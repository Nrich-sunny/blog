(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[]]);!function(n){function e(e){for(var i,s,l=e[0],o=e[1],d=e[2],u=0,p=[];u<l.length;u++)s=l[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&p.push(r[s][0]),r[s]=0;for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i]);for(c&&c(e);p.length;)p.shift()();return a.push.apply(a,d||[]),t()}function t(){for(var n,e=0;e<a.length;e++){for(var t=a[e],i=!0,l=1;l<t.length;l++){var o=t[l];0!==r[o]&&(i=!1)}i&&(a.splice(e--,1),n=s(s.s=t[0]))}return n}var i={},r={1:0},a=[];function s(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(n){var e=[],t=r[n];if(0!==t)if(t)e.push(t[2]);else{var i=new Promise((function(e,i){t=r[n]=[e,i]}));e.push(t[2]=i);var a,l=document.createElement("script");l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.src=function(n){return s.p+"assets/js/"+({}[n]||n)+"."+{2:"c02cd514",3:"620a1f91",4:"0df20a49",5:"94069b5e",6:"90726693",7:"ba20b3c7",8:"2abb0131",9:"ece9abdb",10:"ccc2fc76",11:"15e920f7",12:"d6b747fb",13:"ee8d04f3",14:"b7513ca5",15:"f2e8ff40",16:"347a6e24",17:"6c1e9625",18:"7602b54c",19:"8f4fcc4b",20:"09885064",21:"b525f277",22:"b9ed6df2",23:"523e5d22",24:"d04239a4",25:"237a6c47",26:"6bd9bfe4",27:"ac60ace0",28:"ee14024f",29:"0caa2b3a",30:"e6e7d6f8",31:"6ec6039c",32:"37f8dd2f",33:"7e29804a",34:"8eeb5b9d",35:"72aa34f7",36:"9de84a28",37:"64e3dd13",38:"99ad5507",39:"8cda7b61",40:"ed6949c0",41:"bf343b6b",42:"cbbfd0d9",43:"39209b19",44:"7eec5b18",45:"b088db4c",46:"bfc9e511",47:"d0b2aa80",48:"49b8f1b4",49:"72f6d0a1",50:"dcbe6aa5",51:"cca2da80",52:"063ad237",53:"65573113",54:"e3b86f9a",55:"e23d17b7",56:"c47badfb",57:"8c7d3e16",58:"52fb51c8",59:"8ee7423a",60:"7c6906fd",61:"898384c1",62:"6bf3cdda",63:"fed7f6ff",64:"62128c79",65:"dd8213b3",66:"579f1a82",67:"fa647f5d",68:"d535a10d",69:"4d7e0d52",70:"4b6cd449",71:"be36a223",72:"f57cde07",73:"a4087adf",74:"8f60ef05",75:"fdc945ab",76:"d1f1faa5",77:"687a6763",78:"97f56bb1",79:"35c1de5f",80:"fbe50656",81:"102e33bc",82:"4f73285b"}[n]+".js"}(n);var o=new Error;a=function(e){l.onerror=l.onload=null,clearTimeout(d);var t=r[n];if(0!==t){if(t){var i=e&&("load"===e.type?"missing":e.type),a=e&&e.target&&e.target.src;o.message="Loading chunk "+n+" failed.\n("+i+": "+a+")",o.name="ChunkLoadError",o.type=i,o.request=a,t[1](o)}r[n]=void 0}};var d=setTimeout((function(){a({type:"timeout",target:l})}),12e4);l.onerror=l.onload=a,document.head.appendChild(l)}return Promise.all(e)},s.m=n,s.c=i,s.d=function(n,e,t){s.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},s.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},s.t=function(n,e){if(1&e&&(n=s(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var i in n)s.d(t,i,function(e){return n[e]}.bind(null,i));return t},s.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return s.d(e,"a",e),e},s.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},s.p="/blog/",s.oe=function(n){throw console.error(n),n};var l=window.webpackJsonp=window.webpackJsonp||[],o=l.push.bind(l);l.push=e,l=l.slice();for(var d=0;d<l.length;d++)e(l[d]);var c=o;a.push([104,0]),t()}([function(n,e,t){var i=t(56),r=i.all;n.exports=i.IS_HTMLDDA?function(n){return"function"==typeof n||n===r}:function(n){return"function"==typeof n}},function(n,e){var t=function(n){return n&&n.Math==Math&&n};n.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof global&&global)||function(){return this}()||this||Function("return this")()},function(n,e,t){var i=t(29),r=Function.prototype,a=r.call,s=i&&r.bind.bind(a,a);n.exports=i?s:function(n){return function(){return a.apply(n,arguments)}}},function(n,e){n.exports=function(n){try{return!!n()}catch(n){return!0}}},function(n,e,t){"use strict";function i(n,e,t,i,r,a,s,l){var o,d="function"==typeof n?n.options:n;if(e&&(d.render=e,d.staticRenderFns=t,d._compiled=!0),i&&(d.functional=!0),a&&(d._scopeId="data-v-"+a),s?(o=function(n){(n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(n=__VUE_SSR_CONTEXT__),r&&r.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(s)},d._ssrRegister=o):r&&(o=l?function(){r.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:r),o)if(d.functional){d._injectStyles=o;var c=d.render;d.render=function(n,e){return o.call(e),c(n,e)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,o):[o]}return{exports:n,options:d}}t.d(e,"a",(function(){return i}))},function(n,e,t){var i=t(3);n.exports=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(n,e){var t=Array.isArray;n.exports=t},function(n,e,t){var i=t(2),r=t(33),a=i({}.hasOwnProperty);n.exports=Object.hasOwn||function(n,e){return a(r(n),e)}},function(n,e,t){var i=t(70),r="object"==typeof self&&self&&self.Object===Object&&self,a=i||r||Function("return this")();n.exports=a},function(n,e,t){var i=t(0),r=t(56),a=r.all;n.exports=r.IS_HTMLDDA?function(n){return"object"==typeof n?null!==n:i(n)||n===a}:function(n){return"object"==typeof n?null!==n:i(n)}},function(n,e,t){var i=t(165),r=t(168);n.exports=function(n,e){var t=r(n,e);return i(t)?t:void 0}},function(n,e,t){"use strict";t.d(e,"e",(function(){return i})),t.d(e,"b",(function(){return a})),t.d(e,"j",(function(){return s})),t.d(e,"g",(function(){return o})),t.d(e,"h",(function(){return d})),t.d(e,"i",(function(){return c})),t.d(e,"c",(function(){return u})),t.d(e,"f",(function(){return p})),t.d(e,"l",(function(){return m})),t.d(e,"m",(function(){return h})),t.d(e,"d",(function(){return f})),t.d(e,"k",(function(){return b})),t.d(e,"n",(function(){return v})),t.d(e,"a",(function(){return x}));t(17);const i=/#.*$/,r=/\.(md|html)$/,a=/\/$/,s=/^[a-z]+:/i;function l(n){return decodeURI(n).replace(i,"").replace(r,"")}function o(n){return s.test(n)}function d(n){return/^mailto:/.test(n)}function c(n){return/^tel:/.test(n)}function u(n){if(o(n))return n;if(!n)return"404";const e=n.match(i),t=e?e[0]:"",r=l(n);return a.test(r)?n:r+".html"+t}function p(n,e){const t=n.hash,r=function(n){const e=n&&n.match(i);if(e)return e[0]}(e);if(r&&t!==r)return!1;return l(n.path)===l(e)}function m(n,e,t){if(o(e))return{type:"external",path:e};t&&(e=function(n,e,t){const i=n.charAt(0);if("/"===i)return n;if("?"===i||"#"===i)return e+n;const r=e.split("/");t&&r[r.length-1]||r.pop();const a=n.replace(/^\//,"").split("/");for(let n=0;n<a.length;n++){const e=a[n];".."===e?r.pop():"."!==e&&r.push(e)}""!==r[0]&&r.unshift("");return r.join("/")}(e,t));const i=l(e);for(let e=0;e<n.length;e++)if(l(n[e].regularPath)===i)return Object.assign({},n[e],{type:"page",path:u(n[e].path)});return console.error(`[vuepress] No matching page found for sidebar item "${e}"`),{}}function h(n,e,t,i){const{pages:r,themeConfig:a}=t,s=i&&a.locales&&a.locales[i]||a;if("auto"===(n.frontmatter.sidebar||s.sidebar||a.sidebar))return g(n);const l=s.sidebar||a.sidebar;if(l){const{base:t,config:i}=function(n,e){if(Array.isArray(e))return{base:"/",config:e};for(const i in e)if(0===(t=n,/(\.html|\/)$/.test(t)?t:t+"/").indexOf(encodeURI(i)))return{base:i,config:e[i]};var t;return{}}(e,l);return"auto"===i?g(n):i?i.map(n=>function n(e,t,i,r=1){if("string"==typeof e)return m(t,e,i);if(Array.isArray(e))return Object.assign(m(t,e[0],i),{title:e[1]});{r>3&&console.error("[vuepress] detected a too deep nested sidebar group.");const a=e.children||[];return 0===a.length&&e.path?Object.assign(m(t,e.path,i),{title:e.title}):{type:"group",path:e.path,title:e.title,sidebarDepth:e.sidebarDepth,initialOpenGroupIndex:e.initialOpenGroupIndex,children:a.map(e=>n(e,t,i,r+1)),collapsable:!1!==e.collapsable}}}(n,r,t)):[]}return[]}function g(n){const e=f(n.headers||[]);return[{type:"group",collapsable:!1,title:n.title,path:null,children:e.map(e=>({type:"auto",title:e.title,basePath:n.path,path:n.path+"#"+e.slug,children:e.children||[]}))}]}function f(n){let e;return(n=n.map(n=>Object.assign({},n))).forEach(n=>{2===n.level?e=n:e&&(e.children||(e.children=[])).push(n)}),n.filter(n=>2===n.level)}function b(n){return Object.assign(n,{type:n.items&&n.items.length?"links":"link"})}function v(n){return Object.prototype.toString.call(n).match(/\[object (.*?)\]/)[1].toLowerCase()}function y(n){let e=n.frontmatter.date||n.lastUpdated||new Date,t=new Date(e);return"Invalid Date"==t&&e&&(t=new Date(e.replace(/-/g,"/"))),t.getTime()}function x(n,e){return y(e)-y(n)}},function(n,e){n.exports=function(n){return null!=n&&"object"==typeof n}},function(n,e,t){var i=t(5),r=t(65),a=t(100),s=t(28),l=t(55),o=TypeError,d=Object.defineProperty,c=Object.getOwnPropertyDescriptor;e.f=i?a?function(n,e,t){if(s(n),e=l(e),s(t),"function"==typeof n&&"prototype"===e&&"value"in t&&"writable"in t&&!t.writable){var i=c(n,e);i&&i.writable&&(n[e]=t.value,t={configurable:"configurable"in t?t.configurable:i.configurable,enumerable:"enumerable"in t?t.enumerable:i.enumerable,writable:!1})}return d(n,e,t)}:d:function(n,e,t){if(s(n),e=l(e),s(t),r)try{return d(n,e,t)}catch(n){}if("get"in t||"set"in t)throw o("Accessors not supported");return"value"in t&&(n[e]=t.value),n}},function(n,e,t){var i=t(16),r=t(150),a=t(151),s=i?i.toStringTag:void 0;n.exports=function(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":s&&s in Object(n)?r(n):a(n)}},function(n,e,t){var i=t(5),r=t(13),a=t(36);n.exports=i?function(n,e,t){return r.f(n,e,a(1,t))}:function(n,e,t){return n[e]=t,n}},function(n,e,t){var i=t(8).Symbol;n.exports=i},function(n,e,t){"use strict";var i=t(18),r=t(33),a=t(34),s=t(129),l=t(131);i({target:"Array",proto:!0,arity:1,forced:t(3)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(n){return n instanceof TypeError}}()},{push:function(n){var e=r(this),t=a(e),i=arguments.length;l(t+i);for(var o=0;o<i;o++)e[t]=arguments[o],t++;return s(e,t),t}})},function(n,e,t){var i=t(1),r=t(52).f,a=t(15),s=t(112),l=t(38),o=t(66),d=t(125);n.exports=function(n,e){var t,c,u,p,m,h=n.target,g=n.global,f=n.stat;if(t=g?i:f?i[h]||l(h,{}):(i[h]||{}).prototype)for(c in e){if(p=e[c],u=n.dontCallGetSet?(m=r(t,c))&&m.value:t[c],!d(g?c:h+(f?".":"#")+c,n.forced)&&void 0!==u){if(typeof p==typeof u)continue;o(p,u)}(n.sham||u&&u.sham)&&a(p,"sham",!0),s(t,c,p,n)}}},function(n,e,t){var i=t(2),r=i({}.toString),a=i("".slice);n.exports=function(n){return a(r(n),8,-1)}},function(n,e,t){var i=t(1),r=t(62),a=t(7),s=t(64),l=t(60),o=t(59),d=i.Symbol,c=r("wks"),u=o?d.for||d:d&&d.withoutSetter||s;n.exports=function(n){return a(c,n)||(c[n]=l&&a(d,n)?d[n]:u("Symbol."+n)),c[n]}},function(n,e,t){var i=t(155),r=t(156),a=t(157),s=t(158),l=t(159);function o(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=a,o.prototype.has=s,o.prototype.set=l,n.exports=o},function(n,e,t){var i=t(72);n.exports=function(n,e){for(var t=n.length;t--;)if(i(n[t][0],e))return t;return-1}},function(n,e,t){var i=t(10)(Object,"create");n.exports=i},function(n,e,t){var i=t(177);n.exports=function(n,e){var t=n.__data__;return i(e)?t["string"==typeof e?"string":"hash"]:t.map}},function(n,e,t){var i=t(46);n.exports=function(n){if("string"==typeof n||i(n))return n;var e=n+"";return"0"==e&&1/n==-1/0?"-0":e}},function(n,e,t){var i,r;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */void 0===(r="function"==typeof(i=function(){var n,e,t={version:"0.2.0"},i=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function r(n,e,t){return n<e?e:n>t?t:n}function a(n){return 100*(-1+n)}t.configure=function(n){var e,t;for(e in n)void 0!==(t=n[e])&&n.hasOwnProperty(e)&&(i[e]=t);return this},t.status=null,t.set=function(n){var e=t.isStarted();n=r(n,i.minimum,1),t.status=1===n?null:n;var o=t.render(!e),d=o.querySelector(i.barSelector),c=i.speed,u=i.easing;return o.offsetWidth,s((function(e){""===i.positionUsing&&(i.positionUsing=t.getPositioningCSS()),l(d,function(n,e,t){var r;return(r="translate3d"===i.positionUsing?{transform:"translate3d("+a(n)+"%,0,0)"}:"translate"===i.positionUsing?{transform:"translate("+a(n)+"%,0)"}:{"margin-left":a(n)+"%"}).transition="all "+e+"ms "+t,r}(n,c,u)),1===n?(l(o,{transition:"none",opacity:1}),o.offsetWidth,setTimeout((function(){l(o,{transition:"all "+c+"ms linear",opacity:0}),setTimeout((function(){t.remove(),e()}),c)}),c)):setTimeout(e,c)})),this},t.isStarted=function(){return"number"==typeof t.status},t.start=function(){t.status||t.set(0);var n=function(){setTimeout((function(){t.status&&(t.trickle(),n())}),i.trickleSpeed)};return i.trickle&&n(),this},t.done=function(n){return n||t.status?t.inc(.3+.5*Math.random()).set(1):this},t.inc=function(n){var e=t.status;return e?("number"!=typeof n&&(n=(1-e)*r(Math.random()*e,.1,.95)),e=r(e+n,0,.994),t.set(e)):t.start()},t.trickle=function(){return t.inc(Math.random()*i.trickleRate)},n=0,e=0,t.promise=function(i){return i&&"resolved"!==i.state()?(0===e&&t.start(),n++,e++,i.always((function(){0==--e?(n=0,t.done()):t.set((n-e)/n)})),this):this},t.render=function(n){if(t.isRendered())return document.getElementById("nprogress");d(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.innerHTML=i.template;var r,s=e.querySelector(i.barSelector),o=n?"-100":a(t.status||0),c=document.querySelector(i.parent);return l(s,{transition:"all 0 linear",transform:"translate3d("+o+"%,0,0)"}),i.showSpinner||(r=e.querySelector(i.spinnerSelector))&&p(r),c!=document.body&&d(c,"nprogress-custom-parent"),c.appendChild(e),e},t.remove=function(){c(document.documentElement,"nprogress-busy"),c(document.querySelector(i.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&p(n)},t.isRendered=function(){return!!document.getElementById("nprogress")},t.getPositioningCSS=function(){var n=document.body.style,e="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return e+"Perspective"in n?"translate3d":e+"Transform"in n?"translate":"margin"};var s=function(){var n=[];function e(){var t=n.shift();t&&t(e)}return function(t){n.push(t),1==n.length&&e()}}(),l=function(){var n=["Webkit","O","Moz","ms"],e={};function t(t){return t=t.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(n,e){return e.toUpperCase()})),e[t]||(e[t]=function(e){var t=document.body.style;if(e in t)return e;for(var i,r=n.length,a=e.charAt(0).toUpperCase()+e.slice(1);r--;)if((i=n[r]+a)in t)return i;return e}(t))}function i(n,e,i){e=t(e),n.style[e]=i}return function(n,e){var t,r,a=arguments;if(2==a.length)for(t in e)void 0!==(r=e[t])&&e.hasOwnProperty(t)&&i(n,t,r);else i(n,a[1],a[2])}}();function o(n,e){return("string"==typeof n?n:u(n)).indexOf(" "+e+" ")>=0}function d(n,e){var t=u(n),i=t+e;o(t,e)||(n.className=i.substring(1))}function c(n,e){var t,i=u(n);o(n,e)&&(t=i.replace(" "+e+" "," "),n.className=t.substring(1,t.length-1))}function u(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function p(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return t})?i.call(e,t,e,n):i)||(n.exports=r)},function(n){n.exports=JSON.parse('{"name":"vuepress-plugin-comment","version":"0.7.3","description":"Comment plugin in vuepress, such as Gitalk, Valine...","main":"index.js","scripts":{"test":"echo \\"Error: no test specified\\" && exit 1"},"repository":{"type":"git","url":"git+ssh://git@github.com/dongyuanxin/vuepress-plugin-comment.git"},"keywords":["vuepress","comment","plugin","vue","gitalk","valine"],"author":"dongyuanxin","license":"MIT","bugs":{"url":"https://github.com/dongyuanxin/vuepress-plugin-comment/issues"},"homepage":"https://github.com/dongyuanxin/vuepress-plugin-comment#readme","dependencies":{"ejs":"^2.6.1","gitalk":"^1.5.0","gitalk-fix":"^1.5.2","i":"^0.3.6","npm":"^6.9.0","valine":"^1.3.9"}}')},function(n,e,t){var i=t(9),r=String,a=TypeError;n.exports=function(n){if(i(n))return n;throw a(r(n)+" is not an object")}},function(n,e,t){var i=t(3);n.exports=!i((function(){var n=function(){}.bind();return"function"!=typeof n||n.hasOwnProperty("prototype")}))},function(n,e,t){var i=t(48),r=t(53);n.exports=function(n){return i(r(n))}},function(n,e,t){var i=t(1),r=t(0),a=function(n){return r(n)?n:void 0};n.exports=function(n,e){return arguments.length<2?a(i[n]):i[n]&&i[n][e]}},function(n,e,t){var i=t(0),r=t(110),a=TypeError;n.exports=function(n){if(i(n))return n;throw a(r(n)+" is not a function")}},function(n,e,t){var i=t(53),r=Object;n.exports=function(n){return r(i(n))}},function(n,e,t){var i=t(123);n.exports=function(n){return i(n.length)}},function(n,e,t){var i=t(29),r=Function.prototype.call;n.exports=i?r.bind(r):function(){return r.apply(r,arguments)}},function(n,e){n.exports=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}}},function(n,e,t){var i=t(1),r=t(38),a=i["__core-js_shared__"]||r("__core-js_shared__",{});n.exports=a},function(n,e,t){var i=t(1),r=Object.defineProperty;n.exports=function(n,e){try{r(i,n,{value:e,configurable:!0,writable:!0})}catch(t){i[n]=e}return e}},function(n,e,t){var i=t(149),r=t(12),a=Object.prototype,s=a.hasOwnProperty,l=a.propertyIsEnumerable,o=i(function(){return arguments}())?i:function(n){return r(n)&&s.call(n,"callee")&&!l.call(n,"callee")};n.exports=o},function(n,e,t){var i=t(10)(t(8),"Map");n.exports=i},function(n,e){n.exports=function(n){var e=typeof n;return null!=n&&("object"==e||"function"==e)}},function(n,e,t){var i=t(169),r=t(176),a=t(178),s=t(179),l=t(180);function o(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=a,o.prototype.has=s,o.prototype.set=l,n.exports=o},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n){t[++e]=n})),t}},function(n,e){n.exports=function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=9007199254740991}},function(n,e,t){var i=t(6),r=t(46),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;n.exports=function(n,e){if(i(n))return!1;var t=typeof n;return!("number"!=t&&"symbol"!=t&&"boolean"!=t&&null!=n&&!r(n))||(s.test(n)||!a.test(n)||null!=e&&n in Object(e))}},function(n,e,t){var i=t(14),r=t(12);n.exports=function(n){return"symbol"==typeof n||r(n)&&"[object Symbol]"==i(n)}},function(n,e){n.exports=function(n){return n}},function(n,e,t){var i=t(2),r=t(3),a=t(19),s=Object,l=i("".split);n.exports=r((function(){return!s("z").propertyIsEnumerable(0)}))?function(n){return"String"==a(n)?l(n,""):s(n)}:s},function(n,e){n.exports={}},function(n,e){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children||(n.children=[]),Object.defineProperty(n,"loaded",{enumerable:!0,get:function(){return n.l}}),Object.defineProperty(n,"id",{enumerable:!0,get:function(){return n.i}}),n.webpackPolyfill=1),n}},function(n,e){var t=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,a=/^0o[0-7]+$/i,s=parseInt,l="object"==typeof global&&global&&global.Object===Object&&global,o="object"==typeof self&&self&&self.Object===Object&&self,d=l||o||Function("return this")(),c=Object.prototype.toString,u=Math.max,p=Math.min,m=function(){return d.Date.now()};function h(n){var e=typeof n;return!!n&&("object"==e||"function"==e)}function g(n){if("number"==typeof n)return n;if(function(n){return"symbol"==typeof n||function(n){return!!n&&"object"==typeof n}(n)&&"[object Symbol]"==c.call(n)}(n))return NaN;if(h(n)){var e="function"==typeof n.valueOf?n.valueOf():n;n=h(e)?e+"":e}if("string"!=typeof n)return 0===n?n:+n;n=n.replace(t,"");var l=r.test(n);return l||a.test(n)?s(n.slice(2),l?2:8):i.test(n)?NaN:+n}n.exports=function(n,e,t){var i,r,a,s,l,o,d=0,c=!1,f=!1,b=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function v(e){var t=i,a=r;return i=r=void 0,d=e,s=n.apply(a,t)}function y(n){return d=n,l=setTimeout(k,e),c?v(n):s}function x(n){var t=n-o;return void 0===o||t>=e||t<0||f&&n-d>=a}function k(){var n=m();if(x(n))return _(n);l=setTimeout(k,function(n){var t=e-(n-o);return f?p(t,a-(n-d)):t}(n))}function _(n){return l=void 0,b&&i?v(n):(i=r=void 0,s)}function E(){var n=m(),t=x(n);if(i=arguments,r=this,o=n,t){if(void 0===l)return y(o);if(f)return l=setTimeout(k,e),v(o)}return void 0===l&&(l=setTimeout(k,e)),s}return e=g(e)||0,h(t)&&(c=!!t.leading,a=(f="maxWait"in t)?u(g(t.maxWait)||0,e):a,b="trailing"in t?!!t.trailing:b),E.cancel=function(){void 0!==l&&clearTimeout(l),d=0,i=o=r=l=void 0},E.flush=function(){return void 0===l?s:_(m())},E}},function(n,e,t){var i=t(5),r=t(35),a=t(106),s=t(36),l=t(30),o=t(55),d=t(7),c=t(65),u=Object.getOwnPropertyDescriptor;e.f=i?u:function(n,e){if(n=l(n),e=o(e),c)try{return u(n,e)}catch(n){}if(d(n,e))return s(!r(a.f,n,e),n[e])}},function(n,e,t){var i=t(54),r=TypeError;n.exports=function(n){if(i(n))throw r("Can't call method on "+n);return n}},function(n,e){n.exports=function(n){return null==n}},function(n,e,t){var i=t(107),r=t(57);n.exports=function(n){var e=i(n,"string");return r(e)?e:e+""}},function(n,e){var t="object"==typeof document&&document.all,i=void 0===t&&void 0!==t;n.exports={all:t,IS_HTMLDDA:i}},function(n,e,t){var i=t(31),r=t(0),a=t(58),s=t(59),l=Object;n.exports=s?function(n){return"symbol"==typeof n}:function(n){var e=i("Symbol");return r(e)&&a(e.prototype,l(n))}},function(n,e,t){var i=t(2);n.exports=i({}.isPrototypeOf)},function(n,e,t){var i=t(60);n.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(n,e,t){var i=t(61),r=t(3),a=t(1).String;n.exports=!!Object.getOwnPropertySymbols&&!r((function(){var n=Symbol();return!a(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&i&&i<41}))},function(n,e,t){var i,r,a=t(1),s=t(108),l=a.process,o=a.Deno,d=l&&l.versions||o&&o.version,c=d&&d.v8;c&&(r=(i=c.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&s&&(!(i=s.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=s.match(/Chrome\/(\d+)/))&&(r=+i[1]),n.exports=r},function(n,e,t){var i=t(63),r=t(37);(n.exports=function(n,e){return r[n]||(r[n]=void 0!==e?e:{})})("versions",[]).push({version:"3.30.2",mode:i?"pure":"global",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"})},function(n,e){n.exports=!1},function(n,e,t){var i=t(2),r=0,a=Math.random(),s=i(1..toString);n.exports=function(n){return"Symbol("+(void 0===n?"":n)+")_"+s(++r+a,36)}},function(n,e,t){var i=t(5),r=t(3),a=t(99);n.exports=!i&&!r((function(){return 7!=Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))},function(n,e,t){var i=t(7),r=t(118),a=t(52),s=t(13);n.exports=function(n,e,t){for(var l=r(e),o=s.f,d=a.f,c=0;c<l.length;c++){var u=l[c];i(n,u)||t&&i(t,u)||o(n,u,d(e,u))}}},function(n,e,t){var i=t(122);n.exports=function(n){var e=+n;return e!=e||0===e?0:i(e)}},function(n,e,t){var i=t(135),r=t(28),a=t(136);n.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,e=!1,t={};try{(n=i(Object.prototype,"__proto__","set"))(t,[]),e=t instanceof Array}catch(n){}return function(t,i){return r(t),a(i),e?n(t,i):t.__proto__=i,t}}():void 0)},function(n,e){n.exports=function(n,e){for(var t=-1,i=e.length,r=n.length;++t<i;)n[r+t]=e[t];return n}},function(n,e){var t="object"==typeof global&&global&&global.Object===Object&&global;n.exports=t},function(n,e,t){var i=t(21),r=t(160),a=t(161),s=t(162),l=t(163),o=t(164);function d(n){var e=this.__data__=new i(n);this.size=e.size}d.prototype.clear=r,d.prototype.delete=a,d.prototype.get=s,d.prototype.has=l,d.prototype.set=o,n.exports=d},function(n,e){n.exports=function(n,e){return n===e||n!=n&&e!=e}},function(n,e,t){var i=t(14),r=t(41);n.exports=function(n){if(!r(n))return!1;var e=i(n);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(n,e){var t=Function.prototype.toString;n.exports=function(n){if(null!=n){try{return t.call(n)}catch(n){}try{return n+""}catch(n){}}return""}},function(n,e,t){var i=t(181),r=t(12);n.exports=function n(e,t,a,s,l){return e===t||(null==e||null==t||!r(e)&&!r(t)?e!=e&&t!=t:i(e,t,a,s,n,l))}},function(n,e,t){var i=t(77),r=t(184),a=t(78);n.exports=function(n,e,t,s,l,o){var d=1&t,c=n.length,u=e.length;if(c!=u&&!(d&&u>c))return!1;var p=o.get(n),m=o.get(e);if(p&&m)return p==e&&m==n;var h=-1,g=!0,f=2&t?new i:void 0;for(o.set(n,e),o.set(e,n);++h<c;){var b=n[h],v=e[h];if(s)var y=d?s(v,b,h,e,n,o):s(b,v,h,n,e,o);if(void 0!==y){if(y)continue;g=!1;break}if(f){if(!r(e,(function(n,e){if(!a(f,e)&&(b===n||l(b,n,t,s,o)))return f.push(e)}))){g=!1;break}}else if(b!==v&&!l(b,v,t,s,o)){g=!1;break}}return o.delete(n),o.delete(e),g}},function(n,e,t){var i=t(42),r=t(182),a=t(183);function s(n){var e=-1,t=null==n?0:n.length;for(this.__data__=new i;++e<t;)this.add(n[e])}s.prototype.add=s.prototype.push=r,s.prototype.has=a,n.exports=s},function(n,e){n.exports=function(n,e){return n.has(e)}},function(n,e,t){var i=t(194),r=t(200),a=t(83);n.exports=function(n){return a(n)?i(n):r(n)}},function(n,e,t){(function(n){var i=t(8),r=t(196),a=e&&!e.nodeType&&e,s=a&&"object"==typeof n&&n&&!n.nodeType&&n,l=s&&s.exports===a?i.Buffer:void 0,o=(l?l.isBuffer:void 0)||r;n.exports=o}).call(this,t(50)(n))},function(n,e){var t=/^(?:0|[1-9]\d*)$/;n.exports=function(n,e){var i=typeof n;return!!(e=null==e?9007199254740991:e)&&("number"==i||"symbol"!=i&&t.test(n))&&n>-1&&n%1==0&&n<e}},function(n,e,t){var i=t(197),r=t(198),a=t(199),s=a&&a.isTypedArray,l=s?r(s):i;n.exports=l},function(n,e,t){var i=t(73),r=t(44);n.exports=function(n){return null!=n&&r(n.length)&&!i(n)}},function(n,e,t){var i=t(10)(t(8),"Set");n.exports=i},function(n,e,t){var i=t(41);n.exports=function(n){return n==n&&!i(n)}},function(n,e){n.exports=function(n,e){return function(t){return null!=t&&(t[n]===e&&(void 0!==e||n in Object(t)))}}},function(n,e,t){var i=t(88),r=t(25);n.exports=function(n,e){for(var t=0,a=(e=i(e,n)).length;null!=n&&t<a;)n=n[r(e[t++])];return t&&t==a?n:void 0}},function(n,e,t){var i=t(6),r=t(45),a=t(211),s=t(214);n.exports=function(n,e){return i(n)?n:r(n,e)?[n]:a(s(n))}},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){var i=t(147),r=t(152),a=t(223),s=t(231),l=t(240),o=t(103),d=a((function(n){var e=o(n);return l(e)&&(e=void 0),s(i(n,1,l,!0),r(e,2))}));n.exports=d},function(n,e,t){"use strict";
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var i=/["'&<>]/;n.exports=function(n){var e,t=""+n,r=i.exec(t);if(!r)return t;var a="",s=0,l=0;for(s=r.index;s<t.length;s++){switch(t.charCodeAt(s)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}l!==s&&(a+=t.substring(l,s)),l=s+1,a+=e}return l!==s?a+t.substring(l,s):a}},function(n,e,t){"use strict";
/**
 * @file Embedded JavaScript templating engine. {@link http://ejs.co}
 * @author Matthew Eernisse <mde@fleegix.org>
 * @author Tiancheng "Timothy" Gu <timothygu99@gmail.com>
 * @project EJS
 * @license {@link http://www.apache.org/licenses/LICENSE-2.0 Apache License, Version 2.0}
 */var i=t(249),r=t(250),a=t(251),s=!1,l=t(252).version,o=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],d=o.concat("cache"),c=/^\uFEFF/;function u(n,t){var r,a,s=t.views,l=/^[A-Za-z]+:\\|^\//.exec(n);if(l&&l.length)r=e.resolveInclude(n.replace(/^\/*/,""),t.root||"/",!0);else if(t.filename&&(a=e.resolveInclude(n,t.filename),i.existsSync(a)&&(r=a)),r||Array.isArray(s)&&s.some((function(t){return a=e.resolveInclude(n,t,!0),i.existsSync(a)}))&&(r=a),!r)throw new Error('Could not find the include file "'+t.escapeFunction(n)+'"');return r}function p(n,t){var i,r=n.filename,a=arguments.length>1;if(n.cache){if(!r)throw new Error("cache option requires a filename");if(i=e.cache.get(r))return i;a||(t=h(r).toString().replace(c,""))}else if(!a){if(!r)throw new Error("Internal EJS error: no file name or template provided");t=h(r).toString().replace(c,"")}return i=e.compile(t,n),n.cache&&e.cache.set(r,i),i}function m(n,t,i){var r;if(!i){if("function"==typeof e.promiseImpl)return new e.promiseImpl((function(e,i){try{e(r=p(n)(t))}catch(n){i(n)}}));throw new Error("Please provide a callback function")}try{r=p(n)(t)}catch(n){return i(n)}i(null,r)}function h(n){return e.fileLoader(n)}function g(n,e,t,i,r){var a=e.split("\n"),s=Math.max(i-3,0),l=Math.min(a.length,i+3),o=r(t),d=a.slice(s,l).map((function(n,e){var t=e+s+1;return(t==i?" >> ":"    ")+t+"| "+n})).join("\n");throw n.path=o,n.message=(o||"ejs")+":"+i+"\n"+d+"\n\n"+n.message,n}function f(n){return n.replace(/;(\s*$)/,"$1")}function b(n,t){t=t||{};var i={};this.templateText=n,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",this.dependencies=[],i.client=t.client||!1,i.escapeFunction=t.escape||t.escapeFunction||a.escapeXML,i.compileDebug=!1!==t.compileDebug,i.debug=!!t.debug,i.filename=t.filename,i.openDelimiter=t.openDelimiter||e.openDelimiter||"<",i.closeDelimiter=t.closeDelimiter||e.closeDelimiter||">",i.delimiter=t.delimiter||e.delimiter||"%",i.strict=t.strict||!1,i.context=t.context,i.cache=t.cache||!1,i.rmWhitespace=t.rmWhitespace,i.root=t.root,i.outputFunctionName=t.outputFunctionName,i.localsName=t.localsName||e.localsName||"locals",i.views=t.views,i.async=t.async,i.destructuredLocals=t.destructuredLocals,i.legacyInclude=void 0===t.legacyInclude||!!t.legacyInclude,i.strict?i._with=!1:i._with=void 0===t._with||t._with,this.opts=i,this.regex=this.createRegex()}e.cache=a.cache,e.fileLoader=i.readFileSync,e.localsName="locals",e.promiseImpl=new Function("return this;")().Promise,e.resolveInclude=function(n,e,t){var i=r.dirname,a=r.extname,s=(0,r.resolve)(t?e:i(e),n);return a(n)||(s+=".ejs"),s},e.compile=function(n,e){return e&&e.scope&&(s||(console.warn("`scope` option is deprecated and will be removed in EJS 3"),s=!0),e.context||(e.context=e.scope),delete e.scope),new b(n,e).compile()},e.render=function(n,e,t){var i=e||{},r=t||{};return 2==arguments.length&&a.shallowCopyFromList(r,i,o),p(r,n)(i)},e.renderFile=function(){var n,e,t,i=Array.prototype.slice.call(arguments),r=i.shift(),s={filename:r};return"function"==typeof arguments[arguments.length-1]&&(n=i.pop()),i.length?(e=i.shift(),i.length?a.shallowCopy(s,i.pop()):(e.settings&&(e.settings.views&&(s.views=e.settings.views),e.settings["view cache"]&&(s.cache=!0),(t=e.settings["view options"])&&a.shallowCopy(s,t)),a.shallowCopyFromList(s,e,d)),s.filename=r):e={},m(s,e,n)},e.Template=b,e.clearCache=function(){e.cache.reset()},b.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"},b.prototype={createRegex:function(){var n="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",e=a.escapeRegExpChars(this.opts.delimiter),t=a.escapeRegExpChars(this.opts.openDelimiter),i=a.escapeRegExpChars(this.opts.closeDelimiter);return n=n.replace(/%/g,e).replace(/</g,t).replace(/>/g,i),new RegExp(n)},compile:function(){var n,e,t,i=this.opts,s="",l="",o=i.escapeFunction;if(!this.source){if(this.generateSource(),s+='  var __output = "";\n  function __append(s) { if (s !== undefined && s !== null) __output += s }\n',i.outputFunctionName&&(s+="  var "+i.outputFunctionName+" = __append;\n"),i.destructuredLocals&&i.destructuredLocals.length){for(var d="  var __locals = ("+i.localsName+" || {}),\n",c=0;c<i.destructuredLocals.length;c++){var m=i.destructuredLocals[c];c>0&&(d+=",\n  "),d+=m+" = __locals."+m}s+=d+";\n"}!1!==i._with&&(s+="  with ("+i.localsName+" || {}) {\n",l+="  }\n"),l+="  return __output;\n",this.source=s+this.source+l}n=i.compileDebug?"var __line = 1\n  , __lines = "+JSON.stringify(this.templateText)+"\n  , __filename = "+(i.filename?JSON.stringify(i.filename):"undefined")+";\ntry {\n"+this.source+"} catch (e) {\n  rethrow(e, __lines, __filename, __line, escapeFn);\n}\n":this.source,i.client&&(n="escapeFn = escapeFn || "+o.toString()+";\n"+n,i.compileDebug&&(n="rethrow = rethrow || "+g.toString()+";\n"+n)),i.strict&&(n='"use strict";\n'+n),i.debug&&console.log(n),i.compileDebug&&i.filename&&(n=n+"\n//# sourceURL="+i.filename+"\n");try{if(i.async)try{t=new Function("return (async function(){}).constructor;")()}catch(n){throw n instanceof SyntaxError?new Error("This environment does not support async/await"):n}else t=Function;e=new t(i.localsName+", escapeFn, include, rethrow",n)}catch(n){throw n instanceof SyntaxError&&(i.filename&&(n.message+=" in "+i.filename),n.message+=" while compiling ejs\n\n",n.message+="If the above error is not helpful, you may want to try EJS-Lint:\n",n.message+="https://github.com/RyanZim/EJS-Lint",i.async||(n.message+="\n",n.message+="Or, if you meant to create an async function, pass `async: true` as an option.")),n}var h=i.client?e:function(n){return e.apply(i.context,[n||{},o,function(e,t){var r=a.shallowCopy({},n);return t&&(r=a.shallowCopy(r,t)),function(n,e){var t=a.shallowCopy({},e);return t.filename=u(n,t),p(t)}(e,i)(r)},g])};if(h.dependencies=this.dependencies,i.filename&&"function"==typeof Object.defineProperty){var f=i.filename,b=r.basename(f,r.extname(f));try{Object.defineProperty(h,"name",{value:b,writable:!1,enumerable:!1,configurable:!0})}catch(n){}}return h},generateSource:function(){var n=this.opts;n.rmWhitespace&&(this.templateText=this.templateText.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var t=this,i=this.parseTemplateText(),r=this.opts.delimiter,s=this.opts.openDelimiter,l=this.opts.closeDelimiter;i&&i.length&&i.forEach((function(o,d){var p,m,g,f,v,y;if(0===o.indexOf(s+r)&&0!==o.indexOf(s+r+r)&&(m=i[d+2])!=r+l&&m!="-"+r+l&&m!="_"+r+l)throw new Error('Could not find matching close tag for "'+o+'".');if(n.legacyInclude&&(g=o.match(/^\s*include\s+(\S+)/))&&(p=i[d-1])&&(p==s+r||p==s+r+"-"||p==s+r+"_"))return f=a.shallowCopy({},t.opts),v=function(n,e){var t,i,r=a.shallowCopy({},e);i=h(t=u(n,r)).toString().replace(c,""),r.filename=t;var s=new b(i,r);return s.generateSource(),{source:s.source,filename:t,template:i}}(g[1],f),y=t.opts.compileDebug?"    ; (function(){\n      var __line = 1\n      , __lines = "+JSON.stringify(v.template)+"\n      , __filename = "+JSON.stringify(v.filename)+";\n      try {\n"+v.source+"      } catch (e) {\n        rethrow(e, __lines, __filename, __line, escapeFn);\n      }\n    ; }).call(this)\n":"    ; (function(){\n"+v.source+"    ; }).call(this)\n",t.source+=y,void t.dependencies.push(e.resolveInclude(g[1],f.filename));t.scanLine(o)}))},parseTemplateText:function(){for(var n,e=this.templateText,t=this.regex,i=t.exec(e),r=[];i;)0!==(n=i.index)&&(r.push(e.substring(0,n)),e=e.slice(n)),r.push(i[0]),e=e.slice(i[0].length),i=t.exec(e);return e&&r.push(e),r},_addOutput:function(n){if(this.truncate&&(n=n.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1),!n)return n;n=(n=(n=(n=n.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/"/g,'\\"'),this.source+='    ; __append("'+n+'")\n'},scanLine:function(n){var e,t=this.opts.delimiter,i=this.opts.openDelimiter,r=this.opts.closeDelimiter;switch(e=n.split("\n").length-1,n){case i+t:case i+t+"_":this.mode=b.modes.EVAL;break;case i+t+"=":this.mode=b.modes.ESCAPED;break;case i+t+"-":this.mode=b.modes.RAW;break;case i+t+"#":this.mode=b.modes.COMMENT;break;case i+t+t:this.mode=b.modes.LITERAL,this.source+='    ; __append("'+n.replace(i+t+t,i+t)+'")\n';break;case t+t+r:this.mode=b.modes.LITERAL,this.source+='    ; __append("'+n.replace(t+t+r,t+r)+'")\n';break;case t+r:case"-"+t+r:case"_"+t+r:this.mode==b.modes.LITERAL&&this._addOutput(n),this.mode=null,this.truncate=0===n.indexOf("-")||0===n.indexOf("_");break;default:if(this.mode){switch(this.mode){case b.modes.EVAL:case b.modes.ESCAPED:case b.modes.RAW:n.lastIndexOf("//")>n.lastIndexOf("\n")&&(n+="\n")}switch(this.mode){case b.modes.EVAL:this.source+="    ; "+n+"\n";break;case b.modes.ESCAPED:this.source+="    ; __append(escapeFn("+f(n)+"))\n";break;case b.modes.RAW:this.source+="    ; __append("+f(n)+")\n";break;case b.modes.COMMENT:break;case b.modes.LITERAL:this._addOutput(n)}}else this._addOutput(n)}this.opts.compileDebug&&e&&(this.currentLine+=e,this.source+="    ; __line = "+this.currentLine+"\n")}},e.escapeXML=a.escapeXML,e.__express=e.renderFile,e.VERSION=l,e.name="ejs","undefined"!=typeof window&&(window.ejs=e)},function(n,e,t){"use strict";t.r(e);var i={name:"CodeBlock",props:{title:{type:String,required:!0},active:{type:Boolean,default:!1}}},r=(t(243),t(4)),a=Object(r.a)(i,(function(){return(0,this._self._c)("div",{staticClass:"theme-code-block",class:{"theme-code-block__active":this.active}},[this._t("default")],2)}),[],!1,null,"4f1e9d0c",null);e.default=a.exports},function(n,e,t){"use strict";t.r(e);var i={name:"CodeGroup",data:()=>({codeTabs:[],activeCodeTabIndex:-1}),watch:{activeCodeTabIndex(n){this.codeTabs.forEach(n=>{n.elm.classList.remove("theme-code-block__active")}),this.codeTabs[n].elm.classList.add("theme-code-block__active")}},mounted(){this.codeTabs=(this.$slots.default||[]).filter(n=>Boolean(n.componentOptions)).map((n,e)=>(""===n.componentOptions.propsData.active&&(this.activeCodeTabIndex=e),{title:n.componentOptions.propsData.title,elm:n.elm})),-1===this.activeCodeTabIndex&&this.codeTabs.length>0&&(this.activeCodeTabIndex=0)},methods:{changeCodeTab(n){this.activeCodeTabIndex=n}}},r=(t(244),t(4)),a=Object(r.a)(i,(function(){var n=this,e=n._self._c;return e("div",{staticClass:"theme-code-group"},[e("div",{staticClass:"theme-code-group__nav"},[e("ul",{staticClass:"theme-code-group__ul"},n._l(n.codeTabs,(function(t,i){return e("li",{key:t.title,staticClass:"theme-code-group__li"},[e("button",{staticClass:"theme-code-group__nav-tab",class:{"theme-code-group__nav-tab-active":i===n.activeCodeTabIndex},on:{click:function(e){return n.changeCodeTab(i)}}},[n._v("\n            "+n._s(t.title)+"\n          ")])])})),0)]),n._v(" "),n._t("default"),n._v(" "),n.codeTabs.length<1?e("pre",{staticClass:"pre-blank"},[n._v("// Make sure to add code blocks to your code group")]):n._e()],2)}),[],!1,null,"2f5f1757",null);e.default=a.exports},function(n,e){n.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(n,e,t){var i=t(1),r=t(9),a=i.document,s=r(a)&&r(a.createElement);n.exports=function(n){return s?a.createElement(n):{}}},function(n,e,t){var i=t(5),r=t(3);n.exports=i&&r((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(n,e,t){var i=t(62),r=t(64),a=i("keys");n.exports=function(n){return a[n]||(a[n]=r(n))}},function(n,e,t){var i=t(2),r=t(7),a=t(30),s=t(120).indexOf,l=t(49),o=i([].push);n.exports=function(n,e){var t,i=a(n),d=0,c=[];for(t in i)!r(l,t)&&r(i,t)&&o(c,t);for(;e.length>d;)r(i,t=e[d++])&&(~s(c,t)||o(c,t));return c}},function(n,e){n.exports=function(n){var e=null==n?0:n.length;return e?n[e-1]:void 0}},function(n,e,t){n.exports=t(255)},function(n,e,t){"use strict";var i=t(18),r=t(126).left,a=t(127),s=t(61);i({target:"Array",proto:!0,forced:!t(128)&&s>79&&s<83||!a("reduce")},{reduce:function(n){var e=arguments.length;return r(this,n,e,e>1?arguments[1]:void 0)}})},function(n,e,t){"use strict";var i={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,a=r&&!i.call({1:2},1);e.f=a?function(n){var e=r(this,n);return!!e&&e.enumerable}:i},function(n,e,t){var i=t(35),r=t(9),a=t(57),s=t(109),l=t(111),o=t(20),d=TypeError,c=o("toPrimitive");n.exports=function(n,e){if(!r(n)||a(n))return n;var t,o=s(n,c);if(o){if(void 0===e&&(e="default"),t=i(o,n,e),!r(t)||a(t))return t;throw d("Can't convert object to primitive value")}return void 0===e&&(e="number"),l(n,e)}},function(n,e){n.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},function(n,e,t){var i=t(32),r=t(54);n.exports=function(n,e){var t=n[e];return r(t)?void 0:i(t)}},function(n,e){var t=String;n.exports=function(n){try{return t(n)}catch(n){return"Object"}}},function(n,e,t){var i=t(35),r=t(0),a=t(9),s=TypeError;n.exports=function(n,e){var t,l;if("string"===e&&r(t=n.toString)&&!a(l=i(t,n)))return l;if(r(t=n.valueOf)&&!a(l=i(t,n)))return l;if("string"!==e&&r(t=n.toString)&&!a(l=i(t,n)))return l;throw s("Can't convert object to primitive value")}},function(n,e,t){var i=t(0),r=t(13),a=t(113),s=t(38);n.exports=function(n,e,t,l){l||(l={});var o=l.enumerable,d=void 0!==l.name?l.name:e;if(i(t)&&a(t,d,l),l.global)o?n[e]=t:s(e,t);else{try{l.unsafe?n[e]&&(o=!0):delete n[e]}catch(n){}o?n[e]=t:r.f(n,e,{value:t,enumerable:!1,configurable:!l.nonConfigurable,writable:!l.nonWritable})}return n}},function(n,e,t){var i=t(2),r=t(3),a=t(0),s=t(7),l=t(5),o=t(114).CONFIGURABLE,d=t(115),c=t(116),u=c.enforce,p=c.get,m=String,h=Object.defineProperty,g=i("".slice),f=i("".replace),b=i([].join),v=l&&!r((function(){return 8!==h((function(){}),"length",{value:8}).length})),y=String(String).split("String"),x=n.exports=function(n,e,t){"Symbol("===g(m(e),0,7)&&(e="["+f(m(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!s(n,"name")||o&&n.name!==e)&&(l?h(n,"name",{value:e,configurable:!0}):n.name=e),v&&t&&s(t,"arity")&&n.length!==t.arity&&h(n,"length",{value:t.arity});try{t&&s(t,"constructor")&&t.constructor?l&&h(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch(n){}var i=u(n);return s(i,"source")||(i.source=b(y,"string"==typeof e?e:"")),n};Function.prototype.toString=x((function(){return a(this)&&p(this).source||d(this)}),"toString")},function(n,e,t){var i=t(5),r=t(7),a=Function.prototype,s=i&&Object.getOwnPropertyDescriptor,l=r(a,"name"),o=l&&"something"===function(){}.name,d=l&&(!i||i&&s(a,"name").configurable);n.exports={EXISTS:l,PROPER:o,CONFIGURABLE:d}},function(n,e,t){var i=t(2),r=t(0),a=t(37),s=i(Function.toString);r(a.inspectSource)||(a.inspectSource=function(n){return s(n)}),n.exports=a.inspectSource},function(n,e,t){var i,r,a,s=t(117),l=t(1),o=t(9),d=t(15),c=t(7),u=t(37),p=t(101),m=t(49),h=l.TypeError,g=l.WeakMap;if(s||u.state){var f=u.state||(u.state=new g);f.get=f.get,f.has=f.has,f.set=f.set,i=function(n,e){if(f.has(n))throw h("Object already initialized");return e.facade=n,f.set(n,e),e},r=function(n){return f.get(n)||{}},a=function(n){return f.has(n)}}else{var b=p("state");m[b]=!0,i=function(n,e){if(c(n,b))throw h("Object already initialized");return e.facade=n,d(n,b,e),e},r=function(n){return c(n,b)?n[b]:{}},a=function(n){return c(n,b)}}n.exports={set:i,get:r,has:a,enforce:function(n){return a(n)?r(n):i(n,{})},getterFor:function(n){return function(e){var t;if(!o(e)||(t=r(e)).type!==n)throw h("Incompatible receiver, "+n+" required");return t}}}},function(n,e,t){var i=t(1),r=t(0),a=i.WeakMap;n.exports=r(a)&&/native code/.test(String(a))},function(n,e,t){var i=t(31),r=t(2),a=t(119),s=t(124),l=t(28),o=r([].concat);n.exports=i("Reflect","ownKeys")||function(n){var e=a.f(l(n)),t=s.f;return t?o(e,t(n)):e}},function(n,e,t){var i=t(102),r=t(98).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(n){return i(n,r)}},function(n,e,t){var i=t(30),r=t(121),a=t(34),s=function(n){return function(e,t,s){var l,o=i(e),d=a(o),c=r(s,d);if(n&&t!=t){for(;d>c;)if((l=o[c++])!=l)return!0}else for(;d>c;c++)if((n||c in o)&&o[c]===t)return n||c||0;return!n&&-1}};n.exports={includes:s(!0),indexOf:s(!1)}},function(n,e,t){var i=t(67),r=Math.max,a=Math.min;n.exports=function(n,e){var t=i(n);return t<0?r(t+e,0):a(t,e)}},function(n,e){var t=Math.ceil,i=Math.floor;n.exports=Math.trunc||function(n){var e=+n;return(e>0?i:t)(e)}},function(n,e,t){var i=t(67),r=Math.min;n.exports=function(n){return n>0?r(i(n),9007199254740991):0}},function(n,e){e.f=Object.getOwnPropertySymbols},function(n,e,t){var i=t(3),r=t(0),a=/#|\.prototype\./,s=function(n,e){var t=o[l(n)];return t==c||t!=d&&(r(e)?i(e):!!e)},l=s.normalize=function(n){return String(n).replace(a,".").toLowerCase()},o=s.data={},d=s.NATIVE="N",c=s.POLYFILL="P";n.exports=s},function(n,e,t){var i=t(32),r=t(33),a=t(48),s=t(34),l=TypeError,o=function(n){return function(e,t,o,d){i(t);var c=r(e),u=a(c),p=s(c),m=n?p-1:0,h=n?-1:1;if(o<2)for(;;){if(m in u){d=u[m],m+=h;break}if(m+=h,n?m<0:p<=m)throw l("Reduce of empty array with no initial value")}for(;n?m>=0:p>m;m+=h)m in u&&(d=t(d,u[m],m,c));return d}};n.exports={left:o(!1),right:o(!0)}},function(n,e,t){"use strict";var i=t(3);n.exports=function(n,e){var t=[][n];return!!t&&i((function(){t.call(null,e||function(){return 1},1)}))}},function(n,e,t){var i=t(19);n.exports="undefined"!=typeof process&&"process"==i(process)},function(n,e,t){"use strict";var i=t(5),r=t(130),a=TypeError,s=Object.getOwnPropertyDescriptor,l=i&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(n){return n instanceof TypeError}}();n.exports=l?function(n,e){if(r(n)&&!s(n,"length").writable)throw a("Cannot set read only .length");return n.length=e}:function(n,e){return n.length=e}},function(n,e,t){var i=t(19);n.exports=Array.isArray||function(n){return"Array"==i(n)}},function(n,e){var t=TypeError;n.exports=function(n){if(n>9007199254740991)throw t("Maximum allowed index exceeded");return n}},function(n,e,t){var i=t(18),r=t(1),a=t(133),s=t(134),l=r.WebAssembly,o=7!==Error("e",{cause:7}).cause,d=function(n,e){var t={};t[n]=s(n,e,o),i({global:!0,constructor:!0,arity:1,forced:o},t)},c=function(n,e){if(l&&l[n]){var t={};t[n]=s("WebAssembly."+n,e,o),i({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:o},t)}};d("Error",(function(n){return function(e){return a(n,this,arguments)}})),d("EvalError",(function(n){return function(e){return a(n,this,arguments)}})),d("RangeError",(function(n){return function(e){return a(n,this,arguments)}})),d("ReferenceError",(function(n){return function(e){return a(n,this,arguments)}})),d("SyntaxError",(function(n){return function(e){return a(n,this,arguments)}})),d("TypeError",(function(n){return function(e){return a(n,this,arguments)}})),d("URIError",(function(n){return function(e){return a(n,this,arguments)}})),c("CompileError",(function(n){return function(e){return a(n,this,arguments)}})),c("LinkError",(function(n){return function(e){return a(n,this,arguments)}})),c("RuntimeError",(function(n){return function(e){return a(n,this,arguments)}}))},function(n,e,t){var i=t(29),r=Function.prototype,a=r.apply,s=r.call;n.exports="object"==typeof Reflect&&Reflect.apply||(i?s.bind(a):function(){return s.apply(a,arguments)})},function(n,e,t){"use strict";var i=t(31),r=t(7),a=t(15),s=t(58),l=t(68),o=t(66),d=t(137),c=t(138),u=t(139),p=t(143),m=t(144),h=t(5),g=t(63);n.exports=function(n,e,t,f){var b=f?2:1,v=n.split("."),y=v[v.length-1],x=i.apply(null,v);if(x){var k=x.prototype;if(!g&&r(k,"cause")&&delete k.cause,!t)return x;var _=i("Error"),E=e((function(n,e){var t=u(f?e:n,void 0),i=f?new x(n):new x;return void 0!==t&&a(i,"message",t),m(i,E,i.stack,2),this&&s(k,this)&&c(i,this,E),arguments.length>b&&p(i,arguments[b]),i}));if(E.prototype=k,"Error"!==y?l?l(E,_):o(E,_,{name:!0}):h&&"stackTraceLimit"in x&&(d(E,x,"stackTraceLimit"),d(E,x,"prepareStackTrace")),o(E,x),!g)try{k.name!==y&&a(k,"name",y),k.constructor=E}catch(n){}return E}}},function(n,e,t){var i=t(2),r=t(32);n.exports=function(n,e,t){try{return i(r(Object.getOwnPropertyDescriptor(n,e)[t]))}catch(n){}}},function(n,e,t){var i=t(0),r=String,a=TypeError;n.exports=function(n){if("object"==typeof n||i(n))return n;throw a("Can't set "+r(n)+" as a prototype")}},function(n,e,t){var i=t(13).f;n.exports=function(n,e,t){t in n||i(n,t,{configurable:!0,get:function(){return e[t]},set:function(n){e[t]=n}})}},function(n,e,t){var i=t(0),r=t(9),a=t(68);n.exports=function(n,e,t){var s,l;return a&&i(s=e.constructor)&&s!==t&&r(l=s.prototype)&&l!==t.prototype&&a(n,l),n}},function(n,e,t){var i=t(140);n.exports=function(n,e){return void 0===n?arguments.length<2?"":e:i(n)}},function(n,e,t){var i=t(141),r=String;n.exports=function(n){if("Symbol"===i(n))throw TypeError("Cannot convert a Symbol value to a string");return r(n)}},function(n,e,t){var i=t(142),r=t(0),a=t(19),s=t(20)("toStringTag"),l=Object,o="Arguments"==a(function(){return arguments}());n.exports=i?a:function(n){var e,t,i;return void 0===n?"Undefined":null===n?"Null":"string"==typeof(t=function(n,e){try{return n[e]}catch(n){}}(e=l(n),s))?t:o?a(e):"Object"==(i=a(e))&&r(e.callee)?"Arguments":i}},function(n,e,t){var i={};i[t(20)("toStringTag")]="z",n.exports="[object z]"===String(i)},function(n,e,t){var i=t(9),r=t(15);n.exports=function(n,e){i(e)&&"cause"in e&&r(n,"cause",e.cause)}},function(n,e,t){var i=t(15),r=t(145),a=t(146),s=Error.captureStackTrace;n.exports=function(n,e,t,l){a&&(s?s(n,e):i(n,"stack",r(t,l)))}},function(n,e,t){var i=t(2),r=Error,a=i("".replace),s=String(r("zxcasd").stack),l=/\n\s*at [^:]*:[^\n]*/,o=l.test(s);n.exports=function(n,e){if(o&&"string"==typeof n&&!r.prepareStackTrace)for(;e--;)n=a(n,l,"");return n}},function(n,e,t){var i=t(3),r=t(36);n.exports=!i((function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",r(1,7)),7!==n.stack)}))},function(n,e,t){var i=t(69),r=t(148);n.exports=function n(e,t,a,s,l){var o=-1,d=e.length;for(a||(a=r),l||(l=[]);++o<d;){var c=e[o];t>0&&a(c)?t>1?n(c,t-1,a,s,l):i(l,c):s||(l[l.length]=c)}return l}},function(n,e,t){var i=t(16),r=t(39),a=t(6),s=i?i.isConcatSpreadable:void 0;n.exports=function(n){return a(n)||r(n)||!!(s&&n&&n[s])}},function(n,e,t){var i=t(14),r=t(12);n.exports=function(n){return r(n)&&"[object Arguments]"==i(n)}},function(n,e,t){var i=t(16),r=Object.prototype,a=r.hasOwnProperty,s=r.toString,l=i?i.toStringTag:void 0;n.exports=function(n){var e=a.call(n,l),t=n[l];try{n[l]=void 0;var i=!0}catch(n){}var r=s.call(n);return i&&(e?n[l]=t:delete n[l]),r}},function(n,e){var t=Object.prototype.toString;n.exports=function(n){return t.call(n)}},function(n,e,t){var i=t(153),r=t(209),a=t(47),s=t(6),l=t(220);n.exports=function(n){return"function"==typeof n?n:null==n?a:"object"==typeof n?s(n)?r(n[0],n[1]):i(n):l(n)}},function(n,e,t){var i=t(154),r=t(208),a=t(86);n.exports=function(n){var e=r(n);return 1==e.length&&e[0][2]?a(e[0][0],e[0][1]):function(t){return t===n||i(t,n,e)}}},function(n,e,t){var i=t(71),r=t(75);n.exports=function(n,e,t,a){var s=t.length,l=s,o=!a;if(null==n)return!l;for(n=Object(n);s--;){var d=t[s];if(o&&d[2]?d[1]!==n[d[0]]:!(d[0]in n))return!1}for(;++s<l;){var c=(d=t[s])[0],u=n[c],p=d[1];if(o&&d[2]){if(void 0===u&&!(c in n))return!1}else{var m=new i;if(a)var h=a(u,p,c,n,e,m);if(!(void 0===h?r(p,u,3,a,m):h))return!1}}return!0}},function(n,e){n.exports=function(){this.__data__=[],this.size=0}},function(n,e,t){var i=t(22),r=Array.prototype.splice;n.exports=function(n){var e=this.__data__,t=i(e,n);return!(t<0)&&(t==e.length-1?e.pop():r.call(e,t,1),--this.size,!0)}},function(n,e,t){var i=t(22);n.exports=function(n){var e=this.__data__,t=i(e,n);return t<0?void 0:e[t][1]}},function(n,e,t){var i=t(22);n.exports=function(n){return i(this.__data__,n)>-1}},function(n,e,t){var i=t(22);n.exports=function(n,e){var t=this.__data__,r=i(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}},function(n,e,t){var i=t(21);n.exports=function(){this.__data__=new i,this.size=0}},function(n,e){n.exports=function(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}},function(n,e){n.exports=function(n){return this.__data__.get(n)}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e,t){var i=t(21),r=t(40),a=t(42);n.exports=function(n,e){var t=this.__data__;if(t instanceof i){var s=t.__data__;if(!r||s.length<199)return s.push([n,e]),this.size=++t.size,this;t=this.__data__=new a(s)}return t.set(n,e),this.size=t.size,this}},function(n,e,t){var i=t(73),r=t(166),a=t(41),s=t(74),l=/^\[object .+?Constructor\]$/,o=Function.prototype,d=Object.prototype,c=o.toString,u=d.hasOwnProperty,p=RegExp("^"+c.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=function(n){return!(!a(n)||r(n))&&(i(n)?p:l).test(s(n))}},function(n,e,t){var i,r=t(167),a=(i=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";n.exports=function(n){return!!a&&a in n}},function(n,e,t){var i=t(8)["__core-js_shared__"];n.exports=i},function(n,e){n.exports=function(n,e){return null==n?void 0:n[e]}},function(n,e,t){var i=t(170),r=t(21),a=t(40);n.exports=function(){this.size=0,this.__data__={hash:new i,map:new(a||r),string:new i}}},function(n,e,t){var i=t(171),r=t(172),a=t(173),s=t(174),l=t(175);function o(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}o.prototype.clear=i,o.prototype.delete=r,o.prototype.get=a,o.prototype.has=s,o.prototype.set=l,n.exports=o},function(n,e,t){var i=t(23);n.exports=function(){this.__data__=i?i(null):{},this.size=0}},function(n,e){n.exports=function(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}},function(n,e,t){var i=t(23),r=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;if(i){var t=e[n];return"__lodash_hash_undefined__"===t?void 0:t}return r.call(e,n)?e[n]:void 0}},function(n,e,t){var i=t(23),r=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;return i?void 0!==e[n]:r.call(e,n)}},function(n,e,t){var i=t(23);n.exports=function(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=i&&void 0===e?"__lodash_hash_undefined__":e,this}},function(n,e,t){var i=t(24);n.exports=function(n){var e=i(this,n).delete(n);return this.size-=e?1:0,e}},function(n,e){n.exports=function(n){var e=typeof n;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==n:null===n}},function(n,e,t){var i=t(24);n.exports=function(n){return i(this,n).get(n)}},function(n,e,t){var i=t(24);n.exports=function(n){return i(this,n).has(n)}},function(n,e,t){var i=t(24);n.exports=function(n,e){var t=i(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}},function(n,e,t){var i=t(71),r=t(76),a=t(185),s=t(188),l=t(204),o=t(6),d=t(80),c=t(82),u="[object Object]",p=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,m,h,g){var f=o(n),b=o(e),v=f?"[object Array]":l(n),y=b?"[object Array]":l(e),x=(v="[object Arguments]"==v?u:v)==u,k=(y="[object Arguments]"==y?u:y)==u,_=v==y;if(_&&d(n)){if(!d(e))return!1;f=!0,x=!1}if(_&&!x)return g||(g=new i),f||c(n)?r(n,e,t,m,h,g):a(n,e,v,t,m,h,g);if(!(1&t)){var E=x&&p.call(n,"__wrapped__"),S=k&&p.call(e,"__wrapped__");if(E||S){var R=E?n.value():n,T=S?e.value():e;return g||(g=new i),h(R,T,t,m,g)}}return!!_&&(g||(g=new i),s(n,e,t,m,h,g))}},function(n,e){n.exports=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e){n.exports=function(n,e){for(var t=-1,i=null==n?0:n.length;++t<i;)if(e(n[t],t,n))return!0;return!1}},function(n,e,t){var i=t(16),r=t(186),a=t(72),s=t(76),l=t(187),o=t(43),d=i?i.prototype:void 0,c=d?d.valueOf:void 0;n.exports=function(n,e,t,i,d,u,p){switch(t){case"[object DataView]":if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=e.byteLength||!u(new r(n),new r(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return a(+n,+e);case"[object Error]":return n.name==e.name&&n.message==e.message;case"[object RegExp]":case"[object String]":return n==e+"";case"[object Map]":var m=l;case"[object Set]":var h=1&i;if(m||(m=o),n.size!=e.size&&!h)return!1;var g=p.get(n);if(g)return g==e;i|=2,p.set(n,e);var f=s(m(n),m(e),i,d,u,p);return p.delete(n),f;case"[object Symbol]":if(c)return c.call(n)==c.call(e)}return!1}},function(n,e,t){var i=t(8).Uint8Array;n.exports=i},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n,i){t[++e]=[i,n]})),t}},function(n,e,t){var i=t(189),r=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,a,s,l){var o=1&t,d=i(n),c=d.length;if(c!=i(e).length&&!o)return!1;for(var u=c;u--;){var p=d[u];if(!(o?p in e:r.call(e,p)))return!1}var m=l.get(n),h=l.get(e);if(m&&h)return m==e&&h==n;var g=!0;l.set(n,e),l.set(e,n);for(var f=o;++u<c;){var b=n[p=d[u]],v=e[p];if(a)var y=o?a(v,b,p,e,n,l):a(b,v,p,n,e,l);if(!(void 0===y?b===v||s(b,v,t,a,l):y)){g=!1;break}f||(f="constructor"==p)}if(g&&!f){var x=n.constructor,k=e.constructor;x==k||!("constructor"in n)||!("constructor"in e)||"function"==typeof x&&x instanceof x&&"function"==typeof k&&k instanceof k||(g=!1)}return l.delete(n),l.delete(e),g}},function(n,e,t){var i=t(190),r=t(191),a=t(79);n.exports=function(n){return i(n,a,r)}},function(n,e,t){var i=t(69),r=t(6);n.exports=function(n,e,t){var a=e(n);return r(n)?a:i(a,t(n))}},function(n,e,t){var i=t(192),r=t(193),a=Object.prototype.propertyIsEnumerable,s=Object.getOwnPropertySymbols,l=s?function(n){return null==n?[]:(n=Object(n),i(s(n),(function(e){return a.call(n,e)})))}:r;n.exports=l},function(n,e){n.exports=function(n,e){for(var t=-1,i=null==n?0:n.length,r=0,a=[];++t<i;){var s=n[t];e(s,t,n)&&(a[r++]=s)}return a}},function(n,e){n.exports=function(){return[]}},function(n,e,t){var i=t(195),r=t(39),a=t(6),s=t(80),l=t(81),o=t(82),d=Object.prototype.hasOwnProperty;n.exports=function(n,e){var t=a(n),c=!t&&r(n),u=!t&&!c&&s(n),p=!t&&!c&&!u&&o(n),m=t||c||u||p,h=m?i(n.length,String):[],g=h.length;for(var f in n)!e&&!d.call(n,f)||m&&("length"==f||u&&("offset"==f||"parent"==f)||p&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||l(f,g))||h.push(f);return h}},function(n,e){n.exports=function(n,e){for(var t=-1,i=Array(n);++t<n;)i[t]=e(t);return i}},function(n,e){n.exports=function(){return!1}},function(n,e,t){var i=t(14),r=t(44),a=t(12),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,n.exports=function(n){return a(n)&&r(n.length)&&!!s[i(n)]}},function(n,e){n.exports=function(n){return function(e){return n(e)}}},function(n,e,t){(function(n){var i=t(70),r=e&&!e.nodeType&&e,a=r&&"object"==typeof n&&n&&!n.nodeType&&n,s=a&&a.exports===r&&i.process,l=function(){try{var n=a&&a.require&&a.require("util").types;return n||s&&s.binding&&s.binding("util")}catch(n){}}();n.exports=l}).call(this,t(50)(n))},function(n,e,t){var i=t(201),r=t(202),a=Object.prototype.hasOwnProperty;n.exports=function(n){if(!i(n))return r(n);var e=[];for(var t in Object(n))a.call(n,t)&&"constructor"!=t&&e.push(t);return e}},function(n,e){var t=Object.prototype;n.exports=function(n){var e=n&&n.constructor;return n===("function"==typeof e&&e.prototype||t)}},function(n,e,t){var i=t(203)(Object.keys,Object);n.exports=i},function(n,e){n.exports=function(n,e){return function(t){return n(e(t))}}},function(n,e,t){var i=t(205),r=t(40),a=t(206),s=t(84),l=t(207),o=t(14),d=t(74),c=d(i),u=d(r),p=d(a),m=d(s),h=d(l),g=o;(i&&"[object DataView]"!=g(new i(new ArrayBuffer(1)))||r&&"[object Map]"!=g(new r)||a&&"[object Promise]"!=g(a.resolve())||s&&"[object Set]"!=g(new s)||l&&"[object WeakMap]"!=g(new l))&&(g=function(n){var e=o(n),t="[object Object]"==e?n.constructor:void 0,i=t?d(t):"";if(i)switch(i){case c:return"[object DataView]";case u:return"[object Map]";case p:return"[object Promise]";case m:return"[object Set]";case h:return"[object WeakMap]"}return e}),n.exports=g},function(n,e,t){var i=t(10)(t(8),"DataView");n.exports=i},function(n,e,t){var i=t(10)(t(8),"Promise");n.exports=i},function(n,e,t){var i=t(10)(t(8),"WeakMap");n.exports=i},function(n,e,t){var i=t(85),r=t(79);n.exports=function(n){for(var e=r(n),t=e.length;t--;){var a=e[t],s=n[a];e[t]=[a,s,i(s)]}return e}},function(n,e,t){var i=t(75),r=t(210),a=t(217),s=t(45),l=t(85),o=t(86),d=t(25);n.exports=function(n,e){return s(n)&&l(e)?o(d(n),e):function(t){var s=r(t,n);return void 0===s&&s===e?a(t,n):i(e,s,3)}}},function(n,e,t){var i=t(87);n.exports=function(n,e,t){var r=null==n?void 0:i(n,e);return void 0===r?t:r}},function(n,e,t){var i=t(212),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,s=i((function(n){var e=[];return 46===n.charCodeAt(0)&&e.push(""),n.replace(r,(function(n,t,i,r){e.push(i?r.replace(a,"$1"):t||n)})),e}));n.exports=s},function(n,e,t){var i=t(213);n.exports=function(n){var e=i(n,(function(n){return 500===t.size&&t.clear(),n})),t=e.cache;return e}},function(n,e,t){var i=t(42);function r(n,e){if("function"!=typeof n||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var t=function(){var i=arguments,r=e?e.apply(this,i):i[0],a=t.cache;if(a.has(r))return a.get(r);var s=n.apply(this,i);return t.cache=a.set(r,s)||a,s};return t.cache=new(r.Cache||i),t}r.Cache=i,n.exports=r},function(n,e,t){var i=t(215);n.exports=function(n){return null==n?"":i(n)}},function(n,e,t){var i=t(16),r=t(216),a=t(6),s=t(46),l=i?i.prototype:void 0,o=l?l.toString:void 0;n.exports=function n(e){if("string"==typeof e)return e;if(a(e))return r(e,n)+"";if(s(e))return o?o.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(n,e){n.exports=function(n,e){for(var t=-1,i=null==n?0:n.length,r=Array(i);++t<i;)r[t]=e(n[t],t,n);return r}},function(n,e,t){var i=t(218),r=t(219);n.exports=function(n,e){return null!=n&&r(n,e,i)}},function(n,e){n.exports=function(n,e){return null!=n&&e in Object(n)}},function(n,e,t){var i=t(88),r=t(39),a=t(6),s=t(81),l=t(44),o=t(25);n.exports=function(n,e,t){for(var d=-1,c=(e=i(e,n)).length,u=!1;++d<c;){var p=o(e[d]);if(!(u=null!=n&&t(n,p)))break;n=n[p]}return u||++d!=c?u:!!(c=null==n?0:n.length)&&l(c)&&s(p,c)&&(a(n)||r(n))}},function(n,e,t){var i=t(221),r=t(222),a=t(45),s=t(25);n.exports=function(n){return a(n)?i(s(n)):r(n)}},function(n,e){n.exports=function(n){return function(e){return null==e?void 0:e[n]}}},function(n,e,t){var i=t(87);n.exports=function(n){return function(e){return i(e,n)}}},function(n,e,t){var i=t(47),r=t(224),a=t(226);n.exports=function(n,e){return a(r(n,e,i),n+"")}},function(n,e,t){var i=t(225),r=Math.max;n.exports=function(n,e,t){return e=r(void 0===e?n.length-1:e,0),function(){for(var a=arguments,s=-1,l=r(a.length-e,0),o=Array(l);++s<l;)o[s]=a[e+s];s=-1;for(var d=Array(e+1);++s<e;)d[s]=a[s];return d[e]=t(o),i(n,this,d)}}},function(n,e){n.exports=function(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}},function(n,e,t){var i=t(227),r=t(230)(i);n.exports=r},function(n,e,t){var i=t(228),r=t(229),a=t(47),s=r?function(n,e){return r(n,"toString",{configurable:!0,enumerable:!1,value:i(e),writable:!0})}:a;n.exports=s},function(n,e){n.exports=function(n){return function(){return n}}},function(n,e,t){var i=t(10),r=function(){try{var n=i(Object,"defineProperty");return n({},"",{}),n}catch(n){}}();n.exports=r},function(n,e){var t=Date.now;n.exports=function(n){var e=0,i=0;return function(){var r=t(),a=16-(r-i);if(i=r,a>0){if(++e>=800)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}},function(n,e,t){var i=t(77),r=t(232),a=t(237),s=t(78),l=t(238),o=t(43);n.exports=function(n,e,t){var d=-1,c=r,u=n.length,p=!0,m=[],h=m;if(t)p=!1,c=a;else if(u>=200){var g=e?null:l(n);if(g)return o(g);p=!1,c=s,h=new i}else h=e?[]:m;n:for(;++d<u;){var f=n[d],b=e?e(f):f;if(f=t||0!==f?f:0,p&&b==b){for(var v=h.length;v--;)if(h[v]===b)continue n;e&&h.push(b),m.push(f)}else c(h,b,t)||(h!==m&&h.push(b),m.push(f))}return m}},function(n,e,t){var i=t(233);n.exports=function(n,e){return!!(null==n?0:n.length)&&i(n,e,0)>-1}},function(n,e,t){var i=t(234),r=t(235),a=t(236);n.exports=function(n,e,t){return e==e?a(n,e,t):i(n,r,t)}},function(n,e){n.exports=function(n,e,t,i){for(var r=n.length,a=t+(i?1:-1);i?a--:++a<r;)if(e(n[a],a,n))return a;return-1}},function(n,e){n.exports=function(n){return n!=n}},function(n,e){n.exports=function(n,e,t){for(var i=t-1,r=n.length;++i<r;)if(n[i]===e)return i;return-1}},function(n,e){n.exports=function(n,e,t){for(var i=-1,r=null==n?0:n.length;++i<r;)if(t(e,n[i]))return!0;return!1}},function(n,e,t){var i=t(84),r=t(239),a=t(43),s=i&&1/a(new i([,-0]))[1]==1/0?function(n){return new i(n)}:r;n.exports=s},function(n,e){n.exports=function(){}},function(n,e,t){var i=t(83),r=t(12);n.exports=function(n){return r(n)&&i(n)}},function(n,e,t){},function(n,e,t){},function(n,e,t){"use strict";t(89)},function(n,e,t){"use strict";t(90)},function(n,e,t){},function(n,e,t){},function(n,e,t){var i=t(18),r=t(1),a=t(248);i({global:!0},{Reflect:{}}),a(r.Reflect,"Reflect",!0)},function(n,e,t){var i=t(13).f,r=t(7),a=t(20)("toStringTag");n.exports=function(n,e,t){n&&!t&&(n=n.prototype),n&&!r(n,a)&&i(n,a,{configurable:!0,value:e})}},function(n,e){},function(n,e){function t(n,e){for(var t=0,i=n.length-1;i>=0;i--){var r=n[i];"."===r?n.splice(i,1):".."===r?(n.splice(i,1),t++):t&&(n.splice(i,1),t--)}if(e)for(;t--;t)n.unshift("..");return n}function i(n,e){if(n.filter)return n.filter(e);for(var t=[],i=0;i<n.length;i++)e(n[i],i,n)&&t.push(n[i]);return t}e.resolve=function(){for(var n="",e=!1,r=arguments.length-1;r>=-1&&!e;r--){var a=r>=0?arguments[r]:process.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(n=a+"/"+n,e="/"===a.charAt(0))}return(e?"/":"")+(n=t(i(n.split("/"),(function(n){return!!n})),!e).join("/"))||"."},e.normalize=function(n){var a=e.isAbsolute(n),s="/"===r(n,-1);return(n=t(i(n.split("/"),(function(n){return!!n})),!a).join("/"))||a||(n="."),n&&s&&(n+="/"),(a?"/":"")+n},e.isAbsolute=function(n){return"/"===n.charAt(0)},e.join=function(){var n=Array.prototype.slice.call(arguments,0);return e.normalize(i(n,(function(n,e){if("string"!=typeof n)throw new TypeError("Arguments to path.join must be strings");return n})).join("/"))},e.relative=function(n,t){function i(n){for(var e=0;e<n.length&&""===n[e];e++);for(var t=n.length-1;t>=0&&""===n[t];t--);return e>t?[]:n.slice(e,t-e+1)}n=e.resolve(n).substr(1),t=e.resolve(t).substr(1);for(var r=i(n.split("/")),a=i(t.split("/")),s=Math.min(r.length,a.length),l=s,o=0;o<s;o++)if(r[o]!==a[o]){l=o;break}var d=[];for(o=l;o<r.length;o++)d.push("..");return(d=d.concat(a.slice(l))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(n){if("string"!=typeof n&&(n+=""),0===n.length)return".";for(var e=n.charCodeAt(0),t=47===e,i=-1,r=!0,a=n.length-1;a>=1;--a)if(47===(e=n.charCodeAt(a))){if(!r){i=a;break}}else r=!1;return-1===i?t?"/":".":t&&1===i?"/":n.slice(0,i)},e.basename=function(n,e){var t=function(n){"string"!=typeof n&&(n+="");var e,t=0,i=-1,r=!0;for(e=n.length-1;e>=0;--e)if(47===n.charCodeAt(e)){if(!r){t=e+1;break}}else-1===i&&(r=!1,i=e+1);return-1===i?"":n.slice(t,i)}(n);return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t},e.extname=function(n){"string"!=typeof n&&(n+="");for(var e=-1,t=0,i=-1,r=!0,a=0,s=n.length-1;s>=0;--s){var l=n.charCodeAt(s);if(47!==l)-1===i&&(r=!1,i=s+1),46===l?-1===e?e=s:1!==a&&(a=1):-1!==e&&(a=-1);else if(!r){t=s+1;break}}return-1===e||-1===i||0===a||1===a&&e===i-1&&e===t+1?"":n.slice(e,i)};var r="b"==="ab".substr(-1)?function(n,e,t){return n.substr(e,t)}:function(n,e,t){return e<0&&(e=n.length+e),n.substr(e,t)}},function(n,e,t){"use strict";var i=/[|\\{}()[\]^$+*?.]/g;e.escapeRegExpChars=function(n){return n?String(n).replace(i,"\\$&"):""};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},a=/[&<>'"]/g;function s(n){return r[n]||n}e.escapeXML=function(n){return null==n?"":String(n).replace(a,s)},e.escapeXML.toString=function(){return Function.prototype.toString.call(this)+';\nvar _ENCODE_HTML_RULES = {\n      "&": "&amp;"\n    , "<": "&lt;"\n    , ">": "&gt;"\n    , \'"\': "&#34;"\n    , "\'": "&#39;"\n    }\n  , _MATCH_HTML = /[&<>\'"]/g;\nfunction encode_char(c) {\n  return _ENCODE_HTML_RULES[c] || c;\n};\n'},e.shallowCopy=function(n,e){for(var t in e=e||{})n[t]=e[t];return n},e.shallowCopyFromList=function(n,e,t){for(var i=0;i<t.length;i++){var r=t[i];void 0!==e[r]&&(n[r]=e[r])}return n},e.cache={_data:{},set:function(n,e){this._data[n]=e},get:function(n){return this._data[n]},remove:function(n){delete this._data[n]},reset:function(){this._data={}}}},function(n){n.exports=JSON.parse('{"name":"ejs","description":"Embedded JavaScript templates","keywords":["template","engine","ejs"],"version":"2.7.4","author":"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)","license":"Apache-2.0","main":"./lib/ejs.js","repository":{"type":"git","url":"git://github.com/mde/ejs.git"},"bugs":"https://github.com/mde/ejs/issues","homepage":"https://github.com/mde/ejs","dependencies":{},"devDependencies":{"browserify":"^13.1.1","eslint":"^4.14.0","git-directory-deploy":"^1.5.1","jake":"^10.3.1","jsdoc":"^3.4.0","lru-cache":"^4.0.1","mocha":"^5.0.5","uglify-js":"^3.3.16"},"engines":{"node":">=0.10.0"},"scripts":{"test":"mocha","postinstall":"node ./postinstall.js"}}')},function(n,e,t){"use strict";t(91)},function(n,e,t){"use strict";t(92)},function(n,e,t){"use strict";t.r(e);
/*!
 * Vue.js v2.7.14
 * (c) 2014-2022 Evan You
 * Released under the MIT License.
 */
var i=Object.freeze({}),r=Array.isArray;function a(n){return null==n}function s(n){return null!=n}function l(n){return!0===n}function o(n){return"string"==typeof n||"number"==typeof n||"symbol"==typeof n||"boolean"==typeof n}function d(n){return"function"==typeof n}function c(n){return null!==n&&"object"==typeof n}var u=Object.prototype.toString;function p(n){return"[object Object]"===u.call(n)}function m(n){return"[object RegExp]"===u.call(n)}function h(n){var e=parseFloat(String(n));return e>=0&&Math.floor(e)===e&&isFinite(n)}function g(n){return s(n)&&"function"==typeof n.then&&"function"==typeof n.catch}function f(n){return null==n?"":Array.isArray(n)||p(n)&&n.toString===u?JSON.stringify(n,null,2):String(n)}function b(n){var e=parseFloat(n);return isNaN(e)?n:e}function v(n,e){for(var t=Object.create(null),i=n.split(","),r=0;r<i.length;r++)t[i[r]]=!0;return e?function(n){return t[n.toLowerCase()]}:function(n){return t[n]}}v("slot,component",!0);var y=v("key,ref,slot,slot-scope,is");function x(n,e){var t=n.length;if(t){if(e===n[t-1])return void(n.length=t-1);var i=n.indexOf(e);if(i>-1)return n.splice(i,1)}}var k=Object.prototype.hasOwnProperty;function _(n,e){return k.call(n,e)}function E(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var S=/-(\w)/g,R=E((function(n){return n.replace(S,(function(n,e){return e?e.toUpperCase():""}))})),T=E((function(n){return n.charAt(0).toUpperCase()+n.slice(1)})),w=/\B([A-Z])/g,I=E((function(n){return n.replace(w,"-$1").toLowerCase()}));var A=Function.prototype.bind?function(n,e){return n.bind(e)}:function(n,e){function t(t){var i=arguments.length;return i?i>1?n.apply(e,arguments):n.call(e,t):n.call(e)}return t._length=n.length,t};function L(n,e){e=e||0;for(var t=n.length-e,i=new Array(t);t--;)i[t]=n[t+e];return i}function B(n,e){for(var t in e)n[t]=e[t];return n}function C(n){for(var e={},t=0;t<n.length;t++)n[t]&&B(e,n[t]);return e}function z(n,e,t){}var D=function(n,e,t){return!1},P=function(n){return n};function O(n,e){if(n===e)return!0;var t=c(n),i=c(e);if(!t||!i)return!t&&!i&&String(n)===String(e);try{var r=Array.isArray(n),a=Array.isArray(e);if(r&&a)return n.length===e.length&&n.every((function(n,t){return O(n,e[t])}));if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(r||a)return!1;var s=Object.keys(n),l=Object.keys(e);return s.length===l.length&&s.every((function(t){return O(n[t],e[t])}))}catch(n){return!1}}function M(n,e){for(var t=0;t<n.length;t++)if(O(n[t],e))return t;return-1}function j(n){var e=!1;return function(){e||(e=!0,n.apply(this,arguments))}}function U(n,e){return n===e?0===n&&1/n!=1/e:n==n||e==e}var $=["component","directive","filter"],F=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch","renderTracked","renderTriggered"],N={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:D,isReservedAttr:D,isUnknownElement:D,getTagNamespace:z,parsePlatformTagName:P,mustUseProp:D,async:!0,_lifecycleHooks:F},q=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function G(n){var e=(n+"").charCodeAt(0);return 36===e||95===e}function K(n,e,t,i){Object.defineProperty(n,e,{value:t,enumerable:!!i,writable:!0,configurable:!0})}var H=new RegExp("[^".concat(q.source,".$_\\d]"));var J="__proto__"in{},V="undefined"!=typeof window,Q=V&&window.navigator.userAgent.toLowerCase(),X=Q&&/msie|trident/.test(Q),W=Q&&Q.indexOf("msie 9.0")>0,Y=Q&&Q.indexOf("edge/")>0;Q&&Q.indexOf("android");var Z=Q&&/iphone|ipad|ipod|ios/.test(Q);Q&&/chrome\/\d+/.test(Q),Q&&/phantomjs/.test(Q);var nn,en=Q&&Q.match(/firefox\/(\d+)/),tn={}.watch,rn=!1;if(V)try{var an={};Object.defineProperty(an,"passive",{get:function(){rn=!0}}),window.addEventListener("test-passive",null,an)}catch(n){}var sn=function(){return void 0===nn&&(nn=!V&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),nn},ln=V&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function on(n){return"function"==typeof n&&/native code/.test(n.toString())}var dn,cn="undefined"!=typeof Symbol&&on(Symbol)&&"undefined"!=typeof Reflect&&on(Reflect.ownKeys);dn="undefined"!=typeof Set&&on(Set)?Set:function(){function n(){this.set=Object.create(null)}return n.prototype.has=function(n){return!0===this.set[n]},n.prototype.add=function(n){this.set[n]=!0},n.prototype.clear=function(){this.set=Object.create(null)},n}();var un=null;function pn(n){void 0===n&&(n=null),n||un&&un._scope.off(),un=n,n&&n._scope.on()}var mn=function(){function n(n,e,t,i,r,a,s,l){this.tag=n,this.data=e,this.children=t,this.text=i,this.elm=r,this.ns=void 0,this.context=a,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=s,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=l,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1}return Object.defineProperty(n.prototype,"child",{get:function(){return this.componentInstance},enumerable:!1,configurable:!0}),n}(),hn=function(n){void 0===n&&(n="");var e=new mn;return e.text=n,e.isComment=!0,e};function gn(n){return new mn(void 0,void 0,void 0,String(n))}function fn(n){var e=new mn(n.tag,n.data,n.children&&n.children.slice(),n.text,n.elm,n.context,n.componentOptions,n.asyncFactory);return e.ns=n.ns,e.isStatic=n.isStatic,e.key=n.key,e.isComment=n.isComment,e.fnContext=n.fnContext,e.fnOptions=n.fnOptions,e.fnScopeId=n.fnScopeId,e.asyncMeta=n.asyncMeta,e.isCloned=!0,e}var bn=0,vn=[],yn=function(){function n(){this._pending=!1,this.id=bn++,this.subs=[]}return n.prototype.addSub=function(n){this.subs.push(n)},n.prototype.removeSub=function(n){this.subs[this.subs.indexOf(n)]=null,this._pending||(this._pending=!0,vn.push(this))},n.prototype.depend=function(e){n.target&&n.target.addDep(this)},n.prototype.notify=function(n){var e=this.subs.filter((function(n){return n}));for(var t=0,i=e.length;t<i;t++){0,e[t].update()}},n}();yn.target=null;var xn=[];function kn(n){xn.push(n),yn.target=n}function _n(){xn.pop(),yn.target=xn[xn.length-1]}var En=Array.prototype,Sn=Object.create(En);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(n){var e=En[n];K(Sn,n,(function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r,a=e.apply(this,t),s=this.__ob__;switch(n){case"push":case"unshift":r=t;break;case"splice":r=t.slice(2)}return r&&s.observeArray(r),s.dep.notify(),a}))}));var Rn=Object.getOwnPropertyNames(Sn),Tn={},wn=!0;function In(n){wn=n}var An={notify:z,depend:z,addSub:z,removeSub:z},Ln=function(){function n(n,e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this.value=n,this.shallow=e,this.mock=t,this.dep=t?An:new yn,this.vmCount=0,K(n,"__ob__",this),r(n)){if(!t)if(J)n.__proto__=Sn;else for(var i=0,a=Rn.length;i<a;i++){K(n,l=Rn[i],Sn[l])}e||this.observeArray(n)}else{var s=Object.keys(n);for(i=0;i<s.length;i++){var l;Cn(n,l=s[i],Tn,void 0,e,t)}}}return n.prototype.observeArray=function(n){for(var e=0,t=n.length;e<t;e++)Bn(n[e],!1,this.mock)},n}();function Bn(n,e,t){return n&&_(n,"__ob__")&&n.__ob__ instanceof Ln?n.__ob__:!wn||!t&&sn()||!r(n)&&!p(n)||!Object.isExtensible(n)||n.__v_skip||Un(n)||n instanceof mn?void 0:new Ln(n,e,t)}function Cn(n,e,t,i,a,s){var l=new yn,o=Object.getOwnPropertyDescriptor(n,e);if(!o||!1!==o.configurable){var d=o&&o.get,c=o&&o.set;d&&!c||t!==Tn&&2!==arguments.length||(t=n[e]);var u=!a&&Bn(t,!1,s);return Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){var e=d?d.call(n):t;return yn.target&&(l.depend(),u&&(u.dep.depend(),r(e)&&Pn(e))),Un(e)&&!a?e.value:e},set:function(e){var i=d?d.call(n):t;if(U(i,e)){if(c)c.call(n,e);else{if(d)return;if(!a&&Un(i)&&!Un(e))return void(i.value=e);t=e}u=!a&&Bn(e,!1,s),l.notify()}}}),l}}function zn(n,e,t){if(!jn(n)){var i=n.__ob__;return r(n)&&h(e)?(n.length=Math.max(n.length,e),n.splice(e,1,t),i&&!i.shallow&&i.mock&&Bn(t,!1,!0),t):e in n&&!(e in Object.prototype)?(n[e]=t,t):n._isVue||i&&i.vmCount?t:i?(Cn(i.value,e,t,void 0,i.shallow,i.mock),i.dep.notify(),t):(n[e]=t,t)}}function Dn(n,e){if(r(n)&&h(e))n.splice(e,1);else{var t=n.__ob__;n._isVue||t&&t.vmCount||jn(n)||_(n,e)&&(delete n[e],t&&t.dep.notify())}}function Pn(n){for(var e=void 0,t=0,i=n.length;t<i;t++)(e=n[t])&&e.__ob__&&e.__ob__.dep.depend(),r(e)&&Pn(e)}function On(n){return Mn(n,!0),K(n,"__v_isShallow",!0),n}function Mn(n,e){if(!jn(n)){Bn(n,e,sn());0}}function jn(n){return!(!n||!n.__v_isReadonly)}function Un(n){return!(!n||!0!==n.__v_isRef)}function $n(n,e,t){Object.defineProperty(n,t,{enumerable:!0,configurable:!0,get:function(){var n=e[t];if(Un(n))return n.value;var i=n&&n.__ob__;return i&&i.dep.depend(),n},set:function(n){var i=e[t];Un(i)&&!Un(n)?i.value=n:e[t]=n}})}"".concat("watcher"," callback"),"".concat("watcher"," getter"),"".concat("watcher"," cleanup");var Fn;var Nn=function(){function n(n){void 0===n&&(n=!1),this.detached=n,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Fn,!n&&Fn&&(this.index=(Fn.scopes||(Fn.scopes=[])).push(this)-1)}return n.prototype.run=function(n){if(this.active){var e=Fn;try{return Fn=this,n()}finally{Fn=e}}else 0},n.prototype.on=function(){Fn=this},n.prototype.off=function(){Fn=this.parent},n.prototype.stop=function(n){if(this.active){var e=void 0,t=void 0;for(e=0,t=this.effects.length;e<t;e++)this.effects[e].teardown();for(e=0,t=this.cleanups.length;e<t;e++)this.cleanups[e]();if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!n){var i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.parent=void 0,this.active=!1}},n}();function qn(n){var e=n._provided,t=n.$parent&&n.$parent._provided;return t===e?n._provided=Object.create(t):e}var Gn=E((function(n){var e="&"===n.charAt(0),t="~"===(n=e?n.slice(1):n).charAt(0),i="!"===(n=t?n.slice(1):n).charAt(0);return{name:n=i?n.slice(1):n,once:t,capture:i,passive:e}}));function Kn(n,e){function t(){var n=t.fns;if(!r(n))return we(n,null,arguments,e,"v-on handler");for(var i=n.slice(),a=0;a<i.length;a++)we(i[a],null,arguments,e,"v-on handler")}return t.fns=n,t}function Hn(n,e,t,i,r,s){var o,d,c,u;for(o in n)d=n[o],c=e[o],u=Gn(o),a(d)||(a(c)?(a(d.fns)&&(d=n[o]=Kn(d,s)),l(u.once)&&(d=n[o]=r(u.name,d,u.capture)),t(u.name,d,u.capture,u.passive,u.params)):d!==c&&(c.fns=d,n[o]=c));for(o in e)a(n[o])&&i((u=Gn(o)).name,e[o],u.capture)}function Jn(n,e,t){var i;n instanceof mn&&(n=n.data.hook||(n.data.hook={}));var r=n[e];function o(){t.apply(this,arguments),x(i.fns,o)}a(r)?i=Kn([o]):s(r.fns)&&l(r.merged)?(i=r).fns.push(o):i=Kn([r,o]),i.merged=!0,n[e]=i}function Vn(n,e,t,i,r){if(s(e)){if(_(e,t))return n[t]=e[t],r||delete e[t],!0;if(_(e,i))return n[t]=e[i],r||delete e[i],!0}return!1}function Qn(n){return o(n)?[gn(n)]:r(n)?function n(e,t){var i,d,c,u,p=[];for(i=0;i<e.length;i++)a(d=e[i])||"boolean"==typeof d||(c=p.length-1,u=p[c],r(d)?d.length>0&&(Xn((d=n(d,"".concat(t||"","_").concat(i)))[0])&&Xn(u)&&(p[c]=gn(u.text+d[0].text),d.shift()),p.push.apply(p,d)):o(d)?Xn(u)?p[c]=gn(u.text+d):""!==d&&p.push(gn(d)):Xn(d)&&Xn(u)?p[c]=gn(u.text+d.text):(l(e._isVList)&&s(d.tag)&&a(d.key)&&s(t)&&(d.key="__vlist".concat(t,"_").concat(i,"__")),p.push(d)));return p}(n):void 0}function Xn(n){return s(n)&&s(n.text)&&!1===n.isComment}function Wn(n,e){var t,i,a,l,o=null;if(r(n)||"string"==typeof n)for(o=new Array(n.length),t=0,i=n.length;t<i;t++)o[t]=e(n[t],t);else if("number"==typeof n)for(o=new Array(n),t=0;t<n;t++)o[t]=e(t+1,t);else if(c(n))if(cn&&n[Symbol.iterator]){o=[];for(var d=n[Symbol.iterator](),u=d.next();!u.done;)o.push(e(u.value,o.length)),u=d.next()}else for(a=Object.keys(n),o=new Array(a.length),t=0,i=a.length;t<i;t++)l=a[t],o[t]=e(n[l],l,t);return s(o)||(o=[]),o._isVList=!0,o}function Yn(n,e,t,i){var r,a=this.$scopedSlots[n];a?(t=t||{},i&&(t=B(B({},i),t)),r=a(t)||(d(e)?e():e)):r=this.$slots[n]||(d(e)?e():e);var s=t&&t.slot;return s?this.$createElement("template",{slot:s},r):r}function Zn(n){return Lt(this.$options,"filters",n,!0)||P}function ne(n,e){return r(n)?-1===n.indexOf(e):n!==e}function ee(n,e,t,i,r){var a=N.keyCodes[e]||t;return r&&i&&!N.keyCodes[e]?ne(r,i):a?ne(a,n):i?I(i)!==e:void 0===n}function te(n,e,t,i,a){if(t)if(c(t)){r(t)&&(t=C(t));var s=void 0,l=function(r){if("class"===r||"style"===r||y(r))s=n;else{var l=n.attrs&&n.attrs.type;s=i||N.mustUseProp(e,l,r)?n.domProps||(n.domProps={}):n.attrs||(n.attrs={})}var o=R(r),d=I(r);o in s||d in s||(s[r]=t[r],a&&((n.on||(n.on={}))["update:".concat(r)]=function(n){t[r]=n}))};for(var o in t)l(o)}else;return n}function ie(n,e){var t=this._staticTrees||(this._staticTrees=[]),i=t[n];return i&&!e||ae(i=t[n]=this.$options.staticRenderFns[n].call(this._renderProxy,this._c,this),"__static__".concat(n),!1),i}function re(n,e,t){return ae(n,"__once__".concat(e).concat(t?"_".concat(t):""),!0),n}function ae(n,e,t){if(r(n))for(var i=0;i<n.length;i++)n[i]&&"string"!=typeof n[i]&&se(n[i],"".concat(e,"_").concat(i),t);else se(n,e,t)}function se(n,e,t){n.isStatic=!0,n.key=e,n.isOnce=t}function le(n,e){if(e)if(p(e)){var t=n.on=n.on?B({},n.on):{};for(var i in e){var r=t[i],a=e[i];t[i]=r?[].concat(r,a):a}}else;return n}function oe(n,e,t,i){e=e||{$stable:!t};for(var a=0;a<n.length;a++){var s=n[a];r(s)?oe(s,e,t):s&&(s.proxy&&(s.fn.proxy=!0),e[s.key]=s.fn)}return i&&(e.$key=i),e}function de(n,e){for(var t=0;t<e.length;t+=2){var i=e[t];"string"==typeof i&&i&&(n[e[t]]=e[t+1])}return n}function ce(n,e){return"string"==typeof n?e+n:n}function ue(n){n._o=re,n._n=b,n._s=f,n._l=Wn,n._t=Yn,n._q=O,n._i=M,n._m=ie,n._f=Zn,n._k=ee,n._b=te,n._v=gn,n._e=hn,n._u=oe,n._g=le,n._d=de,n._p=ce}function pe(n,e){if(!n||!n.length)return{};for(var t={},i=0,r=n.length;i<r;i++){var a=n[i],s=a.data;if(s&&s.attrs&&s.attrs.slot&&delete s.attrs.slot,a.context!==e&&a.fnContext!==e||!s||null==s.slot)(t.default||(t.default=[])).push(a);else{var l=s.slot,o=t[l]||(t[l]=[]);"template"===a.tag?o.push.apply(o,a.children||[]):o.push(a)}}for(var d in t)t[d].every(me)&&delete t[d];return t}function me(n){return n.isComment&&!n.asyncFactory||" "===n.text}function he(n){return n.isComment&&n.asyncFactory}function ge(n,e,t,r){var a,s=Object.keys(t).length>0,l=e?!!e.$stable:!s,o=e&&e.$key;if(e){if(e._normalized)return e._normalized;if(l&&r&&r!==i&&o===r.$key&&!s&&!r.$hasNormal)return r;for(var d in a={},e)e[d]&&"$"!==d[0]&&(a[d]=fe(n,t,d,e[d]))}else a={};for(var c in t)c in a||(a[c]=be(t,c));return e&&Object.isExtensible(e)&&(e._normalized=a),K(a,"$stable",l),K(a,"$key",o),K(a,"$hasNormal",s),a}function fe(n,e,t,i){var a=function(){var e=un;pn(n);var t=arguments.length?i.apply(null,arguments):i({}),a=(t=t&&"object"==typeof t&&!r(t)?[t]:Qn(t))&&t[0];return pn(e),t&&(!a||1===t.length&&a.isComment&&!he(a))?void 0:t};return i.proxy&&Object.defineProperty(e,t,{get:a,enumerable:!0,configurable:!0}),a}function be(n,e){return function(){return n[e]}}function ve(n){return{get attrs(){if(!n._attrsProxy){var e=n._attrsProxy={};K(e,"_v_attr_proxy",!0),ye(e,n.$attrs,i,n,"$attrs")}return n._attrsProxy},get listeners(){n._listenersProxy||ye(n._listenersProxy={},n.$listeners,i,n,"$listeners");return n._listenersProxy},get slots(){return function(n){n._slotsProxy||ke(n._slotsProxy={},n.$scopedSlots);return n._slotsProxy}(n)},emit:A(n.$emit,n),expose:function(e){e&&Object.keys(e).forEach((function(t){return $n(n,e,t)}))}}}function ye(n,e,t,i,r){var a=!1;for(var s in e)s in n?e[s]!==t[s]&&(a=!0):(a=!0,xe(n,s,i,r));for(var s in n)s in e||(a=!0,delete n[s]);return a}function xe(n,e,t,i){Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){return t[i][e]}})}function ke(n,e){for(var t in e)n[t]=e[t];for(var t in n)t in e||delete n[t]}var _e=null;function Ee(n,e){return(n.__esModule||cn&&"Module"===n[Symbol.toStringTag])&&(n=n.default),c(n)?e.extend(n):n}function Se(n){if(r(n))for(var e=0;e<n.length;e++){var t=n[e];if(s(t)&&(s(t.componentOptions)||he(t)))return t}}function Re(n,e,t,i,u,p){return(r(t)||o(t))&&(u=i,i=t,t=void 0),l(p)&&(u=2),function(n,e,t,i,o){if(s(t)&&s(t.__ob__))return hn();s(t)&&s(t.is)&&(e=t.is);if(!e)return hn();0;r(i)&&d(i[0])&&((t=t||{}).scopedSlots={default:i[0]},i.length=0);2===o?i=Qn(i):1===o&&(i=function(n){for(var e=0;e<n.length;e++)if(r(n[e]))return Array.prototype.concat.apply([],n);return n}(i));var u,p;if("string"==typeof e){var m=void 0;p=n.$vnode&&n.$vnode.ns||N.getTagNamespace(e),u=N.isReservedTag(e)?new mn(N.parsePlatformTagName(e),t,i,void 0,void 0,n):t&&t.pre||!s(m=Lt(n.$options,"components",e))?new mn(e,t,i,void 0,void 0,n):xt(m,t,n,i,e)}else u=xt(e,t,n,i);return r(u)?u:s(u)?(s(p)&&function n(e,t,i){e.ns=t,"foreignObject"===e.tag&&(t=void 0,i=!0);if(s(e.children))for(var r=0,o=e.children.length;r<o;r++){var d=e.children[r];s(d.tag)&&(a(d.ns)||l(i)&&"svg"!==d.tag)&&n(d,t,i)}}(u,p),s(t)&&function(n){c(n.style)&&Ne(n.style);c(n.class)&&Ne(n.class)}(t),u):hn()}(n,e,t,i,u)}function Te(n,e,t){kn();try{if(e)for(var i=e;i=i.$parent;){var r=i.$options.errorCaptured;if(r)for(var a=0;a<r.length;a++)try{if(!1===r[a].call(i,n,e,t))return}catch(n){Ie(n,i,"errorCaptured hook")}}Ie(n,e,t)}finally{_n()}}function we(n,e,t,i,r){var a;try{(a=t?n.apply(e,t):n.call(e))&&!a._isVue&&g(a)&&!a._handled&&(a.catch((function(n){return Te(n,i,r+" (Promise/async)")})),a._handled=!0)}catch(n){Te(n,i,r)}return a}function Ie(n,e,t){if(N.errorHandler)try{return N.errorHandler.call(null,n,e,t)}catch(e){e!==n&&Ae(e,null,"config.errorHandler")}Ae(n,e,t)}function Ae(n,e,t){if(!V||"undefined"==typeof console)throw n;console.error(n)}var Le,Be=!1,Ce=[],ze=!1;function De(){ze=!1;var n=Ce.slice(0);Ce.length=0;for(var e=0;e<n.length;e++)n[e]()}if("undefined"!=typeof Promise&&on(Promise)){var Pe=Promise.resolve();Le=function(){Pe.then(De),Z&&setTimeout(z)},Be=!0}else if(X||"undefined"==typeof MutationObserver||!on(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())Le="undefined"!=typeof setImmediate&&on(setImmediate)?function(){setImmediate(De)}:function(){setTimeout(De,0)};else{var Oe=1,Me=new MutationObserver(De),je=document.createTextNode(String(Oe));Me.observe(je,{characterData:!0}),Le=function(){Oe=(Oe+1)%2,je.data=String(Oe)},Be=!0}function Ue(n,e){var t;if(Ce.push((function(){if(n)try{n.call(e)}catch(n){Te(n,e,"nextTick")}else t&&t(e)})),ze||(ze=!0,Le()),!n&&"undefined"!=typeof Promise)return new Promise((function(n){t=n}))}function $e(n){return function(e,t){if(void 0===t&&(t=un),t)return function(n,e,t){var i=n.$options;i[e]=Tt(i[e],t)}(t,n,e)}}$e("beforeMount"),$e("mounted"),$e("beforeUpdate"),$e("updated"),$e("beforeDestroy"),$e("destroyed"),$e("activated"),$e("deactivated"),$e("serverPrefetch"),$e("renderTracked"),$e("renderTriggered"),$e("errorCaptured");var Fe=new dn;function Ne(n){return function n(e,t){var i,a,s=r(e);if(!s&&!c(e)||e.__v_skip||Object.isFrozen(e)||e instanceof mn)return;if(e.__ob__){var l=e.__ob__.dep.id;if(t.has(l))return;t.add(l)}if(s)for(i=e.length;i--;)n(e[i],t);else if(Un(e))n(e.value,t);else for(a=Object.keys(e),i=a.length;i--;)n(e[a[i]],t)}(n,Fe),Fe.clear(),n}var qe,Ge=0,Ke=function(){function n(n,e,t,i,r){var a,s;a=this,void 0===(s=Fn&&!Fn._vm?Fn:n?n._scope:void 0)&&(s=Fn),s&&s.active&&s.effects.push(a),(this.vm=n)&&r&&(n._watcher=this),i?(this.deep=!!i.deep,this.user=!!i.user,this.lazy=!!i.lazy,this.sync=!!i.sync,this.before=i.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=t,this.id=++Ge,this.active=!0,this.post=!1,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new dn,this.newDepIds=new dn,this.expression="",d(e)?this.getter=e:(this.getter=function(n){if(!H.test(n)){var e=n.split(".");return function(n){for(var t=0;t<e.length;t++){if(!n)return;n=n[e[t]]}return n}}}(e),this.getter||(this.getter=z)),this.value=this.lazy?void 0:this.get()}return n.prototype.get=function(){var n;kn(this);var e=this.vm;try{n=this.getter.call(e,e)}catch(n){if(!this.user)throw n;Te(n,e,'getter for watcher "'.concat(this.expression,'"'))}finally{this.deep&&Ne(n),_n(),this.cleanupDeps()}return n},n.prototype.addDep=function(n){var e=n.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(n),this.depIds.has(e)||n.addSub(this))},n.prototype.cleanupDeps=function(){for(var n=this.deps.length;n--;){var e=this.deps[n];this.newDepIds.has(e.id)||e.removeSub(this)}var t=this.depIds;this.depIds=this.newDepIds,this.newDepIds=t,this.newDepIds.clear(),t=this.deps,this.deps=this.newDeps,this.newDeps=t,this.newDeps.length=0},n.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():pt(this)},n.prototype.run=function(){if(this.active){var n=this.get();if(n!==this.value||c(n)||this.deep){var e=this.value;if(this.value=n,this.user){var t='callback for watcher "'.concat(this.expression,'"');we(this.cb,this.vm,[n,e],this.vm,t)}else this.cb.call(this.vm,n,e)}}},n.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},n.prototype.depend=function(){for(var n=this.deps.length;n--;)this.deps[n].depend()},n.prototype.teardown=function(){if(this.vm&&!this.vm._isBeingDestroyed&&x(this.vm._scope.effects,this),this.active){for(var n=this.deps.length;n--;)this.deps[n].removeSub(this);this.active=!1,this.onStop&&this.onStop()}},n}();function He(n,e){qe.$on(n,e)}function Je(n,e){qe.$off(n,e)}function Ve(n,e){var t=qe;return function i(){var r=e.apply(null,arguments);null!==r&&t.$off(n,i)}}function Qe(n,e,t){qe=n,Hn(e,t||{},He,Je,Ve,n),qe=void 0}var Xe=null;function We(n){var e=Xe;return Xe=n,function(){Xe=e}}function Ye(n){for(;n&&(n=n.$parent);)if(n._inactive)return!0;return!1}function Ze(n,e){if(e){if(n._directInactive=!1,Ye(n))return}else if(n._directInactive)return;if(n._inactive||null===n._inactive){n._inactive=!1;for(var t=0;t<n.$children.length;t++)Ze(n.$children[t]);nt(n,"activated")}}function nt(n,e,t,i){void 0===i&&(i=!0),kn();var r=un;i&&pn(n);var a=n.$options[e],s="".concat(e," hook");if(a)for(var l=0,o=a.length;l<o;l++)we(a[l],n,t||null,n,s);n._hasHookEvent&&n.$emit("hook:"+e),i&&pn(r),_n()}var et=[],tt=[],it={},rt=!1,at=!1,st=0;var lt=0,ot=Date.now;if(V&&!X){var dt=window.performance;dt&&"function"==typeof dt.now&&ot()>document.createEvent("Event").timeStamp&&(ot=function(){return dt.now()})}var ct=function(n,e){if(n.post){if(!e.post)return 1}else if(e.post)return-1;return n.id-e.id};function ut(){var n,e;for(lt=ot(),at=!0,et.sort(ct),st=0;st<et.length;st++)(n=et[st]).before&&n.before(),e=n.id,it[e]=null,n.run();var t=tt.slice(),i=et.slice();st=et.length=tt.length=0,it={},rt=at=!1,function(n){for(var e=0;e<n.length;e++)n[e]._inactive=!0,Ze(n[e],!0)}(t),function(n){var e=n.length;for(;e--;){var t=n[e],i=t.vm;i&&i._watcher===t&&i._isMounted&&!i._isDestroyed&&nt(i,"updated")}}(i),function(){for(var n=0;n<vn.length;n++){var e=vn[n];e.subs=e.subs.filter((function(n){return n})),e._pending=!1}vn.length=0}(),ln&&N.devtools&&ln.emit("flush")}function pt(n){var e=n.id;if(null==it[e]&&(n!==yn.target||!n.noRecurse)){if(it[e]=!0,at){for(var t=et.length-1;t>st&&et[t].id>n.id;)t--;et.splice(t+1,0,n)}else et.push(n);rt||(rt=!0,Ue(ut))}}function mt(n,e){if(n){for(var t=Object.create(null),i=cn?Reflect.ownKeys(n):Object.keys(n),r=0;r<i.length;r++){var a=i[r];if("__ob__"!==a){var s=n[a].from;if(s in e._provided)t[a]=e._provided[s];else if("default"in n[a]){var l=n[a].default;t[a]=d(l)?l.call(e):l}else 0}}return t}}function ht(n,e,t,a,s){var o,d=this,c=s.options;_(a,"_uid")?(o=Object.create(a))._original=a:(o=a,a=a._original);var u=l(c._compiled),p=!u;this.data=n,this.props=e,this.children=t,this.parent=a,this.listeners=n.on||i,this.injections=mt(c.inject,a),this.slots=function(){return d.$slots||ge(a,n.scopedSlots,d.$slots=pe(t,a)),d.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return ge(a,n.scopedSlots,this.slots())}}),u&&(this.$options=c,this.$slots=this.slots(),this.$scopedSlots=ge(a,n.scopedSlots,this.$slots)),c._scopeId?this._c=function(n,e,t,i){var s=Re(o,n,e,t,i,p);return s&&!r(s)&&(s.fnScopeId=c._scopeId,s.fnContext=a),s}:this._c=function(n,e,t,i){return Re(o,n,e,t,i,p)}}function gt(n,e,t,i,r){var a=fn(n);return a.fnContext=t,a.fnOptions=i,e.slot&&((a.data||(a.data={})).slot=e.slot),a}function ft(n,e){for(var t in e)n[R(t)]=e[t]}function bt(n){return n.name||n.__name||n._componentTag}ue(ht.prototype);var vt={init:function(n,e){if(n.componentInstance&&!n.componentInstance._isDestroyed&&n.data.keepAlive){var t=n;vt.prepatch(t,t)}else{(n.componentInstance=function(n,e){var t={_isComponent:!0,_parentVnode:n,parent:e},i=n.data.inlineTemplate;s(i)&&(t.render=i.render,t.staticRenderFns=i.staticRenderFns);return new n.componentOptions.Ctor(t)}(n,Xe)).$mount(e?n.elm:void 0,e)}},prepatch:function(n,e){var t=e.componentOptions;!function(n,e,t,r,a){var s=r.data.scopedSlots,l=n.$scopedSlots,o=!!(s&&!s.$stable||l!==i&&!l.$stable||s&&n.$scopedSlots.$key!==s.$key||!s&&n.$scopedSlots.$key),d=!!(a||n.$options._renderChildren||o),c=n.$vnode;n.$options._parentVnode=r,n.$vnode=r,n._vnode&&(n._vnode.parent=r),n.$options._renderChildren=a;var u=r.data.attrs||i;n._attrsProxy&&ye(n._attrsProxy,u,c.data&&c.data.attrs||i,n,"$attrs")&&(d=!0),n.$attrs=u,t=t||i;var p=n.$options._parentListeners;if(n._listenersProxy&&ye(n._listenersProxy,t,p||i,n,"$listeners"),n.$listeners=n.$options._parentListeners=t,Qe(n,t,p),e&&n.$options.props){In(!1);for(var m=n._props,h=n.$options._propKeys||[],g=0;g<h.length;g++){var f=h[g],b=n.$options.props;m[f]=Bt(f,b,e,n)}In(!0),n.$options.propsData=e}d&&(n.$slots=pe(a,r.context),n.$forceUpdate())}(e.componentInstance=n.componentInstance,t.propsData,t.listeners,e,t.children)},insert:function(n){var e,t=n.context,i=n.componentInstance;i._isMounted||(i._isMounted=!0,nt(i,"mounted")),n.data.keepAlive&&(t._isMounted?((e=i)._inactive=!1,tt.push(e)):Ze(i,!0))},destroy:function(n){var e=n.componentInstance;e._isDestroyed||(n.data.keepAlive?function n(e,t){if(!(t&&(e._directInactive=!0,Ye(e))||e._inactive)){e._inactive=!0;for(var i=0;i<e.$children.length;i++)n(e.$children[i]);nt(e,"deactivated")}}(e,!0):e.$destroy())}},yt=Object.keys(vt);function xt(n,e,t,o,d){if(!a(n)){var u=t.$options._base;if(c(n)&&(n=u.extend(n)),"function"==typeof n){var p;if(a(n.cid)&&void 0===(n=function(n,e){if(l(n.error)&&s(n.errorComp))return n.errorComp;if(s(n.resolved))return n.resolved;var t=_e;if(t&&s(n.owners)&&-1===n.owners.indexOf(t)&&n.owners.push(t),l(n.loading)&&s(n.loadingComp))return n.loadingComp;if(t&&!s(n.owners)){var i=n.owners=[t],r=!0,o=null,d=null;t.$on("hook:destroyed",(function(){return x(i,t)}));var u=function(n){for(var e=0,t=i.length;e<t;e++)i[e].$forceUpdate();n&&(i.length=0,null!==o&&(clearTimeout(o),o=null),null!==d&&(clearTimeout(d),d=null))},p=j((function(t){n.resolved=Ee(t,e),r?i.length=0:u(!0)})),m=j((function(e){s(n.errorComp)&&(n.error=!0,u(!0))})),h=n(p,m);return c(h)&&(g(h)?a(n.resolved)&&h.then(p,m):g(h.component)&&(h.component.then(p,m),s(h.error)&&(n.errorComp=Ee(h.error,e)),s(h.loading)&&(n.loadingComp=Ee(h.loading,e),0===h.delay?n.loading=!0:o=setTimeout((function(){o=null,a(n.resolved)&&a(n.error)&&(n.loading=!0,u(!1))}),h.delay||200)),s(h.timeout)&&(d=setTimeout((function(){d=null,a(n.resolved)&&m(null)}),h.timeout)))),r=!1,n.loading?n.loadingComp:n.resolved}}(p=n,u)))return function(n,e,t,i,r){var a=hn();return a.asyncFactory=n,a.asyncMeta={data:e,context:t,children:i,tag:r},a}(p,e,t,o,d);e=e||{},Kt(n),s(e.model)&&function(n,e){var t=n.model&&n.model.prop||"value",i=n.model&&n.model.event||"input";(e.attrs||(e.attrs={}))[t]=e.model.value;var a=e.on||(e.on={}),l=a[i],o=e.model.callback;s(l)?(r(l)?-1===l.indexOf(o):l!==o)&&(a[i]=[o].concat(l)):a[i]=o}(n.options,e);var m=function(n,e,t){var i=e.options.props;if(!a(i)){var r={},l=n.attrs,o=n.props;if(s(l)||s(o))for(var d in i){var c=I(d);Vn(r,o,d,c,!0)||Vn(r,l,d,c,!1)}return r}}(e,n);if(l(n.options.functional))return function(n,e,t,a,l){var o=n.options,d={},c=o.props;if(s(c))for(var u in c)d[u]=Bt(u,c,e||i);else s(t.attrs)&&ft(d,t.attrs),s(t.props)&&ft(d,t.props);var p=new ht(t,d,l,a,n),m=o.render.call(null,p._c,p);if(m instanceof mn)return gt(m,t,p.parent,o,p);if(r(m)){for(var h=Qn(m)||[],g=new Array(h.length),f=0;f<h.length;f++)g[f]=gt(h[f],t,p.parent,o,p);return g}}(n,m,e,t,o);var h=e.on;if(e.on=e.nativeOn,l(n.options.abstract)){var f=e.slot;e={},f&&(e.slot=f)}!function(n){for(var e=n.hook||(n.hook={}),t=0;t<yt.length;t++){var i=yt[t],r=e[i],a=vt[i];r===a||r&&r._merged||(e[i]=r?kt(a,r):a)}}(e);var b=bt(n.options)||d;return new mn("vue-component-".concat(n.cid).concat(b?"-".concat(b):""),e,void 0,void 0,void 0,t,{Ctor:n,propsData:m,listeners:h,tag:d,children:o},p)}}}function kt(n,e){var t=function(t,i){n(t,i),e(t,i)};return t._merged=!0,t}var _t=z,Et=N.optionMergeStrategies;function St(n,e,t){if(void 0===t&&(t=!0),!e)return n;for(var i,r,a,s=cn?Reflect.ownKeys(e):Object.keys(e),l=0;l<s.length;l++)"__ob__"!==(i=s[l])&&(r=n[i],a=e[i],t&&_(n,i)?r!==a&&p(r)&&p(a)&&St(r,a):zn(n,i,a));return n}function Rt(n,e,t){return t?function(){var i=d(e)?e.call(t,t):e,r=d(n)?n.call(t,t):n;return i?St(i,r):r}:e?n?function(){return St(d(e)?e.call(this,this):e,d(n)?n.call(this,this):n)}:e:n}function Tt(n,e){var t=e?n?n.concat(e):r(e)?e:[e]:n;return t?function(n){for(var e=[],t=0;t<n.length;t++)-1===e.indexOf(n[t])&&e.push(n[t]);return e}(t):t}function wt(n,e,t,i){var r=Object.create(n||null);return e?B(r,e):r}Et.data=function(n,e,t){return t?Rt(n,e,t):e&&"function"!=typeof e?n:Rt(n,e)},F.forEach((function(n){Et[n]=Tt})),$.forEach((function(n){Et[n+"s"]=wt})),Et.watch=function(n,e,t,i){if(n===tn&&(n=void 0),e===tn&&(e=void 0),!e)return Object.create(n||null);if(!n)return e;var a={};for(var s in B(a,n),e){var l=a[s],o=e[s];l&&!r(l)&&(l=[l]),a[s]=l?l.concat(o):r(o)?o:[o]}return a},Et.props=Et.methods=Et.inject=Et.computed=function(n,e,t,i){if(!n)return e;var r=Object.create(null);return B(r,n),e&&B(r,e),r},Et.provide=function(n,e){return n?function(){var t=Object.create(null);return St(t,d(n)?n.call(this):n),e&&St(t,d(e)?e.call(this):e,!1),t}:e};var It=function(n,e){return void 0===e?n:e};function At(n,e,t){if(d(e)&&(e=e.options),function(n,e){var t=n.props;if(t){var i,a,s={};if(r(t))for(i=t.length;i--;)"string"==typeof(a=t[i])&&(s[R(a)]={type:null});else if(p(t))for(var l in t)a=t[l],s[R(l)]=p(a)?a:{type:a};else 0;n.props=s}}(e),function(n,e){var t=n.inject;if(t){var i=n.inject={};if(r(t))for(var a=0;a<t.length;a++)i[t[a]]={from:t[a]};else if(p(t))for(var s in t){var l=t[s];i[s]=p(l)?B({from:s},l):{from:l}}else 0}}(e),function(n){var e=n.directives;if(e)for(var t in e){var i=e[t];d(i)&&(e[t]={bind:i,update:i})}}(e),!e._base&&(e.extends&&(n=At(n,e.extends,t)),e.mixins))for(var i=0,a=e.mixins.length;i<a;i++)n=At(n,e.mixins[i],t);var s,l={};for(s in n)o(s);for(s in e)_(n,s)||o(s);function o(i){var r=Et[i]||It;l[i]=r(n[i],e[i],t,i)}return l}function Lt(n,e,t,i){if("string"==typeof t){var r=n[e];if(_(r,t))return r[t];var a=R(t);if(_(r,a))return r[a];var s=T(a);return _(r,s)?r[s]:r[t]||r[a]||r[s]}}function Bt(n,e,t,i){var r=e[n],a=!_(t,n),s=t[n],l=Pt(Boolean,r.type);if(l>-1)if(a&&!_(r,"default"))s=!1;else if(""===s||s===I(n)){var o=Pt(String,r.type);(o<0||l<o)&&(s=!0)}if(void 0===s){s=function(n,e,t){if(!_(e,"default"))return;var i=e.default;0;if(n&&n.$options.propsData&&void 0===n.$options.propsData[t]&&void 0!==n._props[t])return n._props[t];return d(i)&&"Function"!==zt(e.type)?i.call(n):i}(i,r,n);var c=wn;In(!0),Bn(s),In(c)}return s}var Ct=/^\s*function (\w+)/;function zt(n){var e=n&&n.toString().match(Ct);return e?e[1]:""}function Dt(n,e){return zt(n)===zt(e)}function Pt(n,e){if(!r(e))return Dt(e,n)?0:-1;for(var t=0,i=e.length;t<i;t++)if(Dt(e[t],n))return t;return-1}var Ot={enumerable:!0,configurable:!0,get:z,set:z};function Mt(n,e,t){Ot.get=function(){return this[e][t]},Ot.set=function(n){this[e][t]=n},Object.defineProperty(n,t,Ot)}function jt(n){var e=n.$options;if(e.props&&function(n,e){var t=n.$options.propsData||{},i=n._props=On({}),r=n.$options._propKeys=[];n.$parent&&In(!1);var a=function(a){r.push(a);var s=Bt(a,e,t,n);Cn(i,a,s),a in n||Mt(n,"_props",a)};for(var s in e)a(s);In(!0)}(n,e.props),function(n){var e=n.$options,t=e.setup;if(t){var i=n._setupContext=ve(n);pn(n),kn();var r=we(t,null,[n._props||On({}),i],n,"setup");if(_n(),pn(),d(r))e.render=r;else if(c(r))if(n._setupState=r,r.__sfc){var a=n._setupProxy={};for(var s in r)"__sfc"!==s&&$n(a,r,s)}else for(var s in r)G(s)||$n(n,r,s);else 0}}(n),e.methods&&function(n,e){n.$options.props;for(var t in e)n[t]="function"!=typeof e[t]?z:A(e[t],n)}(n,e.methods),e.data)!function(n){var e=n.$options.data;p(e=n._data=d(e)?function(n,e){kn();try{return n.call(e,e)}catch(n){return Te(n,e,"data()"),{}}finally{_n()}}(e,n):e||{})||(e={});var t=Object.keys(e),i=n.$options.props,r=(n.$options.methods,t.length);for(;r--;){var a=t[r];0,i&&_(i,a)||G(a)||Mt(n,"_data",a)}var s=Bn(e);s&&s.vmCount++}(n);else{var t=Bn(n._data={});t&&t.vmCount++}e.computed&&function(n,e){var t=n._computedWatchers=Object.create(null),i=sn();for(var r in e){var a=e[r],s=d(a)?a:a.get;0,i||(t[r]=new Ke(n,s||z,z,Ut)),r in n||$t(n,r,a)}}(n,e.computed),e.watch&&e.watch!==tn&&function(n,e){for(var t in e){var i=e[t];if(r(i))for(var a=0;a<i.length;a++)qt(n,t,i[a]);else qt(n,t,i)}}(n,e.watch)}var Ut={lazy:!0};function $t(n,e,t){var i=!sn();d(t)?(Ot.get=i?Ft(e):Nt(t),Ot.set=z):(Ot.get=t.get?i&&!1!==t.cache?Ft(e):Nt(t.get):z,Ot.set=t.set||z),Object.defineProperty(n,e,Ot)}function Ft(n){return function(){var e=this._computedWatchers&&this._computedWatchers[n];if(e)return e.dirty&&e.evaluate(),yn.target&&e.depend(),e.value}}function Nt(n){return function(){return n.call(this,this)}}function qt(n,e,t,i){return p(t)&&(i=t,t=t.handler),"string"==typeof t&&(t=n[t]),n.$watch(e,t,i)}var Gt=0;function Kt(n){var e=n.options;if(n.super){var t=Kt(n.super);if(t!==n.superOptions){n.superOptions=t;var i=function(n){var e,t=n.options,i=n.sealedOptions;for(var r in t)t[r]!==i[r]&&(e||(e={}),e[r]=t[r]);return e}(n);i&&B(n.extendOptions,i),(e=n.options=At(t,n.extendOptions)).name&&(e.components[e.name]=n)}}return e}function Ht(n){this._init(n)}function Jt(n){n.cid=0;var e=1;n.extend=function(n){n=n||{};var t=this,i=t.cid,r=n._Ctor||(n._Ctor={});if(r[i])return r[i];var a=bt(n)||bt(t.options);var s=function(n){this._init(n)};return(s.prototype=Object.create(t.prototype)).constructor=s,s.cid=e++,s.options=At(t.options,n),s.super=t,s.options.props&&function(n){var e=n.options.props;for(var t in e)Mt(n.prototype,"_props",t)}(s),s.options.computed&&function(n){var e=n.options.computed;for(var t in e)$t(n.prototype,t,e[t])}(s),s.extend=t.extend,s.mixin=t.mixin,s.use=t.use,$.forEach((function(n){s[n]=t[n]})),a&&(s.options.components[a]=s),s.superOptions=t.options,s.extendOptions=n,s.sealedOptions=B({},s.options),r[i]=s,s}}function Vt(n){return n&&(bt(n.Ctor.options)||n.tag)}function Qt(n,e){return r(n)?n.indexOf(e)>-1:"string"==typeof n?n.split(",").indexOf(e)>-1:!!m(n)&&n.test(e)}function Xt(n,e){var t=n.cache,i=n.keys,r=n._vnode;for(var a in t){var s=t[a];if(s){var l=s.name;l&&!e(l)&&Wt(t,a,i,r)}}}function Wt(n,e,t,i){var r=n[e];!r||i&&r.tag===i.tag||r.componentInstance.$destroy(),n[e]=null,x(t,e)}!function(n){n.prototype._init=function(n){var e=this;e._uid=Gt++,e._isVue=!0,e.__v_skip=!0,e._scope=new Nn(!0),e._scope._vm=!0,n&&n._isComponent?function(n,e){var t=n.$options=Object.create(n.constructor.options),i=e._parentVnode;t.parent=e.parent,t._parentVnode=i;var r=i.componentOptions;t.propsData=r.propsData,t._parentListeners=r.listeners,t._renderChildren=r.children,t._componentTag=r.tag,e.render&&(t.render=e.render,t.staticRenderFns=e.staticRenderFns)}(e,n):e.$options=At(Kt(e.constructor),n||{},e),e._renderProxy=e,e._self=e,function(n){var e=n.$options,t=e.parent;if(t&&!e.abstract){for(;t.$options.abstract&&t.$parent;)t=t.$parent;t.$children.push(n)}n.$parent=t,n.$root=t?t.$root:n,n.$children=[],n.$refs={},n._provided=t?t._provided:Object.create(null),n._watcher=null,n._inactive=null,n._directInactive=!1,n._isMounted=!1,n._isDestroyed=!1,n._isBeingDestroyed=!1}(e),function(n){n._events=Object.create(null),n._hasHookEvent=!1;var e=n.$options._parentListeners;e&&Qe(n,e)}(e),function(n){n._vnode=null,n._staticTrees=null;var e=n.$options,t=n.$vnode=e._parentVnode,r=t&&t.context;n.$slots=pe(e._renderChildren,r),n.$scopedSlots=t?ge(n.$parent,t.data.scopedSlots,n.$slots):i,n._c=function(e,t,i,r){return Re(n,e,t,i,r,!1)},n.$createElement=function(e,t,i,r){return Re(n,e,t,i,r,!0)};var a=t&&t.data;Cn(n,"$attrs",a&&a.attrs||i,null,!0),Cn(n,"$listeners",e._parentListeners||i,null,!0)}(e),nt(e,"beforeCreate",void 0,!1),function(n){var e=mt(n.$options.inject,n);e&&(In(!1),Object.keys(e).forEach((function(t){Cn(n,t,e[t])})),In(!0))}(e),jt(e),function(n){var e=n.$options.provide;if(e){var t=d(e)?e.call(n):e;if(!c(t))return;for(var i=qn(n),r=cn?Reflect.ownKeys(t):Object.keys(t),a=0;a<r.length;a++){var s=r[a];Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))}}}(e),nt(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}(Ht),function(n){var e={get:function(){return this._data}},t={get:function(){return this._props}};Object.defineProperty(n.prototype,"$data",e),Object.defineProperty(n.prototype,"$props",t),n.prototype.$set=zn,n.prototype.$delete=Dn,n.prototype.$watch=function(n,e,t){if(p(e))return qt(this,n,e,t);(t=t||{}).user=!0;var i=new Ke(this,n,e,t);if(t.immediate){var r='callback for immediate watcher "'.concat(i.expression,'"');kn(),we(e,this,[i.value],this,r),_n()}return function(){i.teardown()}}}(Ht),function(n){var e=/^hook:/;n.prototype.$on=function(n,t){var i=this;if(r(n))for(var a=0,s=n.length;a<s;a++)i.$on(n[a],t);else(i._events[n]||(i._events[n]=[])).push(t),e.test(n)&&(i._hasHookEvent=!0);return i},n.prototype.$once=function(n,e){var t=this;function i(){t.$off(n,i),e.apply(t,arguments)}return i.fn=e,t.$on(n,i),t},n.prototype.$off=function(n,e){var t=this;if(!arguments.length)return t._events=Object.create(null),t;if(r(n)){for(var i=0,a=n.length;i<a;i++)t.$off(n[i],e);return t}var s,l=t._events[n];if(!l)return t;if(!e)return t._events[n]=null,t;for(var o=l.length;o--;)if((s=l[o])===e||s.fn===e){l.splice(o,1);break}return t},n.prototype.$emit=function(n){var e=this,t=e._events[n];if(t){t=t.length>1?L(t):t;for(var i=L(arguments,1),r='event handler for "'.concat(n,'"'),a=0,s=t.length;a<s;a++)we(t[a],e,i,e,r)}return e}}(Ht),function(n){n.prototype._update=function(n,e){var t=this,i=t.$el,r=t._vnode,a=We(t);t._vnode=n,t.$el=r?t.__patch__(r,n):t.__patch__(t.$el,n,e,!1),a(),i&&(i.__vue__=null),t.$el&&(t.$el.__vue__=t);for(var s=t;s&&s.$vnode&&s.$parent&&s.$vnode===s.$parent._vnode;)s.$parent.$el=s.$el,s=s.$parent},n.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},n.prototype.$destroy=function(){var n=this;if(!n._isBeingDestroyed){nt(n,"beforeDestroy"),n._isBeingDestroyed=!0;var e=n.$parent;!e||e._isBeingDestroyed||n.$options.abstract||x(e.$children,n),n._scope.stop(),n._data.__ob__&&n._data.__ob__.vmCount--,n._isDestroyed=!0,n.__patch__(n._vnode,null),nt(n,"destroyed"),n.$off(),n.$el&&(n.$el.__vue__=null),n.$vnode&&(n.$vnode.parent=null)}}}(Ht),function(n){ue(n.prototype),n.prototype.$nextTick=function(n){return Ue(n,this)},n.prototype._render=function(){var n,e=this,t=e.$options,i=t.render,a=t._parentVnode;a&&e._isMounted&&(e.$scopedSlots=ge(e.$parent,a.data.scopedSlots,e.$slots,e.$scopedSlots),e._slotsProxy&&ke(e._slotsProxy,e.$scopedSlots)),e.$vnode=a;try{pn(e),_e=e,n=i.call(e._renderProxy,e.$createElement)}catch(t){Te(t,e,"render"),n=e._vnode}finally{_e=null,pn()}return r(n)&&1===n.length&&(n=n[0]),n instanceof mn||(n=hn()),n.parent=a,n}}(Ht);var Yt=[String,RegExp,Array],Zt={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Yt,exclude:Yt,max:[String,Number]},methods:{cacheVNode:function(){var n=this.cache,e=this.keys,t=this.vnodeToCache,i=this.keyToCache;if(t){var r=t.tag,a=t.componentInstance,s=t.componentOptions;n[i]={name:Vt(s),tag:r,componentInstance:a},e.push(i),this.max&&e.length>parseInt(this.max)&&Wt(n,e[0],e,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var n in this.cache)Wt(this.cache,n,this.keys)},mounted:function(){var n=this;this.cacheVNode(),this.$watch("include",(function(e){Xt(n,(function(n){return Qt(e,n)}))})),this.$watch("exclude",(function(e){Xt(n,(function(n){return!Qt(e,n)}))}))},updated:function(){this.cacheVNode()},render:function(){var n=this.$slots.default,e=Se(n),t=e&&e.componentOptions;if(t){var i=Vt(t),r=this.include,a=this.exclude;if(r&&(!i||!Qt(r,i))||a&&i&&Qt(a,i))return e;var s=this.cache,l=this.keys,o=null==e.key?t.Ctor.cid+(t.tag?"::".concat(t.tag):""):e.key;s[o]?(e.componentInstance=s[o].componentInstance,x(l,o),l.push(o)):(this.vnodeToCache=e,this.keyToCache=o),e.data.keepAlive=!0}return e||n&&n[0]}}};!function(n){var e={get:function(){return N}};Object.defineProperty(n,"config",e),n.util={warn:_t,extend:B,mergeOptions:At,defineReactive:Cn},n.set=zn,n.delete=Dn,n.nextTick=Ue,n.observable=function(n){return Bn(n),n},n.options=Object.create(null),$.forEach((function(e){n.options[e+"s"]=Object.create(null)})),n.options._base=n,B(n.options.components,Zt),function(n){n.use=function(n){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(n)>-1)return this;var t=L(arguments,1);return t.unshift(this),d(n.install)?n.install.apply(n,t):d(n)&&n.apply(null,t),e.push(n),this}}(n),function(n){n.mixin=function(n){return this.options=At(this.options,n),this}}(n),Jt(n),function(n){$.forEach((function(e){n[e]=function(n,t){return t?("component"===e&&p(t)&&(t.name=t.name||n,t=this.options._base.extend(t)),"directive"===e&&d(t)&&(t={bind:t,update:t}),this.options[e+"s"][n]=t,t):this.options[e+"s"][n]}}))}(n)}(Ht),Object.defineProperty(Ht.prototype,"$isServer",{get:sn}),Object.defineProperty(Ht.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(Ht,"FunctionalRenderContext",{value:ht}),Ht.version="2.7.14";var ni=v("style,class"),ei=v("input,textarea,option,select,progress"),ti=v("contenteditable,draggable,spellcheck"),ii=v("events,caret,typing,plaintext-only"),ri=v("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),ai="http://www.w3.org/1999/xlink",si=function(n){return":"===n.charAt(5)&&"xlink"===n.slice(0,5)},li=function(n){return si(n)?n.slice(6,n.length):""},oi=function(n){return null==n||!1===n};function di(n){for(var e=n.data,t=n,i=n;s(i.componentInstance);)(i=i.componentInstance._vnode)&&i.data&&(e=ci(i.data,e));for(;s(t=t.parent);)t&&t.data&&(e=ci(e,t.data));return function(n,e){if(s(n)||s(e))return ui(n,pi(e));return""}(e.staticClass,e.class)}function ci(n,e){return{staticClass:ui(n.staticClass,e.staticClass),class:s(n.class)?[n.class,e.class]:e.class}}function ui(n,e){return n?e?n+" "+e:n:e||""}function pi(n){return Array.isArray(n)?function(n){for(var e,t="",i=0,r=n.length;i<r;i++)s(e=pi(n[i]))&&""!==e&&(t&&(t+=" "),t+=e);return t}(n):c(n)?function(n){var e="";for(var t in n)n[t]&&(e&&(e+=" "),e+=t);return e}(n):"string"==typeof n?n:""}var mi={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},hi=v("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),gi=v("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),fi=function(n){return hi(n)||gi(n)};var bi=Object.create(null);var vi=v("text,number,password,search,email,tel,url");var yi=Object.freeze({__proto__:null,createElement:function(n,e){var t=document.createElement(n);return"select"!==n||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&t.setAttribute("multiple","multiple"),t},createElementNS:function(n,e){return document.createElementNS(mi[n],e)},createTextNode:function(n){return document.createTextNode(n)},createComment:function(n){return document.createComment(n)},insertBefore:function(n,e,t){n.insertBefore(e,t)},removeChild:function(n,e){n.removeChild(e)},appendChild:function(n,e){n.appendChild(e)},parentNode:function(n){return n.parentNode},nextSibling:function(n){return n.nextSibling},tagName:function(n){return n.tagName},setTextContent:function(n,e){n.textContent=e},setStyleScope:function(n,e){n.setAttribute(e,"")}}),xi={create:function(n,e){ki(e)},update:function(n,e){n.data.ref!==e.data.ref&&(ki(n,!0),ki(e))},destroy:function(n){ki(n,!0)}};function ki(n,e){var t=n.data.ref;if(s(t)){var i=n.context,a=n.componentInstance||n.elm,l=e?null:a,o=e?void 0:a;if(d(t))we(t,i,[l],i,"template ref function");else{var c=n.data.refInFor,u="string"==typeof t||"number"==typeof t,p=Un(t),m=i.$refs;if(u||p)if(c){var h=u?m[t]:t.value;e?r(h)&&x(h,a):r(h)?h.includes(a)||h.push(a):u?(m[t]=[a],_i(i,t,m[t])):t.value=[a]}else if(u){if(e&&m[t]!==a)return;m[t]=o,_i(i,t,l)}else if(p){if(e&&t.value!==a)return;t.value=l}else 0}}}function _i(n,e,t){var i=n._setupState;i&&_(i,e)&&(Un(i[e])?i[e].value=t:i[e]=t)}var Ei=new mn("",{},[]),Si=["create","activate","update","remove","destroy"];function Ri(n,e){return n.key===e.key&&n.asyncFactory===e.asyncFactory&&(n.tag===e.tag&&n.isComment===e.isComment&&s(n.data)===s(e.data)&&function(n,e){if("input"!==n.tag)return!0;var t,i=s(t=n.data)&&s(t=t.attrs)&&t.type,r=s(t=e.data)&&s(t=t.attrs)&&t.type;return i===r||vi(i)&&vi(r)}(n,e)||l(n.isAsyncPlaceholder)&&a(e.asyncFactory.error))}function Ti(n,e,t){var i,r,a={};for(i=e;i<=t;++i)s(r=n[i].key)&&(a[r]=i);return a}var wi={create:Ii,update:Ii,destroy:function(n){Ii(n,Ei)}};function Ii(n,e){(n.data.directives||e.data.directives)&&function(n,e){var t,i,r,a=n===Ei,s=e===Ei,l=Li(n.data.directives,n.context),o=Li(e.data.directives,e.context),d=[],c=[];for(t in o)i=l[t],r=o[t],i?(r.oldValue=i.value,r.oldArg=i.arg,Ci(r,"update",e,n),r.def&&r.def.componentUpdated&&c.push(r)):(Ci(r,"bind",e,n),r.def&&r.def.inserted&&d.push(r));if(d.length){var u=function(){for(var t=0;t<d.length;t++)Ci(d[t],"inserted",e,n)};a?Jn(e,"insert",u):u()}c.length&&Jn(e,"postpatch",(function(){for(var t=0;t<c.length;t++)Ci(c[t],"componentUpdated",e,n)}));if(!a)for(t in l)o[t]||Ci(l[t],"unbind",n,n,s)}(n,e)}var Ai=Object.create(null);function Li(n,e){var t,i,r=Object.create(null);if(!n)return r;for(t=0;t<n.length;t++){if((i=n[t]).modifiers||(i.modifiers=Ai),r[Bi(i)]=i,e._setupState&&e._setupState.__sfc){var a=i.def||Lt(e,"_setupState","v-"+i.name);i.def="function"==typeof a?{bind:a,update:a}:a}i.def=i.def||Lt(e.$options,"directives",i.name)}return r}function Bi(n){return n.rawName||"".concat(n.name,".").concat(Object.keys(n.modifiers||{}).join("."))}function Ci(n,e,t,i,r){var a=n.def&&n.def[e];if(a)try{a(t.elm,n,t,i,r)}catch(i){Te(i,t.context,"directive ".concat(n.name," ").concat(e," hook"))}}var zi=[xi,wi];function Di(n,e){var t=e.componentOptions;if(!(s(t)&&!1===t.Ctor.options.inheritAttrs||a(n.data.attrs)&&a(e.data.attrs))){var i,r,o=e.elm,d=n.data.attrs||{},c=e.data.attrs||{};for(i in(s(c.__ob__)||l(c._v_attr_proxy))&&(c=e.data.attrs=B({},c)),c)r=c[i],d[i]!==r&&Pi(o,i,r,e.data.pre);for(i in(X||Y)&&c.value!==d.value&&Pi(o,"value",c.value),d)a(c[i])&&(si(i)?o.removeAttributeNS(ai,li(i)):ti(i)||o.removeAttribute(i))}}function Pi(n,e,t,i){i||n.tagName.indexOf("-")>-1?Oi(n,e,t):ri(e)?oi(t)?n.removeAttribute(e):(t="allowfullscreen"===e&&"EMBED"===n.tagName?"true":e,n.setAttribute(e,t)):ti(e)?n.setAttribute(e,function(n,e){return oi(e)||"false"===e?"false":"contenteditable"===n&&ii(e)?e:"true"}(e,t)):si(e)?oi(t)?n.removeAttributeNS(ai,li(e)):n.setAttributeNS(ai,e,t):Oi(n,e,t)}function Oi(n,e,t){if(oi(t))n.removeAttribute(e);else{if(X&&!W&&"TEXTAREA"===n.tagName&&"placeholder"===e&&""!==t&&!n.__ieph){var i=function(e){e.stopImmediatePropagation(),n.removeEventListener("input",i)};n.addEventListener("input",i),n.__ieph=!0}n.setAttribute(e,t)}}var Mi={create:Di,update:Di};function ji(n,e){var t=e.elm,i=e.data,r=n.data;if(!(a(i.staticClass)&&a(i.class)&&(a(r)||a(r.staticClass)&&a(r.class)))){var l=di(e),o=t._transitionClasses;s(o)&&(l=ui(l,pi(o))),l!==t._prevClass&&(t.setAttribute("class",l),t._prevClass=l)}}var Ui,$i={create:ji,update:ji};function Fi(n,e,t){var i=Ui;return function r(){var a=e.apply(null,arguments);null!==a&&Gi(n,r,t,i)}}var Ni=Be&&!(en&&Number(en[1])<=53);function qi(n,e,t,i){if(Ni){var r=lt,a=e;e=a._wrapper=function(n){if(n.target===n.currentTarget||n.timeStamp>=r||n.timeStamp<=0||n.target.ownerDocument!==document)return a.apply(this,arguments)}}Ui.addEventListener(n,e,rn?{capture:t,passive:i}:t)}function Gi(n,e,t,i){(i||Ui).removeEventListener(n,e._wrapper||e,t)}function Ki(n,e){if(!a(n.data.on)||!a(e.data.on)){var t=e.data.on||{},i=n.data.on||{};Ui=e.elm||n.elm,function(n){if(s(n.__r)){var e=X?"change":"input";n[e]=[].concat(n.__r,n[e]||[]),delete n.__r}s(n.__c)&&(n.change=[].concat(n.__c,n.change||[]),delete n.__c)}(t),Hn(t,i,qi,Gi,Fi,e.context),Ui=void 0}}var Hi,Ji={create:Ki,update:Ki,destroy:function(n){return Ki(n,Ei)}};function Vi(n,e){if(!a(n.data.domProps)||!a(e.data.domProps)){var t,i,r=e.elm,o=n.data.domProps||{},d=e.data.domProps||{};for(t in(s(d.__ob__)||l(d._v_attr_proxy))&&(d=e.data.domProps=B({},d)),o)t in d||(r[t]="");for(t in d){if(i=d[t],"textContent"===t||"innerHTML"===t){if(e.children&&(e.children.length=0),i===o[t])continue;1===r.childNodes.length&&r.removeChild(r.childNodes[0])}if("value"===t&&"PROGRESS"!==r.tagName){r._value=i;var c=a(i)?"":String(i);Qi(r,c)&&(r.value=c)}else if("innerHTML"===t&&gi(r.tagName)&&a(r.innerHTML)){(Hi=Hi||document.createElement("div")).innerHTML="<svg>".concat(i,"</svg>");for(var u=Hi.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;u.firstChild;)r.appendChild(u.firstChild)}else if(i!==o[t])try{r[t]=i}catch(n){}}}}function Qi(n,e){return!n.composing&&("OPTION"===n.tagName||function(n,e){var t=!0;try{t=document.activeElement!==n}catch(n){}return t&&n.value!==e}(n,e)||function(n,e){var t=n.value,i=n._vModifiers;if(s(i)){if(i.number)return b(t)!==b(e);if(i.trim)return t.trim()!==e.trim()}return t!==e}(n,e))}var Xi={create:Vi,update:Vi},Wi=E((function(n){var e={},t=/:(.+)/;return n.split(/;(?![^(]*\))/g).forEach((function(n){if(n){var i=n.split(t);i.length>1&&(e[i[0].trim()]=i[1].trim())}})),e}));function Yi(n){var e=Zi(n.style);return n.staticStyle?B(n.staticStyle,e):e}function Zi(n){return Array.isArray(n)?C(n):"string"==typeof n?Wi(n):n}var nr,er=/^--/,tr=/\s*!important$/,ir=function(n,e,t){if(er.test(e))n.style.setProperty(e,t);else if(tr.test(t))n.style.setProperty(I(e),t.replace(tr,""),"important");else{var i=ar(e);if(Array.isArray(t))for(var r=0,a=t.length;r<a;r++)n.style[i]=t[r];else n.style[i]=t}},rr=["Webkit","Moz","ms"],ar=E((function(n){if(nr=nr||document.createElement("div").style,"filter"!==(n=R(n))&&n in nr)return n;for(var e=n.charAt(0).toUpperCase()+n.slice(1),t=0;t<rr.length;t++){var i=rr[t]+e;if(i in nr)return i}}));function sr(n,e){var t=e.data,i=n.data;if(!(a(t.staticStyle)&&a(t.style)&&a(i.staticStyle)&&a(i.style))){var r,l,o=e.elm,d=i.staticStyle,c=i.normalizedStyle||i.style||{},u=d||c,p=Zi(e.data.style)||{};e.data.normalizedStyle=s(p.__ob__)?B({},p):p;var m=function(n,e){var t,i={};if(e)for(var r=n;r.componentInstance;)(r=r.componentInstance._vnode)&&r.data&&(t=Yi(r.data))&&B(i,t);(t=Yi(n.data))&&B(i,t);for(var a=n;a=a.parent;)a.data&&(t=Yi(a.data))&&B(i,t);return i}(e,!0);for(l in u)a(m[l])&&ir(o,l,"");for(l in m)(r=m[l])!==u[l]&&ir(o,l,null==r?"":r)}}var lr={create:sr,update:sr},or=/\s+/;function dr(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(or).forEach((function(e){return n.classList.add(e)})):n.classList.add(e);else{var t=" ".concat(n.getAttribute("class")||""," ");t.indexOf(" "+e+" ")<0&&n.setAttribute("class",(t+e).trim())}}function cr(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(or).forEach((function(e){return n.classList.remove(e)})):n.classList.remove(e),n.classList.length||n.removeAttribute("class");else{for(var t=" ".concat(n.getAttribute("class")||""," "),i=" "+e+" ";t.indexOf(i)>=0;)t=t.replace(i," ");(t=t.trim())?n.setAttribute("class",t):n.removeAttribute("class")}}function ur(n){if(n){if("object"==typeof n){var e={};return!1!==n.css&&B(e,pr(n.name||"v")),B(e,n),e}return"string"==typeof n?pr(n):void 0}}var pr=E((function(n){return{enterClass:"".concat(n,"-enter"),enterToClass:"".concat(n,"-enter-to"),enterActiveClass:"".concat(n,"-enter-active"),leaveClass:"".concat(n,"-leave"),leaveToClass:"".concat(n,"-leave-to"),leaveActiveClass:"".concat(n,"-leave-active")}})),mr=V&&!W,hr="transition",gr="transitionend",fr="animation",br="animationend";mr&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(hr="WebkitTransition",gr="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(fr="WebkitAnimation",br="webkitAnimationEnd"));var vr=V?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(n){return n()};function yr(n){vr((function(){vr(n)}))}function xr(n,e){var t=n._transitionClasses||(n._transitionClasses=[]);t.indexOf(e)<0&&(t.push(e),dr(n,e))}function kr(n,e){n._transitionClasses&&x(n._transitionClasses,e),cr(n,e)}function _r(n,e,t){var i=Sr(n,e),r=i.type,a=i.timeout,s=i.propCount;if(!r)return t();var l="transition"===r?gr:br,o=0,d=function(){n.removeEventListener(l,c),t()},c=function(e){e.target===n&&++o>=s&&d()};setTimeout((function(){o<s&&d()}),a+1),n.addEventListener(l,c)}var Er=/\b(transform|all)(,|$)/;function Sr(n,e){var t,i=window.getComputedStyle(n),r=(i[hr+"Delay"]||"").split(", "),a=(i[hr+"Duration"]||"").split(", "),s=Rr(r,a),l=(i[fr+"Delay"]||"").split(", "),o=(i[fr+"Duration"]||"").split(", "),d=Rr(l,o),c=0,u=0;return"transition"===e?s>0&&(t="transition",c=s,u=a.length):"animation"===e?d>0&&(t="animation",c=d,u=o.length):u=(t=(c=Math.max(s,d))>0?s>d?"transition":"animation":null)?"transition"===t?a.length:o.length:0,{type:t,timeout:c,propCount:u,hasTransform:"transition"===t&&Er.test(i[hr+"Property"])}}function Rr(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max.apply(null,e.map((function(e,t){return Tr(e)+Tr(n[t])})))}function Tr(n){return 1e3*Number(n.slice(0,-1).replace(",","."))}function wr(n,e){var t=n.elm;s(t._leaveCb)&&(t._leaveCb.cancelled=!0,t._leaveCb());var i=ur(n.data.transition);if(!a(i)&&!s(t._enterCb)&&1===t.nodeType){for(var r=i.css,l=i.type,o=i.enterClass,u=i.enterToClass,p=i.enterActiveClass,m=i.appearClass,h=i.appearToClass,g=i.appearActiveClass,f=i.beforeEnter,v=i.enter,y=i.afterEnter,x=i.enterCancelled,k=i.beforeAppear,_=i.appear,E=i.afterAppear,S=i.appearCancelled,R=i.duration,T=Xe,w=Xe.$vnode;w&&w.parent;)T=w.context,w=w.parent;var I=!T._isMounted||!n.isRootInsert;if(!I||_||""===_){var A=I&&m?m:o,L=I&&g?g:p,B=I&&h?h:u,C=I&&k||f,z=I&&d(_)?_:v,D=I&&E||y,P=I&&S||x,O=b(c(R)?R.enter:R);0;var M=!1!==r&&!W,U=Lr(z),$=t._enterCb=j((function(){M&&(kr(t,B),kr(t,L)),$.cancelled?(M&&kr(t,A),P&&P(t)):D&&D(t),t._enterCb=null}));n.data.show||Jn(n,"insert",(function(){var e=t.parentNode,i=e&&e._pending&&e._pending[n.key];i&&i.tag===n.tag&&i.elm._leaveCb&&i.elm._leaveCb(),z&&z(t,$)})),C&&C(t),M&&(xr(t,A),xr(t,L),yr((function(){kr(t,A),$.cancelled||(xr(t,B),U||(Ar(O)?setTimeout($,O):_r(t,l,$)))}))),n.data.show&&(e&&e(),z&&z(t,$)),M||U||$()}}}function Ir(n,e){var t=n.elm;s(t._enterCb)&&(t._enterCb.cancelled=!0,t._enterCb());var i=ur(n.data.transition);if(a(i)||1!==t.nodeType)return e();if(!s(t._leaveCb)){var r=i.css,l=i.type,o=i.leaveClass,d=i.leaveToClass,u=i.leaveActiveClass,p=i.beforeLeave,m=i.leave,h=i.afterLeave,g=i.leaveCancelled,f=i.delayLeave,v=i.duration,y=!1!==r&&!W,x=Lr(m),k=b(c(v)?v.leave:v);0;var _=t._leaveCb=j((function(){t.parentNode&&t.parentNode._pending&&(t.parentNode._pending[n.key]=null),y&&(kr(t,d),kr(t,u)),_.cancelled?(y&&kr(t,o),g&&g(t)):(e(),h&&h(t)),t._leaveCb=null}));f?f(E):E()}function E(){_.cancelled||(!n.data.show&&t.parentNode&&((t.parentNode._pending||(t.parentNode._pending={}))[n.key]=n),p&&p(t),y&&(xr(t,o),xr(t,u),yr((function(){kr(t,o),_.cancelled||(xr(t,d),x||(Ar(k)?setTimeout(_,k):_r(t,l,_)))}))),m&&m(t,_),y||x||_())}}function Ar(n){return"number"==typeof n&&!isNaN(n)}function Lr(n){if(a(n))return!1;var e=n.fns;return s(e)?Lr(Array.isArray(e)?e[0]:e):(n._length||n.length)>1}function Br(n,e){!0!==e.data.show&&wr(e)}var Cr=function(n){var e,t,i={},d=n.modules,c=n.nodeOps;for(e=0;e<Si.length;++e)for(i[Si[e]]=[],t=0;t<d.length;++t)s(d[t][Si[e]])&&i[Si[e]].push(d[t][Si[e]]);function u(n){var e=c.parentNode(n);s(e)&&c.removeChild(e,n)}function p(n,e,t,r,a,o,d){if(s(n.elm)&&s(o)&&(n=o[d]=fn(n)),n.isRootInsert=!a,!function(n,e,t,r){var a=n.data;if(s(a)){var o=s(n.componentInstance)&&a.keepAlive;if(s(a=a.hook)&&s(a=a.init)&&a(n,!1),s(n.componentInstance))return m(n,e),h(t,n.elm,r),l(o)&&function(n,e,t,r){var a,l=n;for(;l.componentInstance;)if(l=l.componentInstance._vnode,s(a=l.data)&&s(a=a.transition)){for(a=0;a<i.activate.length;++a)i.activate[a](Ei,l);e.push(l);break}h(t,n.elm,r)}(n,e,t,r),!0}}(n,e,t,r)){var u=n.data,p=n.children,f=n.tag;s(f)?(n.elm=n.ns?c.createElementNS(n.ns,f):c.createElement(f,n),y(n),g(n,p,e),s(u)&&b(n,e),h(t,n.elm,r)):l(n.isComment)?(n.elm=c.createComment(n.text),h(t,n.elm,r)):(n.elm=c.createTextNode(n.text),h(t,n.elm,r))}}function m(n,e){s(n.data.pendingInsert)&&(e.push.apply(e,n.data.pendingInsert),n.data.pendingInsert=null),n.elm=n.componentInstance.$el,f(n)?(b(n,e),y(n)):(ki(n),e.push(n))}function h(n,e,t){s(n)&&(s(t)?c.parentNode(t)===n&&c.insertBefore(n,e,t):c.appendChild(n,e))}function g(n,e,t){if(r(e)){0;for(var i=0;i<e.length;++i)p(e[i],t,n.elm,null,!0,e,i)}else o(n.text)&&c.appendChild(n.elm,c.createTextNode(String(n.text)))}function f(n){for(;n.componentInstance;)n=n.componentInstance._vnode;return s(n.tag)}function b(n,t){for(var r=0;r<i.create.length;++r)i.create[r](Ei,n);s(e=n.data.hook)&&(s(e.create)&&e.create(Ei,n),s(e.insert)&&t.push(n))}function y(n){var e;if(s(e=n.fnScopeId))c.setStyleScope(n.elm,e);else for(var t=n;t;)s(e=t.context)&&s(e=e.$options._scopeId)&&c.setStyleScope(n.elm,e),t=t.parent;s(e=Xe)&&e!==n.context&&e!==n.fnContext&&s(e=e.$options._scopeId)&&c.setStyleScope(n.elm,e)}function x(n,e,t,i,r,a){for(;i<=r;++i)p(t[i],a,n,e,!1,t,i)}function k(n){var e,t,r=n.data;if(s(r))for(s(e=r.hook)&&s(e=e.destroy)&&e(n),e=0;e<i.destroy.length;++e)i.destroy[e](n);if(s(e=n.children))for(t=0;t<n.children.length;++t)k(n.children[t])}function _(n,e,t){for(;e<=t;++e){var i=n[e];s(i)&&(s(i.tag)?(E(i),k(i)):u(i.elm))}}function E(n,e){if(s(e)||s(n.data)){var t,r=i.remove.length+1;for(s(e)?e.listeners+=r:e=function(n,e){function t(){0==--t.listeners&&u(n)}return t.listeners=e,t}(n.elm,r),s(t=n.componentInstance)&&s(t=t._vnode)&&s(t.data)&&E(t,e),t=0;t<i.remove.length;++t)i.remove[t](n,e);s(t=n.data.hook)&&s(t=t.remove)?t(n,e):e()}else u(n.elm)}function S(n,e,t,i){for(var r=t;r<i;r++){var a=e[r];if(s(a)&&Ri(n,a))return r}}function R(n,e,t,r,o,d){if(n!==e){s(e.elm)&&s(r)&&(e=r[o]=fn(e));var u=e.elm=n.elm;if(l(n.isAsyncPlaceholder))s(e.asyncFactory.resolved)?I(n.elm,e,t):e.isAsyncPlaceholder=!0;else if(l(e.isStatic)&&l(n.isStatic)&&e.key===n.key&&(l(e.isCloned)||l(e.isOnce)))e.componentInstance=n.componentInstance;else{var m,h=e.data;s(h)&&s(m=h.hook)&&s(m=m.prepatch)&&m(n,e);var g=n.children,b=e.children;if(s(h)&&f(e)){for(m=0;m<i.update.length;++m)i.update[m](n,e);s(m=h.hook)&&s(m=m.update)&&m(n,e)}a(e.text)?s(g)&&s(b)?g!==b&&function(n,e,t,i,r){var l,o,d,u=0,m=0,h=e.length-1,g=e[0],f=e[h],b=t.length-1,v=t[0],y=t[b],k=!r;for(0;u<=h&&m<=b;)a(g)?g=e[++u]:a(f)?f=e[--h]:Ri(g,v)?(R(g,v,i,t,m),g=e[++u],v=t[++m]):Ri(f,y)?(R(f,y,i,t,b),f=e[--h],y=t[--b]):Ri(g,y)?(R(g,y,i,t,b),k&&c.insertBefore(n,g.elm,c.nextSibling(f.elm)),g=e[++u],y=t[--b]):Ri(f,v)?(R(f,v,i,t,m),k&&c.insertBefore(n,f.elm,g.elm),f=e[--h],v=t[++m]):(a(l)&&(l=Ti(e,u,h)),a(o=s(v.key)?l[v.key]:S(v,e,u,h))?p(v,i,n,g.elm,!1,t,m):Ri(d=e[o],v)?(R(d,v,i,t,m),e[o]=void 0,k&&c.insertBefore(n,d.elm,g.elm)):p(v,i,n,g.elm,!1,t,m),v=t[++m]);u>h?x(n,a(t[b+1])?null:t[b+1].elm,t,m,b,i):m>b&&_(e,u,h)}(u,g,b,t,d):s(b)?(s(n.text)&&c.setTextContent(u,""),x(u,null,b,0,b.length-1,t)):s(g)?_(g,0,g.length-1):s(n.text)&&c.setTextContent(u,""):n.text!==e.text&&c.setTextContent(u,e.text),s(h)&&s(m=h.hook)&&s(m=m.postpatch)&&m(n,e)}}}function T(n,e,t){if(l(t)&&s(n.parent))n.parent.data.pendingInsert=e;else for(var i=0;i<e.length;++i)e[i].data.hook.insert(e[i])}var w=v("attrs,class,staticClass,staticStyle,key");function I(n,e,t,i){var r,a=e.tag,o=e.data,d=e.children;if(i=i||o&&o.pre,e.elm=n,l(e.isComment)&&s(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(s(o)&&(s(r=o.hook)&&s(r=r.init)&&r(e,!0),s(r=e.componentInstance)))return m(e,t),!0;if(s(a)){if(s(d))if(n.hasChildNodes())if(s(r=o)&&s(r=r.domProps)&&s(r=r.innerHTML)){if(r!==n.innerHTML)return!1}else{for(var c=!0,u=n.firstChild,p=0;p<d.length;p++){if(!u||!I(u,d[p],t,i)){c=!1;break}u=u.nextSibling}if(!c||u)return!1}else g(e,d,t);if(s(o)){var h=!1;for(var f in o)if(!w(f)){h=!0,b(e,t);break}!h&&o.class&&Ne(o.class)}}else n.data!==e.text&&(n.data=e.text);return!0}return function(n,e,t,r){if(!a(e)){var o,d=!1,u=[];if(a(n))d=!0,p(e,u);else{var m=s(n.nodeType);if(!m&&Ri(n,e))R(n,e,u,null,null,r);else{if(m){if(1===n.nodeType&&n.hasAttribute("data-server-rendered")&&(n.removeAttribute("data-server-rendered"),t=!0),l(t)&&I(n,e,u))return T(e,u,!0),n;o=n,n=new mn(c.tagName(o).toLowerCase(),{},[],void 0,o)}var h=n.elm,g=c.parentNode(h);if(p(e,u,h._leaveCb?null:g,c.nextSibling(h)),s(e.parent))for(var b=e.parent,v=f(e);b;){for(var y=0;y<i.destroy.length;++y)i.destroy[y](b);if(b.elm=e.elm,v){for(var x=0;x<i.create.length;++x)i.create[x](Ei,b);var E=b.data.hook.insert;if(E.merged)for(var S=1;S<E.fns.length;S++)E.fns[S]()}else ki(b);b=b.parent}s(g)?_([n],0,0):s(n.tag)&&k(n)}}return T(e,u,d),e.elm}s(n)&&k(n)}}({nodeOps:yi,modules:[Mi,$i,Ji,Xi,lr,V?{create:Br,activate:Br,remove:function(n,e){!0!==n.data.show?Ir(n,e):e()}}:{}].concat(zi)});W&&document.addEventListener("selectionchange",(function(){var n=document.activeElement;n&&n.vmodel&&$r(n,"input")}));var zr={inserted:function(n,e,t,i){"select"===t.tag?(i.elm&&!i.elm._vOptions?Jn(t,"postpatch",(function(){zr.componentUpdated(n,e,t)})):Dr(n,e,t.context),n._vOptions=[].map.call(n.options,Mr)):("textarea"===t.tag||vi(n.type))&&(n._vModifiers=e.modifiers,e.modifiers.lazy||(n.addEventListener("compositionstart",jr),n.addEventListener("compositionend",Ur),n.addEventListener("change",Ur),W&&(n.vmodel=!0)))},componentUpdated:function(n,e,t){if("select"===t.tag){Dr(n,e,t.context);var i=n._vOptions,r=n._vOptions=[].map.call(n.options,Mr);if(r.some((function(n,e){return!O(n,i[e])})))(n.multiple?e.value.some((function(n){return Or(n,r)})):e.value!==e.oldValue&&Or(e.value,r))&&$r(n,"change")}}};function Dr(n,e,t){Pr(n,e,t),(X||Y)&&setTimeout((function(){Pr(n,e,t)}),0)}function Pr(n,e,t){var i=e.value,r=n.multiple;if(!r||Array.isArray(i)){for(var a,s,l=0,o=n.options.length;l<o;l++)if(s=n.options[l],r)a=M(i,Mr(s))>-1,s.selected!==a&&(s.selected=a);else if(O(Mr(s),i))return void(n.selectedIndex!==l&&(n.selectedIndex=l));r||(n.selectedIndex=-1)}}function Or(n,e){return e.every((function(e){return!O(e,n)}))}function Mr(n){return"_value"in n?n._value:n.value}function jr(n){n.target.composing=!0}function Ur(n){n.target.composing&&(n.target.composing=!1,$r(n.target,"input"))}function $r(n,e){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),n.dispatchEvent(t)}function Fr(n){return!n.componentInstance||n.data&&n.data.transition?n:Fr(n.componentInstance._vnode)}var Nr={model:zr,show:{bind:function(n,e,t){var i=e.value,r=(t=Fr(t)).data&&t.data.transition,a=n.__vOriginalDisplay="none"===n.style.display?"":n.style.display;i&&r?(t.data.show=!0,wr(t,(function(){n.style.display=a}))):n.style.display=i?a:"none"},update:function(n,e,t){var i=e.value;!i!=!e.oldValue&&((t=Fr(t)).data&&t.data.transition?(t.data.show=!0,i?wr(t,(function(){n.style.display=n.__vOriginalDisplay})):Ir(t,(function(){n.style.display="none"}))):n.style.display=i?n.__vOriginalDisplay:"none")},unbind:function(n,e,t,i,r){r||(n.style.display=n.__vOriginalDisplay)}}},qr={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function Gr(n){var e=n&&n.componentOptions;return e&&e.Ctor.options.abstract?Gr(Se(e.children)):n}function Kr(n){var e={},t=n.$options;for(var i in t.propsData)e[i]=n[i];var r=t._parentListeners;for(var i in r)e[R(i)]=r[i];return e}function Hr(n,e){if(/\d-keep-alive$/.test(e.tag))return n("keep-alive",{props:e.componentOptions.propsData})}var Jr=function(n){return n.tag||he(n)},Vr=function(n){return"show"===n.name},Qr={name:"transition",props:qr,abstract:!0,render:function(n){var e=this,t=this.$slots.default;if(t&&(t=t.filter(Jr)).length){0;var i=this.mode;0;var r=t[0];if(function(n){for(;n=n.parent;)if(n.data.transition)return!0}(this.$vnode))return r;var a=Gr(r);if(!a)return r;if(this._leaving)return Hr(n,r);var s="__transition-".concat(this._uid,"-");a.key=null==a.key?a.isComment?s+"comment":s+a.tag:o(a.key)?0===String(a.key).indexOf(s)?a.key:s+a.key:a.key;var l=(a.data||(a.data={})).transition=Kr(this),d=this._vnode,c=Gr(d);if(a.data.directives&&a.data.directives.some(Vr)&&(a.data.show=!0),c&&c.data&&!function(n,e){return e.key===n.key&&e.tag===n.tag}(a,c)&&!he(c)&&(!c.componentInstance||!c.componentInstance._vnode.isComment)){var u=c.data.transition=B({},l);if("out-in"===i)return this._leaving=!0,Jn(u,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),Hr(n,r);if("in-out"===i){if(he(a))return d;var p,m=function(){p()};Jn(l,"afterEnter",m),Jn(l,"enterCancelled",m),Jn(u,"delayLeave",(function(n){p=n}))}}return r}}},Xr=B({tag:String,moveClass:String},qr);function Wr(n){n.elm._moveCb&&n.elm._moveCb(),n.elm._enterCb&&n.elm._enterCb()}function Yr(n){n.data.newPos=n.elm.getBoundingClientRect()}function Zr(n){var e=n.data.pos,t=n.data.newPos,i=e.left-t.left,r=e.top-t.top;if(i||r){n.data.moved=!0;var a=n.elm.style;a.transform=a.WebkitTransform="translate(".concat(i,"px,").concat(r,"px)"),a.transitionDuration="0s"}}delete Xr.mode;var na={Transition:Qr,TransitionGroup:{props:Xr,beforeMount:function(){var n=this,e=this._update;this._update=function(t,i){var r=We(n);n.__patch__(n._vnode,n.kept,!1,!0),n._vnode=n.kept,r(),e.call(n,t,i)}},render:function(n){for(var e=this.tag||this.$vnode.data.tag||"span",t=Object.create(null),i=this.prevChildren=this.children,r=this.$slots.default||[],a=this.children=[],s=Kr(this),l=0;l<r.length;l++){if((c=r[l]).tag)if(null!=c.key&&0!==String(c.key).indexOf("__vlist"))a.push(c),t[c.key]=c,(c.data||(c.data={})).transition=s;else;}if(i){var o=[],d=[];for(l=0;l<i.length;l++){var c;(c=i[l]).data.transition=s,c.data.pos=c.elm.getBoundingClientRect(),t[c.key]?o.push(c):d.push(c)}this.kept=n(e,null,o),this.removed=d}return n(e,null,a)},updated:function(){var n=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";n.length&&this.hasMove(n[0].elm,e)&&(n.forEach(Wr),n.forEach(Yr),n.forEach(Zr),this._reflow=document.body.offsetHeight,n.forEach((function(n){if(n.data.moved){var t=n.elm,i=t.style;xr(t,e),i.transform=i.WebkitTransform=i.transitionDuration="",t.addEventListener(gr,t._moveCb=function n(i){i&&i.target!==t||i&&!/transform$/.test(i.propertyName)||(t.removeEventListener(gr,n),t._moveCb=null,kr(t,e))})}})))},methods:{hasMove:function(n,e){if(!mr)return!1;if(this._hasMove)return this._hasMove;var t=n.cloneNode();n._transitionClasses&&n._transitionClasses.forEach((function(n){cr(t,n)})),dr(t,e),t.style.display="none",this.$el.appendChild(t);var i=Sr(t);return this.$el.removeChild(t),this._hasMove=i.hasTransform}}}};function ea(n,e){for(var t in e)n[t]=e[t];return n}Ht.config.mustUseProp=function(n,e,t){return"value"===t&&ei(n)&&"button"!==e||"selected"===t&&"option"===n||"checked"===t&&"input"===n||"muted"===t&&"video"===n},Ht.config.isReservedTag=fi,Ht.config.isReservedAttr=ni,Ht.config.getTagNamespace=function(n){return gi(n)?"svg":"math"===n?"math":void 0},Ht.config.isUnknownElement=function(n){if(!V)return!0;if(fi(n))return!1;if(n=n.toLowerCase(),null!=bi[n])return bi[n];var e=document.createElement(n);return n.indexOf("-")>-1?bi[n]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:bi[n]=/HTMLUnknownElement/.test(e.toString())},B(Ht.options.directives,Nr),B(Ht.options.components,na),Ht.prototype.__patch__=V?Cr:z,Ht.prototype.$mount=function(n,e){return function(n,e,t){var i;n.$el=e,n.$options.render||(n.$options.render=hn),nt(n,"beforeMount"),i=function(){n._update(n._render(),t)},new Ke(n,i,z,{before:function(){n._isMounted&&!n._isDestroyed&&nt(n,"beforeUpdate")}},!0),t=!1;var r=n._preWatchers;if(r)for(var a=0;a<r.length;a++)r[a].run();return null==n.$vnode&&(n._isMounted=!0,nt(n,"mounted")),n}(this,n=n&&V?function(n){if("string"==typeof n){var e=document.querySelector(n);return e||document.createElement("div")}return n}(n):void 0,e)},V&&setTimeout((function(){N.devtools&&ln&&ln.emit("init",Ht)}),0);var ta=/[!'()*]/g,ia=function(n){return"%"+n.charCodeAt(0).toString(16)},ra=/%2C/g,aa=function(n){return encodeURIComponent(n).replace(ta,ia).replace(ra,",")};function sa(n){try{return decodeURIComponent(n)}catch(n){0}return n}var la=function(n){return null==n||"object"==typeof n?n:String(n)};function oa(n){var e={};return(n=n.trim().replace(/^(\?|#|&)/,""))?(n.split("&").forEach((function(n){var t=n.replace(/\+/g," ").split("="),i=sa(t.shift()),r=t.length>0?sa(t.join("=")):null;void 0===e[i]?e[i]=r:Array.isArray(e[i])?e[i].push(r):e[i]=[e[i],r]})),e):e}function da(n){var e=n?Object.keys(n).map((function(e){var t=n[e];if(void 0===t)return"";if(null===t)return aa(e);if(Array.isArray(t)){var i=[];return t.forEach((function(n){void 0!==n&&(null===n?i.push(aa(e)):i.push(aa(e)+"="+aa(n)))})),i.join("&")}return aa(e)+"="+aa(t)})).filter((function(n){return n.length>0})).join("&"):null;return e?"?"+e:""}var ca=/\/?$/;function ua(n,e,t,i){var r=i&&i.options.stringifyQuery,a=e.query||{};try{a=pa(a)}catch(n){}var s={name:e.name||n&&n.name,meta:n&&n.meta||{},path:e.path||"/",hash:e.hash||"",query:a,params:e.params||{},fullPath:ga(e,r),matched:n?ha(n):[]};return t&&(s.redirectedFrom=ga(t,r)),Object.freeze(s)}function pa(n){if(Array.isArray(n))return n.map(pa);if(n&&"object"==typeof n){var e={};for(var t in n)e[t]=pa(n[t]);return e}return n}var ma=ua(null,{path:"/"});function ha(n){for(var e=[];n;)e.unshift(n),n=n.parent;return e}function ga(n,e){var t=n.path,i=n.query;void 0===i&&(i={});var r=n.hash;return void 0===r&&(r=""),(t||"/")+(e||da)(i)+r}function fa(n,e,t){return e===ma?n===e:!!e&&(n.path&&e.path?n.path.replace(ca,"")===e.path.replace(ca,"")&&(t||n.hash===e.hash&&ba(n.query,e.query)):!(!n.name||!e.name)&&(n.name===e.name&&(t||n.hash===e.hash&&ba(n.query,e.query)&&ba(n.params,e.params))))}function ba(n,e){if(void 0===n&&(n={}),void 0===e&&(e={}),!n||!e)return n===e;var t=Object.keys(n).sort(),i=Object.keys(e).sort();return t.length===i.length&&t.every((function(t,r){var a=n[t];if(i[r]!==t)return!1;var s=e[t];return null==a||null==s?a===s:"object"==typeof a&&"object"==typeof s?ba(a,s):String(a)===String(s)}))}function va(n){for(var e=0;e<n.matched.length;e++){var t=n.matched[e];for(var i in t.instances){var r=t.instances[i],a=t.enteredCbs[i];if(r&&a){delete t.enteredCbs[i];for(var s=0;s<a.length;s++)r._isBeingDestroyed||a[s](r)}}}}var ya={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(n,e){var t=e.props,i=e.children,r=e.parent,a=e.data;a.routerView=!0;for(var s=r.$createElement,l=t.name,o=r.$route,d=r._routerViewCache||(r._routerViewCache={}),c=0,u=!1;r&&r._routerRoot!==r;){var p=r.$vnode?r.$vnode.data:{};p.routerView&&c++,p.keepAlive&&r._directInactive&&r._inactive&&(u=!0),r=r.$parent}if(a.routerViewDepth=c,u){var m=d[l],h=m&&m.component;return h?(m.configProps&&xa(h,a,m.route,m.configProps),s(h,a,i)):s()}var g=o.matched[c],f=g&&g.components[l];if(!g||!f)return d[l]=null,s();d[l]={component:f},a.registerRouteInstance=function(n,e){var t=g.instances[l];(e&&t!==n||!e&&t===n)&&(g.instances[l]=e)},(a.hook||(a.hook={})).prepatch=function(n,e){g.instances[l]=e.componentInstance},a.hook.init=function(n){n.data.keepAlive&&n.componentInstance&&n.componentInstance!==g.instances[l]&&(g.instances[l]=n.componentInstance),va(o)};var b=g.props&&g.props[l];return b&&(ea(d[l],{route:o,configProps:b}),xa(f,a,o,b)),s(f,a,i)}};function xa(n,e,t,i){var r=e.props=function(n,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(n);case"boolean":return e?n.params:void 0;default:0}}(t,i);if(r){r=e.props=ea({},r);var a=e.attrs=e.attrs||{};for(var s in r)n.props&&s in n.props||(a[s]=r[s],delete r[s])}}function ka(n,e,t){var i=n.charAt(0);if("/"===i)return n;if("?"===i||"#"===i)return e+n;var r=e.split("/");t&&r[r.length-1]||r.pop();for(var a=n.replace(/^\//,"").split("/"),s=0;s<a.length;s++){var l=a[s];".."===l?r.pop():"."!==l&&r.push(l)}return""!==r[0]&&r.unshift(""),r.join("/")}function _a(n){return n.replace(/\/(?:\s*\/)+/g,"/")}var Ea=Array.isArray||function(n){return"[object Array]"==Object.prototype.toString.call(n)},Sa=ja,Ra=La,Ta=function(n,e){return Ca(La(n,e),e)},wa=Ca,Ia=Ma,Aa=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function La(n,e){for(var t,i=[],r=0,a=0,s="",l=e&&e.delimiter||"/";null!=(t=Aa.exec(n));){var o=t[0],d=t[1],c=t.index;if(s+=n.slice(a,c),a=c+o.length,d)s+=d[1];else{var u=n[a],p=t[2],m=t[3],h=t[4],g=t[5],f=t[6],b=t[7];s&&(i.push(s),s="");var v=null!=p&&null!=u&&u!==p,y="+"===f||"*"===f,x="?"===f||"*"===f,k=t[2]||l,_=h||g;i.push({name:m||r++,prefix:p||"",delimiter:k,optional:x,repeat:y,partial:v,asterisk:!!b,pattern:_?Da(_):b?".*":"[^"+za(k)+"]+?"})}}return a<n.length&&(s+=n.substr(a)),s&&i.push(s),i}function Ba(n){return encodeURI(n).replace(/[\/?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()}))}function Ca(n,e){for(var t=new Array(n.length),i=0;i<n.length;i++)"object"==typeof n[i]&&(t[i]=new RegExp("^(?:"+n[i].pattern+")$",Oa(e)));return function(e,i){for(var r="",a=e||{},s=(i||{}).pretty?Ba:encodeURIComponent,l=0;l<n.length;l++){var o=n[l];if("string"!=typeof o){var d,c=a[o.name];if(null==c){if(o.optional){o.partial&&(r+=o.prefix);continue}throw new TypeError('Expected "'+o.name+'" to be defined')}if(Ea(c)){if(!o.repeat)throw new TypeError('Expected "'+o.name+'" to not repeat, but received `'+JSON.stringify(c)+"`");if(0===c.length){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var u=0;u<c.length;u++){if(d=s(c[u]),!t[l].test(d))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but received `'+JSON.stringify(d)+"`");r+=(0===u?o.prefix:o.delimiter)+d}}else{if(d=o.asterisk?encodeURI(c).replace(/[?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()})):s(c),!t[l].test(d))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but received "'+d+'"');r+=o.prefix+d}}else r+=o}return r}}function za(n){return n.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function Da(n){return n.replace(/([=!:$\/()])/g,"\\$1")}function Pa(n,e){return n.keys=e,n}function Oa(n){return n&&n.sensitive?"":"i"}function Ma(n,e,t){Ea(e)||(t=e||t,e=[]);for(var i=(t=t||{}).strict,r=!1!==t.end,a="",s=0;s<n.length;s++){var l=n[s];if("string"==typeof l)a+=za(l);else{var o=za(l.prefix),d="(?:"+l.pattern+")";e.push(l),l.repeat&&(d+="(?:"+o+d+")*"),a+=d=l.optional?l.partial?o+"("+d+")?":"(?:"+o+"("+d+"))?":o+"("+d+")"}}var c=za(t.delimiter||"/"),u=a.slice(-c.length)===c;return i||(a=(u?a.slice(0,-c.length):a)+"(?:"+c+"(?=$))?"),a+=r?"$":i&&u?"":"(?="+c+"|$)",Pa(new RegExp("^"+a,Oa(t)),e)}function ja(n,e,t){return Ea(e)||(t=e||t,e=[]),t=t||{},n instanceof RegExp?function(n,e){var t=n.source.match(/\((?!\?)/g);if(t)for(var i=0;i<t.length;i++)e.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return Pa(n,e)}(n,e):Ea(n)?function(n,e,t){for(var i=[],r=0;r<n.length;r++)i.push(ja(n[r],e,t).source);return Pa(new RegExp("(?:"+i.join("|")+")",Oa(t)),e)}(n,e,t):function(n,e,t){return Ma(La(n,t),e,t)}(n,e,t)}Sa.parse=Ra,Sa.compile=Ta,Sa.tokensToFunction=wa,Sa.tokensToRegExp=Ia;var Ua=Object.create(null);function $a(n,e,t){e=e||{};try{var i=Ua[n]||(Ua[n]=Sa.compile(n));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),i(e,{pretty:!0})}catch(n){return""}finally{delete e[0]}}function Fa(n,e,t,i){var r="string"==typeof n?{path:n}:n;if(r._normalized)return r;if(r.name){var a=(r=ea({},n)).params;return a&&"object"==typeof a&&(r.params=ea({},a)),r}if(!r.path&&r.params&&e){(r=ea({},r))._normalized=!0;var s=ea(ea({},e.params),r.params);if(e.name)r.name=e.name,r.params=s;else if(e.matched.length){var l=e.matched[e.matched.length-1].path;r.path=$a(l,s,e.path)}else 0;return r}var o=function(n){var e="",t="",i=n.indexOf("#");i>=0&&(e=n.slice(i),n=n.slice(0,i));var r=n.indexOf("?");return r>=0&&(t=n.slice(r+1),n=n.slice(0,r)),{path:n,query:t,hash:e}}(r.path||""),d=e&&e.path||"/",c=o.path?ka(o.path,d,t||r.append):d,u=function(n,e,t){void 0===e&&(e={});var i,r=t||oa;try{i=r(n||"")}catch(n){i={}}for(var a in e){var s=e[a];i[a]=Array.isArray(s)?s.map(la):la(s)}return i}(o.query,r.query,i&&i.options.parseQuery),p=r.hash||o.hash;return p&&"#"!==p.charAt(0)&&(p="#"+p),{_normalized:!0,path:c,query:u,hash:p}}var Na,qa=function(){},Ga={name:"RouterLink",props:{to:{type:[String,Object],required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:[String,Array],default:"click"}},render:function(n){var e=this,t=this.$router,i=this.$route,r=t.resolve(this.to,i,this.append),a=r.location,s=r.route,l=r.href,o={},d=t.options.linkActiveClass,c=t.options.linkExactActiveClass,u=null==d?"router-link-active":d,p=null==c?"router-link-exact-active":c,m=null==this.activeClass?u:this.activeClass,h=null==this.exactActiveClass?p:this.exactActiveClass,g=s.redirectedFrom?ua(null,Fa(s.redirectedFrom),null,t):s;o[h]=fa(i,g,this.exactPath),o[m]=this.exact||this.exactPath?o[h]:function(n,e){return 0===n.path.replace(ca,"/").indexOf(e.path.replace(ca,"/"))&&(!e.hash||n.hash===e.hash)&&function(n,e){for(var t in e)if(!(t in n))return!1;return!0}(n.query,e.query)}(i,g);var f=o[h]?this.ariaCurrentValue:null,b=function(n){Ka(n)&&(e.replace?t.replace(a,qa):t.push(a,qa))},v={click:Ka};Array.isArray(this.event)?this.event.forEach((function(n){v[n]=b})):v[this.event]=b;var y={class:o},x=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:l,route:s,navigate:b,isActive:o[m],isExactActive:o[h]});if(x){if(1===x.length)return x[0];if(x.length>1||!x.length)return 0===x.length?n():n("span",{},x)}if("a"===this.tag)y.on=v,y.attrs={href:l,"aria-current":f};else{var k=function n(e){var t;if(e)for(var i=0;i<e.length;i++){if("a"===(t=e[i]).tag)return t;if(t.children&&(t=n(t.children)))return t}}(this.$slots.default);if(k){k.isStatic=!1;var _=k.data=ea({},k.data);for(var E in _.on=_.on||{},_.on){var S=_.on[E];E in v&&(_.on[E]=Array.isArray(S)?S:[S])}for(var R in v)R in _.on?_.on[R].push(v[R]):_.on[R]=b;var T=k.data.attrs=ea({},k.data.attrs);T.href=l,T["aria-current"]=f}else y.on=v}return n(this.tag,y,this.$slots.default)}};function Ka(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey||n.defaultPrevented||void 0!==n.button&&0!==n.button)){if(n.currentTarget&&n.currentTarget.getAttribute){var e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}var Ha="undefined"!=typeof window;function Ja(n,e,t,i,r){var a=e||[],s=t||Object.create(null),l=i||Object.create(null);n.forEach((function(n){!function n(e,t,i,r,a,s){var l=r.path,o=r.name;0;var d=r.pathToRegexpOptions||{},c=function(n,e,t){t||(n=n.replace(/\/$/,""));if("/"===n[0])return n;if(null==e)return n;return _a(e.path+"/"+n)}(l,a,d.strict);"boolean"==typeof r.caseSensitive&&(d.sensitive=r.caseSensitive);var u={path:c,regex:Va(c,d),components:r.components||{default:r.component},alias:r.alias?"string"==typeof r.alias?[r.alias]:r.alias:[],instances:{},enteredCbs:{},name:o,parent:a,matchAs:s,redirect:r.redirect,beforeEnter:r.beforeEnter,meta:r.meta||{},props:null==r.props?{}:r.components?r.props:{default:r.props}};r.children&&r.children.forEach((function(r){var a=s?_a(s+"/"+r.path):void 0;n(e,t,i,r,u,a)}));t[u.path]||(e.push(u.path),t[u.path]=u);if(void 0!==r.alias)for(var p=Array.isArray(r.alias)?r.alias:[r.alias],m=0;m<p.length;++m){0;var h={path:p[m],children:r.children};n(e,t,i,h,a,u.path||"/")}o&&(i[o]||(i[o]=u))}(a,s,l,n,r)}));for(var o=0,d=a.length;o<d;o++)"*"===a[o]&&(a.push(a.splice(o,1)[0]),d--,o--);return{pathList:a,pathMap:s,nameMap:l}}function Va(n,e){return Sa(n,[],e)}function Qa(n,e){var t=Ja(n),i=t.pathList,r=t.pathMap,a=t.nameMap;function s(n,t,s){var l=Fa(n,t,!1,e),d=l.name;if(d){var c=a[d];if(!c)return o(null,l);var u=c.regex.keys.filter((function(n){return!n.optional})).map((function(n){return n.name}));if("object"!=typeof l.params&&(l.params={}),t&&"object"==typeof t.params)for(var p in t.params)!(p in l.params)&&u.indexOf(p)>-1&&(l.params[p]=t.params[p]);return l.path=$a(c.path,l.params),o(c,l,s)}if(l.path){l.params={};for(var m=0;m<i.length;m++){var h=i[m],g=r[h];if(Xa(g.regex,l.path,l.params))return o(g,l,s)}}return o(null,l)}function l(n,t){var i=n.redirect,r="function"==typeof i?i(ua(n,t,null,e)):i;if("string"==typeof r&&(r={path:r}),!r||"object"!=typeof r)return o(null,t);var l=r,d=l.name,c=l.path,u=t.query,p=t.hash,m=t.params;if(u=l.hasOwnProperty("query")?l.query:u,p=l.hasOwnProperty("hash")?l.hash:p,m=l.hasOwnProperty("params")?l.params:m,d){a[d];return s({_normalized:!0,name:d,query:u,hash:p,params:m},void 0,t)}if(c){var h=function(n,e){return ka(n,e.parent?e.parent.path:"/",!0)}(c,n);return s({_normalized:!0,path:$a(h,m),query:u,hash:p},void 0,t)}return o(null,t)}function o(n,t,i){return n&&n.redirect?l(n,i||t):n&&n.matchAs?function(n,e,t){var i=s({_normalized:!0,path:$a(t,e.params)});if(i){var r=i.matched,a=r[r.length-1];return e.params=i.params,o(a,e)}return o(null,e)}(0,t,n.matchAs):ua(n,t,i,e)}return{match:s,addRoute:function(n,e){var t="object"!=typeof n?a[n]:void 0;Ja([e||n],i,r,a,t),t&&t.alias.length&&Ja(t.alias.map((function(n){return{path:n,children:[e]}})),i,r,a,t)},getRoutes:function(){return i.map((function(n){return r[n]}))},addRoutes:function(n){Ja(n,i,r,a)}}}function Xa(n,e,t){var i=e.match(n);if(!i)return!1;if(!t)return!0;for(var r=1,a=i.length;r<a;++r){var s=n.keys[r-1];s&&(t[s.name||"pathMatch"]="string"==typeof i[r]?sa(i[r]):i[r])}return!0}var Wa=Ha&&window.performance&&window.performance.now?window.performance:Date;function Ya(){return Wa.now().toFixed(3)}var Za=Ya();function ns(){return Za}function es(n){return Za=n}var ts=Object.create(null);function is(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var n=window.location.protocol+"//"+window.location.host,e=window.location.href.replace(n,""),t=ea({},window.history.state);return t.key=ns(),window.history.replaceState(t,"",e),window.addEventListener("popstate",ss),function(){window.removeEventListener("popstate",ss)}}function rs(n,e,t,i){if(n.app){var r=n.options.scrollBehavior;r&&n.app.$nextTick((function(){var a=function(){var n=ns();if(n)return ts[n]}(),s=r.call(n,e,t,i?a:null);s&&("function"==typeof s.then?s.then((function(n){us(n,a)})).catch((function(n){0})):us(s,a))}))}}function as(){var n=ns();n&&(ts[n]={x:window.pageXOffset,y:window.pageYOffset})}function ss(n){as(),n.state&&n.state.key&&es(n.state.key)}function ls(n){return ds(n.x)||ds(n.y)}function os(n){return{x:ds(n.x)?n.x:window.pageXOffset,y:ds(n.y)?n.y:window.pageYOffset}}function ds(n){return"number"==typeof n}var cs=/^#\d/;function us(n,e){var t,i="object"==typeof n;if(i&&"string"==typeof n.selector){var r=cs.test(n.selector)?document.getElementById(n.selector.slice(1)):document.querySelector(n.selector);if(r){var a=n.offset&&"object"==typeof n.offset?n.offset:{};e=function(n,e){var t=document.documentElement.getBoundingClientRect(),i=n.getBoundingClientRect();return{x:i.left-t.left-e.x,y:i.top-t.top-e.y}}(r,a={x:ds((t=a).x)?t.x:0,y:ds(t.y)?t.y:0})}else ls(n)&&(e=os(n))}else i&&ls(n)&&(e=os(n));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:n.behavior}):window.scrollTo(e.x,e.y))}var ps,ms=Ha&&((-1===(ps=window.navigator.userAgent).indexOf("Android 2.")&&-1===ps.indexOf("Android 4.0")||-1===ps.indexOf("Mobile Safari")||-1!==ps.indexOf("Chrome")||-1!==ps.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState);function hs(n,e){as();var t=window.history;try{if(e){var i=ea({},t.state);i.key=ns(),t.replaceState(i,"",n)}else t.pushState({key:es(Ya())},"",n)}catch(t){window.location[e?"replace":"assign"](n)}}function gs(n){hs(n,!0)}var fs={redirected:2,aborted:4,cancelled:8,duplicated:16};function bs(n,e){return ys(n,e,fs.redirected,'Redirected when going from "'+n.fullPath+'" to "'+function(n){if("string"==typeof n)return n;if("path"in n)return n.path;var e={};return xs.forEach((function(t){t in n&&(e[t]=n[t])})),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function vs(n,e){return ys(n,e,fs.cancelled,'Navigation cancelled from "'+n.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function ys(n,e,t,i){var r=new Error(i);return r._isRouter=!0,r.from=n,r.to=e,r.type=t,r}var xs=["params","query","hash"];function ks(n){return Object.prototype.toString.call(n).indexOf("Error")>-1}function _s(n,e){return ks(n)&&n._isRouter&&(null==e||n.type===e)}function Es(n,e,t){var i=function(r){r>=n.length?t():n[r]?e(n[r],(function(){i(r+1)})):i(r+1)};i(0)}function Ss(n){return function(e,t,i){var r=!1,a=0,s=null;Rs(n,(function(n,e,t,l){if("function"==typeof n&&void 0===n.cid){r=!0,a++;var o,d=Is((function(e){var r;((r=e).__esModule||ws&&"Module"===r[Symbol.toStringTag])&&(e=e.default),n.resolved="function"==typeof e?e:Na.extend(e),t.components[l]=e,--a<=0&&i()})),c=Is((function(n){var e="Failed to resolve async component "+l+": "+n;s||(s=ks(n)?n:new Error(e),i(s))}));try{o=n(d,c)}catch(n){c(n)}if(o)if("function"==typeof o.then)o.then(d,c);else{var u=o.component;u&&"function"==typeof u.then&&u.then(d,c)}}})),r||i()}}function Rs(n,e){return Ts(n.map((function(n){return Object.keys(n.components).map((function(t){return e(n.components[t],n.instances[t],n,t)}))})))}function Ts(n){return Array.prototype.concat.apply([],n)}var ws="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function Is(n){var e=!1;return function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];if(!e)return e=!0,n.apply(this,t)}}var As=function(n,e){this.router=n,this.base=function(n){if(!n)if(Ha){var e=document.querySelector("base");n=(n=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else n="/";"/"!==n.charAt(0)&&(n="/"+n);return n.replace(/\/$/,"")}(e),this.current=ma,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function Ls(n,e,t,i){var r=Rs(n,(function(n,i,r,a){var s=function(n,e){"function"!=typeof n&&(n=Na.extend(n));return n.options[e]}(n,e);if(s)return Array.isArray(s)?s.map((function(n){return t(n,i,r,a)})):t(s,i,r,a)}));return Ts(i?r.reverse():r)}function Bs(n,e){if(e)return function(){return n.apply(e,arguments)}}As.prototype.listen=function(n){this.cb=n},As.prototype.onReady=function(n,e){this.ready?n():(this.readyCbs.push(n),e&&this.readyErrorCbs.push(e))},As.prototype.onError=function(n){this.errorCbs.push(n)},As.prototype.transitionTo=function(n,e,t){var i,r=this;try{i=this.router.match(n,this.current)}catch(n){throw this.errorCbs.forEach((function(e){e(n)})),n}var a=this.current;this.confirmTransition(i,(function(){r.updateRoute(i),e&&e(i),r.ensureURL(),r.router.afterHooks.forEach((function(n){n&&n(i,a)})),r.ready||(r.ready=!0,r.readyCbs.forEach((function(n){n(i)})))}),(function(n){t&&t(n),n&&!r.ready&&(_s(n,fs.redirected)&&a===ma||(r.ready=!0,r.readyErrorCbs.forEach((function(e){e(n)}))))}))},As.prototype.confirmTransition=function(n,e,t){var i=this,r=this.current;this.pending=n;var a,s,l=function(n){!_s(n)&&ks(n)&&(i.errorCbs.length?i.errorCbs.forEach((function(e){e(n)})):console.error(n)),t&&t(n)},o=n.matched.length-1,d=r.matched.length-1;if(fa(n,r)&&o===d&&n.matched[o]===r.matched[d])return this.ensureURL(),n.hash&&rs(this.router,r,n,!1),l(((s=ys(a=r,n,fs.duplicated,'Avoided redundant navigation to current location: "'+a.fullPath+'".')).name="NavigationDuplicated",s));var c=function(n,e){var t,i=Math.max(n.length,e.length);for(t=0;t<i&&n[t]===e[t];t++);return{updated:e.slice(0,t),activated:e.slice(t),deactivated:n.slice(t)}}(this.current.matched,n.matched),u=c.updated,p=c.deactivated,m=c.activated,h=[].concat(function(n){return Ls(n,"beforeRouteLeave",Bs,!0)}(p),this.router.beforeHooks,function(n){return Ls(n,"beforeRouteUpdate",Bs)}(u),m.map((function(n){return n.beforeEnter})),Ss(m)),g=function(e,t){if(i.pending!==n)return l(vs(r,n));try{e(n,r,(function(e){!1===e?(i.ensureURL(!0),l(function(n,e){return ys(n,e,fs.aborted,'Navigation aborted from "'+n.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(r,n))):ks(e)?(i.ensureURL(!0),l(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(l(bs(r,n)),"object"==typeof e&&e.replace?i.replace(e):i.push(e)):t(e)}))}catch(n){l(n)}};Es(h,g,(function(){Es(function(n){return Ls(n,"beforeRouteEnter",(function(n,e,t,i){return function(n,e,t){return function(i,r,a){return n(i,r,(function(n){"function"==typeof n&&(e.enteredCbs[t]||(e.enteredCbs[t]=[]),e.enteredCbs[t].push(n)),a(n)}))}}(n,t,i)}))}(m).concat(i.router.resolveHooks),g,(function(){if(i.pending!==n)return l(vs(r,n));i.pending=null,e(n),i.router.app&&i.router.app.$nextTick((function(){va(n)}))}))}))},As.prototype.updateRoute=function(n){this.current=n,this.cb&&this.cb(n)},As.prototype.setupListeners=function(){},As.prototype.teardown=function(){this.listeners.forEach((function(n){n()})),this.listeners=[],this.current=ma,this.pending=null};var Cs=function(n){function e(e,t){n.call(this,e,t),this._startLocation=zs(this.base)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router,t=e.options.scrollBehavior,i=ms&&t;i&&this.listeners.push(is());var r=function(){var t=n.current,r=zs(n.base);n.current===ma&&r===n._startLocation||n.transitionTo(r,(function(n){i&&rs(e,n,t,!0)}))};window.addEventListener("popstate",r),this.listeners.push((function(){window.removeEventListener("popstate",r)}))}},e.prototype.go=function(n){window.history.go(n)},e.prototype.push=function(n,e,t){var i=this,r=this.current;this.transitionTo(n,(function(n){hs(_a(i.base+n.fullPath)),rs(i.router,n,r,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var i=this,r=this.current;this.transitionTo(n,(function(n){gs(_a(i.base+n.fullPath)),rs(i.router,n,r,!1),e&&e(n)}),t)},e.prototype.ensureURL=function(n){if(zs(this.base)!==this.current.fullPath){var e=_a(this.base+this.current.fullPath);n?hs(e):gs(e)}},e.prototype.getCurrentLocation=function(){return zs(this.base)},e}(As);function zs(n){var e=window.location.pathname,t=e.toLowerCase(),i=n.toLowerCase();return!n||t!==i&&0!==t.indexOf(_a(i+"/"))||(e=e.slice(n.length)),(e||"/")+window.location.search+window.location.hash}var Ds=function(n){function e(e,t,i){n.call(this,e,t),i&&function(n){var e=zs(n);if(!/^\/#/.test(e))return window.location.replace(_a(n+"/#"+e)),!0}(this.base)||Ps()}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,t=ms&&e;t&&this.listeners.push(is());var i=function(){var e=n.current;Ps()&&n.transitionTo(Os(),(function(i){t&&rs(n.router,i,e,!0),ms||Us(i.fullPath)}))},r=ms?"popstate":"hashchange";window.addEventListener(r,i),this.listeners.push((function(){window.removeEventListener(r,i)}))}},e.prototype.push=function(n,e,t){var i=this,r=this.current;this.transitionTo(n,(function(n){js(n.fullPath),rs(i.router,n,r,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var i=this,r=this.current;this.transitionTo(n,(function(n){Us(n.fullPath),rs(i.router,n,r,!1),e&&e(n)}),t)},e.prototype.go=function(n){window.history.go(n)},e.prototype.ensureURL=function(n){var e=this.current.fullPath;Os()!==e&&(n?js(e):Us(e))},e.prototype.getCurrentLocation=function(){return Os()},e}(As);function Ps(){var n=Os();return"/"===n.charAt(0)||(Us("/"+n),!1)}function Os(){var n=window.location.href,e=n.indexOf("#");return e<0?"":n=n.slice(e+1)}function Ms(n){var e=window.location.href,t=e.indexOf("#");return(t>=0?e.slice(0,t):e)+"#"+n}function js(n){ms?hs(Ms(n)):window.location.hash=n}function Us(n){ms?gs(Ms(n)):window.location.replace(Ms(n))}var $s=function(n){function e(e,t){n.call(this,e,t),this.stack=[],this.index=-1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.push=function(n,e,t){var i=this;this.transitionTo(n,(function(n){i.stack=i.stack.slice(0,i.index+1).concat(n),i.index++,e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var i=this;this.transitionTo(n,(function(n){i.stack=i.stack.slice(0,i.index).concat(n),e&&e(n)}),t)},e.prototype.go=function(n){var e=this,t=this.index+n;if(!(t<0||t>=this.stack.length)){var i=this.stack[t];this.confirmTransition(i,(function(){var n=e.current;e.index=t,e.updateRoute(i),e.router.afterHooks.forEach((function(e){e&&e(i,n)}))}),(function(n){_s(n,fs.duplicated)&&(e.index=t)}))}},e.prototype.getCurrentLocation=function(){var n=this.stack[this.stack.length-1];return n?n.fullPath:"/"},e.prototype.ensureURL=function(){},e}(As),Fs=function(n){void 0===n&&(n={}),this.app=null,this.apps=[],this.options=n,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=Qa(n.routes||[],this);var e=n.mode||"hash";switch(this.fallback="history"===e&&!ms&&!1!==n.fallback,this.fallback&&(e="hash"),Ha||(e="abstract"),this.mode=e,e){case"history":this.history=new Cs(this,n.base);break;case"hash":this.history=new Ds(this,n.base,this.fallback);break;case"abstract":this.history=new $s(this,n.base);break;default:0}},Ns={currentRoute:{configurable:!0}};Fs.prototype.match=function(n,e,t){return this.matcher.match(n,e,t)},Ns.currentRoute.get=function(){return this.history&&this.history.current},Fs.prototype.init=function(n){var e=this;if(this.apps.push(n),n.$once("hook:destroyed",(function(){var t=e.apps.indexOf(n);t>-1&&e.apps.splice(t,1),e.app===n&&(e.app=e.apps[0]||null),e.app||e.history.teardown()})),!this.app){this.app=n;var t=this.history;if(t instanceof Cs||t instanceof Ds){var i=function(n){t.setupListeners(),function(n){var i=t.current,r=e.options.scrollBehavior;ms&&r&&"fullPath"in n&&rs(e,n,i,!1)}(n)};t.transitionTo(t.getCurrentLocation(),i,i)}t.listen((function(n){e.apps.forEach((function(e){e._route=n}))}))}},Fs.prototype.beforeEach=function(n){return Gs(this.beforeHooks,n)},Fs.prototype.beforeResolve=function(n){return Gs(this.resolveHooks,n)},Fs.prototype.afterEach=function(n){return Gs(this.afterHooks,n)},Fs.prototype.onReady=function(n,e){this.history.onReady(n,e)},Fs.prototype.onError=function(n){this.history.onError(n)},Fs.prototype.push=function(n,e,t){var i=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){i.history.push(n,e,t)}));this.history.push(n,e,t)},Fs.prototype.replace=function(n,e,t){var i=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){i.history.replace(n,e,t)}));this.history.replace(n,e,t)},Fs.prototype.go=function(n){this.history.go(n)},Fs.prototype.back=function(){this.go(-1)},Fs.prototype.forward=function(){this.go(1)},Fs.prototype.getMatchedComponents=function(n){var e=n?n.matched?n:this.resolve(n).route:this.currentRoute;return e?[].concat.apply([],e.matched.map((function(n){return Object.keys(n.components).map((function(e){return n.components[e]}))}))):[]},Fs.prototype.resolve=function(n,e,t){var i=Fa(n,e=e||this.history.current,t,this),r=this.match(i,e),a=r.redirectedFrom||r.fullPath;return{location:i,route:r,href:function(n,e,t){var i="hash"===t?"#"+e:e;return n?_a(n+"/"+i):i}(this.history.base,a,this.mode),normalizedTo:i,resolved:r}},Fs.prototype.getRoutes=function(){return this.matcher.getRoutes()},Fs.prototype.addRoute=function(n,e){this.matcher.addRoute(n,e),this.history.current!==ma&&this.history.transitionTo(this.history.getCurrentLocation())},Fs.prototype.addRoutes=function(n){this.matcher.addRoutes(n),this.history.current!==ma&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(Fs.prototype,Ns);var qs=Fs;function Gs(n,e){return n.push(e),function(){var t=n.indexOf(e);t>-1&&n.splice(t,1)}}Fs.install=function n(e){if(!n.installed||Na!==e){n.installed=!0,Na=e;var t=function(n){return void 0!==n},i=function(n,e){var i=n.$options._parentVnode;t(i)&&t(i=i.data)&&t(i=i.registerRouteInstance)&&i(n,e)};e.mixin({beforeCreate:function(){t(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),e.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,i(this,this)},destroyed:function(){i(this)}}),Object.defineProperty(e.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(e.prototype,"$route",{get:function(){return this._routerRoot._route}}),e.component("RouterView",ya),e.component("RouterLink",Ga);var r=e.config.optionMergeStrategies;r.beforeRouteEnter=r.beforeRouteLeave=r.beforeRouteUpdate=r.created}},Fs.version="3.6.5",Fs.isNavigationFailure=_s,Fs.NavigationFailureType=fs,Fs.START_LOCATION=ma,Ha&&window.Vue&&window.Vue.use(Fs);t(105);t(17),t(132);var Ks={NotFound:()=>Promise.all([t.e(0),t.e(4)]).then(t.bind(null,339)),Layout:()=>Promise.all([t.e(0),t.e(2)]).then(t.bind(null,338))},Hs={"v-6933ae78":()=>t.e(5).then(t.bind(null,340)),"v-6629cfe6":()=>t.e(6).then(t.bind(null,341)),"v-2969cc26":()=>t.e(7).then(t.bind(null,342)),"v-eaab9570":()=>t.e(8).then(t.bind(null,343)),"v-007ca368":()=>t.e(9).then(t.bind(null,344)),"v-36d5ec98":()=>t.e(10).then(t.bind(null,345)),"v-18e88d58":()=>t.e(11).then(t.bind(null,346)),"v-60064de7":()=>t.e(12).then(t.bind(null,347)),"v-179fad57":()=>t.e(13).then(t.bind(null,348)),"v-3fdec0bd":()=>t.e(14).then(t.bind(null,349)),"v-53104ef6":()=>t.e(15).then(t.bind(null,350)),"v-1a9d53e5":()=>t.e(16).then(t.bind(null,351)),"v-150b83f6":()=>t.e(17).then(t.bind(null,352)),"v-517069f0":()=>t.e(18).then(t.bind(null,353)),"v-74cfb0b2":()=>t.e(19).then(t.bind(null,354)),"v-a113e2c4":()=>t.e(20).then(t.bind(null,355)),"v-6962c4c2":()=>t.e(21).then(t.bind(null,356)),"v-a6ed5612":()=>t.e(22).then(t.bind(null,357)),"v-2778bd58":()=>t.e(23).then(t.bind(null,358)),"v-31581127":()=>t.e(24).then(t.bind(null,359)),"v-c2ced796":()=>t.e(25).then(t.bind(null,360)),"v-3fe17966":()=>t.e(26).then(t.bind(null,361)),"v-0b361225":()=>t.e(27).then(t.bind(null,362)),"v-68306418":()=>t.e(28).then(t.bind(null,363)),"v-6c981036":()=>t.e(29).then(t.bind(null,364)),"v-1a140cfc":()=>t.e(30).then(t.bind(null,365)),"v-29b8baff":()=>t.e(31).then(t.bind(null,366)),"v-2a85a268":()=>t.e(32).then(t.bind(null,367)),"v-ad649dc2":()=>t.e(33).then(t.bind(null,368)),"v-3aa5fefb":()=>t.e(34).then(t.bind(null,369)),"v-35ef0b3a":()=>t.e(35).then(t.bind(null,370)),"v-2f859720":()=>t.e(36).then(t.bind(null,371)),"v-3622e3e6":()=>t.e(37).then(t.bind(null,372)),"v-c6d294b8":()=>t.e(38).then(t.bind(null,373)),"v-aa603976":()=>t.e(39).then(t.bind(null,374)),"v-1823a466":()=>t.e(40).then(t.bind(null,375)),"v-55200187":()=>t.e(41).then(t.bind(null,376)),"v-66f73835":()=>t.e(42).then(t.bind(null,377)),"v-7482ba20":()=>t.e(43).then(t.bind(null,378)),"v-2c529f3a":()=>t.e(44).then(t.bind(null,379)),"v-76fe5474":()=>t.e(45).then(t.bind(null,380)),"v-24aa3866":()=>t.e(46).then(t.bind(null,381)),"v-18bc1557":()=>t.e(47).then(t.bind(null,382)),"v-4fda8213":()=>t.e(48).then(t.bind(null,383)),"v-c45fcee4":()=>t.e(49).then(t.bind(null,384)),"v-e36601e4":()=>t.e(50).then(t.bind(null,385)),"v-1ae0a658":()=>t.e(51).then(t.bind(null,386)),"v-97c51d34":()=>t.e(52).then(t.bind(null,387)),"v-02285212":()=>t.e(53).then(t.bind(null,388)),"v-2bcd0941":()=>t.e(54).then(t.bind(null,389)),"v-6e3c4c48":()=>t.e(55).then(t.bind(null,390)),"v-2d5f867f":()=>t.e(56).then(t.bind(null,391)),"v-7a34202e":()=>t.e(57).then(t.bind(null,392)),"v-ac009106":()=>t.e(58).then(t.bind(null,393)),"v-31ed6925":()=>t.e(59).then(t.bind(null,394)),"v-45526b4e":()=>t.e(60).then(t.bind(null,395)),"v-11669a46":()=>t.e(61).then(t.bind(null,396)),"v-2c0bb97b":()=>t.e(62).then(t.bind(null,397)),"v-43f0e09d":()=>t.e(63).then(t.bind(null,398)),"v-2b382624":()=>t.e(64).then(t.bind(null,399)),"v-36c9cb62":()=>t.e(65).then(t.bind(null,400)),"v-7e68add3":()=>t.e(66).then(t.bind(null,401)),"v-087079a8":()=>t.e(67).then(t.bind(null,402)),"v-b1a79552":()=>t.e(68).then(t.bind(null,403)),"v-433c42bb":()=>t.e(69).then(t.bind(null,404)),"v-4f80c998":()=>t.e(70).then(t.bind(null,405)),"v-3161e9d4":()=>t.e(71).then(t.bind(null,406)),"v-78a8ae4e":()=>t.e(72).then(t.bind(null,407)),"v-147908a9":()=>t.e(73).then(t.bind(null,408)),"v-f49e53d6":()=>t.e(74).then(t.bind(null,409)),"v-00a73f02":()=>t.e(75).then(t.bind(null,410)),"v-cafc5bfe":()=>t.e(76).then(t.bind(null,411)),"v-53b20642":()=>t.e(77).then(t.bind(null,412)),"v-623e7b3d":()=>t.e(78).then(t.bind(null,413)),"v-551cf7ff":()=>t.e(79).then(t.bind(null,414))};function Js(n){const e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}const Vs=/-(\w)/g,Qs=Js(n=>n.replace(Vs,(n,e)=>e?e.toUpperCase():"")),Xs=/\B([A-Z])/g,Ws=Js(n=>n.replace(Xs,"-$1").toLowerCase()),Ys=Js(n=>n.charAt(0).toUpperCase()+n.slice(1));function Zs(n,e){if(!e)return;if(n(e))return n(e);return e.includes("-")?n(Ys(Qs(e))):n(Ys(e))||n(Ws(e))}const nl=Object.assign({},Ks,Hs),el=n=>nl[n],tl=n=>Hs[n],il=n=>Ks[n],rl=n=>Ht.component(n);function al(n){return Zs(tl,n)}function sl(n){return Zs(il,n)}function ll(n){return Zs(el,n)}function ol(n){return Zs(rl,n)}function dl(...n){return Promise.all(n.filter(n=>n).map(async n=>{if(!ol(n)&&ll(n)){const e=await ll(n)();Ht.component(n,e.default)}}))}function cl(n,e){"undefined"!=typeof window&&window.__VUEPRESS__&&(window.__VUEPRESS__[n]=e)}var ul=t(93),pl=t.n(ul),ml=t(94),hl=t.n(ml),gl={created(){if(this.siteMeta=this.$site.headTags.filter(([n])=>"meta"===n).map(([n,e])=>e),this.$ssrContext){const e=this.getMergedMetaTags();this.$ssrContext.title=this.$title,this.$ssrContext.lang=this.$lang,this.$ssrContext.pageMeta=(n=e)?n.map(n=>{let e="<meta";return Object.keys(n).forEach(t=>{e+=` ${t}="${hl()(n[t])}"`}),e+">"}).join("\n    "):"",this.$ssrContext.canonicalLink=bl(this.$canonicalUrl)}var n},mounted(){this.currentMetaTags=[...document.querySelectorAll("meta")],this.updateMeta(),this.updateCanonicalLink()},methods:{updateMeta(){document.title=this.$title,document.documentElement.lang=this.$lang;const n=this.getMergedMetaTags();this.currentMetaTags=vl(n,this.currentMetaTags)},getMergedMetaTags(){const n=this.$page.frontmatter.meta||[];return pl()([{name:"description",content:this.$description}],n,this.siteMeta,yl)},updateCanonicalLink(){fl(),this.$canonicalUrl&&document.head.insertAdjacentHTML("beforeend",bl(this.$canonicalUrl))}},watch:{$page(){this.updateMeta(),this.updateCanonicalLink()}},beforeDestroy(){vl(null,this.currentMetaTags),fl()}};function fl(){const n=document.querySelector("link[rel='canonical']");n&&n.remove()}function bl(n=""){return n?`<link href="${n}" rel="canonical" />`:""}function vl(n,e){if(e&&[...e].filter(n=>n.parentNode===document.head).forEach(n=>document.head.removeChild(n)),n)return n.map(n=>{const e=document.createElement("meta");return Object.keys(n).forEach(t=>{e.setAttribute(t,n[t])}),document.head.appendChild(e),e})}function yl(n){for(const e of["name","property","itemprop"])if(n.hasOwnProperty(e))return n[e]+e;return JSON.stringify(n)}var xl=t(51),kl={mounted(){window.addEventListener("scroll",this.onScroll)},methods:{onScroll:t.n(xl)()((function(){this.setActiveHash()}),300),setActiveHash(){const n=[].slice.call(document.querySelectorAll(".sidebar-link")),e=[].slice.call(document.querySelectorAll(".header-anchor")).filter(e=>n.some(n=>n.hash===e.hash)),t=Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop),i=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),r=window.innerHeight+t;for(let n=0;n<e.length;n++){const a=e[n],s=e[n+1],l=0===n&&0===t||t>=a.parentElement.offsetTop+10&&(!s||t<s.parentElement.offsetTop-10),o=decodeURIComponent(this.$route.hash);if(l&&o!==decodeURIComponent(a.hash)){const t=a;if(r===i)for(let t=n+1;t<e.length;t++)if(o===decodeURIComponent(e[t].hash))return;return this.$vuepress.$set("disableScrollBehavior",!0),void this.$router.replace(decodeURIComponent(t.hash),()=>{this.$nextTick(()=>{this.$vuepress.$set("disableScrollBehavior",!1)})})}}}},beforeDestroy(){window.removeEventListener("scroll",this.onScroll)}},_l=t(26),El=t.n(_l),Sl={mounted(){El.a.configure({showSpinner:!1}),this.$router.beforeEach((n,e,t)=>{n.path===e.path||Ht.component(n.name)||El.a.start(),t()}),this.$router.afterEach(()=>{El.a.done(),this.isSidebarOpen=!1})}};t(241),t(242);class Rl{constructor(){this.containerEl=document.getElementById("message-container"),this.containerEl||(this.containerEl=document.createElement("div"),this.containerEl.id="message-container",document.body.appendChild(this.containerEl))}show({text:n="",duration:e=3e3}){let t=document.createElement("div");t.className="message move-in",t.innerHTML=`\n      <i style="fill: #06a35a;font-size: 14px;display:inline-flex;align-items: center;">\n        <svg style="fill: #06a35a;font-size: 14px;" t="1572421810237" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2323" width="16" height="16"><path d="M822.811993 824.617989c-83.075838 81.99224-188.546032 124.613757-316.049383 127.86455-122.085362-3.250794-223.943563-45.87231-305.935802-127.86455s-124.613757-184.21164-127.86455-305.935802c3.250794-127.503351 45.87231-232.973545 127.86455-316.049383 81.99224-83.075838 184.21164-126.058554 305.935802-129.309347 127.503351 3.250794 232.973545 46.23351 316.049383 129.309347 83.075838 83.075838 126.058554 188.546032 129.309347 316.049383C949.231746 640.406349 905.887831 742.62575 822.811993 824.617989zM432.716755 684.111464c3.973192 3.973192 8.307584 5.779189 13.364374 6.140388 5.05679 0.361199 9.752381-1.444797 13.364374-5.417989l292.571429-287.514638c3.973192-3.973192 5.779189-8.307584 5.779189-13.364374 0-5.05679-1.805996-9.752381-5.779189-13.364374l1.805996 1.805996c-3.973192-3.973192-8.668783-5.779189-14.086772-6.140388-5.417989-0.361199-10.47478 1.444797-14.809171 5.417989l-264.397884 220.33157c-3.973192 3.250794-8.668783 4.695591-14.447972 4.695591-5.779189 0-10.835979-1.444797-15.53157-3.973192l-94.273016-72.962257c-4.334392-3.250794-9.391182-4.334392-14.447972-3.973192s-9.391182 3.250794-12.641975 7.585185l-2.889594 3.973192c-3.250794 4.334392-4.334392 9.391182-3.973192 14.809171 0.722399 5.417989 2.528395 10.11358 5.779189 14.086772L432.716755 684.111464z" p-id="2324"></path></svg>\n      </i>\n      <div class="text">${n}</div>\n    `,this.containerEl.appendChild(t),e>0&&setTimeout(()=>{this.close(t)},e)}close(n){n.className=n.className.replace("move-in",""),n.className+="move-out",n.addEventListener("animationend",()=>{n.remove()})}}var Tl={mounted(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},updated(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},methods:{updateCopy(){setTimeout(()=>{(['div[class*="language-"] pre','div[class*="aside-code"] aside']instanceof Array||Array.isArray(['div[class*="language-"] pre','div[class*="aside-code"] aside']))&&['div[class*="language-"] pre','div[class*="aside-code"] aside'].forEach(n=>{document.querySelectorAll(n).forEach(this.generateCopyButton)})},1e3)},generateCopyButton(n){if(n.classList.contains("codecopy-enabled"))return;const e=document.createElement("i");e.className="code-copy",e.innerHTML='<svg  style="color:#aaa;font-size:14px" t="1572422231464" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3201" width="14" height="14"><path d="M866.461538 39.384615H354.461538c-43.323077 0-78.769231 35.446154-78.76923 78.769231v39.384616h472.615384c43.323077 0 78.769231 35.446154 78.769231 78.76923v551.384616h39.384615c43.323077 0 78.769231-35.446154 78.769231-78.769231V118.153846c0-43.323077-35.446154-78.769231-78.769231-78.769231z m-118.153846 275.692308c0-43.323077-35.446154-78.769231-78.76923-78.769231H157.538462c-43.323077 0-78.769231 35.446154-78.769231 78.769231v590.769231c0 43.323077 35.446154 78.769231 78.769231 78.769231h512c43.323077 0 78.769231-35.446154 78.76923-78.769231V315.076923z m-354.461538 137.846154c0 11.815385-7.876923 19.692308-19.692308 19.692308h-157.538461c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h157.538461c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z m157.538461 315.076923c0 11.815385-7.876923 19.692308-19.692307 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h315.076923c11.815385 0 19.692308 7.876923 19.692307 19.692308v39.384615z m78.769231-157.538462c0 11.815385-7.876923 19.692308-19.692308 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h393.846153c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z" p-id="3202"></path></svg>',e.title="Copy to clipboard",e.addEventListener("click",()=>{this.copyToClipboard(n.innerText)}),n.appendChild(e),n.classList.add("codecopy-enabled")},copyToClipboard(n){const e=document.createElement("textarea");e.value=n,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e);const t=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);e.select(),document.execCommand("copy");(new Rl).show({text:"å¤å¶æå",duration:1e3}),document.body.removeChild(e),t&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(t))}}};!function(n,e){void 0===e&&(e={});var t=e.insertAt;if(n&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===t&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}("@media (max-width: 1000px) {\n  .vuepress-plugin-demo-block__h_code {\n    display: none;\n  }\n  .vuepress-plugin-demo-block__app {\n    margin-left: auto !important;\n    margin-right: auto !important;\n  }\n}\n.vuepress-plugin-demo-block__wrapper {\n  margin-top: 10px;\n  border: 1px solid #ebebeb;\n  border-radius: 4px;\n  transition: all 0.2s;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display {\n  height: 400px;\n  display: flex;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__app {\n  width: 300px;\n  border: 1px solid #ebebeb;\n  box-shadow: 1px 1px 3px #ebebeb;\n  margin-right: 5px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code {\n  flex: 1;\n  overflow: auto;\n  height: 100%;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code > pre {\n  overflow: visible;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  max-height: 400px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper div {\n  box-sizing: border-box;\n}\n.vuepress-plugin-demo-block__wrapper:hover {\n  box-shadow: 0 0 11px rgba(33, 33, 33, 0.2);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code {\n  overflow: hidden;\n  height: 0;\n  padding: 0 !important;\n  background-color: #282c34;\n  border-radius: 0 !important;\n  transition: height 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code pre {\n  margin: 0 !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  padding: 20px;\n  border-bottom: 1px solid #ebebeb;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer {\n  position: relative;\n  text-align: center;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__codepen {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__expand::before {\n  border-top: none;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid #ccc;\n  border-left: 6px solid transparent;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__codepen,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand span,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand::before {\n  border-top-color: #3eaf7c !important;\n  border-bottom-color: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover svg {\n  fill: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand-text {\n  transition: all 0.5s;\n  opacity: 0;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:nth-last-child(2) {\n  right: 50px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:last-child {\n  right: 10px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button {\n  border-color: transparent;\n  background-color: transparent;\n  font-size: 14px;\n  color: #3eaf7c;\n  cursor: pointer;\n  outline: none;\n  margin: 0;\n  width: 46px;\n  position: relative;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::before {\n  content: attr(data-tip);\n  white-space: nowrap;\n  position: absolute;\n  top: -30px;\n  left: 50%;\n  color: #eee;\n  line-height: 1;\n  z-index: 1000;\n  border-radius: 4px;\n  padding: 6px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  background-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::after {\n  content: '' !important;\n  display: block;\n  position: absolute;\n  left: 50%;\n  top: -5px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  border: 5px solid transparent;\n  border-top-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button svg {\n  width: 34px;\n  height: 20px;\n  fill: #ccc;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__codepen {\n  position: absolute;\n  top: 10px;\n  transition: all 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand {\n  position: relative;\n  width: 100px;\n  height: 40px;\n  margin: 0;\n  color: #3eaf7c;\n  font-size: 14px;\n  background-color: transparent;\n  border-color: transparent;\n  outline: none;\n  transition: all 0.5s;\n  cursor: pointer;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand::before {\n  content: \"\";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 0;\n  height: 0;\n  border-top: 6px solid #ccc;\n  border-right: 6px solid transparent;\n  border-left: 6px solid transparent;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n");var wl={jsLib:[],cssLib:[],jsfiddle:!0,codepen:!0,codepenLayout:"left",codepenJsProcessor:"babel",codepenEditors:"101",horizontal:!1,vue:"https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js",react:"https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js",reactDOM:"https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"},Il={},Al=function(n){return'<div id="app">\n'.concat(n,"\n</div>")},Ll=function(n){return window.$VUEPRESS_DEMO_BLOCK&&void 0!==window.$VUEPRESS_DEMO_BLOCK[n]?window.$VUEPRESS_DEMO_BLOCK[n]:wl[n]},Bl=function n(e,t,i){var r=document.createElement(e);return t&&Object.keys(t).forEach((function(n){if(n.indexOf("data"))r[n]=t[n];else{var e=n.replace("data","");r.dataset[e]=t[n]}})),i&&i.forEach((function(e){var t=e.tag,i=e.attrs,a=e.children;r.appendChild(n(t,i,a))})),r},Cl=function(n,e,t){var i,r=(i=n.querySelectorAll(".".concat(e)),Array.prototype.slice.call(i));return 1!==r.length||t?r:r[0]},zl=function(n,e){var t,i,r=n.match(/<style>([\s\S]+)<\/style>/),a=n.match(/<template>([\s\S]+)<\/template>/),s=n.match(/<script>([\s\S]+)<\/script>/),l={css:r&&r[1].replace(/^\n|\n$/g,""),html:a&&a[1].replace(/^\n|\n$/g,""),js:s&&s[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};l.htmlTpl=Al(l.html),l.jsTpl=(t=l.js,i=t.replace(/export\s+default\s*?\{\n*/,"").replace(/\n*\}\s*$/,"").trim(),"new Vue({\n  el: '#app',\n  ".concat(i,"\n})")),l.script=function(n,e){var t=n.split(/export\s+default/),i="(function() {".concat(t[0]," ; return ").concat(t[1],"})()"),r=window.Babel?window.Babel.transform(i,{presets:["es2015"]}).code:i,a=[eval][0](r);return a.template=e,a}(l.js,l.html);var o=Ll("vue");return l.jsLib.unshift(o),l},Dl=function(n,e){var t,i=n.match(/<style>([\s\S]+)<\/style>/),r=n.match(/<html>([\s\S]+)<\/html>/),a=n.match(/<script>([\s\S]+)<\/script>/),s={css:i&&i[1].replace(/^\n|\n$/g,""),html:r&&r[1].replace(/^\n|\n$/g,""),js:a&&a[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};return s.htmlTpl=s.html,s.jsTpl=s.js,s.script=(t=s.js,window.Babel?window.Babel.transform(t,{presets:["es2015"]}).code:t),s},Pl=function(n){return n=n.replace("export default ","").replace(/App\.__style__(\s*)=(\s*)`([\s\S]*)?`/,""),n+='ReactDOM.render(React.createElement(App), document.getElementById("app"))'};function Ol(){var n=Cl(document,"vuepress-plugin-demo-block__wrapper",!0);n.length?n.forEach((function(n){if("true"!==n.dataset.created){n.style.display="block";var e=Cl(n,"vuepress-plugin-demo-block__code"),t=Cl(n,"vuepress-plugin-demo-block__display"),i=Cl(n,"vuepress-plugin-demo-block__footer"),r=Cl(t,"vuepress-plugin-demo-block__app"),a=decodeURIComponent(n.dataset.code),s=decodeURIComponent(n.dataset.config),l=decodeURIComponent(n.dataset.type);s=s?JSON.parse(s):{};var o=e.querySelector("div").clientHeight,d="react"===l?function(n,e){var t=(0,window.Babel.transform)(n,{presets:["es2015","react"]}).code,i="(function(exports){var module={};module.exports=exports;".concat(t,";return module.exports.__esModule?module.exports.default:module.exports;})({})"),r=new Function("return ".concat(i))(),a={js:r,css:r.__style__||"",jsLib:e.jsLib||[],cssLib:e.cssLib||[],jsTpl:Pl(n),htmlTpl:Al("")},s=Ll("react"),l=Ll("reactDOM");return a.jsLib.unshift(s,l),a}(a,s):"vanilla"===l?Dl(a,s):zl(a,s),c=Bl("button",{className:"".concat("vuepress-plugin-demo-block__expand")});if(i.appendChild(c),c.addEventListener("click",Ml.bind(null,c,o,e,i)),Ll("jsfiddle")&&i.appendChild(function(n){var e=n.css,t=n.htmlTpl,i=n.jsTpl,r=n.jsLib,a=n.cssLib,s=r.concat(a).concat(Ll("cssLib")).concat(Ll("jsLib")).join(",");return Bl("form",{className:"vuepress-plugin-demo-block__jsfiddle",target:"_blank",action:"https://jsfiddle.net/api/post/library/pure/",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"css",value:e}},{tag:"input",attrs:{type:"hidden",name:"html",value:t}},{tag:"input",attrs:{type:"hidden",name:"js",value:i}},{tag:"input",attrs:{type:"hidden",name:"panel_js",value:3}},{tag:"input",attrs:{type:"hidden",name:"wrap",value:1}},{tag:"input",attrs:{type:"hidden",name:"resources",value:s}},{tag:"button",attrs:{type:"submit",className:"vuepress-plugin-demo-block__button",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088289967" class="icon" style="" viewBox="0 0 1170 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1952" xmlns:xlink="http://www.w3.org/1999/xlink" width="228.515625" height="200"><defs><style type="text/css"></style></defs><path d="M1028.571429 441.142857q63.428571 26.285714 102.571428 83.142857T1170.285714 650.857143q0 93.714286-67.428571 160.285714T940 877.714286q-2.285714 0-6.571429-0.285715t-6-0.285714H232q-97.142857-5.714286-164.571429-71.714286T0 645.142857q0-62.857143 31.428571-116t84-84q-6.857143-22.285714-6.857142-46.857143 0-65.714286 46.857142-112t113.714286-46.285714q54.285714 0 98.285714 33.142857 42.857143-88 127.142858-141.714286t186.571428-53.714285q94.857143 0 174.857143 46T982.571429 248.571429t46.571428 172q0 3.428571-0.285714 10.285714t-0.285714 10.285714zM267.428571 593.142857q0 69.714286 48 110.285714t118.857143 40.571429q78.285714 0 137.142857-56.571429-9.142857-11.428571-27.142857-32.285714T519.428571 626.285714q-38.285714 37.142857-82.285714 37.142857-31.428571 0-53.428571-19.142857T361.714286 594.285714q0-30.285714 22-49.714285t52.285714-19.428572q25.142857 0 48.285714 12t41.714286 31.428572 37.142857 42.857142 39.428572 46.857143 44 42.857143 55.428571 31.428572 69.428571 12q69.142857 0 116.857143-40.857143T936 594.857143q0-69.142857-48-109.714286t-118.285714-40.571428q-81.714286 0-137.714286 55.428571l53.142857 61.714286q37.714286-36.571429 81.142857-36.571429 29.714286 0 52.571429 18.857143t22.857143 48q0 32.571429-21.142857 52.285714t-53.714286 19.714286q-24.571429 0-47.142857-12t-41.142857-31.428571-37.428572-42.857143-39.714286-46.857143-44.285714-42.857143-55.142857-31.428571T434.285714 444.571429q-69.714286 0-118.285714 40.285714T267.428571 593.142857z" p-id="1953"></path></svg>',datatip:"JSFiddle"}}])}(d)),Ll("codepen")&&i.appendChild(function(n){var e=n.css,t=n.htmlTpl,i=n.jsTpl,r=n.jsLib,a=n.cssLib,s=JSON.stringify({css:e,html:t,js:i,js_external:r.concat(Ll("jsLib")).join(";"),css_external:a.concat(Ll("cssLib")).join(";"),layout:Ll("codepenLayout"),js_pre_processor:Ll("codepenJsProcessor"),editors:Ll("codepenEditors")});return Bl("form",{className:"vuepress-plugin-demo-block__codepen",target:"_blank",action:"https://codepen.io/pen/define",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"data",value:s}},{tag:"button",attrs:{type:"submit",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088271207" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1737" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M123.428571 668l344.571429 229.714286v-205.142857L277.142857 565.142857z m-35.428571-82.285714l110.285714-73.714286-110.285714-73.714286v147.428572z m468 312l344.571429-229.714286-153.714286-102.857143-190.857143 127.428572v205.142857z m-44-281.714286l155.428571-104-155.428571-104-155.428571 104zM277.142857 458.857143l190.857143-127.428572V126.285714L123.428571 356z m548.571429 53.142857l110.285714 73.714286V438.285714z m-78.857143-53.142857l153.714286-102.857143-344.571429-229.714286v205.142857z m277.142857-102.857143v312q0 23.428571-19.428571 36.571429l-468 312q-12 7.428571-24.571429 7.428571t-24.571429-7.428571L19.428571 704.571429q-19.428571-13.142857-19.428571-36.571429V356q0-23.428571 19.428571-36.571429L487.428571 7.428571q12-7.428571 24.571429-7.428571t24.571429 7.428571l468 312q19.428571 13.142857 19.428571 36.571429z" p-id="1738"></path></svg>',className:"vuepress-plugin-demo-block__button",datatip:"Codepen"}}])}(d)),void 0!==s.horizontal?s.horizontal:Ll("horizontal")){n.classList.add("vuepress-plugin-demo-block__horizontal");var u=e.firstChild.cloneNode(!0);u.classList.add("vuepress-plugin-demo-block__h_code"),t.appendChild(u)}if(d.css&&function(n){if(!Il[n]){var e=Bl("style",{innerHTML:n});document.body.appendChild(e),Il[n]=!0}}(d.css),"react"===l)ReactDOM.render(React.createElement(d.js),r);else if("vue"===l){var p=(new(Vue.extend(d.script))).$mount();r.appendChild(p.$el)}else"vanilla"===l&&(r.innerHTML=d.html,new Function("return (function(){".concat(d.script,"})()"))());n.dataset.created="true"}})):setTimeout((function(n){Ol()}),300)}function Ml(n,e,t,i){var r="1"!==n.dataset.isExpand;t.style.height=r?"".concat(e,"px"):0,r?i.classList.add("vuepress-plugin-demo-block__show-link"):i.classList.remove("vuepress-plugin-demo-block__show-link"),n.dataset.isExpand=r?"1":"0"}var jl={mounted:function(){window.$VUEPRESS_DEMO_BLOCK={jsfiddle:!1,codepen:!0,horizontal:!1},Ol()},updated:function(){Ol()}},Ul="auto",$l="zoom-in",Fl="zoom-out",Nl="grab",ql="move";function Gl(n,e,t){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r={passive:!1};i?n.addEventListener(e,t,r):n.removeEventListener(e,t,r)}function Kl(n,e){if(n){var t=new Image;t.onload=function(){e&&e(t)},t.src=n}}function Hl(n){return n.dataset.original?n.dataset.original:"A"===n.parentNode.tagName?n.parentNode.getAttribute("href"):null}function Jl(n,e,t){!function(n){var e=Vl,t=Ql;if(n.transition){var i=n.transition;delete n.transition,n[e]=i}if(n.transform){var r=n.transform;delete n.transform,n[t]=r}}(e);var i=n.style,r={};for(var a in e)t&&(r[a]=i[a]||""),i[a]=e[a];return r}var Vl="transition",Ql="transform",Xl="transform",Wl="transitionend";var Yl=function(){},Zl={enableGrab:!0,preloadImage:!1,closeOnWindowResize:!0,transitionDuration:.4,transitionTimingFunction:"cubic-bezier(0.4, 0, 0, 1)",bgColor:"rgb(255, 255, 255)",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,zIndex:998,customSize:null,onOpen:Yl,onClose:Yl,onGrab:Yl,onMove:Yl,onRelease:Yl,onBeforeOpen:Yl,onBeforeClose:Yl,onBeforeGrab:Yl,onBeforeRelease:Yl,onImageLoading:Yl,onImageLoaded:Yl},no={init:function(n){var e,t;e=this,t=n,Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(n){e[n]=e[n].bind(t)}))},click:function(n){if(n.preventDefault(),to(n))return window.open(this.target.srcOriginal||n.currentTarget.src,"_blank");this.shown?this.released?this.close():this.release():this.open(n.currentTarget)},scroll:function(){var n=document.documentElement||document.body.parentNode||document.body,e=window.pageXOffset||n.scrollLeft,t=window.pageYOffset||n.scrollTop;null===this.lastScrollPosition&&(this.lastScrollPosition={x:e,y:t});var i=this.lastScrollPosition.x-e,r=this.lastScrollPosition.y-t,a=this.options.scrollThreshold;(Math.abs(r)>=a||Math.abs(i)>=a)&&(this.lastScrollPosition=null,this.close())},keydown:function(n){(function(n){return"Escape"===(n.key||n.code)||27===n.keyCode})(n)&&(this.released?this.close():this.release(this.close))},mousedown:function(n){if(eo(n)&&!to(n)){n.preventDefault();var e=n.clientX,t=n.clientY;this.pressTimer=setTimeout(function(){this.grab(e,t)}.bind(this),200)}},mousemove:function(n){this.released||this.move(n.clientX,n.clientY)},mouseup:function(n){eo(n)&&!to(n)&&(clearTimeout(this.pressTimer),this.released?this.close():this.release())},touchstart:function(n){n.preventDefault();var e=n.touches[0],t=e.clientX,i=e.clientY;this.pressTimer=setTimeout(function(){this.grab(t,i)}.bind(this),200)},touchmove:function(n){if(!this.released){var e=n.touches[0],t=e.clientX,i=e.clientY;this.move(t,i)}},touchend:function(n){(function(n){n.targetTouches.length})(n)||(clearTimeout(this.pressTimer),this.released?this.close():this.release())},clickOverlay:function(){this.close()},resizeWindow:function(){this.close()}};function eo(n){return 0===n.button}function to(n){return n.metaKey||n.ctrlKey}var io={init:function(n){this.el=document.createElement("div"),this.instance=n,this.parent=document.body,Jl(this.el,{position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0}),this.updateStyle(n.options),Gl(this.el,"click",n.handler.clickOverlay.bind(n))},updateStyle:function(n){Jl(this.el,{zIndex:n.zIndex,backgroundColor:n.bgColor,transition:"opacity\n        "+n.transitionDuration+"s\n        "+n.transitionTimingFunction})},insert:function(){this.parent.appendChild(this.el)},remove:function(){this.parent.removeChild(this.el)},fadeIn:function(){this.el.offsetWidth,this.el.style.opacity=this.instance.options.bgOpacity},fadeOut:function(){this.el.style.opacity=0}},ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ao=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),so=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},lo={init:function(n,e){this.el=n,this.instance=e,this.srcThumbnail=this.el.getAttribute("src"),this.srcset=this.el.getAttribute("srcset"),this.srcOriginal=Hl(this.el),this.rect=this.el.getBoundingClientRect(),this.translate=null,this.scale=null,this.styleOpen=null,this.styleClose=null},zoomIn:function(){var n=this.instance.options,e=n.zIndex,t=n.enableGrab,i=n.transitionDuration,r=n.transitionTimingFunction;this.translate=this.calculateTranslate(),this.scale=this.calculateScale(),this.styleOpen={position:"relative",zIndex:e+1,cursor:t?Nl:Fl,transition:Xl+"\n        "+i+"s\n        "+r,transform:"translate3d("+this.translate.x+"px, "+this.translate.y+"px, 0px)\n        scale("+this.scale.x+","+this.scale.y+")",height:this.rect.height+"px",width:this.rect.width+"px"},this.el.offsetWidth,this.styleClose=Jl(this.el,this.styleOpen,!0)},zoomOut:function(){this.el.offsetWidth,Jl(this.el,{transform:"none"})},grab:function(n,e,t){var i=oo(),r=i.x-n,a=i.y-e;Jl(this.el,{cursor:ql,transform:"translate3d(\n        "+(this.translate.x+r)+"px, "+(this.translate.y+a)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},move:function(n,e,t){var i=oo(),r=i.x-n,a=i.y-e;Jl(this.el,{transition:Xl,transform:"translate3d(\n        "+(this.translate.x+r)+"px, "+(this.translate.y+a)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},restoreCloseStyle:function(){Jl(this.el,this.styleClose)},restoreOpenStyle:function(){Jl(this.el,this.styleOpen)},upgradeSource:function(){if(this.srcOriginal){var n=this.el.parentNode;this.srcset&&this.el.removeAttribute("srcset");var e=this.el.cloneNode(!1);e.setAttribute("src",this.srcOriginal),e.style.position="fixed",e.style.visibility="hidden",n.appendChild(e),setTimeout(function(){this.el.setAttribute("src",this.srcOriginal),n.removeChild(e)}.bind(this),50)}},downgradeSource:function(){this.srcOriginal&&(this.srcset&&this.el.setAttribute("srcset",this.srcset),this.el.setAttribute("src",this.srcThumbnail))},calculateTranslate:function(){var n=oo(),e=this.rect.left+this.rect.width/2,t=this.rect.top+this.rect.height/2;return{x:n.x-e,y:n.y-t}},calculateScale:function(){var n=this.el.dataset,e=n.zoomingHeight,t=n.zoomingWidth,i=this.instance.options,r=i.customSize,a=i.scaleBase;if(!r&&e&&t)return{x:t/this.rect.width,y:e/this.rect.height};if(r&&"object"===(void 0===r?"undefined":ro(r)))return{x:r.width/this.rect.width,y:r.height/this.rect.height};var s=this.rect.width/2,l=this.rect.height/2,o=oo(),d={x:o.x-s,y:o.y-l},c=d.x/s,u=d.y/l,p=a+Math.min(c,u);if(r&&"string"==typeof r){var m=t||this.el.naturalWidth,h=e||this.el.naturalHeight,g=parseFloat(r)*m/(100*this.rect.width),f=parseFloat(r)*h/(100*this.rect.height);if(p>g||p>f)return{x:g,y:f}}return{x:p,y:p}}};function oo(){var n=document.documentElement;return{x:Math.min(n.clientWidth,window.innerWidth)/2,y:Math.min(n.clientHeight,window.innerHeight)/2}}function co(n,e,t){["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"].forEach((function(i){Gl(n,i,e[i],t)}))}var uo=function(){function n(e){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.target=Object.create(lo),this.overlay=Object.create(io),this.handler=Object.create(no),this.body=document.body,this.shown=!1,this.lock=!1,this.released=!0,this.lastScrollPosition=null,this.pressTimer=null,this.options=so({},Zl,e),this.overlay.init(this),this.handler.init(this)}return ao(n,[{key:"listen",value:function(n){if("string"==typeof n)for(var e=document.querySelectorAll(n),t=e.length;t--;)this.listen(e[t]);else"IMG"===n.tagName&&(n.style.cursor=$l,Gl(n,"click",this.handler.click),this.options.preloadImage&&Kl(Hl(n)));return this}},{key:"config",value:function(n){return n?(so(this.options,n),this.overlay.updateStyle(this.options),this):this.options}},{key:"open",value:function(n){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.onOpen;if(!this.shown&&!this.lock){var i="string"==typeof n?document.querySelector(n):n;if("IMG"===i.tagName){if(this.options.onBeforeOpen(i),this.target.init(i,this),!this.options.preloadImage){var r=this.target.srcOriginal;null!=r&&(this.options.onImageLoading(i),Kl(r,this.options.onImageLoaded))}this.shown=!0,this.lock=!0,this.target.zoomIn(),this.overlay.insert(),this.overlay.fadeIn(),Gl(document,"scroll",this.handler.scroll),Gl(document,"keydown",this.handler.keydown),this.options.closeOnWindowResize&&Gl(window,"resize",this.handler.resizeWindow);var a=function n(){Gl(i,Wl,n,!1),e.lock=!1,e.target.upgradeSource(),e.options.enableGrab&&co(document,e.handler,!0),t(i)};return Gl(i,Wl,a),this}}}},{key:"close",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onClose;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeClose(t),this.lock=!0,this.body.style.cursor=Ul,this.overlay.fadeOut(),this.target.zoomOut(),Gl(document,"scroll",this.handler.scroll,!1),Gl(document,"keydown",this.handler.keydown,!1),this.options.closeOnWindowResize&&Gl(window,"resize",this.handler.resizeWindow,!1);var i=function i(){Gl(t,Wl,i,!1),n.shown=!1,n.lock=!1,n.target.downgradeSource(),n.options.enableGrab&&co(document,n.handler,!1),n.target.restoreCloseStyle(),n.overlay.remove(),e(t)};return Gl(t,Wl,i),this}}},{key:"grab",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onGrab;if(this.shown&&!this.lock){var r=this.target.el;this.options.onBeforeGrab(r),this.released=!1,this.target.grab(n,e,t);var a=function n(){Gl(r,Wl,n,!1),i(r)};return Gl(r,Wl,a),this}}},{key:"move",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onMove;if(this.shown&&!this.lock){this.released=!1,this.body.style.cursor=ql,this.target.move(n,e,t);var r=this.target.el,a=function n(){Gl(r,Wl,n,!1),i(r)};return Gl(r,Wl,a),this}}},{key:"release",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onRelease;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeRelease(t),this.lock=!0,this.body.style.cursor=Ul,this.target.restoreOpenStyle();var i=function i(){Gl(t,Wl,i,!1),n.lock=!1,n.released=!0,e(t)};return Gl(t,Wl,i),this}}}]),n}();const po=JSON.parse('{"bgColor":"rgba(0,0,0,0.6)"}'),mo=Number("500");class ho{constructor(){this.instance=new uo(po)}update(n=".theme-vdoing-content img:not(.no-zoom)"){"undefined"!=typeof window&&this.instance.listen(n)}updateDelay(n=".theme-vdoing-content img:not(.no-zoom)",e=mo){setTimeout(()=>this.update(n),e)}}var go=[gl,kl,Sl,Tl,jl,{watch:{"$page.path"(){void 0!==this.$vuepress.zooming&&this.$vuepress.zooming.updateDelay()}},mounted(){this.$vuepress.zooming=new ho,this.$vuepress.zooming.updateDelay()}}],fo={name:"GlobalLayout",computed:{layout(){const n=this.getLayout();return cl("layout",n),Ht.component(n)}},methods:{getLayout(){if(this.$page.path){const n=this.$page.frontmatter.layout;return n&&(this.$vuepress.getLayoutAsyncComponent(n)||this.$vuepress.getVueComponent(n))?n:"Layout"}return"NotFound"}}},bo=t(4),vo=Object(bo.a)(fo,(function(){return(0,this._self._c)(this.layout,{tag:"component"})}),[],!1,null,null,null).exports;!function(n,e,t){switch(e){case"components":n[e]||(n[e]={}),Object.assign(n[e],t);break;case"mixins":n[e]||(n[e]=[]),n[e].push(...t);break;default:throw new Error("Unknown option name.")}}(vo,"mixins",go);const yo=[{name:"v-6933ae78",path:"/java/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-6933ae78").then(t)}},{path:"/java/index.html",redirect:"/java/"},{path:"/00.ç®å½é¡µ/05.å¼å/10.Java.html",redirect:"/java/"},{name:"v-6629cfe6",path:"/go/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-6629cfe6").then(t)}},{path:"/go/index.html",redirect:"/go/"},{path:"/00.ç®å½é¡µ/05.å¼å/15.GoLang.html",redirect:"/go/"},{name:"v-2969cc26",path:"/deep-learning/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2969cc26").then(t)}},{path:"/deep-learning/index.html",redirect:"/deep-learning/"},{path:"/00.ç®å½é¡µ/10.AI/05.æ·±åº¦å­¦ä¹ .html",redirect:"/deep-learning/"},{name:"v-eaab9570",path:"/linux/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-eaab9570").then(t)}},{path:"/linux/index.html",redirect:"/linux/"},{path:"/00.ç®å½é¡µ/15.åºç¡/10.Linux.html",redirect:"/linux/"},{name:"v-007ca368",path:"/datastructure/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-007ca368").then(t)}},{path:"/datastructure/index.html",redirect:"/datastructure/"},{path:"/00.ç®å½é¡µ/15.åºç¡/15.æ°æ®ç»æ.html",redirect:"/datastructure/"},{name:"v-36d5ec98",path:"/cloudnative/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-36d5ec98").then(t)}},{path:"/cloudnative/index.html",redirect:"/cloudnative/"},{path:"/00.ç®å½é¡µ/15.åºç¡/20.äºåç.html",redirect:"/cloudnative/"},{name:"v-18e88d58",path:"/git/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-18e88d58").then(t)}},{path:"/git/index.html",redirect:"/git/"},{path:"/00.ç®å½é¡µ/15.åºç¡/5.Git.html",redirect:"/git/"},{name:"v-60064de7",path:"/redis/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-60064de7").then(t)}},{path:"/redis/index.html",redirect:"/redis/"},{path:"/00.ç®å½é¡µ/20.ä¸­é´ä»¶/05.Redis.html",redirect:"/redis/"},{name:"v-179fad57",path:"/mysql/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-179fad57").then(t)}},{path:"/mysql/index.html",redirect:"/mysql/"},{path:"/00.ç®å½é¡µ/20.ä¸­é´ä»¶/06.MySQL.html",redirect:"/mysql/"},{name:"v-3fdec0bd",path:"/route-hijack/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-3fdec0bd").then(t)}},{path:"/route-hijack/index.html",redirect:"/route-hijack/"},{path:"/00.ç®å½é¡µ/25.ç½ç»/5.è·¯ç±å«æ.html",redirect:"/route-hijack/"},{name:"v-53104ef6",path:"/archives/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-53104ef6").then(t)}},{path:"/archives/index.html",redirect:"/archives/"},{path:"/@pages/archivesPage.html",redirect:"/archives/"},{name:"v-1a9d53e5",path:"/categories/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-1a9d53e5").then(t)}},{path:"/categories/index.html",redirect:"/categories/"},{path:"/@pages/categoriesPage.html",redirect:"/categories/"},{name:"v-150b83f6",path:"/tags/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-150b83f6").then(t)}},{path:"/tags/index.html",redirect:"/tags/"},{path:"/@pages/tagsPage.html",redirect:"/tags/"},{name:"v-517069f0",path:"/pages/3a4ae9/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-517069f0").then(t)}},{path:"/pages/3a4ae9/index.html",redirect:"/pages/3a4ae9/"},{path:"/AI/05.æ·±åº¦å­¦ä¹ /05.æå®æ¯/01.åºæ¬æ¦å¿µ.html",redirect:"/pages/3a4ae9/"},{name:"v-74cfb0b2",path:"/pages/e6f457/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-74cfb0b2").then(t)}},{path:"/pages/e6f457/index.html",redirect:"/pages/e6f457/"},{path:"/AI/05.æ·±åº¦å­¦ä¹ /05.æå®æ¯/05.ç¥ç»ç½ç»è®­ç»ä¸èµ·æ¥æä¹å.html",redirect:"/pages/e6f457/"},{name:"v-a113e2c4",path:"/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-a113e2c4").then(t)}},{path:"/index.html",redirect:"/"},{name:"v-6962c4c2",path:"/pages/271391/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-6962c4c2").then(t)}},{path:"/pages/271391/index.html",redirect:"/pages/271391/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/01.åºç¡æ¶æãæ°æ®ç»æä¸ IO æ¨¡å.html",redirect:"/pages/271391/"},{name:"v-a6ed5612",path:"/pages/d1a6d3/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-a6ed5612").then(t)}},{path:"/pages/d1a6d3/index.html",redirect:"/pages/d1a6d3/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/04.æä¹åæºå¶ï¼AOFæ¥å¿åRDBå¿«ç§.html",redirect:"/pages/d1a6d3/"},{name:"v-2778bd58",path:"/pages/348567/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2778bd58").then(t)}},{path:"/pages/348567/index.html",redirect:"/pages/348567/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/06.ä¸»ä»å¤å¶ä¸å¨åµæºå¶.html",redirect:"/pages/348567/"},{name:"v-31581127",path:"/pages/71b166/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-31581127").then(t)}},{path:"/pages/71b166/index.html",redirect:"/pages/71b166/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/09.åçéç¾¤.html",redirect:"/pages/71b166/"},{name:"v-c2ced796",path:"/pages/2029a8/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-c2ced796").then(t)}},{path:"/pages/2029a8/index.html",redirect:"/pages/2029a8/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/11.Redis ä¸­çæ°æ®ç»æ.html",redirect:"/pages/2029a8/"},{name:"v-3fe17966",path:"/pages/a3ed18/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-3fe17966").then(t)}},{path:"/pages/a3ed18/index.html",redirect:"/pages/a3ed18/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/14.æ¶é´åºåæ°æ®çä¿å­.html",redirect:"/pages/a3ed18/"},{name:"v-0b361225",path:"/pages/5d636a/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-0b361225").then(t)}},{path:"/pages/5d636a/index.html",redirect:"/pages/5d636a/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/15.Redis çæ¶æ¯éåæ¹æ¡.html",redirect:"/pages/5d636a/"},{name:"v-68306418",path:"/pages/ca62e3/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-68306418").then(t)}},{path:"/pages/ca62e3/index.html",redirect:"/pages/ca62e3/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/16.å¼æ­¥æºå¶ãCPU æ¶æå¯¹æ§è½çå½±å.html",redirect:"/pages/ca62e3/"},{name:"v-6c981036",path:"/pages/f111bf/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-6c981036").then(t)}},{path:"/pages/f111bf/index.html",redirect:"/pages/f111bf/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/18.å¦ä½åºå¯¹åæ¢ç Redis.html",redirect:"/pages/f111bf/"},{name:"v-1a140cfc",path:"/pages/6135bf/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-1a140cfc").then(t)}},{path:"/pages/6135bf/index.html",redirect:"/pages/6135bf/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/20.Redis çåå­ç¢çãç¼å²åº.html",redirect:"/pages/6135bf/"},{name:"v-29b8baff",path:"/pages/d403e5/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-29b8baff").then(t)}},{path:"/pages/d403e5/index.html",redirect:"/pages/d403e5/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/23.Redis ç¨ä½ç¼å­.html",redirect:"/pages/d403e5/"},{name:"v-2a85a268",path:"/pages/cbe81b/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2a85a268").then(t)}},{path:"/pages/cbe81b/index.html",redirect:"/pages/cbe81b/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/25.Redis ç¨ä½ç¼å­ä¹ç¼å­å¼å¸¸.html",redirect:"/pages/cbe81b/"},{name:"v-ad649dc2",path:"/pages/ea52c5/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-ad649dc2").then(t)}},{path:"/pages/ea52c5/index.html",redirect:"/pages/ea52c5/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/27.Redis ç¨ä½ç¼å­ä¹ç¼å­æ±¡æ.html",redirect:"/pages/ea52c5/"},{name:"v-3aa5fefb",path:"/pages/8f7740/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-3aa5fefb").then(t)}},{path:"/pages/8f7740/index.html",redirect:"/pages/8f7740/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/28.Pikaï¼åºäºSSDå®ç°å¤§å®¹éRedis.html",redirect:"/pages/8f7740/"},{name:"v-35ef0b3a",path:"/pages/5a1b01/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-35ef0b3a").then(t)}},{path:"/pages/5a1b01/index.html",redirect:"/pages/5a1b01/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/29.æ éçåå­æä½ååå¸å¼é.html",redirect:"/pages/5a1b01/"},{name:"v-2f859720",path:"/pages/932816/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2f859720").then(t)}},{path:"/pages/932816/index.html",redirect:"/pages/932816/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/31.Redis çäºå¡æºå¶.html",redirect:"/pages/932816/"},{name:"v-3622e3e6",path:"/pages/4140fe/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-3622e3e6").then(t)}},{path:"/pages/4140fe/index.html",redirect:"/pages/4140fe/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/32.Redis ä¸»ä»åæ­¥çå.html",redirect:"/pages/4140fe/"},{name:"v-c6d294b8",path:"/pages/b6efd0/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-c6d294b8").then(t)}},{path:"/pages/b6efd0/index.html",redirect:"/pages/b6efd0/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/36.ç§æåºæ¯ä¸çåºç¨.html",redirect:"/pages/b6efd0/"},{name:"v-aa603976",path:"/pages/d3d97d/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-aa603976").then(t)}},{path:"/pages/d3d97d/index.html",redirect:"/pages/d3d97d/"},{path:"/ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/37.éç¾¤çæ°æ®å¾æåéä¿¡å¼éé®é¢.html",redirect:"/pages/d3d97d/"},{name:"v-1823a466",path:"/pages/473452/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-1823a466").then(t)}},{path:"/pages/473452/index.html",redirect:"/pages/473452/"},{path:"/ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/01.åºç¡æ¶æï¼ä¸æ¡SQLæ¥è¯¢è¯­å¥æ¯å¦ä½æ§è¡çï¼.html",redirect:"/pages/473452/"},{name:"v-55200187",path:"/pages/38bad9/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-55200187").then(t)}},{path:"/pages/38bad9/index.html",redirect:"/pages/38bad9/"},{path:"/ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/02.æ¥å¿ç³»ç»ï¼ä¸æ¡SQLæ´æ°è¯­å¥æ¯å¦ä½æ§è¡çï¼.html",redirect:"/pages/38bad9/"},{name:"v-66f73835",path:"/pages/b99352/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-66f73835").then(t)}},{path:"/pages/b99352/index.html",redirect:"/pages/b99352/"},{path:"/ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/03.äºå¡éç¦».html",redirect:"/pages/b99352/"},{name:"v-7482ba20",path:"/pages/1ea58b/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-7482ba20").then(t)}},{path:"/pages/1ea58b/index.html",redirect:"/pages/1ea58b/"},{path:"/ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/04.æ·±å¥æµåºç´¢å¼.html",redirect:"/pages/1ea58b/"},{name:"v-2c529f3a",path:"/pages/376254/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2c529f3a").then(t)}},{path:"/pages/376254/index.html",redirect:"/pages/376254/"},{path:"/ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/05.å¨å±éãè¡¨çº§éåè¡é.html",redirect:"/pages/376254/"},{name:"v-76fe5474",path:"/pages/02bb58/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-76fe5474").then(t)}},{path:"/pages/02bb58/index.html",redirect:"/pages/02bb58/"},{path:"/ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/06.change buffer.html",redirect:"/pages/02bb58/"},{name:"v-24aa3866",path:"/pages/c4cff3/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-24aa3866").then(t)}},{path:"/pages/c4cff3/index.html",redirect:"/pages/c4cff3/"},{path:"/ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/07.MySQLä¸ºä»ä¹ææ¶åä¼å éç´¢å¼.html",redirect:"/pages/c4cff3/"},{name:"v-18bc1557",path:"/pages/fa9ec1/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-18bc1557").then(t)}},{path:"/pages/fa9ec1/index.html",redirect:"/pages/fa9ec1/"},{path:"/ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/08.æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼.html",redirect:"/pages/fa9ec1/"},{name:"v-4fda8213",path:"/pages/c774f5/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-4fda8213").then(t)}},{path:"/pages/c774f5/index.html",redirect:"/pages/c774f5/"},{path:"/åºç¡/10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/05.Linuxåºç¡ç¯.html",redirect:"/pages/c774f5/"},{name:"v-c45fcee4",path:"/pages/4a5b75/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-c45fcee4").then(t)}},{path:"/pages/4a5b75/index.html",redirect:"/pages/4a5b75/"},{path:"/åºç¡/10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/10.Linuxå®æç¯ï¼ä¸ï¼.html",redirect:"/pages/4a5b75/"},{name:"v-e36601e4",path:"/pages/16468e/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-e36601e4").then(t)}},{path:"/pages/16468e/index.html",redirect:"/pages/16468e/"},{path:"/åºç¡/10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/15.Linuxå®æç¯ï¼ä¸ï¼.html",redirect:"/pages/16468e/"},{name:"v-1ae0a658",path:"/pages/1e98d9/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-1ae0a658").then(t)}},{path:"/pages/1e98d9/index.html",redirect:"/pages/1e98d9/"},{path:"/åºç¡/10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/20.JavaEEä¸Pythonå®å¶ç¯.html",redirect:"/pages/1e98d9/"},{name:"v-97c51d34",path:"/pages/338288/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-97c51d34").then(t)}},{path:"/pages/338288/index.html",redirect:"/pages/338288/"},{path:"/åºç¡/10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/25.å¤§æ°æ®å®å¶ç¯-Shellç¼ç¨.html",redirect:"/pages/338288/"},{name:"v-02285212",path:"/pages/dd2e0e/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-02285212").then(t)}},{path:"/pages/dd2e0e/index.html",redirect:"/pages/dd2e0e/"},{path:"/åºç¡/10.Linux/10.Fromå¬ä¼å·/5.å¸¦ä½ å®ç°Linuxå½ä»¤èªç±.html",redirect:"/pages/dd2e0e/"},{name:"v-2bcd0941",path:"/pages/c2aef8/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2bcd0941").then(t)}},{path:"/pages/c2aef8/index.html",redirect:"/pages/c2aef8/"},{path:"/åºç¡/15.æ°æ®ç»æ/05.å¸¸è§æ°æ®ç»æ/05.LSM æ .html",redirect:"/pages/c2aef8/"},{name:"v-6e3c4c48",path:"/pages/850e00/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-6e3c4c48").then(t)}},{path:"/pages/850e00/index.html",redirect:"/pages/850e00/"},{path:"/åºç¡/20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/01.å¼ç¯è¯.html",redirect:"/pages/850e00/"},{name:"v-2d5f867f",path:"/pages/1cc8db/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2d5f867f").then(t)}},{path:"/pages/1cc8db/index.html",redirect:"/pages/1cc8db/"},{path:"/åºç¡/20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/02.åè¯å®¹å¨.html",redirect:"/pages/1cc8db/"},{name:"v-7a34202e",path:"/pages/757154/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-7a34202e").then(t)}},{path:"/pages/757154/index.html",redirect:"/pages/757154/"},{path:"/åºç¡/20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/09.Kubernetes çå®è£ä¸åºæ¬æ¶æ.html",redirect:"/pages/757154/"},{name:"v-ac009106",path:"/pages/c0d84b/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-ac009106").then(t)}},{path:"/pages/c0d84b/index.html",redirect:"/pages/c0d84b/"},{path:"/åºç¡/20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/11.YAMLãPodãJobãCronJobãConfigMapãSecret.html",redirect:"/pages/c0d84b/"},{name:"v-31ed6925",path:"/pages/0d79ac/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-31ed6925").then(t)}},{path:"/pages/0d79ac/index.html",redirect:"/pages/0d79ac/"},{path:"/åºç¡/5.Git/05.Gitåºç¡.html",redirect:"/pages/0d79ac/"},{name:"v-45526b4e",path:"/pages/dc4ebe/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-45526b4e").then(t)}},{path:"/pages/dc4ebe/index.html",redirect:"/pages/dc4ebe/"},{path:"/åºç¡/5.Git/10.Gitçä½¿ç¨.html",redirect:"/pages/dc4ebe/"},{name:"v-11669a46",path:"/pages/483565/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-11669a46").then(t)}},{path:"/pages/483565/index.html",redirect:"/pages/483565/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/05.Javaåºç¡è¯­æ³.html",redirect:"/pages/483565/"},{name:"v-2c0bb97b",path:"/pages/a6522a/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2c0bb97b").then(t)}},{path:"/pages/a6522a/index.html",redirect:"/pages/a6522a/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/10.æ°ç».html",redirect:"/pages/a6522a/"},{name:"v-43f0e09d",path:"/pages/615479/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-43f0e09d").then(t)}},{path:"/pages/615479/index.html",redirect:"/pages/615479/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/15.æ¹æ³.html",redirect:"/pages/615479/"},{name:"v-2b382624",path:"/pages/d4e408/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-2b382624").then(t)}},{path:"/pages/d4e408/index.html",redirect:"/pages/d4e408/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/20.é¢åå¯¹è±¡åºç¡.html",redirect:"/pages/d4e408/"},{name:"v-36c9cb62",path:"/pages/8f676c/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-36c9cb62").then(t)}},{path:"/pages/8f676c/index.html",redirect:"/pages/8f676c/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/25.å¸¸ç¨API(StringãArrayList).html",redirect:"/pages/8f676c/"},{name:"v-7e68add3",path:"/pages/46cfbb/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-7e68add3").then(t)}},{path:"/pages/46cfbb/index.html",redirect:"/pages/46cfbb/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/30.é¢åå¯¹è±¡è¿é¶1ï¼staticãåä¾ãä»£ç åãç»§æ¿ï¼.html",redirect:"/pages/46cfbb/"},{name:"v-087079a8",path:"/pages/b127ae/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-087079a8").then(t)}},{path:"/pages/b127ae/index.html",redirect:"/pages/b127ae/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/31.é¢åå¯¹è±¡è¿é¶2ï¼åãæéä¿®é¥°ç¬¦ãæ½è±¡ç±»ãæ¥å£ï¼.html",redirect:"/pages/b127ae/"},{name:"v-b1a79552",path:"/pages/a4fc75/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-b1a79552").then(t)}},{path:"/pages/a4fc75/index.html",redirect:"/pages/a4fc75/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/32.é¢åå¯¹è±¡è¿é¶3ï¼å¤æãåé¨ç±»ãå¸¸ç¨APIï¼.html",redirect:"/pages/a4fc75/"},{name:"v-433c42bb",path:"/pages/4cb625/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-433c42bb").then(t)}},{path:"/pages/4cb625/index.html",redirect:"/pages/4cb625/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/33.é¢åå¯¹è±¡è¿é¶4ï¼å¸¸ç¨æ¥æAPIãæ­£åãArraysç±»ãLambdaï¼.html",redirect:"/pages/4cb625/"},{name:"v-4f80c998",path:"/pages/6013df/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-4f80c998").then(t)}},{path:"/pages/6013df/index.html",redirect:"/pages/6013df/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/34.é¢åå¯¹è±¡è¿é¶5ï¼éåä½ç³»ï¼.html",redirect:"/pages/6013df/"},{name:"v-3161e9d4",path:"/pages/134c54/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-3161e9d4").then(t)}},{path:"/pages/134c54/index.html",redirect:"/pages/134c54/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/35.é¢åå¯¹è±¡è¿é¶6ï¼éåä½ç³»ä¹Mapï¼.html",redirect:"/pages/134c54/"},{name:"v-78a8ae4e",path:"/pages/e64834/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-78a8ae4e").then(t)}},{path:"/pages/e64834/index.html",redirect:"/pages/e64834/"},{path:"/å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/40.é¢åå¯¹è±¡è¿é¶-è¡¥åï¼å¯ååæ°ï¼.html",redirect:"/pages/e64834/"},{name:"v-147908a9",path:"/pages/017edb/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-147908a9").then(t)}},{path:"/pages/017edb/index.html",redirect:"/pages/017edb/"},{path:"/å¼å/10.Java/10.é¢åå¯¹è±¡.html",redirect:"/pages/017edb/"},{name:"v-f49e53d6",path:"/pages/e76788/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-f49e53d6").then(t)}},{path:"/pages/e76788/index.html",redirect:"/pages/e76788/"},{path:"/å¼å/10.Java/15.å¸¸ç¨API.html",redirect:"/pages/e76788/"},{name:"v-00a73f02",path:"/pages/5de326/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-00a73f02").then(t)}},{path:"/pages/5de326/index.html",redirect:"/pages/5de326/"},{path:"/å¼å/10.Java/20.å¹¶åãå¹¶è¡ãå¼æ­¥ãåæ­¥ï¼æå­ï¼.html",redirect:"/pages/5de326/"},{name:"v-cafc5bfe",path:"/pages/0fc51e/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-cafc5bfe").then(t)}},{path:"/pages/0fc51e/index.html",redirect:"/pages/0fc51e/"},{path:"/å¼å/10.Java/30.ãSpring Boot è¿é¶-éå¤©æ°ã/05.Springä¾èµæ³¨å¥çåçåæ.html",redirect:"/pages/0fc51e/"},{name:"v-53b20642",path:"/pages/a53eb3/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-53b20642").then(t)}},{path:"/pages/a53eb3/index.html",redirect:"/pages/a53eb3/"},{path:"/å¼å/15.GoLang/05.ç ç¥ä¹è·¯-å­¦ä¹ ç¬è®°/05.åºç¡.html",redirect:"/pages/a53eb3/"},{name:"v-623e7b3d",path:"/pages/83009c/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-623e7b3d").then(t)}},{path:"/pages/83009c/index.html",redirect:"/pages/83009c/"},{path:"/ç½ç»/5.è·¯ç±å«æ/5.ãæ·±å¥æµåºè¯¦è§£RPKIã/05.åè¨.html",redirect:"/pages/83009c/"},{name:"v-551cf7ff",path:"/pages/b6c83c/",component:vo,beforeEnter:(n,e,t)=>{dl("Layout","v-551cf7ff").then(t)}},{path:"/pages/b6c83c/index.html",redirect:"/pages/b6c83c/"},{path:"/ç½ç»/5.è·¯ç±å«æ/5.ãæ·±å¥æµåºè¯¦è§£RPKIã/10.ç®ä».html",redirect:"/pages/b6c83c/"},{path:"*",component:vo}],xo={title:"",description:"",base:"/blog/",headTags:[["link",{rel:"icon",href:"/blog/img/bitbug_favicon.ico"}],["meta",{name:"keywords",content:"åç«¯åå®¢,ä¸ªäººææ¯åå®¢,åç«¯,åç«¯å¼å,åç«¯æ¡æ¶,webåç«¯,åç«¯é¢è¯é¢,ææ¯ææ¡£,å­¦ä¹ ,é¢è¯,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown"}],["meta",{name:"theme-color",content:"#11a8cd"}]],pages:[{title:"Java",frontmatter:{pageComponent:{name:"Catalogue",data:{key:"å¼å/10.Java",imgUrl:"/img/more.png",description:"å­¦ä¹ ãé¢è¯ãå¨çº¿å·¥å·ç­æ´å¤æç« åé¡µé¢"}},title:"Java",date:"2020-03-11T21:50:56.000Z",permalink:"/java"},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/05.%E5%BC%80%E5%8F%91/10.Java.html",relativePath:"00.ç®å½é¡µ/05.å¼å/10.Java.md",key:"v-6933ae78",path:"/java/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/03/28, 02:58:11",lastUpdatedTimestamp:1648436291e3},{title:"GoLang",frontmatter:{pageComponent:{name:"Catalogue",data:{key:"å¼å/15.GoLang",imgUrl:"/img/more.png",description:"GoLang å­¦ä¹ ç¬è®°"}},title:"GoLang",date:"2022-05-15T21:06:15.000Z",permalink:"/go"},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/05.%E5%BC%80%E5%8F%91/15.GoLang.html",relativePath:"00.ç®å½é¡µ/05.å¼å/15.GoLang.md",key:"v-6629cfe6",path:"/go/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/07/27, 11:28:29",lastUpdatedTimestamp:1658921309e3},{title:"æ·±åº¦å­¦ä¹ ",frontmatter:{pageComponent:{name:"Catalogue",data:{key:"AI/05.æ·±åº¦å­¦ä¹ ",imgUrl:"/img/more.png",description:null}},title:"æ·±åº¦å­¦ä¹ ",permalink:"/deep-learning",date:"2022-03-28T10:12:09.000Z"},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/10.AI/05.%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0.html",relativePath:"00.ç®å½é¡µ/10.AI/05.æ·±åº¦å­¦ä¹ .md",key:"v-2969cc26",path:"/deep-learning/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/03/28, 02:58:11",lastUpdatedTimestamp:1648436291e3},{title:"Linux",frontmatter:{pageComponent:{name:"Catalogue",data:{key:"åºç¡/10.Linux",imgUrl:"/img/more.png",description:"Linux å­¦ä¹ "}},title:"Linux",date:"2022-04-09T09:57:56.000Z",permalink:"/linux"},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/15.%E5%9F%BA%E7%A1%80/10.Linux.html",relativePath:"00.ç®å½é¡µ/15.åºç¡/10.Linux.md",key:"v-eaab9570",path:"/linux/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/04/09, 07:49:44",lastUpdatedTimestamp:1649490584e3},{title:"DataStructure",frontmatter:{pageComponent:{name:"Catalogue",data:{key:"åºç¡/15.æ°æ®ç»æ",imgUrl:"/img/more.png",description:"è®°å½å¸¸è§æ°æ®ç»æçç¥è¯"}},title:"DataStructure",date:"2022-05-24T09:57:56.000Z",permalink:"/datastructure"},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/15.%E5%9F%BA%E7%A1%80/15.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html",relativePath:"00.ç®å½é¡µ/15.åºç¡/15.æ°æ®ç»æ.md",key:"v-007ca368",path:"/datastructure/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/05/24, 09:11:54",lastUpdatedTimestamp:1684919514e3},{title:"CloudNative",frontmatter:{pageComponent:{name:"Catalogue",data:{key:"åºç¡/20.äºåç",imgUrl:"/img/more.png",description:"å­¦ä¹ äºåçç¸å³åå®¹çç¬è®°"}},title:"CloudNative",date:"2022-06-07T09:57:56.000Z",permalink:"/cloudnative"},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/15.%E5%9F%BA%E7%A1%80/20.%E4%BA%91%E5%8E%9F%E7%94%9F.html",relativePath:"00.ç®å½é¡µ/15.åºç¡/20.äºåç.md",key:"v-36d5ec98",path:"/cloudnative/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/06/07, 00:44:58",lastUpdatedTimestamp:1686098698e3},{title:"Git",frontmatter:{pageComponent:{name:"Catalogue",data:{key:"åºç¡/5.Git",imgUrl:"/img/more.png",description:"Git ä½¿ç¨"}},title:"Git",date:"2022-04-09T09:57:56.000Z",permalink:"/git"},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/15.%E5%9F%BA%E7%A1%80/5.Git.html",relativePath:"00.ç®å½é¡µ/15.åºç¡/5.Git.md",key:"v-18e88d58",path:"/git/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/04/09, 07:49:44",lastUpdatedTimestamp:1649490584e3},{title:"Redis",frontmatter:{pageComponent:{name:"Catalogue",data:{key:"ä¸­é´ä»¶/05.Redis",imgUrl:"/img/more.png",description:"Redis å­¦ä¹ ç¬è®°"}},title:"Redis",date:"2023-03-19T22:11:56.000Z",permalink:"/redis"},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/20.%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis.html",relativePath:"00.ç®å½é¡µ/20.ä¸­é´ä»¶/05.Redis.md",key:"v-60064de7",path:"/redis/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/03/19, 14:17:32",lastUpdatedTimestamp:1679235452e3},{title:"MySQL",frontmatter:{pageComponent:{name:"Catalogue",data:{key:"ä¸­é´ä»¶/06.MySQL",imgUrl:"/img/more.png",description:"MySQL å­¦ä¹ ç¬è®°"}},title:"MySQL",date:"2023-05-17T09:35:08.000Z",permalink:"/mysql"},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/20.%E4%B8%AD%E9%97%B4%E4%BB%B6/06.MySQL.html",relativePath:"00.ç®å½é¡µ/20.ä¸­é´ä»¶/06.MySQL.md",key:"v-179fad57",path:"/mysql/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/05/17, 02:42:28",lastUpdatedTimestamp:1684291348e3},{title:"è·¯ç±å«æ",frontmatter:{pageComponent:{name:"Catalogue",data:{key:"ç½ç»/5.è·¯ç±å«æ",imgUrl:"/img/more.png",description:"è·¯ç±å«æå­¦ä¹ è®°å½"}},title:"è·¯ç±å«æ",date:"2022-04-12T19:01:56.000Z",permalink:"/route-hijack"},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/25.%E7%BD%91%E7%BB%9C/5.%E8%B7%AF%E7%94%B1%E5%8A%AB%E6%8C%81.html",relativePath:"00.ç®å½é¡µ/25.ç½ç»/5.è·¯ç±å«æ.md",key:"v-3fdec0bd",path:"/route-hijack/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2023/03/19, 14:17:32",lastUpdatedTimestamp:1679235452e3},{title:"å½æ¡£",frontmatter:{archivesPage:!0,title:"å½æ¡£",permalink:"/archives/",article:!1},regularPath:"/@pages/archivesPage.html",relativePath:"@pages/archivesPage.md",key:"v-53104ef6",path:"/archives/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/03/27, 01:31:04",lastUpdatedTimestamp:1648344664e3},{title:"åç±»",frontmatter:{categoriesPage:!0,title:"åç±»",permalink:"/categories/",article:!1},regularPath:"/@pages/categoriesPage.html",relativePath:"@pages/categoriesPage.md",key:"v-1a9d53e5",path:"/categories/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/03/27, 01:31:04",lastUpdatedTimestamp:1648344664e3},{title:"æ ç­¾",frontmatter:{tagsPage:!0,title:"æ ç­¾",permalink:"/tags/",article:!1},regularPath:"/@pages/tagsPage.html",relativePath:"@pages/tagsPage.md",key:"v-150b83f6",path:"/tags/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/03/27, 01:31:04",lastUpdatedTimestamp:1648344664e3},{title:"åºæ¬æ¦å¿µ",frontmatter:{title:"åºæ¬æ¦å¿µ",date:"2022-01-21T19:04:11.000Z",permalink:"/pages/3a4ae9/",categories:["AI","æ·±åº¦å­¦ä¹ ","æå®æ¯"],tags:[null]},regularPath:"/AI/05.%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/05.%E6%9D%8E%E5%AE%8F%E6%AF%85/01.%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.html",relativePath:"AI/05.æ·±åº¦å­¦ä¹ /05.æå®æ¯/01.åºæ¬æ¦å¿µ.md",key:"v-517069f0",path:"/pages/3a4ae9/",headers:[{level:3,title:"1. Function with Unknown Parameters",slug:"_1-function-with-unknown-parameters",normalizedTitle:"1. function with unknown parameters",charIndex:829},{level:3,title:"2. Define Loss from Training Data",slug:"_2-define-loss-from-training-data",normalizedTitle:"2. define loss from training data",charIndex:1083},{level:4,title:"(1) Loss å½æ°",slug:"_1-loss-å½æ°",normalizedTitle:"(1) loss å½æ°",charIndex:1120},{level:4,title:"(2) è®¡ç®è¯¯å·®e",slug:"_2-è®¡ç®è¯¯å·®e",normalizedTitle:"(2) è®¡ç®è¯¯å·®e",charIndex:1415},{level:4,title:"(3) Error Surface",slug:"_3-error-surface",normalizedTitle:"(3) error surface",charIndex:1487},{level:3,title:"3. Optimization",slug:"_3-optimization",normalizedTitle:"3. optimization",charIndex:1660},{level:3,title:"1. çº¢è²æ²çº¿æä¹è¡¨è¾¾",slug:"_1-çº¢è²æ²çº¿æä¹è¡¨è¾¾",normalizedTitle:"1. çº¢è²æ²çº¿æä¹è¡¨è¾¾",charIndex:2698},{level:3,title:"2. èè² Function ï¼Hard Sigmoidï¼æä¹ååºæ¥",slug:"_2-èè²-function-hard-sigmoid-æä¹ååºæ¥",normalizedTitle:"2. èè² function ï¼hard sigmoidï¼æä¹ååºæ¥",charIndex:3103},{level:4,title:"ï¼1ï¼Sigmoid Functionï¼Såæ²çº¿)",slug:"_1-sigmoid-function-såæ²çº¿",normalizedTitle:"ï¼1ï¼sigmoid functionï¼såæ²çº¿)",charIndex:3141},{level:4,title:"(2) åå¼åæ ·çèè² Function ææ ·å¶é åºæ¥",slug:"_2-åå¼åæ ·çèè²-function-ææ ·å¶é åºæ¥",normalizedTitle:"(2) åå¼åæ ·çèè² function ææ ·å¶é åºæ¥",charIndex:3258},{level:3,title:"3. çº¢è² Function é¿ä»ä¹æ ·å­",slug:"_3-çº¢è²-function-é¿ä»ä¹æ ·å­",normalizedTitle:"3. çº¢è² function é¿ä»ä¹æ ·å­",charIndex:3488},{level:4,title:"å¦ä½åå° Model çBias",slug:"å¦ä½åå°-model-çbias",normalizedTitle:"å¦ä½åå° model çbias",charIndex:3532},{level:3,title:"æ¨¡ååå",slug:"æ¨¡ååå",normalizedTitle:"æ¨¡ååå",charIndex:4676},{level:4,title:"Activation Function",slug:"activation-function",normalizedTitle:"activation function",charIndex:4684},{level:4,title:"æ¨¡åæ¹è¿ââå¤åå æ¬¡",slug:"æ¨¡åæ¹è¿-å¤åå æ¬¡",normalizedTitle:"æ¨¡åæ¹è¿ââå¤åå æ¬¡",charIndex:4881}],headersStr:"1. Function with Unknown Parameters 2. Define Loss from Training Data (1) Loss å½æ° (2) è®¡ç®è¯¯å·®e (3) Error Surface 3. Optimization 1. çº¢è²æ²çº¿æä¹è¡¨è¾¾ 2. èè² Function ï¼Hard Sigmoidï¼æä¹ååºæ¥ ï¼1ï¼Sigmoid Functionï¼Såæ²çº¿) (2) åå¼åæ ·çèè² Function ææ ·å¶é åºæ¥ 3. çº¢è² Function é¿ä»ä¹æ ·å­ å¦ä½åå° Model çBias æ¨¡ååå Activation Function æ¨¡åæ¹è¿ââå¤åå æ¬¡",content:"æºå¨å­¦ä¹ æ¦æ¬æ¥è¯´ï¼æºå¨å­¦ä¹ å°±æ¯è®©æºå¨å·å¤æ¾ä¸ä¸ªå½å¼çè½åã\n\n\n# Different types of Functions\n\n * Regressionï¼åå½ï¼\n   \n   * è¾åºæ¯ä¸ä¸ªæ°å¼ï¼scalarï¼\n     \n     > ä¾å¦ï¼ä»å¤©è¦æºå¨åçäºæ,æ¯é¢æµæªæ¥æä¸ä¸ªæ¶é´ç,PM2.5çæ°å¼ãè¾å¥å¯è½æ¯ç§ç§è·é¢æµPM2.5,æå³çææ°,è¿ä¸ä¸ªå½å¼å¯ä»¥æ¿è¿äºæ°å¼å½ä½è¾å¥,è¾åºæå¤©ä¸­åçPM2.5çæ°å¼,é£è¿ä¸ä¸ªæ¾è¿ä¸ªå½å¼çä»»å¡,å«ä½Regressionã\n\n * Classificationï¼åç±»ï¼\n   \n   * è¦æºå¨åéæ©é¢ãäººç±»åå¤å¥½ä¸äºéé¡¹ï¼ä¹å«ç±»å«ï¼ï¼classesï¼ï¼ä»è®¾å®å¥½çéé¡¹ä¸­éæ©ä¸ä¸ªå½åè¾åºï¼è¿ä¸ªä»»å¡å°±å«å Classificationã\n     \n     > ä¾å¦ï¼gmail accountè£¡é¢æä¸ä¸ªå½å¼,å¸®æä»¬ä¾¦æµä¸å°é®ä»¶,æ¯ä¸æ¯åå¾é®ä»¶ã\n     > \n     > alpha goæ¬èº«ä¹æ¯ä¸ä¸ª Classification çé®é¢ã\n\n * Structured Learning\n   \n   * æºå¨ä»å¤©ä¸åªæ¯è¦åéæ©é¢ï¼ä¸åªæ¯è¾åºä¸ä¸ªæ°å­ï¼è¿è¦äº§çä¸ä¸ªæç»æçç©ä»¶ãæºå¨ç»ä¸å¼ å¾ åä¸ç¯æç« ,è¿ç§å«æºå¨äº§çæç»æçä¸è¥¿çé®é¢,å°±å«ä½Structured Learningãå³è¦æºå¨å­¦ä¼åé ã\n\n\n# Case Study\n\nä¸¾ä¾è¯´ææºå¨æä¹æ¾ä¸ä¸ªå½å¼ã\n\næ¾ä¸ä¸ªå½å¼,è¿ä¸ªå½å¼çè¾å¥æ¯youtubeä¸é¢ä¸ä¸ªé¢éè¿å¾ææçèµè®¯ï¼è¾åºå°±æ¯é¢æµæå¤©è¿ä¸ªé¢éå¯è½çæ»è§çæ¬¡æ°ã\n\næ¾è¿ä¸ªå½å¼çè¿ç¨ï¼åä¸ºä¸æ­¥ï¼\n\n 1. ååºä¸ä¸ªå¸¦ææªç¥åæ°çå½å¼ï¼2. å®ä¹ä¸ä¸ªå«åLossçfunctionï¼3. è§£ä¸ä¸ªOptimizationçé®é¢æ¾å°ä¸ç»åæ°ä½¿losså¼æå°ã<æ¬è´¨æ¯è®­ç»ï¼ç¨å·²ç¥çæ°æ®æ¥âé¢æµâ>\n\n----------------------------------------\n\n\n# 1. Function with Unknown Parameters\n\nåè®¾å½å¼ä¸º $ y=b+w*x_{1} $ï¼è¿ä¸ªå¸¦æUnknownçParameterçFunctionå«åModelãè¿ä¸ªçæµå¾å¾å°±æ¥èªäºä½ å¯¹è¿ä¸ªé®é¢æ¬è´¨ä¸çäºè§£ï¼ä¹å°±æ¯ Domain knowledge\n\n * y ä¸ºé¢æµå¼ï¼æ¬ä¾ä¸­ä¸ºæå¤©è§çæ­¤é¢éçæ»äººæ°\n * $x_{1}$ä¸ºå·²ç¥çä¸è¥¿ï¼å«åFeatureï¼æ¬ä¾ä¸­ä¸ºä»å¤©è§ççäººæ°\n * b (bias) å w (weight)æ¯æªç¥çåæ°ï¼è¦ä»æ°æ®èµæä¸­å­¦ä¹ å¾å°\n\n\n# 2. Define Loss from Training Data\n\n# (1) Loss å½æ°\n\nå®ä¹ä¸ä¸ª Loss å½æ°ï¼è¾å¥ä¸º Model ä¸­çæªç¥åæ° b å wï¼Parameterï¼ï¼è¾åºçå¼è¡¨ç¤ºè¥æè¿ç»å¼ä¼ ç»æªç¥åæ°ï¼å¯¹äºè®¡ç®åºçé¢æµå¼æ¯å¥½è¿æ¯ä¸å¥½ã\n\nå¯¹äº Loss çè®¡ç®ï¼è¦ä»è®­ç»èµææ¥è¿è¡ãæä»¥å¯¹äºä¸ä¸ªé¢æµå¼ï¼å¯ä»¥ä»è®­ç»èµæä¸­ç¥éçå®çç»æï¼å èå¯ä»¥è®¡ç®é¢ä¼°ç»æåçæ­£ç»æï¼Labelï¼ä¹é´çè¯¯å·® e ï¼$e_{i} = è®¡ç®å·®è·(yï¼\\hat{y} )$ãå¯ä»¥ä»¥æ­¤æ¹æ³è®¡ç®è®­ç»éä¸­çæ¯ä¸å¤©çè¯¯å·®ï¼ä»èå¯å¾ Loss å¼:$L=\\frac{1}{n}\\sum_{n}e_{_n}$\n\nLè¶å¤§,ä»£è¡¨è¿ç»åæ°è¶ä¸å¥½ï¼Lè¶å°,ä»£è¡¨è¿ç»åæ°è¶å¥½\n\n# (2) è®¡ç®è¯¯å·®e\n\nå¦ä¸å¾ï¼è®¡ç®è¯¯å·® e æå¤ç§æ¹æ³ï¼MAEãMSN ãCross-entropyï¼y å Å· æºçåå¸æ¶ä½¿ç¨ï¼ ç­ã\n\n# (3) Error Surface\n\næä»¬å¯ä»¥è°æ´ä¸åç w å b ï¼çºä¸åçwè·bçç»åè®¡ç®å®çLoss,ç¶åå°±å¯ä»¥ç»åºä»¥ä¸è¿ä¸ä¸ªç­é«çº¿å¾.ï¼å°è¯ä¸åçåæ°ï¼è®¡ç®Lossï¼ç»åºæ¥çå¾ï¼\n\nå¨è¿ä¸ªç­é«çº¿å¾ä¸é¢,è¶åçº¢è²ç³»,ä»£è¡¨è®¡ç®åºæ¥çLossè¶å¤§,å°±ä»£è¡¨è¿ä¸ç»wè·bè¶å·®,å¦æè¶åèè²ç³»,å°±ä»£è¡¨Lossè¶å°,å°±ä»£è¡¨è¿ä¸ç»wè·bè¶å¥½ã\n\n\n# 3. Optimization\n\nè§£ä¸ä¸ªæä½³åçé®é¢ï¼æ¾ä¸ç»æªç¥åæ°ï¼è®© Loss æå°ãæ¬ä¾ä¸­æ¯æ¾è®© Loss æå°ç w* å b*ãä¸ä¸ªOptimization æ¹æ³ï¼Gradient Descentã\n\nææ ·æ¾ä¸ä¸ª w è®©è¿ä¸ª loss çå¼æå°å¢ï¼éæºéåä¸ä¸ªåå§çç¹ï¼è¿ä¸ªåå§çç¹,æä»¬å«å w0-> æ±åæ°å¯¹ Loss çå¾®å -> æ´æ°åæ°å¼ãæä½çå°æ¹è·¨ä¸æ­¥ï¼é£æ´æ°æ¶è¿ä¸æ­¥è¦è·¨å¤å¤§å¢ï¼è¿ä¸æ­¥çæ­¥ä¼çå¤§å°åå³äºè¿ä¸ªå°æ¹çæçåå­¦ä¹ ç ($\\eta $)ï¼èªå·±è®¾å®çï¼ãè¿ç§ä½ å¨åæºå¨å­¦ä¹ ,éè¦èªå·±è®¾å®çä¸è¥¿,å«åhyperparameters ï¼è¶åæ°ï¼ã\n\nä»ä¹æ¶ååä¸æ¥å¢ï¼å¾å¾æä¸¤ç§ç¶åµï¼\n\n * ç¬¬ä¸ç§ç¶åµæ¯ä½ å¤±å»èå¿äºï¼ä½ ä¸å¼å§ä¼è®¾å®è¯´ï¼æä»å¤©å¨è°æ´æçåæ°çæ¶åï¼ææå¤è®¡ç®å æ¬¡ï¼\n * é£è¿æå¦å¤ä¸ç§çæ³ä¸åä¸æ¥çå¯è½æ¯ï¼ä»å¤©å½æä»¬ä¸æ­è°æ´åæ°æ¶è°æ´å°ä¸ä¸ªå°æ¹ï¼å®çå¾®åçå¼ç®åºæ¥æ­£å¥½æ¯ 0 çæ¶åï¼å¦æè¿ä¸é¡¹æ­£å¥½ç®åºæ¥æ¯0.0ä¹ä¸ learning rate è¿æ¯ 0ï¼æä»¥ä½ çåæ°å°±ä¸ä¼åç§»å¨ä½ç½®ï¼é£åæ°çä½ç½®å°±ä¸ä¼åæ´æ°ã\n\n\n\nä½ å¯è½ä¼åç° Gradient Descent è¿ä¸ªæ¹æ³æä¸ä¸ªå·¨å¤§çé®é¢ï¼æä»¬æ²¡ææ¾å°çæ­£æå¥½çè§£ï¼æä»¬åªæ¯æ¾å°ç local minima èä¸æ¯ global minimaãå¶å®ï¼local minima æ¯ä¸ä¸ªåé®é¢ï¼æä»¬å¨å Gradient Descent çæ¶åçæ­£é¢å¯¹çé¾é¢ä¸æ¯ local minimaï¼ä¹åä¼è®²å°å®ççæ­£çç¹å¨åªã\n\nåååªæä¸ä¸ªåæ° wï¼å°å¶æ©å±è³äºç»´ä¹è³å¤ç»´æ¯åçã\n\noptimization\n\n\n# Linear Model\n\nä¸æä¸­çæ¨¡åå³çº¿æ§æ¨¡åã\n\nè§å¯çå®æ°æ®ï¼åç°æ¯éä¸å¤©ä¸ä¸ªå¾ªç¯ï¼å æ­¤å¯ä»¥ä¿®æ¹æ¨¡åï¼æ¨¡åçä¿®æ¹éå¸¸æ¥èªäºå¯¹é®é¢ççè§£ï¼å³ Domain Knowledgeï¼ãå èæ¨¡åä»$y=b+wx_1$ --\x3e $y=b+ \\sum_{j=1}^{7}w_jx_j$ï¼åä¸å¤©çè§çäººæ°é½è¢«åå¥èèã\n\n\n# Piecewise Linear Curves(åæ®µçº¿æ§æ²çº¿)\n\nä¸ç®¡æéº¼æå¼w è· b,ä½ æ°¸è¿è£½é ä¸åºçº¢è²é£ä¸æ¡çº¿,ä½ æ°¸è¿æ æ³ç¨ Linear ç Model,è£½é çº¢è²è¿ä¸æ¡çº¿ãå ä¸º model çéå¶èä½¿å¾æ°¸è¿æ æ³æ¨¡æçå®ç¶åµï¼è¿ç§æ¥èª Model çéå¶ï¼å«åModel ç Biasï¼â ä¸æä¸­ Model ä¸­ç Bias bï¼ã\n\n\n# 1. çº¢è²æ²çº¿æä¹è¡¨è¾¾\n\nå¾ä¸­çº¢è²çè¿ä¸æ¡æ²çº¿ï¼å¯ä»¥çä½æ¯ä¸ä¸ªå¸¸æ°ï¼å ä¸ä¸ç¾¤èè²è¿æ ·ç Functionã\n\nè¿ä¸ªèè²ç Function å«å Hard Sigmoidï¼å®çç¹æ§æ¯\n\n * å½è¾å¥çå¼,å½ x è½´çå¼å°æ¼æä¸ä¸ªè¿ä¸ª Flash Hold çæ¶å,å®æ¯æä¸ä¸ªå®å¼,\n * å¤§æ¼å¦å¤ä¸ä¸ª Flash Hold çæ¶å,åæ¯å¦å¤ä¸ä¸ªå®å¼,\n * ä¸­é´æä¸ä¸ªæå¡\n\nPiecewise Linear ç Curves è¶å¤æ,ä¹å°±æ¯è¿ä¸ªè½¬æçç¹è¶å¤å,é£ä½ éè¦çè¿ä¸ªèè²ç Function å°±è¶å¤ãå¯ä»¥ç¨ Piecewise Linear ç Curves,å»é¼è¿ä»»ä½çè¿ç»­çæ²çº¿,èæ¯ä¸ä¸ª Piecewise Linear ç Curves,åé½å¯ä»¥ç¨ä¸å¤§å èè²ç Function ç»åèµ·æ¥,ä¹å°±æ¯è¯´,æåªè¦æè¶³å¤çèè² Function æå®å èµ·æ¥,æä¹è®¸å°±å¯ä»¥åæä»»ä½è¿ç»­çæ²çº¿ã\n\n\n# 2. èè² Function ï¼Hard Sigmoidï¼æä¹ååºæ¥\n\n# ï¼1ï¼Sigmoid Functionï¼Såæ²çº¿)\n\nç¨ sigmoid Function æ¥é¼è¿èè² Functionãå¬å¼ï¼\n\n$y=c\\frac{1}{1+e^{b+wx_1}} =c*sigmoid(b+wx_1) $\n\n# (2) åå¼åæ ·çèè² Function ææ ·å¶é åºæ¥\n\nè°æ´ b ãw å c ï¼\n\n * å¦æä½ ä»å¤©æ¹ w ä½ å°±ä¼æ¹åæçä½ å°±ä¼æ¹åæå¡çå¡åº¦\n\n * å¦æä½ å¨äº b ä½ å°±å¯ä»¥æè¿ä¸ä¸ª Sigmoid Function å·¦å³ç§»å¨\n\n * å¦æä½ æ¹ c ä½ å°±å¯ä»¥æ¹åå®çé«åº¦\n   \n   ä¸åç Sigmoid Function å èµ·æ¥ä»¥åï¼å¯ä»¥å»é¼è¿åç§Piecewise Linear ç Functionï¼ç¶åå¯ä»¥ç¨æ¥æ¥è¿ä¼¼ä¸åçè¿ç»­å½æ°ã\n\n\n# 3. çº¢è² Function é¿ä»ä¹æ ·å­\n\nçº¢è²æ²çº¿ = èè²0+1+2+3ï¼å³\n\n# å¦ä½åå° Model çBias\n\nåä¸ä¸ªæ´æå¼¹æ§ç,ææªç¥åæ°ç Functionï¼\n\næ­¤æ¶ï¼ç¨äºå¤ä¸ªFeatureï¼å³$X_1$ã j æ¥ä»£è¡¨ Feature çç¼å·.\n\næä»¬åèèä¸ä¸ j å°±æ¯ 1 2 3 çç¶åµ,å°±æ¯æä»¬åªèèä¸ä¸ª Featureãä¸¾ä¾æ¥è¯´ æä»¬åªèèåä¸ãäºãä¸å¤©ç Caseï¼\n\n * æä»¥ j ç­æ¼ 1 2 3,é£æä»¥è¾å¥å°±æ¯ x1 ä»£è¡¨åä¸å¤©çè§çäººæ°,x2 ä¸¤å¤©åè§çäººæ°,x3 ä¸å¤©åçè§çäººæ°\n\n * æ¯ä¸ä¸ª i å°±ä»£è¡¨äºä¸ä¸ªèè²ç Function,åªæ¯æä»¬ç°å¨æ¯ä¸ä¸ªèè²ç Function,é½ç¨ä¸ä¸ª Sigmoid Function æ¥æ¯è¿ä¼¼å®ï¼1 2 3 ä»£è¡¨æä¸ä¸ª Sigmoid Function,\n   \n   è¿ä¸ªæ¬å·è£¡é¢åçäºææ¯ä»éº¼ï¼\n\nè¡¨è¾¾æç©éµå½¢å¼ï¼\n\nè¿ä¸ªèè²æ¹æ¡åçäºæï¼\n\næ¥ä¸æ¥ï¼\n\næ´ä¸ªè¿ç¨åçäºæä¸ºï¼\n\n**éæ°å®ä¹ç¬¦å·ï¼**åä¸ªååéæ¼å¨ä¸èµ·ï¼ç»ç§°ä¸º$\\theta$.\n\n\n# Back to ML_Step 2 :define loss from training data\n\nç´æ¥ç¨ Î¸ æ¥ç»è®¾ææçåæ°,æä»¥æä»¬ç°å¨ç Loss Function å°±åæ $L(\\theta)$.\n\n\n# Back to ML_Step 3: Optimization\n\nä¸ç´æç§è¿ä¸ªå¾è®¡ç®ä¸å»ï¼ç´å° Gradient=0 åéçç»ææèä¸æ³åäºã\n\nä½æ¯å®éä¸ï¼æä»¬çæ°æ®ééå¸¸ä¼å¾å¤§ï¼åè®¾ä¸º N ï¼æä»¬æè¿ N ç¬èµæåæä¸ä¸ªä¸ªç»ï¼ä¸ç»å« Batchï¼å¹¶ä¸åªæ¿ä¸ä¸ª Batch éç Data ç®ä¸ä¸ª Lossï¼æä»å«å L1ãåè®¾è¿ä¸ª B å¤å¤§,ä¹è®¸ L è· L1 ä¼å¾æ¥è¿ ä¹è¯´ä¸å®,æä»¥å®ä½ä¸çæ¶å,æ¯æ¬¡æä»¬ä¼åéä¸ä¸ª Batch,ç¨è¿ä¸ª Batch æ¥ç® L,æ ¹æ®è¿ä¸ª L1 æ¥ç® Gradient,ç¨è¿ä¸ª Gradient æ¥æ´æ°åæ°,æ¥ä¸æ¥åéä¸ä¸ä¸ª Batch ç®åº L2,æ ¹æ® L2 ç®åº Gradient,ç¶ååæ´æ°åæ°,ååä¸ä¸ä¸ª Batch ç®åº L3,æ ¹æ® L3 ç®åº Gradient,åç¨ L3 ç®åºæ¥ç Gradient æ¥æ´æ°åæ°ï¼å¦ä¸å¾ï¼ æä»¥æä»¬å¹¶ä¸æ¯æ¿ L æ¥ç® Gradientï¼å®éä¸æä»¬æ¯æ¿ä¸ä¸ª Batch ç®åºæ¥ç L1 L2 L3ï¼æ¥è®¡ç® Gradientï¼é£æææç Batch é½çè¿ä¸æ¬¡ï¼å«åä¸ä¸ª Epochï¼æ¯ä¸æ¬¡æ´æ°åæ°å«åä¸æ¬¡ Updateï¼Update è· Epoch æ¯ä¸ä¸æ ·çä¸è¥¿ãBatch Size ä¹æ¯ä¸ä¸ª HyperParameterã æ¯æ¬¡æ´æ°ä¸æ¬¡åæ°å«åä¸æ¬¡ Update,æææç Batch é½è¿ä¸é,å«åä¸ä¸ª Epochã\n\n\n# æ¨¡ååå\n\n# Activation Function\n\n * Sigmoidï¼Såï¼\n * ReLUï¼Rectified Linear Unitï¼\n\næä¸¤ä¸ª ReLU å èµ·æ¥,å°±å¯ä»¥åæ Hard ç Sigmoid,ä½ æ³è¦ç¨ ReLU çè¯,å°±æ Sigmoid çå°æ¹,æ¢æ$max(0, b_i+w_{ij}x_j)$.\n\næ¥ä¸æ¥çå®éªé½éæ©ç¨äº ReLU,æ¾ç¶ ReLU æ¯è¾å¥½.åå ä¸ååè§£\n\n# æ¨¡åæ¹è¿ââå¤åå æ¬¡\n\nDeep Learningï¼Neural Networkæ¢ä¸ªäºåå­ï¼éæ¯éé£ãå¦ä¸å¾ï¼\n\nOver Fittingï¼æ´æ·±å±æ¬¡ä¹åï¼å¨è®­ç»éä¸æææ´å¥½ï¼ä½æ¯é¢æµçæææ´å·®äºã",normalizedContent:"æºå¨å­¦ä¹ æ¦æ¬æ¥è¯´ï¼æºå¨å­¦ä¹ å°±æ¯è®©æºå¨å·å¤æ¾ä¸ä¸ªå½å¼çè½åã\n\n\n# different types of functions\n\n * regressionï¼åå½ï¼\n   \n   * è¾åºæ¯ä¸ä¸ªæ°å¼ï¼scalarï¼\n     \n     > ä¾å¦ï¼ä»å¤©è¦æºå¨åçäºæ,æ¯é¢æµæªæ¥æä¸ä¸ªæ¶é´ç,pm2.5çæ°å¼ãè¾å¥å¯è½æ¯ç§ç§è·é¢æµpm2.5,æå³çææ°,è¿ä¸ä¸ªå½å¼å¯ä»¥æ¿è¿äºæ°å¼å½ä½è¾å¥,è¾åºæå¤©ä¸­åçpm2.5çæ°å¼,é£è¿ä¸ä¸ªæ¾è¿ä¸ªå½å¼çä»»å¡,å«ä½regressionã\n\n * classificationï¼åç±»ï¼\n   \n   * è¦æºå¨åéæ©é¢ãäººç±»åå¤å¥½ä¸äºéé¡¹ï¼ä¹å«ç±»å«ï¼ï¼classesï¼ï¼ä»è®¾å®å¥½çéé¡¹ä¸­éæ©ä¸ä¸ªå½åè¾åºï¼è¿ä¸ªä»»å¡å°±å«å classificationã\n     \n     > ä¾å¦ï¼gmail accountè£¡é¢æä¸ä¸ªå½å¼,å¸®æä»¬ä¾¦æµä¸å°é®ä»¶,æ¯ä¸æ¯åå¾é®ä»¶ã\n     > \n     > alpha goæ¬èº«ä¹æ¯ä¸ä¸ª classification çé®é¢ã\n\n * structured learning\n   \n   * æºå¨ä»å¤©ä¸åªæ¯è¦åéæ©é¢ï¼ä¸åªæ¯è¾åºä¸ä¸ªæ°å­ï¼è¿è¦äº§çä¸ä¸ªæç»æçç©ä»¶ãæºå¨ç»ä¸å¼ å¾ åä¸ç¯æç« ,è¿ç§å«æºå¨äº§çæç»æçä¸è¥¿çé®é¢,å°±å«ä½structured learningãå³è¦æºå¨å­¦ä¼åé ã\n\n\n# case study\n\nä¸¾ä¾è¯´ææºå¨æä¹æ¾ä¸ä¸ªå½å¼ã\n\næ¾ä¸ä¸ªå½å¼,è¿ä¸ªå½å¼çè¾å¥æ¯youtubeä¸é¢ä¸ä¸ªé¢éè¿å¾ææçèµè®¯ï¼è¾åºå°±æ¯é¢æµæå¤©è¿ä¸ªé¢éå¯è½çæ»è§çæ¬¡æ°ã\n\næ¾è¿ä¸ªå½å¼çè¿ç¨ï¼åä¸ºä¸æ­¥ï¼\n\n 1. ååºä¸ä¸ªå¸¦ææªç¥åæ°çå½å¼ï¼2. å®ä¹ä¸ä¸ªå«ålossçfunctionï¼3. è§£ä¸ä¸ªoptimizationçé®é¢æ¾å°ä¸ç»åæ°ä½¿losså¼æå°ã<æ¬è´¨æ¯è®­ç»ï¼ç¨å·²ç¥çæ°æ®æ¥âé¢æµâ>\n\n----------------------------------------\n\n\n# 1. function with unknown parameters\n\nåè®¾å½å¼ä¸º $ y=b+w*x_{1} $ï¼è¿ä¸ªå¸¦æunknownçparameterçfunctionå«åmodelãè¿ä¸ªçæµå¾å¾å°±æ¥èªäºä½ å¯¹è¿ä¸ªé®é¢æ¬è´¨ä¸çäºè§£ï¼ä¹å°±æ¯ domain knowledge\n\n * y ä¸ºé¢æµå¼ï¼æ¬ä¾ä¸­ä¸ºæå¤©è§çæ­¤é¢éçæ»äººæ°\n * $x_{1}$ä¸ºå·²ç¥çä¸è¥¿ï¼å«åfeatureï¼æ¬ä¾ä¸­ä¸ºä»å¤©è§ççäººæ°\n * b (bias) å w (weight)æ¯æªç¥çåæ°ï¼è¦ä»æ°æ®èµæä¸­å­¦ä¹ å¾å°\n\n\n# 2. define loss from training data\n\n# (1) loss å½æ°\n\nå®ä¹ä¸ä¸ª loss å½æ°ï¼è¾å¥ä¸º model ä¸­çæªç¥åæ° b å wï¼parameterï¼ï¼è¾åºçå¼è¡¨ç¤ºè¥æè¿ç»å¼ä¼ ç»æªç¥åæ°ï¼å¯¹äºè®¡ç®åºçé¢æµå¼æ¯å¥½è¿æ¯ä¸å¥½ã\n\nå¯¹äº loss çè®¡ç®ï¼è¦ä»è®­ç»èµææ¥è¿è¡ãæä»¥å¯¹äºä¸ä¸ªé¢æµå¼ï¼å¯ä»¥ä»è®­ç»èµæä¸­ç¥éçå®çç»æï¼å èå¯ä»¥è®¡ç®é¢ä¼°ç»æåçæ­£ç»æï¼labelï¼ä¹é´çè¯¯å·® e ï¼$e_{i} = è®¡ç®å·®è·(yï¼\\hat{y} )$ãå¯ä»¥ä»¥æ­¤æ¹æ³è®¡ç®è®­ç»éä¸­çæ¯ä¸å¤©çè¯¯å·®ï¼ä»èå¯å¾ loss å¼:$l=\\frac{1}{n}\\sum_{n}e_{_n}$\n\nlè¶å¤§,ä»£è¡¨è¿ç»åæ°è¶ä¸å¥½ï¼lè¶å°,ä»£è¡¨è¿ç»åæ°è¶å¥½\n\n# (2) è®¡ç®è¯¯å·®e\n\nå¦ä¸å¾ï¼è®¡ç®è¯¯å·® e æå¤ç§æ¹æ³ï¼maeãmsn ãcross-entropyï¼y å y æºçåå¸æ¶ä½¿ç¨ï¼ ç­ã\n\n# (3) error surface\n\næä»¬å¯ä»¥è°æ´ä¸åç w å b ï¼çºä¸åçwè·bçç»åè®¡ç®å®çloss,ç¶åå°±å¯ä»¥ç»åºä»¥ä¸è¿ä¸ä¸ªç­é«çº¿å¾.ï¼å°è¯ä¸åçåæ°ï¼è®¡ç®lossï¼ç»åºæ¥çå¾ï¼\n\nå¨è¿ä¸ªç­é«çº¿å¾ä¸é¢,è¶åçº¢è²ç³»,ä»£è¡¨è®¡ç®åºæ¥çlossè¶å¤§,å°±ä»£è¡¨è¿ä¸ç»wè·bè¶å·®,å¦æè¶åèè²ç³»,å°±ä»£è¡¨lossè¶å°,å°±ä»£è¡¨è¿ä¸ç»wè·bè¶å¥½ã\n\n\n# 3. optimization\n\nè§£ä¸ä¸ªæä½³åçé®é¢ï¼æ¾ä¸ç»æªç¥åæ°ï¼è®© loss æå°ãæ¬ä¾ä¸­æ¯æ¾è®© loss æå°ç w* å b*ãä¸ä¸ªoptimization æ¹æ³ï¼gradient descentã\n\nææ ·æ¾ä¸ä¸ª w è®©è¿ä¸ª loss çå¼æå°å¢ï¼éæºéåä¸ä¸ªåå§çç¹ï¼è¿ä¸ªåå§çç¹,æä»¬å«å w0-> æ±åæ°å¯¹ loss çå¾®å -> æ´æ°åæ°å¼ãæä½çå°æ¹è·¨ä¸æ­¥ï¼é£æ´æ°æ¶è¿ä¸æ­¥è¦è·¨å¤å¤§å¢ï¼è¿ä¸æ­¥çæ­¥ä¼çå¤§å°åå³äºè¿ä¸ªå°æ¹çæçåå­¦ä¹ ç ($\\eta $)ï¼èªå·±è®¾å®çï¼ãè¿ç§ä½ å¨åæºå¨å­¦ä¹ ,éè¦èªå·±è®¾å®çä¸è¥¿,å«åhyperparameters ï¼è¶åæ°ï¼ã\n\nä»ä¹æ¶ååä¸æ¥å¢ï¼å¾å¾æä¸¤ç§ç¶åµï¼\n\n * ç¬¬ä¸ç§ç¶åµæ¯ä½ å¤±å»èå¿äºï¼ä½ ä¸å¼å§ä¼è®¾å®è¯´ï¼æä»å¤©å¨è°æ´æçåæ°çæ¶åï¼ææå¤è®¡ç®å æ¬¡ï¼\n * é£è¿æå¦å¤ä¸ç§çæ³ä¸åä¸æ¥çå¯è½æ¯ï¼ä»å¤©å½æä»¬ä¸æ­è°æ´åæ°æ¶è°æ´å°ä¸ä¸ªå°æ¹ï¼å®çå¾®åçå¼ç®åºæ¥æ­£å¥½æ¯ 0 çæ¶åï¼å¦æè¿ä¸é¡¹æ­£å¥½ç®åºæ¥æ¯0.0ä¹ä¸ learning rate è¿æ¯ 0ï¼æä»¥ä½ çåæ°å°±ä¸ä¼åç§»å¨ä½ç½®ï¼é£åæ°çä½ç½®å°±ä¸ä¼åæ´æ°ã\n\n\n\nä½ å¯è½ä¼åç° gradient descent è¿ä¸ªæ¹æ³æä¸ä¸ªå·¨å¤§çé®é¢ï¼æä»¬æ²¡ææ¾å°çæ­£æå¥½çè§£ï¼æä»¬åªæ¯æ¾å°ç local minima èä¸æ¯ global minimaãå¶å®ï¼local minima æ¯ä¸ä¸ªåé®é¢ï¼æä»¬å¨å gradient descent çæ¶åçæ­£é¢å¯¹çé¾é¢ä¸æ¯ local minimaï¼ä¹åä¼è®²å°å®ççæ­£çç¹å¨åªã\n\nåååªæä¸ä¸ªåæ° wï¼å°å¶æ©å±è³äºç»´ä¹è³å¤ç»´æ¯åçã\n\noptimization\n\n\n# linear model\n\nä¸æä¸­çæ¨¡åå³çº¿æ§æ¨¡åã\n\nè§å¯çå®æ°æ®ï¼åç°æ¯éä¸å¤©ä¸ä¸ªå¾ªç¯ï¼å æ­¤å¯ä»¥ä¿®æ¹æ¨¡åï¼æ¨¡åçä¿®æ¹éå¸¸æ¥èªäºå¯¹é®é¢ççè§£ï¼å³ domain knowledgeï¼ãå èæ¨¡åä»$y=b+wx_1$ --\x3e $y=b+ \\sum_{j=1}^{7}w_jx_j$ï¼åä¸å¤©çè§çäººæ°é½è¢«åå¥èèã\n\n\n# piecewise linear curves(åæ®µçº¿æ§æ²çº¿)\n\nä¸ç®¡æéº¼æå¼w è· b,ä½ æ°¸è¿è£½é ä¸åºçº¢è²é£ä¸æ¡çº¿,ä½ æ°¸è¿æ æ³ç¨ linear ç model,è£½é çº¢è²è¿ä¸æ¡çº¿ãå ä¸º model çéå¶èä½¿å¾æ°¸è¿æ æ³æ¨¡æçå®ç¶åµï¼è¿ç§æ¥èª model çéå¶ï¼å«åmodel ç biasï¼=ä¸æä¸­ model ä¸­ç bias bï¼ã\n\n\n# 1. çº¢è²æ²çº¿æä¹è¡¨è¾¾\n\nå¾ä¸­çº¢è²çè¿ä¸æ¡æ²çº¿ï¼å¯ä»¥çä½æ¯ä¸ä¸ªå¸¸æ°ï¼å ä¸ä¸ç¾¤èè²è¿æ ·ç functionã\n\nè¿ä¸ªèè²ç function å«å hard sigmoidï¼å®çç¹æ§æ¯\n\n * å½è¾å¥çå¼,å½ x è½´çå¼å°æ¼æä¸ä¸ªè¿ä¸ª flash hold çæ¶å,å®æ¯æä¸ä¸ªå®å¼,\n * å¤§æ¼å¦å¤ä¸ä¸ª flash hold çæ¶å,åæ¯å¦å¤ä¸ä¸ªå®å¼,\n * ä¸­é´æä¸ä¸ªæå¡\n\npiecewise linear ç curves è¶å¤æ,ä¹å°±æ¯è¿ä¸ªè½¬æçç¹è¶å¤å,é£ä½ éè¦çè¿ä¸ªèè²ç function å°±è¶å¤ãå¯ä»¥ç¨ piecewise linear ç curves,å»é¼è¿ä»»ä½çè¿ç»­çæ²çº¿,èæ¯ä¸ä¸ª piecewise linear ç curves,åé½å¯ä»¥ç¨ä¸å¤§å èè²ç function ç»åèµ·æ¥,ä¹å°±æ¯è¯´,æåªè¦æè¶³å¤çèè² function æå®å èµ·æ¥,æä¹è®¸å°±å¯ä»¥åæä»»ä½è¿ç»­çæ²çº¿ã\n\n\n# 2. èè² function ï¼hard sigmoidï¼æä¹ååºæ¥\n\n# ï¼1ï¼sigmoid functionï¼såæ²çº¿)\n\nç¨ sigmoid function æ¥é¼è¿èè² functionãå¬å¼ï¼\n\n$y=c\\frac{1}{1+e^{b+wx_1}} =c*sigmoid(b+wx_1) $\n\n# (2) åå¼åæ ·çèè² function ææ ·å¶é åºæ¥\n\nè°æ´ b ãw å c ï¼\n\n * å¦æä½ ä»å¤©æ¹ w ä½ å°±ä¼æ¹åæçä½ å°±ä¼æ¹åæå¡çå¡åº¦\n\n * å¦æä½ å¨äº b ä½ å°±å¯ä»¥æè¿ä¸ä¸ª sigmoid function å·¦å³ç§»å¨\n\n * å¦æä½ æ¹ c ä½ å°±å¯ä»¥æ¹åå®çé«åº¦\n   \n   ä¸åç sigmoid function å èµ·æ¥ä»¥åï¼å¯ä»¥å»é¼è¿åç§piecewise linear ç functionï¼ç¶åå¯ä»¥ç¨æ¥æ¥è¿ä¼¼ä¸åçè¿ç»­å½æ°ã\n\n\n# 3. çº¢è² function é¿ä»ä¹æ ·å­\n\nçº¢è²æ²çº¿ = èè²0+1+2+3ï¼å³\n\n# å¦ä½åå° model çbias\n\nåä¸ä¸ªæ´æå¼¹æ§ç,ææªç¥åæ°ç functionï¼\n\næ­¤æ¶ï¼ç¨äºå¤ä¸ªfeatureï¼å³$x_1$ã j æ¥ä»£è¡¨ feature çç¼å·.\n\næä»¬åèèä¸ä¸ j å°±æ¯ 1 2 3 çç¶åµ,å°±æ¯æä»¬åªèèä¸ä¸ª featureãä¸¾ä¾æ¥è¯´ æä»¬åªèèåä¸ãäºãä¸å¤©ç caseï¼\n\n * æä»¥ j ç­æ¼ 1 2 3,é£æä»¥è¾å¥å°±æ¯ x1 ä»£è¡¨åä¸å¤©çè§çäººæ°,x2 ä¸¤å¤©åè§çäººæ°,x3 ä¸å¤©åçè§çäººæ°\n\n * æ¯ä¸ä¸ª i å°±ä»£è¡¨äºä¸ä¸ªèè²ç function,åªæ¯æä»¬ç°å¨æ¯ä¸ä¸ªèè²ç function,é½ç¨ä¸ä¸ª sigmoid function æ¥æ¯è¿ä¼¼å®ï¼1 2 3 ä»£è¡¨æä¸ä¸ª sigmoid function,\n   \n   è¿ä¸ªæ¬å·è£¡é¢åçäºææ¯ä»éº¼ï¼\n\nè¡¨è¾¾æç©éµå½¢å¼ï¼\n\nè¿ä¸ªèè²æ¹æ¡åçäºæï¼\n\næ¥ä¸æ¥ï¼\n\næ´ä¸ªè¿ç¨åçäºæä¸ºï¼\n\n**éæ°å®ä¹ç¬¦å·ï¼**åä¸ªååéæ¼å¨ä¸èµ·ï¼ç»ç§°ä¸º$\\theta$.\n\n\n# back to ml_step 2 :define loss from training data\n\nç´æ¥ç¨ Î¸ æ¥ç»è®¾ææçåæ°,æä»¥æä»¬ç°å¨ç loss function å°±åæ $l(\\theta)$.\n\n\n# back to ml_step 3: optimization\n\nä¸ç´æç§è¿ä¸ªå¾è®¡ç®ä¸å»ï¼ç´å° gradient=0 åéçç»ææèä¸æ³åäºã\n\nä½æ¯å®éä¸ï¼æä»¬çæ°æ®ééå¸¸ä¼å¾å¤§ï¼åè®¾ä¸º n ï¼æä»¬æè¿ n ç¬èµæåæä¸ä¸ªä¸ªç»ï¼ä¸ç»å« batchï¼å¹¶ä¸åªæ¿ä¸ä¸ª batch éç data ç®ä¸ä¸ª lossï¼æä»å«å l1ãåè®¾è¿ä¸ª b å¤å¤§,ä¹è®¸ l è· l1 ä¼å¾æ¥è¿ ä¹è¯´ä¸å®,æä»¥å®ä½ä¸çæ¶å,æ¯æ¬¡æä»¬ä¼åéä¸ä¸ª batch,ç¨è¿ä¸ª batch æ¥ç® l,æ ¹æ®è¿ä¸ª l1 æ¥ç® gradient,ç¨è¿ä¸ª gradient æ¥æ´æ°åæ°,æ¥ä¸æ¥åéä¸ä¸ä¸ª batch ç®åº l2,æ ¹æ® l2 ç®åº gradient,ç¶ååæ´æ°åæ°,ååä¸ä¸ä¸ª batch ç®åº l3,æ ¹æ® l3 ç®åº gradient,åç¨ l3 ç®åºæ¥ç gradient æ¥æ´æ°åæ°ï¼å¦ä¸å¾ï¼ æä»¥æä»¬å¹¶ä¸æ¯æ¿ l æ¥ç® gradientï¼å®éä¸æä»¬æ¯æ¿ä¸ä¸ª batch ç®åºæ¥ç l1 l2 l3ï¼æ¥è®¡ç® gradientï¼é£æææç batch é½çè¿ä¸æ¬¡ï¼å«åä¸ä¸ª epochï¼æ¯ä¸æ¬¡æ´æ°åæ°å«åä¸æ¬¡ updateï¼update è· epoch æ¯ä¸ä¸æ ·çä¸è¥¿ãbatch size ä¹æ¯ä¸ä¸ª hyperparameterã æ¯æ¬¡æ´æ°ä¸æ¬¡åæ°å«åä¸æ¬¡ update,æææç batch é½è¿ä¸é,å«åä¸ä¸ª epochã\n\n\n# æ¨¡ååå\n\n# activation function\n\n * sigmoidï¼såï¼\n * reluï¼rectified linear unitï¼\n\næä¸¤ä¸ª relu å èµ·æ¥,å°±å¯ä»¥åæ hard ç sigmoid,ä½ æ³è¦ç¨ relu çè¯,å°±æ sigmoid çå°æ¹,æ¢æ$max(0, b_i+w_{ij}x_j)$.\n\næ¥ä¸æ¥çå®éªé½éæ©ç¨äº relu,æ¾ç¶ relu æ¯è¾å¥½.åå ä¸ååè§£\n\n# æ¨¡åæ¹è¿ââå¤åå æ¬¡\n\ndeep learningï¼neural networkæ¢ä¸ªäºåå­ï¼éæ¯éé£ãå¦ä¸å¾ï¼\n\nover fittingï¼æ´æ·±å±æ¬¡ä¹åï¼å¨è®­ç»éä¸æææ´å¥½ï¼ä½æ¯é¢æµçæææ´å·®äºã",charsets:{cjk:!0},lastUpdated:"2022/03/28, 03:20:10",lastUpdatedTimestamp:164843761e4},{title:"ç¥ç»ç½ç»è®­ç»ä¸èµ·æ¥æä¹å",frontmatter:{title:"ç¥ç»ç½ç»è®­ç»ä¸èµ·æ¥æä¹å",date:"2022-10-12T09:52:10.000Z",permalink:"/pages/e6f457/",categories:["AI","æ·±åº¦å­¦ä¹ ","æå®æ¯"],tags:[null]},regularPath:"/AI/05.%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/05.%E6%9D%8E%E5%AE%8F%E6%AF%85/05.%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E8%AE%AD%E7%BB%83%E4%B8%8D%E8%B5%B7%E6%9D%A5%E6%80%8E%E4%B9%88%E5%8A%9E.html",relativePath:"AI/05.æ·±åº¦å­¦ä¹ /05.æå®æ¯/05.ç¥ç»ç½ç»è®­ç»ä¸èµ·æ¥æä¹å.md",key:"v-74cfb0b2",path:"/pages/e6f457/",headersStr:null,content:"éå¸¸ local minimum å¹¶ä¸å¸¸è§ï¼æ´å¸¸è§çæ¯ saddle pointï¼å¤§é¨åæ¶åé½è¿æè·¯å¯ä»¥è®© Loss ä¸éã\n\n",normalizedContent:"éå¸¸ local minimum å¹¶ä¸å¸¸è§ï¼æ´å¸¸è§çæ¯ saddle pointï¼å¤§é¨åæ¶åé½è¿æè·¯å¯ä»¥è®© loss ä¸éã\n\n",charsets:{cjk:!0},lastUpdated:"2023/01/24, 08:14:58",lastUpdatedTimestamp:1674548098e3},{title:"Home",frontmatter:{home:!0,heroText:"Nrich's blog",tagline:"ç§¯è·¬æ­¥ä»¥è³åéï¼è´æ¬æ¯ä¸ªç±å­¦ä¹ çä½ ã",features:[{title:"å¼å",details:"javaç­åç«¯ææ¯",imgUrl:"/img/milkdragon.jpeg"},{title:"AI",details:"æ·±åº¦å­¦ä¹ ç­å­¦ä¹ ç¬è®°",imgUrl:"/img/ui.png"},{title:"ææ¯",details:"ææ¯ææ¡£ãæç¨ãæå·§ãæ»ç»ç­æç« ",imgUrl:"/img/other.png"}]},regularPath:"/",relativePath:"index.md",key:"v-a113e2c4",path:"/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/03/28, 03:20:10",lastUpdatedTimestamp:164843761e4},{title:"åºç¡æ¶æãæ°æ®ç»æä¸ IO æ¨¡å",frontmatter:{title:"åºç¡æ¶æãæ°æ®ç»æä¸ IO æ¨¡å",date:"2023-03-20T14:37:36.000Z",permalink:"/pages/271391/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/01.%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E3%80%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%20IO%20%E6%A8%A1%E5%9E%8B.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/01.åºç¡æ¶æãæ°æ®ç»æä¸ IO æ¨¡å.md",key:"v-6962c4c2",path:"/pages/271391/",headers:[{level:2,title:"1. åºç¡æ¶æï¼ä¸ä¸ªé®å¼æ°æ®åºåå«ä»ä¹ï¼",slug:"_1-åºç¡æ¶æ-ä¸ä¸ªé®å¼æ°æ®åºåå«ä»ä¹",normalizedTitle:"1. åºç¡æ¶æï¼ä¸ä¸ªé®å¼æ°æ®åºåå«ä»ä¹ï¼",charIndex:53},{level:3,title:"1.1 å¯ä»¥å­åªäºæ°æ®ï¼",slug:"_1-1-å¯ä»¥å­åªäºæ°æ®",normalizedTitle:"1.1 å¯ä»¥å­åªäºæ°æ®ï¼",charIndex:417},{level:3,title:"1.2 å¯ä»¥å¯¹æ°æ®åä»ä¹æä½ï¼",slug:"_1-2-å¯ä»¥å¯¹æ°æ®åä»ä¹æä½",normalizedTitle:"1.2 å¯ä»¥å¯¹æ°æ®åä»ä¹æä½ï¼",charIndex:824},{level:3,title:"1.3 éç¨ä»ä¹è®¿é®æ¨¡å¼ï¼",slug:"_1-3-éç¨ä»ä¹è®¿é®æ¨¡å¼",normalizedTitle:"1.3 éç¨ä»ä¹è®¿é®æ¨¡å¼ï¼",charIndex:1674},{level:3,title:"1.4 å¦ä½å®ä½é®å¼å¯¹çä½ç½®ï¼",slug:"_1-4-å¦ä½å®ä½é®å¼å¯¹çä½ç½®",normalizedTitle:"1.4 å¦ä½å®ä½é®å¼å¯¹çä½ç½®ï¼",charIndex:2330},{level:3,title:"1.5 ä¸åæä½çå·ä½é»è¾æ¯ææ ·çï¼",slug:"_1-5-ä¸åæä½çå·ä½é»è¾æ¯ææ ·ç",normalizedTitle:"1.5 ä¸åæä½çå·ä½é»è¾æ¯ææ ·çï¼",charIndex:2810},{level:3,title:"1.6 å¦ä½å®ç°éå¯åå¿«éæä¾æå¡ï¼",slug:"_1-6-å¦ä½å®ç°éå¯åå¿«éæä¾æå¡",normalizedTitle:"1.6 å¦ä½å®ç°éå¯åå¿«éæä¾æå¡ï¼",charIndex:3069},{level:3,title:"1.7 å°ç»",slug:"_1-7-å°ç»",normalizedTitle:"1.7 å°ç»",charIndex:3694},{level:2,title:"2. æ°æ®ç»æï¼å¿«éçRedisæåªäºæ¢æä½ï¼",slug:"_2-æ°æ®ç»æ-å¿«éçredisæåªäºæ¢æä½",normalizedTitle:"2. æ°æ®ç»æï¼å¿«éçredisæåªäºæ¢æä½ï¼",charIndex:4039},{level:3,title:"2.1 key å value ç¨ä»ä¹ç»æç»ç»ï¼",slug:"_2-1-key-å-value-ç¨ä»ä¹ç»æç»ç»",normalizedTitle:"2.1 key å value ç¨ä»ä¹ç»æç»ç»ï¼",charIndex:4694},{level:3,title:"2.2 ä¸ºä»ä¹åå¸è¡¨æä½åæ¢äºââåå¸å²çª",slug:"_2-2-ä¸ºä»ä¹åå¸è¡¨æä½åæ¢äº-åå¸å²çª",normalizedTitle:"2.2 ä¸ºä»ä¹åå¸è¡¨æä½åæ¢äºââåå¸å²çª",charIndex:5180},{level:3,title:"2.3 éåæ°æ®çæä½æç",slug:"_2-3-éåæ°æ®çæä½æç",normalizedTitle:"2.3 éåæ°æ®çæä½æç",charIndex:6259},{level:4,title:"2.3.1 æåªäºåºå±æ°æ®ç»æ",slug:"_2-3-1-æåªäºåºå±æ°æ®ç»æ",normalizedTitle:"2.3.1 æåªäºåºå±æ°æ®ç»æ",charIndex:6425},{level:4,title:"2.3.2 ä¸åæä½çå¤æåº¦",slug:"_2-3-2-ä¸åæä½çå¤æåº¦",normalizedTitle:"2.3.2 ä¸åæä½çå¤æåº¦",charIndex:7426},{level:3,title:"2.4 å°ç»",slug:"_2-4-å°ç»",normalizedTitle:"2.4 å°ç»",charIndex:8641},{level:2,title:"3. é«æ§è½ IO æ¨¡åï¼ä¸ºä»ä¹åçº¿ç¨è¿è½è¿ä¹å¿«ï¼",slug:"_3-é«æ§è½-io-æ¨¡å-ä¸ºä»ä¹åçº¿ç¨è¿è½è¿ä¹å¿«",normalizedTitle:"3. é«æ§è½ io æ¨¡åï¼ä¸ºä»ä¹åçº¿ç¨è¿è½è¿ä¹å¿«ï¼",charIndex:10048},{level:3,title:"3.1 Redis ä¸ºä»ä¹ç¨åçº¿ç¨ââå¤çº¿ç¨çå¹¶åè®¿é®æ§å¶é®é¢",slug:"_3-1-redis-ä¸ºä»ä¹ç¨åçº¿ç¨-å¤çº¿ç¨çå¹¶åè®¿é®æ§å¶é®é¢",normalizedTitle:"3.1 redis ä¸ºä»ä¹ç¨åçº¿ç¨ââå¤çº¿ç¨çå¹¶åè®¿é®æ§å¶é®é¢",charIndex:10427},{level:3,title:"3.2 åçº¿ç¨ Redis ä¸ºä»ä¹é£ä¹å¿«ââå¤è·¯å¤ç¨æºå¶",slug:"_3-2-åçº¿ç¨-redis-ä¸ºä»ä¹é£ä¹å¿«-å¤è·¯å¤ç¨æºå¶",normalizedTitle:"3.2 åçº¿ç¨ redis ä¸ºä»ä¹é£ä¹å¿«ââå¤è·¯å¤ç¨æºå¶",charIndex:10972},{level:4,title:"3.2.1 åºæ¬ IO æ¨¡åä¸é»å¡ç¹",slug:"_3-2-1-åºæ¬-io-æ¨¡åä¸é»å¡ç¹",normalizedTitle:"3.2.1 åºæ¬ io æ¨¡åä¸é»å¡ç¹",charIndex:11235},{level:4,title:"3.2.2 éé»å¡æ¨¡å¼",slug:"_3-2-2-éé»å¡æ¨¡å¼",normalizedTitle:"3.2.2 éé»å¡æ¨¡å¼",charIndex:11552},{level:4,title:"3.2.3 åºäºå¤è·¯å¤ç¨çé«æ§è½ I/O æ¨¡å",slug:"_3-2-3-åºäºå¤è·¯å¤ç¨çé«æ§è½-i-o-æ¨¡å",normalizedTitle:"3.2.3 åºäºå¤è·¯å¤ç¨çé«æ§è½ i/o æ¨¡å",charIndex:12219},{level:3,title:"3.3 å°ç»",slug:"_3-3-å°ç»",normalizedTitle:"3.3 å°ç»",charIndex:13554}],headersStr:"1. åºç¡æ¶æï¼ä¸ä¸ªé®å¼æ°æ®åºåå«ä»ä¹ï¼ 1.1 å¯ä»¥å­åªäºæ°æ®ï¼ 1.2 å¯ä»¥å¯¹æ°æ®åä»ä¹æä½ï¼ 1.3 éç¨ä»ä¹è®¿é®æ¨¡å¼ï¼ 1.4 å¦ä½å®ä½é®å¼å¯¹çä½ç½®ï¼ 1.5 ä¸åæä½çå·ä½é»è¾æ¯ææ ·çï¼ 1.6 å¦ä½å®ç°éå¯åå¿«éæä¾æå¡ï¼ 1.7 å°ç» 2. æ°æ®ç»æï¼å¿«éçRedisæåªäºæ¢æä½ï¼ 2.1 key å value ç¨ä»ä¹ç»æç»ç»ï¼ 2.2 ä¸ºä»ä¹åå¸è¡¨æä½åæ¢äºââåå¸å²çª 2.3 éåæ°æ®çæä½æç 2.3.1 æåªäºåºå±æ°æ®ç»æ 2.3.2 ä¸åæä½çå¤æåº¦ 2.4 å°ç» 3. é«æ§è½ IO æ¨¡åï¼ä¸ºä»ä¹åçº¿ç¨è¿è½è¿ä¹å¿«ï¼ 3.1 Redis ä¸ºä»ä¹ç¨åçº¿ç¨ââå¤çº¿ç¨çå¹¶åè®¿é®æ§å¶é®é¢ 3.2 åçº¿ç¨ Redis ä¸ºä»ä¹é£ä¹å¿«ââå¤è·¯å¤ç¨æºå¶ 3.2.1 åºæ¬ IO æ¨¡åä¸é»å¡ç¹ 3.2.2 éé»å¡æ¨¡å¼ 3.2.3 åºäºå¤è·¯å¤ç¨çé«æ§è½ I/O æ¨¡å 3.3 å°ç»",content:"# åºç¡æ¶æãæ°æ®ç»æä¸ IO æ¨¡å\n\n> åèï¼ 01 | åºæ¬æ¶æï¼ä¸ä¸ªé®å¼æ°æ®åºåå«ä»ä¹ï¼\n\n\n# 1. åºç¡æ¶æï¼ä¸ä¸ªé®å¼æ°æ®åºåå«ä»ä¹ï¼\n\nRedisæ¯å¸åçé®å¼æ°æ®åºã\n\næä»¬åå»ºç«èµ·âç³»ç»è§âï¼åæ·±å¥çè§£åä¼å Redisã å³åå¯¹å®çæ»ä½æ¶æåå³é®æ¨¡åæä¸ä¸ªå¨å±çè®¤ç¥ï¼ç¶ååæ·±å¥å°å·ä½çææ¯ç¹ã\n\nä»å¤©ï¼åæé ä¸ä¸ªç®åç KV æ°æ®åºï¼æä»¬åªéè¦å³æ³¨æ´ä½æ¶æåæ ¸å¿æ¨¡åï¼å¹¶å¯¹å¶è¿è¡åæãææè¿ä¸ªç®åçé®å¼æ°æ®åºç§°ä¸ºSimpleKVï¼å®åªæ¯ä¸ä¸ªå·æå³é®ç»ä»¶ç KV æ°æ®åºæ¶æã\n\n> è¿éç SimpleKV ä¸ GitHub ä¸ååçé¡¹ç®å¹¶ä¸æ¯ä¸ä¸ªä¸è¥¿ã\n\nå¼å§æé  SimpleKV æ¶ï¼é¦åå°±è¦èèéé¢å¯ä»¥å­ä»ä¹æ ·çæ°æ®ï¼å¯¹æ°æ®å¯ä»¥åä»ä¹æ ·çæä½ï¼ä¹å°±æ¯æ°æ®æ¨¡ååæä½æ¥å£ã\n\nå¯¹äºRedisæ¥è¯´ï¼å®å°åºè½åä»ä¹ï¼ä¸è½åä»ä¹å¢ï¼åªæåææå®çæ°æ®æ¨¡ååæä½æ¥å£ï¼æä»¬æè½çæ­£æâè¿åå¥½é¢ç¨å¨ååä¸âã\n\n\n# 1.1 å¯ä»¥å­åªäºæ°æ®ï¼\n\nå¯¹äºé®å¼æ°æ®åºèè¨ï¼åºæ¬çæ°æ®æ¨¡åæ¯ key-value æ¨¡åãSimpleKV ä¸­ï¼\n\n * key ä¸º String ç±»å\n * value ä¸ºåºæ¬æ°æ®ç±»åï¼å¦ Stringãæ´åç­ã\n\nå¯¹äºå®éçäº§ç¯å¢ä¸­çé®å¼æ°æ®åºæ¥è¯´ï¼value ç±»åè¿å¯ä»¥æ¯å¤æç±»åã\n\nä¸åé®å¼æ°æ®åºæ¯æçkeyç±»åä¸è¬å·®å¼ä¸å¤§ï¼èvalueç±»ååæè¾å¤§å·®å«ãæä»¬å¨å¯¹é®å¼æ°æ®åºè¿è¡éåæ¶ï¼ä¸ä¸ªéè¦çèèå ç´ æ¯å®æ¯æçvalueç±»åãä¾å¦ï¼Memcached æ¯æç value ç±»åä»ä¸º String ç±»åï¼è Redis æ¯æç value ç±»ååæ¬äº Stringãåå¸è¡¨ãåè¡¨ãéåç­ãRedisè½å¤å¨å®éä¸å¡åºæ¯ä¸­å¾å°å¹¿æ³çåºç¨ï¼å°±æ¯å¾çäºæ¯æå¤æ ·åç±»åç valueã\n\nä¸å value ç±»åçå®ç°å­å¨åç§æ§è½ãæçç­æ¹é¢çå·®å¼ï¼å æ­¤ç¨äºæ»¡è¶³ä¸åä¸å¡çéæ±ãæç½è¿äºåçæè½å»éæ©ã\n\n\n# 1.2 å¯ä»¥å¯¹æ°æ®åä»ä¹æä½ï¼\n\nSimpleKVæ¯ä¸ä¸ªç®åçé®å¼æ°æ®åºï¼å æ­¤ï¼åºæ¬æä½æ å¤ä¹å¢å æ¹æ¥ï¼\n\n * PUTï¼æ°åå¥ææ´æ°ä¸ä¸ª key-value å¯¹ï¼\n * GETï¼æ ¹æ®ä¸ä¸ª key è¯»åç¸åºçvalueå¼ï¼\n * DELETEï¼æ ¹æ®ä¸ä¸ª key å é¤æ´ä¸ª key-value å¯¹ã\n\néè¦æ³¨æçæ¯ï¼ æäºé®å¼æ°æ®åºçæ°å/æ´æ°æä½å« SETãæ°åå¥åæ´æ°è½ç¶æ¯ç¨ä¸ä¸ªæä½æ¥å£ï¼ä½å¨å®éæ§è¡æ¶ï¼ä¼æ ¹æ® key æ¯å¦å­å¨èæ§è¡ç¸åºçæ°åææ´æ°æµç¨ã\n\nå¨å®éçä¸å¡åºæ¯ä¸­ï¼æä»¬ç»å¸¸ä¼ç¢°å°è¿ç§æåµï¼æ¥è¯¢ä¸ä¸ªç¨æ·å¨ä¸æ®µæ¶é´åçè®¿é®è®°å½ãè¿ç§æä½å¨é®å¼æ°æ®åºä¸­å±äºSCAN æä½ï¼å³ æ ¹æ®ä¸æ®µ key çèå´è¿åç¸åºç value å¼ãå æ­¤ï¼ PUT/GET/DELETE/SCAN æ¯ä¸ä¸ªé®å¼æ°æ®åºçåºæ¬æä½éåã\n\næ­¤å¤ï¼å®éä¸å¡åºæ¯éå¸¸è¿ææ´å ä¸°å¯çéæ±ï¼æ¯å¦ EXISTS æ¥å£ãå¯¹äºä¸ä¸ªå·ä½çé®å¼æ°æ®åºèè¨ï¼ä½ å¯ä»¥éè¿æ¥çæä½ææ¡£ï¼äºè§£å¶è¯¦ç»çæä½æ¥å£ã\n\nç°å¨ï¼æ°æ®æ¨¡ååæä½æ¥å£æä»¬å°±æé å®æäºï¼è¿æ¯æä»¬çåºç¡å·¥ä½ãæ¥ä¸æ¥æ´è¿ä¸æ­¥ï¼éè¦èèä¸ä¸ªéå¸¸éè¦çè®¾è®¡é®é¢ï¼ é®å¼å¯¹ä¿å­å¨åå­è¿æ¯å¤å­ï¼\n\n * ä¿å­å¨åå­çå¥½å¤æ¯è¯»åå¾å¿«ï¼æ½å¨é£é©æ¯ä¸æ¦æçµï¼ææçæ°æ®é½ä¼ä¸¢å¤±ã\n * ä¿å­å¨å¤å­è½å¯ä»¥é¿åæ°æ®ä¸¢å¤±ï¼ä½åéäºç£çæ§è½ï¼æ´ä½æ°æ®åºçæ§è½å°±ä¼è¢«æä½ã\n\nå æ­¤ï¼ å¦ä½è¿è¡è®¾è®¡éæ©ï¼æä»¬éå¸¸éè¦èèé®å¼æ°æ®åºçä¸»è¦åºç¨åºæ¯ãæ¯å¦ï¼ç¼å­åºæ¯ä¸çæ°æ®éè¦è½å¿«éè®¿é®ä½åè®¸ä¸¢å¤±ï¼é£ä¹ï¼ç¨äºæ­¤åºæ¯çé®å¼æ°æ®åºéå¸¸éç¨åå­ä¿å­é®å¼æ°æ®ãMemcached å Redis é½æ¯å±äºåå­é®å¼æ°æ®åºã\n\nä¸ºäºåRedisä¿æä¸è´ï¼æä»¬ç SimpleKV å°±éç¨åå­ä¿å­é®å¼æ°æ®ãæ¥ä¸æ¥ï¼æä»¬æ¥äºè§£ä¸ SimpleKV çåºæ¬ç»ä»¶ãå¤§ä½æ¥è¯´ï¼ä¸ä¸ªé®å¼æ°æ®åºåæ¬äºè®¿é®æ¡æ¶ãç´¢å¼æ¨¡åãæä½æ¨¡ååå­å¨æ¨¡ååé¨åï¼\n\n\n\næ¥ä¸æ¥ï¼æä»¬å°±ä»è¿åä¸ªé¨åå¥æï¼ç»§ç»­æå»ºæä»¬ç SimpleKVã\n\n\n# 1.3 éç¨ä»ä¹è®¿é®æ¨¡å¼ï¼\n\nè®¿é®æ¨¡å¼éå¸¸æä¸¤ç§ï¼\n\n * ä¸ç§æ¯éè¿å½æ°åºè°ç¨çæ¹å¼ä¾å¤é¨åºç¨ä½¿ç¨ãæ¯å¦ä¸å¾ç libsimplekv.soï¼ä»¥å¨æé¾æ¥åºçå½¢å¼é¾æ¥å°ç¨åºä¸­\n * ä¸ç§æ¯éè¿ç½ç»æ¡æ¶ä»¥ Socket éä¿¡çå½¢å¼å¯¹å¤æä¾ KV æä½\n\nå®éçé®å¼æ°æ®åºä¹åºæ¬éç¨ä¸è¿°ä¸¤ç§æ¹å¼ï¼ä¾å¦ï¼RocksDB ä»¥å¨æé¾æ¥åºçå½¢å¼ä½¿ç¨ï¼è Memcached å Redis åæ¯éè¿ç½ç»æ¡æ¶è®¿é®ã\n\néè¿ç½ç»æ¡æ¶æä¾é®å¼å­å¨æå¡ï¼ä¸æ¹é¢æ©å¤§äºé®å¼æ°æ®åºçåç¨é¢ï¼ä½å¦ä¸æ¹é¢ï¼ä¹ç»é®å¼æ°æ®åºçæ§è½ãè¿è¡æ¨¡åæä¾äºä¸åçè®¾è®¡éæ©ï¼å¸¦æ¥äºä¸äºæ½å¨çé®é¢ã\n\nKV æ°æ®åºéè¿æ¥æ¶ç½ç»æ°æ®åï¼å¹¶æç§åè®®è¿è¡è§£æå¾å°æä½ï¼ç¶åæ§è¡ãæ­¤æ¶ï¼æä»¬ä¼éå°ä¸ä¸ªç³»ç»è®¾è®¡ä¸çé®é¢ï¼ç®åæ¥è¯´ï¼å°±æ¯ç½ç»è¿æ¥çå¤çãç½ç»è¯·æ±çè§£æï¼ä»¥åæ°æ®å­åçå¤çï¼æ¯ç¨ä¸ä¸ªçº¿ç¨ãå¤ä¸ªçº¿ç¨ï¼è¿æ¯å¤ä¸ªè¿ç¨æ¥äº¤äºå¤çå¢ï¼è¯¥å¦ä½è¿è¡è®¾è®¡ååèå¢ï¼æä»¬ä¸è¬æè¿ä¸ªé®é¢ç§°ä¸º I/O æ¨¡åè®¾è®¡ãä¸åç I/O æ¨¡åå¯¹é®å¼æ°æ®åºçæ§è½åå¯æ©å±æ§ä¼æä¸åçå½±åï¼\n\n * å¦æä½¿ç¨åçº¿ç¨ï¼é£ä¸ä¸ªçº¿ç¨æ¢è¦å¤çç½ç»è¿æ¥ãè§£æè¯·æ±ï¼åè¦å®ææ°æ®å­åï¼ä¸æ¦æä¸æ­¥æä½åçé»å¡ï¼æ´ä¸ªçº¿ç¨å°±ä¼é»å¡ä½ï¼è¿å°±éä½äºç³»ç»ååºéåº¦ã\n * å¦æä½¿ç¨å¤çº¿ç¨ï¼é£ä¸åçº¿ç¨é´å¦æéè¦è®¿é®å±äº«èµæºï¼é£åä¼äº§ççº¿ç¨ç«äºï¼ä¹ä¼å½±åç³»ç»æçã\n\nå æ­¤æä»¬éè¦è¿è¡ç²¾å¿çè®¾è®¡æ¥é¢å¯¹è¿ä¸ªä¸¤é¾çé®é¢ã\n\n> ä¹è®¸ä½ å¬è¯´è¿ Redis æ¯åçº¿ç¨ï¼é£ Redis æ¯å¦ä½åå°âåçº¿ç¨ãé«æ§è½âçå¢ï¼\n\n\n# 1.4 å¦ä½å®ä½é®å¼å¯¹çä½ç½®ï¼\n\nSimpleKV æ¥æ¾æä¸ª KV å¯¹çæä½ä¾èµäº KV æ°æ®åºçç´¢å¼æ¨¡åãç´¢å¼çä½ç¨æ¯è®©é®å¼æ°æ®åºæ ¹æ® key æ¾å°ç¸åº value çå­å¨ä½ç½®ï¼è¿èæ§è¡æä½ã\n\nç´¢å¼çç±»åæå¾å¤ï¼å¸¸è§çæåå¸è¡¨ãB+æ ãå­å¸æ ç­ãä¸åçç´¢å¼ç»æå¨æ§è½ãç©ºé´æ¶èãå¹¶åæ§å¶ç­æ¹é¢å·æä¸åçç¹å¾ãMemcached å Redis éç¨åå¸è¡¨ä½ä¸º key-value ç´¢å¼ï¼è RocksDB åéç¨è·³è¡¨ä½ä¸ºåå­ä¸­ key-value çç´¢å¼ã\n\nSimpleKVçç´¢å¼æ ¹æ® key æ¾å° value çå­å¨ä½ç½®å³å¯ãä½æ¯ï¼å SimpleKV ä¸åï¼å¯¹ Redis èè¨ï¼å®ç value æ¯æå¤ç§ç±»åï¼å½æä»¬éè¿ç´¢å¼æ¾å°ä¸ä¸ª key æå¯¹åºç value åï¼ä»ç¶éè¦ä» value çå¤æç»æï¼ä¾å¦éåååè¡¨ï¼ä¸­è¿ä¸æ­¥æ¾å°æä»¬å®ééè¦çæ°æ®ï¼è¿ä¸ªæä½çæçæ¬èº«å°±ä¾èµäºå®ä»¬çå®ç°ç»æã\n\nRedis éç¨ä¸äºå¸¸è§çé«æç´¢å¼ç»æä½ä¸ºæäº value ç±»åçåºå±æ°æ®ç»æï¼è¿ä¸ææ¯è·¯çº¿ä¸º Redis å®ç°é«æ§è½è®¿é®æä¾äºè¯å¥½çæ¯æã\n\n\n# 1.5 ä¸åæä½çå·ä½é»è¾æ¯ææ ·çï¼\n\nSimpleKV æ¾å°æ°æ®çå­å¨ä½ç½®åï¼å¯¹äºä¸åçæä½ï¼å¶è¿ä¸æ­¥æ§è¡çæä½é»è¾ä¹ææå·®å¼ã\n\nSimpleKV çæä½æ¨¡åå°±å®ç°äºä¸åæä½çå·ä½é»è¾ï¼\n\n * GET/SCANï¼ç«å»è¿åå½åä½ç½®ç value å³å¯ï¼\n * PUTï¼ä¸ºæ° KV pair åéåå­ç©ºé´ï¼\n * DELETEï¼å é¤ KV pairï¼å¹¶éæ¾ç¸åºåå­ç©ºé´ï¼è¿ä¸ªè¿ç¨ç±åéå¨å®æã\n\nå¯¹äº PUT æ DELETE æä½ï¼æ¶åå°äºåéåéæ¾åå­ï¼è¿å°±éè¦ SimpleKV æ°æ®åºçå­å¨æ¨¡åäºã\n\n\n# 1.6 å¦ä½å®ç°éå¯åå¿«éæä¾æå¡ï¼\n\nSimpleKV éç¨äºå¸¸ç¨çåå­åéå¨ glibc ç malloc å freeï¼å æ­¤ï¼SimpleKV å¹¶ä¸éè¦ç¹å«èèåå­ç©ºé´çç®¡çé®é¢ã\n\nä½æ¯ï¼KV æ°æ®åºç KV pair éå¸¸å¤§å°ä¸ä¸ï¼glibc çåéå¨å¨å¤çéæºçå¤§å°åå­ååéæ¶è¡¨ç°å¹¶ä¸å¥½ãä¸æ¦ä¿å­çé®å¼å¯¹æ°æ®è§æ¨¡è¿å¤§ï¼å°±å¯è½ä¼é æè¾ä¸¥éçåå­ç¢çé®é¢ã\n\nå æ­¤ï¼åéå¨æ¯ KV æ°æ®åºçä¸ä¸ªå³é®å ç´ ãRedis çåå­åéå¨æä¾äºå¤ç§éæ©ï¼åéæçä¹ä¸ä¸æ ·ï¼åé¢ä¼å¯¹æ­¤å±å¼è®²è¿°ã\n\nSimpleKV è½ç¶ä¾èµäºåå­ä¿å­æ°æ®ï¼æä¾å¿«éè®¿é®ï¼ä½æ¯ï¼æä¹å¸æ SimpleKV éå¯åè½å¿«ééæ°æä¾æå¡ï¼æä»¥ï¼æå¨ SimpleKV çå­å¨æ¨¡åä¸­å¢å äºæä¹ååè½ãä¸è¿ï¼é´äºç£çç®¡çè¦æ¯åå­ç®¡çå¤æï¼SimpleKV å°±ç´æ¥éç¨äºæä»¶å½¢å¼ï¼å°é®å¼æ°æ®éè¿è°ç¨æ¬å°æä»¶ç³»ç»çæä½æ¥å£ä¿å­å¨ç£çä¸ã\n\næ­¤æ¶ï¼SimpleKV åªéè¦èèä½æ¶å°åå­ä¸­çé®å¼æ°æ®ä¿å­å°æä»¶ä¸­ï¼\n\n * ä¸ç§æ¹å¼æ¯ï¼æ¯æ¬¡ KV pair çä¿®æ¹é½è¿è¡è½çæä½ãè½ç¶è¿æ´å¯é ï¼ä½æ§è½ä¼åå°å¾å¤§å½±åã\n * ä¸ç§æ¹å¼æ¯ï¼å¨ææ§å°æåå­ä¸­ç KV pair åæ­¥å°æä»¶ä¸­ãä½è¿é¢ä¸´æ°æ®ä¸¢å¤±çé£é©ã\n\nRedis ä¹æä¾äºæä¹ååè½ãä¸è¿ï¼ä¸ºäºéåºä¸åçä¸å¡åºæ¯ï¼Redis ä¸ºæä¹åæä¾äºè¯¸å¤çæ§è¡æºå¶åä¼åæ¹è¿ãåé¢ä¼å¯¹ Redis çæä¹åæºå¶çè®¾è®¡è¿è¡è®¨è®ºã\n\n\n# 1.7 å°ç»\n\nå¨äºè§£äºè¿ä¸ª SimpleKV çåºæ¬ç»ä»¶åï¼åå­¦ä¹  Redis è¿ä¸ªä¸°å¯çç SimpleKV æ¶å°±ä¼è½»æ¾å¾å¤ãä¸ºäºæ¯ææ´å ä¸°å¯çä¸å¡åºæ¯ï¼Rediså¯¹è¿äºç»ä»¶æèåè½è¿è¡äºæ©å±ï¼æèè¯´æ¯è¿è¡äºç²¾ç»ä¼åï¼ä»èæ»¡è¶³äºåè½åæ§è½ç­æ¹é¢çè¦æ±ã\n\n\n\nä» SimpleKV å° Redisï¼ä¸»è¦æä»¥ä¸éè¦ååï¼\n\n * Redis ä¸»è¦éè¿ç½ç»æ¡æ¶è¿è¡è®¿é®ï¼èä¸åæ¯å¨æåºäºã\n * value çç±»åæ´å ä¸°å¯ï¼å æ­¤å¯æ¯æçæä½ä¹æ´å ä¸°å¯ã\n * Redisçæä¹åæ¨¡åè½æ¯æä¸¤ç§æ¹å¼ï¼æ¥å¿ï¼AOFï¼åå¿«ç§ï¼RDBï¼ã\n * SimpleKV æ¯ä¸ªç®åçåæºé®å¼æ°æ®åºï¼ä½æ¯ï¼Redis æ¯æé«å¯é éç¾¤åé«å¯æ©å±éç¾¤ï¼å æ­¤ï¼Redis ä¸­åå«äºç¸åºçéç¾¤åè½æ¯ææ¨¡åã\n\n\n# 2. æ°æ®ç»æï¼å¿«éçRedisæåªäºæ¢æä½ï¼\n\nRedis çâå¿«âæä¸ä¸ªéè¦è¡¨ç°ï¼å®æ¥æ¶å°ä¸ä¸ªé®å¼å¯¹æä½åï¼è½ä»¥å¾®ç§çº§å«çéåº¦æ¾å°æ°æ®ï¼å¹¶å¿«éå®ææä½ã\n\næ°æ®åºè¿ä¹å¤ï¼ä¸ºå¥ Redis è½æè¿ä¹çªåºçè¡¨ç°å¢ï¼\n\n * ä¸æ¹é¢ï¼æä½å¨åå­ä¸­å®æ\n * å¦ä¸æ¹é¢ï¼å½åäºå®çæ°æ®ç»æï¼é«æçæ°æ®ç»ææ¯ Redis å¿«éå¤çæ°æ®çåºç¡ã\n\n> è¿éè¯´çæ°æ®ç»ææ¯ææ°æ®åºä¸­ value çæ°æ®ç±»åï¼å¾ä¸­ç»¿è²çååï¼çåºå±å®ç°æ¹å¼\n\nç®åæ¥è¯´ï¼åºå±æ°æ®ç»æä¸å±æ 6 ç§ï¼ç®åå¨æå­ç¬¦ä¸²ãååé¾è¡¨ãåç¼©åè¡¨ãåå¸è¡¨ãè·³è¡¨åæ´æ°æ°ç»ãå®ä»¬åæ°æ®ç±»åçå¯¹åºå³ç³»å¦ä¸å¾æç¤ºï¼\n\n\n\nå¯ä»¥çå°ï¼String ç±»åçåºå±å®ç°åªæä¸ç§æ°æ®ç»æï¼ä¹å°±æ¯ç®åå¨æå­ç¬¦ä¸²ãè ListãHashãSet å Sorted Set è¿åç§æ°æ®ç±»åï¼é½æä¸¤ç§åºå±å®ç°ç»æãéå¸¸æåµä¸ï¼æä»¬ä¼æè¿åç§ç±»åç§°ä¸ºéåç±»åï¼å®ä»¬çç¹ç¹æ¯ä¸ä¸ªé®å¯¹åºäºä¸ä¸ªéåçæ°æ®ã\n\nçå°è¿éï¼å¶å®æäºé®é¢å·²ç»å¼å¾æä»¬å»èèäºï¼\n\n * è¿äºæ°æ®ç»æé½æ¯å¼çåºå±å®ç°ï¼é®åå¼æ¬èº«ä¹é´ç¨ä»ä¹ç»æç»ç»ï¼\n * ä¸ºä»ä¹éåç±»åæé£ä¹å¤çåºå±ç»æï¼å®ä»¬é½æ¯æä¹ç»ç»æ°æ®çï¼é½å¾å¿«åï¼\n * ä»ä¹æ¯ç®åå¨æå­ç¬¦ä¸²ï¼åå¸¸ç¨çå­ç¬¦ä¸²æ¯ä¸åäºåï¼\n\næ¥ä¸æ¥ï¼æå°±åä½ èèåä¸¤ä¸ªé®é¢ãè¿æ ·ï¼ä½ ä¸ä»å¯ä»¥ç¥é Redisâå¿«âçåºæ¬åçï¼è¿å¯ä»¥åæ­¤çè§£ Redis ä¸­æåªäºæ½å¨çâæ¢æä½âï¼æå¤§å Redis çæ§è½ä¼å¿ãèå³äºç®åå¨æå­ç¬¦ä¸²ï¼ä¼å¨åé¢çè¯¾ç¨ç»§ç»­è®¨è®ºã\n\n\n# 2.1 key å value ç¨ä»ä¹ç»æç»ç»ï¼\n\nä¸ºäºå®ç°ä» key å° value çå¿«éè®¿é®ï¼Redis ä½¿ç¨äºä¸ä¸ªåå¸è¡¨æ¥ä¿å­ææé®å¼å¯¹ã\n\nä¸ä¸ªåå¸è¡¨ï¼å¶å®å°±æ¯ä¸ä¸ªæ°ç»ï¼æ°ç»çæ¯ä¸ªåç´ ç§°ä¸ºä¸ä¸ªåå¸æ¡¶ãæä»¥ï¼æä»¬å¸¸è¯´ï¼ä¸ä¸ªåå¸è¡¨æ¯ç±å¤ä¸ªåå¸æ¡¶ç»æçï¼æ¯ä¸ªåå¸æ¡¶ä¸­ä¿å­äºé®å¼å¯¹æ°æ®ãåå¸æ¡¶ä¸­çåç´ ä¿å­çä¸æ¯å¼æ¬èº«ï¼èæ¯ä¸ä¸ª pointerï¼è¿æ ·ä¸ç®¡ value æ¯ String è¿æ¯ collection ç±»åï¼åå¸æ¡¶ä¸­çåç´ é½æ¯æåå®ä»¬ç pointerã\n\nå¦ä¸å¾æç¤ºï¼åå¸æ¡¶ä¸­ç entry åç´ ä¸­ä¿å­äº key å value ç pointerï¼\n\n\n\nå ä¸ºè¿ä¸ªåå¸è¡¨ä¿å­äºææçé®å¼å¯¹ï¼æä»¥ï¼æä¹æå®ç§°ä¸ºå¨å±åå¸è¡¨ãä½¿ç¨ hash table å¯ä»¥å¨ O(1) æ¶é´å¤æåº¦ä¸è®¿é®å°ç¸åºç entry åç´ ãââéè¿è®¡ç® key çåå¸å¼ï¼å¾å°åå¸æ¡¶çä½ç½®ï¼å°±å¯ä»¥è®¿é®å° KV pair äºã\n\nä½æ¯ï¼éçå¾ Redis åå¥å¤§éæ°æ®åï¼ä¼åç°æä½ææ¶åçªç¶åæ¢äºï¼å ä¸ºæä¸ä¸ªæ½å¨çé£é©ç¹ï¼åå¸è¡¨çå²çªé®é¢å rehash å¯è½å¸¦æ¥çæä½é»å¡ã\n\n\n# 2.2 ä¸ºä»ä¹åå¸è¡¨æä½åæ¢äºââåå¸å²çª\n\nå½æ°æ®å¢å¤ï¼åå¸å²çªæ¯ä¸å¯é¿åçé®é¢ã\n\nRedis è§£å³åå¸å²çªçæ¹å¼ï¼å°±æ¯é¾å¼åå¸ï¼åä¸ä¸ªåå¸æ¡¶ä¸­çå¤ä¸ªåç´ ç¨ä¸ä¸ªé¾è¡¨æ¥ä¿å­ï¼å®ä»¬ä¹é´ä¾æ¬¡ç¨æéè¿æ¥ã\n\nå¦ä¸å¾æç¤ºï¼å²çªçåç´ å½¢æçé¾è¡¨ï¼å«ååå¸å²çªé¾ã\n\n\n\nä½éçåå¸å²çªè¶æ¥è¶å¤ï¼ä¸æ¡åå¸å²çªé¾çé entry æ¥æ¾ä¼éä½æ§è½ãæä»¥ï¼Redis ä¼å¯¹åå¸è¡¨å rehash æä½ï¼å¢å ç°æçåå¸æ¡¶æ°éï¼è®©éæ¸å¢å¤ç entry åç´ è½å¨æ´å¤çæ¡¶ä¹é´åæ£ä¿å­ï¼åå°åä¸ªæ¡¶ä¸­çåç´ æ°éï¼ä»èåå°åä¸ªæ¡¶ä¸­çå²çªã\n\nrehash å·ä½æä¹åå¢ï¼\n\nä¸ºäºä½¿ rehash æä½æ´é«æï¼Redis é»è®¤ä½¿ç¨äºä¸¤ä¸ªå¨å±åå¸è¡¨ï¼åå¸è¡¨ 1 ååå¸è¡¨ 2ãä¸å¼å§ï¼å½ä½ åæå¥æ°æ®æ¶ï¼é»è®¤ä½¿ç¨åå¸è¡¨ 1ï¼æ­¤æ¶çåå¸è¡¨ 2 å¹¶æ²¡æè¢«åéç©ºé´ãéçæ°æ®éæ­¥å¢å¤ï¼Redis å¼å§æ§è¡ rehashï¼è¿ä¸ªè¿ç¨åä¸ºä¸æ­¥ï¼\n\n 1. ç»åå¸è¡¨ 2 åéæ´å¤§çç©ºé´ï¼ä¾å¦æ¯å½ååå¸è¡¨ 1 å¤§å°çä¸¤åï¼\n 2. æåå¸è¡¨ 1 ä¸­çæ°æ®éæ°æ å°å¹¶æ·è´å°åå¸è¡¨ 2 ä¸­ï¼\n 3. éæ¾åå¸è¡¨ 1 çç©ºé´ã\n\nå°æ­¤ï¼æä»¬å°±å¯ä»¥ä»åå¸è¡¨ 1 åæ¢å°åå¸è¡¨ 2ï¼ç¨å¢å¤§çåå¸è¡¨ 2 ä¿å­æ´å¤æ°æ®ï¼èåæ¥çåå¸è¡¨ 1 çä½ä¸ä¸æ¬¡ rehash æ©å®¹å¤ç¨ã\n\nè¿ä¸ªè¿ç¨çä¼¼ç®åï¼ä½æ¯ç¬¬äºæ­¥æ¶åå¤§éçæ°æ®æ·è´ï¼å¦æä¸æ¬¡æ§æåå¸è¡¨ 1 ä¸­çæ°æ®é½è¿ç§»å®ï¼ä¼é æ Redis çº¿ç¨é»å¡ï¼æ æ³æå¡å¶ä»è¯·æ±ãæ­¤æ¶ï¼Redis å°±æ æ³å¿«éè®¿é®æ°æ®äºãä¸ºäºé¿åè¿ä¸ªé®é¢ï¼Redis éç¨äºæ¸è¿å¼ rehashï¼\n\nç®åæ¥è¯´å°±æ¯å¨ç¬¬äºæ­¥æ·è´æ°æ®æ¶ï¼Redis ä»ç¶æ­£å¸¸å¤çå®¢æ·ç«¯è¯·æ±ï¼æ¯å¤çä¸ä¸ªè¯·æ±æ¶ï¼ä»åå¸è¡¨ 1 ä¸­çç¬¬ä¸ä¸ªç´¢å¼ä½ç½®å¼å§ï¼é¡ºå¸¦çå°è¿ä¸ªç´¢å¼ä½ç½®ä¸çææ entries æ·è´å°åå¸è¡¨ 2 ä¸­ï¼ç­å¤çä¸ä¸ä¸ªè¯·æ±æ¶ï¼åé¡ºå¸¦æ·è´åå¸è¡¨ 1 ä¸­çä¸ä¸ä¸ªç´¢å¼ä½ç½®ç entriesãå¦ä¸å¾æç¤ºï¼\n\n\n\nè¿æ ·å°±å·§å¦å°æä¸æ¬¡æ§å¤§éæ·è´çå¼éï¼åæå°äºå¤æ¬¡å¤çè¯·æ±çè¿ç¨ä¸­ï¼é¿åäºèæ¶æä½ï¼ä¿è¯äºæ°æ®çå¿«éè®¿é®ã\n\nå°è¿éï¼ä½ å°±è½çè§£ Redis ç key å value æ¯æä¹éè¿åå¸è¡¨æ¥ç»ç»çäºã\n\n * å¯¹äº value ä¸º String ç±»åçæ¥è¯´ï¼æ¾å° entry å°±å¯ä»¥ç´æ¥ CRUD äºï¼æä½å¤æåº¦ O(1)ã\n * å¯¹äº value ä¸º collection ç±»åçæ¥è¯´ï¼æ¾å° entry åè¿è¦å¨éåä¸­è¿ä¸æ­¥æä½ã\n\næ¥ä¸æ¥æ¥çå¨ collection ç±»åä¸­çæä½æçåæ¯ææ ·çã\n\n\n# 2.3 éåæ°æ®çæä½æç\n\nå String ç±»åä¸åï¼ä¸ä¸ªéåç±»åç valueï¼ç¬¬ä¸æ­¥æ¯éè¿å¨å±åå¸è¡¨æ¾å°å¯¹åºçåå¸æ¡¶ä½ç½®ï¼ç¬¬äºæ­¥æ¯å¨éåä¸­åå¢å æ¹æ¥ãé£ä¹ï¼éåçæä½æçååªäºå ç´ ç¸å³å¢ï¼\n\n 1. ä¸åºå±çæ°æ®ç»ææå³\n 2. ä¸æä½æ¬èº«çæ§è¡ç¹ç¹æå³\n\næ¥ä¸æ¥ï¼æä»¬å°±åå«èèéåç±»åçåºå±æ°æ®ç»æåæä½å¤æåº¦ã\n\n# 2.3.1 æåªäºåºå±æ°æ®ç»æ\n\néåç±»åçåºå±æ°æ®ç»æä¸»è¦æ 5 ç§ï¼æ´æ°æ°ç»ãååé¾è¡¨ãåå¸è¡¨ãåç¼©åè¡¨åè·³è¡¨ï¼\n\n * åå¸è¡¨çæä½æä»¬å·²ç»äºè§£äºï¼\n * æ´æ°æ°ç»åååé¾è¡¨å¹³æ¶å¾å¸¸è§ï¼å¶æä½ç¹å¾æ¯é¡ºåºè¯»åï¼éè¿æ°ç»ä¸æ æèé¾è¡¨çæééä¸ªåç´ è®¿é®ï¼æä½å¤æåº¦å¾å¾æ¯ O(N)ï¼\n * åç¼©è·³è¡¨åè·³è¡¨å¹³æ¶æ¥è§¦ä¸å¤ï¼ä½ä¹æ¯ Redis çéè¦æ°æ®ç»æï¼ä¸é¢éç¹è§£éè¿é¨åã\n\n----------------------------------------\n\nåç¼©åè¡¨ï¼\n\nåç¼©åè¡¨å®éä¸ç±»ä¼¼äºä¸ä¸ªæ°ç»ï¼æ°ç»ä¸­çæ¯ä¸ä¸ªåç´ é½å¯¹åºä¿å­ä¸ä¸ªæ°æ®ãåæ°ç»ä¸åçæ¯ï¼åç¼©åè¡¨å¨è¡¨å¤´æä¸ä¸ªå­æ®µï¼\n\n * zlbytesï¼åè¡¨é¿åº¦\n * zltailï¼åè¡¨å°¾çåç§»é\n * zllenï¼åè¡¨ä¸­ç entry çä¸ªæ°\n\n\n\nå¨åç¼©åè¡¨ä¸­ï¼å®ä½ç¬¬ä¸ä¸ªåæåä¸ä¸ªåç´ ï¼å¯ä»¥éè¿è¡¨å¤´ä¸ä¸ªå­æ®µçé¿åº¦ç´æ¥å®ä½ï¼å¤æåº¦æ¯O(1)ãèæ¥æ¾å¶ä»åç´ æ¶ï¼åªè½éä¸ªæ¥æ¾ï¼æ­¤æ¶çå¤æåº¦å°±æ¯O(N)äºã\n\n----------------------------------------\n\nè·³è¡¨ï¼\n\næåºé¾è¡¨åªè½éä¸æ¥æ¾åç´ ï¼å¯¼è´æä½èµ·æ¥éå¸¸ç¼æ¢ï¼äºæ¯å°±åºç°äºè·³è¡¨ãå·ä½æ¥è¯´ï¼è·³è¡¨å¨é¾è¡¨çåºç¡ä¸ï¼å¢å äºå¤çº§ç´¢å¼ï¼éè¿ç´¢å¼ä½ç½®çå ä¸ªè·³è½¬ï¼å®ç°æ°æ®çå¿«éå®ä½ï¼å¦ä¸å¾æç¤ºï¼\n\n\n\nå¦ææä»¬è¦å¨é¾è¡¨ä¸­æ¥æ¾ 33 è¿ä¸ªåç´ ï¼åªè½ä»å¤´å¼å§éåé¾è¡¨ï¼æ¥æ¾ 6 æ¬¡ï¼ç´å°æ¾å° 33 ä¸ºæ­¢ãæ­¤æ¶ï¼å¤æåº¦æ¯ O(N)ï¼æ¥æ¾æçå¾ä½ã\n\nä¸ºäºæé«æ¥æ¾éåº¦ï¼æä»¬æ¥å¢å ä¸çº§ç´¢å¼ï¼ä»ç¬¬ä¸ä¸ªåç´ å¼å§ï¼æ¯ä¸¤ä¸ªåç´ éä¸ä¸ªåºæ¥ä½ä¸ºç´¢å¼ãè¿äºç´¢å¼åéè¿æéæååå§çé¾è¡¨ãä¾å¦ï¼ä»åä¸¤ä¸ªåç´ ä¸­æ½ååç´  1 ä½ä¸ºä¸çº§ç´¢å¼ï¼ä»ç¬¬ä¸ãåä¸ªåç´ ä¸­æ½ååç´  11 ä½ä¸ºä¸çº§ç´¢å¼ãæ­¤æ¶ï¼æä»¬åªéè¦ 4 æ¬¡æ¥æ¾å°±è½å®ä½å°åç´  33 äºã\n\nå¦ææä»¬è¿æ³åå¿«ï¼å¯ä»¥åå¢å äºçº§ç´¢å¼ï¼ä»ä¸çº§ç´¢å¼ä¸­ï¼åæ½åé¨ååç´ ä½ä¸ºäºçº§ç´¢å¼ãä¾å¦ï¼ä»ä¸çº§ç´¢å¼ä¸­æ½å 1ã27ã100 ä½ä¸ºäºçº§ç´¢å¼ï¼äºçº§ç´¢å¼æåä¸çº§ç´¢å¼ãè¿æ ·ï¼æä»¬åªéè¦ 3 æ¬¡æ¥æ¾ï¼å°±è½å®ä½å°åç´  33 äºã\n\nå¯ä»¥çå°ï¼è¿ä¸ªæ¥æ¾è¿ç¨å°±æ¯å¨å¤çº§ç´¢å¼ä¸è·³æ¥è·³å»ï¼æåå®ä½å°åç´ ãè¿ä¹æ­£å¥½ç¬¦åâè·³âè¡¨çå«æ³ãå½æ°æ®éå¾å¤§æ¶ï¼è·³è¡¨çæ¥æ¾å¤æåº¦å°±æ¯ $O(logN)$ã\n\nå¥½äºï¼æä»¬ç°å¨å¯ä»¥æç§æ¥æ¾çæ¶é´å¤æåº¦ç»è¿äºæ°æ®ç»æåä¸ç±»äºï¼\n\n\n\n# 2.3.2 ä¸åæä½çå¤æåº¦\n\néåç±»åçæä½ç±»åå¾å¤ï¼æè¯»ååä¸ªéååç´ çï¼ä¾å¦ HGETãHSETï¼ä¹ææä½å¤ä¸ªåç´ çï¼ä¾å¦ SADDï¼è¿æå¯¹æ´ä¸ªéåè¿è¡éåæä½çï¼ä¾å¦ SMEMBERSãè¿ä¹å¤æä½ï¼å®ä»¬çå¤æåº¦ä¹åä¸ç¸åãèå¤æåº¦çé«ä½åæ¯æä»¬éæ©éåç±»åçéè¦ä¾æ®ã\n\nææ»ç»äºä¸ä¸ªâåå¥å£è¯âï¼å¸æè½å¸®å©ä½ å¿«éè®°ä½éåå¸¸è§æä½çå¤æåº¦ãè¿æ ·ä½ å¨ä½¿ç¨è¿ç¨ä¸­ï¼å°±å¯ä»¥æåè§é¿é«å¤æåº¦æä½äºï¼\n\n * ååç´ æä½æ¯åºç¡ï¼\n * èå´æä½éå¸¸èæ¶ï¼\n * ç»è®¡æä½éå¸¸é«æï¼\n * ä¾å¤æåµåªæå ä¸ªã\n\nç¬¬ä¸ï¼ååç´ æä½ï¼æ¯ææ¯ä¸ç§éåç±»åå¯¹åä¸ªæ°æ®å®ç°çå¢å æ¹æ¥æä½ãä¾å¦ï¼Hash ç±»åç HGETãHSET å HDELï¼Set ç±»åç SADDãSREMãSRANDMEMBER ç­ãè¿äºæä½çå¤æåº¦ç±éåéç¨çæ°æ®ç»æå³å®ï¼ä¾å¦ï¼HGETãHSET å HDEL æ¯å¯¹åå¸è¡¨åæä½ï¼æä»¥å®ä»¬çå¤æåº¦é½æ¯ O(1)ï¼Set ç±»åç¨åå¸è¡¨ä½ä¸ºåºå±æ°æ®ç»ææ¶ï¼å®ç SADDãSREMãSRANDMEMBER å¤æåº¦ä¹æ¯ O(1)ã\n\nè¿éï¼æä¸ªå°æ¹ä½ éè¦æ³¨æä¸ä¸ï¼éåç±»åæ¯æåæ¶å¯¹å¤ä¸ªåç´ è¿è¡å¢å æ¹æ¥ï¼ä¾å¦ Hash ç±»åç HMGET å HMSETï¼Set ç±»åç SADD ä¹æ¯æåæ¶å¢å å¤ä¸ªåç´ ãæ­¤æ¶ï¼è¿äºæä½çå¤æåº¦ï¼å°±æ¯ç±åä¸ªåç´ æä½å¤æåº¦ååç´ ä¸ªæ°å³å®çãä¾å¦ï¼HMSET å¢å  M ä¸ªåç´ æ¶ï¼å¤æåº¦å°±ä» O(1) åæ O(M) äºã\n\nç¬¬äºï¼èå´æä½ï¼æ¯æéåç±»åä¸­çéåæä½ï¼å¯ä»¥è¿åéåä¸­çæææ°æ®ï¼æ¯å¦ Hash ç±»åç HGETALL å Set ç±»åç SMEMBERSï¼æèè¿åä¸ä¸ªèå´åçé¨åæ°æ®ï¼æ¯å¦ List ç±»åç LRANGE å ZSet ç±»åç ZRANGEãè¿ç±»æä½çå¤æåº¦ä¸è¬æ¯ O(N)ï¼æ¯è¾èæ¶ï¼æä»¬åºè¯¥å°½éé¿åã\n\nä¸è¿ï¼Redis ä» 2.8 çæ¬å¼å§æä¾äº SCAN ç³»åæä½ï¼åæ¬ HSCANï¼SSCAN å ZSCANï¼ï¼è¿ç±»æä½å®ç°äºæ¸è¿å¼éåï¼æ¯æ¬¡åªè¿åæéæ°éçæ°æ®ãè¿æ ·ä¸æ¥ï¼ç¸æ¯äº HGETALLãSMEMBERS è¿ç±»æä½æ¥è¯´ï¼å°±é¿åäºä¸æ¬¡æ§è¿åææåç´ èå¯¼è´ç Redis é»å¡ã\n\nç¬¬ä¸ï¼ç»è®¡æä½ï¼æ¯æéåç±»åå¯¹éåä¸­ææåç´ ä¸ªæ°çè®°å½ï¼ä¾å¦ LLEN å SCARDãè¿ç±»æä½å¤æåº¦åªæ O(1)ï¼è¿æ¯å ä¸ºå½éåç±»åéç¨åç¼©åè¡¨ãååé¾è¡¨ãæ´æ°æ°ç»è¿äºæ°æ®ç»ææ¶ï¼è¿äºç»æä¸­ä¸é¨è®°å½äºåç´ çä¸ªæ°ç»è®¡ï¼å æ­¤å¯ä»¥é«æå°å®æç¸å³æä½ã\n\nç¬¬åï¼ä¾å¤æåµï¼æ¯ææäºæ°æ®ç»æçç¹æ®è®°å½ï¼ä¾å¦åç¼©åè¡¨åååé¾è¡¨é½ä¼è®°å½è¡¨å¤´åè¡¨å°¾çåç§»éãè¿æ ·ä¸æ¥ï¼å¯¹äº List ç±»åç LPOPãRPOPãLPUSHãRPUSH è¿åä¸ªæä½æ¥è¯´ï¼å®ä»¬æ¯å¨åè¡¨çå¤´å°¾å¢å åç´ ï¼è¿å°±å¯ä»¥éè¿åç§»éç´æ¥å®ä½ï¼æä»¥å®ä»¬çå¤æåº¦ä¹åªæ O(1)ï¼å¯ä»¥å®ç°å¿«éæä½ã\n\n\n# 2.4 å°ç»\n\nè¿ä¸å¤§èå­¦ä¹ äº Redis çåºå±æ°æ®ç»æï¼åæ¬ Redis æ´ä½çç¨æ¥ä¿å­æ¯ä¸ª KV çå¨å±åå¸è¡¨ç»æï¼ä¹åæ¬æ¯æéåç±»åå®ç°çååé¾è¡¨ãåç¼©åè¡¨ãæ´æ°æ°ç»ãåå¸è¡¨åè·³è¡¨è¿äºå¤§åºå±ç»æã\n\nRedis ä¹æä»¥è½å¿«éæä½é®å¼å¯¹ï¼ä¸æ¹é¢æ¯å ä¸º O(1) å¤æåº¦çåå¸è¡¨è¢«å¹¿æ³ä½¿ç¨ï¼åæ¬ StringãHash å Setï¼å®ä»¬çæä½å¤æåº¦åºæ¬ç±åå¸è¡¨å³å®ï¼å¦ä¸æ¹é¢ï¼Sorted Set ä¹éç¨äº O(logN) å¤æåº¦çè·³è¡¨ãä¸è¿ï¼éåç±»åçèå´æä½ï¼å ä¸ºè¦éååºå±æ°æ®ç»æï¼å¤æåº¦éå¸¸æ¯ O(N)ãè¿éï¼æçå»ºè®®æ¯ï¼ç¨å¶ä»å½ä»¤æ¥æ¿ä»£ï¼ä¾å¦å¯ä»¥ç¨ SCAN æ¥ä»£æ¿ï¼é¿åå¨ Redis åé¨äº§çè´¹æ¶çå¨éåéåæä½ã\n\nå½ç¶ï¼æä»¬ä¸è½å¿äºå¤æåº¦è¾é«ç List ç±»åï¼å®çä¸¤ç§åºå±å®ç°ç»æï¼ååé¾è¡¨ååç¼©åè¡¨çæä½å¤æåº¦é½æ¯ O(N)ãå æ­¤ï¼æçå»ºè®®æ¯ï¼å å°å¶å®å°ä½¿ç¨ List ç±»åãä¾å¦ï¼æ¢ç¶å®ç POP/PUSH æçå¾é«ï¼é£ä¹å°±å°å®ä¸»è¦ç¨äº FIFO éååºæ¯ï¼èä¸æ¯ä½ä¸ºä¸ä¸ªå¯ä»¥éæºè¯»åçéåã\n\nRedis æ°æ®ç±»åä¸°å¯ï¼æå¥½çåæ³å°±æ¯ææ¡åçï¼ä»åçä¸æ¨æ­ä¸åæä½çå¤æåº¦ï¼ä»èå¿«éåçå°ååºéæ©\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼Redisä»ä¹æ¶åå rehashï¼\n\nRedisä¼ä½¿ç¨è£è½½å å­ï¼load factorï¼æ¥å¤æ­æ¯å¦éè¦å rehashãè£è½½å å­çè®¡ç®æ¹å¼æ¯ï¼åå¸è¡¨ä¸­ææ entry çä¸ªæ°é¤ä»¥åå¸è¡¨çåå¸æ¡¶ä¸ªæ°ãRedisä¼æ ¹æ®è£è½½å å­çä¸¤ç§æåµï¼æ¥è§¦å rehash æä½ï¼\n\n * è£è½½å å­â¥1ï¼åæ¶ï¼åå¸è¡¨è¢«åè®¸è¿è¡ rehashï¼\n * è£è½½å å­â¥5ã\n\nå¨ç¬¬ä¸ç§æåµä¸ï¼å¦æè£è½½å å­ç­äº1ï¼åæ¶æä»¬åè®¾ï¼ææé®å¼å¯¹æ¯å¹³ååå¸å¨åå¸è¡¨çåä¸ªæ¡¶ä¸­çï¼é£ä¹ï¼æ­¤æ¶ï¼åå¸è¡¨å¯ä»¥ä¸ç¨é¾å¼åå¸ï¼å ä¸ºä¸ä¸ªåå¸æ¡¶æ­£å¥½ä¿å­äºä¸ä¸ªé®å¼å¯¹ã\n\nä½æ¯ï¼å¦ææ­¤æ¶åææ°çæ°æ®åå¥ï¼åå¸è¡¨å°±è¦ä½¿ç¨é¾å¼åå¸äºï¼è¿ä¼å¯¹æ¥è¯¢æ§è½äº§çå½±åãå¨è¿è¡RDBçæåAOFéåæ¶ï¼åå¸è¡¨çrehashæ¯è¢«ç¦æ­¢çï¼è¿æ¯ä¸ºäºé¿åå¯¹RDBåAOFéåé æå½±åãå¦ææ­¤æ¶ï¼Redisæ²¡æå¨çæRDBåéåAOFï¼é£ä¹ï¼å°±å¯ä»¥è¿è¡rehashãå¦åçè¯ï¼åææ°æ®åå¥æ¶ï¼åå¸è¡¨å°±è¦å¼å§ä½¿ç¨æ¥è¯¢è¾æ¢çé¾å¼åå¸äºã\n\nå¨ç¬¬äºç§æåµä¸ï¼ä¹å°±æ¯è£è½½å å­å¤§äºç­äº5æ¶ï¼å°±è¡¨æå½åä¿å­çæ°æ®éå·²ç»è¿è¿å¤§äºåå¸æ¡¶çä¸ªæ°ï¼åå¸æ¡¶éä¼æå¤§éçé¾å¼åå¸å­å¨ï¼æ§è½ä¼åå°ä¸¥éå½±åï¼æ­¤æ¶ï¼å°±ç«é©¬å¼å§årehashã\n\nååè¯´çæ¯è§¦årehashçæåµï¼å¦æè£è½½å å­å°äº1ï¼æèè£è½½å å­å¤§äº1ä½æ¯å°äº5ï¼åæ¶åå¸è¡¨ææ¶ä¸è¢«åè®¸è¿è¡rehashï¼ä¾å¦ï¼å®ä¾æ­£å¨çæRDBæèéåAOFï¼ï¼æ­¤æ¶ï¼åå¸è¡¨æ¯ä¸ä¼è¿è¡rehashæä½çã\n\næ¬èé®é¢ 2ï¼ æ¸è¿å¼ rehash çæ§è¡æºå¶ââéç¨æ¸è¿å¼hashæ¶ï¼å¦æå®ä¾ææ¶æ²¡ææ¶å°æ°è¯·æ±ï¼æ¯ä¸æ¯å°±ä¸årehashäºï¼\n\nå¶å®ä¸æ¯çãRedisä¼æ§è¡å®æ¶ä»»å¡ï¼å®æ¶ä»»å¡ä¸­å°±åå«äºrehashæä½ãæè°çå®æ¶ä»»å¡ï¼å°±æ¯æç§ä¸å®é¢çï¼ä¾å¦æ¯100ms/æ¬¡ï¼æ§è¡çä»»å¡ã\n\nå¨rehashè¢«è§¦ååï¼å³ä½¿æ²¡ææ¶å°æ°è¯·æ±ï¼Redisä¹ä¼å®æ¶æ§è¡ä¸æ¬¡rehashæä½ï¼èä¸ï¼æ¯æ¬¡æ§è¡æ¶é¿ä¸ä¼è¶è¿1msï¼ä»¥åå¯¹å¶ä»ä»»å¡é æå½±åã\n\n\n# 3. é«æ§è½ IO æ¨¡åï¼ä¸ºä»ä¹åçº¿ç¨è¿è½è¿ä¹å¿«ï¼\n\nè¿ä¸å¤§èæ¢è®¨ï¼ä¸ºä»ä¹åçº¿ç¨ç Redis è½é£ä¹å¿«ï¼\n\né¦åè¦åæ¸ä¸ä¸ªäºå®ï¼æä»¬éå¸¸è¯´ç Redis æ¯åçº¿ç¨ï¼ä¸»è¦æ¯æ Redis çç½ç» IO åé®å¼å¯¹è¯»åæ¯ç±ä¸ä¸ªçº¿ç¨æ¥å®æçï¼è¿ä¹æ¯ Redis å¯¹å¤æä¾é®å¼å­å¨æå¡çä¸»è¦æµç¨ãä½ Redis çå¶ä»åè½ï¼æ¯å¦æä¹åãå¼æ­¥å é¤ãéç¾¤æ°æ®åæ­¥ç­ï¼å¶å®æ¯ç±é¢å¤ççº¿ç¨æ§è¡çã\n\næä»¥ï¼ä¸¥æ ¼æ¥è¯´ï¼Redis å¹¶ä¸æ¯åçº¿ç¨ï¼ä½æ¯æä»¬ä¸è¬æ Redis ç§°ä¸ºåçº¿ç¨é«æ§è½ï¼è¿æ ·æ¾å¾âé·âäºãå æ­¤æ¥ä¸æ¥æä»¬ä¹ç§° Redis ä¸ºåçº¿ç¨æ¨¡å¼ã\n\nè¦å¼æç½è¿èæåºçé®é¢ï¼æä»¬å°±è¦æ·±å¥å°å­¦ä¹ ä¸ Redis çåçº¿ç¨è®¾è®¡æºå¶ä»¥åå¤è·¯å¤ç¨æºå¶ãä¹åä½ å¨è°ä¼ Redis æ§è½æ¶ï¼ä¹è½æ´æéå¯¹æ§å°é¿åä¼å¯¼è´ Redis åçº¿ç¨é»å¡çæä½ï¼ä¾å¦æ§è¡å¤æåº¦é«çå½ä»¤ã\n\n\n# 3.1 Redis ä¸ºä»ä¹ç¨åçº¿ç¨ââå¤çº¿ç¨çå¹¶åè®¿é®æ§å¶é®é¢\n\nè¦æ´å¥½å°çè§£ Redis ä¸ºä»ä¹ç¨åçº¿ç¨ï¼æä»¬å°±è¦åäºè§£å¤çº¿ç¨çå¼éã\n\nå¯¹äºä¸ä¸ªå¤çº¿ç¨çç³»ç»æ¥è¯´ï¼å¨æåççèµæºåéçæåµä¸ï¼å¯ä»¥å¢å ç³»ç»ä¸­å¤çè¯·æ±æä½çèµæºå®ä½ï¼è¿èæåç³»ç»è½å¤åæ¶å¤ççè¯·æ±æ°ï¼å³ååçãä½éå¸¸æåµä¸å¦ææ²¡æè¯å¥½çè®¾è®¡ï¼å®éå¤çº¿ç¨çè¡¨ç°å¯è½å¹¶ä¸å¥½ï¼å¦ä¸å¾ï¼å·¦è¾¹æ¯æä»¬çææï¼å³è¾¹æ¯å¯è½çå®éè¡¨ç°ï¼\n\n\n\nåºç°è¿ç§æåµçä¸ä¸ªå³é®ç¶é¢å°±æ¯ï¼ç³»ç»éå¸¸ä¼å­å¨è¢«å¤çº¿ç¨åæ¶è®¿é®çå±äº«èµæºï¼ä¸ºä¿è¯æ­£ç¡®æ§çé¢å¤æºå¶ä¼å¸¦æ¥é¢å¤çå¼éãè¿å°±æ¯å¤çº¿ç¨ç¼ç¨æ¨¡å¼é¢ä¸´çå±äº«èµæºçå¹¶åè®¿é®æ§å¶é®é¢ã\n\nå¹¶åè®¿é®æ§å¶ä¸ç´æ¯å¤çº¿ç¨å¼åä¸­çä¸ä¸ªé¾ç¹é®é¢ï¼å¦ææ²¡æç²¾ç»çè®¾è®¡ï¼æ¯å¦è¯´ï¼åªæ¯ç®åå°éç¨ä¸ä¸ªç²ç²åº¦äºæ¥éï¼å°±ä¼åºç°ä¸çæ³çç»æï¼å³ä½¿å¢å äºçº¿ç¨ï¼å¤§é¨åçº¿ç¨ä¹å¨ç­å¾è·åè®¿é®å±äº«èµæºçäºæ¥éï¼å¹¶è¡åä¸²è¡ï¼ç³»ç»ååçå¹¶æ²¡æéççº¿ç¨çå¢å èå¢å ãèä¸ï¼éç¨å¤çº¿ç¨å¼åä¸è¬ä¼å¼å¥åæ­¥åè¯­æ¥ä¿æ¤å±äº«èµæºçå¹¶åè®¿é®ï¼è¿ä¹ä¼éä½ç³»ç»ä»£ç çæè°è¯æ§åå¯ç»´æ¤æ§ãä¸ºäºé¿åè¿äºé®é¢ï¼Redis ç´æ¥éç¨äºåçº¿ç¨æ¨¡å¼ã\n\nå°è¿éï¼ä½ åºè¯¥å·²ç»æç½äºâRedisä¸ºä»ä¹ç¨åçº¿ç¨âï¼é£ä¹ï¼æ¥ä¸æ¥ï¼æä»¬å°±æ¥ççï¼ä¸ºä»ä¹åçº¿ç¨Redisè½è·å¾é«æ§è½ã\n\n\n# 3.2 åçº¿ç¨ Redis ä¸ºä»ä¹é£ä¹å¿«ââå¤è·¯å¤ç¨æºå¶\n\nRedis ä½¿ç¨åçº¿ç¨æ¨¡åå´è¾¾å°äºæ¯ç§æ°åä¸çº§å«çå¤çè½åï¼è¿æ¯ä¸ºä»ä¹å¢ï¼å¶å®ï¼è¿æ¯ Redis å¤æ¹é¢è®¾è®¡éæ©çä¸ä¸ªç»¼åç»æï¼\n\n * ä¸æ¹é¢ï¼å¤§é¨åæä½å¨åå­ä¸å®æï¼åå ä¸éç¨äºé«æçæ°æ®ç»æã\n * å¦ä¸æ¹é¢ï¼Redis éç¨äºå¤è·¯å¤ç¨æºå¶ï¼ä½¿å¶å¨ç½ç» IO æä½ä¸­è½å¹¶åå¤çå¤§éçå®¢æ·ç«¯è¯·æ±ï¼å®ç°é«ååçã\n\né¦åï¼æä»¬è¦å¼æç½ç½ç»æä½çåºæ¬ IO æ¨¡ååæ½å¨çé»å¡ç¹ãæ¯ç«ï¼Redis éç¨åçº¿ç¨è¿è¡ IOï¼å¦æçº¿ç¨è¢«é»å¡äºï¼å°±æ æ³è¿è¡å¤è·¯å¤ç¨äºã\n\n# 3.2.1 åºæ¬ IO æ¨¡åä¸é»å¡ç¹\n\nä¸æ¬¡ç½ç»äº¤äºçè¿ç¨ï¼ä»¥ Get è¯·æ±ä¸ºä¾ï¼ç¬¬ä¸èä¸­ç SimpleKV ä¸ºäºå¤çä¸ä¸ª Get è¯·æ±ï¼éè¦çå¬å®¢æ·ç«¯è¯·æ±ï¼bind/listenï¼ï¼åå®¢æ·ç«¯å»ºç«è¿æ¥ï¼acceptï¼ï¼ä» socket ä¸­è¯»åè¯·æ±ï¼recvï¼ï¼è§£æå®¢æ·ç«¯åéè¯·æ±ï¼parseï¼ï¼æ ¹æ®è¯·æ±ç±»åè¯»åé®å¼æ°æ®ï¼getï¼ï¼æåç»å®¢æ·ç«¯è¿åç»æï¼å³å socket ä¸­ååæ°æ®ï¼sendï¼ãä¸å¾æ¾ç¤ºäºè¿ä¸è¿ç¨ï¼\n\n\n\nç±äº Redis æ¯åçº¿ç¨ï¼èè¿éçç½ç» IO ææ½å¨çé»å¡ç¹ï¼åå«æ¯ accept() å recv()ï¼ä»èå¯è½å¯¼è´ Redis æ´ä¸ªçº¿ç¨é»å¡ãå¹¸è¿çæ¯ï¼socket ç½ç»æ¨¡åæ¬èº«æ¯æéé»å¡æ¨¡å¼ã\n\n# 3.2.2 éé»å¡æ¨¡å¼\n\nSocket ç½ç»æ¨¡åçéé»å¡æ¨¡å¼è®¾ç½®ï¼ä¸»è¦ä½ç°å¨ä¸ä¸ªå³é®çå½æ°è°ç¨ä¸ï¼å¦ææ³è¦ä½¿ç¨ socket éé»å¡æ¨¡å¼ï¼å°±å¿é¡»è¦äºè§£è¿ä¸ä¸ªå½æ°çè°ç¨è¿åç±»ååè®¾ç½®æ¨¡å¼ãæ¥ä¸æ¥ï¼æä»¬å°±éç¹å­¦ä¹ ä¸å®ä»¬ã\n\nå¨ socket æ¨¡åä¸­ï¼ä¸åæä½è°ç¨åä¼è¿åä¸åçå¥æ¥å­ç±»åï¼\n\n * socket() æ¹æ³ä¼è¿åä¸»å¨å¥æ¥å­ï¼\n * ç¶åè°ç¨ listen() æ¹æ³ï¼å°ä¸»å¨å¥æ¥å­è½¬åä¸ºçå¬å¥æ¥å­ï¼æ­¤æ¶ï¼å¯ä»¥çå¬æ¥èªå®¢æ·ç«¯çè¿æ¥è¯·æ±ï¼\n * æåï¼è°ç¨ accept() æ¹æ³æ¥æ¶å°è¾¾çå®¢æ·ç«¯è¿æ¥ï¼å¹¶è¿åå·²è¿æ¥å¥æ¥å­ã\n\n\n\néå¯¹çå¬å¥æ¥å­ï¼æä»¬å¯ä»¥è®¾ç½®éé»å¡æ¨¡å¼ï¼å½ Redis è°ç¨ accept() ä½ä¸ç´æªæè¿æ¥è¯·æ±å°è¾¾æ¶ï¼Redis çº¿ç¨å¯ä»¥è¿åå¤çå¶ä»æä½ï¼èä¸ç¨ä¸ç´ç­å¾ãä½æ¯ï¼ä½ è¦æ³¨æçæ¯ï¼è°ç¨ accept() æ¶ï¼å·²ç»å­å¨çå¬å¥æ¥å­äºã\n\nè½ç¶ Redis çº¿ç¨å¯ä»¥ä¸ç¨ç»§ç»­ç­å¾ï¼ä½æ¯æ»å¾ææºå¶ç»§ç»­å¨çå¬å¥æ¥å­ä¸ç­å¾åç»­è¿æ¥è¯·æ±ï¼å¹¶å¨æè¯·æ±æ¶éç¥ Redisã\n\nç±»ä¼¼çï¼æä»¬ä¹å¯ä»¥éå¯¹å·²è¿æ¥å¥æ¥å­è®¾ç½®éé»å¡æ¨¡å¼ï¼Redis è°ç¨ recv() åï¼å¦æå·²è¿æ¥å¥æ¥å­ä¸ä¸ç´æ²¡ææ°æ®å°è¾¾ï¼Redis çº¿ç¨åæ ·å¯ä»¥è¿åå¤çå¶ä»æä½ãæä»¬ä¹éè¦ææºå¶ç»§ç»­çå¬è¯¥å·²è¿æ¥å¥æ¥å­ï¼å¹¶å¨ææ°æ®è¾¾å°æ¶éç¥ Redisã\n\nè¿æ ·æè½ä¿è¯ Redis çº¿ç¨ï¼æ¢ä¸ä¼ååºæ¬ IO æ¨¡åä¸­ä¸ç´å¨é»å¡ç¹ç­å¾ï¼ä¹ä¸ä¼å¯¼è´ Redis æ æ³å¤çå®éå°è¾¾çè¿æ¥è¯·æ±ææ°æ®ã\n\nå°æ­¤ï¼Linux ä¸­ç IO å¤è·¯å¤ç¨æºå¶å°±è¦ç»åºäºã\n\n# 3.2.3 åºäºå¤è·¯å¤ç¨çé«æ§è½ I/O æ¨¡å\n\nLinux ä¸­ç IO å¤è·¯å¤ç¨æºå¶æ¯æä¸ä¸ªçº¿ç¨å¤çå¤ä¸ª IO æµï¼å°±æ¯æä»¬ç»å¸¸å¬å°ç select/epoll æºå¶ãç®åæ¥è¯´ï¼å¨ Redis åªè¿è¡åçº¿ç¨çæåµä¸ï¼è¯¥æºå¶åè®¸åæ ¸ä¸­ï¼åæ¶å­å¨å¤ä¸ªçå¬å¥æ¥å­åå·²è¿æ¥å¥æ¥å­ãåæ ¸ä¼ä¸ç´çå¬è¿äºå¥æ¥å­ä¸çè¿æ¥è¯·æ±ææ°æ®è¯·æ±ãä¸æ¦æè¯·æ±å°è¾¾ï¼å°±ä¼äº¤ç» Redis çº¿ç¨å¤çï¼è¿å°±å®ç°äºä¸ä¸ª Redis çº¿ç¨å¤çå¤ä¸ª IO æµçææã\n\n> æä»¥å¶å® 3.2.2 èä¸­éè¦æè¯·æ±æèæ°æ®å°è¾¾æ¶éç¥ Redis çæºå¶å°±æ¯ Linux åæ ¸ãå¦å¤ï¼æ­¤æºå¶ä¹æä¸º Redis éå¸¸æ¯å¨ Linux ä¸ä½¿ç¨çåå ä¹ä¸ã\n\nä¸å¾å°±æ¯åºäºå¤è·¯å¤ç¨ç Redis IO æ¨¡åãå¾ä¸­çå¤ä¸ª FD å°±æ¯åææè¯´çå¤ä¸ªå¥æ¥å­ãRedis ç½ç»æ¡æ¶è°ç¨ epoll æºå¶ï¼è®©åæ ¸çå¬è¿äºå¥æ¥å­ãæ­¤æ¶ï¼Redis çº¿ç¨ä¸ä¼é»å¡å¨æä¸ä¸ªç¹å®ççå¬æå·²è¿æ¥å¥æ¥å­ä¸ï¼ä¹å°±æ¯è¯´ï¼ä¸ä¼é»å¡å¨æä¸ä¸ªç¹å®çå®¢æ·ç«¯è¯·æ±å¤çä¸ãæ­£å ä¸ºæ­¤ï¼Redis å¯ä»¥åæ¶åå¤ä¸ªå®¢æ·ç«¯è¿æ¥å¹¶å¤çè¯·æ±ï¼ä»èæåå¹¶åæ§ã\n\n\n\nä¸ºäºå¨è¯·æ±å°è¾¾æ¶è½éç¥å° Redis çº¿ç¨ï¼select/epoll æä¾äºåºäºäºä»¶çåè°æºå¶ï¼å³éå¯¹ä¸åäºä»¶çåçï¼è°ç¨ç¸åºçå¤çå½æ°ã\n\né£ä¹ï¼åè°æºå¶æ¯æä¹å·¥ä½çå¢ï¼å¶å®ï¼select/epoll ä¸æ¦çæµå° FD ä¸æè¯·æ±å°è¾¾æ¶ï¼å°±ä¼è§¦åç¸åºçäºä»¶ã\n\nè¿äºäºä»¶ä¼è¢«æ¾è¿ä¸ä¸ªäºä»¶éåï¼Redis åçº¿ç¨å¯¹è¯¥äºä»¶éåä¸æ­è¿è¡å¤çãè¿æ ·ä¸æ¥ï¼Redis æ éä¸ç´è½®è¯¢æ¯å¦æè¯·æ±å®éåçï¼è¿å°±å¯ä»¥é¿åé æ CPU èµæºæµªè´¹ãåæ¶ï¼Redis å¨å¯¹äºä»¶éåä¸­çäºä»¶è¿è¡å¤çæ¶ï¼ä¼è°ç¨ç¸åºçå¤çå½æ°ï¼è¿å°±å®ç°äºåºäºäºä»¶çåè°ãå ä¸º Redis ä¸ç´å¨å¯¹äºä»¶éåè¿è¡å¤çï¼æä»¥è½åæ¶ååºå®¢æ·ç«¯è¯·æ±ï¼æå Redis çååºæ§è½ã\n\nä¸ºäºæ¹ä¾¿ä½ çè§£ï¼æåä»¥è¿æ¥è¯·æ±åè¯»æ°æ®è¯·æ±ä¸ºä¾ï¼å·ä½è§£éä¸ä¸ãè¿ä¸¤ä¸ªè¯·æ±åå«å¯¹åº Accept äºä»¶å Read äºä»¶ï¼Redis åå«å¯¹è¿ä¸¤ä¸ªäºä»¶æ³¨å accept å get åè°å½æ°ãå½ Linux åæ ¸çå¬å°æè¿æ¥è¯·æ±æè¯»æ°æ®è¯·æ±æ¶ï¼å°±ä¼è§¦å Accept äºä»¶å Read äºä»¶ï¼æ­¤æ¶ï¼åæ ¸å°±ä¼åè° Redis ç¸åºç accept å get å½æ°è¿è¡å¤çã\n\n> è¿å°±åçäººå»å»é¢ç§çãå¨å»çå®éè¯æ­åï¼æ¯ä¸ªçäººï¼ç­åäºè¯·æ±ï¼é½éè¦ååè¯ãæµä½æ¸©ãç»è®°ç­ãå¦æè¿äºå·¥ä½é½ç±å»çæ¥å®æï¼å»ççå·¥ä½æçå°±ä¼å¾ä½ãæä»¥ï¼å»é¢é½è®¾ç½®äºåè¯å°ï¼åè¯å°ä¼ä¸ç´å¤çè¿äºè¯æ­åçå·¥ä½ï¼ç±»ä¼¼äº Linux åæ ¸çå¬è¯·æ±ï¼ï¼ç¶ååè½¬äº¤ç»å»çåå®éè¯æ­ãè¿æ ·å³ä½¿ä¸ä¸ªå»çï¼ç¸å½äº Redis åçº¿ç¨ï¼ï¼æçä¹è½æåã\n\nä¸è¿ï¼éè¦æ³¨æçæ¯ï¼å³ä½¿ä½ çåºç¨åºæ¯ä¸­é¨ç½²äºä¸åçæä½ç³»ç»ï¼å¤è·¯å¤ç¨æºå¶ä¹æ¯éç¨çãå ä¸ºè¿ä¸ªæºå¶çå®ç°æå¾å¤ç§ï¼æ¢æåºäº Linux ç³»ç»ä¸ç select å epoll å®ç°ï¼ä¹æåºäº FreeBSD ç kqueue å®ç°ï¼ä»¥ååºäº Solaris ç evport å®ç°ï¼è¿æ ·ï¼ä½ å¯ä»¥æ ¹æ® Redis å®éè¿è¡çæä½ç³»ç»ï¼éæ©ç¸åºçå¤è·¯å¤ç¨å®ç°ã\n\n\n# 3.3 å°ç»\n\næä»¬éç¹å­¦ä¹ äº Redis çº¿ç¨çä¸ä¸ªé®é¢ï¼\n\n * Redis ççåªæåçº¿ç¨åï¼\n * ä¸ºä»ä¹ç¨åçº¿ç¨ï¼\n * åçº¿ç¨ä¸ºä»ä¹è¿ä¹å¿«ï¼\n\nRedis åçº¿ç¨æ¯æå®å¯¹ç½ç» IO åæ°æ®è¯»åçæä½éç¨äºä¸ä¸ªçº¿ç¨ï¼èéç¨åçº¿ç¨çä¸ä¸ªæ ¸å¿åå æ¯é¿åå¤çº¿ç¨å¼åçå¹¶åæ§å¶é®é¢ãåçº¿ç¨ç Redis ä¹è½è·å¾é«æ§è½ï¼è·å¤è·¯å¤ç¨ç IO æ¨¡åå¯åç¸å³ï¼å ä¸ºè¿é¿åäº accept() å send()/recv() æ½å¨çç½ç» IO æä½é»å¡ç¹ã\n\n> å¦å¤ï¼æä¹å§éä¸ï¼å¯è½ä½ ä¹æ³¨æå°äºï¼2020 å¹´ 5 æï¼Redis 6.0 çç¨³å®çåå¸äºï¼Redis 6.0 ä¸­æåºäºå¤çº¿ç¨æ¨¡åãé£ä¹ï¼è¿ä¸ªå¤çº¿ç¨æ¨¡ååè¿èè¯¾æè¯´ç IO æ¨¡åæä»ä¹å³èï¼ä¼å¼å¥å¤æçå¹¶åæ§å¶é®é¢åï¼ä¼ç» Redis 6.0 å¸¦æ¥å¤å¤§æåï¼å³äºè¿äºé®é¢ï¼æä¼å¨åé¢çè¯¾ç¨ä¸­åä½ å·ä½ä»ç»ã\n\n----------------------------------------\n\né®é¢ï¼Redis çåºæ¬ IO æ¨¡åä¸­è¿æåªäºæ½å¨çæ§è½ç¶é¢ï¼\n\nå¨ä¸»çº¿ç¨æ§è¡æä½æé´ï¼ä»»ä½èæ¶çæä½é½æ¯æ½å¨çæ§è½ç¶é¢ï¼é¤äºç½ç» IO å¤ï¼è¿åæ¬ bigkeyãå¨éè¿åç­æä½ã",normalizedContent:"# åºç¡æ¶æãæ°æ®ç»æä¸ io æ¨¡å\n\n> åèï¼ 01 | åºæ¬æ¶æï¼ä¸ä¸ªé®å¼æ°æ®åºåå«ä»ä¹ï¼\n\n\n# 1. åºç¡æ¶æï¼ä¸ä¸ªé®å¼æ°æ®åºåå«ä»ä¹ï¼\n\nredisæ¯å¸åçé®å¼æ°æ®åºã\n\næä»¬åå»ºç«èµ·âç³»ç»è§âï¼åæ·±å¥çè§£åä¼å redisã å³åå¯¹å®çæ»ä½æ¶æåå³é®æ¨¡åæä¸ä¸ªå¨å±çè®¤ç¥ï¼ç¶ååæ·±å¥å°å·ä½çææ¯ç¹ã\n\nä»å¤©ï¼åæé ä¸ä¸ªç®åç kv æ°æ®åºï¼æä»¬åªéè¦å³æ³¨æ´ä½æ¶æåæ ¸å¿æ¨¡åï¼å¹¶å¯¹å¶è¿è¡åæãææè¿ä¸ªç®åçé®å¼æ°æ®åºç§°ä¸ºsimplekvï¼å®åªæ¯ä¸ä¸ªå·æå³é®ç»ä»¶ç kv æ°æ®åºæ¶æã\n\n> è¿éç simplekv ä¸ github ä¸ååçé¡¹ç®å¹¶ä¸æ¯ä¸ä¸ªä¸è¥¿ã\n\nå¼å§æé  simplekv æ¶ï¼é¦åå°±è¦èèéé¢å¯ä»¥å­ä»ä¹æ ·çæ°æ®ï¼å¯¹æ°æ®å¯ä»¥åä»ä¹æ ·çæä½ï¼ä¹å°±æ¯æ°æ®æ¨¡ååæä½æ¥å£ã\n\nå¯¹äºredisæ¥è¯´ï¼å®å°åºè½åä»ä¹ï¼ä¸è½åä»ä¹å¢ï¼åªæåææå®çæ°æ®æ¨¡ååæä½æ¥å£ï¼æä»¬æè½çæ­£æâè¿åå¥½é¢ç¨å¨ååä¸âã\n\n\n# 1.1 å¯ä»¥å­åªäºæ°æ®ï¼\n\nå¯¹äºé®å¼æ°æ®åºèè¨ï¼åºæ¬çæ°æ®æ¨¡åæ¯ key-value æ¨¡åãsimplekv ä¸­ï¼\n\n * key ä¸º string ç±»å\n * value ä¸ºåºæ¬æ°æ®ç±»åï¼å¦ stringãæ´åç­ã\n\nå¯¹äºå®éçäº§ç¯å¢ä¸­çé®å¼æ°æ®åºæ¥è¯´ï¼value ç±»åè¿å¯ä»¥æ¯å¤æç±»åã\n\nä¸åé®å¼æ°æ®åºæ¯æçkeyç±»åä¸è¬å·®å¼ä¸å¤§ï¼èvalueç±»ååæè¾å¤§å·®å«ãæä»¬å¨å¯¹é®å¼æ°æ®åºè¿è¡éåæ¶ï¼ä¸ä¸ªéè¦çèèå ç´ æ¯å®æ¯æçvalueç±»åãä¾å¦ï¼memcached æ¯æç value ç±»åä»ä¸º string ç±»åï¼è redis æ¯æç value ç±»ååæ¬äº stringãåå¸è¡¨ãåè¡¨ãéåç­ãredisè½å¤å¨å®éä¸å¡åºæ¯ä¸­å¾å°å¹¿æ³çåºç¨ï¼å°±æ¯å¾çäºæ¯æå¤æ ·åç±»åç valueã\n\nä¸å value ç±»åçå®ç°å­å¨åç§æ§è½ãæçç­æ¹é¢çå·®å¼ï¼å æ­¤ç¨äºæ»¡è¶³ä¸åä¸å¡çéæ±ãæç½è¿äºåçæè½å»éæ©ã\n\n\n# 1.2 å¯ä»¥å¯¹æ°æ®åä»ä¹æä½ï¼\n\nsimplekvæ¯ä¸ä¸ªç®åçé®å¼æ°æ®åºï¼å æ­¤ï¼åºæ¬æä½æ å¤ä¹å¢å æ¹æ¥ï¼\n\n * putï¼æ°åå¥ææ´æ°ä¸ä¸ª key-value å¯¹ï¼\n * getï¼æ ¹æ®ä¸ä¸ª key è¯»åç¸åºçvalueå¼ï¼\n * deleteï¼æ ¹æ®ä¸ä¸ª key å é¤æ´ä¸ª key-value å¯¹ã\n\néè¦æ³¨æçæ¯ï¼ æäºé®å¼æ°æ®åºçæ°å/æ´æ°æä½å« setãæ°åå¥åæ´æ°è½ç¶æ¯ç¨ä¸ä¸ªæä½æ¥å£ï¼ä½å¨å®éæ§è¡æ¶ï¼ä¼æ ¹æ® key æ¯å¦å­å¨èæ§è¡ç¸åºçæ°åææ´æ°æµç¨ã\n\nå¨å®éçä¸å¡åºæ¯ä¸­ï¼æä»¬ç»å¸¸ä¼ç¢°å°è¿ç§æåµï¼æ¥è¯¢ä¸ä¸ªç¨æ·å¨ä¸æ®µæ¶é´åçè®¿é®è®°å½ãè¿ç§æä½å¨é®å¼æ°æ®åºä¸­å±äºscan æä½ï¼å³ æ ¹æ®ä¸æ®µ key çèå´è¿åç¸åºç value å¼ãå æ­¤ï¼ put/get/delete/scan æ¯ä¸ä¸ªé®å¼æ°æ®åºçåºæ¬æä½éåã\n\næ­¤å¤ï¼å®éä¸å¡åºæ¯éå¸¸è¿ææ´å ä¸°å¯çéæ±ï¼æ¯å¦ exists æ¥å£ãå¯¹äºä¸ä¸ªå·ä½çé®å¼æ°æ®åºèè¨ï¼ä½ å¯ä»¥éè¿æ¥çæä½ææ¡£ï¼äºè§£å¶è¯¦ç»çæä½æ¥å£ã\n\nç°å¨ï¼æ°æ®æ¨¡ååæä½æ¥å£æä»¬å°±æé å®æäºï¼è¿æ¯æä»¬çåºç¡å·¥ä½ãæ¥ä¸æ¥æ´è¿ä¸æ­¥ï¼éè¦èèä¸ä¸ªéå¸¸éè¦çè®¾è®¡é®é¢ï¼ é®å¼å¯¹ä¿å­å¨åå­è¿æ¯å¤å­ï¼\n\n * ä¿å­å¨åå­çå¥½å¤æ¯è¯»åå¾å¿«ï¼æ½å¨é£é©æ¯ä¸æ¦æçµï¼ææçæ°æ®é½ä¼ä¸¢å¤±ã\n * ä¿å­å¨å¤å­è½å¯ä»¥é¿åæ°æ®ä¸¢å¤±ï¼ä½åéäºç£çæ§è½ï¼æ´ä½æ°æ®åºçæ§è½å°±ä¼è¢«æä½ã\n\nå æ­¤ï¼ å¦ä½è¿è¡è®¾è®¡éæ©ï¼æä»¬éå¸¸éè¦èèé®å¼æ°æ®åºçä¸»è¦åºç¨åºæ¯ãæ¯å¦ï¼ç¼å­åºæ¯ä¸çæ°æ®éè¦è½å¿«éè®¿é®ä½åè®¸ä¸¢å¤±ï¼é£ä¹ï¼ç¨äºæ­¤åºæ¯çé®å¼æ°æ®åºéå¸¸éç¨åå­ä¿å­é®å¼æ°æ®ãmemcached å redis é½æ¯å±äºåå­é®å¼æ°æ®åºã\n\nä¸ºäºåredisä¿æä¸è´ï¼æä»¬ç simplekv å°±éç¨åå­ä¿å­é®å¼æ°æ®ãæ¥ä¸æ¥ï¼æä»¬æ¥äºè§£ä¸ simplekv çåºæ¬ç»ä»¶ãå¤§ä½æ¥è¯´ï¼ä¸ä¸ªé®å¼æ°æ®åºåæ¬äºè®¿é®æ¡æ¶ãç´¢å¼æ¨¡åãæä½æ¨¡ååå­å¨æ¨¡ååé¨åï¼\n\n\n\næ¥ä¸æ¥ï¼æä»¬å°±ä»è¿åä¸ªé¨åå¥æï¼ç»§ç»­æå»ºæä»¬ç simplekvã\n\n\n# 1.3 éç¨ä»ä¹è®¿é®æ¨¡å¼ï¼\n\nè®¿é®æ¨¡å¼éå¸¸æä¸¤ç§ï¼\n\n * ä¸ç§æ¯éè¿å½æ°åºè°ç¨çæ¹å¼ä¾å¤é¨åºç¨ä½¿ç¨ãæ¯å¦ä¸å¾ç libsimplekv.soï¼ä»¥å¨æé¾æ¥åºçå½¢å¼é¾æ¥å°ç¨åºä¸­\n * ä¸ç§æ¯éè¿ç½ç»æ¡æ¶ä»¥ socket éä¿¡çå½¢å¼å¯¹å¤æä¾ kv æä½\n\nå®éçé®å¼æ°æ®åºä¹åºæ¬éç¨ä¸è¿°ä¸¤ç§æ¹å¼ï¼ä¾å¦ï¼rocksdb ä»¥å¨æé¾æ¥åºçå½¢å¼ä½¿ç¨ï¼è memcached å redis åæ¯éè¿ç½ç»æ¡æ¶è®¿é®ã\n\néè¿ç½ç»æ¡æ¶æä¾é®å¼å­å¨æå¡ï¼ä¸æ¹é¢æ©å¤§äºé®å¼æ°æ®åºçåç¨é¢ï¼ä½å¦ä¸æ¹é¢ï¼ä¹ç»é®å¼æ°æ®åºçæ§è½ãè¿è¡æ¨¡åæä¾äºä¸åçè®¾è®¡éæ©ï¼å¸¦æ¥äºä¸äºæ½å¨çé®é¢ã\n\nkv æ°æ®åºéè¿æ¥æ¶ç½ç»æ°æ®åï¼å¹¶æç§åè®®è¿è¡è§£æå¾å°æä½ï¼ç¶åæ§è¡ãæ­¤æ¶ï¼æä»¬ä¼éå°ä¸ä¸ªç³»ç»è®¾è®¡ä¸çé®é¢ï¼ç®åæ¥è¯´ï¼å°±æ¯ç½ç»è¿æ¥çå¤çãç½ç»è¯·æ±çè§£æï¼ä»¥åæ°æ®å­åçå¤çï¼æ¯ç¨ä¸ä¸ªçº¿ç¨ãå¤ä¸ªçº¿ç¨ï¼è¿æ¯å¤ä¸ªè¿ç¨æ¥äº¤äºå¤çå¢ï¼è¯¥å¦ä½è¿è¡è®¾è®¡ååèå¢ï¼æä»¬ä¸è¬æè¿ä¸ªé®é¢ç§°ä¸º i/o æ¨¡åè®¾è®¡ãä¸åç i/o æ¨¡åå¯¹é®å¼æ°æ®åºçæ§è½åå¯æ©å±æ§ä¼æä¸åçå½±åï¼\n\n * å¦æä½¿ç¨åçº¿ç¨ï¼é£ä¸ä¸ªçº¿ç¨æ¢è¦å¤çç½ç»è¿æ¥ãè§£æè¯·æ±ï¼åè¦å®ææ°æ®å­åï¼ä¸æ¦æä¸æ­¥æä½åçé»å¡ï¼æ´ä¸ªçº¿ç¨å°±ä¼é»å¡ä½ï¼è¿å°±éä½äºç³»ç»ååºéåº¦ã\n * å¦æä½¿ç¨å¤çº¿ç¨ï¼é£ä¸åçº¿ç¨é´å¦æéè¦è®¿é®å±äº«èµæºï¼é£åä¼äº§ççº¿ç¨ç«äºï¼ä¹ä¼å½±åç³»ç»æçã\n\nå æ­¤æä»¬éè¦è¿è¡ç²¾å¿çè®¾è®¡æ¥é¢å¯¹è¿ä¸ªä¸¤é¾çé®é¢ã\n\n> ä¹è®¸ä½ å¬è¯´è¿ redis æ¯åçº¿ç¨ï¼é£ redis æ¯å¦ä½åå°âåçº¿ç¨ãé«æ§è½âçå¢ï¼\n\n\n# 1.4 å¦ä½å®ä½é®å¼å¯¹çä½ç½®ï¼\n\nsimplekv æ¥æ¾æä¸ª kv å¯¹çæä½ä¾èµäº kv æ°æ®åºçç´¢å¼æ¨¡åãç´¢å¼çä½ç¨æ¯è®©é®å¼æ°æ®åºæ ¹æ® key æ¾å°ç¸åº value çå­å¨ä½ç½®ï¼è¿èæ§è¡æä½ã\n\nç´¢å¼çç±»åæå¾å¤ï¼å¸¸è§çæåå¸è¡¨ãb+æ ãå­å¸æ ç­ãä¸åçç´¢å¼ç»æå¨æ§è½ãç©ºé´æ¶èãå¹¶åæ§å¶ç­æ¹é¢å·æä¸åçç¹å¾ãmemcached å redis éç¨åå¸è¡¨ä½ä¸º key-value ç´¢å¼ï¼è rocksdb åéç¨è·³è¡¨ä½ä¸ºåå­ä¸­ key-value çç´¢å¼ã\n\nsimplekvçç´¢å¼æ ¹æ® key æ¾å° value çå­å¨ä½ç½®å³å¯ãä½æ¯ï¼å simplekv ä¸åï¼å¯¹ redis èè¨ï¼å®ç value æ¯æå¤ç§ç±»åï¼å½æä»¬éè¿ç´¢å¼æ¾å°ä¸ä¸ª key æå¯¹åºç value åï¼ä»ç¶éè¦ä» value çå¤æç»æï¼ä¾å¦éåååè¡¨ï¼ä¸­è¿ä¸æ­¥æ¾å°æä»¬å®ééè¦çæ°æ®ï¼è¿ä¸ªæä½çæçæ¬èº«å°±ä¾èµäºå®ä»¬çå®ç°ç»æã\n\nredis éç¨ä¸äºå¸¸è§çé«æç´¢å¼ç»æä½ä¸ºæäº value ç±»åçåºå±æ°æ®ç»æï¼è¿ä¸ææ¯è·¯çº¿ä¸º redis å®ç°é«æ§è½è®¿é®æä¾äºè¯å¥½çæ¯æã\n\n\n# 1.5 ä¸åæä½çå·ä½é»è¾æ¯ææ ·çï¼\n\nsimplekv æ¾å°æ°æ®çå­å¨ä½ç½®åï¼å¯¹äºä¸åçæä½ï¼å¶è¿ä¸æ­¥æ§è¡çæä½é»è¾ä¹ææå·®å¼ã\n\nsimplekv çæä½æ¨¡åå°±å®ç°äºä¸åæä½çå·ä½é»è¾ï¼\n\n * get/scanï¼ç«å»è¿åå½åä½ç½®ç value å³å¯ï¼\n * putï¼ä¸ºæ° kv pair åéåå­ç©ºé´ï¼\n * deleteï¼å é¤ kv pairï¼å¹¶éæ¾ç¸åºåå­ç©ºé´ï¼è¿ä¸ªè¿ç¨ç±åéå¨å®æã\n\nå¯¹äº put æ delete æä½ï¼æ¶åå°äºåéåéæ¾åå­ï¼è¿å°±éè¦ simplekv æ°æ®åºçå­å¨æ¨¡åäºã\n\n\n# 1.6 å¦ä½å®ç°éå¯åå¿«éæä¾æå¡ï¼\n\nsimplekv éç¨äºå¸¸ç¨çåå­åéå¨ glibc ç malloc å freeï¼å æ­¤ï¼simplekv å¹¶ä¸éè¦ç¹å«èèåå­ç©ºé´çç®¡çé®é¢ã\n\nä½æ¯ï¼kv æ°æ®åºç kv pair éå¸¸å¤§å°ä¸ä¸ï¼glibc çåéå¨å¨å¤çéæºçå¤§å°åå­ååéæ¶è¡¨ç°å¹¶ä¸å¥½ãä¸æ¦ä¿å­çé®å¼å¯¹æ°æ®è§æ¨¡è¿å¤§ï¼å°±å¯è½ä¼é æè¾ä¸¥éçåå­ç¢çé®é¢ã\n\nå æ­¤ï¼åéå¨æ¯ kv æ°æ®åºçä¸ä¸ªå³é®å ç´ ãredis çåå­åéå¨æä¾äºå¤ç§éæ©ï¼åéæçä¹ä¸ä¸æ ·ï¼åé¢ä¼å¯¹æ­¤å±å¼è®²è¿°ã\n\nsimplekv è½ç¶ä¾èµäºåå­ä¿å­æ°æ®ï¼æä¾å¿«éè®¿é®ï¼ä½æ¯ï¼æä¹å¸æ simplekv éå¯åè½å¿«ééæ°æä¾æå¡ï¼æä»¥ï¼æå¨ simplekv çå­å¨æ¨¡åä¸­å¢å äºæä¹ååè½ãä¸è¿ï¼é´äºç£çç®¡çè¦æ¯åå­ç®¡çå¤æï¼simplekv å°±ç´æ¥éç¨äºæä»¶å½¢å¼ï¼å°é®å¼æ°æ®éè¿è°ç¨æ¬å°æä»¶ç³»ç»çæä½æ¥å£ä¿å­å¨ç£çä¸ã\n\næ­¤æ¶ï¼simplekv åªéè¦èèä½æ¶å°åå­ä¸­çé®å¼æ°æ®ä¿å­å°æä»¶ä¸­ï¼\n\n * ä¸ç§æ¹å¼æ¯ï¼æ¯æ¬¡ kv pair çä¿®æ¹é½è¿è¡è½çæä½ãè½ç¶è¿æ´å¯é ï¼ä½æ§è½ä¼åå°å¾å¤§å½±åã\n * ä¸ç§æ¹å¼æ¯ï¼å¨ææ§å°æåå­ä¸­ç kv pair åæ­¥å°æä»¶ä¸­ãä½è¿é¢ä¸´æ°æ®ä¸¢å¤±çé£é©ã\n\nredis ä¹æä¾äºæä¹ååè½ãä¸è¿ï¼ä¸ºäºéåºä¸åçä¸å¡åºæ¯ï¼redis ä¸ºæä¹åæä¾äºè¯¸å¤çæ§è¡æºå¶åä¼åæ¹è¿ãåé¢ä¼å¯¹ redis çæä¹åæºå¶çè®¾è®¡è¿è¡è®¨è®ºã\n\n\n# 1.7 å°ç»\n\nå¨äºè§£äºè¿ä¸ª simplekv çåºæ¬ç»ä»¶åï¼åå­¦ä¹  redis è¿ä¸ªä¸°å¯çç simplekv æ¶å°±ä¼è½»æ¾å¾å¤ãä¸ºäºæ¯ææ´å ä¸°å¯çä¸å¡åºæ¯ï¼rediså¯¹è¿äºç»ä»¶æèåè½è¿è¡äºæ©å±ï¼æèè¯´æ¯è¿è¡äºç²¾ç»ä¼åï¼ä»èæ»¡è¶³äºåè½åæ§è½ç­æ¹é¢çè¦æ±ã\n\n\n\nä» simplekv å° redisï¼ä¸»è¦æä»¥ä¸éè¦ååï¼\n\n * redis ä¸»è¦éè¿ç½ç»æ¡æ¶è¿è¡è®¿é®ï¼èä¸åæ¯å¨æåºäºã\n * value çç±»åæ´å ä¸°å¯ï¼å æ­¤å¯æ¯æçæä½ä¹æ´å ä¸°å¯ã\n * redisçæä¹åæ¨¡åè½æ¯æä¸¤ç§æ¹å¼ï¼æ¥å¿ï¼aofï¼åå¿«ç§ï¼rdbï¼ã\n * simplekv æ¯ä¸ªç®åçåæºé®å¼æ°æ®åºï¼ä½æ¯ï¼redis æ¯æé«å¯é éç¾¤åé«å¯æ©å±éç¾¤ï¼å æ­¤ï¼redis ä¸­åå«äºç¸åºçéç¾¤åè½æ¯ææ¨¡åã\n\n\n# 2. æ°æ®ç»æï¼å¿«éçredisæåªäºæ¢æä½ï¼\n\nredis çâå¿«âæä¸ä¸ªéè¦è¡¨ç°ï¼å®æ¥æ¶å°ä¸ä¸ªé®å¼å¯¹æä½åï¼è½ä»¥å¾®ç§çº§å«çéåº¦æ¾å°æ°æ®ï¼å¹¶å¿«éå®ææä½ã\n\næ°æ®åºè¿ä¹å¤ï¼ä¸ºå¥ redis è½æè¿ä¹çªåºçè¡¨ç°å¢ï¼\n\n * ä¸æ¹é¢ï¼æä½å¨åå­ä¸­å®æ\n * å¦ä¸æ¹é¢ï¼å½åäºå®çæ°æ®ç»æï¼é«æçæ°æ®ç»ææ¯ redis å¿«éå¤çæ°æ®çåºç¡ã\n\n> è¿éè¯´çæ°æ®ç»ææ¯ææ°æ®åºä¸­ value çæ°æ®ç±»åï¼å¾ä¸­ç»¿è²çååï¼çåºå±å®ç°æ¹å¼\n\nç®åæ¥è¯´ï¼åºå±æ°æ®ç»æä¸å±æ 6 ç§ï¼ç®åå¨æå­ç¬¦ä¸²ãååé¾è¡¨ãåç¼©åè¡¨ãåå¸è¡¨ãè·³è¡¨åæ´æ°æ°ç»ãå®ä»¬åæ°æ®ç±»åçå¯¹åºå³ç³»å¦ä¸å¾æç¤ºï¼\n\n\n\nå¯ä»¥çå°ï¼string ç±»åçåºå±å®ç°åªæä¸ç§æ°æ®ç»æï¼ä¹å°±æ¯ç®åå¨æå­ç¬¦ä¸²ãè listãhashãset å sorted set è¿åç§æ°æ®ç±»åï¼é½æä¸¤ç§åºå±å®ç°ç»æãéå¸¸æåµä¸ï¼æä»¬ä¼æè¿åç§ç±»åç§°ä¸ºéåç±»åï¼å®ä»¬çç¹ç¹æ¯ä¸ä¸ªé®å¯¹åºäºä¸ä¸ªéåçæ°æ®ã\n\nçå°è¿éï¼å¶å®æäºé®é¢å·²ç»å¼å¾æä»¬å»èèäºï¼\n\n * è¿äºæ°æ®ç»æé½æ¯å¼çåºå±å®ç°ï¼é®åå¼æ¬èº«ä¹é´ç¨ä»ä¹ç»æç»ç»ï¼\n * ä¸ºä»ä¹éåç±»åæé£ä¹å¤çåºå±ç»æï¼å®ä»¬é½æ¯æä¹ç»ç»æ°æ®çï¼é½å¾å¿«åï¼\n * ä»ä¹æ¯ç®åå¨æå­ç¬¦ä¸²ï¼åå¸¸ç¨çå­ç¬¦ä¸²æ¯ä¸åäºåï¼\n\næ¥ä¸æ¥ï¼æå°±åä½ èèåä¸¤ä¸ªé®é¢ãè¿æ ·ï¼ä½ ä¸ä»å¯ä»¥ç¥é redisâå¿«âçåºæ¬åçï¼è¿å¯ä»¥åæ­¤çè§£ redis ä¸­æåªäºæ½å¨çâæ¢æä½âï¼æå¤§å redis çæ§è½ä¼å¿ãèå³äºç®åå¨æå­ç¬¦ä¸²ï¼ä¼å¨åé¢çè¯¾ç¨ç»§ç»­è®¨è®ºã\n\n\n# 2.1 key å value ç¨ä»ä¹ç»æç»ç»ï¼\n\nä¸ºäºå®ç°ä» key å° value çå¿«éè®¿é®ï¼redis ä½¿ç¨äºä¸ä¸ªåå¸è¡¨æ¥ä¿å­ææé®å¼å¯¹ã\n\nä¸ä¸ªåå¸è¡¨ï¼å¶å®å°±æ¯ä¸ä¸ªæ°ç»ï¼æ°ç»çæ¯ä¸ªåç´ ç§°ä¸ºä¸ä¸ªåå¸æ¡¶ãæä»¥ï¼æä»¬å¸¸è¯´ï¼ä¸ä¸ªåå¸è¡¨æ¯ç±å¤ä¸ªåå¸æ¡¶ç»æçï¼æ¯ä¸ªåå¸æ¡¶ä¸­ä¿å­äºé®å¼å¯¹æ°æ®ãåå¸æ¡¶ä¸­çåç´ ä¿å­çä¸æ¯å¼æ¬èº«ï¼èæ¯ä¸ä¸ª pointerï¼è¿æ ·ä¸ç®¡ value æ¯ string è¿æ¯ collection ç±»åï¼åå¸æ¡¶ä¸­çåç´ é½æ¯æåå®ä»¬ç pointerã\n\nå¦ä¸å¾æç¤ºï¼åå¸æ¡¶ä¸­ç entry åç´ ä¸­ä¿å­äº key å value ç pointerï¼\n\n\n\nå ä¸ºè¿ä¸ªåå¸è¡¨ä¿å­äºææçé®å¼å¯¹ï¼æä»¥ï¼æä¹æå®ç§°ä¸ºå¨å±åå¸è¡¨ãä½¿ç¨ hash table å¯ä»¥å¨ o(1) æ¶é´å¤æåº¦ä¸è®¿é®å°ç¸åºç entry åç´ ãââéè¿è®¡ç® key çåå¸å¼ï¼å¾å°åå¸æ¡¶çä½ç½®ï¼å°±å¯ä»¥è®¿é®å° kv pair äºã\n\nä½æ¯ï¼éçå¾ redis åå¥å¤§éæ°æ®åï¼ä¼åç°æä½ææ¶åçªç¶åæ¢äºï¼å ä¸ºæä¸ä¸ªæ½å¨çé£é©ç¹ï¼åå¸è¡¨çå²çªé®é¢å rehash å¯è½å¸¦æ¥çæä½é»å¡ã\n\n\n# 2.2 ä¸ºä»ä¹åå¸è¡¨æä½åæ¢äºââåå¸å²çª\n\nå½æ°æ®å¢å¤ï¼åå¸å²çªæ¯ä¸å¯é¿åçé®é¢ã\n\nredis è§£å³åå¸å²çªçæ¹å¼ï¼å°±æ¯é¾å¼åå¸ï¼åä¸ä¸ªåå¸æ¡¶ä¸­çå¤ä¸ªåç´ ç¨ä¸ä¸ªé¾è¡¨æ¥ä¿å­ï¼å®ä»¬ä¹é´ä¾æ¬¡ç¨æéè¿æ¥ã\n\nå¦ä¸å¾æç¤ºï¼å²çªçåç´ å½¢æçé¾è¡¨ï¼å«ååå¸å²çªé¾ã\n\n\n\nä½éçåå¸å²çªè¶æ¥è¶å¤ï¼ä¸æ¡åå¸å²çªé¾çé entry æ¥æ¾ä¼éä½æ§è½ãæä»¥ï¼redis ä¼å¯¹åå¸è¡¨å rehash æä½ï¼å¢å ç°æçåå¸æ¡¶æ°éï¼è®©éæ¸å¢å¤ç entry åç´ è½å¨æ´å¤çæ¡¶ä¹é´åæ£ä¿å­ï¼åå°åä¸ªæ¡¶ä¸­çåç´ æ°éï¼ä»èåå°åä¸ªæ¡¶ä¸­çå²çªã\n\nrehash å·ä½æä¹åå¢ï¼\n\nä¸ºäºä½¿ rehash æä½æ´é«æï¼redis é»è®¤ä½¿ç¨äºä¸¤ä¸ªå¨å±åå¸è¡¨ï¼åå¸è¡¨ 1 ååå¸è¡¨ 2ãä¸å¼å§ï¼å½ä½ åæå¥æ°æ®æ¶ï¼é»è®¤ä½¿ç¨åå¸è¡¨ 1ï¼æ­¤æ¶çåå¸è¡¨ 2 å¹¶æ²¡æè¢«åéç©ºé´ãéçæ°æ®éæ­¥å¢å¤ï¼redis å¼å§æ§è¡ rehashï¼è¿ä¸ªè¿ç¨åä¸ºä¸æ­¥ï¼\n\n 1. ç»åå¸è¡¨ 2 åéæ´å¤§çç©ºé´ï¼ä¾å¦æ¯å½ååå¸è¡¨ 1 å¤§å°çä¸¤åï¼\n 2. æåå¸è¡¨ 1 ä¸­çæ°æ®éæ°æ å°å¹¶æ·è´å°åå¸è¡¨ 2 ä¸­ï¼\n 3. éæ¾åå¸è¡¨ 1 çç©ºé´ã\n\nå°æ­¤ï¼æä»¬å°±å¯ä»¥ä»åå¸è¡¨ 1 åæ¢å°åå¸è¡¨ 2ï¼ç¨å¢å¤§çåå¸è¡¨ 2 ä¿å­æ´å¤æ°æ®ï¼èåæ¥çåå¸è¡¨ 1 çä½ä¸ä¸æ¬¡ rehash æ©å®¹å¤ç¨ã\n\nè¿ä¸ªè¿ç¨çä¼¼ç®åï¼ä½æ¯ç¬¬äºæ­¥æ¶åå¤§éçæ°æ®æ·è´ï¼å¦æä¸æ¬¡æ§æåå¸è¡¨ 1 ä¸­çæ°æ®é½è¿ç§»å®ï¼ä¼é æ redis çº¿ç¨é»å¡ï¼æ æ³æå¡å¶ä»è¯·æ±ãæ­¤æ¶ï¼redis å°±æ æ³å¿«éè®¿é®æ°æ®äºãä¸ºäºé¿åè¿ä¸ªé®é¢ï¼redis éç¨äºæ¸è¿å¼ rehashï¼\n\nç®åæ¥è¯´å°±æ¯å¨ç¬¬äºæ­¥æ·è´æ°æ®æ¶ï¼redis ä»ç¶æ­£å¸¸å¤çå®¢æ·ç«¯è¯·æ±ï¼æ¯å¤çä¸ä¸ªè¯·æ±æ¶ï¼ä»åå¸è¡¨ 1 ä¸­çç¬¬ä¸ä¸ªç´¢å¼ä½ç½®å¼å§ï¼é¡ºå¸¦çå°è¿ä¸ªç´¢å¼ä½ç½®ä¸çææ entries æ·è´å°åå¸è¡¨ 2 ä¸­ï¼ç­å¤çä¸ä¸ä¸ªè¯·æ±æ¶ï¼åé¡ºå¸¦æ·è´åå¸è¡¨ 1 ä¸­çä¸ä¸ä¸ªç´¢å¼ä½ç½®ç entriesãå¦ä¸å¾æç¤ºï¼\n\n\n\nè¿æ ·å°±å·§å¦å°æä¸æ¬¡æ§å¤§éæ·è´çå¼éï¼åæå°äºå¤æ¬¡å¤çè¯·æ±çè¿ç¨ä¸­ï¼é¿åäºèæ¶æä½ï¼ä¿è¯äºæ°æ®çå¿«éè®¿é®ã\n\nå°è¿éï¼ä½ å°±è½çè§£ redis ç key å value æ¯æä¹éè¿åå¸è¡¨æ¥ç»ç»çäºã\n\n * å¯¹äº value ä¸º string ç±»åçæ¥è¯´ï¼æ¾å° entry å°±å¯ä»¥ç´æ¥ crud äºï¼æä½å¤æåº¦ o(1)ã\n * å¯¹äº value ä¸º collection ç±»åçæ¥è¯´ï¼æ¾å° entry åè¿è¦å¨éåä¸­è¿ä¸æ­¥æä½ã\n\næ¥ä¸æ¥æ¥çå¨ collection ç±»åä¸­çæä½æçåæ¯ææ ·çã\n\n\n# 2.3 éåæ°æ®çæä½æç\n\nå string ç±»åä¸åï¼ä¸ä¸ªéåç±»åç valueï¼ç¬¬ä¸æ­¥æ¯éè¿å¨å±åå¸è¡¨æ¾å°å¯¹åºçåå¸æ¡¶ä½ç½®ï¼ç¬¬äºæ­¥æ¯å¨éåä¸­åå¢å æ¹æ¥ãé£ä¹ï¼éåçæä½æçååªäºå ç´ ç¸å³å¢ï¼\n\n 1. ä¸åºå±çæ°æ®ç»ææå³\n 2. ä¸æä½æ¬èº«çæ§è¡ç¹ç¹æå³\n\næ¥ä¸æ¥ï¼æä»¬å°±åå«èèéåç±»åçåºå±æ°æ®ç»æåæä½å¤æåº¦ã\n\n# 2.3.1 æåªäºåºå±æ°æ®ç»æ\n\néåç±»åçåºå±æ°æ®ç»æä¸»è¦æ 5 ç§ï¼æ´æ°æ°ç»ãååé¾è¡¨ãåå¸è¡¨ãåç¼©åè¡¨åè·³è¡¨ï¼\n\n * åå¸è¡¨çæä½æä»¬å·²ç»äºè§£äºï¼\n * æ´æ°æ°ç»åååé¾è¡¨å¹³æ¶å¾å¸¸è§ï¼å¶æä½ç¹å¾æ¯é¡ºåºè¯»åï¼éè¿æ°ç»ä¸æ æèé¾è¡¨çæééä¸ªåç´ è®¿é®ï¼æä½å¤æåº¦å¾å¾æ¯ o(n)ï¼\n * åç¼©è·³è¡¨åè·³è¡¨å¹³æ¶æ¥è§¦ä¸å¤ï¼ä½ä¹æ¯ redis çéè¦æ°æ®ç»æï¼ä¸é¢éç¹è§£éè¿é¨åã\n\n----------------------------------------\n\nåç¼©åè¡¨ï¼\n\nåç¼©åè¡¨å®éä¸ç±»ä¼¼äºä¸ä¸ªæ°ç»ï¼æ°ç»ä¸­çæ¯ä¸ä¸ªåç´ é½å¯¹åºä¿å­ä¸ä¸ªæ°æ®ãåæ°ç»ä¸åçæ¯ï¼åç¼©åè¡¨å¨è¡¨å¤´æä¸ä¸ªå­æ®µï¼\n\n * zlbytesï¼åè¡¨é¿åº¦\n * zltailï¼åè¡¨å°¾çåç§»é\n * zllenï¼åè¡¨ä¸­ç entry çä¸ªæ°\n\n\n\nå¨åç¼©åè¡¨ä¸­ï¼å®ä½ç¬¬ä¸ä¸ªåæåä¸ä¸ªåç´ ï¼å¯ä»¥éè¿è¡¨å¤´ä¸ä¸ªå­æ®µçé¿åº¦ç´æ¥å®ä½ï¼å¤æåº¦æ¯o(1)ãèæ¥æ¾å¶ä»åç´ æ¶ï¼åªè½éä¸ªæ¥æ¾ï¼æ­¤æ¶çå¤æåº¦å°±æ¯o(n)äºã\n\n----------------------------------------\n\nè·³è¡¨ï¼\n\næåºé¾è¡¨åªè½éä¸æ¥æ¾åç´ ï¼å¯¼è´æä½èµ·æ¥éå¸¸ç¼æ¢ï¼äºæ¯å°±åºç°äºè·³è¡¨ãå·ä½æ¥è¯´ï¼è·³è¡¨å¨é¾è¡¨çåºç¡ä¸ï¼å¢å äºå¤çº§ç´¢å¼ï¼éè¿ç´¢å¼ä½ç½®çå ä¸ªè·³è½¬ï¼å®ç°æ°æ®çå¿«éå®ä½ï¼å¦ä¸å¾æç¤ºï¼\n\n\n\nå¦ææä»¬è¦å¨é¾è¡¨ä¸­æ¥æ¾ 33 è¿ä¸ªåç´ ï¼åªè½ä»å¤´å¼å§éåé¾è¡¨ï¼æ¥æ¾ 6 æ¬¡ï¼ç´å°æ¾å° 33 ä¸ºæ­¢ãæ­¤æ¶ï¼å¤æåº¦æ¯ o(n)ï¼æ¥æ¾æçå¾ä½ã\n\nä¸ºäºæé«æ¥æ¾éåº¦ï¼æä»¬æ¥å¢å ä¸çº§ç´¢å¼ï¼ä»ç¬¬ä¸ä¸ªåç´ å¼å§ï¼æ¯ä¸¤ä¸ªåç´ éä¸ä¸ªåºæ¥ä½ä¸ºç´¢å¼ãè¿äºç´¢å¼åéè¿æéæååå§çé¾è¡¨ãä¾å¦ï¼ä»åä¸¤ä¸ªåç´ ä¸­æ½ååç´  1 ä½ä¸ºä¸çº§ç´¢å¼ï¼ä»ç¬¬ä¸ãåä¸ªåç´ ä¸­æ½ååç´  11 ä½ä¸ºä¸çº§ç´¢å¼ãæ­¤æ¶ï¼æä»¬åªéè¦ 4 æ¬¡æ¥æ¾å°±è½å®ä½å°åç´  33 äºã\n\nå¦ææä»¬è¿æ³åå¿«ï¼å¯ä»¥åå¢å äºçº§ç´¢å¼ï¼ä»ä¸çº§ç´¢å¼ä¸­ï¼åæ½åé¨ååç´ ä½ä¸ºäºçº§ç´¢å¼ãä¾å¦ï¼ä»ä¸çº§ç´¢å¼ä¸­æ½å 1ã27ã100 ä½ä¸ºäºçº§ç´¢å¼ï¼äºçº§ç´¢å¼æåä¸çº§ç´¢å¼ãè¿æ ·ï¼æä»¬åªéè¦ 3 æ¬¡æ¥æ¾ï¼å°±è½å®ä½å°åç´  33 äºã\n\nå¯ä»¥çå°ï¼è¿ä¸ªæ¥æ¾è¿ç¨å°±æ¯å¨å¤çº§ç´¢å¼ä¸è·³æ¥è·³å»ï¼æåå®ä½å°åç´ ãè¿ä¹æ­£å¥½ç¬¦åâè·³âè¡¨çå«æ³ãå½æ°æ®éå¾å¤§æ¶ï¼è·³è¡¨çæ¥æ¾å¤æåº¦å°±æ¯ $o(logn)$ã\n\nå¥½äºï¼æä»¬ç°å¨å¯ä»¥æç§æ¥æ¾çæ¶é´å¤æåº¦ç»è¿äºæ°æ®ç»æåä¸ç±»äºï¼\n\n\n\n# 2.3.2 ä¸åæä½çå¤æåº¦\n\néåç±»åçæä½ç±»åå¾å¤ï¼æè¯»ååä¸ªéååç´ çï¼ä¾å¦ hgetãhsetï¼ä¹ææä½å¤ä¸ªåç´ çï¼ä¾å¦ saddï¼è¿æå¯¹æ´ä¸ªéåè¿è¡éåæä½çï¼ä¾å¦ smembersãè¿ä¹å¤æä½ï¼å®ä»¬çå¤æåº¦ä¹åä¸ç¸åãèå¤æåº¦çé«ä½åæ¯æä»¬éæ©éåç±»åçéè¦ä¾æ®ã\n\nææ»ç»äºä¸ä¸ªâåå¥å£è¯âï¼å¸æè½å¸®å©ä½ å¿«éè®°ä½éåå¸¸è§æä½çå¤æåº¦ãè¿æ ·ä½ å¨ä½¿ç¨è¿ç¨ä¸­ï¼å°±å¯ä»¥æåè§é¿é«å¤æåº¦æä½äºï¼\n\n * ååç´ æä½æ¯åºç¡ï¼\n * èå´æä½éå¸¸èæ¶ï¼\n * ç»è®¡æä½éå¸¸é«æï¼\n * ä¾å¤æåµåªæå ä¸ªã\n\nç¬¬ä¸ï¼ååç´ æä½ï¼æ¯ææ¯ä¸ç§éåç±»åå¯¹åä¸ªæ°æ®å®ç°çå¢å æ¹æ¥æä½ãä¾å¦ï¼hash ç±»åç hgetãhset å hdelï¼set ç±»åç saddãsremãsrandmember ç­ãè¿äºæä½çå¤æåº¦ç±éåéç¨çæ°æ®ç»æå³å®ï¼ä¾å¦ï¼hgetãhset å hdel æ¯å¯¹åå¸è¡¨åæä½ï¼æä»¥å®ä»¬çå¤æåº¦é½æ¯ o(1)ï¼set ç±»åç¨åå¸è¡¨ä½ä¸ºåºå±æ°æ®ç»ææ¶ï¼å®ç saddãsremãsrandmember å¤æåº¦ä¹æ¯ o(1)ã\n\nè¿éï¼æä¸ªå°æ¹ä½ éè¦æ³¨æä¸ä¸ï¼éåç±»åæ¯æåæ¶å¯¹å¤ä¸ªåç´ è¿è¡å¢å æ¹æ¥ï¼ä¾å¦ hash ç±»åç hmget å hmsetï¼set ç±»åç sadd ä¹æ¯æåæ¶å¢å å¤ä¸ªåç´ ãæ­¤æ¶ï¼è¿äºæä½çå¤æåº¦ï¼å°±æ¯ç±åä¸ªåç´ æä½å¤æåº¦ååç´ ä¸ªæ°å³å®çãä¾å¦ï¼hmset å¢å  m ä¸ªåç´ æ¶ï¼å¤æåº¦å°±ä» o(1) åæ o(m) äºã\n\nç¬¬äºï¼èå´æä½ï¼æ¯æéåç±»åä¸­çéåæä½ï¼å¯ä»¥è¿åéåä¸­çæææ°æ®ï¼æ¯å¦ hash ç±»åç hgetall å set ç±»åç smembersï¼æèè¿åä¸ä¸ªèå´åçé¨åæ°æ®ï¼æ¯å¦ list ç±»åç lrange å zset ç±»åç zrangeãè¿ç±»æä½çå¤æåº¦ä¸è¬æ¯ o(n)ï¼æ¯è¾èæ¶ï¼æä»¬åºè¯¥å°½éé¿åã\n\nä¸è¿ï¼redis ä» 2.8 çæ¬å¼å§æä¾äº scan ç³»åæä½ï¼åæ¬ hscanï¼sscan å zscanï¼ï¼è¿ç±»æä½å®ç°äºæ¸è¿å¼éåï¼æ¯æ¬¡åªè¿åæéæ°éçæ°æ®ãè¿æ ·ä¸æ¥ï¼ç¸æ¯äº hgetallãsmembers è¿ç±»æä½æ¥è¯´ï¼å°±é¿åäºä¸æ¬¡æ§è¿åææåç´ èå¯¼è´ç redis é»å¡ã\n\nç¬¬ä¸ï¼ç»è®¡æä½ï¼æ¯æéåç±»åå¯¹éåä¸­ææåç´ ä¸ªæ°çè®°å½ï¼ä¾å¦ llen å scardãè¿ç±»æä½å¤æåº¦åªæ o(1)ï¼è¿æ¯å ä¸ºå½éåç±»åéç¨åç¼©åè¡¨ãååé¾è¡¨ãæ´æ°æ°ç»è¿äºæ°æ®ç»ææ¶ï¼è¿äºç»æä¸­ä¸é¨è®°å½äºåç´ çä¸ªæ°ç»è®¡ï¼å æ­¤å¯ä»¥é«æå°å®æç¸å³æä½ã\n\nç¬¬åï¼ä¾å¤æåµï¼æ¯ææäºæ°æ®ç»æçç¹æ®è®°å½ï¼ä¾å¦åç¼©åè¡¨åååé¾è¡¨é½ä¼è®°å½è¡¨å¤´åè¡¨å°¾çåç§»éãè¿æ ·ä¸æ¥ï¼å¯¹äº list ç±»åç lpopãrpopãlpushãrpush è¿åä¸ªæä½æ¥è¯´ï¼å®ä»¬æ¯å¨åè¡¨çå¤´å°¾å¢å åç´ ï¼è¿å°±å¯ä»¥éè¿åç§»éç´æ¥å®ä½ï¼æä»¥å®ä»¬çå¤æåº¦ä¹åªæ o(1)ï¼å¯ä»¥å®ç°å¿«éæä½ã\n\n\n# 2.4 å°ç»\n\nè¿ä¸å¤§èå­¦ä¹ äº redis çåºå±æ°æ®ç»æï¼åæ¬ redis æ´ä½çç¨æ¥ä¿å­æ¯ä¸ª kv çå¨å±åå¸è¡¨ç»æï¼ä¹åæ¬æ¯æéåç±»åå®ç°çååé¾è¡¨ãåç¼©åè¡¨ãæ´æ°æ°ç»ãåå¸è¡¨åè·³è¡¨è¿äºå¤§åºå±ç»æã\n\nredis ä¹æä»¥è½å¿«éæä½é®å¼å¯¹ï¼ä¸æ¹é¢æ¯å ä¸º o(1) å¤æåº¦çåå¸è¡¨è¢«å¹¿æ³ä½¿ç¨ï¼åæ¬ stringãhash å setï¼å®ä»¬çæä½å¤æåº¦åºæ¬ç±åå¸è¡¨å³å®ï¼å¦ä¸æ¹é¢ï¼sorted set ä¹éç¨äº o(logn) å¤æåº¦çè·³è¡¨ãä¸è¿ï¼éåç±»åçèå´æä½ï¼å ä¸ºè¦éååºå±æ°æ®ç»æï¼å¤æåº¦éå¸¸æ¯ o(n)ãè¿éï¼æçå»ºè®®æ¯ï¼ç¨å¶ä»å½ä»¤æ¥æ¿ä»£ï¼ä¾å¦å¯ä»¥ç¨ scan æ¥ä»£æ¿ï¼é¿åå¨ redis åé¨äº§çè´¹æ¶çå¨éåéåæä½ã\n\nå½ç¶ï¼æä»¬ä¸è½å¿äºå¤æåº¦è¾é«ç list ç±»åï¼å®çä¸¤ç§åºå±å®ç°ç»æï¼ååé¾è¡¨ååç¼©åè¡¨çæä½å¤æåº¦é½æ¯ o(n)ãå æ­¤ï¼æçå»ºè®®æ¯ï¼å å°å¶å®å°ä½¿ç¨ list ç±»åãä¾å¦ï¼æ¢ç¶å®ç pop/push æçå¾é«ï¼é£ä¹å°±å°å®ä¸»è¦ç¨äº fifo éååºæ¯ï¼èä¸æ¯ä½ä¸ºä¸ä¸ªå¯ä»¥éæºè¯»åçéåã\n\nredis æ°æ®ç±»åä¸°å¯ï¼æå¥½çåæ³å°±æ¯ææ¡åçï¼ä»åçä¸æ¨æ­ä¸åæä½çå¤æåº¦ï¼ä»èå¿«éåçå°ååºéæ©\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼redisä»ä¹æ¶åå rehashï¼\n\nredisä¼ä½¿ç¨è£è½½å å­ï¼load factorï¼æ¥å¤æ­æ¯å¦éè¦å rehashãè£è½½å å­çè®¡ç®æ¹å¼æ¯ï¼åå¸è¡¨ä¸­ææ entry çä¸ªæ°é¤ä»¥åå¸è¡¨çåå¸æ¡¶ä¸ªæ°ãredisä¼æ ¹æ®è£è½½å å­çä¸¤ç§æåµï¼æ¥è§¦å rehash æä½ï¼\n\n * è£è½½å å­â¥1ï¼åæ¶ï¼åå¸è¡¨è¢«åè®¸è¿è¡ rehashï¼\n * è£è½½å å­â¥5ã\n\nå¨ç¬¬ä¸ç§æåµä¸ï¼å¦æè£è½½å å­ç­äº1ï¼åæ¶æä»¬åè®¾ï¼ææé®å¼å¯¹æ¯å¹³ååå¸å¨åå¸è¡¨çåä¸ªæ¡¶ä¸­çï¼é£ä¹ï¼æ­¤æ¶ï¼åå¸è¡¨å¯ä»¥ä¸ç¨é¾å¼åå¸ï¼å ä¸ºä¸ä¸ªåå¸æ¡¶æ­£å¥½ä¿å­äºä¸ä¸ªé®å¼å¯¹ã\n\nä½æ¯ï¼å¦ææ­¤æ¶åææ°çæ°æ®åå¥ï¼åå¸è¡¨å°±è¦ä½¿ç¨é¾å¼åå¸äºï¼è¿ä¼å¯¹æ¥è¯¢æ§è½äº§çå½±åãå¨è¿è¡rdbçæåaoféåæ¶ï¼åå¸è¡¨çrehashæ¯è¢«ç¦æ­¢çï¼è¿æ¯ä¸ºäºé¿åå¯¹rdbåaoféåé æå½±åãå¦ææ­¤æ¶ï¼redisæ²¡æå¨çærdbåéåaofï¼é£ä¹ï¼å°±å¯ä»¥è¿è¡rehashãå¦åçè¯ï¼åææ°æ®åå¥æ¶ï¼åå¸è¡¨å°±è¦å¼å§ä½¿ç¨æ¥è¯¢è¾æ¢çé¾å¼åå¸äºã\n\nå¨ç¬¬äºç§æåµä¸ï¼ä¹å°±æ¯è£è½½å å­å¤§äºç­äº5æ¶ï¼å°±è¡¨æå½åä¿å­çæ°æ®éå·²ç»è¿è¿å¤§äºåå¸æ¡¶çä¸ªæ°ï¼åå¸æ¡¶éä¼æå¤§éçé¾å¼åå¸å­å¨ï¼æ§è½ä¼åå°ä¸¥éå½±åï¼æ­¤æ¶ï¼å°±ç«é©¬å¼å§årehashã\n\nååè¯´çæ¯è§¦årehashçæåµï¼å¦æè£è½½å å­å°äº1ï¼æèè£è½½å å­å¤§äº1ä½æ¯å°äº5ï¼åæ¶åå¸è¡¨ææ¶ä¸è¢«åè®¸è¿è¡rehashï¼ä¾å¦ï¼å®ä¾æ­£å¨çærdbæèéåaofï¼ï¼æ­¤æ¶ï¼åå¸è¡¨æ¯ä¸ä¼è¿è¡rehashæä½çã\n\næ¬èé®é¢ 2ï¼ æ¸è¿å¼ rehash çæ§è¡æºå¶ââéç¨æ¸è¿å¼hashæ¶ï¼å¦æå®ä¾ææ¶æ²¡ææ¶å°æ°è¯·æ±ï¼æ¯ä¸æ¯å°±ä¸årehashäºï¼\n\nå¶å®ä¸æ¯çãredisä¼æ§è¡å®æ¶ä»»å¡ï¼å®æ¶ä»»å¡ä¸­å°±åå«äºrehashæä½ãæè°çå®æ¶ä»»å¡ï¼å°±æ¯æç§ä¸å®é¢çï¼ä¾å¦æ¯100ms/æ¬¡ï¼æ§è¡çä»»å¡ã\n\nå¨rehashè¢«è§¦ååï¼å³ä½¿æ²¡ææ¶å°æ°è¯·æ±ï¼redisä¹ä¼å®æ¶æ§è¡ä¸æ¬¡rehashæä½ï¼èä¸ï¼æ¯æ¬¡æ§è¡æ¶é¿ä¸ä¼è¶è¿1msï¼ä»¥åå¯¹å¶ä»ä»»å¡é æå½±åã\n\n\n# 3. é«æ§è½ io æ¨¡åï¼ä¸ºä»ä¹åçº¿ç¨è¿è½è¿ä¹å¿«ï¼\n\nè¿ä¸å¤§èæ¢è®¨ï¼ä¸ºä»ä¹åçº¿ç¨ç redis è½é£ä¹å¿«ï¼\n\né¦åè¦åæ¸ä¸ä¸ªäºå®ï¼æä»¬éå¸¸è¯´ç redis æ¯åçº¿ç¨ï¼ä¸»è¦æ¯æ redis çç½ç» io åé®å¼å¯¹è¯»åæ¯ç±ä¸ä¸ªçº¿ç¨æ¥å®æçï¼è¿ä¹æ¯ redis å¯¹å¤æä¾é®å¼å­å¨æå¡çä¸»è¦æµç¨ãä½ redis çå¶ä»åè½ï¼æ¯å¦æä¹åãå¼æ­¥å é¤ãéç¾¤æ°æ®åæ­¥ç­ï¼å¶å®æ¯ç±é¢å¤ççº¿ç¨æ§è¡çã\n\næä»¥ï¼ä¸¥æ ¼æ¥è¯´ï¼redis å¹¶ä¸æ¯åçº¿ç¨ï¼ä½æ¯æä»¬ä¸è¬æ redis ç§°ä¸ºåçº¿ç¨é«æ§è½ï¼è¿æ ·æ¾å¾âé·âäºãå æ­¤æ¥ä¸æ¥æä»¬ä¹ç§° redis ä¸ºåçº¿ç¨æ¨¡å¼ã\n\nè¦å¼æç½è¿èæåºçé®é¢ï¼æä»¬å°±è¦æ·±å¥å°å­¦ä¹ ä¸ redis çåçº¿ç¨è®¾è®¡æºå¶ä»¥åå¤è·¯å¤ç¨æºå¶ãä¹åä½ å¨è°ä¼ redis æ§è½æ¶ï¼ä¹è½æ´æéå¯¹æ§å°é¿åä¼å¯¼è´ redis åçº¿ç¨é»å¡çæä½ï¼ä¾å¦æ§è¡å¤æåº¦é«çå½ä»¤ã\n\n\n# 3.1 redis ä¸ºä»ä¹ç¨åçº¿ç¨ââå¤çº¿ç¨çå¹¶åè®¿é®æ§å¶é®é¢\n\nè¦æ´å¥½å°çè§£ redis ä¸ºä»ä¹ç¨åçº¿ç¨ï¼æä»¬å°±è¦åäºè§£å¤çº¿ç¨çå¼éã\n\nå¯¹äºä¸ä¸ªå¤çº¿ç¨çç³»ç»æ¥è¯´ï¼å¨æåççèµæºåéçæåµä¸ï¼å¯ä»¥å¢å ç³»ç»ä¸­å¤çè¯·æ±æä½çèµæºå®ä½ï¼è¿èæåç³»ç»è½å¤åæ¶å¤ççè¯·æ±æ°ï¼å³ååçãä½éå¸¸æåµä¸å¦ææ²¡æè¯å¥½çè®¾è®¡ï¼å®éå¤çº¿ç¨çè¡¨ç°å¯è½å¹¶ä¸å¥½ï¼å¦ä¸å¾ï¼å·¦è¾¹æ¯æä»¬çææï¼å³è¾¹æ¯å¯è½çå®éè¡¨ç°ï¼\n\n\n\nåºç°è¿ç§æåµçä¸ä¸ªå³é®ç¶é¢å°±æ¯ï¼ç³»ç»éå¸¸ä¼å­å¨è¢«å¤çº¿ç¨åæ¶è®¿é®çå±äº«èµæºï¼ä¸ºä¿è¯æ­£ç¡®æ§çé¢å¤æºå¶ä¼å¸¦æ¥é¢å¤çå¼éãè¿å°±æ¯å¤çº¿ç¨ç¼ç¨æ¨¡å¼é¢ä¸´çå±äº«èµæºçå¹¶åè®¿é®æ§å¶é®é¢ã\n\nå¹¶åè®¿é®æ§å¶ä¸ç´æ¯å¤çº¿ç¨å¼åä¸­çä¸ä¸ªé¾ç¹é®é¢ï¼å¦ææ²¡æç²¾ç»çè®¾è®¡ï¼æ¯å¦è¯´ï¼åªæ¯ç®åå°éç¨ä¸ä¸ªç²ç²åº¦äºæ¥éï¼å°±ä¼åºç°ä¸çæ³çç»æï¼å³ä½¿å¢å äºçº¿ç¨ï¼å¤§é¨åçº¿ç¨ä¹å¨ç­å¾è·åè®¿é®å±äº«èµæºçäºæ¥éï¼å¹¶è¡åä¸²è¡ï¼ç³»ç»ååçå¹¶æ²¡æéççº¿ç¨çå¢å èå¢å ãèä¸ï¼éç¨å¤çº¿ç¨å¼åä¸è¬ä¼å¼å¥åæ­¥åè¯­æ¥ä¿æ¤å±äº«èµæºçå¹¶åè®¿é®ï¼è¿ä¹ä¼éä½ç³»ç»ä»£ç çæè°è¯æ§åå¯ç»´æ¤æ§ãä¸ºäºé¿åè¿äºé®é¢ï¼redis ç´æ¥éç¨äºåçº¿ç¨æ¨¡å¼ã\n\nå°è¿éï¼ä½ åºè¯¥å·²ç»æç½äºâredisä¸ºä»ä¹ç¨åçº¿ç¨âï¼é£ä¹ï¼æ¥ä¸æ¥ï¼æä»¬å°±æ¥ççï¼ä¸ºä»ä¹åçº¿ç¨redisè½è·å¾é«æ§è½ã\n\n\n# 3.2 åçº¿ç¨ redis ä¸ºä»ä¹é£ä¹å¿«ââå¤è·¯å¤ç¨æºå¶\n\nredis ä½¿ç¨åçº¿ç¨æ¨¡åå´è¾¾å°äºæ¯ç§æ°åä¸çº§å«çå¤çè½åï¼è¿æ¯ä¸ºä»ä¹å¢ï¼å¶å®ï¼è¿æ¯ redis å¤æ¹é¢è®¾è®¡éæ©çä¸ä¸ªç»¼åç»æï¼\n\n * ä¸æ¹é¢ï¼å¤§é¨åæä½å¨åå­ä¸å®æï¼åå ä¸éç¨äºé«æçæ°æ®ç»æã\n * å¦ä¸æ¹é¢ï¼redis éç¨äºå¤è·¯å¤ç¨æºå¶ï¼ä½¿å¶å¨ç½ç» io æä½ä¸­è½å¹¶åå¤çå¤§éçå®¢æ·ç«¯è¯·æ±ï¼å®ç°é«ååçã\n\né¦åï¼æä»¬è¦å¼æç½ç½ç»æä½çåºæ¬ io æ¨¡ååæ½å¨çé»å¡ç¹ãæ¯ç«ï¼redis éç¨åçº¿ç¨è¿è¡ ioï¼å¦æçº¿ç¨è¢«é»å¡äºï¼å°±æ æ³è¿è¡å¤è·¯å¤ç¨äºã\n\n# 3.2.1 åºæ¬ io æ¨¡åä¸é»å¡ç¹\n\nä¸æ¬¡ç½ç»äº¤äºçè¿ç¨ï¼ä»¥ get è¯·æ±ä¸ºä¾ï¼ç¬¬ä¸èä¸­ç simplekv ä¸ºäºå¤çä¸ä¸ª get è¯·æ±ï¼éè¦çå¬å®¢æ·ç«¯è¯·æ±ï¼bind/listenï¼ï¼åå®¢æ·ç«¯å»ºç«è¿æ¥ï¼acceptï¼ï¼ä» socket ä¸­è¯»åè¯·æ±ï¼recvï¼ï¼è§£æå®¢æ·ç«¯åéè¯·æ±ï¼parseï¼ï¼æ ¹æ®è¯·æ±ç±»åè¯»åé®å¼æ°æ®ï¼getï¼ï¼æåç»å®¢æ·ç«¯è¿åç»æï¼å³å socket ä¸­ååæ°æ®ï¼sendï¼ãä¸å¾æ¾ç¤ºäºè¿ä¸è¿ç¨ï¼\n\n\n\nç±äº redis æ¯åçº¿ç¨ï¼èè¿éçç½ç» io ææ½å¨çé»å¡ç¹ï¼åå«æ¯ accept() å recv()ï¼ä»èå¯è½å¯¼è´ redis æ´ä¸ªçº¿ç¨é»å¡ãå¹¸è¿çæ¯ï¼socket ç½ç»æ¨¡åæ¬èº«æ¯æéé»å¡æ¨¡å¼ã\n\n# 3.2.2 éé»å¡æ¨¡å¼\n\nsocket ç½ç»æ¨¡åçéé»å¡æ¨¡å¼è®¾ç½®ï¼ä¸»è¦ä½ç°å¨ä¸ä¸ªå³é®çå½æ°è°ç¨ä¸ï¼å¦ææ³è¦ä½¿ç¨ socket éé»å¡æ¨¡å¼ï¼å°±å¿é¡»è¦äºè§£è¿ä¸ä¸ªå½æ°çè°ç¨è¿åç±»ååè®¾ç½®æ¨¡å¼ãæ¥ä¸æ¥ï¼æä»¬å°±éç¹å­¦ä¹ ä¸å®ä»¬ã\n\nå¨ socket æ¨¡åä¸­ï¼ä¸åæä½è°ç¨åä¼è¿åä¸åçå¥æ¥å­ç±»åï¼\n\n * socket() æ¹æ³ä¼è¿åä¸»å¨å¥æ¥å­ï¼\n * ç¶åè°ç¨ listen() æ¹æ³ï¼å°ä¸»å¨å¥æ¥å­è½¬åä¸ºçå¬å¥æ¥å­ï¼æ­¤æ¶ï¼å¯ä»¥çå¬æ¥èªå®¢æ·ç«¯çè¿æ¥è¯·æ±ï¼\n * æåï¼è°ç¨ accept() æ¹æ³æ¥æ¶å°è¾¾çå®¢æ·ç«¯è¿æ¥ï¼å¹¶è¿åå·²è¿æ¥å¥æ¥å­ã\n\n\n\néå¯¹çå¬å¥æ¥å­ï¼æä»¬å¯ä»¥è®¾ç½®éé»å¡æ¨¡å¼ï¼å½ redis è°ç¨ accept() ä½ä¸ç´æªæè¿æ¥è¯·æ±å°è¾¾æ¶ï¼redis çº¿ç¨å¯ä»¥è¿åå¤çå¶ä»æä½ï¼èä¸ç¨ä¸ç´ç­å¾ãä½æ¯ï¼ä½ è¦æ³¨æçæ¯ï¼è°ç¨ accept() æ¶ï¼å·²ç»å­å¨çå¬å¥æ¥å­äºã\n\nè½ç¶ redis çº¿ç¨å¯ä»¥ä¸ç¨ç»§ç»­ç­å¾ï¼ä½æ¯æ»å¾ææºå¶ç»§ç»­å¨çå¬å¥æ¥å­ä¸ç­å¾åç»­è¿æ¥è¯·æ±ï¼å¹¶å¨æè¯·æ±æ¶éç¥ redisã\n\nç±»ä¼¼çï¼æä»¬ä¹å¯ä»¥éå¯¹å·²è¿æ¥å¥æ¥å­è®¾ç½®éé»å¡æ¨¡å¼ï¼redis è°ç¨ recv() åï¼å¦æå·²è¿æ¥å¥æ¥å­ä¸ä¸ç´æ²¡ææ°æ®å°è¾¾ï¼redis çº¿ç¨åæ ·å¯ä»¥è¿åå¤çå¶ä»æä½ãæä»¬ä¹éè¦ææºå¶ç»§ç»­çå¬è¯¥å·²è¿æ¥å¥æ¥å­ï¼å¹¶å¨ææ°æ®è¾¾å°æ¶éç¥ redisã\n\nè¿æ ·æè½ä¿è¯ redis çº¿ç¨ï¼æ¢ä¸ä¼ååºæ¬ io æ¨¡åä¸­ä¸ç´å¨é»å¡ç¹ç­å¾ï¼ä¹ä¸ä¼å¯¼è´ redis æ æ³å¤çå®éå°è¾¾çè¿æ¥è¯·æ±ææ°æ®ã\n\nå°æ­¤ï¼linux ä¸­ç io å¤è·¯å¤ç¨æºå¶å°±è¦ç»åºäºã\n\n# 3.2.3 åºäºå¤è·¯å¤ç¨çé«æ§è½ i/o æ¨¡å\n\nlinux ä¸­ç io å¤è·¯å¤ç¨æºå¶æ¯æä¸ä¸ªçº¿ç¨å¤çå¤ä¸ª io æµï¼å°±æ¯æä»¬ç»å¸¸å¬å°ç select/epoll æºå¶ãç®åæ¥è¯´ï¼å¨ redis åªè¿è¡åçº¿ç¨çæåµä¸ï¼è¯¥æºå¶åè®¸åæ ¸ä¸­ï¼åæ¶å­å¨å¤ä¸ªçå¬å¥æ¥å­åå·²è¿æ¥å¥æ¥å­ãåæ ¸ä¼ä¸ç´çå¬è¿äºå¥æ¥å­ä¸çè¿æ¥è¯·æ±ææ°æ®è¯·æ±ãä¸æ¦æè¯·æ±å°è¾¾ï¼å°±ä¼äº¤ç» redis çº¿ç¨å¤çï¼è¿å°±å®ç°äºä¸ä¸ª redis çº¿ç¨å¤çå¤ä¸ª io æµçææã\n\n> æä»¥å¶å® 3.2.2 èä¸­éè¦æè¯·æ±æèæ°æ®å°è¾¾æ¶éç¥ redis çæºå¶å°±æ¯ linux åæ ¸ãå¦å¤ï¼æ­¤æºå¶ä¹æä¸º redis éå¸¸æ¯å¨ linux ä¸ä½¿ç¨çåå ä¹ä¸ã\n\nä¸å¾å°±æ¯åºäºå¤è·¯å¤ç¨ç redis io æ¨¡åãå¾ä¸­çå¤ä¸ª fd å°±æ¯åææè¯´çå¤ä¸ªå¥æ¥å­ãredis ç½ç»æ¡æ¶è°ç¨ epoll æºå¶ï¼è®©åæ ¸çå¬è¿äºå¥æ¥å­ãæ­¤æ¶ï¼redis çº¿ç¨ä¸ä¼é»å¡å¨æä¸ä¸ªç¹å®ççå¬æå·²è¿æ¥å¥æ¥å­ä¸ï¼ä¹å°±æ¯è¯´ï¼ä¸ä¼é»å¡å¨æä¸ä¸ªç¹å®çå®¢æ·ç«¯è¯·æ±å¤çä¸ãæ­£å ä¸ºæ­¤ï¼redis å¯ä»¥åæ¶åå¤ä¸ªå®¢æ·ç«¯è¿æ¥å¹¶å¤çè¯·æ±ï¼ä»èæåå¹¶åæ§ã\n\n\n\nä¸ºäºå¨è¯·æ±å°è¾¾æ¶è½éç¥å° redis çº¿ç¨ï¼select/epoll æä¾äºåºäºäºä»¶çåè°æºå¶ï¼å³éå¯¹ä¸åäºä»¶çåçï¼è°ç¨ç¸åºçå¤çå½æ°ã\n\né£ä¹ï¼åè°æºå¶æ¯æä¹å·¥ä½çå¢ï¼å¶å®ï¼select/epoll ä¸æ¦çæµå° fd ä¸æè¯·æ±å°è¾¾æ¶ï¼å°±ä¼è§¦åç¸åºçäºä»¶ã\n\nè¿äºäºä»¶ä¼è¢«æ¾è¿ä¸ä¸ªäºä»¶éåï¼redis åçº¿ç¨å¯¹è¯¥äºä»¶éåä¸æ­è¿è¡å¤çãè¿æ ·ä¸æ¥ï¼redis æ éä¸ç´è½®è¯¢æ¯å¦æè¯·æ±å®éåçï¼è¿å°±å¯ä»¥é¿åé æ cpu èµæºæµªè´¹ãåæ¶ï¼redis å¨å¯¹äºä»¶éåä¸­çäºä»¶è¿è¡å¤çæ¶ï¼ä¼è°ç¨ç¸åºçå¤çå½æ°ï¼è¿å°±å®ç°äºåºäºäºä»¶çåè°ãå ä¸º redis ä¸ç´å¨å¯¹äºä»¶éåè¿è¡å¤çï¼æä»¥è½åæ¶ååºå®¢æ·ç«¯è¯·æ±ï¼æå redis çååºæ§è½ã\n\nä¸ºäºæ¹ä¾¿ä½ çè§£ï¼æåä»¥è¿æ¥è¯·æ±åè¯»æ°æ®è¯·æ±ä¸ºä¾ï¼å·ä½è§£éä¸ä¸ãè¿ä¸¤ä¸ªè¯·æ±åå«å¯¹åº accept äºä»¶å read äºä»¶ï¼redis åå«å¯¹è¿ä¸¤ä¸ªäºä»¶æ³¨å accept å get åè°å½æ°ãå½ linux åæ ¸çå¬å°æè¿æ¥è¯·æ±æè¯»æ°æ®è¯·æ±æ¶ï¼å°±ä¼è§¦å accept äºä»¶å read äºä»¶ï¼æ­¤æ¶ï¼åæ ¸å°±ä¼åè° redis ç¸åºç accept å get å½æ°è¿è¡å¤çã\n\n> è¿å°±åçäººå»å»é¢ç§çãå¨å»çå®éè¯æ­åï¼æ¯ä¸ªçäººï¼ç­åäºè¯·æ±ï¼é½éè¦ååè¯ãæµä½æ¸©ãç»è®°ç­ãå¦æè¿äºå·¥ä½é½ç±å»çæ¥å®æï¼å»ççå·¥ä½æçå°±ä¼å¾ä½ãæä»¥ï¼å»é¢é½è®¾ç½®äºåè¯å°ï¼åè¯å°ä¼ä¸ç´å¤çè¿äºè¯æ­åçå·¥ä½ï¼ç±»ä¼¼äº linux åæ ¸çå¬è¯·æ±ï¼ï¼ç¶ååè½¬äº¤ç»å»çåå®éè¯æ­ãè¿æ ·å³ä½¿ä¸ä¸ªå»çï¼ç¸å½äº redis åçº¿ç¨ï¼ï¼æçä¹è½æåã\n\nä¸è¿ï¼éè¦æ³¨æçæ¯ï¼å³ä½¿ä½ çåºç¨åºæ¯ä¸­é¨ç½²äºä¸åçæä½ç³»ç»ï¼å¤è·¯å¤ç¨æºå¶ä¹æ¯éç¨çãå ä¸ºè¿ä¸ªæºå¶çå®ç°æå¾å¤ç§ï¼æ¢æåºäº linux ç³»ç»ä¸ç select å epoll å®ç°ï¼ä¹æåºäº freebsd ç kqueue å®ç°ï¼ä»¥ååºäº solaris ç evport å®ç°ï¼è¿æ ·ï¼ä½ å¯ä»¥æ ¹æ® redis å®éè¿è¡çæä½ç³»ç»ï¼éæ©ç¸åºçå¤è·¯å¤ç¨å®ç°ã\n\n\n# 3.3 å°ç»\n\næä»¬éç¹å­¦ä¹ äº redis çº¿ç¨çä¸ä¸ªé®é¢ï¼\n\n * redis ççåªæåçº¿ç¨åï¼\n * ä¸ºä»ä¹ç¨åçº¿ç¨ï¼\n * åçº¿ç¨ä¸ºä»ä¹è¿ä¹å¿«ï¼\n\nredis åçº¿ç¨æ¯æå®å¯¹ç½ç» io åæ°æ®è¯»åçæä½éç¨äºä¸ä¸ªçº¿ç¨ï¼èéç¨åçº¿ç¨çä¸ä¸ªæ ¸å¿åå æ¯é¿åå¤çº¿ç¨å¼åçå¹¶åæ§å¶é®é¢ãåçº¿ç¨ç redis ä¹è½è·å¾é«æ§è½ï¼è·å¤è·¯å¤ç¨ç io æ¨¡åå¯åç¸å³ï¼å ä¸ºè¿é¿åäº accept() å send()/recv() æ½å¨çç½ç» io æä½é»å¡ç¹ã\n\n> å¦å¤ï¼æä¹å§éä¸ï¼å¯è½ä½ ä¹æ³¨æå°äºï¼2020 å¹´ 5 æï¼redis 6.0 çç¨³å®çåå¸äºï¼redis 6.0 ä¸­æåºäºå¤çº¿ç¨æ¨¡åãé£ä¹ï¼è¿ä¸ªå¤çº¿ç¨æ¨¡ååè¿èè¯¾æè¯´ç io æ¨¡åæä»ä¹å³èï¼ä¼å¼å¥å¤æçå¹¶åæ§å¶é®é¢åï¼ä¼ç» redis 6.0 å¸¦æ¥å¤å¤§æåï¼å³äºè¿äºé®é¢ï¼æä¼å¨åé¢çè¯¾ç¨ä¸­åä½ å·ä½ä»ç»ã\n\n----------------------------------------\n\né®é¢ï¼redis çåºæ¬ io æ¨¡åä¸­è¿æåªäºæ½å¨çæ§è½ç¶é¢ï¼\n\nå¨ä¸»çº¿ç¨æ§è¡æä½æé´ï¼ä»»ä½èæ¶çæä½é½æ¯æ½å¨çæ§è½ç¶é¢ï¼é¤äºç½ç» io å¤ï¼è¿åæ¬ bigkeyãå¨éè¿åç­æä½ã",charsets:{cjk:!0},lastUpdated:"2023/03/27, 09:21:08",lastUpdatedTimestamp:1679908868e3},{title:"æä¹åæºå¶ï¼AOFæ¥å¿åRDBå¿«ç§",frontmatter:{title:"æä¹åæºå¶ï¼AOFæ¥å¿åRDBå¿«ç§",date:"2023-03-25T20:55:25.000Z",permalink:"/pages/d1a6d3/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/04.%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6%EF%BC%9AAOF%E6%97%A5%E5%BF%97%E5%92%8CRDB%E5%BF%AB%E7%85%A7.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/04.æä¹åæºå¶ï¼AOFæ¥å¿åRDBå¿«ç§.md",key:"v-a6ed5612",path:"/pages/d1a6d3/",headers:[{level:2,title:"1. AOF æ¥å¿ï¼å®æºäºï¼Redis å¦ä½é¿åæ°æ®ä¸¢å¤±",slug:"_1-aof-æ¥å¿-å®æºäº-redis-å¦ä½é¿åæ°æ®ä¸¢å¤±",normalizedTitle:"1. aof æ¥å¿ï¼å®æºäºï¼redis å¦ä½é¿åæ°æ®ä¸¢å¤±",charIndex:296},{level:3,title:"1.1 AOF æ¥å¿æ¯å¦ä½å®ç°çï¼",slug:"_1-1-aof-æ¥å¿æ¯å¦ä½å®ç°ç",normalizedTitle:"1.1 aof æ¥å¿æ¯å¦ä½å®ç°çï¼",charIndex:351},{level:3,title:"1.2 ä¸ç§ååç­ç¥",slug:"_1-2-ä¸ç§ååç­ç¥",normalizedTitle:"1.2 ä¸ç§ååç­ç¥",charIndex:1435},{level:3,title:"1.3 AOF éåæºå¶",slug:"_1-3-aof-éåæºå¶",normalizedTitle:"1.3 aof éåæºå¶",charIndex:2421},{level:3,title:"1.4 AOF éåä¼é»å¡åï¼ââ ä¸ä¼",slug:"_1-4-aof-éåä¼é»å¡å-ä¸ä¼",normalizedTitle:"1.4 aof éåä¼é»å¡åï¼ââ ä¸ä¼",charIndex:2886},{level:3,title:"1.5 å°ç»",slug:"_1-5-å°ç»",normalizedTitle:"1.5 å°ç»",charIndex:3571},{level:2,title:"2. RDB å¿«ç§ï¼å®æºåï¼Rediså¦ä½å®ç°å¿«éæ¢å¤ï¼",slug:"_2-rdb-å¿«ç§-å®æºå-rediså¦ä½å®ç°å¿«éæ¢å¤",normalizedTitle:"2. rdb å¿«ç§ï¼å®æºåï¼rediså¦ä½å®ç°å¿«éæ¢å¤ï¼",charIndex:4510},{level:3,title:"2.1 ä»ä¹æ¯ RDB",slug:"_2-1-ä»ä¹æ¯-rdb",normalizedTitle:"2.1 ä»ä¹æ¯ rdb",charIndex:4543},{level:3,title:"2.2 ç»åªäºæ°æ®æå¿«ç§ï¼",slug:"_2-2-ç»åªäºæ°æ®æå¿«ç§",normalizedTitle:"2.2 ç»åªäºæ°æ®æå¿«ç§ï¼",charIndex:5059},{level:3,title:"2.3 å¿«ç§æ¶æ°æ®è½ä¿®æ¹åï¼",slug:"_2-3-å¿«ç§æ¶æ°æ®è½ä¿®æ¹å",normalizedTitle:"2.3 å¿«ç§æ¶æ°æ®è½ä¿®æ¹åï¼",charIndex:5458},{level:3,title:"2.4 æå¿«ç§çé¢ç",slug:"_2-4-æå¿«ç§çé¢ç",normalizedTitle:"2.4 æå¿«ç§çé¢ç",charIndex:6175},{level:3,title:"2.5 å°ç»",slug:"_2-5-å°ç»",normalizedTitle:"2.5 å°ç»",charIndex:7412}],headersStr:"1. AOF æ¥å¿ï¼å®æºäºï¼Redis å¦ä½é¿åæ°æ®ä¸¢å¤± 1.1 AOF æ¥å¿æ¯å¦ä½å®ç°çï¼ 1.2 ä¸ç§ååç­ç¥ 1.3 AOF éåæºå¶ 1.4 AOF éåä¼é»å¡åï¼ââ ä¸ä¼ 1.5 å°ç» 2. RDB å¿«ç§ï¼å®æºåï¼Rediså¦ä½å®ç°å¿«éæ¢å¤ï¼ 2.1 ä»ä¹æ¯ RDB 2.2 ç»åªäºæ°æ®æå¿«ç§ï¼ 2.3 å¿«ç§æ¶æ°æ®è½ä¿®æ¹åï¼ 2.4 æå¿«ç§çé¢ç 2.5 å°ç»",content:"# æä¹åæºå¶ï¼AOFæ¥å¿åRDBå¿«ç§\n\n> åèï¼\n> \n>  * 04 AOF æ¥å¿ï¼å®æºäºï¼Redis å¦ä½é¿åæ°æ®ä¸¢å¤±ï¼ | æå®¢æ¶é´\n>  * 05 åå­å¿«ç§ï¼å®æºåï¼Redis å¦ä½å®ç°å¿«éæ¢å¤ï¼| æå®¢æ¶é´\n\nRedis ç¨ä½ç¼å­å¹¶å°æ°æ®å­äºåå­ä¸­ï¼å°±ä¼é¢å¯¹ä¸ä¸ªé®é¢ï¼ä¸æ¦æå¡å¨å®æºï¼åå­ä¸­çæ°æ®å°å¨é¨ä¸¢å¤±ã\n\nä¹è®¸æä¸ªè§£å³æ¹æ¡ï¼ä»åç«¯æ°æ®åºæ¢å¤è¿äºæ°æ®ãä½è¿é¢ç¹è®¿é®æ°æ®åºä¼ä½¿å¾æ§è½ä¸¥éä¸éãæä»¥å¯¹äº Redis èè¨ï¼å®ç°æ°æ®çæä¹åï¼é¿åä»åç«¯ä¸­æ¢å¤æ°æ®ï¼æ¯è³å³éè¦çã\n\nç®åï¼Redis çæä¹åä¸»è¦æä¸¤å¤§æºå¶ï¼AOF æ¥å¿å RDB å¿«ç§ãè¿éè®²åå«è®²è§£ã\n\n\n# 1. AOF æ¥å¿ï¼å®æºäºï¼Redis å¦ä½é¿åæ°æ®ä¸¢å¤±\n\nAOFï¼Append Only File\n\n\n# 1.1 AOF æ¥å¿æ¯å¦ä½å®ç°çï¼\n\nè¯´å°æ¥å¿ï¼æä»¬çæçæ¯é¢åæ¥å¿ï¼WALï¼Write Ahead Logï¼ï¼ä¹å°±æ¯è¯´ï¼å¨å®éåæ°æ®åï¼åæä¿®æ¹çæ°æ®è®°å°æ¥å¿æä»¶ä¸­ï¼ä»¥ä¾¿æéæ¶è¿è¡æ¢å¤ãä¸è¿ï¼AOF æ¥å¿æ­£å¥½ç¸åï¼å®æ¯ååæ¥å¿ï¼âååâçæææ¯ Redis æ¯åæ§è¡å½ä»¤ï¼ææ°æ®åå¥åå­ï¼ç¶åæè®°å½æ¥å¿ï¼å¦ä¸å¾æç¤ºï¼\n\né£ AOF ä¸ºä»ä¹è¦åæ§è¡å½ä»¤åè®°æ¥å¿å¢ï¼è¦åç­è¿ä¸ªé®é¢ï¼æä»¬è¦åç¥é AOF éè®°å½äºä»ä¹åå®¹ã\n\nä¼ ç»æ°æ®åºçæ¥å¿ï¼ä¾å¦ redo logï¼éåæ¥å¿ï¼ï¼è®°å½çæ¯ä¿®æ¹åçæ°æ®ï¼è AOF éè®°å½çæ¯ Redis æ¶å°çæ¯ä¸æ¡å½ä»¤ï¼è¿äºå½ä»¤æ¯ä»¥ææ¬å½¢å¼ä¿å­çã\n\næä»¬ä»¥Redisæ¶å°âset testkey testvalueâå½ä»¤åè®°å½çæ¥å¿ä¸ºä¾ï¼ççAOFæ¥å¿çåå®¹ãå¶ä¸­ï¼â *3âè¡¨ç¤ºå½åå½ä»¤æä¸ä¸ªé¨åï¼æ¯é¨åé½æ¯ç±â $+æ°å­âå¼å¤´ï¼åé¢ç´§è·çå·ä½çå½ä»¤ãé®æå¼ãè¿éï¼âæ°å­âè¡¨ç¤ºè¿é¨åä¸­çå½ä»¤ãé®æå¼ä¸å±æå¤å°å­èãä¾å¦ï¼â $3 setâè¡¨ç¤ºè¿é¨åæ3ä¸ªå­èï¼ä¹å°±æ¯âsetâå½ä»¤ã\n\nä½æ¯ï¼ä¸ºäºé¿åé¢å¤çæ£æ¥å¼éï¼Redis å¨å AOF éé¢è®°å½æ¥å¿çæ¶åï¼å¹¶ä¸ä¼åå»å¯¹è¿äºå½ä»¤è¿è¡è¯­æ³æ£æ¥ãæä»¥ï¼å¦æåè®°æ¥å¿åæ§è¡å½ä»¤çè¯ï¼æ¥å¿ä¸­å°±æå¯è½è®°å½äºéè¯¯çå½ä»¤ï¼Redis å¨ä½¿ç¨æ¥å¿æ¢å¤æ°æ®æ¶ï¼å°±å¯è½ä¼åºéã\n\nèååæ¥å¿è¿ç§æ¹å¼ï¼å°±æ¯åè®©ç³»ç»æ§è¡å½ä»¤ï¼åªæå½ä»¤è½æ§è¡æåï¼æä¼è¢«è®°å½å°æ¥å¿ä¸­ï¼å¦åï¼ç³»ç»å°±ä¼ç´æ¥åå®¢æ·ç«¯æ¥éãæä»¥ï¼Redis ä½¿ç¨ååæ¥å¿è¿ä¸æ¹å¼çä¸å¤§å¥½å¤æ¯ï¼å¯ä»¥é¿ååºç°è®°å½éè¯¯å½ä»¤çæåµã\n\né¤æ­¤ä¹å¤ï¼AOF è¿æä¸ä¸ªå¥½å¤ï¼å®æ¯å¨å½ä»¤æ§è¡åæè®°å½æ¥å¿ï¼æä»¥ä¸ä¼é»å¡å½åçåæä½ã\n\nä¸è¿ï¼AOF ä¹æä¸¤ä¸ªæ½å¨çé£é©:\n\n * é¦åï¼å¦æåæ§è¡å®ä¸ä¸ªå½ä»¤ï¼è¿æ²¡ææ¥å¾åè®°æ¥å¿å°±å®æºäºï¼é£ä¹è¿ä¸ªå½ä»¤åç¸åºçæ°æ®å°±æä¸¢å¤±çé£é©ãå¦ææ­¤æ¶ Redis æ¯ç¨ä½ç¼å­ï¼è¿å¯ä»¥ä»åç«¯æ°æ®åºéæ°è¯»å¥æ°æ®è¿è¡æ¢å¤ï¼ä½æ¯ï¼å¦æ Redis æ¯ç´æ¥ç¨ä½æ°æ®åºçè¯ï¼æ­¤æ¶ï¼å ä¸ºå½ä»¤æ²¡æè®°å¥æ¥å¿ï¼æä»¥å°±æ æ³ç¨æ¥å¿è¿è¡æ¢å¤äºã\n * å¶æ¬¡ï¼AOF è½ç¶é¿åäºå¯¹å½åå½ä»¤çé»å¡ï¼ä½å¯è½ä¼ç»ä¸ä¸ä¸ªæä½å¸¦æ¥é»å¡é£é©ãè¿æ¯å ä¸ºï¼AOF æ¥å¿ä¹æ¯å¨ä¸»çº¿ç¨ä¸­æ§è¡çï¼å¦æå¨ææ¥å¿æä»¶åå¥ç£çæ¶ï¼ç£çåååå¤§ï¼å°±ä¼å¯¼è´åçå¾æ¢ï¼è¿èå¯¼è´åç»­çæä½ä¹æ æ³æ§è¡äºã\n\nä»ç»åæçè¯ï¼ä½ å°±ä¼åç°ï¼è¿ä¸¤ä¸ªé£é©é½æ¯å AOF ååç£ççæ¶æºç¸å³çãè¿ä¹å°±æå³çï¼å¦ææä»¬è½å¤æ§å¶ä¸ä¸ªåå½ä»¤æ§è¡å®å AOF æ¥å¿ååç£ççæ¶æºï¼è¿ä¸¤ä¸ªé£é©å°±è§£é¤äºã\n\n\n# 1.2 ä¸ç§ååç­ç¥\n\nå¶å®ï¼å¯¹äºè¿ä¸ªé®é¢ï¼AOF æºå¶ç»æä»¬æä¾äºä¸ä¸ªéæ©ï¼ä¹å°±æ¯ AOF éç½®é¡¹ appendfsync çä¸ä¸ªå¯éå¼ï¼\n\n * Alwaysï¼åæ­¥ååï¼æ¯ä¸ªåå½ä»¤æ§è¡å®ï¼ç«é©¬åæ­¥å°å°æ¥å¿ååç£çï¼\n * Everysecï¼æ¯ç§ååï¼æ¯ä¸ªåå½ä»¤æ§è¡å®ï¼åªæ¯åææ¥å¿åå° AOF æä»¶çåå­ç¼å²åºï¼æ¯éä¸ç§æç¼å²åºä¸­çåå®¹åå¥ç£çï¼\n * Noï¼æä½ç³»ç»æ§å¶çååï¼æ¯ä¸ªåå½ä»¤æ§è¡å®ï¼åªæ¯åææ¥å¿åå° AOF æä»¶çåå­ç¼å²åºï¼ç±æä½ç³»ç»å³å®ä½æ¶å°ç¼å²åºåå®¹ååç£çã\n\néå¯¹é¿åä¸»çº¿ç¨é»å¡ååå°æ°æ®ä¸¢å¤±é®é¢ï¼è¿ä¸ç§ååç­ç¥é½æ æ³åå°ä¸¤å¨å¶ç¾ãæä»¬æ¥åæä¸å¶ä¸­çåå ï¼\n\n * âåæ­¥ååâå¯ä»¥åå°åºæ¬ä¸ä¸¢æ°æ®ï¼ä½æ¯å®å¨æ¯ä¸ä¸ªåå½ä»¤åé½æä¸ä¸ªæ¢éçè½çæä½ï¼ä¸å¯é¿åå°ä¼å½±åä¸»çº¿ç¨æ§è½ï¼\n * è½ç¶âæä½ç³»ç»æ§å¶çååâå¨åå®ç¼å²åºåï¼å°±å¯ä»¥ç»§ç»­æ§è¡åç»­çå½ä»¤ï¼ä½æ¯è½ççæ¶æºå·²ç»ä¸å¨ Redis æä¸­äºï¼åªè¦ AOF è®°å½æ²¡æååç£çï¼ä¸æ¦å®æºå¯¹åºçæ°æ®å°±ä¸¢å¤±äºï¼\n * âæ¯ç§ååâéç¨ä¸ç§ååä¸æ¬¡çé¢çï¼é¿åäºâåæ­¥ååâçæ§è½å¼éï¼è½ç¶åå°äºå¯¹ç³»ç»æ§è½çå½±åï¼ä½æ¯å¦æåçå®æºï¼ä¸ä¸ç§åæªè½ççå½ä»¤æä½ä»ç¶ä¼ä¸¢å¤±ãæä»¥ï¼è¿åªè½ç®æ¯ï¼å¨é¿åå½±åä¸»çº¿ç¨æ§è½åé¿åæ°æ®ä¸¢å¤±ä¸¤èé´åäºä¸ªæä¸­ã\n\nä¸ç§ååç­ç¥çå¯¹æ¯å¦ä¸ï¼\n\néæ©åªç§ååç­ç¥ï¼å°±è¦å¨é«æ§è½åé«å¯é æ§ä¹é´å trade-off äºï¼\n\n * æ³è¦è·å¾é«æ§è½ï¼å°±éæ© No ç­ç¥ï¼\n * å¦ææ³è¦å¾å°é«å¯é æ§ä¿è¯ï¼å°±éæ© Always ç­ç¥ï¼\n * å¦æåè®¸æ°æ®æä¸ç¹ä¸¢å¤±ï¼åå¸ææ§è½å«åå¤ªå¤§å½±åçè¯ï¼é£ä¹å°±éæ© Everysec ç­ç¥ã\n\néç Redis æ¥æ¶çå½ä»¤è¶æ¥è¶å¤ï¼AOF æä»¶ä¹ä¼è¶æ¥è¶å¤§ï¼è¿ä¹å°±æå³çï¼æä»¬ä¸å®è¦å°å¿ AOF æä»¶è¿å¤§å¸¦æ¥çæ§è½é®é¢ãè¿éçâæ§è½é®é¢âï¼ä¸»è¦å¨äºä»¥ä¸ä¸ä¸ªæ¹é¢ï¼\n\n 1. æä»¶ç³»ç»æ¬èº«å¯¹æä»¶å¤§å°æéå¶ï¼æ æ³ä¿å­è¿å¤§çæä»¶ï¼\n 2. å¦ææä»¶å¤ªå¤§ï¼ä¹ååå¾éé¢è¿½å å½ä»¤è®°å½çè¯ï¼æçä¹ä¼åä½ï¼\n 3. å¦æåçå®æºï¼AOF ä¸­è®°å½çå½ä»¤è¦ä¸ä¸ªä¸ªè¢«éæ°æ§è¡ï¼ç¨äºæéæ¢å¤ï¼å¦ææ¥å¿æä»¶å¤ªå¤§ï¼æ´ä¸ªæ¢å¤è¿ç¨å°±ä¼éå¸¸ç¼æ¢ï¼è¿å°±ä¼å½±åå° Redis çæ­£å¸¸ä½¿ç¨ã\n\næä»¥ï¼æä»¬å°±è¦éåä¸å®çæ§å¶ææ®µï¼è¿ä¸ªæ¶åï¼**AOF éåæºå¶**å°±ç»åºäºã\n\n\n# 1.3 AOF éåæºå¶\n\nå½ AOF æ¥å¿æä»¶å¤ªå¤§äºï¼å°±éè¦ AOF éåæºå¶äºã\n\nAOF éåæºå¶ï¼å°±æ¯å¨éåæ¶ï¼Redis æ ¹æ®æ°æ®åºçç°ç¶åå»ºä¸ä¸ªæ°ç AOF æä»¶ï¼ä¹å°±æ¯è¯´ï¼è¯»åæ°æ®åºä¸­çææé®å¼å¯¹ï¼ç¶åå¯¹æ¯ä¸ä¸ªé®å¼å¯¹ç¨ä¸æ¡å½ä»¤è®°å½å®çåå¥ãæ¯å¦è¯´ï¼å½è¯»åäºé®å¼å¯¹âtestkeyâ: âtestvalueâä¹åï¼éåæºå¶ä¼è®°å½ set testkey testvalue è¿æ¡å½ä»¤ãè¿æ ·ï¼å½éè¦æ¢å¤æ¶ï¼å¯ä»¥éæ°æ§è¡è¯¥å½ä»¤ï¼å®ç°âtestkeyâ: âtestvalueâçåå¥ã\n\nä¸ºä»ä¹éåæºå¶å¯ä»¥ææ¥å¿æä»¶åå°å¢? å®éä¸ï¼éåæºå¶å·æâå¤åä¸âåè½ãæè°çâå¤åä¸âï¼ä¹å°±æ¯è¯´ï¼æ§æ¥å¿æä»¶ä¸­çå¤æ¡å½ä»¤ï¼å¨éååçæ°æ¥å¿ä¸­åæäºä¸æ¡å½ä»¤ãå ä¸ºè¿ä¸ªè¿ç¨æä¸äºä¸­é´çä¿®æ¹è®°å½ç»å»æäºï¼åªä¿çäºææ°çæ°æ®åºç¶æãå¦ä¸å¾æç¤ºï¼\n\nä¸è¿ï¼è½ç¶ AOF éååï¼æ¥å¿æä»¶ä¼ç¼©å°ï¼ä½æ¯ï¼è¦ææ´ä¸ªæ°æ®åºçææ°æ°æ®çæä½æ¥å¿é½ååç£çï¼ä»ç¶æ¯ä¸ä¸ªéå¸¸èæ¶çè¿ç¨ãè¿æ¶ï¼æä»¬å°±è¦ç»§ç»­å³æ³¨å¦ä¸ä¸ªé®é¢äºï¼éåä¼ä¸ä¼é»å¡ä¸»çº¿ç¨ï¼\n\n\n# 1.4 AOF éåä¼é»å¡åï¼ââ ä¸ä¼\n\nå AOF æ¥å¿ç±ä¸»çº¿ç¨ååä¸åï¼éåè¿ç¨æ¯ç±åå°å­è¿ç¨ bgrewriteaof æ¥å®æçï¼è¿ä¹æ¯ä¸ºäºé¿åé»å¡ä¸»çº¿ç¨ï¼å¯¼è´æ°æ®åºæ§è½ä¸éã\n\nææéåçè¿ç¨æ»ç»ä¸ºâä¸ä¸ªæ·è´ï¼ä¸¤å¤æ¥å¿âï¼\n\nâä¸ä¸ªæ·è´âå°±æ¯æï¼æ¯æ¬¡æ§è¡éåæ¶ï¼ä¸»çº¿ç¨ fork åºåå°ç bgrewriteaof å­è¿ç¨ãæ­¤æ¶ï¼fork ä¼æä¸»çº¿ç¨çåå­æ·è´ä¸ä»½ç» bgrewriteaof å­è¿ç¨ï¼è¿éé¢å°±åå«äºæ°æ®åºçææ°æ°æ®ãç¶åï¼bgrewriteaof å­è¿ç¨å°±å¯ä»¥å¨ä¸å½±åä¸»çº¿ç¨çæåµä¸ï¼éä¸ææ·è´çæ°æ®åææä½ï¼è®°å¥éåæ¥å¿ã\n\nâä¸¤å¤æ¥å¿âåæ¯ä»ä¹å¢ï¼\n\nå ä¸ºä¸»çº¿ç¨æªé»å¡ï¼ä»ç¶å¯ä»¥å¤çæ°æ¥çæä½ãæ­¤æ¶ï¼å¦ææåæä½ï¼ç¬¬ä¸å¤æ¥å¿å°±æ¯ææ­£å¨ä½¿ç¨ç AOF æ¥å¿ï¼Redis ä¼æè¿ä¸ªæä½åå°å®çç¼å²åºãè¿æ ·ä¸æ¥ï¼å³ä½¿å®æºäºï¼è¿ä¸ª AOF æ¥å¿çæä½ä»ç¶æ¯é½å¨çï¼å¯ä»¥ç¨äºæ¢å¤ã\n\nèç¬¬äºå¤æ¥å¿ï¼å°±æ¯ææ°ç AOF éåæ¥å¿ãè¿ä¸ªæä½ä¹ä¼è¢«åå°éåæ¥å¿çç¼å²åºãè¿æ ·ï¼éåæ¥å¿ä¹ä¸ä¼ä¸¢å¤±ææ°çæä½ãç­å°æ·è´æ°æ®çæææä½è®°å½éåå®æåï¼éåæ¥å¿è®°å½çè¿äºææ°æä½ä¹ä¼åå¥æ°ç AOF æä»¶ï¼ä»¥ä¿è¯æ°æ®åºææ°ç¶æçè®°å½ãæ­¤æ¶ï¼æä»¬å°±å¯ä»¥ç¨æ°ç AOF æä»¶æ¿ä»£æ§æä»¶äºã\n\nå æ­¤ï¼AOF éé»å¡çéåè¿ç¨å¦ä¸å¾æç¤ºï¼\n\næ»ç»æ¥è¯´ï¼æ¯æ¬¡ AOF éåæ¶ï¼Redis ä¼åæ§è¡ä¸ä¸ªåå­æ·è´ï¼ç¨äºéåï¼ç¶åï¼ä½¿ç¨ä¸¤ä¸ªæ¥å¿ä¿è¯å¨éåè¿ç¨ä¸­ï¼æ°åå¥çæ°æ®ä¸ä¼ä¸¢å¤±ãèä¸ï¼å ä¸º Redis éç¨é¢å¤ççº¿ç¨è¿è¡æ°æ®éåï¼æä»¥ï¼è¿ä¸ªè¿ç¨å¹¶ä¸ä¼é»å¡ä¸»çº¿ç¨ã\n\n\n# 1.5 å°ç»\n\nè¿ä¸èä»ç»äº Redis ç¨äºé¿åæ°æ®ä¸¢å¤±ç AOF æ¥å¿æºå¶ãè¿ä¸ªæ¹æ³éè¿éä¸è®°å½æä½å½ä»¤ï¼å¨æ¢å¤æ¶åéä¸æ§è¡å½ä»¤çæ¹å¼ï¼ä¿è¯äºæ°æ®çå¯é æ§ã\n\nAOF æºå¶èèå°å¯¹ Redis æ§è½çå½±åï¼æä¾äº AOF æ¥å¿çä¸ç§ååç­ç¥ã\n\næ­¤å¤ï¼ä¸ºäºé¿åæ¥å¿æä»¶è¿å¤§ï¼Redis æä¾äº AOF éåæºå¶ï¼ç´æ¥æ ¹æ®æ°æ®åºéæ°æ®çææ°ç¶æï¼çæè¿äºæ°æ®çæå¥å½ä»¤ï¼ä½ä¸ºæ°æ¥å¿ãè¿ä¸ªè¿ç¨éè¿åå°çº¿ç¨å®æï¼é¿åäºå¯¹ä¸»çº¿ç¨çé»å¡ã\n\nä¸è¿ï¼ä¸é¢ä»ç»çè½çæ¶æºåéåæºå¶é½æ¯ç¨äºâè®°æ¥å¿âçæ¹æ³ï¼èå¨âç¨æ¥å¿âæ¶ï¼éè¦å¯¹ææçæä½è®°å½è¿è¡é¡ºåºéæ¾ï¼è¿ä¸ªéæ¾è¿ç¨å°±å¾æ¢äºãé£ï¼ææ²¡ææ¢è½é¿åæ°æ®ä¸¢å¤±ï¼åè½æ´å¿«å°æ¢å¤çæ¹æ³å¢ï¼å½ç¶æï¼é£å°±æ¯ RDB å¿«ç§äºã\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼AOF éåè¿ç¨ææ²¡æå¶ä»æ½å¨çé»å¡é£é©ï¼\n\nè¿éæä¸¤ä¸ªé£é©ï¼\n\n 1. Redis ä¸»çº¿ç¨ fork åå»º bgrewriteaof å­è¿ç¨æ¶ï¼åæ ¸éè¦åå»ºç¨äºç®¡çå­è¿ç¨çç¸å³æ°æ®ç»æï¼è¿äºæ°æ®ç»æå¨æä½ç³»ç»ä¸­éå¸¸å«ä½è¿ç¨æ§å¶åï¼Process Control Blockï¼ç®ç§°ä¸º PCBï¼ãåæ ¸è¦æä¸»çº¿ç¨ç PCB åå®¹æ·è´ç»å­è¿ç¨ãè¿ä¸ªåå»ºåæ·è´è¿ç¨ç±åæ ¸æ§è¡ï¼æ¯ä¼é»å¡ä¸»çº¿ç¨çãèä¸ï¼å¨æ·è´è¿ç¨ä¸­ï¼å­è¿ç¨è¦æ·è´ç¶è¿ç¨çé¡µè¡¨ï¼è¿ä¸ªè¿ç¨çèæ¶å Redis å®ä¾çåå­å¤§å°æå³ãå¦æ Redis å®ä¾åå­å¤§ï¼é¡µè¡¨å°±ä¼å¤§ï¼fork æ§è¡æ¶é´å°±ä¼é¿ï¼è¿å°±ä¼ç»ä¸»çº¿ç¨å¸¦æ¥é»å¡é£é©ã\n 2. bgrewriteaof å­è¿ç¨ä¼åä¸»çº¿ç¨å±äº«åå­ãå½ä¸»çº¿ç¨æ¶å°æ°åæä¿®æ¹çæä½æ¶ï¼ä¸»çº¿ç¨ä¼ç³è¯·æ°çåå­ç©ºé´ï¼ç¨æ¥ä¿å­æ°åæä¿®æ¹çæ°æ®ï¼å¦ææä½çæ¯ bigkeyï¼ä¹å°±æ¯æ°æ®éå¤§çéåç±»åæ°æ®ï¼é£ä¹ï¼ä¸»çº¿ç¨ä¼å ä¸ºç³è¯·å¤§ç©ºé´èé¢ä¸´é»å¡é£é©ãå ä¸ºæä½ç³»ç»å¨åéåå­ç©ºé´æ¶ï¼ææ¥æ¾åéçå¼éï¼è¿å°±ä¼å¯¼è´é»å¡ã\n\næ¬èé®é¢ 2ï¼AOF éåä¸ºä»ä¹ä¸å±äº«ä½¿ç¨ AOF æ¬èº«çæ¥å¿ï¼\n\nå¦æé½ç¨ AOF æ¥å¿çè¯ï¼ä¸»çº¿ç¨è¦åï¼bgrewriteaof å­è¿ç¨ä¹è¦åï¼è¿ä¸¤èä¼ç«äºæä»¶ç³»ç»çéï¼è¿å°±ä¼å¯¹ Redis ä¸»çº¿ç¨çæ§è½é æå½±åã\n\n\n# 2. RDB å¿«ç§ï¼å®æºåï¼Rediså¦ä½å®ç°å¿«éæ¢å¤ï¼\n\n\n# 2.1 ä»ä¹æ¯ RDB\n\nä¸ä¸èè®²ç Redis é¿åæ°æ®ä¸¢å¤±ç AOF æ¹æ³ï¼å¥½å¤æ¯æ¯æ¬¡æ§è¡åªéè¦è®°å½æä½å½ä»¤ï¼éè¦æä¹åçæ°æ®éä¸å¤§ï¼åªè¦ä½ ä¸æ¯éç¨ç Always çæä¹åç­ç¥ï¼å°±ä¸ä¼å¯¹æ§è½é æå¤ªå¤§å½±åã\n\nä½ç±äºè®°å½çå½ä»¤èä¸æ¯å®éæ°æ®ï¼å æ­¤ä½¿ç¨ AOF æ¥å¿è¿è¡æéæ¢å¤æ¶éè¦éæ¾ä¸éï¼å¦ææ¥å¿è¿å¤ä¼èè´¹å¾é¿æ¶é´ãé£ææ²¡ææ¢å¯ä»¥ä¿è¯å¯é æ§ï¼è¿è½å¨å®æºæ¶å®ç°å¿«éæ¢å¤çå¶ä»æ¹æ³å¢ï¼è¿å°±æ¯è¿èè¦å­¦ä¹ çæä¹åæ¹æ³ââåå­å¿«ç§ã\n\nåå­å¿«ç§ï¼æåå­ä¸­çæ°æ®å¨æä¸ä¸ªæ¶å»çç¶æè®°å½ã\n\nè¿å°±åå¹³æ¶æç§çä¸æ ·ï¼åå­å¿«ç§ææä¸æ¶å»çç¶æä»¥æä»¶çå½¢å¼åå°ç£çä¸ï¼è¿æ ·å³ä½¿å®æºï¼å¿«ç§æä»¶ä¹ä¸ä¼ä¸¢å¤±ï¼æ°æ®çå¯é æ§ä¹å°±å¾å°äºä¿è¯ãè¿ä¸ªå¿«ç§æä»¶å°±ç§°ä¸º RDB æä»¶ã\n\n> RDB: Redis DataBase\n\nå AOF ç¸æ¯ï¼RDB è®°å½çæ¯æä¸æ¶å»çæ°æ®ï¼å¹¶ä¸æ¯æä½ï¼æä»¥ï¼å¨åæ°æ®æ¢å¤æ¶ï¼æä»¬å¯ä»¥ç´æ¥æ RDB æä»¶è¯»å¥åå­ï¼å¾å¿«å°å®ææ¢å¤ã\n\nä½åå­å¿«ç§ä¹å¹¶ä¸ä¸å®æ¯æä¼éé¡¹ï¼æå¿«ç§æ¶åå°ä¸¤ä¸ªå³é®é®é¢ï¼\n\n * ç»åªäºæ°æ®æå¿«ç§ï¼è¿æ¶åå°å¿«ç§çæ§è¡æççé®é¢ã\n * æå¿«ç§æ¶è¿è½å¢å æ¹åï¼è¿æ¶å Redis æ¯å¦è¢«é»å¡ã\n\n\n# 2.2 ç»åªäºæ°æ®æå¿«ç§ï¼\n\nRedis çæ°æ®é½å¨åå­ä¸­ï¼ä¸ºäºæä¾æææ°æ®çå¯é æ§ä¿è¯ï¼å®æ§è¡çæ¯å¨éå¿«ç§ï¼ä¹å°±æ¯è¯´ï¼æåå­ä¸­çæææ°æ®é½è®°å½å°ç£çä¸­ã\n\nä½å¨éå¿«ç§å¨é¨åå¥ç£çä¼è±è´¹å¾å¤æ¶é´ï¼è Redis çåçº¿ç¨æ¨¡ååå³å®äºæä»¬è¦å°½éé¿åææä¼é»å¡ä¸»çº¿ç¨çæä½ãé£ RDB æä»¶ççææ¯å¦ä¼é»å¡ä¸»çº¿ç¨ï¼\n\nRedis æä¾äºä¸¤ä¸ªå½ä»¤æ¥çæ RDB æä»¶ï¼åå«æ¯ save å bgsaveï¼\n\n * saveï¼å¨ä¸»çº¿ç¨ä¸­æ§è¡ï¼ä¼å¯¼è´é»å¡ï¼\n * bgsaveï¼åå»ºä¸ä¸ªå­è¿ç¨ï¼ä¸é¨ç¨äºåå¥ RDB æä»¶ï¼é¿åäºä¸»çº¿ç¨çé»å¡ï¼è¿ä¹æ¯ Redis RDB æä»¶çæçé»è®¤éç½®ã\n\næ­¤æ¶ï¼æä»¬å¯ä»¥éè¿bgsaveå½ä»¤æ¥æ§è¡å¨éå¿«ç§ï¼è¿æ¢æä¾äºæ°æ®çå¯é æ§ä¿è¯ï¼ä¹é¿åäºå¯¹ Redis çæ§è½å½±åã\n\næ¥ä¸æ¥éè¦èèï¼ä½¿ç¨ bgsave æ¥æ§è¡å¨éå¿«ç§æ¶ï¼Redis è½å¦æ­£å¸¸å¤çåæä½ï¼\n\n\n# 2.3 å¿«ç§æ¶æ°æ®è½ä¿®æ¹åï¼\n\nå¨æå¿«ç§æ¶ï¼å¦æåçæ°æ®æ¹å¨ï¼åå¾å®¹æäº§çæ°æ®ä¸ä¸è´ç°è±¡ãå¦æä¸æ³è®©æ°æ®åçæ¹å¨ï¼é£æå¿«ç§æé´ Redis æ æ³æ¥æ¶åè¯·æ±ï¼è¿å¨çäº§ç¯å¢ä¸æ¯ä¸è¢«åè®¸çãè¿æ¶ï¼Redis å°±åå©äºæä½ç³»ç»æä¾çåæ¶å¤å¶ææ¯ï¼Copy-On-Writeï¼COWï¼ï¼å¨æ§è¡å¿«ç§çåæ¶ï¼æ­£å¸¸å¤çåæä½ã\n\nä¸ºä»ä¹ä¸ç¨ bgsave é¿åé»å¡æ¥å¤çæå¿«ç§æé´ä¸è½åçé®é¢å¢ï¼\n\nè¿æ¯ä¸ä¸ªå¸¸è§çè¯¯åºã\n\né¿åé»å¡åæ­£å¸¸å¤çåæä½å¹¶ä¸æ¯ä¸åäºãç¨ bgsave æ§è¡å¨éå¿«ç§æ¶ï¼ä¸»çº¿ç¨çç¡®æ²¡æé»å¡ï¼å¯ä»¥æ­£å¸¸æ¥æ¶è¯·æ±ï¼ä½æ¯ï¼ä¸ºäºä¿è¯å¿«ç§å®æ´æ§ï¼å®åªè½å¤çè¯»æä½ï¼å ä¸ºä¸è½ä¿®æ¹æ­£å¨æ§è¡å¿«ç§çæ°æ®ã\n\nç®åæ¥è¯´ï¼ bgsave å­è¿ç¨æ¯ç±ä¸»çº¿ç¨ fork çæçï¼å¯ä»¥å±äº«ä¸»çº¿ç¨çææåå­æ°æ®ãbgsave å­è¿ç¨è¿è¡åï¼å¼å§è¯»åä¸»çº¿ç¨çåå­æ°æ®ï¼å¹¶æå®ä»¬åå¥ RDB æä»¶ã\n\n * æ­¤æ¶ï¼å¦æä¸»çº¿ç¨å¯¹è¿äºæ°æ®é½æ¯è¯»æä½ï¼å¦å¾ä¸­çé®å¼å¯¹ Aï¼ï¼é£ä¹ï¼ä¸»çº¿ç¨å bgsave å­è¿ç¨ç¸äºä¸å½±åã\n * ä½å¦æä¸»çº¿ç¨è¦ä¿®æ¹ä¸åæ°æ®ï¼ä¾å¦å¾ä¸­çé®å¼å¯¹ Cï¼ï¼é£ä¹ï¼è¿åæ°æ®å°±ä¼è¢«å¤å¶ä¸ä»½ï¼çæè¯¥æ°æ®çå¯æ¬ï¼é®å¼å¯¹ Câï¼ãç¶åï¼ä¸»çº¿ç¨å¨è¿ä¸ªæ°æ®å¯æ¬ä¸è¿è¡ä¿®æ¹ãåæ¶ï¼bgsaveå­è¿ç¨å¯ä»¥ç»§ç»­æåæ¥çæ°æ®ï¼é®å¼å¯¹ Cï¼åå¥ RDB æä»¶ã\n\nè¿æ¢ä¿è¯äºå¿«ç§çå®æ´æ§ï¼ä¹åè®¸ä¸»çº¿ç¨åæ¶å¯¹æ°æ®è¿è¡ä¿®æ¹ï¼é¿åäºå¯¹æ­£å¸¸ä¸å¡çå½±åã\n\nå°è¿éï¼æä»¬å°±è§£å³äºå¯¹âåªäºæ°æ®åå¿«ç§âä»¥åâåå¿«ç§æ¶æ°æ®è½å¦ä¿®æ¹âè¿ä¸¤å¤§é®é¢ï¼Redis ä¼ä½¿ç¨ bgsave å¯¹å½ååå­ä¸­çæææ°æ®åå¿«ç§ï¼è¿ä¸ªæä½æ¯å­è¿ç¨å¨åå°å®æçï¼è¿å°±åè®¸ä¸»çº¿ç¨åæ¶å¯ä»¥ä¿®æ¹æ°æ®ã\n\n\n# 2.4 æå¿«ç§çé¢ç\n\nå¿«ç§é´éæ¶é´ä¹æ¯ä¸ä¸ªå³é®é®é¢ã\n\næå¿«ç§çé´éè¶å°ï¼åçå®æºæ¶ä¸¢å¤±çæ°æ®ä¹å°±è¶å°ï¼é£è½ä¸è½æ¯ç§æä¸æ¬¡å¿«ç§ï¼\n\nè¿ç§æ³æ³æ¯éè¯¯çãé¢ç¹æ§è¡å¨éå¿«ç§ä¼å¸¦æ¥ä¸¤æ¹é¢çå¼éï¼\n\n * ä¸æ¹é¢ï¼é¢ç¹å°å¨éæ°æ®åå¥ç£çï¼ä¼ç»ç£çå¸¦æ¥å¾å¤§ååï¼å¤ä¸ªå¿«ç§ç«äºæéçç£çå¸¦å®½ï¼åä¸ä¸ªå¿«ç§è¿æ²¡æåå®ï¼åä¸ä¸ªåå¼å§åäºï¼å®¹æé ææ¶æ§å¾ªç¯ã\n * å¦ä¸æ¹é¢ï¼bgsave å­è¿ç¨éè¦éè¿ fork æä½ä»ä¸»çº¿ç¨åå»ºåºæ¥ãè½ç¶ï¼å­è¿ç¨å¨åå»ºåä¸ä¼åé»å¡ä¸»çº¿ç¨ï¼ä½æ¯ï¼fork è¿ä¸ªåå»ºè¿ç¨æ¬èº«ä¼é»å¡ä¸»çº¿ç¨ï¼èä¸ä¸»çº¿ç¨çåå­è¶å¤§ï¼é»å¡æ¶é´è¶é¿ãå¦æé¢ç¹ fork åº bgsave å­è¿ç¨ï¼è¿å°±ä¼é¢ç¹é»å¡ä¸»çº¿ç¨äºï¼æä»¥ï¼å¨ Redis ä¸­å¦ææä¸ä¸ª bgsave å¨è¿è¡ï¼å°±ä¸ä¼åå¯å¨ç¬¬äºä¸ª bgsave å­è¿ç¨ï¼ãé£ä¹ï¼æä»ä¹å¶ä»å¥½æ¹æ³åï¼\n\næ­¤æ¶ï¼æä»¬å¯ä»¥åå¢éå¿«ç§ï¼åäºä¸æ¬¡å¨éå¿«ç§åï¼åç»­çå¿«ç§åªå¯¹ä¿®æ¹çæ°æ®è¿è¡å¿«ç§è®°å½ï¼è¿æ ·å¯ä»¥é¿åæ¯æ¬¡å¨éå¿«ç§çå¼éã\n\nå¨ç¬¬ä¸æ¬¡åå®å¨éå¿«ç§åï¼T1 å T2 æ¶å»å¦æååå¿«ç§ï¼æä»¬åªéè¦å°è¢«ä¿®æ¹çæ°æ®åå¥å¿«ç§æä»¶å°±è¡ãä½æ¯ï¼è¿ä¹åçåææ¯ï¼æä»¬éè¦è®°ä½åªäºæ°æ®è¢«ä¿®æ¹äºãè¿ä¸ªâè®°ä½âéè¦æä»¬ä½¿ç¨é¢å¤çåæ°æ®ä¿¡æ¯å»è®°å½åªäºæ°æ®è¢«ä¿®æ¹äºï¼è¿ä¼å¸¦æ¥é¢å¤çç©ºé´å¼éé®é¢ãå¦ä¸å¾æç¤ºï¼\n\nå¦ææä»¬å¯¹æ¯ä¸ä¸ªé®å¼å¯¹çä¿®æ¹ï¼é½åä¸ªè®°å½ï¼é£ä¹ï¼å¦ææ 1 ä¸ä¸ªè¢«ä¿®æ¹çé®å¼å¯¹ï¼æä»¬å°±éè¦æ 1 ä¸æ¡é¢å¤çè®°å½ãèä¸ï¼æçæ¶åï¼é®å¼å¯¹éå¸¸å°ï¼æ¯å¦åªæ 32 å­èï¼èè®°å½å®è¢«ä¿®æ¹çåæ°æ®ä¿¡æ¯ï¼å¯è½å°±éè¦ 8 å­èï¼è¿æ ·çç»ï¼ä¸ºäºâè®°ä½âä¿®æ¹ï¼å¼å¥çé¢å¤ç©ºé´å¼éæ¯è¾å¤§ãè¿å¯¹äºåå­èµæºå®è´µç Redis æ¥è¯´ï¼æäºå¾ä¸å¿å¤±ã\n\nå°è¿éï¼ä½ å¯ä»¥åç°ï¼RDB å¿«ç§è½ç¶è· AOF ç¸æ¯ï¼å¿«ç§çæ¢å¤éåº¦å¿«ï¼ä½æ¯ï¼å¿«ç§çé¢çä¸å¥½ææ¡ï¼å¦æé¢çå¤ªä½ï¼ä¸¤æ¬¡å¿«ç§é´ä¸æ¦å®æºï¼å°±å¯è½ææ¯è¾å¤çæ°æ®ä¸¢å¤±ãå¦æé¢çå¤ªé«ï¼åä¼äº§çé¢å¤å¼éï¼é£ä¹ï¼è¿æä»ä¹æ¹æ³æ¢è½å©ç¨RDBçå¿«éæ¢å¤ï¼åè½ä»¥è¾å°çå¼éåå°å°½éå°ä¸¢æ°æ®å¢ï¼\n\nRedis 4.0ä¸­æåºäºä¸ä¸ªæ··åä½¿ç¨AOFæ¥å¿ååå­å¿«ç§çæ¹æ³ãç®åæ¥è¯´ï¼åå­å¿«ç§ä»¥ä¸å®çé¢çæ§è¡ï¼å¨ä¸¤æ¬¡å¿«ç§ä¹é´ï¼ä½¿ç¨ AOF æ¥å¿è®°å½è¿æé´çææå½ä»¤æä½ã\n\nè¿æ ·ä¸æ¥ï¼å¿«ç§ä¸ç¨å¾é¢ç¹å°æ§è¡ï¼è¿å°±é¿åäºé¢ç¹ fork å¯¹ä¸»çº¿ç¨çå½±åãèä¸ï¼AOF æ¥å¿ä¹åªç¨è®°å½ä¸¤æ¬¡å¿«ç§é´çæä½ï¼ä¹å°±æ¯è¯´ï¼ä¸éè¦è®°å½æææä½äºï¼å æ­¤ï¼å°±ä¸ä¼åºç°æä»¶è¿å¤§çæåµäºï¼ä¹å¯ä»¥é¿åéåå¼éã\n\nå¦ä¸å¾æç¤ºï¼T1åT2æ¶å»çä¿®æ¹ï¼ç¨AOFæ¥å¿è®°å½ï¼ç­å°ç¬¬äºæ¬¡åå¨éå¿«ç§æ¶ï¼å°±å¯ä»¥æ¸ç©ºAOFæ¥å¿ï¼å ä¸ºæ­¤æ¶çä¿®æ¹é½å·²ç»è®°å½å°å¿«ç§ä¸­äºï¼æ¢å¤æ¶å°±ä¸åç¨æ¥å¿äºã\n\nè¿ä¸ªæ¹æ³æ¢è½äº«åå° RDB æä»¶å¿«éæ¢å¤çå¥½å¤ï¼åè½äº«åå° AOF åªè®°å½æä½å½ä»¤çç®åä¼å¿ï¼é¢æç¹âé±¼åçæå¯ä»¥å¼å¾âçæè§ï¼å»ºè®®ä½ å¨å®è·µä¸­ç¨èµ·æ¥ã\n\nð å¶å®æåè¿ä¸ªç»¼åçæ¹æ³æ²¡æä½¿ç¨å¢éå¿«ç§çåæ³ã\n\n\n# 2.5 å°ç»\n\nè¿ä¸å¤§èï¼ä»ç»äº Redis ç¨äºé¿åæ°æ®ä¸¢å¤±ç RDB åå­å¿«ç§çæ¹æ³ï¼å®å¯ä»¥å¿«éæ¢å¤æ°æ®åºãéè¿ç´æ¥æ RDB æä»¶è¯»å¥åå­ï¼é¿å AOF éè¦é¡ºåºãéä¸æ§è¡æä½å½ä»¤å¸¦æ¥çä½ææ§è½é®é¢ã\n\nRedis è®¾è®¡ bgsave ååæ¶å¤å¶çæ¹å¼æ¥å°½å¯è½åå°äºåå­å¿«ç§å¯¹æ­£å¸¸è¯»åçå½±åã\n\nä½é¢ç¹å¿«ç§åæ¯ä¸å¯æ¥åçï¼äºæ¯åºç°äºæ··åä½¿ç¨ RDB å AOF çæ¹å¼ï¼æ­£å¥½å¯ä»¥åä¸¤èä¹é¿ï¼é¿ä¸¤èä¹ç­ï¼ä»¥è¾å°çæ§è½å¼éä¿è¯æ°æ®å¯é æ§åæ§è½ã\n\næåï¼å³äº AOF å RDB çéæ©é®é¢ï¼ææ³æä¸ç¹å»ºè®®ï¼\n\n * æ°æ®ä¸è½ä¸¢å¤±æ¶ï¼åå­å¿«ç§å AOF çæ··åä½¿ç¨æ¯ä¸ä¸ªå¾å¥½çéæ©ï¼\n * å¦æåè®¸åéçº§å«çæ°æ®ä¸¢å¤±ï¼å¯ä»¥åªä½¿ç¨ RDBï¼\n * å¦æåªç¨ AOFï¼ä¼åä½¿ç¨ everysec çéç½®éé¡¹ï¼å ä¸ºå®å¨å¯é æ§åæ§è½ä¹é´åäºä¸ä¸ªå¹³è¡¡ã\n\n----------------------------------------\n\næ¬èé®é¢ 1 ï¼ä½¿ç¨ä¸ä¸ª 2 æ ¸ CPUã4GB åå­ã500GB ç£ççäºä¸»æºè¿è¡ Redisï¼Redis æ°æ®åºçæ°æ®éå¤§å°å·®ä¸å¤æ¯ 2GBãå½æ¶ Redisä¸»è¦ä»¥ä¿®æ¹æä½ä¸ºä¸»ï¼åè¯»æ¯ä¾å·®ä¸å¤å¨ 8:2 å·¦å³ï¼ä¹å°±æ¯è¯´ï¼å¦ææ 100 ä¸ªè¯·æ±ï¼80 ä¸ªè¯·æ±æ§è¡çæ¯ä¿®æ¹æä½ãå¨è¿ä¸ªåºæ¯ä¸ï¼ç¨ RDB åæä¹åæä»ä¹é£é©åï¼ï¼\n\nä»åå­èµæºåCPUèµæºä¸¤æ¹é¢åæé£é©ï¼\n\n 1. åå­ä¸è¶³çé£é©ï¼Redis forkä¸ä¸ªbgsaveå­è¿ç¨è¿è¡RDBåå¥ï¼å¦æä¸»çº¿ç¨åæ¥æ¶å°åæä½ï¼å°±ä¼éç¨åæ¶å¤å¶ãåæ¶å¤å¶éè¦ç»åæä½çæ°æ®åéæ°çåå­ç©ºé´ãæ¬é®é¢ä¸­åçæ¯ä¾ä¸º80%ï¼é£ä¹ï¼å¨æä¹åè¿ç¨ä¸­ï¼ä¸ºäºä¿å­80%åæä½æ¶åçæ°æ®ï¼åæ¶å¤å¶æºå¶ä¼å¨å®ä¾åå­ä¸­ï¼ä¸ºè¿äºæ°æ®ååéæ°åå­ç©ºé´ï¼åéçåå­éç¸å½äºæ´ä¸ªå®ä¾æ°æ®éç80%ï¼å¤§çº¦æ¯1.6GBï¼è¿æ ·ä¸æ¥ï¼æ´ä¸ªç³»ç»åå­çä½¿ç¨éå°±æ¥è¿é¥±åäºãæ­¤æ¶ï¼å¦æå®ä¾è¿æå¤§éçæ°keyåå¥ækeyä¿®æ¹ï¼äºä¸»æºåå­å¾å¿«å°±ä¼è¢«ååãå¦æäºä¸»æºå¼å¯äºSwapæºå¶ï¼å°±ä¼æä¸é¨åæ°æ®è¢«æ¢å°ç£çä¸ï¼å½è®¿é®ç£çä¸çè¿é¨åæ°æ®æ¶ï¼æ§è½ä¼æ¥å§ä¸éãå¦æäºä¸»æºæ²¡æå¼å¯Swapï¼ä¼ç´æ¥è§¦åOOMï¼æ´ä¸ªRediså®ä¾ä¼é¢ä¸´è¢«ç³»ç»killæçé£é©ã\n 2. ä¸»çº¿ç¨åå­è¿ç¨ç«äºä½¿ç¨CPUçé£é©ï¼çæRDBçå­è¿ç¨éè¦CPUæ ¸è¿è¡ï¼ä¸»çº¿ç¨æ¬èº«ä¹éè¦CPUæ ¸è¿è¡ï¼èä¸ï¼å¦æRedisè¿å¯ç¨äºåå°çº¿ç¨ï¼æ­¤æ¶ï¼ä¸»çº¿ç¨ãå­è¿ç¨ååå°çº¿ç¨é½ä¼ç«äºCPUèµæºãç±äºäºä¸»æºåªæ2æ ¸CPUï¼è¿å°±ä¼å½±åå°ä¸»çº¿ç¨å¤çè¯·æ±çéåº¦ã\n\næ¬èé®é¢ 2 ï¼åæ¶å¤å¶çåºå±å®ç°æºå¶ï¼ï¼\n\nåæ¶å¤å¶çææï¼bgsaveå­è¿ç¨ç¸å½äºå¤å¶äºåå§æ°æ®ï¼èä¸»çº¿ç¨ä»ç¶å¯ä»¥ä¿®æ¹åæ¥çæ°æ®ã\n\nå¯¹Redisæ¥è¯´ï¼ä¸»çº¿ç¨forkåºbgsaveå­è¿ç¨åï¼bgsaveå­è¿ç¨å®éæ¯å¤å¶äºä¸»çº¿ç¨çé¡µè¡¨ãè¿äºé¡µè¡¨ä¸­ï¼å°±ä¿å­äºå¨æ§è¡bgsaveå½ä»¤æ¶ï¼ä¸»çº¿ç¨çæææ°æ®åå¨åå­ä¸­çç©çå°åãè¿æ ·ä¸æ¥ï¼bgsaveå­è¿ç¨çæRDBæ¶ï¼å°±å¯ä»¥æ ¹æ®é¡µè¡¨è¯»åè¿äºæ°æ®ï¼ååå¥ç£çä¸­ãå¦ææ­¤æ¶ï¼ä¸»çº¿ç¨æ¥æ¶å°äºæ°åæä¿®æ¹æä½ï¼é£ä¹ï¼ä¸»çº¿ç¨ä¼ä½¿ç¨åæ¶å¤å¶æºå¶ãå·ä½æ¥è¯´ï¼åæ¶å¤å¶å°±æ¯æï¼ä¸»çº¿ç¨å¨æåæä½æ¶ï¼æä¼æè¿ä¸ªæ°åæä¿®æ¹åçæ°æ®åå¥å°ä¸ä¸ªæ°çç©çå°åä¸­ï¼å¹¶ä¿®æ¹èªå·±çé¡µè¡¨æ å°ã\n\nææ¥åå©ä¸å¾ä¸­çä¾å­ï¼å·ä½å±ç¤ºä¸ä¸åæ¶å¤å¶çåºå±æºå¶ã\n\nbgsaveå­è¿ç¨å¤å¶ä¸»çº¿ç¨çé¡µè¡¨ä»¥åï¼åå¦ä¸»çº¿ç¨éè¦ä¿®æ¹èé¡µ7éçæ°æ®ï¼é£ä¹ï¼ä¸»çº¿ç¨å°±éè¦æ°åéä¸ä¸ªç©çé¡µï¼åè®¾æ¯ç©çé¡µ53ï¼ï¼ç¶åæä¿®æ¹åçèé¡µ7éçæ°æ®åå°ç©çé¡µ53ä¸ï¼èèé¡µ7éåæ¥çæ°æ®ä»ç¶ä¿å­å¨ç©çé¡µ33ä¸ãè¿ä¸ªæ¶åï¼èé¡µ7å°ç©çé¡µ33çæ å°å³ç³»ï¼ä»ç¶ä¿çå¨bgsaveå­è¿ç¨ä¸­ãæä»¥ï¼bgsaveå­è¿ç¨å¯ä»¥æ è¯¯å°æèé¡µ7çåå§æ°æ®åå¥RDBæä»¶ã",normalizedContent:"# æä¹åæºå¶ï¼aofæ¥å¿årdbå¿«ç§\n\n> åèï¼\n> \n>  * 04 aof æ¥å¿ï¼å®æºäºï¼redis å¦ä½é¿åæ°æ®ä¸¢å¤±ï¼ | æå®¢æ¶é´\n>  * 05 åå­å¿«ç§ï¼å®æºåï¼redis å¦ä½å®ç°å¿«éæ¢å¤ï¼| æå®¢æ¶é´\n\nredis ç¨ä½ç¼å­å¹¶å°æ°æ®å­äºåå­ä¸­ï¼å°±ä¼é¢å¯¹ä¸ä¸ªé®é¢ï¼ä¸æ¦æå¡å¨å®æºï¼åå­ä¸­çæ°æ®å°å¨é¨ä¸¢å¤±ã\n\nä¹è®¸æä¸ªè§£å³æ¹æ¡ï¼ä»åç«¯æ°æ®åºæ¢å¤è¿äºæ°æ®ãä½è¿é¢ç¹è®¿é®æ°æ®åºä¼ä½¿å¾æ§è½ä¸¥éä¸éãæä»¥å¯¹äº redis èè¨ï¼å®ç°æ°æ®çæä¹åï¼é¿åä»åç«¯ä¸­æ¢å¤æ°æ®ï¼æ¯è³å³éè¦çã\n\nç®åï¼redis çæä¹åä¸»è¦æä¸¤å¤§æºå¶ï¼aof æ¥å¿å rdb å¿«ç§ãè¿éè®²åå«è®²è§£ã\n\n\n# 1. aof æ¥å¿ï¼å®æºäºï¼redis å¦ä½é¿åæ°æ®ä¸¢å¤±\n\naofï¼append only file\n\n\n# 1.1 aof æ¥å¿æ¯å¦ä½å®ç°çï¼\n\nè¯´å°æ¥å¿ï¼æä»¬çæçæ¯é¢åæ¥å¿ï¼walï¼write ahead logï¼ï¼ä¹å°±æ¯è¯´ï¼å¨å®éåæ°æ®åï¼åæä¿®æ¹çæ°æ®è®°å°æ¥å¿æä»¶ä¸­ï¼ä»¥ä¾¿æéæ¶è¿è¡æ¢å¤ãä¸è¿ï¼aof æ¥å¿æ­£å¥½ç¸åï¼å®æ¯ååæ¥å¿ï¼âååâçæææ¯ redis æ¯åæ§è¡å½ä»¤ï¼ææ°æ®åå¥åå­ï¼ç¶åæè®°å½æ¥å¿ï¼å¦ä¸å¾æç¤ºï¼\n\né£ aof ä¸ºä»ä¹è¦åæ§è¡å½ä»¤åè®°æ¥å¿å¢ï¼è¦åç­è¿ä¸ªé®é¢ï¼æä»¬è¦åç¥é aof éè®°å½äºä»ä¹åå®¹ã\n\nä¼ ç»æ°æ®åºçæ¥å¿ï¼ä¾å¦ redo logï¼éåæ¥å¿ï¼ï¼è®°å½çæ¯ä¿®æ¹åçæ°æ®ï¼è aof éè®°å½çæ¯ redis æ¶å°çæ¯ä¸æ¡å½ä»¤ï¼è¿äºå½ä»¤æ¯ä»¥ææ¬å½¢å¼ä¿å­çã\n\næä»¬ä»¥redisæ¶å°âset testkey testvalueâå½ä»¤åè®°å½çæ¥å¿ä¸ºä¾ï¼ççaofæ¥å¿çåå®¹ãå¶ä¸­ï¼â *3âè¡¨ç¤ºå½åå½ä»¤æä¸ä¸ªé¨åï¼æ¯é¨åé½æ¯ç±â $+æ°å­âå¼å¤´ï¼åé¢ç´§è·çå·ä½çå½ä»¤ãé®æå¼ãè¿éï¼âæ°å­âè¡¨ç¤ºè¿é¨åä¸­çå½ä»¤ãé®æå¼ä¸å±æå¤å°å­èãä¾å¦ï¼â $3 setâè¡¨ç¤ºè¿é¨åæ3ä¸ªå­èï¼ä¹å°±æ¯âsetâå½ä»¤ã\n\nä½æ¯ï¼ä¸ºäºé¿åé¢å¤çæ£æ¥å¼éï¼redis å¨å aof éé¢è®°å½æ¥å¿çæ¶åï¼å¹¶ä¸ä¼åå»å¯¹è¿äºå½ä»¤è¿è¡è¯­æ³æ£æ¥ãæä»¥ï¼å¦æåè®°æ¥å¿åæ§è¡å½ä»¤çè¯ï¼æ¥å¿ä¸­å°±æå¯è½è®°å½äºéè¯¯çå½ä»¤ï¼redis å¨ä½¿ç¨æ¥å¿æ¢å¤æ°æ®æ¶ï¼å°±å¯è½ä¼åºéã\n\nèååæ¥å¿è¿ç§æ¹å¼ï¼å°±æ¯åè®©ç³»ç»æ§è¡å½ä»¤ï¼åªæå½ä»¤è½æ§è¡æåï¼æä¼è¢«è®°å½å°æ¥å¿ä¸­ï¼å¦åï¼ç³»ç»å°±ä¼ç´æ¥åå®¢æ·ç«¯æ¥éãæä»¥ï¼redis ä½¿ç¨ååæ¥å¿è¿ä¸æ¹å¼çä¸å¤§å¥½å¤æ¯ï¼å¯ä»¥é¿ååºç°è®°å½éè¯¯å½ä»¤çæåµã\n\né¤æ­¤ä¹å¤ï¼aof è¿æä¸ä¸ªå¥½å¤ï¼å®æ¯å¨å½ä»¤æ§è¡åæè®°å½æ¥å¿ï¼æä»¥ä¸ä¼é»å¡å½åçåæä½ã\n\nä¸è¿ï¼aof ä¹æä¸¤ä¸ªæ½å¨çé£é©:\n\n * é¦åï¼å¦æåæ§è¡å®ä¸ä¸ªå½ä»¤ï¼è¿æ²¡ææ¥å¾åè®°æ¥å¿å°±å®æºäºï¼é£ä¹è¿ä¸ªå½ä»¤åç¸åºçæ°æ®å°±æä¸¢å¤±çé£é©ãå¦ææ­¤æ¶ redis æ¯ç¨ä½ç¼å­ï¼è¿å¯ä»¥ä»åç«¯æ°æ®åºéæ°è¯»å¥æ°æ®è¿è¡æ¢å¤ï¼ä½æ¯ï¼å¦æ redis æ¯ç´æ¥ç¨ä½æ°æ®åºçè¯ï¼æ­¤æ¶ï¼å ä¸ºå½ä»¤æ²¡æè®°å¥æ¥å¿ï¼æä»¥å°±æ æ³ç¨æ¥å¿è¿è¡æ¢å¤äºã\n * å¶æ¬¡ï¼aof è½ç¶é¿åäºå¯¹å½åå½ä»¤çé»å¡ï¼ä½å¯è½ä¼ç»ä¸ä¸ä¸ªæä½å¸¦æ¥é»å¡é£é©ãè¿æ¯å ä¸ºï¼aof æ¥å¿ä¹æ¯å¨ä¸»çº¿ç¨ä¸­æ§è¡çï¼å¦æå¨ææ¥å¿æä»¶åå¥ç£çæ¶ï¼ç£çåååå¤§ï¼å°±ä¼å¯¼è´åçå¾æ¢ï¼è¿èå¯¼è´åç»­çæä½ä¹æ æ³æ§è¡äºã\n\nä»ç»åæçè¯ï¼ä½ å°±ä¼åç°ï¼è¿ä¸¤ä¸ªé£é©é½æ¯å aof ååç£ççæ¶æºç¸å³çãè¿ä¹å°±æå³çï¼å¦ææä»¬è½å¤æ§å¶ä¸ä¸ªåå½ä»¤æ§è¡å®å aof æ¥å¿ååç£ççæ¶æºï¼è¿ä¸¤ä¸ªé£é©å°±è§£é¤äºã\n\n\n# 1.2 ä¸ç§ååç­ç¥\n\nå¶å®ï¼å¯¹äºè¿ä¸ªé®é¢ï¼aof æºå¶ç»æä»¬æä¾äºä¸ä¸ªéæ©ï¼ä¹å°±æ¯ aof éç½®é¡¹ appendfsync çä¸ä¸ªå¯éå¼ï¼\n\n * alwaysï¼åæ­¥ååï¼æ¯ä¸ªåå½ä»¤æ§è¡å®ï¼ç«é©¬åæ­¥å°å°æ¥å¿ååç£çï¼\n * everysecï¼æ¯ç§ååï¼æ¯ä¸ªåå½ä»¤æ§è¡å®ï¼åªæ¯åææ¥å¿åå° aof æä»¶çåå­ç¼å²åºï¼æ¯éä¸ç§æç¼å²åºä¸­çåå®¹åå¥ç£çï¼\n * noï¼æä½ç³»ç»æ§å¶çååï¼æ¯ä¸ªåå½ä»¤æ§è¡å®ï¼åªæ¯åææ¥å¿åå° aof æä»¶çåå­ç¼å²åºï¼ç±æä½ç³»ç»å³å®ä½æ¶å°ç¼å²åºåå®¹ååç£çã\n\néå¯¹é¿åä¸»çº¿ç¨é»å¡ååå°æ°æ®ä¸¢å¤±é®é¢ï¼è¿ä¸ç§ååç­ç¥é½æ æ³åå°ä¸¤å¨å¶ç¾ãæä»¬æ¥åæä¸å¶ä¸­çåå ï¼\n\n * âåæ­¥ååâå¯ä»¥åå°åºæ¬ä¸ä¸¢æ°æ®ï¼ä½æ¯å®å¨æ¯ä¸ä¸ªåå½ä»¤åé½æä¸ä¸ªæ¢éçè½çæä½ï¼ä¸å¯é¿åå°ä¼å½±åä¸»çº¿ç¨æ§è½ï¼\n * è½ç¶âæä½ç³»ç»æ§å¶çååâå¨åå®ç¼å²åºåï¼å°±å¯ä»¥ç»§ç»­æ§è¡åç»­çå½ä»¤ï¼ä½æ¯è½ççæ¶æºå·²ç»ä¸å¨ redis æä¸­äºï¼åªè¦ aof è®°å½æ²¡æååç£çï¼ä¸æ¦å®æºå¯¹åºçæ°æ®å°±ä¸¢å¤±äºï¼\n * âæ¯ç§ååâéç¨ä¸ç§ååä¸æ¬¡çé¢çï¼é¿åäºâåæ­¥ååâçæ§è½å¼éï¼è½ç¶åå°äºå¯¹ç³»ç»æ§è½çå½±åï¼ä½æ¯å¦æåçå®æºï¼ä¸ä¸ç§åæªè½ççå½ä»¤æä½ä»ç¶ä¼ä¸¢å¤±ãæä»¥ï¼è¿åªè½ç®æ¯ï¼å¨é¿åå½±åä¸»çº¿ç¨æ§è½åé¿åæ°æ®ä¸¢å¤±ä¸¤èé´åäºä¸ªæä¸­ã\n\nä¸ç§ååç­ç¥çå¯¹æ¯å¦ä¸ï¼\n\néæ©åªç§ååç­ç¥ï¼å°±è¦å¨é«æ§è½åé«å¯é æ§ä¹é´å trade-off äºï¼\n\n * æ³è¦è·å¾é«æ§è½ï¼å°±éæ© no ç­ç¥ï¼\n * å¦ææ³è¦å¾å°é«å¯é æ§ä¿è¯ï¼å°±éæ© always ç­ç¥ï¼\n * å¦æåè®¸æ°æ®æä¸ç¹ä¸¢å¤±ï¼åå¸ææ§è½å«åå¤ªå¤§å½±åçè¯ï¼é£ä¹å°±éæ© everysec ç­ç¥ã\n\néç redis æ¥æ¶çå½ä»¤è¶æ¥è¶å¤ï¼aof æä»¶ä¹ä¼è¶æ¥è¶å¤§ï¼è¿ä¹å°±æå³çï¼æä»¬ä¸å®è¦å°å¿ aof æä»¶è¿å¤§å¸¦æ¥çæ§è½é®é¢ãè¿éçâæ§è½é®é¢âï¼ä¸»è¦å¨äºä»¥ä¸ä¸ä¸ªæ¹é¢ï¼\n\n 1. æä»¶ç³»ç»æ¬èº«å¯¹æä»¶å¤§å°æéå¶ï¼æ æ³ä¿å­è¿å¤§çæä»¶ï¼\n 2. å¦ææä»¶å¤ªå¤§ï¼ä¹ååå¾éé¢è¿½å å½ä»¤è®°å½çè¯ï¼æçä¹ä¼åä½ï¼\n 3. å¦æåçå®æºï¼aof ä¸­è®°å½çå½ä»¤è¦ä¸ä¸ªä¸ªè¢«éæ°æ§è¡ï¼ç¨äºæéæ¢å¤ï¼å¦ææ¥å¿æä»¶å¤ªå¤§ï¼æ´ä¸ªæ¢å¤è¿ç¨å°±ä¼éå¸¸ç¼æ¢ï¼è¿å°±ä¼å½±åå° redis çæ­£å¸¸ä½¿ç¨ã\n\næä»¥ï¼æä»¬å°±è¦éåä¸å®çæ§å¶ææ®µï¼è¿ä¸ªæ¶åï¼**aof éåæºå¶**å°±ç»åºäºã\n\n\n# 1.3 aof éåæºå¶\n\nå½ aof æ¥å¿æä»¶å¤ªå¤§äºï¼å°±éè¦ aof éåæºå¶äºã\n\naof éåæºå¶ï¼å°±æ¯å¨éåæ¶ï¼redis æ ¹æ®æ°æ®åºçç°ç¶åå»ºä¸ä¸ªæ°ç aof æä»¶ï¼ä¹å°±æ¯è¯´ï¼è¯»åæ°æ®åºä¸­çææé®å¼å¯¹ï¼ç¶åå¯¹æ¯ä¸ä¸ªé®å¼å¯¹ç¨ä¸æ¡å½ä»¤è®°å½å®çåå¥ãæ¯å¦è¯´ï¼å½è¯»åäºé®å¼å¯¹âtestkeyâ: âtestvalueâä¹åï¼éåæºå¶ä¼è®°å½ set testkey testvalue è¿æ¡å½ä»¤ãè¿æ ·ï¼å½éè¦æ¢å¤æ¶ï¼å¯ä»¥éæ°æ§è¡è¯¥å½ä»¤ï¼å®ç°âtestkeyâ: âtestvalueâçåå¥ã\n\nä¸ºä»ä¹éåæºå¶å¯ä»¥ææ¥å¿æä»¶åå°å¢? å®éä¸ï¼éåæºå¶å·æâå¤åä¸âåè½ãæè°çâå¤åä¸âï¼ä¹å°±æ¯è¯´ï¼æ§æ¥å¿æä»¶ä¸­çå¤æ¡å½ä»¤ï¼å¨éååçæ°æ¥å¿ä¸­åæäºä¸æ¡å½ä»¤ãå ä¸ºè¿ä¸ªè¿ç¨æä¸äºä¸­é´çä¿®æ¹è®°å½ç»å»æäºï¼åªä¿çäºææ°çæ°æ®åºç¶æãå¦ä¸å¾æç¤ºï¼\n\nä¸è¿ï¼è½ç¶ aof éååï¼æ¥å¿æä»¶ä¼ç¼©å°ï¼ä½æ¯ï¼è¦ææ´ä¸ªæ°æ®åºçææ°æ°æ®çæä½æ¥å¿é½ååç£çï¼ä»ç¶æ¯ä¸ä¸ªéå¸¸èæ¶çè¿ç¨ãè¿æ¶ï¼æä»¬å°±è¦ç»§ç»­å³æ³¨å¦ä¸ä¸ªé®é¢äºï¼éåä¼ä¸ä¼é»å¡ä¸»çº¿ç¨ï¼\n\n\n# 1.4 aof éåä¼é»å¡åï¼ââ ä¸ä¼\n\nå aof æ¥å¿ç±ä¸»çº¿ç¨ååä¸åï¼éåè¿ç¨æ¯ç±åå°å­è¿ç¨ bgrewriteaof æ¥å®æçï¼è¿ä¹æ¯ä¸ºäºé¿åé»å¡ä¸»çº¿ç¨ï¼å¯¼è´æ°æ®åºæ§è½ä¸éã\n\nææéåçè¿ç¨æ»ç»ä¸ºâä¸ä¸ªæ·è´ï¼ä¸¤å¤æ¥å¿âï¼\n\nâä¸ä¸ªæ·è´âå°±æ¯æï¼æ¯æ¬¡æ§è¡éåæ¶ï¼ä¸»çº¿ç¨ fork åºåå°ç bgrewriteaof å­è¿ç¨ãæ­¤æ¶ï¼fork ä¼æä¸»çº¿ç¨çåå­æ·è´ä¸ä»½ç» bgrewriteaof å­è¿ç¨ï¼è¿éé¢å°±åå«äºæ°æ®åºçææ°æ°æ®ãç¶åï¼bgrewriteaof å­è¿ç¨å°±å¯ä»¥å¨ä¸å½±åä¸»çº¿ç¨çæåµä¸ï¼éä¸ææ·è´çæ°æ®åææä½ï¼è®°å¥éåæ¥å¿ã\n\nâä¸¤å¤æ¥å¿âåæ¯ä»ä¹å¢ï¼\n\nå ä¸ºä¸»çº¿ç¨æªé»å¡ï¼ä»ç¶å¯ä»¥å¤çæ°æ¥çæä½ãæ­¤æ¶ï¼å¦ææåæä½ï¼ç¬¬ä¸å¤æ¥å¿å°±æ¯ææ­£å¨ä½¿ç¨ç aof æ¥å¿ï¼redis ä¼æè¿ä¸ªæä½åå°å®çç¼å²åºãè¿æ ·ä¸æ¥ï¼å³ä½¿å®æºäºï¼è¿ä¸ª aof æ¥å¿çæä½ä»ç¶æ¯é½å¨çï¼å¯ä»¥ç¨äºæ¢å¤ã\n\nèç¬¬äºå¤æ¥å¿ï¼å°±æ¯ææ°ç aof éåæ¥å¿ãè¿ä¸ªæä½ä¹ä¼è¢«åå°éåæ¥å¿çç¼å²åºãè¿æ ·ï¼éåæ¥å¿ä¹ä¸ä¼ä¸¢å¤±ææ°çæä½ãç­å°æ·è´æ°æ®çæææä½è®°å½éåå®æåï¼éåæ¥å¿è®°å½çè¿äºææ°æä½ä¹ä¼åå¥æ°ç aof æä»¶ï¼ä»¥ä¿è¯æ°æ®åºææ°ç¶æçè®°å½ãæ­¤æ¶ï¼æä»¬å°±å¯ä»¥ç¨æ°ç aof æä»¶æ¿ä»£æ§æä»¶äºã\n\nå æ­¤ï¼aof éé»å¡çéåè¿ç¨å¦ä¸å¾æç¤ºï¼\n\næ»ç»æ¥è¯´ï¼æ¯æ¬¡ aof éåæ¶ï¼redis ä¼åæ§è¡ä¸ä¸ªåå­æ·è´ï¼ç¨äºéåï¼ç¶åï¼ä½¿ç¨ä¸¤ä¸ªæ¥å¿ä¿è¯å¨éåè¿ç¨ä¸­ï¼æ°åå¥çæ°æ®ä¸ä¼ä¸¢å¤±ãèä¸ï¼å ä¸º redis éç¨é¢å¤ççº¿ç¨è¿è¡æ°æ®éåï¼æä»¥ï¼è¿ä¸ªè¿ç¨å¹¶ä¸ä¼é»å¡ä¸»çº¿ç¨ã\n\n\n# 1.5 å°ç»\n\nè¿ä¸èä»ç»äº redis ç¨äºé¿åæ°æ®ä¸¢å¤±ç aof æ¥å¿æºå¶ãè¿ä¸ªæ¹æ³éè¿éä¸è®°å½æä½å½ä»¤ï¼å¨æ¢å¤æ¶åéä¸æ§è¡å½ä»¤çæ¹å¼ï¼ä¿è¯äºæ°æ®çå¯é æ§ã\n\naof æºå¶èèå°å¯¹ redis æ§è½çå½±åï¼æä¾äº aof æ¥å¿çä¸ç§ååç­ç¥ã\n\næ­¤å¤ï¼ä¸ºäºé¿åæ¥å¿æä»¶è¿å¤§ï¼redis æä¾äº aof éåæºå¶ï¼ç´æ¥æ ¹æ®æ°æ®åºéæ°æ®çææ°ç¶æï¼çæè¿äºæ°æ®çæå¥å½ä»¤ï¼ä½ä¸ºæ°æ¥å¿ãè¿ä¸ªè¿ç¨éè¿åå°çº¿ç¨å®æï¼é¿åäºå¯¹ä¸»çº¿ç¨çé»å¡ã\n\nä¸è¿ï¼ä¸é¢ä»ç»çè½çæ¶æºåéåæºå¶é½æ¯ç¨äºâè®°æ¥å¿âçæ¹æ³ï¼èå¨âç¨æ¥å¿âæ¶ï¼éè¦å¯¹ææçæä½è®°å½è¿è¡é¡ºåºéæ¾ï¼è¿ä¸ªéæ¾è¿ç¨å°±å¾æ¢äºãé£ï¼ææ²¡ææ¢è½é¿åæ°æ®ä¸¢å¤±ï¼åè½æ´å¿«å°æ¢å¤çæ¹æ³å¢ï¼å½ç¶æï¼é£å°±æ¯ rdb å¿«ç§äºã\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼aof éåè¿ç¨ææ²¡æå¶ä»æ½å¨çé»å¡é£é©ï¼\n\nè¿éæä¸¤ä¸ªé£é©ï¼\n\n 1. redis ä¸»çº¿ç¨ fork åå»º bgrewriteaof å­è¿ç¨æ¶ï¼åæ ¸éè¦åå»ºç¨äºç®¡çå­è¿ç¨çç¸å³æ°æ®ç»æï¼è¿äºæ°æ®ç»æå¨æä½ç³»ç»ä¸­éå¸¸å«ä½è¿ç¨æ§å¶åï¼process control blockï¼ç®ç§°ä¸º pcbï¼ãåæ ¸è¦æä¸»çº¿ç¨ç pcb åå®¹æ·è´ç»å­è¿ç¨ãè¿ä¸ªåå»ºåæ·è´è¿ç¨ç±åæ ¸æ§è¡ï¼æ¯ä¼é»å¡ä¸»çº¿ç¨çãèä¸ï¼å¨æ·è´è¿ç¨ä¸­ï¼å­è¿ç¨è¦æ·è´ç¶è¿ç¨çé¡µè¡¨ï¼è¿ä¸ªè¿ç¨çèæ¶å redis å®ä¾çåå­å¤§å°æå³ãå¦æ redis å®ä¾åå­å¤§ï¼é¡µè¡¨å°±ä¼å¤§ï¼fork æ§è¡æ¶é´å°±ä¼é¿ï¼è¿å°±ä¼ç»ä¸»çº¿ç¨å¸¦æ¥é»å¡é£é©ã\n 2. bgrewriteaof å­è¿ç¨ä¼åä¸»çº¿ç¨å±äº«åå­ãå½ä¸»çº¿ç¨æ¶å°æ°åæä¿®æ¹çæä½æ¶ï¼ä¸»çº¿ç¨ä¼ç³è¯·æ°çåå­ç©ºé´ï¼ç¨æ¥ä¿å­æ°åæä¿®æ¹çæ°æ®ï¼å¦ææä½çæ¯ bigkeyï¼ä¹å°±æ¯æ°æ®éå¤§çéåç±»åæ°æ®ï¼é£ä¹ï¼ä¸»çº¿ç¨ä¼å ä¸ºç³è¯·å¤§ç©ºé´èé¢ä¸´é»å¡é£é©ãå ä¸ºæä½ç³»ç»å¨åéåå­ç©ºé´æ¶ï¼ææ¥æ¾åéçå¼éï¼è¿å°±ä¼å¯¼è´é»å¡ã\n\næ¬èé®é¢ 2ï¼aof éåä¸ºä»ä¹ä¸å±äº«ä½¿ç¨ aof æ¬èº«çæ¥å¿ï¼\n\nå¦æé½ç¨ aof æ¥å¿çè¯ï¼ä¸»çº¿ç¨è¦åï¼bgrewriteaof å­è¿ç¨ä¹è¦åï¼è¿ä¸¤èä¼ç«äºæä»¶ç³»ç»çéï¼è¿å°±ä¼å¯¹ redis ä¸»çº¿ç¨çæ§è½é æå½±åã\n\n\n# 2. rdb å¿«ç§ï¼å®æºåï¼rediså¦ä½å®ç°å¿«éæ¢å¤ï¼\n\n\n# 2.1 ä»ä¹æ¯ rdb\n\nä¸ä¸èè®²ç redis é¿åæ°æ®ä¸¢å¤±ç aof æ¹æ³ï¼å¥½å¤æ¯æ¯æ¬¡æ§è¡åªéè¦è®°å½æä½å½ä»¤ï¼éè¦æä¹åçæ°æ®éä¸å¤§ï¼åªè¦ä½ ä¸æ¯éç¨ç always çæä¹åç­ç¥ï¼å°±ä¸ä¼å¯¹æ§è½é æå¤ªå¤§å½±åã\n\nä½ç±äºè®°å½çå½ä»¤èä¸æ¯å®éæ°æ®ï¼å æ­¤ä½¿ç¨ aof æ¥å¿è¿è¡æéæ¢å¤æ¶éè¦éæ¾ä¸éï¼å¦ææ¥å¿è¿å¤ä¼èè´¹å¾é¿æ¶é´ãé£ææ²¡ææ¢å¯ä»¥ä¿è¯å¯é æ§ï¼è¿è½å¨å®æºæ¶å®ç°å¿«éæ¢å¤çå¶ä»æ¹æ³å¢ï¼è¿å°±æ¯è¿èè¦å­¦ä¹ çæä¹åæ¹æ³ââåå­å¿«ç§ã\n\nåå­å¿«ç§ï¼æåå­ä¸­çæ°æ®å¨æä¸ä¸ªæ¶å»çç¶æè®°å½ã\n\nè¿å°±åå¹³æ¶æç§çä¸æ ·ï¼åå­å¿«ç§ææä¸æ¶å»çç¶æä»¥æä»¶çå½¢å¼åå°ç£çä¸ï¼è¿æ ·å³ä½¿å®æºï¼å¿«ç§æä»¶ä¹ä¸ä¼ä¸¢å¤±ï¼æ°æ®çå¯é æ§ä¹å°±å¾å°äºä¿è¯ãè¿ä¸ªå¿«ç§æä»¶å°±ç§°ä¸º rdb æä»¶ã\n\n> rdb: redis database\n\nå aof ç¸æ¯ï¼rdb è®°å½çæ¯æä¸æ¶å»çæ°æ®ï¼å¹¶ä¸æ¯æä½ï¼æä»¥ï¼å¨åæ°æ®æ¢å¤æ¶ï¼æä»¬å¯ä»¥ç´æ¥æ rdb æä»¶è¯»å¥åå­ï¼å¾å¿«å°å®ææ¢å¤ã\n\nä½åå­å¿«ç§ä¹å¹¶ä¸ä¸å®æ¯æä¼éé¡¹ï¼æå¿«ç§æ¶åå°ä¸¤ä¸ªå³é®é®é¢ï¼\n\n * ç»åªäºæ°æ®æå¿«ç§ï¼è¿æ¶åå°å¿«ç§çæ§è¡æççé®é¢ã\n * æå¿«ç§æ¶è¿è½å¢å æ¹åï¼è¿æ¶å redis æ¯å¦è¢«é»å¡ã\n\n\n# 2.2 ç»åªäºæ°æ®æå¿«ç§ï¼\n\nredis çæ°æ®é½å¨åå­ä¸­ï¼ä¸ºäºæä¾æææ°æ®çå¯é æ§ä¿è¯ï¼å®æ§è¡çæ¯å¨éå¿«ç§ï¼ä¹å°±æ¯è¯´ï¼æåå­ä¸­çæææ°æ®é½è®°å½å°ç£çä¸­ã\n\nä½å¨éå¿«ç§å¨é¨åå¥ç£çä¼è±è´¹å¾å¤æ¶é´ï¼è redis çåçº¿ç¨æ¨¡ååå³å®äºæä»¬è¦å°½éé¿åææä¼é»å¡ä¸»çº¿ç¨çæä½ãé£ rdb æä»¶ççææ¯å¦ä¼é»å¡ä¸»çº¿ç¨ï¼\n\nredis æä¾äºä¸¤ä¸ªå½ä»¤æ¥çæ rdb æä»¶ï¼åå«æ¯ save å bgsaveï¼\n\n * saveï¼å¨ä¸»çº¿ç¨ä¸­æ§è¡ï¼ä¼å¯¼è´é»å¡ï¼\n * bgsaveï¼åå»ºä¸ä¸ªå­è¿ç¨ï¼ä¸é¨ç¨äºåå¥ rdb æä»¶ï¼é¿åäºä¸»çº¿ç¨çé»å¡ï¼è¿ä¹æ¯ redis rdb æä»¶çæçé»è®¤éç½®ã\n\næ­¤æ¶ï¼æä»¬å¯ä»¥éè¿bgsaveå½ä»¤æ¥æ§è¡å¨éå¿«ç§ï¼è¿æ¢æä¾äºæ°æ®çå¯é æ§ä¿è¯ï¼ä¹é¿åäºå¯¹ redis çæ§è½å½±åã\n\næ¥ä¸æ¥éè¦èèï¼ä½¿ç¨ bgsave æ¥æ§è¡å¨éå¿«ç§æ¶ï¼redis è½å¦æ­£å¸¸å¤çåæä½ï¼\n\n\n# 2.3 å¿«ç§æ¶æ°æ®è½ä¿®æ¹åï¼\n\nå¨æå¿«ç§æ¶ï¼å¦æåçæ°æ®æ¹å¨ï¼åå¾å®¹æäº§çæ°æ®ä¸ä¸è´ç°è±¡ãå¦æä¸æ³è®©æ°æ®åçæ¹å¨ï¼é£æå¿«ç§æé´ redis æ æ³æ¥æ¶åè¯·æ±ï¼è¿å¨çäº§ç¯å¢ä¸æ¯ä¸è¢«åè®¸çãè¿æ¶ï¼redis å°±åå©äºæä½ç³»ç»æä¾çåæ¶å¤å¶ææ¯ï¼copy-on-writeï¼cowï¼ï¼å¨æ§è¡å¿«ç§çåæ¶ï¼æ­£å¸¸å¤çåæä½ã\n\nä¸ºä»ä¹ä¸ç¨ bgsave é¿åé»å¡æ¥å¤çæå¿«ç§æé´ä¸è½åçé®é¢å¢ï¼\n\nè¿æ¯ä¸ä¸ªå¸¸è§çè¯¯åºã\n\né¿åé»å¡åæ­£å¸¸å¤çåæä½å¹¶ä¸æ¯ä¸åäºãç¨ bgsave æ§è¡å¨éå¿«ç§æ¶ï¼ä¸»çº¿ç¨çç¡®æ²¡æé»å¡ï¼å¯ä»¥æ­£å¸¸æ¥æ¶è¯·æ±ï¼ä½æ¯ï¼ä¸ºäºä¿è¯å¿«ç§å®æ´æ§ï¼å®åªè½å¤çè¯»æä½ï¼å ä¸ºä¸è½ä¿®æ¹æ­£å¨æ§è¡å¿«ç§çæ°æ®ã\n\nç®åæ¥è¯´ï¼ bgsave å­è¿ç¨æ¯ç±ä¸»çº¿ç¨ fork çæçï¼å¯ä»¥å±äº«ä¸»çº¿ç¨çææåå­æ°æ®ãbgsave å­è¿ç¨è¿è¡åï¼å¼å§è¯»åä¸»çº¿ç¨çåå­æ°æ®ï¼å¹¶æå®ä»¬åå¥ rdb æä»¶ã\n\n * æ­¤æ¶ï¼å¦æä¸»çº¿ç¨å¯¹è¿äºæ°æ®é½æ¯è¯»æä½ï¼å¦å¾ä¸­çé®å¼å¯¹ aï¼ï¼é£ä¹ï¼ä¸»çº¿ç¨å bgsave å­è¿ç¨ç¸äºä¸å½±åã\n * ä½å¦æä¸»çº¿ç¨è¦ä¿®æ¹ä¸åæ°æ®ï¼ä¾å¦å¾ä¸­çé®å¼å¯¹ cï¼ï¼é£ä¹ï¼è¿åæ°æ®å°±ä¼è¢«å¤å¶ä¸ä»½ï¼çæè¯¥æ°æ®çå¯æ¬ï¼é®å¼å¯¹ câï¼ãç¶åï¼ä¸»çº¿ç¨å¨è¿ä¸ªæ°æ®å¯æ¬ä¸è¿è¡ä¿®æ¹ãåæ¶ï¼bgsaveå­è¿ç¨å¯ä»¥ç»§ç»­æåæ¥çæ°æ®ï¼é®å¼å¯¹ cï¼åå¥ rdb æä»¶ã\n\nè¿æ¢ä¿è¯äºå¿«ç§çå®æ´æ§ï¼ä¹åè®¸ä¸»çº¿ç¨åæ¶å¯¹æ°æ®è¿è¡ä¿®æ¹ï¼é¿åäºå¯¹æ­£å¸¸ä¸å¡çå½±åã\n\nå°è¿éï¼æä»¬å°±è§£å³äºå¯¹âåªäºæ°æ®åå¿«ç§âä»¥åâåå¿«ç§æ¶æ°æ®è½å¦ä¿®æ¹âè¿ä¸¤å¤§é®é¢ï¼redis ä¼ä½¿ç¨ bgsave å¯¹å½ååå­ä¸­çæææ°æ®åå¿«ç§ï¼è¿ä¸ªæä½æ¯å­è¿ç¨å¨åå°å®æçï¼è¿å°±åè®¸ä¸»çº¿ç¨åæ¶å¯ä»¥ä¿®æ¹æ°æ®ã\n\n\n# 2.4 æå¿«ç§çé¢ç\n\nå¿«ç§é´éæ¶é´ä¹æ¯ä¸ä¸ªå³é®é®é¢ã\n\næå¿«ç§çé´éè¶å°ï¼åçå®æºæ¶ä¸¢å¤±çæ°æ®ä¹å°±è¶å°ï¼é£è½ä¸è½æ¯ç§æä¸æ¬¡å¿«ç§ï¼\n\nè¿ç§æ³æ³æ¯éè¯¯çãé¢ç¹æ§è¡å¨éå¿«ç§ä¼å¸¦æ¥ä¸¤æ¹é¢çå¼éï¼\n\n * ä¸æ¹é¢ï¼é¢ç¹å°å¨éæ°æ®åå¥ç£çï¼ä¼ç»ç£çå¸¦æ¥å¾å¤§ååï¼å¤ä¸ªå¿«ç§ç«äºæéçç£çå¸¦å®½ï¼åä¸ä¸ªå¿«ç§è¿æ²¡æåå®ï¼åä¸ä¸ªåå¼å§åäºï¼å®¹æé ææ¶æ§å¾ªç¯ã\n * å¦ä¸æ¹é¢ï¼bgsave å­è¿ç¨éè¦éè¿ fork æä½ä»ä¸»çº¿ç¨åå»ºåºæ¥ãè½ç¶ï¼å­è¿ç¨å¨åå»ºåä¸ä¼åé»å¡ä¸»çº¿ç¨ï¼ä½æ¯ï¼fork è¿ä¸ªåå»ºè¿ç¨æ¬èº«ä¼é»å¡ä¸»çº¿ç¨ï¼èä¸ä¸»çº¿ç¨çåå­è¶å¤§ï¼é»å¡æ¶é´è¶é¿ãå¦æé¢ç¹ fork åº bgsave å­è¿ç¨ï¼è¿å°±ä¼é¢ç¹é»å¡ä¸»çº¿ç¨äºï¼æä»¥ï¼å¨ redis ä¸­å¦ææä¸ä¸ª bgsave å¨è¿è¡ï¼å°±ä¸ä¼åå¯å¨ç¬¬äºä¸ª bgsave å­è¿ç¨ï¼ãé£ä¹ï¼æä»ä¹å¶ä»å¥½æ¹æ³åï¼\n\næ­¤æ¶ï¼æä»¬å¯ä»¥åå¢éå¿«ç§ï¼åäºä¸æ¬¡å¨éå¿«ç§åï¼åç»­çå¿«ç§åªå¯¹ä¿®æ¹çæ°æ®è¿è¡å¿«ç§è®°å½ï¼è¿æ ·å¯ä»¥é¿åæ¯æ¬¡å¨éå¿«ç§çå¼éã\n\nå¨ç¬¬ä¸æ¬¡åå®å¨éå¿«ç§åï¼t1 å t2 æ¶å»å¦æååå¿«ç§ï¼æä»¬åªéè¦å°è¢«ä¿®æ¹çæ°æ®åå¥å¿«ç§æä»¶å°±è¡ãä½æ¯ï¼è¿ä¹åçåææ¯ï¼æä»¬éè¦è®°ä½åªäºæ°æ®è¢«ä¿®æ¹äºãè¿ä¸ªâè®°ä½âéè¦æä»¬ä½¿ç¨é¢å¤çåæ°æ®ä¿¡æ¯å»è®°å½åªäºæ°æ®è¢«ä¿®æ¹äºï¼è¿ä¼å¸¦æ¥é¢å¤çç©ºé´å¼éé®é¢ãå¦ä¸å¾æç¤ºï¼\n\nå¦ææä»¬å¯¹æ¯ä¸ä¸ªé®å¼å¯¹çä¿®æ¹ï¼é½åä¸ªè®°å½ï¼é£ä¹ï¼å¦ææ 1 ä¸ä¸ªè¢«ä¿®æ¹çé®å¼å¯¹ï¼æä»¬å°±éè¦æ 1 ä¸æ¡é¢å¤çè®°å½ãèä¸ï¼æçæ¶åï¼é®å¼å¯¹éå¸¸å°ï¼æ¯å¦åªæ 32 å­èï¼èè®°å½å®è¢«ä¿®æ¹çåæ°æ®ä¿¡æ¯ï¼å¯è½å°±éè¦ 8 å­èï¼è¿æ ·çç»ï¼ä¸ºäºâè®°ä½âä¿®æ¹ï¼å¼å¥çé¢å¤ç©ºé´å¼éæ¯è¾å¤§ãè¿å¯¹äºåå­èµæºå®è´µç redis æ¥è¯´ï¼æäºå¾ä¸å¿å¤±ã\n\nå°è¿éï¼ä½ å¯ä»¥åç°ï¼rdb å¿«ç§è½ç¶è· aof ç¸æ¯ï¼å¿«ç§çæ¢å¤éåº¦å¿«ï¼ä½æ¯ï¼å¿«ç§çé¢çä¸å¥½ææ¡ï¼å¦æé¢çå¤ªä½ï¼ä¸¤æ¬¡å¿«ç§é´ä¸æ¦å®æºï¼å°±å¯è½ææ¯è¾å¤çæ°æ®ä¸¢å¤±ãå¦æé¢çå¤ªé«ï¼åä¼äº§çé¢å¤å¼éï¼é£ä¹ï¼è¿æä»ä¹æ¹æ³æ¢è½å©ç¨rdbçå¿«éæ¢å¤ï¼åè½ä»¥è¾å°çå¼éåå°å°½éå°ä¸¢æ°æ®å¢ï¼\n\nredis 4.0ä¸­æåºäºä¸ä¸ªæ··åä½¿ç¨aofæ¥å¿ååå­å¿«ç§çæ¹æ³ãç®åæ¥è¯´ï¼åå­å¿«ç§ä»¥ä¸å®çé¢çæ§è¡ï¼å¨ä¸¤æ¬¡å¿«ç§ä¹é´ï¼ä½¿ç¨ aof æ¥å¿è®°å½è¿æé´çææå½ä»¤æä½ã\n\nè¿æ ·ä¸æ¥ï¼å¿«ç§ä¸ç¨å¾é¢ç¹å°æ§è¡ï¼è¿å°±é¿åäºé¢ç¹ fork å¯¹ä¸»çº¿ç¨çå½±åãèä¸ï¼aof æ¥å¿ä¹åªç¨è®°å½ä¸¤æ¬¡å¿«ç§é´çæä½ï¼ä¹å°±æ¯è¯´ï¼ä¸éè¦è®°å½æææä½äºï¼å æ­¤ï¼å°±ä¸ä¼åºç°æä»¶è¿å¤§çæåµäºï¼ä¹å¯ä»¥é¿åéåå¼éã\n\nå¦ä¸å¾æç¤ºï¼t1åt2æ¶å»çä¿®æ¹ï¼ç¨aofæ¥å¿è®°å½ï¼ç­å°ç¬¬äºæ¬¡åå¨éå¿«ç§æ¶ï¼å°±å¯ä»¥æ¸ç©ºaofæ¥å¿ï¼å ä¸ºæ­¤æ¶çä¿®æ¹é½å·²ç»è®°å½å°å¿«ç§ä¸­äºï¼æ¢å¤æ¶å°±ä¸åç¨æ¥å¿äºã\n\nè¿ä¸ªæ¹æ³æ¢è½äº«åå° rdb æä»¶å¿«éæ¢å¤çå¥½å¤ï¼åè½äº«åå° aof åªè®°å½æä½å½ä»¤çç®åä¼å¿ï¼é¢æç¹âé±¼åçæå¯ä»¥å¼å¾âçæè§ï¼å»ºè®®ä½ å¨å®è·µä¸­ç¨èµ·æ¥ã\n\nð å¶å®æåè¿ä¸ªç»¼åçæ¹æ³æ²¡æä½¿ç¨å¢éå¿«ç§çåæ³ã\n\n\n# 2.5 å°ç»\n\nè¿ä¸å¤§èï¼ä»ç»äº redis ç¨äºé¿åæ°æ®ä¸¢å¤±ç rdb åå­å¿«ç§çæ¹æ³ï¼å®å¯ä»¥å¿«éæ¢å¤æ°æ®åºãéè¿ç´æ¥æ rdb æä»¶è¯»å¥åå­ï¼é¿å aof éè¦é¡ºåºãéä¸æ§è¡æä½å½ä»¤å¸¦æ¥çä½ææ§è½é®é¢ã\n\nredis è®¾è®¡ bgsave ååæ¶å¤å¶çæ¹å¼æ¥å°½å¯è½åå°äºåå­å¿«ç§å¯¹æ­£å¸¸è¯»åçå½±åã\n\nä½é¢ç¹å¿«ç§åæ¯ä¸å¯æ¥åçï¼äºæ¯åºç°äºæ··åä½¿ç¨ rdb å aof çæ¹å¼ï¼æ­£å¥½å¯ä»¥åä¸¤èä¹é¿ï¼é¿ä¸¤èä¹ç­ï¼ä»¥è¾å°çæ§è½å¼éä¿è¯æ°æ®å¯é æ§åæ§è½ã\n\næåï¼å³äº aof å rdb çéæ©é®é¢ï¼ææ³æä¸ç¹å»ºè®®ï¼\n\n * æ°æ®ä¸è½ä¸¢å¤±æ¶ï¼åå­å¿«ç§å aof çæ··åä½¿ç¨æ¯ä¸ä¸ªå¾å¥½çéæ©ï¼\n * å¦æåè®¸åéçº§å«çæ°æ®ä¸¢å¤±ï¼å¯ä»¥åªä½¿ç¨ rdbï¼\n * å¦æåªç¨ aofï¼ä¼åä½¿ç¨ everysec çéç½®éé¡¹ï¼å ä¸ºå®å¨å¯é æ§åæ§è½ä¹é´åäºä¸ä¸ªå¹³è¡¡ã\n\n----------------------------------------\n\næ¬èé®é¢ 1 ï¼ä½¿ç¨ä¸ä¸ª 2 æ ¸ cpuã4gb åå­ã500gb ç£ççäºä¸»æºè¿è¡ redisï¼redis æ°æ®åºçæ°æ®éå¤§å°å·®ä¸å¤æ¯ 2gbãå½æ¶ redisä¸»è¦ä»¥ä¿®æ¹æä½ä¸ºä¸»ï¼åè¯»æ¯ä¾å·®ä¸å¤å¨ 8:2 å·¦å³ï¼ä¹å°±æ¯è¯´ï¼å¦ææ 100 ä¸ªè¯·æ±ï¼80 ä¸ªè¯·æ±æ§è¡çæ¯ä¿®æ¹æä½ãå¨è¿ä¸ªåºæ¯ä¸ï¼ç¨ rdb åæä¹åæä»ä¹é£é©åï¼ï¼\n\nä»åå­èµæºåcpuèµæºä¸¤æ¹é¢åæé£é©ï¼\n\n 1. åå­ä¸è¶³çé£é©ï¼redis forkä¸ä¸ªbgsaveå­è¿ç¨è¿è¡rdbåå¥ï¼å¦æä¸»çº¿ç¨åæ¥æ¶å°åæä½ï¼å°±ä¼éç¨åæ¶å¤å¶ãåæ¶å¤å¶éè¦ç»åæä½çæ°æ®åéæ°çåå­ç©ºé´ãæ¬é®é¢ä¸­åçæ¯ä¾ä¸º80%ï¼é£ä¹ï¼å¨æä¹åè¿ç¨ä¸­ï¼ä¸ºäºä¿å­80%åæä½æ¶åçæ°æ®ï¼åæ¶å¤å¶æºå¶ä¼å¨å®ä¾åå­ä¸­ï¼ä¸ºè¿äºæ°æ®ååéæ°åå­ç©ºé´ï¼åéçåå­éç¸å½äºæ´ä¸ªå®ä¾æ°æ®éç80%ï¼å¤§çº¦æ¯1.6gbï¼è¿æ ·ä¸æ¥ï¼æ´ä¸ªç³»ç»åå­çä½¿ç¨éå°±æ¥è¿é¥±åäºãæ­¤æ¶ï¼å¦æå®ä¾è¿æå¤§éçæ°keyåå¥ækeyä¿®æ¹ï¼äºä¸»æºåå­å¾å¿«å°±ä¼è¢«ååãå¦æäºä¸»æºå¼å¯äºswapæºå¶ï¼å°±ä¼æä¸é¨åæ°æ®è¢«æ¢å°ç£çä¸ï¼å½è®¿é®ç£çä¸çè¿é¨åæ°æ®æ¶ï¼æ§è½ä¼æ¥å§ä¸éãå¦æäºä¸»æºæ²¡æå¼å¯swapï¼ä¼ç´æ¥è§¦åoomï¼æ´ä¸ªrediså®ä¾ä¼é¢ä¸´è¢«ç³»ç»killæçé£é©ã\n 2. ä¸»çº¿ç¨åå­è¿ç¨ç«äºä½¿ç¨cpuçé£é©ï¼çærdbçå­è¿ç¨éè¦cpuæ ¸è¿è¡ï¼ä¸»çº¿ç¨æ¬èº«ä¹éè¦cpuæ ¸è¿è¡ï¼èä¸ï¼å¦æredisè¿å¯ç¨äºåå°çº¿ç¨ï¼æ­¤æ¶ï¼ä¸»çº¿ç¨ãå­è¿ç¨ååå°çº¿ç¨é½ä¼ç«äºcpuèµæºãç±äºäºä¸»æºåªæ2æ ¸cpuï¼è¿å°±ä¼å½±åå°ä¸»çº¿ç¨å¤çè¯·æ±çéåº¦ã\n\næ¬èé®é¢ 2 ï¼åæ¶å¤å¶çåºå±å®ç°æºå¶ï¼ï¼\n\nåæ¶å¤å¶çææï¼bgsaveå­è¿ç¨ç¸å½äºå¤å¶äºåå§æ°æ®ï¼èä¸»çº¿ç¨ä»ç¶å¯ä»¥ä¿®æ¹åæ¥çæ°æ®ã\n\nå¯¹redisæ¥è¯´ï¼ä¸»çº¿ç¨forkåºbgsaveå­è¿ç¨åï¼bgsaveå­è¿ç¨å®éæ¯å¤å¶äºä¸»çº¿ç¨çé¡µè¡¨ãè¿äºé¡µè¡¨ä¸­ï¼å°±ä¿å­äºå¨æ§è¡bgsaveå½ä»¤æ¶ï¼ä¸»çº¿ç¨çæææ°æ®åå¨åå­ä¸­çç©çå°åãè¿æ ·ä¸æ¥ï¼bgsaveå­è¿ç¨çærdbæ¶ï¼å°±å¯ä»¥æ ¹æ®é¡µè¡¨è¯»åè¿äºæ°æ®ï¼ååå¥ç£çä¸­ãå¦ææ­¤æ¶ï¼ä¸»çº¿ç¨æ¥æ¶å°äºæ°åæä¿®æ¹æä½ï¼é£ä¹ï¼ä¸»çº¿ç¨ä¼ä½¿ç¨åæ¶å¤å¶æºå¶ãå·ä½æ¥è¯´ï¼åæ¶å¤å¶å°±æ¯æï¼ä¸»çº¿ç¨å¨æåæä½æ¶ï¼æä¼æè¿ä¸ªæ°åæä¿®æ¹åçæ°æ®åå¥å°ä¸ä¸ªæ°çç©çå°åä¸­ï¼å¹¶ä¿®æ¹èªå·±çé¡µè¡¨æ å°ã\n\nææ¥åå©ä¸å¾ä¸­çä¾å­ï¼å·ä½å±ç¤ºä¸ä¸åæ¶å¤å¶çåºå±æºå¶ã\n\nbgsaveå­è¿ç¨å¤å¶ä¸»çº¿ç¨çé¡µè¡¨ä»¥åï¼åå¦ä¸»çº¿ç¨éè¦ä¿®æ¹èé¡µ7éçæ°æ®ï¼é£ä¹ï¼ä¸»çº¿ç¨å°±éè¦æ°åéä¸ä¸ªç©çé¡µï¼åè®¾æ¯ç©çé¡µ53ï¼ï¼ç¶åæä¿®æ¹åçèé¡µ7éçæ°æ®åå°ç©çé¡µ53ä¸ï¼èèé¡µ7éåæ¥çæ°æ®ä»ç¶ä¿å­å¨ç©çé¡µ33ä¸ãè¿ä¸ªæ¶åï¼èé¡µ7å°ç©çé¡µ33çæ å°å³ç³»ï¼ä»ç¶ä¿çå¨bgsaveå­è¿ç¨ä¸­ãæä»¥ï¼bgsaveå­è¿ç¨å¯ä»¥æ è¯¯å°æèé¡µ7çåå§æ°æ®åå¥rdbæä»¶ã",charsets:{cjk:!0},lastUpdated:"2023/03/27, 09:21:08",lastUpdatedTimestamp:1679908868e3},{title:"ä¸»ä»å¤å¶ä¸å¨åµæºå¶",frontmatter:{title:"ä¸»ä»å¤å¶ä¸å¨åµæºå¶",date:"2023-03-25T22:21:29.000Z",permalink:"/pages/348567/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/06.%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B8%8E%E5%93%A8%E5%85%B5%E6%9C%BA%E5%88%B6.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/06.ä¸»ä»å¤å¶ä¸å¨åµæºå¶.md",key:"v-2778bd58",path:"/pages/348567/",headers:[{level:2,title:"1. æ°æ®åæ­¥ï¼ä¸»ä»åºå¦ä½å®ç°æ°æ®ä¸è´ï¼",slug:"_1-æ°æ®åæ­¥-ä¸»ä»åºå¦ä½å®ç°æ°æ®ä¸è´",normalizedTitle:"1. æ°æ®åæ­¥ï¼ä¸»ä»åºå¦ä½å®ç°æ°æ®ä¸è´ï¼",charIndex:598},{level:3,title:"1.1 ä¸»ä»åºé´å¦ä½è¿è¡ç¬¬ä¸æ¬¡åæ­¥ï¼",slug:"_1-1-ä¸»ä»åºé´å¦ä½è¿è¡ç¬¬ä¸æ¬¡åæ­¥",normalizedTitle:"1.1 ä¸»ä»åºé´å¦ä½è¿è¡ç¬¬ä¸æ¬¡åæ­¥ï¼",charIndex:706},{level:3,title:"1.2 ä¸»ä»çº§èæ¨¡å¼åæå¨éå¤å¶æ¶çä¸»åºåå",slug:"_1-2-ä¸»ä»çº§èæ¨¡å¼åæå¨éå¤å¶æ¶çä¸»åºåå",normalizedTitle:"1.2 ä¸»ä»çº§èæ¨¡å¼åæå¨éå¤å¶æ¶çä¸»åºåå",charIndex:1921},{level:3,title:"1.3 ä¸»ä»åºé´ç½ç»æ­äºæä¹åï¼",slug:"_1-3-ä¸»ä»åºé´ç½ç»æ­äºæä¹å",normalizedTitle:"1.3 ä¸»ä»åºé´ç½ç»æ­äºæä¹åï¼",charIndex:2620},{level:3,title:"1.4 å°ç»",slug:"_1-4-å°ç»",normalizedTitle:"1.4 å°ç»",charIndex:4261},{level:2,title:"2. å¨åµæºå¶ï¼ä¸»åºæäºï¼å¦ä½ä¸é´æ­æå¡ï¼",slug:"_2-å¨åµæºå¶-ä¸»åºæäº-å¦ä½ä¸é´æ­æå¡",normalizedTitle:"2. å¨åµæºå¶ï¼ä¸»åºæäºï¼å¦ä½ä¸é´æ­æå¡ï¼",charIndex:5416},{level:3,title:"2.1 å¨åµæºå¶çåºæ¬æµç¨",slug:"_2-1-å¨åµæºå¶çåºæ¬æµç¨",normalizedTitle:"2.1 å¨åµæºå¶çåºæ¬æµç¨",charIndex:5754},{level:3,title:"2.2 ä¸»è§ä¸çº¿åå®¢è§ä¸çº¿",slug:"_2-2-ä¸»è§ä¸çº¿åå®¢è§ä¸çº¿",normalizedTitle:"2.2 ä¸»è§ä¸çº¿åå®¢è§ä¸çº¿",charIndex:6396},{level:3,title:"2.3 å¦ä½éå®æ°ä¸»åºï¼",slug:"_2-3-å¦ä½éå®æ°ä¸»åº",normalizedTitle:"2.3 å¦ä½éå®æ°ä¸»åºï¼",charIndex:7260},{level:4,title:"2.3.1 ç­é",slug:"_2-3-1-ç­é",normalizedTitle:"2.3.1 ç­é",charIndex:7416},{level:4,title:"2.3.2 æå",slug:"_2-3-2-æå",normalizedTitle:"2.3.2 æå",charIndex:7775},{level:3,title:"2.4 å°ç»",slug:"_2-4-å°ç»",normalizedTitle:"2.4 å°ç»",charIndex:8502},{level:2,title:"3. å¨åµéç¾¤ï¼å¨åµæäºï¼ä¸»ä»åºè¿è½åæ¢åï¼",slug:"_3-å¨åµéç¾¤-å¨åµæäº-ä¸»ä»åºè¿è½åæ¢å",normalizedTitle:"3. å¨åµéç¾¤ï¼å¨åµæäºï¼ä¸»ä»åºè¿è½åæ¢åï¼",charIndex:9170},{level:3,title:"3.1 åºäº pub/sub æºå¶çå¨åµéç¾¤ç»æ",slug:"_3-1-åºäº-pub-sub-æºå¶çå¨åµéç¾¤ç»æ",normalizedTitle:"3.1 åºäº pub/sub æºå¶çå¨åµéç¾¤ç»æ",charIndex:9526},{level:3,title:"3.2 åºäº pub/sub æºå¶çå®¢æ·ç«¯äºä»¶éç¥",slug:"_3-2-åºäº-pub-sub-æºå¶çå®¢æ·ç«¯äºä»¶éç¥",normalizedTitle:"3.2 åºäº pub/sub æºå¶çå®¢æ·ç«¯äºä»¶éç¥",charIndex:10528},{level:3,title:"3.3 ç±åªä¸ªå¨åµæ§è¡ä¸»ä»åæ¢ï¼",slug:"_3-3-ç±åªä¸ªå¨åµæ§è¡ä¸»ä»åæ¢",normalizedTitle:"3.3 ç±åªä¸ªå¨åµæ§è¡ä¸»ä»åæ¢ï¼",charIndex:11321},{level:3,title:"3.4 å°ç»",slug:"_3-4-å°ç»",normalizedTitle:"3.4 å°ç»",charIndex:12208}],headersStr:"1. æ°æ®åæ­¥ï¼ä¸»ä»åºå¦ä½å®ç°æ°æ®ä¸è´ï¼ 1.1 ä¸»ä»åºé´å¦ä½è¿è¡ç¬¬ä¸æ¬¡åæ­¥ï¼ 1.2 ä¸»ä»çº§èæ¨¡å¼åæå¨éå¤å¶æ¶çä¸»åºåå 1.3 ä¸»ä»åºé´ç½ç»æ­äºæä¹åï¼ 1.4 å°ç» 2. å¨åµæºå¶ï¼ä¸»åºæäºï¼å¦ä½ä¸é´æ­æå¡ï¼ 2.1 å¨åµæºå¶çåºæ¬æµç¨ 2.2 ä¸»è§ä¸çº¿åå®¢è§ä¸çº¿ 2.3 å¦ä½éå®æ°ä¸»åºï¼ 2.3.1 ç­é 2.3.2 æå 2.4 å°ç» 3. å¨åµéç¾¤ï¼å¨åµæäºï¼ä¸»ä»åºè¿è½åæ¢åï¼ 3.1 åºäº pub/sub æºå¶çå¨åµéç¾¤ç»æ 3.2 åºäº pub/sub æºå¶çå®¢æ·ç«¯äºä»¶éç¥ 3.3 ç±åªä¸ªå¨åµæ§è¡ä¸»ä»åæ¢ï¼ 3.4 å°ç»",content:"> åèï¼\n> \n>  * 06 æ°æ®åæ­¥ï¼ä¸»ä»åºå¦ä½å®ç°æ°æ®ä¸è´ï¼| æå®¢æ¶é´(opens new window)\n>  * 07 å¨åµæºå¶ï¼ä¸»åºæäºï¼å¦ä½ä¸é´æ­æå¡ï¼| æå®¢æ¶é´(opens new window)\n>  * 08 å¨åµéç¾¤ï¼å¨åµæäºï¼ä¸»ä»åºè¿è½åæ¢åï¼| æå®¢æ¶é´\n\næä»¬ä½¿ç¨ AOF å RDBï¼ä¿è¯å°½éå°ä¸¢å¤±æ°æ®ï¼æåå¯é æ§ãä½ä¾ç¶å­å¨ä¸å¯ç¨é®é¢ã\n\nåè®¾æä»¬ç Redis åªæä¸ä¸ªå®ä¾ï¼é£ä¹å½è¿ä¸ªå®ä¾å®æºï¼é£å°±æ æ³ç»§ç»­æä¾æå¡äºãæä»¬æ»è¯´ Redis å·æé«å¯é æ§ï¼å¶å®æä¸¤å±å«ä¹ï¼\n\n * ä¸æ¯æ°æ®å°½éå°ä¸¢å¤±ã\n * äºæ¯æå¡å°½éå°ä¸­æ­ã\n\nAOF å RDB ä¿è¯äºåèï¼èå¯¹äºåèï¼Redis çåæ³å°±æ¯å¢å å¯æ¬åä½éï¼è¿æ ·å½ä¸ä¸ªå®ä¾åºç°æéåï¼å¶ä»å®ä¾å¯ä»¥ç»§ç»­æä¾æå¡ã\n\nRedis ä½¿ç¨äºä¸»ä»å¤å¶çæ¨¡å¼æ¥åæ°æ®å¤å¶ï¼ä¸»ä»åºä¹é´éç¨çæ¯âè¯»ååç¦»âçæ¹å¼ï¼\n\n * è¯»æä½ï¼ä¸»åºãä»åºé½å¯ä»¥æ¥æ¶ï¼\n * åæä½ï¼é¦åå°ä¸»åºæ§è¡ï¼ç¶åï¼ä¸»åºå°åæä½åæ­¥ç»ä»åºã\n\nä¸»ä»å¤å¶çæ¨¡å¼å°±é¢ä¸´ DDIA æ°æ®å¤å¶ ä¸­æè®¨è®ºçä¸ç³»åé®é¢ãä¸é¢æä»¬å¯¹ Redis å¨è¯¥æ¨¡å¼ä¸çå®è·µè¿è¡è®¨è®ºã\n\nä¸»ä»åºåæ­¥æ¯å¦ä½å®æçå¢ï¼ä¸»åºæ°æ®æ¯ä¸æ¬¡æ§ä¼ ç»ä»åºï¼è¿æ¯åæ¹åæ­¥ï¼è¦æ¯ä¸»ä»åºé´çç½ç»æ­è¿äºï¼æ°æ®è¿è½ä¿æä¸è´åï¼ä¸é¢èèä¸»ä»åºåæ­¥çåçï¼ä»¥ååºå¯¹ç½ç»æ­è¿é£é©çæ¹æ¡ã\n\n\n# 1. æ°æ®åæ­¥ï¼ä¸»ä»åºå¦ä½å®ç°æ°æ®ä¸è´ï¼\n\nè¿ä¸å¤§èä¸»è¦è®¨è®ºä¸»ä»åºåæ­¥çåçï¼ä»¥ååºå¯¹ç½ç»æ­è¿é£é©çæ¹æ¡ã\n\né¦åçä¸ä¸ä¸»ä»åºé´çç¬¬ä¸æ¬¡åæ­¥æ¯å¦ä½è¿è¡çï¼è¿ä¹æ¯ Redis å®ä¾å»ºç«ä¸»ä»åºæ¨¡å¼åçè§å®å¨ä½ã\n\n\n# 1.1 ä¸»ä»åºé´å¦ä½è¿è¡ç¬¬ä¸æ¬¡åæ­¥ï¼\n\nå½æä»¬å¯å¨å¤ä¸ª Redis å®ä¾çæ¶åï¼å®ä»¬ç¸äºä¹é´å°±å¯ä»¥éè¿ replicaofï¼Redis 5.0 ä¹åä½¿ç¨ slaveofï¼å½ä»¤å½¢æä¸»åºåä»åºçå³ç³»ï¼ä¹åä¼æç§ä¸ä¸ªé¶æ®µå®ææ°æ®çç¬¬ä¸æ¬¡åæ­¥ã\n\nä¾å¦ï¼ç°å¨æå®ä¾1ï¼ipï¼172.16.19.3ï¼åå®ä¾2ï¼ipï¼172.16.19.5ï¼ï¼æä»¬å¨å®ä¾2ä¸æ§è¡ä»¥ä¸è¿ä¸ªå½ä»¤åï¼å®ä¾2å°±åæäºå®ä¾1çä»åºï¼å¹¶ä»å®ä¾1ä¸å¤å¶æ°æ®ï¼\n\nreplicaof  172.16.19.3  6379\n\n\n1\n\n\næ¥ä¸æ¥ï¼æä»¬å°±è¦å­¦ä¹ ä¸»ä»åºé´æ°æ®ç¬¬ä¸æ¬¡åæ­¥çä¸ä¸ªé¶æ®µäºï¼\n\nç¬¬ä¸é¶æ®µæ¯ä¸»ä»åºé´å»ºç«è¿æ¥ãåååæ­¥çè¿ç¨ï¼ä¸»è¦æ¯ä¸ºå¨éå¤å¶ååå¤ãå¨è¿ä¸æ­¥ï¼ä»åºåä¸»åºå»ºç«èµ·è¿æ¥ï¼å¹¶åè¯ä¸»åºå³å°è¿è¡åæ­¥ï¼ä¸»åºç¡®è®¤åå¤åï¼ä¸»ä»åºé´å°±å¯ä»¥å¼å§åæ­¥äºã\n\nå·ä½æ¥è¯´ï¼ä»åºç»ä¸»åºåé psync å½ä»¤ï¼è¡¨ç¤ºè¦è¿è¡æ°æ®åæ­¥ï¼ä¸»åºæ ¹æ®è¿ä¸ªå½ä»¤çåæ°æ¥å¯å¨å¤å¶ãpsyncå½ä»¤åå«äºä¸»åºç runIDåå¤å¶è¿åº¦ offset ä¸¤ä¸ªåæ°ï¼\n\n * runIDï¼æ¯æ¯ä¸ª Redis å®ä¾å¯å¨æ¶é½ä¼èªå¨çæçä¸ä¸ªéæº IDï¼ç¨æ¥å¯ä¸æ è®°è¿ä¸ªå®ä¾ãå½ä»åºåä¸»åºç¬¬ä¸æ¬¡å¤å¶æ¶ï¼å ä¸ºä¸ç¥éä¸»åºç runIDï¼æä»¥å°runIDè®¾ä¸ºâ?âã\n * offsetï¼æ­¤æ¶è®¾ä¸º -1ï¼è¡¨ç¤ºç¬¬ä¸æ¬¡å¤å¶ã\n\nä¸»åºæ¶å° psync å½ä»¤åï¼ä¼ç¨ FULLRESYNC ååºå½ä»¤å¸¦ä¸ä¸¤ä¸ªåæ°ï¼ä¸»åº runID åä¸»åºç®åçå¤å¶è¿åº¦ offsetï¼è¿åç»ä»åºãä»åºæ¶å°ååºåï¼ä¼è®°å½ä¸è¿ä¸¤ä¸ªåæ°ã\n\nè¿éæä¸ªå°æ¹éè¦æ³¨æï¼FULLRESYNC ååºè¡¨ç¤ºç¬¬ä¸æ¬¡å¤å¶éç¨çå¨éå¤å¶ï¼ä¹å°±æ¯è¯´ï¼ä¸»åºä¼æå½åææçæ°æ®é½å¤å¶ç»ä»åºã\n\nå¨ç¬¬äºé¶æ®µï¼ä¸»åºå°æææ°æ®åæ­¥ç»ä»åºãä»åºæ¶å°æ°æ®åï¼å¨æ¬å°å®ææ°æ®å è½½ãè¿ä¸ªè¿ç¨ä¾èµäºåå­å¿«ç§çæç RDB æä»¶ã\n\nå·ä½æ¥è¯´ï¼ä¸»åºæ§è¡ bgsave å½ä»¤ï¼çæ RDB æä»¶ï¼æ¥çå°æä»¶åç»ä»åºãä»åºæ¥æ¶å° RDB æä»¶åï¼ä¼åæ¸ç©ºå½åæ°æ®åºï¼ç¶åå è½½ RDB æä»¶ãè¿æ¯å ä¸ºä»åºå¨éè¿ replicaof å½ä»¤å¼å§åä¸»åºåæ­¥åï¼å¯è½ä¿å­äºå¶ä»æ°æ®ãä¸ºäºé¿åä¹åæ°æ®çå½±åï¼ä»åºéè¦åæå½åæ°æ®åºæ¸ç©ºã\n\nå¨ä¸»åºå°æ°æ®åæ­¥ç»ä»åºçè¿ç¨ä¸­ï¼ä¸»åºä¸ä¼è¢«é»å¡ï¼ä»ç¶å¯ä»¥æ­£å¸¸æ¥æ¶è¯·æ±ãå¦åï¼Redis çæå¡å°±è¢«ä¸­æ­äºãä½æ¯ï¼è¿äºè¯·æ±ä¸­çåæä½å¹¶æ²¡æè®°å½å°ååçæç RDB æä»¶ä¸­ãä¸ºäºä¿è¯ä¸»ä»åºçæ°æ®ä¸è´æ§ï¼ä¸»åºä¼å¨åå­ä¸­ç¨ä¸é¨ç replication bufferï¼è®°å½ RDB æä»¶çæåæ¶å°çææåæä½ã\n\næåï¼ä¹å°±æ¯ç¬¬ä¸é¶æ®µï¼ä¸»åºä¼æç¬¬äºé¶æ®µæ§è¡è¿ç¨ä¸­æ°æ¶å°çåå½ä»¤ï¼ååéç»ä»åºãå·ä½çæä½æ¯ï¼å½ä¸»åºå®æ RDB æä»¶åéåï¼å°±ä¼ææ­¤æ¶ replication buffer ä¸­çä¿®æ¹æä½åç»ä»åºï¼ä»åºåéæ°æ§è¡è¿äºæä½ãè¿æ ·ä¸æ¥ï¼ä¸»ä»åºå°±å®ç°åæ­¥äºã\n\n\n# 1.2 ä¸»ä»çº§èæ¨¡å¼åæå¨éå¤å¶æ¶çä¸»åºåå\n\nå¨ä¸»ä»åæ­¥æ¶ï¼å¨éå¤å¶çé¶æ®µéè¦ä¸»åºå®æä¸¤ä¸ªèæ¶çæä½ï¼çæ RDB åä¼ è¾ RDBã\n\nè¥ä»åºæ°éå¾å¤ä¸é½éè¦è¿è¡å¨éå¤å¶ï¼ä¼è®©ä¸»åºå¿äº fork å­è¿ç¨çæ RDBï¼å¯¼è´ä¸»åºååºè¯·æ±éåº¦åæ¢ãåæ¶ä¼ è¾ RDB ä¹éè¦å ç¨ä¸»åºçå¸¦å®½ãé£ä¹ï¼ææ²¡æå¥½çè§£å³æ¹æ³æ¥åæä¸»åºååå¢ï¼è¿å°±æ¯âä¸»-ä»-ä»âæ¨¡å¼ã\n\nååä»ç»çä¸»ä»æ¨¡å¼ä¸­ï¼ææçä»åºé½æ¯ä»ä¸»åºåæ­¥èæ¥çï¼ç°å¨æä»¬å¯ä»¥éè¿âä¸»-ä»-ä»âçæ¨¡å¼å°ä¸»åºçæç RDB åä¼ è¾ RDB çååä»¥çº§èçæ¹å¼åæ£å°ä»åºä¸ã\n\nç®åæ¥è¯´ï¼æä»¬å¨é¨ç½²ä¸»ä»éç¾¤çæ¶åï¼å¯ä»¥æå¨éæ©ä¸ä¸ªä»åºï¼æ¯å¦éæ©åå­èµæºéç½®è¾é«çä»åºï¼ï¼ç¨äºçº§èå¶ä»çä»åºãç¶åï¼æä»¬å¯ä»¥åéæ©ä¸äºä»åºï¼ä¾å¦ä¸åä¹ä¸çä»åºï¼ï¼å¨è¿äºä»åºä¸æ§è¡å¦ä¸å½ä»¤ï¼è®©å®ä»¬ååææéçä»åºï¼å»ºç«èµ·ä¸»ä»å³ç³»ï¼\n\nreplicaof  æéä»åºçIP 6379\n\n\n1\n\n\nè¿æ ·ä¸æ¥ï¼è¿äºä»åºå°±ä¼ç¥éï¼å¨è¿è¡åæ­¥æ¶ï¼ä¸ç¨ååä¸»åºè¿è¡äº¤äºäºï¼åªè¦åçº§èçä»åºè¿è¡åæä½åæ­¥å°±è¡äºï¼è¿å°±å¯ä»¥åè½»ä¸»åºä¸çååï¼å¦ä¸å¾æç¤ºï¼\n\nä»¥ä¸å°±æ¯âä¸»-ä»-ä»âæ¨¡å¼çåæ­¥ãä¸æ¦ä¸»ä»åºå®æäºå¨éå¤å¶ï¼å®ä»¬ä¹é´å°±ä¼ä¸ç´ç»´æ¤ä¸ä¸ªç½ç»è¿æ¥ï¼ä¸»åºä¼éè¿è¿ä¸ªè¿æ¥å°åç»­éç»­æ¶å°çå½ä»¤æä½ååæ­¥ç»ä»åºï¼è¿ä¸ªè¿ç¨ä¹ç§°ä¸ºåºäºé¿è¿æ¥çå½ä»¤ä¼ æ­ï¼å¯ä»¥é¿åé¢ç¹å»ºç«è¿æ¥çå¼éã\n\nè¿ä¸ªæ°æ®åæ­¥çè¿ç¨å­å¨ä¸ä¸ªé£é©ç¹ï¼ç½ç»æ­è¿æé»å¡ãå¦æç½ç»æ­è¿ï¼ä¸»ä»åºä¹é´å°±æ æ³è¿è¡å½ä»¤ä¼ æ­äºï¼ä»åºçæ°æ®èªç¶ä¹å°±æ²¡åæ³åä¸»åºä¿æä¸è´äºï¼å®¢æ·ç«¯å°±å¯è½ä»ä»åºè¯»å°æ§æ°æ®ãæ¥ä¸æ¥ï¼æä»¬å°±æ¥èèç½ç»æ­è¿åçè§£å³åæ³.\n\n\n# 1.3 ä¸»ä»åºé´ç½ç»æ­äºæä¹åï¼\n\nå¨ Redis 2.8 ä¹åï¼å¦æä¸»ä»åºå¨å½ä»¤ä¼ æ­æ¶åºç°äºç½ç»éªæ­ï¼é£ä¹ï¼ä»åºå°±ä¼åä¸»åºéæ°è¿è¡ä¸æ¬¡å¨éå¤å¶ï¼å¼ééå¸¸å¤§ã\n\nä» Redis 2.8 å¼å§ï¼ç½ç»æ­äºä¹åï¼ä¸»ä»åºä¼éç¨å¢éå¤å¶çæ¹å¼ç»§ç»­åæ­¥ãä¹å°±æ¯åªä¼æç½ç»æ­è¿æé´ä¸»åºæ¶å°çå½ä»¤ï¼åæ­¥ç»ä»åºã\n\né£ä¹ï¼å¢éå¤å¶æ¶ï¼ä¸»ä»åºä¹é´å·ä½æ¯æä¹ä¿æåæ­¥çå¢ï¼è¿éçå¥¥å¦å°±å¨äº repl_backlog_buffer è¿ä¸ªç¼å²åºãæä»¬åæ¥çä¸å®æ¯å¦ä½ç¨äºå¢éå½ä»¤çåæ­¥çã\n\nå½ä¸»ä»åºæ­è¿åï¼ä¸»åºä¼ææ­è¿æé´æ¶å°çåæä½å½ä»¤ï¼åå¥ replication buffer ï¼åæ¶ä¹ä¼æè¿äºæä½å½ä»¤ä¹åå¥ repl_backlog_buffer è¿ä¸ªç¼å²åºãrepl_backlog_buffer æ¯ä¸ä¸ªç¯å½¢ç¼å²åºï¼ä¸»åºä¼è®°å½èªå·±åå°çä½ç½®ï¼ä»åºåä¼è®°å½èªå·±å·²ç»è¯»å°çä½ç½®ã\n\nåå¼å§çæ¶åï¼ä¸»åºåä»åºçåè¯»ä½ç½®å¨ä¸èµ·ï¼è¿ç®æ¯å®ä»¬çèµ·å§ä½ç½®ãéçä¸»åºä¸æ­æ¥æ¶æ°çåæä½ï¼å®å¨ç¼å²åºä¸­çåä½ç½®ä¼éæ­¥åç¦»èµ·å§ä½ç½®ï¼æä»¬éå¸¸ç¨åç§»éæ¥è¡¡éè¿ä¸ªåç§»è·ç¦»çå¤§å°ï¼å¯¹ä¸»åºæ¥è¯´ï¼å¯¹åºçåç§»éå°±æ¯ master_repl_offsetãä¸»åºæ¥æ¶çæ°åæä½è¶å¤ï¼è¿ä¸ªå¼å°±ä¼è¶å¤§ãåæ ·ï¼ä»åºå¨å¤å¶å®åæä½å½ä»¤åï¼å®å¨ç¼å²åºä¸­çè¯»ä½ç½®ä¹å¼å§éæ­¥åç§»åæçèµ·å§ä½ç½®ï¼æ­¤æ¶ï¼ä»åºå·²å¤å¶çåç§»é slave_repl_offset ä¹å¨ä¸æ­å¢å ãæ­£å¸¸æåµä¸ï¼è¿ä¸¤ä¸ªåç§»éåºæ¬ç¸ç­ã\n\nä¸»ä»åºçè¿æ¥æ¢å¤ä¹åï¼ä»åºé¦åä¼ç»ä¸»åºåé psync å½ä»¤ï¼å¹¶æèªå·±å½åç slave_repl_offset åç»ä¸»åºï¼ä¸»åºä¼å¤æ­èªå·±ç master_repl_offset å slave_repl_offset ä¹é´çå·®è·ãå¨ç½ç»æ­è¿é¶æ®µï¼ä¸»åºå¯è½ä¼æ¶å°æ°çåæä½å½ä»¤ï¼æä»¥ï¼ä¸è¬æ¥è¯´ï¼master_repl_offset ä¼å¤§äº slave_repl_offsetãæ­¤æ¶ï¼ä¸»åºåªç¨æ master_repl_offset å slave_repl_offset ä¹é´çå½ä»¤æä½åæ­¥ç»ä»åºå°±è¡ã\n\nå°±åååç¤ºæå¾çä¸­é´é¨åï¼ä¸»åºåä»åºä¹é´ç¸å·®äº put d e å put d f ä¸¤ä¸ªæä½ï¼å¨å¢éå¤å¶æ¶ï¼ä¸»åºåªéè¦æå®ä»¬åæ­¥ç»ä»åºå°±è¡äºã\n\nè¯´å°è¿éï¼æä»¬ååå©ä¸å¼ å¾ï¼åé¡¾ä¸å¢éå¤å¶çæµç¨ï¼\n\nä¸è¿ç±äº repl_backlog_buffer æ¯ä¸ä¸ªç¯å½¢ç¼å²åºï¼æä»¥å¨ç¼å²åºåæ»¡åï¼ä¸»åºä¼ç»§ç»­åå¥ï¼æ­¤æ¶ï¼å°±ä¼è¦çæä¹ååå¥çæä½ãå¦æä»åºçè¯»åéåº¦æ¯è¾æ¢ï¼å°±æå¯è½å¯¼è´ä»åºè¿æªè¯»åçæä½è¢«ä¸»åºæ°åçæä½è¦çäºï¼è¿ä¼å¯¼è´ä¸»ä»åºé´çæ°æ®ä¸ä¸è´ãå æ­¤ï¼æä»¬è¦æ³åæ³é¿åè¿ä¸æåµï¼ä¸è¬èè¨ï¼æä»¬å¯ä»¥è°æ´ repl_backlog_size è¿ä¸ªåæ°ãè¿ä¸ªåæ°åæéçç¼å²ç©ºé´å¤§å°æå³ï¼ç¼å²ç©ºé´å¤§å° = ä¸»åºåå¥å½ä»¤éåº¦ * æä½å¤§å° - ä¸»ä»åºé´ç½ç»ä¼ è¾å½ä»¤éåº¦ * æä½å¤§å°ãå¨å®éåºç¨ä¸­ï¼èèå°å¯è½å­å¨ä¸äºçªåçè¯·æ±ååï¼æä»¬éå¸¸éè¦æè¿ä¸ªç¼å²ç©ºé´æ©å¤§ä¸åï¼å³ repl_backlog_size = ç¼å²ç©ºé´å¤§å° * 2ï¼è¿ä¹å°±æ¯ repl_backlog_size çæç»å¼ã\n\n> ä¸¾ä¸ªä¾å­ï¼å¦æä¸»åºæ¯ç§åå¥ 2000 ä¸ªæä½ï¼æ¯ä¸ªæä½çå¤§å°ä¸º 2KBï¼ç½ç»æ¯ç§è½ä¼ è¾ 1000 ä¸ªæä½ï¼é£ä¹ï¼æ 1000 ä¸ªæä½éè¦ç¼å²èµ·æ¥ï¼è¿å°±è³å°éè¦ 2MB çç¼å²ç©ºé´ãå¦åï¼æ°åçå½ä»¤å°±ä¼è¦çææ§æä½äºãä¸ºäºåºå¯¹å¯è½ççªåååï¼æä»¬æç»æ repl_backlog_size è®¾ä¸º 4MBã\n\nè¿æ ·ä¸æ¥ï¼å¢éå¤å¶æ¶ä¸»ä»åºçæ°æ®ä¸ä¸è´é£é©å°±éä½äºãä¸è¿ï¼å¦æå¹¶åè¯·æ±ééå¸¸å¤§ï¼è¿ä¸¤åçç¼å²ç©ºé´é½å­ä¸ä¸æ°æä½è¯·æ±çè¯ï¼æ­¤æ¶ï¼ä¸»ä»åºæ°æ®ä»ç¶å¯è½ä¸ä¸è´ãéå¯¹è¿ç§æåµï¼\n\n * ä¸æ¹é¢ï¼æ ¹æ®æå¡å¨çèµæºç»§ç»­éå½å¢å  repl_backlog_size å¼ã\n * ä¸æ¹é¢ï¼å¯ä»¥èèä½¿ç¨åçéç¾¤æ¥åæåä¸ªä¸»åºçè¯·æ±ååãï¼åé¢ä¼è®²ï¼\n\n\n# 1.4 å°ç»\n\nè¿ä¸èä¸»è¦è®²äº Redis ä¸»ä»åæ­¥çä¸ç§æ¨¡å¼ï¼\n\n 1. å¨éå¤å¶ï¼ç¬¬ä¸æ¬¡åæ­¥ä¸å¯é¿åï¼èæ¶ãä¸ºåå°ä¸»åºçåæ­¥ååï¼å¼å¥äºâä¸»-ä»-ä»âççº§èæ¨¡å¼ã\n    \n    ð¡ å°å»ºè®®: ä¸ä¸ªRediså®ä¾çæ°æ®åºä¸è¦å¤ªå¤§ï¼ä¸ä¸ªå®ä¾å¤§å°å¨å GBçº§å«æ¯è¾åéï¼è¿æ ·å¯ä»¥åå°RDBæä»¶çæãä¼ è¾åéæ°å è½½çå¼éã\n\n 2. é¿è¿æ¥å¤å¶ï¼æ¯ä¸»ä»åºæ­£å¸¸è¿è¡åçå¸¸è§åæ­¥é¶æ®µï¼ä¸»ä»ä¹é´éè¿å½ä»¤ä¼ æ­å®ç°åæ­¥ã\n\n 3. å¢éå¤å¶ï¼åçç½ç»æ­è¿åï¼å°±éè¦å¢éå¤å¶æ¥ä¿è¯æ°æ®çåæ­¥ã\n    \n    éè¿è°å¤§ repl_backlog_size è¿ä¸ªåæ°ï¼å¯ä»¥åå°ä»åºå¨ç½ç»æ­è¿æ¶å¨éå¤å¶çé£é©ã\n\nä¸è¿ï¼ä¸»ä»æ¨¡å¼é¢ä¸´ä¸»åºæéçæ½å¨é£é©ï¼ä¸é¢å°èèä¸»åºæéåï¼ä¿è¯æå¡å¯é æ§çè§£å³æ¹æ¡ã\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼AOFè®°å½çæä½å½ä»¤æ´å¨ï¼ç¸æ¯äºRDBä¸¢å¤±çæ°æ®æ´å°ãä¸ºä»ä¹ä¸»ä»åºé´çå¤å¶ä¸ä½¿ç¨ AOFï¼\n\næä¸¤ä¸ªåå ï¼\n\n 1. RDB æä»¶æ¯äºè¿å¶æä»¶ï¼æ è®ºæ¯è¦æ RDB åå¥ç£çï¼è¿æ¯è¦éè¿ç½ç»ä¼ è¾ RDBï¼IO æçé½æ¯è®°å½åä¼ è¾ AOF çé«ã\n 2. å¨ä»åºç«¯è¿è¡æ¢å¤æ¶ï¼ç¨ RDB çæ¢å¤æçè¦é«äºç¨ AOFã\n\næ¬èé®é¢ 2ï¼replication buffer å repl_backlog_buffer çåºå«ï¼\n\næ»çæ¥è¯´ï¼replication buffer æ¯ä¸»ä»åºå¨è¿è¡å¨éå¤å¶æ¶ï¼ä¸»åºä¸ç¨äºåä»åºè¿æ¥çå®¢æ·ç«¯ç bufferï¼è repl_backlog_buffer æ¯ä¸ºäºæ¯æä»åºå¢éå¤å¶ï¼ä¸»åºä¸ç¨äºæç»­ä¿å­åæä½çä¸åä¸ç¨ bufferã\n\nRedisä¸»ä»åºå¨è¿è¡å¤å¶æ¶ï¼å½ä¸»åºè¦æå¨éå¤å¶æé´çåæä½å½ä»¤åç»ä»åºæ¶ï¼ä¸»åºçæä½ï¼\n\n * ååå»ºä¸ä¸ªå®¢æ·ç«¯ï¼ç¨æ¥è¿æ¥ä»åº\n * éè¿è¿ä¸ªå®¢æ·ç«¯ï¼æåæä½å½ä»¤åç»ä»åº\n\nå¨åå­ä¸­ï¼ä¸»åºä¸çå®¢æ·ç«¯å°±ä¼å¯¹åºä¸ä¸ª bufferï¼è¿ä¸ª buffer å°±è¢«ç§°ä¸º replication bufferãRediséè¿ client_buffer éç½®é¡¹æ¥æ§å¶è¿ä¸ª buffer çå¤§å°ãä¸»åºä¼ç»æ¯ä¸ªä»åºå»ºç«ä¸ä¸ªå®¢æ·ç«¯ï¼æä»¥ replication buffer ä¸æ¯å±äº«çï¼èæ¯æ¯ä¸ªä»åºé½æä¸ä¸ªå¯¹åºçå®¢æ·ç«¯ã\n\nrepl_backlog_buffer æ¯ä¸åä¸ç¨ bufferï¼å¨ Redis æå¡å¨å¯å¨åï¼å¼å§ä¸ç´æ¥æ¶åæä½å½ä»¤ï¼æä»¥ repl_backlog_buffer æ¯ææä»åºå±äº«çãä¸»åºåä»åºä¼åèªè®°å½èªå·±çå¤å¶è¿åº¦ï¼æä»¥ï¼ä¸åçä»åºå¨è¿è¡æ¢å¤æ¶ï¼ä¼æèªå·±çå¤å¶è¿åº¦ï¼slave_repl_offsetï¼åç»ä¸»åºï¼ä¸»åºå°±å¯ä»¥åå®ç¬ç«åæ­¥ã\n\n\n# 2. å¨åµæºå¶ï¼ä¸»åºæäºï¼å¦ä½ä¸é´æ­æå¡ï¼\n\nä¸èå­¦ä¹ äºä¸»ä»åºçéç¾¤æ¨¡å¼ï¼å¨è¿ä¸ªæ¨¡å¼ä¸ï¼å¦æä»åºåçæéäºï¼å®¢æ·ç«¯å¯ä»¥ç»§ç»­åä¸»åºæå¶ä»ä»åºåéè¯·æ±ï¼ä½æ¯å¦æä¸»åºåçæéäºï¼ä»åºå°±æ²¡æä¸»åºå¯ä»¥è¿è¡æ°æ®å¤å¶äºãå¦æè¯·æ±æ¯åªè¯»çè¯è¿å¥½ï¼ä½å¦ææåè¯·æ±ï¼é£ä¹æ­¤æ¶å°±æ²¡æå®ä¾å¯ä»¥å®æè¿ä¸ªæä½äºãè¿ç§æåµæ¯ä¸å¯æ¥åçã\n\næä»¥ï¼å¦æä¸»åºæäºï¼æä»¬å°±éè¦è¿è¡ä¸ä¸ªæ°ä¸»åºï¼æ¯å¦è¯´æä¸ä¸ªä»åºåæ¢ä¸ºä¸»åºï¼ä½è¿å°±æ¶åå°ä¸ä¸ªé®é¢ï¼\n\n 1. ä¸»åºççæäºåï¼\n 2. è¯¥éæ©åªä¸ªä»åºä½ä¸ºä¸»åºï¼\n 3. æä¹ææ°ä¸»åºçç¸å³ä¿¡æ¯éç¥ç»ä»åºåå®¢æ·ç«¯å¢ï¼\n\nè¿å°±è¦æå°å¨åµæºå¶äºãå¨ Redis ä¸»ä»éç¾¤ä¸­ï¼å¨åµæºå¶æ¯å®ç°ä¸»ä»åºèªå¨åæ¢çå³é®æºå¶ï¼å®ææå°è§£å³äºä¸»ä»å¤å¶æ¨¡å¼ä¸æéè½¬ç§»çè¿ä¸ä¸ªé®é¢ã\n\n\n# 2.1 å¨åµæºå¶çåºæ¬æµç¨\n\nå¨åµå¶å®å°±æ¯ä¸ä¸ªè¿è¡å¨ç¹æ®æ¨¡å¼ä¸ç Redis è¿ç¨ï¼ä¸»ä»åºå®ä¾è¿è¡çåæ¶ï¼å®ä¹å¨è¿è¡ãå¨åµä¸»è¦è´è´£çå°±æ¯ä¸ä¸ªä»»å¡ï¼çæ§ãéä¸»ï¼éæ©ä¸»åºï¼åéç¥ã\n\n * çæ§æ¯æå¨åµè¿ç¨å¨è¿è¡æ¶ï¼å¨ææ§å°ç»ææçä¸»ä»åºåé PING å½ä»¤ï¼æ£æµå®ä»¬æ¯å¦ä»ç¶å¨çº¿è¿è¡ãå¦æä»åºæ²¡æå¨è§å®æ¶é´åååºå¨åµçPINGå½ä»¤ï¼å¨åµå°±ä¼æå®æ è®°ä¸ºâä¸çº¿ç¶æâï¼åæ ·ï¼å¦æä¸»åºä¹æ²¡æå¨è§å®æ¶é´åååºå¨åµçPINGå½ä»¤ï¼å¨åµå°±ä¼å¤å®ä¸»åºä¸çº¿ï¼ç¶åå¼å§èªå¨åæ¢ä¸»åºçæµç¨ã\n * èªå¨åæ¢ä¸»åºçæµç¨å°±æ¯å¨åµçéä¸»çä»»å¡ï¼ä¸»åºæäºä»¥åï¼å¨åµå°±éè¦ä»å¾å¤ä¸ªä»åºéï¼æç§ä¸å®çè§åéæ©ä¸ä¸ªä»åºå®ä¾ï¼æå®ä½ä¸ºæ°çä¸»åºãè¿ä¸æ­¥å®æåï¼ç°å¨çéç¾¤éå°±æäºæ°ä¸»åºã\n * ç¶åï¼å¨åµä¼æ§è¡æåä¸ä¸ªä»»å¡ï¼éç¥ï¼å¨åµææ°ä¸»åºçè¿æ¥ä¿¡æ¯åç»å¶ä»ä»åºï¼è®©å®ä»¬æ§è¡ replicaof å½ä»¤ï¼åæ°ä¸»åºå»ºç«è¿æ¥ï¼å¹¶è¿è¡æ°æ®å¤å¶ãåæ¶ï¼å¨åµä¼ææ°ä¸»åºçè¿æ¥ä¿¡æ¯éç¥ç»å®¢æ·ç«¯ï¼è®©å®ä»¬æè¯·æ±æä½åå°æ°ä¸»åºä¸ã\n\nå¨è¿ä¸ä¸ªä»»å¡ä¸­ï¼éç¥ä»»å¡ç¸å¯¹æ¥è¯´æ¯è¾ç®åï¼å¨åµåªéè¦ææ°ä¸»åºä¿¡æ¯åç»ä»åºåå®¢æ·ç«¯ï¼è®©å®ä»¬åæ°ä¸»åºå»ºç«è¿æ¥å°±è¡ï¼å¹¶ä¸æ¶åå³ç­çé»è¾ãä½æ¯ï¼å¨çæ§åéä¸»è¿ä¸¤ä¸ªä»»å¡ä¸­ï¼å¨åµéè¦ååºä¸¤ä¸ªå³ç­ï¼\n\n * å¨çæ§ä»»å¡ä¸­ï¼å¨åµéè¦å¤æ­ä¸»åºæ¯å¦å¤äºä¸çº¿ç¶æï¼\n * å¨éä¸»ä»»å¡ä¸­ï¼å¨åµä¹è¦å³å®éæ©åªä¸ªä»åºå®ä¾ä½ä¸ºä¸»åºã\n\næ¥ä¸æ¥åè¯´ä¸ä¸å¦ä½å¤æ­ä¸»åºçä¸çº¿ç¶æãå¨åµå¯¹ä¸»åºçä¸çº¿å¤æ­æâä¸»è§ä¸çº¿âåâå®¢è§ä¸çº¿âä¸¤ç§ã\n\n\n# 2.2 ä¸»è§ä¸çº¿åå®¢è§ä¸çº¿\n\næåè§£éä¸ä»ä¹æ¯âä¸»è§ä¸çº¿âã\n\nå¨åµè¿ç¨ä¼ä½¿ç¨ PING å½ä»¤æ£æµå®èªå·±åä¸»ãä»åºçç½ç»è¿æ¥æåµï¼ç¨æ¥å¤æ­å®ä¾çç¶æãå¦æå¨åµåç°ä¸»åºæä»åºå¯¹ PING å½ä»¤çååºè¶æ¶äºï¼é£ä¹ï¼å¨åµå°±ä¼åæå®æ è®°ä¸ºâä¸»è§ä¸çº¿âï¼\n\n * å¦ææ£æµçæ¯ä»åºï¼é£ä¹å¨åµç®åå°æå®æ è®°ä¸ºä¸»è§ä¸çº¿å°±è¡äºï¼å ä¸ºä»åºçä¸çº¿å½±åä¸è¬ä¸å¤ªå¤§ï¼éç¾¤çå¯¹å¤æå¡ä¸ä¼é´æ­ã\n * ä½å¦ææ£æµæ¯ä¸»åºï¼é£ä¹å¨åµå¨æ è®°ä¸ºä¸»è§ä¸çº¿åï¼è¿éè¦å¼å¯ä¸»ä»åæ¢ã\n\nä½å­å¨å¨åµè¯¯å¤ä¸»åºçä¸çº¿ç¶æçé®é¢ï¼å ä¸ºä¸æ¦å¼å¯ä¸»ä»åæ¢ï¼å°±ä¼å¸¦æ¥é¢å¤å¼éï¼å æ­¤éè¦ç¹å«æ³¨æé¿åè¯¯å¤çæåµãè¯¯å¤å°±æ¯è¯´ä¸»åºå®éæ²¡æä¸çº¿ï¼ä½å¨åµè¯¯ä»¥ä¸ºå®ä¸çº¿äºï¼è¿éå¸¸åçå¨éç¾¤çç½ç»ååè¾å¤§çæåµä¸ã\n\nè¯¯å¤ä¹åä¼äº§çä»ä¹å¼éï¼\n\nä¸æ¦å¨åµå¤æ­ä¸»åºä¸çº¿äºï¼å°±ä¼å¼å§éæ©æ°ä¸»åºï¼å¹¶è®©ä»åºåæ°ä¸»åºè¿è¡æ°æ®åæ­¥ï¼è¿ä¸ªè¿ç¨æ¬èº«å°±ä¼æå¼éï¼ä¾å¦ï¼å¨åµè¦è±æ¶é´éåºæ°ä¸»åºï¼ä»åºä¹éè¦è±æ¶é´åæ°ä¸»åºåæ­¥ãèå¨è¯¯å¤çæåµä¸ï¼ä¸»åºæ¬èº«æ ¹æ¬å°±ä¸éè¦è¿è¡åæ¢çï¼æä»¥è¿ä¸ªè¿ç¨çå¼éæ¯æ²¡æä»·å¼çã\n\né£ææ ·åå°è¯¯å¤å¢ï¼å¨åµæºå¶éå¸¸ä¼ç±å¤å°å®ä¾ç»æä¸ä¸ªå¨åµéç¾¤ï¼è®©å¤ä¸ªå¨åµå®ä¾ä¸èµ·æ¥å¤æ­ï¼ä»èé¿ååä¸ªå¨åµå ç½ç»é®é¢èå¯¼è´çè¯¯å¤ãè¿æ ·ï¼åªæå½å¤§å¤æ°çå¨åµé½è®¤ä¸ºä¸»åºå·²ç»ä¸»è§ä¸çº¿äºï¼é£ä¸»åºæè¢«æ è®°ä¸ºå®¢è§ä¸çº¿ãè¿ä¸ªå«æ³è¡¨æä¸»åºä¸çº¿æä¸ºä¸ä¸ªå®¢è§äºå®äºï¼å¤æ­çååå°±æ¯å°æ°æä»å¤æ°ãè¿æ¶ä¼è¿ä¸æ­¥åºåå¨åµè¿è¡ä¸»ä»åæ¢çæµç¨ã\n\nä¸è¿°æ è®°ä¸ºâä¸»è§ä¸çº¿âåâå®¢è§ä¸çº¿âçæµç¨å¦ä¸å¾æç¤ºï¼\n\nç®åæ¥è¯´ï¼âå®¢è§ä¸çº¿âçæ åå°±æ¯ï¼å½æ N ä¸ªå¨åµå®ä¾æ¶ï¼æå¥½è¦æ N/2 + 1 ä¸ªå®ä¾å¤æ­ä¸»åºä¸ºâä¸»è§ä¸çº¿âï¼æè½æç»å¤å®ä¸»åºä¸ºâå®¢è§ä¸çº¿âãè¿æ ·ä¸æ¥ï¼å°±å¯ä»¥åå°è¯¯å¤çæ¦çï¼ä¹è½é¿åè¯¯å¤å¸¦æ¥çæ è°çä¸»ä»åºåæ¢ãï¼å½ç¶ï¼æå¤å°ä¸ªå®ä¾ååºâä¸»è§ä¸çº¿âçå¤æ­æå¯ä»¥ï¼å¯ä»¥ç± Redis ç®¡çåèªè¡è®¾å®ï¼\n\nå°è¿éæä»¬å¯ä»¥çå°ï¼åå©äºå¤ä¸ªå¨åµå®ä¾æ¥å±åå¤æ­ä¸»åºæ¯å¦å¤äºä¸çº¿ç¶æãå¦æä¸»åºçç¡®ä¸çº¿äºï¼å¨åµå°±è¦å¼å§ä¸ä¸ä¸ªå³ç­è¿ç¨ï¼éä¸»ã\n\n\n# 2.3 å¦ä½éå®æ°ä¸»åºï¼\n\nå¨åµéæ©æ°ä¸»åºçè¿ç¨å¯ä»¥ç§°ä¸ºâç­é+æåâï¼\n\n * ç­éï¼å¨å¤ä¸ªä»åºä¸­æç§ä¸å®çç­éæ¡ä»¶æ¥å»æä¸ç¬¦åæ¡ä»¶çä»åºã\n * æåï¼åæç§ä¸å®çè§åï¼ç»å©ä¸çä»åºéä¸ªæåï¼è¯éå¾åæé«çä»åºä¸ºæ°ä¸»åºã\n\nè¿ä¸ªè¿ç¨å¦ä¸å¾æç¤ºï¼\n\nå¨ååé£æ®µè¯ä¸­ï¼æä¸¤ä¸ªâä¸å®âï¼æä»¬ççåå«æ¯ä»ä¹ï¼\n\n# 2.3.1 ç­é\n\næä»¬å¨å¤ä¸ªä»åºä¸­éä¸»çæ¶åï¼é¤äºè¦æ£æ¥ä»åºçå½åå¨çº¿ç¶æï¼è¿è¦å¤æ­å®ä¹åçç½ç»è¿æ¥ç¶æï¼ä»èéåºç½ç»æåµæå¥½çå®ä¾ãå¦æä»åºæ»æ¯åä¸»åºæ­è¿ï¼èä¸æ­è¿æ¬¡æ°è¶åºäºä¸å®çéå¼ï¼æä»¬å°±æçç±ç¸ä¿¡ï¼è¿ä¸ªä»åºçç½ç»ç¶åµå¹¶ä¸æ¯å¤ªå¥½ï¼å°±å¯ä»¥æè¿ä¸ªä»åºç­æäºã\n\nå·ä½æä¹å¤æ­å¢ï¼ä½ ä½¿ç¨éç½®é¡¹ down-after-milliseconds * 10ãå¶ä¸­ï¼down-after-milliseconds æ¯æä»¬è®¤å®ä¸»ä»åºæ­è¿çæå¤§è¿æ¥è¶æ¶æ¶é´ãå¦æå¨ down-after-milliseconds æ¯«ç§åï¼ä¸»ä»èç¹é½æ²¡æéè¿ç½ç»èç³»ä¸ï¼æä»¬å°±å¯ä»¥è®¤ä¸ºä¸»ä»èç¹æ­è¿äºãå¦æåçæ­è¿çæ¬¡æ°è¶è¿äº 10 æ¬¡ï¼å°±è¯´æè¿ä¸ªä»åºçç½ç»ç¶åµä¸å¥½ï¼ä¸éåä½ä¸ºæ°ä¸»åºã\n\nç±æ­¤å°±è¿æ»¤æäºä¸åéåä¸»åºçä»åºï¼å®æäºç­éå·¥ä½ã\n\n# 2.3.2 æå\n\næ¥ä¸æ¥å°±è¦ç»å©ä½çä»åºæåäºãæä»¬å¯ä»¥åå«æç§ä¸ä¸ªè§åä¾æ¬¡è¿è¡ä¸è½®æåï¼\n\n 1. ä»åºä¼åçº§\n 2. ä»åºå¤å¶è¿åº¦\n 3. ä»åº ID å·\n\nåªè¦å¨æä¸è½®ä¸­ï¼æä»åºå¾åæé«ï¼é£ä¹å®å°±æ¯ä¸»åºäºï¼éä¸»è¿ç¨å°æ­¤ç»æãå¦ææ²¡æåºç°å¾åæé«çä»åºï¼é£ä¹å°±ç»§ç»­è¿è¡ä¸ä¸è½®ã\n\nç¬¬ä¸è½®ï¼ä¼åçº§æé«çä»åºå¾åé«ã\n\nç¨æ·å¯ä»¥éè¿ slave-priority éç½®é¡¹ï¼ç»ä¸åçä»åºè®¾ç½®ä¸åä¼åçº§ãæ¯å¦ï¼ä½ æä¸¤ä¸ªä»åºï¼å®ä»¬çåå­å¤§å°ä¸ä¸æ ·ï¼ä½ å¯ä»¥æå¨ç»åå­å¤§çå®ä¾è®¾ç½®ä¸ä¸ªé«ä¼åçº§ãå¨éä¸»æ¶ï¼å¨åµä¼ç»ä¼åçº§é«çä»åºæé«åï¼å¦ææä¸ä¸ªä»åºä¼åçº§æé«ï¼é£ä¹å®å°±æ¯æ°ä¸»åºäºãå¦æä»åºçä¼åçº§é½ä¸æ ·ï¼é£ä¹å¨åµå¼å§ç¬¬äºè½®æåã\n\nç¬¬äºè½®ï¼åæ§ä¸»åºåæ­¥ç¨åº¦ææ¥è¿çä»åºå¾åé«ã\n\nè¿ä¸ªè§åçä¾æ®æ¯ï¼å¦æéæ©åæ§ä¸»åºåæ­¥ææ¥è¿çé£ä¸ªä»åºä½ä¸ºä¸»åºï¼é£ä¹ï¼è¿ä¸ªæ°ä¸»åºä¸å°±æææ°çæ°æ®ãå¶å®ä¹å°±æ¯åªä¸ªä»åºç slave_repl_offset ææ¥è¿ä¸»åºç master_repl_offset è°å°±å¾åé«(å¨ repl_backlog_buffer ä¸­çä½ç½®)ãå¦ä¸å¾æç¤ºï¼\n\nç¬¬ä¸è½®ï¼IDå·å°çä»åºå¾åé«ã\n\næ¯ä¸ªå®ä¾é½ä¼æä¸ä¸ªIDï¼è¿ä¸ªIDå°±ç±»ä¼¼äºè¿éçä»åºçç¼å·ãç®åï¼Redis å¨éä¸»åºæ¶ï¼æä¸ä¸ªé»è®¤çè§å®ï¼å¨ä¼åçº§åå¤å¶è¿åº¦é½ç¸åçæåµä¸ï¼ID å·æå°çä»åºå¾åæé«ï¼ä¼è¢«éä¸ºæ°ä¸»åºã\n\nå°è¿éï¼âéä¸»âè¿ä¸ªè¿ç¨å°±å®æäºãæä»¬å¨åé¡¾ä¸ä¸è¿ä¸ªæµç¨ï¼\n\n * é¦åï¼å¨åµä¼æç§å¨çº¿ç¶æãç½ç»ç¶æï¼ç­éè¿æ»¤æä¸é¨åä¸ç¬¦åè¦æ±çä»åºï¼\n * ç¶åï¼ä¾æ¬¡æç§ä¼åçº§ãå¤å¶è¿åº¦ãID å·å¤§å°åå¯¹å©ä½çä»åºè¿è¡æåï¼åªè¦æå¾åæé«çä»åºåºç°ï¼å°±æå®éä¸ºæ°ä¸»åºã\n\n\n# 2.4 å°ç»\n\nå¨åµæºå¶æ¯å®ç° Redis ä¸é´æ­æå¡çéè¦ä¿è¯ï¼å®èªå¨å®æäºä»¥ä¸ä¸ä¸ªåè½ï¼å¹¶å®ç°äºä¸»ä»åæ¢ï¼\n\n * çæ§ä¸»åºè¿è¡ç¶æï¼å¹¶å¤æ­ä¸»åºæ¯å¦å®¢è§ä¸çº¿ï¼\n * å¨ä¸»åºå®¢è§ä¸çº¿åï¼éåæ°ä¸»åºï¼\n * éåºæ°ä¸»åºåï¼éç¥ä»åºåå®¢æ·ç«¯ã\n\nä¸ºäºéä½è¯¯å¤çï¼å¨åµæºå¶éå¸¸éç¨å¤å®ä¾é¨ç½²ï¼éè¿âå°æ°æä»å¤æ°âçååï¼æ¥å¤æ­ä¸»åºæ¯å¦å®¢è§ä¸çº¿ã\n\nä½å¨åµéç¾¤åæ¶ä¹å¸¦æ¥äºé®é¢ï¼\n\n * å¨åµéç¾¤ä¸­æå®ä¾æäºï¼æä¹åï¼ä¼å½±åä¸»åºç¶æå¤æ­åéä¸»åï¼\n * å¨åµéç¾¤å¤æ°å®ä¾è¾¾æå±è¯ï¼å¤æ­åºä¸»åºâå®¢è§ä¸çº¿âåï¼ç±åªä¸ªå®ä¾æ¥æ§è¡ä¸»ä»åæ¢å¢ï¼\n\nä¸ºäºææè¿äºé®é¢ï¼éè¦è¿ä¸æ­¥äºè§£å¨åµéç¾¤ã\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼å¨ä¸»ä»åæ¢è¿ç¨ä¸­ï¼å®¢æ·ç«¯è½å¦æ­£å¸¸å°è¿è¡è¯·æ±æä½å¢ï¼\n\nä¸»ä»éç¾¤ä¸è¬æ¯éç¨è¯»ååç¦»æ¨¡å¼ï¼å½ä¸»åºæéåï¼å®¢æ·ç«¯ä»ç¶å¯ä»¥æè¯»è¯·æ±åéç»ä»åºï¼è®©ä»åºæå¡ãä½æ¯ï¼å¯¹äºåè¯·æ±æä½ï¼å®¢æ·ç«¯å°±æ æ³æ§è¡äºã\n\næ¬èé®é¢ 2ï¼å¦ææ³è¦åºç¨ç¨åºä¸æç¥æå¡çä¸­æ­ï¼è¿éè¦å¨åµæå®¢æ·ç«¯ååäºä»ä¹åï¼\n\n * ä¸æ¹é¢ï¼å®¢æ·ç«¯éè¦è½ç¼å­åºç¨åéçåè¯·æ±ãåªè¦ä¸æ¯åæ­¥åæä½ï¼Redis åºç¨åºæ¯ä¸è¬ä¹æ²¡æåæ­¥åï¼ï¼åè¯·æ±éå¸¸ä¸ä¼å¨åºç¨ç¨åºçå³é®è·¯å¾ä¸ï¼æä»¥ï¼å®¢æ·ç«¯ç¼å­åè¯·æ±åï¼ç»åºç¨ç¨åºè¿åä¸ä¸ªç¡®è®¤å°±è¡ã\n * å¦ä¸æ¹é¢ï¼ä¸»ä»åæ¢å®æåï¼å®¢æ·ç«¯è¦è½åæ°ä¸»åºéæ°å»ºç«è¿æ¥ï¼å¨åµéè¦æä¾è®¢éé¢éï¼è®©å®¢æ·ç«¯è½å¤è®¢éå°æ°ä¸»åºçä¿¡æ¯ãåæ¶ï¼å®¢æ·ç«¯ä¹éè¦è½ä¸»å¨åå¨åµéä¿¡ï¼è¯¢é®æ°ä¸»åºçä¿¡æ¯ã\n\n\n# 3. å¨åµéç¾¤ï¼å¨åµæäºï¼ä¸»ä»åºè¿è½åæ¢åï¼\n\nä¸èè®²çå¨åµæºå¶å®ç°äºä¸»ä»åæ¢ï¼ä½å¦ææå¨åµå®ä¾å¨è¿è¡æ¶åçäºæéï¼ä¸»ä»åºè¿è½æ­£å¸¸åæ¢åï¼å®éä¸ï¼ä¸æ¦å¤ä¸ªå®ä¾ç»æäºå¨åµéç¾¤ï¼å³ä½¿æå¨åµå®ä¾ææäºï¼å¶ä»å¨åµè¿è½ç»§ç»­åä½å®æä¸»ä»åæ¢çå·¥ä½ï¼åæ¬å¤å®ä¸»åºæ¯ä¸æ¯å¤äºä¸çº¿ç¶æãéæ©æ°ä¸»åºï¼ä»¥åéç¥ä»åºåå®¢æ·ç«¯ã\n\nå¦æä½ é¨ç½²è¿å¨åµéç¾¤çè¯å°±ä¼ç¥éï¼å¨éç½®å¨åµçä¿¡æ¯æ¶ï¼æä»¬åªéè¦ç¨å°ä¸é¢çè¿ä¸ªéç½®é¡¹ï¼å³è®¾ç½®ä¸»åºç IPåç«¯å£ï¼å¹¶æ²¡æéç½®å¶ä»å¨åµçè¿æ¥ä¿¡æ¯ï¼\n\nsentinel monitor <master-name> <ip> <redis-port> <quorum>\n\n\n1\n\n\nè¿äºå¨åµå®ä¾æ¢ç¶é½ä¸ç¥éå½¼æ­¤çå°åï¼åæ¯æä¹ç»æéç¾¤çå¢ï¼è¦å¼æç½è¿ä¸ªé®é¢ï¼æä»¬å°±éè¦å­¦ä¹ ä¸ä¸å¨åµéç¾¤çç»æåè¿è¡æºå¶äºã\n\n\n# 3.1 åºäº pub/sub æºå¶çå¨åµéç¾¤ç»æ\n\nå¨åµå®ä¾ä¹é´å¯ä»¥ç¸äºåç°ï¼è¦å½åäº Redis æä¾ç pub/sub æºå¶ï¼ä¹å°±æ¯åå¸/è®¢éæºå¶ãå¨åµåªè¦åä¸»åºå»ºç«èµ·äºè¿æ¥ï¼å°±å¯ä»¥å¨ä¸»åºä¸åå¸æ¶æ¯äºï¼æ¯å¦è¯´åå¸å®èªå·±çè¿æ¥ä¿¡æ¯ï¼IPåç«¯å£ï¼ãåæ¶ï¼å®ä¹å¯ä»¥ä»ä¸»åºä¸è®¢éæ¶æ¯ï¼è·å¾å¶ä»å¨åµåå¸çè¿æ¥ä¿¡æ¯ãå½å¤ä¸ªå¨åµå®ä¾é½å¨ä¸»åºä¸åäºåå¸åè®¢éæä½åï¼å®ä»¬ä¹é´å°±è½ç¥éå½¼æ­¤ç IP å°ååç«¯å£ã\n\né¤äºå¨åµå®ä¾ï¼æä»¬èªå·±ç¼åçåºç¨ç¨åºä¹å¯ä»¥éè¿Redisè¿è¡æ¶æ¯çåå¸åè®¢éãæä»¥ï¼ä¸ºäºåºåä¸ååºç¨çæ¶æ¯ï¼Redis ä¼ä»¥é¢éçå½¢å¼ï¼å¯¹è¿äºæ¶æ¯è¿è¡åé¨å«ç±»çç®¡çãæè°çé¢éï¼å®éä¸å°±æ¯æ¶æ¯çç±»å«ãå½æ¶æ¯ç±»å«ç¸åæ¶ï¼å®ä»¬å°±å±äºåä¸ä¸ªé¢éãåä¹ï¼å°±å±äºä¸åçé¢éãåªæè®¢éäºåä¸ä¸ªé¢éçåºç¨ï¼æè½éè¿åå¸çæ¶æ¯è¿è¡ä¿¡æ¯äº¤æ¢ã\n\nå¨ä¸»ä»éç¾¤ä¸­ï¼ä¸»åºä¸æä¸ä¸ªåä¸º __sentinel__: hello çé¢éï¼ä¸åå¨åµå°±æ¯éè¿å®æ¥ç¸äºåç°ï¼å®ç°äºç¸éä¿¡çãå¦ä¸å¾ç¤ºä¾ï¼\n\nåå©äºä¸å¾æç¤ºç pub/sub æºå¶ï¼å¨åµéç¾¤å°±å½¢æäºï¼å®ä»¬ä¹é´å¯ä»¥éè¿ç½ç»è¿æ¥è¿è¡éä¿¡ï¼å¹¶å¯¹ä¸»åºæ¯å¦ä¸çº¿çå¤æ­è¿è¡ååãå¨åµé¤äºå½¼æ­¤ä¹é´å»ºç«èµ·è¿æ¥å½¢æéç¾¤å¤ï¼è¿éè¦åä»åºå»ºç«è¿æ¥ãè¿æ¯å ä¸ºï¼å¨å¨åµççæ§ä»»å¡ä¸­ï¼å®éè¦å¯¹ä¸»ä»åºé½è¿è¡å¿è·³å¤æ­ï¼èä¸å¨ä¸»ä»åºåæ¢å®æåï¼å®è¿éè¦éç¥ä»åºï¼è®©å®ä»¬åæ°ä¸»åºè¿è¡åæ­¥ã\n\né£ä¹ï¼ å¨åµæ¯å¦ä½ç¥éä»åºç IP å°ååç«¯å£çå¢ï¼å¦ä¸å¾æç¤ºï¼è¿æ¯ç±å¨åµåä¸»åºåé INFO å½ä»¤æ¥å®æçï¼ç¶åä¸»åºä¼ååºç»å¨åµä¸ä¸ª slave åè¡¨ãç±æ­¤ï¼å¨åµå°±å¯ä»¥ä¸ä»åºå»ºç«è¿æ¥äºã\n\nä½ çï¼éè¿ pub/sub æºå¶ï¼å¨åµä¹é´å¯ä»¥ç»æéç¾¤ï¼åæ¶ï¼å¨åµåéè¿ INFO å½ä»¤ï¼è·å¾äºä»åºè¿æ¥ä¿¡æ¯ï¼ä¹è½åä»åºå»ºç«è¿æ¥ï¼å¹¶è¿è¡çæ§äºã\n\nä½æ¯ï¼å¨åµä¸è½åªåä¸»ãä»åºè¿æ¥ãå ä¸ºä¸»ä»åºåæ¢åï¼å®¢æ·ç«¯ä¹éè¦ç¥éæ°ä¸»åºçè¿æ¥ä¿¡æ¯ï¼æè½åæ°ä¸»åºåéè¯·æ±æä½ãæä»¥ï¼å¨åµè¿éè¦å®æææ°ä¸»åºçä¿¡æ¯åè¯å®¢æ·ç«¯è¿ä¸ªä»»å¡ãèä¸ï¼å¨å®éä½¿ç¨å¨åµæ¶ï¼æä»¬ææ¶ä¼éå°è¿æ ·çé®é¢ï¼å¦ä½å¨å®¢æ·ç«¯éè¿çæ§äºè§£å¨åµè¿è¡ä¸»ä»åæ¢çè¿ç¨å¢ï¼æ¯å¦è¯´ï¼ä¸»ä»åæ¢è¿è¡å°åªä¸æ­¥äºï¼è¿å¶å®å°±æ¯è¦æ±ï¼å®¢æ·ç«¯è½å¤è·åå°å¨åµéç¾¤å¨çæ§ãéä¸»ãåæ¢è¿ä¸ªè¿ç¨ä¸­åççåç§äºä»¶ã\n\næ­¤æ¶ï¼æä»¬ä»ç¶å¯ä»¥ä¾èµ pub/sub æºå¶ï¼æ¥å¸®å©æä»¬å®æå¨åµåå®¢æ·ç«¯é´çä¿¡æ¯åæ­¥ã\n\n\n# 3.2 åºäº pub/sub æºå¶çå®¢æ·ç«¯äºä»¶éç¥\n\nä»æ¬è´¨ä¸è¯´ï¼å¨åµå°±æ¯ä¸ä¸ªè¿è¡å¨ç¹å®æ¨¡å¼ä¸ç Redis å®ä¾ï¼åªä¸è¿å®å¹¶ä¸æå¡è¯·æ±æä½ï¼åªæ¯å®æçæ§ãéä¸»åéç¥çä»»å¡ãæä»¥ï¼æ¯ä¸ªå¨åµå®ä¾ä¹æä¾ pub/sub æºå¶ï¼å®¢æ·ç«¯å¯ä»¥ä»å¨åµè®¢éæ¶æ¯ãå¨åµæä¾çæ¶æ¯è®¢éé¢éæå¾å¤ï¼ä¸åé¢éåå«äºä¸»ä»åºåæ¢è¿ç¨ä¸­çä¸åå³é®äºä»¶ãä¸é¢ååºäºä¸äºéè¦çé¢éï¼\n\nç¥éäºè¿äºé¢éä¹åï¼ä½ å°±å¯ä»¥è®©å®¢æ·ç«¯ä»å¨åµé£éè®¢éæ¶æ¯äºãå·ä½çæä½æ­¥éª¤æ¯ï¼å®¢æ·ç«¯è¯»åå¨åµçéç½®æä»¶åï¼å¯ä»¥è·å¾å¨åµçå°ååç«¯å£ï¼åå¨åµå»ºç«ç½ç»è¿æ¥ãç¶åï¼æä»¬å¯ä»¥å¨å®¢æ·ç«¯æ§è¡è®¢éå½ä»¤ï¼æ¥è·åä¸åçäºä»¶æ¶æ¯ã\n\nä¸¾ä¸ªä¾å­ï¼ä½ å¯ä»¥æ§è¡ SUBSCRIBE +odown å½ä»¤ï¼æ¥è®¢éâææå®ä¾è¿å¥å®¢è§ä¸çº¿ç¶æçäºä»¶âï¼ä¹å¯ä»¥æ§è¡ PSUBSCRIBE * æ¥è®¢éææçäºä»¶ã\n\nå½å¨åµææ°ä¸»åºéæ©åºæ¥åï¼å®¢æ·ç«¯å°±ä¼çå°ä¸é¢ç switch-master äºä»¶ãè¿ä¸ªäºä»¶è¡¨ç¤ºä¸»åºå·²ç»åæ¢äºï¼æ°ä¸»åºç IP ååç«¯å£ä¿¡æ¯å·²ç»æäºãè¿ä¸ªæ¶åï¼å®¢æ·ç«¯å°±å¯ä»¥ç¨è¿éé¢çæ°ä¸»åºå°ååç«¯å£è¿è¡éä¿¡äºï¼\n\nswitch-master <master name> <oldip> <oldport> <newip> <newport>\n\n\n1\n\n\næäºè¿äºäºä»¶éç¥ï¼å®¢æ·ç«¯ä¸ä»å¯ä»¥å¨ä¸»ä»åæ¢åå¾å°æ°ä¸»åºçè¿æ¥ä¿¡æ¯ï¼è¿å¯ä»¥çæ§å°ä¸»ä»åºåæ¢è¿ç¨ä¸­åççåä¸ªéè¦äºä»¶ãè¿æ ·ï¼å®¢æ·ç«¯å°±å¯ä»¥ç¥éä¸»ä»åæ¢è¿è¡å°åªä¸æ­¥äºï¼æå©äºäºè§£åæ¢è¿åº¦ã\n\nå¥½äºï¼æäº pub/sub æºå¶ï¼å¨åµåå¨åµä¹é´ãå¨åµåä»åºä¹é´ãå¨åµåå®¢æ·ç«¯ä¹é´å°±é½è½å»ºç«èµ·è¿æ¥äºï¼åå ä¸æä»¬ä¸èè¯¾ä»ç»ä¸»åºä¸çº¿å¤æ­åéä¸»ä¾æ®ï¼å¨åµéç¾¤ççæ§ãéä¸»åéç¥ä¸ä¸ªä»»å¡å°±åºæ¬å¯ä»¥æ­£å¸¸å·¥ä½äºãä¸è¿ï¼æä»¬è¿éè¦èèä¸ä¸ªé®é¢ï¼ä¸»åºæéä»¥åï¼å¨åµéç¾¤æå¤ä¸ªå®ä¾ï¼é£æä¹ç¡®å®ç±åªä¸ªå¨åµæ¥è¿è¡å®éçä¸»ä»åæ¢å¢ï¼\n\n\n# 3.3 ç±åªä¸ªå¨åµæ§è¡ä¸»ä»åæ¢ï¼\n\nç¡®å®ç±åªä¸ªå¨åµæ§è¡ä¸»ä»åæ¢çè¿ç¨ï¼åä¸»åºâå®¢è§ä¸çº¿âçå¤æ­è¿ç¨ç±»ä¼¼ï¼ä¹æ¯ä¸ä¸ªâæç¥¨ä»²è£âçè¿ç¨ãå¨å·ä½äºè§£è¿ä¸ªè¿ç¨åï¼æä»¬åæ¥çä¸ï¼å¤æ­âå®¢è§ä¸çº¿âçä»²è£è¿ç¨ã\n\nå¨åµéç¾¤è¦å¤å®ä¸»åºâå®¢è§ä¸çº¿âï¼éè¦æä¸å®æ°éçå®ä¾é½è®¤ä¸ºè¯¥ä¸»åºå·²ç»âä¸»è§ä¸çº¿âäºãæå¨ä¸èè¯¾åä½ ä»ç»äºå¤æ­âå®¢è§ä¸çº¿âçååï¼æ¥ä¸æ¥ï¼æä»ç»ä¸å·ä½çå¤æ­è¿ç¨ï¼\n\nä»»ä½ä¸ä¸ªå®ä¾åªè¦èªèº«å¤æ­ä¸»åºâä¸»è§ä¸çº¿âåï¼å°±ä¼ç»å¶ä»å®ä¾åé is-master-down-by-addr å½ä»¤ãæ¥çï¼å¶ä»å®ä¾ä¼æ ¹æ®èªå·±åä¸»åºçè¿æ¥æåµï¼ååº Y æ N çååºï¼Y ç¸å½äºèµæç¥¨ï¼N ç¸å½äºåå¯¹ç¥¨ãå¦ä¸å¾æç¤ºï¼\n\nä¸ä¸ªå¨åµè·å¾äºä»²è£æéçèµæç¥¨æ°åï¼å°±å¯ä»¥æ è®°ä¸»åºä¸ºâå®¢è§ä¸çº¿âãè¿ä¸ªæéçèµæç¥¨æ°æ¯éè¿å¨åµéç½®æä»¶ä¸­ç quorum éç½®é¡¹è®¾å®çãä¾å¦ï¼ç°å¨æ 5 ä¸ªå¨åµï¼quorum éç½®çæ¯ 3ï¼é£ä¹ï¼ä¸ä¸ªå¨åµéè¦3å¼ èµæç¥¨ï¼å°±å¯ä»¥æ è®°ä¸»åºä¸ºâå®¢è§ä¸çº¿âäºãè¿3å¼ èµæç¥¨åæ¬å¨åµèªå·±çä¸å¼ èµæç¥¨åå¦å¤ä¸¤ä¸ªå¨åµçèµæç¥¨ã\n\næ­¤æ¶ï¼è¿ä¸ªå¨åµå°±å¯ä»¥åç»å¶ä»å¨åµåéå½ä»¤ï¼è¡¨æå¸æç±èªå·±æ¥æ§è¡ä¸»ä»åæ¢ï¼å¹¶è®©ææå¶ä»å¨åµè¿è¡æç¥¨ãè¿ä¸ªæç¥¨è¿ç¨ç§°ä¸ºâLeader éä¸¾âãå ä¸ºæç»æ§è¡ä¸»ä»åæ¢çå¨åµç§°ä¸º Leaderï¼æç¥¨è¿ç¨å°±æ¯ç¡®å® Leaderãå¨æç¥¨è¿ç¨ä¸­ï¼ä»»ä½ä¸ä¸ªæ³æä¸º Leader çå¨åµï¼è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼\n\n 1. æ¿å°åæ°ä»¥ä¸çèµæç¥¨ï¼\n 2. æ¿å°çç¥¨æ°åæ¶è¿éè¦å¤§äºç­äºå¨åµéç½®æä»¶ä¸­ç quorum å¼ãä»¥3ä¸ªå¨åµä¸ºä¾ï¼åè®¾æ­¤æ¶ç quorum è®¾ç½®ä¸º 2ï¼é£ä¹ï¼ä»»ä½ä¸ä¸ªæ³æä¸º Leader çå¨åµåªè¦æ¿å°2å¼ èµæç¥¨ï¼å°±å¯ä»¥äºã\n\nä¸å¾å°±å±ç¤ºäº 3 ä¸ªå¨åµãquorum=2 çéä¸¾è¿ç¨ï¼\n\néè¦æ³¨æçæ¯ï¼å¦æå¨åµéç¾¤åªæ 2 ä¸ªå®ä¾ï¼æ­¤æ¶ï¼ä¸ä¸ªå¨åµè¦æ³æä¸º Leaderï¼å¿é¡»è·å¾ 2 ç¥¨ï¼èä¸æ¯ 1 ç¥¨ãæä»¥ï¼å¦ææä¸ªå¨åµææäºï¼é£ä¹ï¼æ­¤æ¶çéç¾¤æ¯æ æ³è¿è¡ä¸»ä»åºåæ¢çãå æ­¤ï¼éå¸¸æä»¬è³å°ä¼éç½® 3 ä¸ªå¨åµå®ä¾ãè¿ä¸ç¹å¾éè¦ï¼ä½ å¨å®éåºç¨æ¶å¯ä¸è½å¿½ç¥äºã\n\n\n# 3.4 å°ç»\n\néå¸¸ï¼æä»¬å¨è§£å³ä¸ä¸ªç³»ç»é®é¢çæ¶åï¼ä¼å¼å¥ä¸ä¸ªæ°æºå¶ï¼æèè®¾è®¡ä¸å±æ°åè½ï¼å°±åæä»¬å¨è¿ä¸¤èè¯¾å­¦ä¹ çåå®¹ï¼ä¸ºäºå®ç°ä¸»ä»åæ¢ï¼æä»¬å¼å¥äºå¨åµï¼ä¸ºäºé¿ååä¸ªå¨åµæéåæ æ³è¿è¡ä¸»ä»åæ¢ï¼ä»¥åä¸ºäºåå°è¯¯å¤çï¼åå¼å¥äºå¨åµéç¾¤ï¼å¨åµéç¾¤åéè¦æä¸äºæºå¶æ¥æ¯æå®çæ­£å¸¸è¿è¡ã\n\nè¿ä¸èä¸»è¦è®²äºå¨åµéç¾¤çä¸äºå³é®æºå¶ï¼\n\n * åºäº pub/sub æºå¶çå¨åµéç¾¤ç»æè¿ç¨ï¼\n * åºäº INFO å½ä»¤çä»åºåè¡¨ï¼è¿å¯ä»¥å¸®å©å¨åµåä»åºå»ºç«è¿æ¥ï¼\n * åºäºå¨åµèªèº«ç pub/sub åè½ï¼è¿å®ç°äºå®¢æ·ç«¯åå¨åµä¹é´çäºä»¶éç¥ã\n\nå¯¹äºä¸»ä»åæ¢ï¼éè¦å¨åµéç¾¤å¨å¤æ­äºä¸»åºâå®¢è§ä¸çº¿âåï¼ç»è¿æç¥¨ä»²è£ï¼éä¸¾ä¸ä¸ª Leader åºæ¥ï¼ç±å®è´è´£å®éçä¸»ä»åæ¢ï¼å³ç±å®æ¥å®ææ°ä¸»åºçéæ©ä»¥åéç¥ä»åºä¸å®¢æ·ç«¯ã\n\n> æåï¼ææ³åç»ä½ åäº«ä¸ä¸ªç»éªï¼è¦ä¿è¯ææå¨åµå®ä¾çéç½®æ¯ä¸è´çï¼å°¤å¶æ¯ä¸»è§ä¸çº¿çå¤æ­å¼ down-after-millisecondsãæä»¬æ¾ç»å°±è¸©è¿ä¸ä¸ªâåâãå½æ¶ï¼å¨æä»¬çé¡¹ç®ä¸­ï¼å ä¸ºè¿ä¸ªå¼å¨ä¸åçå¨åµå®ä¾ä¸éç½®ä¸ä¸è´ï¼å¯¼è´å¨åµéç¾¤ä¸ç´æ²¡æå¯¹ææéçä¸»åºå½¢æå±è¯ï¼ä¹å°±æ²¡æåæ¶åæ¢ä¸»åºï¼æç»çç»æå°±æ¯éç¾¤æå¡ä¸ç¨³å®ãæä»¥ï¼ä½ ä¸å®ä¸è¦å¿½ç¥è¿æ¡çä¼¼ç®åçç»éªã\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼æä¸ä¸ªRediséç¾¤ï¼æ¯âä¸ä¸»åä»âï¼éç½®äº 5 ä¸ªå¨åµå®ä¾çéç¾¤ï¼quorum å¼è®¾ä¸º 2ãå¨è¿è¡è¿ç¨ä¸­ï¼å¦ææ 3 ä¸ªå¨åµå®ä¾é½åçæéäºï¼æ­¤æ¶ï¼Redis ä¸»åºå¦æææéï¼è¿è½æ­£ç¡®å°å¤æ­ä¸»åºâå®¢è§ä¸çº¿âåï¼å¦æå¯ä»¥çè¯ï¼è¿è½è¿è¡ä¸»ä»åºèªå¨åæ¢åï¼\n\nå ä¸ºå¤å®ä¸»åºâå®¢è§ä¸çº¿âçä¾æ®æ¯ï¼è®¤ä¸ºä¸»åºâä¸»è§ä¸çº¿âçå¨åµä¸ªæ°è¦å¤§äºç­äºquorumå¼ï¼ç°å¨è¿å©2ä¸ªå¨åµå®ä¾ï¼ä¸ªæ°æ­£å¥½ç­äºquorumå¼ï¼æä»¥è¿è½æ­£å¸¸å¤æ­ä¸»åºæ¯å¦å¤äºâå®¢è§ä¸çº¿âç¶æãå¦æä¸ä¸ªå¨åµæ³è¦æ§è¡ä¸»ä»åæ¢ï¼å°±è¦è·å°åæ°ä»¥ä¸çå¨åµæç¥¨èµæï¼ä¹å°±æ¯è³å°éè¦3ä¸ªå¨åµæç¥¨èµæãä½æ¯ï¼ç°å¨åªæ2ä¸ªå¨åµäºï¼æä»¥å°±æ æ³è¿è¡ä¸»ä»åæ¢äºã\n\næ¬èé®é¢ 2ï¼å¨åµå®ä¾æ¯ä¸æ¯è¶å¤è¶å¥½å¢ï¼å¦æåæ¶è°å¤§ down-after-milliseconds å¼ï¼å¯¹åå°è¯¯å¤æ¯ä¸æ¯ä¹æå¥½å¤ï¼\n\nå¨åµå®ä¾è¶å¤ï¼è¯¯å¤çä¼è¶ä½ï¼ä½æ¯å¨å¤å®ä¸»åºä¸çº¿åéä¸¾Leaderæ¶ï¼å®ä¾éè¦æ¿å°çèµæç¥¨æ°ä¹è¶å¤ï¼ç­å¾ææå¨åµæå®ç¥¨çæ¶é´å¯è½ä¹ä¼ç¸åºå¢å ï¼ä¸»ä»åºåæ¢çæ¶é´ä¹ä¼åé¿ï¼å®¢æ·ç«¯å®¹æå ç§¯è¾å¤çè¯·æ±æä½ï¼å¯è½ä¼å¯¼è´å®¢æ·ç«¯è¯·æ±æº¢åºï¼ä»èé æè¯·æ±ä¸¢å¤±ãå¦æä¸å¡å±å¯¹Redisçæä½æååºæ¶é´è¦æ±ï¼å°±å¯è½ä¼å ä¸ºæ°ä¸»åºä¸ç´æ²¡æéå®ï¼æ°æä½æ æ³æ§è¡èåçè¶æ¶æ¥è­¦ã\n\nè°å¤§down-after-millisecondsåï¼å¯è½ä¼å¯¼è´è¿æ ·çæåµï¼ä¸»åºå®éå·²ç»åçæéäºï¼ä½æ¯å¨åµè¿äºå¾é¿æ¶é´æå¤æ­åºæ¥ï¼è¿å°±ä¼å½±åå°Rediså¯¹ä¸å¡çå¯ç¨æ§ã",normalizedContent:"> åèï¼\n> \n>  * 06 æ°æ®åæ­¥ï¼ä¸»ä»åºå¦ä½å®ç°æ°æ®ä¸è´ï¼| æå®¢æ¶é´(opens new window)\n>  * 07 å¨åµæºå¶ï¼ä¸»åºæäºï¼å¦ä½ä¸é´æ­æå¡ï¼| æå®¢æ¶é´(opens new window)\n>  * 08 å¨åµéç¾¤ï¼å¨åµæäºï¼ä¸»ä»åºè¿è½åæ¢åï¼| æå®¢æ¶é´\n\næä»¬ä½¿ç¨ aof å rdbï¼ä¿è¯å°½éå°ä¸¢å¤±æ°æ®ï¼æåå¯é æ§ãä½ä¾ç¶å­å¨ä¸å¯ç¨é®é¢ã\n\nåè®¾æä»¬ç redis åªæä¸ä¸ªå®ä¾ï¼é£ä¹å½è¿ä¸ªå®ä¾å®æºï¼é£å°±æ æ³ç»§ç»­æä¾æå¡äºãæä»¬æ»è¯´ redis å·æé«å¯é æ§ï¼å¶å®æä¸¤å±å«ä¹ï¼\n\n * ä¸æ¯æ°æ®å°½éå°ä¸¢å¤±ã\n * äºæ¯æå¡å°½éå°ä¸­æ­ã\n\naof å rdb ä¿è¯äºåèï¼èå¯¹äºåèï¼redis çåæ³å°±æ¯å¢å å¯æ¬åä½éï¼è¿æ ·å½ä¸ä¸ªå®ä¾åºç°æéåï¼å¶ä»å®ä¾å¯ä»¥ç»§ç»­æä¾æå¡ã\n\nredis ä½¿ç¨äºä¸»ä»å¤å¶çæ¨¡å¼æ¥åæ°æ®å¤å¶ï¼ä¸»ä»åºä¹é´éç¨çæ¯âè¯»ååç¦»âçæ¹å¼ï¼\n\n * è¯»æä½ï¼ä¸»åºãä»åºé½å¯ä»¥æ¥æ¶ï¼\n * åæä½ï¼é¦åå°ä¸»åºæ§è¡ï¼ç¶åï¼ä¸»åºå°åæä½åæ­¥ç»ä»åºã\n\nä¸»ä»å¤å¶çæ¨¡å¼å°±é¢ä¸´ ddia æ°æ®å¤å¶ ä¸­æè®¨è®ºçä¸ç³»åé®é¢ãä¸é¢æä»¬å¯¹ redis å¨è¯¥æ¨¡å¼ä¸çå®è·µè¿è¡è®¨è®ºã\n\nä¸»ä»åºåæ­¥æ¯å¦ä½å®æçå¢ï¼ä¸»åºæ°æ®æ¯ä¸æ¬¡æ§ä¼ ç»ä»åºï¼è¿æ¯åæ¹åæ­¥ï¼è¦æ¯ä¸»ä»åºé´çç½ç»æ­è¿äºï¼æ°æ®è¿è½ä¿æä¸è´åï¼ä¸é¢èèä¸»ä»åºåæ­¥çåçï¼ä»¥ååºå¯¹ç½ç»æ­è¿é£é©çæ¹æ¡ã\n\n\n# 1. æ°æ®åæ­¥ï¼ä¸»ä»åºå¦ä½å®ç°æ°æ®ä¸è´ï¼\n\nè¿ä¸å¤§èä¸»è¦è®¨è®ºä¸»ä»åºåæ­¥çåçï¼ä»¥ååºå¯¹ç½ç»æ­è¿é£é©çæ¹æ¡ã\n\né¦åçä¸ä¸ä¸»ä»åºé´çç¬¬ä¸æ¬¡åæ­¥æ¯å¦ä½è¿è¡çï¼è¿ä¹æ¯ redis å®ä¾å»ºç«ä¸»ä»åºæ¨¡å¼åçè§å®å¨ä½ã\n\n\n# 1.1 ä¸»ä»åºé´å¦ä½è¿è¡ç¬¬ä¸æ¬¡åæ­¥ï¼\n\nå½æä»¬å¯å¨å¤ä¸ª redis å®ä¾çæ¶åï¼å®ä»¬ç¸äºä¹é´å°±å¯ä»¥éè¿ replicaofï¼redis 5.0 ä¹åä½¿ç¨ slaveofï¼å½ä»¤å½¢æä¸»åºåä»åºçå³ç³»ï¼ä¹åä¼æç§ä¸ä¸ªé¶æ®µå®ææ°æ®çç¬¬ä¸æ¬¡åæ­¥ã\n\nä¾å¦ï¼ç°å¨æå®ä¾1ï¼ipï¼172.16.19.3ï¼åå®ä¾2ï¼ipï¼172.16.19.5ï¼ï¼æä»¬å¨å®ä¾2ä¸æ§è¡ä»¥ä¸è¿ä¸ªå½ä»¤åï¼å®ä¾2å°±åæäºå®ä¾1çä»åºï¼å¹¶ä»å®ä¾1ä¸å¤å¶æ°æ®ï¼\n\nreplicaof  172.16.19.3  6379\n\n\n1\n\n\næ¥ä¸æ¥ï¼æä»¬å°±è¦å­¦ä¹ ä¸»ä»åºé´æ°æ®ç¬¬ä¸æ¬¡åæ­¥çä¸ä¸ªé¶æ®µäºï¼\n\nç¬¬ä¸é¶æ®µæ¯ä¸»ä»åºé´å»ºç«è¿æ¥ãåååæ­¥çè¿ç¨ï¼ä¸»è¦æ¯ä¸ºå¨éå¤å¶ååå¤ãå¨è¿ä¸æ­¥ï¼ä»åºåä¸»åºå»ºç«èµ·è¿æ¥ï¼å¹¶åè¯ä¸»åºå³å°è¿è¡åæ­¥ï¼ä¸»åºç¡®è®¤åå¤åï¼ä¸»ä»åºé´å°±å¯ä»¥å¼å§åæ­¥äºã\n\nå·ä½æ¥è¯´ï¼ä»åºç»ä¸»åºåé psync å½ä»¤ï¼è¡¨ç¤ºè¦è¿è¡æ°æ®åæ­¥ï¼ä¸»åºæ ¹æ®è¿ä¸ªå½ä»¤çåæ°æ¥å¯å¨å¤å¶ãpsyncå½ä»¤åå«äºä¸»åºç runidåå¤å¶è¿åº¦ offset ä¸¤ä¸ªåæ°ï¼\n\n * runidï¼æ¯æ¯ä¸ª redis å®ä¾å¯å¨æ¶é½ä¼èªå¨çæçä¸ä¸ªéæº idï¼ç¨æ¥å¯ä¸æ è®°è¿ä¸ªå®ä¾ãå½ä»åºåä¸»åºç¬¬ä¸æ¬¡å¤å¶æ¶ï¼å ä¸ºä¸ç¥éä¸»åºç runidï¼æä»¥å°runidè®¾ä¸ºâ?âã\n * offsetï¼æ­¤æ¶è®¾ä¸º -1ï¼è¡¨ç¤ºç¬¬ä¸æ¬¡å¤å¶ã\n\nä¸»åºæ¶å° psync å½ä»¤åï¼ä¼ç¨ fullresync ååºå½ä»¤å¸¦ä¸ä¸¤ä¸ªåæ°ï¼ä¸»åº runid åä¸»åºç®åçå¤å¶è¿åº¦ offsetï¼è¿åç»ä»åºãä»åºæ¶å°ååºåï¼ä¼è®°å½ä¸è¿ä¸¤ä¸ªåæ°ã\n\nè¿éæä¸ªå°æ¹éè¦æ³¨æï¼fullresync ååºè¡¨ç¤ºç¬¬ä¸æ¬¡å¤å¶éç¨çå¨éå¤å¶ï¼ä¹å°±æ¯è¯´ï¼ä¸»åºä¼æå½åææçæ°æ®é½å¤å¶ç»ä»åºã\n\nå¨ç¬¬äºé¶æ®µï¼ä¸»åºå°æææ°æ®åæ­¥ç»ä»åºãä»åºæ¶å°æ°æ®åï¼å¨æ¬å°å®ææ°æ®å è½½ãè¿ä¸ªè¿ç¨ä¾èµäºåå­å¿«ç§çæç rdb æä»¶ã\n\nå·ä½æ¥è¯´ï¼ä¸»åºæ§è¡ bgsave å½ä»¤ï¼çæ rdb æä»¶ï¼æ¥çå°æä»¶åç»ä»åºãä»åºæ¥æ¶å° rdb æä»¶åï¼ä¼åæ¸ç©ºå½åæ°æ®åºï¼ç¶åå è½½ rdb æä»¶ãè¿æ¯å ä¸ºä»åºå¨éè¿ replicaof å½ä»¤å¼å§åä¸»åºåæ­¥åï¼å¯è½ä¿å­äºå¶ä»æ°æ®ãä¸ºäºé¿åä¹åæ°æ®çå½±åï¼ä»åºéè¦åæå½åæ°æ®åºæ¸ç©ºã\n\nå¨ä¸»åºå°æ°æ®åæ­¥ç»ä»åºçè¿ç¨ä¸­ï¼ä¸»åºä¸ä¼è¢«é»å¡ï¼ä»ç¶å¯ä»¥æ­£å¸¸æ¥æ¶è¯·æ±ãå¦åï¼redis çæå¡å°±è¢«ä¸­æ­äºãä½æ¯ï¼è¿äºè¯·æ±ä¸­çåæä½å¹¶æ²¡æè®°å½å°ååçæç rdb æä»¶ä¸­ãä¸ºäºä¿è¯ä¸»ä»åºçæ°æ®ä¸è´æ§ï¼ä¸»åºä¼å¨åå­ä¸­ç¨ä¸é¨ç replication bufferï¼è®°å½ rdb æä»¶çæåæ¶å°çææåæä½ã\n\næåï¼ä¹å°±æ¯ç¬¬ä¸é¶æ®µï¼ä¸»åºä¼æç¬¬äºé¶æ®µæ§è¡è¿ç¨ä¸­æ°æ¶å°çåå½ä»¤ï¼ååéç»ä»åºãå·ä½çæä½æ¯ï¼å½ä¸»åºå®æ rdb æä»¶åéåï¼å°±ä¼ææ­¤æ¶ replication buffer ä¸­çä¿®æ¹æä½åç»ä»åºï¼ä»åºåéæ°æ§è¡è¿äºæä½ãè¿æ ·ä¸æ¥ï¼ä¸»ä»åºå°±å®ç°åæ­¥äºã\n\n\n# 1.2 ä¸»ä»çº§èæ¨¡å¼åæå¨éå¤å¶æ¶çä¸»åºåå\n\nå¨ä¸»ä»åæ­¥æ¶ï¼å¨éå¤å¶çé¶æ®µéè¦ä¸»åºå®æä¸¤ä¸ªèæ¶çæä½ï¼çæ rdb åä¼ è¾ rdbã\n\nè¥ä»åºæ°éå¾å¤ä¸é½éè¦è¿è¡å¨éå¤å¶ï¼ä¼è®©ä¸»åºå¿äº fork å­è¿ç¨çæ rdbï¼å¯¼è´ä¸»åºååºè¯·æ±éåº¦åæ¢ãåæ¶ä¼ è¾ rdb ä¹éè¦å ç¨ä¸»åºçå¸¦å®½ãé£ä¹ï¼ææ²¡æå¥½çè§£å³æ¹æ³æ¥åæä¸»åºååå¢ï¼è¿å°±æ¯âä¸»-ä»-ä»âæ¨¡å¼ã\n\nååä»ç»çä¸»ä»æ¨¡å¼ä¸­ï¼ææçä»åºé½æ¯ä»ä¸»åºåæ­¥èæ¥çï¼ç°å¨æä»¬å¯ä»¥éè¿âä¸»-ä»-ä»âçæ¨¡å¼å°ä¸»åºçæç rdb åä¼ è¾ rdb çååä»¥çº§èçæ¹å¼åæ£å°ä»åºä¸ã\n\nç®åæ¥è¯´ï¼æä»¬å¨é¨ç½²ä¸»ä»éç¾¤çæ¶åï¼å¯ä»¥æå¨éæ©ä¸ä¸ªä»åºï¼æ¯å¦éæ©åå­èµæºéç½®è¾é«çä»åºï¼ï¼ç¨äºçº§èå¶ä»çä»åºãç¶åï¼æä»¬å¯ä»¥åéæ©ä¸äºä»åºï¼ä¾å¦ä¸åä¹ä¸çä»åºï¼ï¼å¨è¿äºä»åºä¸æ§è¡å¦ä¸å½ä»¤ï¼è®©å®ä»¬ååææéçä»åºï¼å»ºç«èµ·ä¸»ä»å³ç³»ï¼\n\nreplicaof  æéä»åºçip 6379\n\n\n1\n\n\nè¿æ ·ä¸æ¥ï¼è¿äºä»åºå°±ä¼ç¥éï¼å¨è¿è¡åæ­¥æ¶ï¼ä¸ç¨ååä¸»åºè¿è¡äº¤äºäºï¼åªè¦åçº§èçä»åºè¿è¡åæä½åæ­¥å°±è¡äºï¼è¿å°±å¯ä»¥åè½»ä¸»åºä¸çååï¼å¦ä¸å¾æç¤ºï¼\n\nä»¥ä¸å°±æ¯âä¸»-ä»-ä»âæ¨¡å¼çåæ­¥ãä¸æ¦ä¸»ä»åºå®æäºå¨éå¤å¶ï¼å®ä»¬ä¹é´å°±ä¼ä¸ç´ç»´æ¤ä¸ä¸ªç½ç»è¿æ¥ï¼ä¸»åºä¼éè¿è¿ä¸ªè¿æ¥å°åç»­éç»­æ¶å°çå½ä»¤æä½ååæ­¥ç»ä»åºï¼è¿ä¸ªè¿ç¨ä¹ç§°ä¸ºåºäºé¿è¿æ¥çå½ä»¤ä¼ æ­ï¼å¯ä»¥é¿åé¢ç¹å»ºç«è¿æ¥çå¼éã\n\nè¿ä¸ªæ°æ®åæ­¥çè¿ç¨å­å¨ä¸ä¸ªé£é©ç¹ï¼ç½ç»æ­è¿æé»å¡ãå¦æç½ç»æ­è¿ï¼ä¸»ä»åºä¹é´å°±æ æ³è¿è¡å½ä»¤ä¼ æ­äºï¼ä»åºçæ°æ®èªç¶ä¹å°±æ²¡åæ³åä¸»åºä¿æä¸è´äºï¼å®¢æ·ç«¯å°±å¯è½ä»ä»åºè¯»å°æ§æ°æ®ãæ¥ä¸æ¥ï¼æä»¬å°±æ¥èèç½ç»æ­è¿åçè§£å³åæ³.\n\n\n# 1.3 ä¸»ä»åºé´ç½ç»æ­äºæä¹åï¼\n\nå¨ redis 2.8 ä¹åï¼å¦æä¸»ä»åºå¨å½ä»¤ä¼ æ­æ¶åºç°äºç½ç»éªæ­ï¼é£ä¹ï¼ä»åºå°±ä¼åä¸»åºéæ°è¿è¡ä¸æ¬¡å¨éå¤å¶ï¼å¼ééå¸¸å¤§ã\n\nä» redis 2.8 å¼å§ï¼ç½ç»æ­äºä¹åï¼ä¸»ä»åºä¼éç¨å¢éå¤å¶çæ¹å¼ç»§ç»­åæ­¥ãä¹å°±æ¯åªä¼æç½ç»æ­è¿æé´ä¸»åºæ¶å°çå½ä»¤ï¼åæ­¥ç»ä»åºã\n\né£ä¹ï¼å¢éå¤å¶æ¶ï¼ä¸»ä»åºä¹é´å·ä½æ¯æä¹ä¿æåæ­¥çå¢ï¼è¿éçå¥¥å¦å°±å¨äº repl_backlog_buffer è¿ä¸ªç¼å²åºãæä»¬åæ¥çä¸å®æ¯å¦ä½ç¨äºå¢éå½ä»¤çåæ­¥çã\n\nå½ä¸»ä»åºæ­è¿åï¼ä¸»åºä¼ææ­è¿æé´æ¶å°çåæä½å½ä»¤ï¼åå¥ replication buffer ï¼åæ¶ä¹ä¼æè¿äºæä½å½ä»¤ä¹åå¥ repl_backlog_buffer è¿ä¸ªç¼å²åºãrepl_backlog_buffer æ¯ä¸ä¸ªç¯å½¢ç¼å²åºï¼ä¸»åºä¼è®°å½èªå·±åå°çä½ç½®ï¼ä»åºåä¼è®°å½èªå·±å·²ç»è¯»å°çä½ç½®ã\n\nåå¼å§çæ¶åï¼ä¸»åºåä»åºçåè¯»ä½ç½®å¨ä¸èµ·ï¼è¿ç®æ¯å®ä»¬çèµ·å§ä½ç½®ãéçä¸»åºä¸æ­æ¥æ¶æ°çåæä½ï¼å®å¨ç¼å²åºä¸­çåä½ç½®ä¼éæ­¥åç¦»èµ·å§ä½ç½®ï¼æä»¬éå¸¸ç¨åç§»éæ¥è¡¡éè¿ä¸ªåç§»è·ç¦»çå¤§å°ï¼å¯¹ä¸»åºæ¥è¯´ï¼å¯¹åºçåç§»éå°±æ¯ master_repl_offsetãä¸»åºæ¥æ¶çæ°åæä½è¶å¤ï¼è¿ä¸ªå¼å°±ä¼è¶å¤§ãåæ ·ï¼ä»åºå¨å¤å¶å®åæä½å½ä»¤åï¼å®å¨ç¼å²åºä¸­çè¯»ä½ç½®ä¹å¼å§éæ­¥åç§»åæçèµ·å§ä½ç½®ï¼æ­¤æ¶ï¼ä»åºå·²å¤å¶çåç§»é slave_repl_offset ä¹å¨ä¸æ­å¢å ãæ­£å¸¸æåµä¸ï¼è¿ä¸¤ä¸ªåç§»éåºæ¬ç¸ç­ã\n\nä¸»ä»åºçè¿æ¥æ¢å¤ä¹åï¼ä»åºé¦åä¼ç»ä¸»åºåé psync å½ä»¤ï¼å¹¶æèªå·±å½åç slave_repl_offset åç»ä¸»åºï¼ä¸»åºä¼å¤æ­èªå·±ç master_repl_offset å slave_repl_offset ä¹é´çå·®è·ãå¨ç½ç»æ­è¿é¶æ®µï¼ä¸»åºå¯è½ä¼æ¶å°æ°çåæä½å½ä»¤ï¼æä»¥ï¼ä¸è¬æ¥è¯´ï¼master_repl_offset ä¼å¤§äº slave_repl_offsetãæ­¤æ¶ï¼ä¸»åºåªç¨æ master_repl_offset å slave_repl_offset ä¹é´çå½ä»¤æä½åæ­¥ç»ä»åºå°±è¡ã\n\nå°±åååç¤ºæå¾çä¸­é´é¨åï¼ä¸»åºåä»åºä¹é´ç¸å·®äº put d e å put d f ä¸¤ä¸ªæä½ï¼å¨å¢éå¤å¶æ¶ï¼ä¸»åºåªéè¦æå®ä»¬åæ­¥ç»ä»åºå°±è¡äºã\n\nè¯´å°è¿éï¼æä»¬ååå©ä¸å¼ å¾ï¼åé¡¾ä¸å¢éå¤å¶çæµç¨ï¼\n\nä¸è¿ç±äº repl_backlog_buffer æ¯ä¸ä¸ªç¯å½¢ç¼å²åºï¼æä»¥å¨ç¼å²åºåæ»¡åï¼ä¸»åºä¼ç»§ç»­åå¥ï¼æ­¤æ¶ï¼å°±ä¼è¦çæä¹ååå¥çæä½ãå¦æä»åºçè¯»åéåº¦æ¯è¾æ¢ï¼å°±æå¯è½å¯¼è´ä»åºè¿æªè¯»åçæä½è¢«ä¸»åºæ°åçæä½è¦çäºï¼è¿ä¼å¯¼è´ä¸»ä»åºé´çæ°æ®ä¸ä¸è´ãå æ­¤ï¼æä»¬è¦æ³åæ³é¿åè¿ä¸æåµï¼ä¸è¬èè¨ï¼æä»¬å¯ä»¥è°æ´ repl_backlog_size è¿ä¸ªåæ°ãè¿ä¸ªåæ°åæéçç¼å²ç©ºé´å¤§å°æå³ï¼ç¼å²ç©ºé´å¤§å° = ä¸»åºåå¥å½ä»¤éåº¦ * æä½å¤§å° - ä¸»ä»åºé´ç½ç»ä¼ è¾å½ä»¤éåº¦ * æä½å¤§å°ãå¨å®éåºç¨ä¸­ï¼èèå°å¯è½å­å¨ä¸äºçªåçè¯·æ±ååï¼æä»¬éå¸¸éè¦æè¿ä¸ªç¼å²ç©ºé´æ©å¤§ä¸åï¼å³ repl_backlog_size = ç¼å²ç©ºé´å¤§å° * 2ï¼è¿ä¹å°±æ¯ repl_backlog_size çæç»å¼ã\n\n> ä¸¾ä¸ªä¾å­ï¼å¦æä¸»åºæ¯ç§åå¥ 2000 ä¸ªæä½ï¼æ¯ä¸ªæä½çå¤§å°ä¸º 2kbï¼ç½ç»æ¯ç§è½ä¼ è¾ 1000 ä¸ªæä½ï¼é£ä¹ï¼æ 1000 ä¸ªæä½éè¦ç¼å²èµ·æ¥ï¼è¿å°±è³å°éè¦ 2mb çç¼å²ç©ºé´ãå¦åï¼æ°åçå½ä»¤å°±ä¼è¦çææ§æä½äºãä¸ºäºåºå¯¹å¯è½ççªåååï¼æä»¬æç»æ repl_backlog_size è®¾ä¸º 4mbã\n\nè¿æ ·ä¸æ¥ï¼å¢éå¤å¶æ¶ä¸»ä»åºçæ°æ®ä¸ä¸è´é£é©å°±éä½äºãä¸è¿ï¼å¦æå¹¶åè¯·æ±ééå¸¸å¤§ï¼è¿ä¸¤åçç¼å²ç©ºé´é½å­ä¸ä¸æ°æä½è¯·æ±çè¯ï¼æ­¤æ¶ï¼ä¸»ä»åºæ°æ®ä»ç¶å¯è½ä¸ä¸è´ãéå¯¹è¿ç§æåµï¼\n\n * ä¸æ¹é¢ï¼æ ¹æ®æå¡å¨çèµæºç»§ç»­éå½å¢å  repl_backlog_size å¼ã\n * ä¸æ¹é¢ï¼å¯ä»¥èèä½¿ç¨åçéç¾¤æ¥åæåä¸ªä¸»åºçè¯·æ±ååãï¼åé¢ä¼è®²ï¼\n\n\n# 1.4 å°ç»\n\nè¿ä¸èä¸»è¦è®²äº redis ä¸»ä»åæ­¥çä¸ç§æ¨¡å¼ï¼\n\n 1. å¨éå¤å¶ï¼ç¬¬ä¸æ¬¡åæ­¥ä¸å¯é¿åï¼èæ¶ãä¸ºåå°ä¸»åºçåæ­¥ååï¼å¼å¥äºâä¸»-ä»-ä»âççº§èæ¨¡å¼ã\n    \n    ð¡ å°å»ºè®®: ä¸ä¸ªrediså®ä¾çæ°æ®åºä¸è¦å¤ªå¤§ï¼ä¸ä¸ªå®ä¾å¤§å°å¨å gbçº§å«æ¯è¾åéï¼è¿æ ·å¯ä»¥åå°rdbæä»¶çæãä¼ è¾åéæ°å è½½çå¼éã\n\n 2. é¿è¿æ¥å¤å¶ï¼æ¯ä¸»ä»åºæ­£å¸¸è¿è¡åçå¸¸è§åæ­¥é¶æ®µï¼ä¸»ä»ä¹é´éè¿å½ä»¤ä¼ æ­å®ç°åæ­¥ã\n\n 3. å¢éå¤å¶ï¼åçç½ç»æ­è¿åï¼å°±éè¦å¢éå¤å¶æ¥ä¿è¯æ°æ®çåæ­¥ã\n    \n    éè¿è°å¤§ repl_backlog_size è¿ä¸ªåæ°ï¼å¯ä»¥åå°ä»åºå¨ç½ç»æ­è¿æ¶å¨éå¤å¶çé£é©ã\n\nä¸è¿ï¼ä¸»ä»æ¨¡å¼é¢ä¸´ä¸»åºæéçæ½å¨é£é©ï¼ä¸é¢å°èèä¸»åºæéåï¼ä¿è¯æå¡å¯é æ§çè§£å³æ¹æ¡ã\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼aofè®°å½çæä½å½ä»¤æ´å¨ï¼ç¸æ¯äºrdbä¸¢å¤±çæ°æ®æ´å°ãä¸ºä»ä¹ä¸»ä»åºé´çå¤å¶ä¸ä½¿ç¨ aofï¼\n\næä¸¤ä¸ªåå ï¼\n\n 1. rdb æä»¶æ¯äºè¿å¶æä»¶ï¼æ è®ºæ¯è¦æ rdb åå¥ç£çï¼è¿æ¯è¦éè¿ç½ç»ä¼ è¾ rdbï¼io æçé½æ¯è®°å½åä¼ è¾ aof çé«ã\n 2. å¨ä»åºç«¯è¿è¡æ¢å¤æ¶ï¼ç¨ rdb çæ¢å¤æçè¦é«äºç¨ aofã\n\næ¬èé®é¢ 2ï¼replication buffer å repl_backlog_buffer çåºå«ï¼\n\næ»çæ¥è¯´ï¼replication buffer æ¯ä¸»ä»åºå¨è¿è¡å¨éå¤å¶æ¶ï¼ä¸»åºä¸ç¨äºåä»åºè¿æ¥çå®¢æ·ç«¯ç bufferï¼è repl_backlog_buffer æ¯ä¸ºäºæ¯æä»åºå¢éå¤å¶ï¼ä¸»åºä¸ç¨äºæç»­ä¿å­åæä½çä¸åä¸ç¨ bufferã\n\nredisä¸»ä»åºå¨è¿è¡å¤å¶æ¶ï¼å½ä¸»åºè¦æå¨éå¤å¶æé´çåæä½å½ä»¤åç»ä»åºæ¶ï¼ä¸»åºçæä½ï¼\n\n * ååå»ºä¸ä¸ªå®¢æ·ç«¯ï¼ç¨æ¥è¿æ¥ä»åº\n * éè¿è¿ä¸ªå®¢æ·ç«¯ï¼æåæä½å½ä»¤åç»ä»åº\n\nå¨åå­ä¸­ï¼ä¸»åºä¸çå®¢æ·ç«¯å°±ä¼å¯¹åºä¸ä¸ª bufferï¼è¿ä¸ª buffer å°±è¢«ç§°ä¸º replication bufferãrediséè¿ client_buffer éç½®é¡¹æ¥æ§å¶è¿ä¸ª buffer çå¤§å°ãä¸»åºä¼ç»æ¯ä¸ªä»åºå»ºç«ä¸ä¸ªå®¢æ·ç«¯ï¼æä»¥ replication buffer ä¸æ¯å±äº«çï¼èæ¯æ¯ä¸ªä»åºé½æä¸ä¸ªå¯¹åºçå®¢æ·ç«¯ã\n\nrepl_backlog_buffer æ¯ä¸åä¸ç¨ bufferï¼å¨ redis æå¡å¨å¯å¨åï¼å¼å§ä¸ç´æ¥æ¶åæä½å½ä»¤ï¼æä»¥ repl_backlog_buffer æ¯ææä»åºå±äº«çãä¸»åºåä»åºä¼åèªè®°å½èªå·±çå¤å¶è¿åº¦ï¼æä»¥ï¼ä¸åçä»åºå¨è¿è¡æ¢å¤æ¶ï¼ä¼æèªå·±çå¤å¶è¿åº¦ï¼slave_repl_offsetï¼åç»ä¸»åºï¼ä¸»åºå°±å¯ä»¥åå®ç¬ç«åæ­¥ã\n\n\n# 2. å¨åµæºå¶ï¼ä¸»åºæäºï¼å¦ä½ä¸é´æ­æå¡ï¼\n\nä¸èå­¦ä¹ äºä¸»ä»åºçéç¾¤æ¨¡å¼ï¼å¨è¿ä¸ªæ¨¡å¼ä¸ï¼å¦æä»åºåçæéäºï¼å®¢æ·ç«¯å¯ä»¥ç»§ç»­åä¸»åºæå¶ä»ä»åºåéè¯·æ±ï¼ä½æ¯å¦æä¸»åºåçæéäºï¼ä»åºå°±æ²¡æä¸»åºå¯ä»¥è¿è¡æ°æ®å¤å¶äºãå¦æè¯·æ±æ¯åªè¯»çè¯è¿å¥½ï¼ä½å¦ææåè¯·æ±ï¼é£ä¹æ­¤æ¶å°±æ²¡æå®ä¾å¯ä»¥å®æè¿ä¸ªæä½äºãè¿ç§æåµæ¯ä¸å¯æ¥åçã\n\næä»¥ï¼å¦æä¸»åºæäºï¼æä»¬å°±éè¦è¿è¡ä¸ä¸ªæ°ä¸»åºï¼æ¯å¦è¯´æä¸ä¸ªä»åºåæ¢ä¸ºä¸»åºï¼ä½è¿å°±æ¶åå°ä¸ä¸ªé®é¢ï¼\n\n 1. ä¸»åºççæäºåï¼\n 2. è¯¥éæ©åªä¸ªä»åºä½ä¸ºä¸»åºï¼\n 3. æä¹ææ°ä¸»åºçç¸å³ä¿¡æ¯éç¥ç»ä»åºåå®¢æ·ç«¯å¢ï¼\n\nè¿å°±è¦æå°å¨åµæºå¶äºãå¨ redis ä¸»ä»éç¾¤ä¸­ï¼å¨åµæºå¶æ¯å®ç°ä¸»ä»åºèªå¨åæ¢çå³é®æºå¶ï¼å®ææå°è§£å³äºä¸»ä»å¤å¶æ¨¡å¼ä¸æéè½¬ç§»çè¿ä¸ä¸ªé®é¢ã\n\n\n# 2.1 å¨åµæºå¶çåºæ¬æµç¨\n\nå¨åµå¶å®å°±æ¯ä¸ä¸ªè¿è¡å¨ç¹æ®æ¨¡å¼ä¸ç redis è¿ç¨ï¼ä¸»ä»åºå®ä¾è¿è¡çåæ¶ï¼å®ä¹å¨è¿è¡ãå¨åµä¸»è¦è´è´£çå°±æ¯ä¸ä¸ªä»»å¡ï¼çæ§ãéä¸»ï¼éæ©ä¸»åºï¼åéç¥ã\n\n * çæ§æ¯æå¨åµè¿ç¨å¨è¿è¡æ¶ï¼å¨ææ§å°ç»ææçä¸»ä»åºåé ping å½ä»¤ï¼æ£æµå®ä»¬æ¯å¦ä»ç¶å¨çº¿è¿è¡ãå¦æä»åºæ²¡æå¨è§å®æ¶é´åååºå¨åµçpingå½ä»¤ï¼å¨åµå°±ä¼æå®æ è®°ä¸ºâä¸çº¿ç¶æâï¼åæ ·ï¼å¦æä¸»åºä¹æ²¡æå¨è§å®æ¶é´åååºå¨åµçpingå½ä»¤ï¼å¨åµå°±ä¼å¤å®ä¸»åºä¸çº¿ï¼ç¶åå¼å§èªå¨åæ¢ä¸»åºçæµç¨ã\n * èªå¨åæ¢ä¸»åºçæµç¨å°±æ¯å¨åµçéä¸»çä»»å¡ï¼ä¸»åºæäºä»¥åï¼å¨åµå°±éè¦ä»å¾å¤ä¸ªä»åºéï¼æç§ä¸å®çè§åéæ©ä¸ä¸ªä»åºå®ä¾ï¼æå®ä½ä¸ºæ°çä¸»åºãè¿ä¸æ­¥å®æåï¼ç°å¨çéç¾¤éå°±æäºæ°ä¸»åºã\n * ç¶åï¼å¨åµä¼æ§è¡æåä¸ä¸ªä»»å¡ï¼éç¥ï¼å¨åµææ°ä¸»åºçè¿æ¥ä¿¡æ¯åç»å¶ä»ä»åºï¼è®©å®ä»¬æ§è¡ replicaof å½ä»¤ï¼åæ°ä¸»åºå»ºç«è¿æ¥ï¼å¹¶è¿è¡æ°æ®å¤å¶ãåæ¶ï¼å¨åµä¼ææ°ä¸»åºçè¿æ¥ä¿¡æ¯éç¥ç»å®¢æ·ç«¯ï¼è®©å®ä»¬æè¯·æ±æä½åå°æ°ä¸»åºä¸ã\n\nå¨è¿ä¸ä¸ªä»»å¡ä¸­ï¼éç¥ä»»å¡ç¸å¯¹æ¥è¯´æ¯è¾ç®åï¼å¨åµåªéè¦ææ°ä¸»åºä¿¡æ¯åç»ä»åºåå®¢æ·ç«¯ï¼è®©å®ä»¬åæ°ä¸»åºå»ºç«è¿æ¥å°±è¡ï¼å¹¶ä¸æ¶åå³ç­çé»è¾ãä½æ¯ï¼å¨çæ§åéä¸»è¿ä¸¤ä¸ªä»»å¡ä¸­ï¼å¨åµéè¦ååºä¸¤ä¸ªå³ç­ï¼\n\n * å¨çæ§ä»»å¡ä¸­ï¼å¨åµéè¦å¤æ­ä¸»åºæ¯å¦å¤äºä¸çº¿ç¶æï¼\n * å¨éä¸»ä»»å¡ä¸­ï¼å¨åµä¹è¦å³å®éæ©åªä¸ªä»åºå®ä¾ä½ä¸ºä¸»åºã\n\næ¥ä¸æ¥åè¯´ä¸ä¸å¦ä½å¤æ­ä¸»åºçä¸çº¿ç¶æãå¨åµå¯¹ä¸»åºçä¸çº¿å¤æ­æâä¸»è§ä¸çº¿âåâå®¢è§ä¸çº¿âä¸¤ç§ã\n\n\n# 2.2 ä¸»è§ä¸çº¿åå®¢è§ä¸çº¿\n\næåè§£éä¸ä»ä¹æ¯âä¸»è§ä¸çº¿âã\n\nå¨åµè¿ç¨ä¼ä½¿ç¨ ping å½ä»¤æ£æµå®èªå·±åä¸»ãä»åºçç½ç»è¿æ¥æåµï¼ç¨æ¥å¤æ­å®ä¾çç¶æãå¦æå¨åµåç°ä¸»åºæä»åºå¯¹ ping å½ä»¤çååºè¶æ¶äºï¼é£ä¹ï¼å¨åµå°±ä¼åæå®æ è®°ä¸ºâä¸»è§ä¸çº¿âï¼\n\n * å¦ææ£æµçæ¯ä»åºï¼é£ä¹å¨åµç®åå°æå®æ è®°ä¸ºä¸»è§ä¸çº¿å°±è¡äºï¼å ä¸ºä»åºçä¸çº¿å½±åä¸è¬ä¸å¤ªå¤§ï¼éç¾¤çå¯¹å¤æå¡ä¸ä¼é´æ­ã\n * ä½å¦ææ£æµæ¯ä¸»åºï¼é£ä¹å¨åµå¨æ è®°ä¸ºä¸»è§ä¸çº¿åï¼è¿éè¦å¼å¯ä¸»ä»åæ¢ã\n\nä½å­å¨å¨åµè¯¯å¤ä¸»åºçä¸çº¿ç¶æçé®é¢ï¼å ä¸ºä¸æ¦å¼å¯ä¸»ä»åæ¢ï¼å°±ä¼å¸¦æ¥é¢å¤å¼éï¼å æ­¤éè¦ç¹å«æ³¨æé¿åè¯¯å¤çæåµãè¯¯å¤å°±æ¯è¯´ä¸»åºå®éæ²¡æä¸çº¿ï¼ä½å¨åµè¯¯ä»¥ä¸ºå®ä¸çº¿äºï¼è¿éå¸¸åçå¨éç¾¤çç½ç»ååè¾å¤§çæåµä¸ã\n\nè¯¯å¤ä¹åä¼äº§çä»ä¹å¼éï¼\n\nä¸æ¦å¨åµå¤æ­ä¸»åºä¸çº¿äºï¼å°±ä¼å¼å§éæ©æ°ä¸»åºï¼å¹¶è®©ä»åºåæ°ä¸»åºè¿è¡æ°æ®åæ­¥ï¼è¿ä¸ªè¿ç¨æ¬èº«å°±ä¼æå¼éï¼ä¾å¦ï¼å¨åµè¦è±æ¶é´éåºæ°ä¸»åºï¼ä»åºä¹éè¦è±æ¶é´åæ°ä¸»åºåæ­¥ãèå¨è¯¯å¤çæåµä¸ï¼ä¸»åºæ¬èº«æ ¹æ¬å°±ä¸éè¦è¿è¡åæ¢çï¼æä»¥è¿ä¸ªè¿ç¨çå¼éæ¯æ²¡æä»·å¼çã\n\né£ææ ·åå°è¯¯å¤å¢ï¼å¨åµæºå¶éå¸¸ä¼ç±å¤å°å®ä¾ç»æä¸ä¸ªå¨åµéç¾¤ï¼è®©å¤ä¸ªå¨åµå®ä¾ä¸èµ·æ¥å¤æ­ï¼ä»èé¿ååä¸ªå¨åµå ç½ç»é®é¢èå¯¼è´çè¯¯å¤ãè¿æ ·ï¼åªæå½å¤§å¤æ°çå¨åµé½è®¤ä¸ºä¸»åºå·²ç»ä¸»è§ä¸çº¿äºï¼é£ä¸»åºæè¢«æ è®°ä¸ºå®¢è§ä¸çº¿ãè¿ä¸ªå«æ³è¡¨æä¸»åºä¸çº¿æä¸ºä¸ä¸ªå®¢è§äºå®äºï¼å¤æ­çååå°±æ¯å°æ°æä»å¤æ°ãè¿æ¶ä¼è¿ä¸æ­¥åºåå¨åµè¿è¡ä¸»ä»åæ¢çæµç¨ã\n\nä¸è¿°æ è®°ä¸ºâä¸»è§ä¸çº¿âåâå®¢è§ä¸çº¿âçæµç¨å¦ä¸å¾æç¤ºï¼\n\nç®åæ¥è¯´ï¼âå®¢è§ä¸çº¿âçæ åå°±æ¯ï¼å½æ n ä¸ªå¨åµå®ä¾æ¶ï¼æå¥½è¦æ n/2 + 1 ä¸ªå®ä¾å¤æ­ä¸»åºä¸ºâä¸»è§ä¸çº¿âï¼æè½æç»å¤å®ä¸»åºä¸ºâå®¢è§ä¸çº¿âãè¿æ ·ä¸æ¥ï¼å°±å¯ä»¥åå°è¯¯å¤çæ¦çï¼ä¹è½é¿åè¯¯å¤å¸¦æ¥çæ è°çä¸»ä»åºåæ¢ãï¼å½ç¶ï¼æå¤å°ä¸ªå®ä¾ååºâä¸»è§ä¸çº¿âçå¤æ­æå¯ä»¥ï¼å¯ä»¥ç± redis ç®¡çåèªè¡è®¾å®ï¼\n\nå°è¿éæä»¬å¯ä»¥çå°ï¼åå©äºå¤ä¸ªå¨åµå®ä¾æ¥å±åå¤æ­ä¸»åºæ¯å¦å¤äºä¸çº¿ç¶æãå¦æä¸»åºçç¡®ä¸çº¿äºï¼å¨åµå°±è¦å¼å§ä¸ä¸ä¸ªå³ç­è¿ç¨ï¼éä¸»ã\n\n\n# 2.3 å¦ä½éå®æ°ä¸»åºï¼\n\nå¨åµéæ©æ°ä¸»åºçè¿ç¨å¯ä»¥ç§°ä¸ºâç­é+æåâï¼\n\n * ç­éï¼å¨å¤ä¸ªä»åºä¸­æç§ä¸å®çç­éæ¡ä»¶æ¥å»æä¸ç¬¦åæ¡ä»¶çä»åºã\n * æåï¼åæç§ä¸å®çè§åï¼ç»å©ä¸çä»åºéä¸ªæåï¼è¯éå¾åæé«çä»åºä¸ºæ°ä¸»åºã\n\nè¿ä¸ªè¿ç¨å¦ä¸å¾æç¤ºï¼\n\nå¨ååé£æ®µè¯ä¸­ï¼æä¸¤ä¸ªâä¸å®âï¼æä»¬ççåå«æ¯ä»ä¹ï¼\n\n# 2.3.1 ç­é\n\næä»¬å¨å¤ä¸ªä»åºä¸­éä¸»çæ¶åï¼é¤äºè¦æ£æ¥ä»åºçå½åå¨çº¿ç¶æï¼è¿è¦å¤æ­å®ä¹åçç½ç»è¿æ¥ç¶æï¼ä»èéåºç½ç»æåµæå¥½çå®ä¾ãå¦æä»åºæ»æ¯åä¸»åºæ­è¿ï¼èä¸æ­è¿æ¬¡æ°è¶åºäºä¸å®çéå¼ï¼æä»¬å°±æçç±ç¸ä¿¡ï¼è¿ä¸ªä»åºçç½ç»ç¶åµå¹¶ä¸æ¯å¤ªå¥½ï¼å°±å¯ä»¥æè¿ä¸ªä»åºç­æäºã\n\nå·ä½æä¹å¤æ­å¢ï¼ä½ ä½¿ç¨éç½®é¡¹ down-after-milliseconds * 10ãå¶ä¸­ï¼down-after-milliseconds æ¯æä»¬è®¤å®ä¸»ä»åºæ­è¿çæå¤§è¿æ¥è¶æ¶æ¶é´ãå¦æå¨ down-after-milliseconds æ¯«ç§åï¼ä¸»ä»èç¹é½æ²¡æéè¿ç½ç»èç³»ä¸ï¼æä»¬å°±å¯ä»¥è®¤ä¸ºä¸»ä»èç¹æ­è¿äºãå¦æåçæ­è¿çæ¬¡æ°è¶è¿äº 10 æ¬¡ï¼å°±è¯´æè¿ä¸ªä»åºçç½ç»ç¶åµä¸å¥½ï¼ä¸éåä½ä¸ºæ°ä¸»åºã\n\nç±æ­¤å°±è¿æ»¤æäºä¸åéåä¸»åºçä»åºï¼å®æäºç­éå·¥ä½ã\n\n# 2.3.2 æå\n\næ¥ä¸æ¥å°±è¦ç»å©ä½çä»åºæåäºãæä»¬å¯ä»¥åå«æç§ä¸ä¸ªè§åä¾æ¬¡è¿è¡ä¸è½®æåï¼\n\n 1. ä»åºä¼åçº§\n 2. ä»åºå¤å¶è¿åº¦\n 3. ä»åº id å·\n\nåªè¦å¨æä¸è½®ä¸­ï¼æä»åºå¾åæé«ï¼é£ä¹å®å°±æ¯ä¸»åºäºï¼éä¸»è¿ç¨å°æ­¤ç»æãå¦ææ²¡æåºç°å¾åæé«çä»åºï¼é£ä¹å°±ç»§ç»­è¿è¡ä¸ä¸è½®ã\n\nç¬¬ä¸è½®ï¼ä¼åçº§æé«çä»åºå¾åé«ã\n\nç¨æ·å¯ä»¥éè¿ slave-priority éç½®é¡¹ï¼ç»ä¸åçä»åºè®¾ç½®ä¸åä¼åçº§ãæ¯å¦ï¼ä½ æä¸¤ä¸ªä»åºï¼å®ä»¬çåå­å¤§å°ä¸ä¸æ ·ï¼ä½ å¯ä»¥æå¨ç»åå­å¤§çå®ä¾è®¾ç½®ä¸ä¸ªé«ä¼åçº§ãå¨éä¸»æ¶ï¼å¨åµä¼ç»ä¼åçº§é«çä»åºæé«åï¼å¦ææä¸ä¸ªä»åºä¼åçº§æé«ï¼é£ä¹å®å°±æ¯æ°ä¸»åºäºãå¦æä»åºçä¼åçº§é½ä¸æ ·ï¼é£ä¹å¨åµå¼å§ç¬¬äºè½®æåã\n\nç¬¬äºè½®ï¼åæ§ä¸»åºåæ­¥ç¨åº¦ææ¥è¿çä»åºå¾åé«ã\n\nè¿ä¸ªè§åçä¾æ®æ¯ï¼å¦æéæ©åæ§ä¸»åºåæ­¥ææ¥è¿çé£ä¸ªä»åºä½ä¸ºä¸»åºï¼é£ä¹ï¼è¿ä¸ªæ°ä¸»åºä¸å°±æææ°çæ°æ®ãå¶å®ä¹å°±æ¯åªä¸ªä»åºç slave_repl_offset ææ¥è¿ä¸»åºç master_repl_offset è°å°±å¾åé«(å¨ repl_backlog_buffer ä¸­çä½ç½®)ãå¦ä¸å¾æç¤ºï¼\n\nç¬¬ä¸è½®ï¼idå·å°çä»åºå¾åé«ã\n\næ¯ä¸ªå®ä¾é½ä¼æä¸ä¸ªidï¼è¿ä¸ªidå°±ç±»ä¼¼äºè¿éçä»åºçç¼å·ãç®åï¼redis å¨éä¸»åºæ¶ï¼æä¸ä¸ªé»è®¤çè§å®ï¼å¨ä¼åçº§åå¤å¶è¿åº¦é½ç¸åçæåµä¸ï¼id å·æå°çä»åºå¾åæé«ï¼ä¼è¢«éä¸ºæ°ä¸»åºã\n\nå°è¿éï¼âéä¸»âè¿ä¸ªè¿ç¨å°±å®æäºãæä»¬å¨åé¡¾ä¸ä¸è¿ä¸ªæµç¨ï¼\n\n * é¦åï¼å¨åµä¼æç§å¨çº¿ç¶æãç½ç»ç¶æï¼ç­éè¿æ»¤æä¸é¨åä¸ç¬¦åè¦æ±çä»åºï¼\n * ç¶åï¼ä¾æ¬¡æç§ä¼åçº§ãå¤å¶è¿åº¦ãid å·å¤§å°åå¯¹å©ä½çä»åºè¿è¡æåï¼åªè¦æå¾åæé«çä»åºåºç°ï¼å°±æå®éä¸ºæ°ä¸»åºã\n\n\n# 2.4 å°ç»\n\nå¨åµæºå¶æ¯å®ç° redis ä¸é´æ­æå¡çéè¦ä¿è¯ï¼å®èªå¨å®æäºä»¥ä¸ä¸ä¸ªåè½ï¼å¹¶å®ç°äºä¸»ä»åæ¢ï¼\n\n * çæ§ä¸»åºè¿è¡ç¶æï¼å¹¶å¤æ­ä¸»åºæ¯å¦å®¢è§ä¸çº¿ï¼\n * å¨ä¸»åºå®¢è§ä¸çº¿åï¼éåæ°ä¸»åºï¼\n * éåºæ°ä¸»åºåï¼éç¥ä»åºåå®¢æ·ç«¯ã\n\nä¸ºäºéä½è¯¯å¤çï¼å¨åµæºå¶éå¸¸éç¨å¤å®ä¾é¨ç½²ï¼éè¿âå°æ°æä»å¤æ°âçååï¼æ¥å¤æ­ä¸»åºæ¯å¦å®¢è§ä¸çº¿ã\n\nä½å¨åµéç¾¤åæ¶ä¹å¸¦æ¥äºé®é¢ï¼\n\n * å¨åµéç¾¤ä¸­æå®ä¾æäºï¼æä¹åï¼ä¼å½±åä¸»åºç¶æå¤æ­åéä¸»åï¼\n * å¨åµéç¾¤å¤æ°å®ä¾è¾¾æå±è¯ï¼å¤æ­åºä¸»åºâå®¢è§ä¸çº¿âåï¼ç±åªä¸ªå®ä¾æ¥æ§è¡ä¸»ä»åæ¢å¢ï¼\n\nä¸ºäºææè¿äºé®é¢ï¼éè¦è¿ä¸æ­¥äºè§£å¨åµéç¾¤ã\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼å¨ä¸»ä»åæ¢è¿ç¨ä¸­ï¼å®¢æ·ç«¯è½å¦æ­£å¸¸å°è¿è¡è¯·æ±æä½å¢ï¼\n\nä¸»ä»éç¾¤ä¸è¬æ¯éç¨è¯»ååç¦»æ¨¡å¼ï¼å½ä¸»åºæéåï¼å®¢æ·ç«¯ä»ç¶å¯ä»¥æè¯»è¯·æ±åéç»ä»åºï¼è®©ä»åºæå¡ãä½æ¯ï¼å¯¹äºåè¯·æ±æä½ï¼å®¢æ·ç«¯å°±æ æ³æ§è¡äºã\n\næ¬èé®é¢ 2ï¼å¦ææ³è¦åºç¨ç¨åºä¸æç¥æå¡çä¸­æ­ï¼è¿éè¦å¨åµæå®¢æ·ç«¯ååäºä»ä¹åï¼\n\n * ä¸æ¹é¢ï¼å®¢æ·ç«¯éè¦è½ç¼å­åºç¨åéçåè¯·æ±ãåªè¦ä¸æ¯åæ­¥åæä½ï¼redis åºç¨åºæ¯ä¸è¬ä¹æ²¡æåæ­¥åï¼ï¼åè¯·æ±éå¸¸ä¸ä¼å¨åºç¨ç¨åºçå³é®è·¯å¾ä¸ï¼æä»¥ï¼å®¢æ·ç«¯ç¼å­åè¯·æ±åï¼ç»åºç¨ç¨åºè¿åä¸ä¸ªç¡®è®¤å°±è¡ã\n * å¦ä¸æ¹é¢ï¼ä¸»ä»åæ¢å®æåï¼å®¢æ·ç«¯è¦è½åæ°ä¸»åºéæ°å»ºç«è¿æ¥ï¼å¨åµéè¦æä¾è®¢éé¢éï¼è®©å®¢æ·ç«¯è½å¤è®¢éå°æ°ä¸»åºçä¿¡æ¯ãåæ¶ï¼å®¢æ·ç«¯ä¹éè¦è½ä¸»å¨åå¨åµéä¿¡ï¼è¯¢é®æ°ä¸»åºçä¿¡æ¯ã\n\n\n# 3. å¨åµéç¾¤ï¼å¨åµæäºï¼ä¸»ä»åºè¿è½åæ¢åï¼\n\nä¸èè®²çå¨åµæºå¶å®ç°äºä¸»ä»åæ¢ï¼ä½å¦ææå¨åµå®ä¾å¨è¿è¡æ¶åçäºæéï¼ä¸»ä»åºè¿è½æ­£å¸¸åæ¢åï¼å®éä¸ï¼ä¸æ¦å¤ä¸ªå®ä¾ç»æäºå¨åµéç¾¤ï¼å³ä½¿æå¨åµå®ä¾ææäºï¼å¶ä»å¨åµè¿è½ç»§ç»­åä½å®æä¸»ä»åæ¢çå·¥ä½ï¼åæ¬å¤å®ä¸»åºæ¯ä¸æ¯å¤äºä¸çº¿ç¶æãéæ©æ°ä¸»åºï¼ä»¥åéç¥ä»åºåå®¢æ·ç«¯ã\n\nå¦æä½ é¨ç½²è¿å¨åµéç¾¤çè¯å°±ä¼ç¥éï¼å¨éç½®å¨åµçä¿¡æ¯æ¶ï¼æä»¬åªéè¦ç¨å°ä¸é¢çè¿ä¸ªéç½®é¡¹ï¼å³è®¾ç½®ä¸»åºç ipåç«¯å£ï¼å¹¶æ²¡æéç½®å¶ä»å¨åµçè¿æ¥ä¿¡æ¯ï¼\n\nsentinel monitor <master-name> <ip> <redis-port> <quorum>\n\n\n1\n\n\nè¿äºå¨åµå®ä¾æ¢ç¶é½ä¸ç¥éå½¼æ­¤çå°åï¼åæ¯æä¹ç»æéç¾¤çå¢ï¼è¦å¼æç½è¿ä¸ªé®é¢ï¼æä»¬å°±éè¦å­¦ä¹ ä¸ä¸å¨åµéç¾¤çç»æåè¿è¡æºå¶äºã\n\n\n# 3.1 åºäº pub/sub æºå¶çå¨åµéç¾¤ç»æ\n\nå¨åµå®ä¾ä¹é´å¯ä»¥ç¸äºåç°ï¼è¦å½åäº redis æä¾ç pub/sub æºå¶ï¼ä¹å°±æ¯åå¸/è®¢éæºå¶ãå¨åµåªè¦åä¸»åºå»ºç«èµ·äºè¿æ¥ï¼å°±å¯ä»¥å¨ä¸»åºä¸åå¸æ¶æ¯äºï¼æ¯å¦è¯´åå¸å®èªå·±çè¿æ¥ä¿¡æ¯ï¼ipåç«¯å£ï¼ãåæ¶ï¼å®ä¹å¯ä»¥ä»ä¸»åºä¸è®¢éæ¶æ¯ï¼è·å¾å¶ä»å¨åµåå¸çè¿æ¥ä¿¡æ¯ãå½å¤ä¸ªå¨åµå®ä¾é½å¨ä¸»åºä¸åäºåå¸åè®¢éæä½åï¼å®ä»¬ä¹é´å°±è½ç¥éå½¼æ­¤ç ip å°ååç«¯å£ã\n\né¤äºå¨åµå®ä¾ï¼æä»¬èªå·±ç¼åçåºç¨ç¨åºä¹å¯ä»¥éè¿redisè¿è¡æ¶æ¯çåå¸åè®¢éãæä»¥ï¼ä¸ºäºåºåä¸ååºç¨çæ¶æ¯ï¼redis ä¼ä»¥é¢éçå½¢å¼ï¼å¯¹è¿äºæ¶æ¯è¿è¡åé¨å«ç±»çç®¡çãæè°çé¢éï¼å®éä¸å°±æ¯æ¶æ¯çç±»å«ãå½æ¶æ¯ç±»å«ç¸åæ¶ï¼å®ä»¬å°±å±äºåä¸ä¸ªé¢éãåä¹ï¼å°±å±äºä¸åçé¢éãåªæè®¢éäºåä¸ä¸ªé¢éçåºç¨ï¼æè½éè¿åå¸çæ¶æ¯è¿è¡ä¿¡æ¯äº¤æ¢ã\n\nå¨ä¸»ä»éç¾¤ä¸­ï¼ä¸»åºä¸æä¸ä¸ªåä¸º __sentinel__: hello çé¢éï¼ä¸åå¨åµå°±æ¯éè¿å®æ¥ç¸äºåç°ï¼å®ç°äºç¸éä¿¡çãå¦ä¸å¾ç¤ºä¾ï¼\n\nåå©äºä¸å¾æç¤ºç pub/sub æºå¶ï¼å¨åµéç¾¤å°±å½¢æäºï¼å®ä»¬ä¹é´å¯ä»¥éè¿ç½ç»è¿æ¥è¿è¡éä¿¡ï¼å¹¶å¯¹ä¸»åºæ¯å¦ä¸çº¿çå¤æ­è¿è¡ååãå¨åµé¤äºå½¼æ­¤ä¹é´å»ºç«èµ·è¿æ¥å½¢æéç¾¤å¤ï¼è¿éè¦åä»åºå»ºç«è¿æ¥ãè¿æ¯å ä¸ºï¼å¨å¨åµççæ§ä»»å¡ä¸­ï¼å®éè¦å¯¹ä¸»ä»åºé½è¿è¡å¿è·³å¤æ­ï¼èä¸å¨ä¸»ä»åºåæ¢å®æåï¼å®è¿éè¦éç¥ä»åºï¼è®©å®ä»¬åæ°ä¸»åºè¿è¡åæ­¥ã\n\né£ä¹ï¼ å¨åµæ¯å¦ä½ç¥éä»åºç ip å°ååç«¯å£çå¢ï¼å¦ä¸å¾æç¤ºï¼è¿æ¯ç±å¨åµåä¸»åºåé info å½ä»¤æ¥å®æçï¼ç¶åä¸»åºä¼ååºç»å¨åµä¸ä¸ª slave åè¡¨ãç±æ­¤ï¼å¨åµå°±å¯ä»¥ä¸ä»åºå»ºç«è¿æ¥äºã\n\nä½ çï¼éè¿ pub/sub æºå¶ï¼å¨åµä¹é´å¯ä»¥ç»æéç¾¤ï¼åæ¶ï¼å¨åµåéè¿ info å½ä»¤ï¼è·å¾äºä»åºè¿æ¥ä¿¡æ¯ï¼ä¹è½åä»åºå»ºç«è¿æ¥ï¼å¹¶è¿è¡çæ§äºã\n\nä½æ¯ï¼å¨åµä¸è½åªåä¸»ãä»åºè¿æ¥ãå ä¸ºä¸»ä»åºåæ¢åï¼å®¢æ·ç«¯ä¹éè¦ç¥éæ°ä¸»åºçè¿æ¥ä¿¡æ¯ï¼æè½åæ°ä¸»åºåéè¯·æ±æä½ãæä»¥ï¼å¨åµè¿éè¦å®æææ°ä¸»åºçä¿¡æ¯åè¯å®¢æ·ç«¯è¿ä¸ªä»»å¡ãèä¸ï¼å¨å®éä½¿ç¨å¨åµæ¶ï¼æä»¬ææ¶ä¼éå°è¿æ ·çé®é¢ï¼å¦ä½å¨å®¢æ·ç«¯éè¿çæ§äºè§£å¨åµè¿è¡ä¸»ä»åæ¢çè¿ç¨å¢ï¼æ¯å¦è¯´ï¼ä¸»ä»åæ¢è¿è¡å°åªä¸æ­¥äºï¼è¿å¶å®å°±æ¯è¦æ±ï¼å®¢æ·ç«¯è½å¤è·åå°å¨åµéç¾¤å¨çæ§ãéä¸»ãåæ¢è¿ä¸ªè¿ç¨ä¸­åççåç§äºä»¶ã\n\næ­¤æ¶ï¼æä»¬ä»ç¶å¯ä»¥ä¾èµ pub/sub æºå¶ï¼æ¥å¸®å©æä»¬å®æå¨åµåå®¢æ·ç«¯é´çä¿¡æ¯åæ­¥ã\n\n\n# 3.2 åºäº pub/sub æºå¶çå®¢æ·ç«¯äºä»¶éç¥\n\nä»æ¬è´¨ä¸è¯´ï¼å¨åµå°±æ¯ä¸ä¸ªè¿è¡å¨ç¹å®æ¨¡å¼ä¸ç redis å®ä¾ï¼åªä¸è¿å®å¹¶ä¸æå¡è¯·æ±æä½ï¼åªæ¯å®æçæ§ãéä¸»åéç¥çä»»å¡ãæä»¥ï¼æ¯ä¸ªå¨åµå®ä¾ä¹æä¾ pub/sub æºå¶ï¼å®¢æ·ç«¯å¯ä»¥ä»å¨åµè®¢éæ¶æ¯ãå¨åµæä¾çæ¶æ¯è®¢éé¢éæå¾å¤ï¼ä¸åé¢éåå«äºä¸»ä»åºåæ¢è¿ç¨ä¸­çä¸åå³é®äºä»¶ãä¸é¢ååºäºä¸äºéè¦çé¢éï¼\n\nç¥éäºè¿äºé¢éä¹åï¼ä½ å°±å¯ä»¥è®©å®¢æ·ç«¯ä»å¨åµé£éè®¢éæ¶æ¯äºãå·ä½çæä½æ­¥éª¤æ¯ï¼å®¢æ·ç«¯è¯»åå¨åµçéç½®æä»¶åï¼å¯ä»¥è·å¾å¨åµçå°ååç«¯å£ï¼åå¨åµå»ºç«ç½ç»è¿æ¥ãç¶åï¼æä»¬å¯ä»¥å¨å®¢æ·ç«¯æ§è¡è®¢éå½ä»¤ï¼æ¥è·åä¸åçäºä»¶æ¶æ¯ã\n\nä¸¾ä¸ªä¾å­ï¼ä½ å¯ä»¥æ§è¡ subscribe +odown å½ä»¤ï¼æ¥è®¢éâææå®ä¾è¿å¥å®¢è§ä¸çº¿ç¶æçäºä»¶âï¼ä¹å¯ä»¥æ§è¡ psubscribe * æ¥è®¢éææçäºä»¶ã\n\nå½å¨åµææ°ä¸»åºéæ©åºæ¥åï¼å®¢æ·ç«¯å°±ä¼çå°ä¸é¢ç switch-master äºä»¶ãè¿ä¸ªäºä»¶è¡¨ç¤ºä¸»åºå·²ç»åæ¢äºï¼æ°ä¸»åºç ip ååç«¯å£ä¿¡æ¯å·²ç»æäºãè¿ä¸ªæ¶åï¼å®¢æ·ç«¯å°±å¯ä»¥ç¨è¿éé¢çæ°ä¸»åºå°ååç«¯å£è¿è¡éä¿¡äºï¼\n\nswitch-master <master name> <oldip> <oldport> <newip> <newport>\n\n\n1\n\n\næäºè¿äºäºä»¶éç¥ï¼å®¢æ·ç«¯ä¸ä»å¯ä»¥å¨ä¸»ä»åæ¢åå¾å°æ°ä¸»åºçè¿æ¥ä¿¡æ¯ï¼è¿å¯ä»¥çæ§å°ä¸»ä»åºåæ¢è¿ç¨ä¸­åççåä¸ªéè¦äºä»¶ãè¿æ ·ï¼å®¢æ·ç«¯å°±å¯ä»¥ç¥éä¸»ä»åæ¢è¿è¡å°åªä¸æ­¥äºï¼æå©äºäºè§£åæ¢è¿åº¦ã\n\nå¥½äºï¼æäº pub/sub æºå¶ï¼å¨åµåå¨åµä¹é´ãå¨åµåä»åºä¹é´ãå¨åµåå®¢æ·ç«¯ä¹é´å°±é½è½å»ºç«èµ·è¿æ¥äºï¼åå ä¸æä»¬ä¸èè¯¾ä»ç»ä¸»åºä¸çº¿å¤æ­åéä¸»ä¾æ®ï¼å¨åµéç¾¤ççæ§ãéä¸»åéç¥ä¸ä¸ªä»»å¡å°±åºæ¬å¯ä»¥æ­£å¸¸å·¥ä½äºãä¸è¿ï¼æä»¬è¿éè¦èèä¸ä¸ªé®é¢ï¼ä¸»åºæéä»¥åï¼å¨åµéç¾¤æå¤ä¸ªå®ä¾ï¼é£æä¹ç¡®å®ç±åªä¸ªå¨åµæ¥è¿è¡å®éçä¸»ä»åæ¢å¢ï¼\n\n\n# 3.3 ç±åªä¸ªå¨åµæ§è¡ä¸»ä»åæ¢ï¼\n\nç¡®å®ç±åªä¸ªå¨åµæ§è¡ä¸»ä»åæ¢çè¿ç¨ï¼åä¸»åºâå®¢è§ä¸çº¿âçå¤æ­è¿ç¨ç±»ä¼¼ï¼ä¹æ¯ä¸ä¸ªâæç¥¨ä»²è£âçè¿ç¨ãå¨å·ä½äºè§£è¿ä¸ªè¿ç¨åï¼æä»¬åæ¥çä¸ï¼å¤æ­âå®¢è§ä¸çº¿âçä»²è£è¿ç¨ã\n\nå¨åµéç¾¤è¦å¤å®ä¸»åºâå®¢è§ä¸çº¿âï¼éè¦æä¸å®æ°éçå®ä¾é½è®¤ä¸ºè¯¥ä¸»åºå·²ç»âä¸»è§ä¸çº¿âäºãæå¨ä¸èè¯¾åä½ ä»ç»äºå¤æ­âå®¢è§ä¸çº¿âçååï¼æ¥ä¸æ¥ï¼æä»ç»ä¸å·ä½çå¤æ­è¿ç¨ï¼\n\nä»»ä½ä¸ä¸ªå®ä¾åªè¦èªèº«å¤æ­ä¸»åºâä¸»è§ä¸çº¿âåï¼å°±ä¼ç»å¶ä»å®ä¾åé is-master-down-by-addr å½ä»¤ãæ¥çï¼å¶ä»å®ä¾ä¼æ ¹æ®èªå·±åä¸»åºçè¿æ¥æåµï¼ååº y æ n çååºï¼y ç¸å½äºèµæç¥¨ï¼n ç¸å½äºåå¯¹ç¥¨ãå¦ä¸å¾æç¤ºï¼\n\nä¸ä¸ªå¨åµè·å¾äºä»²è£æéçèµæç¥¨æ°åï¼å°±å¯ä»¥æ è®°ä¸»åºä¸ºâå®¢è§ä¸çº¿âãè¿ä¸ªæéçèµæç¥¨æ°æ¯éè¿å¨åµéç½®æä»¶ä¸­ç quorum éç½®é¡¹è®¾å®çãä¾å¦ï¼ç°å¨æ 5 ä¸ªå¨åµï¼quorum éç½®çæ¯ 3ï¼é£ä¹ï¼ä¸ä¸ªå¨åµéè¦3å¼ èµæç¥¨ï¼å°±å¯ä»¥æ è®°ä¸»åºä¸ºâå®¢è§ä¸çº¿âäºãè¿3å¼ èµæç¥¨åæ¬å¨åµèªå·±çä¸å¼ èµæç¥¨åå¦å¤ä¸¤ä¸ªå¨åµçèµæç¥¨ã\n\næ­¤æ¶ï¼è¿ä¸ªå¨åµå°±å¯ä»¥åç»å¶ä»å¨åµåéå½ä»¤ï¼è¡¨æå¸æç±èªå·±æ¥æ§è¡ä¸»ä»åæ¢ï¼å¹¶è®©ææå¶ä»å¨åµè¿è¡æç¥¨ãè¿ä¸ªæç¥¨è¿ç¨ç§°ä¸ºâleader éä¸¾âãå ä¸ºæç»æ§è¡ä¸»ä»åæ¢çå¨åµç§°ä¸º leaderï¼æç¥¨è¿ç¨å°±æ¯ç¡®å® leaderãå¨æç¥¨è¿ç¨ä¸­ï¼ä»»ä½ä¸ä¸ªæ³æä¸º leader çå¨åµï¼è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼\n\n 1. æ¿å°åæ°ä»¥ä¸çèµæç¥¨ï¼\n 2. æ¿å°çç¥¨æ°åæ¶è¿éè¦å¤§äºç­äºå¨åµéç½®æä»¶ä¸­ç quorum å¼ãä»¥3ä¸ªå¨åµä¸ºä¾ï¼åè®¾æ­¤æ¶ç quorum è®¾ç½®ä¸º 2ï¼é£ä¹ï¼ä»»ä½ä¸ä¸ªæ³æä¸º leader çå¨åµåªè¦æ¿å°2å¼ èµæç¥¨ï¼å°±å¯ä»¥äºã\n\nä¸å¾å°±å±ç¤ºäº 3 ä¸ªå¨åµãquorum=2 çéä¸¾è¿ç¨ï¼\n\néè¦æ³¨æçæ¯ï¼å¦æå¨åµéç¾¤åªæ 2 ä¸ªå®ä¾ï¼æ­¤æ¶ï¼ä¸ä¸ªå¨åµè¦æ³æä¸º leaderï¼å¿é¡»è·å¾ 2 ç¥¨ï¼èä¸æ¯ 1 ç¥¨ãæä»¥ï¼å¦ææä¸ªå¨åµææäºï¼é£ä¹ï¼æ­¤æ¶çéç¾¤æ¯æ æ³è¿è¡ä¸»ä»åºåæ¢çãå æ­¤ï¼éå¸¸æä»¬è³å°ä¼éç½® 3 ä¸ªå¨åµå®ä¾ãè¿ä¸ç¹å¾éè¦ï¼ä½ å¨å®éåºç¨æ¶å¯ä¸è½å¿½ç¥äºã\n\n\n# 3.4 å°ç»\n\néå¸¸ï¼æä»¬å¨è§£å³ä¸ä¸ªç³»ç»é®é¢çæ¶åï¼ä¼å¼å¥ä¸ä¸ªæ°æºå¶ï¼æèè®¾è®¡ä¸å±æ°åè½ï¼å°±åæä»¬å¨è¿ä¸¤èè¯¾å­¦ä¹ çåå®¹ï¼ä¸ºäºå®ç°ä¸»ä»åæ¢ï¼æä»¬å¼å¥äºå¨åµï¼ä¸ºäºé¿ååä¸ªå¨åµæéåæ æ³è¿è¡ä¸»ä»åæ¢ï¼ä»¥åä¸ºäºåå°è¯¯å¤çï¼åå¼å¥äºå¨åµéç¾¤ï¼å¨åµéç¾¤åéè¦æä¸äºæºå¶æ¥æ¯æå®çæ­£å¸¸è¿è¡ã\n\nè¿ä¸èä¸»è¦è®²äºå¨åµéç¾¤çä¸äºå³é®æºå¶ï¼\n\n * åºäº pub/sub æºå¶çå¨åµéç¾¤ç»æè¿ç¨ï¼\n * åºäº info å½ä»¤çä»åºåè¡¨ï¼è¿å¯ä»¥å¸®å©å¨åµåä»åºå»ºç«è¿æ¥ï¼\n * åºäºå¨åµèªèº«ç pub/sub åè½ï¼è¿å®ç°äºå®¢æ·ç«¯åå¨åµä¹é´çäºä»¶éç¥ã\n\nå¯¹äºä¸»ä»åæ¢ï¼éè¦å¨åµéç¾¤å¨å¤æ­äºä¸»åºâå®¢è§ä¸çº¿âåï¼ç»è¿æç¥¨ä»²è£ï¼éä¸¾ä¸ä¸ª leader åºæ¥ï¼ç±å®è´è´£å®éçä¸»ä»åæ¢ï¼å³ç±å®æ¥å®ææ°ä¸»åºçéæ©ä»¥åéç¥ä»åºä¸å®¢æ·ç«¯ã\n\n> æåï¼ææ³åç»ä½ åäº«ä¸ä¸ªç»éªï¼è¦ä¿è¯ææå¨åµå®ä¾çéç½®æ¯ä¸è´çï¼å°¤å¶æ¯ä¸»è§ä¸çº¿çå¤æ­å¼ down-after-millisecondsãæä»¬æ¾ç»å°±è¸©è¿ä¸ä¸ªâåâãå½æ¶ï¼å¨æä»¬çé¡¹ç®ä¸­ï¼å ä¸ºè¿ä¸ªå¼å¨ä¸åçå¨åµå®ä¾ä¸éç½®ä¸ä¸è´ï¼å¯¼è´å¨åµéç¾¤ä¸ç´æ²¡æå¯¹ææéçä¸»åºå½¢æå±è¯ï¼ä¹å°±æ²¡æåæ¶åæ¢ä¸»åºï¼æç»çç»æå°±æ¯éç¾¤æå¡ä¸ç¨³å®ãæä»¥ï¼ä½ ä¸å®ä¸è¦å¿½ç¥è¿æ¡çä¼¼ç®åçç»éªã\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼æä¸ä¸ªrediséç¾¤ï¼æ¯âä¸ä¸»åä»âï¼éç½®äº 5 ä¸ªå¨åµå®ä¾çéç¾¤ï¼quorum å¼è®¾ä¸º 2ãå¨è¿è¡è¿ç¨ä¸­ï¼å¦ææ 3 ä¸ªå¨åµå®ä¾é½åçæéäºï¼æ­¤æ¶ï¼redis ä¸»åºå¦æææéï¼è¿è½æ­£ç¡®å°å¤æ­ä¸»åºâå®¢è§ä¸çº¿âåï¼å¦æå¯ä»¥çè¯ï¼è¿è½è¿è¡ä¸»ä»åºèªå¨åæ¢åï¼\n\nå ä¸ºå¤å®ä¸»åºâå®¢è§ä¸çº¿âçä¾æ®æ¯ï¼è®¤ä¸ºä¸»åºâä¸»è§ä¸çº¿âçå¨åµä¸ªæ°è¦å¤§äºç­äºquorumå¼ï¼ç°å¨è¿å©2ä¸ªå¨åµå®ä¾ï¼ä¸ªæ°æ­£å¥½ç­äºquorumå¼ï¼æä»¥è¿è½æ­£å¸¸å¤æ­ä¸»åºæ¯å¦å¤äºâå®¢è§ä¸çº¿âç¶æãå¦æä¸ä¸ªå¨åµæ³è¦æ§è¡ä¸»ä»åæ¢ï¼å°±è¦è·å°åæ°ä»¥ä¸çå¨åµæç¥¨èµæï¼ä¹å°±æ¯è³å°éè¦3ä¸ªå¨åµæç¥¨èµæãä½æ¯ï¼ç°å¨åªæ2ä¸ªå¨åµäºï¼æä»¥å°±æ æ³è¿è¡ä¸»ä»åæ¢äºã\n\næ¬èé®é¢ 2ï¼å¨åµå®ä¾æ¯ä¸æ¯è¶å¤è¶å¥½å¢ï¼å¦æåæ¶è°å¤§ down-after-milliseconds å¼ï¼å¯¹åå°è¯¯å¤æ¯ä¸æ¯ä¹æå¥½å¤ï¼\n\nå¨åµå®ä¾è¶å¤ï¼è¯¯å¤çä¼è¶ä½ï¼ä½æ¯å¨å¤å®ä¸»åºä¸çº¿åéä¸¾leaderæ¶ï¼å®ä¾éè¦æ¿å°çèµæç¥¨æ°ä¹è¶å¤ï¼ç­å¾ææå¨åµæå®ç¥¨çæ¶é´å¯è½ä¹ä¼ç¸åºå¢å ï¼ä¸»ä»åºåæ¢çæ¶é´ä¹ä¼åé¿ï¼å®¢æ·ç«¯å®¹æå ç§¯è¾å¤çè¯·æ±æä½ï¼å¯è½ä¼å¯¼è´å®¢æ·ç«¯è¯·æ±æº¢åºï¼ä»èé æè¯·æ±ä¸¢å¤±ãå¦æä¸å¡å±å¯¹redisçæä½æååºæ¶é´è¦æ±ï¼å°±å¯è½ä¼å ä¸ºæ°ä¸»åºä¸ç´æ²¡æéå®ï¼æ°æä½æ æ³æ§è¡èåçè¶æ¶æ¥è­¦ã\n\nè°å¤§down-after-millisecondsåï¼å¯è½ä¼å¯¼è´è¿æ ·çæåµï¼ä¸»åºå®éå·²ç»åçæéäºï¼ä½æ¯å¨åµè¿äºå¾é¿æ¶é´æå¤æ­åºæ¥ï¼è¿å°±ä¼å½±åå°rediså¯¹ä¸å¡çå¯ç¨æ§ã",charsets:{cjk:!0},lastUpdated:"2023/03/27, 09:26:06",lastUpdatedTimestamp:1679909166e3},{title:"åçéç¾¤",frontmatter:{title:"åçéç¾¤",date:"2023-03-27T15:47:12.000Z",permalink:"/pages/71b166/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/09.%E5%88%87%E7%89%87%E9%9B%86%E7%BE%A4.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/09.åçéç¾¤.md",key:"v-31581127",path:"/pages/71b166/",headers:[{level:2,title:"1. åçéç¾¤ï¼æ°æ®å¢å¤äºï¼æ¯è¯¥å åå­è¿æ¯å å®ä¾ï¼",slug:"_1-åçéç¾¤-æ°æ®å¢å¤äº-æ¯è¯¥å åå­è¿æ¯å å®ä¾",normalizedTitle:"1. åçéç¾¤ï¼æ°æ®å¢å¤äºï¼æ¯è¯¥å åå­è¿æ¯å å®ä¾ï¼",charIndex:100},{level:3,title:"1.1 å¦ä½ä¿å­æ´å¤æ°æ®ï¼",slug:"_1-1-å¦ä½ä¿å­æ´å¤æ°æ®",normalizedTitle:"1.1 å¦ä½ä¿å­æ´å¤æ°æ®ï¼",charIndex:1061},{level:3,title:"1.2 æ°æ®åçåå®ä¾çå¯¹åºåå¸å³ç³»",slug:"_1-2-æ°æ®åçåå®ä¾çå¯¹åºåå¸å³ç³»",normalizedTitle:"1.2 æ°æ®åçåå®ä¾çå¯¹åºåå¸å³ç³»",charIndex:1555},{level:3,title:"1.3 å®¢æ·ç«¯å¦ä½å®ä½æ°æ®ï¼",slug:"_1-3-å®¢æ·ç«¯å¦ä½å®ä½æ°æ®",normalizedTitle:"1.3 å®¢æ·ç«¯å¦ä½å®ä½æ°æ®ï¼",charIndex:2845},{level:3,title:"1.4 å°ç»",slug:"_1-4-å°ç»",normalizedTitle:"1.4 å°ç»",charIndex:4738},{level:2,title:"2. Codis VS Redis Clusterï¼æè¯¥éæ©åªä¸ä¸ªéç¾¤æ¹æ¡ï¼",slug:"_2-codis-vs-redis-cluster-æè¯¥éæ©åªä¸ä¸ªéç¾¤æ¹æ¡",normalizedTitle:"2. codis vs redis clusterï¼æè¯¥éæ©åªä¸ä¸ªéç¾¤æ¹æ¡ï¼",charIndex:5716},{level:3,title:"2.1 Codis çæ´ä½æ¶æååºæ¬æµç¨",slug:"_2-1-codis-çæ´ä½æ¶æååºæ¬æµç¨",normalizedTitle:"2.1 codis çæ´ä½æ¶æååºæ¬æµç¨",charIndex:5864},{level:3,title:"2.2 Codis çå³é®ææ¯åç",slug:"_2-2-codis-çå³é®ææ¯åç",normalizedTitle:"2.2 codis çå³é®ææ¯åç",charIndex:6772},{level:4,title:"2.2.1 æ°æ®å¦ä½å¨éç¾¤éåå¸ï¼",slug:"_2-2-1-æ°æ®å¦ä½å¨éç¾¤éåå¸",normalizedTitle:"2.2.1 æ°æ®å¦ä½å¨éç¾¤éåå¸ï¼",charIndex:6865},{level:4,title:"2.2.2 éç¾¤æ©å®¹åæ°æ®è¿ç§»å¦ä½è¿è¡?",slug:"_2-2-2-éç¾¤æ©å®¹åæ°æ®è¿ç§»å¦ä½è¿è¡",normalizedTitle:"2.2.2 éç¾¤æ©å®¹åæ°æ®è¿ç§»å¦ä½è¿è¡?",charIndex:8030},{level:4,title:"2.2.3 å®¢æ·ç«¯çå¼å®¹æ§",slug:"_2-2-3-å®¢æ·ç«¯çå¼å®¹æ§",normalizedTitle:"2.2.3 å®¢æ·ç«¯çå¼å®¹æ§",charIndex:9906},{level:4,title:"2.2.4 æä¹ä¿è¯éç¾¤å¯é æ§ï¼",slug:"_2-2-4-æä¹ä¿è¯éç¾¤å¯é æ§",normalizedTitle:"2.2.4 æä¹ä¿è¯éç¾¤å¯é æ§ï¼",charIndex:10488},{level:3,title:"2.3 åçéç¾¤æ¹æ¡éæ©å»ºè®®",slug:"_2-3-åçéç¾¤æ¹æ¡éæ©å»ºè®®",normalizedTitle:"2.3 åçéç¾¤æ¹æ¡éæ©å»ºè®®",charIndex:11722}],headersStr:"1. åçéç¾¤ï¼æ°æ®å¢å¤äºï¼æ¯è¯¥å åå­è¿æ¯å å®ä¾ï¼ 1.1 å¦ä½ä¿å­æ´å¤æ°æ®ï¼ 1.2 æ°æ®åçåå®ä¾çå¯¹åºåå¸å³ç³» 1.3 å®¢æ·ç«¯å¦ä½å®ä½æ°æ®ï¼ 1.4 å°ç» 2. Codis VS Redis Clusterï¼æè¯¥éæ©åªä¸ä¸ªéç¾¤æ¹æ¡ï¼ 2.1 Codis çæ´ä½æ¶æååºæ¬æµç¨ 2.2 Codis çå³é®ææ¯åç 2.2.1 æ°æ®å¦ä½å¨éç¾¤éåå¸ï¼ 2.2.2 éç¾¤æ©å®¹åæ°æ®è¿ç§»å¦ä½è¿è¡? 2.2.3 å®¢æ·ç«¯çå¼å®¹æ§ 2.2.4 æä¹ä¿è¯éç¾¤å¯é æ§ï¼ 2.3 åçéç¾¤æ¹æ¡éæ©å»ºè®®",content:"> åèï¼\n> \n>  * 09 åçéç¾¤ï¼æ°æ®å¢å¤äºï¼æ¯è¯¥å åå­è¿æ¯å å®ä¾ï¼| æå®¢æ¶é´\n>  * 35 Codis VS Redis Clusterï¼æè¯¥éæ©åªä¸ä¸ªéç¾¤æ¹æ¡ï¼| æå®¢æ¶é´\n\n\n# 1. åçéç¾¤ï¼æ°æ®å¢å¤äºï¼æ¯è¯¥å åå­è¿æ¯å å®ä¾ï¼\n\næè¿ä¹ä¸ä¸ªéæ±ï¼è¦ç¨ Redis ä¿å­ 5000 ä¸ä¸ªé®å¼å¯¹ï¼æ¯ä¸ªé®å¼å¯¹å¤§çº¦æ¯ 512Bï¼ä¸ºäºè½å¿«éé¨ç½²å¹¶å¯¹å¤æä¾æå¡ï¼æä»¬éç¨äºä¸»æºæ¥è¿è¡ Redis å®ä¾ï¼é£ä¹ï¼è¯¥å¦ä½éæ©äºä¸»æºçåå­å®¹éå¢ï¼\n\nç²ç¥è®¡ç®ä¸ä¸ï¼è¿äº KV æå çåå­ç©ºé´å¤§çº¦ä¸º 25GBï¼æä»¥ç¬¬ä¸ååºæ¯éæ©ä¸å° 32G åå­çäºä¸»æºæ¥é¨ç½² Redisãä½å¨ä½¿ç¨è¿ç¨ä¸­ä¼åç°ï¼Redis ååºææ¶ä¼éå¸¸æ¢ï¼è¿æ¶ä½¿ç¨ INFO å½ä»¤æ¥ç Redis ç latest_fork_usec ææ å¼ï¼è¡¨ç¤ºæè¿ä¸æ¬¡ fork çèæ¶ï¼ï¼ç»ææ¾ç¤ºè¿ä¸ªææ å¼ç¹å«é«ï¼å¿«å°ç§çº§å«äºã\n\nè¿è· Redis çæä¹åæºå¶æå³ç³»ãå¨ä½¿ç¨ RDB è¿è¡æä¹åæ¶ï¼Redis ä¼ fork å­è¿ç¨æ¥å®æï¼fork æä½çç¨æ¶å Redis çæ°æ®éæ¯æ­£ç¸å³çï¼è fork å¨æ§è¡æ¶ä¼é»å¡ä¸»çº¿ç¨ãæ°æ®éè¶å¤§ï¼fork æä½é æçä¸»çº¿ç¨é»å¡çæ¶é´è¶é¿ãæä»¥ï¼å¨ä½¿ç¨ RDB å¯¹ 25GB çæ°æ®è¿è¡æä¹åæ¶ï¼æ°æ®éè¾å¤§ï¼åå°è¿è¡çå­è¿ç¨å¨ fork åå»ºæ¶é»å¡äºä¸»çº¿ç¨ï¼äºæ¯å°±å¯¼è´ Redis ååºåæ¢äºã\n\nçæ¥ï¼ç¬¬ä¸ä¸ªæ¹æ¡æ¾ç¶æ¯ä¸å¯è¡çï¼æä»¬å¿é¡»è¦å¯»æ¾å¶ä»çæ¹æ¡ãè¿ä¸ªæ¶åï¼æä»¬æ³¨æå°äº Redis çåçéç¾¤ãè½ç¶ç»å»ºåçéç¾¤æ¯è¾éº»ç¦ï¼ä½æ¯å®å¯ä»¥ä¿å­å¤§éæ°æ®ï¼èä¸å¯¹ Redis ä¸»çº¿ç¨çé»å¡å½±åè¾å°ã\n\nåçéç¾¤ï¼ä¹å«åçéç¾¤ï¼å°±æ¯æå¯å¨å¤ä¸ª Redis å®ä¾ç»æä¸ä¸ªéç¾¤ï¼ç¶åæç§ä¸å®çè§åï¼ææ¶å°çæ°æ®ååæå¤ä»½ï¼æ¯ä¸ä»½ç¨ä¸ä¸ªå®ä¾æ¥ä¿å­ãåå°æä»¬ååçåºæ¯ä¸­ï¼å¦ææ 25GB çæ°æ®å¹³ååæ 5 ä»½ï¼å½ç¶ï¼ä¹å¯ä»¥ä¸åååï¼ï¼ä½¿ç¨ 5 ä¸ªå®ä¾æ¥ä¿å­ï¼æ¯ä¸ªå®ä¾åªéè¦ä¿å­ 5GB æ°æ®ãå¦ä¸å¾æç¤ºï¼\n\né£ä¹ï¼å¨åçéç¾¤ä¸­ï¼å®ä¾å¨ä¸º 5GB æ°æ®çæ RDB æ¶ï¼æ°æ®éå°±å°äºå¾å¤ï¼fork å­è¿ç¨ä¸è¬ä¸ä¼ç»ä¸»çº¿ç¨å¸¦æ¥è¾é¿æ¶é´çé»å¡ãéç¨å¤ä¸ªå®ä¾ä¿å­æ°æ®åçåï¼æä»¬æ¢è½ä¿å­ 25GB æ°æ®ï¼åé¿åäº fork å­è¿ç¨é»å¡ä¸»çº¿ç¨èå¯¼è´çååºçªç¶åæ¢ã\n\nå¨å®éåºç¨ Redis æ¶ï¼éçç¨æ·æä¸å¡è§æ¨¡çæ©å±ï¼ä¿å­å¤§éæ°æ®çæåµéå¸¸æ¯æ æ³é¿åçãèåçéç¾¤ï¼å°±æ¯ä¸ä¸ªéå¸¸å¥½çè§£å³æ¹æ¡ãè¿èè¯¾ï¼æä»¬å°±æ¥å­¦ä¹ ä¸ä¸ã\n\n\n# 1.1 å¦ä½ä¿å­æ´å¤æ°æ®ï¼\n\nå¨ååçæ¡ä¾éï¼ä¸ºäºä¿å­å¤§éæ°æ®ï¼æä»¬ä½¿ç¨äºå¤§åå­äºä¸»æºååçéç¾¤ä¸¤ç§æ¹æ³ãå®éä¸ï¼è¿ä¸¤ç§æ¹æ³åå«å¯¹åºç Redis åºå¯¹æ°æ®éå¢å¤çä¸¤ç§æ¹æ¡ï¼çºµåæ©å±åæ¨ªåæ©å±ï¼\n\n * çºµåæ©å±ï¼scale upï¼ï¼åçº§åä¸ª Redis å®ä¾çèµæºéç½®ï¼åæ¬å¢å åå­å®¹éãå¢å ç£çå®¹éãä½¿ç¨æ´é«éç½®ç CPUã\n * æ¨ªåæ©å±ï¼scale outï¼ï¼æ¨ªåå¢å å½å Redis å®ä¾çä¸ªæ°ã\n\nä¸¤ç§æ¹å¼åæä¼ç¼ºç¹ï¼\n\n * çºµåæ©å±å®æ½ç®åï¼ä½æä¹å RDB æä»¶ä¼æ¾èéä½æ§è½ï¼èä¸ä¼åå°ç¡¬ä»¶ä¸ææ¬çéå¶ã\n   \n   * å¦æä½ ä¸è¦æ±æä¹åä¿å­Redisæ°æ®ï¼é£ä¹ï¼çºµåæ©å±ä¼æ¯ä¸ä¸ªä¸éçéæ©ã\n\n * æ¨ªåæ©å±ä¸éè¦æå¿ç¡¬ä»¶åææ¬çéå¶ï¼ä½æ¶åå°å¤å®ä¾çåå¸å¼ç®¡ççé®é¢ã\n   \n   * å¨é¢åç¾ä¸ãåä¸çº§å«çç¨æ·è§æ¨¡æ¶ï¼æ¨ªåæ©å±çRedisåçéç¾¤ä¼æ¯ä¸ä¸ªéå¸¸å¥½çéæ©.\n\nè¦æ³æåçéç¾¤ç¨èµ·æ¥ï¼æä»¬å°±éè¦è§£å³ä¸¤å¤§é®é¢ï¼\n\n * æ°æ®åçåï¼å¨å¤ä¸ªå®ä¾ä¹é´å¦ä½åå¸ï¼\n * å®¢æ·ç«¯æä¹ç¡®å®æ³è¦è®¿é®çæ°æ®å¨åªä¸ªå®ä¾ä¸ï¼\n\næ¥ä¸æ¥ï¼æä»¬å°±ä¸ä¸ªä¸ªå°è§£å³ã\n\n\n# 1.2 æ°æ®åçåå®ä¾çå¯¹åºåå¸å³ç³»\n\nå¨åçéç¾¤ä¸­ï¼æ°æ®éè¦åå¸å¨ä¸åå®ä¾ä¸ï¼é£ä¹ï¼æ°æ®åå®ä¾ä¹é´å¦ä½å¯¹åºå¢ï¼è¿å°±åæ¥ä¸æ¥æè¦è®²ç Redis Cluster æ¹æ¡æå³äºãä¸è¿ï¼æä»¬è¦åå¼æç½åçéç¾¤å Redis Cluster çèç³»ä¸åºå«ã\n\nå®éä¸ï¼åçéç¾¤æ¯ä¸ç§ä¿å­å¤§éæ°æ®çéç¨æºå¶ï¼è¿ä¸ªæºå¶å¯ä»¥æä¸åçå®ç°æ¹æ¡ãå¨ Redis 3.0 ä¹åï¼å®æ¹å¹¶æ²¡æéå¯¹åçéç¾¤æä¾å·ä½çæ¹æ¡ãä» 3.0 å¼å§ï¼å®æ¹æä¾äºä¸ä¸ªåä¸º Redis Cluster çæ¹æ¡ï¼ç¨äºå®ç°åçéç¾¤ãRedis Cluster æ¹æ¡ä¸­å°±è§å®äºæ°æ®åå®ä¾çå¯¹åºè§åã\n\nå·ä½æ¥è¯´ï¼Redis Cluster æ¹æ¡éç¨åå¸æ§½ï¼Hash Slotï¼åé¢ç§°ä¸º Slotï¼ï¼æ¥å¤çæ°æ®åå®ä¾ä¹é´çæ å°å³ç³»ãå¨ Redis Cluster æ¹æ¡ä¸­ï¼ä¸ä¸ªåçéç¾¤å±æ 16384 ä¸ªåå¸æ§½ï¼è¿äºåå¸æ§½ç±»ä¼¼äºæ°æ®ååºï¼æ¯ä¸ªé®å¼å¯¹é½ä¼æ ¹æ®å®ç keyï¼è¢«æ å°å°ä¸ä¸ª slot ä¸­ãå·ä½çæ å°è¿ç¨åä¸ºä¸¤å¤§æ­¥ï¼\n\n * é¦åæ ¹æ®é®å¼å¯¹ç keyï¼æç§ CRC16 ç®æ³è®¡ç®ä¸ä¸ª 16bit çå¼ï¼\n * ç¶åï¼åç¨è¿ä¸ª 16bit å¼å¯¹ 16384 åæ¨¡ï¼å¾å° 0~16383 èå´åçæ¨¡æ°ï¼æ¯ä¸ªæ¨¡æ°ä»£è¡¨ä¸ä¸ªç¸åºç¼å·ç slotã\n\né£ä¹ï¼è¿äº slot åæ¯å¦ä½è¢«æ å°å°å·ä½ç Redis å®ä¾ä¸çå¢ï¼æä»¬å¨é¨ç½² Redis Cluster æ¹æ¡æ¶ï¼å¯ä»¥ä½¿ç¨ cluster create å½ä»¤åå»ºéç¾¤ï¼æ­¤æ¶ï¼Redis ä¼èªå¨æè¿äº slot å¹³ååå¸å¨éç¾¤å®ä¾ä¸ãä¾å¦ï¼å¦æéç¾¤ä¸­æ N ä¸ªå®ä¾ï¼é£ä¹ï¼æ¯ä¸ªå®ä¾ä¸çæ§½ä¸ªæ°ä¸º 16384/N ä¸ªãè¿ä¹æ¯ DDIA ä¸­è®²çæ°æ®ååºæ¹æ³ä¸­çåºå®é»è¾ååºçæ¹æ³ã\n\nå½ç¶ï¼ æä»¬ä¹å¯ä»¥ä½¿ç¨ cluster meet å½ä»¤æå¨å»ºç«å®ä¾é´çè¿æ¥ï¼å½¢æéç¾¤ï¼åä½¿ç¨ cluster addslots å½ä»¤ï¼æ ¹æ®ä¸åå®ä¾çèµæºæåµæå®æ¯ä¸ªå®ä¾ä¸ç slot ä¸ªæ°ãä¸å¾å±ç¤ºäºæ°æ®ãåå¸æ§½åå®ä¾è¿ä¸èçæ å°åå¸æåµï¼\n\nç¤ºæå¾ä¸­çåçéç¾¤ä¸å±æ 3 ä¸ªå®ä¾ï¼åæ¶åè®¾æ 5 ä¸ª slotï¼æä»¬é¦åå¯ä»¥éè¿ä¸é¢çå½ä»¤æå¨åé slotï¼å®ä¾ 1 ä¿å­ slot 0 å 1ï¼å®ä¾ 2 ä¿å­ slot 2 å 3ï¼å®ä¾ 3 ä¿å­ slot 4ãéç½®å½ä»¤å¦ä¸ï¼\n\nredis-cli -h 172.16.19.3 âp 6379 cluster addslots 0,1\nredis-cli -h 172.16.19.4 âp 6379 cluster addslots 2,3\nredis-cli -h 172.16.19.5 âp 6379 cluster addslots 4\n\n\n1\n2\n3\n\n\næ³¨æï¼å¨æå¨åé slot æ¶ï¼éè¦æ 16384 ä¸ª slot é½åéå®ï¼å¦å Redis éç¾¤æ æ³æ­£å¸¸å·¥ä½ã\n\nç»¼ä¸ï¼éè¿åå¸æ§½ï¼åçéç¾¤å°±å®ç°äºæ°æ®å°åå¸æ§½ãåå¸æ§½åå°å®ä¾çåéãä½æ¯ï¼å³ä½¿å®ä¾æäºåå¸æ§½çæ å°ä¿¡æ¯ï¼å®¢æ·ç«¯åæ¯æä¹ç¥éè¦è®¿é®çæ°æ®å¨åªä¸ªå®ä¾ä¸å¢ï¼\n\n\n# 1.3 å®¢æ·ç«¯å¦ä½å®ä½æ°æ®ï¼\n\nå¨å®ä½é®å¼å¯¹æ°æ®æ¶ï¼å®æå¤çåå¸æ§½æ¯å¯ä»¥éè¿è®¡ç®å¾å°çï¼è¿ä¸ªè®¡ç®å¯ä»¥å¨å®¢æ·ç«¯åéè¯·æ±æ¶æ¥æ§è¡ãä½æ¯ï¼è¦è¿ä¸æ­¥å®ä½å° Redis å®ä¾ï¼è¿éè¦ç¥é slot åå¸å¨åªä¸ªå®ä¾ä¸ã\n\nä¸è¬æ¥è¯´ï¼å®¢æ·ç«¯åéç¾¤å®ä¾å»ºç«è¿æ¥åï¼å®ä¾å°±ä¼æåå¸æ§½çåéä¿¡æ¯åç»å®¢æ·ç«¯ãä½æ¯ï¼å¨éç¾¤åååå»ºçæ¶åï¼æ¯ä¸ªå®ä¾åªç¥éèªå·±è¢«åéäºåªäºåå¸æ§½ï¼æ¯ä¸ç¥éå¶ä»å®ä¾æ¥æçåå¸æ§½ä¿¡æ¯çãé£ä¹ï¼å®¢æ·ç«¯ä¸ºä»ä¹å¯ä»¥å¨è®¿é®ä»»ä½ä¸ä¸ªå®ä¾æ¶ï¼é½è½è·å¾ææçåå¸æ§½ä¿¡æ¯å¢ï¼è¿æ¯å ä¸ºï¼Redis å®ä¾ä¼æèªå·±çåå¸æ§½ä¿¡æ¯åç»åå®ç¸è¿æ¥çå¶å®å®ä¾ï¼æ¥å®æåå¸æ§½åéä¿¡æ¯çæ©æ£ãå½å®ä¾ä¹é´ç¸äºè¿æ¥åï¼æ¯ä¸ªå®ä¾å°±æææåå¸æ§½çæ å°å³ç³»äºã\n\nå®¢æ·ç«¯æ¶å°åå¸æ§½ä¿¡æ¯åï¼ä¼æåå¸æ§½ä¿¡æ¯ç¼å­å¨æ¬å°ãå½å®¢æ·ç«¯è¯·æ±é®å¼å¯¹æ¶ï¼ä¼åè®¡ç®é®æå¯¹åºçåå¸æ§½ï¼ç¶åå°±å¯ä»¥ç»ç¸åºçå®ä¾åéè¯·æ±äºãä½æ¯ï¼å¨éç¾¤ä¸­ï¼å®ä¾ååå¸æ§½çå¯¹åºå³ç³»å¹¶ä¸æ¯ä¸æä¸åçï¼æå¸¸è§çååæä¸¤ä¸ªï¼\n\n * å¨éç¾¤ä¸­ï¼å®ä¾ææ°å¢æå é¤ï¼Redis éè¦éæ°åéåå¸æ§½ï¼\n * ä¸ºäºè´è½½åè¡¡ï¼Redis éè¦æåå¸æ§½å¨ææå®ä¾ä¸éæ°åå¸ä¸éã\n\næ­¤æ¶ï¼å®ä¾ä¹é´è¿å¯ä»¥éè¿ç¸äºä¼ éæ¶æ¯ï¼è·å¾ææ°çåå¸æ§½åéä¿¡æ¯ï¼ä½æ¯ï¼å®¢æ·ç«¯æ¯æ æ³ä¸»å¨æç¥è¿äºååçãè¿å°±ä¼å¯¼è´ï¼å®ç¼å­çåéä¿¡æ¯åææ°çåéä¿¡æ¯å°±ä¸ä¸è´äºï¼é£è¯¥æä¹åå¢ï¼\n\nRedis Cluster æ¹æ¡æä¾äºä¸ç§éå®åæºå¶ï¼æè°çâéå®åâï¼å°±æ¯æï¼å®¢æ·ç«¯ç»ä¸ä¸ªå®ä¾åéæ°æ®è¯»åæä½æ¶ï¼å¦æè¿ä¸ªå®ä¾ä¸å¹¶æ²¡æç¸åºçæ°æ®ï¼å®ä¾å°±ä¼æ³å®¢æ·ç«¯è¿åä¸ä¸ªå¦ä¸æç¤ºç MOVED å½ä»¤ååºç»æï¼å®¢æ·ç«¯è¿æ¶å°±è¦åç»ä¸ä¸ªæ°å®ä¾åéæä½å½ä»¤ã\n\nGET hello:key\n(error) MOVED 13320 172.16.19.5:6379\n\n\n1\n2\n\n\nå¶ä¸­ï¼MOVED å½ä»¤è¡¨ç¤ºï¼å®¢æ·ç«¯è¯·æ±çé®å¼å¯¹æå¨çåå¸æ§½ 13320ï¼å®éæ¯å¨ 172.16.19.5 è¿ä¸ªå®ä¾ä¸ãéè¿è¿åç MOVED å½ä»¤ï¼å°±ç¸å½äºæåå¸æ§½æå¨çæ°å®ä¾çä¿¡æ¯åè¯ç»å®¢æ·ç«¯äºãè¿æ ·ä¸æ¥ï¼å®¢æ·ç«¯å°±å¯ä»¥ç´æ¥å 172.16.19.5 è¿æ¥ï¼å¹¶åéæä½è¯·æ±äºã\n\nä¸é¢ç¨ä¸å¼ å¾æ¥è¯´æä¸ä¸ MOVED å½ä»¤çéå®åçä½¿ç¨æ¹æ³ãå¯ä»¥çå°ï¼ç±äºè´è½½åè¡¡ï¼Slot 2ä¸­çæ°æ®å·²ç»ä»å®ä¾2è¿ç§»å°äºå®ä¾3ï¼ä½æ¯ï¼å®¢æ·ç«¯ç¼å­ä»ç¶è®°å½çâSlot 2å¨å®ä¾2âçä¿¡æ¯ï¼æä»¥ä¼ç»å®ä¾2åéå½ä»¤ãå®ä¾2ç»å®¢æ·ç«¯è¿åä¸æ¡ MOVED å½ä»¤ï¼æSlot 2çææ°ä½ç½®ï¼ä¹å°±æ¯å¨å®ä¾3ä¸ï¼ï¼è¿åç»å®¢æ·ç«¯ï¼å®¢æ·ç«¯å°±ä¼åæ¬¡åå®ä¾3åéè¯·æ±ï¼åæ¶è¿ä¼æ´æ°æ¬å°ç¼å­ï¼æ Slot 2ä¸å®ä¾çå¯¹åºå³ç³»æ´æ°è¿æ¥ã\n\néè¦æ³¨æçæ¯ï¼å¨ä¸å¾ä¸­ï¼å½å®¢æ·ç«¯ç»å®ä¾2åéå½ä»¤æ¶ï¼Slot 2ä¸­çæ°æ®å·²ç»å¨é¨è¿ç§»å°äºå®ä¾3ãå¨å®éåºç¨æ¶ï¼å¦æSlot 2ä¸­çæ°æ®æ¯è¾å¤ï¼å°±å¯è½ä¼åºç°ä¸ç§æåµï¼å®¢æ·ç«¯åå®ä¾2åéè¯·æ±ï¼ä½æ­¤æ¶ï¼Slot 2ä¸­çæ°æ®åªæä¸é¨åè¿ç§»å°äºå®ä¾3ï¼è¿æé¨åæ°æ®æ²¡æè¿ç§»ãå¨è¿ç§è¿ç§»é¨åå®æçæåµä¸ï¼å®¢æ·ç«¯å°±ä¼æ¶å°ä¸æ¡ ASK æ¥éä¿¡æ¯ï¼å¦ä¸æç¤ºï¼\n\nGET hello:key\n(error) ASK 13320 172.16.19.5:6379\n\n\n1\n2\n\n\nè¿ä¸ªç»æä¸­ç ASK å½ä»¤å°±è¡¨ç¤ºï¼å®¢æ·ç«¯è¯·æ±çé®å¼å¯¹æå¨çåå¸æ§½ 13320ï¼å¨ 172.16.19.5 è¿ä¸ªå®ä¾ä¸ï¼ä½æ¯è¿ä¸ªåå¸æ§½æ­£å¨è¿ç§»ãæ­¤æ¶ï¼å®¢æ·ç«¯éè¦åç» 172.16.19.5 è¿ä¸ªå®ä¾åéä¸ä¸ª ASKING å½ä»¤ãè¿ä¸ªå½ä»¤çæææ¯ï¼è®©è¿ä¸ªå®ä¾åè®¸æ§è¡å®¢æ·ç«¯æ¥ä¸æ¥åéçå½ä»¤ãç¶åï¼å®¢æ·ç«¯ååè¿ä¸ªå®ä¾åé GET å½ä»¤ï¼ä»¥è¯»åæ°æ®ã\n\nçèµ·æ¥å¥½åæç¹å¤æï¼æååå©å¾çæ¥è§£éä¸ä¸ãå¨ä¸å¾ä¸­ï¼Slot 2æ­£å¨ä»å®ä¾2å¾å®ä¾3è¿ç§»ï¼key1åkey2å·²ç»è¿ç§»è¿å»ï¼key3åkey4è¿å¨å®ä¾2ãå®¢æ·ç«¯åå®ä¾2è¯·æ±key2åï¼å°±ä¼æ¶å°å®ä¾2è¿åçASKå½ä»¤ã\n\nASK å½ä»¤è¡¨ç¤ºä¸¤å±å«ä¹ï¼\n\n * ç¬¬ä¸ï¼è¡¨æ slot æ°æ®è¿å¨è¿ç§»ä¸­ï¼\n * ç¬¬äºï¼ASK å½ä»¤æå®¢æ·ç«¯æè¯·æ±æ°æ®çææ°å®ä¾å°åè¿åç»å®¢æ·ç«¯ï¼æ­¤æ¶ï¼å®¢æ·ç«¯éè¦ç»å®ä¾ 3 åé ASKING å½ä»¤ï¼ç¶åååéæä½å½ä»¤ã\n\nå MOVED å½ä»¤ä¸åï¼ASKå½ä»¤å¹¶ä¸ä¼æ´æ°å®¢æ·ç«¯ç¼å­çåå¸æ§½åéä¿¡æ¯ãæä»¥ï¼å¨ä¸å¾ä¸­ï¼å¦æå®¢æ·ç«¯åæ¬¡è¯·æ± slot 2 ä¸­çæ°æ®ï¼å®è¿æ¯ä¼ç» å®ä¾ 2 åéè¯·æ±ãè¿ä¹å°±æ¯è¯´ï¼ASK å½ä»¤çä½ç¨åªæ¯è®©å®¢æ·ç«¯è½ç»æ°å®ä¾åéä¸æ¬¡è¯·æ±ï¼èä¸å MOVED å½ä»¤é£æ ·ï¼ä¼æ´æ¹æ¬å°ç¼å­ï¼è®©åç»­ææå½ä»¤é½åå¾æ°å®ä¾ã\n\n\n# 1.4 å°ç»\n\nè¿èè¯¾ï¼æä»¬å­¦ä¹ äºåçéç¾¤å¨ä¿å­å¤§éæ°æ®æ¹é¢çä¼å¿ï¼ä»¥ååºäºåå¸æ§½çæ°æ®åå¸æºå¶åå®¢æ·ç«¯å®ä½é®å¼å¯¹çæ¹æ³ã\n\nå¨åºå¯¹æ°æ®éæ©å®¹æ¶ï¼è½ç¶å¢å åå­è¿ç§çºµåæ©å±çæ¹æ³ç®åç´æ¥ï¼ä½æ¯ä¼é ææ°æ®åºçåå­è¿å¤§ï¼å¯¼è´æ§è½åæ¢ãRedis åçéç¾¤æä¾äºæ¨ªåæ©å±çæ¨¡å¼ï¼ä¹å°±æ¯ä½¿ç¨å¤ä¸ªå®ä¾ï¼å¹¶ç»æ¯ä¸ªå®ä¾éç½®ä¸å®æ°éçåå¸æ§½ï¼æ°æ®å¯ä»¥éè¿é®çåå¸å¼æ å°å°åå¸æ§½ï¼åéè¿åå¸æ§½åæ£ä¿å­å°ä¸åçå®ä¾ä¸ãè¿æ ·åçå¥½å¤æ¯æ©å±æ§å¥½ï¼ä¸ç®¡æå¤å°æ°æ®ï¼åçéç¾¤é½è½åºå¯¹ã\n\nå¦å¤ï¼éç¾¤çå®ä¾å¢åï¼æèæ¯ä¸ºäºå®ç°è´è½½åè¡¡èè¿è¡çæ°æ®éæ°åå¸ï¼ä¼å¯¼è´åå¸æ§½åå®ä¾çæ å°å³ç³»åçååï¼å®¢æ·ç«¯åéè¯·æ±æ¶ï¼ä¼æ¶å°å½ä»¤æ§è¡æ¥éä¿¡æ¯ãäºè§£äº MOVED å ASK å½ä»¤ï¼ä½ å°±ä¸ä¼ä¸ºè¿ç±»æ¥éèå¤´ç¼äºã\n\næååè¯´è¿ï¼å¨ Redis 3.0 ä¹åï¼Redis å®æ¹å¹¶æ²¡ææä¾åçéç¾¤æ¹æ¡ï¼ä½æ¯ï¼å¶å®å½æ¶ä¸çå·²ç»æäºä¸äºåçéç¾¤çæ¹æ¡ï¼ä¾å¦åºäºå®¢æ·ç«¯ååºç ShardedJedisï¼åºäºä»£çç CodisãTwemproxy ç­ãè¿äºæ¹æ¡çåºç¨æ©äº Redis Cluster æ¹æ¡ï¼å¨æ¯æçéç¾¤å®ä¾è§æ¨¡ãéç¾¤ç¨³å®æ§ãå®¢æ·ç«¯åå¥½æ§æ¹é¢ä¹é½æçåèªçä¼å¿ï¼æä¼å¨åé¢çè¯¾ç¨ä¸­ï¼ä¸é¨åä½ èèè¿äºæ¹æ¡çå®ç°æºå¶ï¼ä»¥åå®è·µç»éªãè¿æ ·ä¸æ¥ï¼å½ä½ åç¢°å°ä¸å¡åå±å¸¦æ¥çæ°æ®éå·¨å¤§çé¾é¢æ¶ï¼å°±å¯ä»¥æ ¹æ®è¿äºæ¹æ¡çç¹ç¹ï¼éæ©åéçæ¹æ¡å®ç°åçéç¾¤ï¼ä»¥åºå¯¹ä¸å¡éæ±äºã\n\n----------------------------------------\n\næ¬èé®é¢ï¼ä¸ºä»ä¹Redisä¸ç´æ¥ç¨ä¸ä¸ªè¡¨ï¼æé®å¼å¯¹åå®ä¾çå¯¹åºå³ç³»è®°å½ä¸æ¥ï¼èæ¯è¦å¯¹é®å¼å¯¹ç key å CRC è®¡ç®ï¼\n\nå¦æä½¿ç¨è¡¨è®°å½é®å¼å¯¹åå®ä¾çå¯¹åºå³ç³»ï¼ä¸æ¦é®å¼å¯¹åå®ä¾çå¯¹åºå³ç³»åçäºååï¼ä¾å¦å®ä¾æå¢åæèæ°æ®éæ°åå¸ï¼ï¼å°±è¦ä¿®æ¹è¡¨ãå¦ææ¯åçº¿ç¨æä½è¡¨ï¼é£ä¹æææä½é½è¦ä¸²è¡æ§è¡ï¼æ§è½æ¢ï¼å¦ææ¯å¤çº¿ç¨æä½è¡¨ï¼å°±æ¶åå°å éå¼éãæ­¤å¤ï¼å¦ææ°æ®ééå¸¸å¤§ï¼ä½¿ç¨è¡¨è®°å½é®å¼å¯¹åå®ä¾çå¯¹åºå³ç³»ï¼éè¦çé¢å¤å­å¨ç©ºé´ä¹ä¼å¢å ã\n\nåºäºåå¸æ§½è®¡ç®æ¶ï¼è½ç¶ä¹è¦è®°å½åå¸æ§½åå®ä¾çå¯¹åºå³ç³»ï¼ä½æ¯åå¸æ§½çä¸ªæ°è¦æ¯é®å¼å¯¹çä¸ªæ°å°å¾å¤ï¼æ è®ºæ¯ä¿®æ¹åå¸æ§½åå®ä¾çå¯¹åºå³ç³»ï¼è¿æ¯ä½¿ç¨é¢å¤ç©ºé´å­å¨åå¸æ§½åå®ä¾çå¯¹åºå³ç³»ï¼é½æ¯ç´æ¥è®°å½é®å¼å¯¹åå®ä¾çå³ç³»çå¼éå°å¾å¤ã\n\n\n# 2. Codis VS Redis Clusterï¼æè¯¥éæ©åªä¸ä¸ªéç¾¤æ¹æ¡ï¼\n\nåé¢å­¦ä¹ äº Redis å®æ¹æä¾çåçéç¾¤æ¹æ¡ Redis Clusterï¼ä½å¨è¯¥æ¹æ¡åå¸ä¹åï¼ä¸çå·²ç»å¹¿æ³ä½¿ç¨ Codisãè¿ä¸èå°è®²è§£ Codis çå®ç°åçï¼å¹¶å°ä¸¤èè¿è¡å¯¹æ¯ï¼ä»èéåºæä½³çéç¾¤æ¹æ¡ã\n\n\n# 2.1 Codis çæ´ä½æ¶æååºæ¬æµç¨\n\nCodis éç¾¤ä¸­åå«äº 4 ç±»å³é®ç»ä»¶ï¼\n\n * codis serverï¼è¿æ¯è¿è¡äºäºæ¬¡å¼åçRediså®ä¾ï¼å¶ä¸­å¢å äºé¢å¤çæ°æ®ç»æï¼æ¯ææ°æ®è¿ç§»æä½ï¼ä¸»è¦è´è´£å¤çå·ä½çæ°æ®è¯»åè¯·æ±ã\n * codis proxyï¼æ¥æ¶å®¢æ·ç«¯è¯·æ±ï¼å¹¶æè¯·æ±è½¬åç»codis serverã\n * Zookeeper éç¾¤ï¼ä¿å­éç¾¤åæ°æ®ï¼ä¾å¦æ°æ®ä½ç½®ä¿¡æ¯åcodis proxyä¿¡æ¯ãè¿éï¼æä¸ªå°æ¹éè¦ä½ æ³¨æï¼é¤äºä½¿ç¨Zookeeperï¼Codisè¿å¯ä»¥ä½¿ç¨etcdææ¬å°æä»¶ç³»ç»ä¿å­åæ°æ®ä¿¡æ¯ã\n * codis dashboard å codis feï¼å±åç»æäºéç¾¤ç®¡çå·¥å·ãå¶ä¸­ï¼codis dashboardè´è´£æ§è¡éç¾¤ç®¡çå·¥ä½ï¼åæ¬å¢å codis serverãcodis proxyåè¿è¡æ°æ®è¿ç§»ãècodis feè´è´£æä¾dashboardçWebæä½çé¢ï¼ä¾¿äºæä»¬ç´æ¥å¨Webçé¢ä¸è¿è¡éç¾¤ç®¡çã\n\næç¨ä¸å¼ å¾æ¥å±ç¤ºä¸ Codis éç¾¤çæ¶æåå³é®ç»ä»¶ï¼\n\nä¸é¢å·ä½è§£éä¸ä¸ Codis æ¯å¦ä½å¤çè¯·æ±çï¼\n\n * é¦åï¼ä¸ºäºè®©éç¾¤è½æ¥æ¶å¹¶å¤çè¯·æ±ï¼æä»¬è¦åä½¿ç¨ codis dashboard è®¾ç½® codis server å codis proxy çè®¿é®å°åï¼å®æè®¾ç½®åï¼codis server å codis proxy æä¼å¼å§æ¥æ¶è¿æ¥ã\n * ç¶åï¼å½å®¢æ·ç«¯è¦è¯»åæ°æ®æ¶ï¼å®¢æ·ç«¯ç´æ¥åcodis proxyå»ºç«è¿æ¥ãcodis proxy æ¬èº«æ¯æ Redis ç RESP äº¤äºåè®®ï¼æä»¥å®¢æ·ç«¯è®¿é®codis proxyæ¶ï¼åè®¿é®åççRediså®ä¾æ²¡æä»ä¹åºå«ï¼è¿æ ·ä¸æ¥ï¼åæ¬è¿æ¥åå®ä¾çå®¢æ·ç«¯å°±å¯ä»¥è½»æ¾å°åCodiséç¾¤å»ºç«èµ·è¿æ¥äºã\n * æåï¼codis proxyæ¥æ¶å°è¯·æ±ï¼å°±ä¼æ¥è¯¢è¯·æ±æ°æ®åcodis serverçæ å°å³ç³»ï¼å¹¶æè¯·æ±è½¬åç»ç¸åºçcodis serverè¿è¡å¤çãå½codis serverå¤çå®è¯·æ±åï¼ä¼æç»æè¿åç»codis proxyï¼proxyåææ°æ®è¿åç»å®¢æ·ç«¯ã\n\nç¨ä¸å¼ å¾æ¥å±ç¤ºè¿ä¸ªå¤çæµç¨ï¼\n\n\n# 2.2 Codis çå³é®ææ¯åç\n\nè¿éå°å´ç»å½±ååçéç¾¤ä½¿ç¨ææç 4 æ¹é¢ææ¯å ç´ ï¼æ°æ®åå¸ãéç¾¤æ©å®¹åæ°æ®è¿ç§»ãå®¢æ·ç«¯å¼å®¹æ§ãå¯é æ§ä¿è¯ï¼æ¥è®¨è®ºå®ä»¬çå·ä½è®¾è®¡éæ©ååçã\n\n# 2.2.1 æ°æ®å¦ä½å¨éç¾¤éåå¸ï¼\n\nå¨ Codis éç¾¤ä¸­ï¼ä¸ä¸ªæ°æ®åºè¯¥ä¿å­å¨åªä¸ªcodis serverä¸ï¼è¿æ¯éè¿é»è¾æ§½ï¼Slotï¼æ å°æ¥å®æçï¼å·ä½æ¥è¯´ï¼æ»å±åæä¸¤æ­¥ï¼\n\n 1. ç¬¬ä¸æ­¥ï¼Codiséç¾¤ä¸å±æ1024ä¸ªSlotï¼ç¼å·ä¾æ¬¡æ¯0å°1023ãæä»¬å¯ä»¥æè¿äºSlotæå¨åéç»codis serverï¼æ¯ä¸ªserverä¸åå«ä¸é¨åSlotãå½ç¶ï¼æä»¬ä¹å¯ä»¥è®©codis dashboardè¿è¡èªå¨åéï¼ä¾å¦ï¼dashboardæ1024ä¸ªSlotå¨ææserverä¸ååã\n 2. ç¬¬äºæ­¥ï¼å½å®¢æ·ç«¯è¦è¯»åæ°æ®æ¶ï¼ä¼ä½¿ç¨CRC32ç®æ³è®¡ç®æ°æ®keyçåå¸å¼ï¼å¹¶æè¿ä¸ªåå¸å¼å¯¹1024åæ¨¡ãèåæ¨¡åçå¼ï¼åå¯¹åºSlotçç¼å·ãæ­¤æ¶ï¼æ ¹æ®ç¬¬ä¸æ­¥åéçSlotåserverå¯¹åºå³ç³»ï¼æä»¬å°±å¯ä»¥ç¥éæ°æ®ä¿å­å¨åªä¸ªserverä¸äºã\n\nè¿ä¸ªè¿ç¨å¦ä¸å¾æç¤ºï¼\n\næ°æ®keyåSlotçæ å°å³ç³»æ¯å®¢æ·ç«¯å¨è¯»åæ°æ®åç´æ¥éè¿CRC32è®¡ç®å¾å°çï¼èSlotåcodis serverçæ å°å³ç³»æ¯éè¿åéå®æçï¼æä»¥å°±éè¦ç¨ä¸ä¸ªå­å¨ç³»ç»ä¿å­ä¸æ¥ï¼å¦åï¼å¦æéç¾¤ææéäºï¼æ å°å³ç³»å°±ä¼ä¸¢å¤±ã\n\næä»¬æSlotåcodis serverçæ å°å³ç³»ç§°ä¸ºæ°æ®è·¯ç±è¡¨ï¼ç®ç§°è·¯ç±è¡¨ï¼ãæä»¬å¨codis dashboardä¸åéå¥½è·¯ç±è¡¨åï¼dashboardä¼æè·¯ç±è¡¨åéç»codis proxyï¼åæ¶ï¼dashboardä¹ä¼æè·¯ç±è¡¨ä¿å­å¨Zookeeperä¸­ãcodis-proxyä¼æè·¯ç±è¡¨ç¼å­å¨æ¬å°ï¼å½å®æ¥æ¶å°å®¢æ·ç«¯è¯·æ±åï¼ç´æ¥æ¥è¯¢æ¬å°çè·¯ç±è¡¨ï¼å°±å¯ä»¥å®ææ­£ç¡®çè¯·æ±è½¬åäºãä¸å¾å±ç¤ºäºè·¯ç±è¡¨çåéåä½¿ç¨è¿ç¨ï¼\n\nå¨æ°æ®åççå®ç°æ¹æ³ä¸ï¼Codis å Redis Cluster å¾ç¸ä¼¼ï¼é½éç¨äº key æ å°å° SlotãSlot ååéå°å®ä¾ä¸çæºå¶ãä½æ¯ï¼è¿éæä¸ä¸ªææ¾çåºå«ï¼\n\n * Codisä¸­çè·¯ç±è¡¨æ¯æä»¬éè¿codis dashboardåéåä¿®æ¹çï¼å¹¶è¢«ä¿å­å¨Zookeeperéç¾¤ä¸­ãä¸æ¦æ°æ®ä½ç½®åçååï¼ä¾å¦æå®ä¾å¢åï¼ï¼è·¯ç±è¡¨è¢«ä¿®æ¹äºï¼codis dashbaordå°±ä¼æä¿®æ¹åçè·¯ç±è¡¨åéç»codis proxyï¼proxyå°±å¯ä»¥æ ¹æ®ææ°çè·¯ç±ä¿¡æ¯è½¬åè¯·æ±äºã\n * å¨Redis Clusterä¸­ï¼æ°æ®è·¯ç±è¡¨æ¯éè¿æ¯ä¸ªå®ä¾ç¸äºé´çéä¿¡ä¼ éçï¼æåä¼å¨æ¯ä¸ªå®ä¾ä¸ä¿å­ä¸ä»½ãå½æ°æ®è·¯ç±ä¿¡æ¯åçååæ¶ï¼å°±éè¦å¨ææå®ä¾é´éè¿ç½ç»æ¶æ¯è¿è¡ä¼ éãæä»¥ï¼å¦æå®ä¾æ°éè¾å¤çè¯ï¼å°±ä¼æ¶èè¾å¤çéç¾¤ç½ç»èµæºã\n\næ°æ®åå¸è§£å³äºæ°æ°æ®åå¥æ¶è¯¥ä¿å­å¨åªä¸ªserverçé®é¢ï¼ä½æ¯ï¼å½ä¸å¡æ°æ®å¢å åï¼å¦æéç¾¤ä¸­çç°æå®ä¾ä¸è¶³ä»¥ä¿å­æææ°æ®ï¼æä»¬å°±éè¦å¯¹éç¾¤è¿è¡æ©å®¹ãæ¥ä¸æ¥ï¼æä»¬åæ¥å­¦ä¹ ä¸Codiséå¯¹éç¾¤æ©å®¹çå³é®ææ¯è®¾è®¡ã\n\n# 2.2.2 éç¾¤æ©å®¹åæ°æ®è¿ç§»å¦ä½è¿è¡?\n\nCodis éç¾¤æ©å®¹åæ¬äºä¸¤æ¹é¢ï¼å¢å  codis server åå¢å  codis proxyã\n\n----------------------------------------\n\næä»¬åæ¥çå¢å  codis serverï¼è¿ä¸ªè¿ç¨ä¸»è¦æ¶åå°ä¸¤æ­¥æä½ï¼\n\n 1. å¯å¨æ°ç codis serverï¼å°å®å å¥éç¾¤ä¸­ï¼\n 2. æé¨åæ°æ®è¿ç§»å°æ°ç serverã\n\néè¦æ³¨æçæ¯ï¼è¿éçæ°æ®è¿ç§»æ¯ä¸ä¸ªéè¦çæºå¶ãCodis éç¾¤æç§ Slot çç²åº¦è¿è¡æ°æ®è¿ç§»ï¼æä»¬æ¥çä¸è¿ç§»çåºæ¬æµç¨ï¼\n\n 1. å¨æºserverä¸ï¼Codisä»è¦è¿ç§»çSlotä¸­éæºéæ©ä¸ä¸ªæ°æ®ï¼åéç»ç®çserverã\n 2. ç®çserverç¡®è®¤æ¶å°æ°æ®åï¼ä¼ç»æºserverè¿åç¡®è®¤æ¶æ¯ãè¿æ¶ï¼æºserverä¼å¨æ¬å°å°åæè¿ç§»çæ°æ®å é¤ã\n 3. ç¬¬ä¸æ­¥åç¬¬äºæ­¥å°±æ¯åä¸ªæ°æ®çè¿ç§»è¿ç¨ãCodisä¼ä¸æ­éå¤è¿ä¸ªè¿ç§»è¿ç¨ï¼ç´å°è¦è¿ç§»çSlotä¸­çæ°æ®å¨é¨è¿ç§»å®æã\n\nä¸å¾æ¾ç¤ºäºæ°æ®è¿ç§»çæµç¨ï¼\n\néå¯¹åæä»ç»çåä¸ªæ°æ®çè¿ç§»è¿ç¨ï¼Codiså®ç°äºä¸¤ç§è¿ç§»æ¨¡å¼ï¼åå«æ¯åæ­¥è¿ç§»åå¼æ­¥è¿ç§»ï¼\n\n * åæ­¥è¿ç§»æ¯æï¼å¨æ°æ®ä»æºserveråéç»ç®çserverçè¿ç¨ä¸­ï¼æºserveræ¯é»å¡çï¼æ æ³å¤çæ°çè¯·æ±æä½ãè¿ç§æ¨¡å¼å¾å®¹æå®ç°ï¼ä½æ¯è¿ç§»è¿ç¨ä¸­ä¼æ¶åå¤ä¸ªæä½ï¼åæ¬æ°æ®å¨æºserveråºååãç½ç»ä¼ è¾ãå¨ç®çserverååºååï¼ä»¥åå¨æºserverå é¤ï¼ï¼å¦æè¿ç§»çæ°æ®æ¯ä¸ä¸ªbigkeyï¼æºserverå°±ä¼é»å¡è¾é¿æ¶é´ï¼æ æ³åæ¶å¤çç¨æ·è¯·æ±ã\n * ä¸ºäºé¿åæ°æ®è¿ç§»é»å¡æºserverï¼Codiså®ç°çç¬¬äºç§è¿ç§»æ¨¡å¼å°±æ¯å¼æ­¥è¿ç§»ãå¼æ­¥è¿ç§»çå³é®ç¹ç¹æä¸¤ä¸ªï¼\n   * ç¬¬ä¸ä¸ªç¹ç¹æ¯ï¼å½æºserverææ°æ®åéç»ç®çserveråï¼å°±å¯ä»¥å¤çå¶ä»è¯·æ±æä½äºï¼ä¸ç¨ç­å°ç®çserverçå½ä»¤æ§è¡å®ãèç®çserverä¼å¨æ¶å°æ°æ®å¹¶ååºååä¿å­å°æ¬å°åï¼ç»æºserveråéä¸ä¸ªACKæ¶æ¯ï¼è¡¨æè¿ç§»å®æãæ­¤æ¶ï¼æºserverå¨æ¬å°æåæè¿ç§»çæ°æ®å é¤ãå¨è¿ä¸ªè¿ç¨ä¸­ï¼è¿ç§»çæ°æ®ä¼è¢«è®¾ç½®ä¸ºåªè¯»ï¼æä»¥ï¼æºserverä¸çæ°æ®ä¸ä¼è¢«ä¿®æ¹ï¼èªç¶ä¹å°±ä¸ä¼åºç°âåç®çserverä¸çæ°æ®ä¸ä¸è´âçé®é¢äºã\n   * ç¬¬äºä¸ªç¹ç¹æ¯ï¼å¯¹äºbigkeyï¼å¼æ­¥è¿ç§»éç¨äºæåæä»¤çæ¹å¼è¿è¡è¿ç§»ãå·ä½æ¥è¯´å°±æ¯ï¼å¯¹bigkeyä¸­æ¯ä¸ªåç´ ï¼ç¨ä¸æ¡æä»¤è¿è¡è¿ç§»ï¼èä¸æ¯ææ´ä¸ªbigkeyè¿è¡åºååååæ´ä½ä¼ è¾ãè¿ç§åæ´ä¸ºé¶çæ¹å¼ï¼å°±é¿åäºbigkeyè¿ç§»æ¶ï¼å ä¸ºè¦åºååå¤§éæ°æ®èé»å¡æºserverçé®é¢ãæ­¤å¤ï¼å½bigkeyè¿ç§»äºä¸é¨åæ°æ®åï¼å¦æCodisåçæéï¼å°±ä¼å¯¼è´bigkeyçä¸é¨ååç´ å¨æºserverï¼èå¦ä¸é¨ååç´ å¨ç®çserverï¼è¿å°±ç ´åäºè¿ç§»çåå­æ§ãæä»¥ï¼Codisä¼å¨ç®æ serverä¸ï¼ç»bigkeyçåç´ è®¾ç½®ä¸ä¸ªä¸´æ¶è¿ææ¶é´ãå¦æè¿ç§»è¿ç¨ä¸­åçæéï¼é£ä¹ï¼ç®æ serverä¸çkeyä¼å¨è¿æåè¢«å é¤ï¼ä¸ä¼å½±åè¿ç§»çåå­æ§ãå½æ­£å¸¸å®æè¿ç§»åï¼bigkeyåç´ çä¸´æ¶è¿ææ¶é´ä¼è¢«å é¤ã\n\n> è¿éï¼æä¸ªå°æ¹éè¦ä½ æ³¨æä¸ï¼ä¸ºäºæåè¿ç§»çæçï¼Codiså¨å¼æ­¥è¿ç§»Slotæ¶ï¼åè®¸æ¯æ¬¡è¿ç§»å¤ä¸ªkeyãä½ å¯ä»¥éè¿å¼æ­¥è¿ç§»å½ä»¤SLOTSMGRTTAGSLOT-ASYNCçåæ°numkeysè®¾ç½®æ¯æ¬¡è¿ç§»çkeyæ°éã\n\n----------------------------------------\n\nååè®²çæ¯ codis server çæ©å®¹åæ°æ®è¿ç§»æºå¶ï¼é¤æ­¤ä¹å¤ï¼æä»¬å¯è½è¿éè¦å¢å  codis proxyãå ä¸ºå¨ Codis éç¾¤ä¸­ï¼å®¢æ·ç«¯æ¯å codis proxy ç´æ¥è¿æ¥çï¼æä»¥ï¼å½å®¢æ·ç«¯å¢å æ¶ï¼ä¸ä¸ªproxyæ æ³æ¯æå¤§éçè¯·æ±æä½ï¼æ­¤æ¶ï¼æä»¬å°±éè¦å¢å proxyã\n\nå¢å proxyæ¯è¾å®¹æï¼æä»¬ç´æ¥å¯å¨proxyï¼åéè¿codis dashboardæproxyå å¥éç¾¤å°±è¡ã\n\næ­¤æ¶ï¼codis proxyçè®¿é®è¿æ¥ä¿¡æ¯é½ä¼ä¿å­å¨Zookeeperä¸ãæä»¥ï¼å½æ°å¢äºproxyåï¼Zookeeperä¸ä¼æææ°çè®¿é®åè¡¨ï¼å®¢æ·ç«¯ä¹å°±å¯ä»¥ä»Zookeeperä¸è¯»åproxyè®¿é®åè¡¨ï¼æè¯·æ±åéç»æ°å¢çproxyãè¿æ ·ä¸æ¥ï¼å®¢æ·ç«¯çè®¿é®ååå°±å¯ä»¥å¨å¤ä¸ªproxyä¸åæå¤çäºï¼å¦ä¸å¾æç¤ºï¼\n\nå¥½äºï¼å°è¿éï¼æä»¬å°±äºè§£äºCodiséç¾¤ä¸­çæ°æ®åå¸ãéç¾¤æ©å®¹åæ°æ®è¿ç§»çæ¹æ³ï¼è¿é½æ¯åçéç¾¤ä¸­çå³é®æºå¶ã\n\n# 2.2.3 å®¢æ·ç«¯çå¼å®¹æ§\n\nä½¿ç¨ Redis åå®ä¾æ¶ï¼å®¢æ·ç«¯åªè¦ç¬¦å RESP åè®®ï¼å°±å¯ä»¥åå®ä¾è¿è¡äº¤äºåè¯»åæ°æ®ãä½æ¯ï¼å¨ä½¿ç¨åçéç¾¤æ¶ï¼æäºåè½æ¯ååå®ä¾ä¸ä¸æ ·çï¼æ¯å¦éç¾¤ä¸­çæ°æ®è¿ç§»æä½ï¼å¨åå®ä¾ä¸æ¯æ²¡æçï¼èä¸è¿ç§»è¿ç¨ä¸­ï¼æ°æ®è®¿é®è¯·æ±å¯è½è¦è¢«éå®åï¼ä¾å¦Redis Clusterä¸­çMOVEå½ä»¤ï¼ãæä»¥ï¼å®¢æ·ç«¯éè¦å¢å åéç¾¤åè½ç¸å³çå½ä»¤æä½çæ¯æãå¦æåæ¥ä½¿ç¨åå®ä¾å®¢æ·ç«¯ï¼æ³è¦æ©å®¹ä½¿ç¨éç¾¤ï¼å°±éè¦ä½¿ç¨æ°å®¢æ·ç«¯ï¼è¿å¯¹äºä¸å¡åºç¨çå¼å®¹æ§æ¥è¯´ï¼å¹¶ä¸æ¯ç¹å«åå¥½ã\n\n> æä»¥å¯¹äºä½¿ç¨åçéç¾¤ Redis Cluster èè¨ï¼è¦æ³ä»åå®ä¾æ©å®¹æéç¾¤ï¼å°±éè¦ä»åå®ä¾å®¢æ·ç«¯æ¢ææ°çå®¢æ·ç«¯ï¼å¯¹ä¸å¡åºç¨çå¼å®¹æ§èè¨ï¼ä¸æ¯å¾åå¥½ã\n\nCodis éç¾¤å¨è®¾è®¡æ¶ï¼å°±ååèèäºå¯¹ç°æåå®ä¾å®¢æ·ç«¯çå¼å®¹æ§ãCodis ä½¿ç¨ codis proxy ç´æ¥åå®¢æ·ç«¯è¿æ¥ï¼codis proxy æ¯ååå®ä¾å®¢æ·ç«¯å¼å®¹çãèåéç¾¤ç¸å³çç®¡çå·¥ä½ï¼ä¾å¦è¯·æ±è½¬åãæ°æ®è¿ç§»ç­ï¼ï¼é½ç± codis proxyãcodis dashboard è¿äºç»ä»¶æ¥å®æï¼ä¸éè¦å®¢æ·ç«¯åä¸ã\n\nè¿æ ·ä¸æ¥ï¼ä¸å¡åºç¨ä½¿ç¨ Codis éç¾¤æ¶ï¼å°±ä¸ç¨ä¿®æ¹å®¢æ·ç«¯äºï¼å¯ä»¥å¤ç¨ååå®ä¾è¿æ¥çå®¢æ·ç«¯ï¼æ¢è½å©ç¨éç¾¤è¯»åå¤§å®¹éæ°æ®ï¼åé¿åäºä¿®æ¹å®¢æ·ç«¯å¢å å¤æçæä½é»è¾ï¼ä¿è¯äºä¸å¡ä»£ç çç¨³å®æ§åå¼å®¹æ§ã\n\n# 2.2.4 æä¹ä¿è¯éç¾¤å¯é æ§ï¼\n\nå¯¹äºä¸ä¸ªåå¸å¼ç³»ç»æ¥è¯´ï¼å®çå¯é æ§åç³»ç»ä¸­çç»ä»¶ä¸ªæ°æå³ï¼ç»ä»¶è¶å¤ï¼æ½å¨çé£é©ç¹ä¹å°±è¶å¤ãåRedis Clusteråªåå«Rediså®ä¾ä¸ä¸æ ·ï¼Codiséç¾¤åå«çç»ä»¶æ4ç±»ãé£ä½ å°±ä¼é®äºï¼è¿ä¹å¤ç»ä»¶ä¼éä½Codiséç¾¤çå¯é æ§åï¼\n\næä»¬æ¥åå«çä¸ Codis ä¸åç»ä»¶çå¯é æ§ä¿è¯æ¹æ³ã\n\n----------------------------------------\n\né¦åæ¯ codis serverã\n\ncodis serverå¶å®å°±æ¯Rediså®ä¾ï¼åªä¸è¿å¢å äºåéç¾¤æä½ç¸å³çå½ä»¤ãRedisçä¸»ä»å¤å¶æºå¶åå¨åµæºå¶å¨codis serverä¸é½æ¯å¯ä»¥ä½¿ç¨çï¼æä»¥ï¼Codiså°±ä½¿ç¨ä¸»ä»éç¾¤æ¥ä¿è¯codis serverçå¯é æ§ãç®åæ¥è¯´å°±æ¯ï¼Codisç»æ¯ä¸ªserveréç½®ä»åºï¼å¹¶ä½¿ç¨å¨åµæºå¶è¿è¡çæ§ï¼å½åçæéæ¶ï¼ä¸»ä»åºå¯ä»¥è¿è¡åæ¢ï¼ä»èä¿è¯äºserverçå¯é æ§ã\n\nå¨è¿ç§éç½®æåµä¸ï¼æ¯ä¸ªserverå°±æä¸ºäºä¸ä¸ªserver groupï¼æ¯ä¸ªgroupä¸­æ¯ä¸ä¸»å¤ä»çserverãæ°æ®åå¸ä½¿ç¨çSlotï¼ä¹æ¯æç§groupçç²åº¦è¿è¡åéçãåæ¶ï¼codis proxyå¨è½¬åè¯·æ±æ¶ï¼ä¹æ¯æç§æ°æ®æå¨çSlotågroupçå¯¹åºå³ç³»ï¼æåè¯·æ±åå°ç¸åºgroupçä¸»åºï¼è¯»è¯·æ±åå°groupä¸­çä¸»åºæä»åºä¸ã\n\nä¸å¾å±ç¤ºçæ¯éç½®äºserver groupçCodiséç¾¤æ¶æãå¨Codiséç¾¤ä¸­ï¼æä»¬éè¿é¨ç½²server groupåå¨åµéç¾¤ï¼å®ç°codis serverçä¸»ä»åæ¢ï¼æåéç¾¤å¯é æ§ï¼\n\n----------------------------------------\n\nåçä¸ä¸ codis proxy å Zookeeper çå¯é æ§ãè¿ä¿©ç»ä»¶æ¯æ­éä½¿ç¨çã\n\nå¨Codiséç¾¤è®¾è®¡æ¶ï¼proxyä¸çä¿¡æ¯æºå¤´é½æ¯æ¥èªZookeeperï¼ä¾å¦è·¯ç±è¡¨ï¼ãèZookeeperéç¾¤ä½¿ç¨å¤ä¸ªå®ä¾æ¥ä¿å­æ°æ®ï¼åªè¦æè¶è¿åæ°çZookeeperå®ä¾å¯ä»¥æ­£å¸¸å·¥ä½ï¼ Zookeeperéç¾¤å°±å¯ä»¥æä¾æå¡ï¼ä¹å¯ä»¥ä¿è¯è¿äºæ°æ®çå¯é æ§ã\n\næä»¥ï¼codis proxyä½¿ç¨Zookeeperéç¾¤ä¿å­è·¯ç±è¡¨ï¼å¯ä»¥ååå©ç¨Zookeeperçé«å¯é æ§ä¿è¯æ¥ç¡®ä¿codis proxyçå¯é æ§ï¼ä¸ç¨ååé¢å¤çå·¥ä½äºãå½codis proxyåçæéåï¼ç´æ¥éå¯proxyå°±è¡ãéå¯åçproxyï¼å¯ä»¥éè¿codis dashboardä»Zookeeperéç¾¤ä¸è·åè·¯ç±è¡¨ï¼ç¶åï¼å°±å¯ä»¥æ¥æ¶å®¢æ·ç«¯è¯·æ±è¿è¡è½¬åäºãè¿æ ·çè®¾è®¡ï¼ä¹éä½äºCodiséç¾¤æ¬èº«çå¼åå¤æåº¦ã\n\n----------------------------------------\n\nå¯¹äºcodis dashboardåcodis feæ¥è¯´ï¼å®ä»¬ä¸»è¦æä¾éç½®ç®¡çåç®¡çåæå·¥æä½ï¼è´è½½ååä¸å¤§ï¼æä»¥ï¼å®ä»¬çå¯é æ§å¯ä»¥ä¸ç¨é¢å¤è¿è¡ä¿è¯äºã\n\n\n# 2.3 åçéç¾¤æ¹æ¡éæ©å»ºè®®\n\nä¸å¾æ»ç»äº Codis å Redis Cluster ä¸¤ç§åçéç¾¤æ¹æ¡ï¼å¯¹æ¯å¦ä¸ï¼\n\næåï¼å¨å®éåºç¨çæ¶åï¼å¯¹äºè¿ä¸¤ç§æ¹æ¡çéæ©æå¦ä¸å»ºè®®ï¼\n\n 1. ä»ç¨³å®æ§åæçåº¦æ¥çï¼Codisåºç¨å¾æ¯è¾æ©ï¼å¨ä¸çå·²ç»æäºæçççäº§é¨ç½²ãè½ç¶Codiså¼å¥äºproxyåZookeeperï¼å¢å äºéç¾¤å¤æåº¦ï¼ä½æ¯ï¼proxyçæ ç¶æè®¾è®¡åZookeeperèªèº«çç¨³å®æ§ï¼ä¹ç»Codisçç¨³å®ä½¿ç¨æä¾äºä¿è¯ãèRedis Clusterçæ¨åºæ¶é´æäºCodisï¼ç¸å¯¹æ¥è¯´ï¼æçåº¦è¦å¼±äºCodisï¼å¦æä½ æ³éæ©ä¸ä¸ªæçç¨³å®çæ¹æ¡ï¼Codisæ´å åéäºã\n\n 2. ä»ä¸å¡åºç¨å®¢æ·ç«¯å¼å®¹æ§æ¥çï¼è¿æ¥åå®ä¾çå®¢æ·ç«¯å¯ä»¥ç´æ¥è¿æ¥codis proxyï¼èåæ¬è¿æ¥åå®ä¾çå®¢æ·ç«¯è¦æ³è¿æ¥Redis Clusterçè¯ï¼å°±éè¦å¼åæ°åè½ãæä»¥ï¼å¦æä½ çä¸å¡åºç¨ä¸­å¤§éä½¿ç¨äºåå®ä¾çå®¢æ·ç«¯ï¼èç°å¨æ³åºç¨åçéç¾¤çè¯ï¼å»ºè®®ä½ éæ©Codisï¼è¿æ ·å¯ä»¥é¿åä¿®æ¹ä¸å¡åºç¨ä¸­çå®¢æ·ç«¯ã\n\n 3. ä»ä½¿ç¨Redisæ°å½ä»¤åæ°ç¹æ§æ¥çï¼Codis serveræ¯åºäºå¼æºçRedis 3.2.8å¼åçï¼æä»¥ï¼Codiså¹¶ä¸æ¯æRedisåç»­çå¼æºçæ¬ä¸­çæ°å¢å½ä»¤åæ°æ®ç±»åãå¦å¤ï¼Codiså¹¶æ²¡æå®ç°å¼æºRedisçæ¬çææå½ä»¤ï¼æ¯å¦BITOPãBLPOPãBRPOPï¼ä»¥ååä¸äºå¡ç¸å³çMUTLIãEXECç­å½ä»¤ã Codiså®ç½ ä¸ååºäºä¸è¢«æ¯æçå½ä»¤åè¡¨ï¼ä½ å¨ä½¿ç¨æ¶è®°å¾å»æ ¸æ¥ä¸ä¸ãæä»¥ï¼å¦æä½ æ³ä½¿ç¨å¼æºRedis çæ¬çæ°ç¹æ§ï¼Redis Clusteræ¯ä¸ä¸ªåéçéæ©ã\n\n 4. ä»æ°æ®è¿ç§»æ§è½ç»´åº¦æ¥çï¼Codisè½æ¯æå¼æ­¥è¿ç§»ï¼å¼æ­¥è¿ç§»å¯¹éç¾¤å¤çæ­£å¸¸è¯·æ±çæ§è½å½±åè¦æ¯ä½¿ç¨åæ­¥è¿ç§»çå°ãæä»¥ï¼å¦æä½ å¨åºç¨éç¾¤æ¶ï¼æ°æ®è¿ç§»æ¯è¾é¢ç¹çè¯ï¼Codisæ¯ä¸ªæ´åéçéæ©ã\n\nå¦å¤è¿éåæä¾ä¸ä¸ª Codis ä½¿ç¨ä¸çå°å»ºè®®ï¼å½ä½ æå¤æ¡ä¸å¡çº¿è¦ä½¿ç¨ Codis æ¶ï¼å¯ä»¥å¯å¨å¤ä¸ª codis dashboardï¼æ¯ä¸ª dashboard ç®¡çä¸é¨å codis serverï¼åæ¶ï¼åç¨ä¸ä¸ª dashboard å¯¹åºè´è´£ä¸ä¸ªä¸å¡çº¿çéç¾¤ç®¡çï¼è¿æ ·å°±å¯ä»¥åå°ç¨ä¸ä¸ª Codis éç¾¤å®ç°å¤æ¡ä¸å¡çº¿çéç¦»ç®¡çäºã",normalizedContent:"> åèï¼\n> \n>  * 09 åçéç¾¤ï¼æ°æ®å¢å¤äºï¼æ¯è¯¥å åå­è¿æ¯å å®ä¾ï¼| æå®¢æ¶é´\n>  * 35 codis vs redis clusterï¼æè¯¥éæ©åªä¸ä¸ªéç¾¤æ¹æ¡ï¼| æå®¢æ¶é´\n\n\n# 1. åçéç¾¤ï¼æ°æ®å¢å¤äºï¼æ¯è¯¥å åå­è¿æ¯å å®ä¾ï¼\n\næè¿ä¹ä¸ä¸ªéæ±ï¼è¦ç¨ redis ä¿å­ 5000 ä¸ä¸ªé®å¼å¯¹ï¼æ¯ä¸ªé®å¼å¯¹å¤§çº¦æ¯ 512bï¼ä¸ºäºè½å¿«éé¨ç½²å¹¶å¯¹å¤æä¾æå¡ï¼æä»¬éç¨äºä¸»æºæ¥è¿è¡ redis å®ä¾ï¼é£ä¹ï¼è¯¥å¦ä½éæ©äºä¸»æºçåå­å®¹éå¢ï¼\n\nç²ç¥è®¡ç®ä¸ä¸ï¼è¿äº kv æå çåå­ç©ºé´å¤§çº¦ä¸º 25gbï¼æä»¥ç¬¬ä¸ååºæ¯éæ©ä¸å° 32g åå­çäºä¸»æºæ¥é¨ç½² redisãä½å¨ä½¿ç¨è¿ç¨ä¸­ä¼åç°ï¼redis ååºææ¶ä¼éå¸¸æ¢ï¼è¿æ¶ä½¿ç¨ info å½ä»¤æ¥ç redis ç latest_fork_usec ææ å¼ï¼è¡¨ç¤ºæè¿ä¸æ¬¡ fork çèæ¶ï¼ï¼ç»ææ¾ç¤ºè¿ä¸ªææ å¼ç¹å«é«ï¼å¿«å°ç§çº§å«äºã\n\nè¿è· redis çæä¹åæºå¶æå³ç³»ãå¨ä½¿ç¨ rdb è¿è¡æä¹åæ¶ï¼redis ä¼ fork å­è¿ç¨æ¥å®æï¼fork æä½çç¨æ¶å redis çæ°æ®éæ¯æ­£ç¸å³çï¼è fork å¨æ§è¡æ¶ä¼é»å¡ä¸»çº¿ç¨ãæ°æ®éè¶å¤§ï¼fork æä½é æçä¸»çº¿ç¨é»å¡çæ¶é´è¶é¿ãæä»¥ï¼å¨ä½¿ç¨ rdb å¯¹ 25gb çæ°æ®è¿è¡æä¹åæ¶ï¼æ°æ®éè¾å¤§ï¼åå°è¿è¡çå­è¿ç¨å¨ fork åå»ºæ¶é»å¡äºä¸»çº¿ç¨ï¼äºæ¯å°±å¯¼è´ redis ååºåæ¢äºã\n\nçæ¥ï¼ç¬¬ä¸ä¸ªæ¹æ¡æ¾ç¶æ¯ä¸å¯è¡çï¼æä»¬å¿é¡»è¦å¯»æ¾å¶ä»çæ¹æ¡ãè¿ä¸ªæ¶åï¼æä»¬æ³¨æå°äº redis çåçéç¾¤ãè½ç¶ç»å»ºåçéç¾¤æ¯è¾éº»ç¦ï¼ä½æ¯å®å¯ä»¥ä¿å­å¤§éæ°æ®ï¼èä¸å¯¹ redis ä¸»çº¿ç¨çé»å¡å½±åè¾å°ã\n\nåçéç¾¤ï¼ä¹å«åçéç¾¤ï¼å°±æ¯æå¯å¨å¤ä¸ª redis å®ä¾ç»æä¸ä¸ªéç¾¤ï¼ç¶åæç§ä¸å®çè§åï¼ææ¶å°çæ°æ®ååæå¤ä»½ï¼æ¯ä¸ä»½ç¨ä¸ä¸ªå®ä¾æ¥ä¿å­ãåå°æä»¬ååçåºæ¯ä¸­ï¼å¦ææ 25gb çæ°æ®å¹³ååæ 5 ä»½ï¼å½ç¶ï¼ä¹å¯ä»¥ä¸åååï¼ï¼ä½¿ç¨ 5 ä¸ªå®ä¾æ¥ä¿å­ï¼æ¯ä¸ªå®ä¾åªéè¦ä¿å­ 5gb æ°æ®ãå¦ä¸å¾æç¤ºï¼\n\né£ä¹ï¼å¨åçéç¾¤ä¸­ï¼å®ä¾å¨ä¸º 5gb æ°æ®çæ rdb æ¶ï¼æ°æ®éå°±å°äºå¾å¤ï¼fork å­è¿ç¨ä¸è¬ä¸ä¼ç»ä¸»çº¿ç¨å¸¦æ¥è¾é¿æ¶é´çé»å¡ãéç¨å¤ä¸ªå®ä¾ä¿å­æ°æ®åçåï¼æä»¬æ¢è½ä¿å­ 25gb æ°æ®ï¼åé¿åäº fork å­è¿ç¨é»å¡ä¸»çº¿ç¨èå¯¼è´çååºçªç¶åæ¢ã\n\nå¨å®éåºç¨ redis æ¶ï¼éçç¨æ·æä¸å¡è§æ¨¡çæ©å±ï¼ä¿å­å¤§éæ°æ®çæåµéå¸¸æ¯æ æ³é¿åçãèåçéç¾¤ï¼å°±æ¯ä¸ä¸ªéå¸¸å¥½çè§£å³æ¹æ¡ãè¿èè¯¾ï¼æä»¬å°±æ¥å­¦ä¹ ä¸ä¸ã\n\n\n# 1.1 å¦ä½ä¿å­æ´å¤æ°æ®ï¼\n\nå¨ååçæ¡ä¾éï¼ä¸ºäºä¿å­å¤§éæ°æ®ï¼æä»¬ä½¿ç¨äºå¤§åå­äºä¸»æºååçéç¾¤ä¸¤ç§æ¹æ³ãå®éä¸ï¼è¿ä¸¤ç§æ¹æ³åå«å¯¹åºç redis åºå¯¹æ°æ®éå¢å¤çä¸¤ç§æ¹æ¡ï¼çºµåæ©å±åæ¨ªåæ©å±ï¼\n\n * çºµåæ©å±ï¼scale upï¼ï¼åçº§åä¸ª redis å®ä¾çèµæºéç½®ï¼åæ¬å¢å åå­å®¹éãå¢å ç£çå®¹éãä½¿ç¨æ´é«éç½®ç cpuã\n * æ¨ªåæ©å±ï¼scale outï¼ï¼æ¨ªåå¢å å½å redis å®ä¾çä¸ªæ°ã\n\nä¸¤ç§æ¹å¼åæä¼ç¼ºç¹ï¼\n\n * çºµåæ©å±å®æ½ç®åï¼ä½æä¹å rdb æä»¶ä¼æ¾èéä½æ§è½ï¼èä¸ä¼åå°ç¡¬ä»¶ä¸ææ¬çéå¶ã\n   \n   * å¦æä½ ä¸è¦æ±æä¹åä¿å­redisæ°æ®ï¼é£ä¹ï¼çºµåæ©å±ä¼æ¯ä¸ä¸ªä¸éçéæ©ã\n\n * æ¨ªåæ©å±ä¸éè¦æå¿ç¡¬ä»¶åææ¬çéå¶ï¼ä½æ¶åå°å¤å®ä¾çåå¸å¼ç®¡ççé®é¢ã\n   \n   * å¨é¢åç¾ä¸ãåä¸çº§å«çç¨æ·è§æ¨¡æ¶ï¼æ¨ªåæ©å±çredisåçéç¾¤ä¼æ¯ä¸ä¸ªéå¸¸å¥½çéæ©.\n\nè¦æ³æåçéç¾¤ç¨èµ·æ¥ï¼æä»¬å°±éè¦è§£å³ä¸¤å¤§é®é¢ï¼\n\n * æ°æ®åçåï¼å¨å¤ä¸ªå®ä¾ä¹é´å¦ä½åå¸ï¼\n * å®¢æ·ç«¯æä¹ç¡®å®æ³è¦è®¿é®çæ°æ®å¨åªä¸ªå®ä¾ä¸ï¼\n\næ¥ä¸æ¥ï¼æä»¬å°±ä¸ä¸ªä¸ªå°è§£å³ã\n\n\n# 1.2 æ°æ®åçåå®ä¾çå¯¹åºåå¸å³ç³»\n\nå¨åçéç¾¤ä¸­ï¼æ°æ®éè¦åå¸å¨ä¸åå®ä¾ä¸ï¼é£ä¹ï¼æ°æ®åå®ä¾ä¹é´å¦ä½å¯¹åºå¢ï¼è¿å°±åæ¥ä¸æ¥æè¦è®²ç redis cluster æ¹æ¡æå³äºãä¸è¿ï¼æä»¬è¦åå¼æç½åçéç¾¤å redis cluster çèç³»ä¸åºå«ã\n\nå®éä¸ï¼åçéç¾¤æ¯ä¸ç§ä¿å­å¤§éæ°æ®çéç¨æºå¶ï¼è¿ä¸ªæºå¶å¯ä»¥æä¸åçå®ç°æ¹æ¡ãå¨ redis 3.0 ä¹åï¼å®æ¹å¹¶æ²¡æéå¯¹åçéç¾¤æä¾å·ä½çæ¹æ¡ãä» 3.0 å¼å§ï¼å®æ¹æä¾äºä¸ä¸ªåä¸º redis cluster çæ¹æ¡ï¼ç¨äºå®ç°åçéç¾¤ãredis cluster æ¹æ¡ä¸­å°±è§å®äºæ°æ®åå®ä¾çå¯¹åºè§åã\n\nå·ä½æ¥è¯´ï¼redis cluster æ¹æ¡éç¨åå¸æ§½ï¼hash slotï¼åé¢ç§°ä¸º slotï¼ï¼æ¥å¤çæ°æ®åå®ä¾ä¹é´çæ å°å³ç³»ãå¨ redis cluster æ¹æ¡ä¸­ï¼ä¸ä¸ªåçéç¾¤å±æ 16384 ä¸ªåå¸æ§½ï¼è¿äºåå¸æ§½ç±»ä¼¼äºæ°æ®ååºï¼æ¯ä¸ªé®å¼å¯¹é½ä¼æ ¹æ®å®ç keyï¼è¢«æ å°å°ä¸ä¸ª slot ä¸­ãå·ä½çæ å°è¿ç¨åä¸ºä¸¤å¤§æ­¥ï¼\n\n * é¦åæ ¹æ®é®å¼å¯¹ç keyï¼æç§ crc16 ç®æ³è®¡ç®ä¸ä¸ª 16bit çå¼ï¼\n * ç¶åï¼åç¨è¿ä¸ª 16bit å¼å¯¹ 16384 åæ¨¡ï¼å¾å° 0~16383 èå´åçæ¨¡æ°ï¼æ¯ä¸ªæ¨¡æ°ä»£è¡¨ä¸ä¸ªç¸åºç¼å·ç slotã\n\né£ä¹ï¼è¿äº slot åæ¯å¦ä½è¢«æ å°å°å·ä½ç redis å®ä¾ä¸çå¢ï¼æä»¬å¨é¨ç½² redis cluster æ¹æ¡æ¶ï¼å¯ä»¥ä½¿ç¨ cluster create å½ä»¤åå»ºéç¾¤ï¼æ­¤æ¶ï¼redis ä¼èªå¨æè¿äº slot å¹³ååå¸å¨éç¾¤å®ä¾ä¸ãä¾å¦ï¼å¦æéç¾¤ä¸­æ n ä¸ªå®ä¾ï¼é£ä¹ï¼æ¯ä¸ªå®ä¾ä¸çæ§½ä¸ªæ°ä¸º 16384/n ä¸ªãè¿ä¹æ¯ ddia ä¸­è®²çæ°æ®ååºæ¹æ³ä¸­çåºå®é»è¾ååºçæ¹æ³ã\n\nå½ç¶ï¼ æä»¬ä¹å¯ä»¥ä½¿ç¨ cluster meet å½ä»¤æå¨å»ºç«å®ä¾é´çè¿æ¥ï¼å½¢æéç¾¤ï¼åä½¿ç¨ cluster addslots å½ä»¤ï¼æ ¹æ®ä¸åå®ä¾çèµæºæåµæå®æ¯ä¸ªå®ä¾ä¸ç slot ä¸ªæ°ãä¸å¾å±ç¤ºäºæ°æ®ãåå¸æ§½åå®ä¾è¿ä¸èçæ å°åå¸æåµï¼\n\nç¤ºæå¾ä¸­çåçéç¾¤ä¸å±æ 3 ä¸ªå®ä¾ï¼åæ¶åè®¾æ 5 ä¸ª slotï¼æä»¬é¦åå¯ä»¥éè¿ä¸é¢çå½ä»¤æå¨åé slotï¼å®ä¾ 1 ä¿å­ slot 0 å 1ï¼å®ä¾ 2 ä¿å­ slot 2 å 3ï¼å®ä¾ 3 ä¿å­ slot 4ãéç½®å½ä»¤å¦ä¸ï¼\n\nredis-cli -h 172.16.19.3 âp 6379 cluster addslots 0,1\nredis-cli -h 172.16.19.4 âp 6379 cluster addslots 2,3\nredis-cli -h 172.16.19.5 âp 6379 cluster addslots 4\n\n\n1\n2\n3\n\n\næ³¨æï¼å¨æå¨åé slot æ¶ï¼éè¦æ 16384 ä¸ª slot é½åéå®ï¼å¦å redis éç¾¤æ æ³æ­£å¸¸å·¥ä½ã\n\nç»¼ä¸ï¼éè¿åå¸æ§½ï¼åçéç¾¤å°±å®ç°äºæ°æ®å°åå¸æ§½ãåå¸æ§½åå°å®ä¾çåéãä½æ¯ï¼å³ä½¿å®ä¾æäºåå¸æ§½çæ å°ä¿¡æ¯ï¼å®¢æ·ç«¯åæ¯æä¹ç¥éè¦è®¿é®çæ°æ®å¨åªä¸ªå®ä¾ä¸å¢ï¼\n\n\n# 1.3 å®¢æ·ç«¯å¦ä½å®ä½æ°æ®ï¼\n\nå¨å®ä½é®å¼å¯¹æ°æ®æ¶ï¼å®æå¤çåå¸æ§½æ¯å¯ä»¥éè¿è®¡ç®å¾å°çï¼è¿ä¸ªè®¡ç®å¯ä»¥å¨å®¢æ·ç«¯åéè¯·æ±æ¶æ¥æ§è¡ãä½æ¯ï¼è¦è¿ä¸æ­¥å®ä½å° redis å®ä¾ï¼è¿éè¦ç¥é slot åå¸å¨åªä¸ªå®ä¾ä¸ã\n\nä¸è¬æ¥è¯´ï¼å®¢æ·ç«¯åéç¾¤å®ä¾å»ºç«è¿æ¥åï¼å®ä¾å°±ä¼æåå¸æ§½çåéä¿¡æ¯åç»å®¢æ·ç«¯ãä½æ¯ï¼å¨éç¾¤åååå»ºçæ¶åï¼æ¯ä¸ªå®ä¾åªç¥éèªå·±è¢«åéäºåªäºåå¸æ§½ï¼æ¯ä¸ç¥éå¶ä»å®ä¾æ¥æçåå¸æ§½ä¿¡æ¯çãé£ä¹ï¼å®¢æ·ç«¯ä¸ºä»ä¹å¯ä»¥å¨è®¿é®ä»»ä½ä¸ä¸ªå®ä¾æ¶ï¼é½è½è·å¾ææçåå¸æ§½ä¿¡æ¯å¢ï¼è¿æ¯å ä¸ºï¼redis å®ä¾ä¼æèªå·±çåå¸æ§½ä¿¡æ¯åç»åå®ç¸è¿æ¥çå¶å®å®ä¾ï¼æ¥å®æåå¸æ§½åéä¿¡æ¯çæ©æ£ãå½å®ä¾ä¹é´ç¸äºè¿æ¥åï¼æ¯ä¸ªå®ä¾å°±æææåå¸æ§½çæ å°å³ç³»äºã\n\nå®¢æ·ç«¯æ¶å°åå¸æ§½ä¿¡æ¯åï¼ä¼æåå¸æ§½ä¿¡æ¯ç¼å­å¨æ¬å°ãå½å®¢æ·ç«¯è¯·æ±é®å¼å¯¹æ¶ï¼ä¼åè®¡ç®é®æå¯¹åºçåå¸æ§½ï¼ç¶åå°±å¯ä»¥ç»ç¸åºçå®ä¾åéè¯·æ±äºãä½æ¯ï¼å¨éç¾¤ä¸­ï¼å®ä¾ååå¸æ§½çå¯¹åºå³ç³»å¹¶ä¸æ¯ä¸æä¸åçï¼æå¸¸è§çååæä¸¤ä¸ªï¼\n\n * å¨éç¾¤ä¸­ï¼å®ä¾ææ°å¢æå é¤ï¼redis éè¦éæ°åéåå¸æ§½ï¼\n * ä¸ºäºè´è½½åè¡¡ï¼redis éè¦æåå¸æ§½å¨ææå®ä¾ä¸éæ°åå¸ä¸éã\n\næ­¤æ¶ï¼å®ä¾ä¹é´è¿å¯ä»¥éè¿ç¸äºä¼ éæ¶æ¯ï¼è·å¾ææ°çåå¸æ§½åéä¿¡æ¯ï¼ä½æ¯ï¼å®¢æ·ç«¯æ¯æ æ³ä¸»å¨æç¥è¿äºååçãè¿å°±ä¼å¯¼è´ï¼å®ç¼å­çåéä¿¡æ¯åææ°çåéä¿¡æ¯å°±ä¸ä¸è´äºï¼é£è¯¥æä¹åå¢ï¼\n\nredis cluster æ¹æ¡æä¾äºä¸ç§éå®åæºå¶ï¼æè°çâéå®åâï¼å°±æ¯æï¼å®¢æ·ç«¯ç»ä¸ä¸ªå®ä¾åéæ°æ®è¯»åæä½æ¶ï¼å¦æè¿ä¸ªå®ä¾ä¸å¹¶æ²¡æç¸åºçæ°æ®ï¼å®ä¾å°±ä¼æ³å®¢æ·ç«¯è¿åä¸ä¸ªå¦ä¸æç¤ºç moved å½ä»¤ååºç»æï¼å®¢æ·ç«¯è¿æ¶å°±è¦åç»ä¸ä¸ªæ°å®ä¾åéæä½å½ä»¤ã\n\nget hello:key\n(error) moved 13320 172.16.19.5:6379\n\n\n1\n2\n\n\nå¶ä¸­ï¼moved å½ä»¤è¡¨ç¤ºï¼å®¢æ·ç«¯è¯·æ±çé®å¼å¯¹æå¨çåå¸æ§½ 13320ï¼å®éæ¯å¨ 172.16.19.5 è¿ä¸ªå®ä¾ä¸ãéè¿è¿åç moved å½ä»¤ï¼å°±ç¸å½äºæåå¸æ§½æå¨çæ°å®ä¾çä¿¡æ¯åè¯ç»å®¢æ·ç«¯äºãè¿æ ·ä¸æ¥ï¼å®¢æ·ç«¯å°±å¯ä»¥ç´æ¥å 172.16.19.5 è¿æ¥ï¼å¹¶åéæä½è¯·æ±äºã\n\nä¸é¢ç¨ä¸å¼ å¾æ¥è¯´æä¸ä¸ moved å½ä»¤çéå®åçä½¿ç¨æ¹æ³ãå¯ä»¥çå°ï¼ç±äºè´è½½åè¡¡ï¼slot 2ä¸­çæ°æ®å·²ç»ä»å®ä¾2è¿ç§»å°äºå®ä¾3ï¼ä½æ¯ï¼å®¢æ·ç«¯ç¼å­ä»ç¶è®°å½çâslot 2å¨å®ä¾2âçä¿¡æ¯ï¼æä»¥ä¼ç»å®ä¾2åéå½ä»¤ãå®ä¾2ç»å®¢æ·ç«¯è¿åä¸æ¡ moved å½ä»¤ï¼æslot 2çææ°ä½ç½®ï¼ä¹å°±æ¯å¨å®ä¾3ä¸ï¼ï¼è¿åç»å®¢æ·ç«¯ï¼å®¢æ·ç«¯å°±ä¼åæ¬¡åå®ä¾3åéè¯·æ±ï¼åæ¶è¿ä¼æ´æ°æ¬å°ç¼å­ï¼æ slot 2ä¸å®ä¾çå¯¹åºå³ç³»æ´æ°è¿æ¥ã\n\néè¦æ³¨æçæ¯ï¼å¨ä¸å¾ä¸­ï¼å½å®¢æ·ç«¯ç»å®ä¾2åéå½ä»¤æ¶ï¼slot 2ä¸­çæ°æ®å·²ç»å¨é¨è¿ç§»å°äºå®ä¾3ãå¨å®éåºç¨æ¶ï¼å¦æslot 2ä¸­çæ°æ®æ¯è¾å¤ï¼å°±å¯è½ä¼åºç°ä¸ç§æåµï¼å®¢æ·ç«¯åå®ä¾2åéè¯·æ±ï¼ä½æ­¤æ¶ï¼slot 2ä¸­çæ°æ®åªæä¸é¨åè¿ç§»å°äºå®ä¾3ï¼è¿æé¨åæ°æ®æ²¡æè¿ç§»ãå¨è¿ç§è¿ç§»é¨åå®æçæåµä¸ï¼å®¢æ·ç«¯å°±ä¼æ¶å°ä¸æ¡ ask æ¥éä¿¡æ¯ï¼å¦ä¸æç¤ºï¼\n\nget hello:key\n(error) ask 13320 172.16.19.5:6379\n\n\n1\n2\n\n\nè¿ä¸ªç»æä¸­ç ask å½ä»¤å°±è¡¨ç¤ºï¼å®¢æ·ç«¯è¯·æ±çé®å¼å¯¹æå¨çåå¸æ§½ 13320ï¼å¨ 172.16.19.5 è¿ä¸ªå®ä¾ä¸ï¼ä½æ¯è¿ä¸ªåå¸æ§½æ­£å¨è¿ç§»ãæ­¤æ¶ï¼å®¢æ·ç«¯éè¦åç» 172.16.19.5 è¿ä¸ªå®ä¾åéä¸ä¸ª asking å½ä»¤ãè¿ä¸ªå½ä»¤çæææ¯ï¼è®©è¿ä¸ªå®ä¾åè®¸æ§è¡å®¢æ·ç«¯æ¥ä¸æ¥åéçå½ä»¤ãç¶åï¼å®¢æ·ç«¯ååè¿ä¸ªå®ä¾åé get å½ä»¤ï¼ä»¥è¯»åæ°æ®ã\n\nçèµ·æ¥å¥½åæç¹å¤æï¼æååå©å¾çæ¥è§£éä¸ä¸ãå¨ä¸å¾ä¸­ï¼slot 2æ­£å¨ä»å®ä¾2å¾å®ä¾3è¿ç§»ï¼key1åkey2å·²ç»è¿ç§»è¿å»ï¼key3åkey4è¿å¨å®ä¾2ãå®¢æ·ç«¯åå®ä¾2è¯·æ±key2åï¼å°±ä¼æ¶å°å®ä¾2è¿åçaskå½ä»¤ã\n\nask å½ä»¤è¡¨ç¤ºä¸¤å±å«ä¹ï¼\n\n * ç¬¬ä¸ï¼è¡¨æ slot æ°æ®è¿å¨è¿ç§»ä¸­ï¼\n * ç¬¬äºï¼ask å½ä»¤æå®¢æ·ç«¯æè¯·æ±æ°æ®çææ°å®ä¾å°åè¿åç»å®¢æ·ç«¯ï¼æ­¤æ¶ï¼å®¢æ·ç«¯éè¦ç»å®ä¾ 3 åé asking å½ä»¤ï¼ç¶åååéæä½å½ä»¤ã\n\nå moved å½ä»¤ä¸åï¼askå½ä»¤å¹¶ä¸ä¼æ´æ°å®¢æ·ç«¯ç¼å­çåå¸æ§½åéä¿¡æ¯ãæä»¥ï¼å¨ä¸å¾ä¸­ï¼å¦æå®¢æ·ç«¯åæ¬¡è¯·æ± slot 2 ä¸­çæ°æ®ï¼å®è¿æ¯ä¼ç» å®ä¾ 2 åéè¯·æ±ãè¿ä¹å°±æ¯è¯´ï¼ask å½ä»¤çä½ç¨åªæ¯è®©å®¢æ·ç«¯è½ç»æ°å®ä¾åéä¸æ¬¡è¯·æ±ï¼èä¸å moved å½ä»¤é£æ ·ï¼ä¼æ´æ¹æ¬å°ç¼å­ï¼è®©åç»­ææå½ä»¤é½åå¾æ°å®ä¾ã\n\n\n# 1.4 å°ç»\n\nè¿èè¯¾ï¼æä»¬å­¦ä¹ äºåçéç¾¤å¨ä¿å­å¤§éæ°æ®æ¹é¢çä¼å¿ï¼ä»¥ååºäºåå¸æ§½çæ°æ®åå¸æºå¶åå®¢æ·ç«¯å®ä½é®å¼å¯¹çæ¹æ³ã\n\nå¨åºå¯¹æ°æ®éæ©å®¹æ¶ï¼è½ç¶å¢å åå­è¿ç§çºµåæ©å±çæ¹æ³ç®åç´æ¥ï¼ä½æ¯ä¼é ææ°æ®åºçåå­è¿å¤§ï¼å¯¼è´æ§è½åæ¢ãredis åçéç¾¤æä¾äºæ¨ªåæ©å±çæ¨¡å¼ï¼ä¹å°±æ¯ä½¿ç¨å¤ä¸ªå®ä¾ï¼å¹¶ç»æ¯ä¸ªå®ä¾éç½®ä¸å®æ°éçåå¸æ§½ï¼æ°æ®å¯ä»¥éè¿é®çåå¸å¼æ å°å°åå¸æ§½ï¼åéè¿åå¸æ§½åæ£ä¿å­å°ä¸åçå®ä¾ä¸ãè¿æ ·åçå¥½å¤æ¯æ©å±æ§å¥½ï¼ä¸ç®¡æå¤å°æ°æ®ï¼åçéç¾¤é½è½åºå¯¹ã\n\nå¦å¤ï¼éç¾¤çå®ä¾å¢åï¼æèæ¯ä¸ºäºå®ç°è´è½½åè¡¡èè¿è¡çæ°æ®éæ°åå¸ï¼ä¼å¯¼è´åå¸æ§½åå®ä¾çæ å°å³ç³»åçååï¼å®¢æ·ç«¯åéè¯·æ±æ¶ï¼ä¼æ¶å°å½ä»¤æ§è¡æ¥éä¿¡æ¯ãäºè§£äº moved å ask å½ä»¤ï¼ä½ å°±ä¸ä¼ä¸ºè¿ç±»æ¥éèå¤´ç¼äºã\n\næååè¯´è¿ï¼å¨ redis 3.0 ä¹åï¼redis å®æ¹å¹¶æ²¡ææä¾åçéç¾¤æ¹æ¡ï¼ä½æ¯ï¼å¶å®å½æ¶ä¸çå·²ç»æäºä¸äºåçéç¾¤çæ¹æ¡ï¼ä¾å¦åºäºå®¢æ·ç«¯ååºç shardedjedisï¼åºäºä»£çç codisãtwemproxy ç­ãè¿äºæ¹æ¡çåºç¨æ©äº redis cluster æ¹æ¡ï¼å¨æ¯æçéç¾¤å®ä¾è§æ¨¡ãéç¾¤ç¨³å®æ§ãå®¢æ·ç«¯åå¥½æ§æ¹é¢ä¹é½æçåèªçä¼å¿ï¼æä¼å¨åé¢çè¯¾ç¨ä¸­ï¼ä¸é¨åä½ èèè¿äºæ¹æ¡çå®ç°æºå¶ï¼ä»¥åå®è·µç»éªãè¿æ ·ä¸æ¥ï¼å½ä½ åç¢°å°ä¸å¡åå±å¸¦æ¥çæ°æ®éå·¨å¤§çé¾é¢æ¶ï¼å°±å¯ä»¥æ ¹æ®è¿äºæ¹æ¡çç¹ç¹ï¼éæ©åéçæ¹æ¡å®ç°åçéç¾¤ï¼ä»¥åºå¯¹ä¸å¡éæ±äºã\n\n----------------------------------------\n\næ¬èé®é¢ï¼ä¸ºä»ä¹redisä¸ç´æ¥ç¨ä¸ä¸ªè¡¨ï¼æé®å¼å¯¹åå®ä¾çå¯¹åºå³ç³»è®°å½ä¸æ¥ï¼èæ¯è¦å¯¹é®å¼å¯¹ç key å crc è®¡ç®ï¼\n\nå¦æä½¿ç¨è¡¨è®°å½é®å¼å¯¹åå®ä¾çå¯¹åºå³ç³»ï¼ä¸æ¦é®å¼å¯¹åå®ä¾çå¯¹åºå³ç³»åçäºååï¼ä¾å¦å®ä¾æå¢åæèæ°æ®éæ°åå¸ï¼ï¼å°±è¦ä¿®æ¹è¡¨ãå¦ææ¯åçº¿ç¨æä½è¡¨ï¼é£ä¹æææä½é½è¦ä¸²è¡æ§è¡ï¼æ§è½æ¢ï¼å¦ææ¯å¤çº¿ç¨æä½è¡¨ï¼å°±æ¶åå°å éå¼éãæ­¤å¤ï¼å¦ææ°æ®ééå¸¸å¤§ï¼ä½¿ç¨è¡¨è®°å½é®å¼å¯¹åå®ä¾çå¯¹åºå³ç³»ï¼éè¦çé¢å¤å­å¨ç©ºé´ä¹ä¼å¢å ã\n\nåºäºåå¸æ§½è®¡ç®æ¶ï¼è½ç¶ä¹è¦è®°å½åå¸æ§½åå®ä¾çå¯¹åºå³ç³»ï¼ä½æ¯åå¸æ§½çä¸ªæ°è¦æ¯é®å¼å¯¹çä¸ªæ°å°å¾å¤ï¼æ è®ºæ¯ä¿®æ¹åå¸æ§½åå®ä¾çå¯¹åºå³ç³»ï¼è¿æ¯ä½¿ç¨é¢å¤ç©ºé´å­å¨åå¸æ§½åå®ä¾çå¯¹åºå³ç³»ï¼é½æ¯ç´æ¥è®°å½é®å¼å¯¹åå®ä¾çå³ç³»çå¼éå°å¾å¤ã\n\n\n# 2. codis vs redis clusterï¼æè¯¥éæ©åªä¸ä¸ªéç¾¤æ¹æ¡ï¼\n\nåé¢å­¦ä¹ äº redis å®æ¹æä¾çåçéç¾¤æ¹æ¡ redis clusterï¼ä½å¨è¯¥æ¹æ¡åå¸ä¹åï¼ä¸çå·²ç»å¹¿æ³ä½¿ç¨ codisãè¿ä¸èå°è®²è§£ codis çå®ç°åçï¼å¹¶å°ä¸¤èè¿è¡å¯¹æ¯ï¼ä»èéåºæä½³çéç¾¤æ¹æ¡ã\n\n\n# 2.1 codis çæ´ä½æ¶æååºæ¬æµç¨\n\ncodis éç¾¤ä¸­åå«äº 4 ç±»å³é®ç»ä»¶ï¼\n\n * codis serverï¼è¿æ¯è¿è¡äºäºæ¬¡å¼åçrediså®ä¾ï¼å¶ä¸­å¢å äºé¢å¤çæ°æ®ç»æï¼æ¯ææ°æ®è¿ç§»æä½ï¼ä¸»è¦è´è´£å¤çå·ä½çæ°æ®è¯»åè¯·æ±ã\n * codis proxyï¼æ¥æ¶å®¢æ·ç«¯è¯·æ±ï¼å¹¶æè¯·æ±è½¬åç»codis serverã\n * zookeeper éç¾¤ï¼ä¿å­éç¾¤åæ°æ®ï¼ä¾å¦æ°æ®ä½ç½®ä¿¡æ¯åcodis proxyä¿¡æ¯ãè¿éï¼æä¸ªå°æ¹éè¦ä½ æ³¨æï¼é¤äºä½¿ç¨zookeeperï¼codisè¿å¯ä»¥ä½¿ç¨etcdææ¬å°æä»¶ç³»ç»ä¿å­åæ°æ®ä¿¡æ¯ã\n * codis dashboard å codis feï¼å±åç»æäºéç¾¤ç®¡çå·¥å·ãå¶ä¸­ï¼codis dashboardè´è´£æ§è¡éç¾¤ç®¡çå·¥ä½ï¼åæ¬å¢å codis serverãcodis proxyåè¿è¡æ°æ®è¿ç§»ãècodis feè´è´£æä¾dashboardçwebæä½çé¢ï¼ä¾¿äºæä»¬ç´æ¥å¨webçé¢ä¸è¿è¡éç¾¤ç®¡çã\n\næç¨ä¸å¼ å¾æ¥å±ç¤ºä¸ codis éç¾¤çæ¶æåå³é®ç»ä»¶ï¼\n\nä¸é¢å·ä½è§£éä¸ä¸ codis æ¯å¦ä½å¤çè¯·æ±çï¼\n\n * é¦åï¼ä¸ºäºè®©éç¾¤è½æ¥æ¶å¹¶å¤çè¯·æ±ï¼æä»¬è¦åä½¿ç¨ codis dashboard è®¾ç½® codis server å codis proxy çè®¿é®å°åï¼å®æè®¾ç½®åï¼codis server å codis proxy æä¼å¼å§æ¥æ¶è¿æ¥ã\n * ç¶åï¼å½å®¢æ·ç«¯è¦è¯»åæ°æ®æ¶ï¼å®¢æ·ç«¯ç´æ¥åcodis proxyå»ºç«è¿æ¥ãcodis proxy æ¬èº«æ¯æ redis ç resp äº¤äºåè®®ï¼æä»¥å®¢æ·ç«¯è®¿é®codis proxyæ¶ï¼åè®¿é®åççrediså®ä¾æ²¡æä»ä¹åºå«ï¼è¿æ ·ä¸æ¥ï¼åæ¬è¿æ¥åå®ä¾çå®¢æ·ç«¯å°±å¯ä»¥è½»æ¾å°åcodiséç¾¤å»ºç«èµ·è¿æ¥äºã\n * æåï¼codis proxyæ¥æ¶å°è¯·æ±ï¼å°±ä¼æ¥è¯¢è¯·æ±æ°æ®åcodis serverçæ å°å³ç³»ï¼å¹¶æè¯·æ±è½¬åç»ç¸åºçcodis serverè¿è¡å¤çãå½codis serverå¤çå®è¯·æ±åï¼ä¼æç»æè¿åç»codis proxyï¼proxyåææ°æ®è¿åç»å®¢æ·ç«¯ã\n\nç¨ä¸å¼ å¾æ¥å±ç¤ºè¿ä¸ªå¤çæµç¨ï¼\n\n\n# 2.2 codis çå³é®ææ¯åç\n\nè¿éå°å´ç»å½±ååçéç¾¤ä½¿ç¨ææç 4 æ¹é¢ææ¯å ç´ ï¼æ°æ®åå¸ãéç¾¤æ©å®¹åæ°æ®è¿ç§»ãå®¢æ·ç«¯å¼å®¹æ§ãå¯é æ§ä¿è¯ï¼æ¥è®¨è®ºå®ä»¬çå·ä½è®¾è®¡éæ©ååçã\n\n# 2.2.1 æ°æ®å¦ä½å¨éç¾¤éåå¸ï¼\n\nå¨ codis éç¾¤ä¸­ï¼ä¸ä¸ªæ°æ®åºè¯¥ä¿å­å¨åªä¸ªcodis serverä¸ï¼è¿æ¯éè¿é»è¾æ§½ï¼slotï¼æ å°æ¥å®æçï¼å·ä½æ¥è¯´ï¼æ»å±åæä¸¤æ­¥ï¼\n\n 1. ç¬¬ä¸æ­¥ï¼codiséç¾¤ä¸å±æ1024ä¸ªslotï¼ç¼å·ä¾æ¬¡æ¯0å°1023ãæä»¬å¯ä»¥æè¿äºslotæå¨åéç»codis serverï¼æ¯ä¸ªserverä¸åå«ä¸é¨åslotãå½ç¶ï¼æä»¬ä¹å¯ä»¥è®©codis dashboardè¿è¡èªå¨åéï¼ä¾å¦ï¼dashboardæ1024ä¸ªslotå¨ææserverä¸ååã\n 2. ç¬¬äºæ­¥ï¼å½å®¢æ·ç«¯è¦è¯»åæ°æ®æ¶ï¼ä¼ä½¿ç¨crc32ç®æ³è®¡ç®æ°æ®keyçåå¸å¼ï¼å¹¶æè¿ä¸ªåå¸å¼å¯¹1024åæ¨¡ãèåæ¨¡åçå¼ï¼åå¯¹åºslotçç¼å·ãæ­¤æ¶ï¼æ ¹æ®ç¬¬ä¸æ­¥åéçslotåserverå¯¹åºå³ç³»ï¼æä»¬å°±å¯ä»¥ç¥éæ°æ®ä¿å­å¨åªä¸ªserverä¸äºã\n\nè¿ä¸ªè¿ç¨å¦ä¸å¾æç¤ºï¼\n\næ°æ®keyåslotçæ å°å³ç³»æ¯å®¢æ·ç«¯å¨è¯»åæ°æ®åç´æ¥éè¿crc32è®¡ç®å¾å°çï¼èslotåcodis serverçæ å°å³ç³»æ¯éè¿åéå®æçï¼æä»¥å°±éè¦ç¨ä¸ä¸ªå­å¨ç³»ç»ä¿å­ä¸æ¥ï¼å¦åï¼å¦æéç¾¤ææéäºï¼æ å°å³ç³»å°±ä¼ä¸¢å¤±ã\n\næä»¬æslotåcodis serverçæ å°å³ç³»ç§°ä¸ºæ°æ®è·¯ç±è¡¨ï¼ç®ç§°è·¯ç±è¡¨ï¼ãæä»¬å¨codis dashboardä¸åéå¥½è·¯ç±è¡¨åï¼dashboardä¼æè·¯ç±è¡¨åéç»codis proxyï¼åæ¶ï¼dashboardä¹ä¼æè·¯ç±è¡¨ä¿å­å¨zookeeperä¸­ãcodis-proxyä¼æè·¯ç±è¡¨ç¼å­å¨æ¬å°ï¼å½å®æ¥æ¶å°å®¢æ·ç«¯è¯·æ±åï¼ç´æ¥æ¥è¯¢æ¬å°çè·¯ç±è¡¨ï¼å°±å¯ä»¥å®ææ­£ç¡®çè¯·æ±è½¬åäºãä¸å¾å±ç¤ºäºè·¯ç±è¡¨çåéåä½¿ç¨è¿ç¨ï¼\n\nå¨æ°æ®åççå®ç°æ¹æ³ä¸ï¼codis å redis cluster å¾ç¸ä¼¼ï¼é½éç¨äº key æ å°å° slotãslot ååéå°å®ä¾ä¸çæºå¶ãä½æ¯ï¼è¿éæä¸ä¸ªææ¾çåºå«ï¼\n\n * codisä¸­çè·¯ç±è¡¨æ¯æä»¬éè¿codis dashboardåéåä¿®æ¹çï¼å¹¶è¢«ä¿å­å¨zookeeperéç¾¤ä¸­ãä¸æ¦æ°æ®ä½ç½®åçååï¼ä¾å¦æå®ä¾å¢åï¼ï¼è·¯ç±è¡¨è¢«ä¿®æ¹äºï¼codis dashbaordå°±ä¼æä¿®æ¹åçè·¯ç±è¡¨åéç»codis proxyï¼proxyå°±å¯ä»¥æ ¹æ®ææ°çè·¯ç±ä¿¡æ¯è½¬åè¯·æ±äºã\n * å¨redis clusterä¸­ï¼æ°æ®è·¯ç±è¡¨æ¯éè¿æ¯ä¸ªå®ä¾ç¸äºé´çéä¿¡ä¼ éçï¼æåä¼å¨æ¯ä¸ªå®ä¾ä¸ä¿å­ä¸ä»½ãå½æ°æ®è·¯ç±ä¿¡æ¯åçååæ¶ï¼å°±éè¦å¨ææå®ä¾é´éè¿ç½ç»æ¶æ¯è¿è¡ä¼ éãæä»¥ï¼å¦æå®ä¾æ°éè¾å¤çè¯ï¼å°±ä¼æ¶èè¾å¤çéç¾¤ç½ç»èµæºã\n\næ°æ®åå¸è§£å³äºæ°æ°æ®åå¥æ¶è¯¥ä¿å­å¨åªä¸ªserverçé®é¢ï¼ä½æ¯ï¼å½ä¸å¡æ°æ®å¢å åï¼å¦æéç¾¤ä¸­çç°æå®ä¾ä¸è¶³ä»¥ä¿å­æææ°æ®ï¼æä»¬å°±éè¦å¯¹éç¾¤è¿è¡æ©å®¹ãæ¥ä¸æ¥ï¼æä»¬åæ¥å­¦ä¹ ä¸codiséå¯¹éç¾¤æ©å®¹çå³é®ææ¯è®¾è®¡ã\n\n# 2.2.2 éç¾¤æ©å®¹åæ°æ®è¿ç§»å¦ä½è¿è¡?\n\ncodis éç¾¤æ©å®¹åæ¬äºä¸¤æ¹é¢ï¼å¢å  codis server åå¢å  codis proxyã\n\n----------------------------------------\n\næä»¬åæ¥çå¢å  codis serverï¼è¿ä¸ªè¿ç¨ä¸»è¦æ¶åå°ä¸¤æ­¥æä½ï¼\n\n 1. å¯å¨æ°ç codis serverï¼å°å®å å¥éç¾¤ä¸­ï¼\n 2. æé¨åæ°æ®è¿ç§»å°æ°ç serverã\n\néè¦æ³¨æçæ¯ï¼è¿éçæ°æ®è¿ç§»æ¯ä¸ä¸ªéè¦çæºå¶ãcodis éç¾¤æç§ slot çç²åº¦è¿è¡æ°æ®è¿ç§»ï¼æä»¬æ¥çä¸è¿ç§»çåºæ¬æµç¨ï¼\n\n 1. å¨æºserverä¸ï¼codisä»è¦è¿ç§»çslotä¸­éæºéæ©ä¸ä¸ªæ°æ®ï¼åéç»ç®çserverã\n 2. ç®çserverç¡®è®¤æ¶å°æ°æ®åï¼ä¼ç»æºserverè¿åç¡®è®¤æ¶æ¯ãè¿æ¶ï¼æºserverä¼å¨æ¬å°å°åæè¿ç§»çæ°æ®å é¤ã\n 3. ç¬¬ä¸æ­¥åç¬¬äºæ­¥å°±æ¯åä¸ªæ°æ®çè¿ç§»è¿ç¨ãcodisä¼ä¸æ­éå¤è¿ä¸ªè¿ç§»è¿ç¨ï¼ç´å°è¦è¿ç§»çslotä¸­çæ°æ®å¨é¨è¿ç§»å®æã\n\nä¸å¾æ¾ç¤ºäºæ°æ®è¿ç§»çæµç¨ï¼\n\néå¯¹åæä»ç»çåä¸ªæ°æ®çè¿ç§»è¿ç¨ï¼codiså®ç°äºä¸¤ç§è¿ç§»æ¨¡å¼ï¼åå«æ¯åæ­¥è¿ç§»åå¼æ­¥è¿ç§»ï¼\n\n * åæ­¥è¿ç§»æ¯æï¼å¨æ°æ®ä»æºserveråéç»ç®çserverçè¿ç¨ä¸­ï¼æºserveræ¯é»å¡çï¼æ æ³å¤çæ°çè¯·æ±æä½ãè¿ç§æ¨¡å¼å¾å®¹æå®ç°ï¼ä½æ¯è¿ç§»è¿ç¨ä¸­ä¼æ¶åå¤ä¸ªæä½ï¼åæ¬æ°æ®å¨æºserveråºååãç½ç»ä¼ è¾ãå¨ç®çserverååºååï¼ä»¥åå¨æºserverå é¤ï¼ï¼å¦æè¿ç§»çæ°æ®æ¯ä¸ä¸ªbigkeyï¼æºserverå°±ä¼é»å¡è¾é¿æ¶é´ï¼æ æ³åæ¶å¤çç¨æ·è¯·æ±ã\n * ä¸ºäºé¿åæ°æ®è¿ç§»é»å¡æºserverï¼codiså®ç°çç¬¬äºç§è¿ç§»æ¨¡å¼å°±æ¯å¼æ­¥è¿ç§»ãå¼æ­¥è¿ç§»çå³é®ç¹ç¹æä¸¤ä¸ªï¼\n   * ç¬¬ä¸ä¸ªç¹ç¹æ¯ï¼å½æºserverææ°æ®åéç»ç®çserveråï¼å°±å¯ä»¥å¤çå¶ä»è¯·æ±æä½äºï¼ä¸ç¨ç­å°ç®çserverçå½ä»¤æ§è¡å®ãèç®çserverä¼å¨æ¶å°æ°æ®å¹¶ååºååä¿å­å°æ¬å°åï¼ç»æºserveråéä¸ä¸ªackæ¶æ¯ï¼è¡¨æè¿ç§»å®æãæ­¤æ¶ï¼æºserverå¨æ¬å°æåæè¿ç§»çæ°æ®å é¤ãå¨è¿ä¸ªè¿ç¨ä¸­ï¼è¿ç§»çæ°æ®ä¼è¢«è®¾ç½®ä¸ºåªè¯»ï¼æä»¥ï¼æºserverä¸çæ°æ®ä¸ä¼è¢«ä¿®æ¹ï¼èªç¶ä¹å°±ä¸ä¼åºç°âåç®çserverä¸çæ°æ®ä¸ä¸è´âçé®é¢äºã\n   * ç¬¬äºä¸ªç¹ç¹æ¯ï¼å¯¹äºbigkeyï¼å¼æ­¥è¿ç§»éç¨äºæåæä»¤çæ¹å¼è¿è¡è¿ç§»ãå·ä½æ¥è¯´å°±æ¯ï¼å¯¹bigkeyä¸­æ¯ä¸ªåç´ ï¼ç¨ä¸æ¡æä»¤è¿è¡è¿ç§»ï¼èä¸æ¯ææ´ä¸ªbigkeyè¿è¡åºååååæ´ä½ä¼ è¾ãè¿ç§åæ´ä¸ºé¶çæ¹å¼ï¼å°±é¿åäºbigkeyè¿ç§»æ¶ï¼å ä¸ºè¦åºååå¤§éæ°æ®èé»å¡æºserverçé®é¢ãæ­¤å¤ï¼å½bigkeyè¿ç§»äºä¸é¨åæ°æ®åï¼å¦æcodisåçæéï¼å°±ä¼å¯¼è´bigkeyçä¸é¨ååç´ å¨æºserverï¼èå¦ä¸é¨ååç´ å¨ç®çserverï¼è¿å°±ç ´åäºè¿ç§»çåå­æ§ãæä»¥ï¼codisä¼å¨ç®æ serverä¸ï¼ç»bigkeyçåç´ è®¾ç½®ä¸ä¸ªä¸´æ¶è¿ææ¶é´ãå¦æè¿ç§»è¿ç¨ä¸­åçæéï¼é£ä¹ï¼ç®æ serverä¸çkeyä¼å¨è¿æåè¢«å é¤ï¼ä¸ä¼å½±åè¿ç§»çåå­æ§ãå½æ­£å¸¸å®æè¿ç§»åï¼bigkeyåç´ çä¸´æ¶è¿ææ¶é´ä¼è¢«å é¤ã\n\n> è¿éï¼æä¸ªå°æ¹éè¦ä½ æ³¨æä¸ï¼ä¸ºäºæåè¿ç§»çæçï¼codiså¨å¼æ­¥è¿ç§»slotæ¶ï¼åè®¸æ¯æ¬¡è¿ç§»å¤ä¸ªkeyãä½ å¯ä»¥éè¿å¼æ­¥è¿ç§»å½ä»¤slotsmgrttagslot-asyncçåæ°numkeysè®¾ç½®æ¯æ¬¡è¿ç§»çkeyæ°éã\n\n----------------------------------------\n\nååè®²çæ¯ codis server çæ©å®¹åæ°æ®è¿ç§»æºå¶ï¼é¤æ­¤ä¹å¤ï¼æä»¬å¯è½è¿éè¦å¢å  codis proxyãå ä¸ºå¨ codis éç¾¤ä¸­ï¼å®¢æ·ç«¯æ¯å codis proxy ç´æ¥è¿æ¥çï¼æä»¥ï¼å½å®¢æ·ç«¯å¢å æ¶ï¼ä¸ä¸ªproxyæ æ³æ¯æå¤§éçè¯·æ±æä½ï¼æ­¤æ¶ï¼æä»¬å°±éè¦å¢å proxyã\n\nå¢å proxyæ¯è¾å®¹æï¼æä»¬ç´æ¥å¯å¨proxyï¼åéè¿codis dashboardæproxyå å¥éç¾¤å°±è¡ã\n\næ­¤æ¶ï¼codis proxyçè®¿é®è¿æ¥ä¿¡æ¯é½ä¼ä¿å­å¨zookeeperä¸ãæä»¥ï¼å½æ°å¢äºproxyåï¼zookeeperä¸ä¼æææ°çè®¿é®åè¡¨ï¼å®¢æ·ç«¯ä¹å°±å¯ä»¥ä»zookeeperä¸è¯»åproxyè®¿é®åè¡¨ï¼æè¯·æ±åéç»æ°å¢çproxyãè¿æ ·ä¸æ¥ï¼å®¢æ·ç«¯çè®¿é®ååå°±å¯ä»¥å¨å¤ä¸ªproxyä¸åæå¤çäºï¼å¦ä¸å¾æç¤ºï¼\n\nå¥½äºï¼å°è¿éï¼æä»¬å°±äºè§£äºcodiséç¾¤ä¸­çæ°æ®åå¸ãéç¾¤æ©å®¹åæ°æ®è¿ç§»çæ¹æ³ï¼è¿é½æ¯åçéç¾¤ä¸­çå³é®æºå¶ã\n\n# 2.2.3 å®¢æ·ç«¯çå¼å®¹æ§\n\nä½¿ç¨ redis åå®ä¾æ¶ï¼å®¢æ·ç«¯åªè¦ç¬¦å resp åè®®ï¼å°±å¯ä»¥åå®ä¾è¿è¡äº¤äºåè¯»åæ°æ®ãä½æ¯ï¼å¨ä½¿ç¨åçéç¾¤æ¶ï¼æäºåè½æ¯ååå®ä¾ä¸ä¸æ ·çï¼æ¯å¦éç¾¤ä¸­çæ°æ®è¿ç§»æä½ï¼å¨åå®ä¾ä¸æ¯æ²¡æçï¼èä¸è¿ç§»è¿ç¨ä¸­ï¼æ°æ®è®¿é®è¯·æ±å¯è½è¦è¢«éå®åï¼ä¾å¦redis clusterä¸­çmoveå½ä»¤ï¼ãæä»¥ï¼å®¢æ·ç«¯éè¦å¢å åéç¾¤åè½ç¸å³çå½ä»¤æä½çæ¯æãå¦æåæ¥ä½¿ç¨åå®ä¾å®¢æ·ç«¯ï¼æ³è¦æ©å®¹ä½¿ç¨éç¾¤ï¼å°±éè¦ä½¿ç¨æ°å®¢æ·ç«¯ï¼è¿å¯¹äºä¸å¡åºç¨çå¼å®¹æ§æ¥è¯´ï¼å¹¶ä¸æ¯ç¹å«åå¥½ã\n\n> æä»¥å¯¹äºä½¿ç¨åçéç¾¤ redis cluster èè¨ï¼è¦æ³ä»åå®ä¾æ©å®¹æéç¾¤ï¼å°±éè¦ä»åå®ä¾å®¢æ·ç«¯æ¢ææ°çå®¢æ·ç«¯ï¼å¯¹ä¸å¡åºç¨çå¼å®¹æ§èè¨ï¼ä¸æ¯å¾åå¥½ã\n\ncodis éç¾¤å¨è®¾è®¡æ¶ï¼å°±ååèèäºå¯¹ç°æåå®ä¾å®¢æ·ç«¯çå¼å®¹æ§ãcodis ä½¿ç¨ codis proxy ç´æ¥åå®¢æ·ç«¯è¿æ¥ï¼codis proxy æ¯ååå®ä¾å®¢æ·ç«¯å¼å®¹çãèåéç¾¤ç¸å³çç®¡çå·¥ä½ï¼ä¾å¦è¯·æ±è½¬åãæ°æ®è¿ç§»ç­ï¼ï¼é½ç± codis proxyãcodis dashboard è¿äºç»ä»¶æ¥å®æï¼ä¸éè¦å®¢æ·ç«¯åä¸ã\n\nè¿æ ·ä¸æ¥ï¼ä¸å¡åºç¨ä½¿ç¨ codis éç¾¤æ¶ï¼å°±ä¸ç¨ä¿®æ¹å®¢æ·ç«¯äºï¼å¯ä»¥å¤ç¨ååå®ä¾è¿æ¥çå®¢æ·ç«¯ï¼æ¢è½å©ç¨éç¾¤è¯»åå¤§å®¹éæ°æ®ï¼åé¿åäºä¿®æ¹å®¢æ·ç«¯å¢å å¤æçæä½é»è¾ï¼ä¿è¯äºä¸å¡ä»£ç çç¨³å®æ§åå¼å®¹æ§ã\n\n# 2.2.4 æä¹ä¿è¯éç¾¤å¯é æ§ï¼\n\nå¯¹äºä¸ä¸ªåå¸å¼ç³»ç»æ¥è¯´ï¼å®çå¯é æ§åç³»ç»ä¸­çç»ä»¶ä¸ªæ°æå³ï¼ç»ä»¶è¶å¤ï¼æ½å¨çé£é©ç¹ä¹å°±è¶å¤ãåredis clusteråªåå«rediså®ä¾ä¸ä¸æ ·ï¼codiséç¾¤åå«çç»ä»¶æ4ç±»ãé£ä½ å°±ä¼é®äºï¼è¿ä¹å¤ç»ä»¶ä¼éä½codiséç¾¤çå¯é æ§åï¼\n\næä»¬æ¥åå«çä¸ codis ä¸åç»ä»¶çå¯é æ§ä¿è¯æ¹æ³ã\n\n----------------------------------------\n\né¦åæ¯ codis serverã\n\ncodis serverå¶å®å°±æ¯rediså®ä¾ï¼åªä¸è¿å¢å äºåéç¾¤æä½ç¸å³çå½ä»¤ãredisçä¸»ä»å¤å¶æºå¶åå¨åµæºå¶å¨codis serverä¸é½æ¯å¯ä»¥ä½¿ç¨çï¼æä»¥ï¼codiså°±ä½¿ç¨ä¸»ä»éç¾¤æ¥ä¿è¯codis serverçå¯é æ§ãç®åæ¥è¯´å°±æ¯ï¼codisç»æ¯ä¸ªserveréç½®ä»åºï¼å¹¶ä½¿ç¨å¨åµæºå¶è¿è¡çæ§ï¼å½åçæéæ¶ï¼ä¸»ä»åºå¯ä»¥è¿è¡åæ¢ï¼ä»èä¿è¯äºserverçå¯é æ§ã\n\nå¨è¿ç§éç½®æåµä¸ï¼æ¯ä¸ªserverå°±æä¸ºäºä¸ä¸ªserver groupï¼æ¯ä¸ªgroupä¸­æ¯ä¸ä¸»å¤ä»çserverãæ°æ®åå¸ä½¿ç¨çslotï¼ä¹æ¯æç§groupçç²åº¦è¿è¡åéçãåæ¶ï¼codis proxyå¨è½¬åè¯·æ±æ¶ï¼ä¹æ¯æç§æ°æ®æå¨çslotågroupçå¯¹åºå³ç³»ï¼æåè¯·æ±åå°ç¸åºgroupçä¸»åºï¼è¯»è¯·æ±åå°groupä¸­çä¸»åºæä»åºä¸ã\n\nä¸å¾å±ç¤ºçæ¯éç½®äºserver groupçcodiséç¾¤æ¶æãå¨codiséç¾¤ä¸­ï¼æä»¬éè¿é¨ç½²server groupåå¨åµéç¾¤ï¼å®ç°codis serverçä¸»ä»åæ¢ï¼æåéç¾¤å¯é æ§ï¼\n\n----------------------------------------\n\nåçä¸ä¸ codis proxy å zookeeper çå¯é æ§ãè¿ä¿©ç»ä»¶æ¯æ­éä½¿ç¨çã\n\nå¨codiséç¾¤è®¾è®¡æ¶ï¼proxyä¸çä¿¡æ¯æºå¤´é½æ¯æ¥èªzookeeperï¼ä¾å¦è·¯ç±è¡¨ï¼ãèzookeeperéç¾¤ä½¿ç¨å¤ä¸ªå®ä¾æ¥ä¿å­æ°æ®ï¼åªè¦æè¶è¿åæ°çzookeeperå®ä¾å¯ä»¥æ­£å¸¸å·¥ä½ï¼ zookeeperéç¾¤å°±å¯ä»¥æä¾æå¡ï¼ä¹å¯ä»¥ä¿è¯è¿äºæ°æ®çå¯é æ§ã\n\næä»¥ï¼codis proxyä½¿ç¨zookeeperéç¾¤ä¿å­è·¯ç±è¡¨ï¼å¯ä»¥ååå©ç¨zookeeperçé«å¯é æ§ä¿è¯æ¥ç¡®ä¿codis proxyçå¯é æ§ï¼ä¸ç¨ååé¢å¤çå·¥ä½äºãå½codis proxyåçæéåï¼ç´æ¥éå¯proxyå°±è¡ãéå¯åçproxyï¼å¯ä»¥éè¿codis dashboardä»zookeeperéç¾¤ä¸è·åè·¯ç±è¡¨ï¼ç¶åï¼å°±å¯ä»¥æ¥æ¶å®¢æ·ç«¯è¯·æ±è¿è¡è½¬åäºãè¿æ ·çè®¾è®¡ï¼ä¹éä½äºcodiséç¾¤æ¬èº«çå¼åå¤æåº¦ã\n\n----------------------------------------\n\nå¯¹äºcodis dashboardåcodis feæ¥è¯´ï¼å®ä»¬ä¸»è¦æä¾éç½®ç®¡çåç®¡çåæå·¥æä½ï¼è´è½½ååä¸å¤§ï¼æä»¥ï¼å®ä»¬çå¯é æ§å¯ä»¥ä¸ç¨é¢å¤è¿è¡ä¿è¯äºã\n\n\n# 2.3 åçéç¾¤æ¹æ¡éæ©å»ºè®®\n\nä¸å¾æ»ç»äº codis å redis cluster ä¸¤ç§åçéç¾¤æ¹æ¡ï¼å¯¹æ¯å¦ä¸ï¼\n\næåï¼å¨å®éåºç¨çæ¶åï¼å¯¹äºè¿ä¸¤ç§æ¹æ¡çéæ©æå¦ä¸å»ºè®®ï¼\n\n 1. ä»ç¨³å®æ§åæçåº¦æ¥çï¼codisåºç¨å¾æ¯è¾æ©ï¼å¨ä¸çå·²ç»æäºæçççäº§é¨ç½²ãè½ç¶codiså¼å¥äºproxyåzookeeperï¼å¢å äºéç¾¤å¤æåº¦ï¼ä½æ¯ï¼proxyçæ ç¶æè®¾è®¡åzookeeperèªèº«çç¨³å®æ§ï¼ä¹ç»codisçç¨³å®ä½¿ç¨æä¾äºä¿è¯ãèredis clusterçæ¨åºæ¶é´æäºcodisï¼ç¸å¯¹æ¥è¯´ï¼æçåº¦è¦å¼±äºcodisï¼å¦æä½ æ³éæ©ä¸ä¸ªæçç¨³å®çæ¹æ¡ï¼codisæ´å åéäºã\n\n 2. ä»ä¸å¡åºç¨å®¢æ·ç«¯å¼å®¹æ§æ¥çï¼è¿æ¥åå®ä¾çå®¢æ·ç«¯å¯ä»¥ç´æ¥è¿æ¥codis proxyï¼èåæ¬è¿æ¥åå®ä¾çå®¢æ·ç«¯è¦æ³è¿æ¥redis clusterçè¯ï¼å°±éè¦å¼åæ°åè½ãæä»¥ï¼å¦æä½ çä¸å¡åºç¨ä¸­å¤§éä½¿ç¨äºåå®ä¾çå®¢æ·ç«¯ï¼èç°å¨æ³åºç¨åçéç¾¤çè¯ï¼å»ºè®®ä½ éæ©codisï¼è¿æ ·å¯ä»¥é¿åä¿®æ¹ä¸å¡åºç¨ä¸­çå®¢æ·ç«¯ã\n\n 3. ä»ä½¿ç¨redisæ°å½ä»¤åæ°ç¹æ§æ¥çï¼codis serveræ¯åºäºå¼æºçredis 3.2.8å¼åçï¼æä»¥ï¼codiså¹¶ä¸æ¯æredisåç»­çå¼æºçæ¬ä¸­çæ°å¢å½ä»¤åæ°æ®ç±»åãå¦å¤ï¼codiså¹¶æ²¡æå®ç°å¼æºredisçæ¬çææå½ä»¤ï¼æ¯å¦bitopãblpopãbrpopï¼ä»¥ååä¸äºå¡ç¸å³çmutliãexecç­å½ä»¤ã codiså®ç½ ä¸ååºäºä¸è¢«æ¯æçå½ä»¤åè¡¨ï¼ä½ å¨ä½¿ç¨æ¶è®°å¾å»æ ¸æ¥ä¸ä¸ãæä»¥ï¼å¦æä½ æ³ä½¿ç¨å¼æºredis çæ¬çæ°ç¹æ§ï¼redis clusteræ¯ä¸ä¸ªåéçéæ©ã\n\n 4. ä»æ°æ®è¿ç§»æ§è½ç»´åº¦æ¥çï¼codisè½æ¯æå¼æ­¥è¿ç§»ï¼å¼æ­¥è¿ç§»å¯¹éç¾¤å¤çæ­£å¸¸è¯·æ±çæ§è½å½±åè¦æ¯ä½¿ç¨åæ­¥è¿ç§»çå°ãæä»¥ï¼å¦æä½ å¨åºç¨éç¾¤æ¶ï¼æ°æ®è¿ç§»æ¯è¾é¢ç¹çè¯ï¼codisæ¯ä¸ªæ´åéçéæ©ã\n\nå¦å¤è¿éåæä¾ä¸ä¸ª codis ä½¿ç¨ä¸çå°å»ºè®®ï¼å½ä½ æå¤æ¡ä¸å¡çº¿è¦ä½¿ç¨ codis æ¶ï¼å¯ä»¥å¯å¨å¤ä¸ª codis dashboardï¼æ¯ä¸ª dashboard ç®¡çä¸é¨å codis serverï¼åæ¶ï¼åç¨ä¸ä¸ª dashboard å¯¹åºè´è´£ä¸ä¸ªä¸å¡çº¿çéç¾¤ç®¡çï¼è¿æ ·å°±å¯ä»¥åå°ç¨ä¸ä¸ª codis éç¾¤å®ç°å¤æ¡ä¸å¡çº¿çéç¦»ç®¡çäºã",charsets:{cjk:!0},lastUpdated:"2023/04/21, 08:38:32",lastUpdatedTimestamp:1682066312e3},{title:"Redis ä¸­çæ°æ®ç»æ",frontmatter:{title:"Redis ä¸­çæ°æ®ç»æ",date:"2023-03-29T20:16:12.000Z",permalink:"/pages/2029a8/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/11.Redis%20%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/11.Redis ä¸­çæ°æ®ç»æ.md",key:"v-c2ced796",path:"/pages/2029a8/",headers:[{level:2,title:"1. âä¸éæ²¹âç Stringï¼ä¸ºä»ä¹ä¸å¥½ç¨äºï¼",slug:"_1-ä¸éæ²¹-ç-string-ä¸ºä»ä¹ä¸å¥½ç¨äº",normalizedTitle:"1. âä¸éæ²¹âç stringï¼ä¸ºä»ä¹ä¸å¥½ç¨äºï¼",charIndex:255},{level:3,title:"1.1 ä¸ºä»ä¹ String ç±»ååå­å¼éå¤§ï¼",slug:"_1-1-ä¸ºä»ä¹-string-ç±»ååå­å¼éå¤§",normalizedTitle:"1.1 ä¸ºä»ä¹ string ç±»ååå­å¼éå¤§ï¼",charIndex:1285},{level:3,title:"1.2 ç¨ä»ä¹æ°æ®ç»æå¯ä»¥èçåå­ï¼",slug:"_1-2-ç¨ä»ä¹æ°æ®ç»æå¯ä»¥èçåå­",normalizedTitle:"1.2 ç¨ä»ä¹æ°æ®ç»æå¯ä»¥èçåå­ï¼",charIndex:3166},{level:3,title:"1.3 å¦ä½ç¨éåç±»åä¿å­åå¼çé®å¼å¯¹ï¼",slug:"_1-3-å¦ä½ç¨éåç±»åä¿å­åå¼çé®å¼å¯¹",normalizedTitle:"1.3 å¦ä½ç¨éåç±»åä¿å­åå¼çé®å¼å¯¹ï¼",charIndex:4239},{level:3,title:"1.4 å°ç»",slug:"_1-4-å°ç»",normalizedTitle:"1.4 å°ç»",charIndex:5550},{level:2,title:"2. æä¸äº¿ä¸ªkeysè¦ç»è®¡ï¼åºè¯¥ç¨åªç§éåï¼",slug:"_2-æä¸äº¿ä¸ªkeysè¦ç»è®¡-åºè¯¥ç¨åªç§éå",normalizedTitle:"2. æä¸äº¿ä¸ªkeysè¦ç»è®¡ï¼åºè¯¥ç¨åªç§éåï¼",charIndex:5909},{level:3,title:"2.1 èåç»è®¡ ââ Set",slug:"_2-1-èåç»è®¡-set",normalizedTitle:"2.1 èåç»è®¡ ââ set",charIndex:6327},{level:3,title:"2.2 æåºç»è®¡ ââ æåºéå",slug:"_2-2-æåºç»è®¡-æåºéå",normalizedTitle:"2.2 æåºç»è®¡ ââ æåºéå",charIndex:6994},{level:3,title:"2.3 äºå¼ç¶æç»è®¡ ââ Bitmap",slug:"_2-3-äºå¼ç¶æç»è®¡-bitmap",normalizedTitle:"2.3 äºå¼ç¶æç»è®¡ ââ bitmap",charIndex:8552},{level:3,title:"2.4 åºæ°ç»è®¡ ââ HyperLogLog",slug:"_2-4-åºæ°ç»è®¡-hyperloglog",normalizedTitle:"2.4 åºæ°ç»è®¡ ââ hyperloglog",charIndex:10111},{level:3,title:"2.5 å°ç»",slug:"_2-5-å°ç»",normalizedTitle:"2.5 å°ç»",charIndex:11569},{level:2,title:"3. GEO æ¯ä»ä¹ï¼è¿å¯ä»¥å®ä¹æ°çæ°æ®ç±»ååï¼",slug:"_3-geo-æ¯ä»ä¹-è¿å¯ä»¥å®ä¹æ°çæ°æ®ç±»åå",normalizedTitle:"3. geo æ¯ä»ä¹ï¼è¿å¯ä»¥å®ä¹æ°çæ°æ®ç±»ååï¼",charIndex:12077},{level:3,title:"3.1 é¢å LBS åºç¨ç GEO ç±»å",slug:"_3-1-é¢å-lbs-åºç¨ç-geo-ç±»å",normalizedTitle:"3.1 é¢å lbs åºç¨ç geo ç±»å",charIndex:12289},{level:4,title:"3.1.1 GEO çåºå±ç»æ",slug:"_3-1-1-geo-çåºå±ç»æ",normalizedTitle:"3.1.1 geo çåºå±ç»æ",charIndex:12450},{level:4,title:"3.1.2 GeoHash çç¼ç æ¹æ³",slug:"_3-1-2-geohash-çç¼ç æ¹æ³",normalizedTitle:"3.1.2 geohash çç¼ç æ¹æ³",charIndex:13725},{level:4,title:"3.1.3 å¦ä½æä½ GEO ç±»åï¼",slug:"_3-1-3-å¦ä½æä½-geo-ç±»å",normalizedTitle:"3.1.3 å¦ä½æä½ geo ç±»åï¼",charIndex:15843},{level:3,title:"3.2 å¦ä½èªå®ä¹æ°æ®ç±»å",slug:"_3-2-å¦ä½èªå®ä¹æ°æ®ç±»å",normalizedTitle:"3.2 å¦ä½èªå®ä¹æ°æ®ç±»å",charIndex:16869},{level:4,title:"3.2.1 Redis çåºæ¬å¯¹è±¡ç»æï¼RedisObject",slug:"_3-2-1-redis-çåºæ¬å¯¹è±¡ç»æ-redisobject",normalizedTitle:"3.2.1 redis çåºæ¬å¯¹è±¡ç»æï¼redisobject",charIndex:16974},{level:4,title:"3.2.2 å¼åä¸ä¸ªæ°çæ°æ®ç±»å",slug:"_3-2-2-å¼åä¸ä¸ªæ°çæ°æ®ç±»å",normalizedTitle:"3.2.2 å¼åä¸ä¸ªæ°çæ°æ®ç±»å",charIndex:17442},{level:3,title:"3.3 å°ç»",slug:"_3-3-å°ç»",normalizedTitle:"3.3 å°ç»",charIndex:20395}],headersStr:"1. âä¸éæ²¹âç Stringï¼ä¸ºä»ä¹ä¸å¥½ç¨äºï¼ 1.1 ä¸ºä»ä¹ String ç±»ååå­å¼éå¤§ï¼ 1.2 ç¨ä»ä¹æ°æ®ç»æå¯ä»¥èçåå­ï¼ 1.3 å¦ä½ç¨éåç±»åä¿å­åå¼çé®å¼å¯¹ï¼ 1.4 å°ç» 2. æä¸äº¿ä¸ªkeysè¦ç»è®¡ï¼åºè¯¥ç¨åªç§éåï¼ 2.1 èåç»è®¡ ââ Set 2.2 æåºç»è®¡ ââ æåºéå 2.3 äºå¼ç¶æç»è®¡ ââ Bitmap 2.4 åºæ°ç»è®¡ ââ HyperLogLog 2.5 å°ç» 3. GEO æ¯ä»ä¹ï¼è¿å¯ä»¥å®ä¹æ°çæ°æ®ç±»ååï¼ 3.1 é¢å LBS åºç¨ç GEO ç±»å 3.1.1 GEO çåºå±ç»æ 3.1.2 GeoHash çç¼ç æ¹æ³ 3.1.3 å¦ä½æä½ GEO ç±»åï¼ 3.2 å¦ä½èªå®ä¹æ°æ®ç±»å 3.2.1 Redis çåºæ¬å¯¹è±¡ç»æï¼RedisObject 3.2.2 å¼åä¸ä¸ªæ°çæ°æ®ç±»å 3.3 å°ç»",content:'> åèï¼\n> \n>  * 11 âä¸éæ²¹âç Stringï¼ä¸ºä»ä¹ä¸å¥½ç¨äºï¼| æå®¢æ¶é´\n>  * 12 æä¸äº¿ä¸ª keys è¦ç»è®¡ï¼åºè¯¥ç¨åªç§éåï¼| æå®¢æ¶é´\n>  * 13 GEOæ¯ä»ä¹ï¼è¿å¯ä»¥å®ä¹æ°çæ°æ®ç±»ååï¼| æå®¢æ¶é´\n\nè¿ä¸ç« è¿å¥å®è·µç¯ï¼å°å­¦ä¹ âæ°æ®ç»æâï¼ä»ç»åå­å¼éä»¥åä¿å­åç»è®¡æµ·éæ°æ®çæ°æ®ç±»ååå¶åºå±æ°æ®ç»æï¼è¿ä¼å´ç»å¸åçåºç¨åºæ¯ï¼ä¾å¦å°åä½ç½®æ¥è¯¢ãæ¶é´åºåæ°æ®åºè¯»ååæ¶æ¯éåå­åï¼ï¼è·ä½ åäº«ä½¿ç¨ Redis çæ°æ®ç±»åå module æ©å±åè½æ¥æ»¡è¶³éæ±çå·ä½æ¹æ¡ã\n\n\n# 1. âä¸éæ²¹âç Stringï¼ä¸ºä»ä¹ä¸å¥½ç¨äºï¼\n\nè¿ä¸èäºè§£ä¸ä¸ String ç±»åçåå­ç©ºé´æ¶èé®é¢ï¼ä»¥åéæ©èçåå­å¼éçæ°æ®ç±»åçè§£å³æ¹æ¡ã\n\nååäº«ä¸ä¸ªå®éçéæ±ãå½æ¶è¦å¼åä¸ä¸ªå¾çå­å¨ç³»ç»ï¼è¦æ±è½å¿«éè®°å½å¹¶è½å¤å¿«éæ ¹æ®å¾ç ID æ¾å°å¯¹åºçå¾çå­å¨å¯¹è±¡ IDï¼å³ photo_id -> photo_obj_idãç±äºå¾çæ°éå·¨å¤§ï¼æä»¬å°±ä½¿ç¨ 10 ä½æ°æ¥ä¿å­è¿ä¸ª IDï¼ä¾å¦ï¼\n\nphoto_id: 1101000051\nphoto_obj_id: 3301000051\n\n\n1\n2\n\n\nå¯ä»¥çå° photo_id ä¸ photo_obj_id ä¸ä¸å¯¹åºï¼æ¯å¸åçâé®-åå¼âæ¨¡å¼ãæè°çâåå¼âï¼å°±æ¯æé®å¼å¯¹ä¸­çå¼å°±æ¯ä¸ä¸ªå¼ï¼èä¸æ¯ä¸ä¸ªéåï¼è¿å String ç±»åæä¾çâä¸ä¸ªé®å¯¹åºä¸ä¸ªå¼çæ°æ®âçä¿å­å½¢å¼åå¥½å¥åã\n\nèä¸ï¼String ç±»åå¯ä»¥ä¿å­äºè¿å¶å­èæµï¼å°±åâä¸éæ²¹âä¸æ ·ï¼åªè¦ææ°æ®è½¬æäºè¿å¶å­èæ°ç»ï¼å°±å¯ä»¥ä¿å­äºã\n\næä»¥ï¼æä»¬çç¬¬ä¸ä¸ªæ¹æ¡å°±æ¯ç¨ String ä¿å­æ°æ®ãæä»¬æå¾ç ID åå¾çå­å¨å¯¹è±¡ ID åå«ä½ä¸ºé®å¼å¯¹ç key å value æ¥ä¿å­ï¼å¶ä¸­ï¼å¾çå­å¨å¯¹è±¡ ID ç¨äº String ç±»åã\n\nåå¼å§ï¼æä»¬ä¿å­äº1äº¿å¼ å¾çï¼å¤§çº¦ç¨äº6.4GBçåå­ãä½éçå¾çæ°æ®éçä¸æ­å¢å ï¼Redis åå­ä½¿ç¨éä¹å¨å¢å ï¼å¯¼è´å çæ RDB èååºåæ¢çé®é¢ãå¾æ¾ç¶ï¼String ç±»åå¹¶ä¸æ¯ä¸ç§å¥½çéæ©ï¼æä»¬è¿éè¦è¿ä¸æ­¥å¯»æ¾è½èçåå­å¼éçæ°æ®ç±»åæ¹æ¡ã\n\nå¨è¿ä¸ªè¿ç¨ä¸­ï¼æä»¬ç ç©¶åç°ï¼String ç±»åå¹¶ä¸æ¯éç¨äºææåºåçï¼å®æä¸ä¸ªææ¾çç­æ¿ï¼å°±æ¯å®ä¿å­æ°æ®æ¶ææ¶èçåå­ç©ºé´è¾å¤ã\n\nåæ¶ï¼æä»¬è¿ä»ç»ç ç©¶äºéåç±»åçæ°æ®ç»æï¼åç°ï¼éåç±»åæéå¸¸èçåå­ç©ºé´çåºå±å®ç°ç»æï¼ä½æ¯ï¼éåç±»åä¿å­çæ°æ®æ¨¡å¼ï¼æ¯ä¸ä¸ªé®å¯¹åºä¸ç³»åå¼ï¼å¹¶ä¸éåç´æ¥ä¿å­åå¼çé®å¼å¯¹ãæä»¥ï¼æä»¬å°±ä½¿ç¨äºçº§ç¼ç çæ¹æ³ï¼å®ç°äºç¨éåç±»åä¿å­åå¼é®å¼å¯¹ï¼Redis å®ä¾çåå­ç©ºé´æ¶èææ¾ä¸éäºã\n\nè¿èè¯¾ï¼æå°±æå¨è§£å³è¿ä¸ªé®é¢æ¶å­¦å°çç»éªåæ¹æ³åäº«ç»ä½ ï¼åæ¬ String ç±»åçåå­ç©ºé´æ¶èå¨åªå¿äºãç¨ä»ä¹æ°æ®ç»æå¯ä»¥èçåå­ï¼ä»¥åå¦ä½ç¨éåç±»åä¿å­åå¼é®å¼å¯¹ãå¦æä½ å¨ä½¿ç¨ String ç±»åæ¶ä¹éå°äºåå­ç©ºé´æ¶èè¾å¤çé®é¢ï¼å°±å¯ä»¥å°è¯ä¸ä»å¤©çè§£å³æ¹æ¡äºã\n\næ¥ä¸æ¥ï¼æä»¬åæ¥çç String ç±»åçåå­é½æ¶èå¨åªéäºã\n\n\n# 1.1 ä¸ºä»ä¹ String ç±»ååå­å¼éå¤§ï¼\n\nå¨åæçæ¡ä¾ä¸­ï¼æä»¬ä¿å­äº1äº¿å¼ å¾ççä¿¡æ¯ï¼ç¨äºçº¦ 6.4GB çåå­ï¼ä¸ä¸ªå¾çIDåå¾çå­å¨å¯¹è±¡IDçè®°å½å¹³åç¨äº 64 å­èãä½é®é¢æ¯ï¼ä¸ç»å¾çIDåå¶å­å¨å¯¹è±¡IDçè®°å½ï¼å®éåªéè¦ 16 å­èå°±å¯ä»¥äºã\n\næä»¬æ¥åæä¸ä¸ãå¦ææä»¬å¯ä»¥ç¨ä¸¤ä¸ª8å­èç Long ç±»åè¡¨ç¤ºè¿ä¸¤ä¸ª IDï¼å ä¸º 8 å­èçLongç±»åæå¤§å¯ä»¥è¡¨ç¤º $2^{64}$ï¼æä»¥è¯å®å¯ä»¥è¡¨ç¤º 10 ä½æ°ãä½æ¯ï¼ä¸ºä»ä¹ String ç±»åå´ç¨äº 64 å­èå¢ï¼\n\nå¶å®ï¼é¤äºè®°å½å®éæ°æ®ï¼Stringç±»åè¿éè¦é¢å¤çåå­ç©ºé´è®°å½æ°æ®é¿åº¦ãç©ºé´ä½¿ç¨ç­ä¿¡æ¯ï¼è¿äºä¿¡æ¯ä¹å«ä½åæ°æ®ãå½å®éä¿å­çæ°æ®è¾å°æ¶ï¼åæ°æ®çç©ºé´å¼éå°±æ¾å¾æ¯è¾å¤§äºï¼æç¹âå§å®¾å¤ºä¸»âçææã\n\né£ä¹ï¼String ç±»åå·ä½æ¯æä¹ä¿å­æ°æ®çå¢ï¼\n\nå½ä½ ä¿å­ 64 ä½æç¬¦å·æ´æ°æ¶ï¼String ç±»åä¼æå®ä¿å­ä¸ºä¸ä¸ª 8 å­èç long ç±»åæ´æ°ï¼è¿ç§æ¹å¼éå¸¸ä¹ç§°ä¸º int ç¼ç æ¹å¼ã\n\nä½å½ä½ ä¿å­çæ°æ®ä¸­åå«å­ç¬¦æ¶ï¼String ç±»åå°±ä¼ç¨ç®åå¨æå­ç¬¦ä¸²ï¼Simple Dynamic Stringï¼SDSï¼ç struct æ¥ä¿å­ï¼\n\n * bufï¼char[] ç±»åï¼ä¿å­å®éæ°æ®ï¼åæ¶ä¼å¨å°¾é¨å ä¸ä¸ª \\0ã\n * lenï¼4 byteï¼è¡¨ç¤º buf çé¿åº¦ã\n * allocï¼4 byteï¼è¡¨ç¤º buf çåéé¿åº¦ã\n\nå¯ä»¥çå°ï¼len å alloc å°±æ¯ SDS ç»æä½çé¢å¤å¼éãå¦å¤ï¼å¯¹äº String ç±»åæ¥è¯´ï¼é¤äº SDSï¼è¿æä¸ä¸ªæ¥èªäº RedisObject ç»æä½çå¼éã\n\nRedis ä½¿ç¨ RedisObject ç»æä½æ¥ç»ä¸è®°å½ä¸åçæ°æ®ç»æçåæ°æ®åå®éæ°æ®ä½ç½®ãå¶ç»æç¤ºæå¾å¦ä¸ï¼\n\nä¸ºäºèçåå­ï¼Redis è¿å¯¹ Long ç±»åæ´æ°å SDS çåå­å¸å±åäºä¸é¨çè®¾è®¡ï¼\n\n * å½ä¿å­çæ¯ Long ç±»åæ¶ï¼RedisObject ä¸­ç ptr å°±ç´æ¥èµå¼ä¸ºæ´æ°æ°æ®äºï¼è¿æ ·å°±ä¸ç¨é¢å¤çæéåæåæ´æ°äºï¼èçäºæéçå¼éãè¿ä¹æ¯åé¢è¯´ç int ç¼ç æ¹å¼ã\n * å½ä¿å­çæ¯å­ç¬¦ä¸²æ¶ï¼ä¸å­ç¬¦ä¸²å°äºç­äº 44 byte æ¶ï¼RedisObject ä¸­çåæ°æ®ãæéå SDS æ¯ä¸åè¿ç»­çåå­åºåï¼è¿æ ·å°±å¯ä»¥é¿ååå­ç¢çãè¿ç§å¸å±æ¹å¼ä¹è¢«ç§°ä¸º embstr ç¼ç æ¹å¼ã\n * å½å­ç¬¦ä¸²å¤§äº 44 byte æ¶ï¼SDS æ°æ®éå°±å¼å§åå¤ï¼Redis å°±ä¸åæ SDS å RedisObject å¸å±å¨ä¸èµ·äºï¼èæ¯ä¼ç» SDS åéç¬ç«çç©ºé´ï¼å¹¶ç¨æéæå SDS ç»æãè¿ç§å¸å±æ¹å¼è¢«ç§°ä¸º raw ç¼ç æ¨¡å¼ã\n\nä¸ç§ç¼ç æ¹å¼å¦ä¸å¾æç¤ºï¼\n\nç°å¨ç¥éäº RedisObject çé¢å¤å¼éï¼æä»¬å°±å¯ä»¥è®¡ç® String ç±»åçåå­ä½¿ç¨éäºã\n\nå ä¸º10ä½æ°çå¾çIDåå¾çå­å¨å¯¹è±¡IDæ¯Longç±»åæ´æ°ï¼æä»¥å¯ä»¥ç´æ¥ç¨intç¼ç çRedisObjectä¿å­ãæ¯ä¸ªintç¼ç çRedisObjectåæ°æ®é¨åå 8å­èï¼æéé¨åè¢«ç´æ¥èµå¼ä¸º8å­èçæ´æ°äºãæ­¤æ¶ï¼æ¯ä¸ªIDä¼ä½¿ç¨16å­èï¼å èµ·æ¥ä¸å±æ¯32å­èãä½æ¯ï¼å¦å¤ç32å­èå»åªå¿äºå¢ï¼å¶å®ï¼Redis æ¯ä½¿ç¨ä¸ä¸ªå¨å± hash table æ¥ä¿å­ææçé®å¼å¯¹çï¼åå¸è¡¨çæ¯ä¸é¡¹æ¯ä¸ä¸ª dictEntry çç»æä½ï¼ç¨æ¥æåä¸ä¸ª kv pairãå¶ä¸­ dictEntry æä¸ä¸ª 8 byte çæéï¼åå«æå keyãvalue ä»¥åä¸ä¸ä¸ª dictEntryãä¸ä¸ª dictEntry å¦ä¸å¾æç¤ºï¼\n\nä½ dictEntry åªå äº 24 byteï¼é£ä¸ºå¥ä¼å ç¨ 32 byte å¢ï¼è¿å°±è¦æå° Redis ä½¿ç¨çåå­åéåº jemalloc äºã\n\njemalloc å¨åéåå­æ¶ï¼ä¼æ ¹æ®æä»¬ç³è¯·çå­èæ° Nï¼æ¾ä¸ä¸ªæ¯ N å¤§ï¼ä½æ¯ææ¥è¿ N ç 2 çå¹æ¬¡æ°ä½ä¸ºåéçç©ºé´ï¼è¿æ ·å¯ä»¥åå°é¢ç¹åéçæ¬¡æ°ãä¸¾ä¸ªä¾å­ãå¦æä½ ç³è¯·6å­èç©ºé´ï¼jemallocå®éä¼åé8å­èç©ºé´ï¼å¦æä½ ç³è¯·24å­èç©ºé´ï¼jemallocåä¼åé32å­èãæä»¥ï¼å¨æä»¬ååè¯´çåºæ¯éï¼dictEntryç»æå°±å ç¨äº32å­èã\n\nå¥½äºï¼å°è¿éä½ å°±è½çè§£ï¼ä¸ºä»ä¹ç¨Stringç±»åä¿å­å¾çIDåå¾çå­å¨å¯¹è±¡IDæ¶éè¦ç¨64ä¸ªå­èäºãä½ çï¼ææææä¿¡æ¯åªæ 16 byteï¼ä½¿ç¨ String ç±»åä¿å­å´éè¦ 64 byte çåå­ç©ºé´ï¼æ 48 byte é½æ¯é¢å¤å¼éãé£ææ²¡ææ´èçåå­çæ¹æ³å¢ï¼\n\n\n# 1.2 ç¨ä»ä¹æ°æ®ç»æå¯ä»¥èçåå­ï¼\n\nRedis æä¸ç§åºå±æ°æ®ç»æï¼å«åç¼©åè¡¨ï¼ziplistï¼ï¼è¿æ¯ä¸ç§éå¸¸èçåå­çç»æã\n\næä»¬ååé¡¾ä¸åç¼©åè¡¨çææï¼è¡¨å¤´æä¸ä¸ªå­æ®µzlbytesãzltailåzllenï¼åå«è¡¨ç¤ºåè¡¨é¿åº¦ãåè¡¨å°¾çåç§»éï¼ä»¥ååè¡¨ä¸­çentryä¸ªæ°ãåç¼©åè¡¨å°¾è¿æä¸ä¸ªzlendï¼è¡¨ç¤ºåè¡¨ç»æãå¦ä¸å¾ï¼\n\nåç¼©åè¡¨ä¹æä»¥è½èçåå­ï¼å°±å¨äºå®æ¯ç¨ä¸ç³»åè¿ç»­ç entry ä¿å­æ°æ®ãæ¯ä¸ª entry çåæ°æ®åæ¬ä¸é¢å é¨åï¼\n\n * prev_lenï¼è¡¨ç¤ºåä¸ä¸ªentryçé¿åº¦ãprev_lenæä¸¤ç§åå¼æåµï¼1å­èæ5å­èãåå¼1å­èæ¶ï¼è¡¨ç¤ºä¸ä¸ä¸ªentryçé¿åº¦å°äº254å­èãè½ç¶1å­èçå¼è½è¡¨ç¤ºçæ°å¼èå´æ¯0å°255ï¼ä½æ¯åç¼©åè¡¨ä¸­zlendçåå¼é»è®¤æ¯255ï¼å æ­¤ï¼å°±é»è®¤ç¨255è¡¨ç¤ºæ´ä¸ªåç¼©åè¡¨çç»æï¼å¶ä»è¡¨ç¤ºé¿åº¦çå°æ¹å°±ä¸è½åç¨255è¿ä¸ªå¼äºãæä»¥ï¼å½ä¸ä¸ä¸ªentryé¿åº¦å°äº254å­èæ¶ï¼prev_lenåå¼ä¸º1å­èï¼å¦åï¼å°±åå¼ä¸º5å­èã\n * lenï¼è¡¨ç¤ºèªèº«é¿åº¦ï¼4 byte\n * encodingï¼è¡¨ç¤ºç¼ç æ¹å¼ï¼1 byte\n * contentï¼ä¿å­å®éæ°æ®\n\nè¿äº entry ä¼æ¨ä¸ªå¿æ¾ç½®å¨åå­ä¸­ï¼ä¸éè¦åç¨é¢å¤çæéè¿è¡è¿æ¥ï¼è¿æ ·å°±å¯ä»¥èçæéæå ç¨çç©ºé´ã\n\næä»¬ä»¥ä¿å­å¾çå­å¨å¯¹è±¡IDä¸ºä¾ï¼æ¥åæä¸ä¸åç¼©åè¡¨æ¯å¦ä½èçåå­ç©ºé´çãæ¯ä¸ªentryä¿å­ä¸ä¸ªå¾çå­å¨å¯¹è±¡IDï¼8å­èï¼ï¼æ­¤æ¶ï¼æ¯ä¸ªentryçprev_lenåªéè¦1ä¸ªå­èå°±è¡ï¼å ä¸ºæ¯ä¸ªentryçåä¸ä¸ªentryé¿åº¦é½åªæ8å­èï¼å°äº254å­èãè¿æ ·ä¸æ¥ï¼ä¸ä¸ªå¾ççå­å¨å¯¹è±¡IDæå ç¨çåå­å¤§å°æ¯14å­èï¼1+4+1+8=14ï¼ï¼å®éåé16å­èã\n\nRedisåºäºåç¼©åè¡¨å®ç°äº ListãHash å Sorted Set è¿æ ·çéåç±»åï¼è¿æ ·åçæå¤§å¥½å¤å°±æ¯èçäº dictEntry çå¼éãå½ä½ ç¨ String ç±»åæ¶ï¼ä¸ä¸ªé®å¼å¯¹å°±æä¸ä¸ª dictEntryï¼è¦ç¨ 32 å­èç©ºé´ãä½éç¨éåç±»åæ¶ï¼ä¸ä¸ª key å°±å¯¹åºä¸ä¸ªéåçæ°æ®ï¼è½ä¿å­çæ°æ®å¤äºå¾å¤ï¼ä½ä¹åªç¨äºä¸ä¸ª dictEntryï¼è¿æ ·å°±èçäºåå­ã\n\nè¿ä¸ªæ¹æ¡å¬èµ·æ¥å¾å¥½ï¼ä½è¿å­å¨ä¸ä¸ªé®é¢ï¼å¨ç¨éåç±»åä¿å­é®å¼å¯¹æ¶ï¼ä¸ä¸ªé®å¯¹åºäºä¸ä¸ªéåçæ°æ®ï¼ä½æ¯å¨æä»¬çåºæ¯ä¸­ï¼ä¸ä¸ªå¾çIDåªå¯¹åºä¸ä¸ªå¾ççå­å¨å¯¹è±¡IDï¼æä»¬è¯¥æä¹ç¨éåç±»åå¢ï¼æ¢å¥è¯è¯´ï¼å¨ä¸ä¸ªé®å¯¹åºä¸ä¸ªå¼ï¼ä¹å°±æ¯åå¼é®å¼å¯¹ï¼çæåµä¸ï¼æä»¬è¯¥æä¹ç¨éåç±»åæ¥ä¿å­è¿ç§åå¼é®å¼å¯¹å¢ï¼\n\n\n# 1.3 å¦ä½ç¨éåç±»åä¿å­åå¼çé®å¼å¯¹ï¼\n\nå¨ä¿å­åå¼çé®å¼å¯¹æ¶ï¼å¯ä»¥éç¨åºäº Hash ç±»åçäºçº§ç¼ç æ¹æ³ãè¿éè¯´çäºçº§ç¼ç ï¼å°±æ¯æä¸ä¸ªåå¼çæ°æ®æåæä¸¤é¨åï¼åä¸é¨åä½ä¸ºHashéåçkeyï¼åä¸é¨åä½ä¸ºHashéåçvalueï¼è¿æ ·ä¸æ¥ï¼æä»¬å°±å¯ä»¥æåå¼æ°æ®ä¿å­å°Hashéåä¸­äºã\n\nä»¥å¾çID 1101000060åå¾çå­å¨å¯¹è±¡ID 3302000080ä¸ºä¾ï¼æä»¬å¯ä»¥æå¾çIDçå7ä½ï¼1101000ï¼ä½ä¸ºHashç±»åçé®ï¼æå¾çIDçæå3ä½ï¼060ï¼åå¾çå­å¨å¯¹è±¡IDåå«ä½ä¸ºHashç±»åå¼ä¸­çkeyåvalueã\n\næç§è¿ç§è®¾è®¡æ¹æ³ï¼æå¨Redisä¸­æå¥äºä¸ç»å¾çIDåå¶å­å¨å¯¹è±¡IDçè®°å½ï¼å¹¶ä¸ç¨infoå½ä»¤æ¥çäºåå­å¼éï¼æåç°ï¼å¢å ä¸æ¡è®°å½åï¼åå­å ç¨åªå¢å äº16å­èï¼å¦ä¸æç¤ºï¼\n\n127.0.0.1:6379> info memory\n# Memory\nused_memory:1039120\n127.0.0.1:6379> hset 1101000 060 3302000080\n(integer) 1\n127.0.0.1:6379> info memory\n# Memory\nused_memory:1039136\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨ä½¿ç¨ String ç±»åæ¶ï¼æ¯ä¸ªè®°å½éè¦æ¶è 64 å­èï¼è¿ç§æ¹å¼å´åªç¨äº 16 å­èï¼æä½¿ç¨çåå­ç©ºé´æ¯åæ¥ç 1/4ï¼æ»¡è¶³äºæä»¬èçåå­ç©ºé´çéæ±ã\n\nä¸è¿ï¼ä½ å¯è½ä¹ä¼æçæï¼âäºçº§ç¼ç ä¸å®è¦æå¾çIDçå7ä½ä½ä¸ºHashç±»åçé®ï¼ææå3ä½ä½ä¸ºHashç±»åå¼ä¸­çkeyåï¼â å¶å®ï¼äºçº§ç¼ç æ¹æ³ä¸­éç¨çIDé¿åº¦æ¯æè®²ç©¶çã\n\næä»¬ä¹åè®²è¿ï¼Redis ç Hash ç±»åæä¸¤ç§åºå±å®ç°ç»æï¼åå«æ¯åç¼©åè¡¨ååå¸è¡¨ãHash ç±»åè®¾ç½®äºä¸ä¸ªç¨åç¼©åè¡¨ä¿å­æ°æ®æ¶çéå¼ï¼ä¸æ¦è¶è¿éå¼ï¼Hash ç±»åå°±ä¼ç¨åå¸è¡¨æ¥ä¿å­æ°æ®äºãè¿ä¸¤ä¸ªéå¼åå«å¯¹åºä»¥ä¸ä¸¤ä¸ªéç½®é¡¹ï¼\n\n * hash-max-ziplist-entriesï¼è¡¨ç¤ºç¨åç¼©åè¡¨ä¿å­æ¶åå¸éåä¸­çæå¤§åç´ ä¸ªæ°ã\n * hash-max-ziplist-valueï¼è¡¨ç¤ºç¨åç¼©åè¡¨ä¿å­æ¶åå¸éåä¸­åä¸ªåç´ çæå¤§é¿åº¦ã\n\nå¦ææä»¬å¾Hashéåä¸­åå¥çåç´ ä¸ªæ°è¶è¿äº hash-max-ziplist-entriesï¼æèåå¥çåä¸ªåç´ å¤§å°è¶è¿äº hash-max-ziplist-valueï¼Redis å°±ä¼èªå¨æ Hash ç±»åçå®ç°ç»æç±åç¼©åè¡¨è½¬ä¸ºåå¸è¡¨ã\n\nä¸æ¦ä»åç¼©åè¡¨è½¬ä¸ºäºåå¸è¡¨ï¼Hash ç±»åå°±ä¼ä¸ç´ç¨åå¸è¡¨è¿è¡ä¿å­ï¼èä¸ä¼åè½¬ååç¼©åè¡¨äºãå¨èçåå­ç©ºé´æ¹é¢ï¼åå¸è¡¨å°±æ²¡æåç¼©åè¡¨é£ä¹é«æäºã\n\nä¸ºäºè½ååä½¿ç¨åç¼©åè¡¨çç²¾ç®åå­å¸å±ï¼æä»¬ä¸è¬è¦æ§å¶ä¿å­å¨Hashéåä¸­çåç´ ä¸ªæ°ãæä»¥ï¼å¨åæçäºçº§ç¼ç ä¸­ï¼æä»¬åªç¨å¾çIDæå3ä½ä½ä¸ºHashéåçkeyï¼ä¹å°±ä¿è¯äºHashéåçåç´ ä¸ªæ°ä¸è¶è¿1000ï¼åæ¶ï¼æä»¬æ hash-max-ziplist-entries è®¾ç½®ä¸º 1000ï¼è¿æ ·ä¸æ¥ï¼Hash éåå°±å¯ä»¥ä¸ç´ä½¿ç¨åç¼©åè¡¨æ¥èçåå­ç©ºé´äºã\n\n\n# 1.4 å°ç»\n\nè¿ä¸èæä»¬æç ´äºå¯¹ String çè®¤ç¥è¯¯åºï¼äºè§£å° String å¹¶éä¸éæ²¹ï¼å½ä¿å­ç kv pair æ¬èº«å ç¨åå­ç©ºé´ä¸å¤§æ¶ï¼String ç±»åçåæ°æ®å¼éå°±å æ®ä¸»å¯¼äºï¼è¿åæ¬äº RedisObjectãSDSãdictEntry ç»æçåå­å¼éã\n\néå¯¹è¿ç§æåµï¼æä»¬å¯ä»¥åå©åç¼©åè¡¨è¿ç§åºå±ç»æï¼ä½¿ç¨ Hash ç±»åçäºçº§ç¼ç æ¹æ³æ¥ä¿å­åå¼ kv pair çæ°æ®ãä¹å°±æ¯éè¦å°å kv pair ç key ææä¸¤é¨åï¼åä¸é¨åä½ä¸º Hash éåç keyï¼åä¸é¨åä¸å kv pair ç value ç»åæä¸ä¸ªæ° kv æ¥ä½ä¸º Hash éåç valueã\n\nå°å¦æï¼å¦æä½ æ³ç¥é kv pair éç¨ä¸åç±»åä¿å­æ¶çåå­å¼éï¼å¯ä»¥å¨Redis å®¹éé¢ä¼°è¿ä¸ªç½ç«ä¸è¿è¡ä¼°è®¡ã\n\n\n# 2. æä¸äº¿ä¸ªkeysè¦ç»è®¡ï¼åºè¯¥ç¨åªç§éåï¼\n\nå¾å¤åºæ¯éè¦ä¿å­è¿æ ·ä¸ç§æ°æ®ï¼ä¸ä¸ª key å¯¹åºäºä¸ä¸ªæ°æ®éåãæ¯å¦:\n\n * ææºAppä¸­çæ¯å¤©çç¨æ·ç»å½ä¿¡æ¯ï¼ä¸å¤© -> ç¨æ· ID / ç»å½è®¾å¤;\n * çµåç½ç«ä¸ååçç¨æ·è¯è®ºåè¡¨ï¼ä¸ä¸ªåå -> ä¸ç³»åè¯è®ºï¼\n * ç¨æ·å¨ææºAppä¸çç­¾å°æå¡ä¿¡æ¯ï¼åå·¥ -> ä¸å¤©æå¡è®°å½ã\n\nRedis çéåç±»åå¾éåå­å¨è¿äºæ°æ®ï¼ä½å¨è¿äºåºæ¯ä¸­ï¼é¤äºè®°å½ä¿¡æ¯ï¼æä»¬å¾å¾è¿éè¦å¯¹éåä¸­çæ°æ®è¿è¡ç»è®¡ï¼æ¯å¦ç»è®¡æ¯å¤©æ°å¢ç¨æ·æ°ãç»è®¡è¯è®ºåè¡¨ä¸­çææ°è¯è®ºãä¸ä¸ªæè¿ç»­æå¡çåå·¥æ°ç­ãéå¸¸æä»¬ä¼é¢ä¸´å·¨å¤§çè®¿é®éï¼æ¯å¦ç¾ä¸ãåä¸çº§å«ãæä»¥ï¼æä»¬å¿é¡»è¦è½å¤éæ©éå¸¸é«æå°ç»è®¡å¤§éæ°æ®ï¼ä¾å¦äº¿çº§ï¼çéåç±»åã\n\nè¦æ³éæ©åéçéåï¼æä»¬å°±å¾äºè§£å¸¸ç¨çéåç»è®¡æ¨¡å¼ãè¿ä¸èå°ä»ç»éåç±»åçå¸¸è§åç§ç»è®¡æ¨¡å¼ï¼èåç»è®¡ãæåºç»è®¡ãäºå¼ç¶æç»è®¡ååºæ°ç»è®¡ï¼å¹¶ä»ç»è¿äºç»è®¡åºæ¯ä¸ä»ä¹æ°æ®ç»ææ´å åéã\n\n\n# 2.1 èåç»è®¡ ââ Set\n\nèåç»è®¡ï¼æç»è®¡å¤ä¸ªéååç´ çèåç»æï¼åæ¬ï¼ç»è®¡å¤ä¸ªéåçå±æåç´ ï¼äº¤éç»è®¡ï¼ï¼æä¸¤ä¸ªéåç¸æ¯ï¼ç»è®¡å¶ä¸­ä¸ä¸ªéåç¬æçåç´ ï¼å·®éç»è®¡ï¼ï¼ç»è®¡å¤ä¸ªéåçææåç´ ï¼å¹¶éç»è®¡ï¼ã\n\næ¯å¦ç»è®¡ææº App æ¯å¤©çæ°å¢ç¨æ·æ°åç¬¬äºå¤©ççå­ç¨æ·æ°å°±æ¯èåç»è®¡ãè¦å®æè¿ä¸ªç»è®¡ä»»å¡ï¼æä»¬å¯ä»¥ç¨ä¸ä¸ªéåè®°å½ææç»å½è¿Appçç¨æ·IDï¼åæ¶ï¼ç¨å¦ä¸ä¸ªéåè®°å½æ¯ä¸å¤©ç»å½è¿Appçç¨æ·IDãç¶åï¼åå¯¹è¿ä¸¤ä¸ªéååèåç»è®¡ãæä»¬æ¥çä¸å·ä½çæä½ã\n\nå¯ä»¥ä½¿ç¨ Set ç±»åæ¥è®°å½ææç»å½è¿ App çç¨æ· IDï¼æ key è®¾ç½®æ user:idï¼value å°±æ¯ä¿å­äºææç»éè¿ App çç¨æ· ID ç Setï¼å¦ä¸å¾ï¼\n\nè¿éè¦è®°å½æ¯ä¸å¤©ç»å½çç¨æ· IDï¼å¯ä»¥è®© key è®¾ä¸º user:id:<datetime>ï¼æ¯å¦ user:id:20200803ï¼value æ¯è®°å½äºå½å¤©ç»å½çææç¨æ· ID ç Setãå¦ä¸å¾ï¼\n\nå¨ç»è®¡æ¯å¤©çæ°å¢ç¨æ·æ¶ï¼æä»¬åªç¨è®¡ç®æ¯æ¥ç¨æ· Set åç´¯è®¡ç¨æ· Set çå·®éå°±è¡ã\n\nå½ä½ éè¦å¯¹å¤ä¸ªéåè¿è¡èåè®¡ç®æ¶ï¼Set ç±»åä¼æ¯ä¸ä¸ªéå¸¸ä¸éçéæ©ãä¸è¿ï¼è¿éæä¸ä¸ªæ½å¨çé£é©ï¼Set çå·®éãå¹¶éåäº¤éçè®¡ç®å¤æåº¦è¾é«ï¼å¨æ°æ®éè¾å¤§çæåµä¸ï¼å¦æç´æ¥æ§è¡è¿äºè®¡ç®ï¼ä¼å¯¼è´Rediså®ä¾é»å¡ãæä»¥è¿éç»ä¸ä¸ªå°å»ºè®®ï¼ä½ å¯ä»¥ä»ä¸»ä»éç¾¤ä¸­éæ©ä¸ä¸ªä»åºï¼è®©å®ä¸é¨è´è´£èåè®¡ç®ï¼æèæ¯ææ°æ®è¯»åå°å®¢æ·ç«¯ï¼å¨å®¢æ·ç«¯æ¥å®æèåç»è®¡ï¼è¿æ ·å°±å¯ä»¥è§é¿é»å¡ä¸»åºå®ä¾åå¶ä»ä»åºå®ä¾çé£é©äºã\n\n\n# 2.2 æåºç»è®¡ ââ æåºéå\n\nè¿ä¸å°èè®²åºå¯¹éååç´ æåºçéæ±çæ¹æ³ï¼è¿éä»¥çµåç½ç«æä¾ææ°è¯è®ºåè¡¨çåºæ¯ä¸ºä¾è¿è¡è®²è§£ã\n\nææ°è¯è®ºåè¡¨åå«äºææè¯è®ºä¸­çææ°çè¨ï¼è¿å°±è¦æ±éåç±»åè½å¯¹åç´ ä¿åºï¼è¿ç§å¯¹åç´ ä¿åºçéåç±»åå«ä½æåºéåãå¨ Redis çåä¸ªéåç±»åä¸­ï¼ListãHashãSet å Sorted Setï¼ï¼List å Sorted Set å°±å±äºæåºéåã\n\n * List æç§åç´ æ·»å çé¡ºåºè¿è¡æåºï¼\n * Sorted Set æç§åç´ çæéæ¥æåºï¼å¶ä¸­æéå¼å¯ä»¥èªå·±å³å®ï¼æ¯å¦è®©æå¥æ¶é´ä½ä¸ºæéï¼ã\n\nè²ä¼¼é½ç¬¦åéæ±ï¼æ¥ä¸æ¥çä¸ä¸å¦ä½éæ©ã\n\n----------------------------------------\n\nå¦æä½¿ç¨ List çè¯ãæ¯ä¸ªååå¯¹åºä¸ä¸ª Listï¼è¿ä¸ª List åå«äºè¯¥ååçå¨é¨è¯è®ºï¼å¹¶æç§è¯è®ºæ¶é´ä¿å­ï¼æ¯æ¥ä¸ä¸ªæ°è¯è®ºå°±ç¨ LPUSH å½ä»¤æå®æå¥å° List çéå¤´ã\n\nå¨åªæä¸é¡µè¯è®ºçæ¶åï¼æä»¬å¯ä»¥å¾æ¸æ°å°çå°ææ°çè¯è®ºï¼ä½æ¯ï¼å¨å®éåºç¨ä¸­ï¼ç½ç«ä¸è¬ä¼åé¡µæ¾ç¤ºææ°çè¯è®ºåè¡¨ï¼ä¸æ¦æ¶åå°åé¡µæä½ï¼Listå°±å¯è½ä¼åºç°é®é¢äºã\n\nåè®¾å½åçè¯è®ºListæ¯{A, B, C, D, E, F}ï¼å¶ä¸­ï¼Aæ¯ææ°çè¯è®ºï¼ä»¥æ­¤ç±»æ¨ï¼Fæ¯ææ©çè¯è®ºï¼ï¼å¨å±ç¤ºç¬¬ä¸é¡µç3ä¸ªè¯è®ºæ¶ï¼æä»¬å¯ä»¥ç¨ä¸é¢çå½ä»¤ï¼å¾å°ææ°çä¸æ¡è¯è®ºAãBãCï¼\n\nLRANGE product1 0 2\n1) "A"\n2) "B"\n3) "C"\n\n\n1\n2\n3\n4\n\n\nç¶åï¼åç¨ä¸é¢çå½ä»¤è·åç¬¬äºé¡µç3ä¸ªè¯è®ºï¼ä¹å°±æ¯DãEãFï¼\n\nLRANGE product1 3 5\n1) "D"\n2) "E"\n3) "F"\n\n\n1\n2\n3\n4\n\n\nä½æ¯ï¼å¦æå¨å±ç¤ºç¬¬äºé¡µåï¼åäº§çäºä¸ä¸ªæ°è¯è®ºGï¼è¯è®ºGå°±ä¼è¢«LPUSHå½ä»¤æå¥å°è¯è®ºListçéå¤´ï¼è¯è®ºListå°±åæäº{G, A, B, C, D, E, F}ãæ­¤æ¶ï¼åç¨åæçå½ä»¤è·åç¬¬äºé¡µè¯è®ºæ¶ï¼å°±ä¼åç°ï¼è¯è®ºCåè¢«å±ç¤ºåºæ¥äºï¼ä¹å°±æ¯CãDãEï¼\n\nLRANGE product1 3 5\n1) "C"\n2) "D"\n3) "E"\n\n\n1\n2\n3\n4\n\n\nä¹æä»¥ä¼è¿æ ·ï¼å³é®åå å°±å¨äºï¼Listæ¯éè¿åç´ å¨Listä¸­çä½ç½®æ¥æåºçï¼å½æä¸ä¸ªæ°åç´ æå¥æ¶ï¼ååçåç´ å¨Listä¸­çä½ç½®é½åç§»äºä¸ä½ï¼æ¯å¦è¯´åæ¥å¨ç¬¬1ä½çåç´ ç°å¨æå¨äºç¬¬2ä½ãæä»¥ï¼å¯¹æ¯æ°åç´ æå¥ååï¼List ç¸åä½ç½®ä¸çåç´ å°±ä¼åçååï¼ç¨ LRANGE è¯»åæ¶ï¼å°±ä¼è¯»å°æ§åç´ ã\n\n----------------------------------------\n\nå List ç¸æ¯ï¼Sorted Set å°±ä¸å­å¨è¿ä¸ªé®é¢ï¼å ä¸ºå®æ¯æ ¹æ®åç´ çå®éæéæ¥æåºåè·åæ°æ®çã\n\næä»¬å¯ä»¥æè¯è®ºæ¶é´çååç»æ¯æ¡è¯è®ºè®¾ç½®ä¸ä¸ªæéå¼ï¼ç¶ååæè¯è®ºä¿å­å° Sorted Set ä¸­ãSorted Set ç ZRANGEBYSCORE å½ä»¤å°±å¯ä»¥ææéæåºåè¿ååç´ ãè¿æ ·çè¯ï¼å³ä½¿éåä¸­çåç´ é¢ç¹æ´æ°ï¼Sorted Set ä¹è½éè¿ ZRANGEBYSCORE å½ä»¤åç¡®å°è·åå°æåºæåçæ°æ®ã\n\nåè®¾è¶æ°çè¯è®ºæéè¶å¤§ï¼ç®åææ°è¯è®ºçæéæ¯ Nï¼æä»¬æ§è¡ä¸é¢çå½ä»¤æ¶ï¼å°±å¯ä»¥è·å¾ææ°ç10æ¡è¯è®ºï¼\n\nZRANGEBYSCORE comments N-9 N\n\n\n1\n\n\næä»¥ï¼å¨é¢å¯¹éè¦å±ç¤ºææ°åè¡¨ãæè¡æ¦ç­åºæ¯æ¶ï¼å¦ææ°æ®æ´æ°é¢ç¹æèéè¦åé¡µæ¾ç¤ºï¼å»ºè®®ä½ ä¼åèèä½¿ç¨ Sorted Setã\n\n> Sorted Set å¯ä»¥æ ¹æ®æéæ¥è¿è¡æåºï¼ä½ List åªè½æ ¹æ®ç´¢å¼è·å¾å¼ï¼æå¢å åç´ æ¶ï¼Sorted Set è¿æ¯å¯ä»¥ç±æéå¾å°æ­£ç¡®çå¼ï¼ä½ List ä¸è¡ã\n\n\n# 2.3 äºå¼ç¶æç»è®¡ ââ Bitmap\n\näºå¼ç¶æå°±æ¯æéååç´ çåå¼å°±åªæ 0 å 1 ä¸¤ç§ãæ¯å¦å¨ç­¾å°æå¡çåºæ¯ä¸­ï¼åªç¨è®°å½ç­¾å°ï¼1ï¼ææªç­¾å°ï¼0ï¼ï¼æä»¥è¿å°±æ¯éå¸¸å¸åçäºå¼ç¶æã\n\nå¨ç­¾å°ç»è®¡æ¶ï¼æ¯ä¸ªç¨æ·ä¸å¤©çç­¾å°ç¨ 1 ä¸ª bit ä½å°±è½è¡¨ç¤ºï¼ä¸ä¸ªæï¼åè®¾æ¯31å¤©ï¼çç­¾å°æåµç¨ 31 ä¸ª bit ä½å°±å¯ä»¥ï¼èä¸å¹´çç­¾å°ä¹åªéè¦ç¨ 365 ä¸ª bit ä½ï¼æ ¹æ¬ä¸ç¨å¤ªå¤æçéåç±»åãè¿ä¸ªæ¶åï¼æä»¬å°±å¯ä»¥éæ© Bitmapãè¿æ¯Redisæä¾çæ©å±æ°æ®ç±»åãæ¥ä¸æ¥ä»ç» Bitmap çå®ç°åçã\n\nBitmap æ¬èº«æ¯ç¨ String ç±»åä½ä¸ºåºå±æ°æ®ç»æå®ç°çä¸ç§ç»è®¡äºå¼ç¶æçæ°æ®ç±»åãString ç±»åæ¯ä¼ä¿å­ä¸ºäºè¿å¶çå­èæ°ç»ï¼æä»¥ï¼Redis å°±æå­èæ°ç»çæ¯ä¸ª bit ä½å©ç¨èµ·æ¥ï¼ç¨æ¥è¡¨ç¤ºä¸ä¸ªåç´ çäºå¼ç¶æãä½ å¯ä»¥æ Bitmap çä½æ¯ä¸ä¸ª bit æ°ç»ã\n\nBitmap æä¾äº GETBIT/SETBIT æä½ï¼ä½¿ç¨ä¸ä¸ªåç§»å¼ offset å¯¹ bit æ°ç»çæä¸ä¸ª bit ä½è¿è¡è¯»ååãä¸è¿ï¼éè¦æ³¨æçæ¯ï¼Bitmap ç offset æ¯ä» 0 å¼å§ç®çï¼ä¹å°±æ¯è¯´offsetçæå°å¼æ¯0ãå½ä½¿ç¨SETBITå¯¹ä¸ä¸ªbitä½è¿è¡åæä½æ¶ï¼è¿ä¸ªbitä½ä¼è¢«è®¾ç½®ä¸º1ãBitmap è¿æä¾äº BITCOUNT æä½ï¼ç¨æ¥ç»è®¡è¿ä¸ªbitæ°ç»ä¸­ææâ1âçä¸ªæ°ã\n\né£ä¹ï¼å·ä½è¯¥æä¹ç¨ Bitmap è¿è¡ç­¾å°ç»è®¡å¢ï¼æè¿æ¯åå©ä¸ä¸ªå·ä½çä¾å­æ¥è¯´æãåè®¾æä»¬è¦ç»è®¡ ID 3000 çç¨æ·å¨2020å¹´8æä»½çç­¾å°æåµï¼å°±å¯ä»¥æç§ä¸é¢çæ­¥éª¤è¿è¡æä½ï¼\n\n 1. æ§è¡ä¸é¢çå½ä»¤ï¼è®°å½è¯¥ç¨æ·8æ3å·å·²ç­¾å°ï¼\n\nSETBIT uid:sign:3000:202008 2 1\n\n\n1\n\n\n> ä¸è¿°å½ä»¤ä¸­ç 2 è¡¨ç¤º 8 æçç¬¬ä¸å¤©ã\n\n 2. æ£æ¥è¯¥ç¨æ·8æ3æ¥æ¯å¦ç­¾å°ï¼\n\nGETBIT uid:sign:3000:202008 2\n\n\n1\n\n 3. ç»è®¡è¯¥ç¨æ·å¨8æä»½çç­¾å°æ¬¡æ°ï¼\n\nBITCOUNT uid:sign:3000:202008\n\n\n1\n\n\nè¿æ ·ï¼æä»¬å°±ç¥éè¯¥ç¨æ·å¨8æä»½çç­¾å°æåµäºï¼æ¯ä¸æ¯å¾ç®åå¢ï¼æ¥ä¸æ¥ï¼ä½ å¯ä»¥åæèä¸ä¸ªé®é¢ï¼å¦æè®°å½äº1äº¿ä¸ªç¨æ·10å¤©çç­¾å°æåµï¼ä½ æåæ³ç»è®¡åºè¿10å¤©è¿ç»­ç­¾å°çç¨æ·æ»æ°åï¼\n\nå¨ä»ç»å·ä½çæ¹æ³ä¹åï¼æä»¬è¦åç¥éï¼Bitmapæ¯æç¨ BITOP å½ä»¤å¯¹å¤ä¸ªBitmapæä½åâä¸âãâæâãâå¼æâçæä½ï¼æä½çç»æä¼ä¿å­å°ä¸ä¸ªæ°çBitmapä¸­ãæ¯å¦ä¸å¾å¯¹ä¸ä¸ª bitmap å AND æä½ï¼\n\nåå°ååçé®é¢ï¼å¨ç»è®¡1äº¿ä¸ªç¨æ·è¿ç»­10å¤©çç­¾å°æåµæ¶ï¼ä½ å¯ä»¥ææ¯å¤©çæ¥æä½ä¸ºkeyï¼æ¯ä¸ªkeyå¯¹åºä¸ä¸ª1äº¿ä½çBitmapï¼æ¯ä¸ä¸ªbitå¯¹åºä¸ä¸ªç¨æ·å½å¤©çç­¾å°æåµã\n\næ¥ä¸æ¥ï¼æä»¬å¯¹10ä¸ªBitmapåâä¸âæä½ï¼å¾å°çç»æä¹æ¯ä¸ä¸ªBitmapãå¨è¿ä¸ªBitmapä¸­ï¼åªæ10å¤©é½ç­¾å°çç¨æ·å¯¹åºçbitä½ä¸çå¼æä¼æ¯1ãæåï¼æä»¬å¯ä»¥ç¨BITCOUNTç»è®¡ä¸Bitmapä¸­ç1çä¸ªæ°ï¼è¿å°±æ¯è¿ç»­ç­¾å°10å¤©çç¨æ·æ»æ°äºã\n\nç°å¨ï¼æä»¬å¯ä»¥è®¡ç®ä¸ä¸è®°å½äº10å¤©ç­¾å°æåµåçåå­å¼éãæ¯å¤©ä½¿ç¨1ä¸ª1äº¿ä½çBitmapï¼å¤§çº¦å 12MBçåå­ï¼10^8/8/1024/1024ï¼ï¼10å¤©çBitmapçåå­å¼éçº¦ä¸º120MBï¼åå­ååä¸ç®å¤ªå¤§ãä¸è¿ï¼å¨å®éåºç¨æ¶ï¼æå¥½å¯¹Bitmapè®¾ç½®è¿ææ¶é´ï¼è®©Redisèªå¨å é¤ä¸åéè¦çç­¾å°è®°å½ï¼ä»¥èçåå­å¼éã\n\næä»¥ï¼å¦æåªéè¦ç»è®¡æ°æ®çäºå¼ç¶æï¼ä¾å¦ååææ²¡æãç¨æ·å¨ä¸å¨ç­ï¼å°±å¯ä»¥ä½¿ç¨ Bitmapï¼å ä¸ºå®åªç¨ä¸ä¸ªbitä½å°±è½è¡¨ç¤º0æ1ãå¨è®°å½æµ·éæ°æ®æ¶ï¼Bitmapè½å¤ææå°èçåå­ç©ºé´ã\n\n\n# 2.4 åºæ°ç»è®¡ ââ HyperLogLog\n\nåºæ°ç»è®¡å°±æ¯æç»è®¡ä¸ä¸ªéåä¸­ä¸éå¤çåç´ ä¸ªæ°ãæ¯å¦æä»¬ç»è®¡ä¸ä¸ªç½é¡µçç¬ç«è®¿å®¢ï¼Unique Visitorï¼UVï¼éãUV çç»è®¡æä¸ªç¬ç¹çå°æ¹ï¼éè¦å»éï¼ä¸ä¸ªç¨æ·ä¸å¤©åçå¤æ¬¡è®¿é®åªè½ç®ä½ä¸æ¬¡ã\n\nå¨Redisçéåç±»åä¸­ï¼Setç±»åé»è®¤æ¯æå»éï¼æä»¥çå°æå»ééæ±æ¶ï¼æä»¬å¯è½ç¬¬ä¸æ¶é´å°±ä¼æ³å°ç¨Setç±»åãæä»¬æ¥ç»åä¸ä¸ªä¾å­çä¸çç¨Setçæåµï¼æä¸ä¸ªç¨æ·user1è®¿é®page1æ¶ï¼ä½ æè¿ä¸ªä¿¡æ¯å å°Setä¸­ï¼\n\nSADD page1:uv user1\n\n\n1\n\n\nç¨æ·1åæ¥è®¿é®æ¶ï¼Set çå»éåè½å°±ä¿è¯äºä¸ä¼éå¤è®°å½ç¨æ·1çè®¿é®æ¬¡æ°ï¼è¿æ ·ï¼ç¨æ·1å°±ç®æ¯ä¸ä¸ªç¬ç«è®¿å®¢ãå½ä½ éè¦ç»è®¡UVæ¶ï¼å¯ä»¥ç´æ¥ç¨SCARDå½ä»¤ï¼è¿ä¸ªå½ä»¤ä¼è¿åä¸ä¸ªéåä¸­çåç´ ä¸ªæ°ãä½æ¯ï¼å¦æpage1éå¸¸ç«çï¼UVè¾¾å°äºåä¸æ¶ï¼ä¸ä¸ªSetå°±è¦è®°å½åä¸ä¸ªç¨æ·IDãå¯¹äºä¸ä¸ªæå¤§ä¿ççµåç½ç«èè¨ï¼è¿æ ·çé¡µé¢å¯è½ææåä¸ä¸ä¸ªï¼å¦ææ¯ä¸ªé¡µé¢é½ç¨è¿æ ·çä¸ä¸ªSetï¼å°±ä¼æ¶èå¾å¤§çåå­ç©ºé´ã\n\nå½ç¶ï¼ä½ ä¹å¯ä»¥ç¨ Hash ç±»åè®°å½ UVãä¾å¦ï¼ä½ å¯ä»¥æç¨æ·IDä½ä¸ºHashéåçkeyï¼å½ç¨æ·è®¿é®é¡µé¢æ¶ï¼å°±ç¨HSETå½ä»¤ï¼ç¨äºè®¾ç½®Hashéååç´ çå¼ï¼ï¼å¯¹è¿ä¸ªç¨æ·IDè®°å½ä¸ä¸ªå¼â1âï¼è¡¨ç¤ºä¸ä¸ªç¬ç«è®¿å®¢ï¼ç¨æ·1è®¿é®page1åï¼æä»¬å°±è®°å½ä¸º1ä¸ªç¬ç«è®¿å®¢ï¼å¦ä¸æç¤ºï¼\n\nHSET page1:uv user1 1\n\n\n1\n\n\nå³ä½¿ç¨æ·1å¤æ¬¡è®¿é®é¡µé¢ï¼éå¤æ§è¡è¿ä¸ªHSETå½ä»¤ï¼ä¹åªä¼æuser1çå¼è®¾ç½®ä¸º1ï¼ä»ç¶åªè®°ä¸º1ä¸ªç¬ç«è®¿å®¢ãå½è¦ç»è®¡ UV æ¶ï¼æä»¬å¯ä»¥ç¨ HLEN å½ä»¤ç»è®¡ Hash éåä¸­çææåç´ ä¸ªæ°ã\n\nä½æ¯ï¼åSetç±»åç¸ä¼¼ï¼å½é¡µé¢å¾å¤æ¶ï¼Hashç±»åä¹ä¼æ¶èå¾å¤§çåå­ç©ºé´ãé£ä¹ï¼æä»ä¹åæ³æ¢è½å®æç»è®¡ï¼è¿è½èçåå­åï¼è¿æ¶åï¼å°±è¦ç¨å°Redisæä¾ç HyperLogLog äºã\n\nHyperLogLog æ¯ä¸ç§ç¨äºç»è®¡åºæ°çæ°æ®éåç±»åï¼å®çæå¤§ä¼å¿å°±å¨äºï¼å½éååç´ æ°ééå¸¸å¤æ¶ï¼å®è®¡ç®åºæ°æéçç©ºé´æ»æ¯åºå®çï¼èä¸è¿å¾å°ãå¨Redisä¸­ï¼æ¯ä¸ª HyperLogLog åªéè¦è±è´¹ 12 KB åå­ï¼å°±å¯ä»¥è®¡ç®æ¥è¿ 2^64 ä¸ªåç´ çåºæ°ãä½ çï¼ååç´ è¶å¤å°±è¶èè´¹åå­çSetåHashç±»åç¸æ¯ï¼HyperLogLog å°±éå¸¸èçç©ºé´ã\n\nå¨ç»è®¡ UV æ¶ï¼ä½ å¯ä»¥ç¨ PFADD å½ä»¤ï¼ç¨äºå HyperLogLog ä¸­æ·»å æ°åç´ ï¼æè®¿é®é¡µé¢çæ¯ä¸ªç¨æ·é½æ·»å å° HyperLogLog ä¸­ï¼\n\nPFADD page1:uv user1 user2 user3 user4 user5\n\n\n1\n\n\næ¥ä¸æ¥ï¼å°±å¯ä»¥ç¨ PFCOUNT å½ä»¤ ç´æ¥è·å¾ page1 ç UV å¼äºï¼è¿ä¸ªå½ä»¤çä½ç¨å°±æ¯è¿å HyperLogLog çç»è®¡ç»æï¼\n\nPFCOUNT page1:uv\n\n\n1\n\n\n> å³äº HyperLogLog çå·ä½å®ç°åçï¼ä½ ä¸éè¦éç¹ææ¡ï¼ä¸ä¼å½±åå°ä½ çæ¥å¸¸ä½¿ç¨ãæ³è¦æ´å¤äºè§£çè¯ï¼å¯ä»¥åèè¿æ¡é¾æ¥ã\n\nä¸è¿ï¼æä¸ç¹éè¦ä½ æ³¨æä¸ä¸ï¼HyperLogLog çç»è®¡è§åæ¯åºäºæ¦çå®æçï¼æä»¥å®ç»åºçç»è®¡ç»ææ¯æä¸å®è¯¯å·®çï¼æ åè¯¯ç®çæ¯ 0.81%ãè¿ä¹å°±æå³çï¼ä½ ä½¿ç¨ HyperLogLog ç»è®¡ç UV æ¯ 100 ä¸ï¼ä½å®éç UV å¯è½æ¯ 101 ä¸ãè½ç¶è¯¯å·®çä¸ç®å¤§ï¼ä½æ¯ï¼å¦æä½ éè¦ç²¾ç¡®ç»è®¡ç»æçè¯ï¼æå¥½è¿æ¯ç»§ç»­ç¨ Set æ Hash ç±»åã\n\n\n# 2.5 å°ç»\n\nè¿ä¸å¤§èéå¯¹èåç»è®¡ãæåºç»è®¡ãäºå¼ç¶æç»è®¡ååºæ°ç»è®¡åç§åºæ¯è®²è§£äºå¤ä¸ªæ°æ®ç»æï¼æ±æ»å¦ä¸ï¼\n\nå¯ä»¥çå°ï¼\n\n * SetåSorted Seté½æ¯æå¤ç§èåç»è®¡ï¼ä¸è¿ï¼å¯¹äºå·®éè®¡ç®æ¥è¯´ï¼åªæSetæ¯æãBitmapä¹è½åå¤ä¸ªBitmapé´çèåè®¡ç®ï¼åæ¬ä¸ãæåå¼ææä½ã\n * å½éè¦è¿è¡æåºç»è®¡æ¶ï¼Listä¸­çåç´ è½ç¶æåºï¼ä½æ¯ä¸æ¦ææ°åç´ æå¥ï¼åæ¥çåç´ å¨Listä¸­çä½ç½®å°±ä¼ç§»å¨ï¼é£ä¹ï¼æä½ç½®è¯»åçæåºç»æå¯è½å°±ä¸åç¡®äºãèSorted Setæ¬èº«æ¯æç§éååç´ çæéæåºï¼å¯ä»¥åç¡®å°æåºè·åç»æï¼æä»¥å»ºè®®ä½ ä¼åä½¿ç¨å®ã\n * å¦ææä»¬è®°å½çæ°æ®åªæ0å1ä¸¤ä¸ªå¼çç¶æï¼Bitmapä¼æ¯ä¸ä¸ªå¾å¥½çéæ©ï¼è¿ä¸»è¦å½åäºBitmapå¯¹äºä¸ä¸ªæ°æ®åªç¨1ä¸ªbitè®°å½ï¼å¯ä»¥èçåå­ã\n * å¯¹äºåºæ°ç»è®¡æ¥è¯´ï¼å¦æéååç´ éè¾¾å°äº¿çº§å«èä¸ä¸éè¦ç²¾ç¡®ç»è®¡æ¶ï¼æå»ºè®®ä½ ä½¿ç¨HyperLogLogã\n\nå½ç¶ï¼Redisçåºç¨åºæ¯éå¸¸å¤ï¼è¿å¼ è¡¨ä¸­çæ»ç»ä¸ä¸å®è½è¦çå°ææåºæ¯ãæå»ºè®®ä½ ä¹è¯çèªå·±ç»ä¸å¼ è¡¨ï¼æä½ éå°çå¶ä»åºæ¯æ·»å è¿å»ãé¿ä¹ç§¯ç´¯ä¸æ¥ï¼ä½ ä¸å®è½å¤æ´å çµæ´»å°æéåç±»ååºç¨å°åéçå®è·µé¡¹ç®ä¸­ã\n\n\n# 3. GEO æ¯ä»ä¹ï¼è¿å¯ä»¥å®ä¹æ°çæ°æ®ç±»ååï¼\n\næä»¬ä¹åå­¦ä¹ äº Redis ç 5 å¤§åºæ¬æ°æ®ç±»åï¼StringãListãHashãSet å Sorted Setãå¨é¢å¯¹ä¸äºç¹æ®åºæ¯æ¶ï¼è¿äºç±»åæ æ³å¾å¥½å°æ¯æï¼äºæ¯ Redis è¿æä¾äº 3 ç§æ©å±ç±»åï¼BitmapãHyperLogLog å GEOãè¿ä¸èä¸»è¦è®²ä¸ä¸ GEOã\n\nå¦å¤èè¿è®²ä»ç»å¼åèªå®ä¹çæ°æ°æ®ç±»åçåºæ¬æ­¥éª¤ï¼ä»èæ»¡è¶³ä¸ªäººçç¹æ®éæ±ã\n\n\n# 3.1 é¢å LBS åºç¨ç GEO ç±»å\n\næ¥å¸¸çå°å¾æç´¢ãæè½¦ç­é½ç¦»ä¸å¼åºäºä½ç½®ä¿¡æ¯æå¡ï¼Location-Based Serviceï¼LBSï¼çåºç¨ãLBS åºç¨è®¿é®çæ°æ®æ¯åäººæç©å³èçä¸ç»ç»çº¬åº¦ä¿¡æ¯ï¼èä¸è¦è½æ¥è¯¢ç¸é»çç»çº¬åº¦èå´ï¼GEO å°±éå¸¸éååºç¨å¨ LBS æå¡çåºæ¯ä¸­ï¼æä»¬æ¥çä¸ä¸å®çåºå±ç»æã\n\n# 3.1.1 GEO çåºå±ç»æ\n\nä¸è¬æ¥è¯´ï¼å¨è®¾è®¡ä¸ä¸ªæ°æ®ç±»åçåºå±ç»ææ¶ï¼æä»¬é¦åéè¦ç¥éï¼è¦å¤ççæ°æ®æä»ä¹è®¿é®ç¹ç¹ãæä»¥ï¼æä»¬éè¦åææ¸æ¥ä½ç½®ä¿¡æ¯å°åºæ¯æä¹è¢«å­åçã\n\nä»¥å«è½¦æå¡ä¸ºä¾ï¼æ¥åæä¸ LBS åºç¨ä¸­ç»çº¬åº¦çå­åç¹ç¹ï¼\n\n 1. æ¯ä¸è¾ç½çº¦è½¦é½æä¸ä¸ªç¼å·ï¼ä¾å¦33ï¼ï¼ç½çº¦è½¦éè¦å°èªå·±çç»åº¦ä¿¡æ¯ï¼ä¾å¦116.034579ï¼åçº¬åº¦ä¿¡æ¯ï¼ä¾å¦39.000452 ï¼åç»å«è½¦åºç¨ã\n 2. ç¨æ·å¨å«è½¦çæ¶åï¼å«è½¦åºç¨ä¼æ ¹æ®ç¨æ·çç»çº¬åº¦ä½ç½®ï¼ä¾å¦ç»åº¦116.054579ï¼çº¬åº¦39.030452ï¼ï¼æ¥æ¾ç¨æ·çéè¿è½¦è¾ï¼å¹¶è¿è¡å¹éã\n 3. ç­æä½ç½®ç¸è¿çç¨æ·åè½¦è¾å¹éä¸ä»¥åï¼å«è½¦åºç¨å°±ä¼æ ¹æ®è½¦è¾çç¼å·ï¼è·åè½¦è¾çä¿¡æ¯ï¼å¹¶è¿åç»ç¨æ·ã\n\n----------------------------------------\n\nèè Hash Set ç±»åï¼\n\nå¯ä»¥çå°ï¼ä¸è¾è½¦ï¼æä¸ä¸ªç¨æ·ï¼å¯¹åºä¸ç»ç»çº¬åº¦ï¼å¹¶ä¸éçè½¦ï¼æç¨æ·ï¼çä½ç½®ç§»å¨ï¼ç¸åºçç»çº¬åº¦ä¹ä¼ååãè¿ç§æ°æ®è®°å½æ¨¡å¼å±äºä¸ä¸ªkeyï¼ä¾å¦è½¦IDï¼å¯¹åºä¸ä¸ªvalueï¼ä¸ç»ç»çº¬åº¦ï¼ãå½æå¾å¤è½¦è¾ä¿¡æ¯è¦ä¿å­æ¶ï¼å°±éè¦æä¸ä¸ªéåæ¥ä¿å­ä¸ç³»åçkeyåvalueãHashéåç±»åå¯ä»¥å¿«éå­åä¸ç³»åçkeyåvalueï¼æ­£å¥½å¯ä»¥ç¨æ¥è®°å½ä¸ç³»åè½¦è¾IDåç»çº¬åº¦çå¯¹åºå³ç³»ï¼æä»¥ï¼æä»¬å¯ä»¥æä¸åè½¦è¾çIDåå®ä»¬å¯¹åºçç»çº¬åº¦ä¿¡æ¯å­å¨Hashéåä¸­ï¼å¦ä¸å¾æç¤ºï¼\n\nåæ¶ï¼Hashç±»åçHSETæä½å½ä»¤ï¼ä¼æ ¹æ®keyæ¥è®¾ç½®ç¸åºçvalueå¼ï¼æä»¥ï¼æä»¬å¯ä»¥ç¨å®æ¥å¿«éå°æ´æ°è½¦è¾ååçç»çº¬åº¦ä¿¡æ¯ãå°è¿éï¼Hashç±»åçèµ·æ¥æ¯ä¸ä¸ªä¸éçéæ©ãä½é®é¢æ¯ï¼å¯¹äºä¸ä¸ªLBSåºç¨æ¥è¯´ï¼é¤äºè®°å½ç»çº¬åº¦ä¿¡æ¯ï¼è¿éè¦æ ¹æ®ç¨æ·çç»çº¬åº¦ä¿¡æ¯å¨è½¦è¾çHashéåä¸­è¿è¡èå´æ¥è¯¢ã\n\nä¸æ¦æ¶åå°èå´æ¥è¯¢ï¼å°±æå³çéåä¸­çåç´ éè¦æåºï¼ä½Hashç±»åçåç´ æ¯æ åºçï¼æ¾ç¶ä¸è½æ»¡è¶³æä»¬çè¦æ±ã\n\n----------------------------------------\n\nèè Sorted Set ç±»åï¼\n\næä»¬åæ¥ççä½¿ç¨ Sorted Setç±»åæ¯ä¸æ¯åéã\n\nSorted Set ç±»åä¹æ¯æä¸ä¸ª key å¯¹åºä¸ä¸ª value çè®°å½æ¨¡å¼ï¼å¶ä¸­ï¼keyå°±æ¯Sorted Setä¸­çåç´ ï¼èvalueåæ¯åç´ çæéåæ°ãæ´éè¦çæ¯ï¼Sorted Setå¯ä»¥æ ¹æ®åç´ çæéåæ°æåºï¼æ¯æèå´æ¥è¯¢ãè¿å°±è½æ»¡è¶³LBSæå¡ä¸­æ¥æ¾ç¸é»ä½ç½®çéæ±äºã\n\nå®éä¸ï¼GEO ç±»åçåºå±æ°æ®ç»æå°±æ¯ç¨ Sorted Set æ¥å®ç°çãå±ä»¬è¿æ¯åçå«è½¦åºç¨çä¾å­æ¥å æ·±ä¸çè§£ãç¨Sorted Setæ¥ä¿å­è½¦è¾çç»çº¬åº¦ä¿¡æ¯æ¶ï¼Sorted Setçåç´ æ¯è½¦è¾IDï¼åç´ çæéåæ°æ¯ç»çº¬åº¦ä¿¡æ¯ï¼å¦ä¸å¾æç¤ºï¼\n\nè¿æ¶é®é¢æ¥äºï¼Sorted Setåç´ çæéåæ°æ¯ä¸ä¸ªæµ®ç¹æ°ï¼floatç±»åï¼ï¼èä¸ç»ç»çº¬åº¦åå«çæ¯ç»åº¦åçº¬åº¦ä¸¤ä¸ªå¼ï¼æ¯æ²¡æ³ç´æ¥ä¿å­ä¸ºä¸ä¸ªæµ®ç¹æ°çï¼é£å·ä½è¯¥æä¹è¿è¡ä¿å­å¢ï¼è¿å°±è¦ç¨å° GEO ç±»åä¸­ç GeoHash ç¼ç äºã\n\n# 3.1.2 GeoHash çç¼ç æ¹æ³\n\nä¸ºäºè½é«æå°å¯¹ç»çº¬åº¦è¿è¡æ¯è¾ï¼Redis éç¨äºä¸çå¹¿æ³ä½¿ç¨ç GeoHash ç¼ç æ¹æ³ï¼è¿ä¸ªæ¹æ³çåºæ¬åçå°±æ¯âäºååºé´ï¼åºé´ç¼ç âã\n\nå½æä»¬è¦å¯¹ä¸ç»ç»çº¬åº¦è¿è¡ GeoHash ç¼ç æ¶ï¼æä»¬è¦åå¯¹ç»åº¦åçº¬åº¦åå«ç¼ç ï¼ç¶ååæç»çº¬åº¦åèªçç¼ç ç»åæä¸ä¸ªæç»ç¼ç ã\n\né¦åï¼æä»¬æ¥çä¸ç»åº¦åçº¬åº¦çåç¬ç¼ç è¿ç¨ã\n\nå¯¹äºä¸ä¸ªå°çä½ç½®ä¿¡æ¯æ¥è¯´ï¼å®çç»åº¦èå´æ¯ [-180,180] ãGeoHash ç¼ç ä¼æä¸ä¸ªç»åº¦å¼ç¼ç æä¸ä¸ª N ä½çäºè¿å¶å¼ï¼æä»¬æ¥å¯¹ç»åº¦èå´ [-180,180] åNæ¬¡çäºååºæä½ï¼å¶ä¸­ N å¯ä»¥èªå®ä¹ã\n\n * å¨è¿è¡ç¬¬ä¸æ¬¡äºååºæ¶ï¼ç»åº¦èå´[-180,180]ä¼è¢«åæä¸¤ä¸ªå­åºé´ï¼[-180,0)å[0,180]ï¼æç§°ä¹ä¸ºå·¦ãå³ååºï¼ãæ­¤æ¶ï¼æä»¬å¯ä»¥æ¥çä¸ä¸è¦ç¼ç çç»åº¦å¼è½å¨äºå·¦ååºè¿æ¯å³ååºãå¦ææ¯è½å¨å·¦ååºï¼æä»¬å°±ç¨0è¡¨ç¤ºï¼å¦æè½å¨å³ååºï¼å°±ç¨1è¡¨ç¤ºãè¿æ ·ä¸æ¥ï¼æ¯åå®ä¸æ¬¡äºååºï¼æä»¬å°±å¯ä»¥å¾å°1ä½ç¼ç å¼ã\n * ç¶åï¼æä»¬åå¯¹ç»åº¦å¼æå±çååºååä¸æ¬¡äºååºï¼åæ¶åæ¬¡æ¥çç»åº¦å¼è½å¨äºäºååºåçå·¦ååºè¿æ¯å³ååºï¼æç§åæçè§ååå1ä½ç¼ç ãå½åå®Næ¬¡çäºååºåï¼ç»åº¦å¼å°±å¯ä»¥ç¨ä¸ä¸ªN bitçæ°æ¥è¡¨ç¤ºäºã\n\nä¸¾ä¸ªä¾å­ï¼åè®¾æä»¬è¦ç¼ç çç»åº¦å¼æ¯116.37ï¼æä»¬ç¨5ä½ç¼ç å¼ï¼ä¹å°±æ¯N=5ï¼å5æ¬¡ååºï¼ãæä»¬ååç¬¬ä¸æ¬¡äºååºæä½ï¼æç»åº¦åºé´[-180,180]åæäºå·¦ååº[-180,0)åå³ååº[0,180]ï¼æ­¤æ¶ï¼ç»åº¦å¼116.37æ¯å±äºå³ååº[0,180]ï¼æä»¥ï¼æä»¬ç¨1è¡¨ç¤ºç¬¬ä¸æ¬¡äºååºåçç¼ç å¼ãæ¥ä¸æ¥ï¼æä»¬åç¬¬äºæ¬¡äºååºï¼æç»åº¦å¼116.37æå±ç[0,180]åºé´ï¼åæ[0,90)å[90, 180]ãæ­¤æ¶ï¼ç»åº¦å¼116.37è¿æ¯å±äºå³ååº[90,180]ï¼æä»¥ï¼ç¬¬äºæ¬¡ååºåçç¼ç å¼ä»ç¶ä¸º1ãç­å°ç¬¬ä¸æ¬¡å¯¹[90,180]è¿è¡äºååºï¼ç»åº¦å¼116.37è½å¨äºååºåçå·¦ååº[90, 135)ä¸­ï¼æä»¥ï¼ç¬¬ä¸æ¬¡ååºåçç¼ç å¼å°±æ¯0ã\n\næç§è¿ç§æ¹æ³ï¼åå®5æ¬¡ååºåï¼æä»¬æç»åº¦å¼116.37å®ä½å¨[112.5, 123.75]è¿ä¸ªåºé´ï¼å¹¶ä¸å¾å°äºç»åº¦å¼ç5ä½ç¼ç å¼ï¼å³11010ãè¿ä¸ªç¼ç è¿ç¨å¦ä¸è¡¨æç¤ºï¼\n\nå¯¹çº¬åº¦çç¼ç æ¹å¼ï¼åå¯¹ç»åº¦çä¸æ ·ï¼åªæ¯çº¬åº¦çèå´æ¯[-90ï¼90]ï¼ä¸é¢è¿å¼ è¡¨æ¾ç¤ºäºå¯¹çº¬åº¦å¼39.86çç¼ç è¿ç¨ï¼\n\nå½ä¸ç»ç»çº¬åº¦å¼é½ç¼å®ç åï¼æä»¬åæå®ä»¬çåèªç¼ç å¼ç»åå¨ä¸èµ·ï¼ç»åçè§åæ¯ï¼æç»ç¼ç å¼çå¶æ°ä½ä¸ä¾æ¬¡æ¯ç»åº¦çç¼ç å¼ï¼å¥æ°ä½ä¸ä¾æ¬¡æ¯çº¬åº¦çç¼ç å¼ï¼å¶ä¸­ï¼å¶æ°ä½ä»0å¼å§ï¼å¥æ°ä½ä»1å¼å§ã\n\næä»¬ååè®¡ç®çç»çº¬åº¦ï¼116.37ï¼39.86ï¼çåèªç¼ç å¼æ¯11010å10111ï¼ç»åä¹åï¼ç¬¬0ä½æ¯ç»åº¦çç¬¬0ä½1ï¼ç¬¬1ä½æ¯çº¬åº¦çç¬¬0ä½1ï¼ç¬¬2ä½æ¯ç»åº¦çç¬¬1ä½1ï¼ç¬¬3ä½æ¯çº¬åº¦çç¬¬1ä½0ï¼ä»¥æ­¤ç±»æ¨ï¼å°±è½å¾å°æç»ç¼ç å¼1110011101ï¼å¦ä¸å¾æç¤ºï¼\n\nç¨äº GeoHash ç¼ç åï¼åæ¥æ æ³ç¨ä¸ä¸ªæéåæ°è¡¨ç¤ºçä¸ç»ç»çº¬åº¦ï¼116.37ï¼39.86ï¼å°±å¯ä»¥ç¨1110011101è¿ä¸ä¸ªå¼æ¥è¡¨ç¤ºï¼å°±å¯ä»¥ä¿å­ä¸º Sorted Set çæéåæ°äºã\n\nå½ç¶ï¼ä½¿ç¨ GeoHash ç¼ç åï¼æä»¬ç¸å½äºææ´ä¸ªå°çç©ºé´ååæäºä¸ä¸ªä¸ªæ¹æ ¼ï¼æ¯ä¸ªæ¹æ ¼å¯¹åºäº GeoHash ä¸­çä¸ä¸ªååºã\n\nä¸¾ä¸ªä¾å­ãæä»¬æç»åº¦åºé´[-180,180]åä¸æ¬¡äºååºï¼æçº¬åº¦åºé´[-90,90]åä¸æ¬¡äºååºï¼å°±ä¼å¾å°4ä¸ªååºãæä»¬æ¥çä¸å®ä»¬çç»åº¦åçº¬åº¦èå´ä»¥åå¯¹åºçGeoHashç»åç¼ç ã\n\n * ååºä¸ï¼[-180,0)å[-90,0)ï¼ç¼ç 00ï¼\n * ååºäºï¼[-180,0)å[0,90]ï¼ç¼ç 01ï¼\n * ååºä¸ï¼[0,180]å[-90,0)ï¼ç¼ç 10ï¼\n * ååºåï¼[0,180]å[0,90]ï¼ç¼ç 11ã\n\nè¿4ä¸ªååºå¯¹åºäº4ä¸ªæ¹æ ¼ï¼æ¯ä¸ªæ¹æ ¼è¦çäºä¸å®èå´åçç»çº¬åº¦å¼ï¼ååºè¶å¤ï¼æ¯ä¸ªæ¹æ ¼è½è¦çå°çå°çç©ºé´å°±è¶å°ï¼ä¹å°±è¶ç²¾åãæä»¬ææææ¹æ ¼çç¼ç å¼æ å°å°ä¸ç»´ç©ºé´æ¶ï¼ç¸é»æ¹æ ¼ç GeoHash ç¼ç å¼åºæ¬ä¹æ¯æ¥è¿çï¼å¦ä¸å¾æç¤ºï¼\n\næä»¥ï¼æä»¬ä½¿ç¨ Sorted Set èå´æ¥è¯¢å¾å°çç¸è¿ç¼ç å¼ï¼å¨å®éçå°çç©ºé´ä¸ï¼ä¹æ¯ç¸é»çæ¹æ ¼ï¼è¿å°±å¯ä»¥å®ç°LBSåºç¨âæç´¢éè¿çäººæç©âçåè½äºã\n\nä¸è¿è¦æ³¨æï¼æçç¼ç å¼è½ç¶å¨å¤§å°ä¸æ¥è¿ï¼ä½å®éå¯¹åºçæ¹æ ¼å´è·ç¦»æ¯è¾è¿ãä¾å¦ï¼æä»¬ç¨4ä½æ¥åGeoHashç¼ç ï¼æç»åº¦åºé´[-180,180]åçº¬åº¦åºé´[-90,90]ååæäº4ä¸ªååºï¼ä¸å±16ä¸ªååºï¼å¯¹åºäº16ä¸ªæ¹æ ¼ãç¼ç å¼ä¸º0111å1000çä¸¤ä¸ªæ¹æ ¼å°±ç¦»å¾æ¯è¾è¿ï¼å¦ä¸å¾æç¤ºï¼\n\næä»¥ï¼ä¸ºäºé¿åæ¥è¯¢ä¸åç¡®é®é¢ï¼æä»¬å¯ä»¥åæ¶æ¥è¯¢ç»å®ç»çº¬åº¦æå¨çæ¹æ ¼å¨å´ç4ä¸ªæ8ä¸ªæ¹æ ¼ã\n\næ»ç»ä¸ä¸ï¼GEO ç±»åæ¯æç»çº¬åº¦æå¨çåºé´ç¼ç ä½ä¸ºSorted Setä¸­åç´ çæéåæ°ï¼æåç»çº¬åº¦ç¸å³çè½¦è¾ ID ä½ä¸º Sorted Set ä¸­åç´ æ¬èº«çå¼ä¿å­ä¸æ¥ï¼è¿æ ·ç¸é»ç»çº¬åº¦çæ¥è¯¢å°±å¯ä»¥éè¿ç¼ç å¼çå¤§å°èå´æ¥è¯¢æ¥å®ç°äºãæ¥ä¸æ¥ï¼æä»¬åæ¥èèå·ä½å¦ä½æä½ GEO ç±»åã\n\n# 3.1.3 å¦ä½æä½ GEO ç±»åï¼\n\næä½ GEO ç±»åç»å¸¸ä½¿ç¨ä¸¤ä¸ªå½ä»¤ï¼\n\n * GEOADD å½ä»¤ï¼ç¨äºæä¸ç»ç»çº¬åº¦ä¿¡æ¯åç¸å¯¹åºçä¸ä¸ª ID è®°å½å° GEO ç±»åéåä¸­ï¼\n * GEORADIUS å½ä»¤ï¼ä¼æ ¹æ®è¾å¥çç»çº¬åº¦ä½ç½®ï¼æ¥æ¾ä»¥è¿ä¸ªç»çº¬åº¦ä¸ºä¸­å¿çä¸å®èå´åçå¶ä»åç´ ãå½ç¶ï¼æä»¬å¯ä»¥èªå·±å®ä¹è¿ä¸ªèå´ã\n\næè¿æ¯ä»¥âå«è½¦åºç¨âçè½¦è¾å¹éåºæ¯ä¸ºä¾ï¼ä»ç»ä¸å·ä½å¦ä½ä½¿ç¨è¿ä¸¤ä¸ªå½ä»¤ã\n\n----------------------------------------\n\nGEOADD å½ä»¤ï¼\n\nåè®¾è½¦è¾IDæ¯33ï¼ç»çº¬åº¦ä½ç½®æ¯ï¼116.034579ï¼39.030452ï¼ï¼æä»¬å¯ä»¥ç¨ä¸ä¸ª GEO éåä¿å­ææè½¦è¾çç»çº¬åº¦ï¼éå key æ¯ cars:locationsãæ§è¡ä¸é¢çè¿ä¸ªå½ä»¤ï¼å°±å¯ä»¥æ ID å·ä¸º 33 çè½¦è¾çå½åç»çº¬åº¦ä½ç½®å­å¥ GEO éåä¸­ï¼\n\nGEOADD cars:locations 116.034579 39.030452 33\n\n\n1\n\n\n----------------------------------------\n\nGEORADIUS å½ä»¤ï¼\n\nå½ç¨æ·æ³è¦å¯»æ¾èªå·±éè¿çç½çº¦è½¦æ¶ï¼LBS åºç¨å°±å¯ä»¥ä½¿ç¨ GEORADIUS å½ä»¤ï¼\n\nä¾å¦ï¼LBS åºç¨æ§è¡ä¸é¢çå½ä»¤æ¶ï¼Redis ä¼æ ¹æ®è¾å¥çç¨æ·çç»çº¬åº¦ä¿¡æ¯ï¼116.054579ï¼39.030452 ï¼ï¼æ¥æ¾ä»¥è¿ä¸ªç»çº¬åº¦ä¸ºä¸­å¿ç5å¬éåçè½¦è¾ä¿¡æ¯ï¼å¹¶è¿åç»LBSåºç¨ãå½ç¶ï¼ ä½ å¯ä»¥ä¿®æ¹â5âè¿ä¸ªåæ°ï¼æ¥è¿åæ´å¤§ææ´å°èå´åçè½¦è¾ä¿¡æ¯ã\n\nGEORADIUS cars:locations 116.054579 39.030452 5 km ASC COUNT 10\n\n\n1\n\n\nå¦å¤ï¼æä»¬è¿å¯ä»¥è¿ä¸æ­¥éå®è¿åçè½¦è¾ä¿¡æ¯ãæ¯å¦ï¼æä»¬å¯ä»¥ä½¿ç¨ASCéé¡¹ï¼è®©è¿åçè½¦è¾ä¿¡æ¯æç§è·ç¦»è¿ä¸ªä¸­å¿ä½ç½®ä»è¿å°è¿çæ¹å¼æ¥æåºï¼ä»¥æ¹ä¾¿éæ©æè¿çè½¦è¾ï¼è¿å¯ä»¥ä½¿ç¨COUNTéé¡¹ï¼æå®è¿åçè½¦è¾ä¿¡æ¯çæ°éãæ¯ç«ï¼5å¬éèå´åçè½¦è¾å¯è½æå¾å¤ï¼å¦æè¿åå¨é¨ä¿¡æ¯ï¼ä¼å ç¨æ¯è¾å¤çæ°æ®å¸¦å®½ï¼è¿ä¸ªéé¡¹å¯ä»¥å¸®å©æ§å¶è¿åçæ°æ®éï¼èçå¸¦å®½ã\n\nå¯ä»¥çå°ï¼ä½¿ç¨ GEO æ°æ®ç±»åå¯ä»¥éå¸¸è½»æ¾å°æä½ç»çº¬åº¦è¿ç§ä¿¡æ¯ã\n\nå°½ç®¡ Redis æå¦æ­¤å¤æ°æ®ç±»åï¼ä½æ¯æäºåºæ¯ä¸ï¼æä»¬å¯¹æ°æ®ç±»åä¼æç¹æ®éæ±ãæ¥ä¸æ¥å°±ä»ç» Redis çèªå®ä¹æ°æ®ç±»åãè¿æ ·ä½ å°±å¯ä»¥å®å¶ç¬¦åèªå·±éæ±çæ°æ®ç±»åäºã\n\n\n# 3.2 å¦ä½èªå®ä¹æ°æ®ç±»å\n\nä¸ºäºå®ç°èªå®ä¹æ°æ®ç±»åï¼é¦åï¼æä»¬éè¦äºè§£ Redis çåºæ¬å¯¹è±¡ç»æ RedisObjectï¼å ä¸º Redis é®å¼å¯¹ä¸­çæ¯ä¸ä¸ªå¼é½æ¯ç¨ RedisObject ä¿å­çã\n\n# 3.2.1 Redis çåºæ¬å¯¹è±¡ç»æï¼RedisObject\n\nRedisObject ä¸»è¦åæ¬åæ°æ®åæéï¼\n\n * åæ°æ®ä¸»è¦ç¨æ¥åºåä¸åçæ°æ®ç±»åï¼\n * æéç¨æ¥æåå·ä½çå¼ã\n\nå·ä½èè¨ï¼RedisObject åé¨åå«ï¼\n\n * typeï¼è¡¨ç¤ºå¼çç±»åï¼æ¶µçäºæä»¬åé¢å­¦ä¹ çäºå¤§åºæ¬ç±»åï¼\n * encodingï¼æ¯å¼çç¼ç æ¹å¼ï¼ç¨æ¥è¡¨ç¤ºRedisä¸­å®ç°åä¸ªåºæ¬ç±»åçåºå±æ°æ®ç»æï¼ä¾å¦SDSãåç¼©åè¡¨ãåå¸è¡¨ãè·³è¡¨ç­ï¼\n * lruï¼è®°å½äºè¿ä¸ªå¯¹è±¡æåä¸æ¬¡è¢«è®¿é®çæ¶é´ï¼ç¨äºæ·æ±°è¿æçé®å¼å¯¹ï¼\n * refcountï¼è®°å½äºå¯¹è±¡çå¼ç¨è®¡æ°ï¼\n * *ptrï¼æ¯æåæ°æ®çæéã\n\nRedisObjectç»æåå© *ptr æéï¼å°±å¯ä»¥æåä¸åçæ°æ®ç±»åï¼ä¾å¦ï¼ *ptr æåä¸ä¸ªSDSæä¸ä¸ªè·³è¡¨ï¼å°±è¡¨ç¤ºé®å¼å¯¹ä¸­çå¼æ¯Stringç±»åæSorted Setç±»åãæä»¥ï¼æä»¬å¨å®ä¹äºæ°çæ°æ®ç±»ååï¼ä¹åªè¦å¨RedisObjectä¸­è®¾ç½®å¥½æ°ç±»åçtypeåencodingï¼åç¨ *ptr æåæ°ç±»åçå®ç°ï¼å°±è¡äºã\n\n# 3.2.2 å¼åä¸ä¸ªæ°çæ°æ®ç±»å\n\näºè§£äº RedisObject ç»æåï¼å®ä¹ä¸ä¸ªæ°çæ°æ®ç±»åä¹å°±ä¸é¾äºãé¦åï¼æä»¬éè¦ä¸ºæ°æ°æ®ç±»åå®ä¹å¥½å®çåºå±ç»æãtype å encoding å±æ§å¼ï¼ç¶ååå®ç°æ°æ°æ®ç±»åçåå»ºãéæ¾å½æ°ååºæ¬å½ä»¤ã\n\næä»¥å¼åä¸ä¸ªåå­å«ä½ NewTypeObject çæ°æ°æ®ç±»åä¸ºä¾ï¼æ¥è§£éä¸å·ä½ç4ä¸ªæä½æ­¥éª¤ï¼\n\n----------------------------------------\n\nç¬¬ä¸æ­¥ï¼å®ä¹æ°æ°æ®ç±»åçåºå±ç»æ.\n\næä»¬ç¨ newtype.h æä»¶æ¥ä¿å­è¿ä¸ªæ°ç±»åçå®ä¹ï¼å·ä½å®ä¹çä»£ç å¦ä¸æç¤ºï¼\n\nstruct NewTypeObject {\n    struct NewTypeNode *head;\n    size_t len;\n} NewTypeObject;\n\n\n1\n2\n3\n4\n\n\nå¶ä¸­ï¼NewTypeNode ç»æå°±æ¯æä»¬èªå®ä¹çæ°ç±»åçåºå±ç»æãæä»¬ä¸ºåºå±ç»æè®¾è®¡ä¸¤ä¸ªæååéï¼ä¸ä¸ªæ¯Longç±»åçvalueå¼ï¼ç¨æ¥ä¿å­å®éæ°æ®ï¼ä¸ä¸ªæ¯ *next æéï¼æåä¸ä¸ä¸ª NewTypeNode ç»æã\n\nstruct NewTypeNode {\n    long value;\n    struct NewTypeNode *next;\n};\n\n\n1\n2\n3\n4\n\n\nä»ä»£ç ä¸­å¯ä»¥çå°ï¼NewTypeObject ç±»åçåºå±ç»æå¶å®å°±æ¯ä¸ä¸ª Long ç±»åçååé¾è¡¨ãå½ç¶ï¼ä½ è¿å¯ä»¥æ ¹æ®èªå·±çéæ±ï¼æ NewTypeObject çåºå±ç»æå®ä¹ä¸ºå¶ä»ç±»åãä¾å¦ï¼å¦ææä»¬æ³è¦ NewTypeObject çæ¥è¯¢æçæ¯é¾è¡¨é«ï¼å°±å¯ä»¥æå®çåºå±ç»æè®¾è®¡æä¸é¢B+æ ã\n\n----------------------------------------\n\nç¬¬äºæ­¥ï¼å¨RedisObjectçtypeå±æ§ä¸­ï¼å¢å è¿ä¸ªæ°ç±»åçå®ä¹.\n\nè¿ä¸ªå®ä¹æ¯å¨ Redis ç server.h æä»¶ä¸­ãæ¯å¦ï¼æä»¬å¢å ä¸ä¸ªå«ä½ OBJ_NEWTYPE çå®å®ä¹ï¼ç¨æ¥å¨ä»£ç ä¸­æä»£ NewTypeObject è¿ä¸ªæ°ç±»åï¼\n\n#define OBJ_STRING 0    /* String object. */\n#define OBJ_LIST 1      /* List object. */\n#define OBJ_SET 2       /* Set object. */\n#define OBJ_ZSET 3      /* Sorted set object. */\nâ¦\n#define OBJ_NEWTYPE 7\n\n\n1\n2\n3\n4\n5\n6\n\n\n----------------------------------------\n\nç¬¬ä¸æ­¥ï¼å¼åæ°ç±»åçåå»ºåéæ¾å½æ°.\n\nRedis ææ°æ®ç±»åçåå»ºåéæ¾å½æ°é½å®ä¹å¨äº object.c æä»¶ä¸­ãæä»¥ï¼æä»¬å¯ä»¥å¨è¿ä¸ªæä»¶ä¸­å¢å  NewTypeObject çåå»ºå½æ° createNewTypeObjectï¼å¦ä¸æç¤ºï¼\n\nrobj *createNewTypeObject(void){\n   NewTypeObject *h = newtypeNew();\n   robj *o = createObject(OBJ_NEWTYPE,h);\n   return o;\n}\n\n\n1\n2\n3\n4\n5\n\n\ncreateNewTypeObject åå«è°ç¨äº newtypeNew å createObject ä¸¤ä¸ªå½æ°ï¼æåå«æ¥ä»ç»ä¸ï¼\n\n * newtypeNew å½æ°ï¼ç¨æ¥ä¸ºæ°æ°æ®ç±»ååå§ååå­ç»æçãè¿ä¸ªåå§åè¿ç¨ä¸»è¦æ¯ç¨zmallocååºå±ç»æåéç©ºé´ï¼ä»¥ä¾¿åå¥æ°æ®ï¼\n\nNewTypeObject *newtypeNew(void){\n    NewTypeObject *n = zmalloc(sizeof(*n));\n    n->head = NULL;\n    n->len = 0;\n    return n;\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nnewtypeNew å½æ°æ¶åå°æ°æ°æ®ç±»åçå·ä½åå»ºï¼è Redis é»è®¤ä¼ä¸ºæ¯ä¸ªæ°æ®ç±»åå®ä¹ä¸ä¸ªåç¬æä»¶ï¼å®ç°è¿ä¸ªç±»åçåå»ºåå½ä»¤æä½ï¼ä¾å¦ï¼t_string.cåt_list.cåå«å¯¹åºStringåListç±»åãæç§Redisçæ¯ä¾ï¼æä»¬å°±ænewtypeNewå½æ°å®ä¹å¨åä¸º t_newtype.c çæä»¶ä¸­ã\n\n * createObject å½æ°ï¼Redisæ¬èº«æä¾çRedisObjectåå»ºå½æ°ï¼å®çåæ°æ¯æ°æ®ç±»åçtypeåæåæ°æ®ç±»åå®ç°çæéã\n\næä»¬ç» createObject å½æ°ä¸­ä¼ å¥äºä¸¤ä¸ªåæ°ï¼åå«æ¯æ°ç±»åç type å¼ OBJ_NEWTYPEï¼ä»¥åæåä¸ä¸ªåå§åè¿ç NewTypeObjec çæéãè¿æ ·ä¸æ¥ï¼åå»ºç RedisObject å°±è½æåæä»¬èªå®ä¹çæ°æ°æ®ç±»åäºï¼\n\nrobj *createObject(int type, void *ptr) {\n    robj *o = zmalloc(sizeof(*o));\n    o->type = type;\n    o->ptr = ptr;\n    ...\n    return o;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¯¹äºéæ¾å½æ°æ¥è¯´ï¼å®æ¯åå»ºå½æ°çåè¿ç¨ï¼æ¯ç¨zfreeå½ä»¤ææ°ç»æçåå­ç©ºé´éæ¾æã\n\nç¬¬åæ­¥ï¼å¼åæ°ç±»åçå½ä»¤æä½.\n\nç®åæ¥è¯´ï¼å¢å ç¸åºçå½ä»¤æä½çè¿ç¨å¯ä»¥åæä¸å°æ­¥ï¼\n\n 1. å¨ t_newtype.c æä»¶ä¸­å¢å å½ä»¤æä½çå®ç°ãæ¯å¦è¯´ï¼æä»¬å®ä¹ ntinsertCommand å½æ°ï¼ç±å®å®ç°å¯¹ NewTypeObject ååé¾è¡¨çæå¥æä½ï¼\n\nvoid ntinsertCommand(client *c){\n  //åºäºå®¢æ·ç«¯ä¼ éçåæ°ï¼å®ç°å¨NewTypeObjecté¾è¡¨å¤´æå¥åç´ \n}\n\n\n1\n2\n3\n\n 2. å¨ server.h æä»¶ä¸­ï¼å£°ææä»¬å·²ç»å®ç°çå½ä»¤ï¼ä»¥ä¾¿å¨ server.c æä»¶å¼ç¨è¿ä¸ªå½ä»¤ï¼ä¾å¦ï¼\n\nvoid ntinsertCommand(client *c)\n\n\n1\n\n 3. å¨ server.c æä»¶ä¸­ç redisCommandTable éé¢ï¼ææ°å¢å½ä»¤åå®ç°å½æ°å³èèµ·æ¥ãä¾å¦ï¼æ°å¢ç ntinsert å½ä»¤ç± ntinsertCommand å½æ°å®ç°ï¼æä»¬å°±å¯ä»¥ç¨ ntinsert å½ä»¤ç» NewTypeObject æ°æ®ç±»åæå¥åç´ äºï¼\n\nstruct redisCommand redisCommandTable[] = {\n    ...\n    {"ntinsert",ntinsertCommand,2,"m",...}\n}\n\n\n1\n2\n3\n4\n\n\næ­¤æ¶ï¼æä»¬å°±å®æäºä¸ä¸ªèªå®ä¹ç NewTypeObject æ°æ®ç±»åï¼å¯ä»¥å®ç°åºæ¬çå½ä»¤æä½äºãå½ç¶ï¼å¦æä½ è¿å¸ææ°çæ°æ®ç±»åè½è¢«æä¹åä¿å­ï¼æä»¬è¿éè¦å¨ Redis ç RDB å AOF æ¨¡åä¸­å¢å å¯¹æ°æ°æ®ç±»åè¿è¡æä¹åä¿å­çä»£ç ï¼æä¼å¨åé¢çå é¤ä¸­ååä½ åäº«ã\n\n\n# 3.3 å°ç»\n\nè¿ä¸èè¦å­¦ä¹ äº Redis çæ©å±ç±»åï¼GEO ç±»åãå®å¯ä»¥è®°å½ç»çº¬åº¦å½¢å¼çå°çä½ç½®ä¿¡æ¯ï¼è¢«å¹¿æ³å°åºç¨å¨LBSæå¡ä¸­ãGEO æ¬èº«å¹¶æ²¡æè®¾è®¡æ°çåºå±æ°æ®ç»æï¼èæ¯ç´æ¥ä½¿ç¨äº Sorted Set éåç±»åã\n\nGEOç±»åä½¿ç¨GeoHashç¼ç æ¹æ³å®ç°äºç»çº¬åº¦å°Sorted Setä¸­åç´ æéåæ°çè½¬æ¢ï¼è¿å¶ä¸­çä¸¤ä¸ªå³é®æºå¶å°±æ¯å¯¹äºç»´å°å¾ååºé´ååï¼ä»¥åå¯¹åºé´è¿è¡ç¼ç ãä¸ç»ç»çº¬åº¦è½å¨æä¸ªåºé´åï¼å°±ç¨åºé´çç¼ç å¼æ¥è¡¨ç¤ºï¼å¹¶æç¼ç å¼ä½ä¸ºSorted Setåç´ çæéåæ°ãè¿æ ·ä¸æ¥ï¼æä»¬å°±å¯ä»¥æç»çº¬åº¦ä¿å­å°Sorted Setä¸­ï¼å©ç¨Sorted Setæä¾çâææéè¿è¡æåºèå´æ¥æ¾âçç¹æ§ï¼å®ç°LBSæå¡ä¸­é¢ç¹ä½¿ç¨çâæç´¢éè¿âçéæ±ã\n\nä¹ååè®²è§£äºå¨ Redis ä¸­æ©å±èªå®ä¹æ°æ®ç»æçæ¹å¼ã\n\næ©å±æ°æ®ç±»åçä¸¤ç§å®ç°éå¾\n\n * ä¸ç§æ¯åºäºç°æçæ°æ®ç±»åï¼éè¿æ°æ®ç¼ç ææ¯å®ç°æ°çæä½çæ¹å¼ï¼æ¥å®ç°æ©å±æ°æ®ç±»åï¼ä¾å¦åºäºSorted SetåGeoHashç¼ç å®ç°GEOï¼ä»¥ååºäºStringåä½æä½å®ç°Bitmapï¼\n * å¦ä¸ç§å°±æ¯å¼åèªå®ä¹çæ°æ®ç±»åï¼å·ä½çæä½æ¯å¢å æ°æ°æ®ç±»åçå®ä¹ï¼å®ç°åå»ºåéæ¾å½æ°ï¼å®ç°æ°æ°æ®ç±»åæ¯æçå½ä»¤æä½ï¼å»ºè®®ä½ å°è¯çæä»å¤©å­¦å°çåå®¹çµæ´»å°åºç¨å°ä½ çå·¥ä½åºæ¯ä¸­ã\n\n----------------------------------------\n\næ¬èé®é¢ï¼é¤äºæä»¬è®²å°çäºå¤§åºæ¬æ°æ®ç±»åï¼è¿ç¨è¿ä»ä¹å«çæ°æ®ç±»åï¼\n\nRedisè¿æä¸ç§æ°æ®ç±»åï¼å«ä½å¸éè¿æ»¤å¨ãå®çæ¥è¯¢æçå¾é«ï¼ç»å¸¸ä¼ç¨å¨ç¼å­åºæ¯ä¸­ï¼å¯ä»¥ç¨æ¥å¤æ­æ°æ®æ¯å¦å­å¨ç¼å­ä¸­ãä¼å¨åé¢ï¼ç¬¬25è®²ï¼å·ä½å°ä»ç»ä¸ä¸å®ã',normalizedContent:'> åèï¼\n> \n>  * 11 âä¸éæ²¹âç stringï¼ä¸ºä»ä¹ä¸å¥½ç¨äºï¼| æå®¢æ¶é´\n>  * 12 æä¸äº¿ä¸ª keys è¦ç»è®¡ï¼åºè¯¥ç¨åªç§éåï¼| æå®¢æ¶é´\n>  * 13 geoæ¯ä»ä¹ï¼è¿å¯ä»¥å®ä¹æ°çæ°æ®ç±»ååï¼| æå®¢æ¶é´\n\nè¿ä¸ç« è¿å¥å®è·µç¯ï¼å°å­¦ä¹ âæ°æ®ç»æâï¼ä»ç»åå­å¼éä»¥åä¿å­åç»è®¡æµ·éæ°æ®çæ°æ®ç±»ååå¶åºå±æ°æ®ç»æï¼è¿ä¼å´ç»å¸åçåºç¨åºæ¯ï¼ä¾å¦å°åä½ç½®æ¥è¯¢ãæ¶é´åºåæ°æ®åºè¯»ååæ¶æ¯éåå­åï¼ï¼è·ä½ åäº«ä½¿ç¨ redis çæ°æ®ç±»åå module æ©å±åè½æ¥æ»¡è¶³éæ±çå·ä½æ¹æ¡ã\n\n\n# 1. âä¸éæ²¹âç stringï¼ä¸ºä»ä¹ä¸å¥½ç¨äºï¼\n\nè¿ä¸èäºè§£ä¸ä¸ string ç±»åçåå­ç©ºé´æ¶èé®é¢ï¼ä»¥åéæ©èçåå­å¼éçæ°æ®ç±»åçè§£å³æ¹æ¡ã\n\nååäº«ä¸ä¸ªå®éçéæ±ãå½æ¶è¦å¼åä¸ä¸ªå¾çå­å¨ç³»ç»ï¼è¦æ±è½å¿«éè®°å½å¹¶è½å¤å¿«éæ ¹æ®å¾ç id æ¾å°å¯¹åºçå¾çå­å¨å¯¹è±¡ idï¼å³ photo_id -> photo_obj_idãç±äºå¾çæ°éå·¨å¤§ï¼æä»¬å°±ä½¿ç¨ 10 ä½æ°æ¥ä¿å­è¿ä¸ª idï¼ä¾å¦ï¼\n\nphoto_id: 1101000051\nphoto_obj_id: 3301000051\n\n\n1\n2\n\n\nå¯ä»¥çå° photo_id ä¸ photo_obj_id ä¸ä¸å¯¹åºï¼æ¯å¸åçâé®-åå¼âæ¨¡å¼ãæè°çâåå¼âï¼å°±æ¯æé®å¼å¯¹ä¸­çå¼å°±æ¯ä¸ä¸ªå¼ï¼èä¸æ¯ä¸ä¸ªéåï¼è¿å string ç±»åæä¾çâä¸ä¸ªé®å¯¹åºä¸ä¸ªå¼çæ°æ®âçä¿å­å½¢å¼åå¥½å¥åã\n\nèä¸ï¼string ç±»åå¯ä»¥ä¿å­äºè¿å¶å­èæµï¼å°±åâä¸éæ²¹âä¸æ ·ï¼åªè¦ææ°æ®è½¬æäºè¿å¶å­èæ°ç»ï¼å°±å¯ä»¥ä¿å­äºã\n\næä»¥ï¼æä»¬çç¬¬ä¸ä¸ªæ¹æ¡å°±æ¯ç¨ string ä¿å­æ°æ®ãæä»¬æå¾ç id åå¾çå­å¨å¯¹è±¡ id åå«ä½ä¸ºé®å¼å¯¹ç key å value æ¥ä¿å­ï¼å¶ä¸­ï¼å¾çå­å¨å¯¹è±¡ id ç¨äº string ç±»åã\n\nåå¼å§ï¼æä»¬ä¿å­äº1äº¿å¼ å¾çï¼å¤§çº¦ç¨äº6.4gbçåå­ãä½éçå¾çæ°æ®éçä¸æ­å¢å ï¼redis åå­ä½¿ç¨éä¹å¨å¢å ï¼å¯¼è´å çæ rdb èååºåæ¢çé®é¢ãå¾æ¾ç¶ï¼string ç±»åå¹¶ä¸æ¯ä¸ç§å¥½çéæ©ï¼æä»¬è¿éè¦è¿ä¸æ­¥å¯»æ¾è½èçåå­å¼éçæ°æ®ç±»åæ¹æ¡ã\n\nå¨è¿ä¸ªè¿ç¨ä¸­ï¼æä»¬ç ç©¶åç°ï¼string ç±»åå¹¶ä¸æ¯éç¨äºææåºåçï¼å®æä¸ä¸ªææ¾çç­æ¿ï¼å°±æ¯å®ä¿å­æ°æ®æ¶ææ¶èçåå­ç©ºé´è¾å¤ã\n\nåæ¶ï¼æä»¬è¿ä»ç»ç ç©¶äºéåç±»åçæ°æ®ç»æï¼åç°ï¼éåç±»åæéå¸¸èçåå­ç©ºé´çåºå±å®ç°ç»æï¼ä½æ¯ï¼éåç±»åä¿å­çæ°æ®æ¨¡å¼ï¼æ¯ä¸ä¸ªé®å¯¹åºä¸ç³»åå¼ï¼å¹¶ä¸éåç´æ¥ä¿å­åå¼çé®å¼å¯¹ãæä»¥ï¼æä»¬å°±ä½¿ç¨äºçº§ç¼ç çæ¹æ³ï¼å®ç°äºç¨éåç±»åä¿å­åå¼é®å¼å¯¹ï¼redis å®ä¾çåå­ç©ºé´æ¶èææ¾ä¸éäºã\n\nè¿èè¯¾ï¼æå°±æå¨è§£å³è¿ä¸ªé®é¢æ¶å­¦å°çç»éªåæ¹æ³åäº«ç»ä½ ï¼åæ¬ string ç±»åçåå­ç©ºé´æ¶èå¨åªå¿äºãç¨ä»ä¹æ°æ®ç»æå¯ä»¥èçåå­ï¼ä»¥åå¦ä½ç¨éåç±»åä¿å­åå¼é®å¼å¯¹ãå¦æä½ å¨ä½¿ç¨ string ç±»åæ¶ä¹éå°äºåå­ç©ºé´æ¶èè¾å¤çé®é¢ï¼å°±å¯ä»¥å°è¯ä¸ä»å¤©çè§£å³æ¹æ¡äºã\n\næ¥ä¸æ¥ï¼æä»¬åæ¥çç string ç±»åçåå­é½æ¶èå¨åªéäºã\n\n\n# 1.1 ä¸ºä»ä¹ string ç±»ååå­å¼éå¤§ï¼\n\nå¨åæçæ¡ä¾ä¸­ï¼æä»¬ä¿å­äº1äº¿å¼ å¾ççä¿¡æ¯ï¼ç¨äºçº¦ 6.4gb çåå­ï¼ä¸ä¸ªå¾çidåå¾çå­å¨å¯¹è±¡idçè®°å½å¹³åç¨äº 64 å­èãä½é®é¢æ¯ï¼ä¸ç»å¾çidåå¶å­å¨å¯¹è±¡idçè®°å½ï¼å®éåªéè¦ 16 å­èå°±å¯ä»¥äºã\n\næä»¬æ¥åæä¸ä¸ãå¦ææä»¬å¯ä»¥ç¨ä¸¤ä¸ª8å­èç long ç±»åè¡¨ç¤ºè¿ä¸¤ä¸ª idï¼å ä¸º 8 å­èçlongç±»åæå¤§å¯ä»¥è¡¨ç¤º $2^{64}$ï¼æä»¥è¯å®å¯ä»¥è¡¨ç¤º 10 ä½æ°ãä½æ¯ï¼ä¸ºä»ä¹ string ç±»åå´ç¨äº 64 å­èå¢ï¼\n\nå¶å®ï¼é¤äºè®°å½å®éæ°æ®ï¼stringç±»åè¿éè¦é¢å¤çåå­ç©ºé´è®°å½æ°æ®é¿åº¦ãç©ºé´ä½¿ç¨ç­ä¿¡æ¯ï¼è¿äºä¿¡æ¯ä¹å«ä½åæ°æ®ãå½å®éä¿å­çæ°æ®è¾å°æ¶ï¼åæ°æ®çç©ºé´å¼éå°±æ¾å¾æ¯è¾å¤§äºï¼æç¹âå§å®¾å¤ºä¸»âçææã\n\né£ä¹ï¼string ç±»åå·ä½æ¯æä¹ä¿å­æ°æ®çå¢ï¼\n\nå½ä½ ä¿å­ 64 ä½æç¬¦å·æ´æ°æ¶ï¼string ç±»åä¼æå®ä¿å­ä¸ºä¸ä¸ª 8 å­èç long ç±»åæ´æ°ï¼è¿ç§æ¹å¼éå¸¸ä¹ç§°ä¸º int ç¼ç æ¹å¼ã\n\nä½å½ä½ ä¿å­çæ°æ®ä¸­åå«å­ç¬¦æ¶ï¼string ç±»åå°±ä¼ç¨ç®åå¨æå­ç¬¦ä¸²ï¼simple dynamic stringï¼sdsï¼ç struct æ¥ä¿å­ï¼\n\n * bufï¼char[] ç±»åï¼ä¿å­å®éæ°æ®ï¼åæ¶ä¼å¨å°¾é¨å ä¸ä¸ª \\0ã\n * lenï¼4 byteï¼è¡¨ç¤º buf çé¿åº¦ã\n * allocï¼4 byteï¼è¡¨ç¤º buf çåéé¿åº¦ã\n\nå¯ä»¥çå°ï¼len å alloc å°±æ¯ sds ç»æä½çé¢å¤å¼éãå¦å¤ï¼å¯¹äº string ç±»åæ¥è¯´ï¼é¤äº sdsï¼è¿æä¸ä¸ªæ¥èªäº redisobject ç»æä½çå¼éã\n\nredis ä½¿ç¨ redisobject ç»æä½æ¥ç»ä¸è®°å½ä¸åçæ°æ®ç»æçåæ°æ®åå®éæ°æ®ä½ç½®ãå¶ç»æç¤ºæå¾å¦ä¸ï¼\n\nä¸ºäºèçåå­ï¼redis è¿å¯¹ long ç±»åæ´æ°å sds çåå­å¸å±åäºä¸é¨çè®¾è®¡ï¼\n\n * å½ä¿å­çæ¯ long ç±»åæ¶ï¼redisobject ä¸­ç ptr å°±ç´æ¥èµå¼ä¸ºæ´æ°æ°æ®äºï¼è¿æ ·å°±ä¸ç¨é¢å¤çæéåæåæ´æ°äºï¼èçäºæéçå¼éãè¿ä¹æ¯åé¢è¯´ç int ç¼ç æ¹å¼ã\n * å½ä¿å­çæ¯å­ç¬¦ä¸²æ¶ï¼ä¸å­ç¬¦ä¸²å°äºç­äº 44 byte æ¶ï¼redisobject ä¸­çåæ°æ®ãæéå sds æ¯ä¸åè¿ç»­çåå­åºåï¼è¿æ ·å°±å¯ä»¥é¿ååå­ç¢çãè¿ç§å¸å±æ¹å¼ä¹è¢«ç§°ä¸º embstr ç¼ç æ¹å¼ã\n * å½å­ç¬¦ä¸²å¤§äº 44 byte æ¶ï¼sds æ°æ®éå°±å¼å§åå¤ï¼redis å°±ä¸åæ sds å redisobject å¸å±å¨ä¸èµ·äºï¼èæ¯ä¼ç» sds åéç¬ç«çç©ºé´ï¼å¹¶ç¨æéæå sds ç»æãè¿ç§å¸å±æ¹å¼è¢«ç§°ä¸º raw ç¼ç æ¨¡å¼ã\n\nä¸ç§ç¼ç æ¹å¼å¦ä¸å¾æç¤ºï¼\n\nç°å¨ç¥éäº redisobject çé¢å¤å¼éï¼æä»¬å°±å¯ä»¥è®¡ç® string ç±»åçåå­ä½¿ç¨éäºã\n\nå ä¸º10ä½æ°çå¾çidåå¾çå­å¨å¯¹è±¡idæ¯longç±»åæ´æ°ï¼æä»¥å¯ä»¥ç´æ¥ç¨intç¼ç çredisobjectä¿å­ãæ¯ä¸ªintç¼ç çredisobjectåæ°æ®é¨åå 8å­èï¼æéé¨åè¢«ç´æ¥èµå¼ä¸º8å­èçæ´æ°äºãæ­¤æ¶ï¼æ¯ä¸ªidä¼ä½¿ç¨16å­èï¼å èµ·æ¥ä¸å±æ¯32å­èãä½æ¯ï¼å¦å¤ç32å­èå»åªå¿äºå¢ï¼å¶å®ï¼redis æ¯ä½¿ç¨ä¸ä¸ªå¨å± hash table æ¥ä¿å­ææçé®å¼å¯¹çï¼åå¸è¡¨çæ¯ä¸é¡¹æ¯ä¸ä¸ª dictentry çç»æä½ï¼ç¨æ¥æåä¸ä¸ª kv pairãå¶ä¸­ dictentry æä¸ä¸ª 8 byte çæéï¼åå«æå keyãvalue ä»¥åä¸ä¸ä¸ª dictentryãä¸ä¸ª dictentry å¦ä¸å¾æç¤ºï¼\n\nä½ dictentry åªå äº 24 byteï¼é£ä¸ºå¥ä¼å ç¨ 32 byte å¢ï¼è¿å°±è¦æå° redis ä½¿ç¨çåå­åéåº jemalloc äºã\n\njemalloc å¨åéåå­æ¶ï¼ä¼æ ¹æ®æä»¬ç³è¯·çå­èæ° nï¼æ¾ä¸ä¸ªæ¯ n å¤§ï¼ä½æ¯ææ¥è¿ n ç 2 çå¹æ¬¡æ°ä½ä¸ºåéçç©ºé´ï¼è¿æ ·å¯ä»¥åå°é¢ç¹åéçæ¬¡æ°ãä¸¾ä¸ªä¾å­ãå¦æä½ ç³è¯·6å­èç©ºé´ï¼jemallocå®éä¼åé8å­èç©ºé´ï¼å¦æä½ ç³è¯·24å­èç©ºé´ï¼jemallocåä¼åé32å­èãæä»¥ï¼å¨æä»¬ååè¯´çåºæ¯éï¼dictentryç»æå°±å ç¨äº32å­èã\n\nå¥½äºï¼å°è¿éä½ å°±è½çè§£ï¼ä¸ºä»ä¹ç¨stringç±»åä¿å­å¾çidåå¾çå­å¨å¯¹è±¡idæ¶éè¦ç¨64ä¸ªå­èäºãä½ çï¼ææææä¿¡æ¯åªæ 16 byteï¼ä½¿ç¨ string ç±»åä¿å­å´éè¦ 64 byte çåå­ç©ºé´ï¼æ 48 byte é½æ¯é¢å¤å¼éãé£ææ²¡ææ´èçåå­çæ¹æ³å¢ï¼\n\n\n# 1.2 ç¨ä»ä¹æ°æ®ç»æå¯ä»¥èçåå­ï¼\n\nredis æä¸ç§åºå±æ°æ®ç»æï¼å«åç¼©åè¡¨ï¼ziplistï¼ï¼è¿æ¯ä¸ç§éå¸¸èçåå­çç»æã\n\næä»¬ååé¡¾ä¸åç¼©åè¡¨çææï¼è¡¨å¤´æä¸ä¸ªå­æ®µzlbytesãzltailåzllenï¼åå«è¡¨ç¤ºåè¡¨é¿åº¦ãåè¡¨å°¾çåç§»éï¼ä»¥ååè¡¨ä¸­çentryä¸ªæ°ãåç¼©åè¡¨å°¾è¿æä¸ä¸ªzlendï¼è¡¨ç¤ºåè¡¨ç»æãå¦ä¸å¾ï¼\n\nåç¼©åè¡¨ä¹æä»¥è½èçåå­ï¼å°±å¨äºå®æ¯ç¨ä¸ç³»åè¿ç»­ç entry ä¿å­æ°æ®ãæ¯ä¸ª entry çåæ°æ®åæ¬ä¸é¢å é¨åï¼\n\n * prev_lenï¼è¡¨ç¤ºåä¸ä¸ªentryçé¿åº¦ãprev_lenæä¸¤ç§åå¼æåµï¼1å­èæ5å­èãåå¼1å­èæ¶ï¼è¡¨ç¤ºä¸ä¸ä¸ªentryçé¿åº¦å°äº254å­èãè½ç¶1å­èçå¼è½è¡¨ç¤ºçæ°å¼èå´æ¯0å°255ï¼ä½æ¯åç¼©åè¡¨ä¸­zlendçåå¼é»è®¤æ¯255ï¼å æ­¤ï¼å°±é»è®¤ç¨255è¡¨ç¤ºæ´ä¸ªåç¼©åè¡¨çç»æï¼å¶ä»è¡¨ç¤ºé¿åº¦çå°æ¹å°±ä¸è½åç¨255è¿ä¸ªå¼äºãæä»¥ï¼å½ä¸ä¸ä¸ªentryé¿åº¦å°äº254å­èæ¶ï¼prev_lenåå¼ä¸º1å­èï¼å¦åï¼å°±åå¼ä¸º5å­èã\n * lenï¼è¡¨ç¤ºèªèº«é¿åº¦ï¼4 byte\n * encodingï¼è¡¨ç¤ºç¼ç æ¹å¼ï¼1 byte\n * contentï¼ä¿å­å®éæ°æ®\n\nè¿äº entry ä¼æ¨ä¸ªå¿æ¾ç½®å¨åå­ä¸­ï¼ä¸éè¦åç¨é¢å¤çæéè¿è¡è¿æ¥ï¼è¿æ ·å°±å¯ä»¥èçæéæå ç¨çç©ºé´ã\n\næä»¬ä»¥ä¿å­å¾çå­å¨å¯¹è±¡idä¸ºä¾ï¼æ¥åæä¸ä¸åç¼©åè¡¨æ¯å¦ä½èçåå­ç©ºé´çãæ¯ä¸ªentryä¿å­ä¸ä¸ªå¾çå­å¨å¯¹è±¡idï¼8å­èï¼ï¼æ­¤æ¶ï¼æ¯ä¸ªentryçprev_lenåªéè¦1ä¸ªå­èå°±è¡ï¼å ä¸ºæ¯ä¸ªentryçåä¸ä¸ªentryé¿åº¦é½åªæ8å­èï¼å°äº254å­èãè¿æ ·ä¸æ¥ï¼ä¸ä¸ªå¾ççå­å¨å¯¹è±¡idæå ç¨çåå­å¤§å°æ¯14å­èï¼1+4+1+8=14ï¼ï¼å®éåé16å­èã\n\nredisåºäºåç¼©åè¡¨å®ç°äº listãhash å sorted set è¿æ ·çéåç±»åï¼è¿æ ·åçæå¤§å¥½å¤å°±æ¯èçäº dictentry çå¼éãå½ä½ ç¨ string ç±»åæ¶ï¼ä¸ä¸ªé®å¼å¯¹å°±æä¸ä¸ª dictentryï¼è¦ç¨ 32 å­èç©ºé´ãä½éç¨éåç±»åæ¶ï¼ä¸ä¸ª key å°±å¯¹åºä¸ä¸ªéåçæ°æ®ï¼è½ä¿å­çæ°æ®å¤äºå¾å¤ï¼ä½ä¹åªç¨äºä¸ä¸ª dictentryï¼è¿æ ·å°±èçäºåå­ã\n\nè¿ä¸ªæ¹æ¡å¬èµ·æ¥å¾å¥½ï¼ä½è¿å­å¨ä¸ä¸ªé®é¢ï¼å¨ç¨éåç±»åä¿å­é®å¼å¯¹æ¶ï¼ä¸ä¸ªé®å¯¹åºäºä¸ä¸ªéåçæ°æ®ï¼ä½æ¯å¨æä»¬çåºæ¯ä¸­ï¼ä¸ä¸ªå¾çidåªå¯¹åºä¸ä¸ªå¾ççå­å¨å¯¹è±¡idï¼æä»¬è¯¥æä¹ç¨éåç±»åå¢ï¼æ¢å¥è¯è¯´ï¼å¨ä¸ä¸ªé®å¯¹åºä¸ä¸ªå¼ï¼ä¹å°±æ¯åå¼é®å¼å¯¹ï¼çæåµä¸ï¼æä»¬è¯¥æä¹ç¨éåç±»åæ¥ä¿å­è¿ç§åå¼é®å¼å¯¹å¢ï¼\n\n\n# 1.3 å¦ä½ç¨éåç±»åä¿å­åå¼çé®å¼å¯¹ï¼\n\nå¨ä¿å­åå¼çé®å¼å¯¹æ¶ï¼å¯ä»¥éç¨åºäº hash ç±»åçäºçº§ç¼ç æ¹æ³ãè¿éè¯´çäºçº§ç¼ç ï¼å°±æ¯æä¸ä¸ªåå¼çæ°æ®æåæä¸¤é¨åï¼åä¸é¨åä½ä¸ºhashéåçkeyï¼åä¸é¨åä½ä¸ºhashéåçvalueï¼è¿æ ·ä¸æ¥ï¼æä»¬å°±å¯ä»¥æåå¼æ°æ®ä¿å­å°hashéåä¸­äºã\n\nä»¥å¾çid 1101000060åå¾çå­å¨å¯¹è±¡id 3302000080ä¸ºä¾ï¼æä»¬å¯ä»¥æå¾çidçå7ä½ï¼1101000ï¼ä½ä¸ºhashç±»åçé®ï¼æå¾çidçæå3ä½ï¼060ï¼åå¾çå­å¨å¯¹è±¡idåå«ä½ä¸ºhashç±»åå¼ä¸­çkeyåvalueã\n\næç§è¿ç§è®¾è®¡æ¹æ³ï¼æå¨redisä¸­æå¥äºä¸ç»å¾çidåå¶å­å¨å¯¹è±¡idçè®°å½ï¼å¹¶ä¸ç¨infoå½ä»¤æ¥çäºåå­å¼éï¼æåç°ï¼å¢å ä¸æ¡è®°å½åï¼åå­å ç¨åªå¢å äº16å­èï¼å¦ä¸æç¤ºï¼\n\n127.0.0.1:6379> info memory\n# memory\nused_memory:1039120\n127.0.0.1:6379> hset 1101000 060 3302000080\n(integer) 1\n127.0.0.1:6379> info memory\n# memory\nused_memory:1039136\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨ä½¿ç¨ string ç±»åæ¶ï¼æ¯ä¸ªè®°å½éè¦æ¶è 64 å­èï¼è¿ç§æ¹å¼å´åªç¨äº 16 å­èï¼æä½¿ç¨çåå­ç©ºé´æ¯åæ¥ç 1/4ï¼æ»¡è¶³äºæä»¬èçåå­ç©ºé´çéæ±ã\n\nä¸è¿ï¼ä½ å¯è½ä¹ä¼æçæï¼âäºçº§ç¼ç ä¸å®è¦æå¾çidçå7ä½ä½ä¸ºhashç±»åçé®ï¼ææå3ä½ä½ä¸ºhashç±»åå¼ä¸­çkeyåï¼â å¶å®ï¼äºçº§ç¼ç æ¹æ³ä¸­éç¨çidé¿åº¦æ¯æè®²ç©¶çã\n\næä»¬ä¹åè®²è¿ï¼redis ç hash ç±»åæä¸¤ç§åºå±å®ç°ç»æï¼åå«æ¯åç¼©åè¡¨ååå¸è¡¨ãhash ç±»åè®¾ç½®äºä¸ä¸ªç¨åç¼©åè¡¨ä¿å­æ°æ®æ¶çéå¼ï¼ä¸æ¦è¶è¿éå¼ï¼hash ç±»åå°±ä¼ç¨åå¸è¡¨æ¥ä¿å­æ°æ®äºãè¿ä¸¤ä¸ªéå¼åå«å¯¹åºä»¥ä¸ä¸¤ä¸ªéç½®é¡¹ï¼\n\n * hash-max-ziplist-entriesï¼è¡¨ç¤ºç¨åç¼©åè¡¨ä¿å­æ¶åå¸éåä¸­çæå¤§åç´ ä¸ªæ°ã\n * hash-max-ziplist-valueï¼è¡¨ç¤ºç¨åç¼©åè¡¨ä¿å­æ¶åå¸éåä¸­åä¸ªåç´ çæå¤§é¿åº¦ã\n\nå¦ææä»¬å¾hashéåä¸­åå¥çåç´ ä¸ªæ°è¶è¿äº hash-max-ziplist-entriesï¼æèåå¥çåä¸ªåç´ å¤§å°è¶è¿äº hash-max-ziplist-valueï¼redis å°±ä¼èªå¨æ hash ç±»åçå®ç°ç»æç±åç¼©åè¡¨è½¬ä¸ºåå¸è¡¨ã\n\nä¸æ¦ä»åç¼©åè¡¨è½¬ä¸ºäºåå¸è¡¨ï¼hash ç±»åå°±ä¼ä¸ç´ç¨åå¸è¡¨è¿è¡ä¿å­ï¼èä¸ä¼åè½¬ååç¼©åè¡¨äºãå¨èçåå­ç©ºé´æ¹é¢ï¼åå¸è¡¨å°±æ²¡æåç¼©åè¡¨é£ä¹é«æäºã\n\nä¸ºäºè½ååä½¿ç¨åç¼©åè¡¨çç²¾ç®åå­å¸å±ï¼æä»¬ä¸è¬è¦æ§å¶ä¿å­å¨hashéåä¸­çåç´ ä¸ªæ°ãæä»¥ï¼å¨åæçäºçº§ç¼ç ä¸­ï¼æä»¬åªç¨å¾çidæå3ä½ä½ä¸ºhashéåçkeyï¼ä¹å°±ä¿è¯äºhashéåçåç´ ä¸ªæ°ä¸è¶è¿1000ï¼åæ¶ï¼æä»¬æ hash-max-ziplist-entries è®¾ç½®ä¸º 1000ï¼è¿æ ·ä¸æ¥ï¼hash éåå°±å¯ä»¥ä¸ç´ä½¿ç¨åç¼©åè¡¨æ¥èçåå­ç©ºé´äºã\n\n\n# 1.4 å°ç»\n\nè¿ä¸èæä»¬æç ´äºå¯¹ string çè®¤ç¥è¯¯åºï¼äºè§£å° string å¹¶éä¸éæ²¹ï¼å½ä¿å­ç kv pair æ¬èº«å ç¨åå­ç©ºé´ä¸å¤§æ¶ï¼string ç±»åçåæ°æ®å¼éå°±å æ®ä¸»å¯¼äºï¼è¿åæ¬äº redisobjectãsdsãdictentry ç»æçåå­å¼éã\n\néå¯¹è¿ç§æåµï¼æä»¬å¯ä»¥åå©åç¼©åè¡¨è¿ç§åºå±ç»æï¼ä½¿ç¨ hash ç±»åçäºçº§ç¼ç æ¹æ³æ¥ä¿å­åå¼ kv pair çæ°æ®ãä¹å°±æ¯éè¦å°å kv pair ç key ææä¸¤é¨åï¼åä¸é¨åä½ä¸º hash éåç keyï¼åä¸é¨åä¸å kv pair ç value ç»åæä¸ä¸ªæ° kv æ¥ä½ä¸º hash éåç valueã\n\nå°å¦æï¼å¦æä½ æ³ç¥é kv pair éç¨ä¸åç±»åä¿å­æ¶çåå­å¼éï¼å¯ä»¥å¨redis å®¹éé¢ä¼°è¿ä¸ªç½ç«ä¸è¿è¡ä¼°è®¡ã\n\n\n# 2. æä¸äº¿ä¸ªkeysè¦ç»è®¡ï¼åºè¯¥ç¨åªç§éåï¼\n\nå¾å¤åºæ¯éè¦ä¿å­è¿æ ·ä¸ç§æ°æ®ï¼ä¸ä¸ª key å¯¹åºäºä¸ä¸ªæ°æ®éåãæ¯å¦:\n\n * ææºappä¸­çæ¯å¤©çç¨æ·ç»å½ä¿¡æ¯ï¼ä¸å¤© -> ç¨æ· id / ç»å½è®¾å¤;\n * çµåç½ç«ä¸ååçç¨æ·è¯è®ºåè¡¨ï¼ä¸ä¸ªåå -> ä¸ç³»åè¯è®ºï¼\n * ç¨æ·å¨ææºappä¸çç­¾å°æå¡ä¿¡æ¯ï¼åå·¥ -> ä¸å¤©æå¡è®°å½ã\n\nredis çéåç±»åå¾éåå­å¨è¿äºæ°æ®ï¼ä½å¨è¿äºåºæ¯ä¸­ï¼é¤äºè®°å½ä¿¡æ¯ï¼æä»¬å¾å¾è¿éè¦å¯¹éåä¸­çæ°æ®è¿è¡ç»è®¡ï¼æ¯å¦ç»è®¡æ¯å¤©æ°å¢ç¨æ·æ°ãç»è®¡è¯è®ºåè¡¨ä¸­çææ°è¯è®ºãä¸ä¸ªæè¿ç»­æå¡çåå·¥æ°ç­ãéå¸¸æä»¬ä¼é¢ä¸´å·¨å¤§çè®¿é®éï¼æ¯å¦ç¾ä¸ãåä¸çº§å«ãæä»¥ï¼æä»¬å¿é¡»è¦è½å¤éæ©éå¸¸é«æå°ç»è®¡å¤§éæ°æ®ï¼ä¾å¦äº¿çº§ï¼çéåç±»åã\n\nè¦æ³éæ©åéçéåï¼æä»¬å°±å¾äºè§£å¸¸ç¨çéåç»è®¡æ¨¡å¼ãè¿ä¸èå°ä»ç»éåç±»åçå¸¸è§åç§ç»è®¡æ¨¡å¼ï¼èåç»è®¡ãæåºç»è®¡ãäºå¼ç¶æç»è®¡ååºæ°ç»è®¡ï¼å¹¶ä»ç»è¿äºç»è®¡åºæ¯ä¸ä»ä¹æ°æ®ç»ææ´å åéã\n\n\n# 2.1 èåç»è®¡ ââ set\n\nèåç»è®¡ï¼æç»è®¡å¤ä¸ªéååç´ çèåç»æï¼åæ¬ï¼ç»è®¡å¤ä¸ªéåçå±æåç´ ï¼äº¤éç»è®¡ï¼ï¼æä¸¤ä¸ªéåç¸æ¯ï¼ç»è®¡å¶ä¸­ä¸ä¸ªéåç¬æçåç´ ï¼å·®éç»è®¡ï¼ï¼ç»è®¡å¤ä¸ªéåçææåç´ ï¼å¹¶éç»è®¡ï¼ã\n\næ¯å¦ç»è®¡ææº app æ¯å¤©çæ°å¢ç¨æ·æ°åç¬¬äºå¤©ççå­ç¨æ·æ°å°±æ¯èåç»è®¡ãè¦å®æè¿ä¸ªç»è®¡ä»»å¡ï¼æä»¬å¯ä»¥ç¨ä¸ä¸ªéåè®°å½ææç»å½è¿appçç¨æ·idï¼åæ¶ï¼ç¨å¦ä¸ä¸ªéåè®°å½æ¯ä¸å¤©ç»å½è¿appçç¨æ·idãç¶åï¼åå¯¹è¿ä¸¤ä¸ªéååèåç»è®¡ãæä»¬æ¥çä¸å·ä½çæä½ã\n\nå¯ä»¥ä½¿ç¨ set ç±»åæ¥è®°å½ææç»å½è¿ app çç¨æ· idï¼æ key è®¾ç½®æ user:idï¼value å°±æ¯ä¿å­äºææç»éè¿ app çç¨æ· id ç setï¼å¦ä¸å¾ï¼\n\nè¿éè¦è®°å½æ¯ä¸å¤©ç»å½çç¨æ· idï¼å¯ä»¥è®© key è®¾ä¸º user:id:<datetime>ï¼æ¯å¦ user:id:20200803ï¼value æ¯è®°å½äºå½å¤©ç»å½çææç¨æ· id ç setãå¦ä¸å¾ï¼\n\nå¨ç»è®¡æ¯å¤©çæ°å¢ç¨æ·æ¶ï¼æä»¬åªç¨è®¡ç®æ¯æ¥ç¨æ· set åç´¯è®¡ç¨æ· set çå·®éå°±è¡ã\n\nå½ä½ éè¦å¯¹å¤ä¸ªéåè¿è¡èåè®¡ç®æ¶ï¼set ç±»åä¼æ¯ä¸ä¸ªéå¸¸ä¸éçéæ©ãä¸è¿ï¼è¿éæä¸ä¸ªæ½å¨çé£é©ï¼set çå·®éãå¹¶éåäº¤éçè®¡ç®å¤æåº¦è¾é«ï¼å¨æ°æ®éè¾å¤§çæåµä¸ï¼å¦æç´æ¥æ§è¡è¿äºè®¡ç®ï¼ä¼å¯¼è´rediså®ä¾é»å¡ãæä»¥è¿éç»ä¸ä¸ªå°å»ºè®®ï¼ä½ å¯ä»¥ä»ä¸»ä»éç¾¤ä¸­éæ©ä¸ä¸ªä»åºï¼è®©å®ä¸é¨è´è´£èåè®¡ç®ï¼æèæ¯ææ°æ®è¯»åå°å®¢æ·ç«¯ï¼å¨å®¢æ·ç«¯æ¥å®æèåç»è®¡ï¼è¿æ ·å°±å¯ä»¥è§é¿é»å¡ä¸»åºå®ä¾åå¶ä»ä»åºå®ä¾çé£é©äºã\n\n\n# 2.2 æåºç»è®¡ ââ æåºéå\n\nè¿ä¸å°èè®²åºå¯¹éååç´ æåºçéæ±çæ¹æ³ï¼è¿éä»¥çµåç½ç«æä¾ææ°è¯è®ºåè¡¨çåºæ¯ä¸ºä¾è¿è¡è®²è§£ã\n\nææ°è¯è®ºåè¡¨åå«äºææè¯è®ºä¸­çææ°çè¨ï¼è¿å°±è¦æ±éåç±»åè½å¯¹åç´ ä¿åºï¼è¿ç§å¯¹åç´ ä¿åºçéåç±»åå«ä½æåºéåãå¨ redis çåä¸ªéåç±»åä¸­ï¼listãhashãset å sorted setï¼ï¼list å sorted set å°±å±äºæåºéåã\n\n * list æç§åç´ æ·»å çé¡ºåºè¿è¡æåºï¼\n * sorted set æç§åç´ çæéæ¥æåºï¼å¶ä¸­æéå¼å¯ä»¥èªå·±å³å®ï¼æ¯å¦è®©æå¥æ¶é´ä½ä¸ºæéï¼ã\n\nè²ä¼¼é½ç¬¦åéæ±ï¼æ¥ä¸æ¥çä¸ä¸å¦ä½éæ©ã\n\n----------------------------------------\n\nå¦æä½¿ç¨ list çè¯ãæ¯ä¸ªååå¯¹åºä¸ä¸ª listï¼è¿ä¸ª list åå«äºè¯¥ååçå¨é¨è¯è®ºï¼å¹¶æç§è¯è®ºæ¶é´ä¿å­ï¼æ¯æ¥ä¸ä¸ªæ°è¯è®ºå°±ç¨ lpush å½ä»¤æå®æå¥å° list çéå¤´ã\n\nå¨åªæä¸é¡µè¯è®ºçæ¶åï¼æä»¬å¯ä»¥å¾æ¸æ°å°çå°ææ°çè¯è®ºï¼ä½æ¯ï¼å¨å®éåºç¨ä¸­ï¼ç½ç«ä¸è¬ä¼åé¡µæ¾ç¤ºææ°çè¯è®ºåè¡¨ï¼ä¸æ¦æ¶åå°åé¡µæä½ï¼listå°±å¯è½ä¼åºç°é®é¢äºã\n\nåè®¾å½åçè¯è®ºlistæ¯{a, b, c, d, e, f}ï¼å¶ä¸­ï¼aæ¯ææ°çè¯è®ºï¼ä»¥æ­¤ç±»æ¨ï¼fæ¯ææ©çè¯è®ºï¼ï¼å¨å±ç¤ºç¬¬ä¸é¡µç3ä¸ªè¯è®ºæ¶ï¼æä»¬å¯ä»¥ç¨ä¸é¢çå½ä»¤ï¼å¾å°ææ°çä¸æ¡è¯è®ºaãbãcï¼\n\nlrange product1 0 2\n1) "a"\n2) "b"\n3) "c"\n\n\n1\n2\n3\n4\n\n\nç¶åï¼åç¨ä¸é¢çå½ä»¤è·åç¬¬äºé¡µç3ä¸ªè¯è®ºï¼ä¹å°±æ¯dãeãfï¼\n\nlrange product1 3 5\n1) "d"\n2) "e"\n3) "f"\n\n\n1\n2\n3\n4\n\n\nä½æ¯ï¼å¦æå¨å±ç¤ºç¬¬äºé¡µåï¼åäº§çäºä¸ä¸ªæ°è¯è®ºgï¼è¯è®ºgå°±ä¼è¢«lpushå½ä»¤æå¥å°è¯è®ºlistçéå¤´ï¼è¯è®ºlistå°±åæäº{g, a, b, c, d, e, f}ãæ­¤æ¶ï¼åç¨åæçå½ä»¤è·åç¬¬äºé¡µè¯è®ºæ¶ï¼å°±ä¼åç°ï¼è¯è®ºcåè¢«å±ç¤ºåºæ¥äºï¼ä¹å°±æ¯cãdãeï¼\n\nlrange product1 3 5\n1) "c"\n2) "d"\n3) "e"\n\n\n1\n2\n3\n4\n\n\nä¹æä»¥ä¼è¿æ ·ï¼å³é®åå å°±å¨äºï¼listæ¯éè¿åç´ å¨listä¸­çä½ç½®æ¥æåºçï¼å½æä¸ä¸ªæ°åç´ æå¥æ¶ï¼ååçåç´ å¨listä¸­çä½ç½®é½åç§»äºä¸ä½ï¼æ¯å¦è¯´åæ¥å¨ç¬¬1ä½çåç´ ç°å¨æå¨äºç¬¬2ä½ãæä»¥ï¼å¯¹æ¯æ°åç´ æå¥ååï¼list ç¸åä½ç½®ä¸çåç´ å°±ä¼åçååï¼ç¨ lrange è¯»åæ¶ï¼å°±ä¼è¯»å°æ§åç´ ã\n\n----------------------------------------\n\nå list ç¸æ¯ï¼sorted set å°±ä¸å­å¨è¿ä¸ªé®é¢ï¼å ä¸ºå®æ¯æ ¹æ®åç´ çå®éæéæ¥æåºåè·åæ°æ®çã\n\næä»¬å¯ä»¥æè¯è®ºæ¶é´çååç»æ¯æ¡è¯è®ºè®¾ç½®ä¸ä¸ªæéå¼ï¼ç¶ååæè¯è®ºä¿å­å° sorted set ä¸­ãsorted set ç zrangebyscore å½ä»¤å°±å¯ä»¥ææéæåºåè¿ååç´ ãè¿æ ·çè¯ï¼å³ä½¿éåä¸­çåç´ é¢ç¹æ´æ°ï¼sorted set ä¹è½éè¿ zrangebyscore å½ä»¤åç¡®å°è·åå°æåºæåçæ°æ®ã\n\nåè®¾è¶æ°çè¯è®ºæéè¶å¤§ï¼ç®åææ°è¯è®ºçæéæ¯ nï¼æä»¬æ§è¡ä¸é¢çå½ä»¤æ¶ï¼å°±å¯ä»¥è·å¾ææ°ç10æ¡è¯è®ºï¼\n\nzrangebyscore comments n-9 n\n\n\n1\n\n\næä»¥ï¼å¨é¢å¯¹éè¦å±ç¤ºææ°åè¡¨ãæè¡æ¦ç­åºæ¯æ¶ï¼å¦ææ°æ®æ´æ°é¢ç¹æèéè¦åé¡µæ¾ç¤ºï¼å»ºè®®ä½ ä¼åèèä½¿ç¨ sorted setã\n\n> sorted set å¯ä»¥æ ¹æ®æéæ¥è¿è¡æåºï¼ä½ list åªè½æ ¹æ®ç´¢å¼è·å¾å¼ï¼æå¢å åç´ æ¶ï¼sorted set è¿æ¯å¯ä»¥ç±æéå¾å°æ­£ç¡®çå¼ï¼ä½ list ä¸è¡ã\n\n\n# 2.3 äºå¼ç¶æç»è®¡ ââ bitmap\n\näºå¼ç¶æå°±æ¯æéååç´ çåå¼å°±åªæ 0 å 1 ä¸¤ç§ãæ¯å¦å¨ç­¾å°æå¡çåºæ¯ä¸­ï¼åªç¨è®°å½ç­¾å°ï¼1ï¼ææªç­¾å°ï¼0ï¼ï¼æä»¥è¿å°±æ¯éå¸¸å¸åçäºå¼ç¶æã\n\nå¨ç­¾å°ç»è®¡æ¶ï¼æ¯ä¸ªç¨æ·ä¸å¤©çç­¾å°ç¨ 1 ä¸ª bit ä½å°±è½è¡¨ç¤ºï¼ä¸ä¸ªæï¼åè®¾æ¯31å¤©ï¼çç­¾å°æåµç¨ 31 ä¸ª bit ä½å°±å¯ä»¥ï¼èä¸å¹´çç­¾å°ä¹åªéè¦ç¨ 365 ä¸ª bit ä½ï¼æ ¹æ¬ä¸ç¨å¤ªå¤æçéåç±»åãè¿ä¸ªæ¶åï¼æä»¬å°±å¯ä»¥éæ© bitmapãè¿æ¯redisæä¾çæ©å±æ°æ®ç±»åãæ¥ä¸æ¥ä»ç» bitmap çå®ç°åçã\n\nbitmap æ¬èº«æ¯ç¨ string ç±»åä½ä¸ºåºå±æ°æ®ç»æå®ç°çä¸ç§ç»è®¡äºå¼ç¶æçæ°æ®ç±»åãstring ç±»åæ¯ä¼ä¿å­ä¸ºäºè¿å¶çå­èæ°ç»ï¼æä»¥ï¼redis å°±æå­èæ°ç»çæ¯ä¸ª bit ä½å©ç¨èµ·æ¥ï¼ç¨æ¥è¡¨ç¤ºä¸ä¸ªåç´ çäºå¼ç¶æãä½ å¯ä»¥æ bitmap çä½æ¯ä¸ä¸ª bit æ°ç»ã\n\nbitmap æä¾äº getbit/setbit æä½ï¼ä½¿ç¨ä¸ä¸ªåç§»å¼ offset å¯¹ bit æ°ç»çæä¸ä¸ª bit ä½è¿è¡è¯»ååãä¸è¿ï¼éè¦æ³¨æçæ¯ï¼bitmap ç offset æ¯ä» 0 å¼å§ç®çï¼ä¹å°±æ¯è¯´offsetçæå°å¼æ¯0ãå½ä½¿ç¨setbitå¯¹ä¸ä¸ªbitä½è¿è¡åæä½æ¶ï¼è¿ä¸ªbitä½ä¼è¢«è®¾ç½®ä¸º1ãbitmap è¿æä¾äº bitcount æä½ï¼ç¨æ¥ç»è®¡è¿ä¸ªbitæ°ç»ä¸­ææâ1âçä¸ªæ°ã\n\né£ä¹ï¼å·ä½è¯¥æä¹ç¨ bitmap è¿è¡ç­¾å°ç»è®¡å¢ï¼æè¿æ¯åå©ä¸ä¸ªå·ä½çä¾å­æ¥è¯´æãåè®¾æä»¬è¦ç»è®¡ id 3000 çç¨æ·å¨2020å¹´8æä»½çç­¾å°æåµï¼å°±å¯ä»¥æç§ä¸é¢çæ­¥éª¤è¿è¡æä½ï¼\n\n 1. æ§è¡ä¸é¢çå½ä»¤ï¼è®°å½è¯¥ç¨æ·8æ3å·å·²ç­¾å°ï¼\n\nsetbit uid:sign:3000:202008 2 1\n\n\n1\n\n\n> ä¸è¿°å½ä»¤ä¸­ç 2 è¡¨ç¤º 8 æçç¬¬ä¸å¤©ã\n\n 2. æ£æ¥è¯¥ç¨æ·8æ3æ¥æ¯å¦ç­¾å°ï¼\n\ngetbit uid:sign:3000:202008 2\n\n\n1\n\n 3. ç»è®¡è¯¥ç¨æ·å¨8æä»½çç­¾å°æ¬¡æ°ï¼\n\nbitcount uid:sign:3000:202008\n\n\n1\n\n\nè¿æ ·ï¼æä»¬å°±ç¥éè¯¥ç¨æ·å¨8æä»½çç­¾å°æåµäºï¼æ¯ä¸æ¯å¾ç®åå¢ï¼æ¥ä¸æ¥ï¼ä½ å¯ä»¥åæèä¸ä¸ªé®é¢ï¼å¦æè®°å½äº1äº¿ä¸ªç¨æ·10å¤©çç­¾å°æåµï¼ä½ æåæ³ç»è®¡åºè¿10å¤©è¿ç»­ç­¾å°çç¨æ·æ»æ°åï¼\n\nå¨ä»ç»å·ä½çæ¹æ³ä¹åï¼æä»¬è¦åç¥éï¼bitmapæ¯æç¨ bitop å½ä»¤å¯¹å¤ä¸ªbitmapæä½åâä¸âãâæâãâå¼æâçæä½ï¼æä½çç»æä¼ä¿å­å°ä¸ä¸ªæ°çbitmapä¸­ãæ¯å¦ä¸å¾å¯¹ä¸ä¸ª bitmap å and æä½ï¼\n\nåå°ååçé®é¢ï¼å¨ç»è®¡1äº¿ä¸ªç¨æ·è¿ç»­10å¤©çç­¾å°æåµæ¶ï¼ä½ å¯ä»¥ææ¯å¤©çæ¥æä½ä¸ºkeyï¼æ¯ä¸ªkeyå¯¹åºä¸ä¸ª1äº¿ä½çbitmapï¼æ¯ä¸ä¸ªbitå¯¹åºä¸ä¸ªç¨æ·å½å¤©çç­¾å°æåµã\n\næ¥ä¸æ¥ï¼æä»¬å¯¹10ä¸ªbitmapåâä¸âæä½ï¼å¾å°çç»æä¹æ¯ä¸ä¸ªbitmapãå¨è¿ä¸ªbitmapä¸­ï¼åªæ10å¤©é½ç­¾å°çç¨æ·å¯¹åºçbitä½ä¸çå¼æä¼æ¯1ãæåï¼æä»¬å¯ä»¥ç¨bitcountç»è®¡ä¸bitmapä¸­ç1çä¸ªæ°ï¼è¿å°±æ¯è¿ç»­ç­¾å°10å¤©çç¨æ·æ»æ°äºã\n\nç°å¨ï¼æä»¬å¯ä»¥è®¡ç®ä¸ä¸è®°å½äº10å¤©ç­¾å°æåµåçåå­å¼éãæ¯å¤©ä½¿ç¨1ä¸ª1äº¿ä½çbitmapï¼å¤§çº¦å 12mbçåå­ï¼10^8/8/1024/1024ï¼ï¼10å¤©çbitmapçåå­å¼éçº¦ä¸º120mbï¼åå­ååä¸ç®å¤ªå¤§ãä¸è¿ï¼å¨å®éåºç¨æ¶ï¼æå¥½å¯¹bitmapè®¾ç½®è¿ææ¶é´ï¼è®©redisèªå¨å é¤ä¸åéè¦çç­¾å°è®°å½ï¼ä»¥èçåå­å¼éã\n\næä»¥ï¼å¦æåªéè¦ç»è®¡æ°æ®çäºå¼ç¶æï¼ä¾å¦ååææ²¡æãç¨æ·å¨ä¸å¨ç­ï¼å°±å¯ä»¥ä½¿ç¨ bitmapï¼å ä¸ºå®åªç¨ä¸ä¸ªbitä½å°±è½è¡¨ç¤º0æ1ãå¨è®°å½æµ·éæ°æ®æ¶ï¼bitmapè½å¤ææå°èçåå­ç©ºé´ã\n\n\n# 2.4 åºæ°ç»è®¡ ââ hyperloglog\n\nåºæ°ç»è®¡å°±æ¯æç»è®¡ä¸ä¸ªéåä¸­ä¸éå¤çåç´ ä¸ªæ°ãæ¯å¦æä»¬ç»è®¡ä¸ä¸ªç½é¡µçç¬ç«è®¿å®¢ï¼unique visitorï¼uvï¼éãuv çç»è®¡æä¸ªç¬ç¹çå°æ¹ï¼éè¦å»éï¼ä¸ä¸ªç¨æ·ä¸å¤©åçå¤æ¬¡è®¿é®åªè½ç®ä½ä¸æ¬¡ã\n\nå¨redisçéåç±»åä¸­ï¼setç±»åé»è®¤æ¯æå»éï¼æä»¥çå°æå»ééæ±æ¶ï¼æä»¬å¯è½ç¬¬ä¸æ¶é´å°±ä¼æ³å°ç¨setç±»åãæä»¬æ¥ç»åä¸ä¸ªä¾å­çä¸çç¨setçæåµï¼æä¸ä¸ªç¨æ·user1è®¿é®page1æ¶ï¼ä½ æè¿ä¸ªä¿¡æ¯å å°setä¸­ï¼\n\nsadd page1:uv user1\n\n\n1\n\n\nç¨æ·1åæ¥è®¿é®æ¶ï¼set çå»éåè½å°±ä¿è¯äºä¸ä¼éå¤è®°å½ç¨æ·1çè®¿é®æ¬¡æ°ï¼è¿æ ·ï¼ç¨æ·1å°±ç®æ¯ä¸ä¸ªç¬ç«è®¿å®¢ãå½ä½ éè¦ç»è®¡uvæ¶ï¼å¯ä»¥ç´æ¥ç¨scardå½ä»¤ï¼è¿ä¸ªå½ä»¤ä¼è¿åä¸ä¸ªéåä¸­çåç´ ä¸ªæ°ãä½æ¯ï¼å¦æpage1éå¸¸ç«çï¼uvè¾¾å°äºåä¸æ¶ï¼ä¸ä¸ªsetå°±è¦è®°å½åä¸ä¸ªç¨æ·idãå¯¹äºä¸ä¸ªæå¤§ä¿ççµåç½ç«èè¨ï¼è¿æ ·çé¡µé¢å¯è½ææåä¸ä¸ä¸ªï¼å¦ææ¯ä¸ªé¡µé¢é½ç¨è¿æ ·çä¸ä¸ªsetï¼å°±ä¼æ¶èå¾å¤§çåå­ç©ºé´ã\n\nå½ç¶ï¼ä½ ä¹å¯ä»¥ç¨ hash ç±»åè®°å½ uvãä¾å¦ï¼ä½ å¯ä»¥æç¨æ·idä½ä¸ºhashéåçkeyï¼å½ç¨æ·è®¿é®é¡µé¢æ¶ï¼å°±ç¨hsetå½ä»¤ï¼ç¨äºè®¾ç½®hashéååç´ çå¼ï¼ï¼å¯¹è¿ä¸ªç¨æ·idè®°å½ä¸ä¸ªå¼â1âï¼è¡¨ç¤ºä¸ä¸ªç¬ç«è®¿å®¢ï¼ç¨æ·1è®¿é®page1åï¼æä»¬å°±è®°å½ä¸º1ä¸ªç¬ç«è®¿å®¢ï¼å¦ä¸æç¤ºï¼\n\nhset page1:uv user1 1\n\n\n1\n\n\nå³ä½¿ç¨æ·1å¤æ¬¡è®¿é®é¡µé¢ï¼éå¤æ§è¡è¿ä¸ªhsetå½ä»¤ï¼ä¹åªä¼æuser1çå¼è®¾ç½®ä¸º1ï¼ä»ç¶åªè®°ä¸º1ä¸ªç¬ç«è®¿å®¢ãå½è¦ç»è®¡ uv æ¶ï¼æä»¬å¯ä»¥ç¨ hlen å½ä»¤ç»è®¡ hash éåä¸­çææåç´ ä¸ªæ°ã\n\nä½æ¯ï¼åsetç±»åç¸ä¼¼ï¼å½é¡µé¢å¾å¤æ¶ï¼hashç±»åä¹ä¼æ¶èå¾å¤§çåå­ç©ºé´ãé£ä¹ï¼æä»ä¹åæ³æ¢è½å®æç»è®¡ï¼è¿è½èçåå­åï¼è¿æ¶åï¼å°±è¦ç¨å°redisæä¾ç hyperloglog äºã\n\nhyperloglog æ¯ä¸ç§ç¨äºç»è®¡åºæ°çæ°æ®éåç±»åï¼å®çæå¤§ä¼å¿å°±å¨äºï¼å½éååç´ æ°ééå¸¸å¤æ¶ï¼å®è®¡ç®åºæ°æéçç©ºé´æ»æ¯åºå®çï¼èä¸è¿å¾å°ãå¨redisä¸­ï¼æ¯ä¸ª hyperloglog åªéè¦è±è´¹ 12 kb åå­ï¼å°±å¯ä»¥è®¡ç®æ¥è¿ 2^64 ä¸ªåç´ çåºæ°ãä½ çï¼ååç´ è¶å¤å°±è¶èè´¹åå­çsetåhashç±»åç¸æ¯ï¼hyperloglog å°±éå¸¸èçç©ºé´ã\n\nå¨ç»è®¡ uv æ¶ï¼ä½ å¯ä»¥ç¨ pfadd å½ä»¤ï¼ç¨äºå hyperloglog ä¸­æ·»å æ°åç´ ï¼æè®¿é®é¡µé¢çæ¯ä¸ªç¨æ·é½æ·»å å° hyperloglog ä¸­ï¼\n\npfadd page1:uv user1 user2 user3 user4 user5\n\n\n1\n\n\næ¥ä¸æ¥ï¼å°±å¯ä»¥ç¨ pfcount å½ä»¤ ç´æ¥è·å¾ page1 ç uv å¼äºï¼è¿ä¸ªå½ä»¤çä½ç¨å°±æ¯è¿å hyperloglog çç»è®¡ç»æï¼\n\npfcount page1:uv\n\n\n1\n\n\n> å³äº hyperloglog çå·ä½å®ç°åçï¼ä½ ä¸éè¦éç¹ææ¡ï¼ä¸ä¼å½±åå°ä½ çæ¥å¸¸ä½¿ç¨ãæ³è¦æ´å¤äºè§£çè¯ï¼å¯ä»¥åèè¿æ¡é¾æ¥ã\n\nä¸è¿ï¼æä¸ç¹éè¦ä½ æ³¨æä¸ä¸ï¼hyperloglog çç»è®¡è§åæ¯åºäºæ¦çå®æçï¼æä»¥å®ç»åºçç»è®¡ç»ææ¯æä¸å®è¯¯å·®çï¼æ åè¯¯ç®çæ¯ 0.81%ãè¿ä¹å°±æå³çï¼ä½ ä½¿ç¨ hyperloglog ç»è®¡ç uv æ¯ 100 ä¸ï¼ä½å®éç uv å¯è½æ¯ 101 ä¸ãè½ç¶è¯¯å·®çä¸ç®å¤§ï¼ä½æ¯ï¼å¦æä½ éè¦ç²¾ç¡®ç»è®¡ç»æçè¯ï¼æå¥½è¿æ¯ç»§ç»­ç¨ set æ hash ç±»åã\n\n\n# 2.5 å°ç»\n\nè¿ä¸å¤§èéå¯¹èåç»è®¡ãæåºç»è®¡ãäºå¼ç¶æç»è®¡ååºæ°ç»è®¡åç§åºæ¯è®²è§£äºå¤ä¸ªæ°æ®ç»æï¼æ±æ»å¦ä¸ï¼\n\nå¯ä»¥çå°ï¼\n\n * setåsorted seté½æ¯æå¤ç§èåç»è®¡ï¼ä¸è¿ï¼å¯¹äºå·®éè®¡ç®æ¥è¯´ï¼åªæsetæ¯æãbitmapä¹è½åå¤ä¸ªbitmapé´çèåè®¡ç®ï¼åæ¬ä¸ãæåå¼ææä½ã\n * å½éè¦è¿è¡æåºç»è®¡æ¶ï¼listä¸­çåç´ è½ç¶æåºï¼ä½æ¯ä¸æ¦ææ°åç´ æå¥ï¼åæ¥çåç´ å¨listä¸­çä½ç½®å°±ä¼ç§»å¨ï¼é£ä¹ï¼æä½ç½®è¯»åçæåºç»æå¯è½å°±ä¸åç¡®äºãèsorted setæ¬èº«æ¯æç§éååç´ çæéæåºï¼å¯ä»¥åç¡®å°æåºè·åç»æï¼æä»¥å»ºè®®ä½ ä¼åä½¿ç¨å®ã\n * å¦ææä»¬è®°å½çæ°æ®åªæ0å1ä¸¤ä¸ªå¼çç¶æï¼bitmapä¼æ¯ä¸ä¸ªå¾å¥½çéæ©ï¼è¿ä¸»è¦å½åäºbitmapå¯¹äºä¸ä¸ªæ°æ®åªç¨1ä¸ªbitè®°å½ï¼å¯ä»¥èçåå­ã\n * å¯¹äºåºæ°ç»è®¡æ¥è¯´ï¼å¦æéååç´ éè¾¾å°äº¿çº§å«èä¸ä¸éè¦ç²¾ç¡®ç»è®¡æ¶ï¼æå»ºè®®ä½ ä½¿ç¨hyperloglogã\n\nå½ç¶ï¼redisçåºç¨åºæ¯éå¸¸å¤ï¼è¿å¼ è¡¨ä¸­çæ»ç»ä¸ä¸å®è½è¦çå°ææåºæ¯ãæå»ºè®®ä½ ä¹è¯çèªå·±ç»ä¸å¼ è¡¨ï¼æä½ éå°çå¶ä»åºæ¯æ·»å è¿å»ãé¿ä¹ç§¯ç´¯ä¸æ¥ï¼ä½ ä¸å®è½å¤æ´å çµæ´»å°æéåç±»ååºç¨å°åéçå®è·µé¡¹ç®ä¸­ã\n\n\n# 3. geo æ¯ä»ä¹ï¼è¿å¯ä»¥å®ä¹æ°çæ°æ®ç±»ååï¼\n\næä»¬ä¹åå­¦ä¹ äº redis ç 5 å¤§åºæ¬æ°æ®ç±»åï¼stringãlistãhashãset å sorted setãå¨é¢å¯¹ä¸äºç¹æ®åºæ¯æ¶ï¼è¿äºç±»åæ æ³å¾å¥½å°æ¯æï¼äºæ¯ redis è¿æä¾äº 3 ç§æ©å±ç±»åï¼bitmapãhyperloglog å geoãè¿ä¸èä¸»è¦è®²ä¸ä¸ geoã\n\nå¦å¤èè¿è®²ä»ç»å¼åèªå®ä¹çæ°æ°æ®ç±»åçåºæ¬æ­¥éª¤ï¼ä»èæ»¡è¶³ä¸ªäººçç¹æ®éæ±ã\n\n\n# 3.1 é¢å lbs åºç¨ç geo ç±»å\n\næ¥å¸¸çå°å¾æç´¢ãæè½¦ç­é½ç¦»ä¸å¼åºäºä½ç½®ä¿¡æ¯æå¡ï¼location-based serviceï¼lbsï¼çåºç¨ãlbs åºç¨è®¿é®çæ°æ®æ¯åäººæç©å³èçä¸ç»ç»çº¬åº¦ä¿¡æ¯ï¼èä¸è¦è½æ¥è¯¢ç¸é»çç»çº¬åº¦èå´ï¼geo å°±éå¸¸éååºç¨å¨ lbs æå¡çåºæ¯ä¸­ï¼æä»¬æ¥çä¸ä¸å®çåºå±ç»æã\n\n# 3.1.1 geo çåºå±ç»æ\n\nä¸è¬æ¥è¯´ï¼å¨è®¾è®¡ä¸ä¸ªæ°æ®ç±»åçåºå±ç»ææ¶ï¼æä»¬é¦åéè¦ç¥éï¼è¦å¤ççæ°æ®æä»ä¹è®¿é®ç¹ç¹ãæä»¥ï¼æä»¬éè¦åææ¸æ¥ä½ç½®ä¿¡æ¯å°åºæ¯æä¹è¢«å­åçã\n\nä»¥å«è½¦æå¡ä¸ºä¾ï¼æ¥åæä¸ lbs åºç¨ä¸­ç»çº¬åº¦çå­åç¹ç¹ï¼\n\n 1. æ¯ä¸è¾ç½çº¦è½¦é½æä¸ä¸ªç¼å·ï¼ä¾å¦33ï¼ï¼ç½çº¦è½¦éè¦å°èªå·±çç»åº¦ä¿¡æ¯ï¼ä¾å¦116.034579ï¼åçº¬åº¦ä¿¡æ¯ï¼ä¾å¦39.000452 ï¼åç»å«è½¦åºç¨ã\n 2. ç¨æ·å¨å«è½¦çæ¶åï¼å«è½¦åºç¨ä¼æ ¹æ®ç¨æ·çç»çº¬åº¦ä½ç½®ï¼ä¾å¦ç»åº¦116.054579ï¼çº¬åº¦39.030452ï¼ï¼æ¥æ¾ç¨æ·çéè¿è½¦è¾ï¼å¹¶è¿è¡å¹éã\n 3. ç­æä½ç½®ç¸è¿çç¨æ·åè½¦è¾å¹éä¸ä»¥åï¼å«è½¦åºç¨å°±ä¼æ ¹æ®è½¦è¾çç¼å·ï¼è·åè½¦è¾çä¿¡æ¯ï¼å¹¶è¿åç»ç¨æ·ã\n\n----------------------------------------\n\nèè hash set ç±»åï¼\n\nå¯ä»¥çå°ï¼ä¸è¾è½¦ï¼æä¸ä¸ªç¨æ·ï¼å¯¹åºä¸ç»ç»çº¬åº¦ï¼å¹¶ä¸éçè½¦ï¼æç¨æ·ï¼çä½ç½®ç§»å¨ï¼ç¸åºçç»çº¬åº¦ä¹ä¼ååãè¿ç§æ°æ®è®°å½æ¨¡å¼å±äºä¸ä¸ªkeyï¼ä¾å¦è½¦idï¼å¯¹åºä¸ä¸ªvalueï¼ä¸ç»ç»çº¬åº¦ï¼ãå½æå¾å¤è½¦è¾ä¿¡æ¯è¦ä¿å­æ¶ï¼å°±éè¦æä¸ä¸ªéåæ¥ä¿å­ä¸ç³»åçkeyåvalueãhashéåç±»åå¯ä»¥å¿«éå­åä¸ç³»åçkeyåvalueï¼æ­£å¥½å¯ä»¥ç¨æ¥è®°å½ä¸ç³»åè½¦è¾idåç»çº¬åº¦çå¯¹åºå³ç³»ï¼æä»¥ï¼æä»¬å¯ä»¥æä¸åè½¦è¾çidåå®ä»¬å¯¹åºçç»çº¬åº¦ä¿¡æ¯å­å¨hashéåä¸­ï¼å¦ä¸å¾æç¤ºï¼\n\nåæ¶ï¼hashç±»åçhsetæä½å½ä»¤ï¼ä¼æ ¹æ®keyæ¥è®¾ç½®ç¸åºçvalueå¼ï¼æä»¥ï¼æä»¬å¯ä»¥ç¨å®æ¥å¿«éå°æ´æ°è½¦è¾ååçç»çº¬åº¦ä¿¡æ¯ãå°è¿éï¼hashç±»åçèµ·æ¥æ¯ä¸ä¸ªä¸éçéæ©ãä½é®é¢æ¯ï¼å¯¹äºä¸ä¸ªlbsåºç¨æ¥è¯´ï¼é¤äºè®°å½ç»çº¬åº¦ä¿¡æ¯ï¼è¿éè¦æ ¹æ®ç¨æ·çç»çº¬åº¦ä¿¡æ¯å¨è½¦è¾çhashéåä¸­è¿è¡èå´æ¥è¯¢ã\n\nä¸æ¦æ¶åå°èå´æ¥è¯¢ï¼å°±æå³çéåä¸­çåç´ éè¦æåºï¼ä½hashç±»åçåç´ æ¯æ åºçï¼æ¾ç¶ä¸è½æ»¡è¶³æä»¬çè¦æ±ã\n\n----------------------------------------\n\nèè sorted set ç±»åï¼\n\næä»¬åæ¥ççä½¿ç¨ sorted setç±»åæ¯ä¸æ¯åéã\n\nsorted set ç±»åä¹æ¯æä¸ä¸ª key å¯¹åºä¸ä¸ª value çè®°å½æ¨¡å¼ï¼å¶ä¸­ï¼keyå°±æ¯sorted setä¸­çåç´ ï¼èvalueåæ¯åç´ çæéåæ°ãæ´éè¦çæ¯ï¼sorted setå¯ä»¥æ ¹æ®åç´ çæéåæ°æåºï¼æ¯æèå´æ¥è¯¢ãè¿å°±è½æ»¡è¶³lbsæå¡ä¸­æ¥æ¾ç¸é»ä½ç½®çéæ±äºã\n\nå®éä¸ï¼geo ç±»åçåºå±æ°æ®ç»æå°±æ¯ç¨ sorted set æ¥å®ç°çãå±ä»¬è¿æ¯åçå«è½¦åºç¨çä¾å­æ¥å æ·±ä¸çè§£ãç¨sorted setæ¥ä¿å­è½¦è¾çç»çº¬åº¦ä¿¡æ¯æ¶ï¼sorted setçåç´ æ¯è½¦è¾idï¼åç´ çæéåæ°æ¯ç»çº¬åº¦ä¿¡æ¯ï¼å¦ä¸å¾æç¤ºï¼\n\nè¿æ¶é®é¢æ¥äºï¼sorted setåç´ çæéåæ°æ¯ä¸ä¸ªæµ®ç¹æ°ï¼floatç±»åï¼ï¼èä¸ç»ç»çº¬åº¦åå«çæ¯ç»åº¦åçº¬åº¦ä¸¤ä¸ªå¼ï¼æ¯æ²¡æ³ç´æ¥ä¿å­ä¸ºä¸ä¸ªæµ®ç¹æ°çï¼é£å·ä½è¯¥æä¹è¿è¡ä¿å­å¢ï¼è¿å°±è¦ç¨å° geo ç±»åä¸­ç geohash ç¼ç äºã\n\n# 3.1.2 geohash çç¼ç æ¹æ³\n\nä¸ºäºè½é«æå°å¯¹ç»çº¬åº¦è¿è¡æ¯è¾ï¼redis éç¨äºä¸çå¹¿æ³ä½¿ç¨ç geohash ç¼ç æ¹æ³ï¼è¿ä¸ªæ¹æ³çåºæ¬åçå°±æ¯âäºååºé´ï¼åºé´ç¼ç âã\n\nå½æä»¬è¦å¯¹ä¸ç»ç»çº¬åº¦è¿è¡ geohash ç¼ç æ¶ï¼æä»¬è¦åå¯¹ç»åº¦åçº¬åº¦åå«ç¼ç ï¼ç¶ååæç»çº¬åº¦åèªçç¼ç ç»åæä¸ä¸ªæç»ç¼ç ã\n\né¦åï¼æä»¬æ¥çä¸ç»åº¦åçº¬åº¦çåç¬ç¼ç è¿ç¨ã\n\nå¯¹äºä¸ä¸ªå°çä½ç½®ä¿¡æ¯æ¥è¯´ï¼å®çç»åº¦èå´æ¯ [-180,180] ãgeohash ç¼ç ä¼æä¸ä¸ªç»åº¦å¼ç¼ç æä¸ä¸ª n ä½çäºè¿å¶å¼ï¼æä»¬æ¥å¯¹ç»åº¦èå´ [-180,180] ånæ¬¡çäºååºæä½ï¼å¶ä¸­ n å¯ä»¥èªå®ä¹ã\n\n * å¨è¿è¡ç¬¬ä¸æ¬¡äºååºæ¶ï¼ç»åº¦èå´[-180,180]ä¼è¢«åæä¸¤ä¸ªå­åºé´ï¼[-180,0)å[0,180]ï¼æç§°ä¹ä¸ºå·¦ãå³ååºï¼ãæ­¤æ¶ï¼æä»¬å¯ä»¥æ¥çä¸ä¸è¦ç¼ç çç»åº¦å¼è½å¨äºå·¦ååºè¿æ¯å³ååºãå¦ææ¯è½å¨å·¦ååºï¼æä»¬å°±ç¨0è¡¨ç¤ºï¼å¦æè½å¨å³ååºï¼å°±ç¨1è¡¨ç¤ºãè¿æ ·ä¸æ¥ï¼æ¯åå®ä¸æ¬¡äºååºï¼æä»¬å°±å¯ä»¥å¾å°1ä½ç¼ç å¼ã\n * ç¶åï¼æä»¬åå¯¹ç»åº¦å¼æå±çååºååä¸æ¬¡äºååºï¼åæ¶åæ¬¡æ¥çç»åº¦å¼è½å¨äºäºååºåçå·¦ååºè¿æ¯å³ååºï¼æç§åæçè§ååå1ä½ç¼ç ãå½åå®næ¬¡çäºååºåï¼ç»åº¦å¼å°±å¯ä»¥ç¨ä¸ä¸ªn bitçæ°æ¥è¡¨ç¤ºäºã\n\nä¸¾ä¸ªä¾å­ï¼åè®¾æä»¬è¦ç¼ç çç»åº¦å¼æ¯116.37ï¼æä»¬ç¨5ä½ç¼ç å¼ï¼ä¹å°±æ¯n=5ï¼å5æ¬¡ååºï¼ãæä»¬ååç¬¬ä¸æ¬¡äºååºæä½ï¼æç»åº¦åºé´[-180,180]åæäºå·¦ååº[-180,0)åå³ååº[0,180]ï¼æ­¤æ¶ï¼ç»åº¦å¼116.37æ¯å±äºå³ååº[0,180]ï¼æä»¥ï¼æä»¬ç¨1è¡¨ç¤ºç¬¬ä¸æ¬¡äºååºåçç¼ç å¼ãæ¥ä¸æ¥ï¼æä»¬åç¬¬äºæ¬¡äºååºï¼æç»åº¦å¼116.37æå±ç[0,180]åºé´ï¼åæ[0,90)å[90, 180]ãæ­¤æ¶ï¼ç»åº¦å¼116.37è¿æ¯å±äºå³ååº[90,180]ï¼æä»¥ï¼ç¬¬äºæ¬¡ååºåçç¼ç å¼ä»ç¶ä¸º1ãç­å°ç¬¬ä¸æ¬¡å¯¹[90,180]è¿è¡äºååºï¼ç»åº¦å¼116.37è½å¨äºååºåçå·¦ååº[90, 135)ä¸­ï¼æä»¥ï¼ç¬¬ä¸æ¬¡ååºåçç¼ç å¼å°±æ¯0ã\n\næç§è¿ç§æ¹æ³ï¼åå®5æ¬¡ååºåï¼æä»¬æç»åº¦å¼116.37å®ä½å¨[112.5, 123.75]è¿ä¸ªåºé´ï¼å¹¶ä¸å¾å°äºç»åº¦å¼ç5ä½ç¼ç å¼ï¼å³11010ãè¿ä¸ªç¼ç è¿ç¨å¦ä¸è¡¨æç¤ºï¼\n\nå¯¹çº¬åº¦çç¼ç æ¹å¼ï¼åå¯¹ç»åº¦çä¸æ ·ï¼åªæ¯çº¬åº¦çèå´æ¯[-90ï¼90]ï¼ä¸é¢è¿å¼ è¡¨æ¾ç¤ºäºå¯¹çº¬åº¦å¼39.86çç¼ç è¿ç¨ï¼\n\nå½ä¸ç»ç»çº¬åº¦å¼é½ç¼å®ç åï¼æä»¬åæå®ä»¬çåèªç¼ç å¼ç»åå¨ä¸èµ·ï¼ç»åçè§åæ¯ï¼æç»ç¼ç å¼çå¶æ°ä½ä¸ä¾æ¬¡æ¯ç»åº¦çç¼ç å¼ï¼å¥æ°ä½ä¸ä¾æ¬¡æ¯çº¬åº¦çç¼ç å¼ï¼å¶ä¸­ï¼å¶æ°ä½ä»0å¼å§ï¼å¥æ°ä½ä»1å¼å§ã\n\næä»¬ååè®¡ç®çç»çº¬åº¦ï¼116.37ï¼39.86ï¼çåèªç¼ç å¼æ¯11010å10111ï¼ç»åä¹åï¼ç¬¬0ä½æ¯ç»åº¦çç¬¬0ä½1ï¼ç¬¬1ä½æ¯çº¬åº¦çç¬¬0ä½1ï¼ç¬¬2ä½æ¯ç»åº¦çç¬¬1ä½1ï¼ç¬¬3ä½æ¯çº¬åº¦çç¬¬1ä½0ï¼ä»¥æ­¤ç±»æ¨ï¼å°±è½å¾å°æç»ç¼ç å¼1110011101ï¼å¦ä¸å¾æç¤ºï¼\n\nç¨äº geohash ç¼ç åï¼åæ¥æ æ³ç¨ä¸ä¸ªæéåæ°è¡¨ç¤ºçä¸ç»ç»çº¬åº¦ï¼116.37ï¼39.86ï¼å°±å¯ä»¥ç¨1110011101è¿ä¸ä¸ªå¼æ¥è¡¨ç¤ºï¼å°±å¯ä»¥ä¿å­ä¸º sorted set çæéåæ°äºã\n\nå½ç¶ï¼ä½¿ç¨ geohash ç¼ç åï¼æä»¬ç¸å½äºææ´ä¸ªå°çç©ºé´ååæäºä¸ä¸ªä¸ªæ¹æ ¼ï¼æ¯ä¸ªæ¹æ ¼å¯¹åºäº geohash ä¸­çä¸ä¸ªååºã\n\nä¸¾ä¸ªä¾å­ãæä»¬æç»åº¦åºé´[-180,180]åä¸æ¬¡äºååºï¼æçº¬åº¦åºé´[-90,90]åä¸æ¬¡äºååºï¼å°±ä¼å¾å°4ä¸ªååºãæä»¬æ¥çä¸å®ä»¬çç»åº¦åçº¬åº¦èå´ä»¥åå¯¹åºçgeohashç»åç¼ç ã\n\n * ååºä¸ï¼[-180,0)å[-90,0)ï¼ç¼ç 00ï¼\n * ååºäºï¼[-180,0)å[0,90]ï¼ç¼ç 01ï¼\n * ååºä¸ï¼[0,180]å[-90,0)ï¼ç¼ç 10ï¼\n * ååºåï¼[0,180]å[0,90]ï¼ç¼ç 11ã\n\nè¿4ä¸ªååºå¯¹åºäº4ä¸ªæ¹æ ¼ï¼æ¯ä¸ªæ¹æ ¼è¦çäºä¸å®èå´åçç»çº¬åº¦å¼ï¼ååºè¶å¤ï¼æ¯ä¸ªæ¹æ ¼è½è¦çå°çå°çç©ºé´å°±è¶å°ï¼ä¹å°±è¶ç²¾åãæä»¬ææææ¹æ ¼çç¼ç å¼æ å°å°ä¸ç»´ç©ºé´æ¶ï¼ç¸é»æ¹æ ¼ç geohash ç¼ç å¼åºæ¬ä¹æ¯æ¥è¿çï¼å¦ä¸å¾æç¤ºï¼\n\næä»¥ï¼æä»¬ä½¿ç¨ sorted set èå´æ¥è¯¢å¾å°çç¸è¿ç¼ç å¼ï¼å¨å®éçå°çç©ºé´ä¸ï¼ä¹æ¯ç¸é»çæ¹æ ¼ï¼è¿å°±å¯ä»¥å®ç°lbsåºç¨âæç´¢éè¿çäººæç©âçåè½äºã\n\nä¸è¿è¦æ³¨æï¼æçç¼ç å¼è½ç¶å¨å¤§å°ä¸æ¥è¿ï¼ä½å®éå¯¹åºçæ¹æ ¼å´è·ç¦»æ¯è¾è¿ãä¾å¦ï¼æä»¬ç¨4ä½æ¥ågeohashç¼ç ï¼æç»åº¦åºé´[-180,180]åçº¬åº¦åºé´[-90,90]ååæäº4ä¸ªååºï¼ä¸å±16ä¸ªååºï¼å¯¹åºäº16ä¸ªæ¹æ ¼ãç¼ç å¼ä¸º0111å1000çä¸¤ä¸ªæ¹æ ¼å°±ç¦»å¾æ¯è¾è¿ï¼å¦ä¸å¾æç¤ºï¼\n\næä»¥ï¼ä¸ºäºé¿åæ¥è¯¢ä¸åç¡®é®é¢ï¼æä»¬å¯ä»¥åæ¶æ¥è¯¢ç»å®ç»çº¬åº¦æå¨çæ¹æ ¼å¨å´ç4ä¸ªæ8ä¸ªæ¹æ ¼ã\n\næ»ç»ä¸ä¸ï¼geo ç±»åæ¯æç»çº¬åº¦æå¨çåºé´ç¼ç ä½ä¸ºsorted setä¸­åç´ çæéåæ°ï¼æåç»çº¬åº¦ç¸å³çè½¦è¾ id ä½ä¸º sorted set ä¸­åç´ æ¬èº«çå¼ä¿å­ä¸æ¥ï¼è¿æ ·ç¸é»ç»çº¬åº¦çæ¥è¯¢å°±å¯ä»¥éè¿ç¼ç å¼çå¤§å°èå´æ¥è¯¢æ¥å®ç°äºãæ¥ä¸æ¥ï¼æä»¬åæ¥èèå·ä½å¦ä½æä½ geo ç±»åã\n\n# 3.1.3 å¦ä½æä½ geo ç±»åï¼\n\næä½ geo ç±»åç»å¸¸ä½¿ç¨ä¸¤ä¸ªå½ä»¤ï¼\n\n * geoadd å½ä»¤ï¼ç¨äºæä¸ç»ç»çº¬åº¦ä¿¡æ¯åç¸å¯¹åºçä¸ä¸ª id è®°å½å° geo ç±»åéåä¸­ï¼\n * georadius å½ä»¤ï¼ä¼æ ¹æ®è¾å¥çç»çº¬åº¦ä½ç½®ï¼æ¥æ¾ä»¥è¿ä¸ªç»çº¬åº¦ä¸ºä¸­å¿çä¸å®èå´åçå¶ä»åç´ ãå½ç¶ï¼æä»¬å¯ä»¥èªå·±å®ä¹è¿ä¸ªèå´ã\n\næè¿æ¯ä»¥âå«è½¦åºç¨âçè½¦è¾å¹éåºæ¯ä¸ºä¾ï¼ä»ç»ä¸å·ä½å¦ä½ä½¿ç¨è¿ä¸¤ä¸ªå½ä»¤ã\n\n----------------------------------------\n\ngeoadd å½ä»¤ï¼\n\nåè®¾è½¦è¾idæ¯33ï¼ç»çº¬åº¦ä½ç½®æ¯ï¼116.034579ï¼39.030452ï¼ï¼æä»¬å¯ä»¥ç¨ä¸ä¸ª geo éåä¿å­ææè½¦è¾çç»çº¬åº¦ï¼éå key æ¯ cars:locationsãæ§è¡ä¸é¢çè¿ä¸ªå½ä»¤ï¼å°±å¯ä»¥æ id å·ä¸º 33 çè½¦è¾çå½åç»çº¬åº¦ä½ç½®å­å¥ geo éåä¸­ï¼\n\ngeoadd cars:locations 116.034579 39.030452 33\n\n\n1\n\n\n----------------------------------------\n\ngeoradius å½ä»¤ï¼\n\nå½ç¨æ·æ³è¦å¯»æ¾èªå·±éè¿çç½çº¦è½¦æ¶ï¼lbs åºç¨å°±å¯ä»¥ä½¿ç¨ georadius å½ä»¤ï¼\n\nä¾å¦ï¼lbs åºç¨æ§è¡ä¸é¢çå½ä»¤æ¶ï¼redis ä¼æ ¹æ®è¾å¥çç¨æ·çç»çº¬åº¦ä¿¡æ¯ï¼116.054579ï¼39.030452 ï¼ï¼æ¥æ¾ä»¥è¿ä¸ªç»çº¬åº¦ä¸ºä¸­å¿ç5å¬éåçè½¦è¾ä¿¡æ¯ï¼å¹¶è¿åç»lbsåºç¨ãå½ç¶ï¼ ä½ å¯ä»¥ä¿®æ¹â5âè¿ä¸ªåæ°ï¼æ¥è¿åæ´å¤§ææ´å°èå´åçè½¦è¾ä¿¡æ¯ã\n\ngeoradius cars:locations 116.054579 39.030452 5 km asc count 10\n\n\n1\n\n\nå¦å¤ï¼æä»¬è¿å¯ä»¥è¿ä¸æ­¥éå®è¿åçè½¦è¾ä¿¡æ¯ãæ¯å¦ï¼æä»¬å¯ä»¥ä½¿ç¨ascéé¡¹ï¼è®©è¿åçè½¦è¾ä¿¡æ¯æç§è·ç¦»è¿ä¸ªä¸­å¿ä½ç½®ä»è¿å°è¿çæ¹å¼æ¥æåºï¼ä»¥æ¹ä¾¿éæ©æè¿çè½¦è¾ï¼è¿å¯ä»¥ä½¿ç¨countéé¡¹ï¼æå®è¿åçè½¦è¾ä¿¡æ¯çæ°éãæ¯ç«ï¼5å¬éèå´åçè½¦è¾å¯è½æå¾å¤ï¼å¦æè¿åå¨é¨ä¿¡æ¯ï¼ä¼å ç¨æ¯è¾å¤çæ°æ®å¸¦å®½ï¼è¿ä¸ªéé¡¹å¯ä»¥å¸®å©æ§å¶è¿åçæ°æ®éï¼èçå¸¦å®½ã\n\nå¯ä»¥çå°ï¼ä½¿ç¨ geo æ°æ®ç±»åå¯ä»¥éå¸¸è½»æ¾å°æä½ç»çº¬åº¦è¿ç§ä¿¡æ¯ã\n\nå°½ç®¡ redis æå¦æ­¤å¤æ°æ®ç±»åï¼ä½æ¯æäºåºæ¯ä¸ï¼æä»¬å¯¹æ°æ®ç±»åä¼æç¹æ®éæ±ãæ¥ä¸æ¥å°±ä»ç» redis çèªå®ä¹æ°æ®ç±»åãè¿æ ·ä½ å°±å¯ä»¥å®å¶ç¬¦åèªå·±éæ±çæ°æ®ç±»åäºã\n\n\n# 3.2 å¦ä½èªå®ä¹æ°æ®ç±»å\n\nä¸ºäºå®ç°èªå®ä¹æ°æ®ç±»åï¼é¦åï¼æä»¬éè¦äºè§£ redis çåºæ¬å¯¹è±¡ç»æ redisobjectï¼å ä¸º redis é®å¼å¯¹ä¸­çæ¯ä¸ä¸ªå¼é½æ¯ç¨ redisobject ä¿å­çã\n\n# 3.2.1 redis çåºæ¬å¯¹è±¡ç»æï¼redisobject\n\nredisobject ä¸»è¦åæ¬åæ°æ®åæéï¼\n\n * åæ°æ®ä¸»è¦ç¨æ¥åºåä¸åçæ°æ®ç±»åï¼\n * æéç¨æ¥æåå·ä½çå¼ã\n\nå·ä½èè¨ï¼redisobject åé¨åå«ï¼\n\n * typeï¼è¡¨ç¤ºå¼çç±»åï¼æ¶µçäºæä»¬åé¢å­¦ä¹ çäºå¤§åºæ¬ç±»åï¼\n * encodingï¼æ¯å¼çç¼ç æ¹å¼ï¼ç¨æ¥è¡¨ç¤ºredisä¸­å®ç°åä¸ªåºæ¬ç±»åçåºå±æ°æ®ç»æï¼ä¾å¦sdsãåç¼©åè¡¨ãåå¸è¡¨ãè·³è¡¨ç­ï¼\n * lruï¼è®°å½äºè¿ä¸ªå¯¹è±¡æåä¸æ¬¡è¢«è®¿é®çæ¶é´ï¼ç¨äºæ·æ±°è¿æçé®å¼å¯¹ï¼\n * refcountï¼è®°å½äºå¯¹è±¡çå¼ç¨è®¡æ°ï¼\n * *ptrï¼æ¯æåæ°æ®çæéã\n\nredisobjectç»æåå© *ptr æéï¼å°±å¯ä»¥æåä¸åçæ°æ®ç±»åï¼ä¾å¦ï¼ *ptr æåä¸ä¸ªsdsæä¸ä¸ªè·³è¡¨ï¼å°±è¡¨ç¤ºé®å¼å¯¹ä¸­çå¼æ¯stringç±»åæsorted setç±»åãæä»¥ï¼æä»¬å¨å®ä¹äºæ°çæ°æ®ç±»ååï¼ä¹åªè¦å¨redisobjectä¸­è®¾ç½®å¥½æ°ç±»åçtypeåencodingï¼åç¨ *ptr æåæ°ç±»åçå®ç°ï¼å°±è¡äºã\n\n# 3.2.2 å¼åä¸ä¸ªæ°çæ°æ®ç±»å\n\näºè§£äº redisobject ç»æåï¼å®ä¹ä¸ä¸ªæ°çæ°æ®ç±»åä¹å°±ä¸é¾äºãé¦åï¼æä»¬éè¦ä¸ºæ°æ°æ®ç±»åå®ä¹å¥½å®çåºå±ç»æãtype å encoding å±æ§å¼ï¼ç¶ååå®ç°æ°æ°æ®ç±»åçåå»ºãéæ¾å½æ°ååºæ¬å½ä»¤ã\n\næä»¥å¼åä¸ä¸ªåå­å«ä½ newtypeobject çæ°æ°æ®ç±»åä¸ºä¾ï¼æ¥è§£éä¸å·ä½ç4ä¸ªæä½æ­¥éª¤ï¼\n\n----------------------------------------\n\nç¬¬ä¸æ­¥ï¼å®ä¹æ°æ°æ®ç±»åçåºå±ç»æ.\n\næä»¬ç¨ newtype.h æä»¶æ¥ä¿å­è¿ä¸ªæ°ç±»åçå®ä¹ï¼å·ä½å®ä¹çä»£ç å¦ä¸æç¤ºï¼\n\nstruct newtypeobject {\n    struct newtypenode *head;\n    size_t len;\n} newtypeobject;\n\n\n1\n2\n3\n4\n\n\nå¶ä¸­ï¼newtypenode ç»æå°±æ¯æä»¬èªå®ä¹çæ°ç±»åçåºå±ç»æãæä»¬ä¸ºåºå±ç»æè®¾è®¡ä¸¤ä¸ªæååéï¼ä¸ä¸ªæ¯longç±»åçvalueå¼ï¼ç¨æ¥ä¿å­å®éæ°æ®ï¼ä¸ä¸ªæ¯ *next æéï¼æåä¸ä¸ä¸ª newtypenode ç»æã\n\nstruct newtypenode {\n    long value;\n    struct newtypenode *next;\n};\n\n\n1\n2\n3\n4\n\n\nä»ä»£ç ä¸­å¯ä»¥çå°ï¼newtypeobject ç±»åçåºå±ç»æå¶å®å°±æ¯ä¸ä¸ª long ç±»åçååé¾è¡¨ãå½ç¶ï¼ä½ è¿å¯ä»¥æ ¹æ®èªå·±çéæ±ï¼æ newtypeobject çåºå±ç»æå®ä¹ä¸ºå¶ä»ç±»åãä¾å¦ï¼å¦ææä»¬æ³è¦ newtypeobject çæ¥è¯¢æçæ¯é¾è¡¨é«ï¼å°±å¯ä»¥æå®çåºå±ç»æè®¾è®¡æä¸é¢b+æ ã\n\n----------------------------------------\n\nç¬¬äºæ­¥ï¼å¨redisobjectçtypeå±æ§ä¸­ï¼å¢å è¿ä¸ªæ°ç±»åçå®ä¹.\n\nè¿ä¸ªå®ä¹æ¯å¨ redis ç server.h æä»¶ä¸­ãæ¯å¦ï¼æä»¬å¢å ä¸ä¸ªå«ä½ obj_newtype çå®å®ä¹ï¼ç¨æ¥å¨ä»£ç ä¸­æä»£ newtypeobject è¿ä¸ªæ°ç±»åï¼\n\n#define obj_string 0    /* string object. */\n#define obj_list 1      /* list object. */\n#define obj_set 2       /* set object. */\n#define obj_zset 3      /* sorted set object. */\nâ¦\n#define obj_newtype 7\n\n\n1\n2\n3\n4\n5\n6\n\n\n----------------------------------------\n\nç¬¬ä¸æ­¥ï¼å¼åæ°ç±»åçåå»ºåéæ¾å½æ°.\n\nredis ææ°æ®ç±»åçåå»ºåéæ¾å½æ°é½å®ä¹å¨äº object.c æä»¶ä¸­ãæä»¥ï¼æä»¬å¯ä»¥å¨è¿ä¸ªæä»¶ä¸­å¢å  newtypeobject çåå»ºå½æ° createnewtypeobjectï¼å¦ä¸æç¤ºï¼\n\nrobj *createnewtypeobject(void){\n   newtypeobject *h = newtypenew();\n   robj *o = createobject(obj_newtype,h);\n   return o;\n}\n\n\n1\n2\n3\n4\n5\n\n\ncreatenewtypeobject åå«è°ç¨äº newtypenew å createobject ä¸¤ä¸ªå½æ°ï¼æåå«æ¥ä»ç»ä¸ï¼\n\n * newtypenew å½æ°ï¼ç¨æ¥ä¸ºæ°æ°æ®ç±»ååå§ååå­ç»æçãè¿ä¸ªåå§åè¿ç¨ä¸»è¦æ¯ç¨zmallocååºå±ç»æåéç©ºé´ï¼ä»¥ä¾¿åå¥æ°æ®ï¼\n\nnewtypeobject *newtypenew(void){\n    newtypeobject *n = zmalloc(sizeof(*n));\n    n->head = null;\n    n->len = 0;\n    return n;\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nnewtypenew å½æ°æ¶åå°æ°æ°æ®ç±»åçå·ä½åå»ºï¼è redis é»è®¤ä¼ä¸ºæ¯ä¸ªæ°æ®ç±»åå®ä¹ä¸ä¸ªåç¬æä»¶ï¼å®ç°è¿ä¸ªç±»åçåå»ºåå½ä»¤æä½ï¼ä¾å¦ï¼t_string.cåt_list.cåå«å¯¹åºstringålistç±»åãæç§redisçæ¯ä¾ï¼æä»¬å°±ænewtypenewå½æ°å®ä¹å¨åä¸º t_newtype.c çæä»¶ä¸­ã\n\n * createobject å½æ°ï¼redisæ¬èº«æä¾çredisobjectåå»ºå½æ°ï¼å®çåæ°æ¯æ°æ®ç±»åçtypeåæåæ°æ®ç±»åå®ç°çæéã\n\næä»¬ç» createobject å½æ°ä¸­ä¼ å¥äºä¸¤ä¸ªåæ°ï¼åå«æ¯æ°ç±»åç type å¼ obj_newtypeï¼ä»¥åæåä¸ä¸ªåå§åè¿ç newtypeobjec çæéãè¿æ ·ä¸æ¥ï¼åå»ºç redisobject å°±è½æåæä»¬èªå®ä¹çæ°æ°æ®ç±»åäºï¼\n\nrobj *createobject(int type, void *ptr) {\n    robj *o = zmalloc(sizeof(*o));\n    o->type = type;\n    o->ptr = ptr;\n    ...\n    return o;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¯¹äºéæ¾å½æ°æ¥è¯´ï¼å®æ¯åå»ºå½æ°çåè¿ç¨ï¼æ¯ç¨zfreeå½ä»¤ææ°ç»æçåå­ç©ºé´éæ¾æã\n\nç¬¬åæ­¥ï¼å¼åæ°ç±»åçå½ä»¤æä½.\n\nç®åæ¥è¯´ï¼å¢å ç¸åºçå½ä»¤æä½çè¿ç¨å¯ä»¥åæä¸å°æ­¥ï¼\n\n 1. å¨ t_newtype.c æä»¶ä¸­å¢å å½ä»¤æä½çå®ç°ãæ¯å¦è¯´ï¼æä»¬å®ä¹ ntinsertcommand å½æ°ï¼ç±å®å®ç°å¯¹ newtypeobject ååé¾è¡¨çæå¥æä½ï¼\n\nvoid ntinsertcommand(client *c){\n  //åºäºå®¢æ·ç«¯ä¼ éçåæ°ï¼å®ç°å¨newtypeobjecté¾è¡¨å¤´æå¥åç´ \n}\n\n\n1\n2\n3\n\n 2. å¨ server.h æä»¶ä¸­ï¼å£°ææä»¬å·²ç»å®ç°çå½ä»¤ï¼ä»¥ä¾¿å¨ server.c æä»¶å¼ç¨è¿ä¸ªå½ä»¤ï¼ä¾å¦ï¼\n\nvoid ntinsertcommand(client *c)\n\n\n1\n\n 3. å¨ server.c æä»¶ä¸­ç rediscommandtable éé¢ï¼ææ°å¢å½ä»¤åå®ç°å½æ°å³èèµ·æ¥ãä¾å¦ï¼æ°å¢ç ntinsert å½ä»¤ç± ntinsertcommand å½æ°å®ç°ï¼æä»¬å°±å¯ä»¥ç¨ ntinsert å½ä»¤ç» newtypeobject æ°æ®ç±»åæå¥åç´ äºï¼\n\nstruct rediscommand rediscommandtable[] = {\n    ...\n    {"ntinsert",ntinsertcommand,2,"m",...}\n}\n\n\n1\n2\n3\n4\n\n\næ­¤æ¶ï¼æä»¬å°±å®æäºä¸ä¸ªèªå®ä¹ç newtypeobject æ°æ®ç±»åï¼å¯ä»¥å®ç°åºæ¬çå½ä»¤æä½äºãå½ç¶ï¼å¦æä½ è¿å¸ææ°çæ°æ®ç±»åè½è¢«æä¹åä¿å­ï¼æä»¬è¿éè¦å¨ redis ç rdb å aof æ¨¡åä¸­å¢å å¯¹æ°æ°æ®ç±»åè¿è¡æä¹åä¿å­çä»£ç ï¼æä¼å¨åé¢çå é¤ä¸­ååä½ åäº«ã\n\n\n# 3.3 å°ç»\n\nè¿ä¸èè¦å­¦ä¹ äº redis çæ©å±ç±»åï¼geo ç±»åãå®å¯ä»¥è®°å½ç»çº¬åº¦å½¢å¼çå°çä½ç½®ä¿¡æ¯ï¼è¢«å¹¿æ³å°åºç¨å¨lbsæå¡ä¸­ãgeo æ¬èº«å¹¶æ²¡æè®¾è®¡æ°çåºå±æ°æ®ç»æï¼èæ¯ç´æ¥ä½¿ç¨äº sorted set éåç±»åã\n\ngeoç±»åä½¿ç¨geohashç¼ç æ¹æ³å®ç°äºç»çº¬åº¦å°sorted setä¸­åç´ æéåæ°çè½¬æ¢ï¼è¿å¶ä¸­çä¸¤ä¸ªå³é®æºå¶å°±æ¯å¯¹äºç»´å°å¾ååºé´ååï¼ä»¥åå¯¹åºé´è¿è¡ç¼ç ãä¸ç»ç»çº¬åº¦è½å¨æä¸ªåºé´åï¼å°±ç¨åºé´çç¼ç å¼æ¥è¡¨ç¤ºï¼å¹¶æç¼ç å¼ä½ä¸ºsorted setåç´ çæéåæ°ãè¿æ ·ä¸æ¥ï¼æä»¬å°±å¯ä»¥æç»çº¬åº¦ä¿å­å°sorted setä¸­ï¼å©ç¨sorted setæä¾çâææéè¿è¡æåºèå´æ¥æ¾âçç¹æ§ï¼å®ç°lbsæå¡ä¸­é¢ç¹ä½¿ç¨çâæç´¢éè¿âçéæ±ã\n\nä¹ååè®²è§£äºå¨ redis ä¸­æ©å±èªå®ä¹æ°æ®ç»æçæ¹å¼ã\n\næ©å±æ°æ®ç±»åçä¸¤ç§å®ç°éå¾\n\n * ä¸ç§æ¯åºäºç°æçæ°æ®ç±»åï¼éè¿æ°æ®ç¼ç ææ¯å®ç°æ°çæä½çæ¹å¼ï¼æ¥å®ç°æ©å±æ°æ®ç±»åï¼ä¾å¦åºäºsorted setågeohashç¼ç å®ç°geoï¼ä»¥ååºäºstringåä½æä½å®ç°bitmapï¼\n * å¦ä¸ç§å°±æ¯å¼åèªå®ä¹çæ°æ®ç±»åï¼å·ä½çæä½æ¯å¢å æ°æ°æ®ç±»åçå®ä¹ï¼å®ç°åå»ºåéæ¾å½æ°ï¼å®ç°æ°æ°æ®ç±»åæ¯æçå½ä»¤æä½ï¼å»ºè®®ä½ å°è¯çæä»å¤©å­¦å°çåå®¹çµæ´»å°åºç¨å°ä½ çå·¥ä½åºæ¯ä¸­ã\n\n----------------------------------------\n\næ¬èé®é¢ï¼é¤äºæä»¬è®²å°çäºå¤§åºæ¬æ°æ®ç±»åï¼è¿ç¨è¿ä»ä¹å«çæ°æ®ç±»åï¼\n\nredisè¿æä¸ç§æ°æ®ç±»åï¼å«ä½å¸éè¿æ»¤å¨ãå®çæ¥è¯¢æçå¾é«ï¼ç»å¸¸ä¼ç¨å¨ç¼å­åºæ¯ä¸­ï¼å¯ä»¥ç¨æ¥å¤æ­æ°æ®æ¯å¦å­å¨ç¼å­ä¸­ãä¼å¨åé¢ï¼ç¬¬25è®²ï¼å·ä½å°ä»ç»ä¸ä¸å®ã',charsets:{cjk:!0},lastUpdated:"2023/04/10, 14:17:28",lastUpdatedTimestamp:1681136248e3},{title:"æ¶é´åºåæ°æ®çä¿å­",frontmatter:{title:"æ¶é´åºåæ°æ®çä¿å­",date:"2023-04-06T10:27:39.000Z",permalink:"/pages/a3ed18/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/14.%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BF%9D%E5%AD%98.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/14.æ¶é´åºåæ°æ®çä¿å­.md",key:"v-3fe17966",path:"/pages/a3ed18/",headers:[{level:2,title:"1. å¦ä½å¨ Redis ä¸­ä¿å­æ¶é´åºåæ°æ®ï¼",slug:"_1-å¦ä½å¨-redis-ä¸­ä¿å­æ¶é´åºåæ°æ®",normalizedTitle:"1. å¦ä½å¨ redis ä¸­ä¿å­æ¶é´åºåæ°æ®ï¼",charIndex:48},{level:3,title:"1.1 æ¶é´åºåæ°æ®çè¯»åç¹ç¹",slug:"_1-1-æ¶é´åºåæ°æ®çè¯»åç¹ç¹",normalizedTitle:"1.1 æ¶é´åºåæ°æ®çè¯»åç¹ç¹",charIndex:377},{level:4,title:"1ï¼ åç¹ç¹",slug:"_1-åç¹ç¹",normalizedTitle:"1ï¼ åç¹ç¹",charIndex:396},{level:4,title:"2ï¼ è¯»ç¹ç¹",slug:"_2-è¯»ç¹ç¹",normalizedTitle:"2ï¼ è¯»ç¹ç¹",charIndex:568},{level:3,title:"1.2 åºäº Hash å Sorted Set ä¿å­æ¶é´åºåæ°æ®",slug:"_1-2-åºäº-hash-å-sorted-set-ä¿å­æ¶é´åºåæ°æ®",normalizedTitle:"1.2 åºäº hash å sorted set ä¿å­æ¶é´åºåæ°æ®",charIndex:922},{level:4,title:"1.2.1 ä¸ºä»ä¹è¦åæ¶ä½¿ç¨è¿ä¸¤ç§ç±»åï¼",slug:"_1-2-1-ä¸ºä»ä¹è¦åæ¶ä½¿ç¨è¿ä¸¤ç§ç±»å",normalizedTitle:"1.2.1 ä¸ºä»ä¹è¦åæ¶ä½¿ç¨è¿ä¸¤ç§ç±»åï¼",charIndex:1054},{level:4,title:"1.2.2 å¦ä½ä¿è¯åå­æ§ï¼",slug:"_1-2-2-å¦ä½ä¿è¯åå­æ§",normalizedTitle:"1.2.2 å¦ä½ä¿è¯åå­æ§ï¼",charIndex:2059},{level:4,title:"1.2.3 å¦ä½å¯¹æ¶é´åºåæ°æ®èåè®¡ç®ï¼",slug:"_1-2-3-å¦ä½å¯¹æ¶é´åºåæ°æ®èåè®¡ç®",normalizedTitle:"1.2.3 å¦ä½å¯¹æ¶é´åºåæ°æ®èåè®¡ç®ï¼",charIndex:3058},{level:3,title:"1.3 åºäº RedisTimeSeries æ¨¡åä¿å­æ¶é´åºåæ°æ®",slug:"_1-3-åºäº-redistimeseries-æ¨¡åä¿å­æ¶é´åºåæ°æ®",normalizedTitle:"1.3 åºäº redistimeseries æ¨¡åä¿å­æ¶é´åºåæ°æ®",charIndex:3225},{level:4,title:"1.3.1 RedisTimeSeries éåçåºæ¯",slug:"_1-3-1-redistimeseries-éåçåºæ¯",normalizedTitle:"1.3.1 redistimeseries éåçåºæ¯",charIndex:3262},{level:4,title:"1.3.2 RedisTimeSeries æ¯ä»ä¹",slug:"_1-3-2-redistimeseries-æ¯ä»ä¹",normalizedTitle:"1.3.2 redistimeseries æ¯ä»ä¹",charIndex:4205},{level:3,title:"1.4 å°ç»",slug:"_1-4-å°ç»",normalizedTitle:"1.4 å°ç»",charIndex:6770}],headersStr:"1. å¦ä½å¨ Redis ä¸­ä¿å­æ¶é´åºåæ°æ®ï¼ 1.1 æ¶é´åºåæ°æ®çè¯»åç¹ç¹ 1ï¼ åç¹ç¹ 2ï¼ è¯»ç¹ç¹ 1.2 åºäº Hash å Sorted Set ä¿å­æ¶é´åºåæ°æ® 1.2.1 ä¸ºä»ä¹è¦åæ¶ä½¿ç¨è¿ä¸¤ç§ç±»åï¼ 1.2.2 å¦ä½ä¿è¯åå­æ§ï¼ 1.2.3 å¦ä½å¯¹æ¶é´åºåæ°æ®èåè®¡ç®ï¼ 1.3 åºäº RedisTimeSeries æ¨¡åä¿å­æ¶é´åºåæ°æ® 1.3.1 RedisTimeSeries éåçåºæ¯ 1.3.2 RedisTimeSeries æ¯ä»ä¹ 1.4 å°ç»",content:'> åèï¼\n> \n>  * 14 å¦ä½å¨ Redis ä¸­ä¿å­æ¶é´åºåæ°æ®ï¼| æå®¢æ¶é´\n\n\n# 1. å¦ä½å¨ Redis ä¸­ä¿å­æ¶é´åºåæ°æ®ï¼\n\næä»¬ç»å¸¸é¢ä¸´è¿æ ·ä¸ä¸ªéæ±ï¼è®°å½ç¨æ·å¨ç½ç«æè App ä¸çç¹å»è¡ä¸ºæ°æ®ï¼æ¥åæç¨æ·è¡ä¸ºãè¿éçæ°æ®ä¸è¬åæ¬ç¨æ· IDãè¡ä¸ºç±»åï¼ä¾å¦æµè§ãç»å½ãä¸åç­ï¼ãè¡ä¸ºåççæ¶é´æ³ï¼\n\nUserID, Type, TimeStamp\n\n\n1\n\n\nè¿äºä¸åçæ¶é´ç¸å³çä¸ç»æ°æ®ï¼å°±æ¯æ¶é´åºåæ°æ®ãè¿äºæ°æ®çç¹ç¹æ¯æ²¡æä¸¥æ ¼çå³ç³»æ¨¡åï¼è®°å½çä¿¡æ¯å¯ä»¥è¡¨ç¤ºæé®åå¼çå³ç³»ï¼ä¾å¦ï¼ä¸ä¸ªè®¾å¤IDå¯¹åºä¸æ¡è®°å½ï¼ï¼æä»¥ï¼å¹¶ä¸éè¦ä¸é¨ç¨å³ç³»åæ°æ®åºï¼ä¾å¦ MySQLï¼æ¥ä¿å­ãè Redis çé®å¼æ°æ®æ¨¡åï¼æ­£å¥½å¯ä»¥æ»¡è¶³è¿éçæ°æ®å­åéæ±ãRedis åºäºèªèº«æ°æ®ç»æä»¥åæ©å±æ¨¡åï¼æä¾äºä¸¤ç§è§£å³æ¹æ¡ãæä»¬å¨è¿éå¯¹å¶è¿è¡è®¨è®ºã\n\n\n# 1.1 æ¶é´åºåæ°æ®çè¯»åç¹ç¹\n\n# 1ï¼ åç¹ç¹\n\nå¨å®éåºç¨ä¸­ï¼æ¶é´åºåæ°æ®éå¸¸æ¯æç»­é«å¹¶ååå¥çï¼è¿äºæ°æ®çåå¥ä¸»è¦æ¯æå¥æ°æ°æ®ï¼èä¸æ¯æ´æ°æ°æ®ï¼ä¹å°±æ¯è¯´ï¼ä¸ä¸ªæ¶é´åºåæ°æ®è¢«è®°å½åéå¸¸å°±ä¸ä¼åäºãå ä¸ºè¿äºæ°æ®å¾å¾ä»£è¡¨æä¸ªè®¾å¤å¨æä¸ªæ¶å»çæµéå¼ã\n\næä»¥ï¼è¿ç§æ°æ®çåå¥ç¹ç¹å¾ç®åï¼å°±æ¯æå¥æ°æ®å¿«ï¼è¿å°±è¦æ±æä»¬éæ©çæ°æ®ç±»åï¼å¨è¿è¡æ°æ®æå¥æ¶ï¼å¤æåº¦è¦ä½ï¼å°½éä¸è¦é»å¡ã\n\n# 2ï¼ è¯»ç¹ç¹\n\næä»¬å¨æ¥è¯¢æ¶é´åºåæ°æ®æ¶ï¼æ¢æå¯¹åæ¡è®°å½çæ¥è¯¢ï¼å¦æ¥è¯¢ä¸ä¸ªè®¾å¤çææ¶å»ç¶æï¼ï¼ä¹æå¯¹æä¸ªæ¶é´èå´åçæ°æ®çæ¥è¯¢ï¼å¦æ¥çä¸ä¸åææè®¾å¤çç¶æï¼ãé¤æ­¤ä¹å¤ï¼è¿æä¸äºæ´å¤æçæ¥è¯¢ï¼æ¯å¦å¯¹æä¸ªæ¶é´èå´åçæ°æ®åèåè®¡ç®ï¼å¦è®¡ç®åå¼ãæ±æå¤§å¼ç­ã\n\næ¦æ¬æ¶é´åºåæ°æ®çç¹ç¹ï¼æ¥è¯¢æ¨¡å¼å¤ã\n\nå¼æ¸æ¥äºæ¶é´åºåæ°æ®çè¯»åç¹ç¹ï¼æ¥ä¸æ¥æä»¬å°±ççå¦ä½å¨ Redis ä¸­ä¿å­è¿äºæ°æ®ãæä»¬æ¥åæä¸ï¼éå¯¹æ¶é´åºåæ°æ®çâåè¦å¿«âï¼Redisçé«æ§è½åç¹æ§ç´æ¥å°±å¯ä»¥æ»¡è¶³äºï¼èéå¯¹âæ¥è¯¢æ¨¡å¼å¤âï¼ä¹å°±æ¯è¦æ¯æåç¹æ¥è¯¢ãèå´æ¥è¯¢åèåè®¡ç®ï¼Redis æä¾äºä¿å­æ¶é´åºåæ°æ®çä¸¤ç§æ¹æ¡ï¼åå«æ¯ï¼\n\n * åºäº Hash å Sorted Set å®ç°ï¼\n * åºäº RedisTimeSeries æ¨¡åå®ç°ã\n\n\n# 1.2 åºäº Hash å Sorted Set ä¿å­æ¶é´åºåæ°æ®\n\nHash å Sorted Set ç»åçæ¹å¼æä¸ä¸ªææ¾çå¥½å¤ï¼å®ä»¬æ¯ Redis åå¨çæ°æ®ç±»åï¼ä»£ç æçåæ§è½ç¨³å®ãæä»¥ï¼åºäºè¿ä¸¤ä¸ªæ°æ®ç±»åä¿å­æ¶é´åºåæ°æ®ï¼ç³»ç»ç¨³å®æ§æ¯å¯ä»¥é¢æçã\n\n# 1.2.1 ä¸ºä»ä¹è¦åæ¶ä½¿ç¨è¿ä¸¤ç§ç±»åï¼\n\nä¸è¿ï¼å¨åé¢å­¦ä¹ çåºæ¯ä¸­ï¼æä»¬é½æ¯ä½¿ç¨ä¸ä¸ªæ°æ®ç±»åæ¥å­åæ°æ®ï¼é£ä¹ï¼ä¸ºä»ä¹ä¿å­æ¶é´åºåæ°æ®ï¼è¦åæ¶ä½¿ç¨è¿ä¸¤ç§ç±»åï¼è¿æ¯æä»¬è¦åç­çç¬¬ä¸ä¸ªé®é¢ã\n\nå³äº Hash ç±»åï¼æä»¬é½ç¥éï¼å®æä¸ä¸ªç¹ç¹æ¯ï¼å¯ä»¥å®ç°å¯¹åé®çå¿«éæ¥è¯¢ãè¿å°±æ»¡è¶³äºæ¶é´åºåæ°æ®çåé®æ¥è¯¢éæ±ãæä»¬å¯ä»¥ææ¶é´æ³ä½ä¸º Hash éåç keyï¼æè®°å½çè®¾å¤ç¶æå¼ä½ä¸º Hash éåç valueã\n\nå¯ä»¥çä¸ç¨ Hash éåè®°å½è®¾å¤çæ¸©åº¦å¼çç¤ºæå¾ï¼\n\nå½æä»¬æ³è¦æ¥è¯¢æä¸ªæ¶é´ç¹æèæ¯å¤ä¸ªæ¶é´ç¹ä¸çæ¸©åº¦æ°æ®æ¶ï¼ç´æ¥ä½¿ç¨ HGET å½ä»¤æè HMGET å½ä»¤ï¼å°±å¯ä»¥åå«è·å¾ Hash éåä¸­çä¸ä¸ª key åå¤ä¸ª key ç value å¼äºãç¤ºä¾å¦ä¸ï¼\n\nç¨HGETå½ä»¤æ¥è¯¢202008030905è¿ä¸ªæ¶å»çæ¸©åº¦å¼ï¼ä½¿ç¨HMGETæ¥è¯¢202008030905ã202008030907ã202008030908è¿ä¸ä¸ªæ¶å»çæ¸©åº¦å¼ï¼\n\nHGET device:temperature 202008030905\n"25.1"\n\nHMGET device:temperature 202008030905 202008030907 202008030908\n1) "25.1"\n2) "25.9"\n3) "24.9"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä½ çï¼ç¨ Hash ç±»åæ¥å®ç°åé®çæ¥è¯¢å¾ç®åãä½æ¯ï¼Hashç±»åæä¸ªç­æ¿ï¼å®å¹¶ä¸æ¯æå¯¹æ°æ®è¿è¡èå´æ¥è¯¢ãå¦ææ³è¦åèå´æ¥è¯¢çè¯ï¼Hash ç±»åéè¦å¨é¨æ«ææè¡ã\n\nä¸ºäºè½åæ¶æ¯æææ¶é´æ³èå´çæ¥è¯¢ï¼å¯ä»¥ç¨ Sorted Set æ¥ä¿å­æ¶é´åºåæ°æ®ï¼å ä¸ºå®è½å¤æ ¹æ®åç´ çæéåæ°æ¥æåºãæä»¬å¯ä»¥ææ¶é´æ³ä½ä¸º Sorted Set éåçåç´ åæ°ï¼ææ¶é´ç¹ä¸è®°å½çæ°æ®ä½ä¸ºåç´ æ¬èº«ï¼\n\nä½¿ç¨ Sorted Set ä¿å­æ°æ®åï¼æä»¬å°±å¯ä»¥ä½¿ç¨ZRANGEBYSCOREå½ä»¤ï¼æç§è¾å¥çæå¤§æ¶é´æ³åæå°æ¶é´æ³æ¥æ¥è¯¢è¿ä¸ªæ¶é´èå´åçæ¸©åº¦å¼äºãå¦ä¸æç¤ºï¼æä»¬æ¥æ¥è¯¢ä¸ä¸å¨2020å¹´8æ3æ¥9ç¹7åå°9ç¹10åé´çæææ¸©åº¦å¼ï¼\n\nZRANGEBYSCORE device:temperature 202008030907 202008030910\n1) "25.9"\n2) "24.9"\n3) "25.3"\n4) "25.2"\n\n\n1\n2\n3\n4\n5\n\n\n# 1.2.2 å¦ä½ä¿è¯åå­æ§ï¼\n\nåæ¶ä½¿ç¨ Hash ä¸ Sorted Set æ»¡è¶³äºåä¸ªæ¶é´ç¹åä¸ä¸ªæ¶é´èå´åçæ°æ®æ¥è¯¢éæ±äºï¼ä½æ¯æä»¬åä¼é¢ä¸´ä¸ä¸ªæ°çé®é¢ï¼å¦ä½ä¿è¯åå¥ Hash å Sorted Set æ¯ä¸ä¸ªåå­æ§çæä½å¢ï¼æè°çåå­æ§æä½ï¼å°±æ¯æå¤ä¸ªåå½ä»¤è¦ä¹å¨é¨æåï¼è¦ä¹å¨é½ä¸æåã\n\né£ Redis æ¯æä¹ä¿è¯åå­æ§æä½çå¢ï¼è¿éå°±æ¶åå°äº Redis ç¨æ¥å®ç°ç®åçäºå¡ç MULTI å EXEC å½ä»¤ãå½å¤ä¸ªå½ä»¤åå¶åæ°æ¬èº«æ è¯¯æ¶ï¼MULTI å EXEC å½ä»¤å¯ä»¥ä¿è¯æ§è¡è¿äºå½ä»¤æ¶çåå­æ§ï¼\n\n * MULTI å½ä»¤ï¼è¡¨ç¤ºä¸ç³»ååå­æ§æä½çå¼å§ãæ¶å°è¿ä¸ªå½ä»¤åï¼Redis å°±ç¥éï¼æ¥ä¸æ¥åæ¶å°çå½ä»¤éè¦æ¾å°ä¸ä¸ªåé¨éåä¸­ï¼åç»­ä¸èµ·æ§è¡ï¼ä¿è¯åå­æ§ã\n * EXEC å½ä»¤ï¼è¡¨ç¤ºä¸ç³»ååå­æ§æä½çç»æãä¸æ¦ Redis æ¶å°äºè¿ä¸ªå½ä»¤ï¼å°±è¡¨ç¤ºææè¦ä¿è¯åå­æ§çå½ä»¤æä½é½å·²ç»åéå®æäºãæ­¤æ¶ï¼Redis å¼å§æ§è¡åææ¾å°åé¨éåä¸­çææå½ä»¤æä½ã\n\nå¦ä¸å¾æç¤ºï¼\n\nä»¥ä¿å­è®¾å¤ç¶æä¿¡æ¯çéæ±ä¸ºä¾ï¼æä»¬æ§è¡ä¸é¢çä»£ç ï¼æè®¾å¤å¨2020å¹´8æ3æ¥9æ¶5åçæ¸©åº¦ï¼åå«ç¨ HSET å½ä»¤å ZADD å½ä»¤åå¥ Hash éåå Sorted Set éåï¼\n\n127.0.0.1:6379> MULTI\nOK\n\n127.0.0.1:6379> HSET device:temperature 202008030911 26.8\nQUEUED\n\n127.0.0.1:6379> ZADD device:temperature 202008030911 26.8\nQUEUED\n\n127.0.0.1:6379> EXEC\n1) (integer) 1\n2) (integer) 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¯ä»¥çå°ï¼é¦åï¼Redisæ¶å°äºå®¢æ·ç«¯æ§è¡çMULTIå½ä»¤ãç¶åï¼å®¢æ·ç«¯åæ§è¡HSETåZADDå½ä»¤åï¼Redisè¿åçç»æä¸ºâQUEUEDâï¼è¡¨ç¤ºè¿ä¸¤ä¸ªå½ä»¤ææ¶å¥éï¼åä¸æ§è¡ï¼æ§è¡äºEXECå½ä»¤åï¼HSETå½ä»¤åZADDå½ä»¤æçæ­£æ§è¡ï¼å¹¶è¿åæåç»æï¼ç»æå¼ä¸º1ï¼ã\n\nå°è¿éï¼æä»¬å°±è§£å³äºæ¶é´åºåæ°æ®çåç¹æ¥è¯¢ãèå´æ¥è¯¢é®é¢ï¼å¹¶ä½¿ç¨MUTLIåEXECå½ä»¤ä¿è¯äºRedisè½åå­æ§å°ææ°æ®ä¿å­å°HashåSorted Setä¸­ã\n\n# 1.2.3 å¦ä½å¯¹æ¶é´åºåæ°æ®èåè®¡ç®ï¼\n\næ¥ä¸æ¥ï¼æä»¬è¦ç»§ç»­è§£å³ç¬¬ä¸ä¸ªé®é¢ï¼å¦ä½å¯¹æ¶é´åºåæ°æ®è¿è¡èåè®¡ç®ï¼èåè®¡ç®ä¸è¬è¢«ç¨æ¥å¨ææ§å°ç»è®¡æ¶é´çªå£åçæ°æ®æ±æ»ç¶æï¼å¨å®æ¶çæ§ä¸é¢è­¦ç­åºæ¯ä¸ä¼é¢ç¹æ§è¡ã\n\nåºäº Hash å Sorted Set ä¿å­æ¶é´åºåæ°æ®æ¶ï¼æ æ³å®ç¾å°è§£å³è¿ä¸ªé®é¢ãå·ä½å°å¨ 1.3.1 èä¸­è®²è¿°ã\n\n\n# 1.3 åºäº RedisTimeSeries æ¨¡åä¿å­æ¶é´åºåæ°æ®\n\n# 1.3.1 RedisTimeSeries éåçåºæ¯\n\næ¥ä¸æ¥ï¼æä»¬ç»§ç»­è§£å³ç¬¬ä¸ä¸ªé®é¢ï¼å¦ä½å¯¹æ¶é´åºåæ°æ®è¿è¡èåè®¡ç®ï¼\n\nå ä¸ºSorted Setåªæ¯æèå´æ¥è¯¢ï¼æ æ³ç´æ¥è¿è¡èåè®¡ç®ï¼æä»¥ï¼æä»¬åªè½åææ¶é´èå´åçæ°æ®ååå°å®¢æ·ç«¯ï¼ç¶åå¨å®¢æ·ç«¯èªè¡å®æèåè®¡ç®ãè¿ä¸ªæ¹æ³è½ç¶è½å®æèåè®¡ç®ï¼ä½æ¯ä¼å¸¦æ¥ä¸å®çæ½å¨é£é©ï¼ä¹å°±æ¯ å¤§éæ°æ®å¨Rediså®ä¾åå®¢æ·ç«¯é´é¢ç¹ä¼ è¾ï¼è¿ä¼åå¶ä»æä½å½ä»¤ç«äºç½ç»èµæºï¼å¯¼è´å¶ä»æä½åæ¢ã\n\nå¨ä¸ä¸ªç©èç½é¡¹ç®ä¸­ï¼éè¦æ¯3åéç»è®¡ä¸ä¸åä¸ªè®¾å¤çæ¸©åº¦ç¶æï¼ä¸æ¦è®¾å¤æ¸©åº¦è¶åºäºè®¾å®çéå¼ï¼å°±è¦è¿è¡æ¥è­¦ãè¿æ¯ä¸ä¸ªå¸åçèåè®¡ç®åºæ¯ï¼æä»¬å¯ä»¥æ¥ççè¿ä¸ªè¿ç¨ä¸­çæ°æ®ä½éï¼åè®¾æä»¬éè¦æ¯3åéè®¡ç®ä¸æ¬¡çææè®¾å¤åææ çæå¤§å¼ï¼æ¯ä¸ªè®¾å¤æ¯15ç§è®°å½ä¸ä¸ªææ å¼ï¼1åéå°±ä¼è®°å½4ä¸ªå¼ï¼3åéå°±ä¼æ12ä¸ªå¼ãæä»¬è¦ç»è®¡çè®¾å¤ææ æ°éæ33ä¸ªï¼æä»¥ï¼åä¸ªè®¾å¤æ¯3åéè®°å½çææ æ°æ®æå°è¿400ä¸ªï¼33 * 12 = 396ï¼ï¼èè®¾å¤æ»æ°éæ1ä¸å°ï¼è¿æ ·ä¸æ¥ï¼æ¯3åéå°±æå°è¿400ä¸æ¡ï¼396 * 1ä¸ = 396ä¸ï¼æ°æ®éè¦å¨å®¢æ·ç«¯åRediså®ä¾é´è¿è¡ä¼ è¾ã\n\nä¸ºäºé¿åå®¢æ·ç«¯åRediså®ä¾é´é¢ç¹çå¤§éæ°æ®ä¼ è¾ï¼æä»¬å¯ä»¥ä½¿ç¨ RedisTimeSeries æ¥ä¿å­æ¶é´åºåæ°æ®ã\n\nRedisTimeSeries æ¯æç´æ¥å¨ Redis å®ä¾ä¸è¿è¡èåè®¡ç®ãè¿æ¯ä»¥åææ¯3åéç®ä¸æ¬¡æå¤§å¼ä¸ºä¾ãå¨Rediså®ä¾ä¸ç´æ¥èåè®¡ç®ï¼é£ä¹ï¼å¯¹äºåä¸ªè®¾å¤çä¸ä¸ªææ å¼æ¥è¯´ï¼æ¯3åéè®°å½ç12æ¡æ°æ®å¯ä»¥èåè®¡ç®æä¸ä¸ªå¼ï¼åä¸ªè®¾å¤æ¯3åéä¹å°±åªæ33ä¸ªèåå¼éè¦ä¼ è¾ï¼1ä¸å°è®¾å¤ä¹åªæ33ä¸æ¡æ°æ®ãæ°æ®éå¤§çº¦æ¯å¨å®¢æ·ç«¯åèåè®¡ç®çååä¹ä¸ï¼å¾æ¾ç¶ï¼å¯ä»¥åå°å¤§éæ°æ®ä¼ è¾å¯¹Rediså®ä¾ç½ç»çæ§è½å½±åã\n\næä»¥ï¼\n\n * å¦ææä»¬åªéè¦è¿è¡åä¸ªæ¶é´ç¹æ¥è¯¢ææ¯å¯¹æä¸ªæ¶é´èå´æ¥è¯¢çè¯ï¼éåä½¿ç¨ Hash å Sorted Set çç»åï¼å®ä»¬é½æ¯ Redis çåå¨æ°æ®ç»æï¼æ§è½å¥½ï¼ç¨³å®æ§é«ã\n * ä½æ¯ï¼å¦ææä»¬éè¦è¿è¡å¤§éçèåè®¡ç®ï¼åæ¶ç½ç»å¸¦å®½æ¡ä»¶ä¸æ¯å¤ªå¥½æ¶ï¼ä½¿ç¨ RedisTimeSeries å°±æ´å åéä¸äºã\n\né£æä»¬å°±å­¦ä¹ ä¸ä¸ RedisTimeSeriesã\n\n# 1.3.2 RedisTimeSeries æ¯ä»ä¹\n\nRedisTimeSeries æ¯ Redis çä¸ä¸ªæ©å±æ¨¡åãå®ä¸é¨é¢åæ¶é´åºåæ°æ®æä¾äºæ°æ®ç±»ååè®¿é®æ¥å£ï¼å¹¶ä¸æ¯æå¨ Redis å®ä¾ä¸ç´æ¥å¯¹æ°æ®è¿è¡ææ¶é´èå´çèåè®¡ç®ã\n\nå ä¸º RedisTimeSeries ä¸å±äºRedisçåå»ºåè½æ¨¡åï¼å¨ä½¿ç¨æ¶ï¼æä»¬éè¦åæå®çæºç åç¬ç¼è¯æå¨æé¾æ¥åº redistimeseries.soï¼åä½¿ç¨ loadmodule å½ä»¤è¿è¡å è½½ï¼å¦ä¸æç¤ºï¼\n\nloadmodule redistimeseries.so\n\n\n1\n\n\nå½ç¨äºæ¶é´åºåæ°æ®å­åæ¶ï¼RedisTimeSeries çæä½ä¸»è¦æ 5 ä¸ªï¼\n\n * ç¨ TS.CREATE å½ä»¤åå»ºæ¶é´åºåæ°æ®éåï¼\n * ç¨ TS.ADD å½ä»¤æå¥æ°æ®ï¼\n * ç¨ TS.GET å½ä»¤è¯»åææ°æ°æ®ï¼\n * ç¨ TS.MGET å½ä»¤ææ ç­¾è¿æ»¤æ¥è¯¢æ°æ®éåï¼\n * ç¨ TS.RANGE æ¯æèåè®¡ç®çèå´æ¥è¯¢ã\n\nä¸é¢ï¼ææ¥ä»ç»ä¸ä¸å¦ä½ä½¿ç¨è¿5ä¸ªæä½ã\n\n----------------------------------------\n\n1ï¼ç¨ TS.CREATE å½ä»¤åå»ºä¸ä¸ªæ¶é´åºåæ°æ®éåï¼\n\nå¨TS.CREATEå½ä»¤ä¸­ï¼æä»¬éè¦è®¾ç½®æ¶é´åºåæ°æ®éåç key åæ°æ®çè¿ææ¶é´ï¼ä»¥æ¯«ç§ä¸ºåä½ï¼ãæ­¤å¤ï¼æä»¬è¿å¯ä»¥ä¸ºæ°æ®éåè®¾ç½®æ ç­¾ï¼æ¥è¡¨ç¤ºæ°æ®éåçå±æ§ã\n\nä¾å¦ï¼æä»¬æ§è¡ä¸é¢çå½ä»¤ï¼åå»ºä¸ä¸ªkeyä¸ºdevice:temperatureãæ°æ®æææä¸º600sçæ¶é´åºåæ°æ®éåãä¹å°±æ¯è¯´ï¼è¿ä¸ªéåä¸­çæ°æ®åå»ºäº600såï¼å°±ä¼è¢«èªå¨å é¤ãæåï¼æä»¬ç»è¿ä¸ªéåè®¾ç½®äºä¸ä¸ªæ ç­¾å±æ§{device_id:1}ï¼è¡¨æè¿ä¸ªæ°æ®éåä¸­è®°å½çæ¯å±äºè®¾å¤IDå·ä¸º1çæ°æ®ã\n\nTS.CREATE device:temperature RETENTION 600000 LABELS device_id 1\nOK\n\n\n1\n2\n\n\n----------------------------------------\n\n2ï¼ç¨ TS.ADD å½ä»¤æå¥æ°æ®ï¼ç¨ TS.GET å½ä»¤è¯»åææ°æ°æ®ï¼\n\næä»¬å¯ä»¥ç¨ TS.ADD å½ä»¤å¾æ¶é´åºåéåä¸­æå¥æ°æ®ï¼åæ¬æ¶é´æ³åå·ä½çæ°å¼ï¼å¹¶ä½¿ç¨ TS.GET å½ä»¤è¯»åæ°æ®éåä¸­çææ°ä¸æ¡æ°æ®ã\n\nä¾å¦ï¼æä»¬æ§è¡ä¸å TS.ADD å½ä»¤æ¶ï¼å°±å¾ device:temperature éåä¸­æå¥äºä¸æ¡æ°æ®ï¼è®°å½çæ¯è®¾å¤å¨2020å¹´8æ3æ¥9æ¶5åçè®¾å¤æ¸©åº¦ï¼åæ§è¡ TS.GET å½ä»¤æ¶ï¼å°±ä¼æååæå¥çææ°æ°æ®è¯»ååºæ¥ï¼\n\nTS.ADD device:temperature 1596416700 25.1\n1596416700\n\nTS.GET device:temperature\n25.1\n\n\n1\n2\n3\n4\n5\n\n\n3ï¼ç¨ TS.MGET å½ä»¤ææ ç­¾è¿æ»¤æ¥è¯¢æ°æ®éåï¼\n\nå¨ä¿å­å¤ä¸ªè®¾å¤çæ¶é´åºåæ°æ®æ¶ï¼æä»¬éå¸¸ä¼æä¸åè®¾å¤çæ°æ®ä¿å­å°ä¸åéåä¸­ãæ­¤æ¶ï¼æä»¬å°±å¯ä»¥ä½¿ç¨TS.MGETå½ä»¤ï¼æç§æ ç­¾æ¥è¯¢é¨åéåä¸­çææ°æ°æ®ãå¨ä½¿ç¨TS.CREATEåå»ºæ°æ®éåæ¶ï¼æä»¬å¯ä»¥ç»éåè®¾ç½®æ ç­¾å±æ§ãå½æä»¬è¿è¡æ¥è¯¢æ¶ï¼å°±å¯ä»¥å¨æ¥è¯¢æ¡ä»¶ä¸­å¯¹éåæ ç­¾å±æ§è¿è¡å¹éï¼æåçæ¥è¯¢ç»æéåªè¿åå¹éä¸çéåä¸­çææ°æ°æ®ã\n\nä¸¾ä¸ªä¾å­ãåè®¾æä»¬ä¸å±ç¨4ä¸ªéåä¸º4ä¸ªè®¾å¤ä¿å­æ¶é´åºåæ°æ®ï¼è®¾å¤çIDå·æ¯1ã2ã3ã4ï¼æä»¬å¨åå»ºæ°æ®éåæ¶ï¼ædevice_idè®¾ç½®ä¸ºæ¯ä¸ªéåçæ ç­¾ãæ­¤æ¶ï¼æä»¬å°±å¯ä»¥ä½¿ç¨ä¸åTS.MGETå½ä»¤ï¼ä»¥åFILTERè®¾ç½®ï¼è¿ä¸ªéç½®é¡¹ç¨æ¥è®¾ç½®éåæ ç­¾çè¿æ»¤æ¡ä»¶ï¼ï¼æ¥è¯¢device_idä¸ç­äº2çææå¶ä»è®¾å¤çæ°æ®éåï¼å¹¶è¿ååèªéåä¸­çææ°çä¸æ¡æ°æ®ã\n\nTS.MGET FILTER device_id!=2\n1) 1) "device:temperature:1"\n   2) (empty list or set)\n   3) 1) (integer) 1596417000\n      2) "25.3"\n2) 1) "device:temperature:3"\n   2) (empty list or set)\n   3) 1) (integer) 1596417000\n      2) "29.5"\n3) 1) "device:temperature:4"\n   2) (empty list or set)\n   3) 1) (integer) 1596417000\n      2) "30.1"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n4ï¼ç¨ TS.RANGE æ¯æéè¦èåè®¡ç®çèå´æ¥è¯¢ï¼\n\næåï¼å¨å¯¹æ¶é´åºåæ°æ®è¿è¡èåè®¡ç®æ¶ï¼æä»¬å¯ä»¥ä½¿ç¨TS.RANGEå½ä»¤æå®è¦æ¥è¯¢çæ°æ®çæ¶é´èå´ï¼åæ¶ç¨AGGREGATIONåæ°æå®è¦æ§è¡çèåè®¡ç®ç±»åãRedisTimeSeriesæ¯æçèåè®¡ç®ç±»åå¾ä¸°å¯ï¼åæ¬æ±åå¼ï¼avgï¼ãæ±æå¤§/æå°å¼ï¼max/minï¼ï¼æ±åï¼sumï¼ç­ã\n\nä¾å¦ï¼å¨æ§è¡ä¸åå½ä»¤æ¶ï¼æä»¬å°±å¯ä»¥æç§æ¯180sçæ¶é´çªå£ï¼å¯¹2020å¹´8æ3æ¥9æ¶5åå2020å¹´8æ3æ¥9æ¶12åè¿æ®µæ¶é´åçæ°æ®è¿è¡åå¼è®¡ç®äºã\n\nTS.RANGE device:temperature 1596416700 1596417120 AGGREGATION avg 180000\n1) 1) (integer) 1596416700\n   2) "25.6"\n2) 1) (integer) 1596416880\n   2) "25.8"\n3) 1) (integer) 1596417060\n   2) "26.1"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸ä½¿ç¨HashåSorted Setæ¥ä¿å­æ¶é´åºåæ°æ®ç¸æ¯ï¼RedisTimeSeriesæ¯ä¸é¨ä¸ºæ¶é´åºåæ°æ®è®¿é®è®¾è®¡çæ©å±æ¨¡åï¼è½æ¯æå¨Rediså®ä¾ä¸ç´æ¥è¿è¡èåè®¡ç®ï¼ä»¥åææ ç­¾å±æ§è¿æ»¤æ¥è¯¢æ°æ®éåï¼å½æä»¬éè¦é¢ç¹è¿è¡èåè®¡ç®ï¼ä»¥åä»å¤§ééåä¸­ç­éåºç¹å®è®¾å¤æç¨æ·çæ°æ®éåæ¶ï¼RedisTimeSerieså°±å¯ä»¥åæ¥ä¼å¿äºã\n\n\n# 1.4 å°ç»\n\nè¿ä¸èå­¦ä¹ äºå¦ä½ä½¿ç¨ Redis ä¿å­æ¶é´åºåæ°æ®ãæ¶é´åºåæ°æ®çåå¥ç¹ç¹æ¯è¦è½å¿«éåå¥ï¼èæ¥è¯¢çç¹ç¹æä¸ä¸ªï¼\n\n * ç¹æ¥è¯¢ï¼æ ¹æ®ä¸ä¸ªæ¶é´æ³ï¼æ¥è¯¢ç¸åºæ¶é´çæ°æ®ï¼\n * èå´æ¥è¯¢ï¼æ¥è¯¢èµ·å§åæªæ­¢æ¶é´æ³èå´åçæ°æ®ï¼\n * èåè®¡ç®ï¼éå¯¹èµ·å§åæªæ­¢æ¶é´æ³èå´åçæææ°æ®è¿è¡è®¡ç®ï¼ä¾å¦æ±æå¤§/æå°å¼ï¼æ±åå¼ç­ã\n\nä¸ºäºéå¯¹å¤æ ·åçæ¥è¯¢éæ±ï¼Redis æä¾äºä¸¤ç§æ¹æ¡ï¼\n\n 1. ç»åä½¿ç¨ Redis åç½®ç Hash å Sorted Set ç±»å\n 2. ä½¿ç¨ RedisTimeSeries æ¨¡å\n\nä¸¤ç§æ¹æ¡åèªçä¼å£ï¼\n\n * ç¬¬ä¸ç§ï¼\n   * æ¢å¯ä»¥å©ç¨Hashç±»åå®ç°å¯¹åé®çå¿«éæ¥è¯¢ï¼è¿è½å©ç¨Sorted Setå®ç°å¯¹èå´æ¥è¯¢çé«ææ¯æï¼ä¸ä¸å­æ»¡è¶³äºæ¶é´åºåæ°æ®çä¸¤å¤§æ¥è¯¢éæ±ã\n   * ä¸¤ä¸ªä¸è¶³ï¼ä¸ä¸ªæ¯ï¼å¨æ§è¡èåè®¡ç®æ¶ï¼æä»¬éè¦ææ°æ®è¯»åå°å®¢æ·ç«¯åè¿è¡èåï¼å½æå¤§éæ°æ®è¦èåæ¶ï¼æ°æ®ä¼ è¾å¼éå¤§ï¼å¦ä¸ä¸ªæ¯ï¼ææçæ°æ®ä¼å¨ä¸¤ä¸ªæ°æ®ç±»åä¸­åä¿å­ä¸ä»½ï¼åå­å¼éä¸å°ãä¸è¿ï¼æä»¬å¯ä»¥éè¿è®¾ç½®éå½çæ°æ®è¿ææ¶é´ï¼éæ¾åå­ï¼åå°åå­ååã\n * ç¬¬äºç§ï¼\n   * RedisTimeSeriesè½æ¯æç´æ¥å¨Rediså®ä¾ä¸è¿è¡å¤ç§æ°æ®èåè®¡ç®ï¼é¿åäºå¤§éæ°æ®å¨å®ä¾åå®¢æ·ç«¯é´ä¼ è¾ã\n   * ä¸è¶³ï¼RedisTimeSeriesçåºå±æ°æ®ç»æä½¿ç¨äºé¾è¡¨ï¼å®çèå´æ¥è¯¢çå¤æåº¦æ¯O(N)çº§å«çï¼åæ¶ï¼å®çTS.GETæ¥è¯¢åªè½è¿åææ°çæ°æ®ï¼æ²¡æåæ³åç¬¬ä¸ç§æ¹æ¡çHashç±»åä¸æ ·ï¼å¯ä»¥è¿åä»»ä¸æ¶é´ç¹çæ°æ®ã\n\nè¿ä¸¤ç§æ¹æ¡åæä¼å£ï¼å»ºè®®æ¯ï¼\n\n * å¦æä½ çé¨ç½²ç¯å¢ä¸­ç½ç»å¸¦å®½é«ãRediså®ä¾åå­å¤§ï¼å¯ä»¥ä¼åèèç¬¬ä¸ç§æ¹æ¡ï¼\n * å¦æä½ çé¨ç½²ç¯å¢ä¸­ç½ç»ãåå­èµæºæéï¼èä¸æ°æ®éå¤§ï¼èåè®¡ç®é¢ç¹ï¼éè¦ææ°æ®éåå±æ§æ¥è¯¢ï¼å¯ä»¥ä¼åèèç¬¬äºç§æ¹æ¡ã\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼å¨ç¨Sorted Setä¿å­æ¶é´åºåæ°æ®æ¶ï¼æä»¬ææ¶é´æ³ä½ä¸ºscoreï¼æå®éçæ°æ®ä½ä¸ºmemberï¼è¿æ ·ä¿å­æ°æ®ææ²¡ææ½å¨çé£é©ï¼\n\nSorted SetåSetä¸æ ·ï¼é½ä¼å¯¹éåä¸­çåç´ è¿è¡å»éï¼ç¸åmemberçå¼ï¼å¨Sorted Setä¸­åªä¼ä¿çä¸ä¸ªã\n\nå¯¹äºæ¶é´åºåæ°æ®æ¥è¯´ï¼è¿ç§å»éçç¹æ§æ¯ä¼å¸¦æ¥æ°æ®ä¸¢å¤±é£é©çãæ¯ç«ï¼æä¸æ¶é´æ®µåçå¤ä¸ªæ¶é´åºåæ°æ®çå¼å¯è½æ¯ç¸åçãå¦ææä»¬å¾Sorted Setä¸­åå¥çæ°æ®æ¯å¨ä¸åæ¶å»äº§ççï¼ä½æ¯åå¥çæ¶å»ä¸åï¼Sorted Setä¸­åªä¼ä¿å­ä¸ä»½æè¿æ¶å»çæ°æ®ãè¿æ ·ä¸æ¥ï¼å¶ä»æ¶å»çæ°æ®å°±é½æ²¡æä¿å­ä¸æ¥ã\n\nä¸¾ä¸ªä¾å­ï¼å¨è®°å½ç©èç½è®¾å¤çæ¸©åº¦æ¶ï¼ä¸ä¸ªè®¾å¤ä¸ä¸ªä¸åçæ¸©åº¦å¼å¯è½é½æ¯26ãå¨Sorted Setä¸­ï¼æä»¬ææ¸©åº¦å¼ä½ä¸ºmemberï¼ææ¶é´æ³ä½ä¸ºscoreãæä»¬ç¨ZADDå½ä»¤æä¸åä¸åæ¶å»çæ¸©åº¦å¼åå¥Sorted Setãç±äºmemberå¼ä¸æ ·ï¼æä»¥åªä¼æscoreæ´æ°ä¸ºææ°æ¶é´æ³ï¼æååªæä¸ä¸ªææ°æ¶é´æ³ï¼ä¾å¦ä¸å12ç¹ï¼ä¸çæ¸©åº¦å¼ãè¿è¯å®æ¯æ æ³æ»¡è¶³ä¿å­å¤ä¸ªæ¶å»æ°æ®çéæ±çã\n\næ¬èé®é¢ 2ï¼å¦æä½ æ¯Redisçå¼åç»´æ¤èï¼ä½ ä¼æèåè®¡ç®ä¹è®¾è®¡ä¸ºSorted Setçä¸ä¸ªåå¨åè½åï¼\n\nèèå°Redisçè¯»ååè½æ¯ç±åçº¿ç¨æ§è¡ï¼å¨è¿è¡æ°æ®è¯»åæ¶ï¼æ¬èº«å°±ä¼æ¶èè¾å¤çCPUèµæºï¼å¦æåå¨Sorted Setä¸­å®ç°èåè®¡ç®ï¼å°±ä¼è¿ä¸æ­¥å¢å CPUçèµæºæ¶èï¼å½±åå°Redisçæ­£å¸¸æ°æ®è¯»åãæä»¥ï¼å¦æææ¯Redisçå¼åç»´æ¤èï¼é¤éå¯¹Redisççº¿ç¨æ¨¡ååä¿®æ¹ï¼æ¯å¦è¯´å¨Redisä¸­ä½¿ç¨é¢å¤ççº¿ç¨æ± åèåè®¡ç®ï¼å¦åï¼æä¸ä¼æèåè®¡ç®ä½ä¸ºRedisçåå¨åè½å®ç°çã',normalizedContent:'> åèï¼\n> \n>  * 14 å¦ä½å¨ redis ä¸­ä¿å­æ¶é´åºåæ°æ®ï¼| æå®¢æ¶é´\n\n\n# 1. å¦ä½å¨ redis ä¸­ä¿å­æ¶é´åºåæ°æ®ï¼\n\næä»¬ç»å¸¸é¢ä¸´è¿æ ·ä¸ä¸ªéæ±ï¼è®°å½ç¨æ·å¨ç½ç«æè app ä¸çç¹å»è¡ä¸ºæ°æ®ï¼æ¥åæç¨æ·è¡ä¸ºãè¿éçæ°æ®ä¸è¬åæ¬ç¨æ· idãè¡ä¸ºç±»åï¼ä¾å¦æµè§ãç»å½ãä¸åç­ï¼ãè¡ä¸ºåççæ¶é´æ³ï¼\n\nuserid, type, timestamp\n\n\n1\n\n\nè¿äºä¸åçæ¶é´ç¸å³çä¸ç»æ°æ®ï¼å°±æ¯æ¶é´åºåæ°æ®ãè¿äºæ°æ®çç¹ç¹æ¯æ²¡æä¸¥æ ¼çå³ç³»æ¨¡åï¼è®°å½çä¿¡æ¯å¯ä»¥è¡¨ç¤ºæé®åå¼çå³ç³»ï¼ä¾å¦ï¼ä¸ä¸ªè®¾å¤idå¯¹åºä¸æ¡è®°å½ï¼ï¼æä»¥ï¼å¹¶ä¸éè¦ä¸é¨ç¨å³ç³»åæ°æ®åºï¼ä¾å¦ mysqlï¼æ¥ä¿å­ãè redis çé®å¼æ°æ®æ¨¡åï¼æ­£å¥½å¯ä»¥æ»¡è¶³è¿éçæ°æ®å­åéæ±ãredis åºäºèªèº«æ°æ®ç»æä»¥åæ©å±æ¨¡åï¼æä¾äºä¸¤ç§è§£å³æ¹æ¡ãæä»¬å¨è¿éå¯¹å¶è¿è¡è®¨è®ºã\n\n\n# 1.1 æ¶é´åºåæ°æ®çè¯»åç¹ç¹\n\n# 1ï¼ åç¹ç¹\n\nå¨å®éåºç¨ä¸­ï¼æ¶é´åºåæ°æ®éå¸¸æ¯æç»­é«å¹¶ååå¥çï¼è¿äºæ°æ®çåå¥ä¸»è¦æ¯æå¥æ°æ°æ®ï¼èä¸æ¯æ´æ°æ°æ®ï¼ä¹å°±æ¯è¯´ï¼ä¸ä¸ªæ¶é´åºåæ°æ®è¢«è®°å½åéå¸¸å°±ä¸ä¼åäºãå ä¸ºè¿äºæ°æ®å¾å¾ä»£è¡¨æä¸ªè®¾å¤å¨æä¸ªæ¶å»çæµéå¼ã\n\næä»¥ï¼è¿ç§æ°æ®çåå¥ç¹ç¹å¾ç®åï¼å°±æ¯æå¥æ°æ®å¿«ï¼è¿å°±è¦æ±æä»¬éæ©çæ°æ®ç±»åï¼å¨è¿è¡æ°æ®æå¥æ¶ï¼å¤æåº¦è¦ä½ï¼å°½éä¸è¦é»å¡ã\n\n# 2ï¼ è¯»ç¹ç¹\n\næä»¬å¨æ¥è¯¢æ¶é´åºåæ°æ®æ¶ï¼æ¢æå¯¹åæ¡è®°å½çæ¥è¯¢ï¼å¦æ¥è¯¢ä¸ä¸ªè®¾å¤çææ¶å»ç¶æï¼ï¼ä¹æå¯¹æä¸ªæ¶é´èå´åçæ°æ®çæ¥è¯¢ï¼å¦æ¥çä¸ä¸åææè®¾å¤çç¶æï¼ãé¤æ­¤ä¹å¤ï¼è¿æä¸äºæ´å¤æçæ¥è¯¢ï¼æ¯å¦å¯¹æä¸ªæ¶é´èå´åçæ°æ®åèåè®¡ç®ï¼å¦è®¡ç®åå¼ãæ±æå¤§å¼ç­ã\n\næ¦æ¬æ¶é´åºåæ°æ®çç¹ç¹ï¼æ¥è¯¢æ¨¡å¼å¤ã\n\nå¼æ¸æ¥äºæ¶é´åºåæ°æ®çè¯»åç¹ç¹ï¼æ¥ä¸æ¥æä»¬å°±ççå¦ä½å¨ redis ä¸­ä¿å­è¿äºæ°æ®ãæä»¬æ¥åæä¸ï¼éå¯¹æ¶é´åºåæ°æ®çâåè¦å¿«âï¼redisçé«æ§è½åç¹æ§ç´æ¥å°±å¯ä»¥æ»¡è¶³äºï¼èéå¯¹âæ¥è¯¢æ¨¡å¼å¤âï¼ä¹å°±æ¯è¦æ¯æåç¹æ¥è¯¢ãèå´æ¥è¯¢åèåè®¡ç®ï¼redis æä¾äºä¿å­æ¶é´åºåæ°æ®çä¸¤ç§æ¹æ¡ï¼åå«æ¯ï¼\n\n * åºäº hash å sorted set å®ç°ï¼\n * åºäº redistimeseries æ¨¡åå®ç°ã\n\n\n# 1.2 åºäº hash å sorted set ä¿å­æ¶é´åºåæ°æ®\n\nhash å sorted set ç»åçæ¹å¼æä¸ä¸ªææ¾çå¥½å¤ï¼å®ä»¬æ¯ redis åå¨çæ°æ®ç±»åï¼ä»£ç æçåæ§è½ç¨³å®ãæä»¥ï¼åºäºè¿ä¸¤ä¸ªæ°æ®ç±»åä¿å­æ¶é´åºåæ°æ®ï¼ç³»ç»ç¨³å®æ§æ¯å¯ä»¥é¢æçã\n\n# 1.2.1 ä¸ºä»ä¹è¦åæ¶ä½¿ç¨è¿ä¸¤ç§ç±»åï¼\n\nä¸è¿ï¼å¨åé¢å­¦ä¹ çåºæ¯ä¸­ï¼æä»¬é½æ¯ä½¿ç¨ä¸ä¸ªæ°æ®ç±»åæ¥å­åæ°æ®ï¼é£ä¹ï¼ä¸ºä»ä¹ä¿å­æ¶é´åºåæ°æ®ï¼è¦åæ¶ä½¿ç¨è¿ä¸¤ç§ç±»åï¼è¿æ¯æä»¬è¦åç­çç¬¬ä¸ä¸ªé®é¢ã\n\nå³äº hash ç±»åï¼æä»¬é½ç¥éï¼å®æä¸ä¸ªç¹ç¹æ¯ï¼å¯ä»¥å®ç°å¯¹åé®çå¿«éæ¥è¯¢ãè¿å°±æ»¡è¶³äºæ¶é´åºåæ°æ®çåé®æ¥è¯¢éæ±ãæä»¬å¯ä»¥ææ¶é´æ³ä½ä¸º hash éåç keyï¼æè®°å½çè®¾å¤ç¶æå¼ä½ä¸º hash éåç valueã\n\nå¯ä»¥çä¸ç¨ hash éåè®°å½è®¾å¤çæ¸©åº¦å¼çç¤ºæå¾ï¼\n\nå½æä»¬æ³è¦æ¥è¯¢æä¸ªæ¶é´ç¹æèæ¯å¤ä¸ªæ¶é´ç¹ä¸çæ¸©åº¦æ°æ®æ¶ï¼ç´æ¥ä½¿ç¨ hget å½ä»¤æè hmget å½ä»¤ï¼å°±å¯ä»¥åå«è·å¾ hash éåä¸­çä¸ä¸ª key åå¤ä¸ª key ç value å¼äºãç¤ºä¾å¦ä¸ï¼\n\nç¨hgetå½ä»¤æ¥è¯¢202008030905è¿ä¸ªæ¶å»çæ¸©åº¦å¼ï¼ä½¿ç¨hmgetæ¥è¯¢202008030905ã202008030907ã202008030908è¿ä¸ä¸ªæ¶å»çæ¸©åº¦å¼ï¼\n\nhget device:temperature 202008030905\n"25.1"\n\nhmget device:temperature 202008030905 202008030907 202008030908\n1) "25.1"\n2) "25.9"\n3) "24.9"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä½ çï¼ç¨ hash ç±»åæ¥å®ç°åé®çæ¥è¯¢å¾ç®åãä½æ¯ï¼hashç±»åæä¸ªç­æ¿ï¼å®å¹¶ä¸æ¯æå¯¹æ°æ®è¿è¡èå´æ¥è¯¢ãå¦ææ³è¦åèå´æ¥è¯¢çè¯ï¼hash ç±»åéè¦å¨é¨æ«ææè¡ã\n\nä¸ºäºè½åæ¶æ¯æææ¶é´æ³èå´çæ¥è¯¢ï¼å¯ä»¥ç¨ sorted set æ¥ä¿å­æ¶é´åºåæ°æ®ï¼å ä¸ºå®è½å¤æ ¹æ®åç´ çæéåæ°æ¥æåºãæä»¬å¯ä»¥ææ¶é´æ³ä½ä¸º sorted set éåçåç´ åæ°ï¼ææ¶é´ç¹ä¸è®°å½çæ°æ®ä½ä¸ºåç´ æ¬èº«ï¼\n\nä½¿ç¨ sorted set ä¿å­æ°æ®åï¼æä»¬å°±å¯ä»¥ä½¿ç¨zrangebyscoreå½ä»¤ï¼æç§è¾å¥çæå¤§æ¶é´æ³åæå°æ¶é´æ³æ¥æ¥è¯¢è¿ä¸ªæ¶é´èå´åçæ¸©åº¦å¼äºãå¦ä¸æç¤ºï¼æä»¬æ¥æ¥è¯¢ä¸ä¸å¨2020å¹´8æ3æ¥9ç¹7åå°9ç¹10åé´çæææ¸©åº¦å¼ï¼\n\nzrangebyscore device:temperature 202008030907 202008030910\n1) "25.9"\n2) "24.9"\n3) "25.3"\n4) "25.2"\n\n\n1\n2\n3\n4\n5\n\n\n# 1.2.2 å¦ä½ä¿è¯åå­æ§ï¼\n\nåæ¶ä½¿ç¨ hash ä¸ sorted set æ»¡è¶³äºåä¸ªæ¶é´ç¹åä¸ä¸ªæ¶é´èå´åçæ°æ®æ¥è¯¢éæ±äºï¼ä½æ¯æä»¬åä¼é¢ä¸´ä¸ä¸ªæ°çé®é¢ï¼å¦ä½ä¿è¯åå¥ hash å sorted set æ¯ä¸ä¸ªåå­æ§çæä½å¢ï¼æè°çåå­æ§æä½ï¼å°±æ¯æå¤ä¸ªåå½ä»¤è¦ä¹å¨é¨æåï¼è¦ä¹å¨é½ä¸æåã\n\né£ redis æ¯æä¹ä¿è¯åå­æ§æä½çå¢ï¼è¿éå°±æ¶åå°äº redis ç¨æ¥å®ç°ç®åçäºå¡ç multi å exec å½ä»¤ãå½å¤ä¸ªå½ä»¤åå¶åæ°æ¬èº«æ è¯¯æ¶ï¼multi å exec å½ä»¤å¯ä»¥ä¿è¯æ§è¡è¿äºå½ä»¤æ¶çåå­æ§ï¼\n\n * multi å½ä»¤ï¼è¡¨ç¤ºä¸ç³»ååå­æ§æä½çå¼å§ãæ¶å°è¿ä¸ªå½ä»¤åï¼redis å°±ç¥éï¼æ¥ä¸æ¥åæ¶å°çå½ä»¤éè¦æ¾å°ä¸ä¸ªåé¨éåä¸­ï¼åç»­ä¸èµ·æ§è¡ï¼ä¿è¯åå­æ§ã\n * exec å½ä»¤ï¼è¡¨ç¤ºä¸ç³»ååå­æ§æä½çç»æãä¸æ¦ redis æ¶å°äºè¿ä¸ªå½ä»¤ï¼å°±è¡¨ç¤ºææè¦ä¿è¯åå­æ§çå½ä»¤æä½é½å·²ç»åéå®æäºãæ­¤æ¶ï¼redis å¼å§æ§è¡åææ¾å°åé¨éåä¸­çææå½ä»¤æä½ã\n\nå¦ä¸å¾æç¤ºï¼\n\nä»¥ä¿å­è®¾å¤ç¶æä¿¡æ¯çéæ±ä¸ºä¾ï¼æä»¬æ§è¡ä¸é¢çä»£ç ï¼æè®¾å¤å¨2020å¹´8æ3æ¥9æ¶5åçæ¸©åº¦ï¼åå«ç¨ hset å½ä»¤å zadd å½ä»¤åå¥ hash éåå sorted set éåï¼\n\n127.0.0.1:6379> multi\nok\n\n127.0.0.1:6379> hset device:temperature 202008030911 26.8\nqueued\n\n127.0.0.1:6379> zadd device:temperature 202008030911 26.8\nqueued\n\n127.0.0.1:6379> exec\n1) (integer) 1\n2) (integer) 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¯ä»¥çå°ï¼é¦åï¼redisæ¶å°äºå®¢æ·ç«¯æ§è¡çmultiå½ä»¤ãç¶åï¼å®¢æ·ç«¯åæ§è¡hsetåzaddå½ä»¤åï¼redisè¿åçç»æä¸ºâqueuedâï¼è¡¨ç¤ºè¿ä¸¤ä¸ªå½ä»¤ææ¶å¥éï¼åä¸æ§è¡ï¼æ§è¡äºexecå½ä»¤åï¼hsetå½ä»¤åzaddå½ä»¤æçæ­£æ§è¡ï¼å¹¶è¿åæåç»æï¼ç»æå¼ä¸º1ï¼ã\n\nå°è¿éï¼æä»¬å°±è§£å³äºæ¶é´åºåæ°æ®çåç¹æ¥è¯¢ãèå´æ¥è¯¢é®é¢ï¼å¹¶ä½¿ç¨mutliåexecå½ä»¤ä¿è¯äºredisè½åå­æ§å°ææ°æ®ä¿å­å°hashåsorted setä¸­ã\n\n# 1.2.3 å¦ä½å¯¹æ¶é´åºåæ°æ®èåè®¡ç®ï¼\n\næ¥ä¸æ¥ï¼æä»¬è¦ç»§ç»­è§£å³ç¬¬ä¸ä¸ªé®é¢ï¼å¦ä½å¯¹æ¶é´åºåæ°æ®è¿è¡èåè®¡ç®ï¼èåè®¡ç®ä¸è¬è¢«ç¨æ¥å¨ææ§å°ç»è®¡æ¶é´çªå£åçæ°æ®æ±æ»ç¶æï¼å¨å®æ¶çæ§ä¸é¢è­¦ç­åºæ¯ä¸ä¼é¢ç¹æ§è¡ã\n\nåºäº hash å sorted set ä¿å­æ¶é´åºåæ°æ®æ¶ï¼æ æ³å®ç¾å°è§£å³è¿ä¸ªé®é¢ãå·ä½å°å¨ 1.3.1 èä¸­è®²è¿°ã\n\n\n# 1.3 åºäº redistimeseries æ¨¡åä¿å­æ¶é´åºåæ°æ®\n\n# 1.3.1 redistimeseries éåçåºæ¯\n\næ¥ä¸æ¥ï¼æä»¬ç»§ç»­è§£å³ç¬¬ä¸ä¸ªé®é¢ï¼å¦ä½å¯¹æ¶é´åºåæ°æ®è¿è¡èåè®¡ç®ï¼\n\nå ä¸ºsorted setåªæ¯æèå´æ¥è¯¢ï¼æ æ³ç´æ¥è¿è¡èåè®¡ç®ï¼æä»¥ï¼æä»¬åªè½åææ¶é´èå´åçæ°æ®ååå°å®¢æ·ç«¯ï¼ç¶åå¨å®¢æ·ç«¯èªè¡å®æèåè®¡ç®ãè¿ä¸ªæ¹æ³è½ç¶è½å®æèåè®¡ç®ï¼ä½æ¯ä¼å¸¦æ¥ä¸å®çæ½å¨é£é©ï¼ä¹å°±æ¯ å¤§éæ°æ®å¨rediså®ä¾åå®¢æ·ç«¯é´é¢ç¹ä¼ è¾ï¼è¿ä¼åå¶ä»æä½å½ä»¤ç«äºç½ç»èµæºï¼å¯¼è´å¶ä»æä½åæ¢ã\n\nå¨ä¸ä¸ªç©èç½é¡¹ç®ä¸­ï¼éè¦æ¯3åéç»è®¡ä¸ä¸åä¸ªè®¾å¤çæ¸©åº¦ç¶æï¼ä¸æ¦è®¾å¤æ¸©åº¦è¶åºäºè®¾å®çéå¼ï¼å°±è¦è¿è¡æ¥è­¦ãè¿æ¯ä¸ä¸ªå¸åçèåè®¡ç®åºæ¯ï¼æä»¬å¯ä»¥æ¥ççè¿ä¸ªè¿ç¨ä¸­çæ°æ®ä½éï¼åè®¾æä»¬éè¦æ¯3åéè®¡ç®ä¸æ¬¡çææè®¾å¤åææ çæå¤§å¼ï¼æ¯ä¸ªè®¾å¤æ¯15ç§è®°å½ä¸ä¸ªææ å¼ï¼1åéå°±ä¼è®°å½4ä¸ªå¼ï¼3åéå°±ä¼æ12ä¸ªå¼ãæä»¬è¦ç»è®¡çè®¾å¤ææ æ°éæ33ä¸ªï¼æä»¥ï¼åä¸ªè®¾å¤æ¯3åéè®°å½çææ æ°æ®æå°è¿400ä¸ªï¼33 * 12 = 396ï¼ï¼èè®¾å¤æ»æ°éæ1ä¸å°ï¼è¿æ ·ä¸æ¥ï¼æ¯3åéå°±æå°è¿400ä¸æ¡ï¼396 * 1ä¸ = 396ä¸ï¼æ°æ®éè¦å¨å®¢æ·ç«¯årediså®ä¾é´è¿è¡ä¼ è¾ã\n\nä¸ºäºé¿åå®¢æ·ç«¯årediså®ä¾é´é¢ç¹çå¤§éæ°æ®ä¼ è¾ï¼æä»¬å¯ä»¥ä½¿ç¨ redistimeseries æ¥ä¿å­æ¶é´åºåæ°æ®ã\n\nredistimeseries æ¯æç´æ¥å¨ redis å®ä¾ä¸è¿è¡èåè®¡ç®ãè¿æ¯ä»¥åææ¯3åéç®ä¸æ¬¡æå¤§å¼ä¸ºä¾ãå¨rediså®ä¾ä¸ç´æ¥èåè®¡ç®ï¼é£ä¹ï¼å¯¹äºåä¸ªè®¾å¤çä¸ä¸ªææ å¼æ¥è¯´ï¼æ¯3åéè®°å½ç12æ¡æ°æ®å¯ä»¥èåè®¡ç®æä¸ä¸ªå¼ï¼åä¸ªè®¾å¤æ¯3åéä¹å°±åªæ33ä¸ªèåå¼éè¦ä¼ è¾ï¼1ä¸å°è®¾å¤ä¹åªæ33ä¸æ¡æ°æ®ãæ°æ®éå¤§çº¦æ¯å¨å®¢æ·ç«¯åèåè®¡ç®çååä¹ä¸ï¼å¾æ¾ç¶ï¼å¯ä»¥åå°å¤§éæ°æ®ä¼ è¾å¯¹rediså®ä¾ç½ç»çæ§è½å½±åã\n\næä»¥ï¼\n\n * å¦ææä»¬åªéè¦è¿è¡åä¸ªæ¶é´ç¹æ¥è¯¢ææ¯å¯¹æä¸ªæ¶é´èå´æ¥è¯¢çè¯ï¼éåä½¿ç¨ hash å sorted set çç»åï¼å®ä»¬é½æ¯ redis çåå¨æ°æ®ç»æï¼æ§è½å¥½ï¼ç¨³å®æ§é«ã\n * ä½æ¯ï¼å¦ææä»¬éè¦è¿è¡å¤§éçèåè®¡ç®ï¼åæ¶ç½ç»å¸¦å®½æ¡ä»¶ä¸æ¯å¤ªå¥½æ¶ï¼ä½¿ç¨ redistimeseries å°±æ´å åéä¸äºã\n\né£æä»¬å°±å­¦ä¹ ä¸ä¸ redistimeseriesã\n\n# 1.3.2 redistimeseries æ¯ä»ä¹\n\nredistimeseries æ¯ redis çä¸ä¸ªæ©å±æ¨¡åãå®ä¸é¨é¢åæ¶é´åºåæ°æ®æä¾äºæ°æ®ç±»ååè®¿é®æ¥å£ï¼å¹¶ä¸æ¯æå¨ redis å®ä¾ä¸ç´æ¥å¯¹æ°æ®è¿è¡ææ¶é´èå´çèåè®¡ç®ã\n\nå ä¸º redistimeseries ä¸å±äºredisçåå»ºåè½æ¨¡åï¼å¨ä½¿ç¨æ¶ï¼æä»¬éè¦åæå®çæºç åç¬ç¼è¯æå¨æé¾æ¥åº redistimeseries.soï¼åä½¿ç¨ loadmodule å½ä»¤è¿è¡å è½½ï¼å¦ä¸æç¤ºï¼\n\nloadmodule redistimeseries.so\n\n\n1\n\n\nå½ç¨äºæ¶é´åºåæ°æ®å­åæ¶ï¼redistimeseries çæä½ä¸»è¦æ 5 ä¸ªï¼\n\n * ç¨ ts.create å½ä»¤åå»ºæ¶é´åºåæ°æ®éåï¼\n * ç¨ ts.add å½ä»¤æå¥æ°æ®ï¼\n * ç¨ ts.get å½ä»¤è¯»åææ°æ°æ®ï¼\n * ç¨ ts.mget å½ä»¤ææ ç­¾è¿æ»¤æ¥è¯¢æ°æ®éåï¼\n * ç¨ ts.range æ¯æèåè®¡ç®çèå´æ¥è¯¢ã\n\nä¸é¢ï¼ææ¥ä»ç»ä¸ä¸å¦ä½ä½¿ç¨è¿5ä¸ªæä½ã\n\n----------------------------------------\n\n1ï¼ç¨ ts.create å½ä»¤åå»ºä¸ä¸ªæ¶é´åºåæ°æ®éåï¼\n\nå¨ts.createå½ä»¤ä¸­ï¼æä»¬éè¦è®¾ç½®æ¶é´åºåæ°æ®éåç key åæ°æ®çè¿ææ¶é´ï¼ä»¥æ¯«ç§ä¸ºåä½ï¼ãæ­¤å¤ï¼æä»¬è¿å¯ä»¥ä¸ºæ°æ®éåè®¾ç½®æ ç­¾ï¼æ¥è¡¨ç¤ºæ°æ®éåçå±æ§ã\n\nä¾å¦ï¼æä»¬æ§è¡ä¸é¢çå½ä»¤ï¼åå»ºä¸ä¸ªkeyä¸ºdevice:temperatureãæ°æ®æææä¸º600sçæ¶é´åºåæ°æ®éåãä¹å°±æ¯è¯´ï¼è¿ä¸ªéåä¸­çæ°æ®åå»ºäº600såï¼å°±ä¼è¢«èªå¨å é¤ãæåï¼æä»¬ç»è¿ä¸ªéåè®¾ç½®äºä¸ä¸ªæ ç­¾å±æ§{device_id:1}ï¼è¡¨æè¿ä¸ªæ°æ®éåä¸­è®°å½çæ¯å±äºè®¾å¤idå·ä¸º1çæ°æ®ã\n\nts.create device:temperature retention 600000 labels device_id 1\nok\n\n\n1\n2\n\n\n----------------------------------------\n\n2ï¼ç¨ ts.add å½ä»¤æå¥æ°æ®ï¼ç¨ ts.get å½ä»¤è¯»åææ°æ°æ®ï¼\n\næä»¬å¯ä»¥ç¨ ts.add å½ä»¤å¾æ¶é´åºåéåä¸­æå¥æ°æ®ï¼åæ¬æ¶é´æ³åå·ä½çæ°å¼ï¼å¹¶ä½¿ç¨ ts.get å½ä»¤è¯»åæ°æ®éåä¸­çææ°ä¸æ¡æ°æ®ã\n\nä¾å¦ï¼æä»¬æ§è¡ä¸å ts.add å½ä»¤æ¶ï¼å°±å¾ device:temperature éåä¸­æå¥äºä¸æ¡æ°æ®ï¼è®°å½çæ¯è®¾å¤å¨2020å¹´8æ3æ¥9æ¶5åçè®¾å¤æ¸©åº¦ï¼åæ§è¡ ts.get å½ä»¤æ¶ï¼å°±ä¼æååæå¥çææ°æ°æ®è¯»ååºæ¥ï¼\n\nts.add device:temperature 1596416700 25.1\n1596416700\n\nts.get device:temperature\n25.1\n\n\n1\n2\n3\n4\n5\n\n\n3ï¼ç¨ ts.mget å½ä»¤ææ ç­¾è¿æ»¤æ¥è¯¢æ°æ®éåï¼\n\nå¨ä¿å­å¤ä¸ªè®¾å¤çæ¶é´åºåæ°æ®æ¶ï¼æä»¬éå¸¸ä¼æä¸åè®¾å¤çæ°æ®ä¿å­å°ä¸åéåä¸­ãæ­¤æ¶ï¼æä»¬å°±å¯ä»¥ä½¿ç¨ts.mgetå½ä»¤ï¼æç§æ ç­¾æ¥è¯¢é¨åéåä¸­çææ°æ°æ®ãå¨ä½¿ç¨ts.createåå»ºæ°æ®éåæ¶ï¼æä»¬å¯ä»¥ç»éåè®¾ç½®æ ç­¾å±æ§ãå½æä»¬è¿è¡æ¥è¯¢æ¶ï¼å°±å¯ä»¥å¨æ¥è¯¢æ¡ä»¶ä¸­å¯¹éåæ ç­¾å±æ§è¿è¡å¹éï¼æåçæ¥è¯¢ç»æéåªè¿åå¹éä¸çéåä¸­çææ°æ°æ®ã\n\nä¸¾ä¸ªä¾å­ãåè®¾æä»¬ä¸å±ç¨4ä¸ªéåä¸º4ä¸ªè®¾å¤ä¿å­æ¶é´åºåæ°æ®ï¼è®¾å¤çidå·æ¯1ã2ã3ã4ï¼æä»¬å¨åå»ºæ°æ®éåæ¶ï¼ædevice_idè®¾ç½®ä¸ºæ¯ä¸ªéåçæ ç­¾ãæ­¤æ¶ï¼æä»¬å°±å¯ä»¥ä½¿ç¨ä¸åts.mgetå½ä»¤ï¼ä»¥åfilterè®¾ç½®ï¼è¿ä¸ªéç½®é¡¹ç¨æ¥è®¾ç½®éåæ ç­¾çè¿æ»¤æ¡ä»¶ï¼ï¼æ¥è¯¢device_idä¸ç­äº2çææå¶ä»è®¾å¤çæ°æ®éåï¼å¹¶è¿ååèªéåä¸­çææ°çä¸æ¡æ°æ®ã\n\nts.mget filter device_id!=2\n1) 1) "device:temperature:1"\n   2) (empty list or set)\n   3) 1) (integer) 1596417000\n      2) "25.3"\n2) 1) "device:temperature:3"\n   2) (empty list or set)\n   3) 1) (integer) 1596417000\n      2) "29.5"\n3) 1) "device:temperature:4"\n   2) (empty list or set)\n   3) 1) (integer) 1596417000\n      2) "30.1"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n4ï¼ç¨ ts.range æ¯æéè¦èåè®¡ç®çèå´æ¥è¯¢ï¼\n\næåï¼å¨å¯¹æ¶é´åºåæ°æ®è¿è¡èåè®¡ç®æ¶ï¼æä»¬å¯ä»¥ä½¿ç¨ts.rangeå½ä»¤æå®è¦æ¥è¯¢çæ°æ®çæ¶é´èå´ï¼åæ¶ç¨aggregationåæ°æå®è¦æ§è¡çèåè®¡ç®ç±»åãredistimeseriesæ¯æçèåè®¡ç®ç±»åå¾ä¸°å¯ï¼åæ¬æ±åå¼ï¼avgï¼ãæ±æå¤§/æå°å¼ï¼max/minï¼ï¼æ±åï¼sumï¼ç­ã\n\nä¾å¦ï¼å¨æ§è¡ä¸åå½ä»¤æ¶ï¼æä»¬å°±å¯ä»¥æç§æ¯180sçæ¶é´çªå£ï¼å¯¹2020å¹´8æ3æ¥9æ¶5åå2020å¹´8æ3æ¥9æ¶12åè¿æ®µæ¶é´åçæ°æ®è¿è¡åå¼è®¡ç®äºã\n\nts.range device:temperature 1596416700 1596417120 aggregation avg 180000\n1) 1) (integer) 1596416700\n   2) "25.6"\n2) 1) (integer) 1596416880\n   2) "25.8"\n3) 1) (integer) 1596417060\n   2) "26.1"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸ä½¿ç¨hashåsorted setæ¥ä¿å­æ¶é´åºåæ°æ®ç¸æ¯ï¼redistimeseriesæ¯ä¸é¨ä¸ºæ¶é´åºåæ°æ®è®¿é®è®¾è®¡çæ©å±æ¨¡åï¼è½æ¯æå¨rediså®ä¾ä¸ç´æ¥è¿è¡èåè®¡ç®ï¼ä»¥åææ ç­¾å±æ§è¿æ»¤æ¥è¯¢æ°æ®éåï¼å½æä»¬éè¦é¢ç¹è¿è¡èåè®¡ç®ï¼ä»¥åä»å¤§ééåä¸­ç­éåºç¹å®è®¾å¤æç¨æ·çæ°æ®éåæ¶ï¼redistimeserieså°±å¯ä»¥åæ¥ä¼å¿äºã\n\n\n# 1.4 å°ç»\n\nè¿ä¸èå­¦ä¹ äºå¦ä½ä½¿ç¨ redis ä¿å­æ¶é´åºåæ°æ®ãæ¶é´åºåæ°æ®çåå¥ç¹ç¹æ¯è¦è½å¿«éåå¥ï¼èæ¥è¯¢çç¹ç¹æä¸ä¸ªï¼\n\n * ç¹æ¥è¯¢ï¼æ ¹æ®ä¸ä¸ªæ¶é´æ³ï¼æ¥è¯¢ç¸åºæ¶é´çæ°æ®ï¼\n * èå´æ¥è¯¢ï¼æ¥è¯¢èµ·å§åæªæ­¢æ¶é´æ³èå´åçæ°æ®ï¼\n * èåè®¡ç®ï¼éå¯¹èµ·å§åæªæ­¢æ¶é´æ³èå´åçæææ°æ®è¿è¡è®¡ç®ï¼ä¾å¦æ±æå¤§/æå°å¼ï¼æ±åå¼ç­ã\n\nä¸ºäºéå¯¹å¤æ ·åçæ¥è¯¢éæ±ï¼redis æä¾äºä¸¤ç§æ¹æ¡ï¼\n\n 1. ç»åä½¿ç¨ redis åç½®ç hash å sorted set ç±»å\n 2. ä½¿ç¨ redistimeseries æ¨¡å\n\nä¸¤ç§æ¹æ¡åèªçä¼å£ï¼\n\n * ç¬¬ä¸ç§ï¼\n   * æ¢å¯ä»¥å©ç¨hashç±»åå®ç°å¯¹åé®çå¿«éæ¥è¯¢ï¼è¿è½å©ç¨sorted setå®ç°å¯¹èå´æ¥è¯¢çé«ææ¯æï¼ä¸ä¸å­æ»¡è¶³äºæ¶é´åºåæ°æ®çä¸¤å¤§æ¥è¯¢éæ±ã\n   * ä¸¤ä¸ªä¸è¶³ï¼ä¸ä¸ªæ¯ï¼å¨æ§è¡èåè®¡ç®æ¶ï¼æä»¬éè¦ææ°æ®è¯»åå°å®¢æ·ç«¯åè¿è¡èåï¼å½æå¤§éæ°æ®è¦èåæ¶ï¼æ°æ®ä¼ è¾å¼éå¤§ï¼å¦ä¸ä¸ªæ¯ï¼ææçæ°æ®ä¼å¨ä¸¤ä¸ªæ°æ®ç±»åä¸­åä¿å­ä¸ä»½ï¼åå­å¼éä¸å°ãä¸è¿ï¼æä»¬å¯ä»¥éè¿è®¾ç½®éå½çæ°æ®è¿ææ¶é´ï¼éæ¾åå­ï¼åå°åå­ååã\n * ç¬¬äºç§ï¼\n   * redistimeseriesè½æ¯æç´æ¥å¨rediså®ä¾ä¸è¿è¡å¤ç§æ°æ®èåè®¡ç®ï¼é¿åäºå¤§éæ°æ®å¨å®ä¾åå®¢æ·ç«¯é´ä¼ è¾ã\n   * ä¸è¶³ï¼redistimeseriesçåºå±æ°æ®ç»æä½¿ç¨äºé¾è¡¨ï¼å®çèå´æ¥è¯¢çå¤æåº¦æ¯o(n)çº§å«çï¼åæ¶ï¼å®çts.getæ¥è¯¢åªè½è¿åææ°çæ°æ®ï¼æ²¡æåæ³åç¬¬ä¸ç§æ¹æ¡çhashç±»åä¸æ ·ï¼å¯ä»¥è¿åä»»ä¸æ¶é´ç¹çæ°æ®ã\n\nè¿ä¸¤ç§æ¹æ¡åæä¼å£ï¼å»ºè®®æ¯ï¼\n\n * å¦æä½ çé¨ç½²ç¯å¢ä¸­ç½ç»å¸¦å®½é«ãrediså®ä¾åå­å¤§ï¼å¯ä»¥ä¼åèèç¬¬ä¸ç§æ¹æ¡ï¼\n * å¦æä½ çé¨ç½²ç¯å¢ä¸­ç½ç»ãåå­èµæºæéï¼èä¸æ°æ®éå¤§ï¼èåè®¡ç®é¢ç¹ï¼éè¦ææ°æ®éåå±æ§æ¥è¯¢ï¼å¯ä»¥ä¼åèèç¬¬äºç§æ¹æ¡ã\n\n----------------------------------------\n\næ¬èé®é¢ 1ï¼å¨ç¨sorted setä¿å­æ¶é´åºåæ°æ®æ¶ï¼æä»¬ææ¶é´æ³ä½ä¸ºscoreï¼æå®éçæ°æ®ä½ä¸ºmemberï¼è¿æ ·ä¿å­æ°æ®ææ²¡ææ½å¨çé£é©ï¼\n\nsorted setåsetä¸æ ·ï¼é½ä¼å¯¹éåä¸­çåç´ è¿è¡å»éï¼ç¸åmemberçå¼ï¼å¨sorted setä¸­åªä¼ä¿çä¸ä¸ªã\n\nå¯¹äºæ¶é´åºåæ°æ®æ¥è¯´ï¼è¿ç§å»éçç¹æ§æ¯ä¼å¸¦æ¥æ°æ®ä¸¢å¤±é£é©çãæ¯ç«ï¼æä¸æ¶é´æ®µåçå¤ä¸ªæ¶é´åºåæ°æ®çå¼å¯è½æ¯ç¸åçãå¦ææä»¬å¾sorted setä¸­åå¥çæ°æ®æ¯å¨ä¸åæ¶å»äº§ççï¼ä½æ¯åå¥çæ¶å»ä¸åï¼sorted setä¸­åªä¼ä¿å­ä¸ä»½æè¿æ¶å»çæ°æ®ãè¿æ ·ä¸æ¥ï¼å¶ä»æ¶å»çæ°æ®å°±é½æ²¡æä¿å­ä¸æ¥ã\n\nä¸¾ä¸ªä¾å­ï¼å¨è®°å½ç©èç½è®¾å¤çæ¸©åº¦æ¶ï¼ä¸ä¸ªè®¾å¤ä¸ä¸ªä¸åçæ¸©åº¦å¼å¯è½é½æ¯26ãå¨sorted setä¸­ï¼æä»¬ææ¸©åº¦å¼ä½ä¸ºmemberï¼ææ¶é´æ³ä½ä¸ºscoreãæä»¬ç¨zaddå½ä»¤æä¸åä¸åæ¶å»çæ¸©åº¦å¼åå¥sorted setãç±äºmemberå¼ä¸æ ·ï¼æä»¥åªä¼æscoreæ´æ°ä¸ºææ°æ¶é´æ³ï¼æååªæä¸ä¸ªææ°æ¶é´æ³ï¼ä¾å¦ä¸å12ç¹ï¼ä¸çæ¸©åº¦å¼ãè¿è¯å®æ¯æ æ³æ»¡è¶³ä¿å­å¤ä¸ªæ¶å»æ°æ®çéæ±çã\n\næ¬èé®é¢ 2ï¼å¦æä½ æ¯redisçå¼åç»´æ¤èï¼ä½ ä¼æèåè®¡ç®ä¹è®¾è®¡ä¸ºsorted setçä¸ä¸ªåå¨åè½åï¼\n\nèèå°redisçè¯»ååè½æ¯ç±åçº¿ç¨æ§è¡ï¼å¨è¿è¡æ°æ®è¯»åæ¶ï¼æ¬èº«å°±ä¼æ¶èè¾å¤çcpuèµæºï¼å¦æåå¨sorted setä¸­å®ç°èåè®¡ç®ï¼å°±ä¼è¿ä¸æ­¥å¢å cpuçèµæºæ¶èï¼å½±åå°redisçæ­£å¸¸æ°æ®è¯»åãæä»¥ï¼å¦æææ¯redisçå¼åç»´æ¤èï¼é¤éå¯¹redisççº¿ç¨æ¨¡ååä¿®æ¹ï¼æ¯å¦è¯´å¨redisä¸­ä½¿ç¨é¢å¤ççº¿ç¨æ± åèåè®¡ç®ï¼å¦åï¼æä¸ä¼æèåè®¡ç®ä½ä¸ºredisçåå¨åè½å®ç°çã',charsets:{cjk:!0},lastUpdated:"2023/04/10, 14:17:28",lastUpdatedTimestamp:1681136248e3},{title:"Redis çæ¶æ¯éåæ¹æ¡",frontmatter:{title:"Redis çæ¶æ¯éåæ¹æ¡",date:"2023-04-06T11:27:04.000Z",permalink:"/pages/5d636a/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/15.Redis%20%E7%9A%84%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%96%B9%E6%A1%88.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/15.Redis çæ¶æ¯éåæ¹æ¡.md",key:"v-0b361225",path:"/pages/5d636a/",headers:[{level:2,title:"1. æ¶æ¯éåçèéªï¼Redisæåªäºè§£å³æ¹æ¡ï¼",slug:"_1-æ¶æ¯éåçèéª-redisæåªäºè§£å³æ¹æ¡",normalizedTitle:"1. æ¶æ¯éåçèéªï¼redisæåªäºè§£å³æ¹æ¡ï¼",charIndex:50},{level:3,title:"1.1 MQ çæ¶æ¯å­åéæ±",slug:"_1-1-mq-çæ¶æ¯å­åéæ±",normalizedTitle:"1.1 mq çæ¶æ¯å­åéæ±",charIndex:281},{level:4,title:"éæ±ä¸ï¼æ¶æ¯ä¿åº",slug:"éæ±ä¸-æ¶æ¯ä¿åº",normalizedTitle:"éæ±ä¸ï¼æ¶æ¯ä¿åº",charIndex:652},{level:4,title:"éæ±äºï¼éå¤æ¶æ¯å¤çï¼å¹ç­è¦æ±ï¼",slug:"éæ±äº-éå¤æ¶æ¯å¤ç-å¹ç­è¦æ±",normalizedTitle:"éæ±äºï¼éå¤æ¶æ¯å¤çï¼å¹ç­è¦æ±ï¼",charIndex:946},{level:4,title:"éæ±ä¸ï¼æ¶æ¯å¯é æ§ä¿è¯",slug:"éæ±ä¸-æ¶æ¯å¯é æ§ä¿è¯",normalizedTitle:"éæ±ä¸ï¼æ¶æ¯å¯é æ§ä¿è¯",charIndex:1087},{level:3,title:"1.2 åºäº List ç MQ è§£å³æ¹æ¡",slug:"_1-2-åºäº-list-ç-mq-è§£å³æ¹æ¡",normalizedTitle:"1.2 åºäº list ç mq è§£å³æ¹æ¡",charIndex:1267},{level:4,title:"1.2.1 è§£å³æ¶æ¯ä¿åºé®é¢",slug:"_1-2-1-è§£å³æ¶æ¯ä¿åºé®é¢",normalizedTitle:"1.2.1 è§£å³æ¶æ¯ä¿åºé®é¢",charIndex:1292},{level:4,title:"1.2.2 å¹ç­æ§è¦æ±ï¼å¤çéå¤æ¶æ¯ï¼",slug:"_1-2-2-å¹ç­æ§è¦æ±-å¤çéå¤æ¶æ¯",normalizedTitle:"1.2.2 å¹ç­æ§è¦æ±ï¼å¤çéå¤æ¶æ¯ï¼",charIndex:1624},{level:4,title:"1.2.3 æ¶æ¯å¯é æ§ä¿è¯",slug:"_1-2-3-æ¶æ¯å¯é æ§ä¿è¯",normalizedTitle:"1.2.3 æ¶æ¯å¯é æ§ä¿è¯",charIndex:1947},{level:3,title:"1.3 åºäº Streams çæ¶æ¯éåè§£å³æ¹æ¡",slug:"_1-3-åºäº-streams-çæ¶æ¯éåè§£å³æ¹æ¡",normalizedTitle:"1.3 åºäº streams çæ¶æ¯éåè§£å³æ¹æ¡",charIndex:2620},{level:4,title:"1ï¼XADD å½ä»¤",slug:"_1-xadd-å½ä»¤",normalizedTitle:"1ï¼xadd å½ä»¤",charIndex:2872},{level:4,title:"2ï¼XREAD å½ä»¤",slug:"_2-xread-å½ä»¤",normalizedTitle:"2ï¼xread å½ä»¤",charIndex:3355},{level:4,title:"3ï¼XGROUP ä¸ XREADGROUP",slug:"_3-xgroup-ä¸-xreadgroup",normalizedTitle:"3ï¼xgroup ä¸ xreadgroup",charIndex:4246},{level:4,title:"4ï¼XPENDING å XACK",slug:"_4-xpending-å-xack",normalizedTitle:"4ï¼xpending å xack",charIndex:5887},{level:3,title:"1.4 å°ç»",slug:"_1-4-å°ç»",normalizedTitle:"1.4 å°ç»",charIndex:7041}],headersStr:"1. æ¶æ¯éåçèéªï¼Redisæåªäºè§£å³æ¹æ¡ï¼ 1.1 MQ çæ¶æ¯å­åéæ± éæ±ä¸ï¼æ¶æ¯ä¿åº éæ±äºï¼éå¤æ¶æ¯å¤çï¼å¹ç­è¦æ±ï¼ éæ±ä¸ï¼æ¶æ¯å¯é æ§ä¿è¯ 1.2 åºäº List ç MQ è§£å³æ¹æ¡ 1.2.1 è§£å³æ¶æ¯ä¿åºé®é¢ 1.2.2 å¹ç­æ§è¦æ±ï¼å¤çéå¤æ¶æ¯ï¼ 1.2.3 æ¶æ¯å¯é æ§ä¿è¯ 1.3 åºäº Streams çæ¶æ¯éåè§£å³æ¹æ¡ 1ï¼XADD å½ä»¤ 2ï¼XREAD å½ä»¤ 3ï¼XGROUP ä¸ XREADGROUP 4ï¼XPENDING å XACK 1.4 å°ç»",content:'> åèï¼\n> \n>  * 15 æ¶æ¯éåçèéªï¼Redis æåªäºè§£å³æ¹æ¡ï¼| æå®¢æ¶é´\n\n\n# 1. æ¶æ¯éåçèéªï¼Redisæåªäºè§£å³æ¹æ¡ï¼\n\næ¶æ¯éåæ¯åå¸å¼ç³»ç»çåºç¡è½¯ä»¶ï¼è¦è½æ¯æç»ä»¶éä¿¡æ¶æ¯çå¿«éè¯»åãRedis æ¬èº«æ¯ææ°æ®çé«éè®¿é®ï¼å æ­¤å¾å¤äººå³å¿ä¸ä¸ªé®é¢ï¼Redis éåå MQ åï¼\n\nè¿ä¸ªé®é¢çèåï¼éå«çä¸¤æ¹é¢çæ ¸å¿é®é¢ï¼\n\n * æ¶æ¯éåçæ¶æ¯å­åéæ±æ¯ä»ä¹ï¼\n * Redis å¦ä½å®ç°æ¶æ¯éåçéæ±ï¼\n\nçè§£äº MQ çç¹å¾å Redis æä¾ç MQ æ¹æ¡ï¼æè½æ ¹æ®å®ééæ±æ¥éæ©åºéåç Redis æ¶æ¯éåæ¹æ¡ã\n\n\n# 1.1 MQ çæ¶æ¯å­åéæ±\n\nåä»ç»ä¸ä¸æ¶æ¯éåå­åæ¶æ¯çè¿ç¨ãå¨åå¸å¼ç³»ç»ä¸­ï¼å½ä¸¤ä¸ªç»ä»¶è¦åºäºæ¶æ¯éåè¿è¡éä¿¡æ¶ï¼ä¸ä¸ªç»ä»¶ä¼æè¦å¤ççæ°æ®ä»¥æ¶æ¯çå½¢å¼ä¼ éç»æ¶æ¯éåï¼ç¶åï¼è¿ä¸ªç»ä»¶å°±å¯ä»¥ç»§ç»­æ§è¡å¶ä»æä½äºï¼è¿ç«¯çå¦ä¸ä¸ªç»ä»¶ä»æ¶æ¯éåä¸­ææ¶æ¯è¯»ååºæ¥ï¼åå¨æ¬å°è¿è¡å¤çã\n\nä¸ä¸ªéç¨ç MQ çæ¶ææ¨¡åä¸ºï¼\n\næ¶æ¯éåä¸­åéæ¶æ¯çç»ä»¶ç§°ä¸ºçäº§èï¼æ¥æ¶æ¶æ¯çç»ä»¶ç§°ä¸ºæ¶è´¹èã\n\nå¨ä½¿ç¨æ¶æ¯éåæ¶ï¼æ¶è´¹èå¯ä»¥å¼æ­¥è¯»åçäº§èæ¶æ¯ï¼ç¶ååè¿è¡å¤çãè¿æ ·ä¸æ¥ï¼å³ä½¿çäº§èåéæ¶æ¯çéåº¦è¿è¿è¶è¿äºæ¶è´¹èå¤çæ¶æ¯çéåº¦ï¼çäº§èå·²ç»åéçæ¶æ¯ä¹å¯ä»¥ç¼å­å¨æ¶æ¯éåä¸­ï¼é¿åé»å¡çäº§èï¼è¿æ¯æ¶æ¯éåä½ä¸ºåå¸å¼ç»ä»¶éä¿¡çä¸å¤§ä¼å¿ã\n\nMQ å¨å­åæ¶æ¯æ¶ï¼å¿é¡»è¦æ»¡è¶³ä¸ä¸ªéæ±ï¼\n\n 1. æ¶æ¯ä¿åº\n 2. å¤çéå¤çæ¶æ¯ï¼å¹ç­è¦æ±ï¼\n 3. ä¿è¯æ¶æ¯å¯é æ§\n\n# éæ±ä¸ï¼æ¶æ¯ä¿åº\n\nè½ç¶æ¶è´¹èæ¯å¼æ­¥å¤çæ¶æ¯ï¼ä½æ¯ï¼æ¶è´¹èä»ç¶éè¦æç§çäº§èåéæ¶æ¯çé¡ºåºæ¥å¤çæ¶æ¯ï¼é¿åååéçæ¶æ¯è¢«åå¤çäºãå¯¹äºè¦æ±æ¶æ¯ä¿åºçåºæ¯æ¥è¯´ï¼ä¸æ¦åºç°è¿ç§æ¶æ¯è¢«ä¹±åºå¤ççæåµï¼å°±å¯è½ä¼å¯¼è´ä¸å¡é»è¾è¢«éè¯¯æ§è¡ï¼ä»èç»ä¸å¡æ¹é ææå¤±ã\n\næä»¬æ¥çä¸ä¸ªæ´æ°åååºå­çåºæ¯ï¼åè®¾çäº§èè´è´£æ¥æ¶åºå­æ´æ°è¯·æ±ï¼æ¶è´¹èè´è´£å®éæ´æ°åºå­ï¼ç°æåºå­éæ¯10ãçäº§èåååéäºæ¶æ¯1åæ¶æ¯2ï¼æ¶æ¯1è¦æååXçåºå­è®°å½æ´æ°ä¸º5ï¼æ¶æ¯2æ¯æååXåºå­æ´æ°ä¸º3ãå¦ææ¶æ¯1å2å¨æ¶æ¯éåä¸­æ æ³ä¿åºï¼åºç°æ¶æ¯2æ©äºæ¶æ¯1è¢«å¤ççæåµï¼é£ä¹ï¼å¾æ¾ç¶ï¼åºå­æ´æ°å°±åºéäºãè¿æ¯ä¸å¡åºç¨æ æ³æ¥åçã\n\n# éæ±äºï¼éå¤æ¶æ¯å¤çï¼å¹ç­è¦æ±ï¼\n\næ¶è´¹èä»æ¶æ¯éåè¯»åæ¶æ¯æ¶ï¼ææ¶ä¼å ä¸ºç½ç»å µå¡èåºç°æ¶æ¯éä¼ çæåµãå¯¹äºéå¤çæ¶æ¯ï¼æ¶è´¹èå¦æå¤æ¬¡å¤ççè¯ï¼å°±å¯è½é æä¸ä¸ªä¸å¡é»è¾è¢«å¤æ¬¡æ§è¡ï¼å¦æä¸å¡é»è¾æ­£å¥½æ¯è¦ä¿®æ¹æ°æ®ï¼é£å°±ä¼åºç°æ°æ®è¢«å¤æ¬¡ä¿®æ¹çé®é¢äºã\n\næ¯å¦å¯è½åºç°éå¤æ£æ¬¾çé®é¢ã\n\n# éæ±ä¸ï¼æ¶æ¯å¯é æ§ä¿è¯\n\næ¶è´¹èå¨å¤çæ¶æ¯çæ¶åï¼è¿å¯è½åºç°å ä¸ºæéæå®æºå¯¼è´æ¶æ¯æ²¡æå¤çå®æçæåµãæ­¤æ¶ï¼æ¶æ¯éåéè¦è½æä¾æ¶æ¯å¯é æ§çä¿è¯ï¼ä¹å°±æ¯è¯´ï¼å½æ¶è´¹èéå¯åï¼å¯ä»¥éæ°è¯»åæ¶æ¯åæ¬¡è¿è¡å¤çï¼å¦åï¼å°±ä¼åºç°æ¶æ¯æ¼å¤ççé®é¢äºã\n\nRedis ç List å Streams ä¸¤ç§æ°æ®ç±»åï¼å°±å¯ä»¥æ»¡è¶³æ¶æ¯éåçè¿ä¸ä¸ªéæ±ãä¸é¢æ¥çè¿ä¸¤ç§æ¹æ¡ã\n\n\n# 1.2 åºäº List ç MQ è§£å³æ¹æ¡\n\n# 1.2.1 è§£å³æ¶æ¯ä¿åºé®é¢\n\nList æ¬èº«å°±æ¯æåè¿ååºçé¡ºåºå¯¹æ°æ®è¿è¡å­åçï¼æä»¥å¦æä½¿ç¨ List ä½ä¸ºæ¶æ¯éåä¿å­æ¶æ¯çè¯ï¼å°±å·²ç»è½æ»¡è¶³æ¶æ¯ä¿åºçéæ±äºï¼\n\n * çäº§èä½¿ç¨ LPUSH å½ä»¤ææ¶æ¯åå¥ List\n * æ¶è´¹èä½¿ç¨ RPOP å½ä»¤è¯»åæ¶æ¯\n\nä¸è¿è¿æ ·çè¯ List ä¸ä¼ä¸»å¨åç¥æ¶è´¹èææ°æ¶æ¯çåå¥ï¼è¿æ ·å°±éè¦æ¶è´¹èä¸ç´è°ç¨ RPOP æ¥çå¬æ¶æ¯ï¼æ¯å¦ä½¿ç¨ä¸ä¸ªwhile(1)å¾ªç¯ï¼ï¼è¿ä¼å¸¦æ¥ä¸å¿è¦çæ§è½æå¤±ã\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼Redis æä¾äº BRPOP å½ä»¤ï¼é»å¡å¼è¯»åï¼å®¢æ·ç«¯å¨æ²¡æè¯»å°éåæ°æ®æ¶ï¼èªå¨é»å¡ï¼ç´å°ææ°çæ°æ®åå¥éåï¼åå¼å§è¯»åæ°æ°æ®ãè¿ç§æ¹å¼ç¸æ¯æ¶è´¹èä¸åè°ç¨ RPOP èè¨ï¼æ´å èç CPU å¼éã\n\n# 1.2.2 å¹ç­æ§è¦æ±ï¼å¤çéå¤æ¶æ¯ï¼\n\nè§£å³æ¶æ¯éå¤é®é¢ï¼å¶å®æä¸ä¸ªè¦æ±ï¼æ¶è´¹èç¨åºæ¬èº«è½å¯¹éå¤æ¶æ¯è¿è¡å¤æ­ï¼\n\n * ä¸æ¹é¢ï¼æ¶æ¯éåè¦è½ç»æ¯ä¸ä¸ªæ¶æ¯æä¾å¨å±å¯ä¸ç ID å·ï¼\n * å¦ä¸æ¹é¢ï¼æ¶è´¹èç¨åºè¦æå·²ç»å¤çè¿çæ¶æ¯ç ID å·è®°å½ä¸æ¥ã\n\nå¹ç­æ§å°±æ¯æï¼å¯¹äºåä¸æ¡æ¶æ¯ï¼æ¶è´¹èæ¶å°ä¸æ¬¡çå¤çç»æåæ¶å°å¤æ¬¡çå¤çç»ææ¯ä¸è´çã\n\nå ä¸º List æ¬èº«ä¸ä¼ä¸ºæ¶æ¯çæ ID å·ï¼å æ­¤éè¦çäº§èå¨åéæ¶æ¯æ¶éå¸¦ä¸å¨å±å¯ä¸ IDãä¾å¦ï¼æä»¬æ§è¡ä»¥ä¸å½ä»¤ï¼å°±æä¸æ¡å¨å± ID ä¸º 101030001ãåºå­éä¸º 5 çæ¶æ¯æå¥äºæ¶æ¯éåï¼\n\nLPUSH mq "101030001:stock:5"\n(integer) 1\n\n\n1\n2\n\n\n# 1.2.3 æ¶æ¯å¯é æ§ä¿è¯\n\nå½æ¶è´¹èç¨åºä» List ä¸­è¯»åä¸æ¡æ¶æ¯åï¼List å°±ä¸ä¼åçå­è¿æ¡æ¶æ¯äºãæä»¥ï¼å¦ææ¶è´¹èç¨åºå¨å¤çæ¶æ¯çè¿ç¨åºç°äºæéæå®æºï¼å°±ä¼å¯¼è´æ¶æ¯æ²¡æå¤çå®æï¼é£ä¹ï¼æ¶è´¹èç¨åºåæ¬¡å¯å¨åï¼å°±æ²¡æ³åæ¬¡ä» List ä¸­è¯»åæ¶æ¯äºã\n\nä¸ºäºçå­æ¶æ¯ï¼List ç±»åæä¾äº BRPOPLPUSH å½ä»¤ï¼è¿ä¸ªå½ä»¤çä½ç¨æ¯è®©æ¶è´¹èç¨åºä»ä¸ä¸ª List ä¸­è¯»åæ¶æ¯ï¼åæ¶ï¼Redis ä¼æè¿ä¸ªæ¶æ¯åæå¥å°å¦ä¸ä¸ª Listï¼å¯ä»¥å«ä½å¤ä»½Listï¼çå­ãè¿æ ·ä¸æ¥ï¼å¦ææ¶è´¹èç¨åºè¯»äºæ¶æ¯ä½æ²¡è½æ­£å¸¸å¤çï¼ç­å®éå¯åï¼å°±å¯ä»¥ä»å¤ä»½ List ä¸­éæ°è¯»åæ¶æ¯å¹¶è¿è¡å¤çäºãä¸å¾æ¯ä½¿ç¨ BRPOPLPUSH å½ä»¤çå­æ¶æ¯ï¼ä»¥åæ¶è´¹èåæ¬¡è¯»åæ¶æ¯çè¿ç¨ï¼\n\nå¥½äºï¼å°è¿éä½ å¯ä»¥çå°ï¼åºäº List ç±»åï¼æä»¬å¯ä»¥æ»¡è¶³åå¸å¼ç»ä»¶å¯¹æ¶æ¯éåçä¸å¤§éæ±ãä½æ¯ï¼å¨ç¨ List åæ¶æ¯éåæ¶ï¼æä»¬è¿å¯è½éå°è¿ä¸ä¸ªé®é¢ï¼çäº§èæ¶æ¯åéå¾å¿«ï¼èæ¶è´¹èå¤çæ¶æ¯çéåº¦æ¯è¾æ¢ï¼è¿å°±å¯¼è´ List ä¸­çæ¶æ¯è¶ç§¯è¶å¤ï¼ç» Redis çåå­å¸¦æ¥å¾å¤§ååãè¿ä¸ªæ¶åï¼æä»¬å¸æå¯å¨å¤ä¸ªæ¶è´¹èç¨åºç»æä¸ä¸ªæ¶è´¹ç»ï¼ä¸èµ·åæå¤ç List ä¸­çæ¶æ¯ãä½æ¯ï¼List ç±»åå¹¶ä¸æ¯ææ¶è´¹ç»çå®ç°ãé£ä¹ï¼è¿ææ²¡ææ´åéçè§£å³æ¹æ¡å¢ï¼è¿å°±è¦è¯´å° Redis ä» 5.0 çæ¬å¼å§æä¾ç Streams æ°æ®ç±»åäºã\n\nå List ç¸æ¯ï¼Streams åæ ·è½å¤æ»¡è¶³æ¶æ¯éåçä¸å¤§éæ±ãèä¸ï¼å®è¿æ¯ææ¶è´¹ç»å½¢å¼çæ¶æ¯è¯»åãæ¥ä¸æ¥ï¼æä»¬å°±æ¥äºè§£ä¸ Streams çä½¿ç¨æ¹æ³ã\n\n\n# 1.3 åºäº Streams çæ¶æ¯éåè§£å³æ¹æ¡\n\nStreams æ¯ Redis ä¸é¨ä¸ºæ¶æ¯éåè®¾è®¡çæ°æ®ç±»åï¼å®æä¾äºä¸°å¯çæ¶æ¯éåæä½å½ä»¤ï¼\n\n * XADDï¼æå¥æ¶æ¯ï¼ä¿è¯æåºï¼å¯ä»¥èªå¨çæå¨å±å¯ä¸ IDï¼\n * XREADï¼ç¨äºè¯»åæ¶æ¯ï¼å¯ä»¥æ ID è¯»åæ°æ®ï¼\n * XREADGROUPï¼ææ¶è´¹ç»å½¢å¼è¯»åæ¶æ¯ï¼\n * XPENDING å XACKï¼XPENDING å½ä»¤å¯ä»¥ç¨æ¥æ¥è¯¢æ¯ä¸ªæ¶è´¹ç»åæææ¶è´¹èå·²è¯»åä½å°æªç¡®è®¤çæ¶æ¯ï¼è XACK å½ä»¤ç¨äºåæ¶æ¯éåç¡®è®¤æ¶æ¯å¤çå·²å®æã\n\n# 1ï¼XADD å½ä»¤\n\nXADD å½ä»¤å¯ä»¥å¾æ¶æ¯éåä¸­æå¥æ°æ¶æ¯ï¼æ¶æ¯çæ ¼å¼æ¯é®-å¼å¯¹å½¢å¼ãå¯¹äºæå¥çæ¯ä¸æ¡æ¶æ¯ï¼Streams å¯ä»¥èªå¨ä¸ºå¶çæä¸ä¸ªå¨å±å¯ä¸ç IDã\n\næ¯å¦è¯´ï¼æä»¬æ§è¡ä¸é¢çå½ä»¤ï¼å°±å¯ä»¥å¾åç§°ä¸º mqstream çæ¶æ¯éåä¸­æå¥ä¸æ¡æ¶æ¯ï¼æ¶æ¯çé®æ¯repoï¼å¼æ¯5ãå¶ä¸­ï¼æ¶æ¯éååç§°åé¢ç *ï¼è¡¨ç¤ºè®©Redisä¸ºæå¥çæ°æ®èªå¨çæä¸ä¸ªå¨å±å¯ä¸çIDï¼ä¾å¦â1599203861727-0âãå½ç¶ï¼æä»¬ä¹å¯ä»¥ä¸ç¨ *ï¼ç´æ¥å¨æ¶æ¯éååç§°åèªè¡è®¾å®ä¸ä¸ªIDå·ï¼åªè¦ä¿è¯è¿ä¸ªIDå·æ¯å¨å±å¯ä¸çå°±è¡ãä¸è¿ï¼ç¸æ¯èªè¡è®¾å®IDå·ï¼ä½¿ç¨ * ä¼æ´å æ¹ä¾¿é«æã\n\nXADD mqstream * repo 5\n"1599203861727-0"\n\n\n1\n2\n\n\nå¯ä»¥çå°ï¼æ¶æ¯çå¨å±å¯ä¸IDç±ä¸¤é¨åç»æï¼ç¬¬ä¸é¨åâ1599203861727âæ¯æ°æ®æå¥æ¶ï¼ä»¥æ¯«ç§ä¸ºåä½è®¡ç®çå½åæå¡å¨æ¶é´ï¼ç¬¬äºé¨åè¡¨ç¤ºæå¥æ¶æ¯å¨å½åæ¯«ç§åçæ¶æ¯åºå·ï¼è¿æ¯ä»0å¼å§ç¼å·çãä¾å¦ï¼â1599203861727-0âå°±è¡¨ç¤ºå¨â1599203861727âæ¯«ç§åçç¬¬1æ¡æ¶æ¯ã\n\n# 2ï¼XREAD å½ä»¤\n\nå½æ¶è´¹èéè¦è¯»åæ¶æ¯æ¶ï¼å¯ä»¥ç´æ¥ä½¿ç¨XREADå½ä»¤ä»æ¶æ¯éåä¸­è¯»åãXREAD å¨è¯»åæ¶æ¯æ¶ï¼å¯ä»¥æå®ä¸ä¸ªæ¶æ¯ IDï¼å¹¶ä»è¿ä¸ªæ¶æ¯ ID çä¸ä¸æ¡æ¶æ¯å¼å§è¿è¡è¯»åã\n\nä¾å¦ï¼æä»¬å¯ä»¥æ§è¡ä¸é¢çå½ä»¤ï¼ä» ID å·ä¸º 1599203861727-0 çæ¶æ¯å¼å§ï¼è¯»ååç»­çæææ¶æ¯ï¼ç¤ºä¾ä¸­ä¸å± 3 æ¡ï¼ï¼\n\nXREAD BLOCK 100 STREAMS  mqstream 1599203861727-0\n1) 1) "mqstream"\n   2) 1) 1) "1599274912765-0"\n         2) 1) "repo"\n            2) "3"\n      2) 1) "1599274925823-0"\n         2) 1) "repo"\n            2) "2"\n      3) 1) "1599274927910-0"\n         2) 1) "repo"\n            2) "1"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¦å¤ï¼æ¶è´¹èä¹å¯ä»¥å¨è°ç¨ XRAED æ¶è®¾å® block éç½®é¡¹ï¼å®ç°ç±»ä¼¼äº BRPOP çé»å¡è¯»åæä½ãå½æ¶æ¯éåä¸­æ²¡ææ¶æ¯æ¶ï¼ä¸æ¦è®¾ç½®äº block éç½®é¡¹ï¼XREAD å°±ä¼é»å¡ï¼é»å¡çæ¶é¿å¯ä»¥å¨ block éç½®é¡¹è¿è¡è®¾ç½®ã\n\nä¸¾ä¸ªä¾å­ï¼æä»¬æ¥çä¸ä¸ä¸é¢çå½ä»¤ï¼å¶ä¸­ï¼å½ä»¤æåçâ$âç¬¦å·è¡¨ç¤ºè¯»åææ°çæ¶æ¯ï¼åæ¶ï¼æä»¬è®¾ç½®äºblock 10000çéç½®é¡¹ï¼10000çåä½æ¯æ¯«ç§ï¼è¡¨æXREADå¨è¯»åææ°æ¶æ¯æ¶ï¼å¦ææ²¡ææ¶æ¯å°æ¥ï¼XREADå°é»å¡10000æ¯«ç§ï¼å³10ç§ï¼ï¼ç¶ååè¿åãä¸é¢å½ä»¤ä¸­çXREADæ§è¡åï¼æ¶æ¯éåmqstreamä¸­ä¸ç´æ²¡ææ¶æ¯ï¼æä»¥ï¼XREADå¨10ç§åè¿åç©ºå¼ï¼nilï¼ï¼\n\nXREAD block 10000 streams mqstream $\n(nil)\n(10.00s)\n\n\n1\n2\n3\n\n\nååè®²å°çè¿äºæä½æ¯ List ä¹æ¯æçï¼æ¥ä¸æ¥ï¼æä»¬åæ¥å­¦ä¹ ä¸ Streams ç¹æçåè½ã\n\n# 3ï¼XGROUP ä¸ XREADGROUP\n\nStreams æ¬èº«å¯ä»¥ä½¿ç¨ XGROUP åå»ºæ¶è´¹ç»ï¼åå»ºæ¶è´¹ç»ä¹åï¼Streams å¯ä»¥ä½¿ç¨ XREADGROUP å½ä»¤è®©æ¶è´¹ç»åçæ¶è´¹èè¯»åæ¶æ¯ã\n\nä¾å¦ï¼æä»¬æ§è¡ä¸é¢çå½ä»¤ï¼åå»ºä¸ä¸ªåä¸º group1 çæ¶è´¹ç»ï¼è¿ä¸ªæ¶è´¹ç»æ¶è´¹çæ¶æ¯éåæ¯ mqstreamï¼\n\nXGROUP create mqstream group1 0\nOK\n\n\n1\n2\n\n\nç¶åï¼æä»¬åæ§è¡ä¸æ®µå½ä»¤ï¼è®©group1æ¶è´¹ç»éçæ¶è´¹èconsumer1ä»mqstreamä¸­è¯»åæææ¶æ¯ï¼å¶ä¸­ï¼å½ä»¤æåçåæ°â>âï¼è¡¨ç¤ºä»ç¬¬ä¸æ¡å°æªè¢«æ¶è´¹çæ¶æ¯å¼å§è¯»åãå ä¸ºå¨consumer1è¯»åæ¶æ¯åï¼group1ä¸­æ²¡æå¶ä»æ¶è´¹èè¯»åè¿æ¶æ¯ï¼æä»¥ï¼consumer1å°±å¾å°mqstreamæ¶æ¯éåä¸­çæææ¶æ¯äºï¼ä¸å±4æ¡ï¼ï¼\n\nXREADGROUP group group1 consumer1 streams mqstream >\n1) 1) "mqstream"\n   2) 1) 1) "1599203861727-0"\n         2) 1) "repo"\n            2) "5"\n      2) 1) "1599274912765-0"\n         2) 1) "repo"\n            2) "3"\n      3) 1) "1599274925823-0"\n         2) 1) "repo"\n            2) "2"\n      4) 1) "1599274927910-0"\n         2) 1) "repo"\n            2) "1"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\néè¦æ³¨æçæ¯ï¼æ¶æ¯éåä¸­çæ¶æ¯ä¸æ¦è¢«æ¶è´¹ç»éçä¸ä¸ªæ¶è´¹èè¯»åäºï¼å°±ä¸è½åè¢«è¯¥æ¶è´¹ç»åçå¶ä»æ¶è´¹èè¯»åäºãæ¯å¦è¯´ï¼æä»¬æ§è¡å®åæçXREADGROUPå½ä»¤åï¼åæ§è¡ä¸é¢çå½ä»¤ï¼è®©group1åçconsumer2è¯»åæ¶æ¯æ¶ï¼consumer2è¯»å°çå°±æ¯ç©ºå¼ï¼å ä¸ºæ¶æ¯å·²ç»è¢«consumer1è¯»åå®äºï¼å¦ä¸æç¤ºï¼\n\nXREADGROUP group group1 consumer2  streams mqstream 0\n1) 1) "mqstream"\n   2) (empty list or set)\n\n\n1\n2\n3\n\n\nä½¿ç¨æ¶è´¹ç»çç®çæ¯è®©ç»åçå¤ä¸ªæ¶è´¹èå±ååæè¯»åæ¶æ¯ï¼æä»¥ï¼æä»¬éå¸¸ä¼è®©æ¯ä¸ªæ¶è´¹èè¯»åé¨åæ¶æ¯ï¼ä»èå®ç°æ¶æ¯è¯»åè´è½½å¨å¤ä¸ªæ¶è´¹èé´æ¯åè¡¡åå¸çãä¾å¦ï¼æä»¬æ§è¡ä¸åå½ä»¤ï¼è®© group2 ä¸­ç consumer1ã2ã3 åèªè¯»åä¸æ¡æ¶æ¯ã\n\nXREADGROUP group group2 consumer1 count 1 streams mqstream >\n1) 1) "mqstream"\n   2) 1) 1) "1599203861727-0"\n         2) 1) "repo"\n            2) "5"\n\nXREADGROUP group group2 consumer2 count 1 streams mqstream >\n1) 1) "mqstream"\n   2) 1) 1) "1599274912765-0"\n         2) 1) "repo"\n            2) "3"\n\nXREADGROUP group group2 consumer3 count 1 streams mqstream >\n1) 1) "mqstream"\n   2) 1) 1) "1599274925823-0"\n         2) 1) "repo"\n            2) "2"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# 4ï¼XPENDING å XACK\n\nä¸ºäºä¿è¯æ¶è´¹èå¨åçæéæå®æºåæ¬¡éå¯åï¼ä»ç¶å¯ä»¥è¯»åæªå¤çå®çæ¶æ¯ï¼Streams ä¼èªå¨ä½¿ç¨åé¨éåï¼ä¹ç§°ä¸º PENDING Listï¼çå­æ¶è´¹ç»éæ¯ä¸ªæ¶è´¹èè¯»åçæ¶æ¯ï¼ç´å°æ¶è´¹èä½¿ç¨ XACK å½ä»¤éç¥Streamsâæ¶æ¯å·²ç»å¤çå®æâãå¦ææ¶è´¹èæ²¡ææåå¤çæ¶æ¯ï¼å®å°±ä¸ä¼ç» Streams åé XACK å½ä»¤ï¼æ¶æ¯ä»ç¶ä¼çå­ãæ­¤æ¶ï¼æ¶è´¹èå¯ä»¥å¨éå¯åï¼ç¨ XPENDING å½ä»¤æ¥çå·²è¯»åãä½å°æªç¡®è®¤å¤çå®æçæ¶æ¯ã\n\nä¾å¦ï¼æä»¬æ¥æ¥çä¸ä¸group2ä¸­åä¸ªæ¶è´¹èå·²è¯»åãä½å°æªç¡®è®¤çæ¶æ¯ä¸ªæ°ãå¶ä¸­ï¼XPENDINGè¿åç»æçç¬¬äºãä¸è¡åå«è¡¨ç¤ºgroup2ä¸­æææ¶è´¹èè¯»åçæ¶æ¯æå°IDåæå¤§IDï¼\n\nXPENDING mqstream group2\n1) (integer) 3\n2) "1599203861727-0"\n3) "1599274925823-0"\n4) 1) 1) "consumer1"\n      2) "1"\n   2) 1) "consumer2"\n      2) "1"\n   3) 1) "consumer3"\n      2) "1"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå¦ææä»¬è¿éè¦è¿ä¸æ­¥æ¥çæä¸ªæ¶è´¹èå·ä½è¯»åäºåªäºæ°æ®ï¼å¯ä»¥æ§è¡ä¸é¢çå½ä»¤ï¼\n\nXPENDING mqstream group2 - + 10 consumer2\n1) 1) "1599274912765-0"\n   2) "consumer2"\n   3) (integer) 513336\n   4) (integer) 1\n\n\n1\n2\n3\n4\n5\n\n\nå¯ä»¥çå°ï¼consumer2 å·²è¯»åçæ¶æ¯ç ID æ¯ 1599274912765-0ã\n\nä¸æ¦æ¶æ¯ 1599274912765-0 è¢« consumer2 å¤çäºï¼consumer2 å°±å¯ä»¥ä½¿ç¨ XACK å½ä»¤éç¥ Streamsï¼ç¶åè¿æ¡æ¶æ¯å°±ä¼è¢«å é¤ãå½æä»¬åä½¿ç¨ XPENDING å½ä»¤æ¥çæ¶ï¼å°±å¯ä»¥çå°ï¼consumer2 å·²ç»æ²¡æå·²è¯»åãä½å°æªç¡®è®¤å¤ççæ¶æ¯äºã\n\n XACK mqstream group2 1599274912765-0\n(integer) 1\nXPENDING mqstream group2 - + 10 consumer2\n(empty list or set)\n\n\n1\n2\n3\n4\n\n\nç°å¨ï¼æä»¬å°±ç¥éäºç¨ Streams å®ç°æ¶æ¯éåçæ¹æ³ï¼æè¿æ³åå¼ºè°ä¸ï¼Streams æ¯ Redis 5.0 ä¸é¨éå¯¹æ¶æ¯éååºæ¯è®¾è®¡çæ°æ®ç±»åï¼å¦æä½ ç Redis æ¯5.0å5.0ä»¥åççæ¬ï¼å°±å¯ä»¥èèæ Streams ç¨ä½æ¶æ¯éåäºã\n\n\n# 1.4 å°ç»\n\næä»¬å­¦ä¹ äºåå¸å¼ç³»ç»ç»ä»¶ä½¿ç¨æ¶æ¯éåæ¶çä¸å¤§éæ±ï¼æ¶æ¯ä¿åºãéå¤æ¶æ¯å¤çåæ¶æ¯å¯é æ§ä¿è¯ï¼è¿ä¸å¤§éæ±å¯ä»¥è¿ä¸æ­¥è½¬æ¢ä¸ºå¯¹æ¶æ¯éåçä¸å¤§è¦æ±ï¼æ¶æ¯æ°æ®æåºå­åï¼æ¶æ¯æ°æ®å·æå¨å±å¯ä¸ç¼å·ï¼ä»¥åæ¶æ¯æ°æ®å¨æ¶è´¹å®æåè¢«å é¤ã\n\nä¸å¾æ±æ»äº List å Streams å®ç°æ¶æ¯éåçç¹ç¹ååºå«ï¼\n\n> å¶å®ï¼å³äºRedisæ¯å¦éååæ¶æ¯éåï¼ä¸çä¸ç´æ¯æäºè®ºçãå¾å¤äººè®¤ä¸ºï¼è¦ä½¿ç¨æ¶æ¯éåï¼å°±åºè¯¥éç¨ KafkaãRabbitMQ è¿äºä¸é¨é¢åæ¶æ¯éååºæ¯çè½¯ä»¶ï¼è Redis æ´å éååç¼å­ã\n> \n> æ ¹æ®è¿äºå¹´åRedisç åå·¥ä½çç»éªï¼æççæ³æ¯ï¼Redisæ¯ä¸ä¸ªéå¸¸è½»éçº§çé®å¼æ°æ®åºï¼é¨ç½²ä¸ä¸ªRediså®ä¾å°±æ¯å¯å¨ä¸ä¸ªè¿ç¨ï¼é¨ç½²Rediséç¾¤ï¼ä¹å°±æ¯é¨ç½²å¤ä¸ªRediså®ä¾ãèKafkaãRabbitMQé¨ç½²æ¶ï¼æ¶åé¢å¤çç»ä»¶ï¼ä¾å¦Kafkaçè¿è¡å°±éè¦åé¨ç½²ZooKeeperãç¸æ¯Redisæ¥è¯´ï¼KafkaåRabbitMQä¸è¬è¢«è®¤ä¸ºæ¯ééçº§çæ¶æ¯éåã\n> \n> æä»¥ï¼å³äºæ¯å¦ç¨Redisåæ¶æ¯éåçé®é¢ï¼ä¸è½ä¸æ¦èè®ºï¼æä»¬éè¦èèä¸å¡å±é¢çæ°æ®ä½éï¼ä»¥åå¯¹æ§è½ãå¯é æ§ãå¯æ©å±æ§çéæ±ãå¦æåå¸å¼ç³»ç»ä¸­çç»ä»¶æ¶æ¯éä¿¡éä¸å¤§ï¼é£ä¹ï¼Redisåªéè¦ä½¿ç¨æéçåå­ç©ºé´å°±è½æ»¡è¶³æ¶æ¯å­å¨çéæ±ï¼èä¸ï¼Redisçé«æ§è½ç¹æ§è½æ¯æå¿«éçæ¶æ¯è¯»åï¼ä¸å¤±ä¸ºæ¶æ¯éåçä¸ä¸ªå¥½çè§£å³æ¹æ¡ã\n\n----------------------------------------\n\næ¬èé®é¢ï¼å¦æä¸ä¸ªçäº§èåéç»æ¶æ¯éåçæ¶æ¯ï¼éè¦è¢«å¤ä¸ªæ¶è´¹èè¿è¡è¯»ååå¤çï¼ä¾å¦ï¼ä¸ä¸ªæ¶æ¯æ¯ä¸æ¡ä»ä¸å¡ç³»ç»ééçæ°æ®ï¼æ¢è¦è¢«æ¶è´¹è1è¯»åå¹¶è¿è¡å®æ¶è®¡ç®ï¼ä¹è¦è¢«æ¶è´¹è2è¯»åå¹¶çå­å°åå¸å¼æä»¶ç³»ç»HDFSä¸­ï¼ä»¥ä¾¿åç»­è¿è¡åå²æ¥è¯¢ï¼ï¼ä½ ä¼ä½¿ç¨Redisçä»ä¹æ°æ®ç±»åæ¥è§£å³è¿ä¸ªé®é¢å¢ï¼\n\nå¯ä»¥ä½¿ç¨Streamsæ°æ®ç±»åçæ¶è´¹ç»ï¼åæ¶æ¶è´¹çäº§èçæ°æ®ï¼è¿æ¯å¯ä»¥çãä½æ¯ï¼éè¦æ³¨æï¼å¦æåªæ¯ä½¿ç¨ä¸ä¸ªæ¶è´¹ç»çè¯ï¼æ¶è´¹ç»åçå¤ä¸ªæ¶è´¹èå¨æ¶è´¹æ¶æ¯æ¶æ¯äºæ¥çï¼æ¢å¥è¯è¯´ï¼å¨ä¸ä¸ªæ¶è´¹ç»åï¼ä¸ä¸ªæ¶æ¯åªè½è¢«ä¸ä¸ªæ¶è´¹èæ¶è´¹ãæä»¬å¸ææ¶æ¯æ¢è¦è¢«æ¶è´¹è1è¯»åï¼ä¹è¦è¢«æ¶è´¹è2è¯»åï¼æ¯ä¸ä¸ªå¤æ¶è´¹èçéæ±ãæä»¥ï¼å¦æä½¿ç¨æ¶è´¹ç»æ¨¡å¼ï¼éè¦è®©æ¶è´¹è1åæ¶è´¹è2å±äºä¸åçæ¶è´¹ç»ï¼è¿æ ·å®ä»¬å°±è½åæ¶æ¶è´¹äºã\n\nå¦å¤ï¼Redisåºäºå­å¸åé¾è¡¨æ°æ®ç»æï¼å®ç°äºåå¸åè®¢éåè½ï¼è¿ä¸ªåè½å¯ä»¥å®ç°ä¸ä¸ªæ¶æ¯è¢«å¤ä¸ªæ¶è´¹èæ¶è´¹ä½¿ç¨ï¼å¯ä»¥æ»¡è¶³é®é¢ä¸­çåºæ¯éæ±ã',normalizedContent:'> åèï¼\n> \n>  * 15 æ¶æ¯éåçèéªï¼redis æåªäºè§£å³æ¹æ¡ï¼| æå®¢æ¶é´\n\n\n# 1. æ¶æ¯éåçèéªï¼redisæåªäºè§£å³æ¹æ¡ï¼\n\næ¶æ¯éåæ¯åå¸å¼ç³»ç»çåºç¡è½¯ä»¶ï¼è¦è½æ¯æç»ä»¶éä¿¡æ¶æ¯çå¿«éè¯»åãredis æ¬èº«æ¯ææ°æ®çé«éè®¿é®ï¼å æ­¤å¾å¤äººå³å¿ä¸ä¸ªé®é¢ï¼redis éåå mq åï¼\n\nè¿ä¸ªé®é¢çèåï¼éå«çä¸¤æ¹é¢çæ ¸å¿é®é¢ï¼\n\n * æ¶æ¯éåçæ¶æ¯å­åéæ±æ¯ä»ä¹ï¼\n * redis å¦ä½å®ç°æ¶æ¯éåçéæ±ï¼\n\nçè§£äº mq çç¹å¾å redis æä¾ç mq æ¹æ¡ï¼æè½æ ¹æ®å®ééæ±æ¥éæ©åºéåç redis æ¶æ¯éåæ¹æ¡ã\n\n\n# 1.1 mq çæ¶æ¯å­åéæ±\n\nåä»ç»ä¸ä¸æ¶æ¯éåå­åæ¶æ¯çè¿ç¨ãå¨åå¸å¼ç³»ç»ä¸­ï¼å½ä¸¤ä¸ªç»ä»¶è¦åºäºæ¶æ¯éåè¿è¡éä¿¡æ¶ï¼ä¸ä¸ªç»ä»¶ä¼æè¦å¤ççæ°æ®ä»¥æ¶æ¯çå½¢å¼ä¼ éç»æ¶æ¯éåï¼ç¶åï¼è¿ä¸ªç»ä»¶å°±å¯ä»¥ç»§ç»­æ§è¡å¶ä»æä½äºï¼è¿ç«¯çå¦ä¸ä¸ªç»ä»¶ä»æ¶æ¯éåä¸­ææ¶æ¯è¯»ååºæ¥ï¼åå¨æ¬å°è¿è¡å¤çã\n\nä¸ä¸ªéç¨ç mq çæ¶ææ¨¡åä¸ºï¼\n\næ¶æ¯éåä¸­åéæ¶æ¯çç»ä»¶ç§°ä¸ºçäº§èï¼æ¥æ¶æ¶æ¯çç»ä»¶ç§°ä¸ºæ¶è´¹èã\n\nå¨ä½¿ç¨æ¶æ¯éåæ¶ï¼æ¶è´¹èå¯ä»¥å¼æ­¥è¯»åçäº§èæ¶æ¯ï¼ç¶ååè¿è¡å¤çãè¿æ ·ä¸æ¥ï¼å³ä½¿çäº§èåéæ¶æ¯çéåº¦è¿è¿è¶è¿äºæ¶è´¹èå¤çæ¶æ¯çéåº¦ï¼çäº§èå·²ç»åéçæ¶æ¯ä¹å¯ä»¥ç¼å­å¨æ¶æ¯éåä¸­ï¼é¿åé»å¡çäº§èï¼è¿æ¯æ¶æ¯éåä½ä¸ºåå¸å¼ç»ä»¶éä¿¡çä¸å¤§ä¼å¿ã\n\nmq å¨å­åæ¶æ¯æ¶ï¼å¿é¡»è¦æ»¡è¶³ä¸ä¸ªéæ±ï¼\n\n 1. æ¶æ¯ä¿åº\n 2. å¤çéå¤çæ¶æ¯ï¼å¹ç­è¦æ±ï¼\n 3. ä¿è¯æ¶æ¯å¯é æ§\n\n# éæ±ä¸ï¼æ¶æ¯ä¿åº\n\nè½ç¶æ¶è´¹èæ¯å¼æ­¥å¤çæ¶æ¯ï¼ä½æ¯ï¼æ¶è´¹èä»ç¶éè¦æç§çäº§èåéæ¶æ¯çé¡ºåºæ¥å¤çæ¶æ¯ï¼é¿åååéçæ¶æ¯è¢«åå¤çäºãå¯¹äºè¦æ±æ¶æ¯ä¿åºçåºæ¯æ¥è¯´ï¼ä¸æ¦åºç°è¿ç§æ¶æ¯è¢«ä¹±åºå¤ççæåµï¼å°±å¯è½ä¼å¯¼è´ä¸å¡é»è¾è¢«éè¯¯æ§è¡ï¼ä»èç»ä¸å¡æ¹é ææå¤±ã\n\næä»¬æ¥çä¸ä¸ªæ´æ°åååºå­çåºæ¯ï¼åè®¾çäº§èè´è´£æ¥æ¶åºå­æ´æ°è¯·æ±ï¼æ¶è´¹èè´è´£å®éæ´æ°åºå­ï¼ç°æåºå­éæ¯10ãçäº§èåååéäºæ¶æ¯1åæ¶æ¯2ï¼æ¶æ¯1è¦æååxçåºå­è®°å½æ´æ°ä¸º5ï¼æ¶æ¯2æ¯æååxåºå­æ´æ°ä¸º3ãå¦ææ¶æ¯1å2å¨æ¶æ¯éåä¸­æ æ³ä¿åºï¼åºç°æ¶æ¯2æ©äºæ¶æ¯1è¢«å¤ççæåµï¼é£ä¹ï¼å¾æ¾ç¶ï¼åºå­æ´æ°å°±åºéäºãè¿æ¯ä¸å¡åºç¨æ æ³æ¥åçã\n\n# éæ±äºï¼éå¤æ¶æ¯å¤çï¼å¹ç­è¦æ±ï¼\n\næ¶è´¹èä»æ¶æ¯éåè¯»åæ¶æ¯æ¶ï¼ææ¶ä¼å ä¸ºç½ç»å µå¡èåºç°æ¶æ¯éä¼ çæåµãå¯¹äºéå¤çæ¶æ¯ï¼æ¶è´¹èå¦æå¤æ¬¡å¤ççè¯ï¼å°±å¯è½é æä¸ä¸ªä¸å¡é»è¾è¢«å¤æ¬¡æ§è¡ï¼å¦æä¸å¡é»è¾æ­£å¥½æ¯è¦ä¿®æ¹æ°æ®ï¼é£å°±ä¼åºç°æ°æ®è¢«å¤æ¬¡ä¿®æ¹çé®é¢äºã\n\næ¯å¦å¯è½åºç°éå¤æ£æ¬¾çé®é¢ã\n\n# éæ±ä¸ï¼æ¶æ¯å¯é æ§ä¿è¯\n\næ¶è´¹èå¨å¤çæ¶æ¯çæ¶åï¼è¿å¯è½åºç°å ä¸ºæéæå®æºå¯¼è´æ¶æ¯æ²¡æå¤çå®æçæåµãæ­¤æ¶ï¼æ¶æ¯éåéè¦è½æä¾æ¶æ¯å¯é æ§çä¿è¯ï¼ä¹å°±æ¯è¯´ï¼å½æ¶è´¹èéå¯åï¼å¯ä»¥éæ°è¯»åæ¶æ¯åæ¬¡è¿è¡å¤çï¼å¦åï¼å°±ä¼åºç°æ¶æ¯æ¼å¤ççé®é¢äºã\n\nredis ç list å streams ä¸¤ç§æ°æ®ç±»åï¼å°±å¯ä»¥æ»¡è¶³æ¶æ¯éåçè¿ä¸ä¸ªéæ±ãä¸é¢æ¥çè¿ä¸¤ç§æ¹æ¡ã\n\n\n# 1.2 åºäº list ç mq è§£å³æ¹æ¡\n\n# 1.2.1 è§£å³æ¶æ¯ä¿åºé®é¢\n\nlist æ¬èº«å°±æ¯æåè¿ååºçé¡ºåºå¯¹æ°æ®è¿è¡å­åçï¼æä»¥å¦æä½¿ç¨ list ä½ä¸ºæ¶æ¯éåä¿å­æ¶æ¯çè¯ï¼å°±å·²ç»è½æ»¡è¶³æ¶æ¯ä¿åºçéæ±äºï¼\n\n * çäº§èä½¿ç¨ lpush å½ä»¤ææ¶æ¯åå¥ list\n * æ¶è´¹èä½¿ç¨ rpop å½ä»¤è¯»åæ¶æ¯\n\nä¸è¿è¿æ ·çè¯ list ä¸ä¼ä¸»å¨åç¥æ¶è´¹èææ°æ¶æ¯çåå¥ï¼è¿æ ·å°±éè¦æ¶è´¹èä¸ç´è°ç¨ rpop æ¥çå¬æ¶æ¯ï¼æ¯å¦ä½¿ç¨ä¸ä¸ªwhile(1)å¾ªç¯ï¼ï¼è¿ä¼å¸¦æ¥ä¸å¿è¦çæ§è½æå¤±ã\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼redis æä¾äº brpop å½ä»¤ï¼é»å¡å¼è¯»åï¼å®¢æ·ç«¯å¨æ²¡æè¯»å°éåæ°æ®æ¶ï¼èªå¨é»å¡ï¼ç´å°ææ°çæ°æ®åå¥éåï¼åå¼å§è¯»åæ°æ°æ®ãè¿ç§æ¹å¼ç¸æ¯æ¶è´¹èä¸åè°ç¨ rpop èè¨ï¼æ´å èç cpu å¼éã\n\n# 1.2.2 å¹ç­æ§è¦æ±ï¼å¤çéå¤æ¶æ¯ï¼\n\nè§£å³æ¶æ¯éå¤é®é¢ï¼å¶å®æä¸ä¸ªè¦æ±ï¼æ¶è´¹èç¨åºæ¬èº«è½å¯¹éå¤æ¶æ¯è¿è¡å¤æ­ï¼\n\n * ä¸æ¹é¢ï¼æ¶æ¯éåè¦è½ç»æ¯ä¸ä¸ªæ¶æ¯æä¾å¨å±å¯ä¸ç id å·ï¼\n * å¦ä¸æ¹é¢ï¼æ¶è´¹èç¨åºè¦æå·²ç»å¤çè¿çæ¶æ¯ç id å·è®°å½ä¸æ¥ã\n\nå¹ç­æ§å°±æ¯æï¼å¯¹äºåä¸æ¡æ¶æ¯ï¼æ¶è´¹èæ¶å°ä¸æ¬¡çå¤çç»æåæ¶å°å¤æ¬¡çå¤çç»ææ¯ä¸è´çã\n\nå ä¸º list æ¬èº«ä¸ä¼ä¸ºæ¶æ¯çæ id å·ï¼å æ­¤éè¦çäº§èå¨åéæ¶æ¯æ¶éå¸¦ä¸å¨å±å¯ä¸ idãä¾å¦ï¼æä»¬æ§è¡ä»¥ä¸å½ä»¤ï¼å°±æä¸æ¡å¨å± id ä¸º 101030001ãåºå­éä¸º 5 çæ¶æ¯æå¥äºæ¶æ¯éåï¼\n\nlpush mq "101030001:stock:5"\n(integer) 1\n\n\n1\n2\n\n\n# 1.2.3 æ¶æ¯å¯é æ§ä¿è¯\n\nå½æ¶è´¹èç¨åºä» list ä¸­è¯»åä¸æ¡æ¶æ¯åï¼list å°±ä¸ä¼åçå­è¿æ¡æ¶æ¯äºãæä»¥ï¼å¦ææ¶è´¹èç¨åºå¨å¤çæ¶æ¯çè¿ç¨åºç°äºæéæå®æºï¼å°±ä¼å¯¼è´æ¶æ¯æ²¡æå¤çå®æï¼é£ä¹ï¼æ¶è´¹èç¨åºåæ¬¡å¯å¨åï¼å°±æ²¡æ³åæ¬¡ä» list ä¸­è¯»åæ¶æ¯äºã\n\nä¸ºäºçå­æ¶æ¯ï¼list ç±»åæä¾äº brpoplpush å½ä»¤ï¼è¿ä¸ªå½ä»¤çä½ç¨æ¯è®©æ¶è´¹èç¨åºä»ä¸ä¸ª list ä¸­è¯»åæ¶æ¯ï¼åæ¶ï¼redis ä¼æè¿ä¸ªæ¶æ¯åæå¥å°å¦ä¸ä¸ª listï¼å¯ä»¥å«ä½å¤ä»½listï¼çå­ãè¿æ ·ä¸æ¥ï¼å¦ææ¶è´¹èç¨åºè¯»äºæ¶æ¯ä½æ²¡è½æ­£å¸¸å¤çï¼ç­å®éå¯åï¼å°±å¯ä»¥ä»å¤ä»½ list ä¸­éæ°è¯»åæ¶æ¯å¹¶è¿è¡å¤çäºãä¸å¾æ¯ä½¿ç¨ brpoplpush å½ä»¤çå­æ¶æ¯ï¼ä»¥åæ¶è´¹èåæ¬¡è¯»åæ¶æ¯çè¿ç¨ï¼\n\nå¥½äºï¼å°è¿éä½ å¯ä»¥çå°ï¼åºäº list ç±»åï¼æä»¬å¯ä»¥æ»¡è¶³åå¸å¼ç»ä»¶å¯¹æ¶æ¯éåçä¸å¤§éæ±ãä½æ¯ï¼å¨ç¨ list åæ¶æ¯éåæ¶ï¼æä»¬è¿å¯è½éå°è¿ä¸ä¸ªé®é¢ï¼çäº§èæ¶æ¯åéå¾å¿«ï¼èæ¶è´¹èå¤çæ¶æ¯çéåº¦æ¯è¾æ¢ï¼è¿å°±å¯¼è´ list ä¸­çæ¶æ¯è¶ç§¯è¶å¤ï¼ç» redis çåå­å¸¦æ¥å¾å¤§ååãè¿ä¸ªæ¶åï¼æä»¬å¸æå¯å¨å¤ä¸ªæ¶è´¹èç¨åºç»æä¸ä¸ªæ¶è´¹ç»ï¼ä¸èµ·åæå¤ç list ä¸­çæ¶æ¯ãä½æ¯ï¼list ç±»åå¹¶ä¸æ¯ææ¶è´¹ç»çå®ç°ãé£ä¹ï¼è¿ææ²¡ææ´åéçè§£å³æ¹æ¡å¢ï¼è¿å°±è¦è¯´å° redis ä» 5.0 çæ¬å¼å§æä¾ç streams æ°æ®ç±»åäºã\n\nå list ç¸æ¯ï¼streams åæ ·è½å¤æ»¡è¶³æ¶æ¯éåçä¸å¤§éæ±ãèä¸ï¼å®è¿æ¯ææ¶è´¹ç»å½¢å¼çæ¶æ¯è¯»åãæ¥ä¸æ¥ï¼æä»¬å°±æ¥äºè§£ä¸ streams çä½¿ç¨æ¹æ³ã\n\n\n# 1.3 åºäº streams çæ¶æ¯éåè§£å³æ¹æ¡\n\nstreams æ¯ redis ä¸é¨ä¸ºæ¶æ¯éåè®¾è®¡çæ°æ®ç±»åï¼å®æä¾äºä¸°å¯çæ¶æ¯éåæä½å½ä»¤ï¼\n\n * xaddï¼æå¥æ¶æ¯ï¼ä¿è¯æåºï¼å¯ä»¥èªå¨çæå¨å±å¯ä¸ idï¼\n * xreadï¼ç¨äºè¯»åæ¶æ¯ï¼å¯ä»¥æ id è¯»åæ°æ®ï¼\n * xreadgroupï¼ææ¶è´¹ç»å½¢å¼è¯»åæ¶æ¯ï¼\n * xpending å xackï¼xpending å½ä»¤å¯ä»¥ç¨æ¥æ¥è¯¢æ¯ä¸ªæ¶è´¹ç»åæææ¶è´¹èå·²è¯»åä½å°æªç¡®è®¤çæ¶æ¯ï¼è xack å½ä»¤ç¨äºåæ¶æ¯éåç¡®è®¤æ¶æ¯å¤çå·²å®æã\n\n# 1ï¼xadd å½ä»¤\n\nxadd å½ä»¤å¯ä»¥å¾æ¶æ¯éåä¸­æå¥æ°æ¶æ¯ï¼æ¶æ¯çæ ¼å¼æ¯é®-å¼å¯¹å½¢å¼ãå¯¹äºæå¥çæ¯ä¸æ¡æ¶æ¯ï¼streams å¯ä»¥èªå¨ä¸ºå¶çæä¸ä¸ªå¨å±å¯ä¸ç idã\n\næ¯å¦è¯´ï¼æä»¬æ§è¡ä¸é¢çå½ä»¤ï¼å°±å¯ä»¥å¾åç§°ä¸º mqstream çæ¶æ¯éåä¸­æå¥ä¸æ¡æ¶æ¯ï¼æ¶æ¯çé®æ¯repoï¼å¼æ¯5ãå¶ä¸­ï¼æ¶æ¯éååç§°åé¢ç *ï¼è¡¨ç¤ºè®©redisä¸ºæå¥çæ°æ®èªå¨çæä¸ä¸ªå¨å±å¯ä¸çidï¼ä¾å¦â1599203861727-0âãå½ç¶ï¼æä»¬ä¹å¯ä»¥ä¸ç¨ *ï¼ç´æ¥å¨æ¶æ¯éååç§°åèªè¡è®¾å®ä¸ä¸ªidå·ï¼åªè¦ä¿è¯è¿ä¸ªidå·æ¯å¨å±å¯ä¸çå°±è¡ãä¸è¿ï¼ç¸æ¯èªè¡è®¾å®idå·ï¼ä½¿ç¨ * ä¼æ´å æ¹ä¾¿é«æã\n\nxadd mqstream * repo 5\n"1599203861727-0"\n\n\n1\n2\n\n\nå¯ä»¥çå°ï¼æ¶æ¯çå¨å±å¯ä¸idç±ä¸¤é¨åç»æï¼ç¬¬ä¸é¨åâ1599203861727âæ¯æ°æ®æå¥æ¶ï¼ä»¥æ¯«ç§ä¸ºåä½è®¡ç®çå½åæå¡å¨æ¶é´ï¼ç¬¬äºé¨åè¡¨ç¤ºæå¥æ¶æ¯å¨å½åæ¯«ç§åçæ¶æ¯åºå·ï¼è¿æ¯ä»0å¼å§ç¼å·çãä¾å¦ï¼â1599203861727-0âå°±è¡¨ç¤ºå¨â1599203861727âæ¯«ç§åçç¬¬1æ¡æ¶æ¯ã\n\n# 2ï¼xread å½ä»¤\n\nå½æ¶è´¹èéè¦è¯»åæ¶æ¯æ¶ï¼å¯ä»¥ç´æ¥ä½¿ç¨xreadå½ä»¤ä»æ¶æ¯éåä¸­è¯»åãxread å¨è¯»åæ¶æ¯æ¶ï¼å¯ä»¥æå®ä¸ä¸ªæ¶æ¯ idï¼å¹¶ä»è¿ä¸ªæ¶æ¯ id çä¸ä¸æ¡æ¶æ¯å¼å§è¿è¡è¯»åã\n\nä¾å¦ï¼æä»¬å¯ä»¥æ§è¡ä¸é¢çå½ä»¤ï¼ä» id å·ä¸º 1599203861727-0 çæ¶æ¯å¼å§ï¼è¯»ååç»­çæææ¶æ¯ï¼ç¤ºä¾ä¸­ä¸å± 3 æ¡ï¼ï¼\n\nxread block 100 streams  mqstream 1599203861727-0\n1) 1) "mqstream"\n   2) 1) 1) "1599274912765-0"\n         2) 1) "repo"\n            2) "3"\n      2) 1) "1599274925823-0"\n         2) 1) "repo"\n            2) "2"\n      3) 1) "1599274927910-0"\n         2) 1) "repo"\n            2) "1"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¦å¤ï¼æ¶è´¹èä¹å¯ä»¥å¨è°ç¨ xraed æ¶è®¾å® block éç½®é¡¹ï¼å®ç°ç±»ä¼¼äº brpop çé»å¡è¯»åæä½ãå½æ¶æ¯éåä¸­æ²¡ææ¶æ¯æ¶ï¼ä¸æ¦è®¾ç½®äº block éç½®é¡¹ï¼xread å°±ä¼é»å¡ï¼é»å¡çæ¶é¿å¯ä»¥å¨ block éç½®é¡¹è¿è¡è®¾ç½®ã\n\nä¸¾ä¸ªä¾å­ï¼æä»¬æ¥çä¸ä¸ä¸é¢çå½ä»¤ï¼å¶ä¸­ï¼å½ä»¤æåçâ$âç¬¦å·è¡¨ç¤ºè¯»åææ°çæ¶æ¯ï¼åæ¶ï¼æä»¬è®¾ç½®äºblock 10000çéç½®é¡¹ï¼10000çåä½æ¯æ¯«ç§ï¼è¡¨æxreadå¨è¯»åææ°æ¶æ¯æ¶ï¼å¦ææ²¡ææ¶æ¯å°æ¥ï¼xreadå°é»å¡10000æ¯«ç§ï¼å³10ç§ï¼ï¼ç¶ååè¿åãä¸é¢å½ä»¤ä¸­çxreadæ§è¡åï¼æ¶æ¯éåmqstreamä¸­ä¸ç´æ²¡ææ¶æ¯ï¼æä»¥ï¼xreadå¨10ç§åè¿åç©ºå¼ï¼nilï¼ï¼\n\nxread block 10000 streams mqstream $\n(nil)\n(10.00s)\n\n\n1\n2\n3\n\n\nååè®²å°çè¿äºæä½æ¯ list ä¹æ¯æçï¼æ¥ä¸æ¥ï¼æä»¬åæ¥å­¦ä¹ ä¸ streams ç¹æçåè½ã\n\n# 3ï¼xgroup ä¸ xreadgroup\n\nstreams æ¬èº«å¯ä»¥ä½¿ç¨ xgroup åå»ºæ¶è´¹ç»ï¼åå»ºæ¶è´¹ç»ä¹åï¼streams å¯ä»¥ä½¿ç¨ xreadgroup å½ä»¤è®©æ¶è´¹ç»åçæ¶è´¹èè¯»åæ¶æ¯ã\n\nä¾å¦ï¼æä»¬æ§è¡ä¸é¢çå½ä»¤ï¼åå»ºä¸ä¸ªåä¸º group1 çæ¶è´¹ç»ï¼è¿ä¸ªæ¶è´¹ç»æ¶è´¹çæ¶æ¯éåæ¯ mqstreamï¼\n\nxgroup create mqstream group1 0\nok\n\n\n1\n2\n\n\nç¶åï¼æä»¬åæ§è¡ä¸æ®µå½ä»¤ï¼è®©group1æ¶è´¹ç»éçæ¶è´¹èconsumer1ä»mqstreamä¸­è¯»åæææ¶æ¯ï¼å¶ä¸­ï¼å½ä»¤æåçåæ°â>âï¼è¡¨ç¤ºä»ç¬¬ä¸æ¡å°æªè¢«æ¶è´¹çæ¶æ¯å¼å§è¯»åãå ä¸ºå¨consumer1è¯»åæ¶æ¯åï¼group1ä¸­æ²¡æå¶ä»æ¶è´¹èè¯»åè¿æ¶æ¯ï¼æä»¥ï¼consumer1å°±å¾å°mqstreamæ¶æ¯éåä¸­çæææ¶æ¯äºï¼ä¸å±4æ¡ï¼ï¼\n\nxreadgroup group group1 consumer1 streams mqstream >\n1) 1) "mqstream"\n   2) 1) 1) "1599203861727-0"\n         2) 1) "repo"\n            2) "5"\n      2) 1) "1599274912765-0"\n         2) 1) "repo"\n            2) "3"\n      3) 1) "1599274925823-0"\n         2) 1) "repo"\n            2) "2"\n      4) 1) "1599274927910-0"\n         2) 1) "repo"\n            2) "1"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\néè¦æ³¨æçæ¯ï¼æ¶æ¯éåä¸­çæ¶æ¯ä¸æ¦è¢«æ¶è´¹ç»éçä¸ä¸ªæ¶è´¹èè¯»åäºï¼å°±ä¸è½åè¢«è¯¥æ¶è´¹ç»åçå¶ä»æ¶è´¹èè¯»åäºãæ¯å¦è¯´ï¼æä»¬æ§è¡å®åæçxreadgroupå½ä»¤åï¼åæ§è¡ä¸é¢çå½ä»¤ï¼è®©group1åçconsumer2è¯»åæ¶æ¯æ¶ï¼consumer2è¯»å°çå°±æ¯ç©ºå¼ï¼å ä¸ºæ¶æ¯å·²ç»è¢«consumer1è¯»åå®äºï¼å¦ä¸æç¤ºï¼\n\nxreadgroup group group1 consumer2  streams mqstream 0\n1) 1) "mqstream"\n   2) (empty list or set)\n\n\n1\n2\n3\n\n\nä½¿ç¨æ¶è´¹ç»çç®çæ¯è®©ç»åçå¤ä¸ªæ¶è´¹èå±ååæè¯»åæ¶æ¯ï¼æä»¥ï¼æä»¬éå¸¸ä¼è®©æ¯ä¸ªæ¶è´¹èè¯»åé¨åæ¶æ¯ï¼ä»èå®ç°æ¶æ¯è¯»åè´è½½å¨å¤ä¸ªæ¶è´¹èé´æ¯åè¡¡åå¸çãä¾å¦ï¼æä»¬æ§è¡ä¸åå½ä»¤ï¼è®© group2 ä¸­ç consumer1ã2ã3 åèªè¯»åä¸æ¡æ¶æ¯ã\n\nxreadgroup group group2 consumer1 count 1 streams mqstream >\n1) 1) "mqstream"\n   2) 1) 1) "1599203861727-0"\n         2) 1) "repo"\n            2) "5"\n\nxreadgroup group group2 consumer2 count 1 streams mqstream >\n1) 1) "mqstream"\n   2) 1) 1) "1599274912765-0"\n         2) 1) "repo"\n            2) "3"\n\nxreadgroup group group2 consumer3 count 1 streams mqstream >\n1) 1) "mqstream"\n   2) 1) 1) "1599274925823-0"\n         2) 1) "repo"\n            2) "2"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# 4ï¼xpending å xack\n\nä¸ºäºä¿è¯æ¶è´¹èå¨åçæéæå®æºåæ¬¡éå¯åï¼ä»ç¶å¯ä»¥è¯»åæªå¤çå®çæ¶æ¯ï¼streams ä¼èªå¨ä½¿ç¨åé¨éåï¼ä¹ç§°ä¸º pending listï¼çå­æ¶è´¹ç»éæ¯ä¸ªæ¶è´¹èè¯»åçæ¶æ¯ï¼ç´å°æ¶è´¹èä½¿ç¨ xack å½ä»¤éç¥streamsâæ¶æ¯å·²ç»å¤çå®æâãå¦ææ¶è´¹èæ²¡ææåå¤çæ¶æ¯ï¼å®å°±ä¸ä¼ç» streams åé xack å½ä»¤ï¼æ¶æ¯ä»ç¶ä¼çå­ãæ­¤æ¶ï¼æ¶è´¹èå¯ä»¥å¨éå¯åï¼ç¨ xpending å½ä»¤æ¥çå·²è¯»åãä½å°æªç¡®è®¤å¤çå®æçæ¶æ¯ã\n\nä¾å¦ï¼æä»¬æ¥æ¥çä¸ä¸group2ä¸­åä¸ªæ¶è´¹èå·²è¯»åãä½å°æªç¡®è®¤çæ¶æ¯ä¸ªæ°ãå¶ä¸­ï¼xpendingè¿åç»æçç¬¬äºãä¸è¡åå«è¡¨ç¤ºgroup2ä¸­æææ¶è´¹èè¯»åçæ¶æ¯æå°idåæå¤§idï¼\n\nxpending mqstream group2\n1) (integer) 3\n2) "1599203861727-0"\n3) "1599274925823-0"\n4) 1) 1) "consumer1"\n      2) "1"\n   2) 1) "consumer2"\n      2) "1"\n   3) 1) "consumer3"\n      2) "1"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå¦ææä»¬è¿éè¦è¿ä¸æ­¥æ¥çæä¸ªæ¶è´¹èå·ä½è¯»åäºåªäºæ°æ®ï¼å¯ä»¥æ§è¡ä¸é¢çå½ä»¤ï¼\n\nxpending mqstream group2 - + 10 consumer2\n1) 1) "1599274912765-0"\n   2) "consumer2"\n   3) (integer) 513336\n   4) (integer) 1\n\n\n1\n2\n3\n4\n5\n\n\nå¯ä»¥çå°ï¼consumer2 å·²è¯»åçæ¶æ¯ç id æ¯ 1599274912765-0ã\n\nä¸æ¦æ¶æ¯ 1599274912765-0 è¢« consumer2 å¤çäºï¼consumer2 å°±å¯ä»¥ä½¿ç¨ xack å½ä»¤éç¥ streamsï¼ç¶åè¿æ¡æ¶æ¯å°±ä¼è¢«å é¤ãå½æä»¬åä½¿ç¨ xpending å½ä»¤æ¥çæ¶ï¼å°±å¯ä»¥çå°ï¼consumer2 å·²ç»æ²¡æå·²è¯»åãä½å°æªç¡®è®¤å¤ççæ¶æ¯äºã\n\n xack mqstream group2 1599274912765-0\n(integer) 1\nxpending mqstream group2 - + 10 consumer2\n(empty list or set)\n\n\n1\n2\n3\n4\n\n\nç°å¨ï¼æä»¬å°±ç¥éäºç¨ streams å®ç°æ¶æ¯éåçæ¹æ³ï¼æè¿æ³åå¼ºè°ä¸ï¼streams æ¯ redis 5.0 ä¸é¨éå¯¹æ¶æ¯éååºæ¯è®¾è®¡çæ°æ®ç±»åï¼å¦æä½ ç redis æ¯5.0å5.0ä»¥åççæ¬ï¼å°±å¯ä»¥èèæ streams ç¨ä½æ¶æ¯éåäºã\n\n\n# 1.4 å°ç»\n\næä»¬å­¦ä¹ äºåå¸å¼ç³»ç»ç»ä»¶ä½¿ç¨æ¶æ¯éåæ¶çä¸å¤§éæ±ï¼æ¶æ¯ä¿åºãéå¤æ¶æ¯å¤çåæ¶æ¯å¯é æ§ä¿è¯ï¼è¿ä¸å¤§éæ±å¯ä»¥è¿ä¸æ­¥è½¬æ¢ä¸ºå¯¹æ¶æ¯éåçä¸å¤§è¦æ±ï¼æ¶æ¯æ°æ®æåºå­åï¼æ¶æ¯æ°æ®å·æå¨å±å¯ä¸ç¼å·ï¼ä»¥åæ¶æ¯æ°æ®å¨æ¶è´¹å®æåè¢«å é¤ã\n\nä¸å¾æ±æ»äº list å streams å®ç°æ¶æ¯éåçç¹ç¹ååºå«ï¼\n\n> å¶å®ï¼å³äºredisæ¯å¦éååæ¶æ¯éåï¼ä¸çä¸ç´æ¯æäºè®ºçãå¾å¤äººè®¤ä¸ºï¼è¦ä½¿ç¨æ¶æ¯éåï¼å°±åºè¯¥éç¨ kafkaãrabbitmq è¿äºä¸é¨é¢åæ¶æ¯éååºæ¯çè½¯ä»¶ï¼è redis æ´å éååç¼å­ã\n> \n> æ ¹æ®è¿äºå¹´åredisç åå·¥ä½çç»éªï¼æççæ³æ¯ï¼redisæ¯ä¸ä¸ªéå¸¸è½»éçº§çé®å¼æ°æ®åºï¼é¨ç½²ä¸ä¸ªrediså®ä¾å°±æ¯å¯å¨ä¸ä¸ªè¿ç¨ï¼é¨ç½²rediséç¾¤ï¼ä¹å°±æ¯é¨ç½²å¤ä¸ªrediså®ä¾ãèkafkaãrabbitmqé¨ç½²æ¶ï¼æ¶åé¢å¤çç»ä»¶ï¼ä¾å¦kafkaçè¿è¡å°±éè¦åé¨ç½²zookeeperãç¸æ¯redisæ¥è¯´ï¼kafkaårabbitmqä¸è¬è¢«è®¤ä¸ºæ¯ééçº§çæ¶æ¯éåã\n> \n> æä»¥ï¼å³äºæ¯å¦ç¨redisåæ¶æ¯éåçé®é¢ï¼ä¸è½ä¸æ¦èè®ºï¼æä»¬éè¦èèä¸å¡å±é¢çæ°æ®ä½éï¼ä»¥åå¯¹æ§è½ãå¯é æ§ãå¯æ©å±æ§çéæ±ãå¦æåå¸å¼ç³»ç»ä¸­çç»ä»¶æ¶æ¯éä¿¡éä¸å¤§ï¼é£ä¹ï¼redisåªéè¦ä½¿ç¨æéçåå­ç©ºé´å°±è½æ»¡è¶³æ¶æ¯å­å¨çéæ±ï¼èä¸ï¼redisçé«æ§è½ç¹æ§è½æ¯æå¿«éçæ¶æ¯è¯»åï¼ä¸å¤±ä¸ºæ¶æ¯éåçä¸ä¸ªå¥½çè§£å³æ¹æ¡ã\n\n----------------------------------------\n\næ¬èé®é¢ï¼å¦æä¸ä¸ªçäº§èåéç»æ¶æ¯éåçæ¶æ¯ï¼éè¦è¢«å¤ä¸ªæ¶è´¹èè¿è¡è¯»ååå¤çï¼ä¾å¦ï¼ä¸ä¸ªæ¶æ¯æ¯ä¸æ¡ä»ä¸å¡ç³»ç»ééçæ°æ®ï¼æ¢è¦è¢«æ¶è´¹è1è¯»åå¹¶è¿è¡å®æ¶è®¡ç®ï¼ä¹è¦è¢«æ¶è´¹è2è¯»åå¹¶çå­å°åå¸å¼æä»¶ç³»ç»hdfsä¸­ï¼ä»¥ä¾¿åç»­è¿è¡åå²æ¥è¯¢ï¼ï¼ä½ ä¼ä½¿ç¨redisçä»ä¹æ°æ®ç±»åæ¥è§£å³è¿ä¸ªé®é¢å¢ï¼\n\nå¯ä»¥ä½¿ç¨streamsæ°æ®ç±»åçæ¶è´¹ç»ï¼åæ¶æ¶è´¹çäº§èçæ°æ®ï¼è¿æ¯å¯ä»¥çãä½æ¯ï¼éè¦æ³¨æï¼å¦æåªæ¯ä½¿ç¨ä¸ä¸ªæ¶è´¹ç»çè¯ï¼æ¶è´¹ç»åçå¤ä¸ªæ¶è´¹èå¨æ¶è´¹æ¶æ¯æ¶æ¯äºæ¥çï¼æ¢å¥è¯è¯´ï¼å¨ä¸ä¸ªæ¶è´¹ç»åï¼ä¸ä¸ªæ¶æ¯åªè½è¢«ä¸ä¸ªæ¶è´¹èæ¶è´¹ãæä»¬å¸ææ¶æ¯æ¢è¦è¢«æ¶è´¹è1è¯»åï¼ä¹è¦è¢«æ¶è´¹è2è¯»åï¼æ¯ä¸ä¸ªå¤æ¶è´¹èçéæ±ãæä»¥ï¼å¦æä½¿ç¨æ¶è´¹ç»æ¨¡å¼ï¼éè¦è®©æ¶è´¹è1åæ¶è´¹è2å±äºä¸åçæ¶è´¹ç»ï¼è¿æ ·å®ä»¬å°±è½åæ¶æ¶è´¹äºã\n\nå¦å¤ï¼redisåºäºå­å¸åé¾è¡¨æ°æ®ç»æï¼å®ç°äºåå¸åè®¢éåè½ï¼è¿ä¸ªåè½å¯ä»¥å®ç°ä¸ä¸ªæ¶æ¯è¢«å¤ä¸ªæ¶è´¹èæ¶è´¹ä½¿ç¨ï¼å¯ä»¥æ»¡è¶³é®é¢ä¸­çåºæ¯éæ±ã',charsets:{cjk:!0},lastUpdated:"2023/04/10, 14:17:28",lastUpdatedTimestamp:1681136248e3},{title:"å¼æ­¥æºå¶ãCPU æ¶æå¯¹æ§è½çå½±å",frontmatter:{title:"å¼æ­¥æºå¶ãCPU æ¶æå¯¹æ§è½çå½±å",date:"2023-04-07T19:23:37.000Z",permalink:"/pages/ca62e3/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/16.%E5%BC%82%E6%AD%A5%E6%9C%BA%E5%88%B6%E3%80%81CPU%20%E6%9E%B6%E6%9E%84%E5%AF%B9%E6%80%A7%E8%83%BD%E7%9A%84%E5%BD%B1%E5%93%8D.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/16.å¼æ­¥æºå¶ãCPU æ¶æå¯¹æ§è½çå½±å.md",key:"v-68306418",path:"/pages/ca62e3/",headers:[{level:2,title:"1. å¼æ­¥æºå¶ï¼å¦ä½é¿ååçº¿ç¨æ¨¡åçé»å¡ï¼",slug:"_1-å¼æ­¥æºå¶-å¦ä½é¿ååçº¿ç¨æ¨¡åçé»å¡",normalizedTitle:"1. å¼æ­¥æºå¶ï¼å¦ä½é¿ååçº¿ç¨æ¨¡åçé»å¡ï¼",charIndex:240},{level:3,title:"1.1 Redis å®ä¾æåªäºé»å¡ç¹ï¼",slug:"_1-1-redis-å®ä¾æåªäºé»å¡ç¹",normalizedTitle:"1.1 redis å®ä¾æåªäºé»å¡ç¹ï¼",charIndex:266},{level:4,title:"1ï¼åå®¢æ·ç«¯äº¤äºæ¶çé»å¡ç¹",slug:"_1-åå®¢æ·ç«¯äº¤äºæ¶çé»å¡ç¹",normalizedTitle:"1ï¼åå®¢æ·ç«¯äº¤äºæ¶çé»å¡ç¹",charIndex:499},{level:4,title:"2ï¼åç£çäº¤äºæ¶çé»å¡ç¹",slug:"_2-åç£çäº¤äºæ¶çé»å¡ç¹",normalizedTitle:"2ï¼åç£çäº¤äºæ¶çé»å¡ç¹",charIndex:1671},{level:4,title:"3ï¼ä¸»ä»èç¹äº¤äºæ¶çé»å¡ç¹",slug:"_3-ä¸»ä»èç¹äº¤äºæ¶çé»å¡ç¹",normalizedTitle:"3ï¼ä¸»ä»èç¹äº¤äºæ¶çé»å¡ç¹",charIndex:1866},{level:4,title:"4ï¼åçéç¾¤å®ä¾äº¤äºæ¶çé»å¡ç¹",slug:"_4-åçéç¾¤å®ä¾äº¤äºæ¶çé»å¡ç¹",normalizedTitle:"4ï¼åçéç¾¤å®ä¾äº¤äºæ¶çé»å¡ç¹",charIndex:2075},{level:3,title:"1.2 åªäºé»å¡ç¹å¯ä»¥å¼æ­¥æ§è¡ï¼",slug:"_1-2-åªäºé»å¡ç¹å¯ä»¥å¼æ­¥æ§è¡",normalizedTitle:"1.2 åªäºé»å¡ç¹å¯ä»¥å¼æ­¥æ§è¡ï¼",charIndex:2676},{level:3,title:"1.3 å¼æ­¥çå­çº¿ç¨æºå¶",slug:"_1-3-å¼æ­¥çå­çº¿ç¨æºå¶",normalizedTitle:"1.3 å¼æ­¥çå­çº¿ç¨æºå¶",charIndex:3569},{level:3,title:"1.4 å°ç»",slug:"_1-4-å°ç»",normalizedTitle:"1.4 å°ç»",charIndex:4268},{level:2,title:"2. ä¸ºä»ä¹ CPU ç»æä¹ä¼å½±å Redis çæ§è½ï¼",slug:"_2-ä¸ºä»ä¹-cpu-ç»æä¹ä¼å½±å-redis-çæ§è½",normalizedTitle:"2. ä¸ºä»ä¹ cpu ç»æä¹ä¼å½±å redis çæ§è½ï¼",charIndex:4338},{level:3,title:"2.1 ä¸»æµç CPU æ¶æ",slug:"_2-1-ä¸»æµç-cpu-æ¶æ",normalizedTitle:"2.1 ä¸»æµç cpu æ¶æ",charIndex:4474},{level:3,title:"2.2 CPU å¤æ ¸å¯¹ Redis æ§è½çå½±å",slug:"_2-2-cpu-å¤æ ¸å¯¹-redis-æ§è½çå½±å",normalizedTitle:"2.2 cpu å¤æ ¸å¯¹ redis æ§è½çå½±å",charIndex:5572},{level:3,title:"2.3 CPU ç NUMA æ¶æå¯¹ Redis æ§è½çå½±å",slug:"_2-3-cpu-ç-numa-æ¶æå¯¹-redis-æ§è½çå½±å",normalizedTitle:"2.3 cpu ç numa æ¶æå¯¹ redis æ§è½çå½±å",charIndex:6260},{level:3,title:"2.4 ç»æ ¸çé£é©åè§£å³æ¹æ¡",slug:"_2-4-ç»æ ¸çé£é©åè§£å³æ¹æ¡",normalizedTitle:"2.4 ç»æ ¸çé£é©åè§£å³æ¹æ¡",charIndex:7354},{level:4,title:"æ¹æ¡ä¸ï¼ä¸ä¸ª Redis å®ä¾å¯¹åºç»ä¸ä¸ªç©çæ ¸",slug:"æ¹æ¡ä¸-ä¸ä¸ª-redis-å®ä¾å¯¹åºç»ä¸ä¸ªç©çæ ¸",normalizedTitle:"æ¹æ¡ä¸ï¼ä¸ä¸ª redis å®ä¾å¯¹åºç»ä¸ä¸ªç©çæ ¸",charIndex:7486},{level:4,title:"æ¹æ¡äºï¼ä¼å Redis æºç ",slug:"æ¹æ¡äº-ä¼å-redis-æºç ",normalizedTitle:"æ¹æ¡äºï¼ä¼å redis æºç ",charIndex:7923},{level:3,title:"2.5 å°ç»",slug:"_2-5-å°ç»",normalizedTitle:"2.5 å°ç»",charIndex:10093}],headersStr:"1. å¼æ­¥æºå¶ï¼å¦ä½é¿ååçº¿ç¨æ¨¡åçé»å¡ï¼ 1.1 Redis å®ä¾æåªäºé»å¡ç¹ï¼ 1ï¼åå®¢æ·ç«¯äº¤äºæ¶çé»å¡ç¹ 2ï¼åç£çäº¤äºæ¶çé»å¡ç¹ 3ï¼ä¸»ä»èç¹äº¤äºæ¶çé»å¡ç¹ 4ï¼åçéç¾¤å®ä¾äº¤äºæ¶çé»å¡ç¹ 1.2 åªäºé»å¡ç¹å¯ä»¥å¼æ­¥æ§è¡ï¼ 1.3 å¼æ­¥çå­çº¿ç¨æºå¶ 1.4 å°ç» 2. ä¸ºä»ä¹ CPU ç»æä¹ä¼å½±å Redis çæ§è½ï¼ 2.1 ä¸»æµç CPU æ¶æ 2.2 CPU å¤æ ¸å¯¹ Redis æ§è½çå½±å 2.3 CPU ç NUMA æ¶æå¯¹ Redis æ§è½çå½±å 2.4 ç»æ ¸çé£é©åè§£å³æ¹æ¡ æ¹æ¡ä¸ï¼ä¸ä¸ª Redis å®ä¾å¯¹åºç»ä¸ä¸ªç©çæ ¸ æ¹æ¡äºï¼ä¼å Redis æºç  2.5 å°ç»",content:'> åèï¼\n> \n>  * 16 å¼æ­¥æºå¶ï¼å¦ä½é¿ååçº¿ç¨æ¨¡åçé»å¡ï¼| æå®¢æ¶é´\n>  * 17 ä¸ºä»ä¹ CPU ç»æä¹ä¼å½±å Redis çæ§è½ï¼| æå®¢æ¶é´\n\nRedis å å¶é«æ§è½èè¢«å¹¿æ³åºç¨ï¼æä»¬éè¦é¿åæ§è½å¼å¸¸çæåµåºç°ãå½±å Redis æ§è½ç 5 å¤§æ¹é¢å ç´ æï¼\n\n * Redis åé¨çé»å¡å¼æä½\n * CPU æ ¸å NUMA æ¶æçå½±å\n * Redis å³é®ç³»ç»éç½®\n * Redis åå­ç¢ç\n * Redis ç¼å²åº\n\næ¬æå°åæåä¸¤ä¸ªå ç´ ã\n\n\n# 1. å¼æ­¥æºå¶ï¼å¦ä½é¿ååçº¿ç¨æ¨¡åçé»å¡ï¼\n\n\n# 1.1 Redis å®ä¾æåªäºé»å¡ç¹ï¼\n\næä»¬åé¢å­¦ä¹ è¿ï¼Redis çç½ç» IO åé®å¼å¯¹è¯»åæ¯ç±ä¸»çº¿ç¨å®æçï¼è¿äºä¸åçäº¤äºè¦æ¶åä¸åçæä½ãæä»¬çä¸ä¸ Redis åä¸åå¯¹è±¡äº¤äºæ¶ï¼æåªäºäº¤äºæä½ï¼\n\n * å®¢æ·ç«¯ï¼ç½ç» IPãKV ç CRUD ç­\n * ç£çï¼AOF ä¸ RDB æä½\n * ä¸»ä»èç¹ï¼æ°æ®å¤å¶æä½\n * åçéç¾¤ï¼åå¶ä»å®ä¾ä¼ è¾åå¸æ§½ä¿¡æ¯ãæ°æ®è¿ç§»\n\nè¿åç±»äº¤äºå¯¹è±¡åæä½ä¹é´çå³ç³»å¦ä¸å¾ï¼\n\nä¸é¢æä»¬éä¸ªåæåªäºæä½ä¼å¼èµ·é»å¡ï¼\n\n# 1ï¼åå®¢æ·ç«¯äº¤äºæ¶çé»å¡ç¹\n\nç±äº Redis ä½¿ç¨äº IO å¤è·¯å¤ç¨æºå¶é¿åäºä¸»çº¿ç¨çä¸ç´ç­å¾ï¼æä»¥ç½ç» IO ä¸æ¯å¯¼è´ Redis é»å¡çå ç´ ã\n\nCRUD æä½æ¯ Redis ä¸å®¢æ·ç«¯äº¤äºçä¸»è¦é¨åï¼ä¹æ¯ Redis ä¸»çº¿ç¨æ§è¡çä¸»è¦ä»»å¡ãæä»¥ï¼å¤æåº¦é«çå¢å æ¹æ¥æä½è¯å®ä¼é»å¡ Redisã\n\né£æä¹å¤æ­æä½å¤æåº¦é«ä¸é«å¢ï¼è¿éæä¸ä¸ªæåºæ¬çæ åï¼å°±æ¯çæä½çå¤æåº¦æ¯å¦ä¸º O(N)ã\n\nRedis ä¸­æ¶åéåçæä½å¤æåº¦éå¸¸ä¸ºO(N)ï¼æä»¬è¦å¨ä½¿ç¨æ¶éè§èµ·æ¥ãä¾å¦éååç´ å¨éæ¥è¯¢æä½HGETALLãSMEMBERSï¼ä»¥åéåçèåç»è®¡æä½ï¼ä¾å¦æ±äº¤ãå¹¶åå·®éãè¿äºæä½å¯ä»¥ä½ä¸º Redis çç¬¬ä¸ä¸ªé»å¡ç¹ï¼éåå¨éæ¥è¯¢åèåæä½ã\n\né¤æ­¤ä¹å¤ï¼éåèªèº«çå é¤æä½åæ ·ä¹ææ½å¨çé»å¡é£é©ãå ä¸ºå é¤æä½çæ¬è´¨æ¯è¦éæ¾é®å¼å¯¹å ç¨çåå­ç©ºé´ï¼èæä½ç³»ç»å¨éæ¾åå­æ¶éè¦ææéæ¾çåå­åæå¥ç©ºé²é¾è¡¨ä¸­ä»¥ä¾¿ç®¡çï¼è¿ä¸ªè¿ç¨å¯è½ä¼é»å¡ç¨åºãæä»¥ï¼å¦æä¸ä¸å­éæ¾äºå¤§éåå­ï¼ç©ºé²åå­åé¾è¡¨æä½æ¶é´å°±ä¼å¢å ï¼ç¸åºå°å°±ä¼é æ Redis ä¸»çº¿ç¨çé»å¡ã\n\néæ¾å¤§éåå­çåºæ¯ï¼å°±æ¯å¨å é¤å¤§éé®å¼å¯¹æ°æ®æ¶ï¼æå¸åçå°±æ¯å é¤åå«äºå¤§éåç´ çéåï¼ä¹ç§°ä¸º bigkey å é¤ãä¸å¾æµè¯äºä¸ååç´ æ°éçéåè¿è¡å é¤æä½æèè´¹çæ¶é´ï¼\n\nä»è¿å¼ è¡¨éï¼æä»¬å¯ä»¥å¾åºä¸ä¸ªç»è®ºï¼\n\n 1. å½åç´ æ°éä»10ä¸å¢å å°100ä¸æ¶ï¼4å¤§éåç±»åçå é¤æ¶é´çå¢é¿å¹åº¦ä»5åä¸åå°äºè¿20åï¼\n 2. éååç´ è¶å¤§ï¼å é¤æè±è´¹çæ¶é´å°±è¶é¿ï¼\n 3. å½å é¤æ100ä¸ä¸ªåç´ çéåæ¶ï¼æå¤§çå é¤æ¶é´ç»å¯¹å¼å·²ç»è¾¾å°äº1.98sï¼Hashç±»åï¼ãRedisçååºæ¶é´ä¸è¬å¨å¾®ç§çº§å«ï¼æä»¥ï¼ä¸ä¸ªæä½è¾¾å°äºè¿2sï¼ä¸å¯é¿åå°ä¼é»å¡ä¸»çº¿ç¨ã\n\næä»¥ï¼bigkey å é¤æä½å°±æ¯ Redis çç¬¬äºä¸ªé»å¡ç¹ãå é¤æä½å¯¹Rediså®ä¾æ§è½çè´é¢å½±åå¾å¤§ï¼èä¸å¨å®éä¸å¡å¼åæ¶å®¹æè¢«å¿½ç¥ï¼æä»¥ä¸å®è¦éè§å®ã\n\nå°å»ºè®®\n\nå½éå° bigkey å é¤æ¶ï¼æä¸ä¸ªå°å»ºè®®ï¼åä½¿ç¨éåç±»åæä¾ç SCAN å½ä»¤è¯»åæ°æ®ï¼ç¶ååè¿è¡å é¤ãå ä¸ºç¨ SCAN å½ä»¤å¯ä»¥æ¯æ¬¡åªè¯»åä¸é¨åæ°æ®å¹¶è¿è¡å é¤ï¼è¿æ ·å¯ä»¥é¿åä¸æ¬¡æ§å é¤å¤§é key ç»ä¸»çº¿ç¨å¸¦æ¥çé»å¡ã\n\nä¾å¦ï¼å¯¹äº Hash ç±»åç bigkey å é¤ï¼ä½ å¯ä»¥ä½¿ç¨ HSCAN å½ä»¤ï¼æ¯æ¬¡ä»Hashéåä¸­è·åä¸é¨åé®å¼å¯¹ï¼ä¾å¦200ä¸ªï¼ï¼åä½¿ç¨ HDEL å é¤è¿äºé®å¼å¯¹ï¼è¿æ ·å°±å¯ä»¥æå é¤åååæå°å¤æ¬¡æä½ä¸­ï¼é£ä¹ï¼æ¯æ¬¡å é¤æä½çèæ¶å°±ä¸ä¼å¤ªé¿ï¼ä¹å°±ä¸ä¼é»å¡ä¸»çº¿ç¨äºã\n\nå®¹æèæ³å°ï¼æ¸ç©ºæ°æ®åºï¼flushdb å flushall æä½ï¼ä¹å¿ç¶æ¯ä¸ä¸ªæ½å¨çé»å¡é£é©ï¼å ä¸ºå®ä»¬ä¹æ¶åå°å¤§é KV çå é¤ãæä»¥ï¼Redis çç¬¬ä¸ä¸ªé»å¡ç¹ï¼æ¸ç©ºæ°æ®åºã\n\n# 2ï¼åç£çäº¤äºæ¶çé»å¡ç¹\n\nç±äºç£ç IO ä¸è¬æ¯è¾æ¢ï¼å æ­¤éè¦éç¹å³æ³¨ãRedis éç¨å­è¿ç¨çæ¹å¼æ¥æ§è¡ RDB ççæå AOF çéåï¼ä»èé¿åäºå¯¹ä¸»çº¿ç¨çé»å¡ã\n\nä½ Redis ç´æ¥è®°å½ AOF æ¶ï¼ä¼æ ¹æ®ä¸åçååç­ç¥å¯¹æ°æ®åè½çä¿å­ãä¸æ¬¡åæ­¥åç£çå¤§çº¦èæ¶ 1~2msï¼å¦æå­å¨å¤§éåæ­¥åæä½çè¯ï¼å°±ä¼é»å¡ä¸»çº¿ç¨ãå æ­¤ Redis çåä¸ªé»å¡ç¹ï¼AOF æ¥å¿åæ­¥åã\n\n# 3ï¼ä¸»ä»èç¹äº¤äºæ¶çé»å¡ç¹\n\nå¨ä¸»ä»å¤å¶æ¶ï¼ä¸»åºåå»ºåä¼ è¾ RDB æä»¶é½æ¯ç±å­è¿ç¨å®æçï¼ä¸ä¼é»å¡ä¸»çº¿ç¨ï¼ä»åºæ¥æ¶ RDB æä»¶åï¼éè¦ä½¿ç¨ flushdb å½ä»¤æ¥æ¸ç©ºå½åæ°æ®åºï¼è¿æ­£å¥½è£ä¸äºåååæçç¬¬ä¸ä¸ªé»å¡ç¹ã\n\næ­¤å¤ï¼ä»åºå¨æ¸ç©ºæ°æ®åºåï¼è¿éè¦æ RDB å è½½å°åå­ä¸­ï¼è¿ä¸ªè¿ç¨ä¸ RDB æä»¶çå¤§å°å¯åç¸å³ï¼RDB è¶å¤§ï¼å è½½è¿ç¨è¶æ¢ãæä»¥ï¼å è½½ RDB æä»¶å°±æä¸ºäº Redis çç¬¬äºä¸ªé»å¡ç¹ã\n\n# 4ï¼åçéç¾¤å®ä¾äº¤äºæ¶çé»å¡ç¹\n\næåï¼å½æä»¬é¨ç½²Redisåçéç¾¤æ¶ï¼æ¯ä¸ªRediså®ä¾ä¸åéçåå¸æ§½ä¿¡æ¯éè¦å¨ä¸åå®ä¾é´è¿è¡ä¼ éï¼åæ¶ï¼å½éè¦è¿è¡è´è½½åè¡¡æèæå®ä¾å¢å æ¶ï¼æ°æ®ä¼å¨ä¸åçå®ä¾é´è¿è¡è¿ç§»ãä¸è¿ï¼åå¸æ§½çä¿¡æ¯éä¸å¤§ï¼èæ°æ®è¿ç§»æ¯æ¸è¿å¼æ§è¡çï¼æä»¥ï¼ä¸è¬æ¥è¯´ï¼è¿ä¸¤ç±»æä½å¯¹ Redis ä¸»çº¿ç¨çé»å¡é£é©ä¸å¤§ã\n\nä¸è¿ï¼å¦æä½ ä½¿ç¨äº Redis Cluster æ¹æ¡ï¼èä¸åæ¶æ­£å¥½è¿ç§»çæ¯ bigkey çè¯ï¼å°±ä¼é æä¸»çº¿ç¨çé»å¡ï¼å ä¸º Redis Cluster ä½¿ç¨äºåæ­¥è¿ç§»ãæå°å¨ç¬¬33è®²ä¸­åä½ ä»ç»ä¸ååçéç¾¤æ¹æ¡å¯¹æ°æ®è¿ç§»é æçé»å¡çè§£å³æ¹æ³ï¼è¿éä½ åªéè¦ç¥éï¼å½æ²¡æ bigkey æ¶ï¼åçéç¾¤çåå®ä¾å¨è¿è¡äº¤äºæ¶ä¸ä¼é»å¡ä¸»çº¿ç¨ï¼å°±å¯ä»¥äºã\n\nç°å¨æä»¬æ»ç»ä¸ååæ¾å°çäºä¸ªé»å¡ç¹ï¼\n\n * éåå¨éæ¥è¯¢åèåæä½\n * bigkey å é¤\n * æ¸ç©ºæ°æ®åº\n * AOF æ¥å¿åæ­¥å\n * ä»åºå è½½ RDB æä»¶\n\nå¦æå¨ä¸»çº¿ç¨ä¸­æ§è¡è¿äºæä½ï¼å¿ç¶ä¼å¯¼è´ä¸»çº¿ç¨é¿æ¶é´æ æ³æå¡å¶ä»è¯·æ±ãä¸ºäºé¿åé»å¡å¼æä½ï¼Redis æä¾äºå¼æ­¥çº¿ç¨æºå¶ãæè°çå¼æ­¥çº¿ç¨æºå¶ï¼æ Redis ä¼å¯å¨ä¸äºå­çº¿ç¨ï¼ç¶åæä¸äºä»»å¡äº¤ç»è¿äºå­çº¿ç¨ï¼è®©å®ä»¬å¨åå°å®æï¼èä¸åç±ä¸»çº¿ç¨æ¥æ§è¡è¿äºä»»å¡ãä½¿ç¨å¼æ­¥çº¿ç¨æºå¶æ§è¡æä½ï¼å¯ä»¥é¿åé»å¡ä¸»çº¿ç¨ã\n\nä¸è¿é®é¢æ¥äºï¼è¿äºä¸ªé»å¡å¼æä½é½å¯ä»¥è¢«å¼æ­¥æ§è¡åï¼\n\n\n# 1.2 åªäºé»å¡ç¹å¯ä»¥å¼æ­¥æ§è¡ï¼\n\nåçä¸ä¸å¼æ­¥æ§è¡å¯¹æä½çè¦æ±ã\n\nå¦æä¸ä¸ªæä½è½è¢«å¼æ­¥æ§è¡ï¼å°±æå³çï¼å®å¹¶ä¸æ¯ Redis ä¸»çº¿ç¨çå³é®è·¯å¾ä¸çæä½ãå³é®è·¯å¾ä¸çæä½æ¯è¯´ï¼å®¢æ·ç«¯æè¯·æ±åç» Redis åå°±ç­çè¿åæ°æ®ç»æãå¦ä¸å¾ï¼\n\n * å·¦å¾çæä½ 1 å°±ä¸ç®å³é®è·¯å¾ä¸çæä½ï¼å æ­¤å¯ä»¥è®©åå°å­çº¿ç¨æ¥å¼æ­¥æ§è¡ï¼\n * å³å¾çæä½ 2 å°±æ¯å³é®è·¯å¾ä¸çæä½ï¼æä»¥ä¸»çº¿ç¨å¿é¡»ç«å³æè¿ä¸ªæä½æ§è¡å®ã\n\nå¯¹ Redis æ¥è¯´ï¼è¯»æä½æ¯å¸åçå³é®è·¯å¾æä½ãRedis çç¬¬ä¸ä¸ªé»å¡ç¹âéåå¨éæ¥è¯¢åèåæä½âé½æ¶åå°äºè¯»æä½ï¼æä»¥ï¼å®ä»¬æ¯ä¸è½è¿è¡å¼æ­¥æä½äºã\n\nèå é¤æä½ä¸éè¦ç«å»è¿åå·ä½çç»æï¼ä¸ç®æ¯å³é®è·¯å¾æä½ï¼å æ­¤æä»¬å¯ä»¥ä½¿ç¨åå°å­çº¿ç¨æ¥å¼æ­¥æ§è¡å é¤æä½ãæç¬¬äºä¸ªåç¬¬ä¸ä¸ªé»å¡ç¹å¯ä»¥å¼æ­¥è§£å³ã\n\nå¯¹äºç¬¬åä¸ªé»å¡ç¹âAOFæ¥å¿åæ­¥åâæ¥è¯´ï¼ä¸ºä¿è¯æ°æ®å¯é æ§ï¼Redis å®ä¾éè¦ä¿è¯ AOF æ¥å¿ä¸­çæä½è®°å½å·²ç»è½çï¼è¿ä¸ªæä½è½ç¶éè¦å®ä¾ç­å¾ï¼ä½å®å¹¶ä¸ä¼è¿åå·ä½çæ°æ®ç»æç»å®ä¾ãæä»¥ï¼æä»¬ä¹å¯ä»¥å¯å¨ä¸ä¸ªå­çº¿ç¨æ¥æ§è¡AOFæ¥å¿çåæ­¥åï¼èä¸ç¨è®©ä¸»çº¿ç¨ç­å¾AOFæ¥å¿çåå®æã\n\næååçä¸âä»åºå è½½ RDB æä»¶âè¿ç¬¬äºä¸ªé»å¡ç¹ãä»åºå¿é¡»æ RDB å è½½å®ï¼è¿æä½ä¹å±äºå³é®è·¯å¾ä¸çæä½ï¼æä»¥æä»¬å¿é¡»è®©ä»åºçä¸»çº¿ç¨æ¥æ§è¡ã\n\nå¯¹äº Redis çäºå¤§é»å¡ç¹æ¥è¯´ï¼é¤äºâéåå¨éæ¥è¯¢åèåæä½âåâä»åºå è½½ RDB æä»¶âï¼å¶ä»ä¸ä¸ªé»å¡ç¹æ¶åçæä½é½ä¸å¨å³é®è·¯å¾ä¸ï¼æä»¥å¯ä»¥ä½¿ç¨ Redis çå¼æ­¥å­çº¿ç¨æºå¶æ¥å®ç° bigkey å é¤ï¼æ¸ç©ºæ°æ®åºï¼ä»¥å AOF æ¥å¿åæ­¥åã\n\nå°å»ºè®®\n\néåå¨éæ¥è¯¢åèåæä½ãä»åºå è½½RDBæä»¶æ¯å¨å³é®è·¯å¾ä¸ï¼æ æ³ä½¿ç¨å¼æ­¥æä½æ¥å®æãå¯¹äºè¿ä¸¤ä¸ªé»å¡ç¹ä¹æä¸¤ä¸ªå°å»ºè®®ï¼\n\n * éåå¨éæ¥è¯¢åèåæä½ï¼å¯ä»¥ä½¿ç¨ SCAN å½ä»¤ï¼åæ¹è¯»åæ°æ®ï¼åå¨å®¢æ·ç«¯è¿è¡èåè®¡ç®ï¼\n * ä»åºå è½½ RDB æä»¶ï¼æä¸»åºçæ°æ®éå¤§å°æ§å¶å¨ 2~4GB å·¦å³ï¼ä»¥ä¿è¯ RDB æä»¶è½ä»¥è¾å¿«çéåº¦å è½½ã\n\né£ Redis å®ç°çå¼æ­¥å­çº¿ç¨æºå¶å·ä½æ¯æä¹æ§è¡å¢ï¼\n\n\n# 1.3 å¼æ­¥çå­çº¿ç¨æºå¶\n\nRedis ä¸»çº¿ç¨å¯å¨åï¼ä¼ä½¿ç¨æä½ç³»ç»æä¾ç pthread_create å½æ°åå»º 3 ä¸ªå­çº¿ç¨ï¼åå«ç±å®ä»¬è´è´£ AOF æ¥å¿åæä½ãé®å¼å¯¹å é¤ä»¥åæä»¶å³é­çå¼æ­¥æ§è¡ã\n\nä¸»çº¿ç¨éè¿ä¸ä¸ªé¾è¡¨å½¢å¼çä»»å¡éååå­çº¿ç¨è¿è¡äº¤äºãå½æ¶å°é®å¼å¯¹å é¤åæ¸ç©ºæ°æ®åºçæä½æ¶ï¼ä¸»çº¿ç¨ä¼æè¿ä¸ªæä½å°è£æä¸ä¸ªä»»å¡ï¼æ¾å¥å°ä»»å¡éåä¸­ï¼ç¶åç»å®¢æ·ç«¯è¿åä¸ä¸ªå®æä¿¡æ¯ï¼è¡¨æå é¤å·²ç»å®æãä½å®éä¸ï¼è¿ä¸ªæ¶åå é¤è¿æ²¡ææ§è¡ï¼ç­å°åå°å­çº¿ç¨ä»ä»»å¡éåä¸­è¯»åä»»å¡åï¼æå¼å§å®éå é¤é®å¼å¯¹ï¼å¹¶éæ¾ç¸åºçåå­ç©ºé´ãå æ­¤ï¼æä»¬æè¿ç§å¼æ­¥å é¤ä¹ç§°ä¸ºæ°æ§å é¤ï¼lazy freeï¼ãæ­¤æ¶ï¼å é¤ææ¸ç©ºæä½ä¸ä¼é»å¡ä¸»çº¿ç¨ï¼è¿å°±é¿åäºå¯¹ä¸»çº¿ç¨çæ§è½å½±åã\n\nåæ°æ§å é¤ç±»ä¼¼ï¼å½ AOF æ¥å¿éç½®æ everysec éé¡¹åï¼ä¸»çº¿ç¨ä¼æ AOF åæ¥å¿æä½å°è£æä¸ä¸ªä»»å¡ï¼ä¹æ¾å°ä»»å¡éåä¸­ãåå°å­çº¿ç¨è¯»åä»»å¡åï¼å¼å§èªè¡åå¥ AOF æ¥å¿ï¼è¿æ ·ä¸»çº¿ç¨å°±ä¸ç¨ä¸ç´ç­å¾ AOF æ¥å¿åå®äºã\n\nä¸é¢è¿å¼ å¾å±ç¤ºäº Redis ä¸­çå¼æ­¥å­çº¿ç¨æ§è¡æºå¶ï¼\n\nå¼æ­¥çé®å¼å¯¹å é¤åæ°æ®åºæ¸ç©ºæä½æ¯ Redis 4.0 åæä¾çåè½ï¼Redisä¹æä¾äºæ°çå½ä»¤æ¥æ§è¡è¿ä¸¤ä¸ªæä½ï¼\n\n * é®å¼å¯¹å é¤ï¼å½ä½ çéåç±»åä¸­æå¤§éåç´ ï¼ä¾å¦æç¾ä¸çº§å«æåä¸çº§å«åç´ ï¼éè¦å é¤æ¶ï¼æå»ºè®®ä½ ä½¿ç¨ UNLINK å½ä»¤ã\n * æ¸ç©ºæ°æ®åºï¼å¯ä»¥å¨ FLUSHDB å FLUSHALL å½ä»¤åå ä¸ ASYNC éé¡¹ï¼è¿æ ·å°±å¯ä»¥è®©åå°å­çº¿ç¨å¼æ­¥å°æ¸ç©ºæ°æ®åºï¼å¦ä¸æç¤ºï¼\n\nFLUSHDB ASYNC\nFLUSHALL AYSNC\n\n\n1\n2\n\n\n\n# 1.4 å°ç»\n\nè¿ä¸èä¸»è¦è®²äº Redis è¿è¡æ¶çäº¤äºå¯¹è±¡åäº¤äºæä½ï¼å¹¶å¯¹å¶ä¸­ä¸å±äºå³é®è·¯å¾çæä½è®²è§£ä½¿ç¨å¼æ­¥å­çº¿ç¨æºå¶æ¥å®æã\n\n\n# 2. ä¸ºä»ä¹ CPU ç»æä¹ä¼å½±å Redis çæ§è½ï¼\n\nCPU çæ¶æï¼CPU çå¤æ ¸æ¶æä»¥åå¤ CPU æ¶æï¼ä¹ä¼å½±å Redis çæ§è½ï¼äºè§£è¿äºå¯¹æä»¬çæ§è½è°ä¼æå¾å¤å¸®å©ã\n\nè¿ä¸èä¸»è¦å­¦ä¹ ç®åä¸»æµ CPU æ¶æä»¥ååºäºæ­¤ä¼å Redis æ§è½çæ¹æ³ã\n\n\n# 2.1 ä¸»æµç CPU æ¶æ\n\nä¸ä¸ª CPU ä¸è¬ç±å¤ä¸ªç©çæ ¸ï¼æ¯ä¸ªæ ¸é½å¯ä»¥è¿è¡ç¨åºï¼æ¯ä¸ªæ ¸é½æ¥æç§æç L1 cache åç§æç L2 cacheãæ³¨æï¼æ¯ä¸ªç©çæ ¸çç§æ cache åªè½è¢«å½åç©çæ ¸ä½¿ç¨ãå½æ°æ®ææä»¤ä¿å­å¨ L1 æ L2 cache ä¸­æ¶ï¼ç©çæ ¸å¯¹å®ä»¬çè®¿é®å»¶è¿ä¸è¶è¿ 10 çº³ç§ï¼éåº¦éå¸¸å¿«ã\n\nå¦æ Redis è½ææä»¤ææ°æ®å­å¨ç©çæ ¸ cache ä¸­ï¼å°±è½é«éè®¿é®ãä½è¿äº cache ä¸è¬åªæ KB çº§å«ï¼æ¾ä¸ä¸å¤ªå¤æ°æ®ãè¥ cache ä¸å½ä¸­ï¼åéè¦è®¿é®åå­ï¼èè®¿å­çå»¶è¿ä¸è¬æ¯è®¿é® cache ç 10 åï¼ä¸å¯é¿åå°ä¼å¯¹æ§è½é æå½±åã\n\næä»¥ï¼ä¸åçç©çæ ¸è¿ä¼å±äº«ä¸ä¸ªå±åç L3 cacheãL3 cache å¾å¾è¾å¤§ï¼è½è¾¾å°å  MB å°å å MBï¼ä»èå°½å¯è½é¿åè®¿é®åå­ã\n\nå¦å¤ï¼ç°å¨ä¸»æµç CPU ä¸­ï¼æ¯ä¸ªç©çæ ¸éå¸¸é½ä¼è¿è¡ä¸¤ä¸ªè¶çº¿ç¨ï¼ä¹å«ä½é»è¾æ ¸ãåä¸ä¸ªç©çæ ¸çé»è¾æ ¸ä¼å±äº«ä½¿ç¨ L1ãL2 ç¼å­ã\n\nä¸å¾å±ç¤ºäºç©çæ ¸ãé»è¾æ ¸ãcache ä¹é´çå³ç³»ï¼\n\nåæ¶ï¼ä¸ºäºæåæå¡å¨çå¤çè½åï¼æå¡å¨è¿å¾å¾ä¼æå¤ä¸ª CPU å¤çå¨ï¼ä¹ç§°å¤ CPU Socketï¼æ¯ä¸ª CPU Socket æèªå·±çç©çæ ¸ãL3 cache ä»¥åè¿æ¥åå­ï¼ä¸ç¨ CPU Socket ä¹é´éè¿æ»çº¿è¿æ¥ãå¦ä¸å¾æç¤ºï¼\n\n> ä¸ä¸ª CPU å°±æ¯ä¸ä¸ª CPU Socket -- > å¤ CPU æ¶æï¼ ä¸ä¸ª CPU å¯ä»¥æå¤ä¸ªç©çæ ¸ï¼ä¸ä¸ªç©çæ ¸å¯ä»¥æå¤ä¸ªé»è¾æ ¸ -- > CPU å¤æ ¸æ¶æã\n\nå¨å¤CPUæ¶æä¸ï¼åºç¨ç¨åºå¯ä»¥å¨ä¸åçå¤çå¨ä¸è¿è¡ãå¨åæçå¾ä¸­ï¼Redis å¯ä»¥åå¨ Socket 1 ä¸è¿è¡ä¸æ®µæ¶é´ï¼ç¶ååè¢«è°åº¦å° Socket 2 ä¸è¿è¡ãä½å½ç¨åºè¢«è°åº¦å° Socket 2 åï¼åè®¿é®åå­å°±éè¦è®¿é®ä¹å Socket ä¸è¿æ¥çåå­ï¼è¿ç§è®¿é®å±äºè¿ç«¯åå­è®¿é®ãç¸æ¯è®¿é®ç´æ¥è¿æ¥çåå­ï¼è¿ç«¯åå­è®¿é®ä¼å¢å å»¶è¿ãå¨å¤CPUæ¶æä¸ï¼ä¸ä¸ªåºç¨ç¨åºè®¿é®æå¨ Socket çæ¬å°åå­åè®¿é®è¿ç«¯åå­çå»¶è¿å¹¶ä¸ä¸è´ï¼æä»¥ï¼æä»¬ä¹æè¿ä¸ªæ¶æç§°ä¸ºéç»ä¸åå­è®¿é®æ¶æï¼Non-Uniform Memory Accessï¼NUMA æ¶æï¼ã\n\nå°è¿éï¼æä»¬å°±ç¥éäºä¸»æµç CPU å¤æ ¸æ¶æåå¤ CPU æ¶æï¼æä»¬æ¥ç®åæ»ç»ä¸ CPU æ¶æå¯¹åºç¨ç¨åºè¿è¡çå½±åï¼\n\n * ååå©ç¨ L1ãL2 cache å¯ä»¥ææç¼©ç­åºç¨ç¨åºçæ§è¡æ¶é´ã\n * å¨ NUMA æ¶æä¸ï¼è¿ç«¯åå­è®¿é®çæåµä¹ä¼å¢å ç¨åºçæ§è¡æ¶é´ã\n\næ¥ä¸æ¥çä¸ä¸ CPU å¤æ ¸æ¯å¦ä½å½±å Redis æ§è½çã\n\n\n# 2.2 CPU å¤æ ¸å¯¹ Redis æ§è½çå½±å\n\nå¨ä¸ä¸ªCPUæ ¸ä¸è¿è¡æ¶ï¼åºç¨ç¨åºéè¦è®°å½èªèº«ä½¿ç¨çè½¯ç¡¬ä»¶èµæºä¿¡æ¯ï¼ä¾å¦æ æéãCPUæ ¸çå¯å­å¨å¼ç­ï¼ï¼æä»¬æè¿äºä¿¡æ¯ç§°ä¸º è¿è¡æ¶ä¿¡æ¯ãåæ¶ï¼åºç¨ç¨åºè®¿é®æé¢ç¹çæä»¤åæ°æ®è¿ä¼è¢«ç¼å­å°L1ãL2ç¼å­ä¸ï¼ä»¥ä¾¿æåæ§è¡éåº¦ãä½å¨å¤æ ¸CPUçåºæ¯ä¸ï¼ä¸æ¦ç¨åºéè¦å¨æ°çCPUæ ¸ä¸è¿è¡æ¶ï¼é£è¿è¡æ¶ä¿¡æ¯å°±éè¦éæ°å è½½å°æ°çCPUæ ¸ä¸ãèä¸ï¼æ°çCPUæ ¸çL1ãL2ç¼å­ä¹éè¦éæ°å è½½æ°æ®åæä»¤ï¼è¿ä¼å¯¼è´ç¨åºçè¿è¡æ¶é´å¢å ã\n\nç¨åºå¨ä¸å CPU æ ¸ä¸åæ¢æ¶ï¼ä¼åçè¿è¡æ¶ä¸ä¸æçéæ°å è½½ï¼ä»èå¯¼è´å»¶è¿ã\n\nä½èå°±ç»åè¿ç±äº context switchï¼çº¿ç¨çä¸ä¸æåæ¢ï¼å¯¼è´ Redis ç 99% å°¾å»¶è¿è¿å¤§ã\n\n> 99% å°¾å»¶è¿ï¼æä»¬æææè¯·æ±çå¤çå»¶è¿ä»å°å°å¤§æä¸ªåºï¼99%çè¯·æ±å»¶è¿å°äºçå¼å°±æ¯99%å°¾å»¶è¿ãæ¯å¦è¯´ï¼æä»¬æ1000ä¸ªè¯·æ±ï¼åè®¾æè¯·æ±å»¶è¿ä»å°å°å¤§æåºåï¼ç¬¬991ä¸ªè¯·æ±çå»¶è¿å®æµå¼æ¯1msï¼èå990ä¸ªè¯·æ±çå»¶è¿é½å°äº1msï¼æä»¥ï¼è¿éç99%å°¾å»¶è¿å°±æ¯1msã\n\nå¦ææ³é¿å Redis æ»æ¯å¨ä¸å CPU æ ¸ä¸æ¥åè°åº¦ï¼å¯ä»¥ä½¿ç¨ taskset å½ä»¤æä¸ä¸ªç¨åºç»å®å¨ä¸ä¸ªæ ¸ä¸è¿è¡ï¼å³ç»æ ¸ãæ¯å¦ä¸é¢è¿æ¡å½ä»¤æ Redis å®ä¾ç»å¨äº 0 å·æ ¸ä¸ï¼å¶ä¸­ï¼â-câéé¡¹ç¨äºè®¾ç½®è¦ç»å®çæ ¸ç¼å·ï¼\n\ntaskset -c 0 ./redis-server\n\n\n1\n\n\nä¸è¡¨å¯¹æ¯äºç»æ ¸ååçRedisç99%å°¾å»¶è¿ï¼\n\nç»æ ¸ä¸ä»å¯¹éä½å°¾å»¶è¿æå¥½å¤ï¼åæ ·ä¹è½éä½å¹³åå»¶è¿ãæåååçï¼è¿èæå Redis æ§è½ã\n\n\n# 2.3 CPU ç NUMA æ¶æå¯¹ Redis æ§è½çå½±å\n\nå®éåºç¨ä¸­ï¼ç»å¸¸çå°ä¸ç§è¯´æ³ï¼ä¸ºäºæå Redis çç½ç»æ§è½ï¼ææä½ç³»ç»çç½ç»ä¸­æ­å¤çç¨åºå CPU æ ¸ç»å®ãè¿ä¸ªåæ³å¯ä»¥é¿åç½ç»ä¸­æ­å¤çç¨åºå¨ä¸åæ ¸ä¸æ¥åè°åº¦æ§è¡ï¼çç¡®è½æææå Redis çç½ç»å¤çæ§è½ãä½æ¯ï¼ç½ç»ä¸­æ­ç¨åºæ¯è¦å Redis å®ä¾è¿è¡ç½ç»æ°æ®äº¤äºçï¼ä¸æ¦æç½ç»ä¸­æ­ç¨åºç»æ ¸åï¼æä»¬å°±éè¦æ³¨æ Redis å®ä¾æ¯ç»å¨åªä¸ªæ ¸ä¸äºï¼è¿ä¼å³ç³»å° Redis è®¿é®ç½ç»æ°æ®çæçé«ä½ã\n\næä»¬åæ¥çä¸Rediså®ä¾åç½ç»ä¸­æ­ç¨åºçæ°æ®äº¤äºï¼ç½ç»ä¸­æ­å¤çç¨åºä»ç½å¡ç¡¬ä»¶ä¸­è¯»åæ°æ®ï¼å¹¶ææ°æ®åå¥å°æä½ç³»ç»åæ ¸ç»´æ¤çä¸ååå­ç¼å²åºãåæ ¸ä¼éè¿epollæºå¶è§¦åäºä»¶ï¼éç¥Rediså®ä¾ï¼Rediså®ä¾åææ°æ®ä»åæ ¸çåå­ç¼å²åºæ·è´å°èªå·±çåå­ç©ºé´ï¼å¦ä¸å¾æç¤ºï¼\n\né£ä¹ï¼å¨CPUçNUMAæ¶æä¸ï¼å½ç½ç»ä¸­æ­å¤çç¨åºãRediså®ä¾åå«åCPUæ ¸ç»å®åï¼å°±ä¼æä¸ä¸ªæ½å¨çé£é©ï¼å¦æç½ç»ä¸­æ­å¤çç¨åºå Redis å®ä¾æ²¡æç»å®å°åä¸ CPU Socket ä¸ï¼é£ Redis è¯»åç½ç»æ°æ®æ¶ï¼å°±éè¦è·¨ CPU Socket è®¿é®åå­ï¼è¿ä¸ªè¿ç¨ä¼è±è´¹è¾å¤æ¶é´ãå¦ä¸å¾æç¤ºï¼\n\nä¸ºäºé¿å Redis è·¨ CPU Socket è®¿é®ï¼æä»¬æå¥½æç½ç»ä¸­æ­ç¨åºåRediså®ä¾ç»å¨åä¸ä¸ª CPU Socket ä¸ãå¦ä¸å¾æç¤ºï¼\n\nCPU Socket çç¼å·å¯ä»¥éè¿ lscpu å½ä»¤æ¥æ¥ç.åè®¾æ2ä¸ªCPU Socketï¼æ¯ä¸ªSocketä¸æ6ä¸ªç©çæ ¸ï¼æ¯ä¸ªç©çæ ¸åæ2ä¸ªé»è¾æ ¸ï¼æ»å±24ä¸ªé»è¾æ ¸ï¼\n\n$ lscpu\nArchitecture: x86_64\n...\nNUMA node0 CPU(s): 0-5,12-17\nNUMA node1 CPU(s): 6-11,18-23\n...\n\n\n1\n2\n3\n4\n5\n6\n\n * å¨CPUçNUMAæ¶æä¸ï¼å¯¹CPUæ ¸çç¼å·è§åï¼å¹¶ä¸æ¯åæä¸ä¸ªCPU Socketä¸­çææé»è¾æ ¸ç¼å®ï¼åå¯¹ä¸ä¸ä¸ªCPU Socketä¸­çé»è¾æ ¸ç¼ç ï¼èæ¯åç»æ¯ä¸ªCPU Socketä¸­æ¯ä¸ªç©çæ ¸çç¬¬ä¸ä¸ªé»è¾æ ¸ä¾æ¬¡ç¼å·ï¼åç»æ¯ä¸ªCPU Socketä¸­çç©çæ ¸çç¬¬äºä¸ªé»è¾æ ¸ä¾æ¬¡ç¼å·ã\n * å¯ä»¥çå°ï¼NUMA node0çCPUæ ¸ç¼å·æ¯0å°5ã12å°17ãå¶ä¸­ï¼0å°5æ¯node0ä¸ç6ä¸ªç©çæ ¸ä¸­çç¬¬ä¸ä¸ªé»è¾æ ¸çç¼å·ï¼12å°17æ¯ç¸åºç©çæ ¸ä¸­çç¬¬äºä¸ªé»è¾æ ¸ç¼å·ãNUMA node1çCPUæ ¸ç¼å·è§åånode0ä¸æ ·ã\n\nä¸è¿ï¼ç»æ ¸ä¹å­å¨ä¸å®çé£é©ãæ¥ä¸æ¥å°±æ¥äºè§£ä¸å®çæ½å¨é£é©ç¹åè§£å³æ¹æ¡ã\n\n\n# 2.4 ç»æ ¸çé£é©åè§£å³æ¹æ¡\n\nRedis é¤äºä¸»çº¿ç¨ä»¥å¤ï¼è¿æè®¸å¤å­è¿ç¨ååå°çº¿ç¨ï¼å½æä»¬æ Redis å®ä¾ç»æ ¸åï¼å¯è½ä¼å¯¼è´å­è¿ç¨ãåå°çº¿ç¨å Redis ä¸»çº¿ç¨ç«äº CPU èµæºï¼ä»èå¯¼è´ Redis è¯·æ±å»¶è¿å¢å ã\n\néå¯¹è¿ç§æåµæä¸¤ä¸ªè§£å³æ¹æ¡ï¼\n\n# æ¹æ¡ä¸ï¼ä¸ä¸ª Redis å®ä¾å¯¹åºç»ä¸ä¸ªç©çæ ¸\n\nå¨ç» Redis å®ä¾ç»æ ¸æ¶ï¼æä»¬ä¸è¦æä¸ä¸ªå®ä¾åä¸ä¸ªé»è¾æ ¸ç»å®ï¼èè¦åä¸ä¸ªç©çæ ¸ç»å®ï¼ä¹å°±æ¯è¯´ï¼æä¸ä¸ªç©çæ ¸ç 2 ä¸ªé»è¾æ ¸é½ç¨ä¸ã\n\næä»¬è¿æ¯ä»¥åæçNUMAæ¶æä¸ºä¾ï¼NUMA node0çCPUæ ¸ç¼å·æ¯0å°5ã12å°17ãå¶ä¸­ï¼ç¼å·0å12ã1å13ã2å14ç­é½æ¯è¡¨ç¤ºä¸ä¸ªç©çæ ¸ç2ä¸ªé»è¾æ ¸ãæä»¥ï¼å¨ç»æ ¸æ¶ï¼æä»¬ä½¿ç¨å±äºåä¸ä¸ªç©çæ ¸ç2ä¸ªé»è¾æ ¸è¿è¡ç»æ ¸æä½ãä¾å¦ï¼æä»¬æ§è¡ä¸é¢çå½ä»¤ï¼å°±æRediså®ä¾ç»å®å°äºé»è¾æ ¸0å12ä¸ï¼èè¿ä¸¤ä¸ªæ ¸æ­£å¥½é½å±äºç©çæ ¸1ã\n\ntaskset -c 0,12 ./redis-server\n\n\n1\n\n\nååªç»ä¸ä¸ªé»è¾æ ¸ç¸æ¯ï¼æ Redis å®ä¾åç©çæ ¸ç»å®ï¼å¯ä»¥è®©ä¸»çº¿ç¨ãå­è¿ç¨ãåå°çº¿ç¨å±äº«ä½¿ç¨2ä¸ªé»è¾æ ¸ï¼å¯ä»¥å¨ä¸å®ç¨åº¦ä¸ç¼è§£ CPU èµæºç«äºãä½æ¯ï¼å ä¸ºåªç¨äº 2 ä¸ªé»è¾æ ¸ï¼å®ä»¬ç¸äºä¹é´ç CPU ç«äºä»ç¶è¿ä¼å­å¨ãå¦æä½ è¿æ³è¿ä¸æ­¥åå° CPU ç«äºï¼è¿æå¦ä¸ç§æ¹æ¡ã\n\n# æ¹æ¡äºï¼ä¼å Redis æºç \n\n> è¿é¨ååªæ¯ç²ç¥çè¿äºä¸ä¸ã\n\nè¿ä¸ªæ¹æ¡å°±æ¯éè¿ä¿®æ¹Redisæºç ï¼æå­è¿ç¨ååå°çº¿ç¨ç»å°ä¸åçCPUæ ¸ä¸ã\n\nå¦æä½ å¯¹Redisçæºç ä¸å¤ªçæï¼ä¹æ²¡å³ç³»ï¼å ä¸ºè¿æ¯éè¿ç¼ç¨å®ç°ç»æ ¸çä¸ä¸ªéç¨åæ³ãå­¦ä¼äºè¿ä¸ªæ¹æ¡ï¼ä½ å¯ä»¥å¨çæäºæºç ä¹åæå®ç¨ä¸ï¼ä¹å¯ä»¥åºç¨å¨å¶ä»éè¦ç»æ ¸çåºæ¯ä¸­ã\n\næ¥ä¸æ¥ï¼æåä»ç»ä¸ä¸éç¨çåæ³ï¼ç¶åï¼åå·ä½è¯´è¯´å¯ä»¥æè¿ä¸ªåæ³å¯¹åºå°Redisçåªé¨åæºç ä¸­ã\n\néè¿ç¼ç¨å®ç°ç»æ ¸æ¶ï¼è¦ç¨å°æä½ç³»ç»æä¾ç1ä¸ªæ°æ®ç»æcpu_set_tå3ä¸ªå½æ°CPU_ZEROãCPU_SETåsched_setaffinityï¼æåæ¥è§£éä¸å®ä»¬ã\n\n * cpu_set_tæ°æ®ç»æï¼æ¯ä¸ä¸ªä½å¾ï¼æ¯ä¸ä½ç¨æ¥è¡¨ç¤ºæå¡å¨ä¸çä¸ä¸ªCPUé»è¾æ ¸ã\n * CPU_ZEROå½æ°ï¼ä»¥cpu_set_tç»æçä½å¾ä¸ºè¾å¥åæ°ï¼æä½å¾ä¸­ææçä½è®¾ç½®ä¸º0ã\n * CPU_SETå½æ°ï¼ä»¥CPUé»è¾æ ¸ç¼å·åcpu_set_tä½å¾ä¸ºåæ°ï¼æä½å¾ä¸­åè¾å¥çé»è¾æ ¸ç¼å·å¯¹åºçä½è®¾ç½®ä¸º1ã\n * sched_setaffinityå½æ°ï¼ä»¥è¿ç¨/çº¿ç¨IDå·åcpu_set_tä¸ºåæ°ï¼æ£æ¥cpu_set_tä¸­åªä¸ä½ä¸º1ï¼å°±æè¾å¥çIDå·æä»£è¡¨çè¿ç¨/çº¿ç¨ç»å¨å¯¹åºçé»è¾æ ¸ä¸ã\n\né£ä¹ï¼æä¹å¨ç¼ç¨æ¶æè¿ä¸ä¸ªå½æ°ç»åèµ·æ¥å®ç°ç»æ ¸å¢ï¼å¾ç®åï¼æä»¬ååæ­¥èµ°å°±è¡ã\n\n * ç¬¬ä¸æ­¥ï¼åå»ºä¸ä¸ªcpu_set_tç»æçä½å¾åéï¼\n * ç¬¬äºæ­¥ï¼ä½¿ç¨CPU_ZEROå½æ°ï¼æcpu_set_tç»æçä½å¾ææçä½é½è®¾ç½®ä¸º0ï¼\n * ç¬¬ä¸æ­¥ï¼æ ¹æ®è¦ç»å®çé»è¾æ ¸ç¼å·ï¼ä½¿ç¨CPU_SETå½æ°ï¼æcpu_set_tç»æçä½å¾ç¸åºä½è®¾ç½®ä¸º1ï¼\n * ç¬¬åæ­¥ï¼ä½¿ç¨sched_setaffinityå½æ°ï¼æç¨åºç»å®å¨cpu_set_tç»æä½å¾ä¸­ä¸º1çé»è¾æ ¸ä¸ã\n\nä¸é¢ï¼æå°±å·ä½ä»ç»ä¸ï¼åå«æåå°çº¿ç¨ãå­è¿ç¨ç»å°ä¸åçæ ¸ä¸çåæ³ã\n\nåè¯´åå°çº¿ç¨ãä¸ºäºè®©ä½ æ´å¥½å°çè§£ç¼ç¨å®ç°ç»æ ¸ï¼ä½ å¯ä»¥çä¸è¿æ®µç¤ºä¾ä»£ç ï¼å®å®ç°äºä¸ºçº¿ç¨ç»æ ¸çæä½ï¼\n\n//çº¿ç¨å½æ°\nvoid worker(int bind_cpu){\n    cpu_set_t cpuset;  //åå»ºä½å¾åé\n    CPU_ZERO(&cpu_set); //ä½å¾åéææä½è®¾ç½®0\n    CPU_SET(bind_cpu, &cpuset); //æ ¹æ®è¾å¥çbind_cpuç¼å·ï¼æä½å¾å¯¹åºä¸ºè®¾ç½®ä¸º1\n    sched_setaffinity(0, sizeof(cpuset), &cpuset); //æç¨åºç»å®å¨cpu_set_tç»æä½å¾ä¸­ä¸º1çé»è¾æ ¸\n    //å®éçº¿ç¨å½æ°å·¥ä½\n}\nint main(){\n    pthread_t pthread1\n    //æåå»ºçpthread1ç»å¨ç¼å·ä¸º3çé»è¾æ ¸ä¸\n    pthread_create(&pthread1, NULL, (void *)worker, 3);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¯¹äºRedisæ¥è¯´ï¼å®æ¯å¨bio.cæä»¶ä¸­çbioProcessBackgroundJobså½æ°ä¸­åå»ºäºåå°çº¿ç¨ãbioProcessBackgroundJobså½æ°ç±»ä¼¼äºååçä¾å­ä¸­çworkerå½æ°ï¼å¨è¿ä¸ªå½æ°ä¸­å®ç°ç»æ ¸åæ­¥æä½ï¼å°±å¯ä»¥æåå°çº¿ç¨ç»å°åä¸»çº¿ç¨ä¸åçæ ¸ä¸äºã\n\nåç»çº¿ç¨ç»æ ¸ç±»ä¼¼ï¼å½æä»¬ä½¿ç¨forkåå»ºå­è¿ç¨æ¶ï¼ä¹å¯ä»¥æååè¯´çåæ­¥æä½å®ç°å¨forkåçå­è¿ç¨ä»£ç ä¸­ï¼ç¤ºä¾ä»£ç å¦ä¸ï¼\n\nint main(){\n   //ç¨forkåå»ºä¸ä¸ªå­è¿ç¨\n   pid_t p = fork();\n   if(p < 0){\n      printf(" fork error\\n");\n   }\n   //å­è¿ç¨ä»£ç é¨å\n   else if(!p){\n      cpu_set_t cpuset;  //åå»ºä½å¾åé\n      CPU_ZERO(&cpu_set); //ä½å¾åéææä½è®¾ç½®0\n      CPU_SET(3, &cpuset); //æä½å¾çç¬¬3ä½è®¾ç½®ä¸º1\n      sched_setaffinity(0, sizeof(cpuset), &cpuset);  //æç¨åºç»å®å¨3å·é»è¾æ ¸\n      //å®éå­è¿ç¨å·¥ä½\n      exit(0);\n   }\n   ...\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nå¯¹äºRedisæ¥è¯´ï¼çæRDBåAOFæ¥å¿éåçå­è¿ç¨åå«æ¯ä¸é¢ä¸¤ä¸ªæä»¶çå½æ°ä¸­å®ç°çã\n\n * rdb.cæä»¶ï¼rdbSaveBackgroundå½æ°ï¼\n * aof.cæä»¶ï¼rewriteAppendOnlyFileBackgroundå½æ°ã\n\nè¿ä¸¤ä¸ªå½æ°ä¸­é½è°ç¨äºforkåå»ºå­è¿ç¨ï¼æä»¥ï¼æä»¬å¯ä»¥å¨å­è¿ç¨ä»£ç é¨åå ä¸ç»æ ¸çåæ­¥æä½ã\n\nä½¿ç¨æºç ä¼åæ¹æ¡ï¼æä»¬æ¢å¯ä»¥å®ç°Rediså®ä¾ç»æ ¸ï¼é¿ååæ¢æ ¸å¸¦æ¥çæ§è½å½±åï¼è¿å¯ä»¥è®©å­è¿ç¨ãåå°çº¿ç¨åä¸»çº¿ç¨ä¸å¨åä¸ä¸ªæ ¸ä¸è¿è¡ï¼é¿åäºå®ä»¬ä¹é´çCPUèµæºç«äºãç¸æ¯ä½¿ç¨tasksetç»æ ¸æ¥è¯´ï¼è¿ä¸ªæ¹æ¡å¯ä»¥è¿ä¸æ­¥éä½ç»æ ¸çé£é©ã\n\n\n# 2.5 å°ç»\n\nè¿ä¸èè®²äºä¸»æµç CPU æ¶æä»¥å NUMA æ¶æï¼å¹¶è§£éäº CPU å¯¹ Redis æ§è½çå½±åã\n\n * ç±äº CPU Socket ä¹é´çåæ¢ä¼å¢å å°¾å»¶è¿ï¼å æ­¤å»ºè®®æå®ä¾ä¸æä¸ªæ ¸è¿è¡ç»å®ã\n * ä¸ºæå Redis çç½ç»æ§è½ï¼ææ¶éè¦æç½ç»ä¸­æ­å¤çç¨åºå CPU æ ¸ç»å®ã\n * ä¸ºé²æ­¢ç»æ ¸å¯¼è´ Redis ä¸»çº¿ç¨ä¸å­è¿ç¨çç«äºï¼æ¬ææåºäºä¸¤ç§æ¹æ¡æ¥è§£å³ã\n\nRedis çä½å»¶è¿æ¯æä»¬æ°¸æçè¿½æ±ç®æ ï¼èå¤æ ¸ CPU å NUMA æ¶æå·²ç»æä¸ºäºç®åæå¡å¨çä¸»æµéç½®ãæä»¥ç»æ ¸ä¼åæ¹æ¡å¨å®è·µä¸­å¾éè¦ã\n\n----------------------------------------\n\n**æ¬èé®é¢ï¼**å¨ä¸å°æä¸¤ä¸ªCPU Socketï¼æ¯ä¸ªSocket 8ä¸ªç©çæ ¸ï¼çæå¡å¨ä¸ï¼æä»¬é¨ç½²äºä¸ä¸ªæç8ä¸ªå®ä¾çRedisåçéç¾¤ï¼8ä¸ªå®ä¾é½ä¸ºä¸»èç¹ï¼æ²¡æä¸»å¤å³ç³»ï¼ï¼ç°å¨æä¸¤ä¸ªæ¹æ¡ï¼\n\n 1. å¨åä¸ä¸ªCPU Socketä¸è¿è¡8ä¸ªå®ä¾ï¼å¹¶å8ä¸ªCPUæ ¸ç»å®ï¼\n 2. å¨ä¸¤ä¸ªCPU Socketä¸åè¿è¡4ä¸ªå®ä¾ï¼å¹¶åç¸åºSocketä¸çæ ¸ç»å®ã\n\nå¦æä¸èèç½ç»æ°æ®è¯»åçå½±åï¼ä½ ä¼éæ©åªä¸ªæ¹æ¡å¢ï¼\n\nç­æ¡ï¼å»ºè®®ä½¿ç¨ç¬¬äºä¸ªæ¹æ¡ï¼ä¸»è¦æä¸¤æ¹é¢çåå ã\n\n 1. åä¸ä¸ªCPU Socketä¸çè¿ç¨ï¼ä¼å±äº«L3ç¼å­ãå¦ææ8ä¸ªå®ä¾é½é¨ç½²å¨åä¸ä¸ªSocketä¸ï¼å®ä»¬ä¼ç«äºL3ç¼å­ï¼è¿å°±ä¼å¯¼è´å®ä»¬çL3ç¼å­å½ä¸­çéä½ï¼å½±åè®¿é®æ§è½ã\n\n 2. åä¸ä¸ªCPU Socketä¸çè¿ç¨ï¼ä¼ä½¿ç¨åä¸ä¸ªSocketä¸çåå­ç©ºé´ã8ä¸ªå®ä¾å±äº«åä¸ä¸ªSocketä¸çåå­ç©ºé´ï¼è¯å®ä¼ç«äºåå­èµæºãå¦ææå®ä¾ä¿å­çæ°æ®éå¤§ï¼å¶ä»å®ä¾è½ç¨å°çåå­ç©ºé´å¯è½å°±ä¸å¤äºï¼æ­¤æ¶ï¼å¶ä»å®ä¾å°±ä¼è·¨Socketç³è¯·åå­ï¼è¿èé æè·¨Socketè®¿é®åå­ï¼é æå®ä¾çæ§è½éä½ã\n\nå¦å¤ï¼å¨åçéç¾¤ä¸­ï¼ä¸åå®ä¾é´éè¿ç½ç»è¿è¡æ¶æ¯éä¿¡åæ°æ®è¿ç§»ï¼å¹¶ä¸ä¼ä½¿ç¨å±äº«åå­ç©ºé´è¿è¡è·¨å®ä¾çæ°æ®è®¿é®ãæä»¥ï¼å³ä½¿æä¸åçå®ä¾é¨ç½²å°ä¸åçSocketä¸ï¼å®ä»¬ä¹é´ä¹ä¸ä¼åçè·¨Socketåå­çè®¿é®ï¼ä¸ä¼åè·¨Socketåå­è®¿é®çè´é¢å½±åã',normalizedContent:'> åèï¼\n> \n>  * 16 å¼æ­¥æºå¶ï¼å¦ä½é¿ååçº¿ç¨æ¨¡åçé»å¡ï¼| æå®¢æ¶é´\n>  * 17 ä¸ºä»ä¹ cpu ç»æä¹ä¼å½±å redis çæ§è½ï¼| æå®¢æ¶é´\n\nredis å å¶é«æ§è½èè¢«å¹¿æ³åºç¨ï¼æä»¬éè¦é¿åæ§è½å¼å¸¸çæåµåºç°ãå½±å redis æ§è½ç 5 å¤§æ¹é¢å ç´ æï¼\n\n * redis åé¨çé»å¡å¼æä½\n * cpu æ ¸å numa æ¶æçå½±å\n * redis å³é®ç³»ç»éç½®\n * redis åå­ç¢ç\n * redis ç¼å²åº\n\næ¬æå°åæåä¸¤ä¸ªå ç´ ã\n\n\n# 1. å¼æ­¥æºå¶ï¼å¦ä½é¿ååçº¿ç¨æ¨¡åçé»å¡ï¼\n\n\n# 1.1 redis å®ä¾æåªäºé»å¡ç¹ï¼\n\næä»¬åé¢å­¦ä¹ è¿ï¼redis çç½ç» io åé®å¼å¯¹è¯»åæ¯ç±ä¸»çº¿ç¨å®æçï¼è¿äºä¸åçäº¤äºè¦æ¶åä¸åçæä½ãæä»¬çä¸ä¸ redis åä¸åå¯¹è±¡äº¤äºæ¶ï¼æåªäºäº¤äºæä½ï¼\n\n * å®¢æ·ç«¯ï¼ç½ç» ipãkv ç crud ç­\n * ç£çï¼aof ä¸ rdb æä½\n * ä¸»ä»èç¹ï¼æ°æ®å¤å¶æä½\n * åçéç¾¤ï¼åå¶ä»å®ä¾ä¼ è¾åå¸æ§½ä¿¡æ¯ãæ°æ®è¿ç§»\n\nè¿åç±»äº¤äºå¯¹è±¡åæä½ä¹é´çå³ç³»å¦ä¸å¾ï¼\n\nä¸é¢æä»¬éä¸ªåæåªäºæä½ä¼å¼èµ·é»å¡ï¼\n\n# 1ï¼åå®¢æ·ç«¯äº¤äºæ¶çé»å¡ç¹\n\nç±äº redis ä½¿ç¨äº io å¤è·¯å¤ç¨æºå¶é¿åäºä¸»çº¿ç¨çä¸ç´ç­å¾ï¼æä»¥ç½ç» io ä¸æ¯å¯¼è´ redis é»å¡çå ç´ ã\n\ncrud æä½æ¯ redis ä¸å®¢æ·ç«¯äº¤äºçä¸»è¦é¨åï¼ä¹æ¯ redis ä¸»çº¿ç¨æ§è¡çä¸»è¦ä»»å¡ãæä»¥ï¼å¤æåº¦é«çå¢å æ¹æ¥æä½è¯å®ä¼é»å¡ redisã\n\né£æä¹å¤æ­æä½å¤æåº¦é«ä¸é«å¢ï¼è¿éæä¸ä¸ªæåºæ¬çæ åï¼å°±æ¯çæä½çå¤æåº¦æ¯å¦ä¸º o(n)ã\n\nredis ä¸­æ¶åéåçæä½å¤æåº¦éå¸¸ä¸ºo(n)ï¼æä»¬è¦å¨ä½¿ç¨æ¶éè§èµ·æ¥ãä¾å¦éååç´ å¨éæ¥è¯¢æä½hgetallãsmembersï¼ä»¥åéåçèåç»è®¡æä½ï¼ä¾å¦æ±äº¤ãå¹¶åå·®éãè¿äºæä½å¯ä»¥ä½ä¸º redis çç¬¬ä¸ä¸ªé»å¡ç¹ï¼éåå¨éæ¥è¯¢åèåæä½ã\n\né¤æ­¤ä¹å¤ï¼éåèªèº«çå é¤æä½åæ ·ä¹ææ½å¨çé»å¡é£é©ãå ä¸ºå é¤æä½çæ¬è´¨æ¯è¦éæ¾é®å¼å¯¹å ç¨çåå­ç©ºé´ï¼èæä½ç³»ç»å¨éæ¾åå­æ¶éè¦ææéæ¾çåå­åæå¥ç©ºé²é¾è¡¨ä¸­ä»¥ä¾¿ç®¡çï¼è¿ä¸ªè¿ç¨å¯è½ä¼é»å¡ç¨åºãæä»¥ï¼å¦æä¸ä¸å­éæ¾äºå¤§éåå­ï¼ç©ºé²åå­åé¾è¡¨æä½æ¶é´å°±ä¼å¢å ï¼ç¸åºå°å°±ä¼é æ redis ä¸»çº¿ç¨çé»å¡ã\n\néæ¾å¤§éåå­çåºæ¯ï¼å°±æ¯å¨å é¤å¤§éé®å¼å¯¹æ°æ®æ¶ï¼æå¸åçå°±æ¯å é¤åå«äºå¤§éåç´ çéåï¼ä¹ç§°ä¸º bigkey å é¤ãä¸å¾æµè¯äºä¸ååç´ æ°éçéåè¿è¡å é¤æä½æèè´¹çæ¶é´ï¼\n\nä»è¿å¼ è¡¨éï¼æä»¬å¯ä»¥å¾åºä¸ä¸ªç»è®ºï¼\n\n 1. å½åç´ æ°éä»10ä¸å¢å å°100ä¸æ¶ï¼4å¤§éåç±»åçå é¤æ¶é´çå¢é¿å¹åº¦ä»5åä¸åå°äºè¿20åï¼\n 2. éååç´ è¶å¤§ï¼å é¤æè±è´¹çæ¶é´å°±è¶é¿ï¼\n 3. å½å é¤æ100ä¸ä¸ªåç´ çéåæ¶ï¼æå¤§çå é¤æ¶é´ç»å¯¹å¼å·²ç»è¾¾å°äº1.98sï¼hashç±»åï¼ãredisçååºæ¶é´ä¸è¬å¨å¾®ç§çº§å«ï¼æä»¥ï¼ä¸ä¸ªæä½è¾¾å°äºè¿2sï¼ä¸å¯é¿åå°ä¼é»å¡ä¸»çº¿ç¨ã\n\næä»¥ï¼bigkey å é¤æä½å°±æ¯ redis çç¬¬äºä¸ªé»å¡ç¹ãå é¤æä½å¯¹rediså®ä¾æ§è½çè´é¢å½±åå¾å¤§ï¼èä¸å¨å®éä¸å¡å¼åæ¶å®¹æè¢«å¿½ç¥ï¼æä»¥ä¸å®è¦éè§å®ã\n\nå°å»ºè®®\n\nå½éå° bigkey å é¤æ¶ï¼æä¸ä¸ªå°å»ºè®®ï¼åä½¿ç¨éåç±»åæä¾ç scan å½ä»¤è¯»åæ°æ®ï¼ç¶ååè¿è¡å é¤ãå ä¸ºç¨ scan å½ä»¤å¯ä»¥æ¯æ¬¡åªè¯»åä¸é¨åæ°æ®å¹¶è¿è¡å é¤ï¼è¿æ ·å¯ä»¥é¿åä¸æ¬¡æ§å é¤å¤§é key ç»ä¸»çº¿ç¨å¸¦æ¥çé»å¡ã\n\nä¾å¦ï¼å¯¹äº hash ç±»åç bigkey å é¤ï¼ä½ å¯ä»¥ä½¿ç¨ hscan å½ä»¤ï¼æ¯æ¬¡ä»hashéåä¸­è·åä¸é¨åé®å¼å¯¹ï¼ä¾å¦200ä¸ªï¼ï¼åä½¿ç¨ hdel å é¤è¿äºé®å¼å¯¹ï¼è¿æ ·å°±å¯ä»¥æå é¤åååæå°å¤æ¬¡æä½ä¸­ï¼é£ä¹ï¼æ¯æ¬¡å é¤æä½çèæ¶å°±ä¸ä¼å¤ªé¿ï¼ä¹å°±ä¸ä¼é»å¡ä¸»çº¿ç¨äºã\n\nå®¹æèæ³å°ï¼æ¸ç©ºæ°æ®åºï¼flushdb å flushall æä½ï¼ä¹å¿ç¶æ¯ä¸ä¸ªæ½å¨çé»å¡é£é©ï¼å ä¸ºå®ä»¬ä¹æ¶åå°å¤§é kv çå é¤ãæä»¥ï¼redis çç¬¬ä¸ä¸ªé»å¡ç¹ï¼æ¸ç©ºæ°æ®åºã\n\n# 2ï¼åç£çäº¤äºæ¶çé»å¡ç¹\n\nç±äºç£ç io ä¸è¬æ¯è¾æ¢ï¼å æ­¤éè¦éç¹å³æ³¨ãredis éç¨å­è¿ç¨çæ¹å¼æ¥æ§è¡ rdb ççæå aof çéåï¼ä»èé¿åäºå¯¹ä¸»çº¿ç¨çé»å¡ã\n\nä½ redis ç´æ¥è®°å½ aof æ¶ï¼ä¼æ ¹æ®ä¸åçååç­ç¥å¯¹æ°æ®åè½çä¿å­ãä¸æ¬¡åæ­¥åç£çå¤§çº¦èæ¶ 1~2msï¼å¦æå­å¨å¤§éåæ­¥åæä½çè¯ï¼å°±ä¼é»å¡ä¸»çº¿ç¨ãå æ­¤ redis çåä¸ªé»å¡ç¹ï¼aof æ¥å¿åæ­¥åã\n\n# 3ï¼ä¸»ä»èç¹äº¤äºæ¶çé»å¡ç¹\n\nå¨ä¸»ä»å¤å¶æ¶ï¼ä¸»åºåå»ºåä¼ è¾ rdb æä»¶é½æ¯ç±å­è¿ç¨å®æçï¼ä¸ä¼é»å¡ä¸»çº¿ç¨ï¼ä»åºæ¥æ¶ rdb æä»¶åï¼éè¦ä½¿ç¨ flushdb å½ä»¤æ¥æ¸ç©ºå½åæ°æ®åºï¼è¿æ­£å¥½è£ä¸äºåååæçç¬¬ä¸ä¸ªé»å¡ç¹ã\n\næ­¤å¤ï¼ä»åºå¨æ¸ç©ºæ°æ®åºåï¼è¿éè¦æ rdb å è½½å°åå­ä¸­ï¼è¿ä¸ªè¿ç¨ä¸ rdb æä»¶çå¤§å°å¯åç¸å³ï¼rdb è¶å¤§ï¼å è½½è¿ç¨è¶æ¢ãæä»¥ï¼å è½½ rdb æä»¶å°±æä¸ºäº redis çç¬¬äºä¸ªé»å¡ç¹ã\n\n# 4ï¼åçéç¾¤å®ä¾äº¤äºæ¶çé»å¡ç¹\n\næåï¼å½æä»¬é¨ç½²redisåçéç¾¤æ¶ï¼æ¯ä¸ªrediså®ä¾ä¸åéçåå¸æ§½ä¿¡æ¯éè¦å¨ä¸åå®ä¾é´è¿è¡ä¼ éï¼åæ¶ï¼å½éè¦è¿è¡è´è½½åè¡¡æèæå®ä¾å¢å æ¶ï¼æ°æ®ä¼å¨ä¸åçå®ä¾é´è¿è¡è¿ç§»ãä¸è¿ï¼åå¸æ§½çä¿¡æ¯éä¸å¤§ï¼èæ°æ®è¿ç§»æ¯æ¸è¿å¼æ§è¡çï¼æä»¥ï¼ä¸è¬æ¥è¯´ï¼è¿ä¸¤ç±»æä½å¯¹ redis ä¸»çº¿ç¨çé»å¡é£é©ä¸å¤§ã\n\nä¸è¿ï¼å¦æä½ ä½¿ç¨äº redis cluster æ¹æ¡ï¼èä¸åæ¶æ­£å¥½è¿ç§»çæ¯ bigkey çè¯ï¼å°±ä¼é æä¸»çº¿ç¨çé»å¡ï¼å ä¸º redis cluster ä½¿ç¨äºåæ­¥è¿ç§»ãæå°å¨ç¬¬33è®²ä¸­åä½ ä»ç»ä¸ååçéç¾¤æ¹æ¡å¯¹æ°æ®è¿ç§»é æçé»å¡çè§£å³æ¹æ³ï¼è¿éä½ åªéè¦ç¥éï¼å½æ²¡æ bigkey æ¶ï¼åçéç¾¤çåå®ä¾å¨è¿è¡äº¤äºæ¶ä¸ä¼é»å¡ä¸»çº¿ç¨ï¼å°±å¯ä»¥äºã\n\nç°å¨æä»¬æ»ç»ä¸ååæ¾å°çäºä¸ªé»å¡ç¹ï¼\n\n * éåå¨éæ¥è¯¢åèåæä½\n * bigkey å é¤\n * æ¸ç©ºæ°æ®åº\n * aof æ¥å¿åæ­¥å\n * ä»åºå è½½ rdb æä»¶\n\nå¦æå¨ä¸»çº¿ç¨ä¸­æ§è¡è¿äºæä½ï¼å¿ç¶ä¼å¯¼è´ä¸»çº¿ç¨é¿æ¶é´æ æ³æå¡å¶ä»è¯·æ±ãä¸ºäºé¿åé»å¡å¼æä½ï¼redis æä¾äºå¼æ­¥çº¿ç¨æºå¶ãæè°çå¼æ­¥çº¿ç¨æºå¶ï¼æ redis ä¼å¯å¨ä¸äºå­çº¿ç¨ï¼ç¶åæä¸äºä»»å¡äº¤ç»è¿äºå­çº¿ç¨ï¼è®©å®ä»¬å¨åå°å®æï¼èä¸åç±ä¸»çº¿ç¨æ¥æ§è¡è¿äºä»»å¡ãä½¿ç¨å¼æ­¥çº¿ç¨æºå¶æ§è¡æä½ï¼å¯ä»¥é¿åé»å¡ä¸»çº¿ç¨ã\n\nä¸è¿é®é¢æ¥äºï¼è¿äºä¸ªé»å¡å¼æä½é½å¯ä»¥è¢«å¼æ­¥æ§è¡åï¼\n\n\n# 1.2 åªäºé»å¡ç¹å¯ä»¥å¼æ­¥æ§è¡ï¼\n\nåçä¸ä¸å¼æ­¥æ§è¡å¯¹æä½çè¦æ±ã\n\nå¦æä¸ä¸ªæä½è½è¢«å¼æ­¥æ§è¡ï¼å°±æå³çï¼å®å¹¶ä¸æ¯ redis ä¸»çº¿ç¨çå³é®è·¯å¾ä¸çæä½ãå³é®è·¯å¾ä¸çæä½æ¯è¯´ï¼å®¢æ·ç«¯æè¯·æ±åç» redis åå°±ç­çè¿åæ°æ®ç»æãå¦ä¸å¾ï¼\n\n * å·¦å¾çæä½ 1 å°±ä¸ç®å³é®è·¯å¾ä¸çæä½ï¼å æ­¤å¯ä»¥è®©åå°å­çº¿ç¨æ¥å¼æ­¥æ§è¡ï¼\n * å³å¾çæä½ 2 å°±æ¯å³é®è·¯å¾ä¸çæä½ï¼æä»¥ä¸»çº¿ç¨å¿é¡»ç«å³æè¿ä¸ªæä½æ§è¡å®ã\n\nå¯¹ redis æ¥è¯´ï¼è¯»æä½æ¯å¸åçå³é®è·¯å¾æä½ãredis çç¬¬ä¸ä¸ªé»å¡ç¹âéåå¨éæ¥è¯¢åèåæä½âé½æ¶åå°äºè¯»æä½ï¼æä»¥ï¼å®ä»¬æ¯ä¸è½è¿è¡å¼æ­¥æä½äºã\n\nèå é¤æä½ä¸éè¦ç«å»è¿åå·ä½çç»æï¼ä¸ç®æ¯å³é®è·¯å¾æä½ï¼å æ­¤æä»¬å¯ä»¥ä½¿ç¨åå°å­çº¿ç¨æ¥å¼æ­¥æ§è¡å é¤æä½ãæç¬¬äºä¸ªåç¬¬ä¸ä¸ªé»å¡ç¹å¯ä»¥å¼æ­¥è§£å³ã\n\nå¯¹äºç¬¬åä¸ªé»å¡ç¹âaofæ¥å¿åæ­¥åâæ¥è¯´ï¼ä¸ºä¿è¯æ°æ®å¯é æ§ï¼redis å®ä¾éè¦ä¿è¯ aof æ¥å¿ä¸­çæä½è®°å½å·²ç»è½çï¼è¿ä¸ªæä½è½ç¶éè¦å®ä¾ç­å¾ï¼ä½å®å¹¶ä¸ä¼è¿åå·ä½çæ°æ®ç»æç»å®ä¾ãæä»¥ï¼æä»¬ä¹å¯ä»¥å¯å¨ä¸ä¸ªå­çº¿ç¨æ¥æ§è¡aofæ¥å¿çåæ­¥åï¼èä¸ç¨è®©ä¸»çº¿ç¨ç­å¾aofæ¥å¿çåå®æã\n\næååçä¸âä»åºå è½½ rdb æä»¶âè¿ç¬¬äºä¸ªé»å¡ç¹ãä»åºå¿é¡»æ rdb å è½½å®ï¼è¿æä½ä¹å±äºå³é®è·¯å¾ä¸çæä½ï¼æä»¥æä»¬å¿é¡»è®©ä»åºçä¸»çº¿ç¨æ¥æ§è¡ã\n\nå¯¹äº redis çäºå¤§é»å¡ç¹æ¥è¯´ï¼é¤äºâéåå¨éæ¥è¯¢åèåæä½âåâä»åºå è½½ rdb æä»¶âï¼å¶ä»ä¸ä¸ªé»å¡ç¹æ¶åçæä½é½ä¸å¨å³é®è·¯å¾ä¸ï¼æä»¥å¯ä»¥ä½¿ç¨ redis çå¼æ­¥å­çº¿ç¨æºå¶æ¥å®ç° bigkey å é¤ï¼æ¸ç©ºæ°æ®åºï¼ä»¥å aof æ¥å¿åæ­¥åã\n\nå°å»ºè®®\n\néåå¨éæ¥è¯¢åèåæä½ãä»åºå è½½rdbæä»¶æ¯å¨å³é®è·¯å¾ä¸ï¼æ æ³ä½¿ç¨å¼æ­¥æä½æ¥å®æãå¯¹äºè¿ä¸¤ä¸ªé»å¡ç¹ä¹æä¸¤ä¸ªå°å»ºè®®ï¼\n\n * éåå¨éæ¥è¯¢åèåæä½ï¼å¯ä»¥ä½¿ç¨ scan å½ä»¤ï¼åæ¹è¯»åæ°æ®ï¼åå¨å®¢æ·ç«¯è¿è¡èåè®¡ç®ï¼\n * ä»åºå è½½ rdb æä»¶ï¼æä¸»åºçæ°æ®éå¤§å°æ§å¶å¨ 2~4gb å·¦å³ï¼ä»¥ä¿è¯ rdb æä»¶è½ä»¥è¾å¿«çéåº¦å è½½ã\n\né£ redis å®ç°çå¼æ­¥å­çº¿ç¨æºå¶å·ä½æ¯æä¹æ§è¡å¢ï¼\n\n\n# 1.3 å¼æ­¥çå­çº¿ç¨æºå¶\n\nredis ä¸»çº¿ç¨å¯å¨åï¼ä¼ä½¿ç¨æä½ç³»ç»æä¾ç pthread_create å½æ°åå»º 3 ä¸ªå­çº¿ç¨ï¼åå«ç±å®ä»¬è´è´£ aof æ¥å¿åæä½ãé®å¼å¯¹å é¤ä»¥åæä»¶å³é­çå¼æ­¥æ§è¡ã\n\nä¸»çº¿ç¨éè¿ä¸ä¸ªé¾è¡¨å½¢å¼çä»»å¡éååå­çº¿ç¨è¿è¡äº¤äºãå½æ¶å°é®å¼å¯¹å é¤åæ¸ç©ºæ°æ®åºçæä½æ¶ï¼ä¸»çº¿ç¨ä¼æè¿ä¸ªæä½å°è£æä¸ä¸ªä»»å¡ï¼æ¾å¥å°ä»»å¡éåä¸­ï¼ç¶åç»å®¢æ·ç«¯è¿åä¸ä¸ªå®æä¿¡æ¯ï¼è¡¨æå é¤å·²ç»å®æãä½å®éä¸ï¼è¿ä¸ªæ¶åå é¤è¿æ²¡ææ§è¡ï¼ç­å°åå°å­çº¿ç¨ä»ä»»å¡éåä¸­è¯»åä»»å¡åï¼æå¼å§å®éå é¤é®å¼å¯¹ï¼å¹¶éæ¾ç¸åºçåå­ç©ºé´ãå æ­¤ï¼æä»¬æè¿ç§å¼æ­¥å é¤ä¹ç§°ä¸ºæ°æ§å é¤ï¼lazy freeï¼ãæ­¤æ¶ï¼å é¤ææ¸ç©ºæä½ä¸ä¼é»å¡ä¸»çº¿ç¨ï¼è¿å°±é¿åäºå¯¹ä¸»çº¿ç¨çæ§è½å½±åã\n\nåæ°æ§å é¤ç±»ä¼¼ï¼å½ aof æ¥å¿éç½®æ everysec éé¡¹åï¼ä¸»çº¿ç¨ä¼æ aof åæ¥å¿æä½å°è£æä¸ä¸ªä»»å¡ï¼ä¹æ¾å°ä»»å¡éåä¸­ãåå°å­çº¿ç¨è¯»åä»»å¡åï¼å¼å§èªè¡åå¥ aof æ¥å¿ï¼è¿æ ·ä¸»çº¿ç¨å°±ä¸ç¨ä¸ç´ç­å¾ aof æ¥å¿åå®äºã\n\nä¸é¢è¿å¼ å¾å±ç¤ºäº redis ä¸­çå¼æ­¥å­çº¿ç¨æ§è¡æºå¶ï¼\n\nå¼æ­¥çé®å¼å¯¹å é¤åæ°æ®åºæ¸ç©ºæä½æ¯ redis 4.0 åæä¾çåè½ï¼redisä¹æä¾äºæ°çå½ä»¤æ¥æ§è¡è¿ä¸¤ä¸ªæä½ï¼\n\n * é®å¼å¯¹å é¤ï¼å½ä½ çéåç±»åä¸­æå¤§éåç´ ï¼ä¾å¦æç¾ä¸çº§å«æåä¸çº§å«åç´ ï¼éè¦å é¤æ¶ï¼æå»ºè®®ä½ ä½¿ç¨ unlink å½ä»¤ã\n * æ¸ç©ºæ°æ®åºï¼å¯ä»¥å¨ flushdb å flushall å½ä»¤åå ä¸ async éé¡¹ï¼è¿æ ·å°±å¯ä»¥è®©åå°å­çº¿ç¨å¼æ­¥å°æ¸ç©ºæ°æ®åºï¼å¦ä¸æç¤ºï¼\n\nflushdb async\nflushall aysnc\n\n\n1\n2\n\n\n\n# 1.4 å°ç»\n\nè¿ä¸èä¸»è¦è®²äº redis è¿è¡æ¶çäº¤äºå¯¹è±¡åäº¤äºæä½ï¼å¹¶å¯¹å¶ä¸­ä¸å±äºå³é®è·¯å¾çæä½è®²è§£ä½¿ç¨å¼æ­¥å­çº¿ç¨æºå¶æ¥å®æã\n\n\n# 2. ä¸ºä»ä¹ cpu ç»æä¹ä¼å½±å redis çæ§è½ï¼\n\ncpu çæ¶æï¼cpu çå¤æ ¸æ¶æä»¥åå¤ cpu æ¶æï¼ä¹ä¼å½±å redis çæ§è½ï¼äºè§£è¿äºå¯¹æä»¬çæ§è½è°ä¼æå¾å¤å¸®å©ã\n\nè¿ä¸èä¸»è¦å­¦ä¹ ç®åä¸»æµ cpu æ¶æä»¥ååºäºæ­¤ä¼å redis æ§è½çæ¹æ³ã\n\n\n# 2.1 ä¸»æµç cpu æ¶æ\n\nä¸ä¸ª cpu ä¸è¬ç±å¤ä¸ªç©çæ ¸ï¼æ¯ä¸ªæ ¸é½å¯ä»¥è¿è¡ç¨åºï¼æ¯ä¸ªæ ¸é½æ¥æç§æç l1 cache åç§æç l2 cacheãæ³¨æï¼æ¯ä¸ªç©çæ ¸çç§æ cache åªè½è¢«å½åç©çæ ¸ä½¿ç¨ãå½æ°æ®ææä»¤ä¿å­å¨ l1 æ l2 cache ä¸­æ¶ï¼ç©çæ ¸å¯¹å®ä»¬çè®¿é®å»¶è¿ä¸è¶è¿ 10 çº³ç§ï¼éåº¦éå¸¸å¿«ã\n\nå¦æ redis è½ææä»¤ææ°æ®å­å¨ç©çæ ¸ cache ä¸­ï¼å°±è½é«éè®¿é®ãä½è¿äº cache ä¸è¬åªæ kb çº§å«ï¼æ¾ä¸ä¸å¤ªå¤æ°æ®ãè¥ cache ä¸å½ä¸­ï¼åéè¦è®¿é®åå­ï¼èè®¿å­çå»¶è¿ä¸è¬æ¯è®¿é® cache ç 10 åï¼ä¸å¯é¿åå°ä¼å¯¹æ§è½é æå½±åã\n\næä»¥ï¼ä¸åçç©çæ ¸è¿ä¼å±äº«ä¸ä¸ªå±åç l3 cacheãl3 cache å¾å¾è¾å¤§ï¼è½è¾¾å°å  mb å°å å mbï¼ä»èå°½å¯è½é¿åè®¿é®åå­ã\n\nå¦å¤ï¼ç°å¨ä¸»æµç cpu ä¸­ï¼æ¯ä¸ªç©çæ ¸éå¸¸é½ä¼è¿è¡ä¸¤ä¸ªè¶çº¿ç¨ï¼ä¹å«ä½é»è¾æ ¸ãåä¸ä¸ªç©çæ ¸çé»è¾æ ¸ä¼å±äº«ä½¿ç¨ l1ãl2 ç¼å­ã\n\nä¸å¾å±ç¤ºäºç©çæ ¸ãé»è¾æ ¸ãcache ä¹é´çå³ç³»ï¼\n\nåæ¶ï¼ä¸ºäºæåæå¡å¨çå¤çè½åï¼æå¡å¨è¿å¾å¾ä¼æå¤ä¸ª cpu å¤çå¨ï¼ä¹ç§°å¤ cpu socketï¼æ¯ä¸ª cpu socket æèªå·±çç©çæ ¸ãl3 cache ä»¥åè¿æ¥åå­ï¼ä¸ç¨ cpu socket ä¹é´éè¿æ»çº¿è¿æ¥ãå¦ä¸å¾æç¤ºï¼\n\n> ä¸ä¸ª cpu å°±æ¯ä¸ä¸ª cpu socket -- > å¤ cpu æ¶æï¼ ä¸ä¸ª cpu å¯ä»¥æå¤ä¸ªç©çæ ¸ï¼ä¸ä¸ªç©çæ ¸å¯ä»¥æå¤ä¸ªé»è¾æ ¸ -- > cpu å¤æ ¸æ¶æã\n\nå¨å¤cpuæ¶æä¸ï¼åºç¨ç¨åºå¯ä»¥å¨ä¸åçå¤çå¨ä¸è¿è¡ãå¨åæçå¾ä¸­ï¼redis å¯ä»¥åå¨ socket 1 ä¸è¿è¡ä¸æ®µæ¶é´ï¼ç¶ååè¢«è°åº¦å° socket 2 ä¸è¿è¡ãä½å½ç¨åºè¢«è°åº¦å° socket 2 åï¼åè®¿é®åå­å°±éè¦è®¿é®ä¹å socket ä¸è¿æ¥çåå­ï¼è¿ç§è®¿é®å±äºè¿ç«¯åå­è®¿é®ãç¸æ¯è®¿é®ç´æ¥è¿æ¥çåå­ï¼è¿ç«¯åå­è®¿é®ä¼å¢å å»¶è¿ãå¨å¤cpuæ¶æä¸ï¼ä¸ä¸ªåºç¨ç¨åºè®¿é®æå¨ socket çæ¬å°åå­åè®¿é®è¿ç«¯åå­çå»¶è¿å¹¶ä¸ä¸è´ï¼æä»¥ï¼æä»¬ä¹æè¿ä¸ªæ¶æç§°ä¸ºéç»ä¸åå­è®¿é®æ¶æï¼non-uniform memory accessï¼numa æ¶æï¼ã\n\nå°è¿éï¼æä»¬å°±ç¥éäºä¸»æµç cpu å¤æ ¸æ¶æåå¤ cpu æ¶æï¼æä»¬æ¥ç®åæ»ç»ä¸ cpu æ¶æå¯¹åºç¨ç¨åºè¿è¡çå½±åï¼\n\n * ååå©ç¨ l1ãl2 cache å¯ä»¥ææç¼©ç­åºç¨ç¨åºçæ§è¡æ¶é´ã\n * å¨ numa æ¶æä¸ï¼è¿ç«¯åå­è®¿é®çæåµä¹ä¼å¢å ç¨åºçæ§è¡æ¶é´ã\n\næ¥ä¸æ¥çä¸ä¸ cpu å¤æ ¸æ¯å¦ä½å½±å redis æ§è½çã\n\n\n# 2.2 cpu å¤æ ¸å¯¹ redis æ§è½çå½±å\n\nå¨ä¸ä¸ªcpuæ ¸ä¸è¿è¡æ¶ï¼åºç¨ç¨åºéè¦è®°å½èªèº«ä½¿ç¨çè½¯ç¡¬ä»¶èµæºä¿¡æ¯ï¼ä¾å¦æ æéãcpuæ ¸çå¯å­å¨å¼ç­ï¼ï¼æä»¬æè¿äºä¿¡æ¯ç§°ä¸º è¿è¡æ¶ä¿¡æ¯ãåæ¶ï¼åºç¨ç¨åºè®¿é®æé¢ç¹çæä»¤åæ°æ®è¿ä¼è¢«ç¼å­å°l1ãl2ç¼å­ä¸ï¼ä»¥ä¾¿æåæ§è¡éåº¦ãä½å¨å¤æ ¸cpuçåºæ¯ä¸ï¼ä¸æ¦ç¨åºéè¦å¨æ°çcpuæ ¸ä¸è¿è¡æ¶ï¼é£è¿è¡æ¶ä¿¡æ¯å°±éè¦éæ°å è½½å°æ°çcpuæ ¸ä¸ãèä¸ï¼æ°çcpuæ ¸çl1ãl2ç¼å­ä¹éè¦éæ°å è½½æ°æ®åæä»¤ï¼è¿ä¼å¯¼è´ç¨åºçè¿è¡æ¶é´å¢å ã\n\nç¨åºå¨ä¸å cpu æ ¸ä¸åæ¢æ¶ï¼ä¼åçè¿è¡æ¶ä¸ä¸æçéæ°å è½½ï¼ä»èå¯¼è´å»¶è¿ã\n\nä½èå°±ç»åè¿ç±äº context switchï¼çº¿ç¨çä¸ä¸æåæ¢ï¼å¯¼è´ redis ç 99% å°¾å»¶è¿è¿å¤§ã\n\n> 99% å°¾å»¶è¿ï¼æä»¬æææè¯·æ±çå¤çå»¶è¿ä»å°å°å¤§æä¸ªåºï¼99%çè¯·æ±å»¶è¿å°äºçå¼å°±æ¯99%å°¾å»¶è¿ãæ¯å¦è¯´ï¼æä»¬æ1000ä¸ªè¯·æ±ï¼åè®¾æè¯·æ±å»¶è¿ä»å°å°å¤§æåºåï¼ç¬¬991ä¸ªè¯·æ±çå»¶è¿å®æµå¼æ¯1msï¼èå990ä¸ªè¯·æ±çå»¶è¿é½å°äº1msï¼æä»¥ï¼è¿éç99%å°¾å»¶è¿å°±æ¯1msã\n\nå¦ææ³é¿å redis æ»æ¯å¨ä¸å cpu æ ¸ä¸æ¥åè°åº¦ï¼å¯ä»¥ä½¿ç¨ taskset å½ä»¤æä¸ä¸ªç¨åºç»å®å¨ä¸ä¸ªæ ¸ä¸è¿è¡ï¼å³ç»æ ¸ãæ¯å¦ä¸é¢è¿æ¡å½ä»¤æ redis å®ä¾ç»å¨äº 0 å·æ ¸ä¸ï¼å¶ä¸­ï¼â-câéé¡¹ç¨äºè®¾ç½®è¦ç»å®çæ ¸ç¼å·ï¼\n\ntaskset -c 0 ./redis-server\n\n\n1\n\n\nä¸è¡¨å¯¹æ¯äºç»æ ¸ååçredisç99%å°¾å»¶è¿ï¼\n\nç»æ ¸ä¸ä»å¯¹éä½å°¾å»¶è¿æå¥½å¤ï¼åæ ·ä¹è½éä½å¹³åå»¶è¿ãæåååçï¼è¿èæå redis æ§è½ã\n\n\n# 2.3 cpu ç numa æ¶æå¯¹ redis æ§è½çå½±å\n\nå®éåºç¨ä¸­ï¼ç»å¸¸çå°ä¸ç§è¯´æ³ï¼ä¸ºäºæå redis çç½ç»æ§è½ï¼ææä½ç³»ç»çç½ç»ä¸­æ­å¤çç¨åºå cpu æ ¸ç»å®ãè¿ä¸ªåæ³å¯ä»¥é¿åç½ç»ä¸­æ­å¤çç¨åºå¨ä¸åæ ¸ä¸æ¥åè°åº¦æ§è¡ï¼çç¡®è½æææå redis çç½ç»å¤çæ§è½ãä½æ¯ï¼ç½ç»ä¸­æ­ç¨åºæ¯è¦å redis å®ä¾è¿è¡ç½ç»æ°æ®äº¤äºçï¼ä¸æ¦æç½ç»ä¸­æ­ç¨åºç»æ ¸åï¼æä»¬å°±éè¦æ³¨æ redis å®ä¾æ¯ç»å¨åªä¸ªæ ¸ä¸äºï¼è¿ä¼å³ç³»å° redis è®¿é®ç½ç»æ°æ®çæçé«ä½ã\n\næä»¬åæ¥çä¸rediså®ä¾åç½ç»ä¸­æ­ç¨åºçæ°æ®äº¤äºï¼ç½ç»ä¸­æ­å¤çç¨åºä»ç½å¡ç¡¬ä»¶ä¸­è¯»åæ°æ®ï¼å¹¶ææ°æ®åå¥å°æä½ç³»ç»åæ ¸ç»´æ¤çä¸ååå­ç¼å²åºãåæ ¸ä¼éè¿epollæºå¶è§¦åäºä»¶ï¼éç¥rediså®ä¾ï¼rediså®ä¾åææ°æ®ä»åæ ¸çåå­ç¼å²åºæ·è´å°èªå·±çåå­ç©ºé´ï¼å¦ä¸å¾æç¤ºï¼\n\né£ä¹ï¼å¨cpuçnumaæ¶æä¸ï¼å½ç½ç»ä¸­æ­å¤çç¨åºãrediså®ä¾åå«åcpuæ ¸ç»å®åï¼å°±ä¼æä¸ä¸ªæ½å¨çé£é©ï¼å¦æç½ç»ä¸­æ­å¤çç¨åºå redis å®ä¾æ²¡æç»å®å°åä¸ cpu socket ä¸ï¼é£ redis è¯»åç½ç»æ°æ®æ¶ï¼å°±éè¦è·¨ cpu socket è®¿é®åå­ï¼è¿ä¸ªè¿ç¨ä¼è±è´¹è¾å¤æ¶é´ãå¦ä¸å¾æç¤ºï¼\n\nä¸ºäºé¿å redis è·¨ cpu socket è®¿é®ï¼æä»¬æå¥½æç½ç»ä¸­æ­ç¨åºårediså®ä¾ç»å¨åä¸ä¸ª cpu socket ä¸ãå¦ä¸å¾æç¤ºï¼\n\ncpu socket çç¼å·å¯ä»¥éè¿ lscpu å½ä»¤æ¥æ¥ç.åè®¾æ2ä¸ªcpu socketï¼æ¯ä¸ªsocketä¸æ6ä¸ªç©çæ ¸ï¼æ¯ä¸ªç©çæ ¸åæ2ä¸ªé»è¾æ ¸ï¼æ»å±24ä¸ªé»è¾æ ¸ï¼\n\n$ lscpu\narchitecture: x86_64\n...\nnuma node0 cpu(s): 0-5,12-17\nnuma node1 cpu(s): 6-11,18-23\n...\n\n\n1\n2\n3\n4\n5\n6\n\n * å¨cpuçnumaæ¶æä¸ï¼å¯¹cpuæ ¸çç¼å·è§åï¼å¹¶ä¸æ¯åæä¸ä¸ªcpu socketä¸­çææé»è¾æ ¸ç¼å®ï¼åå¯¹ä¸ä¸ä¸ªcpu socketä¸­çé»è¾æ ¸ç¼ç ï¼èæ¯åç»æ¯ä¸ªcpu socketä¸­æ¯ä¸ªç©çæ ¸çç¬¬ä¸ä¸ªé»è¾æ ¸ä¾æ¬¡ç¼å·ï¼åç»æ¯ä¸ªcpu socketä¸­çç©çæ ¸çç¬¬äºä¸ªé»è¾æ ¸ä¾æ¬¡ç¼å·ã\n * å¯ä»¥çå°ï¼numa node0çcpuæ ¸ç¼å·æ¯0å°5ã12å°17ãå¶ä¸­ï¼0å°5æ¯node0ä¸ç6ä¸ªç©çæ ¸ä¸­çç¬¬ä¸ä¸ªé»è¾æ ¸çç¼å·ï¼12å°17æ¯ç¸åºç©çæ ¸ä¸­çç¬¬äºä¸ªé»è¾æ ¸ç¼å·ãnuma node1çcpuæ ¸ç¼å·è§åånode0ä¸æ ·ã\n\nä¸è¿ï¼ç»æ ¸ä¹å­å¨ä¸å®çé£é©ãæ¥ä¸æ¥å°±æ¥äºè§£ä¸å®çæ½å¨é£é©ç¹åè§£å³æ¹æ¡ã\n\n\n# 2.4 ç»æ ¸çé£é©åè§£å³æ¹æ¡\n\nredis é¤äºä¸»çº¿ç¨ä»¥å¤ï¼è¿æè®¸å¤å­è¿ç¨ååå°çº¿ç¨ï¼å½æä»¬æ redis å®ä¾ç»æ ¸åï¼å¯è½ä¼å¯¼è´å­è¿ç¨ãåå°çº¿ç¨å redis ä¸»çº¿ç¨ç«äº cpu èµæºï¼ä»èå¯¼è´ redis è¯·æ±å»¶è¿å¢å ã\n\néå¯¹è¿ç§æåµæä¸¤ä¸ªè§£å³æ¹æ¡ï¼\n\n# æ¹æ¡ä¸ï¼ä¸ä¸ª redis å®ä¾å¯¹åºç»ä¸ä¸ªç©çæ ¸\n\nå¨ç» redis å®ä¾ç»æ ¸æ¶ï¼æä»¬ä¸è¦æä¸ä¸ªå®ä¾åä¸ä¸ªé»è¾æ ¸ç»å®ï¼èè¦åä¸ä¸ªç©çæ ¸ç»å®ï¼ä¹å°±æ¯è¯´ï¼æä¸ä¸ªç©çæ ¸ç 2 ä¸ªé»è¾æ ¸é½ç¨ä¸ã\n\næä»¬è¿æ¯ä»¥åæçnumaæ¶æä¸ºä¾ï¼numa node0çcpuæ ¸ç¼å·æ¯0å°5ã12å°17ãå¶ä¸­ï¼ç¼å·0å12ã1å13ã2å14ç­é½æ¯è¡¨ç¤ºä¸ä¸ªç©çæ ¸ç2ä¸ªé»è¾æ ¸ãæä»¥ï¼å¨ç»æ ¸æ¶ï¼æä»¬ä½¿ç¨å±äºåä¸ä¸ªç©çæ ¸ç2ä¸ªé»è¾æ ¸è¿è¡ç»æ ¸æä½ãä¾å¦ï¼æä»¬æ§è¡ä¸é¢çå½ä»¤ï¼å°±ærediså®ä¾ç»å®å°äºé»è¾æ ¸0å12ä¸ï¼èè¿ä¸¤ä¸ªæ ¸æ­£å¥½é½å±äºç©çæ ¸1ã\n\ntaskset -c 0,12 ./redis-server\n\n\n1\n\n\nååªç»ä¸ä¸ªé»è¾æ ¸ç¸æ¯ï¼æ redis å®ä¾åç©çæ ¸ç»å®ï¼å¯ä»¥è®©ä¸»çº¿ç¨ãå­è¿ç¨ãåå°çº¿ç¨å±äº«ä½¿ç¨2ä¸ªé»è¾æ ¸ï¼å¯ä»¥å¨ä¸å®ç¨åº¦ä¸ç¼è§£ cpu èµæºç«äºãä½æ¯ï¼å ä¸ºåªç¨äº 2 ä¸ªé»è¾æ ¸ï¼å®ä»¬ç¸äºä¹é´ç cpu ç«äºä»ç¶è¿ä¼å­å¨ãå¦æä½ è¿æ³è¿ä¸æ­¥åå° cpu ç«äºï¼è¿æå¦ä¸ç§æ¹æ¡ã\n\n# æ¹æ¡äºï¼ä¼å redis æºç \n\n> è¿é¨ååªæ¯ç²ç¥çè¿äºä¸ä¸ã\n\nè¿ä¸ªæ¹æ¡å°±æ¯éè¿ä¿®æ¹redisæºç ï¼æå­è¿ç¨ååå°çº¿ç¨ç»å°ä¸åçcpuæ ¸ä¸ã\n\nå¦æä½ å¯¹redisçæºç ä¸å¤ªçæï¼ä¹æ²¡å³ç³»ï¼å ä¸ºè¿æ¯éè¿ç¼ç¨å®ç°ç»æ ¸çä¸ä¸ªéç¨åæ³ãå­¦ä¼äºè¿ä¸ªæ¹æ¡ï¼ä½ å¯ä»¥å¨çæäºæºç ä¹åæå®ç¨ä¸ï¼ä¹å¯ä»¥åºç¨å¨å¶ä»éè¦ç»æ ¸çåºæ¯ä¸­ã\n\næ¥ä¸æ¥ï¼æåä»ç»ä¸ä¸éç¨çåæ³ï¼ç¶åï¼åå·ä½è¯´è¯´å¯ä»¥æè¿ä¸ªåæ³å¯¹åºå°redisçåªé¨åæºç ä¸­ã\n\néè¿ç¼ç¨å®ç°ç»æ ¸æ¶ï¼è¦ç¨å°æä½ç³»ç»æä¾ç1ä¸ªæ°æ®ç»æcpu_set_tå3ä¸ªå½æ°cpu_zeroãcpu_setåsched_setaffinityï¼æåæ¥è§£éä¸å®ä»¬ã\n\n * cpu_set_tæ°æ®ç»æï¼æ¯ä¸ä¸ªä½å¾ï¼æ¯ä¸ä½ç¨æ¥è¡¨ç¤ºæå¡å¨ä¸çä¸ä¸ªcpué»è¾æ ¸ã\n * cpu_zeroå½æ°ï¼ä»¥cpu_set_tç»æçä½å¾ä¸ºè¾å¥åæ°ï¼æä½å¾ä¸­ææçä½è®¾ç½®ä¸º0ã\n * cpu_setå½æ°ï¼ä»¥cpué»è¾æ ¸ç¼å·åcpu_set_tä½å¾ä¸ºåæ°ï¼æä½å¾ä¸­åè¾å¥çé»è¾æ ¸ç¼å·å¯¹åºçä½è®¾ç½®ä¸º1ã\n * sched_setaffinityå½æ°ï¼ä»¥è¿ç¨/çº¿ç¨idå·åcpu_set_tä¸ºåæ°ï¼æ£æ¥cpu_set_tä¸­åªä¸ä½ä¸º1ï¼å°±æè¾å¥çidå·æä»£è¡¨çè¿ç¨/çº¿ç¨ç»å¨å¯¹åºçé»è¾æ ¸ä¸ã\n\né£ä¹ï¼æä¹å¨ç¼ç¨æ¶æè¿ä¸ä¸ªå½æ°ç»åèµ·æ¥å®ç°ç»æ ¸å¢ï¼å¾ç®åï¼æä»¬ååæ­¥èµ°å°±è¡ã\n\n * ç¬¬ä¸æ­¥ï¼åå»ºä¸ä¸ªcpu_set_tç»æçä½å¾åéï¼\n * ç¬¬äºæ­¥ï¼ä½¿ç¨cpu_zeroå½æ°ï¼æcpu_set_tç»æçä½å¾ææçä½é½è®¾ç½®ä¸º0ï¼\n * ç¬¬ä¸æ­¥ï¼æ ¹æ®è¦ç»å®çé»è¾æ ¸ç¼å·ï¼ä½¿ç¨cpu_setå½æ°ï¼æcpu_set_tç»æçä½å¾ç¸åºä½è®¾ç½®ä¸º1ï¼\n * ç¬¬åæ­¥ï¼ä½¿ç¨sched_setaffinityå½æ°ï¼æç¨åºç»å®å¨cpu_set_tç»æä½å¾ä¸­ä¸º1çé»è¾æ ¸ä¸ã\n\nä¸é¢ï¼æå°±å·ä½ä»ç»ä¸ï¼åå«æåå°çº¿ç¨ãå­è¿ç¨ç»å°ä¸åçæ ¸ä¸çåæ³ã\n\nåè¯´åå°çº¿ç¨ãä¸ºäºè®©ä½ æ´å¥½å°çè§£ç¼ç¨å®ç°ç»æ ¸ï¼ä½ å¯ä»¥çä¸è¿æ®µç¤ºä¾ä»£ç ï¼å®å®ç°äºä¸ºçº¿ç¨ç»æ ¸çæä½ï¼\n\n//çº¿ç¨å½æ°\nvoid worker(int bind_cpu){\n    cpu_set_t cpuset;  //åå»ºä½å¾åé\n    cpu_zero(&cpu_set); //ä½å¾åéææä½è®¾ç½®0\n    cpu_set(bind_cpu, &cpuset); //æ ¹æ®è¾å¥çbind_cpuç¼å·ï¼æä½å¾å¯¹åºä¸ºè®¾ç½®ä¸º1\n    sched_setaffinity(0, sizeof(cpuset), &cpuset); //æç¨åºç»å®å¨cpu_set_tç»æä½å¾ä¸­ä¸º1çé»è¾æ ¸\n    //å®éçº¿ç¨å½æ°å·¥ä½\n}\nint main(){\n    pthread_t pthread1\n    //æåå»ºçpthread1ç»å¨ç¼å·ä¸º3çé»è¾æ ¸ä¸\n    pthread_create(&pthread1, null, (void *)worker, 3);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¯¹äºredisæ¥è¯´ï¼å®æ¯å¨bio.cæä»¶ä¸­çbioprocessbackgroundjobså½æ°ä¸­åå»ºäºåå°çº¿ç¨ãbioprocessbackgroundjobså½æ°ç±»ä¼¼äºååçä¾å­ä¸­çworkerå½æ°ï¼å¨è¿ä¸ªå½æ°ä¸­å®ç°ç»æ ¸åæ­¥æä½ï¼å°±å¯ä»¥æåå°çº¿ç¨ç»å°åä¸»çº¿ç¨ä¸åçæ ¸ä¸äºã\n\nåç»çº¿ç¨ç»æ ¸ç±»ä¼¼ï¼å½æä»¬ä½¿ç¨forkåå»ºå­è¿ç¨æ¶ï¼ä¹å¯ä»¥æååè¯´çåæ­¥æä½å®ç°å¨forkåçå­è¿ç¨ä»£ç ä¸­ï¼ç¤ºä¾ä»£ç å¦ä¸ï¼\n\nint main(){\n   //ç¨forkåå»ºä¸ä¸ªå­è¿ç¨\n   pid_t p = fork();\n   if(p < 0){\n      printf(" fork error\\n");\n   }\n   //å­è¿ç¨ä»£ç é¨å\n   else if(!p){\n      cpu_set_t cpuset;  //åå»ºä½å¾åé\n      cpu_zero(&cpu_set); //ä½å¾åéææä½è®¾ç½®0\n      cpu_set(3, &cpuset); //æä½å¾çç¬¬3ä½è®¾ç½®ä¸º1\n      sched_setaffinity(0, sizeof(cpuset), &cpuset);  //æç¨åºç»å®å¨3å·é»è¾æ ¸\n      //å®éå­è¿ç¨å·¥ä½\n      exit(0);\n   }\n   ...\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nå¯¹äºredisæ¥è¯´ï¼çærdbåaofæ¥å¿éåçå­è¿ç¨åå«æ¯ä¸é¢ä¸¤ä¸ªæä»¶çå½æ°ä¸­å®ç°çã\n\n * rdb.cæä»¶ï¼rdbsavebackgroundå½æ°ï¼\n * aof.cæä»¶ï¼rewriteappendonlyfilebackgroundå½æ°ã\n\nè¿ä¸¤ä¸ªå½æ°ä¸­é½è°ç¨äºforkåå»ºå­è¿ç¨ï¼æä»¥ï¼æä»¬å¯ä»¥å¨å­è¿ç¨ä»£ç é¨åå ä¸ç»æ ¸çåæ­¥æä½ã\n\nä½¿ç¨æºç ä¼åæ¹æ¡ï¼æä»¬æ¢å¯ä»¥å®ç°rediså®ä¾ç»æ ¸ï¼é¿ååæ¢æ ¸å¸¦æ¥çæ§è½å½±åï¼è¿å¯ä»¥è®©å­è¿ç¨ãåå°çº¿ç¨åä¸»çº¿ç¨ä¸å¨åä¸ä¸ªæ ¸ä¸è¿è¡ï¼é¿åäºå®ä»¬ä¹é´çcpuèµæºç«äºãç¸æ¯ä½¿ç¨tasksetç»æ ¸æ¥è¯´ï¼è¿ä¸ªæ¹æ¡å¯ä»¥è¿ä¸æ­¥éä½ç»æ ¸çé£é©ã\n\n\n# 2.5 å°ç»\n\nè¿ä¸èè®²äºä¸»æµç cpu æ¶æä»¥å numa æ¶æï¼å¹¶è§£éäº cpu å¯¹ redis æ§è½çå½±åã\n\n * ç±äº cpu socket ä¹é´çåæ¢ä¼å¢å å°¾å»¶è¿ï¼å æ­¤å»ºè®®æå®ä¾ä¸æä¸ªæ ¸è¿è¡ç»å®ã\n * ä¸ºæå redis çç½ç»æ§è½ï¼ææ¶éè¦æç½ç»ä¸­æ­å¤çç¨åºå cpu æ ¸ç»å®ã\n * ä¸ºé²æ­¢ç»æ ¸å¯¼è´ redis ä¸»çº¿ç¨ä¸å­è¿ç¨çç«äºï¼æ¬ææåºäºä¸¤ç§æ¹æ¡æ¥è§£å³ã\n\nredis çä½å»¶è¿æ¯æä»¬æ°¸æçè¿½æ±ç®æ ï¼èå¤æ ¸ cpu å numa æ¶æå·²ç»æä¸ºäºç®åæå¡å¨çä¸»æµéç½®ãæä»¥ç»æ ¸ä¼åæ¹æ¡å¨å®è·µä¸­å¾éè¦ã\n\n----------------------------------------\n\n**æ¬èé®é¢ï¼**å¨ä¸å°æä¸¤ä¸ªcpu socketï¼æ¯ä¸ªsocket 8ä¸ªç©çæ ¸ï¼çæå¡å¨ä¸ï¼æä»¬é¨ç½²äºä¸ä¸ªæç8ä¸ªå®ä¾çredisåçéç¾¤ï¼8ä¸ªå®ä¾é½ä¸ºä¸»èç¹ï¼æ²¡æä¸»å¤å³ç³»ï¼ï¼ç°å¨æä¸¤ä¸ªæ¹æ¡ï¼\n\n 1. å¨åä¸ä¸ªcpu socketä¸è¿è¡8ä¸ªå®ä¾ï¼å¹¶å8ä¸ªcpuæ ¸ç»å®ï¼\n 2. å¨ä¸¤ä¸ªcpu socketä¸åè¿è¡4ä¸ªå®ä¾ï¼å¹¶åç¸åºsocketä¸çæ ¸ç»å®ã\n\nå¦æä¸èèç½ç»æ°æ®è¯»åçå½±åï¼ä½ ä¼éæ©åªä¸ªæ¹æ¡å¢ï¼\n\nç­æ¡ï¼å»ºè®®ä½¿ç¨ç¬¬äºä¸ªæ¹æ¡ï¼ä¸»è¦æä¸¤æ¹é¢çåå ã\n\n 1. åä¸ä¸ªcpu socketä¸çè¿ç¨ï¼ä¼å±äº«l3ç¼å­ãå¦ææ8ä¸ªå®ä¾é½é¨ç½²å¨åä¸ä¸ªsocketä¸ï¼å®ä»¬ä¼ç«äºl3ç¼å­ï¼è¿å°±ä¼å¯¼è´å®ä»¬çl3ç¼å­å½ä¸­çéä½ï¼å½±åè®¿é®æ§è½ã\n\n 2. åä¸ä¸ªcpu socketä¸çè¿ç¨ï¼ä¼ä½¿ç¨åä¸ä¸ªsocketä¸çåå­ç©ºé´ã8ä¸ªå®ä¾å±äº«åä¸ä¸ªsocketä¸çåå­ç©ºé´ï¼è¯å®ä¼ç«äºåå­èµæºãå¦ææå®ä¾ä¿å­çæ°æ®éå¤§ï¼å¶ä»å®ä¾è½ç¨å°çåå­ç©ºé´å¯è½å°±ä¸å¤äºï¼æ­¤æ¶ï¼å¶ä»å®ä¾å°±ä¼è·¨socketç³è¯·åå­ï¼è¿èé æè·¨socketè®¿é®åå­ï¼é æå®ä¾çæ§è½éä½ã\n\nå¦å¤ï¼å¨åçéç¾¤ä¸­ï¼ä¸åå®ä¾é´éè¿ç½ç»è¿è¡æ¶æ¯éä¿¡åæ°æ®è¿ç§»ï¼å¹¶ä¸ä¼ä½¿ç¨å±äº«åå­ç©ºé´è¿è¡è·¨å®ä¾çæ°æ®è®¿é®ãæä»¥ï¼å³ä½¿æä¸åçå®ä¾é¨ç½²å°ä¸åçsocketä¸ï¼å®ä»¬ä¹é´ä¹ä¸ä¼åçè·¨socketåå­çè®¿é®ï¼ä¸ä¼åè·¨socketåå­è®¿é®çè´é¢å½±åã',charsets:{cjk:!0},lastUpdated:"2023/04/10, 14:17:28",lastUpdatedTimestamp:1681136248e3},{title:"å¦ä½åºå¯¹åæ¢ç Redis",frontmatter:{title:"å¦ä½åºå¯¹åæ¢ç Redis",date:"2023-04-08T21:28:19.000Z",permalink:"/pages/f111bf/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/18.%E5%A6%82%E4%BD%95%E5%BA%94%E5%AF%B9%E5%8F%98%E6%85%A2%E7%9A%84%20Redis.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/18.å¦ä½åºå¯¹åæ¢ç Redis.md",key:"v-6c981036",path:"/pages/f111bf/",headers:[{level:2,title:"1. Redis ççåæ¢äºåï¼",slug:"_1-redis-ççåæ¢äºå",normalizedTitle:"1. redis ççåæ¢äºåï¼",charIndex:368},{level:2,title:"2. å¦ä½åºå¯¹ Redis åæ¢ï¼",slug:"_2-å¦ä½åºå¯¹-redis-åæ¢",normalizedTitle:"2. å¦ä½åºå¯¹ redis åæ¢ï¼",charIndex:1670},{level:3,title:"2.1 Redis èªèº«æä½ç¹æ§çå½±å",slug:"_2-1-redis-èªèº«æä½ç¹æ§çå½±å",normalizedTitle:"2.1 redis èªèº«æä½ç¹æ§çå½±å",charIndex:1938},{level:4,title:"2.1.1 æ¢æ¥è¯¢å½ä»¤",slug:"_2-1-1-æ¢æ¥è¯¢å½ä»¤",normalizedTitle:"2.1.1 æ¢æ¥è¯¢å½ä»¤",charIndex:2024},{level:4,title:"2.1.2 è¿æ key æä½",slug:"_2-1-2-è¿æ-key-æä½",normalizedTitle:"2.1.2 è¿æ key æä½",charIndex:2845},{level:3,title:"2.2 æä»¶ç³»ç»ï¼AOF æ¨¡å¼",slug:"_2-2-æä»¶ç³»ç»-aof-æ¨¡å¼",normalizedTitle:"2.2 æä»¶ç³»ç»ï¼aof æ¨¡å¼",charIndex:4254},{level:3,title:"2.3 æä½ç³»ç»ï¼swap",slug:"_2-3-æä½ç³»ç»-swap",normalizedTitle:"2.3 æä½ç³»ç»ï¼swap",charIndex:6146},{level:3,title:"2.4 æä½ç³»ç»ï¼åå­å¤§é¡µ",slug:"_2-4-æä½ç³»ç»-åå­å¤§é¡µ",normalizedTitle:"2.4 æä½ç³»ç»ï¼åå­å¤§é¡µ",charIndex:7739},{level:2,title:"3. å°ç»",slug:"_3-å°ç»",normalizedTitle:"3. å°ç»",charIndex:8632}],headersStr:"1. Redis ççåæ¢äºåï¼ 2. å¦ä½åºå¯¹ Redis åæ¢ï¼ 2.1 Redis èªèº«æä½ç¹æ§çå½±å 2.1.1 æ¢æ¥è¯¢å½ä»¤ 2.1.2 è¿æ key æä½ 2.2 æä»¶ç³»ç»ï¼AOF æ¨¡å¼ 2.3 æä½ç³»ç»ï¼swap 2.4 æä½ç³»ç»ï¼åå­å¤§é¡µ 3. å°ç»",content:'> åèï¼\n> \n>  * 18 æ³¢å¨çååºå»¶è¿ï¼å¦ä½åºå¯¹åæ¢çRedisï¼ï¼ä¸ï¼| æå®¢æ¶é´\n>  * 19 æ³¢å¨çååºå»¶è¿ï¼å¦ä½åºå¯¹åæ¢çRedisï¼ï¼ä¸ï¼| æå®¢æ¶é´\n\nRedis å å¶é«æ§è½èè¢«å¹¿æ³åºç¨ï¼æä»¬éè¦é¿åæ§è½å¼å¸¸çæåµåºç°ãå½±å Redis æ§è½ç 5 å¤§æ¹é¢å ç´ æï¼\n\n * Redis åé¨çé»å¡å¼æä½\n * CPU æ ¸å NUMA æ¶æçå½±å\n * Redis å³é®ç³»ç»éç½®\n * Redis åå­ç¢ç\n * Redis ç¼å²åº\n\nä¸ä¸ç¯åæäºåä¸¤ä¸ªå ç´ ï¼æ¬æåæç¬¬ä¸ä¸ªå ç´ ã\n\nå¨å®éé¨ç½²ä¸­ï¼æä¸ä¸ªå¾ä¸¥éçé®é¢ï¼Redis çªç¶åæ¢äºï¼è¿å¯è½ä¼ç´æ¥å½±åå¶ä»ç³»ç»ï¼å¯¼è´ä¸è¿ä¸²çè¿éååºãæ¬æå°ä»ç»å¦ä½ç³»ç»æ§å°åºå¯¹ Redis åæ¢è¿ä¸ªé®é¢ï¼å¹¶ä»é®é¢è®¤å®ãç³»ç»æ§ææ¥ååºå¯¹æ¹æ¡è¿ 3 ä¸ªæ¹é¢æ¥è¿è¡è®²è§£ã\n\n\n# 1. Redis ççåæ¢äºåï¼\n\nå¤æ­ Redis æ¯å¦ççåæ¢äºæä¸ªæç´æ¥çæ¹æ³ï¼æ¥ç Redis çååºå»¶è¿ã\n\nå¤§é¨åæ¶å Redis å»¶è¿å¾ä½ï¼ä½æäºæ¶å»å¯è½ä¼åºç°å¾é«çç¸åºå»¶è¿ï¼çè³è½è¾¾å°å ç§å°åå ç§ï¼ä¸è¿æç»­æ¶é´ä¸é¿ï¼è¿ä¹å«å»¶è¿æ¯åºãå½ä½ åç° Redis å½ä»¤çæ§è¡æ¶é´çªç¶å°±å¢é¿å°äºå ç§ï¼åºæ¬å°±å¯ä»¥è®¤å® Redis åæ¢äºã\n\nè¿ç§æ¹æ³ççæ¯ Redis å»¶è¿çç»å¯¹å¼ï¼ä½å¨ä¸åçè½¯ç¡¬ä»¶ç¯å¢ä¸ï¼Redis çç»å¯¹æ§è½æ¬èº«å¹¶ä¸ç¸åãæ¯å¦å·®çæºå¨å»¶è¿ 1ms æè®¤å®åæ¢äºï¼ä½å¥½çæºå¨å»¶è¿ 0.2ms å°±å¯ä»¥è®¤å®åæ¢äºã\n\næä»¥éè¦ç¬¬äºä¸ªå¤æ­æ¹æ³ï¼åºäºå½åç¯å¢ä¸ç Redis åºçº¿æ§è½åå¤æ­ãåºçº¿æ§è½ï¼æä¸ä¸ªç³»ç»å¨ä½ååãæ å¹²æ°ä¸çåºæ¬æ§è½ï¼è¿ä¸ªæ§è½åªç±å½åçè½¯ç¡¬ä»¶éç½®å³å®ã\n\nå·ä½å¦ä½ç¡®å®åºçº¿æ§è½å¢ï¼redis-cli å½ä»¤æä¾äº âintrinsic-latency éé¡¹ï¼å¯ä»¥ç¨æ¥çæµåç»è®¡æµè¯æé´åçæå¤§å»¶è¿ï¼è¿ä¸ªå»¶è¿å¯ä»¥ä½ä¸º Redis çåºçº¿æ§è½ãå¶ä¸­ï¼æµè¯æ¶é¿å¯ä»¥ç¨ âintrinsic-latency éé¡¹çåæ°æ¥æå®ã\n\nä¸¾ä¸ªä¾å­ï¼æ¯å¦è¯´ï¼æä»¬è¿è¡ä¸é¢çå½ä»¤ï¼è¯¥å½ä»¤ä¼æå° 120 ç§åçæµå°çæå¤§å»¶è¿ãå¯ä»¥çå°ï¼è¿éçæå¤§å»¶è¿æ¯ 119 å¾®ç§ï¼ä¹å°±æ¯åºçº¿æ§è½ä¸º 119 å¾®ç§ãä¸è¬æåµä¸ï¼è¿è¡ 120 ç§å°±è¶³å¤çæµå°æå¤§å»¶è¿äºï¼æä»¥ï¼æä»¬å¯ä»¥æåæ°è®¾ç½®ä¸º 120ã\n\n./redis-cli --intrinsic-latency 120\nMax latency so far: 17 microseconds.\nMax latency so far: 44 microseconds.\nMax latency so far: 94 microseconds.\nMax latency so far: 110 microseconds.\nMax latency so far: 119 microseconds.\n36481658 total runs (avg latency: 3.2893 microseconds / 3289.32 nanoseconds per run).\nWorst run took 36x longer than the average latency.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¸è¬æ¥è¯´ï¼ä½ è¦æè¿è¡æ¶å»¶è¿ååºçº¿æ§è½è¿è¡å¯¹æ¯ï¼å¦æä½ è§å¯å°ç Redis è¿è¡æ¶å»¶è¿æ¯å¶åºçº¿æ§è½ç 2 ååä»¥ä¸ï¼å°±å¯ä»¥è®¤å® Redis åæ¢äºã\n\næä»¬éå¸¸æ¯éè¿å®¢æ·ç«¯åç½ç»è®¿é®Redisæå¡ï¼ä¸ºäºé¿åç½ç»å¯¹åºçº¿æ§è½çå½±åï¼ååè¯´çè¿ä¸ªå½ä»¤éè¦å¨æå¡å¨ç«¯ç´æ¥è¿è¡ï¼è¿ä¹å°±æ¯è¯´ï¼æä»¬åªèèæå¡å¨ç«¯è½¯ç¡¬ä»¶ç¯å¢çå½±åãå¦æä½ æ³äºè§£ç½ç»å¯¹Redisæ§è½çå½±åï¼ä¸ä¸ªç®åçæ¹æ³æ¯ç¨ iPerf è¿æ ·çå·¥å·ï¼æµéä» Redis å®¢æ·ç«¯å°æå¡å¨ç«¯çç½ç»å»¶è¿ãå¦æè¿ä¸ªå»¶è¿æå åæ¯«ç§çè³æ¯å ç¾æ¯«ç§ï¼å°±è¯´æï¼Redis è¿è¡çç½ç»ç¯å¢ä¸­å¾å¯è½æå¤§æµéçå¶ä»åºç¨ç¨åºå¨è¿è¡ï¼å¯¼è´ç½ç»æ¥å¡äºãè¿ä¸ªæ¶åï¼ä½ å°±éè¦åè°ç½ç»è¿ç»´ï¼è°æ´ç½ç»çæµéåéäºã\n\n\n# 2. å¦ä½åºå¯¹ Redis åæ¢ï¼\n\næä»¬ç°å¨éè¦è¯æ­ Redis åæ¢çåå ãè¦åºäºèªå·±å¯¹Redisæ¬èº«çå·¥ä½åçççè§£ï¼å¹¶ä¸ç»ååå®äº¤äºçæä½ç³»ç»ãå­å¨ä»¥åç½ç»ç­å¤é¨ç³»ç»å³é®æºå¶ï¼ååå©ä¸äºè¾å©å·¥å·æ¥å®ä½åå ï¼å¹¶å¶å®è¡ä¹ææçè§£å³æ¹æ¡ã\n\nä¸å¾æ¯ Redis çæ¶æå¾ï¼çº¢è²æ¨¡åå°±æ¯å½±å Redis çä¸å¤§è¦ç´ ï¼Redis èªèº«çæä½ç¹æ§ãæä»¶ç³»ç»åæä½ç³»ç»ã\n\nä¸é¢å°ä»è¿ä¸å¤§è¦ç´ å¥æï¼å¹¶ç»åå®éçåºç¨åºæ¯ï¼ä¾æ¬¡ä»ç»ä»ä¸åè¦ç´ åºåææ¥åè§£å³é®é¢çå®è·µç»éªãæ§è½è¯æ­éå¸¸æ¯ä¸ä»¶å°é¾çäºï¼æä»¥æä»¬ä¸å®ä¸è½æ¯«æ ç®æ å°âä¹±æ¾âã\n\n\n# 2.1 Redis èªèº«æä½ç¹æ§çå½±å\n\né¦åæ¥å­¦ä¹ ä¸ Redis æä¾çé®å¼å¯¹å½ä»¤æä½å¯¹å»¶è¿æ§è½çå½±åãè¿ééç¹ä»ç»ä¸¤ç±»å³é®æä½ï¼æ¢æ¥è¯¢å½ä»¤åè¿æ key æä½ã\n\n# 2.1.1 æ¢æ¥è¯¢å½ä»¤\n\næ¢æ¥è¯¢å½ä»¤ï¼æå¨ Redis ä¸­æ§è¡éåº¦æ¢çå½ä»¤ï¼è¿ä¼å¯¼è´ Redis å»¶è¿å¢å ã\n\næ§è¡å¿«æ¢ä¸æä½å¤æåº¦ç¸å³ãæ¯å¦è¯´ï¼Value ç±»åä¸º String æ¶ï¼GET/SET æä½ä¸»è¦å°±æ¯æä½ Redis çåå¸è¡¨ç´¢å¼ãè¿ä¸ªæä½å¤æåº¦åºæ¬æ¯åºå®çï¼å³ O(1)ãä½æ¯ï¼å½ Value ç±»åä¸º Set æ¶ï¼SORTãSUNION/SMEMBERS æä½å¤æåº¦åå«ä¸º O(N+M*log(M)) å O(N) ãå¶ä¸­ï¼N ä¸º Set ä¸­çåç´ ä¸ªæ°ï¼M ä¸º SORT æä½è¿åçåç´ ä¸ªæ°ãè¿ä¸ªå¤æåº¦å°±å¢å äºå¾å¤ãRediså®æ¹ææ¡£ ä¸­å¯¹æ¯ä¸ªå½ä»¤çå¤æåº¦é½æä»ç»ï¼å½ä½ éè¦äºè§£æä¸ªå½ä»¤çå¤æåº¦æ¶ï¼å¯ä»¥ç´æ¥æ¥è¯¢ã\n\nå½ä½ åç° Redis æ§è½åæ¢æ¶ï¼å¯ä»¥éè¿ Redis æ¥å¿ï¼æèæ¯ latency monitor å·¥å·ï¼æ¥è¯¢åæ¢çè¯·æ±ï¼æ ¹æ®è¯·æ±å¯¹åºçå·ä½å½ä»¤ä»¥åå®æ¹ææ¡£ï¼ç¡®è®¤ä¸æ¯å¦éç¨äºå¤æåº¦é«çæ¢æ¥è¯¢å½ä»¤ãå¦æçç¡®æå¤§éçæ¢æ¥è¯¢å½ä»¤ï¼æä¸¤ç§å¤çæ¹å¼ï¼\n\n 1. ç¨å¶ä»é«æå½ä»¤ä»£æ¿ãæ¯å¦è¯´ï¼å¦æä½ éè¦è¿åä¸ä¸ªSETä¸­çæææåæ¶ï¼ä¸è¦ä½¿ç¨SMEMBERSå½ä»¤ï¼èæ¯è¦ä½¿ç¨SSCANå¤æ¬¡è¿­ä»£è¿åï¼é¿åä¸æ¬¡è¿åå¤§éæ°æ®ï¼é æçº¿ç¨é»å¡ã\n 2. å½ä½ éè¦æ§è¡æåºãäº¤éãå¹¶éæä½æ¶ï¼å¯ä»¥å¨å®¢æ·ç«¯å®æï¼èä¸è¦ç¨ SORTãSUNIONãSINTER è¿äºå½ä»¤ï¼ä»¥åææ¢ Redis å®ä¾ã\n\nè¿æä¸ä¸ªæ¯è¾å®¹æå¿½ç¥çæ¢æ¥è¯¢å½ä»¤ï¼å°±æ¯ KEYSï¼ç¨äºè¿ååè¾å¥æ¨¡å¼å¹éçæækeyãä¾å¦ï¼ä»¥ä¸å½ä»¤è¿åææåå«ânameâå­ç¬¦ä¸²ç keysï¼\n\nredis> KEYS *name*\n1) "lastname"\n2) "firstname"\n\n\n1\n2\n3\n\n\nå ä¸º KEYS å½ä»¤éè¦éåå­å¨çé®å¼å¯¹ï¼æä»¥æä½å»¶æ¶é«ãå¦æä½ ä¸äºè§£å®çå®ç°èä½¿ç¨äºå®ï¼å°±ä¼å¯¼è´Redisæ§è½åæ¢ãæä»¥ï¼KEYSå½ä»¤ä¸è¬ä¸è¢«å»ºè®®ç¨äºçäº§ç¯å¢ä¸­ã\n\n# 2.1.2 è¿æ key æä½\n\nè¿æ key çèªå¨å é¤æºå¶æ¯ Redis ç¨æ¥åæ¶åå­ç©ºé´çå¸¸ç¨æºå¶ï¼åºç¨å¹¿æ³ï¼æ¬èº«å°±ä¼å¼èµ·Redisæä½é»å¡ï¼å¯¼è´æ§è½åæ¢ï¼æä»¥ï¼ä½ å¿é¡»è¦ç¥éè¯¥æºå¶å¯¹æ§è½çå½±åã\n\nRedis é®å¼å¯¹ç key å¯ä»¥è®¾ç½®è¿ææ¶é´ãé»è®¤æåµä¸ï¼Redis æ¯ 100 æ¯«ç§ä¼å é¤ä¸äºè¿æ keyï¼å·ä½çç®æ³å¦ä¸ï¼\n\n 1. éæ · ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP ä¸ªæ°ç keyï¼å¹¶å°å¶ä¸­è¿æç key å¨é¨å é¤ï¼\n 2. å¦æè¶è¿ 25% ç key è¿æäºï¼åéå¤å é¤çè¿ç¨ï¼ç´å°è¿æ key çæ¯ä¾éè³ 25% ä»¥ä¸ã\n\n> ä¸è¿° 1 æ¯ä¼æ¯ç§é½å¨æ§è¡çã\n\nACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP æ¯ Redis çä¸ä¸ªåæ°ï¼é»è®¤æ¯ 20ï¼é£ä¹ï¼ä¸ç§ååºæ¬æ 200 ä¸ªè¿æ key ä¼è¢«å é¤ãè¿ä¸ç­ç¥å¯¹æ¸é¤è¿æ keyãéæ¾åå­ç©ºé´å¾æå¸®å©ãå¦ææ¯ç§éå é¤ 200 ä¸ªè¿æ keyï¼å¹¶ä¸ä¼å¯¹ Redis é æå¤ªå¤§å½±åã\n\nä½æ¯ï¼å¦æè§¦åäºä¸é¢è¿ä¸ªç®æ³çç¬¬äºæ¡ï¼Redis å°±ä¼ä¸ç´å é¤ä»¥éæ¾åå­ç©ºé´ãæ³¨æï¼å é¤æä½æ¯é»å¡çï¼Redis 4.0åå¯ä»¥ç¨å¼æ­¥çº¿ç¨æºå¶æ¥åå°é»å¡å½±åï¼ãæä»¥ï¼ä¸æ¦è¯¥æ¡ä»¶è§¦åï¼Redis ççº¿ç¨å°±ä¼ä¸ç´æ§è¡å é¤ï¼è¿æ ·ä¸æ¥ï¼å°±æ²¡åæ³æ­£å¸¸æå¡å¶ä»çé®å¼æä½äºï¼å°±ä¼è¿ä¸æ­¥å¼èµ·å¶ä»é®å¼æä½çå»¶è¿å¢å ï¼Redis å°±ä¼åæ¢ã\n\nç®æ³çç¬¬äºæ¡è¢«è§¦åçä¸ä¸ªéè¦æ¥æºå°±æ¯ï¼é¢ç¹ä½¿ç¨å¸¦æç¸åæ¶é´åæ°ç EXPIREAT å½ä»¤è®¾ç½®è¿æ keyï¼è¿å°±ä¼å¯¼è´ï¼å¨åä¸ç§åæå¤§éç key åæ¶è¿æãè¿éæå°±è¦ç»åºç¬¬äºæ¡ææ¥å»ºè®®åè§£å³æ¹æ³äºï¼\n\nä½ è¦æ£æ¥ä¸å¡ä»£ç å¨ä½¿ç¨ EXPIREAT å½ä»¤è®¾ç½® key è¿ææ¶é´æ¶ï¼æ¯å¦ä½¿ç¨äºç¸åç UNIX æ¶é´æ³ï¼ææ²¡æä½¿ç¨ EXPIRE å½ä»¤ç»æ¹éç key è®¾ç½®ç¸åçè¿æç§æ°ãå ä¸ºï¼è¿é½ä¼é æå¤§é key å¨åä¸æ¶é´è¿æï¼å¯¼è´æ§è½åæ¢ã\n\néå°è¿ç§æåµæ¶ï¼åä¸ä¸è¦å«éº»ç¦ï¼ä½ é¦åè¦æ ¹æ®å®éä¸å¡çä½¿ç¨éæ±ï¼å³å® EXPIREAT å EXPIRE çè¿ææ¶é´åæ°ãå¶æ¬¡ï¼å¦æä¸æ¹ key çç¡®æ¯åæ¶è¿æï¼ä½ è¿å¯ä»¥å¨ EXPIREAT å EXPIRE çè¿ææ¶é´åæ°ä¸ï¼å ä¸ä¸ä¸ªä¸å®å¤§å°èå´åçéæºæ°ï¼è¿æ ·ï¼æ¢ä¿è¯äº key å¨ä¸ä¸ªé»è¿æ¶é´èå´åè¢«å é¤ï¼åé¿åäºåæ¶è¿æé æçååã\n\n----------------------------------------\n\nååè®²äºä» Redis èªèº«å½ä»¤æä½å±é¢ææ¥çæ¹æ¡ï¼ä½å¦æåç° Redis ææ§è¡å¤§éçæ¢æ¥è¯¢å½ä»¤ï¼ä¹æ²¡æåæ¶å é¤å¤§éè¿æ keysï¼é£å°±è¦å³æ³¨å½±åæ§è½çå¶ä»æºå¶äºï¼ä¹å°±æ¯æä»¶ç³»ç»åæä½ç³»ç»ï¼\n\n * ä¸æ¹é¢ï¼Redis ä¼æä¹åä¿å­æ°æ®å°ç£çï¼è¿ä¸ªè¿ç¨è¦ä¾èµæä»¶ç³»ç»æ¥å®æï¼æä»¥ï¼æä»¶ç³»ç»å°æ°æ®ååç£ççæºå¶ï¼ä¼ç´æ¥å½±åå° Redis æä¹åçæçãèä¸ï¼å¨æä¹åçè¿ç¨ä¸­ï¼Redis ä¹è¿å¨æ¥æ¶å¶ä»è¯·æ±ï¼æä¹åçæçé«ä½åä¼å½±åå° Redis å¤çè¯·æ±çæ§è½ã\n * å¦ä¸æ¹é¢ï¼Redisæ¯åå­æ°æ®åºï¼åå­æä½éå¸¸é¢ç¹ï¼æä»¥ï¼æä½ç³»ç»çåå­æºå¶ä¼ç´æ¥å½±åå° Redis çå¤çæçãæ¯å¦è¯´ï¼å¦æ Redis çåå­ä¸å¤ç¨äºï¼æä½ç³»ç»ä¼å¯å¨ swap æºå¶ï¼è¿å°±ä¼ç´æ¥ææ¢ Redisã\n\n\n# 2.2 æä»¶ç³»ç»ï¼AOF æ¨¡å¼\n\nRedisæ¯ä¸ªåå­æ°æ®åºï¼ä¸ºä»ä¹å®çæ§è½è¿åæä»¶ç³»ç»æå³å¢ï¼\n\nâµ ä¸ºäºä¿è¯æ°æ®å¯é æ§ï¼Redisä¼éç¨AOFæ¥å¿æRDBå¿«ç§ãå¶ä¸­ï¼AOF æ¥å¿æä¾äºä¸ç§æ¥å¿ååç­ç¥ï¼noãeverysecãalwaysãè¿ä¸ç§ååç­ç¥ä¾èµæä»¶ç³»ç»çä¸¤ä¸ªç³»ç»è°ç¨å®æï¼ä¹å°±æ¯ write å fsyncï¼\n\n * write åªè¦ææ¥å¿è®°å½åå°åæ ¸ç¼å²åºï¼å°±å¯ä»¥è¿åäºï¼å¹¶ä¸éè¦ç­å¾æ¥å¿å®éååå°ç£çï¼\n * fsync éè¦ææ¥å¿è®°å½ååå°ç£çåæè½è¿åï¼æ¶é´è¾é¿ã\n\nä¸è¡¨å±ç¤ºäºä¸ç§ååç­ç¥ææ§è¡çç³»ç»è°ç¨ï¼\n\nå½ååç­ç¥éç½®ä¸º everysec å always æ¶ï¼Redis éè¦è°ç¨ fsync ææ¥å¿ååç£çãä½æ¯ï¼è¿ä¸¤ç§ååç­ç¥çå·ä½æ§è¡æåµè¿ä¸å¤ªä¸æ ·ï¼\n\n * å¨ä½¿ç¨everysecæ¶ï¼Redisåè®¸ä¸¢å¤±ä¸ç§çæä½è®°å½ï¼æä»¥ï¼Redisä¸»çº¿ç¨å¹¶ä¸éè¦ç¡®ä¿æ¯ä¸ªæä½è®°å½æ¥å¿é½ååç£çãèä¸ï¼fsyncçæ§è¡æ¶é´å¾é¿ï¼å¦ææ¯å¨Redisä¸»çº¿ç¨ä¸­æ§è¡fsyncï¼å°±å®¹æé»å¡ä¸»çº¿ç¨ãæä»¥ï¼å½ååç­ç¥éç½®ä¸ºeverysecæ¶ï¼Redisä¼ä½¿ç¨åå°çå­çº¿ç¨å¼æ­¥å®æfsyncçæä½ã\n * èå¯¹äºalwaysç­ç¥æ¥è¯´ï¼Rediséè¦ç¡®ä¿æ¯ä¸ªæä½è®°å½æ¥å¿é½ååç£çï¼å¦æç¨åå°å­çº¿ç¨å¼æ­¥å®æï¼ä¸»çº¿ç¨å°±æ æ³åæ¶å°ç¥éæ¯ä¸ªæä½æ¯å¦å·²ç»å®æäºï¼è¿å°±ä¸ç¬¦åalwaysç­ç¥çè¦æ±äºãæä»¥ï¼alwaysç­ç¥å¹¶ä¸ä½¿ç¨åå°å­çº¿ç¨æ¥æ§è¡ã\n\nå¦å¤ï¼å¨ä½¿ç¨AOFæ¥å¿æ¶ï¼ä¸ºäºé¿åæ¥å¿æä»¶ä¸æ­å¢å¤§ï¼Redisä¼æ§è¡AOFéåï¼çæä½éç¼©å°çæ°çAOFæ¥å¿æä»¶ãAOFéåæ¬èº«éè¦çæ¶é´å¾é¿ï¼ä¹å®¹æé»å¡Redisä¸»çº¿ç¨ï¼æä»¥ï¼Redisä½¿ç¨å­è¿ç¨æ¥è¿è¡AOFéåã\n\nä½æ¯ï¼è¿éæä¸ä¸ªæ½å¨çé£é©ç¹ï¼AOF éåä¼å¯¹ç£çè¿è¡å¤§é IO æä½ï¼åæ¶ï¼fsync åéè¦ç­å°æ°æ®åå°ç£çåæè½è¿åï¼æä»¥ï¼å½ AOF éåçååæ¯è¾å¤§æ¶ï¼å°±ä¼å¯¼è´ fsync è¢«é»å¡ãè½ç¶fsyncæ¯ç±åå°å­çº¿ç¨è´è´£æ§è¡çï¼ä½æ¯ï¼ä¸»çº¿ç¨ä¼çæ§fsyncçæ§è¡è¿åº¦ã\n\nå½ä¸»çº¿ç¨ä½¿ç¨åå°å­çº¿ç¨æ§è¡äºä¸æ¬¡fsyncï¼éè¦åæ¬¡ææ°æ¥æ¶çæä½è®°å½ååç£çæ¶ï¼å¦æä¸»çº¿ç¨åç°ä¸ä¸æ¬¡çfsyncè¿æ²¡ææ§è¡å®ï¼é£ä¹å®å°±ä¼é»å¡ãæä»¥ï¼å¦æåå°å­çº¿ç¨æ§è¡çfsyncé¢ç¹é»å¡çè¯ï¼æ¯å¦AOFéåå ç¨äºå¤§éçç£çIOå¸¦å®½ï¼ï¼ä¸»çº¿ç¨ä¹ä¼é»å¡ï¼å¯¼è´Redisæ§è½åæ¢ã\n\nä¸å¾å±ç¤ºäºå¨ç£çååå°åååå¤§çæ¶åï¼fsyncåå°å­çº¿ç¨åä¸»çº¿ç¨åå°çå½±åï¼\n\nå°è¿éä½ åºè¯¥å¯ä»¥äºè§£äºï¼ç±äº fsync åå°å­çº¿ç¨å AOF éåå­è¿ç¨çå­å¨ï¼ä¸» IO çº¿ç¨ä¸è¬ä¸ä¼è¢«é»å¡ãä½æ¯ï¼å¦æå¨éåæ¥å¿æ¶ï¼AOF éåå­è¿ç¨çåå¥éæ¯è¾å¤§ï¼fsync çº¿ç¨ä¹ä¼è¢«é»å¡ï¼è¿èé»å¡ä¸»çº¿ç¨ï¼å¯¼è´å»¶è¿å¢å ã\n\nç°å¨ï¼ææ¥ç»åºææ¥åè§£å³å»ºè®®ã\n\né¦åï¼ä½ å¯ä»¥æ£æ¥ä¸ Redis éç½®æä»¶ä¸­ç appendfsync éç½®é¡¹ï¼è¯¥éç½®é¡¹çåå¼è¡¨æäº Redis å®ä¾ä½¿ç¨çæ¯åªç§ AOF æ¥å¿ååç­ç¥ï¼å¦ä¸æç¤ºï¼\n\nå¦æ AOF ååç­ç¥ä½¿ç¨äº everysec æ always éç½®ï¼è¯·åç¡®è®¤ä¸ä¸å¡æ¹å¯¹æ°æ®å¯é æ§çè¦æ±ï¼æç¡®æ¯å¦éè¦æ¯ä¸ç§ææ¯ä¸ä¸ªæä½é½è®°æ¥å¿ãæçä¸å¡æ¹ä¸äºè§£ Redis AOF æºå¶ï¼å¾å¯è½å°±ç´æ¥ä½¿ç¨æ°æ®å¯é æ§æé«ç­çº§ç always éç½®äºãå¶å®ï¼å¾å¤åºæ¯ä¸­ Redis åªæ¯ä½ä¸ºç¼å­ï¼å¹¶ä¸éè¦å¾é«çæ°æ®å¯é æ§ã\n\nå¦æä¸å¡åºç¨å¯¹å»¶è¿éå¸¸ææï¼ä½åæ¶åè®¸ä¸å®éçæ°æ®ä¸¢å¤±ï¼é£ä¹ï¼å¯ä»¥æéç½®é¡¹ no-appendfsync-on-rewrite è®¾ç½®ä¸º yesãè¿æ ·è¡¨ç¤ºå¨ AOF éåæ¶ï¼ä¸è¿è¡ fsync æä½ãä¹å°±æ¯è¯´ï¼Redis å®ä¾æåå½ä»¤åå°åå­åï¼ä¸è°ç¨åå°çº¿ç¨è¿è¡ fsync æä½ï¼å°±å¯ä»¥ç´æ¥è¿åäºãå½ç¶ï¼å¦ææ­¤æ¶å®ä¾åçå®æºï¼å°±ä¼å¯¼è´æ°æ®ä¸¢å¤±ãåä¹ï¼å¦æè¿ä¸ªéç½®é¡¹è®¾ç½®ä¸º noï¼ä¹æ¯é»è®¤éç½®ï¼ï¼å¨ AOF éåæ¶ï¼Redis å®ä¾ä»ç¶ä¼è°ç¨åå°çº¿ç¨è¿è¡ fsync æä½ï¼è¿å°±ä¼ç»å®ä¾å¸¦æ¥é»å¡ã\n\nno-appendfsync-on-rewrite yes\n\n\n1\n\n\nå¦æçç¡®éè¦é«æ§è½ï¼åæ¶ä¹éè¦é«å¯é æ°æ®ä¿è¯ï¼é£å»ºè®®èèéç¨é«éçåºæç¡¬çä½ä¸ºAOFæ¥å¿çåå¥è®¾å¤ãé«éåºæççå¸¦å®½åå¹¶ååº¦æ¯ä¼ ç»çæºæ¢°ç¡¬ççè¦é«åº10ååä»¥ä¸ãå¨AOFéååfsyncåå°çº¿ç¨åæ¶æ§è¡æ¶ï¼åºæç¡¬çå¯ä»¥æä¾è¾ä¸ºåè¶³çç£çIOèµæºï¼è®©AOFéååfsyncåå°çº¿ç¨çç£çIOèµæºç«äºåå°ï¼ä»èéä½å¯¹Redisçæ§è½å½±åã\n\n\n# 2.3 æä½ç³»ç»ï¼swap\n\nå¦æRedisçAOFæ¥å¿éç½®åªæ¯noï¼æèå°±æ²¡æéç¨AOFæ¨¡å¼ï¼é£ä¹ï¼è¿ä¼æä»ä¹é®é¢å¯¼è´æ§è½åæ¢åï¼è¿æä¸ä¸ªæ½å¨çç¶é¢ï¼æä½ç³»ç»çåå­ swapã\n\nåå­ swap æ¯æä½ç³»ç»å°åå­æ°æ®å¨åå­åç£çé´æ¥åæ¢å¥åæ¢åºçæºå¶ãç±äºè¿æ¶åç£ç IOï¼ä¼å¯¼è´æ§è½æå¤§å°éä½ã\n\nä¸æ¦ swap è¢«è§¦åï¼Redis æ¬èº«ç´æ¥éè¿è®¿é®åå­å°±è½å®æçæä½éè¦ç­å°ç£çæ°æ®è¯»åå®æåæè¡ãèä¸åä½¿ç¨ fsync çº¿ç¨è¯»å AOF æ¥å¿ä¸åï¼swap è§¦ååå½±åçæ¯ Redis çä¸»çº¿ç¨ï¼ä¼æå¤§å¢å  Redis çååºæ¶é´ã\n\néå¸¸è§¦å swap çåå ä¸»è¦æ¯ç©çæºå¨åå­ä¸è¶³ï¼å¯¹äº Redis èè¨ï¼æä¸¤ç§å¸¸è§çæåµï¼\n\n * Redis å®ä¾èªèº«ä½¿ç¨äºå¤§éçåå­ï¼å¯¼è´ç©çæºå¨çå¯ç¨åå­ä¸è¶³ï¼\n * å Redis å®ä¾å¨åä¸å°æºå¨ä¸è¿è¡çå¶ä»è¿ç¨ï¼å¨è¿è¡å¤§éçæä»¶è¯»åæä½ãæä»¶è¯»åæ¬èº«ä¼å ç¨ç³»ç»åå­ï¼è¿ä¼å¯¼è´åéç» Redis å®ä¾çåå­éåå°ï¼è¿èè§¦å Redis åç swapã\n\néå¯¹è¯¥é®é¢çè§£å³æ¹å¼ï¼å¢å æºå¨çåå­æèä½¿ç¨ Redis éç¾¤ã\n\næä½ç³»ç»æ¬èº«ä¼å¨åå°è®°å½æ¯ä¸ªè¿ç¨çswapä½¿ç¨æåµï¼å³æå¤å°æ°æ®éåçäºswapãå¯ä»¥éè¿ä¸é¢çä»ç»æ¥æ¥çæ¯ä¸ªè¿ç¨ç swap ä½¿ç¨æåµã\n\n * ä½ å¯ä»¥åéè¿ä¸é¢çå½ä»¤æ¥çRedisçè¿ç¨å·ï¼è¿éæ¯5332ï¼\n\n$ redis-cli info | grep process_id\nprocess_id: 5332\n\n\n1\n2\n\n * ç¶åï¼è¿å¥ Redis æå¨æºå¨ç /proc ç®å½ä¸çè¯¥è¿ç¨ç®å½ä¸­ï¼\n\ncd /proc/5332\n\n\n1\n\n * æåï¼è¿è¡ä¸é¢çå½ä»¤ï¼æ¥çè¯¥Redisè¿ç¨çä½¿ç¨æåµãå¨è¿å¿ï¼æåªæªåäºé¨åç»æï¼\n\n$cat smaps | egrep \'^(Swap|Size)\'\nSize: 584 kB\nSwap: 0 kB\nSize: 4 kB\nSwap: 4 kB\nSize: 4 kB\nSwap: 0 kB\nSize: 462044 kB\nSwap: 462008 kB\nSize: 21392 kB\nSwap: 0 kB\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næ¯ä¸è¡Sizeè¡¨ç¤ºçæ¯Rediså®ä¾æç¨çä¸ååå­å¤§å°ï¼èSizeä¸æ¹çSwapåå®ç¸å¯¹åºï¼è¡¨ç¤ºè¿åSizeå¤§å°çåå­åºåæå¤å°å·²ç»è¢«æ¢åºå°ç£çä¸äºãå¦æè¿ä¸¤ä¸ªå¼ç¸ç­ï¼å°±è¡¨ç¤ºè¿ååå­åºåå·²ç»å®å¨è¢«æ¢åºå°ç£çäºã\n\nä½ä¸ºåå­æ°æ®åºï¼Redisæ¬èº«ä¼ä½¿ç¨å¾å¤å¤§å°ä¸ä¸çåå­åï¼æä»¥ï¼ä½ å¯ä»¥çå°æå¾å¤Sizeè¡ï¼æçå¾å°ï¼å°±æ¯4KBï¼èæçå¾å¤§ï¼ä¾å¦462044KBãä¸ååå­åè¢«æ¢åºå°ç£çä¸çå¤§å°ä¹ä¸ä¸æ ·ï¼ä¾å¦ååçç»æä¸­çç¬¬ä¸ä¸ª4KBåå­åï¼å®ä¸æ¹çSwapä¹æ¯4KBï¼è¿è¡¨ç¤ºè¿ä¸ªåå­åå·²ç»è¢«æ¢åºäºï¼å¦å¤ï¼462044KBè¿ä¸ªåå­åä¹è¢«æ¢åºäº462008KBï¼å·®ä¸å¤æ462MBã\n\nè¿éæä¸ªéè¦çå°æ¹ï¼æå¾æéä½ ä¸ä¸ï¼å½åºç°ç¾MBï¼çè³GBçº§å«çswapå¤§å°æ¶ï¼å°±è¡¨æï¼æ­¤æ¶ï¼Rediså®ä¾çåå­ååå¾å¤§ï¼å¾æå¯è½ä¼åæ¢ãæä»¥ï¼swap çå¤§å°æ¯ææ¥ Redis æ§è½åæ¢æ¯å¦ç± swap å¼èµ·çéè¦ææ ã\n\nä¸æ¦åçåå­swapï¼æç´æ¥çè§£å³æ¹æ³å°±æ¯å¢å æºå¨åå­ãå¦æè¯¥å®ä¾å¨ä¸ä¸ªRedisåçéç¾¤ä¸­ï¼å¯ä»¥å¢å Rediséç¾¤çå®ä¾ä¸ªæ°ï¼æ¥åææ¯ä¸ªå®ä¾æå¡çæ°æ®éï¼è¿èåå°æ¯ä¸ªå®ä¾æéçåå­éã\n\nå½ç¶ï¼å¦æRediså®ä¾åå¶ä»æä½å¤§éæä»¶çç¨åºï¼ä¾å¦æ°æ®åæç¨åºï¼å±äº«æºå¨ï¼ä½ å¯ä»¥å°Rediså®ä¾è¿ç§»å°åç¬çæºå¨ä¸è¿è¡ï¼ä»¥æ»¡è¶³å®çåå­éæ±éãå¦æè¯¥å®ä¾æ­£å¥½æ¯Redisä¸»ä»éç¾¤ä¸­çä¸»åºï¼èä»åºçåå­å¾å¤§ï¼ä¹å¯ä»¥èèè¿è¡ä¸»ä»åæ¢ï¼æå¤§åå­çä»åºåæä¸»åºï¼ç±å®æ¥å¤çå®¢æ·ç«¯è¯·æ±ã\n\n\n# 2.4 æä½ç³»ç»ï¼åå­å¤§é¡µ\n\né¤äºåå­ swapï¼è¿æä¸ä¸ªååå­ç¸å³çå ç´ ï¼å³åå­å¤§é¡µæºå¶ï¼Transparent Huge Page, THPï¼ï¼ä¹ä¼å½±å Redis æ§è½ãLinuxåæ ¸ä»2.6.38å¼å§æ¯æåå­å¤§é¡µæºå¶ï¼è¯¥æºå¶æ¯æ2MBå¤§å°çåå­é¡µåéï¼èå¸¸è§çåå­é¡µåéæ¯æ4KBçç²åº¦æ¥æ§è¡çã\n\nå¾å¤äººé½è§å¾ï¼âRedisæ¯åå­æ°æ®åºï¼åå­å¤§é¡µä¸æ­£å¥½å¯ä»¥æ»¡è¶³Redisçéæ±åï¼èä¸å¨åéç¸åçåå­éæ¶ï¼åå­å¤§é¡µè¿è½åå°åéæ¬¡æ°ï¼ä¸ä¹æ¯å¯¹Redisåå¥½å?âå¶å®åå­å¤§é¡µå­å¨ä¸ä¸ª trade-offï¼è½ç¶åå­å¤§é¡µå¯ä»¥ç»Rediså¸¦æ¥åå­åéæ¹é¢çæ¶çï¼ä½æ¯ï¼ä¸è¦å¿äºï¼Redisä¸ºäºæä¾æ°æ®å¯é æ§ä¿è¯ï¼éè¦å°æ°æ®åæä¹åä¿å­ãè¿ä¸ªåå¥è¿ç¨ç±é¢å¤ççº¿ç¨æ§è¡ï¼æä»¥ï¼æ­¤æ¶ï¼Redisä¸»çº¿ç¨ä»ç¶å¯ä»¥æ¥æ¶å®¢æ·ç«¯åè¯·æ±ãå®¢æ·ç«¯çåè¯·æ±å¯è½ä¼ä¿®æ¹æ­£å¨è¿è¡æä¹åçæ°æ®ãå¨è¿ä¸è¿ç¨ä¸­ï¼Rediså°±ä¼éç¨åæ¶å¤å¶æºå¶ï¼ä¹å°±æ¯è¯´ï¼ä¸æ¦ææ°æ®è¦è¢«ä¿®æ¹ï¼Rediså¹¶ä¸ä¼ç´æ¥ä¿®æ¹åå­ä¸­çæ°æ®ï¼èæ¯å°è¿äºæ°æ®æ·è´ä¸ä»½ï¼ç¶ååè¿è¡ä¿®æ¹ãå¦æéç¨äºåå­å¤§é¡µï¼é£ä¹ï¼å³ä½¿å®¢æ·ç«¯è¯·æ±åªä¿®æ¹100Bçæ°æ®ï¼Redisä¹éè¦æ·è´2MBçå¤§é¡µãç¸åï¼å¦ææ¯å¸¸è§åå­é¡µæºå¶ï¼åªç¨æ·è´4KBãä¸¤èç¸æ¯ï¼ä½ å¯ä»¥çå°ï¼å½å®¢æ·ç«¯è¯·æ±ä¿®æ¹ææ°åå¥æ°æ®è¾å¤æ¶ï¼åå­å¤§é¡µæºå¶å°å¯¼è´å¤§éçæ·è´ï¼è¿å°±ä¼å½±å Redis æ­£å¸¸çè®¿å­æä½ï¼æç»å¯¼è´æ§è½åæ¢ã\n\né£è¯¥æä¹åå¢ï¼å¾ç®åï¼å³é­åå­å¤§é¡µå°±è¡äºã\n\né¦åï¼æä»¬è¦åææ¥ä¸åå­å¤§é¡µãæ¹æ³æ¯ï¼å¨Rediså®ä¾è¿è¡çæºå¨ä¸æ§è¡å¦ä¸å½ä»¤ï¼\n\ncat /sys/kernel/mm/transparent_hugepage/enabled\n\n\n1\n\n\nå¦ææ§è¡ç»ææ¯alwaysï¼å°±è¡¨æåå­å¤§é¡µæºå¶è¢«å¯å¨äºï¼å¦ææ¯neverï¼å°±è¡¨ç¤ºï¼åå­å¤§é¡µæºå¶è¢«ç¦æ­¢ã\n\nå¨å®éçäº§ç¯å¢ä¸­é¨ç½²æ¶ï¼æå»ºè®®ä½ ä¸è¦ä½¿ç¨åå­å¤§é¡µæºå¶ï¼æä½ä¹å¾ç®åï¼åªéè¦æ§è¡ä¸é¢çå½ä»¤å°±å¯ä»¥äºï¼\n\necho never /sys/kernel/mm/transparent_hugepage/enabled\n\n\n1\n\n\n\n# 3. å°ç»\n\nè¿éæ¢³çäºåå« 9 ä¸ªæ£æ¥ç¹ç checklistï¼å½éå° Redis æ§è½åæ¢æ¶ï¼å¯ä»¥æç§è¿äºæ­¥éª¤éä¸æ£æ¥ï¼\n\n 1. è·åRediså®ä¾å¨å½åç¯å¢ä¸çåºçº¿æ§è½ã\n 2. æ¯å¦ç¨äºæ¢æ¥è¯¢å½ä»¤ï¼å¦ææ¯çè¯ï¼å°±ä½¿ç¨å¶ä»å½ä»¤æ¿ä»£æ¢æ¥è¯¢å½ä»¤ï¼æèæèåè®¡ç®å½ä»¤æ¾å¨å®¢æ·ç«¯åã\n 3. æ¯å¦å¯¹è¿ækeyè®¾ç½®äºç¸åçè¿ææ¶é´ï¼å¯¹äºæ¹éå é¤çkeyï¼å¯ä»¥å¨æ¯ä¸ªkeyçè¿ææ¶é´ä¸å ä¸ä¸ªéæºæ°ï¼é¿ååæ¶å é¤ã\n 4. æ¯å¦å­å¨bigkeyï¼ å¯¹äºbigkeyçå é¤æä½ï¼å¦æä½ çRedisæ¯4.0åä»¥ä¸ççæ¬ï¼å¯ä»¥ç´æ¥å©ç¨å¼æ­¥çº¿ç¨æºå¶åå°ä¸»çº¿ç¨é»å¡ï¼å¦ææ¯Redis 4.0ä»¥åççæ¬ï¼å¯ä»¥ä½¿ç¨SCANå½ä»¤è¿­ä»£å é¤ï¼å¯¹äºbigkeyçéåæ¥è¯¢åèåæä½ï¼å¯ä»¥ä½¿ç¨SCANå½ä»¤å¨å®¢æ·ç«¯å®æã\n 5. Redis AOFéç½®çº§å«æ¯ä»ä¹ï¼ä¸å¡å±é¢æ¯å¦çç¡®éè¦è¿ä¸å¯é æ§çº§å«ï¼å¦ææä»¬éè¦é«æ§è½ï¼åæ¶ä¹åè®¸æ°æ®ä¸¢å¤±ï¼å¯ä»¥å°éç½®é¡¹no-appendfsync-on-rewriteè®¾ç½®ä¸ºyesï¼é¿åAOFéååfsyncç«äºç£çIOèµæºï¼å¯¼è´Rediså»¶è¿å¢å ãå½ç¶ï¼ å¦ææ¢éè¦é«æ§è½åéè¦é«å¯é æ§ï¼æå¥½ä½¿ç¨é«éåºæçä½ä¸ºAOFæ¥å¿çåå¥çã\n 6. Rediså®ä¾çåå­ä½¿ç¨æ¯å¦è¿å¤§ï¼åçswapäºåï¼å¦ææ¯çè¯ï¼å°±å¢å æºå¨åå­ï¼æèæ¯ä½¿ç¨Rediséç¾¤ï¼åæåæºRedisçé®å¼å¯¹æ°éååå­ååãåæ¶ï¼è¦é¿ååºç°Redisåå¶ä»åå­éæ±å¤§çåºç¨å±äº«æºå¨çæåµã\n 7. å¨Rediså®ä¾çè¿è¡ç¯å¢ä¸­ï¼æ¯å¦å¯ç¨äºéæå¤§é¡µæºå¶ï¼å¦ææ¯çè¯ï¼ç´æ¥å³é­åå­å¤§é¡µæºå¶å°±è¡äºã\n 8. æ¯å¦è¿è¡äºRedisä¸»ä»éç¾¤ï¼å¦ææ¯çè¯ï¼æä¸»åºå®ä¾çæ°æ®éå¤§å°æ§å¶å¨2~4GBï¼ä»¥åä¸»ä»å¤å¶æ¶ï¼ä»åºå å è½½å¤§çRDBæä»¶èé»å¡ã\n 9. æ¯å¦ä½¿ç¨äºå¤æ ¸CPUæNUMAæ¶æçæºå¨è¿è¡Rediså®ä¾ï¼ä½¿ç¨å¤æ ¸CPUæ¶ï¼å¯ä»¥ç»Rediså®ä¾ç»å®ç©çæ ¸ï¼ä½¿ç¨NUMAæ¶ææ¶ï¼æ³¨ææRediså®ä¾åç½ç»ä¸­æ­å¤çç¨åºè¿è¡å¨åä¸ä¸ªCPU Socketä¸ã\n\nå®éä¸ï¼å½±åç³»ç»æ§è½çå ç´ è¿æå¾å¤ï¼è¿éè®²çåªæ¯æå¸¸è§é®é¢çè§£å³æ¹æ¡ã\n\nå¦æä½ éå°äºä¸äºç¹æ®æåµï¼ä¹ä¸è¦æï¼æåç»ä½ åäº«ä¸ä¸ªå°æå·§ï¼ä»ç»æ£æ¥ä¸ææ²¡ææ¼äººçé»å±ï¼å·ä½ç¹è¯´ï¼å°±æ¯Redisæå¨çæºå¨ä¸ææ²¡æä¸äºå¶ä»å åå­ãç£çIOåç½ç»IOçç¨åºï¼æ¯å¦è¯´æ°æ®åºç¨åºæèæ°æ®ééç¨åºãå¦ææçè¯ï¼æå»ºè®®ä½ å°è¿äºç¨åºè¿ç§»å°å¶ä»æºå¨ä¸è¿è¡ãä¸ºäºä¿è¯ Redis é«æ§è½ï¼æä»¬éè¦ç» Redis åè¶³çè®¡ç®ãåå­å IO èµæºï¼ç»å®æä¾ä¸ä¸ªâå®éâçç¯å¢ã',normalizedContent:'> åèï¼\n> \n>  * 18 æ³¢å¨çååºå»¶è¿ï¼å¦ä½åºå¯¹åæ¢çredisï¼ï¼ä¸ï¼| æå®¢æ¶é´\n>  * 19 æ³¢å¨çååºå»¶è¿ï¼å¦ä½åºå¯¹åæ¢çredisï¼ï¼ä¸ï¼| æå®¢æ¶é´\n\nredis å å¶é«æ§è½èè¢«å¹¿æ³åºç¨ï¼æä»¬éè¦é¿åæ§è½å¼å¸¸çæåµåºç°ãå½±å redis æ§è½ç 5 å¤§æ¹é¢å ç´ æï¼\n\n * redis åé¨çé»å¡å¼æä½\n * cpu æ ¸å numa æ¶æçå½±å\n * redis å³é®ç³»ç»éç½®\n * redis åå­ç¢ç\n * redis ç¼å²åº\n\nä¸ä¸ç¯åæäºåä¸¤ä¸ªå ç´ ï¼æ¬æåæç¬¬ä¸ä¸ªå ç´ ã\n\nå¨å®éé¨ç½²ä¸­ï¼æä¸ä¸ªå¾ä¸¥éçé®é¢ï¼redis çªç¶åæ¢äºï¼è¿å¯è½ä¼ç´æ¥å½±åå¶ä»ç³»ç»ï¼å¯¼è´ä¸è¿ä¸²çè¿éååºãæ¬æå°ä»ç»å¦ä½ç³»ç»æ§å°åºå¯¹ redis åæ¢è¿ä¸ªé®é¢ï¼å¹¶ä»é®é¢è®¤å®ãç³»ç»æ§ææ¥ååºå¯¹æ¹æ¡è¿ 3 ä¸ªæ¹é¢æ¥è¿è¡è®²è§£ã\n\n\n# 1. redis ççåæ¢äºåï¼\n\nå¤æ­ redis æ¯å¦ççåæ¢äºæä¸ªæç´æ¥çæ¹æ³ï¼æ¥ç redis çååºå»¶è¿ã\n\nå¤§é¨åæ¶å redis å»¶è¿å¾ä½ï¼ä½æäºæ¶å»å¯è½ä¼åºç°å¾é«çç¸åºå»¶è¿ï¼çè³è½è¾¾å°å ç§å°åå ç§ï¼ä¸è¿æç»­æ¶é´ä¸é¿ï¼è¿ä¹å«å»¶è¿æ¯åºãå½ä½ åç° redis å½ä»¤çæ§è¡æ¶é´çªç¶å°±å¢é¿å°äºå ç§ï¼åºæ¬å°±å¯ä»¥è®¤å® redis åæ¢äºã\n\nè¿ç§æ¹æ³ççæ¯ redis å»¶è¿çç»å¯¹å¼ï¼ä½å¨ä¸åçè½¯ç¡¬ä»¶ç¯å¢ä¸ï¼redis çç»å¯¹æ§è½æ¬èº«å¹¶ä¸ç¸åãæ¯å¦å·®çæºå¨å»¶è¿ 1ms æè®¤å®åæ¢äºï¼ä½å¥½çæºå¨å»¶è¿ 0.2ms å°±å¯ä»¥è®¤å®åæ¢äºã\n\næä»¥éè¦ç¬¬äºä¸ªå¤æ­æ¹æ³ï¼åºäºå½åç¯å¢ä¸ç redis åºçº¿æ§è½åå¤æ­ãåºçº¿æ§è½ï¼æä¸ä¸ªç³»ç»å¨ä½ååãæ å¹²æ°ä¸çåºæ¬æ§è½ï¼è¿ä¸ªæ§è½åªç±å½åçè½¯ç¡¬ä»¶éç½®å³å®ã\n\nå·ä½å¦ä½ç¡®å®åºçº¿æ§è½å¢ï¼redis-cli å½ä»¤æä¾äº âintrinsic-latency éé¡¹ï¼å¯ä»¥ç¨æ¥çæµåç»è®¡æµè¯æé´åçæå¤§å»¶è¿ï¼è¿ä¸ªå»¶è¿å¯ä»¥ä½ä¸º redis çåºçº¿æ§è½ãå¶ä¸­ï¼æµè¯æ¶é¿å¯ä»¥ç¨ âintrinsic-latency éé¡¹çåæ°æ¥æå®ã\n\nä¸¾ä¸ªä¾å­ï¼æ¯å¦è¯´ï¼æä»¬è¿è¡ä¸é¢çå½ä»¤ï¼è¯¥å½ä»¤ä¼æå° 120 ç§åçæµå°çæå¤§å»¶è¿ãå¯ä»¥çå°ï¼è¿éçæå¤§å»¶è¿æ¯ 119 å¾®ç§ï¼ä¹å°±æ¯åºçº¿æ§è½ä¸º 119 å¾®ç§ãä¸è¬æåµä¸ï¼è¿è¡ 120 ç§å°±è¶³å¤çæµå°æå¤§å»¶è¿äºï¼æä»¥ï¼æä»¬å¯ä»¥æåæ°è®¾ç½®ä¸º 120ã\n\n./redis-cli --intrinsic-latency 120\nmax latency so far: 17 microseconds.\nmax latency so far: 44 microseconds.\nmax latency so far: 94 microseconds.\nmax latency so far: 110 microseconds.\nmax latency so far: 119 microseconds.\n36481658 total runs (avg latency: 3.2893 microseconds / 3289.32 nanoseconds per run).\nworst run took 36x longer than the average latency.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nä¸è¬æ¥è¯´ï¼ä½ è¦æè¿è¡æ¶å»¶è¿ååºçº¿æ§è½è¿è¡å¯¹æ¯ï¼å¦æä½ è§å¯å°ç redis è¿è¡æ¶å»¶è¿æ¯å¶åºçº¿æ§è½ç 2 ååä»¥ä¸ï¼å°±å¯ä»¥è®¤å® redis åæ¢äºã\n\næä»¬éå¸¸æ¯éè¿å®¢æ·ç«¯åç½ç»è®¿é®redisæå¡ï¼ä¸ºäºé¿åç½ç»å¯¹åºçº¿æ§è½çå½±åï¼ååè¯´çè¿ä¸ªå½ä»¤éè¦å¨æå¡å¨ç«¯ç´æ¥è¿è¡ï¼è¿ä¹å°±æ¯è¯´ï¼æä»¬åªèèæå¡å¨ç«¯è½¯ç¡¬ä»¶ç¯å¢çå½±åãå¦æä½ æ³äºè§£ç½ç»å¯¹redisæ§è½çå½±åï¼ä¸ä¸ªç®åçæ¹æ³æ¯ç¨ iperf è¿æ ·çå·¥å·ï¼æµéä» redis å®¢æ·ç«¯å°æå¡å¨ç«¯çç½ç»å»¶è¿ãå¦æè¿ä¸ªå»¶è¿æå åæ¯«ç§çè³æ¯å ç¾æ¯«ç§ï¼å°±è¯´æï¼redis è¿è¡çç½ç»ç¯å¢ä¸­å¾å¯è½æå¤§æµéçå¶ä»åºç¨ç¨åºå¨è¿è¡ï¼å¯¼è´ç½ç»æ¥å¡äºãè¿ä¸ªæ¶åï¼ä½ å°±éè¦åè°ç½ç»è¿ç»´ï¼è°æ´ç½ç»çæµéåéäºã\n\n\n# 2. å¦ä½åºå¯¹ redis åæ¢ï¼\n\næä»¬ç°å¨éè¦è¯æ­ redis åæ¢çåå ãè¦åºäºèªå·±å¯¹redisæ¬èº«çå·¥ä½åçççè§£ï¼å¹¶ä¸ç»ååå®äº¤äºçæä½ç³»ç»ãå­å¨ä»¥åç½ç»ç­å¤é¨ç³»ç»å³é®æºå¶ï¼ååå©ä¸äºè¾å©å·¥å·æ¥å®ä½åå ï¼å¹¶å¶å®è¡ä¹ææçè§£å³æ¹æ¡ã\n\nä¸å¾æ¯ redis çæ¶æå¾ï¼çº¢è²æ¨¡åå°±æ¯å½±å redis çä¸å¤§è¦ç´ ï¼redis èªèº«çæä½ç¹æ§ãæä»¶ç³»ç»åæä½ç³»ç»ã\n\nä¸é¢å°ä»è¿ä¸å¤§è¦ç´ å¥æï¼å¹¶ç»åå®éçåºç¨åºæ¯ï¼ä¾æ¬¡ä»ç»ä»ä¸åè¦ç´ åºåææ¥åè§£å³é®é¢çå®è·µç»éªãæ§è½è¯æ­éå¸¸æ¯ä¸ä»¶å°é¾çäºï¼æä»¥æä»¬ä¸å®ä¸è½æ¯«æ ç®æ å°âä¹±æ¾âã\n\n\n# 2.1 redis èªèº«æä½ç¹æ§çå½±å\n\né¦åæ¥å­¦ä¹ ä¸ redis æä¾çé®å¼å¯¹å½ä»¤æä½å¯¹å»¶è¿æ§è½çå½±åãè¿ééç¹ä»ç»ä¸¤ç±»å³é®æä½ï¼æ¢æ¥è¯¢å½ä»¤åè¿æ key æä½ã\n\n# 2.1.1 æ¢æ¥è¯¢å½ä»¤\n\næ¢æ¥è¯¢å½ä»¤ï¼æå¨ redis ä¸­æ§è¡éåº¦æ¢çå½ä»¤ï¼è¿ä¼å¯¼è´ redis å»¶è¿å¢å ã\n\næ§è¡å¿«æ¢ä¸æä½å¤æåº¦ç¸å³ãæ¯å¦è¯´ï¼value ç±»åä¸º string æ¶ï¼get/set æä½ä¸»è¦å°±æ¯æä½ redis çåå¸è¡¨ç´¢å¼ãè¿ä¸ªæä½å¤æåº¦åºæ¬æ¯åºå®çï¼å³ o(1)ãä½æ¯ï¼å½ value ç±»åä¸º set æ¶ï¼sortãsunion/smembers æä½å¤æåº¦åå«ä¸º o(n+m*log(m)) å o(n) ãå¶ä¸­ï¼n ä¸º set ä¸­çåç´ ä¸ªæ°ï¼m ä¸º sort æä½è¿åçåç´ ä¸ªæ°ãè¿ä¸ªå¤æåº¦å°±å¢å äºå¾å¤ãrediså®æ¹ææ¡£ ä¸­å¯¹æ¯ä¸ªå½ä»¤çå¤æåº¦é½æä»ç»ï¼å½ä½ éè¦äºè§£æä¸ªå½ä»¤çå¤æåº¦æ¶ï¼å¯ä»¥ç´æ¥æ¥è¯¢ã\n\nå½ä½ åç° redis æ§è½åæ¢æ¶ï¼å¯ä»¥éè¿ redis æ¥å¿ï¼æèæ¯ latency monitor å·¥å·ï¼æ¥è¯¢åæ¢çè¯·æ±ï¼æ ¹æ®è¯·æ±å¯¹åºçå·ä½å½ä»¤ä»¥åå®æ¹ææ¡£ï¼ç¡®è®¤ä¸æ¯å¦éç¨äºå¤æåº¦é«çæ¢æ¥è¯¢å½ä»¤ãå¦æçç¡®æå¤§éçæ¢æ¥è¯¢å½ä»¤ï¼æä¸¤ç§å¤çæ¹å¼ï¼\n\n 1. ç¨å¶ä»é«æå½ä»¤ä»£æ¿ãæ¯å¦è¯´ï¼å¦æä½ éè¦è¿åä¸ä¸ªsetä¸­çæææåæ¶ï¼ä¸è¦ä½¿ç¨smemberså½ä»¤ï¼èæ¯è¦ä½¿ç¨sscanå¤æ¬¡è¿­ä»£è¿åï¼é¿åä¸æ¬¡è¿åå¤§éæ°æ®ï¼é æçº¿ç¨é»å¡ã\n 2. å½ä½ éè¦æ§è¡æåºãäº¤éãå¹¶éæä½æ¶ï¼å¯ä»¥å¨å®¢æ·ç«¯å®æï¼èä¸è¦ç¨ sortãsunionãsinter è¿äºå½ä»¤ï¼ä»¥åææ¢ redis å®ä¾ã\n\nè¿æä¸ä¸ªæ¯è¾å®¹æå¿½ç¥çæ¢æ¥è¯¢å½ä»¤ï¼å°±æ¯ keysï¼ç¨äºè¿ååè¾å¥æ¨¡å¼å¹éçæækeyãä¾å¦ï¼ä»¥ä¸å½ä»¤è¿åææåå«ânameâå­ç¬¦ä¸²ç keysï¼\n\nredis> keys *name*\n1) "lastname"\n2) "firstname"\n\n\n1\n2\n3\n\n\nå ä¸º keys å½ä»¤éè¦éåå­å¨çé®å¼å¯¹ï¼æä»¥æä½å»¶æ¶é«ãå¦æä½ ä¸äºè§£å®çå®ç°èä½¿ç¨äºå®ï¼å°±ä¼å¯¼è´redisæ§è½åæ¢ãæä»¥ï¼keyså½ä»¤ä¸è¬ä¸è¢«å»ºè®®ç¨äºçäº§ç¯å¢ä¸­ã\n\n# 2.1.2 è¿æ key æä½\n\nè¿æ key çèªå¨å é¤æºå¶æ¯ redis ç¨æ¥åæ¶åå­ç©ºé´çå¸¸ç¨æºå¶ï¼åºç¨å¹¿æ³ï¼æ¬èº«å°±ä¼å¼èµ·redisæä½é»å¡ï¼å¯¼è´æ§è½åæ¢ï¼æä»¥ï¼ä½ å¿é¡»è¦ç¥éè¯¥æºå¶å¯¹æ§è½çå½±åã\n\nredis é®å¼å¯¹ç key å¯ä»¥è®¾ç½®è¿ææ¶é´ãé»è®¤æåµä¸ï¼redis æ¯ 100 æ¯«ç§ä¼å é¤ä¸äºè¿æ keyï¼å·ä½çç®æ³å¦ä¸ï¼\n\n 1. éæ · active_expire_cycle_lookups_per_loop ä¸ªæ°ç keyï¼å¹¶å°å¶ä¸­è¿æç key å¨é¨å é¤ï¼\n 2. å¦æè¶è¿ 25% ç key è¿æäºï¼åéå¤å é¤çè¿ç¨ï¼ç´å°è¿æ key çæ¯ä¾éè³ 25% ä»¥ä¸ã\n\n> ä¸è¿° 1 æ¯ä¼æ¯ç§é½å¨æ§è¡çã\n\nactive_expire_cycle_lookups_per_loop æ¯ redis çä¸ä¸ªåæ°ï¼é»è®¤æ¯ 20ï¼é£ä¹ï¼ä¸ç§ååºæ¬æ 200 ä¸ªè¿æ key ä¼è¢«å é¤ãè¿ä¸ç­ç¥å¯¹æ¸é¤è¿æ keyãéæ¾åå­ç©ºé´å¾æå¸®å©ãå¦ææ¯ç§éå é¤ 200 ä¸ªè¿æ keyï¼å¹¶ä¸ä¼å¯¹ redis é æå¤ªå¤§å½±åã\n\nä½æ¯ï¼å¦æè§¦åäºä¸é¢è¿ä¸ªç®æ³çç¬¬äºæ¡ï¼redis å°±ä¼ä¸ç´å é¤ä»¥éæ¾åå­ç©ºé´ãæ³¨æï¼å é¤æä½æ¯é»å¡çï¼redis 4.0åå¯ä»¥ç¨å¼æ­¥çº¿ç¨æºå¶æ¥åå°é»å¡å½±åï¼ãæä»¥ï¼ä¸æ¦è¯¥æ¡ä»¶è§¦åï¼redis ççº¿ç¨å°±ä¼ä¸ç´æ§è¡å é¤ï¼è¿æ ·ä¸æ¥ï¼å°±æ²¡åæ³æ­£å¸¸æå¡å¶ä»çé®å¼æä½äºï¼å°±ä¼è¿ä¸æ­¥å¼èµ·å¶ä»é®å¼æä½çå»¶è¿å¢å ï¼redis å°±ä¼åæ¢ã\n\nç®æ³çç¬¬äºæ¡è¢«è§¦åçä¸ä¸ªéè¦æ¥æºå°±æ¯ï¼é¢ç¹ä½¿ç¨å¸¦æç¸åæ¶é´åæ°ç expireat å½ä»¤è®¾ç½®è¿æ keyï¼è¿å°±ä¼å¯¼è´ï¼å¨åä¸ç§åæå¤§éç key åæ¶è¿æãè¿éæå°±è¦ç»åºç¬¬äºæ¡ææ¥å»ºè®®åè§£å³æ¹æ³äºï¼\n\nä½ è¦æ£æ¥ä¸å¡ä»£ç å¨ä½¿ç¨ expireat å½ä»¤è®¾ç½® key è¿ææ¶é´æ¶ï¼æ¯å¦ä½¿ç¨äºç¸åç unix æ¶é´æ³ï¼ææ²¡æä½¿ç¨ expire å½ä»¤ç»æ¹éç key è®¾ç½®ç¸åçè¿æç§æ°ãå ä¸ºï¼è¿é½ä¼é æå¤§é key å¨åä¸æ¶é´è¿æï¼å¯¼è´æ§è½åæ¢ã\n\néå°è¿ç§æåµæ¶ï¼åä¸ä¸è¦å«éº»ç¦ï¼ä½ é¦åè¦æ ¹æ®å®éä¸å¡çä½¿ç¨éæ±ï¼å³å® expireat å expire çè¿ææ¶é´åæ°ãå¶æ¬¡ï¼å¦æä¸æ¹ key çç¡®æ¯åæ¶è¿æï¼ä½ è¿å¯ä»¥å¨ expireat å expire çè¿ææ¶é´åæ°ä¸ï¼å ä¸ä¸ä¸ªä¸å®å¤§å°èå´åçéæºæ°ï¼è¿æ ·ï¼æ¢ä¿è¯äº key å¨ä¸ä¸ªé»è¿æ¶é´èå´åè¢«å é¤ï¼åé¿åäºåæ¶è¿æé æçååã\n\n----------------------------------------\n\nååè®²äºä» redis èªèº«å½ä»¤æä½å±é¢ææ¥çæ¹æ¡ï¼ä½å¦æåç° redis ææ§è¡å¤§éçæ¢æ¥è¯¢å½ä»¤ï¼ä¹æ²¡æåæ¶å é¤å¤§éè¿æ keysï¼é£å°±è¦å³æ³¨å½±åæ§è½çå¶ä»æºå¶äºï¼ä¹å°±æ¯æä»¶ç³»ç»åæä½ç³»ç»ï¼\n\n * ä¸æ¹é¢ï¼redis ä¼æä¹åä¿å­æ°æ®å°ç£çï¼è¿ä¸ªè¿ç¨è¦ä¾èµæä»¶ç³»ç»æ¥å®æï¼æä»¥ï¼æä»¶ç³»ç»å°æ°æ®ååç£ççæºå¶ï¼ä¼ç´æ¥å½±åå° redis æä¹åçæçãèä¸ï¼å¨æä¹åçè¿ç¨ä¸­ï¼redis ä¹è¿å¨æ¥æ¶å¶ä»è¯·æ±ï¼æä¹åçæçé«ä½åä¼å½±åå° redis å¤çè¯·æ±çæ§è½ã\n * å¦ä¸æ¹é¢ï¼redisæ¯åå­æ°æ®åºï¼åå­æä½éå¸¸é¢ç¹ï¼æä»¥ï¼æä½ç³»ç»çåå­æºå¶ä¼ç´æ¥å½±åå° redis çå¤çæçãæ¯å¦è¯´ï¼å¦æ redis çåå­ä¸å¤ç¨äºï¼æä½ç³»ç»ä¼å¯å¨ swap æºå¶ï¼è¿å°±ä¼ç´æ¥ææ¢ redisã\n\n\n# 2.2 æä»¶ç³»ç»ï¼aof æ¨¡å¼\n\nredisæ¯ä¸ªåå­æ°æ®åºï¼ä¸ºä»ä¹å®çæ§è½è¿åæä»¶ç³»ç»æå³å¢ï¼\n\nâµ ä¸ºäºä¿è¯æ°æ®å¯é æ§ï¼redisä¼éç¨aofæ¥å¿ærdbå¿«ç§ãå¶ä¸­ï¼aof æ¥å¿æä¾äºä¸ç§æ¥å¿ååç­ç¥ï¼noãeverysecãalwaysãè¿ä¸ç§ååç­ç¥ä¾èµæä»¶ç³»ç»çä¸¤ä¸ªç³»ç»è°ç¨å®æï¼ä¹å°±æ¯ write å fsyncï¼\n\n * write åªè¦ææ¥å¿è®°å½åå°åæ ¸ç¼å²åºï¼å°±å¯ä»¥è¿åäºï¼å¹¶ä¸éè¦ç­å¾æ¥å¿å®éååå°ç£çï¼\n * fsync éè¦ææ¥å¿è®°å½ååå°ç£çåæè½è¿åï¼æ¶é´è¾é¿ã\n\nä¸è¡¨å±ç¤ºäºä¸ç§ååç­ç¥ææ§è¡çç³»ç»è°ç¨ï¼\n\nå½ååç­ç¥éç½®ä¸º everysec å always æ¶ï¼redis éè¦è°ç¨ fsync ææ¥å¿ååç£çãä½æ¯ï¼è¿ä¸¤ç§ååç­ç¥çå·ä½æ§è¡æåµè¿ä¸å¤ªä¸æ ·ï¼\n\n * å¨ä½¿ç¨everysecæ¶ï¼redisåè®¸ä¸¢å¤±ä¸ç§çæä½è®°å½ï¼æä»¥ï¼redisä¸»çº¿ç¨å¹¶ä¸éè¦ç¡®ä¿æ¯ä¸ªæä½è®°å½æ¥å¿é½ååç£çãèä¸ï¼fsyncçæ§è¡æ¶é´å¾é¿ï¼å¦ææ¯å¨redisä¸»çº¿ç¨ä¸­æ§è¡fsyncï¼å°±å®¹æé»å¡ä¸»çº¿ç¨ãæä»¥ï¼å½ååç­ç¥éç½®ä¸ºeverysecæ¶ï¼redisä¼ä½¿ç¨åå°çå­çº¿ç¨å¼æ­¥å®æfsyncçæä½ã\n * èå¯¹äºalwaysç­ç¥æ¥è¯´ï¼rediséè¦ç¡®ä¿æ¯ä¸ªæä½è®°å½æ¥å¿é½ååç£çï¼å¦æç¨åå°å­çº¿ç¨å¼æ­¥å®æï¼ä¸»çº¿ç¨å°±æ æ³åæ¶å°ç¥éæ¯ä¸ªæä½æ¯å¦å·²ç»å®æäºï¼è¿å°±ä¸ç¬¦åalwaysç­ç¥çè¦æ±äºãæä»¥ï¼alwaysç­ç¥å¹¶ä¸ä½¿ç¨åå°å­çº¿ç¨æ¥æ§è¡ã\n\nå¦å¤ï¼å¨ä½¿ç¨aofæ¥å¿æ¶ï¼ä¸ºäºé¿åæ¥å¿æä»¶ä¸æ­å¢å¤§ï¼redisä¼æ§è¡aoféåï¼çæä½éç¼©å°çæ°çaofæ¥å¿æä»¶ãaoféåæ¬èº«éè¦çæ¶é´å¾é¿ï¼ä¹å®¹æé»å¡redisä¸»çº¿ç¨ï¼æä»¥ï¼redisä½¿ç¨å­è¿ç¨æ¥è¿è¡aoféåã\n\nä½æ¯ï¼è¿éæä¸ä¸ªæ½å¨çé£é©ç¹ï¼aof éåä¼å¯¹ç£çè¿è¡å¤§é io æä½ï¼åæ¶ï¼fsync åéè¦ç­å°æ°æ®åå°ç£çåæè½è¿åï¼æä»¥ï¼å½ aof éåçååæ¯è¾å¤§æ¶ï¼å°±ä¼å¯¼è´ fsync è¢«é»å¡ãè½ç¶fsyncæ¯ç±åå°å­çº¿ç¨è´è´£æ§è¡çï¼ä½æ¯ï¼ä¸»çº¿ç¨ä¼çæ§fsyncçæ§è¡è¿åº¦ã\n\nå½ä¸»çº¿ç¨ä½¿ç¨åå°å­çº¿ç¨æ§è¡äºä¸æ¬¡fsyncï¼éè¦åæ¬¡ææ°æ¥æ¶çæä½è®°å½ååç£çæ¶ï¼å¦æä¸»çº¿ç¨åç°ä¸ä¸æ¬¡çfsyncè¿æ²¡ææ§è¡å®ï¼é£ä¹å®å°±ä¼é»å¡ãæä»¥ï¼å¦æåå°å­çº¿ç¨æ§è¡çfsyncé¢ç¹é»å¡çè¯ï¼æ¯å¦aoféåå ç¨äºå¤§éçç£çioå¸¦å®½ï¼ï¼ä¸»çº¿ç¨ä¹ä¼é»å¡ï¼å¯¼è´redisæ§è½åæ¢ã\n\nä¸å¾å±ç¤ºäºå¨ç£çååå°åååå¤§çæ¶åï¼fsyncåå°å­çº¿ç¨åä¸»çº¿ç¨åå°çå½±åï¼\n\nå°è¿éä½ åºè¯¥å¯ä»¥äºè§£äºï¼ç±äº fsync åå°å­çº¿ç¨å aof éåå­è¿ç¨çå­å¨ï¼ä¸» io çº¿ç¨ä¸è¬ä¸ä¼è¢«é»å¡ãä½æ¯ï¼å¦æå¨éåæ¥å¿æ¶ï¼aof éåå­è¿ç¨çåå¥éæ¯è¾å¤§ï¼fsync çº¿ç¨ä¹ä¼è¢«é»å¡ï¼è¿èé»å¡ä¸»çº¿ç¨ï¼å¯¼è´å»¶è¿å¢å ã\n\nç°å¨ï¼ææ¥ç»åºææ¥åè§£å³å»ºè®®ã\n\né¦åï¼ä½ å¯ä»¥æ£æ¥ä¸ redis éç½®æä»¶ä¸­ç appendfsync éç½®é¡¹ï¼è¯¥éç½®é¡¹çåå¼è¡¨æäº redis å®ä¾ä½¿ç¨çæ¯åªç§ aof æ¥å¿ååç­ç¥ï¼å¦ä¸æç¤ºï¼\n\nå¦æ aof ååç­ç¥ä½¿ç¨äº everysec æ always éç½®ï¼è¯·åç¡®è®¤ä¸ä¸å¡æ¹å¯¹æ°æ®å¯é æ§çè¦æ±ï¼æç¡®æ¯å¦éè¦æ¯ä¸ç§ææ¯ä¸ä¸ªæä½é½è®°æ¥å¿ãæçä¸å¡æ¹ä¸äºè§£ redis aof æºå¶ï¼å¾å¯è½å°±ç´æ¥ä½¿ç¨æ°æ®å¯é æ§æé«ç­çº§ç always éç½®äºãå¶å®ï¼å¾å¤åºæ¯ä¸­ redis åªæ¯ä½ä¸ºç¼å­ï¼å¹¶ä¸éè¦å¾é«çæ°æ®å¯é æ§ã\n\nå¦æä¸å¡åºç¨å¯¹å»¶è¿éå¸¸ææï¼ä½åæ¶åè®¸ä¸å®éçæ°æ®ä¸¢å¤±ï¼é£ä¹ï¼å¯ä»¥æéç½®é¡¹ no-appendfsync-on-rewrite è®¾ç½®ä¸º yesãè¿æ ·è¡¨ç¤ºå¨ aof éåæ¶ï¼ä¸è¿è¡ fsync æä½ãä¹å°±æ¯è¯´ï¼redis å®ä¾æåå½ä»¤åå°åå­åï¼ä¸è°ç¨åå°çº¿ç¨è¿è¡ fsync æä½ï¼å°±å¯ä»¥ç´æ¥è¿åäºãå½ç¶ï¼å¦ææ­¤æ¶å®ä¾åçå®æºï¼å°±ä¼å¯¼è´æ°æ®ä¸¢å¤±ãåä¹ï¼å¦æè¿ä¸ªéç½®é¡¹è®¾ç½®ä¸º noï¼ä¹æ¯é»è®¤éç½®ï¼ï¼å¨ aof éåæ¶ï¼redis å®ä¾ä»ç¶ä¼è°ç¨åå°çº¿ç¨è¿è¡ fsync æä½ï¼è¿å°±ä¼ç»å®ä¾å¸¦æ¥é»å¡ã\n\nno-appendfsync-on-rewrite yes\n\n\n1\n\n\nå¦æçç¡®éè¦é«æ§è½ï¼åæ¶ä¹éè¦é«å¯é æ°æ®ä¿è¯ï¼é£å»ºè®®èèéç¨é«éçåºæç¡¬çä½ä¸ºaofæ¥å¿çåå¥è®¾å¤ãé«éåºæççå¸¦å®½åå¹¶ååº¦æ¯ä¼ ç»çæºæ¢°ç¡¬ççè¦é«åº10ååä»¥ä¸ãå¨aoféååfsyncåå°çº¿ç¨åæ¶æ§è¡æ¶ï¼åºæç¡¬çå¯ä»¥æä¾è¾ä¸ºåè¶³çç£çioèµæºï¼è®©aoféååfsyncåå°çº¿ç¨çç£çioèµæºç«äºåå°ï¼ä»èéä½å¯¹redisçæ§è½å½±åã\n\n\n# 2.3 æä½ç³»ç»ï¼swap\n\nå¦æredisçaofæ¥å¿éç½®åªæ¯noï¼æèå°±æ²¡æéç¨aofæ¨¡å¼ï¼é£ä¹ï¼è¿ä¼æä»ä¹é®é¢å¯¼è´æ§è½åæ¢åï¼è¿æä¸ä¸ªæ½å¨çç¶é¢ï¼æä½ç³»ç»çåå­ swapã\n\nåå­ swap æ¯æä½ç³»ç»å°åå­æ°æ®å¨åå­åç£çé´æ¥åæ¢å¥åæ¢åºçæºå¶ãç±äºè¿æ¶åç£ç ioï¼ä¼å¯¼è´æ§è½æå¤§å°éä½ã\n\nä¸æ¦ swap è¢«è§¦åï¼redis æ¬èº«ç´æ¥éè¿è®¿é®åå­å°±è½å®æçæä½éè¦ç­å°ç£çæ°æ®è¯»åå®æåæè¡ãèä¸åä½¿ç¨ fsync çº¿ç¨è¯»å aof æ¥å¿ä¸åï¼swap è§¦ååå½±åçæ¯ redis çä¸»çº¿ç¨ï¼ä¼æå¤§å¢å  redis çååºæ¶é´ã\n\néå¸¸è§¦å swap çåå ä¸»è¦æ¯ç©çæºå¨åå­ä¸è¶³ï¼å¯¹äº redis èè¨ï¼æä¸¤ç§å¸¸è§çæåµï¼\n\n * redis å®ä¾èªèº«ä½¿ç¨äºå¤§éçåå­ï¼å¯¼è´ç©çæºå¨çå¯ç¨åå­ä¸è¶³ï¼\n * å redis å®ä¾å¨åä¸å°æºå¨ä¸è¿è¡çå¶ä»è¿ç¨ï¼å¨è¿è¡å¤§éçæä»¶è¯»åæä½ãæä»¶è¯»åæ¬èº«ä¼å ç¨ç³»ç»åå­ï¼è¿ä¼å¯¼è´åéç» redis å®ä¾çåå­éåå°ï¼è¿èè§¦å redis åç swapã\n\néå¯¹è¯¥é®é¢çè§£å³æ¹å¼ï¼å¢å æºå¨çåå­æèä½¿ç¨ redis éç¾¤ã\n\næä½ç³»ç»æ¬èº«ä¼å¨åå°è®°å½æ¯ä¸ªè¿ç¨çswapä½¿ç¨æåµï¼å³æå¤å°æ°æ®éåçäºswapãå¯ä»¥éè¿ä¸é¢çä»ç»æ¥æ¥çæ¯ä¸ªè¿ç¨ç swap ä½¿ç¨æåµã\n\n * ä½ å¯ä»¥åéè¿ä¸é¢çå½ä»¤æ¥çredisçè¿ç¨å·ï¼è¿éæ¯5332ï¼\n\n$ redis-cli info | grep process_id\nprocess_id: 5332\n\n\n1\n2\n\n * ç¶åï¼è¿å¥ redis æå¨æºå¨ç /proc ç®å½ä¸çè¯¥è¿ç¨ç®å½ä¸­ï¼\n\ncd /proc/5332\n\n\n1\n\n * æåï¼è¿è¡ä¸é¢çå½ä»¤ï¼æ¥çè¯¥redisè¿ç¨çä½¿ç¨æåµãå¨è¿å¿ï¼æåªæªåäºé¨åç»æï¼\n\n$cat smaps | egrep \'^(swap|size)\'\nsize: 584 kb\nswap: 0 kb\nsize: 4 kb\nswap: 4 kb\nsize: 4 kb\nswap: 0 kb\nsize: 462044 kb\nswap: 462008 kb\nsize: 21392 kb\nswap: 0 kb\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næ¯ä¸è¡sizeè¡¨ç¤ºçæ¯rediså®ä¾æç¨çä¸ååå­å¤§å°ï¼èsizeä¸æ¹çswapåå®ç¸å¯¹åºï¼è¡¨ç¤ºè¿åsizeå¤§å°çåå­åºåæå¤å°å·²ç»è¢«æ¢åºå°ç£çä¸äºãå¦æè¿ä¸¤ä¸ªå¼ç¸ç­ï¼å°±è¡¨ç¤ºè¿ååå­åºåå·²ç»å®å¨è¢«æ¢åºå°ç£çäºã\n\nä½ä¸ºåå­æ°æ®åºï¼redisæ¬èº«ä¼ä½¿ç¨å¾å¤å¤§å°ä¸ä¸çåå­åï¼æä»¥ï¼ä½ å¯ä»¥çå°æå¾å¤sizeè¡ï¼æçå¾å°ï¼å°±æ¯4kbï¼èæçå¾å¤§ï¼ä¾å¦462044kbãä¸ååå­åè¢«æ¢åºå°ç£çä¸çå¤§å°ä¹ä¸ä¸æ ·ï¼ä¾å¦ååçç»æä¸­çç¬¬ä¸ä¸ª4kbåå­åï¼å®ä¸æ¹çswapä¹æ¯4kbï¼è¿è¡¨ç¤ºè¿ä¸ªåå­åå·²ç»è¢«æ¢åºäºï¼å¦å¤ï¼462044kbè¿ä¸ªåå­åä¹è¢«æ¢åºäº462008kbï¼å·®ä¸å¤æ462mbã\n\nè¿éæä¸ªéè¦çå°æ¹ï¼æå¾æéä½ ä¸ä¸ï¼å½åºç°ç¾mbï¼çè³gbçº§å«çswapå¤§å°æ¶ï¼å°±è¡¨æï¼æ­¤æ¶ï¼rediså®ä¾çåå­ååå¾å¤§ï¼å¾æå¯è½ä¼åæ¢ãæä»¥ï¼swap çå¤§å°æ¯ææ¥ redis æ§è½åæ¢æ¯å¦ç± swap å¼èµ·çéè¦ææ ã\n\nä¸æ¦åçåå­swapï¼æç´æ¥çè§£å³æ¹æ³å°±æ¯å¢å æºå¨åå­ãå¦æè¯¥å®ä¾å¨ä¸ä¸ªredisåçéç¾¤ä¸­ï¼å¯ä»¥å¢å rediséç¾¤çå®ä¾ä¸ªæ°ï¼æ¥åææ¯ä¸ªå®ä¾æå¡çæ°æ®éï¼è¿èåå°æ¯ä¸ªå®ä¾æéçåå­éã\n\nå½ç¶ï¼å¦ærediså®ä¾åå¶ä»æä½å¤§éæä»¶çç¨åºï¼ä¾å¦æ°æ®åæç¨åºï¼å±äº«æºå¨ï¼ä½ å¯ä»¥å°rediså®ä¾è¿ç§»å°åç¬çæºå¨ä¸è¿è¡ï¼ä»¥æ»¡è¶³å®çåå­éæ±éãå¦æè¯¥å®ä¾æ­£å¥½æ¯redisä¸»ä»éç¾¤ä¸­çä¸»åºï¼èä»åºçåå­å¾å¤§ï¼ä¹å¯ä»¥èèè¿è¡ä¸»ä»åæ¢ï¼æå¤§åå­çä»åºåæä¸»åºï¼ç±å®æ¥å¤çå®¢æ·ç«¯è¯·æ±ã\n\n\n# 2.4 æä½ç³»ç»ï¼åå­å¤§é¡µ\n\né¤äºåå­ swapï¼è¿æä¸ä¸ªååå­ç¸å³çå ç´ ï¼å³åå­å¤§é¡µæºå¶ï¼transparent huge page, thpï¼ï¼ä¹ä¼å½±å redis æ§è½ãlinuxåæ ¸ä»2.6.38å¼å§æ¯æåå­å¤§é¡µæºå¶ï¼è¯¥æºå¶æ¯æ2mbå¤§å°çåå­é¡µåéï¼èå¸¸è§çåå­é¡µåéæ¯æ4kbçç²åº¦æ¥æ§è¡çã\n\nå¾å¤äººé½è§å¾ï¼âredisæ¯åå­æ°æ®åºï¼åå­å¤§é¡µä¸æ­£å¥½å¯ä»¥æ»¡è¶³redisçéæ±åï¼èä¸å¨åéç¸åçåå­éæ¶ï¼åå­å¤§é¡µè¿è½åå°åéæ¬¡æ°ï¼ä¸ä¹æ¯å¯¹redisåå¥½å?âå¶å®åå­å¤§é¡µå­å¨ä¸ä¸ª trade-offï¼è½ç¶åå­å¤§é¡µå¯ä»¥ç»rediså¸¦æ¥åå­åéæ¹é¢çæ¶çï¼ä½æ¯ï¼ä¸è¦å¿äºï¼redisä¸ºäºæä¾æ°æ®å¯é æ§ä¿è¯ï¼éè¦å°æ°æ®åæä¹åä¿å­ãè¿ä¸ªåå¥è¿ç¨ç±é¢å¤ççº¿ç¨æ§è¡ï¼æä»¥ï¼æ­¤æ¶ï¼redisä¸»çº¿ç¨ä»ç¶å¯ä»¥æ¥æ¶å®¢æ·ç«¯åè¯·æ±ãå®¢æ·ç«¯çåè¯·æ±å¯è½ä¼ä¿®æ¹æ­£å¨è¿è¡æä¹åçæ°æ®ãå¨è¿ä¸è¿ç¨ä¸­ï¼rediså°±ä¼éç¨åæ¶å¤å¶æºå¶ï¼ä¹å°±æ¯è¯´ï¼ä¸æ¦ææ°æ®è¦è¢«ä¿®æ¹ï¼rediså¹¶ä¸ä¼ç´æ¥ä¿®æ¹åå­ä¸­çæ°æ®ï¼èæ¯å°è¿äºæ°æ®æ·è´ä¸ä»½ï¼ç¶ååè¿è¡ä¿®æ¹ãå¦æéç¨äºåå­å¤§é¡µï¼é£ä¹ï¼å³ä½¿å®¢æ·ç«¯è¯·æ±åªä¿®æ¹100bçæ°æ®ï¼redisä¹éè¦æ·è´2mbçå¤§é¡µãç¸åï¼å¦ææ¯å¸¸è§åå­é¡µæºå¶ï¼åªç¨æ·è´4kbãä¸¤èç¸æ¯ï¼ä½ å¯ä»¥çå°ï¼å½å®¢æ·ç«¯è¯·æ±ä¿®æ¹ææ°åå¥æ°æ®è¾å¤æ¶ï¼åå­å¤§é¡µæºå¶å°å¯¼è´å¤§éçæ·è´ï¼è¿å°±ä¼å½±å redis æ­£å¸¸çè®¿å­æä½ï¼æç»å¯¼è´æ§è½åæ¢ã\n\né£è¯¥æä¹åå¢ï¼å¾ç®åï¼å³é­åå­å¤§é¡µå°±è¡äºã\n\né¦åï¼æä»¬è¦åææ¥ä¸åå­å¤§é¡µãæ¹æ³æ¯ï¼å¨rediså®ä¾è¿è¡çæºå¨ä¸æ§è¡å¦ä¸å½ä»¤ï¼\n\ncat /sys/kernel/mm/transparent_hugepage/enabled\n\n\n1\n\n\nå¦ææ§è¡ç»ææ¯alwaysï¼å°±è¡¨æåå­å¤§é¡µæºå¶è¢«å¯å¨äºï¼å¦ææ¯neverï¼å°±è¡¨ç¤ºï¼åå­å¤§é¡µæºå¶è¢«ç¦æ­¢ã\n\nå¨å®éçäº§ç¯å¢ä¸­é¨ç½²æ¶ï¼æå»ºè®®ä½ ä¸è¦ä½¿ç¨åå­å¤§é¡µæºå¶ï¼æä½ä¹å¾ç®åï¼åªéè¦æ§è¡ä¸é¢çå½ä»¤å°±å¯ä»¥äºï¼\n\necho never /sys/kernel/mm/transparent_hugepage/enabled\n\n\n1\n\n\n\n# 3. å°ç»\n\nè¿éæ¢³çäºåå« 9 ä¸ªæ£æ¥ç¹ç checklistï¼å½éå° redis æ§è½åæ¢æ¶ï¼å¯ä»¥æç§è¿äºæ­¥éª¤éä¸æ£æ¥ï¼\n\n 1. è·årediså®ä¾å¨å½åç¯å¢ä¸çåºçº¿æ§è½ã\n 2. æ¯å¦ç¨äºæ¢æ¥è¯¢å½ä»¤ï¼å¦ææ¯çè¯ï¼å°±ä½¿ç¨å¶ä»å½ä»¤æ¿ä»£æ¢æ¥è¯¢å½ä»¤ï¼æèæèåè®¡ç®å½ä»¤æ¾å¨å®¢æ·ç«¯åã\n 3. æ¯å¦å¯¹è¿ækeyè®¾ç½®äºç¸åçè¿ææ¶é´ï¼å¯¹äºæ¹éå é¤çkeyï¼å¯ä»¥å¨æ¯ä¸ªkeyçè¿ææ¶é´ä¸å ä¸ä¸ªéæºæ°ï¼é¿ååæ¶å é¤ã\n 4. æ¯å¦å­å¨bigkeyï¼ å¯¹äºbigkeyçå é¤æä½ï¼å¦æä½ çredisæ¯4.0åä»¥ä¸ççæ¬ï¼å¯ä»¥ç´æ¥å©ç¨å¼æ­¥çº¿ç¨æºå¶åå°ä¸»çº¿ç¨é»å¡ï¼å¦ææ¯redis 4.0ä»¥åççæ¬ï¼å¯ä»¥ä½¿ç¨scanå½ä»¤è¿­ä»£å é¤ï¼å¯¹äºbigkeyçéåæ¥è¯¢åèåæä½ï¼å¯ä»¥ä½¿ç¨scanå½ä»¤å¨å®¢æ·ç«¯å®æã\n 5. redis aoféç½®çº§å«æ¯ä»ä¹ï¼ä¸å¡å±é¢æ¯å¦çç¡®éè¦è¿ä¸å¯é æ§çº§å«ï¼å¦ææä»¬éè¦é«æ§è½ï¼åæ¶ä¹åè®¸æ°æ®ä¸¢å¤±ï¼å¯ä»¥å°éç½®é¡¹no-appendfsync-on-rewriteè®¾ç½®ä¸ºyesï¼é¿åaoféååfsyncç«äºç£çioèµæºï¼å¯¼è´rediså»¶è¿å¢å ãå½ç¶ï¼ å¦ææ¢éè¦é«æ§è½åéè¦é«å¯é æ§ï¼æå¥½ä½¿ç¨é«éåºæçä½ä¸ºaofæ¥å¿çåå¥çã\n 6. rediså®ä¾çåå­ä½¿ç¨æ¯å¦è¿å¤§ï¼åçswapäºåï¼å¦ææ¯çè¯ï¼å°±å¢å æºå¨åå­ï¼æèæ¯ä½¿ç¨rediséç¾¤ï¼åæåæºredisçé®å¼å¯¹æ°éååå­ååãåæ¶ï¼è¦é¿ååºç°redisåå¶ä»åå­éæ±å¤§çåºç¨å±äº«æºå¨çæåµã\n 7. å¨rediså®ä¾çè¿è¡ç¯å¢ä¸­ï¼æ¯å¦å¯ç¨äºéæå¤§é¡µæºå¶ï¼å¦ææ¯çè¯ï¼ç´æ¥å³é­åå­å¤§é¡µæºå¶å°±è¡äºã\n 8. æ¯å¦è¿è¡äºredisä¸»ä»éç¾¤ï¼å¦ææ¯çè¯ï¼æä¸»åºå®ä¾çæ°æ®éå¤§å°æ§å¶å¨2~4gbï¼ä»¥åä¸»ä»å¤å¶æ¶ï¼ä»åºå å è½½å¤§çrdbæä»¶èé»å¡ã\n 9. æ¯å¦ä½¿ç¨äºå¤æ ¸cpuænumaæ¶æçæºå¨è¿è¡rediså®ä¾ï¼ä½¿ç¨å¤æ ¸cpuæ¶ï¼å¯ä»¥ç»rediså®ä¾ç»å®ç©çæ ¸ï¼ä½¿ç¨numaæ¶ææ¶ï¼æ³¨æærediså®ä¾åç½ç»ä¸­æ­å¤çç¨åºè¿è¡å¨åä¸ä¸ªcpu socketä¸ã\n\nå®éä¸ï¼å½±åç³»ç»æ§è½çå ç´ è¿æå¾å¤ï¼è¿éè®²çåªæ¯æå¸¸è§é®é¢çè§£å³æ¹æ¡ã\n\nå¦æä½ éå°äºä¸äºç¹æ®æåµï¼ä¹ä¸è¦æï¼æåç»ä½ åäº«ä¸ä¸ªå°æå·§ï¼ä»ç»æ£æ¥ä¸ææ²¡ææ¼äººçé»å±ï¼å·ä½ç¹è¯´ï¼å°±æ¯redisæå¨çæºå¨ä¸ææ²¡æä¸äºå¶ä»å åå­ãç£çioåç½ç»ioçç¨åºï¼æ¯å¦è¯´æ°æ®åºç¨åºæèæ°æ®ééç¨åºãå¦ææçè¯ï¼æå»ºè®®ä½ å°è¿äºç¨åºè¿ç§»å°å¶ä»æºå¨ä¸è¿è¡ãä¸ºäºä¿è¯ redis é«æ§è½ï¼æä»¬éè¦ç» redis åè¶³çè®¡ç®ãåå­å io èµæºï¼ç»å®æä¾ä¸ä¸ªâå®éâçç¯å¢ã',charsets:{cjk:!0},lastUpdated:"2023/04/10, 13:35:58",lastUpdatedTimestamp:1681133758e3},{title:"Redis çåå­ç¢çãç¼å²åº",frontmatter:{title:"Redis çåå­ç¢çãç¼å²åº",date:"2023-04-09T17:15:43.000Z",permalink:"/pages/6135bf/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/20.Redis%20%E7%9A%84%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87%E3%80%81%E7%BC%93%E5%86%B2%E5%8C%BA.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/20.Redis çåå­ç¢çãç¼å²åº.md",key:"v-1a140cfc",path:"/pages/6135bf/",headers:[{level:2,title:"1. Redis çåå­ç¢çé®é¢",slug:"_1-redis-çåå­ç¢çé®é¢",normalizedTitle:"1. redis çåå­ç¢çé®é¢",charIndex:257},{level:3,title:"1.1 ä»ä¹æ¯åå­ç¢çï¼",slug:"_1-1-ä»ä¹æ¯åå­ç¢ç",normalizedTitle:"1.1 ä»ä¹æ¯åå­ç¢çï¼",charIndex:640},{level:3,title:"1.2 åå­ç¢çæ¯å¦ä½å½¢æçï¼",slug:"_1-2-åå­ç¢çæ¯å¦ä½å½¢æç",normalizedTitle:"1.2 åå­ç¢çæ¯å¦ä½å½¢æçï¼",charIndex:806},{level:4,title:"1.2.1 åå ï¼åå­åéå¨çåéç­ç¥",slug:"_1-2-1-åå -åå­åéå¨çåéç­ç¥",normalizedTitle:"1.2.1 åå ï¼åå­åéå¨çåéç­ç¥",charIndex:887},{level:4,title:"1.2.2 å¤å ï¼é®å¼å¯¹å¤§å°ä¸ä¸æ ·åå æ¹æä½",slug:"_1-2-2-å¤å -é®å¼å¯¹å¤§å°ä¸ä¸æ ·åå æ¹æä½",normalizedTitle:"1.2.2 å¤å ï¼é®å¼å¯¹å¤§å°ä¸ä¸æ ·åå æ¹æä½",charIndex:1401},{level:3,title:"1.3 å¦ä½å¤æ­æ¯å¦æåå­ç¢çï¼",slug:"_1-3-å¦ä½å¤æ­æ¯å¦æåå­ç¢ç",normalizedTitle:"1.3 å¦ä½å¤æ­æ¯å¦æåå­ç¢çï¼",charIndex:1966},{level:3,title:"1.4 å¦ä½æ¸çåå­ç¢çï¼",slug:"_1-4-å¦ä½æ¸çåå­ç¢ç",normalizedTitle:"1.4 å¦ä½æ¸çåå­ç¢çï¼",charIndex:2753},{level:4,title:"1.4.1 éå¯ Redis çæ¹æ³",slug:"_1-4-1-éå¯-redis-çæ¹æ³",normalizedTitle:"1.4.1 éå¯ redis çæ¹æ³",charIndex:2770},{level:4,title:"1.4.2 åå­ç¢çèªå¨æ¸ççæ¹æ³",slug:"_1-4-2-åå­ç¢çèªå¨æ¸ççæ¹æ³",normalizedTitle:"1.4.2 åå­ç¢çèªå¨æ¸ççæ¹æ³",charIndex:2996},{level:4,title:"1.4.3 åå­ç¢çèªå¨æ¸ççç¸å³åæ°",slug:"_1-4-3-åå­ç¢çèªå¨æ¸ççç¸å³åæ°",normalizedTitle:"1.4.3 åå­ç¢çèªå¨æ¸ççç¸å³åæ°",charIndex:3385},{level:3,title:"1.5 å°ç»",slug:"_1-5-å°ç»",normalizedTitle:"1.5 å°ç»",charIndex:4215},{level:2,title:"2. ç¼å²åºï¼ä¸ä¸ªå¯è½å¼åâæ¨æ¡âçå°æ¹",slug:"_2-ç¼å²åº-ä¸ä¸ªå¯è½å¼å-æ¨æ¡-çå°æ¹",normalizedTitle:"2. ç¼å²åºï¼ä¸ä¸ªå¯è½å¼åâæ¨æ¡âçå°æ¹",charIndex:4603},{level:3,title:"2.1 å®¢æ·ç«¯çè¾å¥åè¾åºç¼å²åº",slug:"_2-1-å®¢æ·ç«¯çè¾å¥åè¾åºç¼å²åº",normalizedTitle:"2.1 å®¢æ·ç«¯çè¾å¥åè¾åºç¼å²åº",charIndex:5103},{level:4,title:"2.1.1 å¦ä½åºå¯¹è¾å¥ç¼å²åºæº¢åºï¼",slug:"_2-1-1-å¦ä½åºå¯¹è¾å¥ç¼å²åºæº¢åº",normalizedTitle:"2.1.1 å¦ä½åºå¯¹è¾å¥ç¼å²åºæº¢åºï¼",charIndex:5368},{level:4,title:"2.1.2 å¦ä½åºå¯¹è¾åºç¼å²åºæº¢åºï¼",slug:"_2-1-2-å¦ä½åºå¯¹è¾åºç¼å²åºæº¢åº",normalizedTitle:"2.1.2 å¦ä½åºå¯¹è¾åºç¼å²åºæº¢åºï¼",charIndex:6883},{level:3,title:"2.2 ä¸»ä»éç¾¤ä¸­çç¼å²åº",slug:"_2-2-ä¸»ä»éç¾¤ä¸­çç¼å²åº",normalizedTitle:"2.2 ä¸»ä»éç¾¤ä¸­çç¼å²åº",charIndex:8639},{level:4,title:"2.2.1 å¨éå¤å¶æé´--å¤å¶ç¼å²åºçæº¢åºé®é¢",slug:"_2-2-1-å¨éå¤å¶æé´-å¤å¶ç¼å²åºçæº¢åºé®é¢",normalizedTitle:"2.2.1 å¨éå¤å¶æé´--å¤å¶ç¼å²åºçæº¢åºé®é¢",charIndex:8805},{level:4,title:"2.2.2 å¢éå¤å¶æé´--å¤å¶ç§¯åç¼å²åºçæº¢åºé®é¢",slug:"_2-2-2-å¢éå¤å¶æé´-å¤å¶ç§¯åç¼å²åºçæº¢åºé®é¢",normalizedTitle:"2.2.2 å¢éå¤å¶æé´--å¤å¶ç§¯åç¼å²åºçæº¢åºé®é¢",charIndex:10033},{level:3,title:"2.3 å°ç»",slug:"_2-3-å°ç»",normalizedTitle:"2.3 å°ç»",charIndex:10530}],headersStr:"1. Redis çåå­ç¢çé®é¢ 1.1 ä»ä¹æ¯åå­ç¢çï¼ 1.2 åå­ç¢çæ¯å¦ä½å½¢æçï¼ 1.2.1 åå ï¼åå­åéå¨çåéç­ç¥ 1.2.2 å¤å ï¼é®å¼å¯¹å¤§å°ä¸ä¸æ ·åå æ¹æä½ 1.3 å¦ä½å¤æ­æ¯å¦æåå­ç¢çï¼ 1.4 å¦ä½æ¸çåå­ç¢çï¼ 1.4.1 éå¯ Redis çæ¹æ³ 1.4.2 åå­ç¢çèªå¨æ¸ççæ¹æ³ 1.4.3 åå­ç¢çèªå¨æ¸ççç¸å³åæ° 1.5 å°ç» 2. ç¼å²åºï¼ä¸ä¸ªå¯è½å¼åâæ¨æ¡âçå°æ¹ 2.1 å®¢æ·ç«¯çè¾å¥åè¾åºç¼å²åº 2.1.1 å¦ä½åºå¯¹è¾å¥ç¼å²åºæº¢åºï¼ 2.1.2 å¦ä½åºå¯¹è¾åºç¼å²åºæº¢åºï¼ 2.2 ä¸»ä»éç¾¤ä¸­çç¼å²åº 2.2.1 å¨éå¤å¶æé´--å¤å¶ç¼å²åºçæº¢åºé®é¢ 2.2.2 å¢éå¤å¶æé´--å¤å¶ç§¯åç¼å²åºçæº¢åºé®é¢ 2.3 å°ç»",content:"> åèï¼\n> \n>  * 20 å é¤æ°æ®åï¼ä¸ºä»ä¹åå­å ç¨çè¿æ¯å¾é«ï¼| æå®¢æ¶é´\n>  * 21 ç¼å²åºï¼ä¸ä¸ªå¯è½å¼åâæ¨æ¡âçå°æ¹ | æå®¢æ¶é´\n\nRedis å å¶é«æ§è½èè¢«å¹¿æ³åºç¨ï¼æä»¬éè¦é¿åæ§è½å¼å¸¸çæåµåºç°ãå½±å Redis æ§è½ç 5 å¤§æ¹é¢å ç´ æï¼\n\n * Redis åé¨çé»å¡å¼æä½\n * CPU æ ¸å NUMA æ¶æçå½±å\n * Redis å³é®ç³»ç»éç½®\n * Redis åå­ç¢ç\n * Redis ç¼å²åº\n\nåé¢ä¸¤ç¯æç« åå«åæäºç¬¬ä¸äºä¸ªåç¬¬ä¸ä¸ªå ç´ ï¼æ¬æåæç¬¬åãäºä¸ªå ç´ ã\n\n\n# 1. Redis çåå­ç¢çé®é¢\n\nä½¿ç¨ Redis æ¶ç»å¸¸ä¼éå°è¿æ ·ä¸ä¸ªé®é¢ï¼ææåäºæ°æ®å é¤ï¼æ°æ®éå·²ç»ä¸å¤§äºï¼ä¸ºä»ä¹ä½¿ç¨topå½ä»¤æ¥çæ¶ï¼è¿ä¼åç°Rediså ç¨äºå¾å¤åå­å¢ï¼å®éä¸ï¼è¿æ¯å ä¸ºï¼å½æ°æ®å é¤åï¼Redis éæ¾çåå­ç©ºé´ä¼ç±åå­åéå¨ç®¡çï¼å¹¶ä¸ä¼ç«å³è¿åç»æä½ç³»ç»ãæä»¥ï¼æä½ç³»ç»ä»ç¶ä¼è®°å½çç»Redisåéäºå¤§éåå­ã\n\nä½æ¯ï¼è¿å¾å¾ä¼ä¼´éä¸ä¸ªæ½å¨çé£é©ç¹ï¼Redis éæ¾çåå­ç©ºé´å¯è½å¹¶ä¸æ¯è¿ç»­çï¼é£ä¹ï¼è¿äºä¸è¿ç»­çåå­ç©ºé´å¾æå¯è½å¤äºä¸ç§é²ç½®çç¶æãè¿å°±ä¼å¯¼è´ä¸ä¸ªé®é¢ï¼è½ç¶æç©ºé²ç©ºé´ï¼Rediså´æ æ³ç¨æ¥ä¿å­æ°æ®ï¼ä¸ä»ä¼åå°Redisè½å¤å®éä¿å­çæ°æ®éï¼è¿ä¼éä½Redisè¿è¡æºå¨çææ¬åæ¥çã\n\nè¿ä¸èå°è®¨è®ºä¸ä¸ Redis çåå­ç©ºé´å­å¨æçé®é¢ï¼æ¢ç´¢ä¸ä¸ï¼ä¸ºä»ä¹æ°æ®å·²ç»å é¤äºï¼ä½åå­å´é²ç½®çæ²¡æç¨ï¼ä»¥åç¸åºçè§£å³æ¹æ¡ã\n\n\n# 1.1 ä»ä¹æ¯åå­ç¢çï¼\n\néå¸¸æåµä¸ï¼åå­ç©ºé´é²ç½®ï¼å¾å¾æ¯å ä¸ºæä½ç³»ç»åçäºè¾ä¸ºä¸¥éçåå­ç¢çï¼å¯¼è´æ æ³ç»§ç»­åéä¸åè¿ç»­ç©ºé´ã\n\nåå­ç¢çï¼åå­ä¸­è¿æ 5KB çç©ºä½ï¼ä½é½æ¯é¶æ£å¨ä¸åå°æ¹ï¼æ æ³æ»¡è¶³âç³è¯·ä¸åè¿ç»­ 2KB ç©ºé´âçè¦æ±ã\n\nç±»ä¼¼äº3ä¸ªäººæ³ä¹°è¿ççç«è½¦ç¥¨ï¼ä½æ­¤æ¶è½¦ä¸åªæä¸è¿ç»­çä¸ä¸ªç©ºåº§ä½ï¼å æ­¤å°±æ¢è¶è½¦äºã\n\n\n# 1.2 åå­ç¢çæ¯å¦ä½å½¢æçï¼\n\nå¶å®ï¼åå­ç¢ççå½¢ææåå åå¤å ä¸¤ä¸ªå±é¢çåå ãç®åæ¥è¯´ï¼åå æ¯æä½ç³»ç»çåå­åéæºå¶ï¼å¤å æ¯ Redis çè´è½½ç¹å¾ã\n\n# 1.2.1 åå ï¼åå­åéå¨çåéç­ç¥\n\nåå­åéå¨çåéç­ç¥å°±å³å®äºæä½ç³»ç»æ æ³åå°âæéåéâãè¿æ¯å ä¸ºï¼åå­åéå¨ä¸è¬æ¯æåºå®å¤§å°æ¥åéåå­ï¼èä¸æ¯å®å¨æç§åºç¨ç¨åºç³è¯·çåå­ç©ºé´å¤§å°ç»ç¨åºåéã\n\nRediså¯ä»¥ä½¿ç¨libcãjemallocãtcmallocå¤ç§åå­åéå¨æ¥åéåå­ï¼é»è®¤ä½¿ç¨jemallocãæ¥ä¸æ¥ï¼æå°±ä»¥jemallocä¸ºä¾ï¼æ¥å·ä½è§£éä¸ä¸ãå¶ä»åéå¨ä¹å­å¨ç±»ä¼¼çé®é¢ã\n\njemallocçåéç­ç¥ä¹ä¸ï¼æ¯æç§ä¸ç³»ååºå®çå¤§å°åååå­ç©ºé´ï¼ä¾å¦8å­èã16å­èã32å­èã48å­èï¼â¦, 2KBã4KBã8KBç­ãå½ç¨åºç³è¯·çåå­ææ¥è¿æä¸ªåºå®å¼æ¶ï¼jemallocä¼ç»å®åéç¸åºå¤§å°çç©ºé´ã\n\nè¿æ ·çåéæ¹å¼æ¬èº«æ¯ä¸ºäºåå°åéæ¬¡æ°ãä¾å¦ï¼Redisç³è¯·ä¸ä¸ª20å­èçç©ºé´ä¿å­æ°æ®ï¼jemallocå°±ä¼åé32å­èï¼æ­¤æ¶ï¼å¦æåºç¨è¿è¦åå¥10å­èçæ°æ®ï¼Rediså°±ä¸ç¨ååæä½ç³»ç»ç³è¯·ç©ºé´äºï¼å ä¸ºåæåéç32å­èå·²ç»å¤ç¨äºï¼è¿å°±é¿åäºä¸æ¬¡åéæä½ã\n\nä½æ¯ï¼å¦æ Redis æ¯æ¬¡ååéå¨ç³è¯·çåå­ç©ºé´å¤§å°ä¸ä¸æ ·ï¼è¿ç§åéæ¹å¼å°±ä¼æå½¢æç¢ççé£é©ï¼èè¿æ­£å¥½æ¥æºäº Redis çå¤å äºã\n\n# 1.2.2 å¤å ï¼é®å¼å¯¹å¤§å°ä¸ä¸æ ·åå æ¹æä½\n\nç¬¬ä¸ä¸ªå¤å ï¼\n\nRedis éå¸¸ä½ä¸ºå±ç¨çç¼å­ç³»ç»æé®å¼æ°æ®åºå¯¹å¤æä¾æå¡ï¼æä»¥ï¼ä¸åä¸å¡åºç¨çæ°æ®é½å¯è½ä¿å­å¨ Redis ä¸­ï¼è¿å°±ä¼å¸¦æ¥ä¸åå¤§å°çé®å¼å¯¹ãä½åå­åéå¨åªè½æåºå®å¤§å°åéåå­ï¼æä»¥ï¼åéçåå­ç©ºé´ä¸è¬é½ä¼æ¯ç³è¯·çç©ºé´å¤§ä¸äºï¼ä¸ä¼å®å¨ä¸è´ï¼è¿æ¬èº«å°±ä¼é æä¸å®çç¢çï¼éä½åå­ç©ºé´å­å¨æçã\n\nç¬¬äºä¸ªå¤å ï¼\n\nç¬¬äºä¸ªå¤å æ¯ï¼è¿äºé®å¼å¯¹ä¼è¢«ä¿®æ¹åå é¤ï¼è¿ä¼å¯¼è´ç©ºé´çæ©å®¹åéæ¾ãå·ä½æ¥è¯´ï¼ä¸æ¹é¢ï¼å¦æä¿®æ¹åçé®å¼å¯¹åå¤§æåå°äºï¼å°±éè¦å ç¨é¢å¤çç©ºé´æèéæ¾ä¸ç¨çç©ºé´ãå¦ä¸æ¹é¢ï¼å é¤çé®å¼å¯¹å°±ä¸åéè¦åå­ç©ºé´äºï¼æ­¤æ¶ï¼å°±ä¼æç©ºé´éæ¾åºæ¥ï¼å½¢æç©ºé²ç©ºé´ã\n\nä½è¿æ ·é¢ç¹æä½åï¼ä¼å½¢æå¾å¤ç¢çç©ºé´ï¼å®ä»¬ä¸æ¯è¿ç»­çï¼å¯¼è´é¾ä»¥è¢«å©ç¨ãå¦ä¸å¾ï¼\n\n----------------------------------------\n\nå¥½äºï¼å°è¿éï¼æä»¬å°±ç¥éäºé æåå­ç¢ççåå¤å ç´ ï¼å¶ä¸­ï¼åå­åéå¨ç­ç¥æ¯åå ï¼èRedisçè´è½½å±äºå¤å ï¼åæ¬äºå¤§å°ä¸ä¸çé®å¼å¯¹åé®å¼å¯¹ä¿®æ¹å é¤å¸¦æ¥çåå­ç©ºé´ååã\n\nå¤§éåå­ç¢ççå­å¨ï¼ä¼é æ Redis çåå­å®éå©ç¨çåä½ï¼æ¥ä¸æ¥ï¼æä»¬å°±è¦æ¥è§£å³è¿ä¸ªé®é¢äºãä¸è¿ï¼å¨è§£å³é®é¢åï¼æä»¬è¦åå¤æ­ Redis è¿è¡è¿ç¨ä¸­æ¯å¦å­å¨åå­ç¢çã\n\n\n# 1.3 å¦ä½å¤æ­æ¯å¦æåå­ç¢çï¼\n\nä¸ºäºè®©ç¨æ·è½çæ§å°å®æ¶çåå­ä½¿ç¨æåµï¼Redis èªèº«æä¾äº INFO å½ä»¤ï¼å¯ä»¥ç¨æ¥æ¥è¯¢åå­ä½¿ç¨çè¯¦ç»ä¿¡æ¯ï¼å½ä»¤å¦ä¸ï¼\n\nINFO memory\n# Memory\nused_memory:1073741736\nused_memory_human:1024.00M\nused_memory_rss:1997159792\nused_memory_rss_human:1.86G\nâ¦\nmem_fragmentation_ratio:1.86\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nè¿éæä¸ä¸ª mem_fragmentation_ratio çææ ï¼å®è¡¨ç¤ºçå°±æ¯ Redis å½åçåå­ç¢ççãé£ä¹ï¼è¿ä¸ªç¢ççæ¯æä¹è®¡ç®çå¢ï¼å¶å®ï¼å°±æ¯ä¸é¢çå½ä»¤ä¸­çä¸¤ä¸ªææ used_memory_rssåused_memoryç¸é¤çç»æï¼\n\nmem_fragmentation_ratio = used_memory_rss/ used_memory\n\n\n1\n\n * used_memory_rss æ¯æä½ç³»ç»å®éåéç»Redisçç©çåå­ç©ºé´ï¼éé¢å°±åå«äºç¢çï¼\n * used_memory æ¯ Redis ä¸ºäºä¿å­æ°æ®å®éç³è¯·ä½¿ç¨çç©ºé´ã\n\nè¿ä¸ªææ å¦ä½ä½¿ç¨å¢ï¼è¿éæä¸äºç»éªéå¼ï¼\n\n * mem_fragmentation_ratio å¤§äº 1 ä½å°äº 1.5ãè¿ç§æåµæ¯åççãè¿æ¯å ä¸ºï¼åææä»ç»çé£äºå ç´ æ¯é¾ä»¥é¿åçãæ¯ç«ï¼åå çåå­åéå¨æ¯ä¸å®è¦ä½¿ç¨çï¼åéç­ç¥é½æ¯éç¨çï¼ä¸ä¼è½»æä¿®æ¹ï¼èå¤å ç±Redisè´è½½å³å®ï¼ä¹æ æ³éå¶ãæä»¥ï¼å­å¨åå­ç¢çä¹æ¯æ­£å¸¸çã\n * mem_fragmentation_ratio å¤§äº 1.5 ãè¿è¡¨æåå­ç¢ççå·²ç»è¶è¿äº50%ãä¸è¬æåµä¸ï¼è¿ä¸ªæ¶åï¼æä»¬å°±éè¦éåä¸äºæªæ½æ¥éä½åå­ç¢ççäºã\n\n\n# 1.4 å¦ä½æ¸çåå­ç¢çï¼\n\n# 1.4.1 éå¯ Redis çæ¹æ³\n\nå½ Redis åçåå­ç¢çåï¼ä¸ä¸ªâç®åç²æ´âçæ¹æ³å°±æ¯éå¯Rediså®ä¾ãå½ç¶ï¼è¿å¹¶ä¸æ¯ä¸ä¸ªâä¼éâçæ¹æ³ï¼æ¯ç«ï¼éå¯ Redis ä¼å¸¦æ¥ä¸¤ä¸ªåæï¼\n\n * å¦æ Redis ä¸­çæ°æ®æ²¡ææä¹åï¼é£ä¹ï¼æ°æ®å°±ä¼ä¸¢å¤±ï¼\n * å³ä½¿ Redis æ°æ®æä¹åäºï¼æä»¬è¿éè¦éè¿ AOF æ RDB è¿è¡æ¢å¤ï¼æ¢å¤æ¶é¿åå³äº AOF æ RDB çå¤§å°ï¼å¦æåªæä¸ä¸ª Redis å®ä¾ï¼æ¢å¤é¶æ®µæ æ³æä¾æå¡ã\n\n# 1.4.2 åå­ç¢çèªå¨æ¸ççæ¹æ³\n\næä»¥ï¼è¿æä»ä¹å¶ä»å¥½åæ³åï¼å¹¸è¿çæ¯ï¼ä» 4.0-RC3 çæ¬ä»¥åï¼Redis èªèº«æä¾äºä¸ç§åå­ç¢çèªå¨æ¸ççæ¹æ³ï¼æä»¬åæ¥çè¿ä¸ªæ¹æ³çåºæ¬æºå¶ï¼âæ¬å®¶è®©ä½ï¼åå¹¶ç©ºé´âï¼ç¨ä¸å¼ å¾æ¥è§£éå°±æ¯ï¼\n\nä»¥ååçé«éçä¾å­æ¥çï¼å°±æ¯ä¸ä¸ªäººä¹°äºä¸å¨ä¸èµ·çè½¦ç¥¨ï¼ä¸è½¦ä¹ååå«äººè°æ¢ä½ä¸ºï¼åå¨äºä¸èµ·ã\n\nå½ç¶ï¼å¦ææ°æ®æ·è´åï¼å¹¶æ²¡æå½¢æè¿ç»­çåå­ç©ºé´ï¼è¿å°±ä¸è½ç®æ¯æ¸çäºã\n\nä¸è¿éè¦æ³¨æï¼ç¢çæ¸çæ¯æä»£ä»·çï¼æä½ç³»ç»éè¦æå¤ä»½æ°æ®æ·è´å°æ°ä½ç½®ï¼æåæç©ºé´éæ¾åºæ¥ï¼è¿ä¼å¸¦æ¥æ¶é´å¼éï¼ä¼é»å¡ Redis ççº¿ç¨ã\n\næä»ä¹åæ³å¯ä»¥å°½éç¼è§£è¿ä¸ªé®é¢åï¼è¿å°±è¦æå° Redis ä¸é¨ä¸ºèªå¨åå­ç¢çæ¸çæºå¶è®¾ç½®çåæ°äºãæä»¬å¯ä»¥éè¿è®¾ç½®åæ°ï¼æ¥æ§å¶ç¢çæ¸ççå¼å§åç»ææ¶æºï¼ä»¥åå ç¨çCPUæ¯ä¾ï¼ä»èåå°ç¢çæ¸çå¯¹ Redis æ¬èº«è¯·æ±å¤ççæ§è½å½±åã\n\n# 1.4.3 åå­ç¢çèªå¨æ¸ççç¸å³åæ°\n\né¦åï¼Redis éè¦å¯ç¨èªå¨åå­ç¢çæ¸çï¼å¯ä»¥æ activedefrag éç½®é¡¹è®¾ç½®ä¸º yesï¼å½ä»¤å¦ä¸ï¼\n\nconfig set activedefrag yes\n\n\n1\n\n\nè¿ä¸ªå½ä»¤åªæ¯å¯ç¨äºèªå¨æ¸çåè½ï¼ä½æ¯ï¼å·ä½ä»ä¹æ¶åæ¸çï¼ä¼åå°ä¸é¢è¿ä¸¤ä¸ªåæ°çæ§å¶ãè¿ä¸¤ä¸ªåæ°åå«è®¾ç½®äºè§¦ååå­æ¸ççä¸ä¸ªæ¡ä»¶ï¼å¦æåæ¶æ»¡è¶³è¿ä¸¤ä¸ªæ¡ä»¶ï¼å°±å¼å§æ¸çãå¨æ¸ççè¿ç¨ä¸­ï¼åªè¦æä¸ä¸ªæ¡ä»¶ä¸æ»¡è¶³äºï¼å°±åæ­¢èªå¨æ¸çï¼\n\n * active-defrag-ignore-bytes 100mbï¼è¡¨ç¤ºåå­ç¢ççå­èæ°è¾¾å°100MBæ¶ï¼å¼å§æ¸çï¼\n * active-defrag-threshold-lower 10ï¼è¡¨ç¤ºåå­ç¢çç©ºé´å æä½ç³»ç»åéç»Redisçæ»ç©ºé´æ¯ä¾è¾¾å°10%æ¶ï¼å¼å§æ¸çã\n\nä¸ºäºå°½å¯è½åå°ç¢çæ¸çå¯¹ Redis æ­£å¸¸è¯·æ±å¤ççå½±åï¼èªå¨åå­ç¢çæ¸çåè½å¨æ§è¡æ¶ï¼è¿ä¼çæ§æ¸çæä½å ç¨ç CPU æ¶é´ï¼èä¸è¿è®¾ç½®äºä¸¤ä¸ªåæ°ï¼åå«ç¨äºæ§å¶æ¸çæä½å ç¨çCPUæ¶é´æ¯ä¾çä¸ãä¸éï¼æ¢ä¿è¯æ¸çå·¥ä½è½æ­£å¸¸è¿è¡ï¼åé¿åäºéä½ Redis æ§è½ãè¿ä¸¤ä¸ªåæ°å·ä½å¦ä¸ï¼\n\n * active-defrag-cycle-min 25ï¼ è¡¨ç¤ºèªå¨æ¸çè¿ç¨æç¨CPUæ¶é´çæ¯ä¾ä¸ä½äº25%ï¼ä¿è¯æ¸çè½æ­£å¸¸å¼å±ï¼\n * active-defrag-cycle-max 75ï¼è¡¨ç¤ºèªå¨æ¸çè¿ç¨æç¨CPUæ¶é´çæ¯ä¾ä¸é«äº75%ï¼ä¸æ¦è¶è¿ï¼å°±åæ­¢æ¸çï¼ä»èé¿åå¨æ¸çæ¶ï¼å¤§éçåå­æ·è´é»å¡Redisï¼å¯¼è´ååºå»¶è¿åé«ã\n\nèªå¨åå­ç¢çæ¸çæºå¶å¨æ§å¶ç¢çæ¸çå¯åçæ¶æºä¸ï¼æ¢èèäºç¢ççç©ºé´å æ¯ãå¯¹ Redis åå­ä½¿ç¨æççå½±åï¼è¿èèäºæ¸çæºå¶æ¬èº«ç CPU æ¶é´å æ¯ãå¯¹ Redis æ§è½çå½±åãèä¸ï¼æ¸çæºå¶è¿æä¾äº 4 ä¸ªåæ°ï¼è®©æä»¬å¯ä»¥æ ¹æ®å®éåºç¨ä¸­çæ°æ®ééæ±åæ§è½è¦æ±çµæ´»ä½¿ç¨ï¼å»ºè®®ä½ å¨å®è·µä¸­å¥½å¥½å°æè¿ä¸ªæºå¶ç¨èµ·æ¥ã\n\n\n# 1.5 å°ç»\n\nè¿ä¸å¤§èä¸»è¦äºè§£äº Redis çåå­ç©ºé´æçé®é¢ï¼è¿éé¢çä¸ä¸ªå³é®ææ¯ç¹å°±æ¯è¦è¯å«åå¤çåå­ç¢çï¼\n\n * info memory å½ä»¤æ¯ä¸ä¸ªå¥½å·¥å·ï¼å¯ä»¥å¸®å©ä½ æ¥çç¢çççæåµï¼\n * ç¢ççéå¼æ¯ä¸ä¸ªå¥½ç»éªï¼å¯ä»¥å¸®å¿ä½ ææå°å¤æ­æ¯å¦è¦è¿è¡ç¢çæ¸çäºï¼\n * åå­ç¢çèªå¨æ¸çæ¯ä¸ä¸ªå¥½æ¹æ³ï¼å¯ä»¥é¿åå ä¸ºç¢çå¯¼è´ Redis çåå­å®éå©ç¨çéä½ï¼æåææ¬æ¶ççã\n\nåå­ç¢çå¹¶ä¸å¯æï¼æä»¬è¦åçå°±æ¯äºè§£å®ï¼éè§å®ï¼å¹¶åç¨é«æçæ¹æ³è§£å³å®ã\n\næåï¼æåç»ä½ æä¾ä¸ä¸ªå°è´´å£«ï¼åå­ç¢çèªå¨æ¸çæ¶ååå­æ·è´ï¼è¿å¯¹Redisèè¨ï¼æ¯ä¸ªæ½å¨çé£é©ãå¦æä½ å¨å®è·µè¿ç¨ä¸­éå°Redisæ§è½åæ¢ï¼è®°å¾éè¿æ¥å¿çä¸æ¯å¦æ­£å¨è¿è¡ç¢çæ¸çãå¦æRedisçç¡®æ­£å¨æ¸çç¢çï¼é£ä¹ï¼æå»ºè®®ä½ è°å°active-defrag-cycle-maxçå¼ï¼ä»¥åè½»å¯¹æ­£å¸¸è¯·æ±å¤ççå½±åã\n\n\n# 2. ç¼å²åºï¼ä¸ä¸ªå¯è½å¼åâæ¨æ¡âçå°æ¹\n\nç¼å²åºçåè½å¶å®å¾ç®åï¼ä¸»è¦å°±æ¯ç¨ä¸ååå­ç©ºé´æ¥ææ¶å­æ¾å½ä»¤æ°æ®ï¼ä»¥ååºç°å ä¸ºæ°æ®åå½ä»¤çå¤çéåº¦æ¢äºåééåº¦èå¯¼è´çæ°æ®ä¸¢å¤±åæ§è½é®é¢ãä½å ä¸ºç¼å²åºçåå­ç©ºé´æéï¼å¦æå¾éé¢åå¥æ°æ®çéåº¦æç»­å°å¤§äºä»éé¢è¯»åæ°æ®çéåº¦ï¼å°±ä¼å¯¼è´ç¼å²åºéè¦è¶æ¥è¶å¤çåå­æ¥æå­æ°æ®ãå½ç¼å²åºå ç¨çåå­è¶åºäºè®¾å®çä¸ééå¼æ¶ï¼å°±ä¼åºç°ç¼å²åºæº¢åºãå¦æåçäºæº¢åºï¼å°±ä¼ä¸¢æ°æ®äºã\n\n> å¯ä»¥ä¸ç»ç¼å²åºçå¤§å°è®¾ç½®ä¸éåï¼æ¾ç¶ä¸è¡ï¼éçç´¯ç§¯çæ°æ®è¶æ¥è¶å¤ï¼ç¼å²åºå ç¨åå­ç©ºé´è¶æ¥è¶å¤§ï¼ä¸æ¦èå°½äºRediså®ä¾æå¨æºå¨çå¯ç¨åå­ï¼å°±ä¼å¯¼è´Rediså®ä¾å´©æºã æä»¥æ¯«ä¸å¤¸å¼ å°è¯´ï¼ç¼å²åºæ¯ç¨æ¥é¿åè¯·æ±ææ°æ®ä¸¢å¤±çæ¨æ¡çï¼ä½ä¹åªæç¨å¯¹äºï¼æè½çæ­£èµ·å°âé¿åâçä½ç¨ã\n\nRedis çä¸¤ä¸ªåºç¨åºæ¯ï¼\n\n * å¨ client å server è¿è¡éä¿¡æ¶ï¼ç¨æ¥æå­å®¢æ·ç«¯åéçå½ä»¤æ°æ®ï¼æèæ¯æå¡å¨ç«¯è¿åç»å®¢æ·ç«¯çæ°æ®ç»æã\n * å¨ä¸»ä»èç¹é´è¿è¡æ°æ®åæ­¥æ¶ï¼ç¨æ¥æå­ä¸»èç¹æ¥æ¶çåå½ä»¤åæ°æ®ã\n\nè¿ä¸å¤§èå°åå«èèæå¡å¨ç«¯åå®¢æ·ç«¯ãä¸»ä»éç¾¤é´çç¼å²åºæº¢åºé®é¢ï¼ä»¥ååºå¯¹æ¹æ¡ã\n\n\n# 2.1 å®¢æ·ç«¯çè¾å¥åè¾åºç¼å²åº\n\næä»¬åæ¥ççæå¡å¨ç«¯åå®¢æ·ç«¯ä¹é´çç¼å²åºã\n\nä¸ºäºé¿åå®¢æ·ç«¯åæå¡å¨ç«¯çè¯·æ±åéåå¤çéåº¦ä¸å¹éï¼æå¡å¨ç«¯ç»æ¯ä¸ªè¿æ¥çå®¢æ·ç«¯é½è®¾ç½®äºä¸ä¸ªè¾å¥ç¼å²åºåè¾åºç¼å²åºï¼æä»¬ç§°ä¹ä¸ºå®¢æ·ç«¯è¾å¥ç¼å²åºåè¾åºç¼å²åºã\n\nè¾å¥ç¼å²åºä¼åæå®¢æ·ç«¯åéè¿æ¥çå½ä»¤æå­èµ·æ¥ï¼Redisä¸»çº¿ç¨åä»è¾å¥ç¼å²åºä¸­è¯»åå½ä»¤ï¼è¿è¡å¤çãå½Redisä¸»çº¿ç¨å¤çå®æ°æ®åï¼ä¼æç»æåå¥å°è¾åºç¼å²åºï¼åéè¿è¾åºç¼å²åºè¿åç»å®¢æ·ç«¯ï¼å¦ä¸å¾æç¤ºï¼\n\nä¸é¢ï¼æä»¬å°±åå«å­¦ä¹ ä¸è¾å¥ç¼å²åºåè¾åºç¼å²åºåçæº¢åºçæåµï¼ä»¥åç¸åºçåºå¯¹æ¹æ¡ã\n\n# 2.1.1 å¦ä½åºå¯¹è¾å¥ç¼å²åºæº¢åºï¼\n\nè¾å¥ç¼å²åºå°±æ¯ç¨æ¥æå­å®¢æ·ç«¯åéçè¯·æ±å½ä»¤çï¼æä»¥å¯è½å¯¼è´æº¢åºçæåµä¸»è¦æ¯ä¸é¢ä¸¤ç§ï¼\n\n * åå¥äº bigkeyï¼æ¯å¦ä¸ä¸å­åå¥äºå¤ä¸ªç¾ä¸çº§å«çéåç±»åæ°æ®ï¼\n * æå¡å¨ç«¯å¤çè¯·æ±çéåº¦è¿æ¢ï¼ä¾å¦ï¼Redis ä¸»çº¿ç¨åºç°äºé´æ­æ§é»å¡ï¼æ æ³åæ¶å¤çæ­£å¸¸åéçè¯·æ±ï¼å¯¼è´å®¢æ·ç«¯åéçè¯·æ±å¨ç¼å²åºè¶ç§¯è¶å¤ã\n\næ¥ä¸æ¥å°æ¢è®¨å¦ä½æ¥çè¾å¥ç¼å²åºçåå­ä½¿ç¨æåµãå¦ä½é¿åæº¢åºè¿ä¸¤ä¸ªé®é¢ã\n\n----------------------------------------\n\nå¦ä½æ¥çè¾å¥ç¼å²åºçåå­ä½¿ç¨æåµï¼è¿å¯ä»¥ä½¿ç¨ CLIENT LIST å½ä»¤ï¼\n\nCLIENT LIST\nid=5 addr=127.0.0.1:50487 fd=9 name= age=4 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=26 qbuf-free=32742 obl=0 oll=0 omem=0 events=r cmd=client\n\n\n1\n2\n\n\næä»¬åªéè¦éç¹å³æ³¨å¶ä¸­çä¸¤ç±»ä¿¡æ¯ï¼\n\n * ä¸ç±»æ¯ä¸æå¡å¨ç«¯è¿æ¥çå®¢æ·ç«¯çä¿¡æ¯ãè¿ä¸ªæ¡ä¾å±ç¤ºçæ¯ä¸ä¸ªå®¢æ·ç«¯çè¾å¥ç¼å²åºæåµï¼å¦ææå¤ä¸ªå®¢æ·ç«¯ï¼è¾åºç»æä¸­çaddrä¼æ¾ç¤ºä¸åå®¢æ·ç«¯çIPåç«¯å£å·ã\n * å¦ä¸ç±»æ¯ä¸è¾å¥ç¼å²åºç¸å³çä¸ä¸ªåæ°ï¼\n   * cmdï¼è¡¨ç¤ºå®¢æ·ç«¯ææ°æ§è¡çå½ä»¤ãè¿ä¸ªä¾å­ä¸­æ§è¡çæ¯CLIENTå½ä»¤ã\n   * qbufï¼è¡¨ç¤ºè¾å¥ç¼å²åºå·²ç»ä½¿ç¨çå¤§å°ãè¿ä¸ªä¾å­ä¸­çCLIENTå½ä»¤å·²ä½¿ç¨äº26å­èå¤§å°çç¼å²åºã\n   * qbuf-freeï¼è¡¨ç¤ºè¾å¥ç¼å²åºå°æªä½¿ç¨çå¤§å°ãè¿ä¸ªä¾å­ä¸­çCLIENTå½ä»¤è¿å¯ä»¥ä½¿ç¨32742å­èçç¼å²åºãqbufåqbuf-freeçæ»åå°±æ¯ï¼Redisæå¡å¨ç«¯å½åä¸ºå·²è¿æ¥çè¿ä¸ªå®¢æ·ç«¯åéçç¼å²åºæ»å¤§å°ãè¿ä¸ªä¾å­ä¸­æ»å±åéäº 26 + 32742 = 32768å­èï¼ä¹å°±æ¯32KBçç¼å²åºã\n\næäºCLIENT LISTå½ä»¤ï¼æä»¬å°±å¯ä»¥éè¿è¾åºç»ææ¥å¤æ­å®¢æ·ç«¯è¾å¥ç¼å²åºçåå­å ç¨æåµäºãå¦æqbufå¾å¤§ï¼èåæ¶qbuf-freeå¾å°ï¼å°±è¦å¼èµ·æ³¨æäºï¼å ä¸ºè¿æ¶åè¾å¥ç¼å²åºå·²ç»å ç¨äºå¾å¤åå­ï¼èä¸æ²¡æä»ä¹ç©ºé²ç©ºé´äºãæ­¤æ¶ï¼å®¢æ·ç«¯ååå¥å¤§éå½ä»¤çè¯ï¼å°±ä¼å¼èµ·å®¢æ·ç«¯è¾å¥ç¼å²åºæº¢åºï¼Redisçå¤çåæ³å°±æ¯æå®¢æ·ç«¯è¿æ¥å³é­ï¼ç»æå°±æ¯ä¸å¡ç¨åºæ æ³è¿è¡æ°æ®å­åäºã\n\néå¸¸æåµä¸ï¼Redisæå¡å¨ç«¯ä¸æ­¢æå¡ä¸ä¸ªå®¢æ·ç«¯ï¼å½å¤ä¸ªå®¢æ·ç«¯è¿æ¥å ç¨çåå­æ»éï¼è¶è¿äºRedisçmaxmemoryéç½®é¡¹æ¶ï¼ä¾å¦4GBï¼ï¼å°±ä¼è§¦åRedisè¿è¡æ°æ®æ·æ±°ãä¸æ¦æ°æ®è¢«æ·æ±°åºRedisï¼åè¦è®¿é®è¿é¨åæ°æ®ï¼å°±éè¦å»åç«¯æ°æ®åºè¯»åï¼è¿å°±éä½äºä¸å¡åºç¨çè®¿é®æ§è½ãæ­¤å¤ï¼æ´ç³ç³çæ¯ï¼å¦æä½¿ç¨å¤ä¸ªå®¢æ·ç«¯ï¼å¯¼è´Redisåå­å ç¨è¿å¤§ï¼ä¹ä¼å¯¼è´åå­æº¢åºï¼out-of-memoryï¼é®é¢ï¼è¿èä¼å¼èµ·Rediså´©æºï¼ç»ä¸å¡åºç¨é æä¸¥éå½±åã\n\nRedisçå®¢æ·ç«¯è¾å¥ç¼å²åºå¤§å°çä¸ééå¼ï¼å¨ä»£ç ä¸­å°±è®¾å®ä¸ºäº1GBãä¹å°±æ¯è¯´ï¼Redisæå¡å¨ç«¯åè®¸ä¸ºæ¯ä¸ªå®¢æ·ç«¯æå¤æå­1GBçå½ä»¤åæ°æ®ã1GBçå¤§å°ï¼å¯¹äºä¸è¬ççäº§ç¯å¢å·²ç»æ¯æ¯è¾åéçäºãä¸æ¹é¢ï¼è¿ä¸ªå¤§å°å¯¹äºå¤çç»å¤§é¨åå®¢æ·ç«¯çè¯·æ±å·²ç»å¤ç¨äºï¼å¦ä¸æ¹é¢ï¼å¦æåå¤§çè¯ï¼Rediså°±æå¯è½å ä¸ºå®¢æ·ç«¯å ç¨äºè¿å¤çåå­èµæºèå´©æºãæä»¥ï¼Rediså¹¶æ²¡ææä¾åæ°è®©æä»¬è°èå®¢æ·ç«¯è¾å¥ç¼å²åºçå¤§å°ãå¦æè¦é¿åè¾å¥ç¼å²åºæº¢åºï¼é£æä»¬å°±åªè½ä»æ°æ®å½ä»¤çåéåå¤çéåº¦å¥æï¼ä¹å°±æ¯åé¢æå°çé¿åå®¢æ·ç«¯åå¥bigkeyï¼ä»¥åé¿åRedisä¸»çº¿ç¨é»å¡ã\n\n# 2.1.2 å¦ä½åºå¯¹è¾åºç¼å²åºæº¢åºï¼\n\nRedis çè¾åºç¼å²åºæå­çæ¯ Redis ä¸»çº¿ç¨è¦è¿åç»å®¢æ·ç«¯çæ°æ®ãä¸è¬æ¥è¯´ï¼ä¸»çº¿ç¨è¿åç»å®¢æ·ç«¯çæ°æ®ï¼æ¢æç®åä¸å¤§å°åºå®ç OK ååºï¼ä¾å¦ï¼æ§è¡ SET å½ä»¤ï¼ææ¥éä¿¡æ¯ï¼ä¹æå¤§å°ä¸åºå®çãåå«å·ä½æ°æ®çæ§è¡ç»æï¼ä¾å¦ï¼æ§è¡ HGET å½ä»¤ï¼ã\n\nå æ­¤ï¼Redis ä¸ºæ¯ä¸ªå®¢æ·ç«¯è®¾ç½®çè¾åºç¼å²åºä¹åæ¬ä¸¤é¨åï¼ä¸é¨åï¼æ¯ä¸ä¸ªå¤§å°ä¸º 16KB çåºå®ç¼å²ç©ºé´ï¼ç¨æ¥æå­ OK ååºååºéä¿¡æ¯ï¼å¦ä¸é¨åï¼æ¯ä¸ä¸ªå¯ä»¥å¨æå¢å çç¼å²ç©ºé´ï¼ç¨æ¥æå­å¤§å°å¯åçååºç»æã\n\næä¸ç§æåµå¯è½åçè¾åºç¼å²åºæº¢åºï¼\n\n * æå¡å¨ç«¯è¿å bigkey çå¤§éç»æï¼\n * æ§è¡äº MONITOR å½ä»¤ï¼\n * ç¼å²åºå¤§å°è®¾ç½®å¾ä¸åçã\n\nMONITOR å½ä»¤æ§è¡åä¼æç»­è¾åºçæµå°çåä¸ªå½ä»¤æä½ï¼å¶è¾åºç»æä¼å ç¨è¾åºç¼å²åºï¼ä»èå¯è½åçæº¢åºãå æ­¤ï¼MONITOR å½ä»¤ä¸»è¦ç¨å¨è°è¯ç¯å¢ä¸­ï¼ä¸è¦å¨çº¿ä¸çäº§ç¯å¢ä¸æç»­ä½¿ç¨ MONITORã\n\næ¥ä¸æ¥ï¼æä»¬çä¸è¾åºç¼å²åºå¤§å°è®¾ç½®çé®é¢ãåè¾å¥ç¼å²åºä¸åï¼æä»¬å¯ä»¥éè¿client-output-buffer-limitéç½®é¡¹ï¼æ¥è®¾ç½®ç¼å²åºçå¤§å°ãå·ä½è®¾ç½®çåå®¹åæ¬ä¸¤æ¹é¢ï¼\n\n * è®¾ç½®ç¼å²åºå¤§å°çä¸ééå¼ï¼\n * è®¾ç½®è¾åºç¼å²åºæç»­åå¥æ°æ®çæ°éä¸ééå¼ï¼åæç»­åå¥æ°æ®çæ¶é´çä¸ééå¼ã\n\nå¨å·ä½ä½¿ç¨client-output-buffer-limitæ¥è®¾ç½®ç¼å²åºå¤§å°çæ¶åï¼æä»¬éè¦ååºåä¸å®¢æ·ç«¯çç±»åã\n\nä¸»è¦åä¸¤å¤§ç±»ï¼\n\n * å¯¹äºåRediså®ä¾è¿è¡äº¤äºçåºç¨ç¨åºæ¥è¯´ï¼ä¸»è¦ä½¿ç¨ä¸¤ç±»å®¢æ·ç«¯åRedisæå¡å¨ç«¯äº¤äºï¼\n   * å¸¸è§åRedisæå¡å¨ç«¯è¿è¡è¯»åå½ä»¤äº¤äºçæ®éå®¢æ·ç«¯\n   * è®¢éäºRedisé¢éçè®¢éå®¢æ·ç«¯\n * å¨Redisä¸»ä»éç¾¤ä¸­ï¼\n   * ä¸»èç¹ä¸ä¹æä¸ç±»å®¢æ·ç«¯ï¼ä»èç¹å®¢æ·ç«¯ï¼ç¨æ¥åä»èç¹è¿è¡æ°æ®åæ­¥ãä¼å¨ä»ç»ä¸»ä»éç¾¤ä¸­çç¼å²åºæ¶ï¼å·ä½ä»ç»ã\n\nå½æä»¬ç»æ®éå®¢æ·ç«¯è®¾ç½®ç¼å²åºå¤§å°æ¶ï¼éå¸¸å¯ä»¥å¨Rediséç½®æä»¶ä¸­è¿è¡è¿æ ·çè®¾ç½®ï¼\n\nclient-output-buffer-limit normal 0 0 0\n\n\n1\n\n\nå¶ä¸­ï¼normal è¡¨ç¤ºå½åè®¾ç½®çæ¯æ®éå®¢æ·ç«¯ï¼ç¬¬1ä¸ª0è®¾ç½®çæ¯ç¼å²åºå¤§å°éå¶ï¼ç¬¬2ä¸ª0åç¬¬3ä¸ª0åå«è¡¨ç¤ºç¼å²åºæç»­åå¥ééå¶åæç»­åå¥æ¶é´éå¶ã\n\nå¯¹äºæ®éå®¢æ·ç«¯æ¥è¯´ï¼å®æ¯åéå®ä¸ä¸ªè¯·æ±ï¼ä¼ç­å°è¯·æ±ç»æè¿ååï¼ååéä¸ä¸ä¸ªè¯·æ±ï¼è¿ç§åéæ¹å¼ç§°ä¸ºé»å¡å¼åéãå¨è¿ç§æåµä¸ï¼å¦æä¸æ¯è¯»åä½éç¹å«å¤§çbigkeyï¼æå¡å¨ç«¯çè¾åºç¼å²åºä¸è¬ä¸ä¼è¢«é»å¡çã\n\næä»¥ï¼æä»¬éå¸¸ææ®éå®¢æ·ç«¯çç¼å²åºå¤§å°éå¶ï¼ä»¥åæç»­åå¥ééå¶ãæç»­åå¥æ¶é´éå¶é½è®¾ç½®ä¸º0ï¼ä¹å°±æ¯ä¸åéå¶ã\n\nå¯¹äºè®¢éå®¢æ·ç«¯æ¥è¯´ï¼ä¸æ¦è®¢éçRedisé¢éææ¶æ¯äºï¼æå¡å¨ç«¯é½ä¼éè¿è¾åºç¼å²åºææ¶æ¯åç»å®¢æ·ç«¯ãæä»¥ï¼è®¢éå®¢æ·ç«¯åæå¡å¨é´çæ¶æ¯åéæ¹å¼ï¼ä¸å±äºé»å¡å¼åéãä¸è¿ï¼å¦æé¢éæ¶æ¯è¾å¤çè¯ï¼ä¹ä¼å ç¨è¾å¤çè¾åºç¼å²åºç©ºé´ã\n\nå æ­¤ï¼æä»¬ä¼ç»è®¢éå®¢æ·ç«¯è®¾ç½®ç¼å²åºå¤§å°éå¶ãç¼å²åºæç»­åå¥ééå¶ï¼ä»¥åæç»­åå¥æ¶é´éå¶ï¼å¯ä»¥å¨Rediséç½®æä»¶ä¸­è¿æ ·è®¾ç½®ï¼\n\nclient-output-buffer-limit pubsub 8mb 2mb 60\n\n\n1\n\n\nå¶ä¸­ï¼pubsubåæ°è¡¨ç¤ºå½åæ¯å¯¹è®¢éå®¢æ·ç«¯è¿è¡è®¾ç½®ï¼8mbè¡¨ç¤ºè¾åºç¼å²åºçå¤§å°ä¸éä¸º8MBï¼ä¸æ¦å®éå ç¨çç¼å²åºå¤§å°è¦è¶è¿8MBï¼æå¡å¨ç«¯å°±ä¼ç´æ¥å³é­å®¢æ·ç«¯çè¿æ¥ï¼2mbå60è¡¨ç¤ºï¼å¦æè¿ç»­60ç§åå¯¹è¾åºç¼å²åºçåå¥éè¶è¿2MBçè¯ï¼æå¡å¨ç«¯ä¹ä¼å³é­å®¢æ·ç«¯è¿æ¥ã\n\n> å¥½å Redis å¯¹ç¼å²åºå¿«è¦æº¢åºçé®é¢ï¼æåçè§£å³åæ³å°±æ¯ï¼ç´æ¥å³é­å®¢æ·ç«¯çè¿æ¥ï¼ä»¥ç»åæ£...\n\nå¥½äºï¼æä»¬æ¥æ»ç»ä¸å¦ä½åºå¯¹è¾åºç¼å²åºæº¢åºï¼\n\n * é¿åbigkeyæä½è¿åå¤§éæ°æ®ç»æï¼\n * é¿åå¨çº¿ä¸ç¯å¢ä¸­æç»­ä½¿ç¨MONITORå½ä»¤ã\n * ä½¿ç¨client-output-buffer-limitè®¾ç½®åççç¼å²åºå¤§å°ä¸éï¼ææ¯ç¼å²åºè¿ç»­åå¥æ¶é´ååå¥éä¸éã\n\nä»¥ä¸å°±æ¯å³äºå®¢æ·ç«¯ç¼å²åºï¼æä»¬è¦éç¹ææ¡çåå®¹äºãæä»¬ç»§ç»­ççå¨ä¸»ä»éç¾¤é´ä½¿ç¨ç¼å²åºï¼éè¦æ³¨æä»ä¹é®é¢ã\n\n\n# 2.2 ä¸»ä»éç¾¤ä¸­çç¼å²åº\n\nä¸»ä»éç¾¤é´çæ°æ®å¤å¶åæ¬å¨éå¤å¶åå¢éå¤å¶ä¸¤ç§ãå¨éå¤å¶æ¯åæ­¥æææ°æ®ï¼èå¢éå¤å¶åªä¼æä¸»ä»åºç½ç»æ­è¿æé´ä¸»åºæ¶å°çå½ä»¤ï¼åæ­¥ç»ä»åºãæ è®ºå¨åªç§å½¢å¼çå¤å¶ä¸­ï¼ä¸ºäºä¿è¯ä¸»ä»èç¹çæ°æ®ä¸è´ï¼é½ä¼ç¨å°ç¼å²åºãä½æ¯ï¼è¿ä¸¤ç§å¤å¶åºæ¯ä¸çç¼å²åºï¼å¨æº¢åºå½±ååå¤§å°è®¾ç½®æ¹é¢å¹¶ä¸ä¸æ ·ãæä»¥ï¼æä»¬åå«æ¥å­¦ä¹ ä¸å§ã\n\n# 2.2.1 å¨éå¤å¶æé´--å¤å¶ç¼å²åºçæº¢åºé®é¢\n\nå¨å¨éå¤å¶è¿ç¨ä¸­ï¼ä¸»èç¹å¨åä»èç¹ä¼ è¾RDBæä»¶çåæ¶ï¼ä¼ç»§ç»­æ¥æ¶å®¢æ·ç«¯åéçåå½ä»¤è¯·æ±ãè¿äºåå½ä»¤å°±ä¼åä¿å­å¨å¤å¶ç¼å²åºä¸­ï¼ç­RDBæä»¶ä¼ è¾å®æåï¼ååéç»ä»èç¹å»æ§è¡ãä¸»èç¹ä¸ä¼ä¸ºæ¯ä¸ªä»èç¹é½ç»´æ¤ä¸ä¸ªå¤å¶ç¼å²åºï¼æ¥ä¿è¯ä¸»ä»èç¹é´çæ°æ®åæ­¥ã\n\næä»¥ï¼å¦æå¨å¨éå¤å¶æ¶ï¼ä»èç¹æ¥æ¶åå è½½RDBè¾æ¢ï¼åæ¶ä¸»èç¹æ¥æ¶å°äºå¤§éçåå½ä»¤ï¼åå½ä»¤å¨å¤å¶ç¼å²åºä¸­å°±ä¼è¶ç§¯è¶å¤ï¼æç»å¯¼è´æº¢åºã\n\nå¶å®ï¼ä¸»èç¹ä¸çå¤å¶ç¼å²åºï¼æ¬è´¨ä¸ä¹æ¯ä¸ä¸ªç¨äºåä»èç¹è¿æ¥çå®¢æ·ç«¯ï¼æä»¬ç§°ä¹ä¸ºä»èç¹å®¢æ·ç«¯ï¼ï¼ä½¿ç¨çè¾åºç¼å²åºãå¤å¶ç¼å²åºä¸æ¦åçæº¢åºï¼ä¸»èç¹ä¹ä¼ç´æ¥å³é­åä»èç¹è¿è¡å¤å¶æä½çè¿æ¥ï¼å¯¼è´å¨éå¤å¶å¤±è´¥ãé£å¦ä½é¿åå¤å¶ç¼å²åºåçæº¢åºå¢ï¼\n\nä¸æ¹é¢ï¼æä»¬å¯ä»¥æ§å¶ä¸»èç¹ä¿å­çæ°æ®éå¤§å°ãæéå¸¸çä½¿ç¨ç»éªï¼æä»¬ä¼æä¸»èç¹çæ°æ®éæ§å¶å¨2~4GBï¼è¿æ ·å¯ä»¥è®©å¨éåæ­¥æ§è¡å¾æ´å¿«äºï¼é¿åå¤å¶ç¼å²åºç´¯ç§¯è¿å¤å½ä»¤ã\n\nå¦ä¸æ¹é¢ï¼æä»¬å¯ä»¥ä½¿ç¨client-output-buffer-limitéç½®é¡¹ï¼æ¥è®¾ç½®åççå¤å¶ç¼å²åºå¤§å°ãè®¾ç½®çä¾æ®ï¼å°±æ¯ä¸»èç¹çæ°æ®éå¤§å°ãä¸»èç¹çåè´è½½åååä¸»èç¹æ¬èº«çåå­å¤§å°ã\n\næä»¬éè¿ä¸ä¸ªå·ä½çä¾å­ï¼æ¥å­¦ä¹ ä¸å·ä½æä¹è®¾ç½®ãå¨ä¸»èç¹æ§è¡å¦ä¸å½ä»¤ï¼\n\nconfig set client-output-buffer-limit slave 512mb 128mb 60\n\n\n1\n\n\nå¶ä¸­ï¼slaveåæ°è¡¨æè¯¥éç½®é¡¹æ¯éå¯¹å¤å¶ç¼å²åºçã512mbä»£è¡¨å°ç¼å²åºå¤§å°çä¸éè®¾ç½®ä¸º512MBï¼128mbå60ä»£è¡¨çè®¾ç½®æ¯ï¼å¦æè¿ç»­60ç§åçåå¥éè¶è¿128MBçè¯ï¼ä¹ä¼è§¦åç¼å²åºæº¢åºã\n\næä»¬åç»§ç»­ççè¿ä¸ªè®¾ç½®å¯¹æä»¬æå¥ç¨ãåè®¾ä¸æ¡åå½ä»¤æ°æ®æ¯1KBï¼é£ä¹ï¼å¤å¶ç¼å²åºå¯ä»¥ç´¯ç§¯512Kæ¡ï¼512MB/1KB = 512Kï¼åå½ä»¤ãåæ¶ï¼ä¸»èç¹å¨å¨éå¤å¶æé´ï¼å¯ä»¥æ¿åçåå½ä»¤éçä¸éæ¯2000æ¡/sï¼128MB/1KB/60 çº¦ç­äº2000ï¼ã\n\nè¿æ ·ä¸æ¥ï¼æä»¬å°±å¾å°äºä¸ç§æ¹æ³ï¼å¨å®éåºç¨ä¸­è®¾ç½®å¤å¶ç¼å²åºçå¤§å°æ¶ï¼å¯ä»¥æ ¹æ®åå½ä»¤æ°æ®çå¤§å°ååºç¨çå®éè´è½½æåµï¼ä¹å°±æ¯åå½ä»¤éçï¼ï¼æ¥ç²ç¥ä¼°è®¡ç¼å²åºä¸­ä¼ç´¯ç§¯çåå½ä»¤æ°æ®éï¼ç¶åï¼ååæè®¾ç½®çå¤å¶ç¼å²åºå¤§å°è¿è¡æ¯è¾ï¼å¤æ­è®¾ç½®çç¼å²åºå¤§å°æ¯å¦è¶³å¤æ¯æç´¯ç§¯çåå½ä»¤æ°æ®éã\n\nå³äºå¤å¶ç¼å²åºï¼æä»¬è¿ä¼éå°ä¸ä¸ªé®é¢ãä¸»èç¹ä¸å¤å¶ç¼å²åºçåå­å¼éï¼ä¼æ¯æ¯ä¸ªä»èç¹å®¢æ·ç«¯è¾åºç¼å²åºå ç¨åå­çæ»åãå¦æéç¾¤ä¸­çä»èç¹æ°éå¸¸å¤çè¯ï¼ä¸»èç¹çåå­å¼éå°±ä¼éå¸¸å¤§ãæä»¥ï¼æä»¬è¿å¿é¡»å¾æ§å¶åä¸»èç¹è¿æ¥çä»èç¹ä¸ªæ°ï¼ä¸è¦ä½¿ç¨å¤§è§æ¨¡çä¸»ä»éç¾¤ã\n\nå¥½äºï¼æä»¬åæ»ç»ä¸ä¸è¿é¨åçåå®¹ãä¸ºäºé¿åå¤å¶ç¼å²åºç´¯ç§¯è¿å¤å½ä»¤é ææº¢åºï¼å¼åå¨éå¤å¶å¤±è´¥ï¼æä»¬å¯ä»¥æ§å¶ä¸»èç¹ä¿å­çæ°æ®éå¤§å°ï¼å¹¶è®¾ç½®åççå¤å¶ç¼å²åºå¤§å°ãåæ¶ï¼æä»¬éè¦æ§å¶ä»èç¹çæ°éï¼æ¥é¿åä¸»èç¹ä¸­å¤å¶ç¼å²åºå ç¨è¿å¤åå­çé®é¢ã\n\n# 2.2.2 å¢éå¤å¶æé´--å¤å¶ç§¯åç¼å²åºçæº¢åºé®é¢\n\næ¥ä¸æ¥ï¼æä»¬åæ¥çä¸å¢éå¤å¶æ¶ä½¿ç¨çç¼å²åºï¼è¿ä¸ªç¼å²åºç§°ä¸ºå¤å¶ç§¯åç¼å²åºã\n\nä¸»èç¹å¨ææ¥æ¶å°çåå½ä»¤åæ­¥ç»ä»èç¹æ¶ï¼åæ¶ä¼æè¿äºåå½ä»¤åå¥å¤å¶ç§¯åç¼å²åºãä¸æ¦ä»èç¹åçç½ç»éªæ­ï¼åæ¬¡åä¸»èç¹æ¢å¤è¿æ¥åï¼ä»èç¹å°±ä¼ä»å¤å¶ç§¯åç¼å²åºä¸­ï¼è¯»åæ­è¿æé´ä¸»èç¹æ¥æ¶å°çåå½ä»¤ï¼è¿èè¿è¡å¢éåæ­¥ï¼å¦ä¸å¾æç¤ºï¼\n\nä¹åä¹æè®²è¿è¿ä¸ªå¤å¶ç§¯åç¼å²åºï¼åªä¸è¿å½æ¶ç§°ä¹ä¸º repl_backlog_bufferãè¿éå°ä»ç¼å²åºæº¢åºçè§åº¦åæ¥åé¡¾ä¸ä¸¤ä¸ªéç¹ï¼å¤å¶ç§¯åç¼å²åºæº¢åºçå½±åï¼ä»¥åå¦ä½åºå¯¹å¤å¶ç§¯åç¼å²åºçæº¢åºé®é¢ã\n\n * é¦åï¼å¤å¶ç§¯åç¼å²åºæ¯ä¸ä¸ªå¤§å°æéçç¯å½¢ç¼å²åºãå½ä¸»èç¹æå¤å¶ç§¯åç¼å²åºåæ»¡åï¼ä¼è¦çç¼å²åºä¸­çæ§å½ä»¤æ°æ®ãå¦æä»èç¹è¿æ²¡æåæ­¥è¿äºæ§å½ä»¤æ°æ®ï¼å°±ä¼é æä¸»ä»èç¹é´éæ°å¼å§æ§è¡å¨éå¤å¶ã\n\n * å¶æ¬¡ï¼ä¸ºäºåºå¯¹å¤å¶ç§¯åç¼å²åºçæº¢åºé®é¢ï¼æä»¬å¯ä»¥è°æ´å¤å¶ç§¯åç¼å²åºçå¤§å°ï¼ä¹å°±æ¯è®¾ç½®repl_backlog_sizeè¿ä¸ªåæ°çå¼ãå·ä½çè°æ´ä¾æ®ï¼ä½ å¯ä»¥åçä¸ç¬¬6è®²ä¸­æä¾çrepl_backlog_sizeå¤§å°çè®¡ç®ä¾æ®ã\n\n\n# 2.3 å°ç»\n\nè¿ä¸å¤§èä¸»è¦è®²äº Redis ä¸­æä½¿ç¨çç¼å²åºï¼ä½¿ç¨ç¼å²åºä»¥åï¼å½å½ä»¤æ°æ®çæ¥æ¶æ¹å¤çéåº¦è·ä¸ä¸åéæ¹çåééåº¦æ¶ï¼ç¼å²åºå¯ä»¥é¿åå½ä»¤æ°æ®çä¸¢å¤±ã\n\næä»¬æ»å±å°ç¼å²åºåæäºåä¸ªï¼\n\n * å®¢æ·ç«¯çè¾å¥ç¼å²åº\n * å®¢æ·ç«¯çè¾åºç¼å²åº\n * ä¸»ä»éç¾¤ä¸­ä¸»èç¹ä¸çå¤å¶ç¼å²åº\n * ä¸»ä»éç¾¤ä¸­ä¸»èç¹ä¸çå¤å¶ç§¯åç¼å²åº\n\nä»ç¼å²åºæº¢åºå¯¹Redisçå½±åçè§åº¦ï¼å¯ä»¥å°è¿åä¸ªç¼å²åæå¦ä¸ä¸¤ç±»ï¼\n\n * ç¼å²åºæº¢åºå¯¼è´ç½ç»è¿æ¥å³é­ï¼æ®éå®¢æ·ç«¯ãè®¢éå®¢æ·ç«¯ï¼ä»¥åä»èç¹å®¢æ·ç«¯ï¼å®ä»¬ä½¿ç¨çç¼å²åºï¼æ¬è´¨ä¸é½æ¯Rediså®¢æ·ç«¯åæå¡å¨ç«¯ä¹é´ï¼ææ¯ä¸»ä»èç¹ä¹é´ä¸ºäºä¼ è¾å½ä»¤æ°æ®èç»´æ¤çãè¿äºç¼å²åºä¸æ¦åçæº¢åºï¼å¤çæºå¶é½æ¯ç´æ¥æå®¢æ·ç«¯åæå¡å¨ç«¯çè¿æ¥ï¼ææ¯ä¸»ä»èç¹é´çè¿æ¥å³é­ãç½ç»è¿æ¥å³é­é æçç´æ¥å½±åï¼å°±æ¯ä¸å¡ç¨åºæ æ³è¯»åRedisï¼æèæ¯ä¸»ä»èç¹å¨éåæ­¥å¤±è´¥ï¼éè¦éæ°æ§è¡ã\n * ç¼å²åºæº¢åºå¯¼è´å½ä»¤æ°æ®ä¸¢å¤±ï¼ä¸»èç¹ä¸çå¤å¶ç§¯åç¼å²åºå±äºç¯å½¢ç¼å²åºï¼ä¸æ¦åçæº¢åºï¼æ°åå¥çå½ä»¤æ°æ®å°±ä¼è¦çæ§çå½ä»¤æ°æ®ï¼å¯¼è´æ§å½ä»¤æ°æ®çä¸¢å¤±ï¼è¿èå¯¼è´ä¸»ä»èç¹éæ°è¿è¡å¨éå¤å¶ã\n\nä»æ¬è´¨ä¸çï¼ç¼å²åºæº¢åºï¼æ éå°±æ¯ä¸ä¸ªåå ï¼å½ä»¤æ°æ®åéè¿å¿«è¿å¤§ï¼å½ä»¤æ°æ®å¤çè¾æ¢ï¼ç¼å²åºç©ºé´è¿å°ãæç½äºè¿ä¸ªï¼æä»¬å°±å¯ä»¥æéå¯¹æ§å°æ¿åºåºå¯¹ç­ç¥äºï¼\n\n * éå¯¹å½ä»¤æ°æ®åéè¿å¿«è¿å¤§çé®é¢ï¼å¯¹äºæ®éå®¢æ·ç«¯æ¥è¯´å¯ä»¥é¿åbigkeyï¼èå¯¹äºå¤å¶ç¼å²åºæ¥è¯´ï¼å°±æ¯é¿åè¿å¤§çRDBæä»¶ã\n * éå¯¹å½ä»¤æ°æ®å¤çè¾æ¢çé®é¢ï¼è§£å³æ¹æ¡å°±æ¯åå°Redisä¸»çº¿ç¨ä¸çé»å¡æä½ï¼ä¾å¦ä½¿ç¨å¼æ­¥çå é¤æä½ã\n * éå¯¹ç¼å²åºç©ºé´è¿å°çé®é¢ï¼è§£å³æ¹æ¡å°±æ¯ä½¿ç¨client-output-buffer-limitéç½®é¡¹è®¾ç½®åççè¾åºç¼å²åºãå¤å¶ç¼å²åºåå¤å¶ç§¯åç¼å²åºå¤§å°ãå½ç¶ï¼æä»¬ä¸è¦å¿äºï¼è¾å¥ç¼å²åºçå¤§å°é»è®¤æ¯åºå®çï¼æä»¬æ æ³éè¿éç½®æ¥ä¿®æ¹å®ï¼é¤éç´æ¥å»ä¿®æ¹Redisæºç ã\n\næäºä¸é¢è¿äºåºå¯¹æ¹æ³ï¼æç¸ä¿¡ä½ å¨å®éåºç¨æ¶ï¼å°±å¯ä»¥é¿åç¼å²åºæº¢åºå¸¦æ¥çå½ä»¤æ°æ®ä¸¢å¤±ãRediså´©æºçè¿äºâæ¨æ¡âäºã",normalizedContent:"> åèï¼\n> \n>  * 20 å é¤æ°æ®åï¼ä¸ºä»ä¹åå­å ç¨çè¿æ¯å¾é«ï¼| æå®¢æ¶é´\n>  * 21 ç¼å²åºï¼ä¸ä¸ªå¯è½å¼åâæ¨æ¡âçå°æ¹ | æå®¢æ¶é´\n\nredis å å¶é«æ§è½èè¢«å¹¿æ³åºç¨ï¼æä»¬éè¦é¿åæ§è½å¼å¸¸çæåµåºç°ãå½±å redis æ§è½ç 5 å¤§æ¹é¢å ç´ æï¼\n\n * redis åé¨çé»å¡å¼æä½\n * cpu æ ¸å numa æ¶æçå½±å\n * redis å³é®ç³»ç»éç½®\n * redis åå­ç¢ç\n * redis ç¼å²åº\n\nåé¢ä¸¤ç¯æç« åå«åæäºç¬¬ä¸äºä¸ªåç¬¬ä¸ä¸ªå ç´ ï¼æ¬æåæç¬¬åãäºä¸ªå ç´ ã\n\n\n# 1. redis çåå­ç¢çé®é¢\n\nä½¿ç¨ redis æ¶ç»å¸¸ä¼éå°è¿æ ·ä¸ä¸ªé®é¢ï¼ææåäºæ°æ®å é¤ï¼æ°æ®éå·²ç»ä¸å¤§äºï¼ä¸ºä»ä¹ä½¿ç¨topå½ä»¤æ¥çæ¶ï¼è¿ä¼åç°rediså ç¨äºå¾å¤åå­å¢ï¼å®éä¸ï¼è¿æ¯å ä¸ºï¼å½æ°æ®å é¤åï¼redis éæ¾çåå­ç©ºé´ä¼ç±åå­åéå¨ç®¡çï¼å¹¶ä¸ä¼ç«å³è¿åç»æä½ç³»ç»ãæä»¥ï¼æä½ç³»ç»ä»ç¶ä¼è®°å½çç»redisåéäºå¤§éåå­ã\n\nä½æ¯ï¼è¿å¾å¾ä¼ä¼´éä¸ä¸ªæ½å¨çé£é©ç¹ï¼redis éæ¾çåå­ç©ºé´å¯è½å¹¶ä¸æ¯è¿ç»­çï¼é£ä¹ï¼è¿äºä¸è¿ç»­çåå­ç©ºé´å¾æå¯è½å¤äºä¸ç§é²ç½®çç¶æãè¿å°±ä¼å¯¼è´ä¸ä¸ªé®é¢ï¼è½ç¶æç©ºé²ç©ºé´ï¼rediså´æ æ³ç¨æ¥ä¿å­æ°æ®ï¼ä¸ä»ä¼åå°redisè½å¤å®éä¿å­çæ°æ®éï¼è¿ä¼éä½redisè¿è¡æºå¨çææ¬åæ¥çã\n\nè¿ä¸èå°è®¨è®ºä¸ä¸ redis çåå­ç©ºé´å­å¨æçé®é¢ï¼æ¢ç´¢ä¸ä¸ï¼ä¸ºä»ä¹æ°æ®å·²ç»å é¤äºï¼ä½åå­å´é²ç½®çæ²¡æç¨ï¼ä»¥åç¸åºçè§£å³æ¹æ¡ã\n\n\n# 1.1 ä»ä¹æ¯åå­ç¢çï¼\n\néå¸¸æåµä¸ï¼åå­ç©ºé´é²ç½®ï¼å¾å¾æ¯å ä¸ºæä½ç³»ç»åçäºè¾ä¸ºä¸¥éçåå­ç¢çï¼å¯¼è´æ æ³ç»§ç»­åéä¸åè¿ç»­ç©ºé´ã\n\nåå­ç¢çï¼åå­ä¸­è¿æ 5kb çç©ºä½ï¼ä½é½æ¯é¶æ£å¨ä¸åå°æ¹ï¼æ æ³æ»¡è¶³âç³è¯·ä¸åè¿ç»­ 2kb ç©ºé´âçè¦æ±ã\n\nç±»ä¼¼äº3ä¸ªäººæ³ä¹°è¿ççç«è½¦ç¥¨ï¼ä½æ­¤æ¶è½¦ä¸åªæä¸è¿ç»­çä¸ä¸ªç©ºåº§ä½ï¼å æ­¤å°±æ¢è¶è½¦äºã\n\n\n# 1.2 åå­ç¢çæ¯å¦ä½å½¢æçï¼\n\nå¶å®ï¼åå­ç¢ççå½¢ææåå åå¤å ä¸¤ä¸ªå±é¢çåå ãç®åæ¥è¯´ï¼åå æ¯æä½ç³»ç»çåå­åéæºå¶ï¼å¤å æ¯ redis çè´è½½ç¹å¾ã\n\n# 1.2.1 åå ï¼åå­åéå¨çåéç­ç¥\n\nåå­åéå¨çåéç­ç¥å°±å³å®äºæä½ç³»ç»æ æ³åå°âæéåéâãè¿æ¯å ä¸ºï¼åå­åéå¨ä¸è¬æ¯æåºå®å¤§å°æ¥åéåå­ï¼èä¸æ¯å®å¨æç§åºç¨ç¨åºç³è¯·çåå­ç©ºé´å¤§å°ç»ç¨åºåéã\n\nrediså¯ä»¥ä½¿ç¨libcãjemallocãtcmallocå¤ç§åå­åéå¨æ¥åéåå­ï¼é»è®¤ä½¿ç¨jemallocãæ¥ä¸æ¥ï¼æå°±ä»¥jemallocä¸ºä¾ï¼æ¥å·ä½è§£éä¸ä¸ãå¶ä»åéå¨ä¹å­å¨ç±»ä¼¼çé®é¢ã\n\njemallocçåéç­ç¥ä¹ä¸ï¼æ¯æç§ä¸ç³»ååºå®çå¤§å°åååå­ç©ºé´ï¼ä¾å¦8å­èã16å­èã32å­èã48å­èï¼â¦, 2kbã4kbã8kbç­ãå½ç¨åºç³è¯·çåå­ææ¥è¿æä¸ªåºå®å¼æ¶ï¼jemallocä¼ç»å®åéç¸åºå¤§å°çç©ºé´ã\n\nè¿æ ·çåéæ¹å¼æ¬èº«æ¯ä¸ºäºåå°åéæ¬¡æ°ãä¾å¦ï¼redisç³è¯·ä¸ä¸ª20å­èçç©ºé´ä¿å­æ°æ®ï¼jemallocå°±ä¼åé32å­èï¼æ­¤æ¶ï¼å¦æåºç¨è¿è¦åå¥10å­èçæ°æ®ï¼rediså°±ä¸ç¨ååæä½ç³»ç»ç³è¯·ç©ºé´äºï¼å ä¸ºåæåéç32å­èå·²ç»å¤ç¨äºï¼è¿å°±é¿åäºä¸æ¬¡åéæä½ã\n\nä½æ¯ï¼å¦æ redis æ¯æ¬¡ååéå¨ç³è¯·çåå­ç©ºé´å¤§å°ä¸ä¸æ ·ï¼è¿ç§åéæ¹å¼å°±ä¼æå½¢æç¢ççé£é©ï¼èè¿æ­£å¥½æ¥æºäº redis çå¤å äºã\n\n# 1.2.2 å¤å ï¼é®å¼å¯¹å¤§å°ä¸ä¸æ ·åå æ¹æä½\n\nç¬¬ä¸ä¸ªå¤å ï¼\n\nredis éå¸¸ä½ä¸ºå±ç¨çç¼å­ç³»ç»æé®å¼æ°æ®åºå¯¹å¤æä¾æå¡ï¼æä»¥ï¼ä¸åä¸å¡åºç¨çæ°æ®é½å¯è½ä¿å­å¨ redis ä¸­ï¼è¿å°±ä¼å¸¦æ¥ä¸åå¤§å°çé®å¼å¯¹ãä½åå­åéå¨åªè½æåºå®å¤§å°åéåå­ï¼æä»¥ï¼åéçåå­ç©ºé´ä¸è¬é½ä¼æ¯ç³è¯·çç©ºé´å¤§ä¸äºï¼ä¸ä¼å®å¨ä¸è´ï¼è¿æ¬èº«å°±ä¼é æä¸å®çç¢çï¼éä½åå­ç©ºé´å­å¨æçã\n\nç¬¬äºä¸ªå¤å ï¼\n\nç¬¬äºä¸ªå¤å æ¯ï¼è¿äºé®å¼å¯¹ä¼è¢«ä¿®æ¹åå é¤ï¼è¿ä¼å¯¼è´ç©ºé´çæ©å®¹åéæ¾ãå·ä½æ¥è¯´ï¼ä¸æ¹é¢ï¼å¦æä¿®æ¹åçé®å¼å¯¹åå¤§æåå°äºï¼å°±éè¦å ç¨é¢å¤çç©ºé´æèéæ¾ä¸ç¨çç©ºé´ãå¦ä¸æ¹é¢ï¼å é¤çé®å¼å¯¹å°±ä¸åéè¦åå­ç©ºé´äºï¼æ­¤æ¶ï¼å°±ä¼æç©ºé´éæ¾åºæ¥ï¼å½¢æç©ºé²ç©ºé´ã\n\nä½è¿æ ·é¢ç¹æä½åï¼ä¼å½¢æå¾å¤ç¢çç©ºé´ï¼å®ä»¬ä¸æ¯è¿ç»­çï¼å¯¼è´é¾ä»¥è¢«å©ç¨ãå¦ä¸å¾ï¼\n\n----------------------------------------\n\nå¥½äºï¼å°è¿éï¼æä»¬å°±ç¥éäºé æåå­ç¢ççåå¤å ç´ ï¼å¶ä¸­ï¼åå­åéå¨ç­ç¥æ¯åå ï¼èredisçè´è½½å±äºå¤å ï¼åæ¬äºå¤§å°ä¸ä¸çé®å¼å¯¹åé®å¼å¯¹ä¿®æ¹å é¤å¸¦æ¥çåå­ç©ºé´ååã\n\nå¤§éåå­ç¢ççå­å¨ï¼ä¼é æ redis çåå­å®éå©ç¨çåä½ï¼æ¥ä¸æ¥ï¼æä»¬å°±è¦æ¥è§£å³è¿ä¸ªé®é¢äºãä¸è¿ï¼å¨è§£å³é®é¢åï¼æä»¬è¦åå¤æ­ redis è¿è¡è¿ç¨ä¸­æ¯å¦å­å¨åå­ç¢çã\n\n\n# 1.3 å¦ä½å¤æ­æ¯å¦æåå­ç¢çï¼\n\nä¸ºäºè®©ç¨æ·è½çæ§å°å®æ¶çåå­ä½¿ç¨æåµï¼redis èªèº«æä¾äº info å½ä»¤ï¼å¯ä»¥ç¨æ¥æ¥è¯¢åå­ä½¿ç¨çè¯¦ç»ä¿¡æ¯ï¼å½ä»¤å¦ä¸ï¼\n\ninfo memory\n# memory\nused_memory:1073741736\nused_memory_human:1024.00m\nused_memory_rss:1997159792\nused_memory_rss_human:1.86g\nâ¦\nmem_fragmentation_ratio:1.86\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nè¿éæä¸ä¸ª mem_fragmentation_ratio çææ ï¼å®è¡¨ç¤ºçå°±æ¯ redis å½åçåå­ç¢ççãé£ä¹ï¼è¿ä¸ªç¢ççæ¯æä¹è®¡ç®çå¢ï¼å¶å®ï¼å°±æ¯ä¸é¢çå½ä»¤ä¸­çä¸¤ä¸ªææ used_memory_rssåused_memoryç¸é¤çç»æï¼\n\nmem_fragmentation_ratio = used_memory_rss/ used_memory\n\n\n1\n\n * used_memory_rss æ¯æä½ç³»ç»å®éåéç»redisçç©çåå­ç©ºé´ï¼éé¢å°±åå«äºç¢çï¼\n * used_memory æ¯ redis ä¸ºäºä¿å­æ°æ®å®éç³è¯·ä½¿ç¨çç©ºé´ã\n\nè¿ä¸ªææ å¦ä½ä½¿ç¨å¢ï¼è¿éæä¸äºç»éªéå¼ï¼\n\n * mem_fragmentation_ratio å¤§äº 1 ä½å°äº 1.5ãè¿ç§æåµæ¯åççãè¿æ¯å ä¸ºï¼åææä»ç»çé£äºå ç´ æ¯é¾ä»¥é¿åçãæ¯ç«ï¼åå çåå­åéå¨æ¯ä¸å®è¦ä½¿ç¨çï¼åéç­ç¥é½æ¯éç¨çï¼ä¸ä¼è½»æä¿®æ¹ï¼èå¤å ç±redisè´è½½å³å®ï¼ä¹æ æ³éå¶ãæä»¥ï¼å­å¨åå­ç¢çä¹æ¯æ­£å¸¸çã\n * mem_fragmentation_ratio å¤§äº 1.5 ãè¿è¡¨æåå­ç¢ççå·²ç»è¶è¿äº50%ãä¸è¬æåµä¸ï¼è¿ä¸ªæ¶åï¼æä»¬å°±éè¦éåä¸äºæªæ½æ¥éä½åå­ç¢ççäºã\n\n\n# 1.4 å¦ä½æ¸çåå­ç¢çï¼\n\n# 1.4.1 éå¯ redis çæ¹æ³\n\nå½ redis åçåå­ç¢çåï¼ä¸ä¸ªâç®åç²æ´âçæ¹æ³å°±æ¯éå¯rediså®ä¾ãå½ç¶ï¼è¿å¹¶ä¸æ¯ä¸ä¸ªâä¼éâçæ¹æ³ï¼æ¯ç«ï¼éå¯ redis ä¼å¸¦æ¥ä¸¤ä¸ªåæï¼\n\n * å¦æ redis ä¸­çæ°æ®æ²¡ææä¹åï¼é£ä¹ï¼æ°æ®å°±ä¼ä¸¢å¤±ï¼\n * å³ä½¿ redis æ°æ®æä¹åäºï¼æä»¬è¿éè¦éè¿ aof æ rdb è¿è¡æ¢å¤ï¼æ¢å¤æ¶é¿åå³äº aof æ rdb çå¤§å°ï¼å¦æåªæä¸ä¸ª redis å®ä¾ï¼æ¢å¤é¶æ®µæ æ³æä¾æå¡ã\n\n# 1.4.2 åå­ç¢çèªå¨æ¸ççæ¹æ³\n\næä»¥ï¼è¿æä»ä¹å¶ä»å¥½åæ³åï¼å¹¸è¿çæ¯ï¼ä» 4.0-rc3 çæ¬ä»¥åï¼redis èªèº«æä¾äºä¸ç§åå­ç¢çèªå¨æ¸ççæ¹æ³ï¼æä»¬åæ¥çè¿ä¸ªæ¹æ³çåºæ¬æºå¶ï¼âæ¬å®¶è®©ä½ï¼åå¹¶ç©ºé´âï¼ç¨ä¸å¼ å¾æ¥è§£éå°±æ¯ï¼\n\nä»¥ååçé«éçä¾å­æ¥çï¼å°±æ¯ä¸ä¸ªäººä¹°äºä¸å¨ä¸èµ·çè½¦ç¥¨ï¼ä¸è½¦ä¹ååå«äººè°æ¢ä½ä¸ºï¼åå¨äºä¸èµ·ã\n\nå½ç¶ï¼å¦ææ°æ®æ·è´åï¼å¹¶æ²¡æå½¢æè¿ç»­çåå­ç©ºé´ï¼è¿å°±ä¸è½ç®æ¯æ¸çäºã\n\nä¸è¿éè¦æ³¨æï¼ç¢çæ¸çæ¯æä»£ä»·çï¼æä½ç³»ç»éè¦æå¤ä»½æ°æ®æ·è´å°æ°ä½ç½®ï¼æåæç©ºé´éæ¾åºæ¥ï¼è¿ä¼å¸¦æ¥æ¶é´å¼éï¼ä¼é»å¡ redis ççº¿ç¨ã\n\næä»ä¹åæ³å¯ä»¥å°½éç¼è§£è¿ä¸ªé®é¢åï¼è¿å°±è¦æå° redis ä¸é¨ä¸ºèªå¨åå­ç¢çæ¸çæºå¶è®¾ç½®çåæ°äºãæä»¬å¯ä»¥éè¿è®¾ç½®åæ°ï¼æ¥æ§å¶ç¢çæ¸ççå¼å§åç»ææ¶æºï¼ä»¥åå ç¨çcpuæ¯ä¾ï¼ä»èåå°ç¢çæ¸çå¯¹ redis æ¬èº«è¯·æ±å¤ççæ§è½å½±åã\n\n# 1.4.3 åå­ç¢çèªå¨æ¸ççç¸å³åæ°\n\né¦åï¼redis éè¦å¯ç¨èªå¨åå­ç¢çæ¸çï¼å¯ä»¥æ activedefrag éç½®é¡¹è®¾ç½®ä¸º yesï¼å½ä»¤å¦ä¸ï¼\n\nconfig set activedefrag yes\n\n\n1\n\n\nè¿ä¸ªå½ä»¤åªæ¯å¯ç¨äºèªå¨æ¸çåè½ï¼ä½æ¯ï¼å·ä½ä»ä¹æ¶åæ¸çï¼ä¼åå°ä¸é¢è¿ä¸¤ä¸ªåæ°çæ§å¶ãè¿ä¸¤ä¸ªåæ°åå«è®¾ç½®äºè§¦ååå­æ¸ççä¸ä¸ªæ¡ä»¶ï¼å¦æåæ¶æ»¡è¶³è¿ä¸¤ä¸ªæ¡ä»¶ï¼å°±å¼å§æ¸çãå¨æ¸ççè¿ç¨ä¸­ï¼åªè¦æä¸ä¸ªæ¡ä»¶ä¸æ»¡è¶³äºï¼å°±åæ­¢èªå¨æ¸çï¼\n\n * active-defrag-ignore-bytes 100mbï¼è¡¨ç¤ºåå­ç¢ççå­èæ°è¾¾å°100mbæ¶ï¼å¼å§æ¸çï¼\n * active-defrag-threshold-lower 10ï¼è¡¨ç¤ºåå­ç¢çç©ºé´å æä½ç³»ç»åéç»redisçæ»ç©ºé´æ¯ä¾è¾¾å°10%æ¶ï¼å¼å§æ¸çã\n\nä¸ºäºå°½å¯è½åå°ç¢çæ¸çå¯¹ redis æ­£å¸¸è¯·æ±å¤ççå½±åï¼èªå¨åå­ç¢çæ¸çåè½å¨æ§è¡æ¶ï¼è¿ä¼çæ§æ¸çæä½å ç¨ç cpu æ¶é´ï¼èä¸è¿è®¾ç½®äºä¸¤ä¸ªåæ°ï¼åå«ç¨äºæ§å¶æ¸çæä½å ç¨çcpuæ¶é´æ¯ä¾çä¸ãä¸éï¼æ¢ä¿è¯æ¸çå·¥ä½è½æ­£å¸¸è¿è¡ï¼åé¿åäºéä½ redis æ§è½ãè¿ä¸¤ä¸ªåæ°å·ä½å¦ä¸ï¼\n\n * active-defrag-cycle-min 25ï¼ è¡¨ç¤ºèªå¨æ¸çè¿ç¨æç¨cpuæ¶é´çæ¯ä¾ä¸ä½äº25%ï¼ä¿è¯æ¸çè½æ­£å¸¸å¼å±ï¼\n * active-defrag-cycle-max 75ï¼è¡¨ç¤ºèªå¨æ¸çè¿ç¨æç¨cpuæ¶é´çæ¯ä¾ä¸é«äº75%ï¼ä¸æ¦è¶è¿ï¼å°±åæ­¢æ¸çï¼ä»èé¿åå¨æ¸çæ¶ï¼å¤§éçåå­æ·è´é»å¡redisï¼å¯¼è´ååºå»¶è¿åé«ã\n\nèªå¨åå­ç¢çæ¸çæºå¶å¨æ§å¶ç¢çæ¸çå¯åçæ¶æºä¸ï¼æ¢èèäºç¢ççç©ºé´å æ¯ãå¯¹ redis åå­ä½¿ç¨æççå½±åï¼è¿èèäºæ¸çæºå¶æ¬èº«ç cpu æ¶é´å æ¯ãå¯¹ redis æ§è½çå½±åãèä¸ï¼æ¸çæºå¶è¿æä¾äº 4 ä¸ªåæ°ï¼è®©æä»¬å¯ä»¥æ ¹æ®å®éåºç¨ä¸­çæ°æ®ééæ±åæ§è½è¦æ±çµæ´»ä½¿ç¨ï¼å»ºè®®ä½ å¨å®è·µä¸­å¥½å¥½å°æè¿ä¸ªæºå¶ç¨èµ·æ¥ã\n\n\n# 1.5 å°ç»\n\nè¿ä¸å¤§èä¸»è¦äºè§£äº redis çåå­ç©ºé´æçé®é¢ï¼è¿éé¢çä¸ä¸ªå³é®ææ¯ç¹å°±æ¯è¦è¯å«åå¤çåå­ç¢çï¼\n\n * info memory å½ä»¤æ¯ä¸ä¸ªå¥½å·¥å·ï¼å¯ä»¥å¸®å©ä½ æ¥çç¢çççæåµï¼\n * ç¢ççéå¼æ¯ä¸ä¸ªå¥½ç»éªï¼å¯ä»¥å¸®å¿ä½ ææå°å¤æ­æ¯å¦è¦è¿è¡ç¢çæ¸çäºï¼\n * åå­ç¢çèªå¨æ¸çæ¯ä¸ä¸ªå¥½æ¹æ³ï¼å¯ä»¥é¿åå ä¸ºç¢çå¯¼è´ redis çåå­å®éå©ç¨çéä½ï¼æåææ¬æ¶ççã\n\nåå­ç¢çå¹¶ä¸å¯æï¼æä»¬è¦åçå°±æ¯äºè§£å®ï¼éè§å®ï¼å¹¶åç¨é«æçæ¹æ³è§£å³å®ã\n\næåï¼æåç»ä½ æä¾ä¸ä¸ªå°è´´å£«ï¼åå­ç¢çèªå¨æ¸çæ¶ååå­æ·è´ï¼è¿å¯¹redisèè¨ï¼æ¯ä¸ªæ½å¨çé£é©ãå¦æä½ å¨å®è·µè¿ç¨ä¸­éå°redisæ§è½åæ¢ï¼è®°å¾éè¿æ¥å¿çä¸æ¯å¦æ­£å¨è¿è¡ç¢çæ¸çãå¦æredisçç¡®æ­£å¨æ¸çç¢çï¼é£ä¹ï¼æå»ºè®®ä½ è°å°active-defrag-cycle-maxçå¼ï¼ä»¥åè½»å¯¹æ­£å¸¸è¯·æ±å¤ççå½±åã\n\n\n# 2. ç¼å²åºï¼ä¸ä¸ªå¯è½å¼åâæ¨æ¡âçå°æ¹\n\nç¼å²åºçåè½å¶å®å¾ç®åï¼ä¸»è¦å°±æ¯ç¨ä¸ååå­ç©ºé´æ¥ææ¶å­æ¾å½ä»¤æ°æ®ï¼ä»¥ååºç°å ä¸ºæ°æ®åå½ä»¤çå¤çéåº¦æ¢äºåééåº¦èå¯¼è´çæ°æ®ä¸¢å¤±åæ§è½é®é¢ãä½å ä¸ºç¼å²åºçåå­ç©ºé´æéï¼å¦æå¾éé¢åå¥æ°æ®çéåº¦æç»­å°å¤§äºä»éé¢è¯»åæ°æ®çéåº¦ï¼å°±ä¼å¯¼è´ç¼å²åºéè¦è¶æ¥è¶å¤çåå­æ¥æå­æ°æ®ãå½ç¼å²åºå ç¨çåå­è¶åºäºè®¾å®çä¸ééå¼æ¶ï¼å°±ä¼åºç°ç¼å²åºæº¢åºãå¦æåçäºæº¢åºï¼å°±ä¼ä¸¢æ°æ®äºã\n\n> å¯ä»¥ä¸ç»ç¼å²åºçå¤§å°è®¾ç½®ä¸éåï¼æ¾ç¶ä¸è¡ï¼éçç´¯ç§¯çæ°æ®è¶æ¥è¶å¤ï¼ç¼å²åºå ç¨åå­ç©ºé´è¶æ¥è¶å¤§ï¼ä¸æ¦èå°½äºrediså®ä¾æå¨æºå¨çå¯ç¨åå­ï¼å°±ä¼å¯¼è´rediså®ä¾å´©æºã æä»¥æ¯«ä¸å¤¸å¼ å°è¯´ï¼ç¼å²åºæ¯ç¨æ¥é¿åè¯·æ±ææ°æ®ä¸¢å¤±çæ¨æ¡çï¼ä½ä¹åªæç¨å¯¹äºï¼æè½çæ­£èµ·å°âé¿åâçä½ç¨ã\n\nredis çä¸¤ä¸ªåºç¨åºæ¯ï¼\n\n * å¨ client å server è¿è¡éä¿¡æ¶ï¼ç¨æ¥æå­å®¢æ·ç«¯åéçå½ä»¤æ°æ®ï¼æèæ¯æå¡å¨ç«¯è¿åç»å®¢æ·ç«¯çæ°æ®ç»æã\n * å¨ä¸»ä»èç¹é´è¿è¡æ°æ®åæ­¥æ¶ï¼ç¨æ¥æå­ä¸»èç¹æ¥æ¶çåå½ä»¤åæ°æ®ã\n\nè¿ä¸å¤§èå°åå«èèæå¡å¨ç«¯åå®¢æ·ç«¯ãä¸»ä»éç¾¤é´çç¼å²åºæº¢åºé®é¢ï¼ä»¥ååºå¯¹æ¹æ¡ã\n\n\n# 2.1 å®¢æ·ç«¯çè¾å¥åè¾åºç¼å²åº\n\næä»¬åæ¥ççæå¡å¨ç«¯åå®¢æ·ç«¯ä¹é´çç¼å²åºã\n\nä¸ºäºé¿åå®¢æ·ç«¯åæå¡å¨ç«¯çè¯·æ±åéåå¤çéåº¦ä¸å¹éï¼æå¡å¨ç«¯ç»æ¯ä¸ªè¿æ¥çå®¢æ·ç«¯é½è®¾ç½®äºä¸ä¸ªè¾å¥ç¼å²åºåè¾åºç¼å²åºï¼æä»¬ç§°ä¹ä¸ºå®¢æ·ç«¯è¾å¥ç¼å²åºåè¾åºç¼å²åºã\n\nè¾å¥ç¼å²åºä¼åæå®¢æ·ç«¯åéè¿æ¥çå½ä»¤æå­èµ·æ¥ï¼redisä¸»çº¿ç¨åä»è¾å¥ç¼å²åºä¸­è¯»åå½ä»¤ï¼è¿è¡å¤çãå½redisä¸»çº¿ç¨å¤çå®æ°æ®åï¼ä¼æç»æåå¥å°è¾åºç¼å²åºï¼åéè¿è¾åºç¼å²åºè¿åç»å®¢æ·ç«¯ï¼å¦ä¸å¾æç¤ºï¼\n\nä¸é¢ï¼æä»¬å°±åå«å­¦ä¹ ä¸è¾å¥ç¼å²åºåè¾åºç¼å²åºåçæº¢åºçæåµï¼ä»¥åç¸åºçåºå¯¹æ¹æ¡ã\n\n# 2.1.1 å¦ä½åºå¯¹è¾å¥ç¼å²åºæº¢åºï¼\n\nè¾å¥ç¼å²åºå°±æ¯ç¨æ¥æå­å®¢æ·ç«¯åéçè¯·æ±å½ä»¤çï¼æä»¥å¯è½å¯¼è´æº¢åºçæåµä¸»è¦æ¯ä¸é¢ä¸¤ç§ï¼\n\n * åå¥äº bigkeyï¼æ¯å¦ä¸ä¸å­åå¥äºå¤ä¸ªç¾ä¸çº§å«çéåç±»åæ°æ®ï¼\n * æå¡å¨ç«¯å¤çè¯·æ±çéåº¦è¿æ¢ï¼ä¾å¦ï¼redis ä¸»çº¿ç¨åºç°äºé´æ­æ§é»å¡ï¼æ æ³åæ¶å¤çæ­£å¸¸åéçè¯·æ±ï¼å¯¼è´å®¢æ·ç«¯åéçè¯·æ±å¨ç¼å²åºè¶ç§¯è¶å¤ã\n\næ¥ä¸æ¥å°æ¢è®¨å¦ä½æ¥çè¾å¥ç¼å²åºçåå­ä½¿ç¨æåµãå¦ä½é¿åæº¢åºè¿ä¸¤ä¸ªé®é¢ã\n\n----------------------------------------\n\nå¦ä½æ¥çè¾å¥ç¼å²åºçåå­ä½¿ç¨æåµï¼è¿å¯ä»¥ä½¿ç¨ client list å½ä»¤ï¼\n\nclient list\nid=5 addr=127.0.0.1:50487 fd=9 name= age=4 idle=0 flags=n db=0 sub=0 psub=0 multi=-1 qbuf=26 qbuf-free=32742 obl=0 oll=0 omem=0 events=r cmd=client\n\n\n1\n2\n\n\næä»¬åªéè¦éç¹å³æ³¨å¶ä¸­çä¸¤ç±»ä¿¡æ¯ï¼\n\n * ä¸ç±»æ¯ä¸æå¡å¨ç«¯è¿æ¥çå®¢æ·ç«¯çä¿¡æ¯ãè¿ä¸ªæ¡ä¾å±ç¤ºçæ¯ä¸ä¸ªå®¢æ·ç«¯çè¾å¥ç¼å²åºæåµï¼å¦ææå¤ä¸ªå®¢æ·ç«¯ï¼è¾åºç»æä¸­çaddrä¼æ¾ç¤ºä¸åå®¢æ·ç«¯çipåç«¯å£å·ã\n * å¦ä¸ç±»æ¯ä¸è¾å¥ç¼å²åºç¸å³çä¸ä¸ªåæ°ï¼\n   * cmdï¼è¡¨ç¤ºå®¢æ·ç«¯ææ°æ§è¡çå½ä»¤ãè¿ä¸ªä¾å­ä¸­æ§è¡çæ¯clientå½ä»¤ã\n   * qbufï¼è¡¨ç¤ºè¾å¥ç¼å²åºå·²ç»ä½¿ç¨çå¤§å°ãè¿ä¸ªä¾å­ä¸­çclientå½ä»¤å·²ä½¿ç¨äº26å­èå¤§å°çç¼å²åºã\n   * qbuf-freeï¼è¡¨ç¤ºè¾å¥ç¼å²åºå°æªä½¿ç¨çå¤§å°ãè¿ä¸ªä¾å­ä¸­çclientå½ä»¤è¿å¯ä»¥ä½¿ç¨32742å­èçç¼å²åºãqbufåqbuf-freeçæ»åå°±æ¯ï¼redisæå¡å¨ç«¯å½åä¸ºå·²è¿æ¥çè¿ä¸ªå®¢æ·ç«¯åéçç¼å²åºæ»å¤§å°ãè¿ä¸ªä¾å­ä¸­æ»å±åéäº 26 + 32742 = 32768å­èï¼ä¹å°±æ¯32kbçç¼å²åºã\n\næäºclient listå½ä»¤ï¼æä»¬å°±å¯ä»¥éè¿è¾åºç»ææ¥å¤æ­å®¢æ·ç«¯è¾å¥ç¼å²åºçåå­å ç¨æåµäºãå¦æqbufå¾å¤§ï¼èåæ¶qbuf-freeå¾å°ï¼å°±è¦å¼èµ·æ³¨æäºï¼å ä¸ºè¿æ¶åè¾å¥ç¼å²åºå·²ç»å ç¨äºå¾å¤åå­ï¼èä¸æ²¡æä»ä¹ç©ºé²ç©ºé´äºãæ­¤æ¶ï¼å®¢æ·ç«¯ååå¥å¤§éå½ä»¤çè¯ï¼å°±ä¼å¼èµ·å®¢æ·ç«¯è¾å¥ç¼å²åºæº¢åºï¼redisçå¤çåæ³å°±æ¯æå®¢æ·ç«¯è¿æ¥å³é­ï¼ç»æå°±æ¯ä¸å¡ç¨åºæ æ³è¿è¡æ°æ®å­åäºã\n\néå¸¸æåµä¸ï¼redisæå¡å¨ç«¯ä¸æ­¢æå¡ä¸ä¸ªå®¢æ·ç«¯ï¼å½å¤ä¸ªå®¢æ·ç«¯è¿æ¥å ç¨çåå­æ»éï¼è¶è¿äºredisçmaxmemoryéç½®é¡¹æ¶ï¼ä¾å¦4gbï¼ï¼å°±ä¼è§¦åredisè¿è¡æ°æ®æ·æ±°ãä¸æ¦æ°æ®è¢«æ·æ±°åºredisï¼åè¦è®¿é®è¿é¨åæ°æ®ï¼å°±éè¦å»åç«¯æ°æ®åºè¯»åï¼è¿å°±éä½äºä¸å¡åºç¨çè®¿é®æ§è½ãæ­¤å¤ï¼æ´ç³ç³çæ¯ï¼å¦æä½¿ç¨å¤ä¸ªå®¢æ·ç«¯ï¼å¯¼è´redisåå­å ç¨è¿å¤§ï¼ä¹ä¼å¯¼è´åå­æº¢åºï¼out-of-memoryï¼é®é¢ï¼è¿èä¼å¼èµ·rediså´©æºï¼ç»ä¸å¡åºç¨é æä¸¥éå½±åã\n\nredisçå®¢æ·ç«¯è¾å¥ç¼å²åºå¤§å°çä¸ééå¼ï¼å¨ä»£ç ä¸­å°±è®¾å®ä¸ºäº1gbãä¹å°±æ¯è¯´ï¼redisæå¡å¨ç«¯åè®¸ä¸ºæ¯ä¸ªå®¢æ·ç«¯æå¤æå­1gbçå½ä»¤åæ°æ®ã1gbçå¤§å°ï¼å¯¹äºä¸è¬ççäº§ç¯å¢å·²ç»æ¯æ¯è¾åéçäºãä¸æ¹é¢ï¼è¿ä¸ªå¤§å°å¯¹äºå¤çç»å¤§é¨åå®¢æ·ç«¯çè¯·æ±å·²ç»å¤ç¨äºï¼å¦ä¸æ¹é¢ï¼å¦æåå¤§çè¯ï¼rediså°±æå¯è½å ä¸ºå®¢æ·ç«¯å ç¨äºè¿å¤çåå­èµæºèå´©æºãæä»¥ï¼rediså¹¶æ²¡ææä¾åæ°è®©æä»¬è°èå®¢æ·ç«¯è¾å¥ç¼å²åºçå¤§å°ãå¦æè¦é¿åè¾å¥ç¼å²åºæº¢åºï¼é£æä»¬å°±åªè½ä»æ°æ®å½ä»¤çåéåå¤çéåº¦å¥æï¼ä¹å°±æ¯åé¢æå°çé¿åå®¢æ·ç«¯åå¥bigkeyï¼ä»¥åé¿åredisä¸»çº¿ç¨é»å¡ã\n\n# 2.1.2 å¦ä½åºå¯¹è¾åºç¼å²åºæº¢åºï¼\n\nredis çè¾åºç¼å²åºæå­çæ¯ redis ä¸»çº¿ç¨è¦è¿åç»å®¢æ·ç«¯çæ°æ®ãä¸è¬æ¥è¯´ï¼ä¸»çº¿ç¨è¿åç»å®¢æ·ç«¯çæ°æ®ï¼æ¢æç®åä¸å¤§å°åºå®ç ok ååºï¼ä¾å¦ï¼æ§è¡ set å½ä»¤ï¼ææ¥éä¿¡æ¯ï¼ä¹æå¤§å°ä¸åºå®çãåå«å·ä½æ°æ®çæ§è¡ç»æï¼ä¾å¦ï¼æ§è¡ hget å½ä»¤ï¼ã\n\nå æ­¤ï¼redis ä¸ºæ¯ä¸ªå®¢æ·ç«¯è®¾ç½®çè¾åºç¼å²åºä¹åæ¬ä¸¤é¨åï¼ä¸é¨åï¼æ¯ä¸ä¸ªå¤§å°ä¸º 16kb çåºå®ç¼å²ç©ºé´ï¼ç¨æ¥æå­ ok ååºååºéä¿¡æ¯ï¼å¦ä¸é¨åï¼æ¯ä¸ä¸ªå¯ä»¥å¨æå¢å çç¼å²ç©ºé´ï¼ç¨æ¥æå­å¤§å°å¯åçååºç»æã\n\næä¸ç§æåµå¯è½åçè¾åºç¼å²åºæº¢åºï¼\n\n * æå¡å¨ç«¯è¿å bigkey çå¤§éç»æï¼\n * æ§è¡äº monitor å½ä»¤ï¼\n * ç¼å²åºå¤§å°è®¾ç½®å¾ä¸åçã\n\nmonitor å½ä»¤æ§è¡åä¼æç»­è¾åºçæµå°çåä¸ªå½ä»¤æä½ï¼å¶è¾åºç»æä¼å ç¨è¾åºç¼å²åºï¼ä»èå¯è½åçæº¢åºãå æ­¤ï¼monitor å½ä»¤ä¸»è¦ç¨å¨è°è¯ç¯å¢ä¸­ï¼ä¸è¦å¨çº¿ä¸çäº§ç¯å¢ä¸æç»­ä½¿ç¨ monitorã\n\næ¥ä¸æ¥ï¼æä»¬çä¸è¾åºç¼å²åºå¤§å°è®¾ç½®çé®é¢ãåè¾å¥ç¼å²åºä¸åï¼æä»¬å¯ä»¥éè¿client-output-buffer-limitéç½®é¡¹ï¼æ¥è®¾ç½®ç¼å²åºçå¤§å°ãå·ä½è®¾ç½®çåå®¹åæ¬ä¸¤æ¹é¢ï¼\n\n * è®¾ç½®ç¼å²åºå¤§å°çä¸ééå¼ï¼\n * è®¾ç½®è¾åºç¼å²åºæç»­åå¥æ°æ®çæ°éä¸ééå¼ï¼åæç»­åå¥æ°æ®çæ¶é´çä¸ééå¼ã\n\nå¨å·ä½ä½¿ç¨client-output-buffer-limitæ¥è®¾ç½®ç¼å²åºå¤§å°çæ¶åï¼æä»¬éè¦ååºåä¸å®¢æ·ç«¯çç±»åã\n\nä¸»è¦åä¸¤å¤§ç±»ï¼\n\n * å¯¹äºårediså®ä¾è¿è¡äº¤äºçåºç¨ç¨åºæ¥è¯´ï¼ä¸»è¦ä½¿ç¨ä¸¤ç±»å®¢æ·ç«¯åredisæå¡å¨ç«¯äº¤äºï¼\n   * å¸¸è§åredisæå¡å¨ç«¯è¿è¡è¯»åå½ä»¤äº¤äºçæ®éå®¢æ·ç«¯\n   * è®¢éäºredisé¢éçè®¢éå®¢æ·ç«¯\n * å¨redisä¸»ä»éç¾¤ä¸­ï¼\n   * ä¸»èç¹ä¸ä¹æä¸ç±»å®¢æ·ç«¯ï¼ä»èç¹å®¢æ·ç«¯ï¼ç¨æ¥åä»èç¹è¿è¡æ°æ®åæ­¥ãä¼å¨ä»ç»ä¸»ä»éç¾¤ä¸­çç¼å²åºæ¶ï¼å·ä½ä»ç»ã\n\nå½æä»¬ç»æ®éå®¢æ·ç«¯è®¾ç½®ç¼å²åºå¤§å°æ¶ï¼éå¸¸å¯ä»¥å¨rediséç½®æä»¶ä¸­è¿è¡è¿æ ·çè®¾ç½®ï¼\n\nclient-output-buffer-limit normal 0 0 0\n\n\n1\n\n\nå¶ä¸­ï¼normal è¡¨ç¤ºå½åè®¾ç½®çæ¯æ®éå®¢æ·ç«¯ï¼ç¬¬1ä¸ª0è®¾ç½®çæ¯ç¼å²åºå¤§å°éå¶ï¼ç¬¬2ä¸ª0åç¬¬3ä¸ª0åå«è¡¨ç¤ºç¼å²åºæç»­åå¥ééå¶åæç»­åå¥æ¶é´éå¶ã\n\nå¯¹äºæ®éå®¢æ·ç«¯æ¥è¯´ï¼å®æ¯åéå®ä¸ä¸ªè¯·æ±ï¼ä¼ç­å°è¯·æ±ç»æè¿ååï¼ååéä¸ä¸ä¸ªè¯·æ±ï¼è¿ç§åéæ¹å¼ç§°ä¸ºé»å¡å¼åéãå¨è¿ç§æåµä¸ï¼å¦æä¸æ¯è¯»åä½éç¹å«å¤§çbigkeyï¼æå¡å¨ç«¯çè¾åºç¼å²åºä¸è¬ä¸ä¼è¢«é»å¡çã\n\næä»¥ï¼æä»¬éå¸¸ææ®éå®¢æ·ç«¯çç¼å²åºå¤§å°éå¶ï¼ä»¥åæç»­åå¥ééå¶ãæç»­åå¥æ¶é´éå¶é½è®¾ç½®ä¸º0ï¼ä¹å°±æ¯ä¸åéå¶ã\n\nå¯¹äºè®¢éå®¢æ·ç«¯æ¥è¯´ï¼ä¸æ¦è®¢éçredisé¢éææ¶æ¯äºï¼æå¡å¨ç«¯é½ä¼éè¿è¾åºç¼å²åºææ¶æ¯åç»å®¢æ·ç«¯ãæä»¥ï¼è®¢éå®¢æ·ç«¯åæå¡å¨é´çæ¶æ¯åéæ¹å¼ï¼ä¸å±äºé»å¡å¼åéãä¸è¿ï¼å¦æé¢éæ¶æ¯è¾å¤çè¯ï¼ä¹ä¼å ç¨è¾å¤çè¾åºç¼å²åºç©ºé´ã\n\nå æ­¤ï¼æä»¬ä¼ç»è®¢éå®¢æ·ç«¯è®¾ç½®ç¼å²åºå¤§å°éå¶ãç¼å²åºæç»­åå¥ééå¶ï¼ä»¥åæç»­åå¥æ¶é´éå¶ï¼å¯ä»¥å¨rediséç½®æä»¶ä¸­è¿æ ·è®¾ç½®ï¼\n\nclient-output-buffer-limit pubsub 8mb 2mb 60\n\n\n1\n\n\nå¶ä¸­ï¼pubsubåæ°è¡¨ç¤ºå½åæ¯å¯¹è®¢éå®¢æ·ç«¯è¿è¡è®¾ç½®ï¼8mbè¡¨ç¤ºè¾åºç¼å²åºçå¤§å°ä¸éä¸º8mbï¼ä¸æ¦å®éå ç¨çç¼å²åºå¤§å°è¦è¶è¿8mbï¼æå¡å¨ç«¯å°±ä¼ç´æ¥å³é­å®¢æ·ç«¯çè¿æ¥ï¼2mbå60è¡¨ç¤ºï¼å¦æè¿ç»­60ç§åå¯¹è¾åºç¼å²åºçåå¥éè¶è¿2mbçè¯ï¼æå¡å¨ç«¯ä¹ä¼å³é­å®¢æ·ç«¯è¿æ¥ã\n\n> å¥½å redis å¯¹ç¼å²åºå¿«è¦æº¢åºçé®é¢ï¼æåçè§£å³åæ³å°±æ¯ï¼ç´æ¥å³é­å®¢æ·ç«¯çè¿æ¥ï¼ä»¥ç»åæ£...\n\nå¥½äºï¼æä»¬æ¥æ»ç»ä¸å¦ä½åºå¯¹è¾åºç¼å²åºæº¢åºï¼\n\n * é¿åbigkeyæä½è¿åå¤§éæ°æ®ç»æï¼\n * é¿åå¨çº¿ä¸ç¯å¢ä¸­æç»­ä½¿ç¨monitorå½ä»¤ã\n * ä½¿ç¨client-output-buffer-limitè®¾ç½®åççç¼å²åºå¤§å°ä¸éï¼ææ¯ç¼å²åºè¿ç»­åå¥æ¶é´ååå¥éä¸éã\n\nä»¥ä¸å°±æ¯å³äºå®¢æ·ç«¯ç¼å²åºï¼æä»¬è¦éç¹ææ¡çåå®¹äºãæä»¬ç»§ç»­ççå¨ä¸»ä»éç¾¤é´ä½¿ç¨ç¼å²åºï¼éè¦æ³¨æä»ä¹é®é¢ã\n\n\n# 2.2 ä¸»ä»éç¾¤ä¸­çç¼å²åº\n\nä¸»ä»éç¾¤é´çæ°æ®å¤å¶åæ¬å¨éå¤å¶åå¢éå¤å¶ä¸¤ç§ãå¨éå¤å¶æ¯åæ­¥æææ°æ®ï¼èå¢éå¤å¶åªä¼æä¸»ä»åºç½ç»æ­è¿æé´ä¸»åºæ¶å°çå½ä»¤ï¼åæ­¥ç»ä»åºãæ è®ºå¨åªç§å½¢å¼çå¤å¶ä¸­ï¼ä¸ºäºä¿è¯ä¸»ä»èç¹çæ°æ®ä¸è´ï¼é½ä¼ç¨å°ç¼å²åºãä½æ¯ï¼è¿ä¸¤ç§å¤å¶åºæ¯ä¸çç¼å²åºï¼å¨æº¢åºå½±ååå¤§å°è®¾ç½®æ¹é¢å¹¶ä¸ä¸æ ·ãæä»¥ï¼æä»¬åå«æ¥å­¦ä¹ ä¸å§ã\n\n# 2.2.1 å¨éå¤å¶æé´--å¤å¶ç¼å²åºçæº¢åºé®é¢\n\nå¨å¨éå¤å¶è¿ç¨ä¸­ï¼ä¸»èç¹å¨åä»èç¹ä¼ è¾rdbæä»¶çåæ¶ï¼ä¼ç»§ç»­æ¥æ¶å®¢æ·ç«¯åéçåå½ä»¤è¯·æ±ãè¿äºåå½ä»¤å°±ä¼åä¿å­å¨å¤å¶ç¼å²åºä¸­ï¼ç­rdbæä»¶ä¼ è¾å®æåï¼ååéç»ä»èç¹å»æ§è¡ãä¸»èç¹ä¸ä¼ä¸ºæ¯ä¸ªä»èç¹é½ç»´æ¤ä¸ä¸ªå¤å¶ç¼å²åºï¼æ¥ä¿è¯ä¸»ä»èç¹é´çæ°æ®åæ­¥ã\n\næä»¥ï¼å¦æå¨å¨éå¤å¶æ¶ï¼ä»èç¹æ¥æ¶åå è½½rdbè¾æ¢ï¼åæ¶ä¸»èç¹æ¥æ¶å°äºå¤§éçåå½ä»¤ï¼åå½ä»¤å¨å¤å¶ç¼å²åºä¸­å°±ä¼è¶ç§¯è¶å¤ï¼æç»å¯¼è´æº¢åºã\n\nå¶å®ï¼ä¸»èç¹ä¸çå¤å¶ç¼å²åºï¼æ¬è´¨ä¸ä¹æ¯ä¸ä¸ªç¨äºåä»èç¹è¿æ¥çå®¢æ·ç«¯ï¼æä»¬ç§°ä¹ä¸ºä»èç¹å®¢æ·ç«¯ï¼ï¼ä½¿ç¨çè¾åºç¼å²åºãå¤å¶ç¼å²åºä¸æ¦åçæº¢åºï¼ä¸»èç¹ä¹ä¼ç´æ¥å³é­åä»èç¹è¿è¡å¤å¶æä½çè¿æ¥ï¼å¯¼è´å¨éå¤å¶å¤±è´¥ãé£å¦ä½é¿åå¤å¶ç¼å²åºåçæº¢åºå¢ï¼\n\nä¸æ¹é¢ï¼æä»¬å¯ä»¥æ§å¶ä¸»èç¹ä¿å­çæ°æ®éå¤§å°ãæéå¸¸çä½¿ç¨ç»éªï¼æä»¬ä¼æä¸»èç¹çæ°æ®éæ§å¶å¨2~4gbï¼è¿æ ·å¯ä»¥è®©å¨éåæ­¥æ§è¡å¾æ´å¿«äºï¼é¿åå¤å¶ç¼å²åºç´¯ç§¯è¿å¤å½ä»¤ã\n\nå¦ä¸æ¹é¢ï¼æä»¬å¯ä»¥ä½¿ç¨client-output-buffer-limitéç½®é¡¹ï¼æ¥è®¾ç½®åççå¤å¶ç¼å²åºå¤§å°ãè®¾ç½®çä¾æ®ï¼å°±æ¯ä¸»èç¹çæ°æ®éå¤§å°ãä¸»èç¹çåè´è½½åååä¸»èç¹æ¬èº«çåå­å¤§å°ã\n\næä»¬éè¿ä¸ä¸ªå·ä½çä¾å­ï¼æ¥å­¦ä¹ ä¸å·ä½æä¹è®¾ç½®ãå¨ä¸»èç¹æ§è¡å¦ä¸å½ä»¤ï¼\n\nconfig set client-output-buffer-limit slave 512mb 128mb 60\n\n\n1\n\n\nå¶ä¸­ï¼slaveåæ°è¡¨æè¯¥éç½®é¡¹æ¯éå¯¹å¤å¶ç¼å²åºçã512mbä»£è¡¨å°ç¼å²åºå¤§å°çä¸éè®¾ç½®ä¸º512mbï¼128mbå60ä»£è¡¨çè®¾ç½®æ¯ï¼å¦æè¿ç»­60ç§åçåå¥éè¶è¿128mbçè¯ï¼ä¹ä¼è§¦åç¼å²åºæº¢åºã\n\næä»¬åç»§ç»­ççè¿ä¸ªè®¾ç½®å¯¹æä»¬æå¥ç¨ãåè®¾ä¸æ¡åå½ä»¤æ°æ®æ¯1kbï¼é£ä¹ï¼å¤å¶ç¼å²åºå¯ä»¥ç´¯ç§¯512kæ¡ï¼512mb/1kb = 512kï¼åå½ä»¤ãåæ¶ï¼ä¸»èç¹å¨å¨éå¤å¶æé´ï¼å¯ä»¥æ¿åçåå½ä»¤éçä¸éæ¯2000æ¡/sï¼128mb/1kb/60 çº¦ç­äº2000ï¼ã\n\nè¿æ ·ä¸æ¥ï¼æä»¬å°±å¾å°äºä¸ç§æ¹æ³ï¼å¨å®éåºç¨ä¸­è®¾ç½®å¤å¶ç¼å²åºçå¤§å°æ¶ï¼å¯ä»¥æ ¹æ®åå½ä»¤æ°æ®çå¤§å°ååºç¨çå®éè´è½½æåµï¼ä¹å°±æ¯åå½ä»¤éçï¼ï¼æ¥ç²ç¥ä¼°è®¡ç¼å²åºä¸­ä¼ç´¯ç§¯çåå½ä»¤æ°æ®éï¼ç¶åï¼ååæè®¾ç½®çå¤å¶ç¼å²åºå¤§å°è¿è¡æ¯è¾ï¼å¤æ­è®¾ç½®çç¼å²åºå¤§å°æ¯å¦è¶³å¤æ¯æç´¯ç§¯çåå½ä»¤æ°æ®éã\n\nå³äºå¤å¶ç¼å²åºï¼æä»¬è¿ä¼éå°ä¸ä¸ªé®é¢ãä¸»èç¹ä¸å¤å¶ç¼å²åºçåå­å¼éï¼ä¼æ¯æ¯ä¸ªä»èç¹å®¢æ·ç«¯è¾åºç¼å²åºå ç¨åå­çæ»åãå¦æéç¾¤ä¸­çä»èç¹æ°éå¸¸å¤çè¯ï¼ä¸»èç¹çåå­å¼éå°±ä¼éå¸¸å¤§ãæä»¥ï¼æä»¬è¿å¿é¡»å¾æ§å¶åä¸»èç¹è¿æ¥çä»èç¹ä¸ªæ°ï¼ä¸è¦ä½¿ç¨å¤§è§æ¨¡çä¸»ä»éç¾¤ã\n\nå¥½äºï¼æä»¬åæ»ç»ä¸ä¸è¿é¨åçåå®¹ãä¸ºäºé¿åå¤å¶ç¼å²åºç´¯ç§¯è¿å¤å½ä»¤é ææº¢åºï¼å¼åå¨éå¤å¶å¤±è´¥ï¼æä»¬å¯ä»¥æ§å¶ä¸»èç¹ä¿å­çæ°æ®éå¤§å°ï¼å¹¶è®¾ç½®åççå¤å¶ç¼å²åºå¤§å°ãåæ¶ï¼æä»¬éè¦æ§å¶ä»èç¹çæ°éï¼æ¥é¿åä¸»èç¹ä¸­å¤å¶ç¼å²åºå ç¨è¿å¤åå­çé®é¢ã\n\n# 2.2.2 å¢éå¤å¶æé´--å¤å¶ç§¯åç¼å²åºçæº¢åºé®é¢\n\næ¥ä¸æ¥ï¼æä»¬åæ¥çä¸å¢éå¤å¶æ¶ä½¿ç¨çç¼å²åºï¼è¿ä¸ªç¼å²åºç§°ä¸ºå¤å¶ç§¯åç¼å²åºã\n\nä¸»èç¹å¨ææ¥æ¶å°çåå½ä»¤åæ­¥ç»ä»èç¹æ¶ï¼åæ¶ä¼æè¿äºåå½ä»¤åå¥å¤å¶ç§¯åç¼å²åºãä¸æ¦ä»èç¹åçç½ç»éªæ­ï¼åæ¬¡åä¸»èç¹æ¢å¤è¿æ¥åï¼ä»èç¹å°±ä¼ä»å¤å¶ç§¯åç¼å²åºä¸­ï¼è¯»åæ­è¿æé´ä¸»èç¹æ¥æ¶å°çåå½ä»¤ï¼è¿èè¿è¡å¢éåæ­¥ï¼å¦ä¸å¾æç¤ºï¼\n\nä¹åä¹æè®²è¿è¿ä¸ªå¤å¶ç§¯åç¼å²åºï¼åªä¸è¿å½æ¶ç§°ä¹ä¸º repl_backlog_bufferãè¿éå°ä»ç¼å²åºæº¢åºçè§åº¦åæ¥åé¡¾ä¸ä¸¤ä¸ªéç¹ï¼å¤å¶ç§¯åç¼å²åºæº¢åºçå½±åï¼ä»¥åå¦ä½åºå¯¹å¤å¶ç§¯åç¼å²åºçæº¢åºé®é¢ã\n\n * é¦åï¼å¤å¶ç§¯åç¼å²åºæ¯ä¸ä¸ªå¤§å°æéçç¯å½¢ç¼å²åºãå½ä¸»èç¹æå¤å¶ç§¯åç¼å²åºåæ»¡åï¼ä¼è¦çç¼å²åºä¸­çæ§å½ä»¤æ°æ®ãå¦æä»èç¹è¿æ²¡æåæ­¥è¿äºæ§å½ä»¤æ°æ®ï¼å°±ä¼é æä¸»ä»èç¹é´éæ°å¼å§æ§è¡å¨éå¤å¶ã\n\n * å¶æ¬¡ï¼ä¸ºäºåºå¯¹å¤å¶ç§¯åç¼å²åºçæº¢åºé®é¢ï¼æä»¬å¯ä»¥è°æ´å¤å¶ç§¯åç¼å²åºçå¤§å°ï¼ä¹å°±æ¯è®¾ç½®repl_backlog_sizeè¿ä¸ªåæ°çå¼ãå·ä½çè°æ´ä¾æ®ï¼ä½ å¯ä»¥åçä¸ç¬¬6è®²ä¸­æä¾çrepl_backlog_sizeå¤§å°çè®¡ç®ä¾æ®ã\n\n\n# 2.3 å°ç»\n\nè¿ä¸å¤§èä¸»è¦è®²äº redis ä¸­æä½¿ç¨çç¼å²åºï¼ä½¿ç¨ç¼å²åºä»¥åï¼å½å½ä»¤æ°æ®çæ¥æ¶æ¹å¤çéåº¦è·ä¸ä¸åéæ¹çåééåº¦æ¶ï¼ç¼å²åºå¯ä»¥é¿åå½ä»¤æ°æ®çä¸¢å¤±ã\n\næä»¬æ»å±å°ç¼å²åºåæäºåä¸ªï¼\n\n * å®¢æ·ç«¯çè¾å¥ç¼å²åº\n * å®¢æ·ç«¯çè¾åºç¼å²åº\n * ä¸»ä»éç¾¤ä¸­ä¸»èç¹ä¸çå¤å¶ç¼å²åº\n * ä¸»ä»éç¾¤ä¸­ä¸»èç¹ä¸çå¤å¶ç§¯åç¼å²åº\n\nä»ç¼å²åºæº¢åºå¯¹redisçå½±åçè§åº¦ï¼å¯ä»¥å°è¿åä¸ªç¼å²åæå¦ä¸ä¸¤ç±»ï¼\n\n * ç¼å²åºæº¢åºå¯¼è´ç½ç»è¿æ¥å³é­ï¼æ®éå®¢æ·ç«¯ãè®¢éå®¢æ·ç«¯ï¼ä»¥åä»èç¹å®¢æ·ç«¯ï¼å®ä»¬ä½¿ç¨çç¼å²åºï¼æ¬è´¨ä¸é½æ¯rediså®¢æ·ç«¯åæå¡å¨ç«¯ä¹é´ï¼ææ¯ä¸»ä»èç¹ä¹é´ä¸ºäºä¼ è¾å½ä»¤æ°æ®èç»´æ¤çãè¿äºç¼å²åºä¸æ¦åçæº¢åºï¼å¤çæºå¶é½æ¯ç´æ¥æå®¢æ·ç«¯åæå¡å¨ç«¯çè¿æ¥ï¼ææ¯ä¸»ä»èç¹é´çè¿æ¥å³é­ãç½ç»è¿æ¥å³é­é æçç´æ¥å½±åï¼å°±æ¯ä¸å¡ç¨åºæ æ³è¯»åredisï¼æèæ¯ä¸»ä»èç¹å¨éåæ­¥å¤±è´¥ï¼éè¦éæ°æ§è¡ã\n * ç¼å²åºæº¢åºå¯¼è´å½ä»¤æ°æ®ä¸¢å¤±ï¼ä¸»èç¹ä¸çå¤å¶ç§¯åç¼å²åºå±äºç¯å½¢ç¼å²åºï¼ä¸æ¦åçæº¢åºï¼æ°åå¥çå½ä»¤æ°æ®å°±ä¼è¦çæ§çå½ä»¤æ°æ®ï¼å¯¼è´æ§å½ä»¤æ°æ®çä¸¢å¤±ï¼è¿èå¯¼è´ä¸»ä»èç¹éæ°è¿è¡å¨éå¤å¶ã\n\nä»æ¬è´¨ä¸çï¼ç¼å²åºæº¢åºï¼æ éå°±æ¯ä¸ä¸ªåå ï¼å½ä»¤æ°æ®åéè¿å¿«è¿å¤§ï¼å½ä»¤æ°æ®å¤çè¾æ¢ï¼ç¼å²åºç©ºé´è¿å°ãæç½äºè¿ä¸ªï¼æä»¬å°±å¯ä»¥æéå¯¹æ§å°æ¿åºåºå¯¹ç­ç¥äºï¼\n\n * éå¯¹å½ä»¤æ°æ®åéè¿å¿«è¿å¤§çé®é¢ï¼å¯¹äºæ®éå®¢æ·ç«¯æ¥è¯´å¯ä»¥é¿åbigkeyï¼èå¯¹äºå¤å¶ç¼å²åºæ¥è¯´ï¼å°±æ¯é¿åè¿å¤§çrdbæä»¶ã\n * éå¯¹å½ä»¤æ°æ®å¤çè¾æ¢çé®é¢ï¼è§£å³æ¹æ¡å°±æ¯åå°redisä¸»çº¿ç¨ä¸çé»å¡æä½ï¼ä¾å¦ä½¿ç¨å¼æ­¥çå é¤æä½ã\n * éå¯¹ç¼å²åºç©ºé´è¿å°çé®é¢ï¼è§£å³æ¹æ¡å°±æ¯ä½¿ç¨client-output-buffer-limitéç½®é¡¹è®¾ç½®åççè¾åºç¼å²åºãå¤å¶ç¼å²åºåå¤å¶ç§¯åç¼å²åºå¤§å°ãå½ç¶ï¼æä»¬ä¸è¦å¿äºï¼è¾å¥ç¼å²åºçå¤§å°é»è®¤æ¯åºå®çï¼æä»¬æ æ³éè¿éç½®æ¥ä¿®æ¹å®ï¼é¤éç´æ¥å»ä¿®æ¹redisæºç ã\n\næäºä¸é¢è¿äºåºå¯¹æ¹æ³ï¼æç¸ä¿¡ä½ å¨å®éåºç¨æ¶ï¼å°±å¯ä»¥é¿åç¼å²åºæº¢åºå¸¦æ¥çå½ä»¤æ°æ®ä¸¢å¤±ãrediså´©æºçè¿äºâæ¨æ¡âäºã",charsets:{cjk:!0},lastUpdated:"2023/04/10, 13:35:58",lastUpdatedTimestamp:1681133758e3},{title:"Redis ç¨ä½ç¼å­",frontmatter:{title:"Redis ç¨ä½ç¼å­",date:"2023-04-10T22:18:22.000Z",permalink:"/pages/d403e5/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/23.Redis%20%E7%94%A8%E4%BD%9C%E7%BC%93%E5%AD%98.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/23.Redis ç¨ä½ç¼å­.md",key:"v-29b8baff",path:"/pages/d403e5/",headers:[{level:2,title:"1. æè·¯ç¼å­ï¼Redis æ¯å¦ä½å·¥ä½çï¼",slug:"_1-æè·¯ç¼å­-redis-æ¯å¦ä½å·¥ä½ç",normalizedTitle:"1. æè·¯ç¼å­ï¼redis æ¯å¦ä½å·¥ä½çï¼",charIndex:347},{level:3,title:"1.1 ç¼å­çç¹å¾",slug:"_1-1-ç¼å­çç¹å¾",normalizedTitle:"1.1 ç¼å­çç¹å¾",charIndex:423},{level:3,title:"1.2 Redis ç¼å­å¤çè¯·æ±çä¸¤ç§æåµ",slug:"_1-2-redis-ç¼å­å¤çè¯·æ±çä¸¤ç§æåµ",normalizedTitle:"1.2 redis ç¼å­å¤çè¯·æ±çä¸¤ç§æåµ",charIndex:854},{level:3,title:"1.3 Redis ä½ä¸ºæè·¯ç¼å­çä½¿ç¨æä½",slug:"_1-3-redis-ä½ä¸ºæè·¯ç¼å­çä½¿ç¨æä½",normalizedTitle:"1.3 redis ä½ä¸ºæè·¯ç¼å­çä½¿ç¨æä½",charIndex:1181},{level:3,title:"1.4 ç¼å­çç±»å",slug:"_1-4-ç¼å­çç±»å",normalizedTitle:"1.4 ç¼å­çç±»å",charIndex:2486},{level:4,title:"1.4.1 åªè¯»ç¼å­",slug:"_1-4-1-åªè¯»ç¼å­",normalizedTitle:"1.4.1 åªè¯»ç¼å­",charIndex:2525},{level:4,title:"1.4.2 è¯»åç¼å­",slug:"_1-4-2-è¯»åç¼å­",normalizedTitle:"1.4.2 è¯»åç¼å­",charIndex:2888},{level:2,title:"2. æ¿æ¢ç­ç¥ï¼ç¼å­æ»¡äºæä¹åï¼",slug:"_2-æ¿æ¢ç­ç¥-ç¼å­æ»¡äºæä¹å",normalizedTitle:"2. æ¿æ¢ç­ç¥ï¼ç¼å­æ»¡äºæä¹åï¼",charIndex:3490},{level:3,title:"2.1 è®¾ç½®å¤å¤§çç¼å­å®¹éåéï¼",slug:"_2-1-è®¾ç½®å¤å¤§çç¼å­å®¹éåé",normalizedTitle:"2.1 è®¾ç½®å¤å¤§çç¼å­å®¹éåéï¼",charIndex:3638},{level:3,title:"2.2 Redis ç¼å­æåªäºæ·æ±°ç­ç¥ï¼",slug:"_2-2-redis-ç¼å­æåªäºæ·æ±°ç­ç¥",normalizedTitle:"2.2 redis ç¼å­æåªäºæ·æ±°ç­ç¥ï¼",charIndex:4191},{level:3,title:"2.3 å¦ä½å¤çè¢«æ·æ±°çæ°æ®ï¼",slug:"_2-3-å¦ä½å¤çè¢«æ·æ±°çæ°æ®",normalizedTitle:"2.3 å¦ä½å¤çè¢«æ·æ±°çæ°æ®ï¼",charIndex:6373}],headersStr:"1. æè·¯ç¼å­ï¼Redis æ¯å¦ä½å·¥ä½çï¼ 1.1 ç¼å­çç¹å¾ 1.2 Redis ç¼å­å¤çè¯·æ±çä¸¤ç§æåµ 1.3 Redis ä½ä¸ºæè·¯ç¼å­çä½¿ç¨æä½ 1.4 ç¼å­çç±»å 1.4.1 åªè¯»ç¼å­ 1.4.2 è¯»åç¼å­ 2. æ¿æ¢ç­ç¥ï¼ç¼å­æ»¡äºæä¹åï¼ 2.1 è®¾ç½®å¤å¤§çç¼å­å®¹éåéï¼ 2.2 Redis ç¼å­æåªäºæ·æ±°ç­ç¥ï¼ 2.3 å¦ä½å¤çè¢«æ·æ±°çæ°æ®ï¼",content:"> åèï¼\n> \n>  * 23 æè·¯ç¼å­ï¼Redis æ¯å¦ä½å·¥ä½çï¼| æå®¢æ¶é´\n>  * 24 æ¿æ¢ç­ç¥ï¼ç¼å­æ»¡äºæä¹åï¼| æå®¢æ¶é´\n\nç±äº Redis æä¾äºé«æ§è½çæ°æ®å­ååè½ï¼å æ­¤è¢«å¹¿æ³åºç¨å°ç¼å­çåºæ¯ä¸­ï¼è¿å¯ä»¥æææåä¸å¡çååºéåº¦ï¼åæ¶é¿åæååç´¯ç§¯å°æ°æ®åºå±é¢ã\n\nææ¡ç¼å­éè¦è§£å³åä¸ªå³é®é®é¢ï¼\n\n * Redis ç¼å­å·ä½æ¯æä¹å·¥ä½çï¼(å·¥ä½åç)\n * Redis ç¼å­å¦ææ»¡äºï¼è¯¥æä¹åï¼(æ¿æ¢ç­ç¥)\n * ä¸ºä»ä¹ä¼æç¼å­ä¸è´æ§ãç¼å­ç©¿éãç¼å­éªå´©ãç¼å­å»ç©¿ç­å¼å¸¸ï¼è¯¥å¦ä½åºå¯¹ï¼(å¼å¸¸å¤çæºå¶)\n * Redis çåå­æ¯ç«æéï¼å¦æç¨å¿«éçåºæç¡¬çæ¥ä¿å­æ°æ®ï¼å¯ä»¥å¢å ç¼å­çæ°æ®éï¼é£ Redis ç¼å­å¯ä»¥ä½¿ç¨å¿«éåºæç¡¬çåï¼(æ©å±æºå¶)\n\nä¸é¢åå«ä»ç»ã\n\n\n# 1. æè·¯ç¼å­ï¼Redis æ¯å¦ä½å·¥ä½çï¼\n\nè¿ä¸å¤§èä¸»è¦äºè§£ä¸ç¼å­çç¹å¾åRediséç¨äºç¼å­çå¤©ç¶ä¼å¿ï¼ä»¥åRedisç¼å­çå·ä½å·¥ä½æºå¶ã\n\n\n# 1.1 ç¼å­çç¹å¾\n\nè®¡ç®æºç³»ç»ä¸­ï¼é»è®¤æä¸¤ç§ç¼å­ï¼\n\n * CPUéé¢çæ«çº§ç¼å­ï¼å³LLCï¼ç¨æ¥ç¼å­åå­ä¸­çæ°æ®ï¼é¿åæ¯æ¬¡ä»åå­ä¸­å­åæ°æ®ï¼\n * åå­ä¸­çé«éé¡µç¼å­ï¼å³page cacheï¼ç¨æ¥ç¼å­ç£çä¸­çæ°æ®ï¼é¿åæ¯æ¬¡ä»ç£çä¸­å­åæ°æ®ã\n\nå·ä½å¦ä¸å¾æç¤ºï¼\n\nLLCçå¤§å°æ¯MBçº§å«ï¼page cacheçå¤§å°æ¯GBçº§å«ï¼èç£ççå¤§å°æ¯TBçº§å«ã\n\nç¼å­çç¬¬ä¸ä¸ªç¹å¾ï¼å¨ä¸ä¸ªå±æ¬¡åçç³»ç»ä¸­ï¼ç¼å­ä¸å®æ¯ä¸ä¸ªå¿«éå­ç³»ç»ï¼æ°æ®å­å¨ç¼å­ä¸­æ¶ï¼è½é¿åæ¯æ¬¡ä»æ¢éå­ç³»ç»ä¸­å­åæ°æ®ãå¯¹åºå°äºèç½åºç¨æ¥è¯´ï¼Redis å°±æ¯å¿«éå­ç³»ç»ï¼èæ°æ®åºå°±æ¯æ¢éå­ç³»ç»äºã\n\nç¼å­çç¬¬äºä¸ªç¹å¾ï¼ç¼å­ç³»ç»çå®¹éå¤§å°æ»æ¯å°äºåç«¯æ¢éç³»ç»çï¼æä»¬ä¸å¯è½ææææ°æ®é½æ¾å¨ç¼å­ç³»ç»ä¸­ãå æ­¤ç¼å­åæ¢éç³»ç»ä¹é´å¿ç¶å­å¨æ°æ®ååååè¯»åçäº¤äºè¿ç¨ãè¿ä½ å¯è½ä¼æ³å° Redis æ¬èº«æ¯æ¯ææä¸å®è§åæ·æ±°æ°æ®çï¼ç¸å½äºå®ç°äºç¼å­çæ°æ®æ·æ±°ï¼å¶å®ï¼è¿ä¹æ¯ Redis éåç¨ä½ç¼å­çä¸ä¸ªéè¦åå ã\n\n\n# 1.2 Redis ç¼å­å¤çè¯·æ±çä¸¤ç§æåµ\n\næ Redis ç¨ä½ç¼å­æ¶ï¼æä»¬ä¼æ Redis é¨ç½²å¨æ°æ®åºçåç«¯ï¼ä¸å¡åºç¨å¨è®¿é®æ°æ®æ¶ï¼ä¼åæ¥è¯¢ Redis ä¸­æ¯å¦ä¿å­äºç¸åºçæ°æ®ãæ­¤æ¶ï¼æ ¹æ®æ°æ®æ¯å¦å­å¨ç¼å­ä¸­ï¼ä¼æä¸¤ç§æåµï¼\n\n * ç¼å­å½ä¸­\n * ç¼å­ç¼ºå¤±ï¼è¿æ¶éè¦è¿è¡ç¼å­æ´æ°ï¼è¿æ¶åå°æ°æ®ä¸è´æ§çé®é¢ï¼ä¼å¨åæè®²è¿°ï¼\n\nç±æ­¤ï¼ä½¿ç¨ Redis ä½ä¸ºç¼å­ä¸»è¦æä¸ä¸ªæä½ï¼\n\n * åºç¨è¯»åæ°æ®æ¶ï¼éè¦åè¯»å Redisï¼\n * åçç¼å­ç¼ºå¤±æ¶ï¼éè¦ä»æ°æ®åºè¯»åæ°æ®ï¼\n * åçç¼å­ç¼ºå¤±æ¶ï¼è¿éè¦æ´æ°ç¼å­ã\n\né£ä¹ï¼è¿äºæä½å·ä½æ¯ç±è°æ¥åçå¢ï¼è¿åRedisç¼å­çä½¿ç¨æ¹å¼ç¸å³ãæ¥ä¸æ¥å°±åä½ èè Redis ä½ä¸ºæè·¯ç¼å­çä½¿ç¨æä½æ¹å¼ã\n\n\n# 1.3 Redis ä½ä¸ºæè·¯ç¼å­çä½¿ç¨æä½\n\nRedisæ¯ä¸ä¸ªç¬ç«çç³»ç»è½¯ä»¶ï¼åä¸å¡åºç¨ç¨åºæ¯ä¸¤ä¸ªè½¯ä»¶ï¼å½æä»¬é¨ç½²äºRediså®ä¾åï¼å®åªä¼è¢«å¨å°ç­å¾å®¢æ·ç«¯åéè¯·æ±ï¼ç¶ååè¿è¡å¤çãæä»¥ï¼ å¦æåºç¨ç¨åºæ³è¦ä½¿ç¨ Redis ç¼å­ï¼æä»¬å°±è¦å¨ç¨åºä¸­å¢å ç¸åºçç¼å­æä½ä»£ç ï¼æä»¥ä¹æ Redis ç§°ä¸ºæè·¯ç¼å­ï¼ä¹å°±æ¯è¯´ï¼è¯»åç¼å­ãè¯»åæ°æ®åºåæ´æ°ç¼å­çæä½é½éè¦å¨åºç¨ç¨åºä¸­æ¥å®æã\n\n> è¿ç§æè·¯ç¼å­ä¸è®¡ç®æºç³»ç»ä¸­çç¼å­ä¸å¤ªä¸æ ·ï¼æ¯å¦è®¡ç®æºç³»ç»ä¸­ç page cache å¹¶ä¸éè¦ä½ å»æ¾ç¤ºè°ç¨å®ç GET æ¥å£ç­ï¼èæ¯è®¡ç®æºç´æ¥å°è¿äºç¼å­æ¾å¨äºç¨åºçæ°æ®è®¿é®è·¯å¾ä¸å¹¶ç´æ¥ä½¿ç¨ã\n\nå¨ä½¿ç¨ Redis ä½ä¸ºç¼å­æ¶ï¼æä»¬éè¦å¨åºç¨ç¨åºä¸­å¢å ä¸æ¹é¢çä»£ç ï¼\n\n * å½åºç¨ç¨åºéè¦è¯»åæ°æ®æ¶ï¼æä»¬éè¦å¨ä»£ç ä¸­æ¾å¼è°ç¨ Redis ç GET æä½æ¥å£ï¼è¿è¡æ¥è¯¢ï¼\n * å¦æç¼å­ç¼ºå¤±äºï¼åºç¨ç¨åºéè¦ååæ°æ®åºè¿æ¥ï¼ä»æ°æ®åºä¸­è¯»åæ°æ®ï¼\n * å½ç¼å­ä¸­çæ°æ®éè¦æ´æ°æ¶ï¼æä»¬ä¹éè¦å¨åºç¨ç¨åºä¸­æ¾å¼å°è°ç¨ SET æä½æ¥å£ï¼ææ´æ°çæ°æ®åå¥ç¼å­ã\n\nä¸é¢æ¯ä¸æ®µå¨ Web åºç¨ä¸­ä½¿ç¨ Redis ç¼å­çä¼ªä»£ç ç¤ºä¾ï¼\n\nString cacheKey = âproductid_11010003â;\nString cacheValue = redisCache.get(cacheKey)ï¼\n//ç¼å­å½ä¸­\nif (cacheValue != NULL)\n   return cacheValue;\n//ç¼å­ç¼ºå¤±\nelse\n   cacheValue = getProductFromDB();\n   redisCache.put(cacheValue)  //ç¼å­æ´æ°\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯ä»¥çå°ï¼ä¸ºäºä½¿ç¨ç¼å­ï¼Web åºç¨ç¨åºéè¦æä¸ä¸ªè¡¨ç¤ºç¼å­ç³»ç»çå®ä¾å¯¹è±¡ redisCacheï¼è¿éè¦ä¸»å¨è°ç¨ GET æ¥å£ï¼å¹¶ä¸è¦å¤çç¼å­å½ä¸­åç¼å­ç¼ºå¤±æ¶çé»è¾ï¼ä¾å¦å¨ç¼å­ç¼ºå¤±æ¶ï¼éè¦æ´æ°ç¼å­ã\n\nRediså¹¶ä¸éç¨äºé£äºæ æ³è·å¾æºç çåºç¨ï¼å ä¸ºéè¦æ°å¢ç¨åºä»£ç æ¥ä½¿ç¨ç¼å­ãä¾å¦ä¸äºå¾æ©ä¹åå¼åçåºç¨ç¨åºï¼å®ä»¬çæºç å·²ç»æ²¡æåç»´æ¤äºï¼æèæ¯ç¬¬ä¸æ¹ä¾åºåå¼åçåºç¨ï¼æ²¡ææä¾æºç ï¼æä»¥ï¼å°±ä¸è½ä½¿ç¨Redisåç¼å­äºã\n\nå¨ä½¿ç¨æè·¯ç¼å­æ¶ï¼æä»¬éè¦å¨åºç¨ç¨åºä¸­å¢å æä½ä»£ç ï¼å¢å äºä½¿ç¨Redisç¼å­çé¢å¤å·¥ä½éï¼ä½æ¯ï¼ä¹æ­£å ä¸ºRedisæ¯æè·¯ç¼å­ï¼æ¯ä¸ä¸ªç¬ç«çç³»ç»ï¼æä»¬å¯ä»¥åç¬å¯¹Redisç¼å­è¿è¡æ©å®¹ææ§è½ä¼åãèä¸ï¼åªè¦ä¿ææä½æ¥å£ä¸åï¼æä»¬å¨åºç¨ç¨åºä¸­å¢å çä»£ç å°±ä¸ç¨åä¿®æ¹äºã\n\nåºç¨ç¨åºé¤äºè¯»åæ°æ®å¤ï¼è¿å¯è½å¯¹æ°æ®è¿è¡ä¿®æ¹ãè¿æ¶æä»¬æ¢å¯ä»¥å¨ç¼å­ä¸­ä¿®æ¹ï¼ä¹å¯ä»¥å¨åç«¯æ°æ®åºä¸­è¿è¡ä¿®æ¹ï¼æä»¬è¯¥æä¹éæ©å¢ï¼\n\nå¶å®ï¼è¿å°±æ¶åå°äºRedisç¼å­çä¸¤ç§ç±»åï¼\n\n * åªè¯»ç¼å­è½å éè¯»è¯·æ±\n * è¯»åç¼å­å¯ä»¥åæ¶å éè¯»åè¯·æ±ã\n\nèä¸ï¼è¯»åç¼å­åæä¸¤ç§æ°æ®ååç­ç¥ï¼å¯ä»¥è®©æä»¬æ ¹æ®ä¸å¡éæ±ï¼å¨ä¿è¯æ§è½åä¿è¯æ°æ®å¯é æ§ä¹é´è¿è¡éæ©ãæä»¥ï¼æ¥ä¸æ¥ï¼æä»¬æ¥å·ä½äºè§£ä¸ Redis çç¼å­ç±»ååç¸åºçååç­ç¥ã\n\n\n# 1.4 ç¼å­çç±»å\n\næç§æ¯å¦æ¥ååè¯·æ±ï¼å¯ä»¥åæåªè¯»ç¼å­åè¯»åç¼å­ã\n\n# 1.4.1 åªè¯»ç¼å­\n\nå½Redisç¨ä½åªè¯»ç¼å­æ¶ï¼åºç¨è¦è¯»åæ°æ®çè¯ï¼ä¼åè°ç¨ Redis GET æ¥å£ï¼æ¥è¯¢æ°æ®æ¯å¦å­å¨ãèææçæ°æ®åè¯·æ±ï¼ä¼ç´æ¥åå¾åç«¯çæ°æ®åºï¼å¨æ°æ®åºä¸­å¢å æ¹ãå¯¹äºå æ¹çæ°æ®æ¥è¯´ï¼å¦æ Redis å·²ç»ç¼å­äºç¸åºçæ°æ®ï¼åºç¨éè¦æè¿äºç¼å­çæ°æ®å é¤ï¼Redis ä¸­å°±æ²¡æè¿äºæ°æ®äºã\n\nå½åºç¨åæ¬¡è¯»åè¿äºæ°æ®æ¶ï¼ä¼åçç¼å­ç¼ºå¤±ï¼åºç¨ä¼æè¿äºæ°æ®ä»æ°æ®åºä¸­è¯»åºæ¥ï¼å¹¶åå°ç¼å­ä¸­ãè¿æ ·ä¸æ¥ï¼è¿äºæ°æ®åç»­åè¢«è¯»åæ¶ï¼å°±å¯ä»¥ç´æ¥ä»ç¼å­ä¸­è·åäºï¼è½èµ·å°å éè®¿é®çææã\n\nä¸å¾å±ç¤ºäºåºç¨ä¿®æ¹æ°æ® A ååæ¬¡è®¿é® A çè¿ç¨ï¼\n\nåªè¯»ç¼å­ç´æ¥å¨æ°æ®åºä¸­æ´æ°æ°æ®çå¥½å¤æ¯ï¼ææææ°çæ°æ®é½å¨æ°æ®åºä¸­ï¼è¿äºæ°æ®ä¸ä¼æä¸¢å¤±çé£é©ãå½æä»¬éè¦ç¼å­å¾çãç­è§é¢è¿äºç¨æ·åªè¯»çæ°æ®æ¶ï¼å°±å¯ä»¥ä½¿ç¨åªè¯»ç¼å­è¿ä¸ªç±»åäºã\n\n# 1.4.2 è¯»åç¼å­\n\nå¯¹äºè¯»åç¼å­æ¥è¯´ï¼é¤äºè¯»è¯·æ±ä¼åéå°ç¼å­è¿è¡å¤çï¼ææçåè¯·æ±ä¹ä¼åéå°ç¼å­ï¼å¨ç¼å­ä¸­ç´æ¥å¯¹æ°æ®è¿è¡å¢å æ¹æä½ãå¾çäº Redis çé«æ§è½è®¿é®ç¹æ§ï¼æ°æ®çå¢å æ¹æä½å¯ä»¥å¨ç¼å­ä¸­å¿«éå®æï¼å¤çç»æä¹ä¼å¿«éè¿åç»ä¸å¡åºç¨ï¼è¿å°±å¯ä»¥æåä¸å¡åºç¨çååºéåº¦ã\n\nä½æ¯ï¼ååªè¯»ç¼å­ä¸ä¸æ ·çæ¯ï¼å¨ä½¿ç¨è¯»åç¼å­æ¶ï¼ææ°çæ°æ®æ¯å¨Redisä¸­ï¼èRedisæ¯åå­æ°æ®åºï¼ä¸æ¦åºç°æçµæå®æºï¼åå­ä¸­çæ°æ®å°±ä¼ä¸¢å¤±ãè¿ä¹å°±æ¯è¯´ï¼åºç¨çææ°æ°æ®å¯è½ä¼ä¸¢å¤±ï¼ç»åºç¨ä¸å¡å¸¦æ¥é£é©ã\n\næ ¹æ®ä¸å¡åºç¨å¯¹æ°æ®å¯é æ§åç¼å­æ§è½çä¸åè¦æ±ï¼æåæ­¥ç´ååå¼æ­¥ååä¸¤ç§ç­ç¥ï¼å¦ä¸å¾æç¤ºï¼\n\n * åæ­¥ç´åç­ç¥ä¼åä¿è¯æ°æ®å¯é æ§ï¼ä¼éä½è®¿é®æ§è½\n * å¼æ­¥ååç­ç¥ä¼åæä¾å¿«éååºï¼ææ°æ®ä¸¢å¤±é£é©\n\nå³äºæ¯éæ©åªè¯»ç¼å­ï¼è¿æ¯è¯»åç¼å­ï¼ä¸»è¦çæä»¬å¯¹åè¯·æ±æ¯å¦æå éçéæ±ï¼\n\n * å¦æéè¦å¯¹åè¯·æ±è¿è¡å éï¼æä»¬éæ©è¯»åç¼å­ï¼\n * å¦æåè¯·æ±å¾å°ï¼æèæ¯åªéè¦æåè¯»è¯·æ±çååºéåº¦çè¯ï¼æä»¬éæ©åªè¯»ç¼å­ã\n\n> ä¸¾ä¸ªä¾å­ï¼å¨ååå¤§ä¿çåºæ¯ä¸­ï¼ååçåºå­ä¿¡æ¯ä¼ä¸ç´è¢«ä¿®æ¹ãå¦ææ¯æ¬¡ä¿®æ¹é½éå°æ°æ®åºä¸­å¤çï¼å°±ä¼ææ¢æ´ä¸ªåºç¨ï¼æ­¤æ¶ï¼æä»¬éå¸¸ä¼éæ©è¯»åç¼å­çæ¨¡å¼ãèå¨ç­è§é¢Appçåºæ¯ä¸­ï¼è½ç¶è§é¢çå±æ§æå¾å¤ï¼ä½æ¯ï¼ä¸è¬ç¡®å®åï¼ä¿®æ¹å¹¶ä¸é¢ç¹ï¼æ­¤æ¶ï¼å¨æ°æ®åºä¸­è¿è¡ä¿®æ¹å¯¹ç¼å­å½±åä¸å¤§ï¼æä»¥åªè¯»ç¼å­æ¨¡å¼æ¯ä¸ä¸ªåéçéæ©ã\n\n\n# 2. æ¿æ¢ç­ç¥ï¼ç¼å­æ»¡äºæä¹åï¼\n\nç¼å­ç©ºé´æéï¼è¿å°±æ¶åå°äºç¼å­ç³»ç»çä¸ä¸ªéè¦æºå¶ï¼ç¼å­æ¿æ¢æºå¶ãç®åæ¥è¯´ï¼æ°æ®æ·æ±°æºå¶åæ¬ä¸¤æ­¥ï¼\n\n 1. æ ¹æ®ä¸å®çç­ç¥ï¼ç­éåºå¯¹åºç¨è®¿é®æ¥è¯´âä¸éè¦âçæ°æ®ï¼\n 2. å°è¿äºæ°æ®ä»ç¼å­ä¸­å é¤ï¼ä¸ºæ°æ¥çæ°æ®è¾åºç©ºé´\n\nè¿ä¸èå°ä¸»è¦æ¢è®¨ç¼å­æ¿æ¢ç­ç¥ã\n\n\n# 2.1 è®¾ç½®å¤å¤§çç¼å­å®¹éåéï¼\n\nç¼å­å®¹éçè®¾ç½®ä¼ç´æ¥å½±åå°ç¼å­çæ§ä»·æ¯ã\n\nç±äºå±é¨æ§åçï¼å¾å¾ä¸é¨åæ°æ®å°±æ¯æäºå·¨å¤§çè®¿é®éãå¦ä¸å¾ï¼\n\n * èçº¿è¡¨ç¤ºâäºå«åçâï¼å³20%çæ°æ®è´¡ç®äº80%çè®¿é®ï¼èå©ä½çæ°æ®è½ç¶ä½éå¾å¤§ï¼ä½åªè´¡ç®äº20%çè®¿é®éãè¿80%çæ°æ®å¨è®¿é®éä¸å°±å½¢æäºä¸æ¡é¿é¿çå°¾å·´ï¼æä»¬ä¹ç§°ä¸ºé¿å°¾æåºã\n * ä½å®éä¸­éçç¨æ·çä¸ªæ§åéæ±è¶æ¥è¶å¤ï¼ä¸åç¨æ·è®¿é®çåå®¹å¯è½å·®å«å¾å¤§ï¼å¯¼è´å¯è½ä¸åå·å¤äºå«åçåå¸ç¹å¾äºï¼ä¹å°±æ¯è¯´ï¼20%çæ°æ®å¯è½è´¡ç®ä¸äº80%çè®¿é®ï¼èå©ä½ç80%æ°æ®åèè´¡ç®äºæ´å¤çè®¿é®éï¼æä»¬ç§°ä¹ä¸ºéå°¾æåºã\n\nå æ­¤ï¼ç¼å­çå®¹éè§åä¸è½ä¸æ¦èè®ºï¼æ¯éè¦ç»ååºç¨æ°æ®å®éè®¿é®ç¹å¾åææ¬å¼éæ¥ç»¼åèèçï¼è¿éä¹å­å¨ trade-offã\n\nä¸è¬ï¼å»ºè®®æç¼å­å®¹éè®¾ç½®ä¸ºæ»æ°æ®éç15%å°30%ï¼å¼é¡¾è®¿é®æ§è½ååå­ç©ºé´å¼éã\n\nå¯¹äº Redis æ¥è¯´ï¼ä¸æ¦ç¡®å®äºç¼å­æå¤§å®¹éï¼æ¯å¦ 4GBï¼ä½ å°±å¯ä»¥ä½¿ç¨ä¸é¢è¿ä¸ªå½ä»¤æ¥è®¾å®ç¼å­çå¤§å°äºï¼\n\nCONFIG SET maxmemory 4gb\n\n\n1\n\n\nä¸è¿ï¼ç¼å­è¢«åæ»¡æ¯ä¸å¯é¿åçï¼æä»¥éè¦ç¼å­æ¿æ¢ãç¼å­æ¿æ¢éè¦è§£å³ä¸¤ä¸ªé®é¢ï¼å³å®æ·æ±°åªäºæ°æ®ï¼å¦ä½å¤çé£äºè¢«æ·æ±°çæ°æ®ãæ¥ä¸æ¥å°±è®¨è®º Redis ä¸­çæ°æ®æ·æ±°ç­ç¥ã\n\n\n# 2.2 Redis ç¼å­æåªäºæ·æ±°ç­ç¥ï¼\n\nRedis 4.0 ä¹åä¸å±æ 8 ç§åå­æ·æ±°ç­ç¥ï¼æ»ç»å¦ä¸å¾ï¼\n\né»è®¤æåµä¸æ¯ noeviction ç­ç¥ï¼Redis å¨ä½¿ç¨çåå­ç©ºé´è¶è¿ maxmemory å¼æ¶ï¼å¹¶ä¸ä¼æ·æ±°æ°æ®ï¼åæåè¯·æ±çè¯ç´æ¥è¿åéè¯¯ãå æ­¤ä¸æè¿ç§æ¹å¼ç¨å° Redis ç¼å­ä¸­ã\n\næä»¬ååæä¸ volatile-randomãvolatile-ttlãvolatile-lru å volatile-lfu è¿åç§æ·æ±°ç­ç¥ãå®ä»¬ç­éçåéæ°æ®èå´ï¼è¢«éå¶å¨å·²ç»è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ä¸ãä¹æ­£å ä¸ºæ­¤ï¼å³ä½¿ç¼å­æ²¡æåæ»¡ï¼è¿äºæ°æ®å¦æè¿æäºï¼ä¹ä¼è¢«å é¤ãä¾å¦ï¼æä»¬ä½¿ç¨ EXPIRE å½ä»¤å¯¹ä¸æ¹é®å¼å¯¹è®¾ç½®äºè¿ææ¶é´åï¼æ è®ºæ¯è¿äºé®å¼å¯¹çè¿ææ¶é´æ¯å¿«å°äºï¼è¿æ¯ Redis çåå­ä½¿ç¨éè¾¾å°äº maxmemory éå¼ï¼Redis é½ä¼è¿ä¸æ­¥æç§ volatile-ttlãvolatile-randomãvolatile-lruãvolatile-lfu è¿åç§ç­ç¥çå·ä½ç­éè§åè¿è¡æ·æ±°ï¼\n\n * volatile-ttl å¨ç­éæ¶ï¼ä¼éå¯¹è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ï¼æ ¹æ®è¿ææ¶é´çååè¿è¡å é¤ï¼è¶æ©è¿æçè¶åè¢«å é¤ã\n * volatile-random å°±åå®çåç§°ä¸æ ·ï¼å¨è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ä¸­ï¼è¿è¡éæºå é¤ã\n * volatile-lru ä¼ä½¿ç¨ LRU ç®æ³ç­éè®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ã\n * volatile-lfu ä¼ä½¿ç¨ LFU ç®æ³éæ©è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ã\n\nallkeys-lruãallkeys-randomãallkeys-lfuè¿ä¸ç§æ·æ±°ç­ç¥çå¤éæ·æ±°æ°æ®èå´ï¼å°±æ©å¤§å°äºææé®å¼å¯¹ï¼æ è®ºè¿äºé®å¼å¯¹æ¯å¦è®¾ç½®äºè¿ææ¶é´ãå®ä»¬ç­éæ°æ®è¿è¡æ·æ±°çè§åæ¯ï¼\n\n * allkeys-random ç­ç¥ï¼ä»ææé®å¼å¯¹ä¸­éæºéæ©å¹¶å é¤æ°æ®ï¼\n * allkeys-lru ç­ç¥ï¼ä½¿ç¨ LRU ç®æ³å¨æææ°æ®ä¸­è¿è¡ç­éã\n * allkeys-lfu ç­ç¥ï¼ä½¿ç¨ LFU ç®æ³å¨æææ°æ®ä¸­è¿è¡ç­éã\n\nè¿ä¹å°±æ¯è¯´ï¼å¦æä¸ä¸ªé®å¼å¯¹è¢«å é¤ç­ç¥éä¸­äºï¼å³ä½¿å®çè¿ææ¶é´è¿æ²¡å°ï¼ä¹éè¦è¢«å é¤ãå½ç¶ï¼å¦æå®çè¿ææ¶é´å°äºä½æªè¢«ç­ç¥éä¸­ï¼åæ ·ä¹ä¼è¢«å é¤ã\n\n> LRUåLFUé½æ¯åå­ç®¡ççé¡µé¢ç½®æ¢ç®æ³ã\n> \n>  * LRUï¼æè¿æå°ä½¿ç¨(æé¿æ¶é´)æ·æ±°ç®æ³ï¼Least Recently Usedï¼ãLRUæ¯æ·æ±°æé¿æ¶é´æ²¡æè¢«ä½¿ç¨çé¡µé¢ã\n>  * LFUï¼æä¸ç»å¸¸ä½¿ç¨(æå°æ¬¡)æ·æ±°ç®æ³ï¼Least Frequently Usedï¼ãLFUæ¯æ·æ±°ä¸æ®µæ¶é´åï¼ä½¿ç¨æ¬¡æ°æå°çé¡µé¢ã\n\nå³äº LRU ç®æ³ï¼\n\nç­éæä¸å¸¸ç¨æ°æ®çæ¹æ³ï¼æææçæ°æ®ç»ç»æä¸ä¸ªé¾è¡¨ï¼é¾è¡¨çå¤´åå°¾åå«è¡¨ç¤ºMRUç«¯åLRUç«¯ï¼åå«ä»£è¡¨æè¿æå¸¸ä½¿ç¨çæ°æ®åæè¿æä¸å¸¸ç¨çæ°æ®ãå·ä½å¦ä¸å¾ï¼\n\nä½æ¯å¦ä¸æ¹æ³ç±äºä½¿ç¨é¾è¡¨ç®¡çææçç¼å­æ°æ®ï¼ä¼å¸¦æ¥é¢å¤çç©ºé´å¼éï¼ä¸æå¤§éæ°æ®è¢«è®¿é®æ¶ï¼éè¦å¨é¾è¡¨ä¸ç§»å¨å¤§éæ°æ®ï¼å¾èæ¶ï¼éä½ Redis ç¼å­æ§è½ã\n\nRedis ä¸­ï¼LRU ç®æ³è¢«åäºç®åï¼ä»¥åè½»æ°æ®æ·æ±°å¯¹ç¼å­æ§è½çå½±åãå·ä½æ¥è¯´ï¼Redisé»è®¤ä¼è®°å½æ¯ä¸ªæ°æ®çæè¿ä¸æ¬¡è®¿é®çæ¶é´æ³ï¼ç±é®å¼å¯¹æ°æ®ç»æRedisObjectä¸­çlruå­æ®µè®°å½ï¼ãç¶åï¼Rediså¨å³å®æ·æ±°çæ°æ®æ¶ï¼ç¬¬ä¸æ¬¡ä¼éæºéåºNä¸ªæ°æ®ï¼æå®ä»¬ä½ä¸ºä¸ä¸ªåééåãæ¥ä¸æ¥ï¼Redisä¼æ¯è¾è¿Nä¸ªæ°æ®çlruå­æ®µï¼ælruå­æ®µå¼æå°çæ°æ®ä»ç¼å­ä¸­æ·æ±°åºå»ã\n\nRedisæä¾äºä¸ä¸ªéç½®åæ°maxmemory-samplesï¼è¿ä¸ªåæ°å°±æ¯Rediséåºçæ°æ®ä¸ªæ°Nãä¾å¦ï¼æä»¬æ§è¡å¦ä¸å½ä»¤ï¼å¯ä»¥è®©Rediséåº100ä¸ªæ°æ®ä½ä¸ºåéæ°æ®éï¼\n\nCONFIG SET maxmemory-samples 100\n\n\n1\n\n\nå½éè¦åæ¬¡æ·æ±°æ°æ®æ¶ï¼Rediséè¦æéæ°æ®è¿å¥ç¬¬ä¸æ¬¡æ·æ±°æ¶åå»ºçåééåãè¿å¿çæéæ åæ¯ï¼ è½è¿å¥åééåçæ°æ®çlruå­æ®µå¼å¿é¡»å°äºåééåä¸­æå°çlruå¼ãå½ææ°æ°æ®è¿å¥åéæ°æ®éåï¼å¦æåéæ°æ®éä¸­çæ°æ®ä¸ªæ°è¾¾å°äºmaxmemory-samplesï¼Rediså°±æåéæ°æ®éä¸­lruå­æ®µå¼æå°çæ°æ®æ·æ±°åºå»ã\n\nè¿æ ·ä¸æ¥ï¼Redisç¼å­ä¸ç¨ä¸ºææçæ°æ®ç»´æ¤ä¸ä¸ªå¤§é¾è¡¨ï¼ä¹ä¸ç¨å¨æ¯æ¬¡æ°æ®è®¿é®æ¶é½ç§»å¨é¾è¡¨é¡¹ï¼æåäºç¼å­çæ§è½ã\n\nå³äºç¼å­æ·æ±°ç­ç¥çéåï¼æå¦ä¸å»ºè®®ï¼\n\n * ä¼åä½¿ç¨ allkeys-lru ç­ç¥ãè¿æ ·å¯ä»¥ååå©ç¨ LRU è¿ä¸ç»å¸ç¼å­ç®æ³çä¼å¿ï¼ææè¿æå¸¸è®¿é®çæ°æ®çå¨ç¼å­ä¸­ï¼æååºç¨çè®¿é®æ§è½ãå¦æä½ çä¸å¡æ°æ®ä¸­æææ¾çå·ç­æ°æ®åºåï¼æå»ºè®®ä½ ä½¿ç¨ allkeys-lru ç­ç¥ã\n * å¦æä¸å¡åºç¨ä¸­çæ°æ®è®¿é®é¢çç¸å·®ä¸å¤§ï¼æ²¡æææ¾çå·ç­æ°æ®åºåï¼å»ºè®®ä½¿ç¨allkeys-randomç­ç¥ï¼éæºéæ©æ·æ±°çæ°æ®å°±è¡ã\n * å¦æä½ çä¸å¡ä¸­æç½®é¡¶çéæ±ï¼æ¯å¦ç½®é¡¶æ°é»ãç½®é¡¶è§é¢ï¼é£ä¹ï¼å¯ä»¥ä½¿ç¨ volatile-lru ç­ç¥ï¼åæ¶ä¸ç»è¿äºç½®é¡¶æ°æ®è®¾ç½®è¿ææ¶é´ãè¿æ ·ä¸æ¥ï¼è¿äºéè¦ç½®é¡¶çæ°æ®ä¸ç´ä¸ä¼è¢«å é¤ï¼èå¶ä»æ°æ®ä¼å¨è¿ææ¶æ ¹æ® LRU è§åè¿è¡ç­éã\n\nä¸æ¦è¢«æ·æ±°çæ°æ®è¢«éå®åï¼Redis æä¹å¤çè¿äºæ°æ®å¢ï¼è¿å°±è¦è¯´å°ç¼å­æ¿æ¢æ¶çå·ä½æä½äºã\n\n\n# 2.3 å¦ä½å¤çè¢«æ·æ±°çæ°æ®ï¼\n\nä¸è¬æ¥è¯´ï¼ä¸æ¦è¢«æ·æ±°çæ°æ®éå®åï¼å¦æè¿ä¸ªæ°æ®æ¯å¹²åæ°æ®ï¼é£ä¹æä»¬å°±ç´æ¥å é¤ï¼å¦æè¿ä¸ªæ°æ®æ¯èæ°æ®ï¼æä»¬éè¦æå®ååæ°æ®åºï¼å¦ä¸å¾æç¤ºï¼\n\n * å¹²åæ°æ®ï¼ååºæ¥åå°±æ²¡æ¹è¿\n * èæ°æ®ï¼ååç«¯æ°æ®åºä¸ä¸è´äº\n\nä¸è¿ï¼å¯¹äºRedisæ¥è¯´ï¼å®å³å®äºè¢«æ·æ±°çæ°æ®åï¼ä¼æå®ä»¬å é¤ãå³ä½¿æ·æ±°çæ°æ®æ¯èæ°æ®ï¼Redis ä¹ä¸ä¼æå®ä»¬ååæ°æ®åºãæä»¥ï¼æä»¬å¨ä½¿ç¨ Redis ç¼å­æ¶ï¼å¦ææ°æ®è¢«ä¿®æ¹äºï¼éè¦å¨æ°æ®ä¿®æ¹æ¶å°±å°å®ååæ°æ®åºãå¦åï¼è¿ä¸ªèæ°æ®è¢«æ·æ±°æ¶ï¼ä¼è¢« Redis å é¤ï¼èæ°æ®åºéä¹æ²¡æææ°çæ°æ®äºã",normalizedContent:"> åèï¼\n> \n>  * 23 æè·¯ç¼å­ï¼redis æ¯å¦ä½å·¥ä½çï¼| æå®¢æ¶é´\n>  * 24 æ¿æ¢ç­ç¥ï¼ç¼å­æ»¡äºæä¹åï¼| æå®¢æ¶é´\n\nç±äº redis æä¾äºé«æ§è½çæ°æ®å­ååè½ï¼å æ­¤è¢«å¹¿æ³åºç¨å°ç¼å­çåºæ¯ä¸­ï¼è¿å¯ä»¥æææåä¸å¡çååºéåº¦ï¼åæ¶é¿åæååç´¯ç§¯å°æ°æ®åºå±é¢ã\n\nææ¡ç¼å­éè¦è§£å³åä¸ªå³é®é®é¢ï¼\n\n * redis ç¼å­å·ä½æ¯æä¹å·¥ä½çï¼(å·¥ä½åç)\n * redis ç¼å­å¦ææ»¡äºï¼è¯¥æä¹åï¼(æ¿æ¢ç­ç¥)\n * ä¸ºä»ä¹ä¼æç¼å­ä¸è´æ§ãç¼å­ç©¿éãç¼å­éªå´©ãç¼å­å»ç©¿ç­å¼å¸¸ï¼è¯¥å¦ä½åºå¯¹ï¼(å¼å¸¸å¤çæºå¶)\n * redis çåå­æ¯ç«æéï¼å¦æç¨å¿«éçåºæç¡¬çæ¥ä¿å­æ°æ®ï¼å¯ä»¥å¢å ç¼å­çæ°æ®éï¼é£ redis ç¼å­å¯ä»¥ä½¿ç¨å¿«éåºæç¡¬çåï¼(æ©å±æºå¶)\n\nä¸é¢åå«ä»ç»ã\n\n\n# 1. æè·¯ç¼å­ï¼redis æ¯å¦ä½å·¥ä½çï¼\n\nè¿ä¸å¤§èä¸»è¦äºè§£ä¸ç¼å­çç¹å¾årediséç¨äºç¼å­çå¤©ç¶ä¼å¿ï¼ä»¥åredisç¼å­çå·ä½å·¥ä½æºå¶ã\n\n\n# 1.1 ç¼å­çç¹å¾\n\nè®¡ç®æºç³»ç»ä¸­ï¼é»è®¤æä¸¤ç§ç¼å­ï¼\n\n * cpuéé¢çæ«çº§ç¼å­ï¼å³llcï¼ç¨æ¥ç¼å­åå­ä¸­çæ°æ®ï¼é¿åæ¯æ¬¡ä»åå­ä¸­å­åæ°æ®ï¼\n * åå­ä¸­çé«éé¡µç¼å­ï¼å³page cacheï¼ç¨æ¥ç¼å­ç£çä¸­çæ°æ®ï¼é¿åæ¯æ¬¡ä»ç£çä¸­å­åæ°æ®ã\n\nå·ä½å¦ä¸å¾æç¤ºï¼\n\nllcçå¤§å°æ¯mbçº§å«ï¼page cacheçå¤§å°æ¯gbçº§å«ï¼èç£ççå¤§å°æ¯tbçº§å«ã\n\nç¼å­çç¬¬ä¸ä¸ªç¹å¾ï¼å¨ä¸ä¸ªå±æ¬¡åçç³»ç»ä¸­ï¼ç¼å­ä¸å®æ¯ä¸ä¸ªå¿«éå­ç³»ç»ï¼æ°æ®å­å¨ç¼å­ä¸­æ¶ï¼è½é¿åæ¯æ¬¡ä»æ¢éå­ç³»ç»ä¸­å­åæ°æ®ãå¯¹åºå°äºèç½åºç¨æ¥è¯´ï¼redis å°±æ¯å¿«éå­ç³»ç»ï¼èæ°æ®åºå°±æ¯æ¢éå­ç³»ç»äºã\n\nç¼å­çç¬¬äºä¸ªç¹å¾ï¼ç¼å­ç³»ç»çå®¹éå¤§å°æ»æ¯å°äºåç«¯æ¢éç³»ç»çï¼æä»¬ä¸å¯è½ææææ°æ®é½æ¾å¨ç¼å­ç³»ç»ä¸­ãå æ­¤ç¼å­åæ¢éç³»ç»ä¹é´å¿ç¶å­å¨æ°æ®ååååè¯»åçäº¤äºè¿ç¨ãè¿ä½ å¯è½ä¼æ³å° redis æ¬èº«æ¯æ¯ææä¸å®è§åæ·æ±°æ°æ®çï¼ç¸å½äºå®ç°äºç¼å­çæ°æ®æ·æ±°ï¼å¶å®ï¼è¿ä¹æ¯ redis éåç¨ä½ç¼å­çä¸ä¸ªéè¦åå ã\n\n\n# 1.2 redis ç¼å­å¤çè¯·æ±çä¸¤ç§æåµ\n\næ redis ç¨ä½ç¼å­æ¶ï¼æä»¬ä¼æ redis é¨ç½²å¨æ°æ®åºçåç«¯ï¼ä¸å¡åºç¨å¨è®¿é®æ°æ®æ¶ï¼ä¼åæ¥è¯¢ redis ä¸­æ¯å¦ä¿å­äºç¸åºçæ°æ®ãæ­¤æ¶ï¼æ ¹æ®æ°æ®æ¯å¦å­å¨ç¼å­ä¸­ï¼ä¼æä¸¤ç§æåµï¼\n\n * ç¼å­å½ä¸­\n * ç¼å­ç¼ºå¤±ï¼è¿æ¶éè¦è¿è¡ç¼å­æ´æ°ï¼è¿æ¶åå°æ°æ®ä¸è´æ§çé®é¢ï¼ä¼å¨åæè®²è¿°ï¼\n\nç±æ­¤ï¼ä½¿ç¨ redis ä½ä¸ºç¼å­ä¸»è¦æä¸ä¸ªæä½ï¼\n\n * åºç¨è¯»åæ°æ®æ¶ï¼éè¦åè¯»å redisï¼\n * åçç¼å­ç¼ºå¤±æ¶ï¼éè¦ä»æ°æ®åºè¯»åæ°æ®ï¼\n * åçç¼å­ç¼ºå¤±æ¶ï¼è¿éè¦æ´æ°ç¼å­ã\n\né£ä¹ï¼è¿äºæä½å·ä½æ¯ç±è°æ¥åçå¢ï¼è¿åredisç¼å­çä½¿ç¨æ¹å¼ç¸å³ãæ¥ä¸æ¥å°±åä½ èè redis ä½ä¸ºæè·¯ç¼å­çä½¿ç¨æä½æ¹å¼ã\n\n\n# 1.3 redis ä½ä¸ºæè·¯ç¼å­çä½¿ç¨æä½\n\nredisæ¯ä¸ä¸ªç¬ç«çç³»ç»è½¯ä»¶ï¼åä¸å¡åºç¨ç¨åºæ¯ä¸¤ä¸ªè½¯ä»¶ï¼å½æä»¬é¨ç½²äºrediså®ä¾åï¼å®åªä¼è¢«å¨å°ç­å¾å®¢æ·ç«¯åéè¯·æ±ï¼ç¶ååè¿è¡å¤çãæä»¥ï¼ å¦æåºç¨ç¨åºæ³è¦ä½¿ç¨ redis ç¼å­ï¼æä»¬å°±è¦å¨ç¨åºä¸­å¢å ç¸åºçç¼å­æä½ä»£ç ï¼æä»¥ä¹æ redis ç§°ä¸ºæè·¯ç¼å­ï¼ä¹å°±æ¯è¯´ï¼è¯»åç¼å­ãè¯»åæ°æ®åºåæ´æ°ç¼å­çæä½é½éè¦å¨åºç¨ç¨åºä¸­æ¥å®æã\n\n> è¿ç§æè·¯ç¼å­ä¸è®¡ç®æºç³»ç»ä¸­çç¼å­ä¸å¤ªä¸æ ·ï¼æ¯å¦è®¡ç®æºç³»ç»ä¸­ç page cache å¹¶ä¸éè¦ä½ å»æ¾ç¤ºè°ç¨å®ç get æ¥å£ç­ï¼èæ¯è®¡ç®æºç´æ¥å°è¿äºç¼å­æ¾å¨äºç¨åºçæ°æ®è®¿é®è·¯å¾ä¸å¹¶ç´æ¥ä½¿ç¨ã\n\nå¨ä½¿ç¨ redis ä½ä¸ºç¼å­æ¶ï¼æä»¬éè¦å¨åºç¨ç¨åºä¸­å¢å ä¸æ¹é¢çä»£ç ï¼\n\n * å½åºç¨ç¨åºéè¦è¯»åæ°æ®æ¶ï¼æä»¬éè¦å¨ä»£ç ä¸­æ¾å¼è°ç¨ redis ç get æä½æ¥å£ï¼è¿è¡æ¥è¯¢ï¼\n * å¦æç¼å­ç¼ºå¤±äºï¼åºç¨ç¨åºéè¦ååæ°æ®åºè¿æ¥ï¼ä»æ°æ®åºä¸­è¯»åæ°æ®ï¼\n * å½ç¼å­ä¸­çæ°æ®éè¦æ´æ°æ¶ï¼æä»¬ä¹éè¦å¨åºç¨ç¨åºä¸­æ¾å¼å°è°ç¨ set æä½æ¥å£ï¼ææ´æ°çæ°æ®åå¥ç¼å­ã\n\nä¸é¢æ¯ä¸æ®µå¨ web åºç¨ä¸­ä½¿ç¨ redis ç¼å­çä¼ªä»£ç ç¤ºä¾ï¼\n\nstring cachekey = âproductid_11010003â;\nstring cachevalue = rediscache.get(cachekey)ï¼\n//ç¼å­å½ä¸­\nif (cachevalue != null)\n   return cachevalue;\n//ç¼å­ç¼ºå¤±\nelse\n   cachevalue = getproductfromdb();\n   rediscache.put(cachevalue)  //ç¼å­æ´æ°\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯ä»¥çå°ï¼ä¸ºäºä½¿ç¨ç¼å­ï¼web åºç¨ç¨åºéè¦æä¸ä¸ªè¡¨ç¤ºç¼å­ç³»ç»çå®ä¾å¯¹è±¡ rediscacheï¼è¿éè¦ä¸»å¨è°ç¨ get æ¥å£ï¼å¹¶ä¸è¦å¤çç¼å­å½ä¸­åç¼å­ç¼ºå¤±æ¶çé»è¾ï¼ä¾å¦å¨ç¼å­ç¼ºå¤±æ¶ï¼éè¦æ´æ°ç¼å­ã\n\nrediså¹¶ä¸éç¨äºé£äºæ æ³è·å¾æºç çåºç¨ï¼å ä¸ºéè¦æ°å¢ç¨åºä»£ç æ¥ä½¿ç¨ç¼å­ãä¾å¦ä¸äºå¾æ©ä¹åå¼åçåºç¨ç¨åºï¼å®ä»¬çæºç å·²ç»æ²¡æåç»´æ¤äºï¼æèæ¯ç¬¬ä¸æ¹ä¾åºåå¼åçåºç¨ï¼æ²¡ææä¾æºç ï¼æä»¥ï¼å°±ä¸è½ä½¿ç¨redisåç¼å­äºã\n\nå¨ä½¿ç¨æè·¯ç¼å­æ¶ï¼æä»¬éè¦å¨åºç¨ç¨åºä¸­å¢å æä½ä»£ç ï¼å¢å äºä½¿ç¨redisç¼å­çé¢å¤å·¥ä½éï¼ä½æ¯ï¼ä¹æ­£å ä¸ºredisæ¯æè·¯ç¼å­ï¼æ¯ä¸ä¸ªç¬ç«çç³»ç»ï¼æä»¬å¯ä»¥åç¬å¯¹redisç¼å­è¿è¡æ©å®¹ææ§è½ä¼åãèä¸ï¼åªè¦ä¿ææä½æ¥å£ä¸åï¼æä»¬å¨åºç¨ç¨åºä¸­å¢å çä»£ç å°±ä¸ç¨åä¿®æ¹äºã\n\nåºç¨ç¨åºé¤äºè¯»åæ°æ®å¤ï¼è¿å¯è½å¯¹æ°æ®è¿è¡ä¿®æ¹ãè¿æ¶æä»¬æ¢å¯ä»¥å¨ç¼å­ä¸­ä¿®æ¹ï¼ä¹å¯ä»¥å¨åç«¯æ°æ®åºä¸­è¿è¡ä¿®æ¹ï¼æä»¬è¯¥æä¹éæ©å¢ï¼\n\nå¶å®ï¼è¿å°±æ¶åå°äºredisç¼å­çä¸¤ç§ç±»åï¼\n\n * åªè¯»ç¼å­è½å éè¯»è¯·æ±\n * è¯»åç¼å­å¯ä»¥åæ¶å éè¯»åè¯·æ±ã\n\nèä¸ï¼è¯»åç¼å­åæä¸¤ç§æ°æ®ååç­ç¥ï¼å¯ä»¥è®©æä»¬æ ¹æ®ä¸å¡éæ±ï¼å¨ä¿è¯æ§è½åä¿è¯æ°æ®å¯é æ§ä¹é´è¿è¡éæ©ãæä»¥ï¼æ¥ä¸æ¥ï¼æä»¬æ¥å·ä½äºè§£ä¸ redis çç¼å­ç±»ååç¸åºçååç­ç¥ã\n\n\n# 1.4 ç¼å­çç±»å\n\næç§æ¯å¦æ¥ååè¯·æ±ï¼å¯ä»¥åæåªè¯»ç¼å­åè¯»åç¼å­ã\n\n# 1.4.1 åªè¯»ç¼å­\n\nå½redisç¨ä½åªè¯»ç¼å­æ¶ï¼åºç¨è¦è¯»åæ°æ®çè¯ï¼ä¼åè°ç¨ redis get æ¥å£ï¼æ¥è¯¢æ°æ®æ¯å¦å­å¨ãèææçæ°æ®åè¯·æ±ï¼ä¼ç´æ¥åå¾åç«¯çæ°æ®åºï¼å¨æ°æ®åºä¸­å¢å æ¹ãå¯¹äºå æ¹çæ°æ®æ¥è¯´ï¼å¦æ redis å·²ç»ç¼å­äºç¸åºçæ°æ®ï¼åºç¨éè¦æè¿äºç¼å­çæ°æ®å é¤ï¼redis ä¸­å°±æ²¡æè¿äºæ°æ®äºã\n\nå½åºç¨åæ¬¡è¯»åè¿äºæ°æ®æ¶ï¼ä¼åçç¼å­ç¼ºå¤±ï¼åºç¨ä¼æè¿äºæ°æ®ä»æ°æ®åºä¸­è¯»åºæ¥ï¼å¹¶åå°ç¼å­ä¸­ãè¿æ ·ä¸æ¥ï¼è¿äºæ°æ®åç»­åè¢«è¯»åæ¶ï¼å°±å¯ä»¥ç´æ¥ä»ç¼å­ä¸­è·åäºï¼è½èµ·å°å éè®¿é®çææã\n\nä¸å¾å±ç¤ºäºåºç¨ä¿®æ¹æ°æ® a ååæ¬¡è®¿é® a çè¿ç¨ï¼\n\nåªè¯»ç¼å­ç´æ¥å¨æ°æ®åºä¸­æ´æ°æ°æ®çå¥½å¤æ¯ï¼ææææ°çæ°æ®é½å¨æ°æ®åºä¸­ï¼è¿äºæ°æ®ä¸ä¼æä¸¢å¤±çé£é©ãå½æä»¬éè¦ç¼å­å¾çãç­è§é¢è¿äºç¨æ·åªè¯»çæ°æ®æ¶ï¼å°±å¯ä»¥ä½¿ç¨åªè¯»ç¼å­è¿ä¸ªç±»åäºã\n\n# 1.4.2 è¯»åç¼å­\n\nå¯¹äºè¯»åç¼å­æ¥è¯´ï¼é¤äºè¯»è¯·æ±ä¼åéå°ç¼å­è¿è¡å¤çï¼ææçåè¯·æ±ä¹ä¼åéå°ç¼å­ï¼å¨ç¼å­ä¸­ç´æ¥å¯¹æ°æ®è¿è¡å¢å æ¹æä½ãå¾çäº redis çé«æ§è½è®¿é®ç¹æ§ï¼æ°æ®çå¢å æ¹æä½å¯ä»¥å¨ç¼å­ä¸­å¿«éå®æï¼å¤çç»æä¹ä¼å¿«éè¿åç»ä¸å¡åºç¨ï¼è¿å°±å¯ä»¥æåä¸å¡åºç¨çååºéåº¦ã\n\nä½æ¯ï¼ååªè¯»ç¼å­ä¸ä¸æ ·çæ¯ï¼å¨ä½¿ç¨è¯»åç¼å­æ¶ï¼ææ°çæ°æ®æ¯å¨redisä¸­ï¼èredisæ¯åå­æ°æ®åºï¼ä¸æ¦åºç°æçµæå®æºï¼åå­ä¸­çæ°æ®å°±ä¼ä¸¢å¤±ãè¿ä¹å°±æ¯è¯´ï¼åºç¨çææ°æ°æ®å¯è½ä¼ä¸¢å¤±ï¼ç»åºç¨ä¸å¡å¸¦æ¥é£é©ã\n\næ ¹æ®ä¸å¡åºç¨å¯¹æ°æ®å¯é æ§åç¼å­æ§è½çä¸åè¦æ±ï¼æåæ­¥ç´ååå¼æ­¥ååä¸¤ç§ç­ç¥ï¼å¦ä¸å¾æç¤ºï¼\n\n * åæ­¥ç´åç­ç¥ä¼åä¿è¯æ°æ®å¯é æ§ï¼ä¼éä½è®¿é®æ§è½\n * å¼æ­¥ååç­ç¥ä¼åæä¾å¿«éååºï¼ææ°æ®ä¸¢å¤±é£é©\n\nå³äºæ¯éæ©åªè¯»ç¼å­ï¼è¿æ¯è¯»åç¼å­ï¼ä¸»è¦çæä»¬å¯¹åè¯·æ±æ¯å¦æå éçéæ±ï¼\n\n * å¦æéè¦å¯¹åè¯·æ±è¿è¡å éï¼æä»¬éæ©è¯»åç¼å­ï¼\n * å¦æåè¯·æ±å¾å°ï¼æèæ¯åªéè¦æåè¯»è¯·æ±çååºéåº¦çè¯ï¼æä»¬éæ©åªè¯»ç¼å­ã\n\n> ä¸¾ä¸ªä¾å­ï¼å¨ååå¤§ä¿çåºæ¯ä¸­ï¼ååçåºå­ä¿¡æ¯ä¼ä¸ç´è¢«ä¿®æ¹ãå¦ææ¯æ¬¡ä¿®æ¹é½éå°æ°æ®åºä¸­å¤çï¼å°±ä¼ææ¢æ´ä¸ªåºç¨ï¼æ­¤æ¶ï¼æä»¬éå¸¸ä¼éæ©è¯»åç¼å­çæ¨¡å¼ãèå¨ç­è§é¢appçåºæ¯ä¸­ï¼è½ç¶è§é¢çå±æ§æå¾å¤ï¼ä½æ¯ï¼ä¸è¬ç¡®å®åï¼ä¿®æ¹å¹¶ä¸é¢ç¹ï¼æ­¤æ¶ï¼å¨æ°æ®åºä¸­è¿è¡ä¿®æ¹å¯¹ç¼å­å½±åä¸å¤§ï¼æä»¥åªè¯»ç¼å­æ¨¡å¼æ¯ä¸ä¸ªåéçéæ©ã\n\n\n# 2. æ¿æ¢ç­ç¥ï¼ç¼å­æ»¡äºæä¹åï¼\n\nç¼å­ç©ºé´æéï¼è¿å°±æ¶åå°äºç¼å­ç³»ç»çä¸ä¸ªéè¦æºå¶ï¼ç¼å­æ¿æ¢æºå¶ãç®åæ¥è¯´ï¼æ°æ®æ·æ±°æºå¶åæ¬ä¸¤æ­¥ï¼\n\n 1. æ ¹æ®ä¸å®çç­ç¥ï¼ç­éåºå¯¹åºç¨è®¿é®æ¥è¯´âä¸éè¦âçæ°æ®ï¼\n 2. å°è¿äºæ°æ®ä»ç¼å­ä¸­å é¤ï¼ä¸ºæ°æ¥çæ°æ®è¾åºç©ºé´\n\nè¿ä¸èå°ä¸»è¦æ¢è®¨ç¼å­æ¿æ¢ç­ç¥ã\n\n\n# 2.1 è®¾ç½®å¤å¤§çç¼å­å®¹éåéï¼\n\nç¼å­å®¹éçè®¾ç½®ä¼ç´æ¥å½±åå°ç¼å­çæ§ä»·æ¯ã\n\nç±äºå±é¨æ§åçï¼å¾å¾ä¸é¨åæ°æ®å°±æ¯æäºå·¨å¤§çè®¿é®éãå¦ä¸å¾ï¼\n\n * èçº¿è¡¨ç¤ºâäºå«åçâï¼å³20%çæ°æ®è´¡ç®äº80%çè®¿é®ï¼èå©ä½çæ°æ®è½ç¶ä½éå¾å¤§ï¼ä½åªè´¡ç®äº20%çè®¿é®éãè¿80%çæ°æ®å¨è®¿é®éä¸å°±å½¢æäºä¸æ¡é¿é¿çå°¾å·´ï¼æä»¬ä¹ç§°ä¸ºé¿å°¾æåºã\n * ä½å®éä¸­éçç¨æ·çä¸ªæ§åéæ±è¶æ¥è¶å¤ï¼ä¸åç¨æ·è®¿é®çåå®¹å¯è½å·®å«å¾å¤§ï¼å¯¼è´å¯è½ä¸åå·å¤äºå«åçåå¸ç¹å¾äºï¼ä¹å°±æ¯è¯´ï¼20%çæ°æ®å¯è½è´¡ç®ä¸äº80%çè®¿é®ï¼èå©ä½ç80%æ°æ®åèè´¡ç®äºæ´å¤çè®¿é®éï¼æä»¬ç§°ä¹ä¸ºéå°¾æåºã\n\nå æ­¤ï¼ç¼å­çå®¹éè§åä¸è½ä¸æ¦èè®ºï¼æ¯éè¦ç»ååºç¨æ°æ®å®éè®¿é®ç¹å¾åææ¬å¼éæ¥ç»¼åèèçï¼è¿éä¹å­å¨ trade-offã\n\nä¸è¬ï¼å»ºè®®æç¼å­å®¹éè®¾ç½®ä¸ºæ»æ°æ®éç15%å°30%ï¼å¼é¡¾è®¿é®æ§è½ååå­ç©ºé´å¼éã\n\nå¯¹äº redis æ¥è¯´ï¼ä¸æ¦ç¡®å®äºç¼å­æå¤§å®¹éï¼æ¯å¦ 4gbï¼ä½ å°±å¯ä»¥ä½¿ç¨ä¸é¢è¿ä¸ªå½ä»¤æ¥è®¾å®ç¼å­çå¤§å°äºï¼\n\nconfig set maxmemory 4gb\n\n\n1\n\n\nä¸è¿ï¼ç¼å­è¢«åæ»¡æ¯ä¸å¯é¿åçï¼æä»¥éè¦ç¼å­æ¿æ¢ãç¼å­æ¿æ¢éè¦è§£å³ä¸¤ä¸ªé®é¢ï¼å³å®æ·æ±°åªäºæ°æ®ï¼å¦ä½å¤çé£äºè¢«æ·æ±°çæ°æ®ãæ¥ä¸æ¥å°±è®¨è®º redis ä¸­çæ°æ®æ·æ±°ç­ç¥ã\n\n\n# 2.2 redis ç¼å­æåªäºæ·æ±°ç­ç¥ï¼\n\nredis 4.0 ä¹åä¸å±æ 8 ç§åå­æ·æ±°ç­ç¥ï¼æ»ç»å¦ä¸å¾ï¼\n\né»è®¤æåµä¸æ¯ noeviction ç­ç¥ï¼redis å¨ä½¿ç¨çåå­ç©ºé´è¶è¿ maxmemory å¼æ¶ï¼å¹¶ä¸ä¼æ·æ±°æ°æ®ï¼åæåè¯·æ±çè¯ç´æ¥è¿åéè¯¯ãå æ­¤ä¸æè¿ç§æ¹å¼ç¨å° redis ç¼å­ä¸­ã\n\næä»¬ååæä¸ volatile-randomãvolatile-ttlãvolatile-lru å volatile-lfu è¿åç§æ·æ±°ç­ç¥ãå®ä»¬ç­éçåéæ°æ®èå´ï¼è¢«éå¶å¨å·²ç»è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ä¸ãä¹æ­£å ä¸ºæ­¤ï¼å³ä½¿ç¼å­æ²¡æåæ»¡ï¼è¿äºæ°æ®å¦æè¿æäºï¼ä¹ä¼è¢«å é¤ãä¾å¦ï¼æä»¬ä½¿ç¨ expire å½ä»¤å¯¹ä¸æ¹é®å¼å¯¹è®¾ç½®äºè¿ææ¶é´åï¼æ è®ºæ¯è¿äºé®å¼å¯¹çè¿ææ¶é´æ¯å¿«å°äºï¼è¿æ¯ redis çåå­ä½¿ç¨éè¾¾å°äº maxmemory éå¼ï¼redis é½ä¼è¿ä¸æ­¥æç§ volatile-ttlãvolatile-randomãvolatile-lruãvolatile-lfu è¿åç§ç­ç¥çå·ä½ç­éè§åè¿è¡æ·æ±°ï¼\n\n * volatile-ttl å¨ç­éæ¶ï¼ä¼éå¯¹è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ï¼æ ¹æ®è¿ææ¶é´çååè¿è¡å é¤ï¼è¶æ©è¿æçè¶åè¢«å é¤ã\n * volatile-random å°±åå®çåç§°ä¸æ ·ï¼å¨è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ä¸­ï¼è¿è¡éæºå é¤ã\n * volatile-lru ä¼ä½¿ç¨ lru ç®æ³ç­éè®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ã\n * volatile-lfu ä¼ä½¿ç¨ lfu ç®æ³éæ©è®¾ç½®äºè¿ææ¶é´çé®å¼å¯¹ã\n\nallkeys-lruãallkeys-randomãallkeys-lfuè¿ä¸ç§æ·æ±°ç­ç¥çå¤éæ·æ±°æ°æ®èå´ï¼å°±æ©å¤§å°äºææé®å¼å¯¹ï¼æ è®ºè¿äºé®å¼å¯¹æ¯å¦è®¾ç½®äºè¿ææ¶é´ãå®ä»¬ç­éæ°æ®è¿è¡æ·æ±°çè§åæ¯ï¼\n\n * allkeys-random ç­ç¥ï¼ä»ææé®å¼å¯¹ä¸­éæºéæ©å¹¶å é¤æ°æ®ï¼\n * allkeys-lru ç­ç¥ï¼ä½¿ç¨ lru ç®æ³å¨æææ°æ®ä¸­è¿è¡ç­éã\n * allkeys-lfu ç­ç¥ï¼ä½¿ç¨ lfu ç®æ³å¨æææ°æ®ä¸­è¿è¡ç­éã\n\nè¿ä¹å°±æ¯è¯´ï¼å¦æä¸ä¸ªé®å¼å¯¹è¢«å é¤ç­ç¥éä¸­äºï¼å³ä½¿å®çè¿ææ¶é´è¿æ²¡å°ï¼ä¹éè¦è¢«å é¤ãå½ç¶ï¼å¦æå®çè¿ææ¶é´å°äºä½æªè¢«ç­ç¥éä¸­ï¼åæ ·ä¹ä¼è¢«å é¤ã\n\n> lruålfué½æ¯åå­ç®¡ççé¡µé¢ç½®æ¢ç®æ³ã\n> \n>  * lruï¼æè¿æå°ä½¿ç¨(æé¿æ¶é´)æ·æ±°ç®æ³ï¼least recently usedï¼ãlruæ¯æ·æ±°æé¿æ¶é´æ²¡æè¢«ä½¿ç¨çé¡µé¢ã\n>  * lfuï¼æä¸ç»å¸¸ä½¿ç¨(æå°æ¬¡)æ·æ±°ç®æ³ï¼least frequently usedï¼ãlfuæ¯æ·æ±°ä¸æ®µæ¶é´åï¼ä½¿ç¨æ¬¡æ°æå°çé¡µé¢ã\n\nå³äº lru ç®æ³ï¼\n\nç­éæä¸å¸¸ç¨æ°æ®çæ¹æ³ï¼æææçæ°æ®ç»ç»æä¸ä¸ªé¾è¡¨ï¼é¾è¡¨çå¤´åå°¾åå«è¡¨ç¤ºmruç«¯ålruç«¯ï¼åå«ä»£è¡¨æè¿æå¸¸ä½¿ç¨çæ°æ®åæè¿æä¸å¸¸ç¨çæ°æ®ãå·ä½å¦ä¸å¾ï¼\n\nä½æ¯å¦ä¸æ¹æ³ç±äºä½¿ç¨é¾è¡¨ç®¡çææçç¼å­æ°æ®ï¼ä¼å¸¦æ¥é¢å¤çç©ºé´å¼éï¼ä¸æå¤§éæ°æ®è¢«è®¿é®æ¶ï¼éè¦å¨é¾è¡¨ä¸ç§»å¨å¤§éæ°æ®ï¼å¾èæ¶ï¼éä½ redis ç¼å­æ§è½ã\n\nredis ä¸­ï¼lru ç®æ³è¢«åäºç®åï¼ä»¥åè½»æ°æ®æ·æ±°å¯¹ç¼å­æ§è½çå½±åãå·ä½æ¥è¯´ï¼redisé»è®¤ä¼è®°å½æ¯ä¸ªæ°æ®çæè¿ä¸æ¬¡è®¿é®çæ¶é´æ³ï¼ç±é®å¼å¯¹æ°æ®ç»æredisobjectä¸­çlruå­æ®µè®°å½ï¼ãç¶åï¼rediså¨å³å®æ·æ±°çæ°æ®æ¶ï¼ç¬¬ä¸æ¬¡ä¼éæºéåºnä¸ªæ°æ®ï¼æå®ä»¬ä½ä¸ºä¸ä¸ªåééåãæ¥ä¸æ¥ï¼redisä¼æ¯è¾è¿nä¸ªæ°æ®çlruå­æ®µï¼ælruå­æ®µå¼æå°çæ°æ®ä»ç¼å­ä¸­æ·æ±°åºå»ã\n\nredisæä¾äºä¸ä¸ªéç½®åæ°maxmemory-samplesï¼è¿ä¸ªåæ°å°±æ¯rediséåºçæ°æ®ä¸ªæ°nãä¾å¦ï¼æä»¬æ§è¡å¦ä¸å½ä»¤ï¼å¯ä»¥è®©rediséåº100ä¸ªæ°æ®ä½ä¸ºåéæ°æ®éï¼\n\nconfig set maxmemory-samples 100\n\n\n1\n\n\nå½éè¦åæ¬¡æ·æ±°æ°æ®æ¶ï¼rediséè¦æéæ°æ®è¿å¥ç¬¬ä¸æ¬¡æ·æ±°æ¶åå»ºçåééåãè¿å¿çæéæ åæ¯ï¼ è½è¿å¥åééåçæ°æ®çlruå­æ®µå¼å¿é¡»å°äºåééåä¸­æå°çlruå¼ãå½ææ°æ°æ®è¿å¥åéæ°æ®éåï¼å¦æåéæ°æ®éä¸­çæ°æ®ä¸ªæ°è¾¾å°äºmaxmemory-samplesï¼rediså°±æåéæ°æ®éä¸­lruå­æ®µå¼æå°çæ°æ®æ·æ±°åºå»ã\n\nè¿æ ·ä¸æ¥ï¼redisç¼å­ä¸ç¨ä¸ºææçæ°æ®ç»´æ¤ä¸ä¸ªå¤§é¾è¡¨ï¼ä¹ä¸ç¨å¨æ¯æ¬¡æ°æ®è®¿é®æ¶é½ç§»å¨é¾è¡¨é¡¹ï¼æåäºç¼å­çæ§è½ã\n\nå³äºç¼å­æ·æ±°ç­ç¥çéåï¼æå¦ä¸å»ºè®®ï¼\n\n * ä¼åä½¿ç¨ allkeys-lru ç­ç¥ãè¿æ ·å¯ä»¥ååå©ç¨ lru è¿ä¸ç»å¸ç¼å­ç®æ³çä¼å¿ï¼ææè¿æå¸¸è®¿é®çæ°æ®çå¨ç¼å­ä¸­ï¼æååºç¨çè®¿é®æ§è½ãå¦æä½ çä¸å¡æ°æ®ä¸­æææ¾çå·ç­æ°æ®åºåï¼æå»ºè®®ä½ ä½¿ç¨ allkeys-lru ç­ç¥ã\n * å¦æä¸å¡åºç¨ä¸­çæ°æ®è®¿é®é¢çç¸å·®ä¸å¤§ï¼æ²¡æææ¾çå·ç­æ°æ®åºåï¼å»ºè®®ä½¿ç¨allkeys-randomç­ç¥ï¼éæºéæ©æ·æ±°çæ°æ®å°±è¡ã\n * å¦æä½ çä¸å¡ä¸­æç½®é¡¶çéæ±ï¼æ¯å¦ç½®é¡¶æ°é»ãç½®é¡¶è§é¢ï¼é£ä¹ï¼å¯ä»¥ä½¿ç¨ volatile-lru ç­ç¥ï¼åæ¶ä¸ç»è¿äºç½®é¡¶æ°æ®è®¾ç½®è¿ææ¶é´ãè¿æ ·ä¸æ¥ï¼è¿äºéè¦ç½®é¡¶çæ°æ®ä¸ç´ä¸ä¼è¢«å é¤ï¼èå¶ä»æ°æ®ä¼å¨è¿ææ¶æ ¹æ® lru è§åè¿è¡ç­éã\n\nä¸æ¦è¢«æ·æ±°çæ°æ®è¢«éå®åï¼redis æä¹å¤çè¿äºæ°æ®å¢ï¼è¿å°±è¦è¯´å°ç¼å­æ¿æ¢æ¶çå·ä½æä½äºã\n\n\n# 2.3 å¦ä½å¤çè¢«æ·æ±°çæ°æ®ï¼\n\nä¸è¬æ¥è¯´ï¼ä¸æ¦è¢«æ·æ±°çæ°æ®éå®åï¼å¦æè¿ä¸ªæ°æ®æ¯å¹²åæ°æ®ï¼é£ä¹æä»¬å°±ç´æ¥å é¤ï¼å¦æè¿ä¸ªæ°æ®æ¯èæ°æ®ï¼æä»¬éè¦æå®ååæ°æ®åºï¼å¦ä¸å¾æç¤ºï¼\n\n * å¹²åæ°æ®ï¼ååºæ¥åå°±æ²¡æ¹è¿\n * èæ°æ®ï¼ååç«¯æ°æ®åºä¸ä¸è´äº\n\nä¸è¿ï¼å¯¹äºredisæ¥è¯´ï¼å®å³å®äºè¢«æ·æ±°çæ°æ®åï¼ä¼æå®ä»¬å é¤ãå³ä½¿æ·æ±°çæ°æ®æ¯èæ°æ®ï¼redis ä¹ä¸ä¼æå®ä»¬ååæ°æ®åºãæä»¥ï¼æä»¬å¨ä½¿ç¨ redis ç¼å­æ¶ï¼å¦ææ°æ®è¢«ä¿®æ¹äºï¼éè¦å¨æ°æ®ä¿®æ¹æ¶å°±å°å®ååæ°æ®åºãå¦åï¼è¿ä¸ªèæ°æ®è¢«æ·æ±°æ¶ï¼ä¼è¢« redis å é¤ï¼èæ°æ®åºéä¹æ²¡æææ°çæ°æ®äºã",charsets:{cjk:!0},lastUpdated:"2023/04/12, 03:21:35",lastUpdatedTimestamp:1681269695e3},{title:"Redis ç¨ä½ç¼å­ä¹ç¼å­å¼å¸¸",frontmatter:{title:"Redis ç¨ä½ç¼å­ä¹ç¼å­å¼å¸¸",date:"2023-04-11T22:22:14.000Z",permalink:"/pages/cbe81b/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/25.Redis%20%E7%94%A8%E4%BD%9C%E7%BC%93%E5%AD%98%E4%B9%8B%E7%BC%93%E5%AD%98%E5%BC%82%E5%B8%B8.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/25.Redis ç¨ä½ç¼å­ä¹ç¼å­å¼å¸¸.md",key:"v-2a85a268",path:"/pages/cbe81b/",headers:[{level:2,title:"3. ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´é®é¢ï¼",slug:"_3-ç¼å­å¼å¸¸-ä¸-å¦ä½è§£å³ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´é®é¢",normalizedTitle:"3. ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´é®é¢ï¼",charIndex:323},{level:3,title:"3.1 ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´æ¯å¦ä½åççï¼",slug:"_3-1-ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´æ¯å¦ä½åçç",normalizedTitle:"3.1 ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´æ¯å¦ä½åççï¼",charIndex:436},{level:4,title:"1ï¼æ°å¢æ°æ®",slug:"_1-æ°å¢æ°æ®",normalizedTitle:"1ï¼æ°å¢æ°æ®",charIndex:1028},{level:4,title:"2ï¼å æ¹æ°æ®",slug:"_2-å æ¹æ°æ®",normalizedTitle:"2ï¼å æ¹æ°æ®",charIndex:1104},{level:3,title:"3.2 å¦ä½è§£å³æ°æ®ä¸ä¸è´é®é¢ï¼",slug:"_3-2-å¦ä½è§£å³æ°æ®ä¸ä¸è´é®é¢",normalizedTitle:"3.2 å¦ä½è§£å³æ°æ®ä¸ä¸è´é®é¢ï¼",charIndex:1312},{level:4,title:"3.2.1 éè¯æºå¶",slug:"_3-2-1-éè¯æºå¶",normalizedTitle:"3.2.1 éè¯æºå¶",charIndex:1447},{level:4,title:"3.2.2 è®¢é MySQL binlogï¼åæä½ç¼å­",slug:"_3-2-2-è®¢é-mysql-binlog-åæä½ç¼å­",normalizedTitle:"3.2.2 è®¢é mysql binlogï¼åæä½ç¼å­",charIndex:1740},{level:4,title:"3.2.3 å»¶è¿åå ",slug:"_3-2-3-å»¶è¿åå ",normalizedTitle:"3.2.3 å»¶è¿åå ",charIndex:2180},{level:3,title:"3.3 å°ç»",slug:"_3-3-å°ç»",normalizedTitle:"3.3 å°ç»",charIndex:3392},{level:2,title:"4. ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­éªå´©ãå»ç©¿ãç©¿éé¾é¢ï¼",slug:"_4-ç¼å­å¼å¸¸-ä¸-å¦ä½è§£å³ç¼å­éªå´©ãå»ç©¿ãç©¿éé¾é¢",normalizedTitle:"4. ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­éªå´©ãå»ç©¿ãç©¿éé¾é¢ï¼",charIndex:4157},{level:3,title:"4.1 ç¼å­éªå´©",slug:"_4-1-ç¼å­éªå´©",normalizedTitle:"4.1 ç¼å­éªå´©",charIndex:4267},{level:4,title:"4.1.1 åå ä¸ï¼å¤§éæ°æ®åæ¶è¿æ",slug:"_4-1-1-åå ä¸-å¤§éæ°æ®åæ¶è¿æ",normalizedTitle:"4.1.1 åå ä¸ï¼å¤§éæ°æ®åæ¶è¿æ",charIndex:4378},{level:4,title:"4.1.2 åå äºï¼Redis ç¼å­å®ä¾åçå®æº",slug:"_4-1-2-åå äº-redis-ç¼å­å®ä¾åçå®æº",normalizedTitle:"4.1.2 åå äºï¼redis ç¼å­å®ä¾åçå®æº",charIndex:4965},{level:3,title:"4.2 ç¼å­å»ç©¿",slug:"_4-2-ç¼å­å»ç©¿",normalizedTitle:"4.2 ç¼å­å»ç©¿",charIndex:6214},{level:3,title:"4.3 ç¼å­ç©¿é",slug:"_4-3-ç¼å­ç©¿é",normalizedTitle:"4.3 ç¼å­ç©¿é",charIndex:6535},{level:4,title:"1ï¼æ¹æ¡ 1ï¼ç¼å­ç©ºå¼æç¼ºçå¼",slug:"_1-æ¹æ¡-1-ç¼å­ç©ºå¼æç¼ºçå¼",normalizedTitle:"1ï¼æ¹æ¡ 1ï¼ç¼å­ç©ºå¼æç¼ºçå¼",charIndex:6839},{level:4,title:"2ï¼æ¹æ¡ 2ï¼ä½¿ç¨å¸éè¿æ»¤å¨å¿«éå¤æ­æ°æ®æ¯å¦å­å¨ï¼é¿åä»æ°æ®åºä¸­æ¥è¯¢æ°æ®æ¯å¦å­å¨ï¼åè½»æ°æ®åºåå",slug:"_2-æ¹æ¡-2-ä½¿ç¨å¸éè¿æ»¤å¨å¿«éå¤æ­æ°æ®æ¯å¦å­å¨-é¿åä»æ°æ®åºä¸­æ¥è¯¢æ°æ®æ¯å¦å­å¨-åè½»æ°æ®åºåå",normalizedTitle:"2ï¼æ¹æ¡ 2ï¼ä½¿ç¨å¸éè¿æ»¤å¨å¿«éå¤æ­æ°æ®æ¯å¦å­å¨ï¼é¿åä»æ°æ®åºä¸­æ¥è¯¢æ°æ®æ¯å¦å­å¨ï¼åè½»æ°æ®åºåå",charIndex:7005},{level:4,title:"3ï¼æ¹æ¡ 3ï¼æåå¯¹è¯·æ±è¿è¡åæ³æ§æ£æµ",slug:"_3-æ¹æ¡-3-æåå¯¹è¯·æ±è¿è¡åæ³æ§æ£æµ",normalizedTitle:"3ï¼æ¹æ¡ 3ï¼æåå¯¹è¯·æ±è¿è¡åæ³æ§æ£æµ",charIndex:7830},{level:3,title:"4.4 å°ç»",slug:"_4-4-å°ç»",normalizedTitle:"4.4 å°ç»",charIndex:8149}],headersStr:"3. ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´é®é¢ï¼ 3.1 ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´æ¯å¦ä½åççï¼ 1ï¼æ°å¢æ°æ® 2ï¼å æ¹æ°æ® 3.2 å¦ä½è§£å³æ°æ®ä¸ä¸è´é®é¢ï¼ 3.2.1 éè¯æºå¶ 3.2.2 è®¢é MySQL binlogï¼åæä½ç¼å­ 3.2.3 å»¶è¿åå  3.3 å°ç» 4. ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­éªå´©ãå»ç©¿ãç©¿éé¾é¢ï¼ 4.1 ç¼å­éªå´© 4.1.1 åå ä¸ï¼å¤§éæ°æ®åæ¶è¿æ 4.1.2 åå äºï¼Redis ç¼å­å®ä¾åçå®æº 4.2 ç¼å­å»ç©¿ 4.3 ç¼å­ç©¿é 1ï¼æ¹æ¡ 1ï¼ç¼å­ç©ºå¼æç¼ºçå¼ 2ï¼æ¹æ¡ 2ï¼ä½¿ç¨å¸éè¿æ»¤å¨å¿«éå¤æ­æ°æ®æ¯å¦å­å¨ï¼é¿åä»æ°æ®åºä¸­æ¥è¯¢æ°æ®æ¯å¦å­å¨ï¼åè½»æ°æ®åºåå 3ï¼æ¹æ¡ 3ï¼æåå¯¹è¯·æ±è¿è¡åæ³æ§æ£æµ 4.4 å°ç»",content:"> åèï¼\n> \n>  * 25 ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´é®é¢ï¼| æå®¢æ¶é´\n>  * 26 ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­éªå´©ãå»ç©¿ãç©¿éé¾é¢ï¼| æå®¢æ¶é´\n>  * ç¼å­æ°æ®ä¸è´æ§æ¢ç©¶ | é¿éå¼åè\n\nææ¡ç¼å­éè¦è§£å³åä¸ªå³é®é®é¢ï¼\n\n * Redis ç¼å­å·ä½æ¯æä¹å·¥ä½çï¼(å·¥ä½åç)\n * Redis ç¼å­å¦ææ»¡äºï¼è¯¥æä¹åï¼(æ¿æ¢ç­ç¥)\n * ä¸ºä»ä¹ä¼æç¼å­ä¸è´æ§ãç¼å­ç©¿éãç¼å­éªå´©ãç¼å­å»ç©¿ç­å¼å¸¸ï¼è¯¥å¦ä½åºå¯¹ï¼(å¼å¸¸å¤çæºå¶)\n * Redis çåå­æ¯ç«æéï¼å¦æç¨å¿«éçåºæç¡¬çæ¥ä¿å­æ°æ®ï¼å¯ä»¥å¢å ç¼å­çæ°æ®éï¼é£ Redis ç¼å­å¯ä»¥ä½¿ç¨å¿«éåºæç¡¬çåï¼(æ©å±æºå¶)\n\nä¸é¢ä»ç»ç¬¬ä¸ä¸ªé®é¢ã\n\n\n# 3. ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´é®é¢ï¼\n\nRedis ç¨ä½ç¼å­ç»å¸¸æä¸äºå¼å¸¸é®é¢ï¼æ¦æ¬æ¥è¯´æ 4 ä¸ªæ¹é¢ï¼ç¼å­ä¸­çæ°æ®åæ°æ®åºä¸­çä¸ä¸è´ï¼ç¼å­éªå´©ï¼ç¼å­å»ç©¿åç¼å­ç©¿éãè¿ä¸èåçä¸ä¸ç¬¬ä¸ä¸ªé®é¢ã\n\n\n# 3.1 ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´æ¯å¦ä½åççï¼\n\nè¿éçæ°æ®çä¸è´æ§å¶å®åå«ä¸¤ç§æåµï¼\n\n * ç¼å­ä¸­ææ°æ®ï¼ä¸ä¸æ°æ®åºä¸­çç¸å\n * ç¼å­ä¸­æ¬èº«æ²¡ææ°æ®ï¼ä¸æ°æ®åºä¸­æ¯ææ°ç\n\nä¸ç¬¦åè¿ä¸¤ç§æåµçï¼å°±å±äºç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´é®é¢äºãå½ç¼å­çè¯»åæ¨¡å¼ä¸åæ¶ï¼æä»¬çåºå¯¹æ¹æ³ä¹ä¸ä¸æ ·ã\n\nå¯¹äºè¯»åç¼å­æ¥è¯´ï¼æ°æ®ç CRUD è¦å¨ç¼å­ä¸­è¿è¡ï¼åæ¶å¯¹åæ°æ®åºè¿è¡ååï¼\n\n * è¥æ³è¦ä¿è¯ç¼å­ä¸æ°æ®åºçæ°æ®ä¸è´ï¼å°±è¦ä½¿ç¨äºå¡æºå¶æ¥ä½¿ç¨åæ­¥ç´åç­ç¥æ¥ä¸åæ´æ°ç¼å­åæ°æ®åºï¼ä¿è¯è¿ä¿©çæ´æ°æåå­æ§ã\n * è¥å¯¹ä¸è´æ§è¦æ±æ²¡æé£ä¹é«ï¼å°±å¯ä»¥ä½¿ç¨å¼æ­¥ååç­ç¥ã\n\nå¯¹äºåªè¯»ç¼å­æ¥è¯´ï¼å¦æææ°æ®æ°å¢ï¼ä¼ç´æ¥åå¥æ°æ®åºï¼èææ°æ®å æ¹æ¶ï¼å°±éè¦æåªè¯»ç¼å­ä¸­çæ°æ®æ è®°ä¸ºæ æãè¿æ ·ä¸æ¥ï¼åºç¨åç»­åè®¿é®è¿äºå¢å æ¹çæ°æ®æ¶ï¼å ä¸ºç¼å­ä¸­æ²¡æç¸åºçæ°æ®ï¼å°±ä¼åçç¼å­ç¼ºå¤±ãæ­¤æ¶ï¼åºç¨åä»æ°æ®åºä¸­ææ°æ®è¯»å¥ç¼å­ï¼è¿æ ·åç»­åè®¿é®æ°æ®æ¶ï¼å°±è½å¤ç´æ¥ä»ç¼å­ä¸­è¯»åäºãè¿ä¸ªè¿ç¨å¦ä¸å¾æç¤ºï¼\n\nä»å¾ä¸­å¯ä»¥çå°ï¼Tomcatä¸è¿è¡çåºç¨ï¼æ è®ºæ¯æ°å¢ï¼Insertæä½ï¼ãä¿®æ¹ï¼Updateæä½ï¼ãè¿æ¯å é¤ï¼Deleteæä½ï¼æ°æ®Xï¼é½ä¼ç´æ¥å¨æ°æ®åºä¸­å¢æ¹å ãå½ç¶ï¼å¦æåºç¨æ§è¡çæ¯ä¿®æ¹æå é¤æä½ï¼è¿ä¼å é¤ç¼å­çæ°æ®Xã\n\né£è¿ä¸ªè¿ç¨ä¼ä¸ä¼åºç°æ°æ®ä¸ä¸è´çæåµå¢ï¼èèå°æ°å¢æ°æ®åå æ¹æ°æ®çæåµä¸ä¸æ ·ï¼æä»¥æä»¬åå¼æ¥çï¼\n\n# 1ï¼æ°å¢æ°æ®\n\nå¦ææ¯æ°å¢æ°æ®ï¼æ°æ®ä¼ç´æ¥åå°æ°æ®åºä¸­ï¼ä¸ç¨å¯¹ç¼å­åä»»ä½æä½ï¼æ­¤æ¶ï¼ç¼å­ä¸­æ¬èº«å°±æ²¡ææ°å¢æ°æ®ï¼èæ°æ®åºä¸­æ¯ææ°å¼ï¼å æ­¤æ¯ä¸è´çã\n\n# 2ï¼å æ¹æ°æ®\n\næ­¤æ¶å°±è¦éæ©æ¯åæ´æ°åæ°æ®åºçæ°æ®è¿æ¯åå é¤ç¼å­ä¸­çæ°æ®ï¼\n\n * å¦æåå ç¼å­å¼ï¼å¯è½å¯¼è´æ°æ®åºæ´æ°å¤±è´¥ãå¯¼è´è¯·æ±åæ¬¡è®¿é®ç¼å­æ¶ï¼åç°ç¼å­ç¼ºå¤±ï¼åè¯» DB æ¶ï¼ä»å¶ä¸­è¯»å°æ§å¼ã\n * å¦æåæ´æ°æ°æ®åºçå¼ï¼å¯è½åºç°ç¼å­å é¤å¤±è´¥ãå¯¼è´åç»­è¯·æ±å åæ¬¡ç¼å­å½ä¸­å¯¼è´è¯»åç¼å­æ§å¼ã\n\nå¯ä»¥çå°ï¼æ è®ºè¿ä¸¤ä¸ªæä½çæ§è¡é¡ºåºè°åè°åï¼åªè¦æä¸ä¸ªæä½å¤±è´¥äºï¼å°±ä¼å¯¼è´å®¢æ·ç«¯è¯»åå°æ§å¼ãå¦ä½è§£å³è¿ä¸ªé®é¢å¢ï¼\n\n\n# 3.2 å¦ä½è§£å³æ°æ®ä¸ä¸è´é®é¢ï¼\n\næ°æ®ä¸ä¸è´åºç°çåå ä¸»è¦åä¸ºä¸¤ç§æåµï¼\n\n * å¯¹ DB/ç¼å­ çæä½ï¼ç¬¬äºä¸ªå¤±è´¥äº è§£å³æ¹æ³ï¼\n   * éè¯æºå¶\n   * è®¢é MySQL binlogï¼åæä½ç¼å­\n * å¤æçå¹¶ååºæ¯ä¸ï¼å¯¹æ°æ®åºåç¼å­çæä½é½æ¯æåç\n\n# 3.2.1 éè¯æºå¶\n\né¦åä¸ç§æ¹æ³æ¯ï¼éè¯æºå¶ã\n\nå·ä½æ¥è¯´ï¼å¯ä»¥æè¦å é¤çç¼å­å¼æèæ¯è¦æ´æ°çæ°æ®åºå¼æå­å°æ¶æ¯éåä¸­ï¼ä¾å¦ä½¿ç¨Kafkaæ¶æ¯éåï¼ãå½åºç¨æ²¡æè½å¤æåå°å é¤ç¼å­å¼æèæ¯æ´æ°æ°æ®åºå¼æ¶ï¼å¯ä»¥ä»æ¶æ¯éåä¸­éæ°è¯»åè¿äºå¼ï¼ç¶ååæ¬¡è¿è¡å é¤ææ´æ°ã\n\nå¦æè½å¤æåå°å é¤ææ´æ°ï¼æä»¬å°±è¦æè¿äºå¼ä»æ¶æ¯éåä¸­å»é¤ï¼ä»¥åéå¤æä½ï¼æ­¤æ¶ï¼æä»¬ä¹å¯ä»¥ä¿è¯æ°æ®åºåç¼å­çæ°æ®ä¸è´äºãå¦åçè¯ï¼æä»¬è¿éè¦åæ¬¡è¿è¡éè¯ãå¦æéè¯è¶è¿çä¸å®æ¬¡æ°ï¼è¿æ¯æ²¡ææåï¼æä»¬å°±éè¦åä¸å¡å±åéæ¥éä¿¡æ¯äºã\n\nå¾æ¾ç¤ºäºåæ´æ°æ°æ®åºï¼åå é¤ç¼å­å¼æ¶ï¼å¦æç¼å­å é¤å¤±è´¥ï¼åæ¬¡éè¯åå é¤æåçæåµï¼\n\n# 3.2.2 è®¢é MySQL binlogï¼åæä½ç¼å­\n\nãåæ´æ°æ°æ®åºï¼åå ç¼å­ãçç­ç¥çç¬¬ä¸æ­¥æ¯æ´æ°æ°æ®åºï¼é£ä¹æ´æ°æ°æ®åºæåï¼å°±ä¼äº§çä¸æ¡åæ´æ¥å¿ï¼è®°å½å¨ binlog éãäºæ¯æä»¬å°±å¯ä»¥éè¿è®¢é binlog æ¥å¿ï¼æ¿å°å·ä½è¦æä½çæ°æ®ï¼ç¶ååæ§è¡ç¼å­å é¤ï¼é¿éå·´å·´å¼æºç Canal ä¸­é´ä»¶å°±æ¯åºäºè¿ä¸ªå®ç°çã\n\nCanal æ¨¡æ MySQL ä¸»ä»å¤å¶çäº¤äºåè®®ï¼æèªå·±ä¼ªè£æä¸ä¸ª MySQL çä»èç¹ï¼å MySQL ä¸»èç¹åé dump è¯·æ±ï¼MySQL æ¶å°è¯·æ±åï¼å°±ä¼å¼å§æ¨é Binlog ç» Canalï¼Canal è§£æ Binlog å­èæµä¹åï¼è½¬æ¢ä¸ºä¾¿äºè¯»åçç»æåæ°æ®ï¼ä¾ä¸æ¸¸ç¨åºè®¢éä½¿ç¨ã\n\nä¸å¾æ¯ Canal çå·¥ä½åçï¼\n\næä»¥ï¼å¦æè¦æ³ä¿è¯ãåæ´æ°æ°æ®åºï¼åå ç¼å­ãç­ç¥ç¬¬äºä¸ªæä½è½æ§è¡æåï¼æä»¬å¯ä»¥ä½¿ç¨ãæ¶æ¯éåæ¥éè¯ç¼å­çå é¤ãï¼æèãè®¢é MySQL binlog åæä½ç¼å­ãï¼è¿ä¸¤ç§æ¹æ³æä¸ä¸ªå±åçç¹ç¹ï¼é½æ¯éç¨å¼æ­¥æä½ç¼å­ã\n\n# 3.2.3 å»¶è¿åå \n\nååè¯´çæ¯å¨æ´æ°æ°æ®åºåå é¤ç¼å­å¼çè¿ç¨ä¸­ï¼å¶ä¸­ä¸ä¸ªæä½å¤±è´¥çæåµï¼å®éä¸ï¼å³ä½¿è¿ä¸¤ä¸ªæä½ç¬¬ä¸æ¬¡æ§è¡æ¶é½æ²¡æå¤±è´¥ï¼å½æå¤§éå¹¶åè¯·æ±æ¶ï¼åºç¨è¿æ¯æå¯è½è¯»å°ä¸ä¸è´çæ°æ®ã\n\nåæ ·ï¼æä»¬æç§ä¸åçå é¤åæ´æ°é¡ºåºï¼åæä¸¤ç§æåµæ¥çãå¨è¿ä¸¤ç§æåµä¸ï¼æä»¬çè§£å³æ¹æ³ä¹ææä¸åã\n\næåµä¸ï¼åå é¤ç¼å­ï¼åæ´æ°æ°æ®åºï¼\n\nåè®¾çº¿ç¨Aå é¤ç¼å­å¼åï¼è¿æ²¡ææ¥å¾åæ´æ°æ°æ®åºï¼æ¯å¦è¯´æç½ç»å»¶è¿ï¼ï¼çº¿ç¨Bå°±å¼å§è¯»åæ°æ®äºï¼é£ä¹è¿ä¸ªæ¶åï¼çº¿ç¨Bä¼åç°ç¼å­ç¼ºå¤±ï¼å°±åªè½å»æ°æ®åºè¯»åãè¿ä¼å¸¦æ¥ä¸¤ä¸ªé®é¢ï¼\n\n 1. çº¿ç¨Bè¯»åå°äºæ§å¼ï¼\n 2. çº¿ç¨Bæ¯å¨ç¼å­ç¼ºå¤±çæåµä¸è¯»åçæ°æ®åºï¼æä»¥ï¼å®è¿ä¼ææ§å¼åå¥ç¼å­ï¼è¿å¯è½ä¼å¯¼è´å¶ä»çº¿ç¨ä»ç¼å­ä¸­è¯»å°æ§å¼ã\n\nç­å°çº¿ç¨Bä»æ°æ®åºè¯»åå®æ°æ®ãæ´æ°äºç¼å­åï¼çº¿ç¨Aæå¼å§æ´æ°æ°æ®åºï¼æ­¤æ¶ï¼ç¼å­ä¸­çæ°æ®æ¯æ§å¼ï¼èæ°æ®åºä¸­çæ¯ææ°å¼ï¼ä¸¤èå°±ä¸ä¸è´äºãè¿ç§æåµç¨è¡¨æ ¼å±ç¤ºå¦ä¸ï¼\n\nè¿è¯¥æä¹åï¼ä¸ç§è§£å³æ¹æ¡æ¯ï¼å¨çº¿ç¨Aæ´æ°å®æ°æ®åºå¼ä»¥åï¼æä»¬å¯ä»¥è®©å®åsleepä¸å°æ®µæ¶é´ï¼åè¿è¡ä¸æ¬¡ç¼å­å é¤æä½ã\n\nä¹æä»¥è¦å ä¸sleepçè¿æ®µæ¶é´ï¼å°±æ¯ä¸ºäºè®©çº¿ç¨Bè½å¤åä»æ°æ®åºè¯»åæ°æ®ï¼åæç¼ºå¤±çæ°æ®åå¥ç¼å­ï¼ç¶åï¼çº¿ç¨Aåè¿è¡å é¤ãæä»¥ï¼çº¿ç¨A sleepçæ¶é´ï¼å°±éè¦å¤§äºçº¿ç¨Bè¯»åæ°æ®ååå¥ç¼å­çæ¶é´ãè¿ä¸ªæ¶é´æä¹ç¡®å®å¢ï¼å»ºè®®ä½ å¨ä¸å¡ç¨åºè¿è¡çæ¶åï¼ç»è®¡ä¸çº¿ç¨è¯»æ°æ®ååç¼å­çæä½æ¶é´ï¼ä»¥æ­¤ä¸ºåºç¡æ¥è¿è¡ä¼°ç®ã\n\nè¿æ ·ä¸æ¥ï¼å¶å®çº¿ç¨è¯»åæ°æ®æ¶ï¼ä¼åç°ç¼å­ç¼ºå¤±ï¼æä»¥ä¼ä»æ°æ®åºä¸­è¯»åææ°å¼ãå ä¸ºè¿ä¸ªæ¹æ¡ä¼å¨ç¬¬ä¸æ¬¡å é¤ç¼å­å¼åï¼å»¶è¿ä¸æ®µæ¶é´åæ¬¡è¿è¡å é¤ï¼æä»¥æä»¬ä¹æå®å«åå»¶è¿åå ãä¸é¢æ¯å»¶è¿åå çä¼ªä»£ç ï¼\n\nredis.delKey(X)\ndb.update(X)\nThread.sleep(N)\nredis.delKey(X)\n\n\n1\n2\n3\n4\n\n\næåµäºï¼åæ´æ°æ°æ®åºå¼ï¼åå é¤ç¼å­å¼ï¼\n\nå¦æçº¿ç¨Aå é¤äºæ°æ®åºä¸­çå¼ï¼ä½è¿æ²¡æ¥å¾åå é¤ç¼å­å¼ï¼çº¿ç¨Bå°±å¼å§è¯»åæ°æ®äºï¼é£ä¹æ­¤æ¶ï¼çº¿ç¨Bæ¥è¯¢ç¼å­æ¶ï¼åç°ç¼å­å½ä¸­ï¼å°±ä¼ç´æ¥ä»ç¼å­ä¸­è¯»åæ§å¼ãä¸è¿ï¼å¨è¿ç§æåµä¸ï¼å¦æå¶ä»çº¿ç¨å¹¶åè¯»ç¼å­çè¯·æ±ä¸å¤ï¼é£ä¹ï¼å°±ä¸ä¼æå¾å¤è¯·æ±è¯»åå°æ§å¼ãèä¸ï¼çº¿ç¨Aä¸è¬ä¹ä¼å¾å¿«å é¤ç¼å­å¼ï¼è¿æ ·ä¸æ¥ï¼å¶ä»çº¿ç¨åæ¬¡è¯»åæ¶ï¼å°±ä¼åçç¼å­ç¼ºå¤±ï¼è¿èä»æ°æ®åºä¸­è¯»åææ°å¼ãæä»¥ï¼è¿ç§æåµå¯¹ä¸å¡çå½±åè¾å°ã\n\nè¿ç§æåµç¨è¡¨æ ¼å±ç¤ºä¸ºï¼\n\n----------------------------------------\n\nå°è¿éæä»¬å¯ä»¥ç¥éï¼ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´ä¸è¬æ¯ç±ä¸¤ä¸ªåå å¯¼è´çï¼æ¬èå¹¶æä¾äºç¸åºçè§£å³æ¹æ¡ï¼\n\n * å é¤ç¼å­å¼ææ´æ°æ°æ®åºå¤±è´¥èå¯¼è´æ°æ®ä¸ä¸è´ï¼ä½ å¯ä»¥ä½¿ç¨éè¯æºå¶ç¡®ä¿å é¤ææ´æ°æä½æåã\n * å¨å é¤ç¼å­å¼ãæ´æ°æ°æ®åºçè¿ä¸¤æ­¥æä½ä¸­ï¼æå¶ä»çº¿ç¨çå¹¶åè¯»æä½ï¼å¯¼è´å¶ä»çº¿ç¨è¯»åå°æ§å¼ï¼åºå¯¹æ¹æ¡æ¯å»¶è¿åå ã\n\n\n# 3.3 å°ç»\n\nè¿ä¸å¤§èè®²äºç¼å­ä¸ä¸è´çé®é¢ï¼å¯ä»¥åæè¯»åç¼å­ååªè¯»ç¼å­ä¸¤ç§æåµåæã\n\n * å¯¹äºè¯»åç¼å­ï¼åæ­¥ååç­ç¥å°±å¯ä»¥ä¿è¯ç¼å­åæ°æ®åºä¸­çæ°æ®ä¸è´ã\n * å¯¹äºåªè¯»ç¼å­ï¼å¯ä»¥æ»ç»ä¸ºä¸é¢è¿å¼ è¡¨ï¼\n\nå¤§å¤æ°ä¸å¡ä¸­ï¼æä»¬æ¯æ Redis å½ååªè¯»ç¼å­æ¥ä½¿ç¨ï¼å¹¶å»ºè®®ä¼åä½¿ç¨åæ´æ°æ°æ®åºåå é¤ç¼å­çæ¹æ³(cache aside)ï¼åå ä¸»è¦æä¸¤ä¸ªï¼\n\n 1. åå é¤ç¼å­å¼åæ´æ°æ°æ®åºï¼æå¯è½å¯¼è´è¯·æ±å ç¼å­ç¼ºå¤±èè®¿é®æ°æ®åºï¼ç»æ°æ®åºå¸¦æ¥ååï¼\n 2. å¦æä¸å¡åºç¨ä¸­è¯»åæ°æ®åºååç¼å­çæ¶é´ä¸å¥½ä¼°ç®ï¼é£ä¹ï¼å»¶è¿åå ä¸­çç­å¾æ¶é´å°±ä¸å¥½è®¾ç½®ã\n\nä¸è¿ï¼å½ä½¿ç¨åæ´æ°æ°æ®åºåå é¤ç¼å­æ¶ï¼ä¹æä¸ªå°æ¹éè¦æ³¨æï¼å¦æä¸å¡å±è¦æ±å¿é¡»è¯»åä¸è´çæ°æ®ï¼é£ä¹ï¼æä»¬å°±éè¦å¨æ´æ°æ°æ®åºæ¶ï¼åå¨Redisç¼å­å®¢æ·ç«¯æå­å¹¶åè¯»è¯·æ±ï¼ç­æ°æ®åºæ´æ°å®ãç¼å­å¼å é¤åï¼åè¯»åæ°æ®ï¼ä»èä¿è¯æ°æ®ä¸è´æ§ã\n\n----------------------------------------\n\ncatch aside å¯ä»¥è¢«ç§°ä¹ä¸ºç¼å­ä½¿ç¨çæä½³å®è·µï¼ä½ä¸æ­¤åæ¶ï¼å®å¼å¥äºç¼å­çå½ä¸­çéä½çé®é¢ï¼ï¼æ¯æ¬¡é½å é¤ç¼å­èªç¶å¯¼è´æ´ä¸å®¹æå½ä¸­äºï¼ï¼å æ­¤å®æ´éç¨äºå¯¹ç¼å­å½ä¸­çè¦æ±å¹¶ä¸æ¯ç¹å«é«çåºæ¯ãå¦æè¦æ±è¾é«çç¼å­å½ä¸­çï¼ä¾ç¶éè¦éç¨æ´æ°æ°æ®åºååæ¶æ´æ°ç¼å­çæ¹æ¡ã\n\nä½æ¯æ´æ°æ°æ®åºååæ¶æ´æ°ç¼å­çæ¹æ¡ä¼å¨å¹¶ååºæ¯ä¸åºç°æ°æ®ä¸ä¸è´ï¼è§£å³æ¹æ¡æä¸¤ç§ï¼\n\n * å¼å¥åå¸å¼é å¨æ´æ°ç¼å­ä¹åå°è¯è·åéï¼å¦æå·²ç»è¢«å ç¨å°±åé»å¡ä½çº¿ç¨ï¼ç­å¾å¶ä»çº¿ç¨éæ¾éååå°è¯æ´æ°ãä½è¿ä¼å½±åå¹¶åæä½çæ§è½ã\n * è®¾ç½®è¾ç­ç¼å­æ¶é´ è®¾ç½®è¾ç­çç¼å­è¿ææ¶é´è½å¤ä½¿å¾æ°æ®ä¸ä¸è´é®é¢å­å¨çæ¶é´ä¹æ¯è¾é¿ï¼å¯¹ä¸å¡çå½±åç¸å¯¹è¾å°ãä½æ¯ä¸æ­¤åæ¶ï¼å¶å®è¿ä¹ä½¿å¾ç¼å­å½ä¸­çéä½ï¼ååå°äºåé¢çé®é¢é...\n\n\n# 4. ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­éªå´©ãå»ç©¿ãç©¿éé¾é¢ï¼\n\né¤äºç¼å­ä¸ä¸è´ï¼è¿æä¸ç§å¯è½çç¼å­å¼å¸¸ï¼ç¼å­éªå´©ãç¼å­å»ç©¿åç¼å­ç©¿éãè¿ä¸ä¸ªé®é¢ä¸æ¦åçï¼ä¼å¯¼è´å¤§éçè¯·æ±ç§¯åå°æ°æ®åºå±ï¼ä»èå¯¼è´æ°æ®åºå®æºæèæéã\n\n\n# 4.1 ç¼å­éªå´©\n\nç¼å­éªå´©ï¼æå¤§éçåºç¨è¯·æ±æ æ³å¨ Redis ç¼å­ä¸­è¿è¡å¤çï¼ç´§æ¥çåºç¨å°å¤§éè¯·æ±åéå°æ°æ®åºå±ï¼å¯¼è´æ°æ®åºå±çååæ¿å¢ã\n\nç¼å­éªå´©ä¸è¬æ¯ç±ä¸¤ä¸ªåå å¯¼è´çï¼åºå¯¹æ¹æ¡ä¹ææä¸åï¼æä»¬ä¸ä¸ªä¸ªæ¥çã\n\n# 4.1.1 åå ä¸ï¼å¤§éæ°æ®åæ¶è¿æ\n\nç¼å­éªå´©çç¬¬ä¸ç§åå ï¼ç¼å­ä¸­æå¤§éæ°æ®åæ¶è¿æï¼å¯¼è´å¤§éè¯·æ±æ æ³å¾å°å¤çã\n\nå·ä½æ¥è¯´ï¼å½æ°æ®ä¿å­å¨ç¼å­ä¸­ï¼å¹¶ä¸è®¾ç½®äºè¿ææ¶é´æ¶ï¼å¦æå¨æä¸ä¸ªæ¶å»ï¼å¤§éæ°æ®åæ¶è¿æï¼æ­¤æ¶ï¼åºç¨åè®¿é®è¿äºæ°æ®çè¯ï¼å°±ä¼åçç¼å­ç¼ºå¤±ãç´§æ¥çï¼åºç¨å°±ä¼æè¯·æ±åéç»æ°æ®åºï¼ä»æ°æ®åºä¸­è¯»åæ°æ®ãå¦æåºç¨çå¹¶åè¯·æ±éå¾å¤§ï¼é£ä¹æ°æ®åºçååä¹å°±å¾å¤§ï¼è¿ä¼è¿ä¸æ­¥å½±åå°æ°æ®åºçå¶ä»æ­£å¸¸ä¸å¡è¯·æ±å¤çãæä»¬æ¥çä¸ä¸ªç®åçä¾å­ï¼å¦ä¸å¾æç¤ºï¼\n\néå¯¹å¤§éæ°æ®åæ¶å¤±æå¸¦æ¥çç¼å­éªå´©é®é¢ï¼æä¸¤ç§è§£å³æ¹æ¡ï¼\n\n 1. å¾®è°è¿ææ¶é´ï¼ä¸å¡é¿åç»å¤§éçæ°æ®è®¾ç½®ç¸åçè¿ææ¶é´ãå¦æä¸å¡å±çç¡®è¦æ±æäºæ°æ®åæ¶å¤±æï¼ä½ å¯ä»¥å¨ç¨ EXPIRE å½ä»¤ç»æ¯ä¸ªæ°æ®è®¾ç½®è¿ææ¶é´æ¶ï¼ç»è¿äºæ°æ®çè¿ææ¶é´å¢å ä¸ä¸ªè¾å°çéæºæ°ãè¿æ ·ä¸æ¥ï¼ä¸åæ°æ®çè¿ææ¶é´å·®å«ä¸ä¼å¤ªå¤§ï¼æ¢é¿åäºå¤§éæ°æ®åæ¶è¿æï¼åæ¶ä¹ä¿è¯äºè¿äºæ°æ®åºæ¬å¨ç¸è¿çæ¶é´å¤±æï¼ä»ç¶è½æ»¡è¶³ä¸å¡éæ±ã\n 2. æå¡éçº§ï¼æåçç¼å­éªå´©æ¶ï¼éå¯¹ä¸åçæ°æ®éåä¸åçå¤çæ¹å¼ï¼\n    * å½ä¸å¡åºç¨è®¿é®çæ¯éæ ¸å¿æ°æ®ï¼ä¾å¦çµåååå±æ§ï¼æ¶ï¼ææ¶åæ­¢ä»ç¼å­ä¸­æ¥è¯¢è¿äºæ°æ®ï¼èæ¯ç´æ¥è¿åé¢å®ä¹ä¿¡æ¯ãç©ºå¼ææ¯éè¯¯ä¿¡æ¯ï¼\n    * å½ä¸å¡åºç¨è®¿é®çæ¯æ ¸å¿æ°æ®ï¼ä¾å¦çµååååºå­ï¼æ¶ï¼ä»ç¶åè®¸æ¥è¯¢ç¼å­ï¼å¦æç¼å­ç¼ºå¤±ï¼ä¹å¯ä»¥ç»§ç»­éè¿æ°æ®åºè¯»åã\n\n# 4.1.2 åå äºï¼Redis ç¼å­å®ä¾åçå®æº\n\nç¼å­éªå´©çç¬¬äºç§åå ï¼Redis ç¼å­å®ä¾åçæéå®æºäºï¼æ æ³å¤çè¯·æ±ï¼è¿å°±ä¼å¯¼è´å¤§éè¯·æ±ä¸ä¸å­ç§¯åå°æ°æ®åºå±ï¼ä»èåçç¼å­éªå´©ã\n\nä¸è¬æ¥è¯´ï¼ä¸ä¸ª Redis å®ä¾å¯ä»¥æ¯ææ°ä¸çº§å«çè¯·æ±å¤çååéï¼èåä¸ªæ°æ®åºå¯è½åªè½æ¯ææ°åçº§å«çè¯·æ±å¤çååéï¼å®ä»¬ä¸¤ä¸ªçå¤çè½åå¯è½ç¸å·®äºè¿ååãç±äºç¼å­éªå´©ï¼Redis ç¼å­å¤±æï¼æä»¥ï¼æ°æ®åºå°±å¯è½è¦æ¿åè¿ååçè¯·æ±ååï¼ä»èå ä¸ºååè¿å¤§èå´©æºã\n\nè¿ç§æåµä¸ç±äº Redis å®ä¾åçäºå®æºï¼æä»¬éè¦éè¿å¶ä»æ¹æ³æ¥åºå¯¹ç¼å­éªå´©äºãæç»ä½ æä¾ä¸¤ä¸ªå»ºè®®ï¼\n\nç¬¬ä¸ä¸ªå»ºè®®ï¼å¨ä¸å¡ç³»ç»ä¸­å®ç°æå¡çæ­æè¯·æ±éæµæºå¶ã\n\næè°çæå¡çæ­ï¼æ¯æå¨åçç¼å­éªå´©æ¶ï¼ä¸ºäºé²æ­¢å¼åè¿éçæ°æ®åºéªå´©ï¼çè³æ¯æ´ä¸ªç³»ç»çå´©æºï¼æä»¬æåä¸å¡åºç¨å¯¹ç¼å­ç³»ç»çæ¥å£è®¿é®ï¼èæ¯ç´æ¥è¿åï¼ç­å°Redisç¼å­å®ä¾éæ°æ¢å¤æå¡åï¼ååè®¸åºç¨è¯·æ±åéå°ç¼å­ç³»ç»ãè¿æ ·é¿åäºå¤§éè¯·æ±å ç¼å­ç¼ºå¤±èç§¯åå°æ°æ®åºç³»ç»ã\n\nå¨ä¸å¡ç³»ç»è¿è¡æ¶ï¼æä»¬å¯ä»¥çæµ Redis æå¨æºå¨åæ°æ®åºæå¨æºå¨çè´è½½ææ ï¼ä¾å¦æ¯ç§è¯·æ±æ°ãCPUå©ç¨çãåå­å©ç¨çç­ãå¦ææä»¬åç° Redis å®ä¾å®æºäºï¼èæ°æ®åºæå¨æºå¨çè´è½½ååçªç¶å¢å ï¼æ­¤æ¶å°±åçç¼å­éªå´©äºãå¤§éè¯·æ±è¢«åéå°æ°æ®åºè¿è¡å¤çãæä»¬å¯ä»¥å¯å¨æå¡çæ­æºå¶ï¼æåä¸å¡åºç¨å¯¹ç¼å­æå¡çè®¿é®ï¼ä»èéä½å¯¹æ°æ®åºçè®¿é®ååï¼å¦ä¸å¾æç¤ºï¼\n\næå¡çæ­è½ç¶å¯ä»¥ä¿è¯æ°æ®åºçæ­£å¸¸è¿è¡ï¼ä½æ¯æåäºæ´ä¸ªç¼å­ç³»ç»çè®¿é®ï¼å¯¹ä¸å¡åºç¨çå½±åèå´å¤§ãä¸ºäºå°½å¯è½åå°è¿ç§å½±åï¼æä»¬ä¹å¯ä»¥è¿è¡è¯·æ±éæµï¼ææä»¬å¨ä¸å¡ç³»ç»çè¯·æ±å¥å£åç«¯æ§å¶æ¯ç§è¿å¥ç³»ç»çè¯·æ±æ°ï¼é¿åè¿å¤çè¯·æ±è¢«åéå°æ°æ®åºã\n\nä¸¾ä¸ªä¾å­ãåè®¾ä¸å¡ç³»ç»æ­£å¸¸è¿è¡æ¶ï¼è¯·æ±å¥å£åç«¯åè®¸æ¯ç§è¿å¥ç³»ç»çè¯·æ±æ¯1ä¸ä¸ªï¼å¶ä¸­ï¼9000ä¸ªè¯·æ±é½è½å¨ç¼å­ç³»ç»ä¸­è¿è¡å¤çï¼åªæ1000ä¸ªè¯·æ±ä¼è¢«åºç¨åéå°æ°æ®åºè¿è¡å¤çãä¸æ¦åçäºç¼å­éªå´©ï¼æ°æ®åºçæ¯ç§è¯·æ±æ°çªç¶å¢å å°æ¯ç§1ä¸ä¸ªï¼æ­¤æ¶ï¼æä»¬å°±å¯ä»¥å¯å¨è¯·æ±éæµæºå¶ï¼å¨è¯·æ±å¥å£åç«¯åªåè®¸æ¯ç§è¿å¥ç³»ç»çè¯·æ±æ°ä¸º1000ä¸ªï¼åå¤çè¯·æ±å°±ä¼å¨å¥å£åç«¯è¢«ç´æ¥æç»æå¡ãæä»¥ï¼ä½¿ç¨äºè¯·æ±éæµï¼å°±å¯ä»¥é¿åå¤§éå¹¶åè¯·æ±ååä¼ éå°æ°æ®åºå±ã\n\nä½¿ç¨æå¡çæ­ææ¯è¯·æ±éæµæºå¶ï¼æ¥åºå¯¹Rediså®ä¾å®æºå¯¼è´çç¼å­éªå´©é®é¢ï¼æ¯å±äºâäºåè¯¸èäº®âï¼ä¹å°±æ¯å·²ç»åçç¼å­éªå´©äºï¼æä»¬ä½¿ç¨è¿ä¸¤ä¸ªæºå¶ï¼æ¥éä½éªå´©å¯¹æ°æ®åºåæ´ä¸ªä¸å¡ç³»ç»çå½±åã\n\nç¬¬äºä¸ªå»ºè®®ï¼äºåé¢é²ï¼æå»º Redis éç¾¤ã\n\néè¿ä¸»ä»èç¹çæ¹å¼æå»º Redis ç¼å­é«å¯é éç¾¤ãå¦æ Redis ç¼å­çä¸»èç¹æéå®æºäºï¼ä»èç¹è¿å¯ä»¥åæ¢æä¸ºä¸»èç¹ï¼ç»§ç»­æä¾ç¼å­æå¡ï¼é¿åäºç±äºç¼å­å®ä¾å®æºèå¯¼è´çç¼å­éªå´©é®é¢ã\n\nç¼å­éªå´©æ¯åçå¨å¤§éæ°æ®åæ¶å¤±æçåºæ¯ä¸ï¼èæ¥ä¸æ¥æè¦åä½ ä»ç»çç¼å­å»ç©¿ï¼æ¯åçå¨æä¸ªç­ç¹æ°æ®å¤±æçåºæ¯ä¸ãåç¼å­éªå´©ç¸æ¯ï¼ç¼å­å»ç©¿å¤±æçæ°æ®æ°éè¦å°å¾å¤ï¼åºå¯¹æ¹æ³ä¹ä¸ä¸æ ·ï¼æä»¬æ¥çä¸ã\n\n\n# 4.2 ç¼å­å»ç©¿\n\nç¼å­å»ç©¿æ¯æï¼éå¯¹æä¸ªè®¿é®éå¸¸é¢ç¹çç­ç¹æ°æ®çè¯·æ±ï¼æ æ³å¨ç¼å­ä¸­è¿è¡å¤çï¼ç´§æ¥çï¼è®¿é®è¯¥æ°æ®çå¤§éè¯·æ±ï¼ä¸ä¸å­é½åéå°äºåç«¯æ°æ®åºï¼å¯¼è´äºæ°æ®åºååæ¿å¢ï¼ä¼å½±åæ°æ®åºå¤çå¶ä»è¯·æ±ãç¼å­å»ç©¿çæåµï¼ç»å¸¸åçå¨ç­ç¹æ°æ®è¿æå¤±ææ¶ï¼å¦ä¸å¾æç¤ºï¼\n\nä¸ºäºé¿åç¼å­å»ç©¿ç»æ°æ®åºå¸¦æ¥çæ¿å¢ååï¼æä»¬çè§£å³æ¹æ³ä¹æ¯è¾ç´æ¥ï¼å¯¹äºè®¿é®ç¹å«é¢ç¹çç­ç¹æ°æ®ï¼æä»¬å°±ä¸è®¾ç½®è¿ææ¶é´äºãè¿æ ·ä¸æ¥ï¼å¯¹ç­ç¹æ°æ®çè®¿é®è¯·æ±ï¼é½å¯ä»¥å¨ç¼å­ä¸­è¿è¡å¤çï¼è Redis æ°ä¸çº§å«çé«ååéå¯ä»¥å¾å¥½å°åºå¯¹å¤§éçå¹¶åè¯·æ±è®¿é®ã\n\nä»¥ä¸ï¼ç¼å­éªå´©åç¼å­å»ç©¿é®é¢ï¼é½æ¯å¨ DB ä¸­ä¿å­äºåºç¨è¦è®¿é®çæ°æ®çæåµãä¸é¢è¦ççç¼å­ç©¿éæ¯æ°æ®ä¹ä¸å¨ DB ä¸­çæåµã\n\n\n# 4.3 ç¼å­ç©¿é\n\nç¼å­ç©¿éæè¦è®¿é®çæ°æ®æ¢ä¸å¨ Redis ç¼å­ä¸­ï¼ä¹ä¸å¨æ°æ®åºä¸­ï¼å¯¼è´è¯·æ±å¨è®¿é®ç¼å­æ¶ï¼åçç¼å­ç¼ºå¤±ï¼åå»è®¿é®æ°æ®åºæ¶ï¼åç°æ°æ®åºä¸­ä¹æ²¡æè¦è®¿é®çæ°æ®ãæ­¤æ¶ï¼åºç¨ä¹æ æ³ä»æ°æ®åºä¸­è¯»åæ°æ®ååå¥ç¼å­ï¼æ¥æå¡åç»­è¯·æ±ï¼è¿æ ·ä¸æ¥ï¼ç¼å­ä¹å°±æäºâæè®¾âï¼å¦æåºç¨æç»­æå¤§éè¯·æ±è®¿é®æ°æ®ï¼å°±ä¼åæ¶ç»ç¼å­åæ°æ®åºå¸¦æ¥å·¨å¤§ååï¼å¦ä¸å¾æç¤ºï¼\n\né£ä¹ï¼ç¼å­ç©¿éä¼åçå¨ä»ä¹æ¶åå¢ï¼ä¸è¬æ¥è¯´ï¼æä¸¤ç§æåµï¼\n\n * ä¸å¡å±è¯¯æä½ï¼ç¼å­ä¸­çæ°æ®åæ°æ®åºä¸­çæ°æ®è¢«è¯¯å é¤äºï¼æä»¥ç¼å­åæ°æ®åºä¸­é½æ²¡ææ°æ®ï¼\n * æ¶ææ»å»ï¼ä¸é¨è®¿é®æ°æ®åºä¸­æ²¡æçæ°æ®ã\n\nä¸ºäºé¿åç¼å­ç©¿éçå½±åï¼ææ¥ç»ä½ æä¾ä¸ç§åºå¯¹æ¹æ¡ã\n\n# 1ï¼æ¹æ¡ 1ï¼ç¼å­ç©ºå¼æç¼ºçå¼\n\nä¸æ¦åçç¼å­ç©¿éï¼æä»¬å°±å¯ä»¥éå¯¹æ¥è¯¢çæ°æ®ï¼å¨Redisä¸­ç¼å­ä¸ä¸ªç©ºå¼ææ¯åä¸å¡å±ååç¡®å®çç¼ºçå¼ï¼ä¾å¦ï¼åºå­çç¼ºçå¼å¯ä»¥è®¾ä¸º0ï¼ãç´§æ¥çï¼åºç¨åéçåç»­è¯·æ±åè¿è¡æ¥è¯¢æ¶ï¼å°±å¯ä»¥ç´æ¥ä»Redisä¸­è¯»åç©ºå¼æç¼ºçå¼ï¼è¿åç»ä¸å¡åºç¨äºï¼é¿åäºæå¤§éè¯·æ±åéç»æ°æ®åºå¤çï¼ä¿æäºæ°æ®åºçæ­£å¸¸è¿è¡ã\n\n# 2ï¼æ¹æ¡ 2ï¼ä½¿ç¨å¸éè¿æ»¤å¨å¿«éå¤æ­æ°æ®æ¯å¦å­å¨ï¼é¿åä»æ°æ®åºä¸­æ¥è¯¢æ°æ®æ¯å¦å­å¨ï¼åè½»æ°æ®åºåå\n\nå¸éè¿æ»¤å¨ç±ä¸ä¸ªåå¼é½ä¸º0çbitæ°ç»åNä¸ªåå¸å½æ°ç»æï¼å¯ä»¥ç¨æ¥å¿«éå¤æ­æä¸ªæ°æ®æ¯å¦å­å¨ãå½æä»¬æ³æ è®°æä¸ªæ°æ®å­å¨æ¶ï¼ä¾å¦ï¼æ°æ®å·²è¢«åå¥æ°æ®åºï¼ï¼å¸éè¿æ»¤å¨ä¼éè¿ä¸ä¸ªæä½å®ææ è®°ï¼\n\n * é¦åï¼ä½¿ç¨Nä¸ªåå¸å½æ°ï¼åå«è®¡ç®è¿ä¸ªæ°æ®çåå¸å¼ï¼å¾å°Nä¸ªåå¸å¼ã\n * ç¶åï¼æä»¬æè¿Nä¸ªåå¸å¼å¯¹bitæ°ç»çé¿åº¦åæ¨¡ï¼å¾å°æ¯ä¸ªåå¸å¼å¨æ°ç»ä¸­çå¯¹åºä½ç½®ã\n * æåï¼æä»¬æå¯¹åºä½ç½®çbitä½è®¾ç½®ä¸º1ï¼è¿å°±å®æäºå¨å¸éè¿æ»¤å¨ä¸­æ è®°æ°æ®çæä½ã\n\nå¦ææ°æ®ä¸å­å¨ï¼ä¾å¦ï¼æ°æ®åºéæ²¡æåå¥æ°æ®ï¼ï¼æä»¬ä¹å°±æ²¡æç¨å¸éè¿æ»¤å¨æ è®°è¿æ°æ®ï¼é£ä¹ï¼bitæ°ç»å¯¹åºbitä½çå¼ä»ç¶ä¸º0ã\n\nå½éè¦æ¥è¯¢æä¸ªæ°æ®æ¶ï¼æä»¬å°±æ§è¡ååè¯´çè®¡ç®è¿ç¨ï¼åå¾å°è¿ä¸ªæ°æ®å¨bitæ°ç»ä¸­å¯¹åºçNä¸ªä½ç½®ãç´§æ¥çï¼æä»¬æ¥çbitæ°ç»ä¸­è¿Nä¸ªä½ç½®ä¸çbitå¼ãåªè¦è¿Nä¸ªbitå¼æä¸ä¸ªä¸ä¸º1ï¼è¿å°±è¡¨æå¸éè¿æ»¤å¨æ²¡æå¯¹è¯¥æ°æ®åè¿æ è®°ï¼æä»¥ï¼æ¥è¯¢çæ°æ®ä¸å®æ²¡æå¨æ°æ®åºä¸­ä¿å­ãè¿ä¸ªè¿ç¨å¦ä¸å¾ï¼\n\nå¾ä¸­å¸éè¿æ»¤å¨æ¯ä¸ä¸ªåå«10ä¸ªbitä½çæ°ç»ï¼ä½¿ç¨äº3ä¸ªåå¸å½æ°ï¼å½å¨å¸éè¿æ»¤å¨ä¸­æ è®°æ°æ®Xæ¶ï¼Xä¼è¢«è®¡ç®3æ¬¡åå¸å¼ï¼å¹¶å¯¹10åæ¨¡ï¼åæ¨¡ç»æåå«æ¯1ã3ã7ãæä»¥ï¼bitæ°ç»çç¬¬1ã3ã7ä½è¢«è®¾ç½®ä¸º1ãå½åºç¨æ³è¦æ¥è¯¢Xæ¶ï¼åªè¦æ¥çæ°ç»çç¬¬1ã3ã7ä½æ¯å¦ä¸º1ï¼åªè¦æä¸ä¸ªä¸º0ï¼é£ä¹ï¼Xå°±è¯å®ä¸å¨æ°æ®åºä¸­ã\n\næ­£æ¯åºäºå¸éè¿æ»¤å¨çå¿«éæ£æµç¹æ§ï¼æä»¬å¯ä»¥å¨ææ°æ®åå¥æ°æ®åºæ¶ï¼ä½¿ç¨å¸éè¿æ»¤å¨åä¸ªæ è®°ãå½ç¼å­ç¼ºå¤±åï¼åºç¨æ¥è¯¢æ°æ®åºæ¶ï¼å¯ä»¥éè¿æ¥è¯¢å¸éè¿æ»¤å¨å¿«éå¤æ­æ°æ®æ¯å¦å­å¨ãå¦æä¸å­å¨ï¼å°±ä¸ç¨åå»æ°æ®åºä¸­æ¥è¯¢äºãè¿æ ·ä¸æ¥ï¼å³ä½¿åçç¼å­ç©¿éäºï¼å¤§éè¯·æ±åªä¼æ¥è¯¢Redisåå¸éè¿æ»¤å¨ï¼èä¸ä¼ç§¯åå°æ°æ®åºï¼ä¹å°±ä¸ä¼å½±åæ°æ®åºçæ­£å¸¸è¿è¡ãå¸éè¿æ»¤å¨å¯ä»¥ä½¿ç¨Rediså®ç°ï¼æ¬èº«å°±è½æ¿æè¾å¤§çå¹¶åè®¿é®ååã\n\n# 3ï¼æ¹æ¡ 3ï¼æåå¯¹è¯·æ±è¿è¡åæ³æ§æ£æµ\n\nè¿ç§æ¹æ¡æ¯å¨è¯·æ±å¥å£çåç«¯è¿è¡è¯·æ±æ£æµãç¼å­ç©¿éçä¸ä¸ªåå æ¯æå¤§éçæ¶æè¯·æ±è®¿é®ä¸å­å¨çæ°æ®ï¼æä»¥ï¼ä¸ä¸ªææçåºå¯¹æ¹æ¡æ¯å¨è¯·æ±å¥å£åç«¯ï¼å¯¹ä¸å¡ç³»ç»æ¥æ¶å°çè¯·æ±è¿è¡åæ³æ§æ£æµï¼ææ¶æçè¯·æ±ï¼ä¾å¦è¯·æ±åæ°ä¸åçãè¯·æ±åæ°æ¯éæ³å¼ãè¯·æ±å­æ®µä¸å­å¨ï¼ç´æ¥è¿æ»¤æï¼ä¸è®©å®ä»¬è®¿é®åç«¯ç¼å­åæ°æ®åºãè¿æ ·ä¸æ¥ï¼ä¹å°±ä¸ä¼åºç°ç¼å­ç©¿éé®é¢äºã\n\nè·ç¼å­éªå´©ãç¼å­å»ç©¿è¿ä¸¤ç±»é®é¢ç¸æ¯ï¼ç¼å­ç©¿éçå½±åæ´å¤§ä¸äºï¼å¸æä½ è½éç¹å³æ³¨ä¸ä¸ï¼\n\n * ä»é¢é²çè§åº¦æ¥è¯´ï¼æä»¬éè¦é¿åè¯¯å é¤æ°æ®åºåç¼å­ä¸­çæ°æ®ï¼\n * ä»åºå¯¹è§åº¦æ¥è¯´ï¼æä»¬å¯ä»¥å¨ä¸å¡ç³»ç»ä¸­ä½¿ç¨ç¼å­ç©ºå¼æç¼ºçå¼ãä½¿ç¨å¸éè¿æ»¤å¨ï¼ä»¥åè¿è¡æ¶æè¯·æ±æ£æµç­æ¹æ³ã\n\n\n# 4.4 å°ç»\n\næ¬èæè®²çä¸ä¸ªé®é¢å¦ä¸å¾æç¤ºï¼\n\næåå¼ºè°ä¸ä¸ï¼æå¡çæ­ãæå¡éçº§ãè¯·æ±éæµè¿äºæ¹æ³é½æ¯å±äºâææâæ¹æ¡ï¼å¨ä¿è¯æ°æ®åºåæ´ä½ç³»ç»ç¨³å®çåæ¶ï¼ä¼å¯¹ä¸å¡åºç¨å¸¦æ¥è´é¢å½±åãä¾å¦ä½¿ç¨æå¡éçº§æ¶ï¼æé¨åæ°æ®çè¯·æ±å°±åªè½å¾å°éè¯¯è¿åä¿¡æ¯ï¼æ æ³æ­£å¸¸å¤çãå¦æä½¿ç¨äºæå¡çæ­ï¼é£ä¹ï¼æ´ä¸ªç¼å­ç³»ç»çæå¡é½è¢«æåäºï¼å½±åçä¸å¡èå´æ´å¤§ãèä½¿ç¨äºè¯·æ±éæµæºå¶åï¼æ´ä¸ªä¸å¡ç³»ç»çååçä¼éä½ï¼è½å¹¶åå¤ççç¨æ·è¯·æ±ä¼åå°ï¼ä¼å½±åå°ç¨æ·ä½éªã\n\næä»¥å»ºè®®å°½éä½¿ç¨é¢é²å¼æ¹æ¡ï¼\n\n * éå¯¹ç¼å­éªå´©ï¼åçå°è®¾ç½®æ°æ®è¿ææ¶é´ï¼ä»¥åæ­å»ºé«å¯é ç¼å­éç¾¤ï¼\n * éå¯¹ç¼å­å»ç©¿ï¼å¨ç¼å­è®¿é®éå¸¸é¢ç¹çç­ç¹æ°æ®æ¶ï¼ä¸è¦è®¾ç½®è¿ææ¶é´ï¼\n * éå¯¹ç¼å­ç©¿éï¼æåå¨å¥å£åç«¯å®ç°æ¶æè¯·æ±æ£æµï¼æèè§èæ°æ®åºçæ°æ®å é¤æä½ï¼é¿åè¯¯å é¤ã",normalizedContent:"> åèï¼\n> \n>  * 25 ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´é®é¢ï¼| æå®¢æ¶é´\n>  * 26 ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­éªå´©ãå»ç©¿ãç©¿éé¾é¢ï¼| æå®¢æ¶é´\n>  * ç¼å­æ°æ®ä¸è´æ§æ¢ç©¶ | é¿éå¼åè\n\nææ¡ç¼å­éè¦è§£å³åä¸ªå³é®é®é¢ï¼\n\n * redis ç¼å­å·ä½æ¯æä¹å·¥ä½çï¼(å·¥ä½åç)\n * redis ç¼å­å¦ææ»¡äºï¼è¯¥æä¹åï¼(æ¿æ¢ç­ç¥)\n * ä¸ºä»ä¹ä¼æç¼å­ä¸è´æ§ãç¼å­ç©¿éãç¼å­éªå´©ãç¼å­å»ç©¿ç­å¼å¸¸ï¼è¯¥å¦ä½åºå¯¹ï¼(å¼å¸¸å¤çæºå¶)\n * redis çåå­æ¯ç«æéï¼å¦æç¨å¿«éçåºæç¡¬çæ¥ä¿å­æ°æ®ï¼å¯ä»¥å¢å ç¼å­çæ°æ®éï¼é£ redis ç¼å­å¯ä»¥ä½¿ç¨å¿«éåºæç¡¬çåï¼(æ©å±æºå¶)\n\nä¸é¢ä»ç»ç¬¬ä¸ä¸ªé®é¢ã\n\n\n# 3. ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´é®é¢ï¼\n\nredis ç¨ä½ç¼å­ç»å¸¸æä¸äºå¼å¸¸é®é¢ï¼æ¦æ¬æ¥è¯´æ 4 ä¸ªæ¹é¢ï¼ç¼å­ä¸­çæ°æ®åæ°æ®åºä¸­çä¸ä¸è´ï¼ç¼å­éªå´©ï¼ç¼å­å»ç©¿åç¼å­ç©¿éãè¿ä¸èåçä¸ä¸ç¬¬ä¸ä¸ªé®é¢ã\n\n\n# 3.1 ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´æ¯å¦ä½åççï¼\n\nè¿éçæ°æ®çä¸è´æ§å¶å®åå«ä¸¤ç§æåµï¼\n\n * ç¼å­ä¸­ææ°æ®ï¼ä¸ä¸æ°æ®åºä¸­çç¸å\n * ç¼å­ä¸­æ¬èº«æ²¡ææ°æ®ï¼ä¸æ°æ®åºä¸­æ¯ææ°ç\n\nä¸ç¬¦åè¿ä¸¤ç§æåµçï¼å°±å±äºç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´é®é¢äºãå½ç¼å­çè¯»åæ¨¡å¼ä¸åæ¶ï¼æä»¬çåºå¯¹æ¹æ³ä¹ä¸ä¸æ ·ã\n\nå¯¹äºè¯»åç¼å­æ¥è¯´ï¼æ°æ®ç crud è¦å¨ç¼å­ä¸­è¿è¡ï¼åæ¶å¯¹åæ°æ®åºè¿è¡ååï¼\n\n * è¥æ³è¦ä¿è¯ç¼å­ä¸æ°æ®åºçæ°æ®ä¸è´ï¼å°±è¦ä½¿ç¨äºå¡æºå¶æ¥ä½¿ç¨åæ­¥ç´åç­ç¥æ¥ä¸åæ´æ°ç¼å­åæ°æ®åºï¼ä¿è¯è¿ä¿©çæ´æ°æåå­æ§ã\n * è¥å¯¹ä¸è´æ§è¦æ±æ²¡æé£ä¹é«ï¼å°±å¯ä»¥ä½¿ç¨å¼æ­¥ååç­ç¥ã\n\nå¯¹äºåªè¯»ç¼å­æ¥è¯´ï¼å¦æææ°æ®æ°å¢ï¼ä¼ç´æ¥åå¥æ°æ®åºï¼èææ°æ®å æ¹æ¶ï¼å°±éè¦æåªè¯»ç¼å­ä¸­çæ°æ®æ è®°ä¸ºæ æãè¿æ ·ä¸æ¥ï¼åºç¨åç»­åè®¿é®è¿äºå¢å æ¹çæ°æ®æ¶ï¼å ä¸ºç¼å­ä¸­æ²¡æç¸åºçæ°æ®ï¼å°±ä¼åçç¼å­ç¼ºå¤±ãæ­¤æ¶ï¼åºç¨åä»æ°æ®åºä¸­ææ°æ®è¯»å¥ç¼å­ï¼è¿æ ·åç»­åè®¿é®æ°æ®æ¶ï¼å°±è½å¤ç´æ¥ä»ç¼å­ä¸­è¯»åäºãè¿ä¸ªè¿ç¨å¦ä¸å¾æç¤ºï¼\n\nä»å¾ä¸­å¯ä»¥çå°ï¼tomcatä¸è¿è¡çåºç¨ï¼æ è®ºæ¯æ°å¢ï¼insertæä½ï¼ãä¿®æ¹ï¼updateæä½ï¼ãè¿æ¯å é¤ï¼deleteæä½ï¼æ°æ®xï¼é½ä¼ç´æ¥å¨æ°æ®åºä¸­å¢æ¹å ãå½ç¶ï¼å¦æåºç¨æ§è¡çæ¯ä¿®æ¹æå é¤æä½ï¼è¿ä¼å é¤ç¼å­çæ°æ®xã\n\né£è¿ä¸ªè¿ç¨ä¼ä¸ä¼åºç°æ°æ®ä¸ä¸è´çæåµå¢ï¼èèå°æ°å¢æ°æ®åå æ¹æ°æ®çæåµä¸ä¸æ ·ï¼æä»¥æä»¬åå¼æ¥çï¼\n\n# 1ï¼æ°å¢æ°æ®\n\nå¦ææ¯æ°å¢æ°æ®ï¼æ°æ®ä¼ç´æ¥åå°æ°æ®åºä¸­ï¼ä¸ç¨å¯¹ç¼å­åä»»ä½æä½ï¼æ­¤æ¶ï¼ç¼å­ä¸­æ¬èº«å°±æ²¡ææ°å¢æ°æ®ï¼èæ°æ®åºä¸­æ¯ææ°å¼ï¼å æ­¤æ¯ä¸è´çã\n\n# 2ï¼å æ¹æ°æ®\n\næ­¤æ¶å°±è¦éæ©æ¯åæ´æ°åæ°æ®åºçæ°æ®è¿æ¯åå é¤ç¼å­ä¸­çæ°æ®ï¼\n\n * å¦æåå ç¼å­å¼ï¼å¯è½å¯¼è´æ°æ®åºæ´æ°å¤±è´¥ãå¯¼è´è¯·æ±åæ¬¡è®¿é®ç¼å­æ¶ï¼åç°ç¼å­ç¼ºå¤±ï¼åè¯» db æ¶ï¼ä»å¶ä¸­è¯»å°æ§å¼ã\n * å¦æåæ´æ°æ°æ®åºçå¼ï¼å¯è½åºç°ç¼å­å é¤å¤±è´¥ãå¯¼è´åç»­è¯·æ±å åæ¬¡ç¼å­å½ä¸­å¯¼è´è¯»åç¼å­æ§å¼ã\n\nå¯ä»¥çå°ï¼æ è®ºè¿ä¸¤ä¸ªæä½çæ§è¡é¡ºåºè°åè°åï¼åªè¦æä¸ä¸ªæä½å¤±è´¥äºï¼å°±ä¼å¯¼è´å®¢æ·ç«¯è¯»åå°æ§å¼ãå¦ä½è§£å³è¿ä¸ªé®é¢å¢ï¼\n\n\n# 3.2 å¦ä½è§£å³æ°æ®ä¸ä¸è´é®é¢ï¼\n\næ°æ®ä¸ä¸è´åºç°çåå ä¸»è¦åä¸ºä¸¤ç§æåµï¼\n\n * å¯¹ db/ç¼å­ çæä½ï¼ç¬¬äºä¸ªå¤±è´¥äº è§£å³æ¹æ³ï¼\n   * éè¯æºå¶\n   * è®¢é mysql binlogï¼åæä½ç¼å­\n * å¤æçå¹¶ååºæ¯ä¸ï¼å¯¹æ°æ®åºåç¼å­çæä½é½æ¯æåç\n\n# 3.2.1 éè¯æºå¶\n\né¦åä¸ç§æ¹æ³æ¯ï¼éè¯æºå¶ã\n\nå·ä½æ¥è¯´ï¼å¯ä»¥æè¦å é¤çç¼å­å¼æèæ¯è¦æ´æ°çæ°æ®åºå¼æå­å°æ¶æ¯éåä¸­ï¼ä¾å¦ä½¿ç¨kafkaæ¶æ¯éåï¼ãå½åºç¨æ²¡æè½å¤æåå°å é¤ç¼å­å¼æèæ¯æ´æ°æ°æ®åºå¼æ¶ï¼å¯ä»¥ä»æ¶æ¯éåä¸­éæ°è¯»åè¿äºå¼ï¼ç¶ååæ¬¡è¿è¡å é¤ææ´æ°ã\n\nå¦æè½å¤æåå°å é¤ææ´æ°ï¼æä»¬å°±è¦æè¿äºå¼ä»æ¶æ¯éåä¸­å»é¤ï¼ä»¥åéå¤æä½ï¼æ­¤æ¶ï¼æä»¬ä¹å¯ä»¥ä¿è¯æ°æ®åºåç¼å­çæ°æ®ä¸è´äºãå¦åçè¯ï¼æä»¬è¿éè¦åæ¬¡è¿è¡éè¯ãå¦æéè¯è¶è¿çä¸å®æ¬¡æ°ï¼è¿æ¯æ²¡ææåï¼æä»¬å°±éè¦åä¸å¡å±åéæ¥éä¿¡æ¯äºã\n\nå¾æ¾ç¤ºäºåæ´æ°æ°æ®åºï¼åå é¤ç¼å­å¼æ¶ï¼å¦æç¼å­å é¤å¤±è´¥ï¼åæ¬¡éè¯åå é¤æåçæåµï¼\n\n# 3.2.2 è®¢é mysql binlogï¼åæä½ç¼å­\n\nãåæ´æ°æ°æ®åºï¼åå ç¼å­ãçç­ç¥çç¬¬ä¸æ­¥æ¯æ´æ°æ°æ®åºï¼é£ä¹æ´æ°æ°æ®åºæåï¼å°±ä¼äº§çä¸æ¡åæ´æ¥å¿ï¼è®°å½å¨ binlog éãäºæ¯æä»¬å°±å¯ä»¥éè¿è®¢é binlog æ¥å¿ï¼æ¿å°å·ä½è¦æä½çæ°æ®ï¼ç¶ååæ§è¡ç¼å­å é¤ï¼é¿éå·´å·´å¼æºç canal ä¸­é´ä»¶å°±æ¯åºäºè¿ä¸ªå®ç°çã\n\ncanal æ¨¡æ mysql ä¸»ä»å¤å¶çäº¤äºåè®®ï¼æèªå·±ä¼ªè£æä¸ä¸ª mysql çä»èç¹ï¼å mysql ä¸»èç¹åé dump è¯·æ±ï¼mysql æ¶å°è¯·æ±åï¼å°±ä¼å¼å§æ¨é binlog ç» canalï¼canal è§£æ binlog å­èæµä¹åï¼è½¬æ¢ä¸ºä¾¿äºè¯»åçç»æåæ°æ®ï¼ä¾ä¸æ¸¸ç¨åºè®¢éä½¿ç¨ã\n\nä¸å¾æ¯ canal çå·¥ä½åçï¼\n\næä»¥ï¼å¦æè¦æ³ä¿è¯ãåæ´æ°æ°æ®åºï¼åå ç¼å­ãç­ç¥ç¬¬äºä¸ªæä½è½æ§è¡æåï¼æä»¬å¯ä»¥ä½¿ç¨ãæ¶æ¯éåæ¥éè¯ç¼å­çå é¤ãï¼æèãè®¢é mysql binlog åæä½ç¼å­ãï¼è¿ä¸¤ç§æ¹æ³æä¸ä¸ªå±åçç¹ç¹ï¼é½æ¯éç¨å¼æ­¥æä½ç¼å­ã\n\n# 3.2.3 å»¶è¿åå \n\nååè¯´çæ¯å¨æ´æ°æ°æ®åºåå é¤ç¼å­å¼çè¿ç¨ä¸­ï¼å¶ä¸­ä¸ä¸ªæä½å¤±è´¥çæåµï¼å®éä¸ï¼å³ä½¿è¿ä¸¤ä¸ªæä½ç¬¬ä¸æ¬¡æ§è¡æ¶é½æ²¡æå¤±è´¥ï¼å½æå¤§éå¹¶åè¯·æ±æ¶ï¼åºç¨è¿æ¯æå¯è½è¯»å°ä¸ä¸è´çæ°æ®ã\n\nåæ ·ï¼æä»¬æç§ä¸åçå é¤åæ´æ°é¡ºåºï¼åæä¸¤ç§æåµæ¥çãå¨è¿ä¸¤ç§æåµä¸ï¼æä»¬çè§£å³æ¹æ³ä¹ææä¸åã\n\næåµä¸ï¼åå é¤ç¼å­ï¼åæ´æ°æ°æ®åºï¼\n\nåè®¾çº¿ç¨aå é¤ç¼å­å¼åï¼è¿æ²¡ææ¥å¾åæ´æ°æ°æ®åºï¼æ¯å¦è¯´æç½ç»å»¶è¿ï¼ï¼çº¿ç¨bå°±å¼å§è¯»åæ°æ®äºï¼é£ä¹è¿ä¸ªæ¶åï¼çº¿ç¨bä¼åç°ç¼å­ç¼ºå¤±ï¼å°±åªè½å»æ°æ®åºè¯»åãè¿ä¼å¸¦æ¥ä¸¤ä¸ªé®é¢ï¼\n\n 1. çº¿ç¨bè¯»åå°äºæ§å¼ï¼\n 2. çº¿ç¨bæ¯å¨ç¼å­ç¼ºå¤±çæåµä¸è¯»åçæ°æ®åºï¼æä»¥ï¼å®è¿ä¼ææ§å¼åå¥ç¼å­ï¼è¿å¯è½ä¼å¯¼è´å¶ä»çº¿ç¨ä»ç¼å­ä¸­è¯»å°æ§å¼ã\n\nç­å°çº¿ç¨bä»æ°æ®åºè¯»åå®æ°æ®ãæ´æ°äºç¼å­åï¼çº¿ç¨aæå¼å§æ´æ°æ°æ®åºï¼æ­¤æ¶ï¼ç¼å­ä¸­çæ°æ®æ¯æ§å¼ï¼èæ°æ®åºä¸­çæ¯ææ°å¼ï¼ä¸¤èå°±ä¸ä¸è´äºãè¿ç§æåµç¨è¡¨æ ¼å±ç¤ºå¦ä¸ï¼\n\nè¿è¯¥æä¹åï¼ä¸ç§è§£å³æ¹æ¡æ¯ï¼å¨çº¿ç¨aæ´æ°å®æ°æ®åºå¼ä»¥åï¼æä»¬å¯ä»¥è®©å®åsleepä¸å°æ®µæ¶é´ï¼åè¿è¡ä¸æ¬¡ç¼å­å é¤æä½ã\n\nä¹æä»¥è¦å ä¸sleepçè¿æ®µæ¶é´ï¼å°±æ¯ä¸ºäºè®©çº¿ç¨bè½å¤åä»æ°æ®åºè¯»åæ°æ®ï¼åæç¼ºå¤±çæ°æ®åå¥ç¼å­ï¼ç¶åï¼çº¿ç¨aåè¿è¡å é¤ãæä»¥ï¼çº¿ç¨a sleepçæ¶é´ï¼å°±éè¦å¤§äºçº¿ç¨bè¯»åæ°æ®ååå¥ç¼å­çæ¶é´ãè¿ä¸ªæ¶é´æä¹ç¡®å®å¢ï¼å»ºè®®ä½ å¨ä¸å¡ç¨åºè¿è¡çæ¶åï¼ç»è®¡ä¸çº¿ç¨è¯»æ°æ®ååç¼å­çæä½æ¶é´ï¼ä»¥æ­¤ä¸ºåºç¡æ¥è¿è¡ä¼°ç®ã\n\nè¿æ ·ä¸æ¥ï¼å¶å®çº¿ç¨è¯»åæ°æ®æ¶ï¼ä¼åç°ç¼å­ç¼ºå¤±ï¼æä»¥ä¼ä»æ°æ®åºä¸­è¯»åææ°å¼ãå ä¸ºè¿ä¸ªæ¹æ¡ä¼å¨ç¬¬ä¸æ¬¡å é¤ç¼å­å¼åï¼å»¶è¿ä¸æ®µæ¶é´åæ¬¡è¿è¡å é¤ï¼æä»¥æä»¬ä¹æå®å«åå»¶è¿åå ãä¸é¢æ¯å»¶è¿åå çä¼ªä»£ç ï¼\n\nredis.delkey(x)\ndb.update(x)\nthread.sleep(n)\nredis.delkey(x)\n\n\n1\n2\n3\n4\n\n\næåµäºï¼åæ´æ°æ°æ®åºå¼ï¼åå é¤ç¼å­å¼ï¼\n\nå¦æçº¿ç¨aå é¤äºæ°æ®åºä¸­çå¼ï¼ä½è¿æ²¡æ¥å¾åå é¤ç¼å­å¼ï¼çº¿ç¨bå°±å¼å§è¯»åæ°æ®äºï¼é£ä¹æ­¤æ¶ï¼çº¿ç¨bæ¥è¯¢ç¼å­æ¶ï¼åç°ç¼å­å½ä¸­ï¼å°±ä¼ç´æ¥ä»ç¼å­ä¸­è¯»åæ§å¼ãä¸è¿ï¼å¨è¿ç§æåµä¸ï¼å¦æå¶ä»çº¿ç¨å¹¶åè¯»ç¼å­çè¯·æ±ä¸å¤ï¼é£ä¹ï¼å°±ä¸ä¼æå¾å¤è¯·æ±è¯»åå°æ§å¼ãèä¸ï¼çº¿ç¨aä¸è¬ä¹ä¼å¾å¿«å é¤ç¼å­å¼ï¼è¿æ ·ä¸æ¥ï¼å¶ä»çº¿ç¨åæ¬¡è¯»åæ¶ï¼å°±ä¼åçç¼å­ç¼ºå¤±ï¼è¿èä»æ°æ®åºä¸­è¯»åææ°å¼ãæä»¥ï¼è¿ç§æåµå¯¹ä¸å¡çå½±åè¾å°ã\n\nè¿ç§æåµç¨è¡¨æ ¼å±ç¤ºä¸ºï¼\n\n----------------------------------------\n\nå°è¿éæä»¬å¯ä»¥ç¥éï¼ç¼å­åæ°æ®åºçæ°æ®ä¸ä¸è´ä¸è¬æ¯ç±ä¸¤ä¸ªåå å¯¼è´çï¼æ¬èå¹¶æä¾äºç¸åºçè§£å³æ¹æ¡ï¼\n\n * å é¤ç¼å­å¼ææ´æ°æ°æ®åºå¤±è´¥èå¯¼è´æ°æ®ä¸ä¸è´ï¼ä½ å¯ä»¥ä½¿ç¨éè¯æºå¶ç¡®ä¿å é¤ææ´æ°æä½æåã\n * å¨å é¤ç¼å­å¼ãæ´æ°æ°æ®åºçè¿ä¸¤æ­¥æä½ä¸­ï¼æå¶ä»çº¿ç¨çå¹¶åè¯»æä½ï¼å¯¼è´å¶ä»çº¿ç¨è¯»åå°æ§å¼ï¼åºå¯¹æ¹æ¡æ¯å»¶è¿åå ã\n\n\n# 3.3 å°ç»\n\nè¿ä¸å¤§èè®²äºç¼å­ä¸ä¸è´çé®é¢ï¼å¯ä»¥åæè¯»åç¼å­ååªè¯»ç¼å­ä¸¤ç§æåµåæã\n\n * å¯¹äºè¯»åç¼å­ï¼åæ­¥ååç­ç¥å°±å¯ä»¥ä¿è¯ç¼å­åæ°æ®åºä¸­çæ°æ®ä¸è´ã\n * å¯¹äºåªè¯»ç¼å­ï¼å¯ä»¥æ»ç»ä¸ºä¸é¢è¿å¼ è¡¨ï¼\n\nå¤§å¤æ°ä¸å¡ä¸­ï¼æä»¬æ¯æ redis å½ååªè¯»ç¼å­æ¥ä½¿ç¨ï¼å¹¶å»ºè®®ä¼åä½¿ç¨åæ´æ°æ°æ®åºåå é¤ç¼å­çæ¹æ³(cache aside)ï¼åå ä¸»è¦æä¸¤ä¸ªï¼\n\n 1. åå é¤ç¼å­å¼åæ´æ°æ°æ®åºï¼æå¯è½å¯¼è´è¯·æ±å ç¼å­ç¼ºå¤±èè®¿é®æ°æ®åºï¼ç»æ°æ®åºå¸¦æ¥ååï¼\n 2. å¦æä¸å¡åºç¨ä¸­è¯»åæ°æ®åºååç¼å­çæ¶é´ä¸å¥½ä¼°ç®ï¼é£ä¹ï¼å»¶è¿åå ä¸­çç­å¾æ¶é´å°±ä¸å¥½è®¾ç½®ã\n\nä¸è¿ï¼å½ä½¿ç¨åæ´æ°æ°æ®åºåå é¤ç¼å­æ¶ï¼ä¹æä¸ªå°æ¹éè¦æ³¨æï¼å¦æä¸å¡å±è¦æ±å¿é¡»è¯»åä¸è´çæ°æ®ï¼é£ä¹ï¼æä»¬å°±éè¦å¨æ´æ°æ°æ®åºæ¶ï¼åå¨redisç¼å­å®¢æ·ç«¯æå­å¹¶åè¯»è¯·æ±ï¼ç­æ°æ®åºæ´æ°å®ãç¼å­å¼å é¤åï¼åè¯»åæ°æ®ï¼ä»èä¿è¯æ°æ®ä¸è´æ§ã\n\n----------------------------------------\n\ncatch aside å¯ä»¥è¢«ç§°ä¹ä¸ºç¼å­ä½¿ç¨çæä½³å®è·µï¼ä½ä¸æ­¤åæ¶ï¼å®å¼å¥äºç¼å­çå½ä¸­çéä½çé®é¢ï¼ï¼æ¯æ¬¡é½å é¤ç¼å­èªç¶å¯¼è´æ´ä¸å®¹æå½ä¸­äºï¼ï¼å æ­¤å®æ´éç¨äºå¯¹ç¼å­å½ä¸­çè¦æ±å¹¶ä¸æ¯ç¹å«é«çåºæ¯ãå¦æè¦æ±è¾é«çç¼å­å½ä¸­çï¼ä¾ç¶éè¦éç¨æ´æ°æ°æ®åºååæ¶æ´æ°ç¼å­çæ¹æ¡ã\n\nä½æ¯æ´æ°æ°æ®åºååæ¶æ´æ°ç¼å­çæ¹æ¡ä¼å¨å¹¶ååºæ¯ä¸åºç°æ°æ®ä¸ä¸è´ï¼è§£å³æ¹æ¡æä¸¤ç§ï¼\n\n * å¼å¥åå¸å¼é å¨æ´æ°ç¼å­ä¹åå°è¯è·åéï¼å¦æå·²ç»è¢«å ç¨å°±åé»å¡ä½çº¿ç¨ï¼ç­å¾å¶ä»çº¿ç¨éæ¾éååå°è¯æ´æ°ãä½è¿ä¼å½±åå¹¶åæä½çæ§è½ã\n * è®¾ç½®è¾ç­ç¼å­æ¶é´ è®¾ç½®è¾ç­çç¼å­è¿ææ¶é´è½å¤ä½¿å¾æ°æ®ä¸ä¸è´é®é¢å­å¨çæ¶é´ä¹æ¯è¾é¿ï¼å¯¹ä¸å¡çå½±åç¸å¯¹è¾å°ãä½æ¯ä¸æ­¤åæ¶ï¼å¶å®è¿ä¹ä½¿å¾ç¼å­å½ä¸­çéä½ï¼ååå°äºåé¢çé®é¢é...\n\n\n# 4. ç¼å­å¼å¸¸ï¼ä¸ï¼ï¼å¦ä½è§£å³ç¼å­éªå´©ãå»ç©¿ãç©¿éé¾é¢ï¼\n\né¤äºç¼å­ä¸ä¸è´ï¼è¿æä¸ç§å¯è½çç¼å­å¼å¸¸ï¼ç¼å­éªå´©ãç¼å­å»ç©¿åç¼å­ç©¿éãè¿ä¸ä¸ªé®é¢ä¸æ¦åçï¼ä¼å¯¼è´å¤§éçè¯·æ±ç§¯åå°æ°æ®åºå±ï¼ä»èå¯¼è´æ°æ®åºå®æºæèæéã\n\n\n# 4.1 ç¼å­éªå´©\n\nç¼å­éªå´©ï¼æå¤§éçåºç¨è¯·æ±æ æ³å¨ redis ç¼å­ä¸­è¿è¡å¤çï¼ç´§æ¥çåºç¨å°å¤§éè¯·æ±åéå°æ°æ®åºå±ï¼å¯¼è´æ°æ®åºå±çååæ¿å¢ã\n\nç¼å­éªå´©ä¸è¬æ¯ç±ä¸¤ä¸ªåå å¯¼è´çï¼åºå¯¹æ¹æ¡ä¹ææä¸åï¼æä»¬ä¸ä¸ªä¸ªæ¥çã\n\n# 4.1.1 åå ä¸ï¼å¤§éæ°æ®åæ¶è¿æ\n\nç¼å­éªå´©çç¬¬ä¸ç§åå ï¼ç¼å­ä¸­æå¤§éæ°æ®åæ¶è¿æï¼å¯¼è´å¤§éè¯·æ±æ æ³å¾å°å¤çã\n\nå·ä½æ¥è¯´ï¼å½æ°æ®ä¿å­å¨ç¼å­ä¸­ï¼å¹¶ä¸è®¾ç½®äºè¿ææ¶é´æ¶ï¼å¦æå¨æä¸ä¸ªæ¶å»ï¼å¤§éæ°æ®åæ¶è¿æï¼æ­¤æ¶ï¼åºç¨åè®¿é®è¿äºæ°æ®çè¯ï¼å°±ä¼åçç¼å­ç¼ºå¤±ãç´§æ¥çï¼åºç¨å°±ä¼æè¯·æ±åéç»æ°æ®åºï¼ä»æ°æ®åºä¸­è¯»åæ°æ®ãå¦æåºç¨çå¹¶åè¯·æ±éå¾å¤§ï¼é£ä¹æ°æ®åºçååä¹å°±å¾å¤§ï¼è¿ä¼è¿ä¸æ­¥å½±åå°æ°æ®åºçå¶ä»æ­£å¸¸ä¸å¡è¯·æ±å¤çãæä»¬æ¥çä¸ä¸ªç®åçä¾å­ï¼å¦ä¸å¾æç¤ºï¼\n\néå¯¹å¤§éæ°æ®åæ¶å¤±æå¸¦æ¥çç¼å­éªå´©é®é¢ï¼æä¸¤ç§è§£å³æ¹æ¡ï¼\n\n 1. å¾®è°è¿ææ¶é´ï¼ä¸å¡é¿åç»å¤§éçæ°æ®è®¾ç½®ç¸åçè¿ææ¶é´ãå¦æä¸å¡å±çç¡®è¦æ±æäºæ°æ®åæ¶å¤±æï¼ä½ å¯ä»¥å¨ç¨ expire å½ä»¤ç»æ¯ä¸ªæ°æ®è®¾ç½®è¿ææ¶é´æ¶ï¼ç»è¿äºæ°æ®çè¿ææ¶é´å¢å ä¸ä¸ªè¾å°çéæºæ°ãè¿æ ·ä¸æ¥ï¼ä¸åæ°æ®çè¿ææ¶é´å·®å«ä¸ä¼å¤ªå¤§ï¼æ¢é¿åäºå¤§éæ°æ®åæ¶è¿æï¼åæ¶ä¹ä¿è¯äºè¿äºæ°æ®åºæ¬å¨ç¸è¿çæ¶é´å¤±æï¼ä»ç¶è½æ»¡è¶³ä¸å¡éæ±ã\n 2. æå¡éçº§ï¼æåçç¼å­éªå´©æ¶ï¼éå¯¹ä¸åçæ°æ®éåä¸åçå¤çæ¹å¼ï¼\n    * å½ä¸å¡åºç¨è®¿é®çæ¯éæ ¸å¿æ°æ®ï¼ä¾å¦çµåååå±æ§ï¼æ¶ï¼ææ¶åæ­¢ä»ç¼å­ä¸­æ¥è¯¢è¿äºæ°æ®ï¼èæ¯ç´æ¥è¿åé¢å®ä¹ä¿¡æ¯ãç©ºå¼ææ¯éè¯¯ä¿¡æ¯ï¼\n    * å½ä¸å¡åºç¨è®¿é®çæ¯æ ¸å¿æ°æ®ï¼ä¾å¦çµååååºå­ï¼æ¶ï¼ä»ç¶åè®¸æ¥è¯¢ç¼å­ï¼å¦æç¼å­ç¼ºå¤±ï¼ä¹å¯ä»¥ç»§ç»­éè¿æ°æ®åºè¯»åã\n\n# 4.1.2 åå äºï¼redis ç¼å­å®ä¾åçå®æº\n\nç¼å­éªå´©çç¬¬äºç§åå ï¼redis ç¼å­å®ä¾åçæéå®æºäºï¼æ æ³å¤çè¯·æ±ï¼è¿å°±ä¼å¯¼è´å¤§éè¯·æ±ä¸ä¸å­ç§¯åå°æ°æ®åºå±ï¼ä»èåçç¼å­éªå´©ã\n\nä¸è¬æ¥è¯´ï¼ä¸ä¸ª redis å®ä¾å¯ä»¥æ¯ææ°ä¸çº§å«çè¯·æ±å¤çååéï¼èåä¸ªæ°æ®åºå¯è½åªè½æ¯ææ°åçº§å«çè¯·æ±å¤çååéï¼å®ä»¬ä¸¤ä¸ªçå¤çè½åå¯è½ç¸å·®äºè¿ååãç±äºç¼å­éªå´©ï¼redis ç¼å­å¤±æï¼æä»¥ï¼æ°æ®åºå°±å¯è½è¦æ¿åè¿ååçè¯·æ±ååï¼ä»èå ä¸ºååè¿å¤§èå´©æºã\n\nè¿ç§æåµä¸ç±äº redis å®ä¾åçäºå®æºï¼æä»¬éè¦éè¿å¶ä»æ¹æ³æ¥åºå¯¹ç¼å­éªå´©äºãæç»ä½ æä¾ä¸¤ä¸ªå»ºè®®ï¼\n\nç¬¬ä¸ä¸ªå»ºè®®ï¼å¨ä¸å¡ç³»ç»ä¸­å®ç°æå¡çæ­æè¯·æ±éæµæºå¶ã\n\næè°çæå¡çæ­ï¼æ¯æå¨åçç¼å­éªå´©æ¶ï¼ä¸ºäºé²æ­¢å¼åè¿éçæ°æ®åºéªå´©ï¼çè³æ¯æ´ä¸ªç³»ç»çå´©æºï¼æä»¬æåä¸å¡åºç¨å¯¹ç¼å­ç³»ç»çæ¥å£è®¿é®ï¼èæ¯ç´æ¥è¿åï¼ç­å°redisç¼å­å®ä¾éæ°æ¢å¤æå¡åï¼ååè®¸åºç¨è¯·æ±åéå°ç¼å­ç³»ç»ãè¿æ ·é¿åäºå¤§éè¯·æ±å ç¼å­ç¼ºå¤±èç§¯åå°æ°æ®åºç³»ç»ã\n\nå¨ä¸å¡ç³»ç»è¿è¡æ¶ï¼æä»¬å¯ä»¥çæµ redis æå¨æºå¨åæ°æ®åºæå¨æºå¨çè´è½½ææ ï¼ä¾å¦æ¯ç§è¯·æ±æ°ãcpuå©ç¨çãåå­å©ç¨çç­ãå¦ææä»¬åç° redis å®ä¾å®æºäºï¼èæ°æ®åºæå¨æºå¨çè´è½½ååçªç¶å¢å ï¼æ­¤æ¶å°±åçç¼å­éªå´©äºãå¤§éè¯·æ±è¢«åéå°æ°æ®åºè¿è¡å¤çãæä»¬å¯ä»¥å¯å¨æå¡çæ­æºå¶ï¼æåä¸å¡åºç¨å¯¹ç¼å­æå¡çè®¿é®ï¼ä»èéä½å¯¹æ°æ®åºçè®¿é®ååï¼å¦ä¸å¾æç¤ºï¼\n\næå¡çæ­è½ç¶å¯ä»¥ä¿è¯æ°æ®åºçæ­£å¸¸è¿è¡ï¼ä½æ¯æåäºæ´ä¸ªç¼å­ç³»ç»çè®¿é®ï¼å¯¹ä¸å¡åºç¨çå½±åèå´å¤§ãä¸ºäºå°½å¯è½åå°è¿ç§å½±åï¼æä»¬ä¹å¯ä»¥è¿è¡è¯·æ±éæµï¼ææä»¬å¨ä¸å¡ç³»ç»çè¯·æ±å¥å£åç«¯æ§å¶æ¯ç§è¿å¥ç³»ç»çè¯·æ±æ°ï¼é¿åè¿å¤çè¯·æ±è¢«åéå°æ°æ®åºã\n\nä¸¾ä¸ªä¾å­ãåè®¾ä¸å¡ç³»ç»æ­£å¸¸è¿è¡æ¶ï¼è¯·æ±å¥å£åç«¯åè®¸æ¯ç§è¿å¥ç³»ç»çè¯·æ±æ¯1ä¸ä¸ªï¼å¶ä¸­ï¼9000ä¸ªè¯·æ±é½è½å¨ç¼å­ç³»ç»ä¸­è¿è¡å¤çï¼åªæ1000ä¸ªè¯·æ±ä¼è¢«åºç¨åéå°æ°æ®åºè¿è¡å¤çãä¸æ¦åçäºç¼å­éªå´©ï¼æ°æ®åºçæ¯ç§è¯·æ±æ°çªç¶å¢å å°æ¯ç§1ä¸ä¸ªï¼æ­¤æ¶ï¼æä»¬å°±å¯ä»¥å¯å¨è¯·æ±éæµæºå¶ï¼å¨è¯·æ±å¥å£åç«¯åªåè®¸æ¯ç§è¿å¥ç³»ç»çè¯·æ±æ°ä¸º1000ä¸ªï¼åå¤çè¯·æ±å°±ä¼å¨å¥å£åç«¯è¢«ç´æ¥æç»æå¡ãæä»¥ï¼ä½¿ç¨äºè¯·æ±éæµï¼å°±å¯ä»¥é¿åå¤§éå¹¶åè¯·æ±ååä¼ éå°æ°æ®åºå±ã\n\nä½¿ç¨æå¡çæ­ææ¯è¯·æ±éæµæºå¶ï¼æ¥åºå¯¹rediså®ä¾å®æºå¯¼è´çç¼å­éªå´©é®é¢ï¼æ¯å±äºâäºåè¯¸èäº®âï¼ä¹å°±æ¯å·²ç»åçç¼å­éªå´©äºï¼æä»¬ä½¿ç¨è¿ä¸¤ä¸ªæºå¶ï¼æ¥éä½éªå´©å¯¹æ°æ®åºåæ´ä¸ªä¸å¡ç³»ç»çå½±åã\n\nç¬¬äºä¸ªå»ºè®®ï¼äºåé¢é²ï¼æå»º redis éç¾¤ã\n\néè¿ä¸»ä»èç¹çæ¹å¼æå»º redis ç¼å­é«å¯é éç¾¤ãå¦æ redis ç¼å­çä¸»èç¹æéå®æºäºï¼ä»èç¹è¿å¯ä»¥åæ¢æä¸ºä¸»èç¹ï¼ç»§ç»­æä¾ç¼å­æå¡ï¼é¿åäºç±äºç¼å­å®ä¾å®æºèå¯¼è´çç¼å­éªå´©é®é¢ã\n\nç¼å­éªå´©æ¯åçå¨å¤§éæ°æ®åæ¶å¤±æçåºæ¯ä¸ï¼èæ¥ä¸æ¥æè¦åä½ ä»ç»çç¼å­å»ç©¿ï¼æ¯åçå¨æä¸ªç­ç¹æ°æ®å¤±æçåºæ¯ä¸ãåç¼å­éªå´©ç¸æ¯ï¼ç¼å­å»ç©¿å¤±æçæ°æ®æ°éè¦å°å¾å¤ï¼åºå¯¹æ¹æ³ä¹ä¸ä¸æ ·ï¼æä»¬æ¥çä¸ã\n\n\n# 4.2 ç¼å­å»ç©¿\n\nç¼å­å»ç©¿æ¯æï¼éå¯¹æä¸ªè®¿é®éå¸¸é¢ç¹çç­ç¹æ°æ®çè¯·æ±ï¼æ æ³å¨ç¼å­ä¸­è¿è¡å¤çï¼ç´§æ¥çï¼è®¿é®è¯¥æ°æ®çå¤§éè¯·æ±ï¼ä¸ä¸å­é½åéå°äºåç«¯æ°æ®åºï¼å¯¼è´äºæ°æ®åºååæ¿å¢ï¼ä¼å½±åæ°æ®åºå¤çå¶ä»è¯·æ±ãç¼å­å»ç©¿çæåµï¼ç»å¸¸åçå¨ç­ç¹æ°æ®è¿æå¤±ææ¶ï¼å¦ä¸å¾æç¤ºï¼\n\nä¸ºäºé¿åç¼å­å»ç©¿ç»æ°æ®åºå¸¦æ¥çæ¿å¢ååï¼æä»¬çè§£å³æ¹æ³ä¹æ¯è¾ç´æ¥ï¼å¯¹äºè®¿é®ç¹å«é¢ç¹çç­ç¹æ°æ®ï¼æä»¬å°±ä¸è®¾ç½®è¿ææ¶é´äºãè¿æ ·ä¸æ¥ï¼å¯¹ç­ç¹æ°æ®çè®¿é®è¯·æ±ï¼é½å¯ä»¥å¨ç¼å­ä¸­è¿è¡å¤çï¼è redis æ°ä¸çº§å«çé«ååéå¯ä»¥å¾å¥½å°åºå¯¹å¤§éçå¹¶åè¯·æ±è®¿é®ã\n\nä»¥ä¸ï¼ç¼å­éªå´©åç¼å­å»ç©¿é®é¢ï¼é½æ¯å¨ db ä¸­ä¿å­äºåºç¨è¦è®¿é®çæ°æ®çæåµãä¸é¢è¦ççç¼å­ç©¿éæ¯æ°æ®ä¹ä¸å¨ db ä¸­çæåµã\n\n\n# 4.3 ç¼å­ç©¿é\n\nç¼å­ç©¿éæè¦è®¿é®çæ°æ®æ¢ä¸å¨ redis ç¼å­ä¸­ï¼ä¹ä¸å¨æ°æ®åºä¸­ï¼å¯¼è´è¯·æ±å¨è®¿é®ç¼å­æ¶ï¼åçç¼å­ç¼ºå¤±ï¼åå»è®¿é®æ°æ®åºæ¶ï¼åç°æ°æ®åºä¸­ä¹æ²¡æè¦è®¿é®çæ°æ®ãæ­¤æ¶ï¼åºç¨ä¹æ æ³ä»æ°æ®åºä¸­è¯»åæ°æ®ååå¥ç¼å­ï¼æ¥æå¡åç»­è¯·æ±ï¼è¿æ ·ä¸æ¥ï¼ç¼å­ä¹å°±æäºâæè®¾âï¼å¦æåºç¨æç»­æå¤§éè¯·æ±è®¿é®æ°æ®ï¼å°±ä¼åæ¶ç»ç¼å­åæ°æ®åºå¸¦æ¥å·¨å¤§ååï¼å¦ä¸å¾æç¤ºï¼\n\né£ä¹ï¼ç¼å­ç©¿éä¼åçå¨ä»ä¹æ¶åå¢ï¼ä¸è¬æ¥è¯´ï¼æä¸¤ç§æåµï¼\n\n * ä¸å¡å±è¯¯æä½ï¼ç¼å­ä¸­çæ°æ®åæ°æ®åºä¸­çæ°æ®è¢«è¯¯å é¤äºï¼æä»¥ç¼å­åæ°æ®åºä¸­é½æ²¡ææ°æ®ï¼\n * æ¶ææ»å»ï¼ä¸é¨è®¿é®æ°æ®åºä¸­æ²¡æçæ°æ®ã\n\nä¸ºäºé¿åç¼å­ç©¿éçå½±åï¼ææ¥ç»ä½ æä¾ä¸ç§åºå¯¹æ¹æ¡ã\n\n# 1ï¼æ¹æ¡ 1ï¼ç¼å­ç©ºå¼æç¼ºçå¼\n\nä¸æ¦åçç¼å­ç©¿éï¼æä»¬å°±å¯ä»¥éå¯¹æ¥è¯¢çæ°æ®ï¼å¨redisä¸­ç¼å­ä¸ä¸ªç©ºå¼ææ¯åä¸å¡å±ååç¡®å®çç¼ºçå¼ï¼ä¾å¦ï¼åºå­çç¼ºçå¼å¯ä»¥è®¾ä¸º0ï¼ãç´§æ¥çï¼åºç¨åéçåç»­è¯·æ±åè¿è¡æ¥è¯¢æ¶ï¼å°±å¯ä»¥ç´æ¥ä»redisä¸­è¯»åç©ºå¼æç¼ºçå¼ï¼è¿åç»ä¸å¡åºç¨äºï¼é¿åäºæå¤§éè¯·æ±åéç»æ°æ®åºå¤çï¼ä¿æäºæ°æ®åºçæ­£å¸¸è¿è¡ã\n\n# 2ï¼æ¹æ¡ 2ï¼ä½¿ç¨å¸éè¿æ»¤å¨å¿«éå¤æ­æ°æ®æ¯å¦å­å¨ï¼é¿åä»æ°æ®åºä¸­æ¥è¯¢æ°æ®æ¯å¦å­å¨ï¼åè½»æ°æ®åºåå\n\nå¸éè¿æ»¤å¨ç±ä¸ä¸ªåå¼é½ä¸º0çbitæ°ç»ånä¸ªåå¸å½æ°ç»æï¼å¯ä»¥ç¨æ¥å¿«éå¤æ­æä¸ªæ°æ®æ¯å¦å­å¨ãå½æä»¬æ³æ è®°æä¸ªæ°æ®å­å¨æ¶ï¼ä¾å¦ï¼æ°æ®å·²è¢«åå¥æ°æ®åºï¼ï¼å¸éè¿æ»¤å¨ä¼éè¿ä¸ä¸ªæä½å®ææ è®°ï¼\n\n * é¦åï¼ä½¿ç¨nä¸ªåå¸å½æ°ï¼åå«è®¡ç®è¿ä¸ªæ°æ®çåå¸å¼ï¼å¾å°nä¸ªåå¸å¼ã\n * ç¶åï¼æä»¬æè¿nä¸ªåå¸å¼å¯¹bitæ°ç»çé¿åº¦åæ¨¡ï¼å¾å°æ¯ä¸ªåå¸å¼å¨æ°ç»ä¸­çå¯¹åºä½ç½®ã\n * æåï¼æä»¬æå¯¹åºä½ç½®çbitä½è®¾ç½®ä¸º1ï¼è¿å°±å®æäºå¨å¸éè¿æ»¤å¨ä¸­æ è®°æ°æ®çæä½ã\n\nå¦ææ°æ®ä¸å­å¨ï¼ä¾å¦ï¼æ°æ®åºéæ²¡æåå¥æ°æ®ï¼ï¼æä»¬ä¹å°±æ²¡æç¨å¸éè¿æ»¤å¨æ è®°è¿æ°æ®ï¼é£ä¹ï¼bitæ°ç»å¯¹åºbitä½çå¼ä»ç¶ä¸º0ã\n\nå½éè¦æ¥è¯¢æä¸ªæ°æ®æ¶ï¼æä»¬å°±æ§è¡ååè¯´çè®¡ç®è¿ç¨ï¼åå¾å°è¿ä¸ªæ°æ®å¨bitæ°ç»ä¸­å¯¹åºçnä¸ªä½ç½®ãç´§æ¥çï¼æä»¬æ¥çbitæ°ç»ä¸­è¿nä¸ªä½ç½®ä¸çbitå¼ãåªè¦è¿nä¸ªbitå¼æä¸ä¸ªä¸ä¸º1ï¼è¿å°±è¡¨æå¸éè¿æ»¤å¨æ²¡æå¯¹è¯¥æ°æ®åè¿æ è®°ï¼æä»¥ï¼æ¥è¯¢çæ°æ®ä¸å®æ²¡æå¨æ°æ®åºä¸­ä¿å­ãè¿ä¸ªè¿ç¨å¦ä¸å¾ï¼\n\nå¾ä¸­å¸éè¿æ»¤å¨æ¯ä¸ä¸ªåå«10ä¸ªbitä½çæ°ç»ï¼ä½¿ç¨äº3ä¸ªåå¸å½æ°ï¼å½å¨å¸éè¿æ»¤å¨ä¸­æ è®°æ°æ®xæ¶ï¼xä¼è¢«è®¡ç®3æ¬¡åå¸å¼ï¼å¹¶å¯¹10åæ¨¡ï¼åæ¨¡ç»æåå«æ¯1ã3ã7ãæä»¥ï¼bitæ°ç»çç¬¬1ã3ã7ä½è¢«è®¾ç½®ä¸º1ãå½åºç¨æ³è¦æ¥è¯¢xæ¶ï¼åªè¦æ¥çæ°ç»çç¬¬1ã3ã7ä½æ¯å¦ä¸º1ï¼åªè¦æä¸ä¸ªä¸º0ï¼é£ä¹ï¼xå°±è¯å®ä¸å¨æ°æ®åºä¸­ã\n\næ­£æ¯åºäºå¸éè¿æ»¤å¨çå¿«éæ£æµç¹æ§ï¼æä»¬å¯ä»¥å¨ææ°æ®åå¥æ°æ®åºæ¶ï¼ä½¿ç¨å¸éè¿æ»¤å¨åä¸ªæ è®°ãå½ç¼å­ç¼ºå¤±åï¼åºç¨æ¥è¯¢æ°æ®åºæ¶ï¼å¯ä»¥éè¿æ¥è¯¢å¸éè¿æ»¤å¨å¿«éå¤æ­æ°æ®æ¯å¦å­å¨ãå¦æä¸å­å¨ï¼å°±ä¸ç¨åå»æ°æ®åºä¸­æ¥è¯¢äºãè¿æ ·ä¸æ¥ï¼å³ä½¿åçç¼å­ç©¿éäºï¼å¤§éè¯·æ±åªä¼æ¥è¯¢redisåå¸éè¿æ»¤å¨ï¼èä¸ä¼ç§¯åå°æ°æ®åºï¼ä¹å°±ä¸ä¼å½±åæ°æ®åºçæ­£å¸¸è¿è¡ãå¸éè¿æ»¤å¨å¯ä»¥ä½¿ç¨rediså®ç°ï¼æ¬èº«å°±è½æ¿æè¾å¤§çå¹¶åè®¿é®ååã\n\n# 3ï¼æ¹æ¡ 3ï¼æåå¯¹è¯·æ±è¿è¡åæ³æ§æ£æµ\n\nè¿ç§æ¹æ¡æ¯å¨è¯·æ±å¥å£çåç«¯è¿è¡è¯·æ±æ£æµãç¼å­ç©¿éçä¸ä¸ªåå æ¯æå¤§éçæ¶æè¯·æ±è®¿é®ä¸å­å¨çæ°æ®ï¼æä»¥ï¼ä¸ä¸ªææçåºå¯¹æ¹æ¡æ¯å¨è¯·æ±å¥å£åç«¯ï¼å¯¹ä¸å¡ç³»ç»æ¥æ¶å°çè¯·æ±è¿è¡åæ³æ§æ£æµï¼ææ¶æçè¯·æ±ï¼ä¾å¦è¯·æ±åæ°ä¸åçãè¯·æ±åæ°æ¯éæ³å¼ãè¯·æ±å­æ®µä¸å­å¨ï¼ç´æ¥è¿æ»¤æï¼ä¸è®©å®ä»¬è®¿é®åç«¯ç¼å­åæ°æ®åºãè¿æ ·ä¸æ¥ï¼ä¹å°±ä¸ä¼åºç°ç¼å­ç©¿éé®é¢äºã\n\nè·ç¼å­éªå´©ãç¼å­å»ç©¿è¿ä¸¤ç±»é®é¢ç¸æ¯ï¼ç¼å­ç©¿éçå½±åæ´å¤§ä¸äºï¼å¸æä½ è½éç¹å³æ³¨ä¸ä¸ï¼\n\n * ä»é¢é²çè§åº¦æ¥è¯´ï¼æä»¬éè¦é¿åè¯¯å é¤æ°æ®åºåç¼å­ä¸­çæ°æ®ï¼\n * ä»åºå¯¹è§åº¦æ¥è¯´ï¼æä»¬å¯ä»¥å¨ä¸å¡ç³»ç»ä¸­ä½¿ç¨ç¼å­ç©ºå¼æç¼ºçå¼ãä½¿ç¨å¸éè¿æ»¤å¨ï¼ä»¥åè¿è¡æ¶æè¯·æ±æ£æµç­æ¹æ³ã\n\n\n# 4.4 å°ç»\n\næ¬èæè®²çä¸ä¸ªé®é¢å¦ä¸å¾æç¤ºï¼\n\næåå¼ºè°ä¸ä¸ï¼æå¡çæ­ãæå¡éçº§ãè¯·æ±éæµè¿äºæ¹æ³é½æ¯å±äºâææâæ¹æ¡ï¼å¨ä¿è¯æ°æ®åºåæ´ä½ç³»ç»ç¨³å®çåæ¶ï¼ä¼å¯¹ä¸å¡åºç¨å¸¦æ¥è´é¢å½±åãä¾å¦ä½¿ç¨æå¡éçº§æ¶ï¼æé¨åæ°æ®çè¯·æ±å°±åªè½å¾å°éè¯¯è¿åä¿¡æ¯ï¼æ æ³æ­£å¸¸å¤çãå¦æä½¿ç¨äºæå¡çæ­ï¼é£ä¹ï¼æ´ä¸ªç¼å­ç³»ç»çæå¡é½è¢«æåäºï¼å½±åçä¸å¡èå´æ´å¤§ãèä½¿ç¨äºè¯·æ±éæµæºå¶åï¼æ´ä¸ªä¸å¡ç³»ç»çååçä¼éä½ï¼è½å¹¶åå¤ççç¨æ·è¯·æ±ä¼åå°ï¼ä¼å½±åå°ç¨æ·ä½éªã\n\næä»¥å»ºè®®å°½éä½¿ç¨é¢é²å¼æ¹æ¡ï¼\n\n * éå¯¹ç¼å­éªå´©ï¼åçå°è®¾ç½®æ°æ®è¿ææ¶é´ï¼ä»¥åæ­å»ºé«å¯é ç¼å­éç¾¤ï¼\n * éå¯¹ç¼å­å»ç©¿ï¼å¨ç¼å­è®¿é®éå¸¸é¢ç¹çç­ç¹æ°æ®æ¶ï¼ä¸è¦è®¾ç½®è¿ææ¶é´ï¼\n * éå¯¹ç¼å­ç©¿éï¼æåå¨å¥å£åç«¯å®ç°æ¶æè¯·æ±æ£æµï¼æèè§èæ°æ®åºçæ°æ®å é¤æä½ï¼é¿åè¯¯å é¤ã",charsets:{cjk:!0},lastUpdated:"2023/06/05, 07:46:08",lastUpdatedTimestamp:1685951168e3},{title:"Redis ç¨ä½ç¼å­ä¹ç¼å­æ±¡æ",frontmatter:{title:"Redis ç¨ä½ç¼å­ä¹ç¼å­æ±¡æ",date:"2023-04-12T10:21:29.000Z",permalink:"/pages/ea52c5/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/27.Redis%20%E7%94%A8%E4%BD%9C%E7%BC%93%E5%AD%98%E4%B9%8B%E7%BC%93%E5%AD%98%E6%B1%A1%E6%9F%93.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/27.Redis ç¨ä½ç¼å­ä¹ç¼å­æ±¡æ.md",key:"v-ad649dc2",path:"/pages/ea52c5/",headers:[{level:2,title:"5. ç¼å­è¢«æ±¡æäºï¼è¯¥æä¹åï¼",slug:"_5-ç¼å­è¢«æ±¡æäº-è¯¥æä¹å",normalizedTitle:"5. ç¼å­è¢«æ±¡æäºï¼è¯¥æä¹åï¼",charIndex:245},{level:3,title:"5.1 å¦ä½è§£å³ç¼å­æ±¡æé®é¢",slug:"_5-1-å¦ä½è§£å³ç¼å­æ±¡æé®é¢",normalizedTitle:"5.1 å¦ä½è§£å³ç¼å­æ±¡æé®é¢",charIndex:367},{level:3,title:"5.2 LRU ç¼å­ç­ç¥",slug:"_5-2-lru-ç¼å­ç­ç¥",normalizedTitle:"5.2 lru ç¼å­ç­ç¥",charIndex:1061},{level:3,title:"5.3 LFU ç¼å­ç­ç¥çä¼å",slug:"_5-3-lfu-ç¼å­ç­ç¥çä¼å",normalizedTitle:"5.3 lfu ç¼å­ç­ç¥çä¼å",charIndex:1521},{level:3,title:"5.4 å°ç»",slug:"_5-4-å°ç»",normalizedTitle:"5.4 å°ç»",charIndex:3479}],headersStr:"5. ç¼å­è¢«æ±¡æäºï¼è¯¥æä¹åï¼ 5.1 å¦ä½è§£å³ç¼å­æ±¡æé®é¢ 5.2 LRU ç¼å­ç­ç¥ 5.3 LFU ç¼å­ç­ç¥çä¼å 5.4 å°ç»",content:"> åèï¼\n> \n>  * 27 ç¼å­è¢«æ±¡æäºï¼è¯¥æä¹åï¼| æå®¢æ¶é´\n\nææ¡ç¼å­éè¦è§£å³åä¸ªå³é®é®é¢ï¼\n\n * Redis ç¼å­å·ä½æ¯æä¹å·¥ä½çï¼(å·¥ä½åç)\n * Redis ç¼å­å¦ææ»¡äºï¼è¯¥æä¹åï¼(æ¿æ¢ç­ç¥)\n * ä¸ºä»ä¹ä¼æç¼å­ä¸è´æ§ãç¼å­ç©¿éãç¼å­éªå´©ãç¼å­å»ç©¿ç­å¼å¸¸ï¼è¯¥å¦ä½åºå¯¹ï¼(å¼å¸¸å¤çæºå¶)\n * Redis çåå­æ¯ç«æéï¼å¦æç¨å¿«éçåºæç¡¬çæ¥ä¿å­æ°æ®ï¼å¯ä»¥å¢å ç¼å­çæ°æ®éï¼é£ Redis ç¼å­å¯ä»¥ä½¿ç¨å¿«éåºæç¡¬çåï¼(æ©å±æºå¶)\n\nä¸é¢ä»ç»ç¬¬åä¸ªé®é¢ã\n\n\n# 5. ç¼å­è¢«æ±¡æäºï¼è¯¥æä¹åï¼\n\nç¼å­æ±¡æï¼ææäºæ°æ®å¾å°è¢«è®¿é®ï¼è¿äºæ°æ®è¢«è®¿é®åä»ç¶ç»§ç»­çå¨ç¼å­ä¸­ï¼å°±åªä¼ç½ç½å ç¨ç¼å­ç©ºé´ï¼è¿ç§æåµå°±æ¯ç¼å­æ±¡æã\n\nå¦æç¼å­æ±¡æä¸¥éï¼å°±ä¼å½±å Redis çæ§è½ãè¿ä¸èå°±ççå¦ä½è§£å³ç¼å­æ±¡æé®é¢ã\n\n\n# 5.1 å¦ä½è§£å³ç¼å­æ±¡æé®é¢\n\nè¦è§£å³ç¼å­æ±¡æï¼æä»¬ä¹è½å¾å®¹ææ³å°è§£å³æ¹æ¡ï¼é£å°±æ¯å¾æä¸ä¼åè¢«è®¿é®çæ°æ®ç­éåºæ¥å¹¶æ·æ±°æãè¿æ ·å°±ä¸ç¨ç­å°ç¼å­è¢«åæ»¡ä»¥åï¼åéä¸æ·æ±°æ§æ°æ®ä¹åï¼æè½åå¥æ°æ°æ®äºãèåªäºæ°æ®è½çå­å¨ç¼å­ä¸­ï¼æ¯ç±ç¼å­çæ·æ±°ç­ç¥å³å®çã\n\næä»¬åé¢è¯´è¿ç¼å­æ·æ±°ç­ç¥æ 8 ç§ï¼åå«æ¯noevictionãvolatile-randomãvolatile-ttlãvolatile-lruãvolatile-lfuãallkeys-lruãallkeys-randomåallkeys-lfuç­ç¥ãåªäºç­ç¥å¯ä»¥è§£å³ç¼å­æ±¡æé®é¢å¢ï¼æä»¬ä¸ä¸åæä¸ã\n\nnoeviction ç­ç¥æ¯ä¸ä¼è¿è¡æ°æ®æ·æ±°çãæä»¥ï¼å®è¯å®ä¸è½ç¨æ¥è§£å³ç¼å­æ±¡æé®é¢ã\n\né¦ååçä¸ä¸ volatile-random å allkeys-random è¿ä¸¤ä¸ªç­ç¥ï¼å®ä»¬é½æ¯éç¨éæºæéè¢«æ·æ±°çæ°æ®ãå ä¸ºè¿ä¸¤ä¸ªç­ç¥å¹¶ä¸æ ¹æ®æ°æ®çè®¿é®æåµæ¥ç­éï¼å æ­¤å¨é¿åç¼å­æ±¡æè¿ä¸ªé®é¢ä¸çææéå¸¸æéã\n\nåç volatile-ttl ç­ç¥ï¼å®ææ°æ®ä¸­å©ä½å­æ´»æ¶é´æç­çç­éåºæ¥å¹¶æ·æ±°æï¼ä½å©ä½å­æ´»æ¶é´ä¹ä¸è½ç´æ¥åæ æ°æ®åæ¬¡è®¿é®çæåµï¼å æ­¤ä¹æ æ³ææé¿åç¼å­æ±¡æãé¤éåºç¨ä¼æ ¹æ®è®¿é®æåµæ¥è®¾ç½®è¿ææ¶é´ã\n\nè®²å°è¿éï¼æä»¬åå°ç»ä¸ãé¤äºå¨æç¡®ç¥éæ°æ®è¢«åæ¬¡è®¿é®çæåµä¸ï¼volatile-ttlå¯ä»¥ææé¿åç¼å­æ±¡æãå¨å¶ä»æåµä¸ï¼volatile-randomãallkeys-randomãvolatile-ttlè¿ä¸ç§ç­ç¥å¹¶ä¸è½åºå¯¹ç¼å­æ±¡æé®é¢ã\n\nä¸é¢åçä¸ä¸ LRU å LFU ç­ç¥å¨è§£å³ç¼å­æ±¡æé®é¢ä¸çææã\n\n\n# 5.2 LRU ç¼å­ç­ç¥\n\nLRU ç­ç¥çæ ¸å¿ææ³ï¼å¦æä¸ä¸ªæ°æ®ååè¢«è®¿é®ï¼é£ä¹è¿ä¸ªæ°æ®è¯å®æ¯ç­æ°æ®ï¼è¿ä¼è¢«åæ¬¡è®¿é®ã\n\nRedis ç LRU ç¼å­ç­ç¥å®ç°æ¹å¼æ¯å¨ RedisObject ç»æä½ä¸è®¾ç½®äºä¸ä¸ª lru å­æ®µæ¥è®°å½æ¶é´æ³ï¼å¨è¿è¡æ°æ®æ·æ±°æ¶ï¼LRU ç­ç¥ä¼æ·æ±°æ lru å¼æå°çæ°æ®ã\n\nå æ­¤å¨æ°æ®è¢«é¢ç¹è®¿é®çä¸å¡åºæ¯ä¸­ï¼LRU ç­ç¥è½å¤ææçå­è®¿é®æ¶é´æè¿çæ°æ®ï¼èä¸å ä¸ºè¿äºæ°æ®å¾å¯è½è¢«åæ¬¡è®¿é®ï¼ä»èå¯ä»¥æåä¸å¡åºç¨çè®¿é®éåº¦ã\n\nä½ LRU è¿ç§åªçæ°æ®è®¿é®æ¶é´çç®æ³ï¼æ æ³å¤çâæ«æå¼åæ¬¡æ¥è¯¢æä½âå¯¼è´çç¼å­æ±¡æé®é¢ãæ«æå¼åæ¬¡æ¥è¯¢æä½æåºç¨å¯¹å¤§éæ°æ®è¿è¡ä¸æ¬¡å¨ä½éä¸è®¿é®ï¼æ­¤æ¶ç±äºè¢«æ¥è¯¢çæ°æ®é½æ¯åè¢«è®¿é®è¿çï¼å¶ lru å¼é½å¾å¤§ï¼ä»èå¯¼è´å¾å¤æ°æ®é½çå¨äºç¼å­ä¸­äº§çæ±¡æã\n\næä»¥å¯¹äº Redis ç LRU ç­ç¥ èè¨ï¼æ«æå¼åæ¬¡æ¥è¯¢ä¼é æç¼å­æ±¡æãä¸ºäºåºå¯¹è¿ç±»é®é¢ï¼Redis 4.0 å¢å äº LFU æ·æ±°ç­ç¥ï¼å®ä»æ¶ææ§åè¢«è®¿é®æ¬¡æ°ä¸¤ä¸ªç»´åº¦æ¥ç­éæ°æ®ãä¸é¢çä¸ä¸ LFU ç­ç¥ã\n\n\n# 5.3 LFU ç¼å­ç­ç¥çä¼å\n\nLFU ç¼å­ç­ç¥æ¯å¨ LRU ç­ç¥åºç¡ä¸ï¼ä¸ºæ¯ä¸ªæ°æ®å¢å äºä¸ä¸ªè®¡æ°å¨ï¼æ¥ç»è®¡è¿ä¸ªæ°æ®çè®¿é®æ¬¡æ°ãå½ä½¿ç¨ LFU ç­ç¥ç­éæ·æ±°æ°æ®æ¶ï¼é¦åä¼æ ¹æ®æ°æ®çè®¿é®æ¬¡æ°è¿è¡ç­éï¼æè®¿é®æ¬¡æ°æä½çæ°æ®æ·æ±°åºç¼å­ãå¦æä¸¤ä¸ªæ°æ®çè®¿é®æ¬¡æ°ç¸åï¼LFU ç­ç¥åæ¯è¾è¿ä¸¤ä¸ªæ°æ®çè®¿é®æ¶ææ§ï¼æè·ç¦»ä¸ä¸æ¬¡è®¿é®æ¶é´æ´ä¹çæ°æ®æ·æ±°åºç¼å­ã\n\nåé£äºè¢«é¢ç¹è®¿é®çæ°æ®ç¸æ¯ï¼æ«æå¼åæ¬¡æ¥è¯¢çæ°æ®å ä¸ºä¸ä¼è¢«åæ¬¡è®¿é®ï¼æä»¥å®ä»¬çè®¿é®æ¬¡æ°ä¸ä¼åå¢å ãå æ­¤ï¼LFU ç­ç¥ä¼ä¼åæè¿äºè®¿é®æ¬¡æ°ä½çæ°æ®æ·æ±°åºç¼å­ãè¿æ ·ä¸æ¥ï¼LFU ç­ç¥å°±å¯ä»¥é¿åè¿äºæ°æ®å¯¹ç¼å­é ææ±¡æäºã\n\n----------------------------------------\n\nLFUç­ç¥å·ä½åæ¯å¦ä½å®ç°çå¢ï¼\n\næ¢ç¶LFUç­ç¥æ¯å¨LRUç­ç¥ä¸åçä¼åï¼é£å®ä»¬çå®ç°å¿å®æäºå³ç³»ãåå¤ä¹ ä¸ç¬¬24è®²å­¦ä¹ è¿çLRUç­ç¥çå®ç°ï¼\n\n * Redisæ¯ç¨RedisObjectç»ææ¥ä¿å­æ°æ®çï¼RedisObjectç»æä¸­è®¾ç½®äºä¸ä¸ªlruå­æ®µï¼ç¨æ¥è®°å½æ°æ®çè®¿é®æ¶é´æ³ï¼\n * Rediså¹¶æ²¡æä¸ºææçæ°æ®ç»´æ¤ä¸ä¸ªå¨å±çé¾è¡¨ï¼èæ¯éè¿éæºéæ ·æ¹å¼ï¼éåä¸å®æ°éï¼ä¾å¦10ä¸ªï¼çæ°æ®æ¾å¥åééåï¼åç»­å¨åééåä¸­æ ¹æ®lruå­æ®µå¼çå¤§å°è¿è¡ç­éã\n\nå¨æ­¤åºç¡ä¸ï¼ Rediså¨å®ç°LFUç­ç¥çæ¶åï¼åªæ¯æåæ¥24bitå¤§å°çlruå­æ®µï¼åè¿ä¸æ­¥æåæäºä¸¤é¨åã\n\n 1. ldtå¼ï¼lruå­æ®µçå16bitï¼è¡¨ç¤ºæ°æ®çè®¿é®æ¶é´æ³ï¼\n 2. counterå¼ï¼lruå­æ®µçå8bitï¼è¡¨ç¤ºæ°æ®çè®¿é®æ¬¡æ°ã\n\næ»ç»ä¸ä¸ï¼å½LFUç­ç¥ç­éæ°æ®æ¶ï¼Redisä¼å¨åééåä¸­ï¼æ ¹æ®æ°æ®lruå­æ®µçå8bitéæ©è®¿é®æ¬¡æ°æå°çæ°æ®è¿è¡æ·æ±°ãå½è®¿é®æ¬¡æ°ç¸åæ¶ï¼åæ ¹æ®lruå­æ®µçå16bitå¼å¤§å°ï¼éæ©è®¿é®æ¶é´æä¹è¿çæ°æ®è¿è¡æ·æ±°ã\n\nä½æ¯ï¼ Redisåªä½¿ç¨äº8bitè®°å½æ°æ®çè®¿é®æ¬¡æ°ï¼è8bitè®°å½çæå¤§å¼æ¯255ï¼è¿æ ·å¯ä»¥åï¼\n\nRedis å¨å®ç°LFUç­ç¥æ¶ï¼æ²¡æéç¨æ°æ®æ¯è¢«è®¿é®ä¸æ¬¡ï¼å°±ç»å¯¹åºçcounterå¼å 1çè®¡æ°è§åï¼èæ¯éç¨äºä¸ä¸ªæ´ä¼åçè®¡æ°è§åï¼æ¯å½æ°æ®è¢«è®¿é®ä¸æ¬¡æ¶ï¼é¦åï¼ç¨è®¡æ°å¨å½åçå¼ä¹ä»¥éç½®é¡¹lfu_log_factoråå 1ï¼ååå¶åæ°ï¼å¾å°ä¸ä¸ªpå¼ï¼ç¶åï¼æè¿ä¸ªpå¼åä¸ä¸ªåå¼èå´å¨ï¼0ï¼1ï¼é´çéæºæ°rå¼æ¯å¤§å°ï¼åªæpå¼å¤§äºrå¼æ¶ï¼è®¡æ°å¨æå 1ã.\n\nä¸é¢è¿æ®µRedisçé¨åæºç ï¼æ¾ç¤ºäºLFUç­ç¥å¢å è®¡æ°å¨å¼çè®¡ç®é»è¾ãå¶ä¸­ï¼basevalæ¯è®¡æ°å¨å½åçå¼ãè®¡æ°å¨çåå§å¼é»è®¤æ¯5ï¼ç±ä»£ç ä¸­çLFU_INIT_VALå¸¸éè®¾ç½®ï¼ï¼èä¸æ¯0ï¼è¿æ ·å¯ä»¥é¿åæ°æ®åè¢«åå¥ç¼å­ï¼å°±å ä¸ºè®¿é®æ¬¡æ°å°èè¢«ç«å³æ·æ±°ã\n\ndouble r = (double)rand()/RAND_MAX;\n...\ndouble p = 1.0/(baseval*server.lfu_log_factor+1);\nif (r < p) counter++;\n\n\n1\n2\n3\n4\n\n\nä½¿ç¨äºè¿ç§è®¡ç®è§ååï¼æä»¬å¯ä»¥éè¿è®¾ç½®ä¸åçlfu_log_factoréç½®é¡¹ï¼æ¥æ§å¶è®¡æ°å¨å¼å¢å çéåº¦ï¼é¿åcounterå¼å¾å¿«å°±å°255äºã\n\nä¸è¡¨è®°å½äºå½lfu_log_factoråä¸åå¼æ¶ï¼å¨ä¸åçå®éè®¿é®æ¬¡æ°æåµä¸ï¼è®¡æ°å¨çå¼æ¯å¦ä½ååçã\n\næ­£æ¯å ä¸ºä½¿ç¨äºéçº¿æ§éå¢çè®¡æ°å¨æ¹æ³ï¼å³ä½¿ç¼å­æ°æ®çè®¿é®æ¬¡æ°æåä¸ä¸ï¼LFUç­ç¥ä¹å¯ä»¥ææå°åºåä¸åçè®¿é®æ¬¡æ°ï¼ä»èè¿è¡åççæ°æ®ç­éãæä»¬å¨åºç¨LFUç­ç¥æ¶ï¼ä¸è¬å¯ä»¥å°lfu_log_factoråå¼ä¸º10ã\n\nå¨ä¸äºåºæ¯ä¸ï¼æäºæ°æ®å¨ç­æ¶é´åè¢«å¤§éè®¿é®åå°±ä¸ä¼åè¢«è®¿é®äºãé£ä¹åæç§è®¿é®æ¬¡æ°æ¥ç­éçè¯ï¼è¿äºæ°æ®ä¼è¢«çå­å¨ç¼å­ä¸­ï¼ä½ä¸ä¼æåç¼å­å½ä¸­çãä¸ºæ­¤ï¼Rediså¨å®ç°LFUç­ç¥æ¶ï¼è¿è®¾è®¡äºä¸ä¸ªcounterå¼çè¡°åæºå¶ï¼\n\n * LFUç­ç¥ä½¿ç¨è¡°åå å­éç½®é¡¹lfu_decay_timeæ¥æ§å¶è®¿é®æ¬¡æ°çè¡°åãLFUç­ç¥ä¼è®¡ç®å½åæ¶é´åæ°æ®æè¿ä¸æ¬¡è®¿é®æ¶é´çå·®å¼ï¼å¹¶æè¿ä¸ªå·®å¼æ¢ç®æä»¥åéä¸ºåä½ãç¶åï¼LFUç­ç¥åæè¿ä¸ªå·®å¼é¤ä»¥lfu_decay_timeå¼ï¼æå¾çç»æå°±æ¯æ°æ®counterè¦è¡°åçå¼ã\n\nç®åä¸¾ä¸ªä¾å­ï¼åè®¾lfu_decay_timeåå¼ä¸º1ï¼å¦ææ°æ®å¨Nåéåæ²¡æè¢«è®¿é®ï¼é£ä¹å®çè®¿é®æ¬¡æ°å°±è¦åNãå¦ælfu_decay_timeåå¼æ´å¤§ï¼é£ä¹ç¸åºçè¡°åå¼ä¼åå°ï¼è¡°åææä¹ä¼åå¼±ãæä»¥ï¼å¦æä¸å¡åºç¨ä¸­æç­æ¶é«é¢è®¿é®çæ°æ®çè¯ï¼å»ºè®®ælfu_decay_timeå¼è®¾ç½®ä¸º1ï¼è¿æ ·ä¸æ¥ï¼LFUç­ç¥å¨å®ä»¬ä¸åè¢«è®¿é®åï¼ä¼è¾å¿«å°è¡°åå®ä»¬çè®¿é®æ¬¡æ°ï¼å°½æ©æå®ä»¬ä»ç¼å­ä¸­æ·æ±°åºå»ï¼é¿åç¼å­æ±¡æã\n\n\n# 5.4 å°ç»\n\nå¨å®éä¸å¡åºç¨ä¸­ï¼LRU åLFU ä¸¤ä¸ªç­ç¥é½æåºç¨ãLRU å LFU ä¸¤ä¸ªç­ç¥å³æ³¨çæ°æ®è®¿é®ç¹å¾åæä¾§éï¼\n\n * LRU ç­ç¥æ´å å³æ³¨æ°æ®çæ¶ææ§ï¼\n * LFU ç­ç¥æ´å å³æ³¨æ°æ®çè®¿é®é¢æ¬¡ã\n\néå¸¸æåµä¸ï¼å®éåºç¨çè´è½½å·æè¾å¥½çæ¶é´å±é¨æ§ï¼æä»¥ LRU ç­ç¥çåºç¨ä¼æ´å å¹¿æ³ãä½æ¯ï¼å¨æ«æå¼æ¥è¯¢çåºç¨åºæ¯ä¸­ï¼LFU ç­ç¥å°±å¯ä»¥å¾å¥½å°åºå¯¹ç¼å­æ±¡æé®é¢äºï¼å»ºè®®ä½ ä¼åä½¿ç¨ã\n\næ­¤å¤ï¼å¦æä¸å¡åºç¨ä¸­æç­æ¶é«é¢è®¿é®çæ°æ®ï¼é¤äºLFUç­ç¥æ¬èº«ä¼å¯¹æ°æ®çè®¿é®æ¬¡æ°è¿è¡èªå¨è¡°åä»¥å¤ï¼æåç»ä½ ä¸ªå°å»ºè®®ï¼ä½ å¯ä»¥ä¼åä½¿ç¨volatile-lfuç­ç¥ï¼å¹¶æ ¹æ®è¿äºæ°æ®çè®¿é®æ¶éè®¾ç½®å®ä»¬çè¿ææ¶é´ï¼ä»¥åå®ä»¬çå­å¨ç¼å­ä¸­é ææ±¡æã",normalizedContent:"> åèï¼\n> \n>  * 27 ç¼å­è¢«æ±¡æäºï¼è¯¥æä¹åï¼| æå®¢æ¶é´\n\nææ¡ç¼å­éè¦è§£å³åä¸ªå³é®é®é¢ï¼\n\n * redis ç¼å­å·ä½æ¯æä¹å·¥ä½çï¼(å·¥ä½åç)\n * redis ç¼å­å¦ææ»¡äºï¼è¯¥æä¹åï¼(æ¿æ¢ç­ç¥)\n * ä¸ºä»ä¹ä¼æç¼å­ä¸è´æ§ãç¼å­ç©¿éãç¼å­éªå´©ãç¼å­å»ç©¿ç­å¼å¸¸ï¼è¯¥å¦ä½åºå¯¹ï¼(å¼å¸¸å¤çæºå¶)\n * redis çåå­æ¯ç«æéï¼å¦æç¨å¿«éçåºæç¡¬çæ¥ä¿å­æ°æ®ï¼å¯ä»¥å¢å ç¼å­çæ°æ®éï¼é£ redis ç¼å­å¯ä»¥ä½¿ç¨å¿«éåºæç¡¬çåï¼(æ©å±æºå¶)\n\nä¸é¢ä»ç»ç¬¬åä¸ªé®é¢ã\n\n\n# 5. ç¼å­è¢«æ±¡æäºï¼è¯¥æä¹åï¼\n\nç¼å­æ±¡æï¼ææäºæ°æ®å¾å°è¢«è®¿é®ï¼è¿äºæ°æ®è¢«è®¿é®åä»ç¶ç»§ç»­çå¨ç¼å­ä¸­ï¼å°±åªä¼ç½ç½å ç¨ç¼å­ç©ºé´ï¼è¿ç§æåµå°±æ¯ç¼å­æ±¡æã\n\nå¦æç¼å­æ±¡æä¸¥éï¼å°±ä¼å½±å redis çæ§è½ãè¿ä¸èå°±ççå¦ä½è§£å³ç¼å­æ±¡æé®é¢ã\n\n\n# 5.1 å¦ä½è§£å³ç¼å­æ±¡æé®é¢\n\nè¦è§£å³ç¼å­æ±¡æï¼æä»¬ä¹è½å¾å®¹ææ³å°è§£å³æ¹æ¡ï¼é£å°±æ¯å¾æä¸ä¼åè¢«è®¿é®çæ°æ®ç­éåºæ¥å¹¶æ·æ±°æãè¿æ ·å°±ä¸ç¨ç­å°ç¼å­è¢«åæ»¡ä»¥åï¼åéä¸æ·æ±°æ§æ°æ®ä¹åï¼æè½åå¥æ°æ°æ®äºãèåªäºæ°æ®è½çå­å¨ç¼å­ä¸­ï¼æ¯ç±ç¼å­çæ·æ±°ç­ç¥å³å®çã\n\næä»¬åé¢è¯´è¿ç¼å­æ·æ±°ç­ç¥æ 8 ç§ï¼åå«æ¯noevictionãvolatile-randomãvolatile-ttlãvolatile-lruãvolatile-lfuãallkeys-lruãallkeys-randomåallkeys-lfuç­ç¥ãåªäºç­ç¥å¯ä»¥è§£å³ç¼å­æ±¡æé®é¢å¢ï¼æä»¬ä¸ä¸åæä¸ã\n\nnoeviction ç­ç¥æ¯ä¸ä¼è¿è¡æ°æ®æ·æ±°çãæä»¥ï¼å®è¯å®ä¸è½ç¨æ¥è§£å³ç¼å­æ±¡æé®é¢ã\n\né¦ååçä¸ä¸ volatile-random å allkeys-random è¿ä¸¤ä¸ªç­ç¥ï¼å®ä»¬é½æ¯éç¨éæºæéè¢«æ·æ±°çæ°æ®ãå ä¸ºè¿ä¸¤ä¸ªç­ç¥å¹¶ä¸æ ¹æ®æ°æ®çè®¿é®æåµæ¥ç­éï¼å æ­¤å¨é¿åç¼å­æ±¡æè¿ä¸ªé®é¢ä¸çææéå¸¸æéã\n\nåç volatile-ttl ç­ç¥ï¼å®ææ°æ®ä¸­å©ä½å­æ´»æ¶é´æç­çç­éåºæ¥å¹¶æ·æ±°æï¼ä½å©ä½å­æ´»æ¶é´ä¹ä¸è½ç´æ¥åæ æ°æ®åæ¬¡è®¿é®çæåµï¼å æ­¤ä¹æ æ³ææé¿åç¼å­æ±¡æãé¤éåºç¨ä¼æ ¹æ®è®¿é®æåµæ¥è®¾ç½®è¿ææ¶é´ã\n\nè®²å°è¿éï¼æä»¬åå°ç»ä¸ãé¤äºå¨æç¡®ç¥éæ°æ®è¢«åæ¬¡è®¿é®çæåµä¸ï¼volatile-ttlå¯ä»¥ææé¿åç¼å­æ±¡æãå¨å¶ä»æåµä¸ï¼volatile-randomãallkeys-randomãvolatile-ttlè¿ä¸ç§ç­ç¥å¹¶ä¸è½åºå¯¹ç¼å­æ±¡æé®é¢ã\n\nä¸é¢åçä¸ä¸ lru å lfu ç­ç¥å¨è§£å³ç¼å­æ±¡æé®é¢ä¸çææã\n\n\n# 5.2 lru ç¼å­ç­ç¥\n\nlru ç­ç¥çæ ¸å¿ææ³ï¼å¦æä¸ä¸ªæ°æ®ååè¢«è®¿é®ï¼é£ä¹è¿ä¸ªæ°æ®è¯å®æ¯ç­æ°æ®ï¼è¿ä¼è¢«åæ¬¡è®¿é®ã\n\nredis ç lru ç¼å­ç­ç¥å®ç°æ¹å¼æ¯å¨ redisobject ç»æä½ä¸è®¾ç½®äºä¸ä¸ª lru å­æ®µæ¥è®°å½æ¶é´æ³ï¼å¨è¿è¡æ°æ®æ·æ±°æ¶ï¼lru ç­ç¥ä¼æ·æ±°æ lru å¼æå°çæ°æ®ã\n\nå æ­¤å¨æ°æ®è¢«é¢ç¹è®¿é®çä¸å¡åºæ¯ä¸­ï¼lru ç­ç¥è½å¤ææçå­è®¿é®æ¶é´æè¿çæ°æ®ï¼èä¸å ä¸ºè¿äºæ°æ®å¾å¯è½è¢«åæ¬¡è®¿é®ï¼ä»èå¯ä»¥æåä¸å¡åºç¨çè®¿é®éåº¦ã\n\nä½ lru è¿ç§åªçæ°æ®è®¿é®æ¶é´çç®æ³ï¼æ æ³å¤çâæ«æå¼åæ¬¡æ¥è¯¢æä½âå¯¼è´çç¼å­æ±¡æé®é¢ãæ«æå¼åæ¬¡æ¥è¯¢æä½æåºç¨å¯¹å¤§éæ°æ®è¿è¡ä¸æ¬¡å¨ä½éä¸è®¿é®ï¼æ­¤æ¶ç±äºè¢«æ¥è¯¢çæ°æ®é½æ¯åè¢«è®¿é®è¿çï¼å¶ lru å¼é½å¾å¤§ï¼ä»èå¯¼è´å¾å¤æ°æ®é½çå¨äºç¼å­ä¸­äº§çæ±¡æã\n\næä»¥å¯¹äº redis ç lru ç­ç¥ èè¨ï¼æ«æå¼åæ¬¡æ¥è¯¢ä¼é æç¼å­æ±¡æãä¸ºäºåºå¯¹è¿ç±»é®é¢ï¼redis 4.0 å¢å äº lfu æ·æ±°ç­ç¥ï¼å®ä»æ¶ææ§åè¢«è®¿é®æ¬¡æ°ä¸¤ä¸ªç»´åº¦æ¥ç­éæ°æ®ãä¸é¢çä¸ä¸ lfu ç­ç¥ã\n\n\n# 5.3 lfu ç¼å­ç­ç¥çä¼å\n\nlfu ç¼å­ç­ç¥æ¯å¨ lru ç­ç¥åºç¡ä¸ï¼ä¸ºæ¯ä¸ªæ°æ®å¢å äºä¸ä¸ªè®¡æ°å¨ï¼æ¥ç»è®¡è¿ä¸ªæ°æ®çè®¿é®æ¬¡æ°ãå½ä½¿ç¨ lfu ç­ç¥ç­éæ·æ±°æ°æ®æ¶ï¼é¦åä¼æ ¹æ®æ°æ®çè®¿é®æ¬¡æ°è¿è¡ç­éï¼æè®¿é®æ¬¡æ°æä½çæ°æ®æ·æ±°åºç¼å­ãå¦æä¸¤ä¸ªæ°æ®çè®¿é®æ¬¡æ°ç¸åï¼lfu ç­ç¥åæ¯è¾è¿ä¸¤ä¸ªæ°æ®çè®¿é®æ¶ææ§ï¼æè·ç¦»ä¸ä¸æ¬¡è®¿é®æ¶é´æ´ä¹çæ°æ®æ·æ±°åºç¼å­ã\n\nåé£äºè¢«é¢ç¹è®¿é®çæ°æ®ç¸æ¯ï¼æ«æå¼åæ¬¡æ¥è¯¢çæ°æ®å ä¸ºä¸ä¼è¢«åæ¬¡è®¿é®ï¼æä»¥å®ä»¬çè®¿é®æ¬¡æ°ä¸ä¼åå¢å ãå æ­¤ï¼lfu ç­ç¥ä¼ä¼åæè¿äºè®¿é®æ¬¡æ°ä½çæ°æ®æ·æ±°åºç¼å­ãè¿æ ·ä¸æ¥ï¼lfu ç­ç¥å°±å¯ä»¥é¿åè¿äºæ°æ®å¯¹ç¼å­é ææ±¡æäºã\n\n----------------------------------------\n\nlfuç­ç¥å·ä½åæ¯å¦ä½å®ç°çå¢ï¼\n\næ¢ç¶lfuç­ç¥æ¯å¨lruç­ç¥ä¸åçä¼åï¼é£å®ä»¬çå®ç°å¿å®æäºå³ç³»ãåå¤ä¹ ä¸ç¬¬24è®²å­¦ä¹ è¿çlruç­ç¥çå®ç°ï¼\n\n * redisæ¯ç¨redisobjectç»ææ¥ä¿å­æ°æ®çï¼redisobjectç»æä¸­è®¾ç½®äºä¸ä¸ªlruå­æ®µï¼ç¨æ¥è®°å½æ°æ®çè®¿é®æ¶é´æ³ï¼\n * rediså¹¶æ²¡æä¸ºææçæ°æ®ç»´æ¤ä¸ä¸ªå¨å±çé¾è¡¨ï¼èæ¯éè¿éæºéæ ·æ¹å¼ï¼éåä¸å®æ°éï¼ä¾å¦10ä¸ªï¼çæ°æ®æ¾å¥åééåï¼åç»­å¨åééåä¸­æ ¹æ®lruå­æ®µå¼çå¤§å°è¿è¡ç­éã\n\nå¨æ­¤åºç¡ä¸ï¼ rediså¨å®ç°lfuç­ç¥çæ¶åï¼åªæ¯æåæ¥24bitå¤§å°çlruå­æ®µï¼åè¿ä¸æ­¥æåæäºä¸¤é¨åã\n\n 1. ldtå¼ï¼lruå­æ®µçå16bitï¼è¡¨ç¤ºæ°æ®çè®¿é®æ¶é´æ³ï¼\n 2. counterå¼ï¼lruå­æ®µçå8bitï¼è¡¨ç¤ºæ°æ®çè®¿é®æ¬¡æ°ã\n\næ»ç»ä¸ä¸ï¼å½lfuç­ç¥ç­éæ°æ®æ¶ï¼redisä¼å¨åééåä¸­ï¼æ ¹æ®æ°æ®lruå­æ®µçå8bitéæ©è®¿é®æ¬¡æ°æå°çæ°æ®è¿è¡æ·æ±°ãå½è®¿é®æ¬¡æ°ç¸åæ¶ï¼åæ ¹æ®lruå­æ®µçå16bitå¼å¤§å°ï¼éæ©è®¿é®æ¶é´æä¹è¿çæ°æ®è¿è¡æ·æ±°ã\n\nä½æ¯ï¼ redisåªä½¿ç¨äº8bitè®°å½æ°æ®çè®¿é®æ¬¡æ°ï¼è8bitè®°å½çæå¤§å¼æ¯255ï¼è¿æ ·å¯ä»¥åï¼\n\nredis å¨å®ç°lfuç­ç¥æ¶ï¼æ²¡æéç¨æ°æ®æ¯è¢«è®¿é®ä¸æ¬¡ï¼å°±ç»å¯¹åºçcounterå¼å 1çè®¡æ°è§åï¼èæ¯éç¨äºä¸ä¸ªæ´ä¼åçè®¡æ°è§åï¼æ¯å½æ°æ®è¢«è®¿é®ä¸æ¬¡æ¶ï¼é¦åï¼ç¨è®¡æ°å¨å½åçå¼ä¹ä»¥éç½®é¡¹lfu_log_factoråå 1ï¼ååå¶åæ°ï¼å¾å°ä¸ä¸ªpå¼ï¼ç¶åï¼æè¿ä¸ªpå¼åä¸ä¸ªåå¼èå´å¨ï¼0ï¼1ï¼é´çéæºæ°rå¼æ¯å¤§å°ï¼åªæpå¼å¤§äºrå¼æ¶ï¼è®¡æ°å¨æå 1ã.\n\nä¸é¢è¿æ®µredisçé¨åæºç ï¼æ¾ç¤ºäºlfuç­ç¥å¢å è®¡æ°å¨å¼çè®¡ç®é»è¾ãå¶ä¸­ï¼basevalæ¯è®¡æ°å¨å½åçå¼ãè®¡æ°å¨çåå§å¼é»è®¤æ¯5ï¼ç±ä»£ç ä¸­çlfu_init_valå¸¸éè®¾ç½®ï¼ï¼èä¸æ¯0ï¼è¿æ ·å¯ä»¥é¿åæ°æ®åè¢«åå¥ç¼å­ï¼å°±å ä¸ºè®¿é®æ¬¡æ°å°èè¢«ç«å³æ·æ±°ã\n\ndouble r = (double)rand()/rand_max;\n...\ndouble p = 1.0/(baseval*server.lfu_log_factor+1);\nif (r < p) counter++;\n\n\n1\n2\n3\n4\n\n\nä½¿ç¨äºè¿ç§è®¡ç®è§ååï¼æä»¬å¯ä»¥éè¿è®¾ç½®ä¸åçlfu_log_factoréç½®é¡¹ï¼æ¥æ§å¶è®¡æ°å¨å¼å¢å çéåº¦ï¼é¿åcounterå¼å¾å¿«å°±å°255äºã\n\nä¸è¡¨è®°å½äºå½lfu_log_factoråä¸åå¼æ¶ï¼å¨ä¸åçå®éè®¿é®æ¬¡æ°æåµä¸ï¼è®¡æ°å¨çå¼æ¯å¦ä½ååçã\n\næ­£æ¯å ä¸ºä½¿ç¨äºéçº¿æ§éå¢çè®¡æ°å¨æ¹æ³ï¼å³ä½¿ç¼å­æ°æ®çè®¿é®æ¬¡æ°æåä¸ä¸ï¼lfuç­ç¥ä¹å¯ä»¥ææå°åºåä¸åçè®¿é®æ¬¡æ°ï¼ä»èè¿è¡åççæ°æ®ç­éãæä»¬å¨åºç¨lfuç­ç¥æ¶ï¼ä¸è¬å¯ä»¥å°lfu_log_factoråå¼ä¸º10ã\n\nå¨ä¸äºåºæ¯ä¸ï¼æäºæ°æ®å¨ç­æ¶é´åè¢«å¤§éè®¿é®åå°±ä¸ä¼åè¢«è®¿é®äºãé£ä¹åæç§è®¿é®æ¬¡æ°æ¥ç­éçè¯ï¼è¿äºæ°æ®ä¼è¢«çå­å¨ç¼å­ä¸­ï¼ä½ä¸ä¼æåç¼å­å½ä¸­çãä¸ºæ­¤ï¼rediså¨å®ç°lfuç­ç¥æ¶ï¼è¿è®¾è®¡äºä¸ä¸ªcounterå¼çè¡°åæºå¶ï¼\n\n * lfuç­ç¥ä½¿ç¨è¡°åå å­éç½®é¡¹lfu_decay_timeæ¥æ§å¶è®¿é®æ¬¡æ°çè¡°åãlfuç­ç¥ä¼è®¡ç®å½åæ¶é´åæ°æ®æè¿ä¸æ¬¡è®¿é®æ¶é´çå·®å¼ï¼å¹¶æè¿ä¸ªå·®å¼æ¢ç®æä»¥åéä¸ºåä½ãç¶åï¼lfuç­ç¥åæè¿ä¸ªå·®å¼é¤ä»¥lfu_decay_timeå¼ï¼æå¾çç»æå°±æ¯æ°æ®counterè¦è¡°åçå¼ã\n\nç®åä¸¾ä¸ªä¾å­ï¼åè®¾lfu_decay_timeåå¼ä¸º1ï¼å¦ææ°æ®å¨nåéåæ²¡æè¢«è®¿é®ï¼é£ä¹å®çè®¿é®æ¬¡æ°å°±è¦ånãå¦ælfu_decay_timeåå¼æ´å¤§ï¼é£ä¹ç¸åºçè¡°åå¼ä¼åå°ï¼è¡°åææä¹ä¼åå¼±ãæä»¥ï¼å¦æä¸å¡åºç¨ä¸­æç­æ¶é«é¢è®¿é®çæ°æ®çè¯ï¼å»ºè®®ælfu_decay_timeå¼è®¾ç½®ä¸º1ï¼è¿æ ·ä¸æ¥ï¼lfuç­ç¥å¨å®ä»¬ä¸åè¢«è®¿é®åï¼ä¼è¾å¿«å°è¡°åå®ä»¬çè®¿é®æ¬¡æ°ï¼å°½æ©æå®ä»¬ä»ç¼å­ä¸­æ·æ±°åºå»ï¼é¿åç¼å­æ±¡æã\n\n\n# 5.4 å°ç»\n\nå¨å®éä¸å¡åºç¨ä¸­ï¼lru ålfu ä¸¤ä¸ªç­ç¥é½æåºç¨ãlru å lfu ä¸¤ä¸ªç­ç¥å³æ³¨çæ°æ®è®¿é®ç¹å¾åæä¾§éï¼\n\n * lru ç­ç¥æ´å å³æ³¨æ°æ®çæ¶ææ§ï¼\n * lfu ç­ç¥æ´å å³æ³¨æ°æ®çè®¿é®é¢æ¬¡ã\n\néå¸¸æåµä¸ï¼å®éåºç¨çè´è½½å·æè¾å¥½çæ¶é´å±é¨æ§ï¼æä»¥ lru ç­ç¥çåºç¨ä¼æ´å å¹¿æ³ãä½æ¯ï¼å¨æ«æå¼æ¥è¯¢çåºç¨åºæ¯ä¸­ï¼lfu ç­ç¥å°±å¯ä»¥å¾å¥½å°åºå¯¹ç¼å­æ±¡æé®é¢äºï¼å»ºè®®ä½ ä¼åä½¿ç¨ã\n\næ­¤å¤ï¼å¦æä¸å¡åºç¨ä¸­æç­æ¶é«é¢è®¿é®çæ°æ®ï¼é¤äºlfuç­ç¥æ¬èº«ä¼å¯¹æ°æ®çè®¿é®æ¬¡æ°è¿è¡èªå¨è¡°åä»¥å¤ï¼æåç»ä½ ä¸ªå°å»ºè®®ï¼ä½ å¯ä»¥ä¼åä½¿ç¨volatile-lfuç­ç¥ï¼å¹¶æ ¹æ®è¿äºæ°æ®çè®¿é®æ¶éè®¾ç½®å®ä»¬çè¿ææ¶é´ï¼ä»¥åå®ä»¬çå­å¨ç¼å­ä¸­é ææ±¡æã",charsets:{cjk:!0},lastUpdated:"2023/04/12, 03:21:35",lastUpdatedTimestamp:1681269695e3},{title:"Pikaï¼åºäºSSDå®ç°å¤§å®¹éRedis",frontmatter:{title:"Pikaï¼åºäºSSDå®ç°å¤§å®¹éRedis",date:"2023-04-18T15:02:38.000Z",permalink:"/pages/8f7740/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/28.Pika%EF%BC%9A%E5%9F%BA%E4%BA%8ESSD%E5%AE%9E%E7%8E%B0%E5%A4%A7%E5%AE%B9%E9%87%8FRedis.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/28.Pikaï¼åºäºSSDå®ç°å¤§å®¹éRedis.md",key:"v-3aa5fefb",path:"/pages/8f7740/",headers:[{level:2,title:"1 Pikaï¼å¦ä½åºäº SSD å®ç°å¤§å®¹é Redisï¼",slug:"_1-pika-å¦ä½åºäº-ssd-å®ç°å¤§å®¹é-redis",normalizedTitle:"1 pikaï¼å¦ä½åºäº ssd å®ç°å¤§å®¹é redisï¼",charIndex:54},{level:3,title:"1.1 å¤§åå­ Redis å®ä¾çæ½å¨é®é¢",slug:"_1-1-å¤§åå­-redis-å®ä¾çæ½å¨é®é¢",normalizedTitle:"1.1 å¤§åå­ redis å®ä¾çæ½å¨é®é¢",charIndex:660},{level:3,title:"1.2 Pika çæ´ä½æ¶æ",slug:"_1-2-pika-çæ´ä½æ¶æ",normalizedTitle:"1.2 pika çæ´ä½æ¶æ",charIndex:983},{level:3,title:"1.3 Pika å¦ä½åºäº SSD ä¿å­æ´å¤æ°æ®ï¼",slug:"_1-3-pika-å¦ä½åºäº-ssd-ä¿å­æ´å¤æ°æ®",normalizedTitle:"1.3 pika å¦ä½åºäº ssd ä¿å­æ´å¤æ°æ®ï¼",charIndex:1851},{level:4,title:"1.3.1 ä½¿ç¨ RocksDB æ¥å­å¨æ°æ®",slug:"_1-3-1-ä½¿ç¨-rocksdb-æ¥å­å¨æ°æ®",normalizedTitle:"1.3.1 ä½¿ç¨ rocksdb æ¥å­å¨æ°æ®",charIndex:1880},{level:3,title:"1.4 Pika å¦ä½å®ç° Redis æ°æ®ç±»åå¼å®¹ï¼",slug:"_1-4-pika-å¦ä½å®ç°-redis-æ°æ®ç±»åå¼å®¹",normalizedTitle:"1.4 pika å¦ä½å®ç° redis æ°æ®ç±»åå¼å®¹ï¼",charIndex:3258},{level:4,title:"1.4.1 List ç±»å",slug:"_1-4-1-list-ç±»å",normalizedTitle:"1.4.1 list ç±»å",charIndex:3641},{level:4,title:"1.4.2 Set ç±»å",slug:"_1-4-2-set-ç±»å",normalizedTitle:"1.4.2 set ç±»å",charIndex:4042},{level:4,title:"1.4.3 Hash ç±»å",slug:"_1-4-3-hash-ç±»å",normalizedTitle:"1.4.3 hash ç±»å",charIndex:4219},{level:4,title:"1.4.4 Sorted Set ç±»å",slug:"_1-4-4-sorted-set-ç±»å",normalizedTitle:"1.4.4 sorted set ç±»å",charIndex:4384},{level:3,title:"1.5 Pika çå¶ä»ä¼å¿ä¸ä¸è¶³",slug:"_1-5-pika-çå¶ä»ä¼å¿ä¸ä¸è¶³",normalizedTitle:"1.5 pika çå¶ä»ä¼å¿ä¸ä¸è¶³",charIndex:4859},{level:3,title:"1.6 å°ç»",slug:"_1-6-å°ç»",normalizedTitle:"1.6 å°ç»",charIndex:5790}],headersStr:"1 Pikaï¼å¦ä½åºäº SSD å®ç°å¤§å®¹é Redisï¼ 1.1 å¤§åå­ Redis å®ä¾çæ½å¨é®é¢ 1.2 Pika çæ´ä½æ¶æ 1.3 Pika å¦ä½åºäº SSD ä¿å­æ´å¤æ°æ®ï¼ 1.3.1 ä½¿ç¨ RocksDB æ¥å­å¨æ°æ® 1.4 Pika å¦ä½å®ç° Redis æ°æ®ç±»åå¼å®¹ï¼ 1.4.1 List ç±»å 1.4.2 Set ç±»å 1.4.3 Hash ç±»å 1.4.4 Sorted Set ç±»å 1.5 Pika çå¶ä»ä¼å¿ä¸ä¸è¶³ 1.6 å°ç»",content:"> åèï¼\n> \n>  * 28 Pikaï¼å¦ä½åºäº SSD å®ç°å¤§å®¹é Redisï¼| æå®¢æ¶é´\n\n\n# 1 Pikaï¼å¦ä½åºäº SSD å®ç°å¤§å®¹é Redisï¼\n\nå¨åºç¨ Redis æ¶ï¼éçä¸å¡æ°æ®çå¢å ï¼ä¼éè¦ Redis ä¿å­æ´å¤çæ°æ®ï¼è¿æ¶ä¼æ³å°ä½¿ç¨ Redis åçéç¾¤ï¼ä»èææ°æ®åæ£ä¿å­å°å¤ä¸ªå®ä¾ä¸ï¼ä½è¿æ ·ä¼å¯¼è´éç¾¤çå®ä¾è§æ¨¡å¢å ï¼è®©éç¾¤çè¿ç»´åå¾å¤æã\n\nè¿æä¸ç§æ¹æ³æ¯å¢å  Redis åä¸ªå®ä¾çåå­å®¹éï¼å½¢æå¤§åå­å®ä¾ï¼ä»èåå°æéç Redis å®ä¾çä¸ªæ°ãè¿æ¯ä¸ªå¥½ä¸»æï¼ä½å¹¶ä¸å®ç¾ï¼åºäºå¤§åå­çå¤§å®¹éå®ä¾å¨å®ä¾æ¢å¤ãä¸»ä»åæ­¥è¿ç¨ä¸­ä¼å¼èµ·ä¸ç³»åæ½å¨é®é¢ï¼ä¾å¦æ¢å¤æ¶é´å¢é¿ãä¸»ä»åæ¢å¼éå¤§ãç¼å²åºææº¢åºã\n\nè¿è¯¥æä¹åå¢ï¼ææ¨èä½ ä½¿ç¨åºæç¡¬çï¼SSDï¼ï¼å®ææ¬å¾ä½ï¼æ¯ GB çææ¬çº¦æ¯åå­çååä¹ä¸ï¼ï¼ä¸å®¹éå¤§ï¼è¯»åéåº¦å¿«ï¼æä»¬å¯ä»¥åºäºSSDæ¥å®ç°å¤§å®¹éçRediså®ä¾ã360å¬å¸DBAååºç¡æ¶æç»èåå¼åç Pika é®å¼æ°æ®åºï¼æ­£å¥½å®ç°äºè¿ä¸éæ±ã\n\nPika å¨åå¼å§è®¾è®¡æ¶æä¸¤ä¸ªç®æ ï¼\n\n 1. åå®ä¾å¯ä»¥ä¿å­å¤§å®¹éæ°æ®ï¼åæ¶é¿åäºå®ä¾æ¢å¤åä¸»ä»åæ­¥æ¶çæ½å¨é®é¢ï¼\n 2. å Redis æ°æ®ç±»åä¿æå¼å®¹ï¼å¯ä»¥æ¯æä½¿ç¨ Redis çåºç¨å¹³æ»å°è¿ç§»å° Pika ä¸ã\n\næä»¥ï¼å¦æä½ ä¸ç´å¨ä½¿ç¨ Redisï¼å¹¶ä¸æ³ä½¿ç¨ SSD æ¥æ©å±åå®ä¾å®¹éï¼Pika å°±æ¯ä¸ä¸ªå¾å¥½çéæ©ã\n\næ¬èå°åä»ç»åºäºå¤§åå­å®ç°å¤§å®¹é Redis å®ä¾çæ½å¨é®é¢ï¼ç¶åä»ç» Pika çç¸å³è®¾è®¡ã\n\n\n# 1.1 å¤§åå­ Redis å®ä¾çæ½å¨é®é¢\n\nRedis ä½¿ç¨åå­ä¿å­æ°æ®ï¼åå­å®¹éå¢å åï¼å°±ä¼å¸¦æ¥ä¸¤æ¹é¢çæ½å¨é®é¢ï¼\n\n * åå­å¿«ç§ RDB çæåæ¢å¤æçä½ï¼è¿ä¼å¯¼è´ Redis å®ä¾é»å¡è¿ä¹ï¼\n * ä¸»ä»èç¹å¨éåæ­¥æ¶é¿å¢å ï¼å¦æ RDB æä»¶å¾å¤§ï¼ä¼å¯¼è´å¨éåæ­¥çæ¶é¿å¢å ï¼æçä¸é«ï¼èä¸è¿å¯è½ä¼å¯¼è´å¤å¶ç¼å²åºæº¢åºãä¸æ¦ç¼å²åºæº¢åºäºï¼ä¸»ä»èç¹é´å°±ä¼åå¼å§å¨éåæ­¥ï¼å½±åä¸å¡åºç¨çæ­£å¸¸ä½¿ç¨ãå¦ææä»¬å¢å å¤å¶ç¼å²åºçå®¹éï¼è¿åä¼æ¶èå®è´µçåå­èµæºã\n\né£ä¹ï¼Pika æ¯å¦ä½è§£å³è¿ä¸¤æ¹é¢çé®é¢å¢ï¼è¿å°±è¦æå° Pika ä¸­çå³é®æ¨¡å RocksDBãbinlog æºå¶å Nemo äºï¼è¿äºæ¨¡åé½æ¯ Pika æ¶æä¸­çéè¦ç»æé¨åã\n\n\n# 1.2 Pika çæ´ä½æ¶æ\n\nPika é®å¼æ°æ®åºçæ´ä½æ¶æä¸­åæ¬äºäºé¨åï¼åå«æ¯ç½ç»æ¡æ¶ãPika çº¿ç¨æ¨¡åãNemo å­å¨æ¨¡åãRocksDB å binlog æºå¶ï¼å¦ä¸å¾æç¤ºï¼\n\nè¿äºä¸ªé¨ååå«å®ç°äºä¸åçåè½ï¼ä¸é¢æä¸ä¸ªä¸ªæ¥ä»ç»ä¸ã\n\né¦åï¼ç½ç»æ¡æ¶ä¸»è¦è´è´£åºå±ç½ç»è¯·æ±çæ¥æ¶ååéãPikaçç½ç»æ¡æ¶æ¯å¯¹æä½ç³»ç»åºå±çç½ç»å½æ°è¿è¡äºå°è£ãPikaå¨è¿è¡ç½ç»éä¿¡æ¶ï¼å¯ä»¥ç´æ¥è°ç¨ç½ç»æ¡æ¶å°è£å¥½çå½æ°ã\n\nå¶æ¬¡ï¼Pika çº¿ç¨æ¨¡åéç¨äºå¤çº¿ç¨æ¨¡åæ¥å·ä½å¤çå®¢æ·ç«¯è¯·æ±ï¼åæ¬ä¸ä¸ªè¯·æ±ååçº¿ç¨ï¼DispatchThreadï¼ãä¸ç»å·¥ä½çº¿ç¨ï¼WorkerThreadï¼ä»¥åä¸ä¸ªçº¿ç¨æ± ï¼ThreadPoolï¼ã\n\nè¯·æ±ååçº¿ç¨ä¸é¨çå¬ç½ç»ç«¯å£ï¼ä¸æ¦æ¥æ¶å°å®¢æ·ç«¯çè¿æ¥è¯·æ±åï¼å°±åå®¢æ·ç«¯å»ºç«è¿æ¥ï¼å¹¶æè¿æ¥äº¤ç±å·¥ä½çº¿ç¨å¤çãå·¥ä½çº¿ç¨è´è´£æ¥æ¶å®¢æ·ç«¯è¿æ¥ä¸åéçå·ä½å½ä»¤è¯·æ±ï¼å¹¶æå½ä»¤è¯·æ±å°è£æTaskï¼åäº¤ç»çº¿ç¨æ± ä¸­ççº¿ç¨ï¼ç±è¿äºçº¿ç¨è¿è¡å®éçæ°æ®å­åå¤çï¼å¦ä¸å¾æç¤ºï¼\n\nå¨å®éåºç¨Pikaçæ¶åï¼æä»¬å¯ä»¥éè¿å¢å å·¥ä½çº¿ç¨æ°åçº¿ç¨æ± ä¸­ççº¿ç¨æ°ï¼æ¥æåPikaçè¯·æ±å¤çååçï¼è¿èæ»¡è¶³ä¸å¡å±å¯¹æ°æ®å¤çæ§è½çéæ±ã\n\nNemo æ¨¡åå¾å®¹æçè§£ï¼å®å®ç°äº Pika å Redis çæ°æ®ç±»åå¼å®¹ãè¿æ ·ä¸æ¥ï¼å½æä»¬æ Redis æå¡è¿ç§»å° Pika æ¶ï¼ä¸ç¨ä¿®æ¹ä¸å¡åºç¨ä¸­æä½ Redis çä»£ç ï¼èä¸è¿å¯ä»¥ç»§ç»­åºç¨è¿ç»´ Redis çç»éªï¼è¿ä½¿å¾ Pika çå­¦ä¹ ææ¬å°±è¾ä½ãNemo æ¨¡åå¯¹æ°æ®ç±»åçå·ä½è½¬æ¢æºå¶æ¯æä»¬è¦éç¹å³å¿çï¼ä¸é¢æä¼å·ä½ä»ç»ã\n\næåï¼æä»¬åæ¥çç RocksDB æä¾çåºäºSSDä¿å­æ°æ®çåè½ãå®ä½¿å¾ Pika å¯ä»¥ä¸ç¨å¤§å®¹éçåå­ï¼å°±è½ä¿å­æ´å¤æ°æ®ï¼è¿é¿åäºä½¿ç¨åå­å¿«ç§ãèä¸ï¼Pikaä½¿ç¨ binlog æºå¶è®°å½åå½ä»¤ï¼ç¨äºä¸»ä»èç¹çå½ä»¤åæ­¥ï¼é¿åäºååæè¯´çå¤§åå­å®ä¾å¨ä¸»ä»åæ­¥è¿ç¨ä¸­çæ½å¨é®é¢ã\n\næ¥ä¸æ¥ï¼æä»¬å°±æ¥å·ä½äºè§£ä¸ï¼Pika æ¯å¦ä½ä½¿ç¨ RocksDB å binlog æºå¶çã\n\n\n# 1.3 Pika å¦ä½åºäº SSD ä¿å­æ´å¤æ°æ®ï¼\n\n# 1.3.1 ä½¿ç¨ RocksDB æ¥å­å¨æ°æ®\n\nä¸ºäºææ°æ®ä¿å­å° SSDï¼Pika ä½¿ç¨äºæä¹å KV æ°æ®åº RocksDBãè¿éåªéè¦äºè§£ RocksDB çåºæ¬æ°æ®è¯»åæºå¶å°±å¯ä»¥ï¼\n\n * Memtable æ¯ä¸ä¸ªå°åå­ç©ºé´ï¼å¤§çº¦å MBæå åMBãä¸¤ä¸ª Memtable æ¥äº¤æ¿ç¼å­åå¥æ°æ®ã\n\næ ¹æ®ä¸å¾å¯ä»¥çå°ï¼RocksDB ä¼åç¨ Memtable ç¼å­æ°æ®ï¼åå°æ°æ®å¿«éåå¥SSDï¼å³ä½¿æ°æ®éåå¤§ï¼æææ°æ®ä¹é½è½ä¿å­å°SSDä¸­ãèä¸ï¼Memtableæ¬èº«å®¹éä¸å¤§ï¼å³ä½¿RocksDBä½¿ç¨äºä¸¤ä¸ªMemtableï¼ä¹ä¸ä¼å ç¨è¿å¤çåå­ï¼è¿æ ·ä¸æ¥ï¼Pikaå¨ä¿å­å¤§å®¹éæ°æ®æ¶ï¼ä¹ä¸ç¨å æ®å¤ªå¤§çåå­ç©ºé´äºã\n\næ°æ®æ¥æ¾æ¹æ³ï¼å½Pikaéè¦è¯»åæ°æ®çæ¶åï¼RocksDBä¼åå¨Memtableä¸­æ¥è¯¢æ¯å¦æè¦è¯»åçæ°æ®ãè¿æ¯å ä¸ºï¼ææ°çæ°æ®é½æ¯ååå¥å°Memtableä¸­çãå¦æMemtableä¸­æ²¡æè¦è¯»åçæ°æ®ï¼RocksDBä¼åæ¥è¯¢ä¿å­å¨SSDä¸çæ°æ®æä»¶ï¼å¦ä¸å¾æç¤ºï¼\n\nå°è¿éï¼ä½ å°±äºè§£äºï¼å½ä½¿ç¨äºRocksDBä¿å­æ°æ®åï¼Pikaå°±å¯ä»¥æå¤§éæ°æ®ä¿å­å°å¤§å®¹éçSSDä¸äºï¼å®ç°äºå¤§å®¹éå®ä¾ã\n\nä¸è¿ï¼æåæåä½ ä»ç»è¿ï¼å½ä½¿ç¨å¤§åå­å®ä¾ä¿å­å¤§éæ°æ®æ¶ï¼Redisä¼é¢ä¸´RDBçæåæ¢å¤çæçé®é¢ï¼ä»¥åä¸»ä»åæ­¥æ¶çæçåç¼å²åºæº¢åºé®é¢ãé£ä¹ï¼å½Pikaä¿å­å¤§éæ°æ®æ¶ï¼è¿ä¼é¢ä¸´ç¸åçé®é¢åï¼å¶å®ä¸ä¼äºï¼æ¥ä¸æ¥åæä¸ä¸ã\n\n * ä¸æ¹é¢ï¼PikaåºäºRocksDBä¿å­äºæ°æ®æä»¶ï¼ç´æ¥è¯»åæ°æ®æä»¶å°±è½æ¢å¤ï¼ä¸éè¦åéè¿åå­å¿«ç§è¿è¡æ¢å¤äºãèä¸ï¼Pikaä»åºå¨è¿è¡å¨éåæ­¥æ¶ï¼å¯ä»¥ç´æ¥ä»ä¸»åºæ·è´æ°æ®æä»¶ï¼ä¸éè¦ä½¿ç¨åå­å¿«ç§ï¼è¿æ ·ä¸æ¥ï¼Pikaå°±é¿åäºå¤§åå­å¿«ç§çææçä½çé®é¢ã\n * å¦ä¸æ¹é¢ï¼Pikaä½¿ç¨äºbinlogæºå¶å®ç°å¢éå½ä»¤åæ­¥ï¼æ¢èçäºåå­ï¼è¿é¿åäºç¼å²åºæº¢åºçé®é¢ãbinlogæ¯ä¿å­å¨SSDä¸çæä»¶ï¼Pikaæ¥æ¶å°åå½ä»¤åï¼å¨ææ°æ®åå¥Memtableæ¶ï¼ä¹ä¼æå½ä»¤æä½åå°binlogæä»¶ä¸­ãåRedisç±»ä¼¼ï¼å½å¨éåæ­¥ç»æåï¼ä»åºä¼ä»binlogä¸­æå°æªåæ­¥çå½ä»¤è¯»åè¿æ¥ï¼è¿æ ·å°±å¯ä»¥åä¸»åºçæ°æ®ä¿æä¸è´ãå½è¿è¡å¢éåæ­¥æ¶ï¼ä»åºä¹æ¯æèªå·±å·²ç»å¤å¶çåç§»éåç»ä¸»åºï¼ä¸»åºæå°æªåæ­¥çå½ä»¤åç»ä»åºï¼æ¥ä¿æä¸»ä»åºçæ°æ®ä¸è´ã\n\nåRedisä½¿ç¨ç¼å²åºç¸æ¯ï¼ä½¿ç¨binlogå¥½å¤æ¯éå¸¸ææ¾çï¼binlogæ¯ä¿å­å¨SSDä¸çæä»¶ï¼æä»¶å¤§å°ä¸åç¼å²åºï¼ä¼åå°åå­å®¹éçè¾å¤éå¶ãèä¸ï¼å½binlogæä»¶å¢å¤§åï¼è¿å¯ä»¥éè¿è½®æ¿æä½ï¼çææ°çbinlogæä»¶ï¼åææ§çbinlogæä»¶ç¬ç«ä¿å­ãè¿æ ·ä¸æ¥ï¼å³ä½¿Pikaå®ä¾ä¿å­äºå¤§éçæ°æ®ï¼å¨åæ­¥è¿ç¨ä¸­ä¹ä¸ä¼åºç°ç¼å²åºæº¢åºçé®é¢äºã\n\nç®åå°ç»ä¸ï¼Pika ä½¿ç¨ RocksDB æå¤§éæ°æ®ä¿å­å°äº SSDï¼åæ¶é¿åäºåå­å¿«ç§ççæåæ¢å¤é®é¢ãèä¸ï¼Pika ä½¿ç¨ binlog æºå¶è¿è¡ä¸»ä»åæ­¥ï¼é¿åå¤§åå­æ¶çå½±åï¼Pika çç¬¬ä¸ä¸ªè®¾è®¡ç®æ å°±å®ç°äºã\n\næ¥ä¸æ¥ï¼æä»¬åæ¥ç Pika æ¯å¦ä½å®ç°ç¬¬äºä¸ªè®¾è®¡ç®æ çï¼ä¹å°±æ¯å¦ä½å Redis å¼å®¹ãæ¯ç«ï¼å¦æä¸å¼å®¹çè¯ï¼åæ¥ä½¿ç¨ Redis çä¸å¡å°±æ æ³å¹³æ»è¿ç§»å° Pika ä¸ä½¿ç¨äºï¼ä¹å°±æ²¡åæ³å©ç¨ Pika ä¿å­å¤§å®¹éæ°æ®çä¼å¿äºã\n\n\n# 1.4 Pika å¦ä½å®ç° Redis æ°æ®ç±»åå¼å®¹ï¼\n\nPika çåºå±å­å¨ä½¿ç¨äº RocksDB æ¥ä¿å­æ°æ®ï¼ä½æ¯ï¼RocksDB åªæä¾äºåå¼çé®å¼å¯¹ç±»åï¼è Redis é®å¼å¯¹ä¸­çå¼å´å¯ä»¥æ¯éåç±»åãè¿æ ·ï¼å¯¹äºéåç±»åå°±æ æ³ç´æ¥å­å¨å¨ RocksDB ä¸­ï¼éè¦ Pika ç Nemo æ¨¡åæ¥å®æå° Redis éåç±»å -> åå¼ kv çè½¬æ¢ã\n\nç®åæ¥è¯´ï¼å¯ä»¥å° Redis çéåç±»ååæä¸¤ç±»ï¼\n\n * ä¸ç±»æ¯ List å Set ç±»åï¼å®ä»¬çéåä¸­æ¯ä¸ªåç´ é½æ¯åå¼ï¼\n * å¦ä¸ç±»æ¯ Hash å Sorted Set ç±»åï¼å®ä»¬çéåä¸­çåç´ é½æ¯ pairï¼å¶ä¸­ï¼Hash éååç´ æ¯ field-value ç±»åï¼è Sorted Set éååç´ æ¯ member-score ç±»åã\n\nä¸é¢çä¸ä¸ Nemo æ¨¡åæ¯å¦ä½åçè¿ç§è½¬æ¢ã\n\n# 1.4.1 List ç±»å\n\nå¨Pikaä¸­ï¼Listéåçkeyè¢«åµå¥å°äºåå¼é®å¼å¯¹çé®å½ä¸­ï¼ç¨keyå­æ®µè¡¨ç¤ºï¼èListéåçåç´ å¼ï¼åè¢«åµå¥å°åå¼é®å¼å¯¹çå¼å½ä¸­ï¼ç¨valueå­æ®µè¡¨ç¤ºãå ä¸ºListéåä¸­çåç´ æ¯æåºçï¼æä»¥ï¼Nemoæ¨¡åè¿å¨åå¼é®å¼å¯¹çkeyåé¢å¢å äºsequenceå­æ®µï¼è¡¨ç¤ºå½ååç´ å¨Listä¸­çé¡ºåºï¼åæ¶ï¼è¿å¨valueçåé¢å¢å äºprevious sequenceånext sequenceè¿ä¸¤ä¸ªå­æ®µï¼åå«è¡¨ç¤ºå½ååç´ çåä¸ä¸ªåç´ ååä¸ä¸ªåç´ ã\n\næ­¤å¤ï¼å¨åå¼é®å¼å¯¹çkeyåé¢ï¼Nemoæ¨¡åè¿å¢å äºä¸ä¸ªå¼âlâï¼è¡¨ç¤ºå½åæ°æ®æ¯Listç±»åï¼ä»¥åå¢å äºä¸ä¸ª1å­èçsizeå­æ®µï¼è¡¨ç¤ºListéåkeyçå¤§å°ãå¨åå¼é®å¼å¯¹çvalueåé¢ï¼Nemoæ¨¡åè¿å¢å äºversionåttlå­æ®µï¼åå«è¡¨ç¤ºå½åæ°æ®ççæ¬å·åå©ä½å­æ´»æ¶é´ï¼ç¨æ¥æ¯æè¿ækeyåè½ï¼ï¼å¦ä¸å¾æç¤ºï¼\n\n# 1.4.2 Set ç±»å\n\nSetéåçkeyååç´ memberå¼ï¼é½è¢«åµå¥å°äºPikaåå¼é®å¼å¯¹çé®å½ä¸­ï¼åå«ç¨keyåmemberå­æ®µè¡¨ç¤ºãåæ¶ï¼åListéåç±»ä¼¼ï¼åå¼é®å¼å¯¹çkeyåé¢æå¼âsâï¼ç¨æ¥è¡¨ç¤ºæ°æ®æ¯Setç±»åï¼åæ¶è¿æsizeå­æ®µï¼ç¨æ¥è¡¨ç¤ºkeyçå¤§å°ãPikaåå¼é®å¼å¯¹çå¼åªä¿å­äºæ°æ®ççæ¬ä¿¡æ¯åå©ä½å­æ´»æ¶é´ï¼å¦ä¸å¾æç¤ºï¼\n\n# 1.4.3 Hash ç±»å\n\nå¯¹äºHashç±»åæ¥è¯´ï¼Hashéåçkeyè¢«åµå¥å°åå¼é®å¼å¯¹çé®å½ä¸­ï¼ç¨keyå­æ®µè¡¨ç¤ºï¼èHashéååç´ çfieldä¹è¢«åµå¥å°åå¼é®å¼å¯¹çé®å½ä¸­ï¼ç´§æ¥çkeyå­æ®µï¼ç¨fieldå­æ®µè¡¨ç¤ºãHashéååç´ çvalueåæ¯åµå¥å°åå¼é®å¼å¯¹çå¼å½ä¸­ï¼å¹¶ä¸ä¹å¸¦æçæ¬ä¿¡æ¯åå©ä½å­æ´»æ¶é´ï¼å¦ä¸å¾æç¤ºï¼\n\n# 1.4.4 Sorted Set ç±»å\n\nå¯¹äºSorted Setç±»åæ¥è¯´ï¼è¯¥ç±»åæ¯éè¦è½å¤æç§éååç´ çscoreå¼æåºçï¼èRocksDBåªæ¯ææç§åå¼é®å¼å¯¹çé®æ¥æåºãæä»¥ï¼Nemoæ¨¡åå¨è½¬æ¢æ°æ®æ¶ï¼å°±æSorted Setéåkeyãåç´ çscoreåmemberå¼é½åµå¥å°äºåå¼é®å¼å¯¹çé®å½ä¸­ï¼æ­¤æ¶ï¼åå¼é®å¼å¯¹ä¸­çå¼åªä¿å­äºæ°æ®ççæ¬ä¿¡æ¯åå©ä½å­æ´»æ¶é´ï¼å¦ä¸å¾æç¤ºï¼\n\néç¨äºä¸é¢çè½¬æ¢æ¹å¼ä¹åï¼Pikaä¸ä»è½å¼å®¹æ¯æRedisçæ°æ®ç±»åï¼èä¸è¿ä¿çäºè¿äºæ°æ®ç±»åçç¹å¾ï¼ä¾å¦Listçåç´ ä¿åºãSorted Setçåç´ æscoreæåºãäºè§£äºPikaçè½¬æ¢æºå¶åï¼ä½ å°±ä¼æç½ï¼å¦æä½ æä¸å¡åºç¨è®¡åä»ä½¿ç¨Redisåæ¢å°ä½¿ç¨Pikaï¼å°±ä¸ç¨æå¿é¢ä¸´å ä¸ºæä½æ¥å£ä¸å¼å®¹èè¦ä¿®æ¹ä¸å¡åºç¨çé®é¢äºã\n\n----------------------------------------\n\nåé¢åæäº Pika çä¸¤å¤§ä¼å¿ï¼\n\n * åºäº SSD ä¿å­å¤§éæ°æ®\n * ä¸ Redis å¼å®¹\n\næ¥ä¸æ¥çä¸ä¸ Pika çå¶ä»ä¼å¿åæ½å¨ä¸è¶³ã\n\n\n# 1.5 Pika çå¶ä»ä¼å¿ä¸ä¸è¶³\n\nè·Redisç¸æ¯ï¼Pikaæå¤§çç¹ç¹å°±æ¯ä½¿ç¨äºSSDæ¥ä¿å­æ°æ®ï¼è¿ä¸ªç¹ç¹è½å¸¦æ¥çæç´æ¥å¥½å¤å°±æ¯ï¼Pikaåå®ä¾è½ä¿å­æ´å¤çæ°æ®äºï¼å®ç°äºå®ä¾æ°æ®æ©å®¹ãé¤æ­¤ä¹å¤ï¼Pika è¿æä¸¤ä¸ªé¢å¤ä¼å¿ï¼\n\n * å®ä¾éå¯å¿«ãPikaçæ°æ®å¨åå¥æ°æ®åºæ¶ï¼æ¯ä¼ä¿å­å°SSDä¸çãå½Pikaå®ä¾éå¯æ¶ï¼å¯ä»¥ç´æ¥ä»SSDä¸çæ°æ®æä»¶ä¸­è¯»åæ°æ®ï¼ä¸éè¦åRedisä¸æ ·ï¼ä»RDBæä»¶å¨é¨éæ°å è½½æ°æ®ææ¯ä»AOFæä»¶ä¸­å¨é¨åæ¾æä½ï¼è¿æå¤§å°æé«äºPikaå®ä¾çéå¯éåº¦ï¼å¯ä»¥å¿«éå¤çä¸å¡åºç¨è¯·æ±ã\n * ä¸»ä»åºéæ°æ§è¡å¨éåæ­¥çé£é©ä½ãPikaéè¿binlogæºå¶å®ç°åå½ä»¤çå¢éåæ­¥ï¼ä¸åååå­ç¼å²åºå¤§å°çéå¶ï¼æä»¥ï¼å³ä½¿å¨æ°æ®éå¾å¤§å¯¼è´ä¸»ä»åºåæ­¥èæ¶å¾é¿çæåµä¸ï¼Pikaä¹ä¸ç¨æå¿ç¼å²åºæº¢åºèè§¦åçä¸»ä»åºéæ°å¨éåæ­¥ã\n\nä½ Pika ä¹æä¸äºä¸è¶³ï¼\n\nè½ç¶å®ä¿æäºRedisæä½æ¥å£ï¼ä¹è½å®ç°æ°æ®åºæ©å®¹ï¼ä½å½ææ°æ®ä¿å­å°SSDä¸åï¼ä¼éä½æ°æ®çè®¿é®æ§è½ãè¿æ¯å ä¸ºï¼æ°æ®æä½æ¯ç«ä¸è½å¨åå­ä¸­ç´æ¥æ§è¡äºï¼èæ¯è¦å¨åºå±çSSDä¸­è¿è¡å­åï¼è¿è¯å®ä¼å½±åï¼Pikaçæ§è½ãèä¸ï¼æä»¬è¿éè¦æbinlogæºå¶è®°å½çåå½ä»¤åæ­¥å°SSDä¸ï¼è¿ä¼éä½Pikaçåæ§è½ã\n\nä¸è¿ï¼Pikaçå¤çº¿ç¨æ¨¡åï¼å¯ä»¥åæ¶ä½¿ç¨å¤ä¸ªçº¿ç¨è¿è¡æ°æ®è¯»åï¼è¿å¨ä¸å®ç¨åº¦ä¸å¼¥è¡¥äºä»SSDå­åæ°æ®é æçæ§è½æå¤±ãå½ç¶ï¼ä½ ä¹å¯ä»¥ä½¿ç¨é«éçSSDæ¥æåè®¿é®æ§è½ï¼è¿èåå°è¯»åSSDå¯¹Pikaæ§è½çå½±åã\n\nä¸ºäºå¸®å©ä½ æ´ç´è§å°äºè§£Pikaçæ§è½æåµï¼æåç»ä½ æä¾ä¸å¼ è¡¨ï¼è¿æ¯Pika å®ç½ ä¸æä¾çæµè¯æ°æ®ï¼\n\nè¿äºæ°æ®æ¯å¨Pika 3.2çæ¬ä¸­ï¼StringåHashç±»åå¨å¤çº¿ç¨æåµä¸çåºæ¬æä½æ§è½ç»æãä»è¡¨ä¸­å¯ä»¥çå°ï¼å¨ä¸åbinlogæ¶ï¼PikaçSET/GETãHSET/HGETçæ§è½é½è½è¾¾å°200K OPSä»¥ä¸ï¼èä¸æ¦å¢å äºåbinlogæä½ï¼SETåHSETæä½æ§è½å¤§çº¦ä¸éäº41%ï¼åªæçº¦120K OPSã\n\næä»¥ï¼æä»¬å¨ä½¿ç¨Pikaæ¶ï¼éè¦å¨åå®ä¾æ©å®¹çå¿è¦æ§åå¯è½çæ§è½æå¤±é´åä¸ªæè¡¡ãå¦æä¿å­å¤§å®¹éæ°æ®æ¯æä»¬çé¦è¦éæ±ï¼é£ä¹ï¼Pikaæ¯ä¸ä¸ªä¸éçè§£å³æ¹æ¡ã\n\n\n# 1.6 å°ç»\n\nè¿èè¯¾ï¼æä»¬å­¦ä¹ äºåºäºSSDç»Redisåå®ä¾è¿è¡æ©å®¹çææ¯æ¹æ¡Pikaãè·Redisç¸æ¯ï¼Pikaçå¥½å¤éå¸¸ææ¾ï¼æ¢æ¯æRedisæä½æ¥å£ï¼åè½æ¯æä¿å­å¤§å®¹éçæ°æ®ãå¦æä½ åæ¥å°±å¨åºç¨Redisï¼ç°å¨æ³è¿è¡æ©å®¹ï¼é£ä¹ï¼Pikaæ çæ¯ä¸ä¸ªå¾å¥½çéæ©ï¼æ è®ºæ¯ä»£ç è¿ç§»è¿æ¯è¿ç»´ç®¡çï¼Pikaåºæ¬ä¸éè¦é¢å¤çå·¥ä½éã\n\nä¸è¿ï¼Pikaæ¯ç«æ¯ææ°æ®ä¿å­å°äºSSDä¸ï¼æ°æ®è®¿é®è¦è¯»åSSDï¼æä»¥ï¼è¯»åæ§è½è¦å¼±äºRedisãéå¯¹è¿ä¸ç¹ï¼æç»ä½ æä¾ä¸¤ä¸ªéä½è¯»åSSDå¯¹Pikaçæ§è½å½±åçå°å»ºè®®ï¼\n\n 1. å©ç¨Pikaçå¤çº¿ç¨æ¨¡åï¼å¢å çº¿ç¨æ°éï¼æåPikaçå¹¶åè¯·æ±å¤çè½åï¼\n 2. ä¸ºPikaéç½®é«éçSSDï¼æåSSDèªèº«çè®¿é®æ§è½ã\n\næåï¼ææ³åç»ä½ ä¸ä¸ªå°æç¤ºãPikaæ¬èº«æä¾äºå¾å¤å·¥å·ï¼å¯ä»¥å¸®å©æä»¬æRedisæ°æ®è¿ç§»å°Pikaï¼æèæ¯æRedisè¯·æ±è½¬åç»Pikaãæ¯å¦è¯´ï¼æä»¬ä½¿ç¨aof_to_pikaå½ä»¤ï¼å¹¶ä¸æå®RedisçAOFæä»¶ä»¥åPikaçè¿æ¥ä¿¡æ¯ï¼å°±å¯ä»¥æRedisæ°æ®è¿ç§»å°Pikaä¸­äºï¼å¦ä¸æç¤ºï¼\n\naof_to_pika -i [Redis AOFæä»¶] -h [Pika IP] -p [Pika port] -a [è®¤è¯ä¿¡æ¯]\n\n\n1\n\n\nå³äºè¿äºå·¥å·çä¿¡æ¯ï¼ä½ é½å¯ä»¥ç´æ¥å¨Pikaç GitHub ä¸æ¾å°ãèä¸ï¼Pikaæ¬èº«ä¹è¿å¨è¿­ä»£å¼åä¸­ï¼æä¹å»ºè®®ä½ å¤å»ççGitHubï¼è¿ä¸æ­¥å°äºè§£å®ãè¿æ ·ï¼ä½ å°±å¯ä»¥è·å¾Pikaçææ°è¿å±ï¼ä¹è½æ´å¥½å°æå®åºç¨å°ä½ çä¸å¡å®è·µä¸­ã",normalizedContent:"> åèï¼\n> \n>  * 28 pikaï¼å¦ä½åºäº ssd å®ç°å¤§å®¹é redisï¼| æå®¢æ¶é´\n\n\n# 1 pikaï¼å¦ä½åºäº ssd å®ç°å¤§å®¹é redisï¼\n\nå¨åºç¨ redis æ¶ï¼éçä¸å¡æ°æ®çå¢å ï¼ä¼éè¦ redis ä¿å­æ´å¤çæ°æ®ï¼è¿æ¶ä¼æ³å°ä½¿ç¨ redis åçéç¾¤ï¼ä»èææ°æ®åæ£ä¿å­å°å¤ä¸ªå®ä¾ä¸ï¼ä½è¿æ ·ä¼å¯¼è´éç¾¤çå®ä¾è§æ¨¡å¢å ï¼è®©éç¾¤çè¿ç»´åå¾å¤æã\n\nè¿æä¸ç§æ¹æ³æ¯å¢å  redis åä¸ªå®ä¾çåå­å®¹éï¼å½¢æå¤§åå­å®ä¾ï¼ä»èåå°æéç redis å®ä¾çä¸ªæ°ãè¿æ¯ä¸ªå¥½ä¸»æï¼ä½å¹¶ä¸å®ç¾ï¼åºäºå¤§åå­çå¤§å®¹éå®ä¾å¨å®ä¾æ¢å¤ãä¸»ä»åæ­¥è¿ç¨ä¸­ä¼å¼èµ·ä¸ç³»åæ½å¨é®é¢ï¼ä¾å¦æ¢å¤æ¶é´å¢é¿ãä¸»ä»åæ¢å¼éå¤§ãç¼å²åºææº¢åºã\n\nè¿è¯¥æä¹åå¢ï¼ææ¨èä½ ä½¿ç¨åºæç¡¬çï¼ssdï¼ï¼å®ææ¬å¾ä½ï¼æ¯ gb çææ¬çº¦æ¯åå­çååä¹ä¸ï¼ï¼ä¸å®¹éå¤§ï¼è¯»åéåº¦å¿«ï¼æä»¬å¯ä»¥åºäºssdæ¥å®ç°å¤§å®¹éçrediså®ä¾ã360å¬å¸dbaååºç¡æ¶æç»èåå¼åç pika é®å¼æ°æ®åºï¼æ­£å¥½å®ç°äºè¿ä¸éæ±ã\n\npika å¨åå¼å§è®¾è®¡æ¶æä¸¤ä¸ªç®æ ï¼\n\n 1. åå®ä¾å¯ä»¥ä¿å­å¤§å®¹éæ°æ®ï¼åæ¶é¿åäºå®ä¾æ¢å¤åä¸»ä»åæ­¥æ¶çæ½å¨é®é¢ï¼\n 2. å redis æ°æ®ç±»åä¿æå¼å®¹ï¼å¯ä»¥æ¯æä½¿ç¨ redis çåºç¨å¹³æ»å°è¿ç§»å° pika ä¸ã\n\næä»¥ï¼å¦æä½ ä¸ç´å¨ä½¿ç¨ redisï¼å¹¶ä¸æ³ä½¿ç¨ ssd æ¥æ©å±åå®ä¾å®¹éï¼pika å°±æ¯ä¸ä¸ªå¾å¥½çéæ©ã\n\næ¬èå°åä»ç»åºäºå¤§åå­å®ç°å¤§å®¹é redis å®ä¾çæ½å¨é®é¢ï¼ç¶åä»ç» pika çç¸å³è®¾è®¡ã\n\n\n# 1.1 å¤§åå­ redis å®ä¾çæ½å¨é®é¢\n\nredis ä½¿ç¨åå­ä¿å­æ°æ®ï¼åå­å®¹éå¢å åï¼å°±ä¼å¸¦æ¥ä¸¤æ¹é¢çæ½å¨é®é¢ï¼\n\n * åå­å¿«ç§ rdb çæåæ¢å¤æçä½ï¼è¿ä¼å¯¼è´ redis å®ä¾é»å¡è¿ä¹ï¼\n * ä¸»ä»èç¹å¨éåæ­¥æ¶é¿å¢å ï¼å¦æ rdb æä»¶å¾å¤§ï¼ä¼å¯¼è´å¨éåæ­¥çæ¶é¿å¢å ï¼æçä¸é«ï¼èä¸è¿å¯è½ä¼å¯¼è´å¤å¶ç¼å²åºæº¢åºãä¸æ¦ç¼å²åºæº¢åºäºï¼ä¸»ä»èç¹é´å°±ä¼åå¼å§å¨éåæ­¥ï¼å½±åä¸å¡åºç¨çæ­£å¸¸ä½¿ç¨ãå¦ææä»¬å¢å å¤å¶ç¼å²åºçå®¹éï¼è¿åä¼æ¶èå®è´µçåå­èµæºã\n\né£ä¹ï¼pika æ¯å¦ä½è§£å³è¿ä¸¤æ¹é¢çé®é¢å¢ï¼è¿å°±è¦æå° pika ä¸­çå³é®æ¨¡å rocksdbãbinlog æºå¶å nemo äºï¼è¿äºæ¨¡åé½æ¯ pika æ¶æä¸­çéè¦ç»æé¨åã\n\n\n# 1.2 pika çæ´ä½æ¶æ\n\npika é®å¼æ°æ®åºçæ´ä½æ¶æä¸­åæ¬äºäºé¨åï¼åå«æ¯ç½ç»æ¡æ¶ãpika çº¿ç¨æ¨¡åãnemo å­å¨æ¨¡åãrocksdb å binlog æºå¶ï¼å¦ä¸å¾æç¤ºï¼\n\nè¿äºä¸ªé¨ååå«å®ç°äºä¸åçåè½ï¼ä¸é¢æä¸ä¸ªä¸ªæ¥ä»ç»ä¸ã\n\né¦åï¼ç½ç»æ¡æ¶ä¸»è¦è´è´£åºå±ç½ç»è¯·æ±çæ¥æ¶ååéãpikaçç½ç»æ¡æ¶æ¯å¯¹æä½ç³»ç»åºå±çç½ç»å½æ°è¿è¡äºå°è£ãpikaå¨è¿è¡ç½ç»éä¿¡æ¶ï¼å¯ä»¥ç´æ¥è°ç¨ç½ç»æ¡æ¶å°è£å¥½çå½æ°ã\n\nå¶æ¬¡ï¼pika çº¿ç¨æ¨¡åéç¨äºå¤çº¿ç¨æ¨¡åæ¥å·ä½å¤çå®¢æ·ç«¯è¯·æ±ï¼åæ¬ä¸ä¸ªè¯·æ±ååçº¿ç¨ï¼dispatchthreadï¼ãä¸ç»å·¥ä½çº¿ç¨ï¼workerthreadï¼ä»¥åä¸ä¸ªçº¿ç¨æ± ï¼threadpoolï¼ã\n\nè¯·æ±ååçº¿ç¨ä¸é¨çå¬ç½ç»ç«¯å£ï¼ä¸æ¦æ¥æ¶å°å®¢æ·ç«¯çè¿æ¥è¯·æ±åï¼å°±åå®¢æ·ç«¯å»ºç«è¿æ¥ï¼å¹¶æè¿æ¥äº¤ç±å·¥ä½çº¿ç¨å¤çãå·¥ä½çº¿ç¨è´è´£æ¥æ¶å®¢æ·ç«¯è¿æ¥ä¸åéçå·ä½å½ä»¤è¯·æ±ï¼å¹¶æå½ä»¤è¯·æ±å°è£ætaskï¼åäº¤ç»çº¿ç¨æ± ä¸­ççº¿ç¨ï¼ç±è¿äºçº¿ç¨è¿è¡å®éçæ°æ®å­åå¤çï¼å¦ä¸å¾æç¤ºï¼\n\nå¨å®éåºç¨pikaçæ¶åï¼æä»¬å¯ä»¥éè¿å¢å å·¥ä½çº¿ç¨æ°åçº¿ç¨æ± ä¸­ççº¿ç¨æ°ï¼æ¥æåpikaçè¯·æ±å¤çååçï¼è¿èæ»¡è¶³ä¸å¡å±å¯¹æ°æ®å¤çæ§è½çéæ±ã\n\nnemo æ¨¡åå¾å®¹æçè§£ï¼å®å®ç°äº pika å redis çæ°æ®ç±»åå¼å®¹ãè¿æ ·ä¸æ¥ï¼å½æä»¬æ redis æå¡è¿ç§»å° pika æ¶ï¼ä¸ç¨ä¿®æ¹ä¸å¡åºç¨ä¸­æä½ redis çä»£ç ï¼èä¸è¿å¯ä»¥ç»§ç»­åºç¨è¿ç»´ redis çç»éªï¼è¿ä½¿å¾ pika çå­¦ä¹ ææ¬å°±è¾ä½ãnemo æ¨¡åå¯¹æ°æ®ç±»åçå·ä½è½¬æ¢æºå¶æ¯æä»¬è¦éç¹å³å¿çï¼ä¸é¢æä¼å·ä½ä»ç»ã\n\næåï¼æä»¬åæ¥çç rocksdb æä¾çåºäºssdä¿å­æ°æ®çåè½ãå®ä½¿å¾ pika å¯ä»¥ä¸ç¨å¤§å®¹éçåå­ï¼å°±è½ä¿å­æ´å¤æ°æ®ï¼è¿é¿åäºä½¿ç¨åå­å¿«ç§ãèä¸ï¼pikaä½¿ç¨ binlog æºå¶è®°å½åå½ä»¤ï¼ç¨äºä¸»ä»èç¹çå½ä»¤åæ­¥ï¼é¿åäºååæè¯´çå¤§åå­å®ä¾å¨ä¸»ä»åæ­¥è¿ç¨ä¸­çæ½å¨é®é¢ã\n\næ¥ä¸æ¥ï¼æä»¬å°±æ¥å·ä½äºè§£ä¸ï¼pika æ¯å¦ä½ä½¿ç¨ rocksdb å binlog æºå¶çã\n\n\n# 1.3 pika å¦ä½åºäº ssd ä¿å­æ´å¤æ°æ®ï¼\n\n# 1.3.1 ä½¿ç¨ rocksdb æ¥å­å¨æ°æ®\n\nä¸ºäºææ°æ®ä¿å­å° ssdï¼pika ä½¿ç¨äºæä¹å kv æ°æ®åº rocksdbãè¿éåªéè¦äºè§£ rocksdb çåºæ¬æ°æ®è¯»åæºå¶å°±å¯ä»¥ï¼\n\n * memtable æ¯ä¸ä¸ªå°åå­ç©ºé´ï¼å¤§çº¦å mbæå åmbãä¸¤ä¸ª memtable æ¥äº¤æ¿ç¼å­åå¥æ°æ®ã\n\næ ¹æ®ä¸å¾å¯ä»¥çå°ï¼rocksdb ä¼åç¨ memtable ç¼å­æ°æ®ï¼åå°æ°æ®å¿«éåå¥ssdï¼å³ä½¿æ°æ®éåå¤§ï¼æææ°æ®ä¹é½è½ä¿å­å°ssdä¸­ãèä¸ï¼memtableæ¬èº«å®¹éä¸å¤§ï¼å³ä½¿rocksdbä½¿ç¨äºä¸¤ä¸ªmemtableï¼ä¹ä¸ä¼å ç¨è¿å¤çåå­ï¼è¿æ ·ä¸æ¥ï¼pikaå¨ä¿å­å¤§å®¹éæ°æ®æ¶ï¼ä¹ä¸ç¨å æ®å¤ªå¤§çåå­ç©ºé´äºã\n\næ°æ®æ¥æ¾æ¹æ³ï¼å½pikaéè¦è¯»åæ°æ®çæ¶åï¼rocksdbä¼åå¨memtableä¸­æ¥è¯¢æ¯å¦æè¦è¯»åçæ°æ®ãè¿æ¯å ä¸ºï¼ææ°çæ°æ®é½æ¯ååå¥å°memtableä¸­çãå¦æmemtableä¸­æ²¡æè¦è¯»åçæ°æ®ï¼rocksdbä¼åæ¥è¯¢ä¿å­å¨ssdä¸çæ°æ®æä»¶ï¼å¦ä¸å¾æç¤ºï¼\n\nå°è¿éï¼ä½ å°±äºè§£äºï¼å½ä½¿ç¨äºrocksdbä¿å­æ°æ®åï¼pikaå°±å¯ä»¥æå¤§éæ°æ®ä¿å­å°å¤§å®¹éçssdä¸äºï¼å®ç°äºå¤§å®¹éå®ä¾ã\n\nä¸è¿ï¼æåæåä½ ä»ç»è¿ï¼å½ä½¿ç¨å¤§åå­å®ä¾ä¿å­å¤§éæ°æ®æ¶ï¼redisä¼é¢ä¸´rdbçæåæ¢å¤çæçé®é¢ï¼ä»¥åä¸»ä»åæ­¥æ¶çæçåç¼å²åºæº¢åºé®é¢ãé£ä¹ï¼å½pikaä¿å­å¤§éæ°æ®æ¶ï¼è¿ä¼é¢ä¸´ç¸åçé®é¢åï¼å¶å®ä¸ä¼äºï¼æ¥ä¸æ¥åæä¸ä¸ã\n\n * ä¸æ¹é¢ï¼pikaåºäºrocksdbä¿å­äºæ°æ®æä»¶ï¼ç´æ¥è¯»åæ°æ®æä»¶å°±è½æ¢å¤ï¼ä¸éè¦åéè¿åå­å¿«ç§è¿è¡æ¢å¤äºãèä¸ï¼pikaä»åºå¨è¿è¡å¨éåæ­¥æ¶ï¼å¯ä»¥ç´æ¥ä»ä¸»åºæ·è´æ°æ®æä»¶ï¼ä¸éè¦ä½¿ç¨åå­å¿«ç§ï¼è¿æ ·ä¸æ¥ï¼pikaå°±é¿åäºå¤§åå­å¿«ç§çææçä½çé®é¢ã\n * å¦ä¸æ¹é¢ï¼pikaä½¿ç¨äºbinlogæºå¶å®ç°å¢éå½ä»¤åæ­¥ï¼æ¢èçäºåå­ï¼è¿é¿åäºç¼å²åºæº¢åºçé®é¢ãbinlogæ¯ä¿å­å¨ssdä¸çæä»¶ï¼pikaæ¥æ¶å°åå½ä»¤åï¼å¨ææ°æ®åå¥memtableæ¶ï¼ä¹ä¼æå½ä»¤æä½åå°binlogæä»¶ä¸­ãåredisç±»ä¼¼ï¼å½å¨éåæ­¥ç»æåï¼ä»åºä¼ä»binlogä¸­æå°æªåæ­¥çå½ä»¤è¯»åè¿æ¥ï¼è¿æ ·å°±å¯ä»¥åä¸»åºçæ°æ®ä¿æä¸è´ãå½è¿è¡å¢éåæ­¥æ¶ï¼ä»åºä¹æ¯æèªå·±å·²ç»å¤å¶çåç§»éåç»ä¸»åºï¼ä¸»åºæå°æªåæ­¥çå½ä»¤åç»ä»åºï¼æ¥ä¿æä¸»ä»åºçæ°æ®ä¸è´ã\n\nåredisä½¿ç¨ç¼å²åºç¸æ¯ï¼ä½¿ç¨binlogå¥½å¤æ¯éå¸¸ææ¾çï¼binlogæ¯ä¿å­å¨ssdä¸çæä»¶ï¼æä»¶å¤§å°ä¸åç¼å²åºï¼ä¼åå°åå­å®¹éçè¾å¤éå¶ãèä¸ï¼å½binlogæä»¶å¢å¤§åï¼è¿å¯ä»¥éè¿è½®æ¿æä½ï¼çææ°çbinlogæä»¶ï¼åææ§çbinlogæä»¶ç¬ç«ä¿å­ãè¿æ ·ä¸æ¥ï¼å³ä½¿pikaå®ä¾ä¿å­äºå¤§éçæ°æ®ï¼å¨åæ­¥è¿ç¨ä¸­ä¹ä¸ä¼åºç°ç¼å²åºæº¢åºçé®é¢äºã\n\nç®åå°ç»ä¸ï¼pika ä½¿ç¨ rocksdb æå¤§éæ°æ®ä¿å­å°äº ssdï¼åæ¶é¿åäºåå­å¿«ç§ççæåæ¢å¤é®é¢ãèä¸ï¼pika ä½¿ç¨ binlog æºå¶è¿è¡ä¸»ä»åæ­¥ï¼é¿åå¤§åå­æ¶çå½±åï¼pika çç¬¬ä¸ä¸ªè®¾è®¡ç®æ å°±å®ç°äºã\n\næ¥ä¸æ¥ï¼æä»¬åæ¥ç pika æ¯å¦ä½å®ç°ç¬¬äºä¸ªè®¾è®¡ç®æ çï¼ä¹å°±æ¯å¦ä½å redis å¼å®¹ãæ¯ç«ï¼å¦æä¸å¼å®¹çè¯ï¼åæ¥ä½¿ç¨ redis çä¸å¡å°±æ æ³å¹³æ»è¿ç§»å° pika ä¸ä½¿ç¨äºï¼ä¹å°±æ²¡åæ³å©ç¨ pika ä¿å­å¤§å®¹éæ°æ®çä¼å¿äºã\n\n\n# 1.4 pika å¦ä½å®ç° redis æ°æ®ç±»åå¼å®¹ï¼\n\npika çåºå±å­å¨ä½¿ç¨äº rocksdb æ¥ä¿å­æ°æ®ï¼ä½æ¯ï¼rocksdb åªæä¾äºåå¼çé®å¼å¯¹ç±»åï¼è redis é®å¼å¯¹ä¸­çå¼å´å¯ä»¥æ¯éåç±»åãè¿æ ·ï¼å¯¹äºéåç±»åå°±æ æ³ç´æ¥å­å¨å¨ rocksdb ä¸­ï¼éè¦ pika ç nemo æ¨¡åæ¥å®æå° redis éåç±»å -> åå¼ kv çè½¬æ¢ã\n\nç®åæ¥è¯´ï¼å¯ä»¥å° redis çéåç±»ååæä¸¤ç±»ï¼\n\n * ä¸ç±»æ¯ list å set ç±»åï¼å®ä»¬çéåä¸­æ¯ä¸ªåç´ é½æ¯åå¼ï¼\n * å¦ä¸ç±»æ¯ hash å sorted set ç±»åï¼å®ä»¬çéåä¸­çåç´ é½æ¯ pairï¼å¶ä¸­ï¼hash éååç´ æ¯ field-value ç±»åï¼è sorted set éååç´ æ¯ member-score ç±»åã\n\nä¸é¢çä¸ä¸ nemo æ¨¡åæ¯å¦ä½åçè¿ç§è½¬æ¢ã\n\n# 1.4.1 list ç±»å\n\nå¨pikaä¸­ï¼listéåçkeyè¢«åµå¥å°äºåå¼é®å¼å¯¹çé®å½ä¸­ï¼ç¨keyå­æ®µè¡¨ç¤ºï¼èlistéåçåç´ å¼ï¼åè¢«åµå¥å°åå¼é®å¼å¯¹çå¼å½ä¸­ï¼ç¨valueå­æ®µè¡¨ç¤ºãå ä¸ºlistéåä¸­çåç´ æ¯æåºçï¼æä»¥ï¼nemoæ¨¡åè¿å¨åå¼é®å¼å¯¹çkeyåé¢å¢å äºsequenceå­æ®µï¼è¡¨ç¤ºå½ååç´ å¨listä¸­çé¡ºåºï¼åæ¶ï¼è¿å¨valueçåé¢å¢å äºprevious sequenceånext sequenceè¿ä¸¤ä¸ªå­æ®µï¼åå«è¡¨ç¤ºå½ååç´ çåä¸ä¸ªåç´ ååä¸ä¸ªåç´ ã\n\næ­¤å¤ï¼å¨åå¼é®å¼å¯¹çkeyåé¢ï¼nemoæ¨¡åè¿å¢å äºä¸ä¸ªå¼âlâï¼è¡¨ç¤ºå½åæ°æ®æ¯listç±»åï¼ä»¥åå¢å äºä¸ä¸ª1å­èçsizeå­æ®µï¼è¡¨ç¤ºlistéåkeyçå¤§å°ãå¨åå¼é®å¼å¯¹çvalueåé¢ï¼nemoæ¨¡åè¿å¢å äºversionåttlå­æ®µï¼åå«è¡¨ç¤ºå½åæ°æ®ççæ¬å·åå©ä½å­æ´»æ¶é´ï¼ç¨æ¥æ¯æè¿ækeyåè½ï¼ï¼å¦ä¸å¾æç¤ºï¼\n\n# 1.4.2 set ç±»å\n\nsetéåçkeyååç´ memberå¼ï¼é½è¢«åµå¥å°äºpikaåå¼é®å¼å¯¹çé®å½ä¸­ï¼åå«ç¨keyåmemberå­æ®µè¡¨ç¤ºãåæ¶ï¼ålistéåç±»ä¼¼ï¼åå¼é®å¼å¯¹çkeyåé¢æå¼âsâï¼ç¨æ¥è¡¨ç¤ºæ°æ®æ¯setç±»åï¼åæ¶è¿æsizeå­æ®µï¼ç¨æ¥è¡¨ç¤ºkeyçå¤§å°ãpikaåå¼é®å¼å¯¹çå¼åªä¿å­äºæ°æ®ççæ¬ä¿¡æ¯åå©ä½å­æ´»æ¶é´ï¼å¦ä¸å¾æç¤ºï¼\n\n# 1.4.3 hash ç±»å\n\nå¯¹äºhashç±»åæ¥è¯´ï¼hashéåçkeyè¢«åµå¥å°åå¼é®å¼å¯¹çé®å½ä¸­ï¼ç¨keyå­æ®µè¡¨ç¤ºï¼èhashéååç´ çfieldä¹è¢«åµå¥å°åå¼é®å¼å¯¹çé®å½ä¸­ï¼ç´§æ¥çkeyå­æ®µï¼ç¨fieldå­æ®µè¡¨ç¤ºãhashéååç´ çvalueåæ¯åµå¥å°åå¼é®å¼å¯¹çå¼å½ä¸­ï¼å¹¶ä¸ä¹å¸¦æçæ¬ä¿¡æ¯åå©ä½å­æ´»æ¶é´ï¼å¦ä¸å¾æç¤ºï¼\n\n# 1.4.4 sorted set ç±»å\n\nå¯¹äºsorted setç±»åæ¥è¯´ï¼è¯¥ç±»åæ¯éè¦è½å¤æç§éååç´ çscoreå¼æåºçï¼èrocksdbåªæ¯ææç§åå¼é®å¼å¯¹çé®æ¥æåºãæä»¥ï¼nemoæ¨¡åå¨è½¬æ¢æ°æ®æ¶ï¼å°±æsorted setéåkeyãåç´ çscoreåmemberå¼é½åµå¥å°äºåå¼é®å¼å¯¹çé®å½ä¸­ï¼æ­¤æ¶ï¼åå¼é®å¼å¯¹ä¸­çå¼åªä¿å­äºæ°æ®ççæ¬ä¿¡æ¯åå©ä½å­æ´»æ¶é´ï¼å¦ä¸å¾æç¤ºï¼\n\néç¨äºä¸é¢çè½¬æ¢æ¹å¼ä¹åï¼pikaä¸ä»è½å¼å®¹æ¯æredisçæ°æ®ç±»åï¼èä¸è¿ä¿çäºè¿äºæ°æ®ç±»åçç¹å¾ï¼ä¾å¦listçåç´ ä¿åºãsorted setçåç´ æscoreæåºãäºè§£äºpikaçè½¬æ¢æºå¶åï¼ä½ å°±ä¼æç½ï¼å¦æä½ æä¸å¡åºç¨è®¡åä»ä½¿ç¨redisåæ¢å°ä½¿ç¨pikaï¼å°±ä¸ç¨æå¿é¢ä¸´å ä¸ºæä½æ¥å£ä¸å¼å®¹èè¦ä¿®æ¹ä¸å¡åºç¨çé®é¢äºã\n\n----------------------------------------\n\nåé¢åæäº pika çä¸¤å¤§ä¼å¿ï¼\n\n * åºäº ssd ä¿å­å¤§éæ°æ®\n * ä¸ redis å¼å®¹\n\næ¥ä¸æ¥çä¸ä¸ pika çå¶ä»ä¼å¿åæ½å¨ä¸è¶³ã\n\n\n# 1.5 pika çå¶ä»ä¼å¿ä¸ä¸è¶³\n\nè·redisç¸æ¯ï¼pikaæå¤§çç¹ç¹å°±æ¯ä½¿ç¨äºssdæ¥ä¿å­æ°æ®ï¼è¿ä¸ªç¹ç¹è½å¸¦æ¥çæç´æ¥å¥½å¤å°±æ¯ï¼pikaåå®ä¾è½ä¿å­æ´å¤çæ°æ®äºï¼å®ç°äºå®ä¾æ°æ®æ©å®¹ãé¤æ­¤ä¹å¤ï¼pika è¿æä¸¤ä¸ªé¢å¤ä¼å¿ï¼\n\n * å®ä¾éå¯å¿«ãpikaçæ°æ®å¨åå¥æ°æ®åºæ¶ï¼æ¯ä¼ä¿å­å°ssdä¸çãå½pikaå®ä¾éå¯æ¶ï¼å¯ä»¥ç´æ¥ä»ssdä¸çæ°æ®æä»¶ä¸­è¯»åæ°æ®ï¼ä¸éè¦åredisä¸æ ·ï¼ä»rdbæä»¶å¨é¨éæ°å è½½æ°æ®ææ¯ä»aofæä»¶ä¸­å¨é¨åæ¾æä½ï¼è¿æå¤§å°æé«äºpikaå®ä¾çéå¯éåº¦ï¼å¯ä»¥å¿«éå¤çä¸å¡åºç¨è¯·æ±ã\n * ä¸»ä»åºéæ°æ§è¡å¨éåæ­¥çé£é©ä½ãpikaéè¿binlogæºå¶å®ç°åå½ä»¤çå¢éåæ­¥ï¼ä¸åååå­ç¼å²åºå¤§å°çéå¶ï¼æä»¥ï¼å³ä½¿å¨æ°æ®éå¾å¤§å¯¼è´ä¸»ä»åºåæ­¥èæ¶å¾é¿çæåµä¸ï¼pikaä¹ä¸ç¨æå¿ç¼å²åºæº¢åºèè§¦åçä¸»ä»åºéæ°å¨éåæ­¥ã\n\nä½ pika ä¹æä¸äºä¸è¶³ï¼\n\nè½ç¶å®ä¿æäºredisæä½æ¥å£ï¼ä¹è½å®ç°æ°æ®åºæ©å®¹ï¼ä½å½ææ°æ®ä¿å­å°ssdä¸åï¼ä¼éä½æ°æ®çè®¿é®æ§è½ãè¿æ¯å ä¸ºï¼æ°æ®æä½æ¯ç«ä¸è½å¨åå­ä¸­ç´æ¥æ§è¡äºï¼èæ¯è¦å¨åºå±çssdä¸­è¿è¡å­åï¼è¿è¯å®ä¼å½±åï¼pikaçæ§è½ãèä¸ï¼æä»¬è¿éè¦æbinlogæºå¶è®°å½çåå½ä»¤åæ­¥å°ssdä¸ï¼è¿ä¼éä½pikaçåæ§è½ã\n\nä¸è¿ï¼pikaçå¤çº¿ç¨æ¨¡åï¼å¯ä»¥åæ¶ä½¿ç¨å¤ä¸ªçº¿ç¨è¿è¡æ°æ®è¯»åï¼è¿å¨ä¸å®ç¨åº¦ä¸å¼¥è¡¥äºä»ssdå­åæ°æ®é æçæ§è½æå¤±ãå½ç¶ï¼ä½ ä¹å¯ä»¥ä½¿ç¨é«éçssdæ¥æåè®¿é®æ§è½ï¼è¿èåå°è¯»åssdå¯¹pikaæ§è½çå½±åã\n\nä¸ºäºå¸®å©ä½ æ´ç´è§å°äºè§£pikaçæ§è½æåµï¼æåç»ä½ æä¾ä¸å¼ è¡¨ï¼è¿æ¯pika å®ç½ ä¸æä¾çæµè¯æ°æ®ï¼\n\nè¿äºæ°æ®æ¯å¨pika 3.2çæ¬ä¸­ï¼stringåhashç±»åå¨å¤çº¿ç¨æåµä¸çåºæ¬æä½æ§è½ç»æãä»è¡¨ä¸­å¯ä»¥çå°ï¼å¨ä¸åbinlogæ¶ï¼pikaçset/getãhset/hgetçæ§è½é½è½è¾¾å°200k opsä»¥ä¸ï¼èä¸æ¦å¢å äºåbinlogæä½ï¼setåhsetæä½æ§è½å¤§çº¦ä¸éäº41%ï¼åªæçº¦120k opsã\n\næä»¥ï¼æä»¬å¨ä½¿ç¨pikaæ¶ï¼éè¦å¨åå®ä¾æ©å®¹çå¿è¦æ§åå¯è½çæ§è½æå¤±é´åä¸ªæè¡¡ãå¦æä¿å­å¤§å®¹éæ°æ®æ¯æä»¬çé¦è¦éæ±ï¼é£ä¹ï¼pikaæ¯ä¸ä¸ªä¸éçè§£å³æ¹æ¡ã\n\n\n# 1.6 å°ç»\n\nè¿èè¯¾ï¼æä»¬å­¦ä¹ äºåºäºssdç»redisåå®ä¾è¿è¡æ©å®¹çææ¯æ¹æ¡pikaãè·redisç¸æ¯ï¼pikaçå¥½å¤éå¸¸ææ¾ï¼æ¢æ¯æredisæä½æ¥å£ï¼åè½æ¯æä¿å­å¤§å®¹éçæ°æ®ãå¦æä½ åæ¥å°±å¨åºç¨redisï¼ç°å¨æ³è¿è¡æ©å®¹ï¼é£ä¹ï¼pikaæ çæ¯ä¸ä¸ªå¾å¥½çéæ©ï¼æ è®ºæ¯ä»£ç è¿ç§»è¿æ¯è¿ç»´ç®¡çï¼pikaåºæ¬ä¸éè¦é¢å¤çå·¥ä½éã\n\nä¸è¿ï¼pikaæ¯ç«æ¯ææ°æ®ä¿å­å°äºssdä¸ï¼æ°æ®è®¿é®è¦è¯»åssdï¼æä»¥ï¼è¯»åæ§è½è¦å¼±äºredisãéå¯¹è¿ä¸ç¹ï¼æç»ä½ æä¾ä¸¤ä¸ªéä½è¯»åssdå¯¹pikaçæ§è½å½±åçå°å»ºè®®ï¼\n\n 1. å©ç¨pikaçå¤çº¿ç¨æ¨¡åï¼å¢å çº¿ç¨æ°éï¼æåpikaçå¹¶åè¯·æ±å¤çè½åï¼\n 2. ä¸ºpikaéç½®é«éçssdï¼æåssdèªèº«çè®¿é®æ§è½ã\n\næåï¼ææ³åç»ä½ ä¸ä¸ªå°æç¤ºãpikaæ¬èº«æä¾äºå¾å¤å·¥å·ï¼å¯ä»¥å¸®å©æä»¬æredisæ°æ®è¿ç§»å°pikaï¼æèæ¯æredisè¯·æ±è½¬åç»pikaãæ¯å¦è¯´ï¼æä»¬ä½¿ç¨aof_to_pikaå½ä»¤ï¼å¹¶ä¸æå®redisçaofæä»¶ä»¥åpikaçè¿æ¥ä¿¡æ¯ï¼å°±å¯ä»¥æredisæ°æ®è¿ç§»å°pikaä¸­äºï¼å¦ä¸æç¤ºï¼\n\naof_to_pika -i [redis aofæä»¶] -h [pika ip] -p [pika port] -a [è®¤è¯ä¿¡æ¯]\n\n\n1\n\n\nå³äºè¿äºå·¥å·çä¿¡æ¯ï¼ä½ é½å¯ä»¥ç´æ¥å¨pikaç github ä¸æ¾å°ãèä¸ï¼pikaæ¬èº«ä¹è¿å¨è¿­ä»£å¼åä¸­ï¼æä¹å»ºè®®ä½ å¤å»ççgithubï¼è¿ä¸æ­¥å°äºè§£å®ãè¿æ ·ï¼ä½ å°±å¯ä»¥è·å¾pikaçææ°è¿å±ï¼ä¹è½æ´å¥½å°æå®åºç¨å°ä½ çä¸å¡å®è·µä¸­ã",charsets:{cjk:!0},lastUpdated:"2023/04/18, 14:13:32",lastUpdatedTimestamp:1681827212e3},{title:"æ éçåå­æä½ååå¸å¼é",frontmatter:{title:"æ éçåå­æä½ååå¸å¼é",date:"2023-04-18T20:18:11.000Z",permalink:"/pages/5a1b01/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/29.%E6%97%A0%E9%94%81%E7%9A%84%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E5%92%8C%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/29.æ éçåå­æä½ååå¸å¼é.md",key:"v-35ef0b3a",path:"/pages/5a1b01/",headers:[{level:2,title:"1. æ éçåå­æä½",slug:"_1-æ éçåå­æä½",normalizedTitle:"1. æ éçåå­æä½",charIndex:252},{level:3,title:"1.1 å¹¶åè®¿é®ä¸­éè¦å¯¹ä»ä¹è¿è¡æ§å¶ï¼",slug:"_1-1-å¹¶åè®¿é®ä¸­éè¦å¯¹ä»ä¹è¿è¡æ§å¶",normalizedTitle:"1.1 å¹¶åè®¿é®ä¸­éè¦å¯¹ä»ä¹è¿è¡æ§å¶ï¼",charIndex:357},{level:3,title:"1.2 Redis çä¸¤ç§åå­æä½æ¹æ³",slug:"_1-2-redis-çä¸¤ç§åå­æä½æ¹æ³",normalizedTitle:"1.2 redis çä¸¤ç§åå­æä½æ¹æ³",charIndex:1119},{level:4,title:"1.2.1 Redis æ¬èº«çåå½ä»¤æä½",slug:"_1-2-1-redis-æ¬èº«çåå½ä»¤æä½",normalizedTitle:"1.2.1 redis æ¬èº«çåå½ä»¤æä½",charIndex:1261},{level:4,title:"1.2.2 Lua èæ¬",slug:"_1-2-2-lua-èæ¬",normalizedTitle:"1.2.2 lua èæ¬",charIndex:1660},{level:2,title:"2. å¦ä½ä½¿ç¨ Redis å®ç°åå¸å¼éï¼",slug:"_2-å¦ä½ä½¿ç¨-redis-å®ç°åå¸å¼é",normalizedTitle:"2. å¦ä½ä½¿ç¨ redis å®ç°åå¸å¼éï¼",charIndex:3305},{level:3,title:"2.1 åæºä¸çéååå¸å¼éçèç³»ä¸åºå«",slug:"_2-1-åæºä¸çéååå¸å¼éçèç³»ä¸åºå«",normalizedTitle:"2.1 åæºä¸çéååå¸å¼éçèç³»ä¸åºå«",charIndex:3561},{level:3,title:"2.2 åºäºåä¸ª Redis èç¹å®ç°åå¸å¼é",slug:"_2-2-åºäºåä¸ª-redis-èç¹å®ç°åå¸å¼é",normalizedTitle:"2.2 åºäºåä¸ª redis èç¹å®ç°åå¸å¼é",charIndex:4276},{level:3,title:"2.3 åºäºå¤ä¸ª Redis èç¹å®ç°é«å¯é çåå¸å¼é",slug:"_2-3-åºäºå¤ä¸ª-redis-èç¹å®ç°é«å¯é çåå¸å¼é",normalizedTitle:"2.3 åºäºå¤ä¸ª redis èç¹å®ç°é«å¯é çåå¸å¼é",charIndex:6518},{level:3,title:"2.4 å°ç»",slug:"_2-4-å°ç»",normalizedTitle:"2.4 å°ç»",charIndex:7713}],headersStr:"1. æ éçåå­æä½ 1.1 å¹¶åè®¿é®ä¸­éè¦å¯¹ä»ä¹è¿è¡æ§å¶ï¼ 1.2 Redis çä¸¤ç§åå­æä½æ¹æ³ 1.2.1 Redis æ¬èº«çåå½ä»¤æä½ 1.2.2 Lua èæ¬ 2. å¦ä½ä½¿ç¨ Redis å®ç°åå¸å¼éï¼ 2.1 åæºä¸çéååå¸å¼éçèç³»ä¸åºå« 2.2 åºäºåä¸ª Redis èç¹å®ç°åå¸å¼é 2.3 åºäºå¤ä¸ª Redis èç¹å®ç°é«å¯é çåå¸å¼é 2.4 å°ç»",content:'> åèï¼\n> \n>  * 29 æ éçåå­æä½ï¼Redis å¦ä½åºå¯¹å¹¶åè®¿é®ï¼| æå®¢æ¶é´\n>  * 30 å¦ä½ä½¿ç¨ Redis å®ç°åå¸å¼éï¼| æå®¢æ¶é´\n\nå¹¶åè®¿é®æ§å¶ï¼æ¯æå¯¹å¤ä¸ªå®¢æ·ç«¯è®¿é®æä½åä¸ä»½æ°æ®çè¿ç¨è¿è¡æ§å¶ï¼ä»¥ä¿è¯ä»»ä½ä¸ä¸ªå®¢æ·ç«¯åéçæä½å¨Rediså®ä¾ä¸æ§è¡æ¶å·æäºæ¥æ§ãä¾å¦ï¼å®¢æ·ç«¯Açè®¿é®æä½å¨æ§è¡æ¶ï¼å®¢æ·ç«¯Bçæä½ä¸è½æ§è¡ï¼éè¦ç­å°Açæä½ç»æåï¼æè½æ§è¡ã\n\nä¸å¡ç³»ç»ä¸å¯é¿åä¼éå°å¹¶åè®¿é®çé®é¢ï¼ä¸ºä¿è¯å¹¶åè®¿é®çæ­£ç¡®æ§ï¼Redis æä¾äºä¸¤ç§æ¹æ³ï¼å éååå­æä½ã\n\n\n# 1. æ éçåå­æä½\n\nåå­æä½æ¯ä¸ç§æä¾å¹¶åè®¿é®æ§å¶çæ¹æ³ï¼æ¯ææ§è¡è¿ç¨ä¿æåå­æ§çæä½ï¼èä¸åå­æä½æ§è¡æ¶å¹¶ä¸éè¦åå éï¼å®ç°äºæ éæä½ãè¿æ ·ä¸æ¥ï¼æ¢è½ä¿è¯å¹¶åæ§å¶ï¼è¿è½åå°å¯¹ç³»ç»å¹¶åæ§è½çå½±åã\n\n\n# 1.1 å¹¶åè®¿é®ä¸­éè¦å¯¹ä»ä¹è¿è¡æ§å¶ï¼\n\nå¹¶åè®¿é®æ§å¶å¯¹åºçæä½ä¸»è¦æ¯æ°æ®ä¿®æ¹æä½ãå½å®¢æ·ç«¯éè¦ä¿®æ¹æ°æ®æ¶ï¼åºæ¬æµç¨åæä¸¤æ­¥ï¼\n\n 1. å®¢æ·ç«¯åææ°æ®è¯»åå°æ¬å°ï¼å¨æ¬å°è¿è¡ä¿®æ¹ï¼\n 2. å®¢æ·ç«¯ä¿®æ¹å®æ°æ®åï¼ååå Redisã\n\nè¿ä¸ªæµç¨è¢«ç§°ä¸º Read-Modify-Writeï¼RMWï¼æä½ãå½æå¤ä¸ªå®¢æ·ç«¯å¯¹åä¸ä»½æ°æ®æ§è¡RMWæä½çè¯ï¼æä»¬å°±éè¦è®©RMWæä½æ¶åçä»£ç ä»¥åå­æ§æ¹å¼æ§è¡ãè®¿é®åä¸ä»½æ°æ®çRMWæä½ä»£ç ï¼å°±å«åä¸´çåºä»£ç ã\n\nä¸è¿ï¼å½æå¤ä¸ªå®¢æ·ç«¯å¹¶åæ§è¡ä¸´çåºä»£ç æ¶ï¼å°±ä¼å­å¨ä¸äºæ½å¨é®é¢ï¼æ¥ä¸æ¥ï¼æç¨ä¸ä¸ªå¤å®¢æ·ç«¯æ´æ°åååºå­çä¾å­æ¥è§£éä¸ä¸ã\n\næä»¬åçä¸ä¸´çåºä»£ç ãåè®¾å®¢æ·ç«¯è¦å¯¹åååºå­æ§è¡æ£å1çæä½ï¼ä¼ªä»£ç å¦ä¸æç¤ºï¼\n\ncurrent = GET(id)\ncurrent--\nSET(id, current)\n\n\n1\n2\n3\n\n\nå¦ææä»¬å¯¹ä¸´çåºä»£ç çæ§è¡æ²¡ææ§å¶æºå¶ï¼å°±å¯è½åºç°æ°æ®æ´æ°éè¯¯ãå¦ä¸å¾æ¯ä¸¤ä¸ªå®¢æ·ç«¯åæ¶æ§è¡ä¸´çåºä»£ç èå¯¼è´çéè¯¯ï¼\n\nä¸å¾ç¸æ¯äºæ­£ç¡®çå¤çé»è¾ï¼åºå­å¼ææ¾æ´æ°éäºãåºç°è¿ä¸ªç°è±¡çåå æ¯ï¼å¤ä¸ªå®¢æ·ç«¯ç RMW è¿ä¸ä¸ªæä½å¨æ§è¡æ¶ä¸å·æäºæ¥æ§ï¼ä¸¤ä¸ªå®¢æ·ç«¯åºäºç¸åçåå§å¼è¿è¡ä¿®æ¹ï¼èä¸æ¯åºäºåä¸ä¸ªå®¢æ·ç«¯ä¿®æ¹åçå¼åä¿®æ¹ã\n\nä¸ºäºä¿è¯æ°æ®å¹¶åä¿®æ¹çæ­£ç¡®æ§ï¼æä»¬å¯ä»¥ä½¿ç¨éæ¥æ§å¶ä¸´çåºä»£ç çæ§è¡æåµï¼å¦ä¸æç¤ºï¼\n\nÂ \n\n\n\nÂ \n\n\nLOCK()\ncurrent = GET(id)\ncurrent--\nSET(id, current)\nUNLOCK()\n\n\n1\n2\n3\n4\n5\n\n\nè½ç¶å éä¿è¯äºäºæ¥æ§ï¼ä½æ¯å éä¼éä½å¹¶åæ§è½ã\n\nåå éç±»ä¼¼ï¼åå­æä½ä¹è½å®ç°å¹¶åæ§å¶ï¼ä½æ¯åå­æä½å¯¹ç³»ç»å¹¶åæ§è½çå½±åè¾å°ï¼æ¥ä¸æ¥ï¼æä»¬å°±æ¥äºè§£ä¸ Redis ä¸­çåå­æä½ã\n\n\n# 1.2 Redis çä¸¤ç§åå­æä½æ¹æ³\n\nä¸ºäºå®ç°å¹¶åæ§å¶è¦æ±çä¸´çåºä»£ç äºæ¥æ§è¡ï¼Redisçåå­æä½éç¨äºä¸¤ç§æ¹æ³ï¼\n\n 1. æå¤ä¸ªæä½å¨ Redis ä¸­å®ç°æä¸ä¸ªæä½ï¼ä¹å°±æ¯åå½ä»¤æä½ï¼\n 2. æå¤ä¸ªæä½åå°ä¸ä¸ª Lua èæ¬ä¸­ï¼ä»¥åå­æ§æ¹å¼æ§è¡åä¸ª Lua èæ¬ã\n\n# 1.2.1 Redis æ¬èº«çåå½ä»¤æä½\n\nRedis æ¯ä½¿ç¨åçº¿ç¨æ¥ä¸²è¡å¤çå®¢æ·ç«¯çè¯·æ±æä½å½ä»¤çï¼æä»¥ï¼å½ Redis æ§è¡æä¸ªå½ä»¤æä½æ¶ï¼å¶ä»å½ä»¤æ¯æ æ³æ§è¡çï¼è¿ç¸å½äºå½ä»¤æä½æ¯äºæ¥æ§è¡çãå½ç¶ï¼Redis çå¿«ç§çæãAOF éåè¿äºæä½ï¼å¯ä»¥ä½¿ç¨åå°çº¿ç¨æèæ¯å­è¿ç¨æ§è¡ï¼ä¹å°±æ¯åä¸»çº¿ç¨çæä½å¹¶è¡æ§è¡ãä¸è¿ï¼è¿äºæä½åªæ¯è¯»åæ°æ®ï¼ä¸ä¼ä¿®æ¹æ°æ®ï¼æä»¥ï¼æä»¬å¹¶ä¸éè¦å¯¹å®ä»¬åå¹¶åæ§å¶ã\n\nå¦å¤ï¼Redis è¿æä¾äº INCR/DECR å½ä»¤å¯¹æ°æ®è¿è¡å¢å¼/åå¼æä½ãï¼è¿ä¸ªå½ä»¤å° RMW ä¸ä¸ªæä½åä¸ºä¸ä¸ªåå­æä½äºã\n\næ¯å¦è¯´ï¼å¨åæçåºå­æ£åä¾å­ä¸­ï¼å®¢æ·ç«¯å¯ä»¥ä½¿ç¨ä¸é¢çä»£ç ï¼ç´æ¥å®æå¯¹ååidçåºå­å¼å1æä½ãå³ä½¿æå¤ä¸ªå®¢æ·ç«¯æ§è¡ä¸é¢çä»£ç ï¼ä¹ä¸ç¨æå¿åºç°åºå­å¼æ£åéè¯¯çé®é¢ï¼\n\nDECR id\n\n\n1\n\n\nä½å½æä»¬æ³è¦å°æ´å¤æçæä½åæåå­æä½æ¶ï¼å°±éè¦ä½¿ç¨ Lua èæ¬äºã\n\n# 1.2.2 Lua èæ¬\n\nRedis ä¼ææ´ä¸ª Lua èæ¬ä½ä¸ºä¸ä¸ªæ´ä½ä½¿ç¨ EVAL å½ä»¤æ¥æ§è¡ï¼å¨æ§è¡çè¿ç¨ä¸­ä¸ä¼è¢«å¶ä»å½ä»¤ææ­ï¼ä»èä¿è¯äº Lua èæ¬ä¸­æä½çåå­æ§ã\n\nä¸é¢ä¸¾ä¸ªä¾å­æ¥è§£é Lua çä½¿ç¨ãå½ä¸ä¸ªä¸å¡åºç¨çè®¿é®ç¨æ·å¢å æ¶ï¼æä»¬ææ¶éè¦éå¶æä¸ªå®¢æ·ç«¯å¨ä¸å®æ¶é´èå´åçè®¿é®æ¬¡æ°ï¼æ¯å¦çæ¬¾ååçè´­ä¹°éæµãç¤¾äº¤ç½ç»ä¸­çæ¯åéç¹èµæ¬¡æ°éå¶ç­ã\n\né£è¯¥æä¹éå¶å¢ï¼æä»¬å¯ä»¥æå®¢æ·ç«¯IPä½ä¸ºkeyï¼æå®¢æ·ç«¯çè®¿é®æ¬¡æ°ä½ä¸ºvalueï¼ä¿å­å°Redisä¸­ãå®¢æ·ç«¯æ¯è®¿é®ä¸æ¬¡åï¼æä»¬å°±ç¨INCRå¢å è®¿é®æ¬¡æ°ãä¸è¿ï¼å¨è¿ç§åºæ¯ä¸ï¼å®¢æ·ç«¯éæµå¶å®åæ¶åå«äºå¯¹è®¿é®æ¬¡æ°åæ¶é´èå´çéå¶ï¼ä¾å¦æ¯åéçè®¿é®æ¬¡æ°ä¸è½è¶è¿20ãæä»¥ï¼æä»¬å¯ä»¥å¨å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æ¶ï¼ç»å¯¹åºé®å¼å¯¹è®¾ç½®è¿ææ¶é´ï¼ä¾å¦è®¾ç½®ä¸º60såè¿æãåæ¶ï¼å¨å®¢æ·ç«¯æ¯æ¬¡è®¿é®æ¶ï¼æä»¬è¯»åå®¢æ·ç«¯å½åçè®¿é®æ¬¡æ°ï¼å¦ææ¬¡æ°è¶è¿éå¼ï¼å°±æ¥éï¼éå¶å®¢æ·ç«¯åæ¬¡è®¿é®ãä½ å¯ä»¥çä¸ä¸é¢çè¿æ®µä»£ç ï¼å®å®ç°äºå¯¹å®¢æ·ç«¯æ¯åéè®¿é®æ¬¡æ°ä¸è¶è¿20æ¬¡çéå¶ãä¼ªä»£ç å¦ä¸ï¼\n\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\n//è·åipå¯¹åºçè®¿é®æ¬¡æ°\ncurrent = GET(ip)\n//å¦æè¶è¿è®¿é®æ¬¡æ°è¶è¿20æ¬¡ï¼åæ¥é\nIF current != NULL AND current > 20 THEN\n    ERROR "exceed 20 accesses per second"\nELSE\n    //å¦æè®¿é®æ¬¡æ°ä¸è¶³20æ¬¡ï¼å¢å ä¸æ¬¡è®¿é®è®¡æ°\n    value = INCR(ip)\n    //å¦ææ¯ç¬¬ä¸æ¬¡è®¿é®ï¼å°é®å¼å¯¹çè¿ææ¶é´è®¾ç½®ä¸º60så\n    IF value == 1 THEN\n        EXPIRE(ip,60)\n    END\n    //æ§è¡å¶ä»æä½\n    DO THINGS\nEND\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå°½ç®¡ä¾å­ä½¿ç¨äº INCR æ¥åå­æ§å°å¢å è®¡æ°ï¼ä½å®¢æ·ç«¯éæµçé»è¾ä¸åªæè®¡æ°ï¼è¿åæ¬è®¿é®æ¬¡æ°å¤æ­åè¿ææ¶é´è®¾ç½®ãå¯¹äºè¿äºæä½ï¼æä»¬åæ ·éè¦ä¿è¯å®ä»¬çåå­æ§ãå¦åï¼å¦æå®¢æ·ç«¯ä½¿ç¨å¤çº¿ç¨è®¿é®ï¼è®¿é®æ¬¡æ°åå§å¼ä¸º0ï¼ç¬¬ä¸ä¸ªçº¿ç¨æ§è¡äºINCR(ip)æä½åï¼ç¬¬äºä¸ªçº¿ç¨ç´§æ¥çä¹æ§è¡äºINCR(ip)ï¼æ­¤æ¶ï¼ipå¯¹åºçè®¿é®æ¬¡æ°å°±è¢«å¢å å°äº2ï¼æä»¬å°±æ æ³åå¯¹è¿ä¸ªipè®¾ç½®è¿ææ¶é´äºãè¿æ ·å°±ä¼å¯¼è´ï¼è¿ä¸ªipå¯¹åºçå®¢æ·ç«¯è®¿é®æ¬¡æ°è¾¾å°20æ¬¡ä¹åï¼å°±æ æ³åè¿è¡è®¿é®äºãå³ä½¿è¿äº60sï¼ä¹ä¸è½åç»§ç»­è®¿é®ï¼æ¾ç¶ä¸ç¬¦åä¸å¡è¦æ±ã\n\nç±äºè¿ç§å¤æçé»è¾æ æ³ä½¿ç¨åä¸ªå½ä»¤æ¥è§£å³ï¼æ­¤æ¶å°±éè¦ä½¿ç¨ Lua èæ¬æ¥ä¿è¯å¹¶åæ§å¶ãæä»¬å¯ä»¥æè®¿é®æ¬¡æ°å 1ãå¤æ­è®¿é®æ¬¡æ°æ¯å¦ä¸º1ï¼ä»¥åè®¾ç½®è¿ææ¶é´è¿ä¸ä¸ªæä½åå¥ä¸ä¸ªLuaèæ¬ï¼å¦ä¸æç¤ºï¼\n\nlocal current\ncurrent = redis.call("incr",KEYS[1])\nif tonumber(current) == 1 then\n    redis.call("expire",KEYS[1],60)\nend\n\n\n1\n2\n3\n4\n5\n\n\nåè®¾æä»¬ç¼åçèæ¬åç§°ä¸º lua.scriptï¼æä»¬æ¥çå°±å¯ä»¥ä½¿ç¨ Redis å®¢æ·ç«¯ï¼å¸¦ä¸ eval éé¡¹ï¼æ¥æ§è¡è¯¥èæ¬ãèæ¬æéçåæ°å°éè¿ä»¥ä¸å½ä»¤ä¸­ç keys å args è¿è¡ä¼ éï¼\n\nredis-cli  --eval lua.script  keys , args\n\n\n1\n\n\nè¿æ ·ä¸æ¥ï¼è®¿é®æ¬¡æ°å 1ãå¤æ­è®¿é®æ¬¡æ°æ¯å¦ä¸º1ï¼ä»¥åè®¾ç½®è¿ææ¶é´è¿ä¸ä¸ªæä½å°±å¯ä»¥åå­æ§å°æ§è¡äºãå³ä½¿å®¢æ·ç«¯æå¤ä¸ªçº¿ç¨åæ¶æ§è¡è¿ä¸ªèæ¬ï¼Redisä¹ä¼ä¾æ¬¡ä¸²è¡æ§è¡èæ¬ä»£ç ï¼é¿åäºå¹¶åæä½å¸¦æ¥çæ°æ®éè¯¯ã\n\næ³¨æï¼å¦ææå¾å¤æä½é½æ¾å¨Luaèæ¬ä¸­åå­æ§è¡ï¼ä¼å¯¼è´Redisæ§è¡èæ¬çæ¶é´å¢å ï¼åæ ·ä¹ä¼éä½Redisçå¹¶åæ§è½ãæä»¥å»ºè®®ï¼å¨ç¼åLuaèæ¬æ¶ï¼ä½ è¦é¿åæä¸éè¦åå¹¶åæ§å¶çæä½åå¥èæ¬ä¸­ã\n\n\n# 2. å¦ä½ä½¿ç¨ Redis å®ç°åå¸å¼éï¼\n\nåé¢æå°ï¼å éä¹è½å®ç°ä¸´çåºä»£ç çäºæ¥æ§è¡ï¼ä½ Redis å±äºåå¸å¼ç³»ç»ï¼å½æå¤ä¸ªå®¢æ·ç«¯éè¦äºæ¢éçæ¶åï¼è¿æéå°±ä¸è½æ¯æä¸ªå®¢æ·ç«¯æ¬å°çéï¼èæ¯æ¯ä¸ªå®¢æ·ç«¯é½è½è®¿é®å°çéã\n\nå¨åå¸å¼ç³»ç»ä¸­ï¼å½æå¤ä¸ªå®¢æ·ç«¯éè¦è·åéçæ¶åï¼æä»¬å°±éè¦ä¸ä¸ªåå¸å¼éï¼å®ä¿å­å¨ä¸ä¸ªå±äº«å­å¨ç³»ç»ä¸­ï¼å¯ä»¥è¢«å¤ä¸ªå®¢æ·ç«¯å±äº«è®¿é®åè·åã\n\nè Redis æ¬èº«å°±æ¯ä¸ä¸ªå±äº«å­å¨ç³»ç»ï¼å¯ä»¥ç¨æ¥ä¿å­åå¸å¼éï¼èä¸å¯ä»¥åºå¯¹é«å¹¶åçéæä½åºæ¯ãè¿ä¸èå°è®¨è®ºå¦ä½åºäº Redis å®ç°åå¸å¼éã\n\n\n# 2.1 åæºä¸çéååå¸å¼éçèç³»ä¸åºå«\n\n----------------------------------------\n\nåçä¸ä¸åæºä¸çéçå®ç°ãå¯¹äºå¨åæºä¸è¿è¡çå¤çº¿ç¨ç¨åºæ¥è¯´ï¼éæ¬èº«å¯ä»¥ç¨ä¸ä¸ªåéè¡¨ç¤ºï¼\n\n * åéä¸º 0ï¼è¡¨ç¤ºæ²¡æçº¿ç¨è·åé\n * åéä¸º 1ï¼è¡¨ç¤ºå·²ç»æçº¿ç¨è·åå°éäº\n\nèçº¿ç¨çå é/éæ¾éå°±æ¯æ£æ¥è¿ä¸ªåéå¹¶ä¿®æ¹çæä½ãç¨ä¸æ®µä»£ç æ¥å±ç¤ºå éåéæ¾éçæä½ï¼\n\nacquire_lock() {\n  if lock == 0\n     lock = 1\n     return 1\n  else        # å·²ç»æå«ççº¿ç¨è·åå°éäºï¼å éå¤±è´¥ \n     return 0\n}\n\nrelease_lock() {\n  lock = 0\n  return 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nèå¨åå¸å¼åºæ¯ä¸ï¼åå¸å¼éçåéç±ä¸ä¸ªå±äº«å­å¨ç³»ç»æ¥ç»´æ¤ï¼è¿æ ·å¤ä¸ªå®¢æ·ç«¯å°±å¯ä»¥è®¿é®åå¸å¼éäºï¼ç±æ­¤ï¼å éåéæ¾éçæä½å°±åæäºè¯»åãå¤æ­åè®¾ç½®å±äº«å­å¨ç³»ç»ä¸­çéåéå¼ã\n\nè¿æ ·ï¼æä»¬å°±å¯ä»¥å¾åºå®ç°åå¸å¼éçä¸¤ä¸ªè¦æ±ï¼\n\n * è¦æ±ä¸ï¼åå¸å¼éçå éåéæ¾éçè¿ç¨ï¼æ¶åå¤ä¸ªæä½ãæä»¥ï¼å¨å®ç°åå¸å¼éæ¶ï¼æä»¬éè¦ä¿è¯è¿äºéæä½çåå­æ§ï¼\n * è¦æ±äºï¼å±äº«å­å¨ç³»ç»ä¿å­äºéåéï¼å¦æå±äº«å­å¨ç³»ç»åçæéæå®æºï¼é£ä¹å®¢æ·ç«¯ä¹å°±æ æ³è¿è¡éæä½äºãå¨å®ç°åå¸å¼éæ¶ï¼æä»¬éè¦èèä¿è¯å±äº«å­å¨ç³»ç»çå¯é æ§ï¼è¿èä¿è¯éçå¯é æ§ã\n\nä¸é¢çä¸ä¸å¦ä½å®ç°åå¸å¼éãæä»¬æ¢å¯ä»¥åºäºåä¸ªRedisèç¹æ¥å®ç°ï¼ä¹å¯ä»¥ä½¿ç¨å¤ä¸ªRedisèç¹å®ç°ãå¨è¿ä¸¤ç§æåµä¸ï¼éçå¯é æ§æ¯ä¸ä¸æ ·çã\n\n\n# 2.2 åºäºåä¸ª Redis èç¹å®ç°åå¸å¼é\n\nä½ä¸ºåå¸å¼éå®ç°è¿ç¨ä¸­çå±äº«å­å¨ç³»ç»ï¼Redis å¯ä»¥ä½¿ç¨é®å¼å¯¹æ¥ä¿å­éåéï¼åæ¥æ¶åå¤çä¸åå®¢æ·ç«¯åéçå éåéæ¾éçæä½è¯·æ±ã\n\næä»¬è¦èµäºéåéä¸ä¸ªåéåï¼æè¿ä¸ªåéåä½ä¸ºé®å¼å¯¹çé®ï¼èéåéçå¼ï¼åæ¯é®å¼å¯¹çå¼ï¼è¿æ ·ä¸æ¥ï¼Redis å°±è½ä¿å­éåéäºï¼å®¢æ·ç«¯ä¹å°±å¯ä»¥éè¿Redisçå½ä»¤æä½æ¥å®ç°éæä½ã\n\nå éè¿ç¨ï¼\n\nåæï¼å¾ä¸­ï¼AåCåæ¶è¯·æ±å éãå ä¸ºRedisä½¿ç¨åçº¿ç¨å¤çè¯·æ±ï¼æä»¥ï¼å³ä½¿å®¢æ·ç«¯AåCåæ¶æå éè¯·æ±åç»äºRedisï¼Redisä¹ä¼ä¸²è¡å¤çå®ä»¬çè¯·æ±ã\n\néæ¾éï¼\n\nå ä¸ºå éåå«äºä¸ä¸ªæä½ï¼è¯»åéåéãå¤æ­éåéå¼ä»¥åæéåéå¼è®¾ç½®ä¸º 1ï¼ï¼ä¸ºäºä¿è¯è¿ä¸ä¸ªæä½çåå­æ§ï¼å¨ Redis ä¸­å¯ä»¥ä½¿ç¨åæä»¤æä½æä½¿ç¨ Lua èæ¬ã\n\næä»¬çä¸ Redis å¯ä»¥ç¨åªäºåå½ä»¤æä½å®ç°å éæä½ã\n\né¦åæ¯ SETNX å½ä»¤ï¼ç¨äºè®¾ç½®é®å¼å¯¹çå¼ï¼è¿ä¸ªå½ä»¤å¨æ§è¡æ¶ä¼å¤æ­é®å¼å¯¹æ¯å¦å­å¨ï¼å¦æä¸å­å¨ï¼å°±è®¾ç½®é®å¼å¯¹çå¼ï¼å¦æå­å¨ï¼å°±ä¸åä»»ä½æä½ã\n\nå¯¹äºéæ¾éæä½æ¥è¯´ï¼æä»¬å¯ä»¥å¨æ§è¡å®ä¸å¡é»è¾åï¼ä½¿ç¨ DEL å½ä»¤å é¤éåéãä¸è¿ï¼ä½ ä¸ç¨æå¿éåéè¢«å é¤åï¼å¶ä»å®¢æ·ç«¯æ æ³è¯·æ±å éäºãå ä¸ºSETNXå½ä»¤å¨æ§è¡æ¶ï¼å¦æè¦è®¾ç½®çé®å¼å¯¹ï¼ä¹å°±æ¯éåéï¼ä¸å­å¨ï¼SETNXå½ä»¤ä¼ååå»ºé®å¼å¯¹ï¼ç¶åè®¾ç½®å®çå¼ãæä»¥ï¼éæ¾éä¹åï¼åæå®¢æ·ç«¯è¯·æ±å éæ¶ï¼SETNXå½ä»¤ä¼åå»ºä¿å­éåéçé®å¼å¯¹ï¼å¹¶è®¾ç½®éåéçå¼ï¼å®æå éã\n\næ»ç»æ¥è¯´ï¼æä»¬å°±å¯ä»¥ç¨ SETNX å DEL å½ä»¤ç»åæ¥å®ç°å éåéæ¾éæä½ãä¸é¢çä¼ªä»£ç ç¤ºä¾æ¾ç¤ºäºéæä½çè¿ç¨ï¼\n\n// å é\nSETNX lock_key 1\n// ä¸å¡é»è¾\nDO THINGS\n// éæ¾é\nDEL lock_key\n\n\n1\n2\n3\n4\n5\n6\n\n\nä¸è¿ï¼ä½¿ç¨ SETNX å DEL å½ä»¤ç»åå®ç°åå¸éï¼å­å¨ä¸¤ä¸ªæ½å¨çé£é©ï¼\n\n * é£é©ä¸ï¼åå¦æä¸ªå®¢æ·ç«¯å¨æ§è¡äºSETNXå½ä»¤ãå éä¹åï¼ç´§æ¥çå´å¨æä½å±äº«æ°æ®æ¶åçäºå¼å¸¸ï¼ç»æä¸ç´æ²¡ææ§è¡æåçDELå½ä»¤éæ¾éãå æ­¤ï¼éå°±ä¸ç´è¢«è¿ä¸ªå®¢æ·ç«¯ææï¼å¶å®å®¢æ·ç«¯æ æ³æ¿å°éï¼ä¹æ æ³è®¿é®å±äº«æ°æ®åæ§è¡åç»­æä½ï¼è¿ä¼ç»ä¸å¡åºç¨å¸¦æ¥å½±åã\n   * è§£å³æ¹æ³ï¼ç»éåéè®¾ç½®ä¸ä¸ªè¿ææ¶é´\n * é£é©äºï¼å¦æå®¢æ·ç«¯Aæ§è¡äºSETNXå½ä»¤å éåï¼åè®¾å®¢æ·ç«¯Bæ§è¡äºDELå½ä»¤éæ¾éï¼æ­¤æ¶ï¼å®¢æ·ç«¯Açéå°±è¢«è¯¯éæ¾äºãå¦æå®¢æ·ç«¯Cæ­£å¥½ä¹å¨ç³è¯·å éï¼å°±å¯ä»¥æåè·å¾éï¼è¿èå¼å§æä½å±äº«æ°æ®ãè¿æ ·ä¸æ¥ï¼å®¢æ·ç«¯AåCåæ¶å¨å¯¹å±äº«æ°æ®è¿è¡æä½ï¼æ°æ®å°±ä¼è¢«ä¿®æ¹éè¯¯ï¼è¿ä¹æ¯ä¸å¡å±ä¸è½æ¥åçã\n   * è§£å³æ¹æ³ï¼SETNX å éæ¶å° value è®¾ç½®ä¸ºæå®¢æ·ç«¯çå¯ä¸ ID å¼ï¼å¹¶å¨éæ¾æ¶å¤æ­è¯¥ ID æ¯å¦ä¸èªå·±çç¸ç­ã\n\nç¥éäºéå¯¹é£é©äºçè§£å³æ¹æ³ï¼ä¸é¢çä¸ä¸å¨ Redis å·ä½å¦ä½å®ç°ã\n\nä¸ºäºè½è¾¾å°åSETNXå½ä»¤ä¸æ ·çææï¼Redisç»SETå½ä»¤æä¾äºç±»ä¼¼çéé¡¹NXï¼ç¨æ¥å®ç°âä¸å­å¨å³è®¾ç½®âãå¦æä½¿ç¨äºNXéé¡¹ï¼SETå½ä»¤åªæå¨é®å¼å¯¹ä¸å­å¨æ¶ï¼æä¼è¿è¡è®¾ç½®ï¼å¦åä¸åèµå¼æä½ãæ­¤å¤ï¼SETå½ä»¤å¨æ§è¡æ¶è¿å¯ä»¥å¸¦ä¸EXæPXéé¡¹ï¼ç¨æ¥è®¾ç½®é®å¼å¯¹çè¿ææ¶é´ãæ¯å¦ï¼æ§è¡ä¸é¢çå½ä»¤æ¶ï¼åªækeyä¸å­å¨æ¶ï¼SETæä¼åå»ºkeyï¼å¹¶å¯¹keyè¿è¡èµå¼ãå¦å¤ï¼keyçå­æ´»æ¶é´ç±secondsæèmillisecondséé¡¹å¼æ¥å³å®ï¼\n\nSET key value [EX seconds | PX milliseconds]  [NX]\n\n\n1\n\n\næäºSETå½ä»¤çNXåEX/PXéé¡¹åï¼æä»¬å°±å¯ä»¥ç¨ä¸é¢çå½ä»¤æ¥å®ç°å éæä½äºï¼\n\n// å é, unique_valueä½ä¸ºå®¢æ·ç«¯å¯ä¸æ§çæ è¯\nSET lock_key unique_value NX PX 10000\n\n\n1\n2\n\n\nå¶ä¸­ï¼unique_valueæ¯å®¢æ·ç«¯çå¯ä¸æ è¯ï¼å¯ä»¥ç¨ä¸ä¸ªéæºçæçå­ç¬¦ä¸²æ¥è¡¨ç¤ºï¼PX 10000åè¡¨ç¤ºlock_keyä¼å¨10såè¿æï¼ä»¥åå®¢æ·ç«¯å¨è¿æé´åçå¼å¸¸èæ æ³éæ¾éã\n\nå ä¸ºå¨å éæä½ä¸­ï¼æ¯ä¸ªå®¢æ·ç«¯é½ä½¿ç¨äºä¸ä¸ªå¯ä¸æ è¯ï¼æä»¥å¨éæ¾éæä½æ¶ï¼æä»¬éè¦å¤æ­éåéçå¼ï¼æ¯å¦ç­äºæ§è¡éæ¾éæä½çå®¢æ·ç«¯çå¯ä¸æ è¯ï¼å¦ä¸æç¤ºï¼\n\n// éæ¾é æ¯è¾unique_valueæ¯å¦ç¸ç­ï¼é¿åè¯¯éæ¾\nif redis.call("get",KEYS[1]) == ARGV[1] then\n    return redis.call("del",KEYS[1])\nelse\n    return 0\nend\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¿æ¯ä½¿ç¨Luaèæ¬ï¼unlock.scriptï¼å®ç°çéæ¾éæä½çä¼ªä»£ç ï¼å¶ä¸­ï¼KEYS[1]è¡¨ç¤ºlock_keyï¼ARGV[1]æ¯å½åå®¢æ·ç«¯çå¯ä¸æ è¯ï¼è¿ä¸¤ä¸ªå¼é½æ¯æä»¬å¨æ§è¡Luaèæ¬æ¶ä½ä¸ºåæ°ä¼ å¥çã\n\næåï¼æä»¬æ§è¡ä¸é¢çå½ä»¤ï¼å°±å¯ä»¥å®æééæ¾æä½äºï¼\n\nredis-cli  --eval  unlock.script lock_key , unique_value\n\n\n1\n\n\néè¿ Lua èæ¬ä¿è¯äº Redis å¨è¿è¡è¯»åéåéãå¤æ­å¼ãå é¤éåéçå¤ä¸ªæä½è½å¤åå­æ§å°æ§è¡ã\n\nå°æ­¤ï¼æä»¬å®ç°äºä½¿ç¨ Redis å®ä¾æ¥å®ç°åå¸å¼éãä½æ¯ä¸ºäºé¿ååç¹æéï¼æä»¬è¿è¦åºäºå¤ä¸ª Redis èç¹æ¥å®ç°åå¸å¼éã\n\n\n# 2.3 åºäºå¤ä¸ª Redis èç¹å®ç°é«å¯é çåå¸å¼é\n\nå½æä»¬è¦å®ç°é«å¯é çåå¸å¼éæ¶ï¼å°±ä¸è½åªä¾èµåä¸ªçå½ä»¤æä½äºï¼æä»¬éè¦æç§ä¸å®çæ­¥éª¤åè§åè¿è¡å è§£éæä½ï¼å¦åï¼å°±å¯è½ä¼åºç°éæ æ³å·¥ä½çæåµãè¿éè¯´çâä¸å®çæ­¥éª¤åè§åâå°±æ¯æçåå¸å¼éçç®æ³ã\n\nä¸ºäºé¿å Redis å®ä¾æéèå¯¼è´çéæ æ³å·¥ä½çé®é¢ï¼Redis çå¼åè Antirez æåºäºåå¸å¼éç®æ³ Redlockã\n\nRedlock ç®æ³çåºæ¬æè·¯ï¼æ¯è®©å®¢æ·ç«¯åå¤ä¸ªç¬ç«çRediså®ä¾ä¾æ¬¡è¯·æ±å éï¼å¦æå®¢æ·ç«¯è½å¤ååæ°ä»¥ä¸çå®ä¾æåå°å®æå éæä½ï¼é£ä¹æä»¬å°±è®¤ä¸ºï¼å®¢æ·ç«¯æåå°è·å¾åå¸å¼éäºï¼å¦åå éå¤±è´¥ãè¿æ ·ä¸æ¥ï¼å³ä½¿æåä¸ªRediså®ä¾åçæéï¼å ä¸ºéåéå¨å¶å®å®ä¾ä¸ä¹æä¿å­ï¼æä»¥ï¼å®¢æ·ç«¯ä»ç¶å¯ä»¥æ­£å¸¸å°è¿è¡éæä½ï¼éåéå¹¶ä¸ä¼ä¸¢å¤±ã\n\næä»¬æ¥å·ä½çä¸ Redlock ç®æ³çæ§è¡æ­¥éª¤ãRedlock ç®æ³çå®ç°éè¦æ N ä¸ªç¬ç«ç Redis å®ä¾ãæ¥ä¸æ¥ï¼æä»¬å¯ä»¥åæ 3 æ­¥æ¥å®æå éæä½ï¼\n\nç¬¬ä¸æ­¥ï¼å®¢æ·ç«¯è·åå½åæ¶é´ã\n\nç¬¬äºæ­¥ï¼å®¢æ·ç«¯æé¡ºåºä¾æ¬¡å N ä¸ª Redis å®ä¾æ§è¡å éæä½ã\n\nè¿éçå éæä½åå¨åå®ä¾ä¸æ§è¡çå éæä½ä¸æ ·ï¼ä½¿ç¨SETå½ä»¤ï¼å¸¦ä¸NXï¼EX/PXéé¡¹ï¼ä»¥åå¸¦ä¸å®¢æ·ç«¯çå¯ä¸æ è¯ãå½ç¶ï¼å¦ææä¸ªRediså®ä¾åçæéäºï¼ä¸ºäºä¿è¯å¨è¿ç§æåµä¸ï¼Redlockç®æ³è½å¤ç»§ç»­è¿è¡ï¼æä»¬éè¦ç»å éæä½è®¾ç½®ä¸ä¸ªè¶æ¶æ¶é´ã\n\nå¦æå®¢æ·ç«¯å¨åä¸ä¸ªRediså®ä¾è¯·æ±å éæ¶ï¼ä¸ç´å°è¶æ¶é½æ²¡ææåï¼é£ä¹æ­¤æ¶ï¼å®¢æ·ç«¯ä¼åä¸ä¸ä¸ªRediså®ä¾ç»§ç»­è¯·æ±å éãå éæä½çè¶æ¶æ¶é´éè¦è¿è¿å°å°äºéçæææ¶é´ï¼ä¸è¬ä¹å°±æ¯è®¾ç½®ä¸ºå åæ¯«ç§ã\n\nç¬¬ä¸æ­¥ï¼ä¸æ¦å®¢æ·ç«¯å®æäºåææ Redis å®ä¾çå éæä½ï¼å®¢æ·ç«¯å°±è¦è®¡ç®æ´ä¸ªå éè¿ç¨çæ»èæ¶ã\n\nå®¢æ·ç«¯åªæå¨æ»¡è¶³ä¸é¢çè¿ä¸¤ä¸ªæ¡ä»¶æ¶ï¼æè½è®¤ä¸ºæ¯å éæåã\n\n * æ¡ä»¶ä¸ï¼å®¢æ·ç«¯ä»è¶è¿åæ°ï¼å¤§äºç­äº N/2+1ï¼ç Redis å®ä¾ä¸æåè·åå°äºéï¼\n * æ¡ä»¶äºï¼å®¢æ·ç«¯è·åéçæ»èæ¶æ²¡æè¶è¿éçæææ¶é´ã\n\nå¨æ»¡è¶³äºè¿ä¸¤ä¸ªæ¡ä»¶åï¼æä»¬éè¦éæ°è®¡ç®è¿æéçæææ¶é´ï¼è®¡ç®çç»ææ¯éçæåæææ¶é´åå»å®¢æ·ç«¯ä¸ºè·åéçæ»èæ¶ãå¦æéçæææ¶é´å·²ç»æ¥ä¸åå®æå±äº«æ°æ®çæä½äºï¼æä»¬å¯ä»¥éæ¾éï¼ä»¥ååºç°è¿æ²¡å®ææ°æ®æä½ï¼éå°±è¿æäºçæåµã\n\nå½ç¶ï¼å¦æå®¢æ·ç«¯å¨åææå®ä¾æ§è¡å®å éæä½åï¼æ²¡è½åæ¶æ»¡è¶³è¿ä¸¤ä¸ªæ¡ä»¶ï¼é£ä¹ï¼å®¢æ·ç«¯åææRedisèç¹åèµ·éæ¾éçæä½ã\n\nå¨Redlockç®æ³ä¸­ï¼éæ¾éçæä½åå¨åå®ä¾ä¸éæ¾éçæä½ä¸æ ·ï¼åªè¦æ§è¡éæ¾éçLuaèæ¬å°±å¯ä»¥äºãè¿æ ·ä¸æ¥ï¼åªè¦Nä¸ªRediså®ä¾ä¸­çåæ°ä»¥ä¸å®ä¾è½æ­£å¸¸å·¥ä½ï¼å°±è½ä¿è¯åå¸å¼éçæ­£å¸¸å·¥ä½äºã\n\næä»¥ï¼å¨å®éçä¸å¡åºç¨ä¸­ï¼å¦æä½ æ³è¦æååå¸å¼éçå¯é æ§ï¼å°±å¯ä»¥éè¿ Redlock ç®æ³æ¥å®ç°ã\n\n\n# 2.4 å°ç»\n\nåå¸å¼éæ¯ç±å±äº«å­å¨ç³»ç»ç»´æ¤çåéï¼å¤ä¸ªå®¢æ·ç«¯å¯ä»¥åå±äº«å­å¨ç³»ç»åéå½ä»¤è¿è¡å éæéæ¾éæä½ãRedis ä½ä¸ºä¸ä¸ªå±äº«å­å¨ç³»ç»ï¼å¯ä»¥ç¨æ¥å®ç°åå¸å¼éã\n\nå¨åºäºåä¸ªRediså®ä¾å®ç°åå¸å¼éæ¶ï¼å¯¹äºå éæä½ï¼æä»¬éè¦æ»¡è¶³ä¸ä¸ªæ¡ä»¶ã\n\n 1. å éåæ¬äºè¯»åéåéãæ£æ¥éåéå¼åè®¾ç½®éåéå¼ä¸ä¸ªæä½ï¼ä½éè¦ä»¥åå­æä½çæ¹å¼å®æï¼æä»¥ï¼æä»¬ä½¿ç¨SETå½ä»¤å¸¦ä¸NXéé¡¹æ¥å®ç°å éï¼\n 2. éåééè¦è®¾ç½®è¿ææ¶é´ï¼ä»¥åå®¢æ·ç«¯æ¿å°éååçå¼å¸¸ï¼å¯¼è´éä¸ç´æ æ³éæ¾ï¼æä»¥ï¼æä»¬å¨SETå½ä»¤æ§è¡æ¶å ä¸EX/PXéé¡¹ï¼è®¾ç½®å¶è¿ææ¶é´ï¼\n 3. éåéçå¼éè¦è½åºåæ¥èªä¸åå®¢æ·ç«¯çå éæä½ï¼ä»¥åå¨éæ¾éæ¶ï¼åºç°è¯¯éæ¾æä½ï¼æä»¥ï¼æä»¬ä½¿ç¨SETå½ä»¤è®¾ç½®éåéå¼æ¶ï¼æ¯ä¸ªå®¢æ·ç«¯è®¾ç½®çå¼æ¯ä¸ä¸ªå¯ä¸å¼ï¼ç¨äºæ è¯å®¢æ·ç«¯ã\n\nåå éç±»ä¼¼ï¼éæ¾éä¹åå«äºè¯»åéåéå¼ãå¤æ­éåéå¼åå é¤éåéä¸ä¸ªæä½ï¼ä¸è¿ï¼æä»¬æ æ³ä½¿ç¨åä¸ªå½ä»¤æ¥å®ç°ï¼æä»¥ï¼æä»¬å¯ä»¥éç¨Luaèæ¬æ§è¡éæ¾éæä½ï¼éè¿Redisåå­æ§å°æ§è¡Luaèæ¬ï¼æ¥ä¿è¯éæ¾éæä½çåå­æ§ã\n\nä¸è¿ï¼åºäºåä¸ª Redis å®ä¾å®ç°åå¸å¼éæ¶ï¼ä¼é¢ä¸´å®ä¾å¼å¸¸æå´©æºçæåµï¼è¿ä¼å¯¼è´å®ä¾æ æ³æä¾éæä½ï¼æ­£å ä¸ºæ­¤ï¼Redis ä¹æä¾äº Redlock ç®æ³ï¼ç¨æ¥å®ç°åºäºå¤ä¸ªå®ä¾çåå¸å¼éãè¿æ ·ä¸æ¥ï¼éåéç±å¤ä¸ªå®ä¾ç»´æ¤ï¼å³ä½¿æå®ä¾åçäºæéï¼éåéä»ç¶æ¯å­å¨çï¼å®¢æ·ç«¯è¿æ¯å¯ä»¥å®æéæä½ãRedlock ç®æ³æ¯å®ç°é«å¯é åå¸å¼éçä¸ç§ææè§£å³æ¹æ¡ï¼ä½ å¯ä»¥å¨å®éåºç¨ä¸­æå®ç¨èµ·æ¥ã',normalizedContent:'> åèï¼\n> \n>  * 29 æ éçåå­æä½ï¼redis å¦ä½åºå¯¹å¹¶åè®¿é®ï¼| æå®¢æ¶é´\n>  * 30 å¦ä½ä½¿ç¨ redis å®ç°åå¸å¼éï¼| æå®¢æ¶é´\n\nå¹¶åè®¿é®æ§å¶ï¼æ¯æå¯¹å¤ä¸ªå®¢æ·ç«¯è®¿é®æä½åä¸ä»½æ°æ®çè¿ç¨è¿è¡æ§å¶ï¼ä»¥ä¿è¯ä»»ä½ä¸ä¸ªå®¢æ·ç«¯åéçæä½å¨rediså®ä¾ä¸æ§è¡æ¶å·æäºæ¥æ§ãä¾å¦ï¼å®¢æ·ç«¯açè®¿é®æä½å¨æ§è¡æ¶ï¼å®¢æ·ç«¯bçæä½ä¸è½æ§è¡ï¼éè¦ç­å°açæä½ç»æåï¼æè½æ§è¡ã\n\nä¸å¡ç³»ç»ä¸å¯é¿åä¼éå°å¹¶åè®¿é®çé®é¢ï¼ä¸ºä¿è¯å¹¶åè®¿é®çæ­£ç¡®æ§ï¼redis æä¾äºä¸¤ç§æ¹æ³ï¼å éååå­æä½ã\n\n\n# 1. æ éçåå­æä½\n\nåå­æä½æ¯ä¸ç§æä¾å¹¶åè®¿é®æ§å¶çæ¹æ³ï¼æ¯ææ§è¡è¿ç¨ä¿æåå­æ§çæä½ï¼èä¸åå­æä½æ§è¡æ¶å¹¶ä¸éè¦åå éï¼å®ç°äºæ éæä½ãè¿æ ·ä¸æ¥ï¼æ¢è½ä¿è¯å¹¶åæ§å¶ï¼è¿è½åå°å¯¹ç³»ç»å¹¶åæ§è½çå½±åã\n\n\n# 1.1 å¹¶åè®¿é®ä¸­éè¦å¯¹ä»ä¹è¿è¡æ§å¶ï¼\n\nå¹¶åè®¿é®æ§å¶å¯¹åºçæä½ä¸»è¦æ¯æ°æ®ä¿®æ¹æä½ãå½å®¢æ·ç«¯éè¦ä¿®æ¹æ°æ®æ¶ï¼åºæ¬æµç¨åæä¸¤æ­¥ï¼\n\n 1. å®¢æ·ç«¯åææ°æ®è¯»åå°æ¬å°ï¼å¨æ¬å°è¿è¡ä¿®æ¹ï¼\n 2. å®¢æ·ç«¯ä¿®æ¹å®æ°æ®åï¼ååå redisã\n\nè¿ä¸ªæµç¨è¢«ç§°ä¸º read-modify-writeï¼rmwï¼æä½ãå½æå¤ä¸ªå®¢æ·ç«¯å¯¹åä¸ä»½æ°æ®æ§è¡rmwæä½çè¯ï¼æä»¬å°±éè¦è®©rmwæä½æ¶åçä»£ç ä»¥åå­æ§æ¹å¼æ§è¡ãè®¿é®åä¸ä»½æ°æ®çrmwæä½ä»£ç ï¼å°±å«åä¸´çåºä»£ç ã\n\nä¸è¿ï¼å½æå¤ä¸ªå®¢æ·ç«¯å¹¶åæ§è¡ä¸´çåºä»£ç æ¶ï¼å°±ä¼å­å¨ä¸äºæ½å¨é®é¢ï¼æ¥ä¸æ¥ï¼æç¨ä¸ä¸ªå¤å®¢æ·ç«¯æ´æ°åååºå­çä¾å­æ¥è§£éä¸ä¸ã\n\næä»¬åçä¸ä¸´çåºä»£ç ãåè®¾å®¢æ·ç«¯è¦å¯¹åååºå­æ§è¡æ£å1çæä½ï¼ä¼ªä»£ç å¦ä¸æç¤ºï¼\n\ncurrent = get(id)\ncurrent--\nset(id, current)\n\n\n1\n2\n3\n\n\nå¦ææä»¬å¯¹ä¸´çåºä»£ç çæ§è¡æ²¡ææ§å¶æºå¶ï¼å°±å¯è½åºç°æ°æ®æ´æ°éè¯¯ãå¦ä¸å¾æ¯ä¸¤ä¸ªå®¢æ·ç«¯åæ¶æ§è¡ä¸´çåºä»£ç èå¯¼è´çéè¯¯ï¼\n\nä¸å¾ç¸æ¯äºæ­£ç¡®çå¤çé»è¾ï¼åºå­å¼ææ¾æ´æ°éäºãåºç°è¿ä¸ªç°è±¡çåå æ¯ï¼å¤ä¸ªå®¢æ·ç«¯ç rmw è¿ä¸ä¸ªæä½å¨æ§è¡æ¶ä¸å·æäºæ¥æ§ï¼ä¸¤ä¸ªå®¢æ·ç«¯åºäºç¸åçåå§å¼è¿è¡ä¿®æ¹ï¼èä¸æ¯åºäºåä¸ä¸ªå®¢æ·ç«¯ä¿®æ¹åçå¼åä¿®æ¹ã\n\nä¸ºäºä¿è¯æ°æ®å¹¶åä¿®æ¹çæ­£ç¡®æ§ï¼æä»¬å¯ä»¥ä½¿ç¨éæ¥æ§å¶ä¸´çåºä»£ç çæ§è¡æåµï¼å¦ä¸æç¤ºï¼\n\nÂ \n\n\n\nÂ \n\n\nlock()\ncurrent = get(id)\ncurrent--\nset(id, current)\nunlock()\n\n\n1\n2\n3\n4\n5\n\n\nè½ç¶å éä¿è¯äºäºæ¥æ§ï¼ä½æ¯å éä¼éä½å¹¶åæ§è½ã\n\nåå éç±»ä¼¼ï¼åå­æä½ä¹è½å®ç°å¹¶åæ§å¶ï¼ä½æ¯åå­æä½å¯¹ç³»ç»å¹¶åæ§è½çå½±åè¾å°ï¼æ¥ä¸æ¥ï¼æä»¬å°±æ¥äºè§£ä¸ redis ä¸­çåå­æä½ã\n\n\n# 1.2 redis çä¸¤ç§åå­æä½æ¹æ³\n\nä¸ºäºå®ç°å¹¶åæ§å¶è¦æ±çä¸´çåºä»£ç äºæ¥æ§è¡ï¼redisçåå­æä½éç¨äºä¸¤ç§æ¹æ³ï¼\n\n 1. æå¤ä¸ªæä½å¨ redis ä¸­å®ç°æä¸ä¸ªæä½ï¼ä¹å°±æ¯åå½ä»¤æä½ï¼\n 2. æå¤ä¸ªæä½åå°ä¸ä¸ª lua èæ¬ä¸­ï¼ä»¥åå­æ§æ¹å¼æ§è¡åä¸ª lua èæ¬ã\n\n# 1.2.1 redis æ¬èº«çåå½ä»¤æä½\n\nredis æ¯ä½¿ç¨åçº¿ç¨æ¥ä¸²è¡å¤çå®¢æ·ç«¯çè¯·æ±æä½å½ä»¤çï¼æä»¥ï¼å½ redis æ§è¡æä¸ªå½ä»¤æä½æ¶ï¼å¶ä»å½ä»¤æ¯æ æ³æ§è¡çï¼è¿ç¸å½äºå½ä»¤æä½æ¯äºæ¥æ§è¡çãå½ç¶ï¼redis çå¿«ç§çæãaof éåè¿äºæä½ï¼å¯ä»¥ä½¿ç¨åå°çº¿ç¨æèæ¯å­è¿ç¨æ§è¡ï¼ä¹å°±æ¯åä¸»çº¿ç¨çæä½å¹¶è¡æ§è¡ãä¸è¿ï¼è¿äºæä½åªæ¯è¯»åæ°æ®ï¼ä¸ä¼ä¿®æ¹æ°æ®ï¼æä»¥ï¼æä»¬å¹¶ä¸éè¦å¯¹å®ä»¬åå¹¶åæ§å¶ã\n\nå¦å¤ï¼redis è¿æä¾äº incr/decr å½ä»¤å¯¹æ°æ®è¿è¡å¢å¼/åå¼æä½ãï¼è¿ä¸ªå½ä»¤å° rmw ä¸ä¸ªæä½åä¸ºä¸ä¸ªåå­æä½äºã\n\næ¯å¦è¯´ï¼å¨åæçåºå­æ£åä¾å­ä¸­ï¼å®¢æ·ç«¯å¯ä»¥ä½¿ç¨ä¸é¢çä»£ç ï¼ç´æ¥å®æå¯¹ååidçåºå­å¼å1æä½ãå³ä½¿æå¤ä¸ªå®¢æ·ç«¯æ§è¡ä¸é¢çä»£ç ï¼ä¹ä¸ç¨æå¿åºç°åºå­å¼æ£åéè¯¯çé®é¢ï¼\n\ndecr id\n\n\n1\n\n\nä½å½æä»¬æ³è¦å°æ´å¤æçæä½åæåå­æä½æ¶ï¼å°±éè¦ä½¿ç¨ lua èæ¬äºã\n\n# 1.2.2 lua èæ¬\n\nredis ä¼ææ´ä¸ª lua èæ¬ä½ä¸ºä¸ä¸ªæ´ä½ä½¿ç¨ eval å½ä»¤æ¥æ§è¡ï¼å¨æ§è¡çè¿ç¨ä¸­ä¸ä¼è¢«å¶ä»å½ä»¤ææ­ï¼ä»èä¿è¯äº lua èæ¬ä¸­æä½çåå­æ§ã\n\nä¸é¢ä¸¾ä¸ªä¾å­æ¥è§£é lua çä½¿ç¨ãå½ä¸ä¸ªä¸å¡åºç¨çè®¿é®ç¨æ·å¢å æ¶ï¼æä»¬ææ¶éè¦éå¶æä¸ªå®¢æ·ç«¯å¨ä¸å®æ¶é´èå´åçè®¿é®æ¬¡æ°ï¼æ¯å¦çæ¬¾ååçè´­ä¹°éæµãç¤¾äº¤ç½ç»ä¸­çæ¯åéç¹èµæ¬¡æ°éå¶ç­ã\n\né£è¯¥æä¹éå¶å¢ï¼æä»¬å¯ä»¥æå®¢æ·ç«¯ipä½ä¸ºkeyï¼æå®¢æ·ç«¯çè®¿é®æ¬¡æ°ä½ä¸ºvalueï¼ä¿å­å°redisä¸­ãå®¢æ·ç«¯æ¯è®¿é®ä¸æ¬¡åï¼æä»¬å°±ç¨incrå¢å è®¿é®æ¬¡æ°ãä¸è¿ï¼å¨è¿ç§åºæ¯ä¸ï¼å®¢æ·ç«¯éæµå¶å®åæ¶åå«äºå¯¹è®¿é®æ¬¡æ°åæ¶é´èå´çéå¶ï¼ä¾å¦æ¯åéçè®¿é®æ¬¡æ°ä¸è½è¶è¿20ãæä»¥ï¼æä»¬å¯ä»¥å¨å®¢æ·ç«¯ç¬¬ä¸æ¬¡è®¿é®æ¶ï¼ç»å¯¹åºé®å¼å¯¹è®¾ç½®è¿ææ¶é´ï¼ä¾å¦è®¾ç½®ä¸º60såè¿æãåæ¶ï¼å¨å®¢æ·ç«¯æ¯æ¬¡è®¿é®æ¶ï¼æä»¬è¯»åå®¢æ·ç«¯å½åçè®¿é®æ¬¡æ°ï¼å¦ææ¬¡æ°è¶è¿éå¼ï¼å°±æ¥éï¼éå¶å®¢æ·ç«¯åæ¬¡è®¿é®ãä½ å¯ä»¥çä¸ä¸é¢çè¿æ®µä»£ç ï¼å®å®ç°äºå¯¹å®¢æ·ç«¯æ¯åéè®¿é®æ¬¡æ°ä¸è¶è¿20æ¬¡çéå¶ãä¼ªä»£ç å¦ä¸ï¼\n\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\n//è·åipå¯¹åºçè®¿é®æ¬¡æ°\ncurrent = get(ip)\n//å¦æè¶è¿è®¿é®æ¬¡æ°è¶è¿20æ¬¡ï¼åæ¥é\nif current != null and current > 20 then\n    error "exceed 20 accesses per second"\nelse\n    //å¦æè®¿é®æ¬¡æ°ä¸è¶³20æ¬¡ï¼å¢å ä¸æ¬¡è®¿é®è®¡æ°\n    value = incr(ip)\n    //å¦ææ¯ç¬¬ä¸æ¬¡è®¿é®ï¼å°é®å¼å¯¹çè¿ææ¶é´è®¾ç½®ä¸º60så\n    if value == 1 then\n        expire(ip,60)\n    end\n    //æ§è¡å¶ä»æä½\n    do things\nend\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nå°½ç®¡ä¾å­ä½¿ç¨äº incr æ¥åå­æ§å°å¢å è®¡æ°ï¼ä½å®¢æ·ç«¯éæµçé»è¾ä¸åªæè®¡æ°ï¼è¿åæ¬è®¿é®æ¬¡æ°å¤æ­åè¿ææ¶é´è®¾ç½®ãå¯¹äºè¿äºæä½ï¼æä»¬åæ ·éè¦ä¿è¯å®ä»¬çåå­æ§ãå¦åï¼å¦æå®¢æ·ç«¯ä½¿ç¨å¤çº¿ç¨è®¿é®ï¼è®¿é®æ¬¡æ°åå§å¼ä¸º0ï¼ç¬¬ä¸ä¸ªçº¿ç¨æ§è¡äºincr(ip)æä½åï¼ç¬¬äºä¸ªçº¿ç¨ç´§æ¥çä¹æ§è¡äºincr(ip)ï¼æ­¤æ¶ï¼ipå¯¹åºçè®¿é®æ¬¡æ°å°±è¢«å¢å å°äº2ï¼æä»¬å°±æ æ³åå¯¹è¿ä¸ªipè®¾ç½®è¿ææ¶é´äºãè¿æ ·å°±ä¼å¯¼è´ï¼è¿ä¸ªipå¯¹åºçå®¢æ·ç«¯è®¿é®æ¬¡æ°è¾¾å°20æ¬¡ä¹åï¼å°±æ æ³åè¿è¡è®¿é®äºãå³ä½¿è¿äº60sï¼ä¹ä¸è½åç»§ç»­è®¿é®ï¼æ¾ç¶ä¸ç¬¦åä¸å¡è¦æ±ã\n\nç±äºè¿ç§å¤æçé»è¾æ æ³ä½¿ç¨åä¸ªå½ä»¤æ¥è§£å³ï¼æ­¤æ¶å°±éè¦ä½¿ç¨ lua èæ¬æ¥ä¿è¯å¹¶åæ§å¶ãæä»¬å¯ä»¥æè®¿é®æ¬¡æ°å 1ãå¤æ­è®¿é®æ¬¡æ°æ¯å¦ä¸º1ï¼ä»¥åè®¾ç½®è¿ææ¶é´è¿ä¸ä¸ªæä½åå¥ä¸ä¸ªluaèæ¬ï¼å¦ä¸æç¤ºï¼\n\nlocal current\ncurrent = redis.call("incr",keys[1])\nif tonumber(current) == 1 then\n    redis.call("expire",keys[1],60)\nend\n\n\n1\n2\n3\n4\n5\n\n\nåè®¾æä»¬ç¼åçèæ¬åç§°ä¸º lua.scriptï¼æä»¬æ¥çå°±å¯ä»¥ä½¿ç¨ redis å®¢æ·ç«¯ï¼å¸¦ä¸ eval éé¡¹ï¼æ¥æ§è¡è¯¥èæ¬ãèæ¬æéçåæ°å°éè¿ä»¥ä¸å½ä»¤ä¸­ç keys å args è¿è¡ä¼ éï¼\n\nredis-cli  --eval lua.script  keys , args\n\n\n1\n\n\nè¿æ ·ä¸æ¥ï¼è®¿é®æ¬¡æ°å 1ãå¤æ­è®¿é®æ¬¡æ°æ¯å¦ä¸º1ï¼ä»¥åè®¾ç½®è¿ææ¶é´è¿ä¸ä¸ªæä½å°±å¯ä»¥åå­æ§å°æ§è¡äºãå³ä½¿å®¢æ·ç«¯æå¤ä¸ªçº¿ç¨åæ¶æ§è¡è¿ä¸ªèæ¬ï¼redisä¹ä¼ä¾æ¬¡ä¸²è¡æ§è¡èæ¬ä»£ç ï¼é¿åäºå¹¶åæä½å¸¦æ¥çæ°æ®éè¯¯ã\n\næ³¨æï¼å¦ææå¾å¤æä½é½æ¾å¨luaèæ¬ä¸­åå­æ§è¡ï¼ä¼å¯¼è´redisæ§è¡èæ¬çæ¶é´å¢å ï¼åæ ·ä¹ä¼éä½redisçå¹¶åæ§è½ãæä»¥å»ºè®®ï¼å¨ç¼åluaèæ¬æ¶ï¼ä½ è¦é¿åæä¸éè¦åå¹¶åæ§å¶çæä½åå¥èæ¬ä¸­ã\n\n\n# 2. å¦ä½ä½¿ç¨ redis å®ç°åå¸å¼éï¼\n\nåé¢æå°ï¼å éä¹è½å®ç°ä¸´çåºä»£ç çäºæ¥æ§è¡ï¼ä½ redis å±äºåå¸å¼ç³»ç»ï¼å½æå¤ä¸ªå®¢æ·ç«¯éè¦äºæ¢éçæ¶åï¼è¿æéå°±ä¸è½æ¯æä¸ªå®¢æ·ç«¯æ¬å°çéï¼èæ¯æ¯ä¸ªå®¢æ·ç«¯é½è½è®¿é®å°çéã\n\nå¨åå¸å¼ç³»ç»ä¸­ï¼å½æå¤ä¸ªå®¢æ·ç«¯éè¦è·åéçæ¶åï¼æä»¬å°±éè¦ä¸ä¸ªåå¸å¼éï¼å®ä¿å­å¨ä¸ä¸ªå±äº«å­å¨ç³»ç»ä¸­ï¼å¯ä»¥è¢«å¤ä¸ªå®¢æ·ç«¯å±äº«è®¿é®åè·åã\n\nè redis æ¬èº«å°±æ¯ä¸ä¸ªå±äº«å­å¨ç³»ç»ï¼å¯ä»¥ç¨æ¥ä¿å­åå¸å¼éï¼èä¸å¯ä»¥åºå¯¹é«å¹¶åçéæä½åºæ¯ãè¿ä¸èå°è®¨è®ºå¦ä½åºäº redis å®ç°åå¸å¼éã\n\n\n# 2.1 åæºä¸çéååå¸å¼éçèç³»ä¸åºå«\n\n----------------------------------------\n\nåçä¸ä¸åæºä¸çéçå®ç°ãå¯¹äºå¨åæºä¸è¿è¡çå¤çº¿ç¨ç¨åºæ¥è¯´ï¼éæ¬èº«å¯ä»¥ç¨ä¸ä¸ªåéè¡¨ç¤ºï¼\n\n * åéä¸º 0ï¼è¡¨ç¤ºæ²¡æçº¿ç¨è·åé\n * åéä¸º 1ï¼è¡¨ç¤ºå·²ç»æçº¿ç¨è·åå°éäº\n\nèçº¿ç¨çå é/éæ¾éå°±æ¯æ£æ¥è¿ä¸ªåéå¹¶ä¿®æ¹çæä½ãç¨ä¸æ®µä»£ç æ¥å±ç¤ºå éåéæ¾éçæä½ï¼\n\nacquire_lock() {\n  if lock == 0\n     lock = 1\n     return 1\n  else        # å·²ç»æå«ççº¿ç¨è·åå°éäºï¼å éå¤±è´¥ \n     return 0\n}\n\nrelease_lock() {\n  lock = 0\n  return 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nèå¨åå¸å¼åºæ¯ä¸ï¼åå¸å¼éçåéç±ä¸ä¸ªå±äº«å­å¨ç³»ç»æ¥ç»´æ¤ï¼è¿æ ·å¤ä¸ªå®¢æ·ç«¯å°±å¯ä»¥è®¿é®åå¸å¼éäºï¼ç±æ­¤ï¼å éåéæ¾éçæä½å°±åæäºè¯»åãå¤æ­åè®¾ç½®å±äº«å­å¨ç³»ç»ä¸­çéåéå¼ã\n\nè¿æ ·ï¼æä»¬å°±å¯ä»¥å¾åºå®ç°åå¸å¼éçä¸¤ä¸ªè¦æ±ï¼\n\n * è¦æ±ä¸ï¼åå¸å¼éçå éåéæ¾éçè¿ç¨ï¼æ¶åå¤ä¸ªæä½ãæä»¥ï¼å¨å®ç°åå¸å¼éæ¶ï¼æä»¬éè¦ä¿è¯è¿äºéæä½çåå­æ§ï¼\n * è¦æ±äºï¼å±äº«å­å¨ç³»ç»ä¿å­äºéåéï¼å¦æå±äº«å­å¨ç³»ç»åçæéæå®æºï¼é£ä¹å®¢æ·ç«¯ä¹å°±æ æ³è¿è¡éæä½äºãå¨å®ç°åå¸å¼éæ¶ï¼æä»¬éè¦èèä¿è¯å±äº«å­å¨ç³»ç»çå¯é æ§ï¼è¿èä¿è¯éçå¯é æ§ã\n\nä¸é¢çä¸ä¸å¦ä½å®ç°åå¸å¼éãæä»¬æ¢å¯ä»¥åºäºåä¸ªredisèç¹æ¥å®ç°ï¼ä¹å¯ä»¥ä½¿ç¨å¤ä¸ªredisèç¹å®ç°ãå¨è¿ä¸¤ç§æåµä¸ï¼éçå¯é æ§æ¯ä¸ä¸æ ·çã\n\n\n# 2.2 åºäºåä¸ª redis èç¹å®ç°åå¸å¼é\n\nä½ä¸ºåå¸å¼éå®ç°è¿ç¨ä¸­çå±äº«å­å¨ç³»ç»ï¼redis å¯ä»¥ä½¿ç¨é®å¼å¯¹æ¥ä¿å­éåéï¼åæ¥æ¶åå¤çä¸åå®¢æ·ç«¯åéçå éåéæ¾éçæä½è¯·æ±ã\n\næä»¬è¦èµäºéåéä¸ä¸ªåéåï¼æè¿ä¸ªåéåä½ä¸ºé®å¼å¯¹çé®ï¼èéåéçå¼ï¼åæ¯é®å¼å¯¹çå¼ï¼è¿æ ·ä¸æ¥ï¼redis å°±è½ä¿å­éåéäºï¼å®¢æ·ç«¯ä¹å°±å¯ä»¥éè¿redisçå½ä»¤æä½æ¥å®ç°éæä½ã\n\nå éè¿ç¨ï¼\n\nåæï¼å¾ä¸­ï¼aåcåæ¶è¯·æ±å éãå ä¸ºredisä½¿ç¨åçº¿ç¨å¤çè¯·æ±ï¼æä»¥ï¼å³ä½¿å®¢æ·ç«¯aåcåæ¶æå éè¯·æ±åç»äºredisï¼redisä¹ä¼ä¸²è¡å¤çå®ä»¬çè¯·æ±ã\n\néæ¾éï¼\n\nå ä¸ºå éåå«äºä¸ä¸ªæä½ï¼è¯»åéåéãå¤æ­éåéå¼ä»¥åæéåéå¼è®¾ç½®ä¸º 1ï¼ï¼ä¸ºäºä¿è¯è¿ä¸ä¸ªæä½çåå­æ§ï¼å¨ redis ä¸­å¯ä»¥ä½¿ç¨åæä»¤æä½æä½¿ç¨ lua èæ¬ã\n\næä»¬çä¸ redis å¯ä»¥ç¨åªäºåå½ä»¤æä½å®ç°å éæä½ã\n\né¦åæ¯ setnx å½ä»¤ï¼ç¨äºè®¾ç½®é®å¼å¯¹çå¼ï¼è¿ä¸ªå½ä»¤å¨æ§è¡æ¶ä¼å¤æ­é®å¼å¯¹æ¯å¦å­å¨ï¼å¦æä¸å­å¨ï¼å°±è®¾ç½®é®å¼å¯¹çå¼ï¼å¦æå­å¨ï¼å°±ä¸åä»»ä½æä½ã\n\nå¯¹äºéæ¾éæä½æ¥è¯´ï¼æä»¬å¯ä»¥å¨æ§è¡å®ä¸å¡é»è¾åï¼ä½¿ç¨ del å½ä»¤å é¤éåéãä¸è¿ï¼ä½ ä¸ç¨æå¿éåéè¢«å é¤åï¼å¶ä»å®¢æ·ç«¯æ æ³è¯·æ±å éäºãå ä¸ºsetnxå½ä»¤å¨æ§è¡æ¶ï¼å¦æè¦è®¾ç½®çé®å¼å¯¹ï¼ä¹å°±æ¯éåéï¼ä¸å­å¨ï¼setnxå½ä»¤ä¼ååå»ºé®å¼å¯¹ï¼ç¶åè®¾ç½®å®çå¼ãæä»¥ï¼éæ¾éä¹åï¼åæå®¢æ·ç«¯è¯·æ±å éæ¶ï¼setnxå½ä»¤ä¼åå»ºä¿å­éåéçé®å¼å¯¹ï¼å¹¶è®¾ç½®éåéçå¼ï¼å®æå éã\n\næ»ç»æ¥è¯´ï¼æä»¬å°±å¯ä»¥ç¨ setnx å del å½ä»¤ç»åæ¥å®ç°å éåéæ¾éæä½ãä¸é¢çä¼ªä»£ç ç¤ºä¾æ¾ç¤ºäºéæä½çè¿ç¨ï¼\n\n// å é\nsetnx lock_key 1\n// ä¸å¡é»è¾\ndo things\n// éæ¾é\ndel lock_key\n\n\n1\n2\n3\n4\n5\n6\n\n\nä¸è¿ï¼ä½¿ç¨ setnx å del å½ä»¤ç»åå®ç°åå¸éï¼å­å¨ä¸¤ä¸ªæ½å¨çé£é©ï¼\n\n * é£é©ä¸ï¼åå¦æä¸ªå®¢æ·ç«¯å¨æ§è¡äºsetnxå½ä»¤ãå éä¹åï¼ç´§æ¥çå´å¨æä½å±äº«æ°æ®æ¶åçäºå¼å¸¸ï¼ç»æä¸ç´æ²¡ææ§è¡æåçdelå½ä»¤éæ¾éãå æ­¤ï¼éå°±ä¸ç´è¢«è¿ä¸ªå®¢æ·ç«¯ææï¼å¶å®å®¢æ·ç«¯æ æ³æ¿å°éï¼ä¹æ æ³è®¿é®å±äº«æ°æ®åæ§è¡åç»­æä½ï¼è¿ä¼ç»ä¸å¡åºç¨å¸¦æ¥å½±åã\n   * è§£å³æ¹æ³ï¼ç»éåéè®¾ç½®ä¸ä¸ªè¿ææ¶é´\n * é£é©äºï¼å¦æå®¢æ·ç«¯aæ§è¡äºsetnxå½ä»¤å éåï¼åè®¾å®¢æ·ç«¯bæ§è¡äºdelå½ä»¤éæ¾éï¼æ­¤æ¶ï¼å®¢æ·ç«¯açéå°±è¢«è¯¯éæ¾äºãå¦æå®¢æ·ç«¯cæ­£å¥½ä¹å¨ç³è¯·å éï¼å°±å¯ä»¥æåè·å¾éï¼è¿èå¼å§æä½å±äº«æ°æ®ãè¿æ ·ä¸æ¥ï¼å®¢æ·ç«¯aåcåæ¶å¨å¯¹å±äº«æ°æ®è¿è¡æä½ï¼æ°æ®å°±ä¼è¢«ä¿®æ¹éè¯¯ï¼è¿ä¹æ¯ä¸å¡å±ä¸è½æ¥åçã\n   * è§£å³æ¹æ³ï¼setnx å éæ¶å° value è®¾ç½®ä¸ºæå®¢æ·ç«¯çå¯ä¸ id å¼ï¼å¹¶å¨éæ¾æ¶å¤æ­è¯¥ id æ¯å¦ä¸èªå·±çç¸ç­ã\n\nç¥éäºéå¯¹é£é©äºçè§£å³æ¹æ³ï¼ä¸é¢çä¸ä¸å¨ redis å·ä½å¦ä½å®ç°ã\n\nä¸ºäºè½è¾¾å°åsetnxå½ä»¤ä¸æ ·çææï¼redisç»setå½ä»¤æä¾äºç±»ä¼¼çéé¡¹nxï¼ç¨æ¥å®ç°âä¸å­å¨å³è®¾ç½®âãå¦æä½¿ç¨äºnxéé¡¹ï¼setå½ä»¤åªæå¨é®å¼å¯¹ä¸å­å¨æ¶ï¼æä¼è¿è¡è®¾ç½®ï¼å¦åä¸åèµå¼æä½ãæ­¤å¤ï¼setå½ä»¤å¨æ§è¡æ¶è¿å¯ä»¥å¸¦ä¸exæpxéé¡¹ï¼ç¨æ¥è®¾ç½®é®å¼å¯¹çè¿ææ¶é´ãæ¯å¦ï¼æ§è¡ä¸é¢çå½ä»¤æ¶ï¼åªækeyä¸å­å¨æ¶ï¼setæä¼åå»ºkeyï¼å¹¶å¯¹keyè¿è¡èµå¼ãå¦å¤ï¼keyçå­æ´»æ¶é´ç±secondsæèmillisecondséé¡¹å¼æ¥å³å®ï¼\n\nset key value [ex seconds | px milliseconds]  [nx]\n\n\n1\n\n\næäºsetå½ä»¤çnxåex/pxéé¡¹åï¼æä»¬å°±å¯ä»¥ç¨ä¸é¢çå½ä»¤æ¥å®ç°å éæä½äºï¼\n\n// å é, unique_valueä½ä¸ºå®¢æ·ç«¯å¯ä¸æ§çæ è¯\nset lock_key unique_value nx px 10000\n\n\n1\n2\n\n\nå¶ä¸­ï¼unique_valueæ¯å®¢æ·ç«¯çå¯ä¸æ è¯ï¼å¯ä»¥ç¨ä¸ä¸ªéæºçæçå­ç¬¦ä¸²æ¥è¡¨ç¤ºï¼px 10000åè¡¨ç¤ºlock_keyä¼å¨10såè¿æï¼ä»¥åå®¢æ·ç«¯å¨è¿æé´åçå¼å¸¸èæ æ³éæ¾éã\n\nå ä¸ºå¨å éæä½ä¸­ï¼æ¯ä¸ªå®¢æ·ç«¯é½ä½¿ç¨äºä¸ä¸ªå¯ä¸æ è¯ï¼æä»¥å¨éæ¾éæä½æ¶ï¼æä»¬éè¦å¤æ­éåéçå¼ï¼æ¯å¦ç­äºæ§è¡éæ¾éæä½çå®¢æ·ç«¯çå¯ä¸æ è¯ï¼å¦ä¸æç¤ºï¼\n\n// éæ¾é æ¯è¾unique_valueæ¯å¦ç¸ç­ï¼é¿åè¯¯éæ¾\nif redis.call("get",keys[1]) == argv[1] then\n    return redis.call("del",keys[1])\nelse\n    return 0\nend\n\n\n1\n2\n3\n4\n5\n6\n\n\nè¿æ¯ä½¿ç¨luaèæ¬ï¼unlock.scriptï¼å®ç°çéæ¾éæä½çä¼ªä»£ç ï¼å¶ä¸­ï¼keys[1]è¡¨ç¤ºlock_keyï¼argv[1]æ¯å½åå®¢æ·ç«¯çå¯ä¸æ è¯ï¼è¿ä¸¤ä¸ªå¼é½æ¯æä»¬å¨æ§è¡luaèæ¬æ¶ä½ä¸ºåæ°ä¼ å¥çã\n\næåï¼æä»¬æ§è¡ä¸é¢çå½ä»¤ï¼å°±å¯ä»¥å®æééæ¾æä½äºï¼\n\nredis-cli  --eval  unlock.script lock_key , unique_value\n\n\n1\n\n\néè¿ lua èæ¬ä¿è¯äº redis å¨è¿è¡è¯»åéåéãå¤æ­å¼ãå é¤éåéçå¤ä¸ªæä½è½å¤åå­æ§å°æ§è¡ã\n\nå°æ­¤ï¼æä»¬å®ç°äºä½¿ç¨ redis å®ä¾æ¥å®ç°åå¸å¼éãä½æ¯ä¸ºäºé¿ååç¹æéï¼æä»¬è¿è¦åºäºå¤ä¸ª redis èç¹æ¥å®ç°åå¸å¼éã\n\n\n# 2.3 åºäºå¤ä¸ª redis èç¹å®ç°é«å¯é çåå¸å¼é\n\nå½æä»¬è¦å®ç°é«å¯é çåå¸å¼éæ¶ï¼å°±ä¸è½åªä¾èµåä¸ªçå½ä»¤æä½äºï¼æä»¬éè¦æç§ä¸å®çæ­¥éª¤åè§åè¿è¡å è§£éæä½ï¼å¦åï¼å°±å¯è½ä¼åºç°éæ æ³å·¥ä½çæåµãè¿éè¯´çâä¸å®çæ­¥éª¤åè§åâå°±æ¯æçåå¸å¼éçç®æ³ã\n\nä¸ºäºé¿å redis å®ä¾æéèå¯¼è´çéæ æ³å·¥ä½çé®é¢ï¼redis çå¼åè antirez æåºäºåå¸å¼éç®æ³ redlockã\n\nredlock ç®æ³çåºæ¬æè·¯ï¼æ¯è®©å®¢æ·ç«¯åå¤ä¸ªç¬ç«çrediså®ä¾ä¾æ¬¡è¯·æ±å éï¼å¦æå®¢æ·ç«¯è½å¤ååæ°ä»¥ä¸çå®ä¾æåå°å®æå éæä½ï¼é£ä¹æä»¬å°±è®¤ä¸ºï¼å®¢æ·ç«¯æåå°è·å¾åå¸å¼éäºï¼å¦åå éå¤±è´¥ãè¿æ ·ä¸æ¥ï¼å³ä½¿æåä¸ªrediså®ä¾åçæéï¼å ä¸ºéåéå¨å¶å®å®ä¾ä¸ä¹æä¿å­ï¼æä»¥ï¼å®¢æ·ç«¯ä»ç¶å¯ä»¥æ­£å¸¸å°è¿è¡éæä½ï¼éåéå¹¶ä¸ä¼ä¸¢å¤±ã\n\næä»¬æ¥å·ä½çä¸ redlock ç®æ³çæ§è¡æ­¥éª¤ãredlock ç®æ³çå®ç°éè¦æ n ä¸ªç¬ç«ç redis å®ä¾ãæ¥ä¸æ¥ï¼æä»¬å¯ä»¥åæ 3 æ­¥æ¥å®æå éæä½ï¼\n\nç¬¬ä¸æ­¥ï¼å®¢æ·ç«¯è·åå½åæ¶é´ã\n\nç¬¬äºæ­¥ï¼å®¢æ·ç«¯æé¡ºåºä¾æ¬¡å n ä¸ª redis å®ä¾æ§è¡å éæä½ã\n\nè¿éçå éæä½åå¨åå®ä¾ä¸æ§è¡çå éæä½ä¸æ ·ï¼ä½¿ç¨setå½ä»¤ï¼å¸¦ä¸nxï¼ex/pxéé¡¹ï¼ä»¥åå¸¦ä¸å®¢æ·ç«¯çå¯ä¸æ è¯ãå½ç¶ï¼å¦ææä¸ªrediså®ä¾åçæéäºï¼ä¸ºäºä¿è¯å¨è¿ç§æåµä¸ï¼redlockç®æ³è½å¤ç»§ç»­è¿è¡ï¼æä»¬éè¦ç»å éæä½è®¾ç½®ä¸ä¸ªè¶æ¶æ¶é´ã\n\nå¦æå®¢æ·ç«¯å¨åä¸ä¸ªrediså®ä¾è¯·æ±å éæ¶ï¼ä¸ç´å°è¶æ¶é½æ²¡ææåï¼é£ä¹æ­¤æ¶ï¼å®¢æ·ç«¯ä¼åä¸ä¸ä¸ªrediså®ä¾ç»§ç»­è¯·æ±å éãå éæä½çè¶æ¶æ¶é´éè¦è¿è¿å°å°äºéçæææ¶é´ï¼ä¸è¬ä¹å°±æ¯è®¾ç½®ä¸ºå åæ¯«ç§ã\n\nç¬¬ä¸æ­¥ï¼ä¸æ¦å®¢æ·ç«¯å®æäºåææ redis å®ä¾çå éæä½ï¼å®¢æ·ç«¯å°±è¦è®¡ç®æ´ä¸ªå éè¿ç¨çæ»èæ¶ã\n\nå®¢æ·ç«¯åªæå¨æ»¡è¶³ä¸é¢çè¿ä¸¤ä¸ªæ¡ä»¶æ¶ï¼æè½è®¤ä¸ºæ¯å éæåã\n\n * æ¡ä»¶ä¸ï¼å®¢æ·ç«¯ä»è¶è¿åæ°ï¼å¤§äºç­äº n/2+1ï¼ç redis å®ä¾ä¸æåè·åå°äºéï¼\n * æ¡ä»¶äºï¼å®¢æ·ç«¯è·åéçæ»èæ¶æ²¡æè¶è¿éçæææ¶é´ã\n\nå¨æ»¡è¶³äºè¿ä¸¤ä¸ªæ¡ä»¶åï¼æä»¬éè¦éæ°è®¡ç®è¿æéçæææ¶é´ï¼è®¡ç®çç»ææ¯éçæåæææ¶é´åå»å®¢æ·ç«¯ä¸ºè·åéçæ»èæ¶ãå¦æéçæææ¶é´å·²ç»æ¥ä¸åå®æå±äº«æ°æ®çæä½äºï¼æä»¬å¯ä»¥éæ¾éï¼ä»¥ååºç°è¿æ²¡å®ææ°æ®æä½ï¼éå°±è¿æäºçæåµã\n\nå½ç¶ï¼å¦æå®¢æ·ç«¯å¨åææå®ä¾æ§è¡å®å éæä½åï¼æ²¡è½åæ¶æ»¡è¶³è¿ä¸¤ä¸ªæ¡ä»¶ï¼é£ä¹ï¼å®¢æ·ç«¯åææredisèç¹åèµ·éæ¾éçæä½ã\n\nå¨redlockç®æ³ä¸­ï¼éæ¾éçæä½åå¨åå®ä¾ä¸éæ¾éçæä½ä¸æ ·ï¼åªè¦æ§è¡éæ¾éçluaèæ¬å°±å¯ä»¥äºãè¿æ ·ä¸æ¥ï¼åªè¦nä¸ªrediså®ä¾ä¸­çåæ°ä»¥ä¸å®ä¾è½æ­£å¸¸å·¥ä½ï¼å°±è½ä¿è¯åå¸å¼éçæ­£å¸¸å·¥ä½äºã\n\næä»¥ï¼å¨å®éçä¸å¡åºç¨ä¸­ï¼å¦æä½ æ³è¦æååå¸å¼éçå¯é æ§ï¼å°±å¯ä»¥éè¿ redlock ç®æ³æ¥å®ç°ã\n\n\n# 2.4 å°ç»\n\nåå¸å¼éæ¯ç±å±äº«å­å¨ç³»ç»ç»´æ¤çåéï¼å¤ä¸ªå®¢æ·ç«¯å¯ä»¥åå±äº«å­å¨ç³»ç»åéå½ä»¤è¿è¡å éæéæ¾éæä½ãredis ä½ä¸ºä¸ä¸ªå±äº«å­å¨ç³»ç»ï¼å¯ä»¥ç¨æ¥å®ç°åå¸å¼éã\n\nå¨åºäºåä¸ªrediså®ä¾å®ç°åå¸å¼éæ¶ï¼å¯¹äºå éæä½ï¼æä»¬éè¦æ»¡è¶³ä¸ä¸ªæ¡ä»¶ã\n\n 1. å éåæ¬äºè¯»åéåéãæ£æ¥éåéå¼åè®¾ç½®éåéå¼ä¸ä¸ªæä½ï¼ä½éè¦ä»¥åå­æä½çæ¹å¼å®æï¼æä»¥ï¼æä»¬ä½¿ç¨setå½ä»¤å¸¦ä¸nxéé¡¹æ¥å®ç°å éï¼\n 2. éåééè¦è®¾ç½®è¿ææ¶é´ï¼ä»¥åå®¢æ·ç«¯æ¿å°éååçå¼å¸¸ï¼å¯¼è´éä¸ç´æ æ³éæ¾ï¼æä»¥ï¼æä»¬å¨setå½ä»¤æ§è¡æ¶å ä¸ex/pxéé¡¹ï¼è®¾ç½®å¶è¿ææ¶é´ï¼\n 3. éåéçå¼éè¦è½åºåæ¥èªä¸åå®¢æ·ç«¯çå éæä½ï¼ä»¥åå¨éæ¾éæ¶ï¼åºç°è¯¯éæ¾æä½ï¼æä»¥ï¼æä»¬ä½¿ç¨setå½ä»¤è®¾ç½®éåéå¼æ¶ï¼æ¯ä¸ªå®¢æ·ç«¯è®¾ç½®çå¼æ¯ä¸ä¸ªå¯ä¸å¼ï¼ç¨äºæ è¯å®¢æ·ç«¯ã\n\nåå éç±»ä¼¼ï¼éæ¾éä¹åå«äºè¯»åéåéå¼ãå¤æ­éåéå¼åå é¤éåéä¸ä¸ªæä½ï¼ä¸è¿ï¼æä»¬æ æ³ä½¿ç¨åä¸ªå½ä»¤æ¥å®ç°ï¼æä»¥ï¼æä»¬å¯ä»¥éç¨luaèæ¬æ§è¡éæ¾éæä½ï¼éè¿redisåå­æ§å°æ§è¡luaèæ¬ï¼æ¥ä¿è¯éæ¾éæä½çåå­æ§ã\n\nä¸è¿ï¼åºäºåä¸ª redis å®ä¾å®ç°åå¸å¼éæ¶ï¼ä¼é¢ä¸´å®ä¾å¼å¸¸æå´©æºçæåµï¼è¿ä¼å¯¼è´å®ä¾æ æ³æä¾éæä½ï¼æ­£å ä¸ºæ­¤ï¼redis ä¹æä¾äº redlock ç®æ³ï¼ç¨æ¥å®ç°åºäºå¤ä¸ªå®ä¾çåå¸å¼éãè¿æ ·ä¸æ¥ï¼éåéç±å¤ä¸ªå®ä¾ç»´æ¤ï¼å³ä½¿æå®ä¾åçäºæéï¼éåéä»ç¶æ¯å­å¨çï¼å®¢æ·ç«¯è¿æ¯å¯ä»¥å®æéæä½ãredlock ç®æ³æ¯å®ç°é«å¯é åå¸å¼éçä¸ç§ææè§£å³æ¹æ¡ï¼ä½ å¯ä»¥å¨å®éåºç¨ä¸­æå®ç¨èµ·æ¥ã',charsets:{cjk:!0},lastUpdated:"2023/04/18, 14:13:32",lastUpdatedTimestamp:1681827212e3},{title:"Redis çäºå¡æºå¶",frontmatter:{title:"Redis çäºå¡æºå¶",date:"2023-04-18T22:17:42.000Z",permalink:"/pages/932816/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/31.Redis%20%E7%9A%84%E4%BA%8B%E5%8A%A1%E6%9C%BA%E5%88%B6.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/31.Redis çäºå¡æºå¶.md",key:"v-2f859720",path:"/pages/932816/",headers:[{level:2,title:"1. äºå¡æºå¶ï¼Redis è½å®ç° ACID å±æ§åï¼",slug:"_1-äºå¡æºå¶-redis-è½å®ç°-acid-å±æ§å",normalizedTitle:"1. äºå¡æºå¶ï¼redis è½å®ç° acid å±æ§åï¼",charIndex:49},{level:3,title:"1.1 ACID å±æ§çè¦æ±",slug:"_1-1-acid-å±æ§çè¦æ±",normalizedTitle:"1.1 acid å±æ§çè¦æ±",charIndex:128},{level:3,title:"1.2 Redis å¦ä½å®ç°äºå¡ï¼",slug:"_1-2-redis-å¦ä½å®ç°äºå¡",normalizedTitle:"1.2 redis å¦ä½å®ç°äºå¡ï¼",charIndex:163},{level:3,title:"1.3 Redis çäºå¡æºå¶è½ä¿è¯åªäºå±æ§ï¼",slug:"_1-3-redis-çäºå¡æºå¶è½ä¿è¯åªäºå±æ§",normalizedTitle:"1.3 redis çäºå¡æºå¶è½ä¿è¯åªäºå±æ§ï¼",charIndex:796},{level:4,title:"1.3.1 åå­æ§",slug:"_1-3-1-åå­æ§",normalizedTitle:"1.3.1 åå­æ§",charIndex:834},{level:4,title:"1.3.2 ä¸è´æ§",slug:"_1-3-2-ä¸è´æ§",normalizedTitle:"1.3.2 ä¸è´æ§",charIndex:2595},{level:4,title:"1.3.3 éç¦»æ§",slug:"_1-3-3-éç¦»æ§",normalizedTitle:"1.3.3 éç¦»æ§",charIndex:3197},{level:4,title:"1.3.4 æä¹æ§",slug:"_1-3-4-æä¹æ§",normalizedTitle:"1.3.4 æä¹æ§",charIndex:3953},{level:3,title:"1.4 å°ç»",slug:"_1-4-å°ç»",normalizedTitle:"1.4 å°ç»",charIndex:4257}],headersStr:"1. äºå¡æºå¶ï¼Redis è½å®ç° ACID å±æ§åï¼ 1.1 ACID å±æ§çè¦æ± 1.2 Redis å¦ä½å®ç°äºå¡ï¼ 1.3 Redis çäºå¡æºå¶è½ä¿è¯åªäºå±æ§ï¼ 1.3.1 åå­æ§ 1.3.2 ä¸è´æ§ 1.3.3 éç¦»æ§ 1.3.4 æä¹æ§ 1.4 å°ç»",content:'> åèï¼\n> \n>  * 31 äºå¡æºå¶ï¼Redisè½å®ç°ACIDå±æ§åï¼| æå®¢æ¶é´\n\n\n# 1. äºå¡æºå¶ï¼Redis è½å®ç° ACID å±æ§åï¼\n\näºå¡æä¾äºå¯¹æ°æ®è¯»åç ACID çä¿è¯ï¼é£ Redis å¯ä»¥å®å¨ä¿è¯ ACID å±æ§åï¼\n\n\n# 1.1 ACID å±æ§çè¦æ±\n\nå¯ä»¥åè äºå¡ è¿ä¸ç¯æç« ã\n\n\n# 1.2 Redis å¦ä½å®ç°äºå¡ï¼\n\näºå¡çæ§è¡è¿ç¨åå«ä¸ä¸ªæ­¥éª¤ï¼Redis æä¾äº MULTIãEXEC ä¸¤ä¸ªå½ä»¤æ¥å®æè¿ä¸ä¸ªæ­¥éª¤ãä¸é¢çä¸ä¸ï¼\n\n 1. ç¬¬ä¸æ­¥ï¼å®¢æ·ç«¯è¦ä½¿ç¨ MULTI å½ä»¤æ¥æ¾å¼å°è¡¨ç¤ºä¸ä¸ªäºå¡çå¼å¯ã\n 2. ç¬¬äºæ­¥ï¼å®¢æ·ç«¯æäºå¡æ¬èº«è¦æ§è¡çå·ä½æä½ï¼ä¾å¦å¢å æ¹æ°æ®ï¼åéç»æå¡å¨ç«¯ãè¿äºæä½å°±æ¯ Redis æ¬èº«æä¾çæ°æ®è¯»åå½ä»¤ï¼ä¾å¦ GETãSET ç­ãä¸è¿ï¼è¿äºå½ä»¤è½ç¶è¢«å®¢æ·ç«¯åéå°äºæå¡å¨ç«¯ï¼ä½ Redis å®ä¾åªæ¯æè¿äºå½ä»¤æå­å°ä¸ä¸ªå½ä»¤éåä¸­ï¼å¹¶ä¸ä¼ç«å³æ§è¡ã\n 3. ç¬¬ä¸æ­¥ï¼å®¢æ·ç«¯å Redis åé EXEC å½ä»¤æ¥æ§è¡äºå¡æäº¤ï¼è®©æ°æ®åºå®éæ§è¡ç¬¬äºæ­¥ä¸­åéçå·ä½æä½ã\n\nå¦ä¸ä»£ç æ¯ä½¿ç¨ MULTI å EXEC æ§è¡ä¸ä¸ªäºå¡çè¿ç¨ï¼\n\n# å¼å¯äºå¡\n127.0.0.1:6379> MULTI\nOK\n# å°a:stockå1ï¼\n127.0.0.1:6379> DECR a:stock\nQUEUED\n# å°b:stockå1\n127.0.0.1:6379> DECR b:stock\nQUEUED\n# å®éæ§è¡äºå¡\n127.0.0.1:6379> EXEC\n1) (integer) 4\n2) (integer) 9\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¥½äºï¼éè¿ä½¿ç¨ MULTI å EXEC å½ä»¤ï¼æä»¬å¯ä»¥å®ç°å¤ä¸ªæä½çå±åæ§è¡ï¼ä½æ¯è¿ç¬¦åäºå¡è¦æ±ç ACID å±æ§åï¼\n\n\n# 1.3 Redis çäºå¡æºå¶è½ä¿è¯åªäºå±æ§ï¼\n\nè¿éåå«åæä¸ä¸ã\n\n# 1.3.1 åå­æ§\n\nå¦æäºå¡æ§è¡åºç°éè¯¯ï¼åå­æ§è¿è½ä¿è¯åï¼è¿è¦åä¸ç§æåµæ¥çå¾ã\n\n * ç¬¬ä¸ç§æåµæ¯ï¼å¨æ§è¡EXECå½ä»¤åï¼å®¢æ·ç«¯åéçæä½å½ä»¤æ¬èº«å°±æéè¯¯ï¼æ¯å¦è¯­æ³éè¯¯ï¼ä½¿ç¨äºä¸å­å¨çå½ä»¤ï¼ï¼å¨å½ä»¤å¥éæ¶å°±è¢« Redis å®ä¾å¤æ­åºæ¥äºãæ­¤æ¶ Redis ä¼æç»æ§è¡æææäº¤çå½ä»¤ï¼ä»èä¿è¯äºåå­æ§ã\n   * ä¾å­ï¼\n\n#å¼å¯äºå¡\n127.0.0.1:6379> MULTI\nOK\n#åéäºå¡ä¸­çç¬¬ä¸ä¸ªæä½ï¼ä½æ¯Redisä¸æ¯æè¯¥å½ä»¤ï¼è¿åæ¥éä¿¡æ¯\n127.0.0.1:6379> PUT a:stock 5\n(error) ERR unknown command `PUT`, with args beginning with: `a:stock`, `5`,\n#åéäºå¡ä¸­çç¬¬äºä¸ªæä½ï¼è¿ä¸ªæä½æ¯æ­£ç¡®çå½ä»¤ï¼Redisæè¯¥å½ä»¤å¥é\n127.0.0.1:6379> DECR b:stock\nQUEUED\n#å®éæ§è¡äºå¡ï¼ä½æ¯ä¹åå½ä»¤æéè¯¯ï¼æä»¥Redisæç»æ§è¡\n127.0.0.1:6379> EXEC\n(error) EXECABORT Transaction discarded because of previous errors.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n * ç¬¬äºç§æåµæ¯ï¼æä¸ªå½ä»¤å¨äºå¡æ§è¡æé´åºç°éè¯¯ï¼å¦å½ä»¤åæä½çæ°æ®ç±»åä¸å¹éï¼å¨æä½å¥éæ¶æ²¡æè¢« Redis å®ä¾æ£æ¥åºéè¯¯ãè¿æ¶å°½ç®¡ Redis ä¼å¯¹åä¸ªå½ä»¤æ¥éï¼ä½è¿æ¯ä¼æè¿ä¸ªäºå¡æ¥ä¸æ¥çææå½ä»¤æ§è¡å®ãå¨è¿ç§æåµä¸ï¼äºå¡çåå­æ§å°±æ æ³å¾å°ä¿è¯äºã\n   * ä¾å­ï¼\n\n#å¼å¯äºå¡\n127.0.0.1:6379> MULTI\nOK\n#åéäºå¡ä¸­çç¬¬ä¸ä¸ªæä½ï¼LPOPå½ä»¤æä½çæ°æ®ç±»åä¸å¹éï¼æ­¤æ¶å¹¶ä¸æ¥é\n127.0.0.1:6379> LPOP a:stock\nQUEUED\n#åéäºå¡ä¸­çç¬¬äºä¸ªæä½\n127.0.0.1:6379> DECR b:stock\nQUEUED\n#å®éæ§è¡äºå¡ï¼äºå¡ç¬¬ä¸ä¸ªæä½æ§è¡æ¥é\n127.0.0.1:6379> EXEC\n1) (error) WRONGTYPE Operation against a key holding the wrong kind of value\n2) (integer) 8\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n * ç¬¬ä¸ç§æåµæ¯ï¼äºå¡æ§è¡æé´ Redis å®ä¾åçäºæéï¼å¯¼è´äºå¡æ§è¡å¤±è´¥ãå¨è¿ç§æåµä¸ï¼\n   * å¦æRediså¼å¯äºAOFæ¥å¿ï¼é£ä¹ï¼åªä¼æé¨åçäºå¡æä½è¢«è®°å½å°AOFæ¥å¿ä¸­ãæä»¬éè¦ä½¿ç¨redis-check-aofå·¥å·æ£æ¥AOFæ¥å¿æä»¶ï¼è¿ä¸ªå·¥å·å¯ä»¥ææªå®æçäºå¡æä½ä»AOFæä»¶ä¸­å»é¤ãè¿æ ·ä¸æ¥ï¼æä»¬ä½¿ç¨AOFæ¢å¤å®ä¾åï¼äºå¡æä½ä¸ä¼åè¢«æ§è¡ï¼ä»èä¿è¯äºåå­æ§ã\n   * å¦æAOFæ¥å¿å¹¶æ²¡æå¼å¯ï¼é£ä¹å®ä¾éå¯åï¼æ°æ®ä¹é½æ²¡æ³æ¢å¤äºï¼æ­¤æ¶ï¼ä¹å°±è°ä¸ä¸åå­æ§äºã\n\nRedis ä¹æ²¡ææä¾åæ»æºå¶ãè½ç¶ Redis æä¾äº DISCARD å½ä»¤ï¼ä½è¿ä¸ªå½ä»¤åªè½ç¨æ¥ä¸»å¨æ¾å¼äºå¡çæ§è¡ï¼ææå­çå½ä»¤éåæ¸ç©ºï¼èµ·ä¸å°åæ»çææãä¸é¢ä»£ç å±ç¤º DISCARD å½ä»¤çä½¿ç¨ï¼\n\n#è¯»åa:stockçå¼4\n127.0.0.1:6379> GET a:stock\n"4"\n#å¼å¯äºå¡\n127.0.0.1:6379> MULTI\nOK\n#åéäºå¡çç¬¬ä¸ä¸ªæä½ï¼å¯¹a:stockå1\n127.0.0.1:6379> DECR a:stock\nQUEUED\n#æ§è¡DISCARDå½ä»¤ï¼ä¸»å¨æ¾å¼äºå¡\n127.0.0.1:6379> DISCARD\nOK\n#åæ¬¡è¯»åa:stockçå¼ï¼å¼æ²¡æè¢«ä¿®æ¹\n127.0.0.1:6379> GET a:stock\n"4"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿éæ»ç»ä¸ä¸ Redis å¯¹äºå¡åå­æ§çä¿è¯æåµï¼\n\n * å½ä»¤å¥éæ¶å°±æ¥éï¼ä¼æ¾å¼äºå¡æ§è¡ï¼ä¿è¯åå­æ§ï¼\n * å½ä»¤å¥éæ¶æ²¡æ¥éï¼å®éæ§è¡æ¶æ¥éï¼ä¸ä¿è¯åå­æ§ï¼\n * EXEC å½ä»¤æ§è¡æ¶å®ä¾æéï¼å¦æå¼å¯äº AOF æ¥å¿ï¼å¯ä»¥ä¿è¯åå­æ§ã\n\n# 1.3.2 ä¸è´æ§\n\næä»¬æç§å½ä»¤åºéåå®ä¾æéçåçæ¶æºï¼åæä¸ç§æåµæ¥çï¼\n\n 1. æåµä¸ï¼å½ä»¤å¥éæ¶å°±æ¥éãå¨è¿ç§æåµä¸ï¼äºå¡æ¬èº«å°±ä¼è¢«æ¾å¼æ§è¡ï¼æä»¥å¯ä»¥ä¿è¯æ°æ®åºçä¸è´æ§ã\n 2. æåµäºï¼å½ä»¤å¥éæ¶æ²¡æ¥éï¼å®éæ§è¡æ¶æ¥éãå¨è¿ç§æåµä¸ï¼æéè¯¯çå½ä»¤ä¸ä¼è¢«æ§è¡ï¼æ­£ç¡®çå½ä»¤å¯ä»¥æ­£å¸¸æ§è¡ï¼ä¹ä¸ä¼æ¹åæ°æ®åºçä¸è´æ§ã\n 3. æåµä¸ï¼EXEC å½ä»¤æ§è¡æ¶å®ä¾åçæéãå¨è¿ç§æåµä¸ï¼å®ä¾æéåä¼è¿è¡éå¯ï¼è¿å°±åæ°æ®æ¢å¤çæ¹å¼æå³äºï¼æä»¬è¦æ ¹æ®å®ä¾æ¯å¦å¼å¯äºRDBæAOFæ¥åæåµè®¨è®ºä¸ã\n    * è¥æ²¡æå¼å¯ RDB æ AOF æ¥å¿ï¼é£å®ä¾æééå¯åï¼æ°æ®é½æ²¡æäºï¼æ°æ®åºæ¯ä¸è´çã\n    * è¥ä½¿ç¨äº RDB å¿«ç§ï¼å ä¸ºRDBå¿«ç§ä¸ä¼å¨äºå¡æ§è¡æ¶æ§è¡ï¼æä»¥ï¼äºå¡å½ä»¤æä½çç»æä¸ä¼è¢«ä¿å­å° RDB å¿«ç§ä¸­ï¼ä½¿ç¨ RDB å¿«ç§è¿è¡æ¢å¤æ¶ï¼æ°æ®åºéçæ°æ®ä¹æ¯ä¸è´çã\n    * è¥ä½¿ç¨äº AOF æ¥å¿ï¼\n      * å¦æäºå¡æä½è¿æ²¡æè¢«è®°å½å°AOFæ¥å¿æ¶ï¼å®ä¾å°±åçäºæéï¼é£ä¹ï¼ä½¿ç¨AOFæ¥å¿æ¢å¤çæ°æ®åºæ°æ®æ¯ä¸è´çã\n      * å¦æåªæé¨åæä½è¢«è®°å½å°äºAOFæ¥å¿ï¼æä»¬å¯ä»¥ä½¿ç¨redis-check-aofæ¸é¤äºå¡ä¸­å·²ç»å®æçæä½ï¼æ°æ®åºæ¢å¤åä¹æ¯ä¸è´çã\n\næä»¥ï¼æ»ç»æ¥è¯´ï¼å¨å½ä»¤æ§è¡éè¯¯æ Redis åçæéçæåµä¸ï¼Redis äºå¡æºå¶å¯¹ä¸è´æ§å±æ§æ¯æä¿è¯çã\n\n# 1.3.3 éç¦»æ§\n\näºå¡çéç¦»æ§ä¿è¯ï¼ä¼åå°åäºå¡ä¸èµ·æ§è¡çå¹¶åæä½çå½±åãèäºå¡æ§è¡åå¯ä»¥åæå½ä»¤å¥éï¼EXEC å½ä»¤æ§è¡åï¼åå½ä»¤å®éæ§è¡ï¼EXEC å½ä»¤æ§è¡åï¼ä¸¤ä¸ªé¶æ®µï¼æä»¥ï¼æä»¬å°±éå¯¹è¿ä¸¤ä¸ªé¶æ®µï¼åæä¸¤ç§æåµæ¥åæï¼\n\n 1. å¹¶åæä½å¨ EXEC å½ä»¤åæ§è¡ï¼æ­¤æ¶ï¼éç¦»æ§çä¿è¯è¦ä½¿ç¨ WATCH æºå¶æ¥å®ç°ï¼å¦åéç¦»æ§æ æ³ä¿è¯ï¼\n 2. å¹¶åæä½å¨ EXEC å½ä»¤åæ§è¡ï¼æ­¤æ¶ï¼éç¦»æ§å¯ä»¥ä¿è¯ã\n\næä»¬åæ¥çç¬¬ä¸ç§æåµãä¸ä¸ªäºå¡ç EXEC å½ä»¤è¿æ²¡ææ§è¡æ¶ï¼äºå¡çå½ä»¤æä½æ¯æå­å¨å½ä»¤éåä¸­çãæ­¤æ¶ï¼å¦ææå¶å®çå¹¶åæä½ï¼æä»¬å°±éè¦çäºå¡æ¯å¦ä½¿ç¨äº WATCH æºå¶ã\n\nWATCH æºå¶çä½ç¨æ¯ï¼å¨äºå¡æ§è¡åï¼çæ§ä¸ä¸ªæå¤ä¸ªé®çå¼ååæåµï¼å½äºå¡è°ç¨ EXEC å½ä»¤æ§è¡æ¶ï¼WATCH æºå¶ä¼åæ£æ¥çæ§çé®æ¯å¦è¢«å¶å®å®¢æ·ç«¯ä¿®æ¹äºãå¦æä¿®æ¹äºï¼å°±æ¾å¼äºå¡æ§è¡ï¼é¿åäºå¡çéç¦»æ§è¢«ç ´åãç¶åï¼å®¢æ·ç«¯å¯ä»¥åæ¬¡æ§è¡äºå¡ï¼æ­¤æ¶ï¼å¦ææ²¡æå¹¶åä¿®æ¹äºå¡æ°æ®çæä½äºï¼äºå¡å°±è½æ­£å¸¸æ§è¡ï¼éç¦»æ§ä¹å¾å°äºä¿è¯ã\n\nWATCHæºå¶çå·ä½å®ç°æ¯ç±WATCHå½ä»¤å®ç°çï¼æç»ä½ ä¸¾ä¸ªä¾å­ï¼ä½ å¯ä»¥çä¸ä¸é¢çå¾ï¼è¿ä¸æ­¥çè§£ä¸WATCHå½ä»¤çä½¿ç¨ï¼\n\nå½ç¶ï¼å¦ææ²¡æä½¿ç¨WATCHæºå¶ï¼å¨EXECå½ä»¤åæ§è¡çå¹¶åæä½æ¯ä¼å¯¹æ°æ®è¿è¡è¯»åçãèä¸ï¼å¨æ§è¡EXECå½ä»¤çæ¶åï¼äºå¡è¦æä½çæ°æ®å·²ç»æ¹åäºï¼å¨è¿ç§æåµä¸ï¼Rediså¹¶æ²¡æåå°è®©äºå¡å¯¹å¶å®æä½éç¦»ï¼éç¦»æ§ä¹å°±æ²¡æå¾å°ä¿éãä¸é¢è¿å¼ å¾æ¾ç¤ºäºæ²¡æWATCHæºå¶æ¶çæåµï¼\n\nå¯¹äºç¬¬äºç§æåµï¼å ä¸º Redis æ¯ç¨åçº¿ç¨æ§è¡å½ä»¤ï¼èä¸ï¼EXEC å½ä»¤æ§è¡åï¼Redis ä¼ä¿è¯åæå½ä»¤éåä¸­çææå½ä»¤æ§è¡å®ãæä»¥ï¼å¨è¿ç§æåµä¸ï¼å¹¶åæä½ä¸ä¼ç ´åäºå¡çéç¦»æ§ï¼å¦ä¸å¾æç¤ºï¼\n\n# 1.3.4 æä¹æ§\n\nå ä¸º Redis æ¯åå­æ°æ®åºï¼æä»¥ï¼æ°æ®æ¯å¦æä¹åä¿å­å®å¨åå³äº Redis çæä¹åéç½®æ¨¡å¼ã\n\nå¦æRedisæ²¡æä½¿ç¨RDBæAOFï¼é£ä¹äºå¡çæä¹åå±æ§è¯å®å¾ä¸å°ä¿è¯ãå¦æRedisä½¿ç¨äºRDBæ¨¡å¼ï¼é£ä¹ï¼å¨ä¸ä¸ªäºå¡æ§è¡åï¼èä¸ä¸æ¬¡çRDBå¿«ç§è¿æªæ§è¡åï¼å¦æåçäºå®ä¾å®æºï¼è¿ç§æåµä¸ï¼äºå¡ä¿®æ¹çæ°æ®ä¹æ¯ä¸è½ä¿è¯æä¹åçã\n\nå¦æRediséç¨äºAOFæ¨¡å¼ï¼å ä¸ºAOFæ¨¡å¼çä¸ç§éç½®éé¡¹noãeverysecåalwaysé½ä¼å­å¨æ°æ®ä¸¢å¤±çæåµï¼æä»¥ï¼äºå¡çæä¹æ§å±æ§ä¹è¿æ¯å¾ä¸å°ä¿è¯ã\n\næä»¥ï¼ä¸ç®¡ Redis éç¨ä»ä¹æä¹åæ¨¡å¼ï¼äºå¡çæä¹æ§å±æ§æ¯å¾ä¸å°ä¿è¯çã\n\n\n# 1.4 å°ç»\n\nè¿ä¸èå­¦ä¹ äº Redis çäºå¡å®ç°ï¼å®éè¿ MULTIãEXECãDISCARD å WATCH åä¸ªå½ä»¤æ¥æ¯æäºå¡æºå¶ï¼æ»ç»å¦ä¸ï¼\n\näºå¡çACIDå±æ§æ¯æä»¬ä½¿ç¨äºå¡è¿è¡æ­£ç¡®æä½çåºæ¬è¦æ±ãéè¿è¿èè¯¾çåæï¼æä»¬äºè§£å°äºï¼Redisçäºå¡æºå¶å¯ä»¥ä¿è¯ä¸è´æ§åéç¦»æ§ï¼ä½æ¯æ æ³ä¿è¯æä¹æ§ãä¸è¿ï¼å ä¸ºRedisæ¬èº«æ¯åå­æ°æ®åºï¼æä¹æ§å¹¶ä¸æ¯ä¸ä¸ªå¿é¡»çå±æ§ï¼æä»¬æ´å å³æ³¨çè¿æ¯åå­æ§ãä¸è´æ§åéç¦»æ§è¿ä¸ä¸ªå±æ§ã\n\nåå­æ§çæåµæ¯è¾å¤æï¼åªæå½äºå¡ä¸­ä½¿ç¨çå½ä»¤è¯­æ³æè¯¯æ¶ï¼åå­æ§å¾ä¸å°ä¿è¯ï¼å¨å¶å®æåµä¸ï¼äºå¡é½å¯ä»¥åå­æ§æ§è¡ã\n\nå»ºè®®ï¼ä¸¥æ ¼æç§ Redis çå½ä»¤è§èè¿è¡ç¨åºå¼åï¼å¹¶ä¸éè¿ code review ç¡®ä¿å½ä»¤çæ­£ç¡®æ§ãè¿æ ·ä¸æ¥ï¼Redis çäºå¡æºå¶å°±è½è¢«åºç¨å¨å®è·µä¸­ï¼ä¿è¯å¤æä½çæ­£ç¡®æ§è¡ã',normalizedContent:'> åèï¼\n> \n>  * 31 äºå¡æºå¶ï¼redisè½å®ç°acidå±æ§åï¼| æå®¢æ¶é´\n\n\n# 1. äºå¡æºå¶ï¼redis è½å®ç° acid å±æ§åï¼\n\näºå¡æä¾äºå¯¹æ°æ®è¯»åç acid çä¿è¯ï¼é£ redis å¯ä»¥å®å¨ä¿è¯ acid å±æ§åï¼\n\n\n# 1.1 acid å±æ§çè¦æ±\n\nå¯ä»¥åè äºå¡ è¿ä¸ç¯æç« ã\n\n\n# 1.2 redis å¦ä½å®ç°äºå¡ï¼\n\näºå¡çæ§è¡è¿ç¨åå«ä¸ä¸ªæ­¥éª¤ï¼redis æä¾äº multiãexec ä¸¤ä¸ªå½ä»¤æ¥å®æè¿ä¸ä¸ªæ­¥éª¤ãä¸é¢çä¸ä¸ï¼\n\n 1. ç¬¬ä¸æ­¥ï¼å®¢æ·ç«¯è¦ä½¿ç¨ multi å½ä»¤æ¥æ¾å¼å°è¡¨ç¤ºä¸ä¸ªäºå¡çå¼å¯ã\n 2. ç¬¬äºæ­¥ï¼å®¢æ·ç«¯æäºå¡æ¬èº«è¦æ§è¡çå·ä½æä½ï¼ä¾å¦å¢å æ¹æ°æ®ï¼åéç»æå¡å¨ç«¯ãè¿äºæä½å°±æ¯ redis æ¬èº«æä¾çæ°æ®è¯»åå½ä»¤ï¼ä¾å¦ getãset ç­ãä¸è¿ï¼è¿äºå½ä»¤è½ç¶è¢«å®¢æ·ç«¯åéå°äºæå¡å¨ç«¯ï¼ä½ redis å®ä¾åªæ¯æè¿äºå½ä»¤æå­å°ä¸ä¸ªå½ä»¤éåä¸­ï¼å¹¶ä¸ä¼ç«å³æ§è¡ã\n 3. ç¬¬ä¸æ­¥ï¼å®¢æ·ç«¯å redis åé exec å½ä»¤æ¥æ§è¡äºå¡æäº¤ï¼è®©æ°æ®åºå®éæ§è¡ç¬¬äºæ­¥ä¸­åéçå·ä½æä½ã\n\nå¦ä¸ä»£ç æ¯ä½¿ç¨ multi å exec æ§è¡ä¸ä¸ªäºå¡çè¿ç¨ï¼\n\n# å¼å¯äºå¡\n127.0.0.1:6379> multi\nok\n# å°a:stockå1ï¼\n127.0.0.1:6379> decr a:stock\nqueued\n# å°b:stockå1\n127.0.0.1:6379> decr b:stock\nqueued\n# å®éæ§è¡äºå¡\n127.0.0.1:6379> exec\n1) (integer) 4\n2) (integer) 9\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nå¥½äºï¼éè¿ä½¿ç¨ multi å exec å½ä»¤ï¼æä»¬å¯ä»¥å®ç°å¤ä¸ªæä½çå±åæ§è¡ï¼ä½æ¯è¿ç¬¦åäºå¡è¦æ±ç acid å±æ§åï¼\n\n\n# 1.3 redis çäºå¡æºå¶è½ä¿è¯åªäºå±æ§ï¼\n\nè¿éåå«åæä¸ä¸ã\n\n# 1.3.1 åå­æ§\n\nå¦æäºå¡æ§è¡åºç°éè¯¯ï¼åå­æ§è¿è½ä¿è¯åï¼è¿è¦åä¸ç§æåµæ¥çå¾ã\n\n * ç¬¬ä¸ç§æåµæ¯ï¼å¨æ§è¡execå½ä»¤åï¼å®¢æ·ç«¯åéçæä½å½ä»¤æ¬èº«å°±æéè¯¯ï¼æ¯å¦è¯­æ³éè¯¯ï¼ä½¿ç¨äºä¸å­å¨çå½ä»¤ï¼ï¼å¨å½ä»¤å¥éæ¶å°±è¢« redis å®ä¾å¤æ­åºæ¥äºãæ­¤æ¶ redis ä¼æç»æ§è¡æææäº¤çå½ä»¤ï¼ä»èä¿è¯äºåå­æ§ã\n   * ä¾å­ï¼\n\n#å¼å¯äºå¡\n127.0.0.1:6379> multi\nok\n#åéäºå¡ä¸­çç¬¬ä¸ä¸ªæä½ï¼ä½æ¯redisä¸æ¯æè¯¥å½ä»¤ï¼è¿åæ¥éä¿¡æ¯\n127.0.0.1:6379> put a:stock 5\n(error) err unknown command `put`, with args beginning with: `a:stock`, `5`,\n#åéäºå¡ä¸­çç¬¬äºä¸ªæä½ï¼è¿ä¸ªæä½æ¯æ­£ç¡®çå½ä»¤ï¼redisæè¯¥å½ä»¤å¥é\n127.0.0.1:6379> decr b:stock\nqueued\n#å®éæ§è¡äºå¡ï¼ä½æ¯ä¹åå½ä»¤æéè¯¯ï¼æä»¥redisæç»æ§è¡\n127.0.0.1:6379> exec\n(error) execabort transaction discarded because of previous errors.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n * ç¬¬äºç§æåµæ¯ï¼æä¸ªå½ä»¤å¨äºå¡æ§è¡æé´åºç°éè¯¯ï¼å¦å½ä»¤åæä½çæ°æ®ç±»åä¸å¹éï¼å¨æä½å¥éæ¶æ²¡æè¢« redis å®ä¾æ£æ¥åºéè¯¯ãè¿æ¶å°½ç®¡ redis ä¼å¯¹åä¸ªå½ä»¤æ¥éï¼ä½è¿æ¯ä¼æè¿ä¸ªäºå¡æ¥ä¸æ¥çææå½ä»¤æ§è¡å®ãå¨è¿ç§æåµä¸ï¼äºå¡çåå­æ§å°±æ æ³å¾å°ä¿è¯äºã\n   * ä¾å­ï¼\n\n#å¼å¯äºå¡\n127.0.0.1:6379> multi\nok\n#åéäºå¡ä¸­çç¬¬ä¸ä¸ªæä½ï¼lpopå½ä»¤æä½çæ°æ®ç±»åä¸å¹éï¼æ­¤æ¶å¹¶ä¸æ¥é\n127.0.0.1:6379> lpop a:stock\nqueued\n#åéäºå¡ä¸­çç¬¬äºä¸ªæä½\n127.0.0.1:6379> decr b:stock\nqueued\n#å®éæ§è¡äºå¡ï¼äºå¡ç¬¬ä¸ä¸ªæä½æ§è¡æ¥é\n127.0.0.1:6379> exec\n1) (error) wrongtype operation against a key holding the wrong kind of value\n2) (integer) 8\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n * ç¬¬ä¸ç§æåµæ¯ï¼äºå¡æ§è¡æé´ redis å®ä¾åçäºæéï¼å¯¼è´äºå¡æ§è¡å¤±è´¥ãå¨è¿ç§æåµä¸ï¼\n   * å¦ærediså¼å¯äºaofæ¥å¿ï¼é£ä¹ï¼åªä¼æé¨åçäºå¡æä½è¢«è®°å½å°aofæ¥å¿ä¸­ãæä»¬éè¦ä½¿ç¨redis-check-aofå·¥å·æ£æ¥aofæ¥å¿æä»¶ï¼è¿ä¸ªå·¥å·å¯ä»¥ææªå®æçäºå¡æä½ä»aofæä»¶ä¸­å»é¤ãè¿æ ·ä¸æ¥ï¼æä»¬ä½¿ç¨aofæ¢å¤å®ä¾åï¼äºå¡æä½ä¸ä¼åè¢«æ§è¡ï¼ä»èä¿è¯äºåå­æ§ã\n   * å¦æaofæ¥å¿å¹¶æ²¡æå¼å¯ï¼é£ä¹å®ä¾éå¯åï¼æ°æ®ä¹é½æ²¡æ³æ¢å¤äºï¼æ­¤æ¶ï¼ä¹å°±è°ä¸ä¸åå­æ§äºã\n\nredis ä¹æ²¡ææä¾åæ»æºå¶ãè½ç¶ redis æä¾äº discard å½ä»¤ï¼ä½è¿ä¸ªå½ä»¤åªè½ç¨æ¥ä¸»å¨æ¾å¼äºå¡çæ§è¡ï¼ææå­çå½ä»¤éåæ¸ç©ºï¼èµ·ä¸å°åæ»çææãä¸é¢ä»£ç å±ç¤º discard å½ä»¤çä½¿ç¨ï¼\n\n#è¯»åa:stockçå¼4\n127.0.0.1:6379> get a:stock\n"4"\n#å¼å¯äºå¡\n127.0.0.1:6379> multi\nok\n#åéäºå¡çç¬¬ä¸ä¸ªæä½ï¼å¯¹a:stockå1\n127.0.0.1:6379> decr a:stock\nqueued\n#æ§è¡discardå½ä»¤ï¼ä¸»å¨æ¾å¼äºå¡\n127.0.0.1:6379> discard\nok\n#åæ¬¡è¯»åa:stockçå¼ï¼å¼æ²¡æè¢«ä¿®æ¹\n127.0.0.1:6379> get a:stock\n"4"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿éæ»ç»ä¸ä¸ redis å¯¹äºå¡åå­æ§çä¿è¯æåµï¼\n\n * å½ä»¤å¥éæ¶å°±æ¥éï¼ä¼æ¾å¼äºå¡æ§è¡ï¼ä¿è¯åå­æ§ï¼\n * å½ä»¤å¥éæ¶æ²¡æ¥éï¼å®éæ§è¡æ¶æ¥éï¼ä¸ä¿è¯åå­æ§ï¼\n * exec å½ä»¤æ§è¡æ¶å®ä¾æéï¼å¦æå¼å¯äº aof æ¥å¿ï¼å¯ä»¥ä¿è¯åå­æ§ã\n\n# 1.3.2 ä¸è´æ§\n\næä»¬æç§å½ä»¤åºéåå®ä¾æéçåçæ¶æºï¼åæä¸ç§æåµæ¥çï¼\n\n 1. æåµä¸ï¼å½ä»¤å¥éæ¶å°±æ¥éãå¨è¿ç§æåµä¸ï¼äºå¡æ¬èº«å°±ä¼è¢«æ¾å¼æ§è¡ï¼æä»¥å¯ä»¥ä¿è¯æ°æ®åºçä¸è´æ§ã\n 2. æåµäºï¼å½ä»¤å¥éæ¶æ²¡æ¥éï¼å®éæ§è¡æ¶æ¥éãå¨è¿ç§æåµä¸ï¼æéè¯¯çå½ä»¤ä¸ä¼è¢«æ§è¡ï¼æ­£ç¡®çå½ä»¤å¯ä»¥æ­£å¸¸æ§è¡ï¼ä¹ä¸ä¼æ¹åæ°æ®åºçä¸è´æ§ã\n 3. æåµä¸ï¼exec å½ä»¤æ§è¡æ¶å®ä¾åçæéãå¨è¿ç§æåµä¸ï¼å®ä¾æéåä¼è¿è¡éå¯ï¼è¿å°±åæ°æ®æ¢å¤çæ¹å¼æå³äºï¼æä»¬è¦æ ¹æ®å®ä¾æ¯å¦å¼å¯äºrdbæaofæ¥åæåµè®¨è®ºä¸ã\n    * è¥æ²¡æå¼å¯ rdb æ aof æ¥å¿ï¼é£å®ä¾æééå¯åï¼æ°æ®é½æ²¡æäºï¼æ°æ®åºæ¯ä¸è´çã\n    * è¥ä½¿ç¨äº rdb å¿«ç§ï¼å ä¸ºrdbå¿«ç§ä¸ä¼å¨äºå¡æ§è¡æ¶æ§è¡ï¼æä»¥ï¼äºå¡å½ä»¤æä½çç»æä¸ä¼è¢«ä¿å­å° rdb å¿«ç§ä¸­ï¼ä½¿ç¨ rdb å¿«ç§è¿è¡æ¢å¤æ¶ï¼æ°æ®åºéçæ°æ®ä¹æ¯ä¸è´çã\n    * è¥ä½¿ç¨äº aof æ¥å¿ï¼\n      * å¦æäºå¡æä½è¿æ²¡æè¢«è®°å½å°aofæ¥å¿æ¶ï¼å®ä¾å°±åçäºæéï¼é£ä¹ï¼ä½¿ç¨aofæ¥å¿æ¢å¤çæ°æ®åºæ°æ®æ¯ä¸è´çã\n      * å¦æåªæé¨åæä½è¢«è®°å½å°äºaofæ¥å¿ï¼æä»¬å¯ä»¥ä½¿ç¨redis-check-aofæ¸é¤äºå¡ä¸­å·²ç»å®æçæä½ï¼æ°æ®åºæ¢å¤åä¹æ¯ä¸è´çã\n\næä»¥ï¼æ»ç»æ¥è¯´ï¼å¨å½ä»¤æ§è¡éè¯¯æ redis åçæéçæåµä¸ï¼redis äºå¡æºå¶å¯¹ä¸è´æ§å±æ§æ¯æä¿è¯çã\n\n# 1.3.3 éç¦»æ§\n\näºå¡çéç¦»æ§ä¿è¯ï¼ä¼åå°åäºå¡ä¸èµ·æ§è¡çå¹¶åæä½çå½±åãèäºå¡æ§è¡åå¯ä»¥åæå½ä»¤å¥éï¼exec å½ä»¤æ§è¡åï¼åå½ä»¤å®éæ§è¡ï¼exec å½ä»¤æ§è¡åï¼ä¸¤ä¸ªé¶æ®µï¼æä»¥ï¼æä»¬å°±éå¯¹è¿ä¸¤ä¸ªé¶æ®µï¼åæä¸¤ç§æåµæ¥åæï¼\n\n 1. å¹¶åæä½å¨ exec å½ä»¤åæ§è¡ï¼æ­¤æ¶ï¼éç¦»æ§çä¿è¯è¦ä½¿ç¨ watch æºå¶æ¥å®ç°ï¼å¦åéç¦»æ§æ æ³ä¿è¯ï¼\n 2. å¹¶åæä½å¨ exec å½ä»¤åæ§è¡ï¼æ­¤æ¶ï¼éç¦»æ§å¯ä»¥ä¿è¯ã\n\næä»¬åæ¥çç¬¬ä¸ç§æåµãä¸ä¸ªäºå¡ç exec å½ä»¤è¿æ²¡ææ§è¡æ¶ï¼äºå¡çå½ä»¤æä½æ¯æå­å¨å½ä»¤éåä¸­çãæ­¤æ¶ï¼å¦ææå¶å®çå¹¶åæä½ï¼æä»¬å°±éè¦çäºå¡æ¯å¦ä½¿ç¨äº watch æºå¶ã\n\nwatch æºå¶çä½ç¨æ¯ï¼å¨äºå¡æ§è¡åï¼çæ§ä¸ä¸ªæå¤ä¸ªé®çå¼ååæåµï¼å½äºå¡è°ç¨ exec å½ä»¤æ§è¡æ¶ï¼watch æºå¶ä¼åæ£æ¥çæ§çé®æ¯å¦è¢«å¶å®å®¢æ·ç«¯ä¿®æ¹äºãå¦æä¿®æ¹äºï¼å°±æ¾å¼äºå¡æ§è¡ï¼é¿åäºå¡çéç¦»æ§è¢«ç ´åãç¶åï¼å®¢æ·ç«¯å¯ä»¥åæ¬¡æ§è¡äºå¡ï¼æ­¤æ¶ï¼å¦ææ²¡æå¹¶åä¿®æ¹äºå¡æ°æ®çæä½äºï¼äºå¡å°±è½æ­£å¸¸æ§è¡ï¼éç¦»æ§ä¹å¾å°äºä¿è¯ã\n\nwatchæºå¶çå·ä½å®ç°æ¯ç±watchå½ä»¤å®ç°çï¼æç»ä½ ä¸¾ä¸ªä¾å­ï¼ä½ å¯ä»¥çä¸ä¸é¢çå¾ï¼è¿ä¸æ­¥çè§£ä¸watchå½ä»¤çä½¿ç¨ï¼\n\nå½ç¶ï¼å¦ææ²¡æä½¿ç¨watchæºå¶ï¼å¨execå½ä»¤åæ§è¡çå¹¶åæä½æ¯ä¼å¯¹æ°æ®è¿è¡è¯»åçãèä¸ï¼å¨æ§è¡execå½ä»¤çæ¶åï¼äºå¡è¦æä½çæ°æ®å·²ç»æ¹åäºï¼å¨è¿ç§æåµä¸ï¼rediså¹¶æ²¡æåå°è®©äºå¡å¯¹å¶å®æä½éç¦»ï¼éç¦»æ§ä¹å°±æ²¡æå¾å°ä¿éãä¸é¢è¿å¼ å¾æ¾ç¤ºäºæ²¡æwatchæºå¶æ¶çæåµï¼\n\nå¯¹äºç¬¬äºç§æåµï¼å ä¸º redis æ¯ç¨åçº¿ç¨æ§è¡å½ä»¤ï¼èä¸ï¼exec å½ä»¤æ§è¡åï¼redis ä¼ä¿è¯åæå½ä»¤éåä¸­çææå½ä»¤æ§è¡å®ãæä»¥ï¼å¨è¿ç§æåµä¸ï¼å¹¶åæä½ä¸ä¼ç ´åäºå¡çéç¦»æ§ï¼å¦ä¸å¾æç¤ºï¼\n\n# 1.3.4 æä¹æ§\n\nå ä¸º redis æ¯åå­æ°æ®åºï¼æä»¥ï¼æ°æ®æ¯å¦æä¹åä¿å­å®å¨åå³äº redis çæä¹åéç½®æ¨¡å¼ã\n\nå¦æredisæ²¡æä½¿ç¨rdbæaofï¼é£ä¹äºå¡çæä¹åå±æ§è¯å®å¾ä¸å°ä¿è¯ãå¦æredisä½¿ç¨äºrdbæ¨¡å¼ï¼é£ä¹ï¼å¨ä¸ä¸ªäºå¡æ§è¡åï¼èä¸ä¸æ¬¡çrdbå¿«ç§è¿æªæ§è¡åï¼å¦æåçäºå®ä¾å®æºï¼è¿ç§æåµä¸ï¼äºå¡ä¿®æ¹çæ°æ®ä¹æ¯ä¸è½ä¿è¯æä¹åçã\n\nå¦ærediséç¨äºaofæ¨¡å¼ï¼å ä¸ºaofæ¨¡å¼çä¸ç§éç½®éé¡¹noãeverysecåalwaysé½ä¼å­å¨æ°æ®ä¸¢å¤±çæåµï¼æä»¥ï¼äºå¡çæä¹æ§å±æ§ä¹è¿æ¯å¾ä¸å°ä¿è¯ã\n\næä»¥ï¼ä¸ç®¡ redis éç¨ä»ä¹æä¹åæ¨¡å¼ï¼äºå¡çæä¹æ§å±æ§æ¯å¾ä¸å°ä¿è¯çã\n\n\n# 1.4 å°ç»\n\nè¿ä¸èå­¦ä¹ äº redis çäºå¡å®ç°ï¼å®éè¿ multiãexecãdiscard å watch åä¸ªå½ä»¤æ¥æ¯æäºå¡æºå¶ï¼æ»ç»å¦ä¸ï¼\n\näºå¡çacidå±æ§æ¯æä»¬ä½¿ç¨äºå¡è¿è¡æ­£ç¡®æä½çåºæ¬è¦æ±ãéè¿è¿èè¯¾çåæï¼æä»¬äºè§£å°äºï¼redisçäºå¡æºå¶å¯ä»¥ä¿è¯ä¸è´æ§åéç¦»æ§ï¼ä½æ¯æ æ³ä¿è¯æä¹æ§ãä¸è¿ï¼å ä¸ºredisæ¬èº«æ¯åå­æ°æ®åºï¼æä¹æ§å¹¶ä¸æ¯ä¸ä¸ªå¿é¡»çå±æ§ï¼æä»¬æ´å å³æ³¨çè¿æ¯åå­æ§ãä¸è´æ§åéç¦»æ§è¿ä¸ä¸ªå±æ§ã\n\nåå­æ§çæåµæ¯è¾å¤æï¼åªæå½äºå¡ä¸­ä½¿ç¨çå½ä»¤è¯­æ³æè¯¯æ¶ï¼åå­æ§å¾ä¸å°ä¿è¯ï¼å¨å¶å®æåµä¸ï¼äºå¡é½å¯ä»¥åå­æ§æ§è¡ã\n\nå»ºè®®ï¼ä¸¥æ ¼æç§ redis çå½ä»¤è§èè¿è¡ç¨åºå¼åï¼å¹¶ä¸éè¿ code review ç¡®ä¿å½ä»¤çæ­£ç¡®æ§ãè¿æ ·ä¸æ¥ï¼redis çäºå¡æºå¶å°±è½è¢«åºç¨å¨å®è·µä¸­ï¼ä¿è¯å¤æä½çæ­£ç¡®æ§è¡ã',charsets:{cjk:!0},lastUpdated:"2023/04/19, 02:34:41",lastUpdatedTimestamp:1681871681e3},{title:"Redis ä¸»ä»åæ­¥çå",frontmatter:{title:"Redis ä¸»ä»åæ­¥çå",date:"2023-04-19T10:35:28.000Z",permalink:"/pages/4140fe/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/32.Redis%20%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E7%9A%84%E5%9D%91.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/32.Redis ä¸»ä»åæ­¥çå.md",key:"v-3622e3e6",path:"/pages/4140fe/",headers:[{level:2,title:"1. Redis ä¸»ä»åæ­¥ä¸æéåæ¢ï¼æåªäºåï¼",slug:"_1-redis-ä¸»ä»åæ­¥ä¸æéåæ¢-æåªäºå",normalizedTitle:"1. redis ä¸»ä»åæ­¥ä¸æéåæ¢ï¼æåªäºåï¼",charIndex:109},{level:3,title:"1.1 ä¸»ä»æ°æ®ä¸ä¸è´",slug:"_1-1-ä¸»ä»æ°æ®ä¸ä¸è´",normalizedTitle:"1.1 ä¸»ä»æ°æ®ä¸ä¸è´",charIndex:270},{level:3,title:"1.2 è¯»åè¿ææ°æ®",slug:"_1-2-è¯»åè¿ææ°æ®",normalizedTitle:"1.2 è¯»åè¿ææ°æ®",charIndex:905},{level:3,title:"1.3 ä¸åçéç½®é¡¹å¯¼è´çæå¡ææ",slug:"_1-3-ä¸åçéç½®é¡¹å¯¼è´çæå¡ææ",normalizedTitle:"1.3 ä¸åçéç½®é¡¹å¯¼è´çæå¡ææ",charIndex:2321},{level:4,title:"1ï¼protected-mode éç½®é¡¹",slug:"_1-protected-mode-éç½®é¡¹",normalizedTitle:"1ï¼protected-mode éç½®é¡¹",charIndex:2399},{level:4,title:"2ï¼cluster-node-timeout éç½®é¡¹",slug:"_2-cluster-node-timeout-éç½®é¡¹",normalizedTitle:"2ï¼cluster-node-timeout éç½®é¡¹",charIndex:2886},{level:3,title:"1.4 å°ç»",slug:"_1-4-å°ç»",normalizedTitle:"1.4 å°ç»",charIndex:3249},{level:2,title:"2. èè£ï¼ä¸æ¬¡å¥æªçæ°æ®ä¸¢å¤±",slug:"_2-èè£-ä¸æ¬¡å¥æªçæ°æ®ä¸¢å¤±",normalizedTitle:"2. èè£ï¼ä¸æ¬¡å¥æªçæ°æ®ä¸¢å¤±",charIndex:3576},{level:3,title:"2.1 ä¸ºä»ä¹ä¼åçèè£ï¼",slug:"_2-1-ä¸ºä»ä¹ä¼åçèè£",normalizedTitle:"2.1 ä¸ºä»ä¹ä¼åçèè£ï¼",charIndex:3822},{level:4,title:"2.1.1 ç¬¬ä¸æ­¥ï¼ç¡®è®¤æ¯ä¸æ¯æ°æ®åæ­¥åºç°äºé®é¢",slug:"_2-1-1-ç¬¬ä¸æ­¥-ç¡®è®¤æ¯ä¸æ¯æ°æ®åæ­¥åºç°äºé®é¢",normalizedTitle:"2.1.1 ç¬¬ä¸æ­¥ï¼ç¡®è®¤æ¯ä¸æ¯æ°æ®åæ­¥åºç°äºé®é¢",charIndex:3909},{level:4,title:"2.1.2 ç¬¬äºæ­¥ï¼ææ¥å®¢æ·ç«¯çæä½æ¥å¿ï¼åç°èè£ç°è±¡",slug:"_2-1-2-ç¬¬äºæ­¥-ææ¥å®¢æ·ç«¯çæä½æ¥å¿-åç°èè£ç°è±¡",normalizedTitle:"2.1.2 ç¬¬äºæ­¥ï¼ææ¥å®¢æ·ç«¯çæä½æ¥å¿ï¼åç°èè£ç°è±¡",charIndex:4266},{level:4,title:"2.1.3 ç¬¬ä¸æ­¥ï¼åç°æ¯åä¸»åºåæéå¯¼è´çèè£",slug:"_2-1-3-ç¬¬ä¸æ­¥-åç°æ¯åä¸»åºåæéå¯¼è´çèè£",normalizedTitle:"2.1.3 ç¬¬ä¸æ­¥ï¼åç°æ¯åä¸»åºåæéå¯¼è´çèè£",charIndex:4611},{level:3,title:"2.2 ä¸ºä»ä¹èè£ä¼å¯¼è´æ°æ®ä¸¢å¤±ï¼",slug:"_2-2-ä¸ºä»ä¹èè£ä¼å¯¼è´æ°æ®ä¸¢å¤±",normalizedTitle:"2.2 ä¸ºä»ä¹èè£ä¼å¯¼è´æ°æ®ä¸¢å¤±ï¼",charIndex:5322},{level:3,title:"2.3 å¦ä½åºå¯¹èè£é®é¢ï¼",slug:"_2-3-å¦ä½åºå¯¹èè£é®é¢",normalizedTitle:"2.3 å¦ä½åºå¯¹èè£é®é¢ï¼",charIndex:5669},{level:3,title:"2.4 å°ç»",slug:"_2-4-å°ç»",normalizedTitle:"2.4 å°ç»",charIndex:6660}],headersStr:"1. Redis ä¸»ä»åæ­¥ä¸æéåæ¢ï¼æåªäºåï¼ 1.1 ä¸»ä»æ°æ®ä¸ä¸è´ 1.2 è¯»åè¿ææ°æ® 1.3 ä¸åçéç½®é¡¹å¯¼è´çæå¡ææ 1ï¼protected-mode éç½®é¡¹ 2ï¼cluster-node-timeout éç½®é¡¹ 1.4 å°ç» 2. èè£ï¼ä¸æ¬¡å¥æªçæ°æ®ä¸¢å¤± 2.1 ä¸ºä»ä¹ä¼åçèè£ï¼ 2.1.1 ç¬¬ä¸æ­¥ï¼ç¡®è®¤æ¯ä¸æ¯æ°æ®åæ­¥åºç°äºé®é¢ 2.1.2 ç¬¬äºæ­¥ï¼ææ¥å®¢æ·ç«¯çæä½æ¥å¿ï¼åç°èè£ç°è±¡ 2.1.3 ç¬¬ä¸æ­¥ï¼åç°æ¯åä¸»åºåæéå¯¼è´çèè£ 2.2 ä¸ºä»ä¹èè£ä¼å¯¼è´æ°æ®ä¸¢å¤±ï¼ 2.3 å¦ä½åºå¯¹èè£é®é¢ï¼ 2.4 å°ç»",content:"> åèï¼\n> \n>  * 32 Redis ä¸»ä»åæ­¥ä¸æéåæ¢ï¼æåªäºåï¼| æå®¢æ¶é´\n>  * 33 èè£ï¼ä¸æ¬¡å¥æªçæ°æ®ä¸¢å¤±| æå®¢æ¶é´\n> \n> å¦å¤ï¼\n> \n> è¿ç¯åæè®²åæ­¥è®²çä¸éï¼é½ä¸²èµ·æ¥äºã\n\n\n# 1. Redis ä¸»ä»åæ­¥ä¸æéåæ¢ï¼æåªäºåï¼\n\nRedis çä¸»ä»åæ­¥æºå¶ä¸ä»å¯ä»¥è®©ä»åºæå¡æ´å¤çè¯»è¯·æ±ï¼åæä¸»åºçååï¼èä¸è¿è½å¨ä¸»åºåçæéæ¶ï¼è¿è¡ä¸»ä»åºåæ¢ï¼æä¾é«å¯é æå¡ãä¸è¿å¨ä½¿ç¨ä¸»ä»æºå¶æ¶å¯è½ä¼éå°ä¸äºåï¼è¿éä¸»è¦ä»ç»ä¸ä¸ªåï¼ä¸»ä»æ°æ®ä¸ä¸è´ãè¯»å°è¿ææ°æ®ï¼ä»¥åéç½®é¡¹è®¾ç½®å¾ä¸åçä»èå¯¼è´æå¡ææã\n\n\n# 1.1 ä¸»ä»æ°æ®ä¸ä¸è´\n\nä¸»ä»æ°æ®ä¸ä¸è´ï¼å°±æ¯æå®¢æ·ç«¯ä»ä»åºä¸­è¯»åå°çå¼åä¸»åºä¸­çææ°å¼å¹¶ä¸ä¸è´ã\n\nåºç°çåå å°±æ¯ä¸»ä»ä¹é´çæ°æ®å¤å¶æ¯å¼æ­¥è¿è¡çãä»åºåºç°æ»åçä¸¤ä¸ªä¸»è¦åå ï¼\n\n 1. ç½ç»å»¶è¿\n 2. ä»åºå å¶ä»æä½èé»å¡è¾é¿æ¶é´\n\nåºå¯¹æ¹æ³ä¸»è¦æä¸¤ä¸ªï¼\n\n 1. ç¡¬ä»¶æ¹é¢ï¼å°½éä¿è¯ä¸»ä»åºé´çç½ç»ç¶åµè¯å¥½ãä¾å¦ï¼æä»¬è¦é¿åæä¸»ä»åºé¨ç½²å¨ä¸åçæºæ¿ï¼æèæ¯é¿åæç½ç»éä¿¡å¯éçåºç¨ï¼ä¾å¦æ°æ®åæåºç¨ï¼åRedisä¸»ä»åºé¨ç½²å¨ä¸èµ·ã\n 2. è¿å¯ä»¥å¼åä¸ä¸ªå¤é¨ç¨åºæ¥çæ§ä¸»ä»åºé´çå¤å¶è¿åº¦ãä¸é¢ä»ç»æ¹æ³ã\n\nå ä¸ºRedisçINFO replicationå½ä»¤å¯ä»¥æ¥çä¸»åºæ¥æ¶åå½ä»¤çè¿åº¦ä¿¡æ¯ï¼master_repl_offsetï¼åä»åºå¤å¶åå½ä»¤çè¿åº¦ä¿¡æ¯ï¼slave_repl_offsetï¼ï¼æä»¥ï¼æä»¬å°±å¯ä»¥å¼åä¸ä¸ªçæ§ç¨åºï¼åç¨INFO replicationå½ä»¤æ¥å°ä¸»ãä»åºçè¿åº¦ï¼ç¶åï¼æä»¬ç¨master_repl_offsetåå»slave_repl_offsetï¼è¿æ ·å°±è½å¾å°ä»åºåä¸»åºé´çå¤å¶è¿åº¦å·®å¼äºã\n\nå¦ææä¸ªä»åºçè¿åº¦å·®å¼å¤§äºæä»¬é¢è®¾çéå¼ï¼æä»¬å¯ä»¥è®©å®¢æ·ç«¯ä¸ååè¿ä¸ªä»åºè¿æ¥è¿è¡æ°æ®è¯»åï¼è¿æ ·å°±å¯ä»¥åå°è¯»å°ä¸ä¸è´æ°æ®çæåµãä¸è¿ï¼ä¸ºäºé¿ååºç°å®¢æ·ç«¯åææä»åºé½ä¸è½è¿æ¥çæåµï¼æä»¬éè¦æå¤å¶è¿åº¦å·®å¼çéå¼è®¾ç½®å¾å¤§ä¸äºã å½ç¶ï¼çæ§ç¨åºå¯ä»¥ä¸ç´çæ§çä»åºçå¤å¶è¿åº¦ï¼å½ä»åºçå¤å¶è¿åº¦åèµ¶ä¸ä¸»åºæ¶ï¼æä»¬å°±åè®¸å®¢æ·ç«¯åæ¬¡è·è¿äºä»åºè¿æ¥ã\n\n\n# 1.2 è¯»åè¿ææ°æ®\n\næä»¬å¨ä½¿ç¨ Redis ä¸»ä»éç¾¤æ¶ï¼ææ¶ä¼è¯»å°è¿ææ°æ®ãä¾å¦ï¼æ°æ® X çè¿ææ¶é´æ¯ 202010240900ï¼ä½æ¯å®¢æ·ç«¯å¨ 202010240910 æ¶ï¼ä»ç¶å¯ä»¥ä»ä»åºä¸­è¯»å°æ°æ® Xãä¸ä¸ªæ°æ®è¿æåï¼åºè¯¥æ¯è¢«å é¤çï¼å®¢æ·ç«¯ä¸è½åè¯»åå°è¯¥æ°æ®ï¼ä½æ¯ï¼Redis ä¸ºä»ä¹è¿è½å¨ä»åºä¸­è¯»å°è¿æçæ°æ®å¢ï¼\n\nå¶å®ï¼è¿ä¸ªé®é¢æ¯ç±Redisçè¿ææ°æ®å é¤ç­ç¥å¼èµ·çã\n\nRedis åæ¶ä½¿ç¨äºä¸¤ç§ç­ç¥æ¥å é¤è¿ææ°æ®ï¼\n\n 1. æ°æ§å é¤ç­ç¥ï¼å½ä¸ä¸ªæ°æ®çè¿ææ¶é´å°äºä»¥åï¼å¹¶ä¸ä¼ç«å³å é¤æ°æ®ï¼èæ¯ç­å°åæè¯·æ±æ¥è¯»åè¿ä¸ªæ°æ®æ¶ï¼å¯¹æ°æ®è¿è¡æ£æ¥ï¼å¦æåç°æ°æ®å·²ç»è¿æäºï¼åå é¤è¿ä¸ªæ°æ®ã\n    * è¿ç§æ¹æ³åå°äºå é¤æ°æ®å¯¹ CPU èµæºçä½¿ç¨ï¼ä½ä¼å¯¼è´å¤§éå·²è¿ææ°æ®çå¨åå­ä¸­ã\n 2. å®æå é¤ç­ç¥ï¼Redis æ¯éä¸æ®µæ¶é´ï¼é»è®¤100msï¼ï¼å°±ä¼éæºéåºä¸å®æ°éçæ°æ®ï¼æ£æ¥å®ä»¬æ¯å¦è¿æï¼å¹¶æå¶ä¸­è¿æçæ°æ®å é¤ï¼è¿æ ·å°±å¯ä»¥åæ¶éæ¾ä¸äºåå­ã\n\næ¸æ¥äºè¿ä¸¤ä¸ªå é¤ç­ç¥ï¼æä»¬åæ¥ççå®ä»¬ä¸ºä»ä¹ä¼å¯¼è´è¯»åå°è¿ææ°æ®ã\n\n * å®æå é¤ç­ç¥åªä¼éæºæ£æ¥ä¸é¨åæ°æ®ï¼ä»ä¼å­å¨è¿ææ°æ®æ®ççé®é¢ã\n * æ°æ§å é¤ç­ç¥åªå¨æ°æ®åæ¬¡è¢«è®¿é®æ¶æä¼å®éå é¤ãå¦æå®¢æ·ç«¯ä»ä¸»åºä¸è¯»åçå­çè¿ææ°æ®ï¼ä¸»åºä¼è§¦åå é¤æä½ï¼æ­¤æ¶ï¼å®¢æ·ç«¯å¹¶ä¸ä¼è¯»å°è¿ææ°æ®ãä½æ¯ï¼ä»åºæ¬èº«ä¸ä¼æ§è¡å é¤æä½ï¼å¦æå®¢æ·ç«¯å¨ä»åºä¸­è®¿é®çå­çè¿ææ°æ®ï¼ä»åºå¹¶ä¸ä¼è§¦åæ°æ®å é¤ãé£ä¹ï¼ä»åºä¼ç»å®¢æ·ç«¯è¿åè¿ææ°æ®åï¼è¿å°±åä½ ä½¿ç¨çRedisçæ¬æå³äºãå¦æä½ ä½¿ç¨çæ¯Redis 3.2ä¹åççæ¬ï¼é£ä¹ï¼ä»åºå¨æå¡è¯»è¯·æ±æ¶ï¼å¹¶ä¸ä¼å¤æ­æ°æ®æ¯å¦è¿æï¼èæ¯ä¼è¿åè¿ææ°æ®ãå¨3.2çæ¬åï¼Redisåäºæ¹è¿ï¼å¦æè¯»åçæ°æ®å·²ç»è¿æäºï¼ä»åºè½ç¶ä¸ä¼å é¤ï¼ä½æ¯ä¼è¿åç©ºå¼ï¼è¿å°±é¿åäºå®¢æ·ç«¯è¯»å°è¿ææ°æ®ãæä»¥ï¼å¨åºç¨ä¸»ä»éç¾¤æ¶ï¼å°½éä½¿ç¨ Redis 3.2 åä»¥ä¸çæ¬ã\n\né£åªè¦ä½¿ç¨äºRedis 3.2 åççæ¬ï¼å°±ä¸ä¼è¯»å°è¿ææ°æ®äºåï¼å¶å®è¿æ¯ä¼çãåå è· Redis ç¨äºè®¾ç½®è¿ææ¶é´çå½ä»¤æå³ç³»ï¼æäºå½ä»¤ç»æ°æ®è®¾ç½®çè¿ææ¶é´å¨ä»åºä¸å¯è½ä¼è¢«å»¶åï¼å¯¼è´åºè¯¥è¿æçæ°æ®åå¨ä»åºä¸è¢«è¯»åå°äºï¼ææ¥ç»ä½ å·ä½è§£éä¸ã\n\nè®¾ç½®æ°æ®è¿ææ¶é´çå½ä»¤ä¸å±æ4ä¸ªï¼æä»¬å¯ä»¥æå®ä»¬åæä¸¤ç±»ï¼\n\n * EXPIRE å PEXPIREï¼å®ä»¬ç»æ°æ®è®¾ç½®çæ¯ä»å½ä»¤æ§è¡æ¶å¼å§è®¡ç®çå­æ´»æ¶é´ï¼\n * EXPIREAT å PEXPIREATï¼å®ä»¬ä¼ç´æ¥ææ°æ®çè¿ææ¶é´è®¾ç½®ä¸ºå·ä½çä¸ä¸ªæ¶é´ç¹ã\n\nè¿ 4 ä¸ªå½ä»¤çåæ°åå«ä¹å¦ä¸è¡¨æç¤ºï¼\n\nç¤ºä¾ï¼\n\n * EXPIRE testkey 60ï¼æ testkey çè¿ææ¶é´è®¾ç½®ä¸º 60s å\n * EXPIREAT testkey 1603501200ï¼è®©testkeyå¨2020å¹´10æ24æ¥ä¸å9ç¹è¿æï¼å½ä»¤ä¸­ç1603501200å°±æ¯ä»¥ç§æ°æ¶é´æ³è¡¨ç¤ºç10æ24æ¥ä¸å9ç¹ã\n\nç±äºç½ç»å»¶è¿ï¼ä½¿ç¨ EXPIRE å¯è½ä¼è®©ä¸»ä»åºçè¿ææ¶é´ç¹ä¸ä¸æ ·ãå æ­¤å»ºè®®ï¼å¨ä¸å¡åºç¨ä¸­ä½¿ç¨ EXPIREAT/PEXPIREAT å½ä»¤ï¼ææ°æ®çè¿ææ¶é´è®¾ç½®ä¸ºå·ä½çæ¶é´ç¹ï¼é¿åè¯»å°è¿ææ°æ®ãå¦å¤æ³¨æï¼EXPIREAT/PEXPIREAT è®¾ç½®çæ¯æ¶é´ç¹ï¼æä»¥ä¸»ä»èç¹ä¸çæ¶éè¦ä¿æä¸è´ï¼å·ä½çåæ³æ¯ï¼è®©ä¸»ä»èç¹åç¸åç NTP æå¡å¨(æ¶é´æå¡å¨)è¿è¡æ¶éåæ­¥ã\n\n\n# 1.3 ä¸åçéç½®é¡¹å¯¼è´çæå¡ææ\n\nè¿éæ¶åå°çéç½®é¡¹æä¸¤ä¸ªï¼åå«æ¯ protected-mode å cluster-node-timeoutã\n\n# 1ï¼protected-mode éç½®é¡¹\n\nè¿ä¸ªéç½®é¡¹çä½ç¨æ¯éå®å¨åµå®ä¾è½å¦è¢«å¶ä»æå¡å¨è®¿é®ï¼\n\n * yesï¼å¨åµå®ä¾åªè½å¨é¨ç½²çæå¡å¨æ¬å°è¿è¡è®¿é®\n * noï¼å¶ä»æå¡å¨ä¹å¯ä»¥è®¿é®è¿ä¸ªå¨åµå®ä¾\n\næ­£å ä¸ºè¿æ ·ï¼å¦æprotected-modeè¢«è®¾ç½®ä¸ºyesï¼èå¶ä½å¨åµå®ä¾é¨ç½²å¨å¶å®æå¡å¨ï¼é£ä¹ï¼è¿äºå¨åµå®ä¾é´å°±æ æ³éä¿¡ãå½ä¸»åºæéæ¶ï¼å¨åµæ æ³å¤æ­ä¸»åºä¸çº¿ï¼ä¹æ æ³è¿è¡ä¸»ä»åæ¢ï¼æç»Redisæå¡ä¸å¯ç¨ã\n\næä»¥ï¼æä»¬å¨åºç¨ä¸»ä»éç¾¤æ¶ï¼è¦æ³¨æå° protected-mode éç½®é¡¹è®¾ç½®ä¸ºnoï¼å¹¶ä¸å°bindéç½®é¡¹è®¾ç½®ä¸ºå¶å®å¨åµå®ä¾çIPå°åãè¿æ ·ä¸æ¥ï¼åªæå¨bindä¸­è®¾ç½®äºIPå°åçå¨åµï¼æå¯ä»¥è®¿é®å½åå®ä¾ï¼æ¢ä¿è¯äºå®ä¾é´è½å¤éä¿¡è¿è¡ä¸»ä»åæ¢ï¼ä¹ä¿è¯äºå¨åµçå®å¨æ§ã\n\næä»¬æ¥çä¸ä¸ªç®åçå°ä¾å­ãå¦æè®¾ç½®äºä¸é¢çéç½®é¡¹ï¼é£ä¹ï¼é¨ç½²å¨192.168.10.3/4/5è¿ä¸å°æå¡å¨ä¸çå¨åµå®ä¾å°±å¯ä»¥ç¸äºéä¿¡ï¼æ§è¡ä¸»ä»åæ¢ï¼\n\nprotected-mode no\nbind 192.168.10.3 192.168.10.4 192.168.10.5\n\n\n1\n2\n\n\n# 2ï¼cluster-node-timeout éç½®é¡¹\n\nè¿ä¸ªéç½®é¡¹è®¾ç½®äºRedis Clusterä¸­å®ä¾ååºå¿è·³æ¶æ¯çè¶æ¶æ¶é´ã\n\nå½æä»¬å¨Redis Clusteréç¾¤ä¸­ä¸ºæ¯ä¸ªå®ä¾éç½®äºâä¸ä¸»ä¸ä»âæ¨¡å¼æ¶ï¼å¦æä¸»å®ä¾åçæéï¼ä»å®ä¾ä¼åæ¢ä¸ºä¸»å®ä¾ï¼åç½ç»å»¶è¿ååæ¢æä½æ§è¡çå½±åï¼åæ¢æ¶é´å¯è½è¾é¿ï¼å°±ä¼å¯¼è´å®ä¾çå¿è·³è¶æ¶ï¼è¶åºcluster-node-timeoutï¼ãå®ä¾è¶æ¶åï¼å°±ä¼è¢«Redis Clusterå¤æ­ä¸ºå¼å¸¸ãèRedis Clusteræ­£å¸¸è¿è¡çæ¡ä»¶å°±æ¯ï¼æåæ°ä»¥ä¸çå®ä¾é½è½æ­£å¸¸è¿è¡ã\n\næä»¥ï¼å¦ææ§è¡ä¸»ä»åæ¢çå®ä¾è¶è¿åæ°ï¼èä¸»ä»åæ¢æ¶é´åè¿é¿çè¯ï¼å°±å¯è½æåæ°ä»¥ä¸çå®ä¾å¿è·³è¶æ¶ï¼ä»èå¯è½å¯¼è´æ´ä¸ªéç¾¤ææãæä»¥ï¼æå»ºè®®ä½ å°cluster-node-timeoutè°å¤§äºï¼ä¾å¦10å°20ç§ï¼ã\n\n\n# 1.4 å°ç»\n\nè¿ä¸èä¸»è¦è®²äº Redis åä¸»ä»åæ­¥æ¶å¯è½åºç°ç 3 ä¸ªåï¼ä¸»ä»æ°æ®ä¸ä¸è´ãè¯»åå°è¿ææ°æ®åä¸åçéç½®é¡¹å¯¼è´æå¡ææãæ»ç»å¦ä¸ï¼\n\næåï¼å³äºä¸»ä»åºæ°æ®ä¸ä¸è´çé®é¢ï¼æè¿æ³åç»ä½ æä¸ä¸ªå°å»ºè®®ï¼Redisä¸­çslave-serve-stale-dataéç½®é¡¹è®¾ç½®äºä»åºè½å¦å¤çæ°æ®è¯»åå½ä»¤ï¼ä½ å¯ä»¥æå®è®¾ç½®ä¸ºnoãè¿æ ·ä¸æ¥ï¼ä»åºåªè½æå¡INFOãSLAVEOFå½ä»¤ï¼è¿å°±å¯ä»¥é¿åå¨ä»åºä¸­è¯»å°ä¸ä¸è´çæ°æ®äºã\n\nä¸è¿ï¼ä½ è¦æ³¨æä¸è¿ä¸ªéç½®é¡¹åslave-read-onlyçåºå«ï¼slave-read-onlyæ¯è®¾ç½®ä»åºè½å¦å¤çåå½ä»¤ï¼slave-read-onlyè®¾ç½®ä¸ºyesæ¶ï¼ä»åºåªè½å¤çè¯»è¯·æ±ï¼æ æ³å¤çåè¯·æ±ï¼ä½ å¯ä¸è¦ææ··äºã\n\n\n# 2. èè£ï¼ä¸æ¬¡å¥æªçæ°æ®ä¸¢å¤±\n\n> å¨ä½¿ç¨ä¸»ä»éç¾¤æ¶ï¼ææ¾éå°è¿è¿æ ·ä¸ä¸ªé®é¢ï¼æä»¬çä¸»ä»éç¾¤æ1ä¸ªä¸»åºã5ä¸ªä»åºå3ä¸ªå¨åµå®ä¾ï¼å¨ä½¿ç¨çè¿ç¨ä¸­ï¼æä»¬åç°å®¢æ·ç«¯åéçä¸äºæ°æ®ä¸¢å¤±äºï¼è¿ç´æ¥å½±åå°äºä¸å¡å±çæ°æ®å¯é æ§ãéè¿ææ¥æç¥éï¼è¿å¶å®æ¯ä¸»ä»éç¾¤ä¸­èè£é®é¢å¯¼è´çã\n\nèè£ï¼æå¨ä¸»ä»éç¾¤ä¸­ï¼åæ¶æä¸¤ä¸ªä¸»èç¹ï¼å®ä»¬é½è½æ¥æ¶åè¯·æ±ãèèè£æç´æ¥çå½±åï¼å°±æ¯å®¢æ·ç«¯ä¸ç¥éåºè¯¥å¾åªä¸ªä¸»èç¹åå¥æ°æ®ï¼ç»æå°±æ¯ä¸åçå®¢æ·ç«¯ä¼å¾ä¸åçä¸»èç¹ä¸åå¥æ°æ®ãèä¸ï¼ä¸¥éçè¯ï¼èè£ä¼è¿ä¸æ­¥å¯¼è´æ°æ®ä¸¢å¤±ã\n\n\n# 2.1 ä¸ºä»ä¹ä¼åçèè£ï¼\n\nåæææå°ï¼ææååç°çé®é¢æ¯ï¼å¨ä¸»ä»éç¾¤ä¸­ï¼å®¢æ·ç«¯åéçæ°æ®ä¸¢å¤±äºãæä»¥ï¼æä»¬é¦åè¦å¼æç½ï¼ä¸ºä»ä¹æ°æ®ä¼ä¸¢å¤±ï¼æ¯ä¸æ¯æ°æ®åæ­¥åºäºé®é¢ï¼\n\n# 2.1.1 ç¬¬ä¸æ­¥ï¼ç¡®è®¤æ¯ä¸æ¯æ°æ®åæ­¥åºç°äºé®é¢\n\nå¨ä¸»ä»éç¾¤ä¸­åçæ°æ®ä¸¢å¤±ï¼æå¸¸è§çåå å°±æ¯ï¼ä¸»åºçæ°æ®è¿æ²¡æåæ­¥å°ä»åºï¼ç»æä¸»åºåçäºæéï¼ç­ä»åºåçº§ä¸ºä¸»åºåï¼æªåæ­¥çæ°æ®å°±ä¸¢å¤±äºã\n\nå¦ææ¯è¿ç§æåµçæ°æ®ä¸¢å¤±ï¼æä»¬å¯ä»¥éè¿æ¯å¯¹ä¸»ä»åºä¸çå¤å¶è¿åº¦å·®å¼æ¥è¿è¡å¤æ­ï¼ä¹å°±æ¯è®¡ç®master_repl_offsetåslave_repl_offsetçå·®å¼ãå¦æä»åºä¸çslave_repl_offsetå°äºåä¸»åºçmaster_repl_offsetï¼é£ä¹ï¼æä»¬å°±å¯ä»¥è®¤å®æ°æ®ä¸¢å¤±æ¯ç±æ°æ®åæ­¥æªå®æå¯¼è´çã\n\nå¨èæ¯é®é¢ä¸­ï¼æä»¬å¦ä¸åäºæ£æ¥ï¼åç°å¹¶ä¸æ¯è¿ä¸ªé®é¢ãé£ä¹æä»¬æ³å°ï¼ææçæ°æ®æä½é½æ¯ä»å®¢æ·ç«¯åéç»Rediså®ä¾çï¼é£ä¹ï¼æ¯ä¸æ¯å¯ä»¥ä»å®¢æ·ç«¯æä½æ¥å¿ä¸­åç°é®é¢å¢ï¼ç´§æ¥çï¼æä»¬å°±æç®åè½¬å°äºå®¢æ·ç«¯ã\n\n# 2.1.2 ç¬¬äºæ­¥ï¼ææ¥å®¢æ·ç«¯çæä½æ¥å¿ï¼åç°èè£ç°è±¡\n\nå¨ææ¥å®¢æ·ç«¯çæä½æ¥å¿æ¶ï¼æä»¬åç°ï¼å¨ä¸»ä»åæ¢åçä¸æ®µæ¶é´åï¼æä¸ä¸ªå®¢æ·ç«¯ä»ç¶å¨ååä¸»åºéä¿¡ï¼å¹¶æ²¡æååçº§çæ°ä¸»åºè¿è¡äº¤äºãè¿å°±ç¸å½äºä¸»ä»éç¾¤ä¸­åæ¶æäºä¸¤ä¸ªä¸»åºãæ ¹æ®è¿ä¸ªè¿¹è±¡ï¼æä»¬å°±æ³å°äºå¨åå¸å¼ä¸»ä»éç¾¤åçæéæ¶ä¼åºç°çä¸ä¸ªé®é¢ï¼èè£ã\n\nä½æ¯ï¼ä¸åå®¢æ·ç«¯ç»ä¸¤ä¸ªä¸»åºåéæ°æ®åæä½ï¼æéçæ¥è¯´ï¼åªä¼å¯¼è´æ°æ°æ®ä¼åå¸å¨ä¸åçä¸»åºä¸ï¼å¹¶ä¸ä¼é ææ°æ®ä¸¢å¤±ãé£ä¹ï¼ä¸ºä»ä¹æä»¬çæ°æ®ä»ç¶ä¸¢å¤±äºå¢ï¼\n\nå°è¿éï¼æä»¬çææ¥æè·¯åä¸æ¬¡ä¸­æ­äºãä¸è¿ï¼å¨åæé®é¢æ¶ï¼æä»¬ä¸ç´è®¤ä¸ºâä»åçåºåæ¯è¿½æ¬æº¯æºçå¥½æ¹æ³âãèè£æ¯åçå¨ä¸»ä»åæ¢çè¿ç¨ä¸­ï¼æä»¬çæµï¼è¯å®æ¯æ¼æäºä¸»ä»éç¾¤åæ¢è¿ç¨ä¸­çæä¸ªç¯èï¼æä»¥ï¼æä»¬æç ç©¶çç¦ç¹æåäºä¸»ä»åæ¢çæ§è¡è¿ç¨ã\n\n# 2.1.3 ç¬¬ä¸æ­¥ï¼åç°æ¯åä¸»åºåæéå¯¼è´çèè£\n\næä»¬æ¯éç¨å¨åµæºå¶è¿è¡ä¸»ä»åæ¢çï¼å½ä¸»ä»åæ¢åçæ¶ï¼ä¸å®æ¯æè¶è¿é¢è®¾æ°éï¼quoruméç½®é¡¹ï¼çå¨åµå®ä¾åä¸»åºçå¿è·³é½è¶æ¶äºï¼æä¼æä¸»åºå¤æ­ä¸ºå®¢è§ä¸çº¿ï¼ç¶åï¼å¨åµå¼å§æ§è¡åæ¢æä½ãå¨åµåæ¢å®æåï¼å®¢æ·ç«¯ä¼åæ°ä¸»åºè¿è¡éä¿¡ï¼åéè¯·æ±æä½ã\n\nä½æ¯ï¼å¨åæ¢è¿ç¨ä¸­ï¼æ¢ç¶å®¢æ·ç«¯ä»ç¶ååä¸»åºéä¿¡ï¼è¿å°±è¡¨æï¼åä¸»åºå¹¶æ²¡æççåçæéï¼ä¾å¦ä¸»åºè¿ç¨ææï¼ãæä»¬çæµï¼ä¸»åºæ¯ç±äºæäºåå æ æ³å¤çè¯·æ±ï¼ä¹æ²¡æååºå¨åµçå¿è·³ï¼æè¢«å¨åµéè¯¯å°å¤æ­ä¸ºå®¢è§ä¸çº¿çãç»æï¼å¨è¢«å¤æ­ä¸çº¿ä¹åï¼åä¸»åºåéæ°å¼å§å¤çè¯·æ±äºï¼èæ­¤æ¶ï¼å¨åµè¿æ²¡æå®æä¸»ä»åæ¢ï¼å®¢æ·ç«¯ä»ç¶å¯ä»¥ååä¸»åºéä¿¡ï¼å®¢æ·ç«¯åéçåæä½å°±ä¼å¨åä¸»åºä¸åå¥æ°æ®äºã\n\nä¸ºäºéªè¯åä¸»åºåªæ¯âåæéâï¼æä»¬ä¹æ¥çäºåä¸»åºæå¨æå¡å¨çèµæºä½¿ç¨çæ§è®°å½ã\n\nçç¡®ï¼æä»¬çå°åä¸»åºæå¨çæºå¨æä¸æ®µæ¶é´çCPUå©ç¨ççªç¶ç¹å«é«ï¼è¿æ¯æä»¬å¨æºå¨ä¸é¨ç½²çä¸ä¸ªæ°æ®ééç¨åºå¯¼è´çãå ä¸ºè¿ä¸ªç¨åºåºæ¬ææºå¨çCPUé½ç¨æ»¡äºï¼å¯¼è´Redisä¸»åºæ æ³ååºå¿è·³äºï¼å¨è¿ä¸ªæé´åï¼å¨åµå°±æä¸»åºå¤æ­ä¸ºå®¢è§ä¸çº¿ï¼å¼å§ä¸»ä»åæ¢äºãä¸è¿ï¼è¿ä¸ªæ°æ®ééç¨åºå¾å¿«æ¢å¤æ­£å¸¸ï¼CPUçä½¿ç¨çä¹éä¸æ¥äºãæ­¤æ¶ï¼åä¸»åºåå¼å§æ­£å¸¸æå¡è¯·æ±äºã\n\næ­£å ä¸ºåä¸»åºå¹¶æ²¡æççåçæéï¼æä»¬å¨å®¢æ·ç«¯æä½æ¥å¿ä¸­å°±çå°äºååä¸»åºçéä¿¡è®°å½ãç­å°ä»åºè¢«åçº§ä¸ºæ°ä¸»åºåï¼ä¸»ä»éç¾¤éå°±æä¸¤ä¸ªä¸»åºäºï¼å°è¿éï¼æä»¬å°±æèè£åççåå æ¸æ¸æ¥äºã\n\nä¸ºäºå¸®å©ä½ å æ·±çè§£ï¼æåç»ä¸å¼ å¾ï¼å±ç¤ºä¸ä¸èè£çåçè¿ç¨ï¼\n\nå¼æ¸æ¥äºèè£åççåå åï¼æä»¬åç»åä¸»ä»åæ¢çåçè¿ç¨è¿è¡äºåæï¼å¾å¿«å°±æ¾å°æ°æ®ä¸¢å¤±çåå äºã\n\n\n# 2.2 ä¸ºä»ä¹èè£ä¼å¯¼è´æ°æ®ä¸¢å¤±ï¼\n\nä¸»ä»åæ¢åï¼ä»åºä¸æ¦åçº§ä¸ºæ°ä¸»åºï¼å¨åµå°±ä¼è®©åä¸»åºæ§è¡slave ofå½ä»¤ï¼åæ°ä¸»åºéæ°è¿è¡å¨éåæ­¥ãèå¨å¨éåæ­¥æ§è¡çæåé¶æ®µï¼åä¸»åºéè¦æ¸ç©ºæ¬å°çæ°æ®ï¼å è½½æ°ä¸»åºåéçRDBæä»¶ï¼è¿æ ·ä¸æ¥ï¼åä¸»åºå¨ä¸»ä»åæ¢æé´ä¿å­çæ°åæ°æ®å°±ä¸¢å¤±äºã\n\nä¸é¢è¿å¼ å¾ç´è§å°å±ç¤ºäºåä¸»åºæ°æ®ä¸¢å¤±çè¿ç¨ï¼\n\nå°è¿éï¼æä»¬å°±å®å¨å¼æç½äºè¿ä¸ªé®é¢çåçè¿ç¨ååå ã\n\nå¨ä¸»ä»åæ¢çè¿ç¨ä¸­ï¼å¦æåä¸»åºåªæ¯âåæéâï¼å®ä¼è§¦åå¨åµå¯å¨ä¸»ä»åæ¢ï¼ä¸æ¦ç­å®ä»åæéä¸­æ¢å¤åï¼åå¼å§å¤çè¯·æ±ï¼è¿æ ·ä¸æ¥ï¼å°±ä¼åæ°ä¸»åºåæ¶å­å¨ï¼å½¢æèè£ãç­å°å¨åµè®©åä¸»åºåæ°ä¸»åºåå¨éåæ­¥åï¼åä¸»åºå¨åæ¢æé´ä¿å­çæ°æ®å°±ä¸¢å¤±äºã\n\nçå°è¿éï¼ä½ è¯å®ä¼å¾å³å¿ï¼æä»¬è¯¥æä¹åºå¯¹èè£é æçæ°æ®ä¸¢å¤±é®é¢å¢ï¼\n\n\n# 2.3 å¦ä½åºå¯¹èè£é®é¢ï¼\n\nååè¯´äºï¼ä¸»ä»éç¾¤ä¸­çæ°æ®ä¸¢å¤±äºä»¶ï¼å½æ ¹ç»åºæ¯å ä¸ºåçäºèè£ãæä»¥ï¼æä»¬å¿é¡»è¦æ¾å°åºå¯¹èè£é®é¢çç­ç¥ã\n\næ¢ç¶é®é¢æ¯åºå¨åä¸»åºåçåæéåä»ç¶è½æ¥æ¶è¯·æ±ä¸ï¼æä»¬å°±å¼å§å¨ä¸»ä»éç¾¤æºå¶çéç½®é¡¹ä¸­æ¥æ¾æ¯å¦æéå¶ä¸»åºæ¥æ¶è¯·æ±çè®¾ç½®ã\n\néè¿æ¥æ¾ï¼æä»¬åç°ï¼Redis å·²ç»æä¾äºä¸¤ä¸ªéç½®é¡¹æ¥éå¶ä¸»åºçè¯·æ±å¤çï¼åå«æ¯ min-slaves-to-write å min-slaves-max-lagï¼\n\n * min-slaves-to-writeï¼è¿ä¸ªéç½®é¡¹è®¾ç½®äºä¸»åºè½è¿è¡æ°æ®åæ­¥çæå°ä»åºæ°éï¼\n * min-slaves-max-lagï¼è¿ä¸ªéç½®é¡¹è®¾ç½®äºä¸»ä»åºé´è¿è¡æ°æ®å¤å¶æ¶ï¼ä»åºç»ä¸»åºåé ACK æ¶æ¯çæå¤§å»¶è¿ï¼ä»¥ç§ä¸ºåä½ï¼ã\n\næäºè¿ä¸¤ä¸ªéç½®é¡¹åï¼æä»¬å°±å¯ä»¥è½»æ¾å°åºå¯¹èè£é®é¢äºãå·ä½ååå¢ï¼æä»¬å¯ä»¥æmin-slaves-to-writeåmin-slaves-max-lagè¿ä¸¤ä¸ªéç½®é¡¹æ­éèµ·æ¥ä½¿ç¨ï¼åå«ç»å®ä»¬è®¾ç½®ä¸å®çéå¼ï¼åè®¾ä¸ºNåTãè¿ä¸¤ä¸ªéç½®é¡¹ç»ååçè¦æ±æ¯ï¼ä¸»åºè¿æ¥çä»åºä¸­è³å°æNä¸ªä»åºï¼åä¸»åºè¿è¡æ°æ®å¤å¶æ¶çACKæ¶æ¯å»¶è¿ä¸è½è¶è¿Tç§ï¼å¦åï¼ä¸»åºå°±ä¸ä¼åæ¥æ¶å®¢æ·ç«¯çè¯·æ±äºã\n\nå³ä½¿åä¸»åºæ¯åæéï¼å®å¨åæéæé´ä¹æ æ³ååºå¨åµå¿è·³ï¼ä¹ä¸è½åä»åºè¿è¡åæ­¥ï¼èªç¶ä¹å°±æ æ³åä»åºè¿è¡ACKç¡®è®¤äºãè¿æ ·ä¸æ¥ï¼min-slaves-to-writeåmin-slaves-max-lagçç»åè¦æ±å°±æ æ³å¾å°æ»¡è¶³ï¼åä¸»åºå°±ä¼è¢«éå¶æ¥æ¶å®¢æ·ç«¯è¯·æ±ï¼å®¢æ·ç«¯ä¹å°±ä¸è½å¨åä¸»åºä¸­åå¥æ°æ°æ®äºã\n\nç­å°æ°ä¸»åºä¸çº¿æ¶ï¼å°±åªææ°ä¸»åºè½æ¥æ¶åå¤çå®¢æ·ç«¯è¯·æ±ï¼æ­¤æ¶ï¼æ°åçæ°æ®ä¼è¢«ç´æ¥åå°æ°ä¸»åºä¸­ãèåä¸»åºä¼è¢«å¨åµéä¸ºä»åºï¼å³ä½¿å®çæ°æ®è¢«æ¸ç©ºäºï¼ä¹ä¸ä¼ææ°æ°æ®ä¸¢å¤±ã\n\næåæ¥ç»ä½ ä¸¾ä¸ªä¾å­ã\n\nåè®¾æä»¬å°min-slaves-to-writeè®¾ç½®ä¸º1ï¼æmin-slaves-max-lagè®¾ç½®ä¸º12sï¼æå¨åµçdown-after-millisecondsè®¾ç½®ä¸º10sï¼ä¸»åºå ä¸ºæäºåå å¡ä½äº15sï¼å¯¼è´å¨åµå¤æ­ä¸»åºå®¢è§ä¸çº¿ï¼å¼å§è¿è¡ä¸»ä»åæ¢ãåæ¶ï¼å ä¸ºåä¸»åºå¡ä½äº15sï¼æ²¡æä¸ä¸ªä»åºè½ååä¸»åºå¨12såè¿è¡æ°æ®å¤å¶ï¼åä¸»åºä¹æ æ³æ¥æ¶å®¢æ·ç«¯è¯·æ±äºãè¿æ ·ä¸æ¥ï¼ä¸»ä»åæ¢å®æåï¼ä¹åªææ°ä¸»åºè½æ¥æ¶è¯·æ±ï¼ä¸ä¼åçèè£ï¼ä¹å°±ä¸ä¼åçæ°æ®ä¸¢å¤±çé®é¢äºã\n\n\n# 2.4 å°ç»\n\nè¿èè¯¾ï¼æä»¬å­¦ä¹ äºä¸»ä»åæ¢æ¶å¯è½éå°çèè£é®é¢ãèè£æ¯æå¨ä¸»ä»éç¾¤ä¸­ï¼åæ¶æä¸¤ä¸ªä¸»åºé½è½æ¥æ¶åè¯·æ±ãå¨Redisçä¸»ä»åæ¢è¿ç¨ä¸­ï¼å¦æåçäºèè£ï¼å®¢æ·ç«¯æ°æ®å°±ä¼åå¥å°åä¸»åºï¼å¦æåä¸»åºè¢«éä¸ºä»åºï¼è¿äºæ°åå¥çæ°æ®å°±ä¸¢å¤±äºã\n\nèè£åççåå ä¸»è¦æ¯åä¸»åºåçäºåæéï¼æä»¬æ¥æ»ç»ä¸åæéçä¸¤ä¸ªåå ã\n\n 1. åä¸»åºé¨ç½²å¨åä¸å°æå¡å¨ä¸çå¶ä»ç¨åºä¸´æ¶å ç¨äºå¤§éèµæºï¼ä¾å¦CPUèµæºï¼ï¼å¯¼è´ä¸»åºèµæºä½¿ç¨åéï¼ç­æ¶é´åæ æ³ååºå¿è·³ãå¶å®ç¨åºä¸åä½¿ç¨èµæºæ¶ï¼ä¸»åºåæ¢å¤æ­£å¸¸ã\n 2. ä¸»åºèªèº«éå°äºé»å¡çæåµï¼ä¾å¦ï¼å¤çbigkeyææ¯åçåå­swapï¼ç­æ¶é´åæ æ³ååºå¿è·³ï¼ç­ä¸»åºé»å¡è§£é¤åï¼åæ¢å¤æ­£å¸¸çè¯·æ±å¤çäºã\n\nä¸ºäºåºå¯¹èè£ï¼ä½ å¯ä»¥å¨ä¸»ä»éç¾¤é¨ç½²æ¶ï¼éè¿åçå°éç½®åæ°min-slaves-to-writeåmin-slaves-max-lagï¼æ¥é¢é²èè£çåçã\n\nå¨å®éåºç¨ä¸­ï¼å¯è½ä¼å ä¸ºç½ç»ææ¶æ¥å¡å¯¼è´ä»åºææ¶åä¸»åºçACKæ¶æ¯è¶æ¶ãå¨è¿ç§æåµä¸ï¼å¹¶ä¸æ¯ä¸»åºåæéï¼æä»¬ä¹ä¸ç¨ç¦æ­¢ä¸»åºæ¥æ¶è¯·æ±ã\n\næä»¥ï¼æç»ä½ çå»ºè®®æ¯ï¼åè®¾ä»åºæKä¸ªï¼å¯ä»¥å°min-slaves-to-writeè®¾ç½®ä¸ºK/2+1ï¼å¦æKç­äº1ï¼å°±è®¾ä¸º1ï¼ï¼å°min-slaves-max-lagè®¾ç½®ä¸ºåå ç§ï¼ä¾å¦10ï½20sï¼ï¼å¨è¿ä¸ªéç½®ä¸ï¼å¦ææä¸åä»¥ä¸çä»åºåä¸»åºè¿è¡çACKæ¶æ¯å»¶è¿è¶è¿åå ç§ï¼æä»¬å°±ç¦æ­¢ä¸»åºæ¥æ¶å®¢æ·ç«¯åè¯·æ±ã\n\nè¿æ ·ä¸æ¥ï¼æä»¬å¯ä»¥é¿åèè£å¸¦æ¥æ°æ®ä¸¢å¤±çæåµï¼èä¸ï¼ä¹ä¸ä¼å ä¸ºåªæå°æ°å ä¸ªä»åºå ä¸ºç½ç»é»å¡è¿ä¸ä¸ä¸»åºï¼å°±ç¦æ­¢ä¸»åºæ¥æ¶è¯·æ±ï¼å¢å äºç³»ç»çé²æ£æ§ã",normalizedContent:"> åèï¼\n> \n>  * 32 redis ä¸»ä»åæ­¥ä¸æéåæ¢ï¼æåªäºåï¼| æå®¢æ¶é´\n>  * 33 èè£ï¼ä¸æ¬¡å¥æªçæ°æ®ä¸¢å¤±| æå®¢æ¶é´\n> \n> å¦å¤ï¼\n> \n> è¿ç¯åæè®²åæ­¥è®²çä¸éï¼é½ä¸²èµ·æ¥äºã\n\n\n# 1. redis ä¸»ä»åæ­¥ä¸æéåæ¢ï¼æåªäºåï¼\n\nredis çä¸»ä»åæ­¥æºå¶ä¸ä»å¯ä»¥è®©ä»åºæå¡æ´å¤çè¯»è¯·æ±ï¼åæä¸»åºçååï¼èä¸è¿è½å¨ä¸»åºåçæéæ¶ï¼è¿è¡ä¸»ä»åºåæ¢ï¼æä¾é«å¯é æå¡ãä¸è¿å¨ä½¿ç¨ä¸»ä»æºå¶æ¶å¯è½ä¼éå°ä¸äºåï¼è¿éä¸»è¦ä»ç»ä¸ä¸ªåï¼ä¸»ä»æ°æ®ä¸ä¸è´ãè¯»å°è¿ææ°æ®ï¼ä»¥åéç½®é¡¹è®¾ç½®å¾ä¸åçä»èå¯¼è´æå¡ææã\n\n\n# 1.1 ä¸»ä»æ°æ®ä¸ä¸è´\n\nä¸»ä»æ°æ®ä¸ä¸è´ï¼å°±æ¯æå®¢æ·ç«¯ä»ä»åºä¸­è¯»åå°çå¼åä¸»åºä¸­çææ°å¼å¹¶ä¸ä¸è´ã\n\nåºç°çåå å°±æ¯ä¸»ä»ä¹é´çæ°æ®å¤å¶æ¯å¼æ­¥è¿è¡çãä»åºåºç°æ»åçä¸¤ä¸ªä¸»è¦åå ï¼\n\n 1. ç½ç»å»¶è¿\n 2. ä»åºå å¶ä»æä½èé»å¡è¾é¿æ¶é´\n\nåºå¯¹æ¹æ³ä¸»è¦æä¸¤ä¸ªï¼\n\n 1. ç¡¬ä»¶æ¹é¢ï¼å°½éä¿è¯ä¸»ä»åºé´çç½ç»ç¶åµè¯å¥½ãä¾å¦ï¼æä»¬è¦é¿åæä¸»ä»åºé¨ç½²å¨ä¸åçæºæ¿ï¼æèæ¯é¿åæç½ç»éä¿¡å¯éçåºç¨ï¼ä¾å¦æ°æ®åæåºç¨ï¼åredisä¸»ä»åºé¨ç½²å¨ä¸èµ·ã\n 2. è¿å¯ä»¥å¼åä¸ä¸ªå¤é¨ç¨åºæ¥çæ§ä¸»ä»åºé´çå¤å¶è¿åº¦ãä¸é¢ä»ç»æ¹æ³ã\n\nå ä¸ºredisçinfo replicationå½ä»¤å¯ä»¥æ¥çä¸»åºæ¥æ¶åå½ä»¤çè¿åº¦ä¿¡æ¯ï¼master_repl_offsetï¼åä»åºå¤å¶åå½ä»¤çè¿åº¦ä¿¡æ¯ï¼slave_repl_offsetï¼ï¼æä»¥ï¼æä»¬å°±å¯ä»¥å¼åä¸ä¸ªçæ§ç¨åºï¼åç¨info replicationå½ä»¤æ¥å°ä¸»ãä»åºçè¿åº¦ï¼ç¶åï¼æä»¬ç¨master_repl_offsetåå»slave_repl_offsetï¼è¿æ ·å°±è½å¾å°ä»åºåä¸»åºé´çå¤å¶è¿åº¦å·®å¼äºã\n\nå¦ææä¸ªä»åºçè¿åº¦å·®å¼å¤§äºæä»¬é¢è®¾çéå¼ï¼æä»¬å¯ä»¥è®©å®¢æ·ç«¯ä¸ååè¿ä¸ªä»åºè¿æ¥è¿è¡æ°æ®è¯»åï¼è¿æ ·å°±å¯ä»¥åå°è¯»å°ä¸ä¸è´æ°æ®çæåµãä¸è¿ï¼ä¸ºäºé¿ååºç°å®¢æ·ç«¯åææä»åºé½ä¸è½è¿æ¥çæåµï¼æä»¬éè¦æå¤å¶è¿åº¦å·®å¼çéå¼è®¾ç½®å¾å¤§ä¸äºã å½ç¶ï¼çæ§ç¨åºå¯ä»¥ä¸ç´çæ§çä»åºçå¤å¶è¿åº¦ï¼å½ä»åºçå¤å¶è¿åº¦åèµ¶ä¸ä¸»åºæ¶ï¼æä»¬å°±åè®¸å®¢æ·ç«¯åæ¬¡è·è¿äºä»åºè¿æ¥ã\n\n\n# 1.2 è¯»åè¿ææ°æ®\n\næä»¬å¨ä½¿ç¨ redis ä¸»ä»éç¾¤æ¶ï¼ææ¶ä¼è¯»å°è¿ææ°æ®ãä¾å¦ï¼æ°æ® x çè¿ææ¶é´æ¯ 202010240900ï¼ä½æ¯å®¢æ·ç«¯å¨ 202010240910 æ¶ï¼ä»ç¶å¯ä»¥ä»ä»åºä¸­è¯»å°æ°æ® xãä¸ä¸ªæ°æ®è¿æåï¼åºè¯¥æ¯è¢«å é¤çï¼å®¢æ·ç«¯ä¸è½åè¯»åå°è¯¥æ°æ®ï¼ä½æ¯ï¼redis ä¸ºä»ä¹è¿è½å¨ä»åºä¸­è¯»å°è¿æçæ°æ®å¢ï¼\n\nå¶å®ï¼è¿ä¸ªé®é¢æ¯ç±redisçè¿ææ°æ®å é¤ç­ç¥å¼èµ·çã\n\nredis åæ¶ä½¿ç¨äºä¸¤ç§ç­ç¥æ¥å é¤è¿ææ°æ®ï¼\n\n 1. æ°æ§å é¤ç­ç¥ï¼å½ä¸ä¸ªæ°æ®çè¿ææ¶é´å°äºä»¥åï¼å¹¶ä¸ä¼ç«å³å é¤æ°æ®ï¼èæ¯ç­å°åæè¯·æ±æ¥è¯»åè¿ä¸ªæ°æ®æ¶ï¼å¯¹æ°æ®è¿è¡æ£æ¥ï¼å¦æåç°æ°æ®å·²ç»è¿æäºï¼åå é¤è¿ä¸ªæ°æ®ã\n    * è¿ç§æ¹æ³åå°äºå é¤æ°æ®å¯¹ cpu èµæºçä½¿ç¨ï¼ä½ä¼å¯¼è´å¤§éå·²è¿ææ°æ®çå¨åå­ä¸­ã\n 2. å®æå é¤ç­ç¥ï¼redis æ¯éä¸æ®µæ¶é´ï¼é»è®¤100msï¼ï¼å°±ä¼éæºéåºä¸å®æ°éçæ°æ®ï¼æ£æ¥å®ä»¬æ¯å¦è¿æï¼å¹¶æå¶ä¸­è¿æçæ°æ®å é¤ï¼è¿æ ·å°±å¯ä»¥åæ¶éæ¾ä¸äºåå­ã\n\næ¸æ¥äºè¿ä¸¤ä¸ªå é¤ç­ç¥ï¼æä»¬åæ¥ççå®ä»¬ä¸ºä»ä¹ä¼å¯¼è´è¯»åå°è¿ææ°æ®ã\n\n * å®æå é¤ç­ç¥åªä¼éæºæ£æ¥ä¸é¨åæ°æ®ï¼ä»ä¼å­å¨è¿ææ°æ®æ®ççé®é¢ã\n * æ°æ§å é¤ç­ç¥åªå¨æ°æ®åæ¬¡è¢«è®¿é®æ¶æä¼å®éå é¤ãå¦æå®¢æ·ç«¯ä»ä¸»åºä¸è¯»åçå­çè¿ææ°æ®ï¼ä¸»åºä¼è§¦åå é¤æä½ï¼æ­¤æ¶ï¼å®¢æ·ç«¯å¹¶ä¸ä¼è¯»å°è¿ææ°æ®ãä½æ¯ï¼ä»åºæ¬èº«ä¸ä¼æ§è¡å é¤æä½ï¼å¦æå®¢æ·ç«¯å¨ä»åºä¸­è®¿é®çå­çè¿ææ°æ®ï¼ä»åºå¹¶ä¸ä¼è§¦åæ°æ®å é¤ãé£ä¹ï¼ä»åºä¼ç»å®¢æ·ç«¯è¿åè¿ææ°æ®åï¼è¿å°±åä½ ä½¿ç¨çredisçæ¬æå³äºãå¦æä½ ä½¿ç¨çæ¯redis 3.2ä¹åççæ¬ï¼é£ä¹ï¼ä»åºå¨æå¡è¯»è¯·æ±æ¶ï¼å¹¶ä¸ä¼å¤æ­æ°æ®æ¯å¦è¿æï¼èæ¯ä¼è¿åè¿ææ°æ®ãå¨3.2çæ¬åï¼redisåäºæ¹è¿ï¼å¦æè¯»åçæ°æ®å·²ç»è¿æäºï¼ä»åºè½ç¶ä¸ä¼å é¤ï¼ä½æ¯ä¼è¿åç©ºå¼ï¼è¿å°±é¿åäºå®¢æ·ç«¯è¯»å°è¿ææ°æ®ãæä»¥ï¼å¨åºç¨ä¸»ä»éç¾¤æ¶ï¼å°½éä½¿ç¨ redis 3.2 åä»¥ä¸çæ¬ã\n\né£åªè¦ä½¿ç¨äºredis 3.2 åççæ¬ï¼å°±ä¸ä¼è¯»å°è¿ææ°æ®äºåï¼å¶å®è¿æ¯ä¼çãåå è· redis ç¨äºè®¾ç½®è¿ææ¶é´çå½ä»¤æå³ç³»ï¼æäºå½ä»¤ç»æ°æ®è®¾ç½®çè¿ææ¶é´å¨ä»åºä¸å¯è½ä¼è¢«å»¶åï¼å¯¼è´åºè¯¥è¿æçæ°æ®åå¨ä»åºä¸è¢«è¯»åå°äºï¼ææ¥ç»ä½ å·ä½è§£éä¸ã\n\nè®¾ç½®æ°æ®è¿ææ¶é´çå½ä»¤ä¸å±æ4ä¸ªï¼æä»¬å¯ä»¥æå®ä»¬åæä¸¤ç±»ï¼\n\n * expire å pexpireï¼å®ä»¬ç»æ°æ®è®¾ç½®çæ¯ä»å½ä»¤æ§è¡æ¶å¼å§è®¡ç®çå­æ´»æ¶é´ï¼\n * expireat å pexpireatï¼å®ä»¬ä¼ç´æ¥ææ°æ®çè¿ææ¶é´è®¾ç½®ä¸ºå·ä½çä¸ä¸ªæ¶é´ç¹ã\n\nè¿ 4 ä¸ªå½ä»¤çåæ°åå«ä¹å¦ä¸è¡¨æç¤ºï¼\n\nç¤ºä¾ï¼\n\n * expire testkey 60ï¼æ testkey çè¿ææ¶é´è®¾ç½®ä¸º 60s å\n * expireat testkey 1603501200ï¼è®©testkeyå¨2020å¹´10æ24æ¥ä¸å9ç¹è¿æï¼å½ä»¤ä¸­ç1603501200å°±æ¯ä»¥ç§æ°æ¶é´æ³è¡¨ç¤ºç10æ24æ¥ä¸å9ç¹ã\n\nç±äºç½ç»å»¶è¿ï¼ä½¿ç¨ expire å¯è½ä¼è®©ä¸»ä»åºçè¿ææ¶é´ç¹ä¸ä¸æ ·ãå æ­¤å»ºè®®ï¼å¨ä¸å¡åºç¨ä¸­ä½¿ç¨ expireat/pexpireat å½ä»¤ï¼ææ°æ®çè¿ææ¶é´è®¾ç½®ä¸ºå·ä½çæ¶é´ç¹ï¼é¿åè¯»å°è¿ææ°æ®ãå¦å¤æ³¨æï¼expireat/pexpireat è®¾ç½®çæ¯æ¶é´ç¹ï¼æä»¥ä¸»ä»èç¹ä¸çæ¶éè¦ä¿æä¸è´ï¼å·ä½çåæ³æ¯ï¼è®©ä¸»ä»èç¹åç¸åç ntp æå¡å¨(æ¶é´æå¡å¨)è¿è¡æ¶éåæ­¥ã\n\n\n# 1.3 ä¸åçéç½®é¡¹å¯¼è´çæå¡ææ\n\nè¿éæ¶åå°çéç½®é¡¹æä¸¤ä¸ªï¼åå«æ¯ protected-mode å cluster-node-timeoutã\n\n# 1ï¼protected-mode éç½®é¡¹\n\nè¿ä¸ªéç½®é¡¹çä½ç¨æ¯éå®å¨åµå®ä¾è½å¦è¢«å¶ä»æå¡å¨è®¿é®ï¼\n\n * yesï¼å¨åµå®ä¾åªè½å¨é¨ç½²çæå¡å¨æ¬å°è¿è¡è®¿é®\n * noï¼å¶ä»æå¡å¨ä¹å¯ä»¥è®¿é®è¿ä¸ªå¨åµå®ä¾\n\næ­£å ä¸ºè¿æ ·ï¼å¦æprotected-modeè¢«è®¾ç½®ä¸ºyesï¼èå¶ä½å¨åµå®ä¾é¨ç½²å¨å¶å®æå¡å¨ï¼é£ä¹ï¼è¿äºå¨åµå®ä¾é´å°±æ æ³éä¿¡ãå½ä¸»åºæéæ¶ï¼å¨åµæ æ³å¤æ­ä¸»åºä¸çº¿ï¼ä¹æ æ³è¿è¡ä¸»ä»åæ¢ï¼æç»redisæå¡ä¸å¯ç¨ã\n\næä»¥ï¼æä»¬å¨åºç¨ä¸»ä»éç¾¤æ¶ï¼è¦æ³¨æå° protected-mode éç½®é¡¹è®¾ç½®ä¸ºnoï¼å¹¶ä¸å°bindéç½®é¡¹è®¾ç½®ä¸ºå¶å®å¨åµå®ä¾çipå°åãè¿æ ·ä¸æ¥ï¼åªæå¨bindä¸­è®¾ç½®äºipå°åçå¨åµï¼æå¯ä»¥è®¿é®å½åå®ä¾ï¼æ¢ä¿è¯äºå®ä¾é´è½å¤éä¿¡è¿è¡ä¸»ä»åæ¢ï¼ä¹ä¿è¯äºå¨åµçå®å¨æ§ã\n\næä»¬æ¥çä¸ä¸ªç®åçå°ä¾å­ãå¦æè®¾ç½®äºä¸é¢çéç½®é¡¹ï¼é£ä¹ï¼é¨ç½²å¨192.168.10.3/4/5è¿ä¸å°æå¡å¨ä¸çå¨åµå®ä¾å°±å¯ä»¥ç¸äºéä¿¡ï¼æ§è¡ä¸»ä»åæ¢ï¼\n\nprotected-mode no\nbind 192.168.10.3 192.168.10.4 192.168.10.5\n\n\n1\n2\n\n\n# 2ï¼cluster-node-timeout éç½®é¡¹\n\nè¿ä¸ªéç½®é¡¹è®¾ç½®äºredis clusterä¸­å®ä¾ååºå¿è·³æ¶æ¯çè¶æ¶æ¶é´ã\n\nå½æä»¬å¨redis clusteréç¾¤ä¸­ä¸ºæ¯ä¸ªå®ä¾éç½®äºâä¸ä¸»ä¸ä»âæ¨¡å¼æ¶ï¼å¦æä¸»å®ä¾åçæéï¼ä»å®ä¾ä¼åæ¢ä¸ºä¸»å®ä¾ï¼åç½ç»å»¶è¿ååæ¢æä½æ§è¡çå½±åï¼åæ¢æ¶é´å¯è½è¾é¿ï¼å°±ä¼å¯¼è´å®ä¾çå¿è·³è¶æ¶ï¼è¶åºcluster-node-timeoutï¼ãå®ä¾è¶æ¶åï¼å°±ä¼è¢«redis clusterå¤æ­ä¸ºå¼å¸¸ãèredis clusteræ­£å¸¸è¿è¡çæ¡ä»¶å°±æ¯ï¼æåæ°ä»¥ä¸çå®ä¾é½è½æ­£å¸¸è¿è¡ã\n\næä»¥ï¼å¦ææ§è¡ä¸»ä»åæ¢çå®ä¾è¶è¿åæ°ï¼èä¸»ä»åæ¢æ¶é´åè¿é¿çè¯ï¼å°±å¯è½æåæ°ä»¥ä¸çå®ä¾å¿è·³è¶æ¶ï¼ä»èå¯è½å¯¼è´æ´ä¸ªéç¾¤ææãæä»¥ï¼æå»ºè®®ä½ å°cluster-node-timeoutè°å¤§äºï¼ä¾å¦10å°20ç§ï¼ã\n\n\n# 1.4 å°ç»\n\nè¿ä¸èä¸»è¦è®²äº redis åä¸»ä»åæ­¥æ¶å¯è½åºç°ç 3 ä¸ªåï¼ä¸»ä»æ°æ®ä¸ä¸è´ãè¯»åå°è¿ææ°æ®åä¸åçéç½®é¡¹å¯¼è´æå¡ææãæ»ç»å¦ä¸ï¼\n\næåï¼å³äºä¸»ä»åºæ°æ®ä¸ä¸è´çé®é¢ï¼æè¿æ³åç»ä½ æä¸ä¸ªå°å»ºè®®ï¼redisä¸­çslave-serve-stale-dataéç½®é¡¹è®¾ç½®äºä»åºè½å¦å¤çæ°æ®è¯»åå½ä»¤ï¼ä½ å¯ä»¥æå®è®¾ç½®ä¸ºnoãè¿æ ·ä¸æ¥ï¼ä»åºåªè½æå¡infoãslaveofå½ä»¤ï¼è¿å°±å¯ä»¥é¿åå¨ä»åºä¸­è¯»å°ä¸ä¸è´çæ°æ®äºã\n\nä¸è¿ï¼ä½ è¦æ³¨æä¸è¿ä¸ªéç½®é¡¹åslave-read-onlyçåºå«ï¼slave-read-onlyæ¯è®¾ç½®ä»åºè½å¦å¤çåå½ä»¤ï¼slave-read-onlyè®¾ç½®ä¸ºyesæ¶ï¼ä»åºåªè½å¤çè¯»è¯·æ±ï¼æ æ³å¤çåè¯·æ±ï¼ä½ å¯ä¸è¦ææ··äºã\n\n\n# 2. èè£ï¼ä¸æ¬¡å¥æªçæ°æ®ä¸¢å¤±\n\n> å¨ä½¿ç¨ä¸»ä»éç¾¤æ¶ï¼ææ¾éå°è¿è¿æ ·ä¸ä¸ªé®é¢ï¼æä»¬çä¸»ä»éç¾¤æ1ä¸ªä¸»åºã5ä¸ªä»åºå3ä¸ªå¨åµå®ä¾ï¼å¨ä½¿ç¨çè¿ç¨ä¸­ï¼æä»¬åç°å®¢æ·ç«¯åéçä¸äºæ°æ®ä¸¢å¤±äºï¼è¿ç´æ¥å½±åå°äºä¸å¡å±çæ°æ®å¯é æ§ãéè¿ææ¥æç¥éï¼è¿å¶å®æ¯ä¸»ä»éç¾¤ä¸­èè£é®é¢å¯¼è´çã\n\nèè£ï¼æå¨ä¸»ä»éç¾¤ä¸­ï¼åæ¶æä¸¤ä¸ªä¸»èç¹ï¼å®ä»¬é½è½æ¥æ¶åè¯·æ±ãèèè£æç´æ¥çå½±åï¼å°±æ¯å®¢æ·ç«¯ä¸ç¥éåºè¯¥å¾åªä¸ªä¸»èç¹åå¥æ°æ®ï¼ç»æå°±æ¯ä¸åçå®¢æ·ç«¯ä¼å¾ä¸åçä¸»èç¹ä¸åå¥æ°æ®ãèä¸ï¼ä¸¥éçè¯ï¼èè£ä¼è¿ä¸æ­¥å¯¼è´æ°æ®ä¸¢å¤±ã\n\n\n# 2.1 ä¸ºä»ä¹ä¼åçèè£ï¼\n\nåæææå°ï¼ææååç°çé®é¢æ¯ï¼å¨ä¸»ä»éç¾¤ä¸­ï¼å®¢æ·ç«¯åéçæ°æ®ä¸¢å¤±äºãæä»¥ï¼æä»¬é¦åè¦å¼æç½ï¼ä¸ºä»ä¹æ°æ®ä¼ä¸¢å¤±ï¼æ¯ä¸æ¯æ°æ®åæ­¥åºäºé®é¢ï¼\n\n# 2.1.1 ç¬¬ä¸æ­¥ï¼ç¡®è®¤æ¯ä¸æ¯æ°æ®åæ­¥åºç°äºé®é¢\n\nå¨ä¸»ä»éç¾¤ä¸­åçæ°æ®ä¸¢å¤±ï¼æå¸¸è§çåå å°±æ¯ï¼ä¸»åºçæ°æ®è¿æ²¡æåæ­¥å°ä»åºï¼ç»æä¸»åºåçäºæéï¼ç­ä»åºåçº§ä¸ºä¸»åºåï¼æªåæ­¥çæ°æ®å°±ä¸¢å¤±äºã\n\nå¦ææ¯è¿ç§æåµçæ°æ®ä¸¢å¤±ï¼æä»¬å¯ä»¥éè¿æ¯å¯¹ä¸»ä»åºä¸çå¤å¶è¿åº¦å·®å¼æ¥è¿è¡å¤æ­ï¼ä¹å°±æ¯è®¡ç®master_repl_offsetåslave_repl_offsetçå·®å¼ãå¦æä»åºä¸çslave_repl_offsetå°äºåä¸»åºçmaster_repl_offsetï¼é£ä¹ï¼æä»¬å°±å¯ä»¥è®¤å®æ°æ®ä¸¢å¤±æ¯ç±æ°æ®åæ­¥æªå®æå¯¼è´çã\n\nå¨èæ¯é®é¢ä¸­ï¼æä»¬å¦ä¸åäºæ£æ¥ï¼åç°å¹¶ä¸æ¯è¿ä¸ªé®é¢ãé£ä¹æä»¬æ³å°ï¼ææçæ°æ®æä½é½æ¯ä»å®¢æ·ç«¯åéç»rediså®ä¾çï¼é£ä¹ï¼æ¯ä¸æ¯å¯ä»¥ä»å®¢æ·ç«¯æä½æ¥å¿ä¸­åç°é®é¢å¢ï¼ç´§æ¥çï¼æä»¬å°±æç®åè½¬å°äºå®¢æ·ç«¯ã\n\n# 2.1.2 ç¬¬äºæ­¥ï¼ææ¥å®¢æ·ç«¯çæä½æ¥å¿ï¼åç°èè£ç°è±¡\n\nå¨ææ¥å®¢æ·ç«¯çæä½æ¥å¿æ¶ï¼æä»¬åç°ï¼å¨ä¸»ä»åæ¢åçä¸æ®µæ¶é´åï¼æä¸ä¸ªå®¢æ·ç«¯ä»ç¶å¨ååä¸»åºéä¿¡ï¼å¹¶æ²¡æååçº§çæ°ä¸»åºè¿è¡äº¤äºãè¿å°±ç¸å½äºä¸»ä»éç¾¤ä¸­åæ¶æäºä¸¤ä¸ªä¸»åºãæ ¹æ®è¿ä¸ªè¿¹è±¡ï¼æä»¬å°±æ³å°äºå¨åå¸å¼ä¸»ä»éç¾¤åçæéæ¶ä¼åºç°çä¸ä¸ªé®é¢ï¼èè£ã\n\nä½æ¯ï¼ä¸åå®¢æ·ç«¯ç»ä¸¤ä¸ªä¸»åºåéæ°æ®åæä½ï¼æéçæ¥è¯´ï¼åªä¼å¯¼è´æ°æ°æ®ä¼åå¸å¨ä¸åçä¸»åºä¸ï¼å¹¶ä¸ä¼é ææ°æ®ä¸¢å¤±ãé£ä¹ï¼ä¸ºä»ä¹æä»¬çæ°æ®ä»ç¶ä¸¢å¤±äºå¢ï¼\n\nå°è¿éï¼æä»¬çææ¥æè·¯åä¸æ¬¡ä¸­æ­äºãä¸è¿ï¼å¨åæé®é¢æ¶ï¼æä»¬ä¸ç´è®¤ä¸ºâä»åçåºåæ¯è¿½æ¬æº¯æºçå¥½æ¹æ³âãèè£æ¯åçå¨ä¸»ä»åæ¢çè¿ç¨ä¸­ï¼æä»¬çæµï¼è¯å®æ¯æ¼æäºä¸»ä»éç¾¤åæ¢è¿ç¨ä¸­çæä¸ªç¯èï¼æä»¥ï¼æä»¬æç ç©¶çç¦ç¹æåäºä¸»ä»åæ¢çæ§è¡è¿ç¨ã\n\n# 2.1.3 ç¬¬ä¸æ­¥ï¼åç°æ¯åä¸»åºåæéå¯¼è´çèè£\n\næä»¬æ¯éç¨å¨åµæºå¶è¿è¡ä¸»ä»åæ¢çï¼å½ä¸»ä»åæ¢åçæ¶ï¼ä¸å®æ¯æè¶è¿é¢è®¾æ°éï¼quoruméç½®é¡¹ï¼çå¨åµå®ä¾åä¸»åºçå¿è·³é½è¶æ¶äºï¼æä¼æä¸»åºå¤æ­ä¸ºå®¢è§ä¸çº¿ï¼ç¶åï¼å¨åµå¼å§æ§è¡åæ¢æä½ãå¨åµåæ¢å®æåï¼å®¢æ·ç«¯ä¼åæ°ä¸»åºè¿è¡éä¿¡ï¼åéè¯·æ±æä½ã\n\nä½æ¯ï¼å¨åæ¢è¿ç¨ä¸­ï¼æ¢ç¶å®¢æ·ç«¯ä»ç¶ååä¸»åºéä¿¡ï¼è¿å°±è¡¨æï¼åä¸»åºå¹¶æ²¡æççåçæéï¼ä¾å¦ä¸»åºè¿ç¨ææï¼ãæä»¬çæµï¼ä¸»åºæ¯ç±äºæäºåå æ æ³å¤çè¯·æ±ï¼ä¹æ²¡æååºå¨åµçå¿è·³ï¼æè¢«å¨åµéè¯¯å°å¤æ­ä¸ºå®¢è§ä¸çº¿çãç»æï¼å¨è¢«å¤æ­ä¸çº¿ä¹åï¼åä¸»åºåéæ°å¼å§å¤çè¯·æ±äºï¼èæ­¤æ¶ï¼å¨åµè¿æ²¡æå®æä¸»ä»åæ¢ï¼å®¢æ·ç«¯ä»ç¶å¯ä»¥ååä¸»åºéä¿¡ï¼å®¢æ·ç«¯åéçåæä½å°±ä¼å¨åä¸»åºä¸åå¥æ°æ®äºã\n\nä¸ºäºéªè¯åä¸»åºåªæ¯âåæéâï¼æä»¬ä¹æ¥çäºåä¸»åºæå¨æå¡å¨çèµæºä½¿ç¨çæ§è®°å½ã\n\nçç¡®ï¼æä»¬çå°åä¸»åºæå¨çæºå¨æä¸æ®µæ¶é´çcpuå©ç¨ççªç¶ç¹å«é«ï¼è¿æ¯æä»¬å¨æºå¨ä¸é¨ç½²çä¸ä¸ªæ°æ®ééç¨åºå¯¼è´çãå ä¸ºè¿ä¸ªç¨åºåºæ¬ææºå¨çcpué½ç¨æ»¡äºï¼å¯¼è´redisä¸»åºæ æ³ååºå¿è·³äºï¼å¨è¿ä¸ªæé´åï¼å¨åµå°±æä¸»åºå¤æ­ä¸ºå®¢è§ä¸çº¿ï¼å¼å§ä¸»ä»åæ¢äºãä¸è¿ï¼è¿ä¸ªæ°æ®ééç¨åºå¾å¿«æ¢å¤æ­£å¸¸ï¼cpuçä½¿ç¨çä¹éä¸æ¥äºãæ­¤æ¶ï¼åä¸»åºåå¼å§æ­£å¸¸æå¡è¯·æ±äºã\n\næ­£å ä¸ºåä¸»åºå¹¶æ²¡æççåçæéï¼æä»¬å¨å®¢æ·ç«¯æä½æ¥å¿ä¸­å°±çå°äºååä¸»åºçéä¿¡è®°å½ãç­å°ä»åºè¢«åçº§ä¸ºæ°ä¸»åºåï¼ä¸»ä»éç¾¤éå°±æä¸¤ä¸ªä¸»åºäºï¼å°è¿éï¼æä»¬å°±æèè£åççåå æ¸æ¸æ¥äºã\n\nä¸ºäºå¸®å©ä½ å æ·±çè§£ï¼æåç»ä¸å¼ å¾ï¼å±ç¤ºä¸ä¸èè£çåçè¿ç¨ï¼\n\nå¼æ¸æ¥äºèè£åççåå åï¼æä»¬åç»åä¸»ä»åæ¢çåçè¿ç¨è¿è¡äºåæï¼å¾å¿«å°±æ¾å°æ°æ®ä¸¢å¤±çåå äºã\n\n\n# 2.2 ä¸ºä»ä¹èè£ä¼å¯¼è´æ°æ®ä¸¢å¤±ï¼\n\nä¸»ä»åæ¢åï¼ä»åºä¸æ¦åçº§ä¸ºæ°ä¸»åºï¼å¨åµå°±ä¼è®©åä¸»åºæ§è¡slave ofå½ä»¤ï¼åæ°ä¸»åºéæ°è¿è¡å¨éåæ­¥ãèå¨å¨éåæ­¥æ§è¡çæåé¶æ®µï¼åä¸»åºéè¦æ¸ç©ºæ¬å°çæ°æ®ï¼å è½½æ°ä¸»åºåéçrdbæä»¶ï¼è¿æ ·ä¸æ¥ï¼åä¸»åºå¨ä¸»ä»åæ¢æé´ä¿å­çæ°åæ°æ®å°±ä¸¢å¤±äºã\n\nä¸é¢è¿å¼ å¾ç´è§å°å±ç¤ºäºåä¸»åºæ°æ®ä¸¢å¤±çè¿ç¨ï¼\n\nå°è¿éï¼æä»¬å°±å®å¨å¼æç½äºè¿ä¸ªé®é¢çåçè¿ç¨ååå ã\n\nå¨ä¸»ä»åæ¢çè¿ç¨ä¸­ï¼å¦æåä¸»åºåªæ¯âåæéâï¼å®ä¼è§¦åå¨åµå¯å¨ä¸»ä»åæ¢ï¼ä¸æ¦ç­å®ä»åæéä¸­æ¢å¤åï¼åå¼å§å¤çè¯·æ±ï¼è¿æ ·ä¸æ¥ï¼å°±ä¼åæ°ä¸»åºåæ¶å­å¨ï¼å½¢æèè£ãç­å°å¨åµè®©åä¸»åºåæ°ä¸»åºåå¨éåæ­¥åï¼åä¸»åºå¨åæ¢æé´ä¿å­çæ°æ®å°±ä¸¢å¤±äºã\n\nçå°è¿éï¼ä½ è¯å®ä¼å¾å³å¿ï¼æä»¬è¯¥æä¹åºå¯¹èè£é æçæ°æ®ä¸¢å¤±é®é¢å¢ï¼\n\n\n# 2.3 å¦ä½åºå¯¹èè£é®é¢ï¼\n\nååè¯´äºï¼ä¸»ä»éç¾¤ä¸­çæ°æ®ä¸¢å¤±äºä»¶ï¼å½æ ¹ç»åºæ¯å ä¸ºåçäºèè£ãæä»¥ï¼æä»¬å¿é¡»è¦æ¾å°åºå¯¹èè£é®é¢çç­ç¥ã\n\næ¢ç¶é®é¢æ¯åºå¨åä¸»åºåçåæéåä»ç¶è½æ¥æ¶è¯·æ±ä¸ï¼æä»¬å°±å¼å§å¨ä¸»ä»éç¾¤æºå¶çéç½®é¡¹ä¸­æ¥æ¾æ¯å¦æéå¶ä¸»åºæ¥æ¶è¯·æ±çè®¾ç½®ã\n\néè¿æ¥æ¾ï¼æä»¬åç°ï¼redis å·²ç»æä¾äºä¸¤ä¸ªéç½®é¡¹æ¥éå¶ä¸»åºçè¯·æ±å¤çï¼åå«æ¯ min-slaves-to-write å min-slaves-max-lagï¼\n\n * min-slaves-to-writeï¼è¿ä¸ªéç½®é¡¹è®¾ç½®äºä¸»åºè½è¿è¡æ°æ®åæ­¥çæå°ä»åºæ°éï¼\n * min-slaves-max-lagï¼è¿ä¸ªéç½®é¡¹è®¾ç½®äºä¸»ä»åºé´è¿è¡æ°æ®å¤å¶æ¶ï¼ä»åºç»ä¸»åºåé ack æ¶æ¯çæå¤§å»¶è¿ï¼ä»¥ç§ä¸ºåä½ï¼ã\n\næäºè¿ä¸¤ä¸ªéç½®é¡¹åï¼æä»¬å°±å¯ä»¥è½»æ¾å°åºå¯¹èè£é®é¢äºãå·ä½ååå¢ï¼æä»¬å¯ä»¥æmin-slaves-to-writeåmin-slaves-max-lagè¿ä¸¤ä¸ªéç½®é¡¹æ­éèµ·æ¥ä½¿ç¨ï¼åå«ç»å®ä»¬è®¾ç½®ä¸å®çéå¼ï¼åè®¾ä¸ºnåtãè¿ä¸¤ä¸ªéç½®é¡¹ç»ååçè¦æ±æ¯ï¼ä¸»åºè¿æ¥çä»åºä¸­è³å°ænä¸ªä»åºï¼åä¸»åºè¿è¡æ°æ®å¤å¶æ¶çackæ¶æ¯å»¶è¿ä¸è½è¶è¿tç§ï¼å¦åï¼ä¸»åºå°±ä¸ä¼åæ¥æ¶å®¢æ·ç«¯çè¯·æ±äºã\n\nå³ä½¿åä¸»åºæ¯åæéï¼å®å¨åæéæé´ä¹æ æ³ååºå¨åµå¿è·³ï¼ä¹ä¸è½åä»åºè¿è¡åæ­¥ï¼èªç¶ä¹å°±æ æ³åä»åºè¿è¡ackç¡®è®¤äºãè¿æ ·ä¸æ¥ï¼min-slaves-to-writeåmin-slaves-max-lagçç»åè¦æ±å°±æ æ³å¾å°æ»¡è¶³ï¼åä¸»åºå°±ä¼è¢«éå¶æ¥æ¶å®¢æ·ç«¯è¯·æ±ï¼å®¢æ·ç«¯ä¹å°±ä¸è½å¨åä¸»åºä¸­åå¥æ°æ°æ®äºã\n\nç­å°æ°ä¸»åºä¸çº¿æ¶ï¼å°±åªææ°ä¸»åºè½æ¥æ¶åå¤çå®¢æ·ç«¯è¯·æ±ï¼æ­¤æ¶ï¼æ°åçæ°æ®ä¼è¢«ç´æ¥åå°æ°ä¸»åºä¸­ãèåä¸»åºä¼è¢«å¨åµéä¸ºä»åºï¼å³ä½¿å®çæ°æ®è¢«æ¸ç©ºäºï¼ä¹ä¸ä¼ææ°æ°æ®ä¸¢å¤±ã\n\næåæ¥ç»ä½ ä¸¾ä¸ªä¾å­ã\n\nåè®¾æä»¬å°min-slaves-to-writeè®¾ç½®ä¸º1ï¼æmin-slaves-max-lagè®¾ç½®ä¸º12sï¼æå¨åµçdown-after-millisecondsè®¾ç½®ä¸º10sï¼ä¸»åºå ä¸ºæäºåå å¡ä½äº15sï¼å¯¼è´å¨åµå¤æ­ä¸»åºå®¢è§ä¸çº¿ï¼å¼å§è¿è¡ä¸»ä»åæ¢ãåæ¶ï¼å ä¸ºåä¸»åºå¡ä½äº15sï¼æ²¡æä¸ä¸ªä»åºè½ååä¸»åºå¨12såè¿è¡æ°æ®å¤å¶ï¼åä¸»åºä¹æ æ³æ¥æ¶å®¢æ·ç«¯è¯·æ±äºãè¿æ ·ä¸æ¥ï¼ä¸»ä»åæ¢å®æåï¼ä¹åªææ°ä¸»åºè½æ¥æ¶è¯·æ±ï¼ä¸ä¼åçèè£ï¼ä¹å°±ä¸ä¼åçæ°æ®ä¸¢å¤±çé®é¢äºã\n\n\n# 2.4 å°ç»\n\nè¿èè¯¾ï¼æä»¬å­¦ä¹ äºä¸»ä»åæ¢æ¶å¯è½éå°çèè£é®é¢ãèè£æ¯æå¨ä¸»ä»éç¾¤ä¸­ï¼åæ¶æä¸¤ä¸ªä¸»åºé½è½æ¥æ¶åè¯·æ±ãå¨redisçä¸»ä»åæ¢è¿ç¨ä¸­ï¼å¦æåçäºèè£ï¼å®¢æ·ç«¯æ°æ®å°±ä¼åå¥å°åä¸»åºï¼å¦æåä¸»åºè¢«éä¸ºä»åºï¼è¿äºæ°åå¥çæ°æ®å°±ä¸¢å¤±äºã\n\nèè£åççåå ä¸»è¦æ¯åä¸»åºåçäºåæéï¼æä»¬æ¥æ»ç»ä¸åæéçä¸¤ä¸ªåå ã\n\n 1. åä¸»åºé¨ç½²å¨åä¸å°æå¡å¨ä¸çå¶ä»ç¨åºä¸´æ¶å ç¨äºå¤§éèµæºï¼ä¾å¦cpuèµæºï¼ï¼å¯¼è´ä¸»åºèµæºä½¿ç¨åéï¼ç­æ¶é´åæ æ³ååºå¿è·³ãå¶å®ç¨åºä¸åä½¿ç¨èµæºæ¶ï¼ä¸»åºåæ¢å¤æ­£å¸¸ã\n 2. ä¸»åºèªèº«éå°äºé»å¡çæåµï¼ä¾å¦ï¼å¤çbigkeyææ¯åçåå­swapï¼ç­æ¶é´åæ æ³ååºå¿è·³ï¼ç­ä¸»åºé»å¡è§£é¤åï¼åæ¢å¤æ­£å¸¸çè¯·æ±å¤çäºã\n\nä¸ºäºåºå¯¹èè£ï¼ä½ å¯ä»¥å¨ä¸»ä»éç¾¤é¨ç½²æ¶ï¼éè¿åçå°éç½®åæ°min-slaves-to-writeåmin-slaves-max-lagï¼æ¥é¢é²èè£çåçã\n\nå¨å®éåºç¨ä¸­ï¼å¯è½ä¼å ä¸ºç½ç»ææ¶æ¥å¡å¯¼è´ä»åºææ¶åä¸»åºçackæ¶æ¯è¶æ¶ãå¨è¿ç§æåµä¸ï¼å¹¶ä¸æ¯ä¸»åºåæéï¼æä»¬ä¹ä¸ç¨ç¦æ­¢ä¸»åºæ¥æ¶è¯·æ±ã\n\næä»¥ï¼æç»ä½ çå»ºè®®æ¯ï¼åè®¾ä»åºækä¸ªï¼å¯ä»¥å°min-slaves-to-writeè®¾ç½®ä¸ºk/2+1ï¼å¦ækç­äº1ï¼å°±è®¾ä¸º1ï¼ï¼å°min-slaves-max-lagè®¾ç½®ä¸ºåå ç§ï¼ä¾å¦10ï½20sï¼ï¼å¨è¿ä¸ªéç½®ä¸ï¼å¦ææä¸åä»¥ä¸çä»åºåä¸»åºè¿è¡çackæ¶æ¯å»¶è¿è¶è¿åå ç§ï¼æä»¬å°±ç¦æ­¢ä¸»åºæ¥æ¶å®¢æ·ç«¯åè¯·æ±ã\n\nè¿æ ·ä¸æ¥ï¼æä»¬å¯ä»¥é¿åèè£å¸¦æ¥æ°æ®ä¸¢å¤±çæåµï¼èä¸ï¼ä¹ä¸ä¼å ä¸ºåªæå°æ°å ä¸ªä»åºå ä¸ºç½ç»é»å¡è¿ä¸ä¸ä¸»åºï¼å°±ç¦æ­¢ä¸»åºæ¥æ¶è¯·æ±ï¼å¢å äºç³»ç»çé²æ£æ§ã",charsets:{cjk:!0},lastUpdated:"2023/04/19, 03:43:04",lastUpdatedTimestamp:1681875784e3},{title:"ç§æåºæ¯ä¸çåºç¨",frontmatter:{title:"ç§æåºæ¯ä¸çåºç¨",date:"2023-04-21T16:39:06.000Z",permalink:"/pages/b6efd0/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/36.%E7%A7%92%E6%9D%80%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/36.ç§æåºæ¯ä¸çåºç¨.md",key:"v-c6d294b8",path:"/pages/b6efd0/",headers:[{level:2,title:"1. Redis æ¯æç§æåºæ¯çå³é®ææ¯åå®è·µé½æåªäºï¼",slug:"_1-redis-æ¯æç§æåºæ¯çå³é®ææ¯åå®è·µé½æåªäº",normalizedTitle:"1. redis æ¯æç§æåºæ¯çå³é®ææ¯åå®è·µé½æåªäºï¼",charIndex:53},{level:3,title:"1.1 ç§æåºæ¯çè´è½½ç¹å¾å¯¹æ¯æç³»ç»çè¦æ±",slug:"_1-1-ç§æåºæ¯çè´è½½ç¹å¾å¯¹æ¯æç³»ç»çè¦æ±",normalizedTitle:"1.1 ç§æåºæ¯çè´è½½ç¹å¾å¯¹æ¯æç³»ç»çè¦æ±",charIndex:252},{level:3,title:"1.2 Redis å¯ä»¥å¨ç§æåºæ¯çåªäºç¯èåæ¥ä½ç¨ï¼",slug:"_1-2-redis-å¯ä»¥å¨ç§æåºæ¯çåªäºç¯èåæ¥ä½ç¨",normalizedTitle:"1.2 redis å¯ä»¥å¨ç§æåºæ¯çåªäºç¯èåæ¥ä½ç¨ï¼",charIndex:606},{level:4,title:"1.2.1 ç¬¬ä¸é¶æ®µï¼ç§ææ´»å¨å",slug:"_1-2-1-ç¬¬ä¸é¶æ®µ-ç§ææ´»å¨å",normalizedTitle:"1.2.1 ç¬¬ä¸é¶æ®µï¼ç§ææ´»å¨å",charIndex:680},{level:4,title:"1.2.2 ç¬¬äºé¶æ®µï¼ç§æå¼å§",slug:"_1-2-2-ç¬¬äºé¶æ®µ-ç§æå¼å§",normalizedTitle:"1.2.2 ç¬¬äºé¶æ®µï¼ç§æå¼å§",charIndex:838},{level:4,title:"1.2.3 ç¬¬ä¸é¶æ®µï¼ç§ææ´»å¨ç»æå",slug:"_1-2-3-ç¬¬ä¸é¶æ®µ-ç§ææ´»å¨ç»æå",normalizedTitle:"1.2.3 ç¬¬ä¸é¶æ®µï¼ç§ææ´»å¨ç»æå",charIndex:1686},{level:3,title:"1.3 Redis çåªäºæ¹æ³å¯ä»¥æ¯æç§æåºæ¯ï¼",slug:"_1-3-redis-çåªäºæ¹æ³å¯ä»¥æ¯æç§æåºæ¯",normalizedTitle:"1.3 redis çåªäºæ¹æ³å¯ä»¥æ¯æç§æåºæ¯ï¼",charIndex:2017},{level:4,title:"1.3.1 åºäºåå­æä½æ¯æç§æåºæ¯",slug:"_1-3-1-åºäºåå­æä½æ¯æç§æåºæ¯",normalizedTitle:"1.3.1 åºäºåå­æä½æ¯æç§æåºæ¯",charIndex:2193},{level:4,title:"1.3.2 åºäºåå¸å¼éæ¥æ¯æç§æåºæ¯",slug:"_1-3-2-åºäºåå¸å¼éæ¥æ¯æç§æåºæ¯",normalizedTitle:"1.3.2 åºäºåå¸å¼éæ¥æ¯æç§æåºæ¯",charIndex:3010},{level:3,title:"1.4 å°ç»",slug:"_1-4-å°ç»",normalizedTitle:"1.4 å°ç»",charIndex:3908}],headersStr:"1. Redis æ¯æç§æåºæ¯çå³é®ææ¯åå®è·µé½æåªäºï¼ 1.1 ç§æåºæ¯çè´è½½ç¹å¾å¯¹æ¯æç³»ç»çè¦æ± 1.2 Redis å¯ä»¥å¨ç§æåºæ¯çåªäºç¯èåæ¥ä½ç¨ï¼ 1.2.1 ç¬¬ä¸é¶æ®µï¼ç§ææ´»å¨å 1.2.2 ç¬¬äºé¶æ®µï¼ç§æå¼å§ 1.2.3 ç¬¬ä¸é¶æ®µï¼ç§ææ´»å¨ç»æå 1.3 Redis çåªäºæ¹æ³å¯ä»¥æ¯æç§æåºæ¯ï¼ 1.3.1 åºäºåå­æä½æ¯æç§æåºæ¯ 1.3.2 åºäºåå¸å¼éæ¥æ¯æç§æåºæ¯ 1.4 å°ç»",content:'> åèï¼\n> \n>  * 36 Redis æ¯æç§æåºæ¯çå³é®ææ¯åå®è·µé½æåªäºï¼| æå®¢æ¶é´\n\n\n# 1. Redis æ¯æç§æåºæ¯çå³é®ææ¯åå®è·µé½æåªäºï¼\n\nç§ææ¯ä¸ä¸ªéå¸¸å¸åçæ´»å¨åºæ¯ï¼ä¸å¡ç¹ç¹æ¯éæ¶ééï¼ä¸å¡ç³»ç»è¦å¤çç¬æ¶çå¤§éé«å¹¶åè¯·æ±ï¼èRediså°±ç»å¸¸è¢«ç¨æ¥æ¯æç§ææ´»å¨ã\n\nä¸è¿ï¼ç§æåºæ¯åå«äºå¤ä¸ªç¯èï¼å¯ä»¥åæç§æåãç§æä¸­åç§æåä¸ä¸ªé¶æ®µï¼æ¯ä¸ªé¶æ®µçè¯·æ±å¤çéæ±å¹¶ä¸ç¸åï¼Redis å¹¶ä¸è½æ¯æç§æåºæ¯çæ¯ä¸ä¸ªç¯èãè¿ä¸èå¤§å°çä¸ä¸ Redis å¦ä½åºç¨å°ç§æçåºæ¯ä¸­ã\n\n\n# 1.1 ç§æåºæ¯çè´è½½ç¹å¾å¯¹æ¯æç³»ç»çè¦æ±\n\nç§ææ´»å¨çç¹ç¹ï¼åååºå­éå´è¿è¿å°äºè´­ä¹°è¯¥ååçç¨æ·æ°ï¼èä¸ä¼éå®ç¨æ·åªè½å¨ä¸å®çæ¶é´æ®µåè´­ä¹°ã\n\nç§æç³»ç»æä¸¤ä¸ªææ¾çè´è½½ç¹å¾ï¼\n\n 1. ç¬æ¶å¹¶åè®¿é®ééå¸¸é«ãä¸è¬æ°æ®åºæ¯ç§åªè½æ¯æåçº§å«çå¹¶åè¯·æ±ï¼èRedisçå¹¶åå¤çè½åï¼æ¯ç§å¤çè¯·æ±æ°ï¼è½è¾¾å°ä¸çº§å«ï¼çè³æ´é«ãæä»¥ï¼å½æå¤§éå¹¶åè¯·æ±æ¶å¥ç§æç³»ç»æ¶ï¼æä»¬å°±éè¦ä½¿ç¨Redisåæ¦æªå¤§é¨åè¯·æ±ï¼é¿åå¤§éè¯·æ±ç´æ¥åéç»æ°æ®åºï¼ææ°æ®åºåå®ã\n 2. è¯»å¤åå°ï¼èä¸è¯»æä½æ¯ç®åçæ¥è¯¢æä½ãåååºå­æ¥è¯¢æä½ï¼è¯»æä½ï¼è¦å¤äºåºå­æ£ååä¸åæä½ï¼åæä½ï¼ã\n\næ¥éªåºå­æ¯å®éç§æåºæ¯ä¸­çå¶ä¸­ä¸ä¸ªç¯èãRedis å·ä½å¯ä»¥å¨æ´ä¸ªç§æåºæ¯ä¸­åªäºç¯èåæ¥ä½ç¨å¢ï¼è¿å°±è¦è¯´å°ç§ææ´»å¨çæ´ä½æµç¨äºï¼æä»¬æ¥åæä¸ã\n\n\n# 1.2 Redis å¯ä»¥å¨ç§æåºæ¯çåªäºç¯èåæ¥ä½ç¨ï¼\n\næä»¬ä¸è¬å¯ä»¥æç§ææ´»å¨åæä¸ä¸ªé¶æ®µãå¨æ¯ä¸ä¸ªé¶æ®µï¼Redisæåæ¥çä½ç¨ä¹ä¸ä¸æ ·ã\n\n# 1.2.1 ç¬¬ä¸é¶æ®µï¼ç§ææ´»å¨å\n\nå¨è¿ä¸ªé¶æ®µï¼ç¨æ·ä¼ä¸æ­å·æ°ååè¯¦æé¡µï¼è¿ä¼å¯¼è´è¯¦æé¡µçç¬æ¶è¯·æ±éå§å¢ãè¿ä¸ªé¶æ®µçåºå¯¹æ¹æ¡ï¼ä¸è¬æ¯å°½é æååè¯¦æé¡µçé¡µé¢åç´ éæåï¼ç¶åä½¿ç¨CDNææ¯æµè§å¨æè¿äºéæåçåç´ ç¼å­èµ·æ¥ãè¿ä¸ªé¶æ®µå¾å¾ä½¿ç¨ CDN + æµè§å¨æååè¯¦æé¡µç¼å­ä¸æ¥å°±è¶³å¤äºï¼è¿ä¸éè¦ Redisã\n\n# 1.2.2 ç¬¬äºé¶æ®µï¼ç§æå¼å§\n\næ­¤æ¶ï¼å¤§éç¨æ·ç¹å»ååè¯¦æé¡µä¸çç§ææé®ï¼ä¼äº§çå¤§éçå¹¶åè¯·æ±æ¥è¯¢åºå­ãä¸æ¦æä¸ªè¯·æ±æ¥è¯¢å°æåºå­ï¼ç´§æ¥çç³»ç»å°±ä¼è¿è¡åºå­æ£åãç¶åï¼ç³»ç»ä¼çæå®éè®¢åï¼å¹¶è¿è¡åç»­å¤çï¼ä¾å¦è®¢åæ¯ä»åç©æµæå¡ãå¦æè¯·æ±æ¥ä¸å°åºå­ï¼å°±ä¼è¿åãç¨æ·éå¸¸ä¼ç»§ç»­ç¹å»ç§ææé®ï¼ç»§ç»­æ¥è¯¢åºå­ã\n\nç®åæ¥è¯´ï¼è¿ä¸ªé¶æ®µçæä½å°±æ¯ä¸ä¸ªï¼åºå­æ¥éªãåºå­æ£ååè®¢åå¤çãå ä¸ºæ¯ä¸ªç§æè¯·æ±é½ä¼æ¥è¯¢åºå­ï¼èè¯·æ±åªææ¥å°æåºå­ä½éåï¼åç»­çåºå­æ£ååè®¢åå¤çæä¼è¢«æ§è¡ãæä»¥ï¼è¿ä¸ªé¶æ®µä¸­æå¤§çå¹¶åååé½å¨åºå­æ¥éªæä½ä¸ãä¸ºäºæ¯æå¤§éé«å¹¶åçåºå­æ¥éªè¯·æ±ï¼æä»¬éè¦å¨è¿ä¸ªç¯èä½¿ç¨ Redis ä¿å­åºå­éï¼è¿æ ·ä¸æ¥ï¼è¯·æ±å¯ä»¥ç´æ¥ä»Redisä¸­è¯»ååºå­å¹¶è¿è¡æ¥éªã\n\né£ä¹ï¼åºå­æ£ååè®¢åå¤çæ¯å¦é½å¯ä»¥äº¤ç»åç«¯çæ°æ®åºæ¥æ§è¡å¢?\n\n * è®¢åå¤çå¯ä»¥äº¤ç»æ°æ®åºæ§è¡ãå ä¸ºè®¢åå¤çå¾å¾æ¶åæ¯ä»ãåºåºç­å¤ä¸ªå³èæä½ï¼éè¦ä½¿ç¨æ°æ®åºçäºå¡ãèä¸è®¢åå¤çæ¶è¯·æ±ååå·²ç»ä¸å¤§äºï¼æ°æ®åºå¯ä»¥æ¯æè¿äºè¯·æ±ã\n * åºå­æ£åä¸è½äº¤ç»æ°æ®åºæ§è¡ï¼èæ¯ç´æ¥å¨ Redis ä¸­æ§è¡ãå ä¸ºä¸æ¦ç¨æ·æ¥è¯¢å°æåºå­å°±ä¼ä¸åï¼é£ä¹å°±ä¼åèµ·è´­ä¹°çè¯·æ±ï¼å¦ææåºå­æ£åçæä½æ¾å°æ°æ®åºæ¥æ§è¡ï¼å°±ä¼å¸¦æ¥ä¸¤ä¸ªé®é¢ï¼\n   1. é¢å¤çå¼éãRedis ä¸­ä¿å­äºåºå­éï¼èåºå­éçææ°å¼åæ¯æ°æ®åºå¨ç»´æ¤ï¼æä»¥æ°æ®åºæ´æ°åï¼è¿éè¦åRedisè¿è¡åæ­¥ï¼è¿ä¸ªè¿ç¨å¢å äºé¢å¤çæä½é»è¾ï¼ä¹å¸¦æ¥äºé¢å¤çå¼éã\n   2. ä¸åéè¶è¿å®éåºå­éï¼åºç°è¶å®ãç±äºæ°æ®åºçå¤çéåº¦è¾æ¢ï¼ä¸è½åæ¶æ´æ°åºå­ä½éï¼è¿å°±ä¼å¯¼è´å¤§éåºå­æ¥éªçè¯·æ±è¯»åå°æ§çåºå­å¼ï¼å¹¶è¿è¡ä¸åãæ­¤æ¶ï¼å°±ä¼åºç°ä¸åæ°éå¤§äºå®éçåºå­éï¼å¯¼è´åºç°è¶å®ï¼è¿å°±ä¸ç¬¦åä¸å¡å±çè¦æ±äºã\n\næä»¥ï¼æä»¬å°±éè¦ç´æ¥å¨Redisä¸­è¿è¡åºå­æ£åãå·ä½çæä½æ¯ï¼å½åºå­æ¥éªå®æåï¼ä¸æ¦åºå­æä½éï¼æä»¬å°±ç«å³å¨Redisä¸­æ£ååºå­ãèä¸ï¼ä¸ºäºé¿åè¯·æ±æ¥è¯¢å°æ§çåºå­å¼ï¼åºå­æ¥éªååºå­æ£åè¿ä¸¤ä¸ªæä½éè¦ä¿è¯åå­æ§ã\n\n# 1.2.3 ç¬¬ä¸é¶æ®µï¼ç§ææ´»å¨ç»æå\n\nå¨è¿ä¸ªé¶æ®µï¼å¯è½è¿ä¼æé¨åç¨æ·å·æ°ååè¯¦æé¡µï¼å°è¯ç­å¾æå¶ä»ç¨æ·éåãèå·²ç»æåä¸åçç¨æ·ä¼å·æ°è®¢åè¯¦æï¼è·è¸ªè®¢åçè¿å±ãä¸è¿ï¼è¿ä¸ªé¶æ®µä¸­çç¨æ·è¯·æ±éå·²ç»ä¸éå¾å¤äºï¼æå¡å¨ç«¯ä¸è¬é½è½æ¯æï¼æä»¬å°±ä¸éç¹è®¨è®ºäºã\n\nè¿éæ»ç»ä¸ç§æåºæ¯å¯¹ Redis çéæ±ï¼ç§æåºæ¯åæç§æåãç§æä¸­åç§æåä¸ä¸ªé¶æ®µãç§æå¼å§ååï¼é«å¹¶åååæ²¡æé£ä¹å¤§ï¼æä»¬ä¸éè¦ä½¿ç¨Redisï¼ä½å¨ç§æè¿è¡ä¸­ï¼éè¦æ¥éªåæ£ååååºå­ï¼åºå­æ¥éªé¢ä¸´å¤§éçé«å¹¶åè¯·æ±ï¼èåºå­æ£ååéè¦ååºå­æ¥éªä¸èµ·æ§è¡ï¼ä»¥ä¿è¯åå­æ§ãè¿å°±æ¯ç§æå¯¹Redisçéæ±ã\n\nä¸å¾å±ç¤ºäºç§æåºæ¯éè¦ Redis åä¸çä¸¤ä¸ªç¯èï¼\n\nä¸é¢ä»ç» Redis æ¯æç§æåºæ¯çæ¹æ³ã\n\n\n# 1.3 Redis çåªäºæ¹æ³å¯ä»¥æ¯æç§æåºæ¯ï¼\n\nç§æåºæ¯å¯¹ Redis æä½çæ ¹æ¬è¦æ±æä¸¤ä¸ªï¼\n\n 1. æ¯æé«å¹¶åãRedis æ¬èº«æ¯æé«å¹¶åï¼ä½æ³¨æå¦ææå¤ä¸ªç§æååï¼æä»¬å¯ä»¥ä½¿ç¨åçéç¾¤æ¥å°åååæ£å¼ã\n 2. ä¿è¯åºå­æ¥éªååºå­æ£ååå­æ§æ§è¡ãéå¯¹è¿æ¡è¦æ±ï¼æä»¬å°±å¯ä»¥ä½¿ç¨ Redis çåå­æä½ææ¯åå¸å¼éè¿ä¸¤ä¸ªåè½ç¹æ§æ¥æ¯æäºã\n\n# 1.3.1 åºäºåå­æä½æ¯æç§æåºæ¯\n\nå¨ç§æåºæ¯ä¸­ï¼ä¸ä¸ªååçåºå­å¯¹åºäºä¸¤ä¸ªä¿¡æ¯ï¼åå«æ¯æ»åºå­éåå·²ç§æéãè¿ç§æ°æ®æ¨¡åæ­£å¥½æ¯ä¸ä¸ªkeyï¼ååIDï¼å¯¹åºäºä¸¤ä¸ªå±æ§ï¼æ»åºå­éåå·²ç§æéï¼ï¼æä»¥ï¼æä»¬å¯ä»¥ä½¿ç¨ä¸ä¸ªHashç±»åçé®å¼å¯¹æ¥ä¿å­åºå­çè¿ä¸¤ä¸ªä¿¡æ¯ï¼å¦ä¸æç¤ºï¼\n\nkey: itemID\nvalue: {total: N, ordered: M}\n\n\n1\n2\n\n * å¶ä¸­ï¼itemIDæ¯ååçç¼å·ï¼totalæ¯æ»åºå­éï¼orderedæ¯å·²ç§æéã\n\nå ä¸ºåºå­æ¥éªååºå­æ£åè¿ä¸¤ä¸ªæä½è¦ä¿è¯ä¸èµ·æ§è¡ï¼ä¸ä¸ªç´æ¥çæ¹æ³å°±æ¯ä½¿ç¨Redisçåå­æä½ãåå­æä½å¯ä»¥æ¯ Redis èªèº«æä¾çåå­å½ä»¤ï¼ä¹å¯ä»¥æ¯ Lua èæ¬ãç±äºè¿éé»è¾è¾ä¸ºå¤æï¼å æ­¤éç¨ Lua èæ¬æ¥åå­æ§å°æ§è¡è¿ä¸¤ä¸ªæä½ï¼\n\n# è·ååååºå­ä¿¡æ¯\nlocal counts = redis.call("HMGET", KEYS[1], "total", "ordered");\n# å°æ»åºå­è½¬æ¢ä¸ºæ°å¼\nlocal total = tonumber(counts[1])\n# å°å·²è¢«ç§æçåºå­è½¬æ¢ä¸ºæ°å¼\nlocal ordered = tonumber(counts[2])\n# å¦æå½åè¯·æ±çåºå­éå ä¸å·²è¢«ç§æçåºå­éä»ç¶å°äºæ»åºå­éï¼å°±å¯ä»¥æ´æ°åºå­\nif ordered + k <= total then\n    # æ´æ°å·²ç§æçåºå­é\n    redis.call("HINCRBY",KEYS[1],"ordered",k)\n    return k;\nend\nreturn 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næäº Lua èæ¬åï¼æä»¬å°±å¯ä»¥å¨ Redis å®¢æ·ç«¯ï¼ä½¿ç¨ EVAL å½ä»¤æ¥æ§è¡è¿ä¸ªèæ¬äºãæåï¼å®¢æ·ç«¯ä¼æ ¹æ®èæ¬çè¿åå¼ï¼æ¥ç¡®å®ç§ææ¯æåè¿æ¯å¤±è´¥äºãå¦æè¿åå¼æ¯kï¼å°±æ¯æåäºï¼å¦ææ¯0ï¼å°±æ¯å¤±è´¥ã\n\n# 1.3.2 åºäºåå¸å¼éæ¥æ¯æç§æåºæ¯\n\nä½¿ç¨åå¸å¼éæ¥æ¯æç§æåºæ¯çå·ä½åæ³æ¯ï¼åè®©å®¢æ·ç«¯å Redis ç³è¯·åå¸å¼éï¼åªææ¿å°éçå®¢æ·ç«¯æè½æ§è¡åºå­æ¥éªååºå­æ£åãè¿æ ·ä¸æ¥ï¼å¤§éçç§æè¯·æ±å°±ä¼å¨äºå¤ºåå¸å¼éæ¶è¢«è¿æ»¤æãèä¸ï¼åºå­æ¥éªåæ£åä¹ä¸ç¨ä½¿ç¨åå­æä½äºï¼å ä¸ºå¤ä¸ªå¹¶åå®¢æ·ç«¯åªæä¸ä¸ªå®¢æ·ç«¯è½å¤æ¿å°éï¼å·²ç»ä¿è¯äºå®¢æ·ç«¯å¹¶åè®¿é®çäºæ¥æ§ã\n\nä¸é¢çä¼ªä»£ç æ¾ç¤ºäºä½¿ç¨åå¸å¼éæ¥æ§è¡åºå­æ¥éªåæ£åçè¿ç¨ï¼\n\n# ä½¿ç¨ååIDä½ä¸ºkey\nkey = itemID\n# ä½¿ç¨å®¢æ·ç«¯å¯ä¸æ è¯ä½ä¸ºvalue\nval = clientUniqueID\n# ç³è¯·åå¸å¼éï¼Timeoutæ¯è¶æ¶æ¶é´\nlock =acquireLock(key, val, Timeout)\n# å½æ¿å°éåï¼æè½è¿è¡åºå­æ¥éªåæ£å\nif (lock == True) {\n   # åºå­æ¥éªåæ£å\n   availStock = DECR(key, k)\n   # åºå­å·²ç»æ£åå®äºï¼éæ¾éï¼è¿åç§æå¤±è´¥\n   if (availStock < 0) {\n      releaseLock(key, val)\n      return error\n   }\n   # åºå­æ£åæåï¼éæ¾é\n   else{\n     releaseLock(key, val)\n     # è®¢åå¤ç\n   }\n}\n# æ²¡ææ¿å°éï¼ç´æ¥è¿å\nelse\n   return\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\néè¦æéä½ çæ¯ï¼å¨ä½¿ç¨åå¸å¼éæ¶ï¼å®¢æ·ç«¯éè¦åå Redis è¯·æ±éï¼åªæè¯·æ±å°äºéï¼æè½è¿è¡åºå­æ¥éªç­æä½ï¼è¿æ ·ä¸æ¥ï¼å®¢æ·ç«¯å¨äºæ¢åå¸å¼éæ¶ï¼å¤§é¨åç§æè¯·æ±æ¬èº«å°±ä¼å ä¸ºæ¢ä¸å°éèè¢«æ¦æªãæä»¥è¿éæä¸ä¸ªå°å»ºè®®ï¼æä»¬å¯ä»¥ä½¿ç¨åçéç¾¤ä¸­çä¸åå®ä¾æ¥åå«ä¿å­åå¸å¼éååååºå­ä¿¡æ¯ãä½¿ç¨è¿ç§ä¿å­æ¹å¼åï¼ç§æè¯·æ±ä¼é¦åè®¿é®ä¿å­åå¸å¼éçå®ä¾ãå¦æå®¢æ·ç«¯æ²¡ææ¿å°éï¼è¿äºå®¢æ·ç«¯å°±ä¸ä¼æ¥è¯¢åååºå­ï¼è¿å°±å¯ä»¥åè½»ä¿å­åºå­ä¿¡æ¯çå®ä¾çååäºã\n\n\n# 1.4 å°ç»\n\nè¿èè¯¾ï¼æä»¬å­¦ä¹ äºRediså¨ç§æåºæ¯ä¸­çå·ä½åºç¨ãç§æåºæ¯æ2ä¸ªè´è½½ç¹å¾ï¼åå«æ¯ç¬æ¶é«å¹¶åè¯·æ±åè¯»å¤åå°ãRedis è¯å¥½çé«å¹¶åå¤çè½åï¼ä»¥åé«æçé®å¼å¯¹è¯»åç¹æ§ï¼æ­£å¥½å¯ä»¥æ»¡è¶³ç§æåºæ¯çéæ±ãæä»¬éè¿ä½¿ç¨ Redis çåå­æä½ååå¸å¼éä¸¤ä¸ªåè½ç¹æ§ææå°æ¯æç§æåºæ¯çéæ±ã\n\nå½ç¶ï¼å¯¹äºç§æåºæ¯æ¥è¯´ï¼åªç¨ Redis æ¯ä¸å¤çãç§æç³»ç»æ¯ä¸ä¸ªç³»ç»æ§å·¥ç¨ï¼Redis å®ç°äºå¯¹åºå­æ¥éªåæ£åè¿ä¸ªç¯èçæ¯æï¼é¤æ­¤ä¹å¤ï¼è¿æ 4 ä¸ªç¯èéè¦æä»¬å¤çå¥½ï¼\n\n 1. åç«¯éæé¡µé¢çè®¾è®¡ãç§æé¡µé¢ä¸è½éæåå¤ççé¡µé¢åç´ ï¼æä»¬é½è¦å°½ééæåï¼è¿æ ·å¯ä»¥ååå©ç¨CDNææµè§å¨ç¼å­æå¡ç§æå¼å§åçè¯·æ±ã\n 2. è¯·æ±æ¦æªåæµæ§ãå¨ç§æç³»ç»çæ¥å¥å±ï¼å¯¹æ¶æè¯·æ±è¿è¡æ¦æªï¼é¿åå¯¹ç³»ç»çæ¶ææ»å»ï¼ä¾å¦ä½¿ç¨é»ååç¦æ­¢æ¶æIPè¿è¡è®¿é®ãå¦æRediså®ä¾çè®¿é®ååè¿å¤§ï¼ä¸ºäºé¿åå®ä¾å´©æºï¼æä»¬ä¹éè¦å¨æ¥å¥å±è¿è¡éæµï¼æ§å¶è¿å¥ç§æç³»ç»çè¯·æ±æ°éã\n 3. åºå­ä¿¡æ¯è¿ææ¶é´å¤çãRedisä¸­ä¿å­çåºå­ä¿¡æ¯å¶å®æ¯æ°æ®åºçç¼å­ï¼ä¸ºäºé¿åç¼å­å»ç©¿é®é¢ï¼æä»¬ä¸è¦ç»åºå­ä¿¡æ¯è®¾ç½®è¿ææ¶é´ã\n 4. æ°æ®åºè®¢åå¼å¸¸å¤çãå¦ææ°æ®åºæ²¡è½æåå¤çè®¢åï¼å¯ä»¥å¢å è®¢åéè¯åè½ï¼ä¿è¯è®¢åæç»è½è¢«æåå¤çã\n\næåï¼æä¹åç»ä½ ä¸ä¸ªå°å»ºè®®ï¼ç§ææ´»å¨å¸¦æ¥çè¯·æ±æµéå·¨å¤§ï¼æä»¬éè¦æç§æååçåºå­ä¿¡æ¯ç¨åç¬çå®ä¾ä¿å­ï¼èä¸è¦åæ¥å¸¸ä¸å¡ç³»ç»çæ°æ®ä¿å­å¨åä¸ä¸ªå®ä¾ä¸ï¼è¿æ ·å¯ä»¥é¿åå¹²æ°ä¸å¡ç³»ç»çæ­£å¸¸è¿è¡ã',normalizedContent:'> åèï¼\n> \n>  * 36 redis æ¯æç§æåºæ¯çå³é®ææ¯åå®è·µé½æåªäºï¼| æå®¢æ¶é´\n\n\n# 1. redis æ¯æç§æåºæ¯çå³é®ææ¯åå®è·µé½æåªäºï¼\n\nç§ææ¯ä¸ä¸ªéå¸¸å¸åçæ´»å¨åºæ¯ï¼ä¸å¡ç¹ç¹æ¯éæ¶ééï¼ä¸å¡ç³»ç»è¦å¤çç¬æ¶çå¤§éé«å¹¶åè¯·æ±ï¼èrediså°±ç»å¸¸è¢«ç¨æ¥æ¯æç§ææ´»å¨ã\n\nä¸è¿ï¼ç§æåºæ¯åå«äºå¤ä¸ªç¯èï¼å¯ä»¥åæç§æåãç§æä¸­åç§æåä¸ä¸ªé¶æ®µï¼æ¯ä¸ªé¶æ®µçè¯·æ±å¤çéæ±å¹¶ä¸ç¸åï¼redis å¹¶ä¸è½æ¯æç§æåºæ¯çæ¯ä¸ä¸ªç¯èãè¿ä¸èå¤§å°çä¸ä¸ redis å¦ä½åºç¨å°ç§æçåºæ¯ä¸­ã\n\n\n# 1.1 ç§æåºæ¯çè´è½½ç¹å¾å¯¹æ¯æç³»ç»çè¦æ±\n\nç§ææ´»å¨çç¹ç¹ï¼åååºå­éå´è¿è¿å°äºè´­ä¹°è¯¥ååçç¨æ·æ°ï¼èä¸ä¼éå®ç¨æ·åªè½å¨ä¸å®çæ¶é´æ®µåè´­ä¹°ã\n\nç§æç³»ç»æä¸¤ä¸ªææ¾çè´è½½ç¹å¾ï¼\n\n 1. ç¬æ¶å¹¶åè®¿é®ééå¸¸é«ãä¸è¬æ°æ®åºæ¯ç§åªè½æ¯æåçº§å«çå¹¶åè¯·æ±ï¼èredisçå¹¶åå¤çè½åï¼æ¯ç§å¤çè¯·æ±æ°ï¼è½è¾¾å°ä¸çº§å«ï¼çè³æ´é«ãæä»¥ï¼å½æå¤§éå¹¶åè¯·æ±æ¶å¥ç§æç³»ç»æ¶ï¼æä»¬å°±éè¦ä½¿ç¨redisåæ¦æªå¤§é¨åè¯·æ±ï¼é¿åå¤§éè¯·æ±ç´æ¥åéç»æ°æ®åºï¼ææ°æ®åºåå®ã\n 2. è¯»å¤åå°ï¼èä¸è¯»æä½æ¯ç®åçæ¥è¯¢æä½ãåååºå­æ¥è¯¢æä½ï¼è¯»æä½ï¼è¦å¤äºåºå­æ£ååä¸åæä½ï¼åæä½ï¼ã\n\næ¥éªåºå­æ¯å®éç§æåºæ¯ä¸­çå¶ä¸­ä¸ä¸ªç¯èãredis å·ä½å¯ä»¥å¨æ´ä¸ªç§æåºæ¯ä¸­åªäºç¯èåæ¥ä½ç¨å¢ï¼è¿å°±è¦è¯´å°ç§ææ´»å¨çæ´ä½æµç¨äºï¼æä»¬æ¥åæä¸ã\n\n\n# 1.2 redis å¯ä»¥å¨ç§æåºæ¯çåªäºç¯èåæ¥ä½ç¨ï¼\n\næä»¬ä¸è¬å¯ä»¥æç§ææ´»å¨åæä¸ä¸ªé¶æ®µãå¨æ¯ä¸ä¸ªé¶æ®µï¼redisæåæ¥çä½ç¨ä¹ä¸ä¸æ ·ã\n\n# 1.2.1 ç¬¬ä¸é¶æ®µï¼ç§ææ´»å¨å\n\nå¨è¿ä¸ªé¶æ®µï¼ç¨æ·ä¼ä¸æ­å·æ°ååè¯¦æé¡µï¼è¿ä¼å¯¼è´è¯¦æé¡µçç¬æ¶è¯·æ±éå§å¢ãè¿ä¸ªé¶æ®µçåºå¯¹æ¹æ¡ï¼ä¸è¬æ¯å°½é æååè¯¦æé¡µçé¡µé¢åç´ éæåï¼ç¶åä½¿ç¨cdnææ¯æµè§å¨æè¿äºéæåçåç´ ç¼å­èµ·æ¥ãè¿ä¸ªé¶æ®µå¾å¾ä½¿ç¨ cdn + æµè§å¨æååè¯¦æé¡µç¼å­ä¸æ¥å°±è¶³å¤äºï¼è¿ä¸éè¦ redisã\n\n# 1.2.2 ç¬¬äºé¶æ®µï¼ç§æå¼å§\n\næ­¤æ¶ï¼å¤§éç¨æ·ç¹å»ååè¯¦æé¡µä¸çç§ææé®ï¼ä¼äº§çå¤§éçå¹¶åè¯·æ±æ¥è¯¢åºå­ãä¸æ¦æä¸ªè¯·æ±æ¥è¯¢å°æåºå­ï¼ç´§æ¥çç³»ç»å°±ä¼è¿è¡åºå­æ£åãç¶åï¼ç³»ç»ä¼çæå®éè®¢åï¼å¹¶è¿è¡åç»­å¤çï¼ä¾å¦è®¢åæ¯ä»åç©æµæå¡ãå¦æè¯·æ±æ¥ä¸å°åºå­ï¼å°±ä¼è¿åãç¨æ·éå¸¸ä¼ç»§ç»­ç¹å»ç§ææé®ï¼ç»§ç»­æ¥è¯¢åºå­ã\n\nç®åæ¥è¯´ï¼è¿ä¸ªé¶æ®µçæä½å°±æ¯ä¸ä¸ªï¼åºå­æ¥éªãåºå­æ£ååè®¢åå¤çãå ä¸ºæ¯ä¸ªç§æè¯·æ±é½ä¼æ¥è¯¢åºå­ï¼èè¯·æ±åªææ¥å°æåºå­ä½éåï¼åç»­çåºå­æ£ååè®¢åå¤çæä¼è¢«æ§è¡ãæä»¥ï¼è¿ä¸ªé¶æ®µä¸­æå¤§çå¹¶åååé½å¨åºå­æ¥éªæä½ä¸ãä¸ºäºæ¯æå¤§éé«å¹¶åçåºå­æ¥éªè¯·æ±ï¼æä»¬éè¦å¨è¿ä¸ªç¯èä½¿ç¨ redis ä¿å­åºå­éï¼è¿æ ·ä¸æ¥ï¼è¯·æ±å¯ä»¥ç´æ¥ä»redisä¸­è¯»ååºå­å¹¶è¿è¡æ¥éªã\n\né£ä¹ï¼åºå­æ£ååè®¢åå¤çæ¯å¦é½å¯ä»¥äº¤ç»åç«¯çæ°æ®åºæ¥æ§è¡å¢?\n\n * è®¢åå¤çå¯ä»¥äº¤ç»æ°æ®åºæ§è¡ãå ä¸ºè®¢åå¤çå¾å¾æ¶åæ¯ä»ãåºåºç­å¤ä¸ªå³èæä½ï¼éè¦ä½¿ç¨æ°æ®åºçäºå¡ãèä¸è®¢åå¤çæ¶è¯·æ±ååå·²ç»ä¸å¤§äºï¼æ°æ®åºå¯ä»¥æ¯æè¿äºè¯·æ±ã\n * åºå­æ£åä¸è½äº¤ç»æ°æ®åºæ§è¡ï¼èæ¯ç´æ¥å¨ redis ä¸­æ§è¡ãå ä¸ºä¸æ¦ç¨æ·æ¥è¯¢å°æåºå­å°±ä¼ä¸åï¼é£ä¹å°±ä¼åèµ·è´­ä¹°çè¯·æ±ï¼å¦ææåºå­æ£åçæä½æ¾å°æ°æ®åºæ¥æ§è¡ï¼å°±ä¼å¸¦æ¥ä¸¤ä¸ªé®é¢ï¼\n   1. é¢å¤çå¼éãredis ä¸­ä¿å­äºåºå­éï¼èåºå­éçææ°å¼åæ¯æ°æ®åºå¨ç»´æ¤ï¼æä»¥æ°æ®åºæ´æ°åï¼è¿éè¦åredisè¿è¡åæ­¥ï¼è¿ä¸ªè¿ç¨å¢å äºé¢å¤çæä½é»è¾ï¼ä¹å¸¦æ¥äºé¢å¤çå¼éã\n   2. ä¸åéè¶è¿å®éåºå­éï¼åºç°è¶å®ãç±äºæ°æ®åºçå¤çéåº¦è¾æ¢ï¼ä¸è½åæ¶æ´æ°åºå­ä½éï¼è¿å°±ä¼å¯¼è´å¤§éåºå­æ¥éªçè¯·æ±è¯»åå°æ§çåºå­å¼ï¼å¹¶è¿è¡ä¸åãæ­¤æ¶ï¼å°±ä¼åºç°ä¸åæ°éå¤§äºå®éçåºå­éï¼å¯¼è´åºç°è¶å®ï¼è¿å°±ä¸ç¬¦åä¸å¡å±çè¦æ±äºã\n\næä»¥ï¼æä»¬å°±éè¦ç´æ¥å¨redisä¸­è¿è¡åºå­æ£åãå·ä½çæä½æ¯ï¼å½åºå­æ¥éªå®æåï¼ä¸æ¦åºå­æä½éï¼æä»¬å°±ç«å³å¨redisä¸­æ£ååºå­ãèä¸ï¼ä¸ºäºé¿åè¯·æ±æ¥è¯¢å°æ§çåºå­å¼ï¼åºå­æ¥éªååºå­æ£åè¿ä¸¤ä¸ªæä½éè¦ä¿è¯åå­æ§ã\n\n# 1.2.3 ç¬¬ä¸é¶æ®µï¼ç§ææ´»å¨ç»æå\n\nå¨è¿ä¸ªé¶æ®µï¼å¯è½è¿ä¼æé¨åç¨æ·å·æ°ååè¯¦æé¡µï¼å°è¯ç­å¾æå¶ä»ç¨æ·éåãèå·²ç»æåä¸åçç¨æ·ä¼å·æ°è®¢åè¯¦æï¼è·è¸ªè®¢åçè¿å±ãä¸è¿ï¼è¿ä¸ªé¶æ®µä¸­çç¨æ·è¯·æ±éå·²ç»ä¸éå¾å¤äºï¼æå¡å¨ç«¯ä¸è¬é½è½æ¯æï¼æä»¬å°±ä¸éç¹è®¨è®ºäºã\n\nè¿éæ»ç»ä¸ç§æåºæ¯å¯¹ redis çéæ±ï¼ç§æåºæ¯åæç§æåãç§æä¸­åç§æåä¸ä¸ªé¶æ®µãç§æå¼å§ååï¼é«å¹¶åååæ²¡æé£ä¹å¤§ï¼æä»¬ä¸éè¦ä½¿ç¨redisï¼ä½å¨ç§æè¿è¡ä¸­ï¼éè¦æ¥éªåæ£ååååºå­ï¼åºå­æ¥éªé¢ä¸´å¤§éçé«å¹¶åè¯·æ±ï¼èåºå­æ£ååéè¦ååºå­æ¥éªä¸èµ·æ§è¡ï¼ä»¥ä¿è¯åå­æ§ãè¿å°±æ¯ç§æå¯¹redisçéæ±ã\n\nä¸å¾å±ç¤ºäºç§æåºæ¯éè¦ redis åä¸çä¸¤ä¸ªç¯èï¼\n\nä¸é¢ä»ç» redis æ¯æç§æåºæ¯çæ¹æ³ã\n\n\n# 1.3 redis çåªäºæ¹æ³å¯ä»¥æ¯æç§æåºæ¯ï¼\n\nç§æåºæ¯å¯¹ redis æä½çæ ¹æ¬è¦æ±æä¸¤ä¸ªï¼\n\n 1. æ¯æé«å¹¶åãredis æ¬èº«æ¯æé«å¹¶åï¼ä½æ³¨æå¦ææå¤ä¸ªç§æååï¼æä»¬å¯ä»¥ä½¿ç¨åçéç¾¤æ¥å°åååæ£å¼ã\n 2. ä¿è¯åºå­æ¥éªååºå­æ£ååå­æ§æ§è¡ãéå¯¹è¿æ¡è¦æ±ï¼æä»¬å°±å¯ä»¥ä½¿ç¨ redis çåå­æä½ææ¯åå¸å¼éè¿ä¸¤ä¸ªåè½ç¹æ§æ¥æ¯æäºã\n\n# 1.3.1 åºäºåå­æä½æ¯æç§æåºæ¯\n\nå¨ç§æåºæ¯ä¸­ï¼ä¸ä¸ªååçåºå­å¯¹åºäºä¸¤ä¸ªä¿¡æ¯ï¼åå«æ¯æ»åºå­éåå·²ç§æéãè¿ç§æ°æ®æ¨¡åæ­£å¥½æ¯ä¸ä¸ªkeyï¼ååidï¼å¯¹åºäºä¸¤ä¸ªå±æ§ï¼æ»åºå­éåå·²ç§æéï¼ï¼æä»¥ï¼æä»¬å¯ä»¥ä½¿ç¨ä¸ä¸ªhashç±»åçé®å¼å¯¹æ¥ä¿å­åºå­çè¿ä¸¤ä¸ªä¿¡æ¯ï¼å¦ä¸æç¤ºï¼\n\nkey: itemid\nvalue: {total: n, ordered: m}\n\n\n1\n2\n\n * å¶ä¸­ï¼itemidæ¯ååçç¼å·ï¼totalæ¯æ»åºå­éï¼orderedæ¯å·²ç§æéã\n\nå ä¸ºåºå­æ¥éªååºå­æ£åè¿ä¸¤ä¸ªæä½è¦ä¿è¯ä¸èµ·æ§è¡ï¼ä¸ä¸ªç´æ¥çæ¹æ³å°±æ¯ä½¿ç¨redisçåå­æä½ãåå­æä½å¯ä»¥æ¯ redis èªèº«æä¾çåå­å½ä»¤ï¼ä¹å¯ä»¥æ¯ lua èæ¬ãç±äºè¿éé»è¾è¾ä¸ºå¤æï¼å æ­¤éç¨ lua èæ¬æ¥åå­æ§å°æ§è¡è¿ä¸¤ä¸ªæä½ï¼\n\n# è·ååååºå­ä¿¡æ¯\nlocal counts = redis.call("hmget", keys[1], "total", "ordered");\n# å°æ»åºå­è½¬æ¢ä¸ºæ°å¼\nlocal total = tonumber(counts[1])\n# å°å·²è¢«ç§æçåºå­è½¬æ¢ä¸ºæ°å¼\nlocal ordered = tonumber(counts[2])\n# å¦æå½åè¯·æ±çåºå­éå ä¸å·²è¢«ç§æçåºå­éä»ç¶å°äºæ»åºå­éï¼å°±å¯ä»¥æ´æ°åºå­\nif ordered + k <= total then\n    # æ´æ°å·²ç§æçåºå­é\n    redis.call("hincrby",keys[1],"ordered",k)\n    return k;\nend\nreturn 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næäº lua èæ¬åï¼æä»¬å°±å¯ä»¥å¨ redis å®¢æ·ç«¯ï¼ä½¿ç¨ eval å½ä»¤æ¥æ§è¡è¿ä¸ªèæ¬äºãæåï¼å®¢æ·ç«¯ä¼æ ¹æ®èæ¬çè¿åå¼ï¼æ¥ç¡®å®ç§ææ¯æåè¿æ¯å¤±è´¥äºãå¦æè¿åå¼æ¯kï¼å°±æ¯æåäºï¼å¦ææ¯0ï¼å°±æ¯å¤±è´¥ã\n\n# 1.3.2 åºäºåå¸å¼éæ¥æ¯æç§æåºæ¯\n\nä½¿ç¨åå¸å¼éæ¥æ¯æç§æåºæ¯çå·ä½åæ³æ¯ï¼åè®©å®¢æ·ç«¯å redis ç³è¯·åå¸å¼éï¼åªææ¿å°éçå®¢æ·ç«¯æè½æ§è¡åºå­æ¥éªååºå­æ£åãè¿æ ·ä¸æ¥ï¼å¤§éçç§æè¯·æ±å°±ä¼å¨äºå¤ºåå¸å¼éæ¶è¢«è¿æ»¤æãèä¸ï¼åºå­æ¥éªåæ£åä¹ä¸ç¨ä½¿ç¨åå­æä½äºï¼å ä¸ºå¤ä¸ªå¹¶åå®¢æ·ç«¯åªæä¸ä¸ªå®¢æ·ç«¯è½å¤æ¿å°éï¼å·²ç»ä¿è¯äºå®¢æ·ç«¯å¹¶åè®¿é®çäºæ¥æ§ã\n\nä¸é¢çä¼ªä»£ç æ¾ç¤ºäºä½¿ç¨åå¸å¼éæ¥æ§è¡åºå­æ¥éªåæ£åçè¿ç¨ï¼\n\n# ä½¿ç¨ååidä½ä¸ºkey\nkey = itemid\n# ä½¿ç¨å®¢æ·ç«¯å¯ä¸æ è¯ä½ä¸ºvalue\nval = clientuniqueid\n# ç³è¯·åå¸å¼éï¼timeoutæ¯è¶æ¶æ¶é´\nlock =acquirelock(key, val, timeout)\n# å½æ¿å°éåï¼æè½è¿è¡åºå­æ¥éªåæ£å\nif (lock == true) {\n   # åºå­æ¥éªåæ£å\n   availstock = decr(key, k)\n   # åºå­å·²ç»æ£åå®äºï¼éæ¾éï¼è¿åç§æå¤±è´¥\n   if (availstock < 0) {\n      releaselock(key, val)\n      return error\n   }\n   # åºå­æ£åæåï¼éæ¾é\n   else{\n     releaselock(key, val)\n     # è®¢åå¤ç\n   }\n}\n# æ²¡ææ¿å°éï¼ç´æ¥è¿å\nelse\n   return\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\néè¦æéä½ çæ¯ï¼å¨ä½¿ç¨åå¸å¼éæ¶ï¼å®¢æ·ç«¯éè¦åå redis è¯·æ±éï¼åªæè¯·æ±å°äºéï¼æè½è¿è¡åºå­æ¥éªç­æä½ï¼è¿æ ·ä¸æ¥ï¼å®¢æ·ç«¯å¨äºæ¢åå¸å¼éæ¶ï¼å¤§é¨åç§æè¯·æ±æ¬èº«å°±ä¼å ä¸ºæ¢ä¸å°éèè¢«æ¦æªãæä»¥è¿éæä¸ä¸ªå°å»ºè®®ï¼æä»¬å¯ä»¥ä½¿ç¨åçéç¾¤ä¸­çä¸åå®ä¾æ¥åå«ä¿å­åå¸å¼éååååºå­ä¿¡æ¯ãä½¿ç¨è¿ç§ä¿å­æ¹å¼åï¼ç§æè¯·æ±ä¼é¦åè®¿é®ä¿å­åå¸å¼éçå®ä¾ãå¦æå®¢æ·ç«¯æ²¡ææ¿å°éï¼è¿äºå®¢æ·ç«¯å°±ä¸ä¼æ¥è¯¢åååºå­ï¼è¿å°±å¯ä»¥åè½»ä¿å­åºå­ä¿¡æ¯çå®ä¾çååäºã\n\n\n# 1.4 å°ç»\n\nè¿èè¯¾ï¼æä»¬å­¦ä¹ äºrediså¨ç§æåºæ¯ä¸­çå·ä½åºç¨ãç§æåºæ¯æ2ä¸ªè´è½½ç¹å¾ï¼åå«æ¯ç¬æ¶é«å¹¶åè¯·æ±åè¯»å¤åå°ãredis è¯å¥½çé«å¹¶åå¤çè½åï¼ä»¥åé«æçé®å¼å¯¹è¯»åç¹æ§ï¼æ­£å¥½å¯ä»¥æ»¡è¶³ç§æåºæ¯çéæ±ãæä»¬éè¿ä½¿ç¨ redis çåå­æä½ååå¸å¼éä¸¤ä¸ªåè½ç¹æ§ææå°æ¯æç§æåºæ¯çéæ±ã\n\nå½ç¶ï¼å¯¹äºç§æåºæ¯æ¥è¯´ï¼åªç¨ redis æ¯ä¸å¤çãç§æç³»ç»æ¯ä¸ä¸ªç³»ç»æ§å·¥ç¨ï¼redis å®ç°äºå¯¹åºå­æ¥éªåæ£åè¿ä¸ªç¯èçæ¯æï¼é¤æ­¤ä¹å¤ï¼è¿æ 4 ä¸ªç¯èéè¦æä»¬å¤çå¥½ï¼\n\n 1. åç«¯éæé¡µé¢çè®¾è®¡ãç§æé¡µé¢ä¸è½éæåå¤ççé¡µé¢åç´ ï¼æä»¬é½è¦å°½ééæåï¼è¿æ ·å¯ä»¥ååå©ç¨cdnææµè§å¨ç¼å­æå¡ç§æå¼å§åçè¯·æ±ã\n 2. è¯·æ±æ¦æªåæµæ§ãå¨ç§æç³»ç»çæ¥å¥å±ï¼å¯¹æ¶æè¯·æ±è¿è¡æ¦æªï¼é¿åå¯¹ç³»ç»çæ¶ææ»å»ï¼ä¾å¦ä½¿ç¨é»ååç¦æ­¢æ¶æipè¿è¡è®¿é®ãå¦ærediså®ä¾çè®¿é®ååè¿å¤§ï¼ä¸ºäºé¿åå®ä¾å´©æºï¼æä»¬ä¹éè¦å¨æ¥å¥å±è¿è¡éæµï¼æ§å¶è¿å¥ç§æç³»ç»çè¯·æ±æ°éã\n 3. åºå­ä¿¡æ¯è¿ææ¶é´å¤çãredisä¸­ä¿å­çåºå­ä¿¡æ¯å¶å®æ¯æ°æ®åºçç¼å­ï¼ä¸ºäºé¿åç¼å­å»ç©¿é®é¢ï¼æä»¬ä¸è¦ç»åºå­ä¿¡æ¯è®¾ç½®è¿ææ¶é´ã\n 4. æ°æ®åºè®¢åå¼å¸¸å¤çãå¦ææ°æ®åºæ²¡è½æåå¤çè®¢åï¼å¯ä»¥å¢å è®¢åéè¯åè½ï¼ä¿è¯è®¢åæç»è½è¢«æåå¤çã\n\næåï¼æä¹åç»ä½ ä¸ä¸ªå°å»ºè®®ï¼ç§ææ´»å¨å¸¦æ¥çè¯·æ±æµéå·¨å¤§ï¼æä»¬éè¦æç§æååçåºå­ä¿¡æ¯ç¨åç¬çå®ä¾ä¿å­ï¼èä¸è¦åæ¥å¸¸ä¸å¡ç³»ç»çæ°æ®ä¿å­å¨åä¸ä¸ªå®ä¾ä¸ï¼è¿æ ·å¯ä»¥é¿åå¹²æ°ä¸å¡ç³»ç»çæ­£å¸¸è¿è¡ã',charsets:{cjk:!0},lastUpdated:"2023/04/21, 09:05:13",lastUpdatedTimestamp:1682067913e3},{title:"éç¾¤çæ°æ®å¾æåéä¿¡å¼éé®é¢",frontmatter:{title:"éç¾¤çæ°æ®å¾æåéä¿¡å¼éé®é¢",date:"2023-04-21T17:05:34.000Z",permalink:"/pages/d3d97d/",categories:["ä¸­é´ä»¶","Redis","ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/05.Redis/05.%E4%B8%93%E6%A0%8F%EF%BC%9ARedis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/37.%E9%9B%86%E7%BE%A4%E7%9A%84%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C%E5%92%8C%E9%80%9A%E4%BF%A1%E5%BC%80%E9%94%80%E9%97%AE%E9%A2%98.html",relativePath:"ä¸­é´ä»¶/05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/37.éç¾¤çæ°æ®å¾æåéä¿¡å¼éé®é¢.md",key:"v-aa603976",path:"/pages/d3d97d/",headers:[{level:2,title:"1. æ°æ®åå¸ä¼åï¼å¦ä½åºå¯¹æ°æ®å¾æï¼",slug:"_1-æ°æ®åå¸ä¼å-å¦ä½åºå¯¹æ°æ®å¾æ",normalizedTitle:"1. æ°æ®åå¸ä¼åï¼å¦ä½åºå¯¹æ°æ®å¾æï¼",charIndex:86},{level:3,title:"1.1 æ°æ®éå¾æçæå ååºå¯¹æ¹æ³",slug:"_1-1-æ°æ®éå¾æçæå ååºå¯¹æ¹æ³",normalizedTitle:"1.1 æ°æ®éå¾æçæå ååºå¯¹æ¹æ³",charIndex:416},{level:4,title:"1.1.1 bigkey å¯¼è´å¾æ",slug:"_1-1-1-bigkey-å¯¼è´å¾æ",normalizedTitle:"1.1.1 bigkey å¯¼è´å¾æ",charIndex:588},{level:4,title:"1.1.2 Slot åéä¸åè¡¡å¯¼è´å¾æ",slug:"_1-1-2-slot-åéä¸åè¡¡å¯¼è´å¾æ",normalizedTitle:"1.1.2 slot åéä¸åè¡¡å¯¼è´å¾æ",charIndex:1004},{level:4,title:"1.1.3 Hash Tag å¯¼è´å¾æ",slug:"_1-1-3-hash-tag-å¯¼è´å¾æ",normalizedTitle:"1.1.3 hash tag å¯¼è´å¾æ",charIndex:2952},{level:3,title:"1.2 æ°æ®è®¿é®å¾æçæå ååºå¯¹æ¹æ³",slug:"_1-2-æ°æ®è®¿é®å¾æçæå ååºå¯¹æ¹æ³",normalizedTitle:"1.2 æ°æ®è®¿é®å¾æçæå ååºå¯¹æ¹æ³",charIndex:3910},{level:3,title:"1.3 å°ç»",slug:"_1-3-å°ç»",normalizedTitle:"1.3 å°ç»",charIndex:4446},{level:2,title:"2. éä¿¡å¼éï¼éå¶ Redis Cluster è§æ¨¡çå³é®å ç´ ",slug:"_2-éä¿¡å¼é-éå¶-redis-cluster-è§æ¨¡çå³é®å ç´ ",normalizedTitle:"2. éä¿¡å¼éï¼éå¶ redis cluster è§æ¨¡çå³é®å ç´ ",charIndex:4793},{level:3,title:"2.1 å®ä¾éä¿¡æ¹æ³åå¯¹éç¾¤è§æ¨¡çå½±å",slug:"_2-1-å®ä¾éä¿¡æ¹æ³åå¯¹éç¾¤è§æ¨¡çå½±å",normalizedTitle:"2.1 å®ä¾éä¿¡æ¹æ³åå¯¹éç¾¤è§æ¨¡çå½±å",charIndex:5070},{level:4,title:"2.1.1 Gossip æ¶æ¯å¤§å°",slug:"_2-1-1-gossip-æ¶æ¯å¤§å°",normalizedTitle:"2.1.1 gossip æ¶æ¯å¤§å°",charIndex:5666},{level:4,title:"2.1.2 å®ä¾é´éä¿¡é¢ç",slug:"_2-1-2-å®ä¾é´éä¿¡é¢ç",normalizedTitle:"2.1.2 å®ä¾é´éä¿¡é¢ç",charIndex:6871},{level:3,title:"2.2 å¦ä½éä½å®ä¾é´çéä¿¡å¼éï¼",slug:"_2-2-å¦ä½éä½å®ä¾é´çéä¿¡å¼é",normalizedTitle:"2.2 å¦ä½éä½å®ä¾é´çéä¿¡å¼éï¼",charIndex:7764}],headersStr:"1. æ°æ®åå¸ä¼åï¼å¦ä½åºå¯¹æ°æ®å¾æï¼ 1.1 æ°æ®éå¾æçæå ååºå¯¹æ¹æ³ 1.1.1 bigkey å¯¼è´å¾æ 1.1.2 Slot åéä¸åè¡¡å¯¼è´å¾æ 1.1.3 Hash Tag å¯¼è´å¾æ 1.2 æ°æ®è®¿é®å¾æçæå ååºå¯¹æ¹æ³ 1.3 å°ç» 2. éä¿¡å¼éï¼éå¶ Redis Cluster è§æ¨¡çå³é®å ç´  2.1 å®ä¾éä¿¡æ¹æ³åå¯¹éç¾¤è§æ¨¡çå½±å 2.1.1 Gossip æ¶æ¯å¤§å° 2.1.2 å®ä¾é´éä¿¡é¢ç 2.2 å¦ä½éä½å®ä¾é´çéä¿¡å¼éï¼",content:'> åèï¼\n> \n>  * 37 æ°æ®åå¸ä¼åï¼å¦ä½åºå¯¹æ°æ®å¾æï¼| æå®¢æ¶é´\n>  * 38 éä¿¡å¼éï¼éå¶Redis Clusterè§æ¨¡çå³é®å ç´ | æå®¢æ¶é´\n\n\n# 1. æ°æ®åå¸ä¼åï¼å¦ä½åºå¯¹æ°æ®å¾æï¼\n\nå¨ Redis åçéç¾¤ä¸­ï¼æ°æ®é½ä¼æç§ CRC ç®æ³çè®¡ç®å¼å¯¹ Slot åæ¨¡ï¼ç¶ååæ å°å°æä¸ªå®ä¾ä¸ãè¿ç§æ¹æ³è½ç¶å®ç°ç®åï¼ä½å®¹æå¯¼è´ä¸ä¸ªé®é¢ï¼æ°æ®å¾æã\n\næ°æ®å¾ææä¸¤ç±»ï¼\n\n * æ°æ®éå¾æï¼å¨æäºæåµä¸ï¼å®ä¾ä¸çæ°æ®åå¸ä¸åè¡¡ï¼æä¸ªå®ä¾ä¸çæ°æ®ç¹å«å¤ã\n * æ°æ®è®¿é®å¾æï¼è½ç¶æ¯ä¸ªéç¾¤å®ä¾ä¸çæ°æ®éç¸å·®ä¸å¤§ï¼ä½æ¯æä¸ªå®ä¾ä¸çæ°æ®æ¯ç­ç¹æ°æ®ï¼è¢«è®¿é®å¾éå¸¸é¢ç¹ã\n\nå¦æåçäºæ°æ®å¾æï¼é£ä¹ä¿å­äºå¤§éæ°æ®ï¼æèæ¯ä¿å­äºç­ç¹æ°æ®çå®ä¾çå¤çååå°±ä¼å¢å¤§ï¼éåº¦åæ¢ï¼çè³è¿å¯è½ä¼å¼èµ·è¿ä¸ªå®ä¾çåå­èµæºèå°½ï¼ä»èå´©æºãè¿æ¯æä»¬å¨åºç¨åçéç¾¤æ¶è¦é¿åçã\n\nè¿ä¸å¤§èå°è®¨è®ºæ°æ®å¾ææ¯å¦ä½åççï¼ä»¥åå¦ä½åºå¯¹ã\n\n\n# 1.1 æ°æ®éå¾æçæå ååºå¯¹æ¹æ³\n\nå½æ°æ®éå¾æåçæ¶ï¼æ°æ®å¨åçéç¾¤çå¤ä¸ªå®ä¾ä¸åå¸ä¸åè¡¡ï¼å¤§éæ°æ®éä¸­å°äºä¸ä¸ªæå ä¸ªå®ä¾ä¸ï¼å¦ä¸å¾æç¤ºï¼\n\né£ä¹ï¼æ°æ®éå¾ææ¯æä¹äº§ççå¢ï¼è¿ä¸»è¦æä¸ä¸ªåå ï¼åå«æ¯æä¸ªå®ä¾ä¸ä¿å­äºbigkeyãSlotåéä¸åè¡¡ä»¥åHash Tagãæ¥ä¸æ¥ï¼æä»¬å°±ä¸ä¸ªä¸ä¸ªæ¥åæï¼åæ¶æè¿ä¼ç»ä½ è®²è§£ç¸åºçè§£å³æ¹æ¡ã\n\n# 1.1.1 bigkey å¯¼è´å¾æ\n\nç¬¬ä¸ä¸ªåå æ¯ï¼æä¸ªå®ä¾ä¸æ­£å¥½ä¿å­äºbigkeyãbigkeyçvalueå¼å¾å¤§ï¼Stringç±»åï¼ï¼æèæ¯bigkeyä¿å­äºå¤§ééååç´ ï¼éåç±»åï¼ï¼ä¼å¯¼è´è¿ä¸ªå®ä¾çæ°æ®éå¢å ï¼åå­èµæºæ¶èä¹ç¸åºå¢å ã\n\nèä¸ï¼bigkeyçæä½ä¸è¬é½ä¼é æå®ä¾IOçº¿ç¨é»å¡ï¼å¦æbigkeyçè®¿é®éæ¯è¾å¤§ï¼å°±ä¼å½±åå°è¿ä¸ªå®ä¾ä¸çå¶å®è¯·æ±è¢«å¤ççéåº¦ã\n\nå¶å®ï¼bigkeyå·²ç»æ¯æä»¬è¯¾ç¨ä¸­åå¤æå°çä¸ä¸ªå³é®ç¹äºãä¸ºäºé¿åbigkeyé æçæ°æ®å¾æï¼ä¸ä¸ªæ ¹æ¬çåºå¯¹æ¹æ³æ¯ï¼æä»¬å¨ä¸å¡å±çææ°æ®æ¶ï¼è¦å°½éé¿åæè¿å¤çæ°æ®ä¿å­å¨åä¸ä¸ªé®å¼å¯¹ä¸­ãæ­¤å¤ï¼å¦æ bigkey æ­£å¥½æ¯éåç±»åï¼é£å¯ä»¥æå®ææå¤ä¸ªå°çéåç±»åæ°æ®ï¼åæ£ä¿å­å¨ä¸åçå®ä¾ä¸ãæä¸ä¸ªbigkeyåæ´ä¸ºé¶ãåæ£ä¿å­äºï¼é¿åäºbigkeyç»åä¸ªåçå®ä¾å¸¦æ¥çè®¿é®ååã\n\néè¦æ³¨æçæ¯ï¼å½ bigkey è®¿é®éè¾å¤§æ¶ï¼ä¹ä¼é ææ°æ®è®¿é®å¾æã\n\n# 1.1.2 Slot åéä¸åè¡¡å¯¼è´å¾æ\n\nå¦æéç¾¤è¿ç»´äººåæ²¡æåè¡¡å°åé Slotï¼å°±ä¼æå¤§éçæ°æ®è¢«åéå°åä¸ä¸ª Slot ä¸­ï¼èåä¸ä¸ª Slot åªä¼å¨ä¸ä¸ªå®ä¾ä¸åå¸ï¼è¿å°±ä¼å¯¼è´ï¼å¤§éæ°æ®è¢«éä¸­å°ä¸ä¸ªå®ä¾ä¸ï¼é ææ°æ®å¾æã\n\nä¸ºäºåºå¯¹è¿ä¸ªé®é¢ï¼æä»¬å¯ä»¥éè¿è¿ç»´è§èï¼å¨åéä¹åï¼æä»¬å°±è¦é¿åæè¿å¤ç Slot åéå°åä¸ä¸ªå®ä¾ãå¦ææ¯å·²ç»åéå¥½Slotçéç¾¤ï¼æä»¬å¯ä»¥åæ¥çSlotåå®ä¾çå·ä½åéå³ç³»ï¼ä»èå¤æ­æ¯å¦æè¿å¤çSlotéä¸­å°äºåä¸ä¸ªå®ä¾ãå¦ææçè¯ï¼å°±å°é¨åSlotè¿ç§»å°å¶å®å®ä¾ï¼ä»èé¿åæ°æ®å¾æã\n\nä¸åéç¾¤ä¸æ¥çSlotåéæåµçæ¹å¼ä¸åï¼å¦ææ¯Redis Clusterï¼å°±ç¨CLUSTER SLOTSå½ä»¤ï¼å¦ææ¯Codisï¼å°±å¯ä»¥å¨codis dashboardä¸æ¥çã\n\nRedis Cluster ä¸­ slot çè¿ç§»\n\næ¯å¦è¯´ï¼æä»¬æ§è¡CLUSTER SLOTSå½ä»¤æ¥çSlotåéæåµãå½ä»¤è¿åç»ææ¾ç¤ºï¼Slot 0 å°Slot 4095è¢«åéå°äºå®ä¾192.168.10.3ä¸ï¼èSlot 12288å°Slot 16383è¢«åéå°äºå®ä¾192.168.10.5ä¸ã\n\n127.0.0.1:6379> cluster slots\n1) 1) (integer) 0\n   1) (integer) 4095\n   2) 1) "192.168.10.3"\n      1) (integer) 6379\n2) 1) (integer) 12288\n   1) (integer) 16383\n   2) 1) "192.168.10.5"\n      1) (integer) 6379\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¦ææä¸ä¸ªå®ä¾ä¸æå¤ªå¤çSlotï¼æä»¬å°±å¯ä»¥ä½¿ç¨è¿ç§»å½ä»¤æè¿äºSlotè¿ç§»å°å¶å®å®ä¾ä¸ãå¨Redis Clusterä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨3ä¸ªå½ä»¤å®æSlotè¿ç§»ã\n\n 1. CLUSTER SETSLOTï¼ä½¿ç¨ä¸åçéé¡¹è¿è¡ä¸ç§è®¾ç½®ï¼åå«æ¯è®¾ç½®Slotè¦è¿å¥çç®æ å®ä¾ï¼Slotè¦è¿åºçæºå®ä¾ï¼ä»¥åSlotæå±çå®ä¾ã\n 2. CLUSTER GETKEYSINSLOTï¼è·åæä¸ªSlotä¸­ä¸å®æ°éçkeyã\n 3. MIGRATEï¼æä¸ä¸ªkeyä»æºå®ä¾å®éè¿ç§»å°ç®æ å®ä¾ã\n\nææ¥åå©ä¸ä¸ªä¾å­ï¼å¸¦ä½ äºè§£ä¸è¿ä¸ä¸ªå½ä»¤æä¹ç¨ã\n\nåè®¾æä»¬è¦æSlot 300ä»æºå®ä¾ï¼IDä¸º3ï¼è¿ç§»å°ç®æ å®ä¾ï¼IDä¸º5ï¼ï¼é£è¦æä¹åå¢ï¼\n\nå®éä¸ï¼æä»¬å¯ä»¥åæ5æ­¥ã\n\nç¬¬1æ­¥ï¼æä»¬åå¨ç®æ å®ä¾5ä¸æ§è¡ä¸é¢çå½ä»¤ï¼å°Slot 300çæºå®ä¾è®¾ç½®ä¸ºå®ä¾3ï¼è¡¨ç¤ºè¦ä»å®ä¾3ä¸è¿å¥Slot 300ã\n\nCLUSTER SETSLOT 300 IMPORTING 3\n\n\n1\n\n\nç¬¬2æ­¥ï¼å¨æºå®ä¾3ä¸ï¼æä»¬æSlot 300çç®æ å®ä¾è®¾ç½®ä¸º5ï¼è¿è¡¨ç¤ºï¼Slot 300è¦è¿åºå°å®ä¾5ä¸ï¼å¦ä¸æç¤ºï¼\n\nCLUSTER SETSLOT 300 MIGRATING 5\n\n\n1\n\n\nç¬¬3æ­¥ï¼ä»Slot 300ä¸­è·å100 ä¸ªkeyãå ä¸ºSlotä¸­çkeyæ°éå¯è½å¾å¤ï¼æä»¥æä»¬éè¦å¨å®¢æ·ç«¯ä¸å¤æ¬¡æ§è¡ä¸é¢çè¿æ¡å½ä»¤ï¼åæ¹æ¬¡è·å¾å¹¶è¿ç§»keyã\n\nCLUSTER GETKEYSINSLOT 300 100\n\n\n1\n\n\nç¬¬4æ­¥ï¼æä»¬æåæè·åç100ä¸ªkeyä¸­çkey1è¿ç§»å°ç®æ å®ä¾5ä¸ï¼IPä¸º192.168.10.5ï¼ï¼åæ¶æè¦è¿å¥çæ°æ®åºè®¾ç½®ä¸º0å·æ°æ®åºï¼æè¿ç§»çè¶æ¶æ¶é´è®¾ç½®ä¸ºtimeoutãæä»¬éå¤æ§è¡MIGRATEå½ä»¤ï¼æ100ä¸ªkeyé½è¿ç§»å®ã\n\nMIGRATE 192.168.10.5 6379 key1 0 timeout\n\n\n1\n\n\næåï¼æä»¬éå¤æ§è¡ç¬¬3åç¬¬4æ­¥ï¼ç´å°Slotä¸­çæækeyé½è¿ç§»å®æã\n\nä»Redis 3.0.6å¼å§ï¼ä½ ä¹å¯ä»¥ä½¿ç¨KEYSéé¡¹ï¼ä¸æ¬¡è¿ç§»å¤ä¸ªkeyï¼key1ã2ã3ï¼ï¼è¿æ ·å¯ä»¥æåè¿ç§»æçã\n\nMIGRATE 192.168.10.5 6379 "" 0 timeout KEYS key1 key2 key3\n\n\n1\n\n\nå¯¹äºCodisæ¥è¯´ï¼æä»¬å¯ä»¥æ§è¡ä¸é¢çå½ä»¤è¿è¡æ°æ®è¿ç§»ãå¶ä¸­ï¼æä»¬ædashboardç»ä»¶çè¿æ¥å°åè®¾ç½®ä¸ºADDRï¼å¹¶ä¸æSlot 300è¿ç§»å°ç¼å·ä¸º6çcodis server groupä¸ã\n\ncodis-admin --dashboard=ADDR -slot-action --create --sid=300 --gid=6\n\n\n1\n\n\né¤äº bigkey å Slot åéä¸åè¡¡ä¼å¯¼è´æ°æ®éå¾æï¼è¿æä¸ä¸ªå¯¼è´å¾æçåå ï¼å°±æ¯ä½¿ç¨äº Hash Tag è¿è¡æ°æ®åçã\n\n# 1.1.3 Hash Tag å¯¼è´å¾æ\n\nHash Tag æ¯æå å¨é®å¼å¯¹ key ä¸­çä¸å¯¹è±æ¬å· {}ãè¿å¯¹æ¬å·ä¼æ key çä¸é¨åæ¬èµ·æ¥ï¼å®¢æ·ç«¯å¨è®¡ç® key ç CRC16 å¼æ¶ï¼åªå¯¹ Hash Tag è±æ¬å·ä¸­ç key åå®¹è¿è¡è®¡ç®ãå¦ææ²¡ç¨ Hash Tag çè¯ï¼å®¢æ·ç«¯è®¡ç®æ´ä¸ª key ç CRC16 çå¼ã\n\n> ä¸¾ä¸ªä¾å­ï¼åè®¾keyæ¯user:profile:3231ï¼æä»¬æå¶ä¸­ç3231ä½ä¸ºHash Tagï¼æ­¤æ¶ï¼keyå°±åæäºuser:profile:{3231}ãå½å®¢æ·ç«¯è®¡ç®è¿ä¸ªkeyçCRC16å¼æ¶ï¼å°±åªä¼è®¡ç®3231çCRC16å¼ãå¦åï¼å®¢æ·ç«¯ä¼è®¡ç®æ´ä¸ªâuser:profile:3231âçCRC16å¼ã\n\nä½¿ç¨ Hash Tag çå¥½å¤æ¯ï¼å¦æä¸å key ç Hash Tag åå®¹é½æ¯ä¸æ ·çï¼é£ä¹ï¼è¿äº key å¯¹åºçæ°æ®ä¼è¢«æ å°å°åä¸ä¸ª Slot ä¸­ï¼åæ¶ä¼è¢«åéå°åä¸ä¸ªå®ä¾ä¸ã\n\nHash Tag ä¸»è¦æ¯ç¨å¨ Redis Cluster å Codis ä¸­ï¼æ¯æäºå¡æä½åèå´æ¥è¯¢ãå ä¸º Redis Cluster å Codis æ¬èº«å¹¶ä¸æ¯æè·¨å®ä¾çäºå¡æä½åèå´æ¥è¯¢ï¼å½ä¸å¡åºç¨æè¿äºéæ±æ¶ï¼å°±åªè½åæè¿äºæ°æ®è¯»åå°ä¸å¡å±è¿è¡äºå¡å¤çï¼æèæ¯éä¸ªæ¥è¯¢æ¯ä¸ªå®ä¾ï¼å¾å°èå´æ¥è¯¢çç»æãè¿æ ·æä½èµ·æ¥éå¸¸éº»ç¦ï¼æä»¥ï¼æä»¬å¯ä»¥ä½¿ç¨ Hash Tag æè¦æ§è¡äºå¡æä½ææ¯èå´æ¥è¯¢çæ°æ®æ å°å°åä¸ä¸ªå®ä¾ä¸ï¼è¿æ ·å°±è½å¾è½»æ¾å°å®ç°äºå¡æèå´æ¥è¯¢äºã\n\nä½æ¯ï¼ä½¿ç¨Hash Tagçæ½å¨é®é¢ï¼å°±æ¯å¤§éçæ°æ®å¯è½è¢«éä¸­å°ä¸ä¸ªå®ä¾ä¸ï¼å¯¼è´æ°æ®å¾æï¼éç¾¤ä¸­çè´è½½ä¸åè¡¡ãé£ä¹ï¼è¯¥æä¹åºå¯¹è¿ç§é®é¢å¢ï¼æä»¬å°±éè¦å¨èå´æ¥è¯¢ãäºå¡æ§è¡çéæ±åæ°æ®å¾æå¸¦æ¥çè®¿é®ååä¹é´ï¼è¿è¡åèäºã\n\næçå»ºè®®æ¯ï¼å¦æä½¿ç¨Hash Tagè¿è¡åççæ°æ®ä¼å¸¦æ¥è¾å¤§çè®¿é®ååï¼å°±ä¼åèèé¿åæ°æ®å¾æï¼æå¥½ä¸è¦ä½¿ç¨Hash Tagè¿è¡æ°æ®åçãå ä¸ºäºå¡åèå´æ¥è¯¢é½è¿å¯ä»¥æ¾å¨å®¢æ·ç«¯æ¥æ§è¡ï¼èæ°æ®å¾æä¼å¯¼è´å®ä¾ä¸ç¨³å®ï¼é ææå¡ä¸å¯ç¨ã\n\n----------------------------------------\n\nä»¥ä¸ä»ç»äºæ°æ®éå¾æçåå ä»¥ååºå¯¹æ¹æ³ãä¸é¢çä¸ä¸æ°æ®è®¿é®å¾æçåå ååºå¯¹æ¹æ³ã\n\n\n# 1.2 æ°æ®è®¿é®å¾æçæå ååºå¯¹æ¹æ³\n\nåçæ°æ®è®¿é®å¾æçæ ¹æ¬åå ï¼å°±æ¯å®ä¾ä¸å­å¨ç­ç¹æ°æ®ãä¸æ¦ç­ç¹æ°æ®è¢«å­å¨äºæä¸ªå®ä¾ä¸­ï¼é£ä¹ï¼è¿ä¸ªå®ä¾çè¯·æ±è®¿é®éå°±ä¼è¿é«äºå¶å®å®ä¾ï¼é¢ä¸´å·¨å¤§çè®¿é®ååãå¦ä¸å¾æç¤ºï¼\n\nå¦ä½åºå¯¹å¢ï¼åæ°æ®éå¾æä¸åï¼ç­ç¹æ°æ®éå¸¸æ¯ä¸ä¸ªæå ä¸ªæ°æ®ï¼æä»¥ï¼ç´æ¥éæ°åé Slot å¹¶ä¸è½è§£å³ç­ç¹æ°æ®çé®é¢ã\n\néå¸¸æ¥è¯´ï¼ç­ç¹æ°æ®ä»¥æå¡è¯»æä½ä¸ºä¸»ï¼å¨è¿ç§æåµä¸ï¼æä»¬å¯ä»¥éç¨ç­ç¹æ°æ®å¤å¯æ¬çæ¹æ³æ¥åºå¯¹ãè¿ä¸ªæ¹æ³çå·ä½åæ³æ¯ï¼æä»¬æç­ç¹æ°æ®å¤å¶å¤ä»½ï¼å¨æ¯ä¸ä¸ªæ°æ®å¯æ¬çkeyä¸­å¢å ä¸ä¸ªéæºåç¼ï¼è®©å®åå¶å®å¯æ¬æ°æ®ä¸ä¼è¢«æ å°å°åä¸ä¸ªSlotä¸­ãè¿æ ·ä¸æ¥ï¼ç­ç¹æ°æ®æ¢æå¤ä¸ªå¯æ¬å¯ä»¥åæ¶æå¡è¯·æ±ï¼åæ¶ï¼è¿äºå¯æ¬æ°æ®çkeyåä¸ä¸æ ·ï¼ä¼è¢«æ å°å°ä¸åçSlotä¸­ãå¨ç»è¿äºSlotåéå®ä¾æ¶ï¼æä»¬ä¹è¦æ³¨ææå®ä»¬åéå°ä¸åçå®ä¾ä¸ï¼é£ä¹ï¼ç­ç¹æ°æ®çè®¿é®ååå°±è¢«åæ£å°ä¸åçå®ä¾ä¸äºã\n\nè¿éï¼æä¸ªå°æ¹éè¦æ³¨æä¸ï¼ç­ç¹æ°æ®å¤å¯æ¬æ¹æ³åªè½éå¯¹åªè¯»çç­ç¹æ°æ®ãå¦æç­ç¹æ°æ®æ¯æè¯»æåçè¯ï¼å°±ä¸éåéç¨å¤å¯æ¬æ¹æ³äºï¼å ä¸ºè¦ä¿è¯å¤å¯æ¬é´çæ°æ®ä¸è´æ§ï¼ä¼å¸¦æ¥é¢å¤çå¼éã\n\nå¯¹äºæè¯»æåçç­ç¹æ°æ®ï¼æä»¬å°±è¦ç»å®ä¾æ¬èº«å¢å èµæºäºï¼ä¾å¦ä½¿ç¨éç½®æ´é«çæºå¨ï¼æ¥åºå¯¹å¤§éçè®¿é®ååã\n\n\n# 1.3 å°ç»\n\nè¿ä¸å¤§èä»ç»äºæ°æ®å¾æçä¸¤ç§æåµï¼æ°æ®éå¾æåæ°æ®è®¿é®å¾æã\n\né ææ°æ®éå¾æçåå ä¸»è¦æä¸ä¸ªï¼\n\n 1. æ°æ®ä¸­æbigkeyï¼å¯¼è´æä¸ªå®ä¾çæ°æ®éå¢å ï¼\n 2. Slotæå·¥åéä¸åï¼å¯¼è´æä¸ªææäºå®ä¾ä¸æå¤§éæ°æ®ï¼\n 3. ä½¿ç¨äºHash Tagï¼å¯¼è´æ°æ®éä¸­å°æäºå®ä¾ä¸ã\n\nèæ°æ®è®¿é®å¾æçä¸»è¦åå å°±æ¯æç­ç¹æ°æ®å­å¨ï¼å¯¼è´å¤§éè®¿é®è¯·æ±éä¸­å°äºç­ç¹æ°æ®æå¨çå®ä¾ä¸ã\n\nä¸è¡¨å¯¹ä»¥ä¸æåµè¿è¡äºæ»ç»ï¼\n\nå¦æå·²ç»åçäºæ°æ®å¾æï¼æä»¬å¯ä»¥éè¿æ°æ®è¿ç§»æ¥ç¼è§£æ°æ®å¾æçå½±åã\n\næåï¼å³äºéç¾¤çå®ä¾èµæºéç½®ï¼æåç»ä½ ä¸ä¸ªå°å»ºè®®ï¼å¨æå»ºåçéç¾¤æ¶ï¼å°½éä½¿ç¨å¤§å°éç½®ç¸åçå®ä¾ï¼ä¾å¦å®ä¾åå­éç½®ä¿æç¸åï¼ï¼è¿æ ·å¯ä»¥é¿åå å®ä¾èµæºä¸åè¡¡èå¨ä¸åå®ä¾ä¸åéä¸åæ°éçSlotã\n\n\n# 2. éä¿¡å¼éï¼éå¶ Redis Cluster è§æ¨¡çå³é®å ç´ \n\nRedis Clusterè½ä¿å­çæ°æ®éä»¥åæ¯æçååéï¼è·éç¾¤çå®ä¾è§æ¨¡å¯åç¸å³ãRediså®æ¹ç»åºäºRedis Clusterçè§æ¨¡ä¸éï¼å°±æ¯ä¸ä¸ªéç¾¤è¿è¡1000ä¸ªå®ä¾ã\n\néå¶ Redis éç¾¤æ°éçä¸ä¸ªå³é®å ç´ å°±æ¯ï¼å®ä¾é´çéä¿¡å¼éä¼éçå®ä¾è§æ¨¡å¢å èå¢å¤§ãå¨éç¾¤è¶è¿ä¸å®è§æ¨¡æ¶ï¼æ¯å¦ 800 èç¹ï¼ï¼éç¾¤ååéåèä¼ä¸éãæä»¥ï¼éç¾¤çå®éè§æ¨¡ä¼åå°éå¶ã\n\nè¿ä¸å¤§èå°è®¨è®ºéç¾¤å®ä¾é´çéä¿¡å¼éæ¯å¦ä½å½±åRedis Clusterè§æ¨¡çï¼ä»¥åå¦ä½éä½å®ä¾é´çéä¿¡å¼éã\n\n\n# 2.1 å®ä¾éä¿¡æ¹æ³åå¯¹éç¾¤è§æ¨¡çå½±å\n\nRedis Cluster å¨è¿è¡æ¶ï¼æ¯ä¸ªå®ä¾ä¸é½ä¼ä¿å­ Slot åå®ä¾çå¯¹åºå³ç³»ï¼ä¹å°±æ¯Slotæ å°è¡¨ï¼ï¼ä»¥åèªèº«çç¶æä¿¡æ¯ãå®ä¾ä¹é´ä¸ºäºäºéè¿äºç¶æä¿¡æ¯ï¼ä¼ä½¿ç¨ Gossip åè®®æ¥è¿è¡éä¿¡ã\n\nGossipåè®®çå·¥ä½åçå¯ä»¥æ¦æ¬æä¸¤ç¹ã\n\n * ä¸æ¯ï¼æ¯ä¸ªå®ä¾ä¹é´ä¼æç§ä¸å®çé¢çï¼ä»éç¾¤ä¸­éæºæéä¸äºå®ä¾ï¼æPINGæ¶æ¯åéç»æéåºæ¥çå®ä¾ï¼ç¨æ¥æ£æµè¿äºå®ä¾æ¯å¦å¨çº¿ï¼å¹¶äº¤æ¢å½¼æ­¤çç¶æä¿¡æ¯ãPINGæ¶æ¯ä¸­å°è£äºåéæ¶æ¯çå®ä¾èªèº«çç¶æä¿¡æ¯ãé¨åå¶å®å®ä¾çç¶æä¿¡æ¯ï¼ä»¥åSlotæ å°è¡¨ã\n * äºæ¯ï¼ä¸ä¸ªå®ä¾å¨æ¥æ¶å°PINGæ¶æ¯åï¼ä¼ç»åéPINGæ¶æ¯çå®ä¾ï¼åéä¸ä¸ªPONGæ¶æ¯ãPONGæ¶æ¯åå«çåå®¹åPINGæ¶æ¯ä¸æ ·ã\n\nä¸å¾æ¾ç¤ºäºä¸¤ä¸ªå®ä¾é´è¿è¡ PINGãPONG æ¶æ¯ä¼ éçæåµï¼\n\nGossip åè®®å¯ä»¥ä¿è¯å¨ä¸æ®µæ¶é´åï¼éç¾¤ä¸­çæ¯ä¸ä¸ªå®ä¾é½è½è·å¾å¶å®ææå®ä¾çç¶æä¿¡æ¯ãè¿æ ·ä¸æ¥ï¼å³ä½¿ææ°èç¹å å¥ãèç¹æéãSlot åæ´ç­äºä»¶åçï¼å®ä¾é´ä¹å¯ä»¥éè¿ PINGãPONG æ¶æ¯çä¼ éï¼å®æéç¾¤ç¶æå¨æ¯ä¸ªå®ä¾ä¸çåæ­¥ã\n\nå¯ä»¥ç´è§çå°ï¼å®ä¾ä¹é´ä½¿ç¨ Gossip åè®®éä¿¡æ¶ï¼éä¿¡å¼éä¼åå°éä¿¡æ¶æ¯å¤§å°åéä¿¡é¢çè¿ä¸¤æ¹é¢çå½±åï¼æ¶æ¯è¶å¤§ãé¢çè¶é«ï¼ç¸åºçéä¿¡å¼éä¹å°±è¶å¤§ãå¦ææ³è¦å®ç°é«æçéä¿¡ï¼å¯ä»¥ä»è¿ä¸¤æ¹é¢å¥æå»è°ä¼ã\n\n# 2.1.1 Gossip æ¶æ¯å¤§å°\n\nRedis å®ä¾åéç PING æ¶æ¯çæ¶æ¯ä½æ¯ç± clusterMsgDataGossip ç»æä½ç»æçï¼è¿ä¸ªç»æä½çå®ä¹å¦ä¸æç¤ºï¼\n\ntypedef struct {\n    char nodename[CLUSTER_NAMELEN];  //40å­è\n    uint32_t ping_sent; //4å­è\n    uint32_t pong_received; //4å­è\n    char ip[NET_IP_STR_LEN]; //46å­è\n    uint16_t port;  //2å­è\n    uint16_t cport;  //2å­è\n    uint16_t flags;  //2å­è\n    uint32_t notused1; //4å­è\n} clusterMsgDataGossip;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå¶ä¸­ï¼CLUSTER_NAMELENåNET_IP_STR_LENçå¼åå«æ¯40å46ï¼åå«è¡¨ç¤ºï¼nodenameåipè¿ä¸¤ä¸ªå­èæ°ç»çé¿åº¦æ¯40å­èå46å­èï¼æä»¬åæç»æä½ä¸­å¶å®ä¿¡æ¯çå¤§å°å èµ·æ¥ï¼å°±å¯ä»¥å¾å°ä¸ä¸ªGossipæ¶æ¯çå¤§å°äºï¼å³104å­èã\n\næ¯ä¸ªå®ä¾å¨åéä¸ä¸ªGossipæ¶æ¯æ¶ï¼é¤äºä¼ä¼ éèªèº«çç¶æä¿¡æ¯ï¼é»è®¤è¿ä¼ä¼ ééç¾¤ååä¹ä¸å®ä¾çç¶æä¿¡æ¯ã\n\næä»¥ï¼å¯¹äºä¸ä¸ªåå«äº1000ä¸ªå®ä¾çéç¾¤æ¥è¯´ï¼æ¯ä¸ªå®ä¾åéä¸ä¸ªPINGæ¶æ¯æ¶ï¼ä¼åå«100ä¸ªå®ä¾çç¶æä¿¡æ¯ï¼æ»çæ°æ®éæ¯ 10400å­èï¼åå ä¸åéå®ä¾èªèº«çä¿¡æ¯ï¼ä¸ä¸ªGossipæ¶æ¯å¤§çº¦æ¯10KBã\n\næ­¤å¤ï¼ä¸ºäºè®©Slotæ å°è¡¨è½å¤å¨ä¸åå®ä¾é´ä¼ æ­ï¼PINGæ¶æ¯ä¸­è¿å¸¦æä¸ä¸ªé¿åº¦ä¸º 16,384 bit ç Bitmapï¼è¿ä¸ªBitmapçæ¯ä¸ä½å¯¹åºäºä¸ä¸ªSlotï¼å¦ææä¸ä½ä¸º1ï¼å°±è¡¨ç¤ºè¿ä¸ªSlotå±äºå½åå®ä¾ãè¿ä¸ªBitmapå¤§å°æ¢ç®æå­èåï¼æ¯2KBãæä»¬æå®ä¾ç¶æä¿¡æ¯åSlotåéä¿¡æ¯ç¸å ï¼å°±å¯ä»¥å¾å°ä¸ä¸ªPINGæ¶æ¯çå¤§å°äºï¼å¤§çº¦æ¯12KBã\n\nPONGæ¶æ¯åPINGæ¶æ¯çåå®¹ä¸æ ·ï¼æä»¥ï¼å®çå¤§å°å¤§çº¦æ¯12KBãæ¯ä¸ªå®ä¾åéäºPINGæ¶æ¯åï¼è¿ä¼æ¶å°è¿åçPONGæ¶æ¯ï¼ä¸¤ä¸ªæ¶æ¯å èµ·æ¥æ24KBã\n\nè½ç¶ä»ç»å¯¹å¼ä¸æ¥çï¼24KB å¹¶ä¸ç®å¾å¤§ï¼ä½æ¯ï¼å¦æå®ä¾æ­£å¸¸å¤ççåä¸ªè¯·æ±åªæå KBçè¯ï¼é£ä¹ï¼å®ä¾ä¸ºäºç»´æ¤éç¾¤ç¶æä¸è´ä¼ è¾çPING/PONGæ¶æ¯ï¼å°±è¦æ¯åä¸ªä¸å¡è¯·æ±å¤§äºãèä¸ï¼æ¯ä¸ªå®ä¾é½ä¼ç»å¶å®å®ä¾åéPING/PONGæ¶æ¯ãéçéç¾¤è§æ¨¡å¢å ï¼è¿äºå¿è·³æ¶æ¯çæ°éä¹ä¼è¶å¤ï¼ä¼å æ®ä¸é¨åéç¾¤çç½ç»éä¿¡å¸¦å®½ï¼è¿èä¼éä½éç¾¤æå¡æ­£å¸¸å®¢æ·ç«¯è¯·æ±çååéã\n\né¤äºå¿è·³æ¶æ¯å¤§å°ä¼å½±åå°éä¿¡å¼éï¼å¦æå®ä¾é´éä¿¡éå¸¸é¢ç¹ï¼ä¹ä¼å¯¼è´éç¾¤ç½ç»å¸¦å®½è¢«é¢ç¹å ç¨ãé£ä¹ï¼Redis Cluster ä¸­å®ä¾çéä¿¡é¢çæ¯ä»ä¹æ ·çå¢ï¼\n\n# 2.1.2 å®ä¾é´éä¿¡é¢ç\n\nRedis Cluster çå®ä¾å¯å¨åï¼é»è®¤ä¼æ¯ç§ä»æ¬å°çå®ä¾åè¡¨ä¸­éæºéåº5ä¸ªå®ä¾ï¼åä»è¿5ä¸ªå®ä¾ä¸­æ¾åºä¸ä¸ªæä¹æ²¡æéä¿¡çå®ä¾ï¼æPINGæ¶æ¯åéç»è¯¥å®ä¾ãè¿æ¯å®ä¾å¨ææ§åéPINGæ¶æ¯çåºæ¬åæ³ã\n\nä½æ¯ï¼è¿éæä¸ä¸ªé®é¢ï¼å®ä¾éåºæ¥çè¿ä¸ªæä¹æ²¡æéä¿¡çå®ä¾ï¼æ¯ç«æ¯ä»éæºéåºç5ä¸ªå®ä¾ä¸­æéçï¼è¿å¹¶ä¸è½ä¿è¯è¿ä¸ªå®ä¾å°±ä¸å®æ¯æ´ä¸ªéç¾¤ä¸­æä¹æ²¡æéä¿¡çå®ä¾ãæä»¥ï¼è¿æå¯è½ä¼åºç°ï¼æäºå®ä¾ä¸ç´æ²¡æè¢«åéPINGæ¶æ¯ï¼å¯¼è´å®ä»¬ç»´æ¤çéç¾¤ç¶æå·²ç»è¿æäºã\n\nä¸ºäºé¿åè¿ç§æåµï¼Redis Clusterçå®ä¾ä¼æç§æ¯100msä¸æ¬¡çé¢çï¼æ«ææ¬å°çå®ä¾åè¡¨ï¼å¦æåç°æå®ä¾æè¿ä¸æ¬¡æ¥æ¶ PONGæ¶æ¯çæ¶é´ï¼å·²ç»å¤§äºéç½®é¡¹ cluster-node-timeoutçä¸åäºï¼cluster-node-timeout/2ï¼ï¼å°±ä¼ç«å»ç»è¯¥å®ä¾åé PINGæ¶æ¯ï¼æ´æ°è¿ä¸ªå®ä¾ä¸çéç¾¤ç¶æä¿¡æ¯ã\n\nå½éç¾¤è§æ¨¡æ©å¤§ä¹åï¼å ä¸ºç½ç»æ¥å¡ææ¯ä¸åæå¡å¨é´çæµéç«äºï¼ä¼å¯¼è´å®ä¾é´çç½ç»éä¿¡å»¶è¿å¢å ãå¦ææé¨åå®ä¾æ æ³æ¶å°å¶å®å®ä¾åéçPONGæ¶æ¯ï¼å°±ä¼å¼èµ·å®ä¾ä¹é´é¢ç¹å°åéPINGæ¶æ¯ï¼è¿åä¼å¯¹éç¾¤ç½ç»éä¿¡å¸¦æ¥é¢å¤çå¼éäºã\n\næä»¬æ¥æ»ç»ä¸åå®ä¾æ¯ç§ä¼åéçPINGæ¶æ¯æ°éï¼å¦ä¸æç¤ºï¼\n\n> PINGæ¶æ¯åéæ°é = 1 + 10 * å®ä¾æ°ï¼æè¿ä¸æ¬¡æ¥æ¶PONGæ¶æ¯çæ¶é´è¶åºcluster-node-timeout/2ï¼ å¶ä¸­ï¼1æ¯æåå®ä¾å¸¸è§æç§æ¯1ç§åéä¸ä¸ªPINGæ¶æ¯ï¼10æ¯ææ¯1ç§åå®ä¾ä¼æ§è¡10æ¬¡æ£æ¥ï¼æ¯æ¬¡æ£æ¥åä¼ç»PONGæ¶æ¯è¶æ¶çå®ä¾åéæ¶æ¯ã\n\nææ¥åå©ä¸ä¸ªä¾å­ï¼å¸¦ä½ åæä¸ä¸å¨è¿ç§éä¿¡é¢çä¸ï¼PINGæ¶æ¯å ç¨éç¾¤å¸¦å®½çæåµã\n\nåè®¾åä¸ªå®ä¾æ£æµåç°ï¼æ¯100æ¯«ç§æ10ä¸ªå®ä¾çPONGæ¶æ¯æ¥æ¶è¶æ¶ï¼é£ä¹ï¼è¿ä¸ªå®ä¾æ¯ç§å°±ä¼åé101ä¸ªPINGæ¶æ¯ï¼çº¦å 1.2MB/så¸¦å®½ãå¦æéç¾¤ä¸­æ30ä¸ªå®ä¾æç§è¿ç§é¢çåéæ¶æ¯ï¼å°±ä¼å ç¨36MB/så¸¦å®½ï¼è¿å°±ä¼æ¤å éç¾¤ä¸­ç¨äºæå¡æ­£å¸¸è¯·æ±çå¸¦å®½ã\n\næä»¥ï¼æä»¬è¦æ³åæ³éä½å®ä¾é´çéä¿¡å¼éï¼é£è¯¥æä¹åå¢ï¼\n\n\n# 2.2 å¦ä½éä½å®ä¾é´çéä¿¡å¼éï¼\n\nä¸ºäºéä½å®ä¾é´çéä¿¡å¼éï¼ä»åçä¸è¯´ï¼æä»¬å¯ä»¥åå°å®ä¾ä¼ è¾çæ¶æ¯å¤§å°ï¼PING/PONGæ¶æ¯ãSlotåéä¿¡æ¯ï¼ï¼ä½æ¯ï¼å ä¸ºéç¾¤å®ä¾ä¾èµPINGãPONGæ¶æ¯åSlotåéä¿¡æ¯ï¼æ¥ç»´æéç¾¤ç¶æçç»ä¸ï¼ä¸æ¦åå°äºä¼ éçæ¶æ¯å¤§å°ï¼å°±ä¼å¯¼è´å®ä¾é´çéä¿¡ä¿¡æ¯åå°ï¼ä¸å©äºéç¾¤ç»´æ¤ï¼æä»¥ï¼æä»¬ä¸è½éç¨è¿ç§æ¹å¼ã\n\né£ä¹ï¼æä»¬è½ä¸è½éä½å®ä¾é´åéæ¶æ¯çé¢çå¢ï¼æä»¬åæ¥åæä¸ä¸ã\n\nç»è¿åæçå­¦ä¹ ï¼æä»¬ç°å¨ç¥éï¼å®ä¾é´åéæ¶æ¯çé¢çæä¸¤ä¸ªã\n\n * æ¯ä¸ªå®ä¾æ¯1ç§åéä¸æ¡PINGæ¶æ¯ãè¿ä¸ªé¢çä¸ç®é«ï¼å¦æåéä½è¯¥é¢ççè¯ï¼éç¾¤ä¸­åå®ä¾çç¶æå¯è½å°±æ²¡åæ³åæ¶ä¼ æ­äºã\n * æ¯ä¸ªå®ä¾æ¯100æ¯«ç§ä¼åä¸æ¬¡æ£æµï¼ç»PONGæ¶æ¯æ¥æ¶è¶è¿cluster-node-timeout/2çèç¹åéPINGæ¶æ¯ãå®ä¾æç§æ¯100æ¯«ç§è¿è¡æ£æµçé¢çï¼æ¯Rediså®ä¾é»è®¤çå¨ææ§æ£æ¥ä»»å¡çç»ä¸é¢çï¼æä»¬ä¸è¬ä¸éè¦ä¿®æ¹å®ã\n\né£ä¹ï¼å°±åªæcluster-node-timeoutè¿ä¸ªéç½®é¡¹å¯ä»¥ä¿®æ¹äºã\n\néç½®é¡¹cluster-node-timeoutå®ä¹äºéç¾¤å®ä¾è¢«å¤æ­ä¸ºæéçå¿è·³è¶æ¶æ¶é´ï¼é»è®¤æ¯15ç§ãå¦æcluster-node-timeoutå¼æ¯è¾å°ï¼é£ä¹ï¼å¨å¤§è§æ¨¡éç¾¤ä¸­ï¼å°±ä¼æ¯è¾é¢ç¹å°åºç°PONGæ¶æ¯æ¥æ¶è¶æ¶çæåµï¼ä»èå¯¼è´å®ä¾æ¯ç§è¦æ§è¡10æ¬¡âç»PONGæ¶æ¯è¶æ¶çå®ä¾åéPINGæ¶æ¯âè¿ä¸ªæä½ã\n\næä»¥ï¼ä¸ºäºé¿åè¿å¤çå¿è·³æ¶æ¯æ¤å éç¾¤å¸¦å®½ï¼æä»¬å¯ä»¥è°å¤§cluster-node-timeoutå¼ï¼æ¯å¦è¯´è°å¤§å°20ç§æ25ç§ãè¿æ ·ä¸æ¥ï¼ PONGæ¶æ¯æ¥æ¶è¶æ¶çæåµå°±ä¼ææç¼è§£ï¼åå®ä¾ä¹ä¸ç¨é¢ç¹å°æ¯ç§æ§è¡10æ¬¡å¿è·³åéæä½äºã\n\nå½ç¶ï¼æä»¬ä¹ä¸è¦æcluster-node-timeoutè°å¾å¤ªå¤§ï¼å¦åï¼å¦æå®ä¾ççåçäºæéï¼æä»¬å°±éè¦ç­å¾cluster-node-timeoutæ¶é¿åï¼æè½æ£æµåºè¿ä¸ªæéï¼è¿åä¼å¯¼è´å®éçæéæ¢å¤æ¶é´è¢«å»¶é¿ï¼ä¼å½±åå°éç¾¤æå¡çæ­£å¸¸ä½¿ç¨ã\n\nä¸ºäºéªè¯è°æ´cluster-node-timeoutå¼åï¼æ¯å¦è½åå°å¿è·³æ¶æ¯å ç¨çéç¾¤ç½ç»å¸¦å®½ï¼æç»ä½ æä¸ªå°å»ºè®®ï¼ä½ å¯ä»¥å¨è°æ´cluster-node-timeoutå¼çååï¼ä½¿ç¨tcpdumpå½ä»¤æåå®ä¾åéå¿è·³ä¿¡æ¯ç½ç»åçæåµã\n\nä¾å¦ï¼æ§è¡ä¸é¢çå½ä»¤åï¼æä»¬å¯ä»¥æåå°192.168.10.3æºå¨ä¸çå®ä¾ä»16379ç«¯å£åéçå¿è·³ç½ç»åï¼å¹¶æç½ç»åçåå®¹ä¿å­å°r1.capæä»¶ä¸­ï¼\n\ntcpdump host 192.168.10.3 port 16379 -i ç½å¡å -w /tmp/r1.cap\n\n\n1\n\n\néè¿åæç½ç»åçæ°éåå¤§å°ï¼å°±å¯ä»¥å¤æ­è°æ´cluster-node-timeoutå¼ååï¼å¿è·³æ¶æ¯å ç¨çå¸¦å®½æåµäºã\n\nå»ºè®®ï¼å¦æä¸æ¯ç¹å«éè¦å¤§å®¹ééç¾¤ï¼æå¥½ æRedis Cluster çè§æ¨¡æ§å¶å¨ 400~500 ä¸ªå®ä¾ã\n\nåè®¾åä¸ªå®ä¾æ¯ç§è½æ¯æ8ä¸è¯·æ±æä½ï¼8ä¸QPSï¼ï¼æ¯ä¸ªä¸»å®ä¾éç½®1ä¸ªä»å®ä¾ï¼é£ä¹ï¼400~ 500ä¸ªå®ä¾å¯æ¯æ 1600ä¸~2000ä¸QPSï¼200/250ä¸ªä¸»å®ä¾*8ä¸QPS=1600/2000ä¸QPSï¼ï¼è¿ä¸ªååéæ§è½å¯ä»¥æ»¡è¶³ä¸å°ä¸å¡åºç¨çéæ±ã',normalizedContent:'> åèï¼\n> \n>  * 37 æ°æ®åå¸ä¼åï¼å¦ä½åºå¯¹æ°æ®å¾æï¼| æå®¢æ¶é´\n>  * 38 éä¿¡å¼éï¼éå¶redis clusterè§æ¨¡çå³é®å ç´ | æå®¢æ¶é´\n\n\n# 1. æ°æ®åå¸ä¼åï¼å¦ä½åºå¯¹æ°æ®å¾æï¼\n\nå¨ redis åçéç¾¤ä¸­ï¼æ°æ®é½ä¼æç§ crc ç®æ³çè®¡ç®å¼å¯¹ slot åæ¨¡ï¼ç¶ååæ å°å°æä¸ªå®ä¾ä¸ãè¿ç§æ¹æ³è½ç¶å®ç°ç®åï¼ä½å®¹æå¯¼è´ä¸ä¸ªé®é¢ï¼æ°æ®å¾æã\n\næ°æ®å¾ææä¸¤ç±»ï¼\n\n * æ°æ®éå¾æï¼å¨æäºæåµä¸ï¼å®ä¾ä¸çæ°æ®åå¸ä¸åè¡¡ï¼æä¸ªå®ä¾ä¸çæ°æ®ç¹å«å¤ã\n * æ°æ®è®¿é®å¾æï¼è½ç¶æ¯ä¸ªéç¾¤å®ä¾ä¸çæ°æ®éç¸å·®ä¸å¤§ï¼ä½æ¯æä¸ªå®ä¾ä¸çæ°æ®æ¯ç­ç¹æ°æ®ï¼è¢«è®¿é®å¾éå¸¸é¢ç¹ã\n\nå¦æåçäºæ°æ®å¾æï¼é£ä¹ä¿å­äºå¤§éæ°æ®ï¼æèæ¯ä¿å­äºç­ç¹æ°æ®çå®ä¾çå¤çååå°±ä¼å¢å¤§ï¼éåº¦åæ¢ï¼çè³è¿å¯è½ä¼å¼èµ·è¿ä¸ªå®ä¾çåå­èµæºèå°½ï¼ä»èå´©æºãè¿æ¯æä»¬å¨åºç¨åçéç¾¤æ¶è¦é¿åçã\n\nè¿ä¸å¤§èå°è®¨è®ºæ°æ®å¾ææ¯å¦ä½åççï¼ä»¥åå¦ä½åºå¯¹ã\n\n\n# 1.1 æ°æ®éå¾æçæå ååºå¯¹æ¹æ³\n\nå½æ°æ®éå¾æåçæ¶ï¼æ°æ®å¨åçéç¾¤çå¤ä¸ªå®ä¾ä¸åå¸ä¸åè¡¡ï¼å¤§éæ°æ®éä¸­å°äºä¸ä¸ªæå ä¸ªå®ä¾ä¸ï¼å¦ä¸å¾æç¤ºï¼\n\né£ä¹ï¼æ°æ®éå¾ææ¯æä¹äº§ççå¢ï¼è¿ä¸»è¦æä¸ä¸ªåå ï¼åå«æ¯æä¸ªå®ä¾ä¸ä¿å­äºbigkeyãslotåéä¸åè¡¡ä»¥åhash tagãæ¥ä¸æ¥ï¼æä»¬å°±ä¸ä¸ªä¸ä¸ªæ¥åæï¼åæ¶æè¿ä¼ç»ä½ è®²è§£ç¸åºçè§£å³æ¹æ¡ã\n\n# 1.1.1 bigkey å¯¼è´å¾æ\n\nç¬¬ä¸ä¸ªåå æ¯ï¼æä¸ªå®ä¾ä¸æ­£å¥½ä¿å­äºbigkeyãbigkeyçvalueå¼å¾å¤§ï¼stringç±»åï¼ï¼æèæ¯bigkeyä¿å­äºå¤§ééååç´ ï¼éåç±»åï¼ï¼ä¼å¯¼è´è¿ä¸ªå®ä¾çæ°æ®éå¢å ï¼åå­èµæºæ¶èä¹ç¸åºå¢å ã\n\nèä¸ï¼bigkeyçæä½ä¸è¬é½ä¼é æå®ä¾ioçº¿ç¨é»å¡ï¼å¦æbigkeyçè®¿é®éæ¯è¾å¤§ï¼å°±ä¼å½±åå°è¿ä¸ªå®ä¾ä¸çå¶å®è¯·æ±è¢«å¤ççéåº¦ã\n\nå¶å®ï¼bigkeyå·²ç»æ¯æä»¬è¯¾ç¨ä¸­åå¤æå°çä¸ä¸ªå³é®ç¹äºãä¸ºäºé¿åbigkeyé æçæ°æ®å¾æï¼ä¸ä¸ªæ ¹æ¬çåºå¯¹æ¹æ³æ¯ï¼æä»¬å¨ä¸å¡å±çææ°æ®æ¶ï¼è¦å°½éé¿åæè¿å¤çæ°æ®ä¿å­å¨åä¸ä¸ªé®å¼å¯¹ä¸­ãæ­¤å¤ï¼å¦æ bigkey æ­£å¥½æ¯éåç±»åï¼é£å¯ä»¥æå®ææå¤ä¸ªå°çéåç±»åæ°æ®ï¼åæ£ä¿å­å¨ä¸åçå®ä¾ä¸ãæä¸ä¸ªbigkeyåæ´ä¸ºé¶ãåæ£ä¿å­äºï¼é¿åäºbigkeyç»åä¸ªåçå®ä¾å¸¦æ¥çè®¿é®ååã\n\néè¦æ³¨æçæ¯ï¼å½ bigkey è®¿é®éè¾å¤§æ¶ï¼ä¹ä¼é ææ°æ®è®¿é®å¾æã\n\n# 1.1.2 slot åéä¸åè¡¡å¯¼è´å¾æ\n\nå¦æéç¾¤è¿ç»´äººåæ²¡æåè¡¡å°åé slotï¼å°±ä¼æå¤§éçæ°æ®è¢«åéå°åä¸ä¸ª slot ä¸­ï¼èåä¸ä¸ª slot åªä¼å¨ä¸ä¸ªå®ä¾ä¸åå¸ï¼è¿å°±ä¼å¯¼è´ï¼å¤§éæ°æ®è¢«éä¸­å°ä¸ä¸ªå®ä¾ä¸ï¼é ææ°æ®å¾æã\n\nä¸ºäºåºå¯¹è¿ä¸ªé®é¢ï¼æä»¬å¯ä»¥éè¿è¿ç»´è§èï¼å¨åéä¹åï¼æä»¬å°±è¦é¿åæè¿å¤ç slot åéå°åä¸ä¸ªå®ä¾ãå¦ææ¯å·²ç»åéå¥½slotçéç¾¤ï¼æä»¬å¯ä»¥åæ¥çslotåå®ä¾çå·ä½åéå³ç³»ï¼ä»èå¤æ­æ¯å¦æè¿å¤çslotéä¸­å°äºåä¸ä¸ªå®ä¾ãå¦ææçè¯ï¼å°±å°é¨åslotè¿ç§»å°å¶å®å®ä¾ï¼ä»èé¿åæ°æ®å¾æã\n\nä¸åéç¾¤ä¸æ¥çslotåéæåµçæ¹å¼ä¸åï¼å¦ææ¯redis clusterï¼å°±ç¨cluster slotså½ä»¤ï¼å¦ææ¯codisï¼å°±å¯ä»¥å¨codis dashboardä¸æ¥çã\n\nredis cluster ä¸­ slot çè¿ç§»\n\næ¯å¦è¯´ï¼æä»¬æ§è¡cluster slotså½ä»¤æ¥çslotåéæåµãå½ä»¤è¿åç»ææ¾ç¤ºï¼slot 0 å°slot 4095è¢«åéå°äºå®ä¾192.168.10.3ä¸ï¼èslot 12288å°slot 16383è¢«åéå°äºå®ä¾192.168.10.5ä¸ã\n\n127.0.0.1:6379> cluster slots\n1) 1) (integer) 0\n   1) (integer) 4095\n   2) 1) "192.168.10.3"\n      1) (integer) 6379\n2) 1) (integer) 12288\n   1) (integer) 16383\n   2) 1) "192.168.10.5"\n      1) (integer) 6379\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¦ææä¸ä¸ªå®ä¾ä¸æå¤ªå¤çslotï¼æä»¬å°±å¯ä»¥ä½¿ç¨è¿ç§»å½ä»¤æè¿äºslotè¿ç§»å°å¶å®å®ä¾ä¸ãå¨redis clusterä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨3ä¸ªå½ä»¤å®æslotè¿ç§»ã\n\n 1. cluster setslotï¼ä½¿ç¨ä¸åçéé¡¹è¿è¡ä¸ç§è®¾ç½®ï¼åå«æ¯è®¾ç½®slotè¦è¿å¥çç®æ å®ä¾ï¼slotè¦è¿åºçæºå®ä¾ï¼ä»¥åslotæå±çå®ä¾ã\n 2. cluster getkeysinslotï¼è·åæä¸ªslotä¸­ä¸å®æ°éçkeyã\n 3. migrateï¼æä¸ä¸ªkeyä»æºå®ä¾å®éè¿ç§»å°ç®æ å®ä¾ã\n\nææ¥åå©ä¸ä¸ªä¾å­ï¼å¸¦ä½ äºè§£ä¸è¿ä¸ä¸ªå½ä»¤æä¹ç¨ã\n\nåè®¾æä»¬è¦æslot 300ä»æºå®ä¾ï¼idä¸º3ï¼è¿ç§»å°ç®æ å®ä¾ï¼idä¸º5ï¼ï¼é£è¦æä¹åå¢ï¼\n\nå®éä¸ï¼æä»¬å¯ä»¥åæ5æ­¥ã\n\nç¬¬1æ­¥ï¼æä»¬åå¨ç®æ å®ä¾5ä¸æ§è¡ä¸é¢çå½ä»¤ï¼å°slot 300çæºå®ä¾è®¾ç½®ä¸ºå®ä¾3ï¼è¡¨ç¤ºè¦ä»å®ä¾3ä¸è¿å¥slot 300ã\n\ncluster setslot 300 importing 3\n\n\n1\n\n\nç¬¬2æ­¥ï¼å¨æºå®ä¾3ä¸ï¼æä»¬æslot 300çç®æ å®ä¾è®¾ç½®ä¸º5ï¼è¿è¡¨ç¤ºï¼slot 300è¦è¿åºå°å®ä¾5ä¸ï¼å¦ä¸æç¤ºï¼\n\ncluster setslot 300 migrating 5\n\n\n1\n\n\nç¬¬3æ­¥ï¼ä»slot 300ä¸­è·å100 ä¸ªkeyãå ä¸ºslotä¸­çkeyæ°éå¯è½å¾å¤ï¼æä»¥æä»¬éè¦å¨å®¢æ·ç«¯ä¸å¤æ¬¡æ§è¡ä¸é¢çè¿æ¡å½ä»¤ï¼åæ¹æ¬¡è·å¾å¹¶è¿ç§»keyã\n\ncluster getkeysinslot 300 100\n\n\n1\n\n\nç¬¬4æ­¥ï¼æä»¬æåæè·åç100ä¸ªkeyä¸­çkey1è¿ç§»å°ç®æ å®ä¾5ä¸ï¼ipä¸º192.168.10.5ï¼ï¼åæ¶æè¦è¿å¥çæ°æ®åºè®¾ç½®ä¸º0å·æ°æ®åºï¼æè¿ç§»çè¶æ¶æ¶é´è®¾ç½®ä¸ºtimeoutãæä»¬éå¤æ§è¡migrateå½ä»¤ï¼æ100ä¸ªkeyé½è¿ç§»å®ã\n\nmigrate 192.168.10.5 6379 key1 0 timeout\n\n\n1\n\n\næåï¼æä»¬éå¤æ§è¡ç¬¬3åç¬¬4æ­¥ï¼ç´å°slotä¸­çæækeyé½è¿ç§»å®æã\n\nä»redis 3.0.6å¼å§ï¼ä½ ä¹å¯ä»¥ä½¿ç¨keyséé¡¹ï¼ä¸æ¬¡è¿ç§»å¤ä¸ªkeyï¼key1ã2ã3ï¼ï¼è¿æ ·å¯ä»¥æåè¿ç§»æçã\n\nmigrate 192.168.10.5 6379 "" 0 timeout keys key1 key2 key3\n\n\n1\n\n\nå¯¹äºcodisæ¥è¯´ï¼æä»¬å¯ä»¥æ§è¡ä¸é¢çå½ä»¤è¿è¡æ°æ®è¿ç§»ãå¶ä¸­ï¼æä»¬ædashboardç»ä»¶çè¿æ¥å°åè®¾ç½®ä¸ºaddrï¼å¹¶ä¸æslot 300è¿ç§»å°ç¼å·ä¸º6çcodis server groupä¸ã\n\ncodis-admin --dashboard=addr -slot-action --create --sid=300 --gid=6\n\n\n1\n\n\né¤äº bigkey å slot åéä¸åè¡¡ä¼å¯¼è´æ°æ®éå¾æï¼è¿æä¸ä¸ªå¯¼è´å¾æçåå ï¼å°±æ¯ä½¿ç¨äº hash tag è¿è¡æ°æ®åçã\n\n# 1.1.3 hash tag å¯¼è´å¾æ\n\nhash tag æ¯æå å¨é®å¼å¯¹ key ä¸­çä¸å¯¹è±æ¬å· {}ãè¿å¯¹æ¬å·ä¼æ key çä¸é¨åæ¬èµ·æ¥ï¼å®¢æ·ç«¯å¨è®¡ç® key ç crc16 å¼æ¶ï¼åªå¯¹ hash tag è±æ¬å·ä¸­ç key åå®¹è¿è¡è®¡ç®ãå¦ææ²¡ç¨ hash tag çè¯ï¼å®¢æ·ç«¯è®¡ç®æ´ä¸ª key ç crc16 çå¼ã\n\n> ä¸¾ä¸ªä¾å­ï¼åè®¾keyæ¯user:profile:3231ï¼æä»¬æå¶ä¸­ç3231ä½ä¸ºhash tagï¼æ­¤æ¶ï¼keyå°±åæäºuser:profile:{3231}ãå½å®¢æ·ç«¯è®¡ç®è¿ä¸ªkeyçcrc16å¼æ¶ï¼å°±åªä¼è®¡ç®3231çcrc16å¼ãå¦åï¼å®¢æ·ç«¯ä¼è®¡ç®æ´ä¸ªâuser:profile:3231âçcrc16å¼ã\n\nä½¿ç¨ hash tag çå¥½å¤æ¯ï¼å¦æä¸å key ç hash tag åå®¹é½æ¯ä¸æ ·çï¼é£ä¹ï¼è¿äº key å¯¹åºçæ°æ®ä¼è¢«æ å°å°åä¸ä¸ª slot ä¸­ï¼åæ¶ä¼è¢«åéå°åä¸ä¸ªå®ä¾ä¸ã\n\nhash tag ä¸»è¦æ¯ç¨å¨ redis cluster å codis ä¸­ï¼æ¯æäºå¡æä½åèå´æ¥è¯¢ãå ä¸º redis cluster å codis æ¬èº«å¹¶ä¸æ¯æè·¨å®ä¾çäºå¡æä½åèå´æ¥è¯¢ï¼å½ä¸å¡åºç¨æè¿äºéæ±æ¶ï¼å°±åªè½åæè¿äºæ°æ®è¯»åå°ä¸å¡å±è¿è¡äºå¡å¤çï¼æèæ¯éä¸ªæ¥è¯¢æ¯ä¸ªå®ä¾ï¼å¾å°èå´æ¥è¯¢çç»æãè¿æ ·æä½èµ·æ¥éå¸¸éº»ç¦ï¼æä»¥ï¼æä»¬å¯ä»¥ä½¿ç¨ hash tag æè¦æ§è¡äºå¡æä½ææ¯èå´æ¥è¯¢çæ°æ®æ å°å°åä¸ä¸ªå®ä¾ä¸ï¼è¿æ ·å°±è½å¾è½»æ¾å°å®ç°äºå¡æèå´æ¥è¯¢äºã\n\nä½æ¯ï¼ä½¿ç¨hash tagçæ½å¨é®é¢ï¼å°±æ¯å¤§éçæ°æ®å¯è½è¢«éä¸­å°ä¸ä¸ªå®ä¾ä¸ï¼å¯¼è´æ°æ®å¾æï¼éç¾¤ä¸­çè´è½½ä¸åè¡¡ãé£ä¹ï¼è¯¥æä¹åºå¯¹è¿ç§é®é¢å¢ï¼æä»¬å°±éè¦å¨èå´æ¥è¯¢ãäºå¡æ§è¡çéæ±åæ°æ®å¾æå¸¦æ¥çè®¿é®ååä¹é´ï¼è¿è¡åèäºã\n\næçå»ºè®®æ¯ï¼å¦æä½¿ç¨hash tagè¿è¡åççæ°æ®ä¼å¸¦æ¥è¾å¤§çè®¿é®ååï¼å°±ä¼åèèé¿åæ°æ®å¾æï¼æå¥½ä¸è¦ä½¿ç¨hash tagè¿è¡æ°æ®åçãå ä¸ºäºå¡åèå´æ¥è¯¢é½è¿å¯ä»¥æ¾å¨å®¢æ·ç«¯æ¥æ§è¡ï¼èæ°æ®å¾æä¼å¯¼è´å®ä¾ä¸ç¨³å®ï¼é ææå¡ä¸å¯ç¨ã\n\n----------------------------------------\n\nä»¥ä¸ä»ç»äºæ°æ®éå¾æçåå ä»¥ååºå¯¹æ¹æ³ãä¸é¢çä¸ä¸æ°æ®è®¿é®å¾æçåå ååºå¯¹æ¹æ³ã\n\n\n# 1.2 æ°æ®è®¿é®å¾æçæå ååºå¯¹æ¹æ³\n\nåçæ°æ®è®¿é®å¾æçæ ¹æ¬åå ï¼å°±æ¯å®ä¾ä¸å­å¨ç­ç¹æ°æ®ãä¸æ¦ç­ç¹æ°æ®è¢«å­å¨äºæä¸ªå®ä¾ä¸­ï¼é£ä¹ï¼è¿ä¸ªå®ä¾çè¯·æ±è®¿é®éå°±ä¼è¿é«äºå¶å®å®ä¾ï¼é¢ä¸´å·¨å¤§çè®¿é®ååãå¦ä¸å¾æç¤ºï¼\n\nå¦ä½åºå¯¹å¢ï¼åæ°æ®éå¾æä¸åï¼ç­ç¹æ°æ®éå¸¸æ¯ä¸ä¸ªæå ä¸ªæ°æ®ï¼æä»¥ï¼ç´æ¥éæ°åé slot å¹¶ä¸è½è§£å³ç­ç¹æ°æ®çé®é¢ã\n\néå¸¸æ¥è¯´ï¼ç­ç¹æ°æ®ä»¥æå¡è¯»æä½ä¸ºä¸»ï¼å¨è¿ç§æåµä¸ï¼æä»¬å¯ä»¥éç¨ç­ç¹æ°æ®å¤å¯æ¬çæ¹æ³æ¥åºå¯¹ãè¿ä¸ªæ¹æ³çå·ä½åæ³æ¯ï¼æä»¬æç­ç¹æ°æ®å¤å¶å¤ä»½ï¼å¨æ¯ä¸ä¸ªæ°æ®å¯æ¬çkeyä¸­å¢å ä¸ä¸ªéæºåç¼ï¼è®©å®åå¶å®å¯æ¬æ°æ®ä¸ä¼è¢«æ å°å°åä¸ä¸ªslotä¸­ãè¿æ ·ä¸æ¥ï¼ç­ç¹æ°æ®æ¢æå¤ä¸ªå¯æ¬å¯ä»¥åæ¶æå¡è¯·æ±ï¼åæ¶ï¼è¿äºå¯æ¬æ°æ®çkeyåä¸ä¸æ ·ï¼ä¼è¢«æ å°å°ä¸åçslotä¸­ãå¨ç»è¿äºslotåéå®ä¾æ¶ï¼æä»¬ä¹è¦æ³¨ææå®ä»¬åéå°ä¸åçå®ä¾ä¸ï¼é£ä¹ï¼ç­ç¹æ°æ®çè®¿é®ååå°±è¢«åæ£å°ä¸åçå®ä¾ä¸äºã\n\nè¿éï¼æä¸ªå°æ¹éè¦æ³¨æä¸ï¼ç­ç¹æ°æ®å¤å¯æ¬æ¹æ³åªè½éå¯¹åªè¯»çç­ç¹æ°æ®ãå¦æç­ç¹æ°æ®æ¯æè¯»æåçè¯ï¼å°±ä¸éåéç¨å¤å¯æ¬æ¹æ³äºï¼å ä¸ºè¦ä¿è¯å¤å¯æ¬é´çæ°æ®ä¸è´æ§ï¼ä¼å¸¦æ¥é¢å¤çå¼éã\n\nå¯¹äºæè¯»æåçç­ç¹æ°æ®ï¼æä»¬å°±è¦ç»å®ä¾æ¬èº«å¢å èµæºäºï¼ä¾å¦ä½¿ç¨éç½®æ´é«çæºå¨ï¼æ¥åºå¯¹å¤§éçè®¿é®ååã\n\n\n# 1.3 å°ç»\n\nè¿ä¸å¤§èä»ç»äºæ°æ®å¾æçä¸¤ç§æåµï¼æ°æ®éå¾æåæ°æ®è®¿é®å¾æã\n\né ææ°æ®éå¾æçåå ä¸»è¦æä¸ä¸ªï¼\n\n 1. æ°æ®ä¸­æbigkeyï¼å¯¼è´æä¸ªå®ä¾çæ°æ®éå¢å ï¼\n 2. slotæå·¥åéä¸åï¼å¯¼è´æä¸ªææäºå®ä¾ä¸æå¤§éæ°æ®ï¼\n 3. ä½¿ç¨äºhash tagï¼å¯¼è´æ°æ®éä¸­å°æäºå®ä¾ä¸ã\n\nèæ°æ®è®¿é®å¾æçä¸»è¦åå å°±æ¯æç­ç¹æ°æ®å­å¨ï¼å¯¼è´å¤§éè®¿é®è¯·æ±éä¸­å°äºç­ç¹æ°æ®æå¨çå®ä¾ä¸ã\n\nä¸è¡¨å¯¹ä»¥ä¸æåµè¿è¡äºæ»ç»ï¼\n\nå¦æå·²ç»åçäºæ°æ®å¾æï¼æä»¬å¯ä»¥éè¿æ°æ®è¿ç§»æ¥ç¼è§£æ°æ®å¾æçå½±åã\n\næåï¼å³äºéç¾¤çå®ä¾èµæºéç½®ï¼æåç»ä½ ä¸ä¸ªå°å»ºè®®ï¼å¨æå»ºåçéç¾¤æ¶ï¼å°½éä½¿ç¨å¤§å°éç½®ç¸åçå®ä¾ï¼ä¾å¦å®ä¾åå­éç½®ä¿æç¸åï¼ï¼è¿æ ·å¯ä»¥é¿åå å®ä¾èµæºä¸åè¡¡èå¨ä¸åå®ä¾ä¸åéä¸åæ°éçslotã\n\n\n# 2. éä¿¡å¼éï¼éå¶ redis cluster è§æ¨¡çå³é®å ç´ \n\nredis clusterè½ä¿å­çæ°æ®éä»¥åæ¯æçååéï¼è·éç¾¤çå®ä¾è§æ¨¡å¯åç¸å³ãrediså®æ¹ç»åºäºredis clusterçè§æ¨¡ä¸éï¼å°±æ¯ä¸ä¸ªéç¾¤è¿è¡1000ä¸ªå®ä¾ã\n\néå¶ redis éç¾¤æ°éçä¸ä¸ªå³é®å ç´ å°±æ¯ï¼å®ä¾é´çéä¿¡å¼éä¼éçå®ä¾è§æ¨¡å¢å èå¢å¤§ãå¨éç¾¤è¶è¿ä¸å®è§æ¨¡æ¶ï¼æ¯å¦ 800 èç¹ï¼ï¼éç¾¤ååéåèä¼ä¸éãæä»¥ï¼éç¾¤çå®éè§æ¨¡ä¼åå°éå¶ã\n\nè¿ä¸å¤§èå°è®¨è®ºéç¾¤å®ä¾é´çéä¿¡å¼éæ¯å¦ä½å½±åredis clusterè§æ¨¡çï¼ä»¥åå¦ä½éä½å®ä¾é´çéä¿¡å¼éã\n\n\n# 2.1 å®ä¾éä¿¡æ¹æ³åå¯¹éç¾¤è§æ¨¡çå½±å\n\nredis cluster å¨è¿è¡æ¶ï¼æ¯ä¸ªå®ä¾ä¸é½ä¼ä¿å­ slot åå®ä¾çå¯¹åºå³ç³»ï¼ä¹å°±æ¯slotæ å°è¡¨ï¼ï¼ä»¥åèªèº«çç¶æä¿¡æ¯ãå®ä¾ä¹é´ä¸ºäºäºéè¿äºç¶æä¿¡æ¯ï¼ä¼ä½¿ç¨ gossip åè®®æ¥è¿è¡éä¿¡ã\n\ngossipåè®®çå·¥ä½åçå¯ä»¥æ¦æ¬æä¸¤ç¹ã\n\n * ä¸æ¯ï¼æ¯ä¸ªå®ä¾ä¹é´ä¼æç§ä¸å®çé¢çï¼ä»éç¾¤ä¸­éæºæéä¸äºå®ä¾ï¼æpingæ¶æ¯åéç»æéåºæ¥çå®ä¾ï¼ç¨æ¥æ£æµè¿äºå®ä¾æ¯å¦å¨çº¿ï¼å¹¶äº¤æ¢å½¼æ­¤çç¶æä¿¡æ¯ãpingæ¶æ¯ä¸­å°è£äºåéæ¶æ¯çå®ä¾èªèº«çç¶æä¿¡æ¯ãé¨åå¶å®å®ä¾çç¶æä¿¡æ¯ï¼ä»¥åslotæ å°è¡¨ã\n * äºæ¯ï¼ä¸ä¸ªå®ä¾å¨æ¥æ¶å°pingæ¶æ¯åï¼ä¼ç»åépingæ¶æ¯çå®ä¾ï¼åéä¸ä¸ªpongæ¶æ¯ãpongæ¶æ¯åå«çåå®¹åpingæ¶æ¯ä¸æ ·ã\n\nä¸å¾æ¾ç¤ºäºä¸¤ä¸ªå®ä¾é´è¿è¡ pingãpong æ¶æ¯ä¼ éçæåµï¼\n\ngossip åè®®å¯ä»¥ä¿è¯å¨ä¸æ®µæ¶é´åï¼éç¾¤ä¸­çæ¯ä¸ä¸ªå®ä¾é½è½è·å¾å¶å®ææå®ä¾çç¶æä¿¡æ¯ãè¿æ ·ä¸æ¥ï¼å³ä½¿ææ°èç¹å å¥ãèç¹æéãslot åæ´ç­äºä»¶åçï¼å®ä¾é´ä¹å¯ä»¥éè¿ pingãpong æ¶æ¯çä¼ éï¼å®æéç¾¤ç¶æå¨æ¯ä¸ªå®ä¾ä¸çåæ­¥ã\n\nå¯ä»¥ç´è§çå°ï¼å®ä¾ä¹é´ä½¿ç¨ gossip åè®®éä¿¡æ¶ï¼éä¿¡å¼éä¼åå°éä¿¡æ¶æ¯å¤§å°åéä¿¡é¢çè¿ä¸¤æ¹é¢çå½±åï¼æ¶æ¯è¶å¤§ãé¢çè¶é«ï¼ç¸åºçéä¿¡å¼éä¹å°±è¶å¤§ãå¦ææ³è¦å®ç°é«æçéä¿¡ï¼å¯ä»¥ä»è¿ä¸¤æ¹é¢å¥æå»è°ä¼ã\n\n# 2.1.1 gossip æ¶æ¯å¤§å°\n\nredis å®ä¾åéç ping æ¶æ¯çæ¶æ¯ä½æ¯ç± clustermsgdatagossip ç»æä½ç»æçï¼è¿ä¸ªç»æä½çå®ä¹å¦ä¸æç¤ºï¼\n\ntypedef struct {\n    char nodename[cluster_namelen];  //40å­è\n    uint32_t ping_sent; //4å­è\n    uint32_t pong_received; //4å­è\n    char ip[net_ip_str_len]; //46å­è\n    uint16_t port;  //2å­è\n    uint16_t cport;  //2å­è\n    uint16_t flags;  //2å­è\n    uint32_t notused1; //4å­è\n} clustermsgdatagossip;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå¶ä¸­ï¼cluster_namelenånet_ip_str_lençå¼åå«æ¯40å46ï¼åå«è¡¨ç¤ºï¼nodenameåipè¿ä¸¤ä¸ªå­èæ°ç»çé¿åº¦æ¯40å­èå46å­èï¼æä»¬åæç»æä½ä¸­å¶å®ä¿¡æ¯çå¤§å°å èµ·æ¥ï¼å°±å¯ä»¥å¾å°ä¸ä¸ªgossipæ¶æ¯çå¤§å°äºï¼å³104å­èã\n\næ¯ä¸ªå®ä¾å¨åéä¸ä¸ªgossipæ¶æ¯æ¶ï¼é¤äºä¼ä¼ éèªèº«çç¶æä¿¡æ¯ï¼é»è®¤è¿ä¼ä¼ ééç¾¤ååä¹ä¸å®ä¾çç¶æä¿¡æ¯ã\n\næä»¥ï¼å¯¹äºä¸ä¸ªåå«äº1000ä¸ªå®ä¾çéç¾¤æ¥è¯´ï¼æ¯ä¸ªå®ä¾åéä¸ä¸ªpingæ¶æ¯æ¶ï¼ä¼åå«100ä¸ªå®ä¾çç¶æä¿¡æ¯ï¼æ»çæ°æ®éæ¯ 10400å­èï¼åå ä¸åéå®ä¾èªèº«çä¿¡æ¯ï¼ä¸ä¸ªgossipæ¶æ¯å¤§çº¦æ¯10kbã\n\næ­¤å¤ï¼ä¸ºäºè®©slotæ å°è¡¨è½å¤å¨ä¸åå®ä¾é´ä¼ æ­ï¼pingæ¶æ¯ä¸­è¿å¸¦æä¸ä¸ªé¿åº¦ä¸º 16,384 bit ç bitmapï¼è¿ä¸ªbitmapçæ¯ä¸ä½å¯¹åºäºä¸ä¸ªslotï¼å¦ææä¸ä½ä¸º1ï¼å°±è¡¨ç¤ºè¿ä¸ªslotå±äºå½åå®ä¾ãè¿ä¸ªbitmapå¤§å°æ¢ç®æå­èåï¼æ¯2kbãæä»¬æå®ä¾ç¶æä¿¡æ¯åslotåéä¿¡æ¯ç¸å ï¼å°±å¯ä»¥å¾å°ä¸ä¸ªpingæ¶æ¯çå¤§å°äºï¼å¤§çº¦æ¯12kbã\n\npongæ¶æ¯åpingæ¶æ¯çåå®¹ä¸æ ·ï¼æä»¥ï¼å®çå¤§å°å¤§çº¦æ¯12kbãæ¯ä¸ªå®ä¾åéäºpingæ¶æ¯åï¼è¿ä¼æ¶å°è¿åçpongæ¶æ¯ï¼ä¸¤ä¸ªæ¶æ¯å èµ·æ¥æ24kbã\n\nè½ç¶ä»ç»å¯¹å¼ä¸æ¥çï¼24kb å¹¶ä¸ç®å¾å¤§ï¼ä½æ¯ï¼å¦æå®ä¾æ­£å¸¸å¤ççåä¸ªè¯·æ±åªæå kbçè¯ï¼é£ä¹ï¼å®ä¾ä¸ºäºç»´æ¤éç¾¤ç¶æä¸è´ä¼ è¾çping/pongæ¶æ¯ï¼å°±è¦æ¯åä¸ªä¸å¡è¯·æ±å¤§äºãèä¸ï¼æ¯ä¸ªå®ä¾é½ä¼ç»å¶å®å®ä¾åéping/pongæ¶æ¯ãéçéç¾¤è§æ¨¡å¢å ï¼è¿äºå¿è·³æ¶æ¯çæ°éä¹ä¼è¶å¤ï¼ä¼å æ®ä¸é¨åéç¾¤çç½ç»éä¿¡å¸¦å®½ï¼è¿èä¼éä½éç¾¤æå¡æ­£å¸¸å®¢æ·ç«¯è¯·æ±çååéã\n\né¤äºå¿è·³æ¶æ¯å¤§å°ä¼å½±åå°éä¿¡å¼éï¼å¦æå®ä¾é´éä¿¡éå¸¸é¢ç¹ï¼ä¹ä¼å¯¼è´éç¾¤ç½ç»å¸¦å®½è¢«é¢ç¹å ç¨ãé£ä¹ï¼redis cluster ä¸­å®ä¾çéä¿¡é¢çæ¯ä»ä¹æ ·çå¢ï¼\n\n# 2.1.2 å®ä¾é´éä¿¡é¢ç\n\nredis cluster çå®ä¾å¯å¨åï¼é»è®¤ä¼æ¯ç§ä»æ¬å°çå®ä¾åè¡¨ä¸­éæºéåº5ä¸ªå®ä¾ï¼åä»è¿5ä¸ªå®ä¾ä¸­æ¾åºä¸ä¸ªæä¹æ²¡æéä¿¡çå®ä¾ï¼æpingæ¶æ¯åéç»è¯¥å®ä¾ãè¿æ¯å®ä¾å¨ææ§åépingæ¶æ¯çåºæ¬åæ³ã\n\nä½æ¯ï¼è¿éæä¸ä¸ªé®é¢ï¼å®ä¾éåºæ¥çè¿ä¸ªæä¹æ²¡æéä¿¡çå®ä¾ï¼æ¯ç«æ¯ä»éæºéåºç5ä¸ªå®ä¾ä¸­æéçï¼è¿å¹¶ä¸è½ä¿è¯è¿ä¸ªå®ä¾å°±ä¸å®æ¯æ´ä¸ªéç¾¤ä¸­æä¹æ²¡æéä¿¡çå®ä¾ãæä»¥ï¼è¿æå¯è½ä¼åºç°ï¼æäºå®ä¾ä¸ç´æ²¡æè¢«åépingæ¶æ¯ï¼å¯¼è´å®ä»¬ç»´æ¤çéç¾¤ç¶æå·²ç»è¿æäºã\n\nä¸ºäºé¿åè¿ç§æåµï¼redis clusterçå®ä¾ä¼æç§æ¯100msä¸æ¬¡çé¢çï¼æ«ææ¬å°çå®ä¾åè¡¨ï¼å¦æåç°æå®ä¾æè¿ä¸æ¬¡æ¥æ¶ pongæ¶æ¯çæ¶é´ï¼å·²ç»å¤§äºéç½®é¡¹ cluster-node-timeoutçä¸åäºï¼cluster-node-timeout/2ï¼ï¼å°±ä¼ç«å»ç»è¯¥å®ä¾åé pingæ¶æ¯ï¼æ´æ°è¿ä¸ªå®ä¾ä¸çéç¾¤ç¶æä¿¡æ¯ã\n\nå½éç¾¤è§æ¨¡æ©å¤§ä¹åï¼å ä¸ºç½ç»æ¥å¡ææ¯ä¸åæå¡å¨é´çæµéç«äºï¼ä¼å¯¼è´å®ä¾é´çç½ç»éä¿¡å»¶è¿å¢å ãå¦ææé¨åå®ä¾æ æ³æ¶å°å¶å®å®ä¾åéçpongæ¶æ¯ï¼å°±ä¼å¼èµ·å®ä¾ä¹é´é¢ç¹å°åépingæ¶æ¯ï¼è¿åä¼å¯¹éç¾¤ç½ç»éä¿¡å¸¦æ¥é¢å¤çå¼éäºã\n\næä»¬æ¥æ»ç»ä¸åå®ä¾æ¯ç§ä¼åéçpingæ¶æ¯æ°éï¼å¦ä¸æç¤ºï¼\n\n> pingæ¶æ¯åéæ°é = 1 + 10 * å®ä¾æ°ï¼æè¿ä¸æ¬¡æ¥æ¶pongæ¶æ¯çæ¶é´è¶åºcluster-node-timeout/2ï¼ å¶ä¸­ï¼1æ¯æåå®ä¾å¸¸è§æç§æ¯1ç§åéä¸ä¸ªpingæ¶æ¯ï¼10æ¯ææ¯1ç§åå®ä¾ä¼æ§è¡10æ¬¡æ£æ¥ï¼æ¯æ¬¡æ£æ¥åä¼ç»pongæ¶æ¯è¶æ¶çå®ä¾åéæ¶æ¯ã\n\nææ¥åå©ä¸ä¸ªä¾å­ï¼å¸¦ä½ åæä¸ä¸å¨è¿ç§éä¿¡é¢çä¸ï¼pingæ¶æ¯å ç¨éç¾¤å¸¦å®½çæåµã\n\nåè®¾åä¸ªå®ä¾æ£æµåç°ï¼æ¯100æ¯«ç§æ10ä¸ªå®ä¾çpongæ¶æ¯æ¥æ¶è¶æ¶ï¼é£ä¹ï¼è¿ä¸ªå®ä¾æ¯ç§å°±ä¼åé101ä¸ªpingæ¶æ¯ï¼çº¦å 1.2mb/så¸¦å®½ãå¦æéç¾¤ä¸­æ30ä¸ªå®ä¾æç§è¿ç§é¢çåéæ¶æ¯ï¼å°±ä¼å ç¨36mb/så¸¦å®½ï¼è¿å°±ä¼æ¤å éç¾¤ä¸­ç¨äºæå¡æ­£å¸¸è¯·æ±çå¸¦å®½ã\n\næä»¥ï¼æä»¬è¦æ³åæ³éä½å®ä¾é´çéä¿¡å¼éï¼é£è¯¥æä¹åå¢ï¼\n\n\n# 2.2 å¦ä½éä½å®ä¾é´çéä¿¡å¼éï¼\n\nä¸ºäºéä½å®ä¾é´çéä¿¡å¼éï¼ä»åçä¸è¯´ï¼æä»¬å¯ä»¥åå°å®ä¾ä¼ è¾çæ¶æ¯å¤§å°ï¼ping/pongæ¶æ¯ãslotåéä¿¡æ¯ï¼ï¼ä½æ¯ï¼å ä¸ºéç¾¤å®ä¾ä¾èµpingãpongæ¶æ¯åslotåéä¿¡æ¯ï¼æ¥ç»´æéç¾¤ç¶æçç»ä¸ï¼ä¸æ¦åå°äºä¼ éçæ¶æ¯å¤§å°ï¼å°±ä¼å¯¼è´å®ä¾é´çéä¿¡ä¿¡æ¯åå°ï¼ä¸å©äºéç¾¤ç»´æ¤ï¼æä»¥ï¼æä»¬ä¸è½éç¨è¿ç§æ¹å¼ã\n\né£ä¹ï¼æä»¬è½ä¸è½éä½å®ä¾é´åéæ¶æ¯çé¢çå¢ï¼æä»¬åæ¥åæä¸ä¸ã\n\nç»è¿åæçå­¦ä¹ ï¼æä»¬ç°å¨ç¥éï¼å®ä¾é´åéæ¶æ¯çé¢çæä¸¤ä¸ªã\n\n * æ¯ä¸ªå®ä¾æ¯1ç§åéä¸æ¡pingæ¶æ¯ãè¿ä¸ªé¢çä¸ç®é«ï¼å¦æåéä½è¯¥é¢ççè¯ï¼éç¾¤ä¸­åå®ä¾çç¶æå¯è½å°±æ²¡åæ³åæ¶ä¼ æ­äºã\n * æ¯ä¸ªå®ä¾æ¯100æ¯«ç§ä¼åä¸æ¬¡æ£æµï¼ç»pongæ¶æ¯æ¥æ¶è¶è¿cluster-node-timeout/2çèç¹åépingæ¶æ¯ãå®ä¾æç§æ¯100æ¯«ç§è¿è¡æ£æµçé¢çï¼æ¯rediså®ä¾é»è®¤çå¨ææ§æ£æ¥ä»»å¡çç»ä¸é¢çï¼æä»¬ä¸è¬ä¸éè¦ä¿®æ¹å®ã\n\né£ä¹ï¼å°±åªæcluster-node-timeoutè¿ä¸ªéç½®é¡¹å¯ä»¥ä¿®æ¹äºã\n\néç½®é¡¹cluster-node-timeoutå®ä¹äºéç¾¤å®ä¾è¢«å¤æ­ä¸ºæéçå¿è·³è¶æ¶æ¶é´ï¼é»è®¤æ¯15ç§ãå¦æcluster-node-timeoutå¼æ¯è¾å°ï¼é£ä¹ï¼å¨å¤§è§æ¨¡éç¾¤ä¸­ï¼å°±ä¼æ¯è¾é¢ç¹å°åºç°pongæ¶æ¯æ¥æ¶è¶æ¶çæåµï¼ä»èå¯¼è´å®ä¾æ¯ç§è¦æ§è¡10æ¬¡âç»pongæ¶æ¯è¶æ¶çå®ä¾åépingæ¶æ¯âè¿ä¸ªæä½ã\n\næä»¥ï¼ä¸ºäºé¿åè¿å¤çå¿è·³æ¶æ¯æ¤å éç¾¤å¸¦å®½ï¼æä»¬å¯ä»¥è°å¤§cluster-node-timeoutå¼ï¼æ¯å¦è¯´è°å¤§å°20ç§æ25ç§ãè¿æ ·ä¸æ¥ï¼ pongæ¶æ¯æ¥æ¶è¶æ¶çæåµå°±ä¼ææç¼è§£ï¼åå®ä¾ä¹ä¸ç¨é¢ç¹å°æ¯ç§æ§è¡10æ¬¡å¿è·³åéæä½äºã\n\nå½ç¶ï¼æä»¬ä¹ä¸è¦æcluster-node-timeoutè°å¾å¤ªå¤§ï¼å¦åï¼å¦æå®ä¾ççåçäºæéï¼æä»¬å°±éè¦ç­å¾cluster-node-timeoutæ¶é¿åï¼æè½æ£æµåºè¿ä¸ªæéï¼è¿åä¼å¯¼è´å®éçæéæ¢å¤æ¶é´è¢«å»¶é¿ï¼ä¼å½±åå°éç¾¤æå¡çæ­£å¸¸ä½¿ç¨ã\n\nä¸ºäºéªè¯è°æ´cluster-node-timeoutå¼åï¼æ¯å¦è½åå°å¿è·³æ¶æ¯å ç¨çéç¾¤ç½ç»å¸¦å®½ï¼æç»ä½ æä¸ªå°å»ºè®®ï¼ä½ å¯ä»¥å¨è°æ´cluster-node-timeoutå¼çååï¼ä½¿ç¨tcpdumpå½ä»¤æåå®ä¾åéå¿è·³ä¿¡æ¯ç½ç»åçæåµã\n\nä¾å¦ï¼æ§è¡ä¸é¢çå½ä»¤åï¼æä»¬å¯ä»¥æåå°192.168.10.3æºå¨ä¸çå®ä¾ä»16379ç«¯å£åéçå¿è·³ç½ç»åï¼å¹¶æç½ç»åçåå®¹ä¿å­å°r1.capæä»¶ä¸­ï¼\n\ntcpdump host 192.168.10.3 port 16379 -i ç½å¡å -w /tmp/r1.cap\n\n\n1\n\n\néè¿åæç½ç»åçæ°éåå¤§å°ï¼å°±å¯ä»¥å¤æ­è°æ´cluster-node-timeoutå¼ååï¼å¿è·³æ¶æ¯å ç¨çå¸¦å®½æåµäºã\n\nå»ºè®®ï¼å¦æä¸æ¯ç¹å«éè¦å¤§å®¹ééç¾¤ï¼æå¥½ æredis cluster çè§æ¨¡æ§å¶å¨ 400~500 ä¸ªå®ä¾ã\n\nåè®¾åä¸ªå®ä¾æ¯ç§è½æ¯æ8ä¸è¯·æ±æä½ï¼8ä¸qpsï¼ï¼æ¯ä¸ªä¸»å®ä¾éç½®1ä¸ªä»å®ä¾ï¼é£ä¹ï¼400~ 500ä¸ªå®ä¾å¯æ¯æ 1600ä¸~2000ä¸qpsï¼200/250ä¸ªä¸»å®ä¾*8ä¸qps=1600/2000ä¸qpsï¼ï¼è¿ä¸ªååéæ§è½å¯ä»¥æ»¡è¶³ä¸å°ä¸å¡åºç¨çéæ±ã',charsets:{cjk:!0},lastUpdated:"2023/04/22, 02:59:51",lastUpdatedTimestamp:1682132391e3},{title:"åºç¡æ¶æï¼ä¸æ¡SQLæ¥è¯¢è¯­å¥æ¯å¦ä½æ§è¡çï¼",frontmatter:{title:"åºç¡æ¶æï¼ä¸æ¡SQLæ¥è¯¢è¯­å¥æ¯å¦ä½æ§è¡çï¼",date:"2023-05-17T09:33:36.000Z",permalink:"/pages/473452/",categories:["ä¸­é´ä»¶","MySQL","ä¸æ ï¼MySQL å®æ 45 è®²"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/06.MySQL/05.%E4%B8%93%E6%A0%8F%EF%BC%9AMySQL%20%E5%AE%9E%E6%88%98%2045%20%E8%AE%B2/01.%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%B8%80%E6%9D%A1SQL%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E7%9A%84%EF%BC%9F.html",relativePath:"ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/01.åºç¡æ¶æï¼ä¸æ¡SQLæ¥è¯¢è¯­å¥æ¯å¦ä½æ§è¡çï¼.md",key:"v-1823a466",path:"/pages/473452/",headers:[{level:2,title:"1. MySQL æ´ä½æ¶æ",slug:"_1-mysql-æ´ä½æ¶æ",normalizedTitle:"1. mysql æ´ä½æ¶æ",charIndex:42},{level:2,title:"2. ä¸ä¸ª SQL çæ§è¡æµç¨",slug:"_2-ä¸ä¸ª-sql-çæ§è¡æµç¨",normalizedTitle:"2. ä¸ä¸ª sql çæ§è¡æµç¨",charIndex:617},{level:3,title:"2.1 è¿æ¥å¨",slug:"_2-1-è¿æ¥å¨",normalizedTitle:"2.1 è¿æ¥å¨",charIndex:637},{level:3,title:"2.2 æ¥è¯¢ç¼å­",slug:"_2-2-æ¥è¯¢ç¼å­",normalizedTitle:"2.2 æ¥è¯¢ç¼å­",charIndex:1696},{level:3,title:"2.3 åæå¨",slug:"_2-3-åæå¨",normalizedTitle:"2.3 åæå¨",charIndex:2282},{level:3,title:"2.4 ä¼åå¨",slug:"_2-4-ä¼åå¨",normalizedTitle:"2.4 ä¼åå¨",charIndex:2514},{level:3,title:"2.5 æ§è¡å¨",slug:"_2-5-æ§è¡å¨",normalizedTitle:"2.5 æ§è¡å¨",charIndex:2882},{level:2,title:"Summary",slug:"summary",normalizedTitle:"summary",charIndex:3613},{level:2,title:"QA",slug:"qa",normalizedTitle:"qa",charIndex:3680}],headersStr:"1. MySQL æ´ä½æ¶æ 2. ä¸ä¸ª SQL çæ§è¡æµç¨ 2.1 è¿æ¥å¨ 2.2 æ¥è¯¢ç¼å­ 2.3 åæå¨ 2.4 ä¼åå¨ 2.5 æ§è¡å¨ Summary QA",content:"> åè 01 | åºç¡æ¶æï¼ä¸æ¡SQLæ¥è¯¢è¯­å¥æ¯å¦ä½æ§è¡çï¼| æå®¢æ¶é´\n\n\n# 1. MySQL æ´ä½æ¶æ\n\nåå¦ä½ æä¸ªæç®åçè¡¨ï¼è¡¨éåªæä¸ä¸ª ID å­æ®µï¼å¨æ§è¡ä¸é¢è¿ä¸ªæ¥è¯¢è¯­å¥æ¶ï¼\n\nmysql> select * from T where ID=10ï¼\n\n\n1\n\n\nMySQL åé¨çæ§è¡è¿ç¨æ¯ææ ·çå¢ï¼è¿ç¯æç« å°±çä¸ä¸ä¸æ¡ SQL å¨ MySQL ä¸­æ¯å¦ä½æ§è¡çã\n\nMySQL çåºæ¬æ¶æç¤ºæå¾å¦ä¸ï¼\n\nå¤§ä½æ¥è¯´ï¼MySQL å¯ä»¥åä¸º Server å±åå­å¨å¼æå±ä¸¤é¨åã\n\n * Server å±åæ¬è¿æ¥å¨ãæ¥è¯¢ç¼å­ãåæå¨ãä¼åå¨ãæ§è¡å¨ç­ï¼æ¶µç MySQL çå¤§å¤æ°æ ¸å¿æå¡åè½ï¼ä»¥åææçåç½®å½æ°ï¼å¦æ¥æãæ¶é´ãæ°å­¦åå å¯å½æ°ç­ï¼ï¼ææè·¨å­å¨å¼æçåè½é½å¨è¿ä¸å±å®ç°ï¼æ¯å¦å­å¨è¿ç¨ãè§¦åå¨ãè§å¾ç­ã\n\n * å­å¨å¼æå±è´è´£æ°æ®çå­å¨åæåãå¶æ¶ææ¨¡å¼æ¯æä»¶å¼çï¼æ¯æ InnoDBãMyISAMãMemory ç­å¤ä¸ªå­å¨å¼æãç°å¨æå¸¸ç¨çå­å¨å¼ææ¯ InnoDBï¼å®ä» MySQL 5.5.5 çæ¬å¼å§æä¸ºäºé»è®¤å­å¨å¼æãå¯ä»¥å¨ create table è¯­å¥ä¸­åå»ºè¡¨æ¶ï¼ä½¿ç¨ engine=memory æ¥æå®ä½¿ç¨åå­å¼æåå»ºè¡¨ã\n\nå¯ä»¥çåºï¼ä¸åçå­å¨å¼æå±ç¨ä¸ä¸ª Server å±ï¼ä¹å°±æ¯ä»è¿æ¥å¨å°æ§è¡å¨çé¨åãä¸é¢å°ç»åå¼å¤´ç»åºç SQL è¯­å¥ï¼å¸¦ä½ èµ°ä¸éæ´ä¸ªæ§è¡æµç¨ï¼ä¾æ¬¡çä¸æ¯ä¸ªç»ä»¶çä½ç¨ã\n\n\n# 2. ä¸ä¸ª SQL çæ§è¡æµç¨\n\n\n# 2.1 è¿æ¥å¨\n\nç¬¬ä¸æ­¥ï¼ä½ ä¼åè¿æ¥å°è¿ä¸ªæ°æ®åºä¸ï¼è¿æ¶åæ¥å¾ä½ çå°±æ¯è¿æ¥å¨ãè¿æ¥å¨è´è´£è·å®¢æ·ç«¯å»ºç«è¿æ¥ãè·åæéãç»´æåç®¡çè¿æ¥ãè¿æ¥å½ä»¤ä¸è¬æ¯è¿ä¹åçï¼\n\nmysql -h$ip -P$port -u$user -p\n\n\n1\n\n\nè¿æ¥å½ä»¤ä¸­ç mysql æ¯å®¢æ·ç«¯å·¥å·ï¼ç¨æ¥è·æå¡ç«¯å»ºç«è¿æ¥ãå¨å®æç»å¸ç TCP æ¡æåï¼è¿æ¥å¨å°±è¦å¼å§è®¤è¯ä½ çèº«ä»½ï¼è¿ä¸ªæ¶åç¨çå°±æ¯ä½ è¾å¥çç¨æ·ååå¯ç ã\n\n * å¦æç¨æ·åæå¯ç ä¸å¯¹ï¼ä½ å°±ä¼æ¶å°ä¸ä¸ª\"Access denied for user\"çéè¯¯ï¼ç¶åå®¢æ·ç«¯ç¨åºç»ææ§è¡ã\n * å¦æç¨æ·åå¯ç è®¤è¯éè¿ï¼è¿æ¥å¨ä¼å°æéè¡¨éé¢æ¥åºä½ æ¥æçæéãä¹åï¼è¿ä¸ªè¿æ¥éé¢çæéå¤æ­é»è¾ï¼é½å°ä¾èµäºæ­¤æ¶è¯»å°çæéã\n\nè¿å°±æå³çï¼ä¸ä¸ªç¨æ·æåå»ºç«è¿æ¥åï¼å³ä½¿ä½ ç¨ç®¡çåè´¦å·å¯¹è¿ä¸ªç¨æ·çæéåäºä¿®æ¹ï¼ä¹ä¸ä¼å½±åå·²ç»å­å¨è¿æ¥çæéãä¿®æ¹å®æåï¼åªæåæ°å»ºçè¿æ¥æä¼ä½¿ç¨æ°çæéè®¾ç½®ã\n\nè¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ï¼\n\n * Command åæä¸ä¸ªæ¾ç¤ºâSleepâçè¡ï¼è¡¨ç¤ºç°å¨ç³»ç»éé¢æä¸ä¸ªç©ºé²è¿æ¥\n\nå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãè¿ä¸ªæ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ã\n\næ°æ®åºéé¢ï¼é¿è¿æ¥æ¯æè¿æ¥æååï¼å¦æå®¢æ·ç«¯æç»­æè¯·æ±ï¼åä¸ç´ä½¿ç¨åä¸ä¸ªè¿æ¥ãç­è¿æ¥åæ¯ææ¯æ¬¡æ§è¡å®å¾å°çå æ¬¡æ¥è¯¢å°±æ­å¼è¿æ¥ï¼ä¸æ¬¡æ¥è¯¢åéæ°å»ºç«ä¸ä¸ªã\n\nå»ºç«è¿æ¥çè¿ç¨éå¸¸æ¯æ¯è¾å¤æçï¼æä»¥æå»ºè®®ä½ å¨ä½¿ç¨ä¸­è¦å°½éåå°å»ºç«è¿æ¥çå¨ä½ï¼ä¹å°±æ¯å°½éä½¿ç¨é¿è¿æ¥ã\n\n> ä½æ¯å¨é¨ä½¿ç¨é¿è¿æ¥åï¼ä½ å¯è½ä¼åç°ï¼æäºæ¶å MySQL å ç¨åå­æ¶¨å¾ç¹å«å¿«ï¼è¿æ¯å ä¸º MySQL å¨æ§è¡è¿ç¨ä¸­ä¸´æ¶ä½¿ç¨çåå­æ¯ç®¡çå¨è¿æ¥å¯¹è±¡éé¢çãè¿äºèµæºä¼å¨è¿æ¥æ­å¼çæ¶åæéæ¾ãæä»¥å¦æé¿è¿æ¥ç´¯ç§¯ä¸æ¥ï¼å¯è½å¯¼è´åå­å ç¨å¤ªå¤§ï¼è¢«ç³»ç»å¼ºè¡ææï¼OOMï¼ï¼ä»ç°è±¡çå°±æ¯ MySQL å¼å¸¸éå¯äºã æä¹è§£å³è¿ä¸ªé®é¢å¢ï¼ä½ å¯ä»¥èèä»¥ä¸ä¸¤ç§æ¹æ¡ã\n\n * å®ææ­å¼é¿è¿æ¥ãä½¿ç¨ä¸æ®µæ¶é´ï¼æèç¨åºéé¢å¤æ­æ§è¡è¿ä¸ä¸ªå ç¨åå­çå¤§æ¥è¯¢åï¼æ­å¼è¿æ¥ï¼ä¹åè¦æ¥è¯¢åéè¿ã\n\n * å¦æä½ ç¨çæ¯ MySQL 5.7 ææ´æ°çæ¬ï¼å¯ä»¥å¨æ¯æ¬¡æ§è¡ä¸ä¸ªæ¯è¾å¤§çæä½åï¼éè¿æ§è¡ mysql_reset_connection æ¥éæ°åå§åè¿æ¥èµæºãè¿ä¸ªè¿ç¨ä¸éè¦éè¿åéæ°åæééªè¯ï¼ä½æ¯ä¼å°è¿æ¥æ¢å¤å°åååå»ºå®æ¶çç¶æã\n\n\n# 2.2 æ¥è¯¢ç¼å­\n\nè¿æ¥å»ºç«å®æåï¼ä½ å°±å¯ä»¥æ§è¡ select è¯­å¥äºãæ§è¡é»è¾å°±ä¼æ¥å°ç¬¬äºæ­¥ï¼æ¥è¯¢ç¼å­ã\n\nMySQL æ¿å°ä¸ä¸ªæ¥è¯¢è¯·æ±åï¼ä¼åå°æ¥è¯¢ç¼å­ççï¼ç¼å­å¯è½ä¼ä»¥ key-value å¯¹çå½¢å¼å­å¨äºåå­ä¸­ï¼å½ä¸­åç´æ¥è¿åãkey æ¯æ¥è¯¢çè¯­å¥ï¼value æ¯æ¥è¯¢çç»æã\n\nä½æ¯å¤§å¤æ°æåµä¸æä¼å»ºè®®ä½ ä¸è¦ä½¿ç¨æ¥è¯¢ç¼å­ï¼ä¸ºä»ä¹å¢ï¼å ä¸ºæ¥è¯¢ç¼å­å¾å¾å¼å¤§äºå©ã\n\næ¥è¯¢ç¼å­çå¤±æéå¸¸é¢ç¹ï¼åªè¦æå¯¹ä¸ä¸ªè¡¨çæ´æ°ï¼è¿ä¸ªè¡¨ä¸ææçæ¥è¯¢ç¼å­é½ä¼è¢«æ¸ç©ºãå æ­¤å¾å¯è½ä½ è´¹å²å°æç»æå­èµ·æ¥ï¼è¿æ²¡ä½¿ç¨å¢ï¼å°±è¢«ä¸ä¸ªæ´æ°å¨æ¸ç©ºäºãå¯¹äºæ´æ°ååå¤§çæ°æ®åºæ¥è¯´ï¼æ¥è¯¢ç¼å­çå½ä¸­çä¼éå¸¸ä½ãé¤éä½ çä¸å¡å°±æ¯æä¸å¼ éæè¡¨ï¼å¾é¿æ¶é´æä¼æ´æ°ä¸æ¬¡ãæ¯å¦ï¼ä¸ä¸ªç³»ç»éç½®è¡¨ï¼é£è¿å¼ è¡¨ä¸çæ¥è¯¢æéåä½¿ç¨æ¥è¯¢ç¼å­ã\n\nå¥½å¨ MySQL ä¹æä¾äºè¿ç§âæéä½¿ç¨âçæ¹å¼ãä½ å¯ä»¥å°åæ° query_cache_type è®¾ç½®æ DEMANDï¼è¿æ ·å¯¹äºé»è®¤ç SQL è¯­å¥é½ä¸ä½¿ç¨æ¥è¯¢ç¼å­ãèå¯¹äºä½ ç¡®å®è¦ä½¿ç¨æ¥è¯¢ç¼å­çè¯­å¥ï¼å¯ä»¥ç¨ SQL_CACHE æ¾å¼æå®ï¼åä¸é¢è¿ä¸ªè¯­å¥ä¸æ ·ï¼\n\nmysql> select SQL_CACHE * from T where ID=10ï¼\n\n\n1\n\n\néè¦æ³¨æçæ¯ï¼MySQL 8.0 çæ¬ç´æ¥å°æ¥è¯¢ç¼å­çæ´ååè½å æäºï¼ä¹å°±æ¯è¯´ 8.0 å¼å§å½»åºæ²¡æè¿ä¸ªåè½äºã\n\n\n# 2.3 åæå¨\n\nå¦ææ²¡æå½ä¸­æ¥è¯¢ç¼å­ï¼å°±è¦å¼å§çæ­£æ§è¡è¯­å¥äºãé¦åï¼MySQL éè¦ç¥éä½ è¦åä»ä¹ï¼å æ­¤éè¦ä½¿ç¨åæå¨å¯¹ SQL è¯­å¥åè§£æã\n\n 1. ãè¯æ³åæãè¯å«åº SQL ä¸­æ¯ä¸ªè¯ä»£è¡¨ä»ä¹ãæ¯å¦å° select è¯å«åºæ¥è¿æ¯ä¸ä¸ªæ¥è¯¢è¯­å¥ï¼ å¹¶å°å¯¹åºçè¡¨ååååè¯å«åºæ¥ã\n 2. ãè¯­æ³åæãå¤æ­ SQL æ¯å¦ç¬¦åè¯­æ³è¦æ±ã\n\nå¦æä½ çè¯­å¥ä¸å¯¹ï¼å°±ä¼æ¶å°âYou have an error in your SQL syntaxâçéè¯¯æéã\n\n\n# 2.4 ä¼åå¨\n\nç»è¿äºåæå¨ï¼MySQL å°±ç¥éä½ è¦åä»ä¹äºãå¨å¼å§æ§è¡ä¹åï¼è¿è¦åç»è¿ä¼åå¨çå¤çã\n\nä¼åå¨ä¼å SQL å·ä½æ§è¡çæ¹æ¡ãæ¯å¦ç´¢å¼çéæ©ãjoin çé¡ºåºç­ã\n\n> ä¸¾ä¾ï¼\n> \n> mysql> select * from t1 join t2 using(ID) where t1.c=10 and t2.d=20;\n> \n> \n> 1\n> \n>  * æ¢å¯ä»¥åä»è¡¨ t1 éé¢ååº c=10 çè®°å½ç ID å¼ï¼åæ ¹æ® ID å¼å³èå°è¡¨ t2ï¼åå¤æ­ t2 éé¢ d çå¼æ¯å¦ç­äº 20ã\n>  * ä¹å¯ä»¥åä»è¡¨ t2 éé¢ååº d=20 çè®°å½ç ID å¼ï¼åæ ¹æ® ID å¼å³èå° t1ï¼åå¤æ­ t1 éé¢ c çå¼æ¯å¦ç­äº 10ã\n> \n> è¿ä¸¤ç§æ¹æ¡çç»æä¸æ ·ï¼ä¼åå¨æ ¹æ®æçæ¥å³å®ä½¿ç¨åªç§ã\n\n\n# 2.5 æ§è¡å¨\n\nMySQL éè¿åæå¨ç¥éäºä½ è¦åä»ä¹ï¼éè¿ä¼åå¨ç¥éäºè¯¥æä¹åï¼äºæ¯å°±è¿å¥äºæ§è¡å¨é¶æ®µï¼å¼å§æ§è¡è¯­å¥ã\n\nå¼å§æ§è¡çæ¶åï¼è¦åå¤æ­ä¸ä¸ä½ å¯¹è¿ä¸ªè¡¨ T ææ²¡ææ§è¡æ¥è¯¢çæéï¼å¦ææ²¡æï¼å°±ä¼è¿åæ²¡ææéçéè¯¯ï¼å¦ä¸æç¤º (å¨å·¥ç¨å®ç°ä¸ï¼å¦æå½ä¸­æ¥è¯¢ç¼å­ï¼ä¼å¨æ¥è¯¢ç¼å­è¿åç»æçæ¶åï¼åæééªè¯ãæ¥è¯¢ä¹ä¼å¨ä¼åå¨ä¹åè°ç¨ precheck éªè¯æé)ã\n\nmysql> select * from T where ID=10;\nERROR 1142 (42000): SELECT command denied to user 'b'@'localhost' for table 'T'\n\n\n1\n2\n\n\nå¦æææéï¼å°±æå¼è¡¨ç»§ç»­æ§è¡ãæå¼è¡¨çæ¶åï¼æ§è¡å¨å°±ä¼æ ¹æ®è¡¨çå¼æå®ä¹ï¼å»ä½¿ç¨è¿ä¸ªå¼ææä¾çæ¥å£ã\n\næ¯å¦æä»¬è¿ä¸ªä¾å­ä¸­çè¡¨ T ä¸­ï¼ID å­æ®µæ²¡æç´¢å¼ï¼é£ä¹æ§è¡å¨çæ§è¡æµç¨æ¯è¿æ ·çï¼\n\n 1. è°ç¨ InnoDB å¼ææ¥å£åè¿ä¸ªè¡¨çç¬¬ä¸è¡ï¼å¤æ­ ID å¼æ¯ä¸æ¯ 10ï¼å¦æä¸æ¯åè·³è¿ï¼å¦ææ¯åå°è¿è¡å­å¨ç»æéä¸­ï¼\n 2. è°ç¨å¼ææ¥å£åâä¸ä¸è¡âï¼éå¤ç¸åçå¤æ­é»è¾ï¼ç´å°åå°è¿ä¸ªè¡¨çæåä¸è¡ã\n 3. æ§è¡å¨å°ä¸è¿°éåè¿ç¨ä¸­æææ»¡è¶³æ¡ä»¶çè¡ç»æçè®°å½éä½ä¸ºç»æéè¿åç»å®¢æ·ç«¯ã\n\nä½ ä¼å¨æ°æ®åºçæ¢æ¥è¯¢æ¥å¿ä¸­çå°ä¸ä¸ª rows_examined çå­æ®µï¼è¡¨ç¤ºè¿ä¸ªè¯­å¥æ§è¡è¿ç¨ä¸­æ«æäºå¤å°è¡ãè¿ä¸ªå¼å°±æ¯å¨æ§è¡å¨æ¯æ¬¡è°ç¨å¼æè·åæ°æ®è¡çæ¶åç´¯å çãå¨æäºåºæ¯ä¸ï¼æ§è¡å¨è°ç¨ä¸æ¬¡ï¼å¨å¼æåé¨åæ«æäºå¤è¡ï¼å æ­¤å¼ææ«æè¡æ°è· rows_examined å¹¶ä¸æ¯å®å¨ç¸åçãæä»¬åé¢ä¼ä¸é¨æä¸ç¯æç« æ¥è®²å­å¨å¼æçåé¨æºå¶ï¼éé¢ä¼æè¯¦ç»çè¯´æã\n\n\n# Summary\n\nä»å¤©ä»ç»äº MySQL çé»è¾æ¶æï¼å¹¶å¸æä½ å¯¹ä¸ä¸ª SQL è¯­å¥å®æ´æ§è¡æµç¨çåä¸ªé¶æ®µæäºä¸ä¸ªåæ­¥çå°è±¡ã\n\n\n# QA\n\nQï¼ä¸ºä»ä¹å¯¹æéçæ£æ¥ä¸å¨ä¼åå¨ä¹ååï¼\n\nAï¼æäºæ¶åï¼SQL è¯­å¥è¦æä½çè¡¨ä¸åªæ¯ SQL å­é¢ä¸é£äºãæ¯å¦å¦ææä¸ªè§¦åå¨ï¼å¾å¨æ§è¡å¨é¶æ®µï¼è¿ç¨ä¸­ï¼æè½ç¡®å®ãä¼åå¨é¶æ®µåæ¯æ è½ä¸ºåçã\n\n----------------------------------------\n\nQï¼å¦æè¡¨ T ä¸­æ²¡æå­æ®µ kï¼èä½ æ§è¡äºè¿ä¸ªè¯­å¥ select * from T where k=1, é£è¯å®æ¯ä¼æ¥âä¸å­å¨è¿ä¸ªåâçéè¯¯ï¼ âUnknown column âkâ in âwhere clauseââãä½ è§å¾è¿ä¸ªéè¯¯æ¯å¨æä»¬ä¸é¢æå°çåªä¸ªé¶æ®µæ¥åºæ¥çå¢ï¼\n\nAï¼åºå½æ¯âä¼åå¨âãä¼åå¨ä¼è¿è¡ä¼ååæï¼æ¯å¦ç¨åæ§è¡åªä¸ªæ¡ä»¶ï¼ä½¿ç¨åªä¸ªç´¢å¼ãå¦ææ²¡æå¯¹åºçå­æ®µå°±ä¼æ¥éçãæäººè®¤ä¸ºæ¯æ§è¡å¨ï¼ç»åºçåå æ¯æ§è¡çæ¶åææå¼è¡¨è·åæ°æ®ï¼ä½æ¯è¡¨çå­æ®µä¸æ¯æ°æ®åï¼æ¯äºåå®ä¹å¥½çï¼æä»¥å¯ä»¥ç´æ¥è¯»åçï¼ä¸éè¦æå¼è¡¨ã",normalizedContent:"> åè 01 | åºç¡æ¶æï¼ä¸æ¡sqlæ¥è¯¢è¯­å¥æ¯å¦ä½æ§è¡çï¼| æå®¢æ¶é´\n\n\n# 1. mysql æ´ä½æ¶æ\n\nåå¦ä½ æä¸ªæç®åçè¡¨ï¼è¡¨éåªæä¸ä¸ª id å­æ®µï¼å¨æ§è¡ä¸é¢è¿ä¸ªæ¥è¯¢è¯­å¥æ¶ï¼\n\nmysql> select * from t where id=10ï¼\n\n\n1\n\n\nmysql åé¨çæ§è¡è¿ç¨æ¯ææ ·çå¢ï¼è¿ç¯æç« å°±çä¸ä¸ä¸æ¡ sql å¨ mysql ä¸­æ¯å¦ä½æ§è¡çã\n\nmysql çåºæ¬æ¶æç¤ºæå¾å¦ä¸ï¼\n\nå¤§ä½æ¥è¯´ï¼mysql å¯ä»¥åä¸º server å±åå­å¨å¼æå±ä¸¤é¨åã\n\n * server å±åæ¬è¿æ¥å¨ãæ¥è¯¢ç¼å­ãåæå¨ãä¼åå¨ãæ§è¡å¨ç­ï¼æ¶µç mysql çå¤§å¤æ°æ ¸å¿æå¡åè½ï¼ä»¥åææçåç½®å½æ°ï¼å¦æ¥æãæ¶é´ãæ°å­¦åå å¯å½æ°ç­ï¼ï¼ææè·¨å­å¨å¼æçåè½é½å¨è¿ä¸å±å®ç°ï¼æ¯å¦å­å¨è¿ç¨ãè§¦åå¨ãè§å¾ç­ã\n\n * å­å¨å¼æå±è´è´£æ°æ®çå­å¨åæåãå¶æ¶ææ¨¡å¼æ¯æä»¶å¼çï¼æ¯æ innodbãmyisamãmemory ç­å¤ä¸ªå­å¨å¼æãç°å¨æå¸¸ç¨çå­å¨å¼ææ¯ innodbï¼å®ä» mysql 5.5.5 çæ¬å¼å§æä¸ºäºé»è®¤å­å¨å¼æãå¯ä»¥å¨ create table è¯­å¥ä¸­åå»ºè¡¨æ¶ï¼ä½¿ç¨ engine=memory æ¥æå®ä½¿ç¨åå­å¼æåå»ºè¡¨ã\n\nå¯ä»¥çåºï¼ä¸åçå­å¨å¼æå±ç¨ä¸ä¸ª server å±ï¼ä¹å°±æ¯ä»è¿æ¥å¨å°æ§è¡å¨çé¨åãä¸é¢å°ç»åå¼å¤´ç»åºç sql è¯­å¥ï¼å¸¦ä½ èµ°ä¸éæ´ä¸ªæ§è¡æµç¨ï¼ä¾æ¬¡çä¸æ¯ä¸ªç»ä»¶çä½ç¨ã\n\n\n# 2. ä¸ä¸ª sql çæ§è¡æµç¨\n\n\n# 2.1 è¿æ¥å¨\n\nç¬¬ä¸æ­¥ï¼ä½ ä¼åè¿æ¥å°è¿ä¸ªæ°æ®åºä¸ï¼è¿æ¶åæ¥å¾ä½ çå°±æ¯è¿æ¥å¨ãè¿æ¥å¨è´è´£è·å®¢æ·ç«¯å»ºç«è¿æ¥ãè·åæéãç»´æåç®¡çè¿æ¥ãè¿æ¥å½ä»¤ä¸è¬æ¯è¿ä¹åçï¼\n\nmysql -h$ip -p$port -u$user -p\n\n\n1\n\n\nè¿æ¥å½ä»¤ä¸­ç mysql æ¯å®¢æ·ç«¯å·¥å·ï¼ç¨æ¥è·æå¡ç«¯å»ºç«è¿æ¥ãå¨å®æç»å¸ç tcp æ¡æåï¼è¿æ¥å¨å°±è¦å¼å§è®¤è¯ä½ çèº«ä»½ï¼è¿ä¸ªæ¶åç¨çå°±æ¯ä½ è¾å¥çç¨æ·ååå¯ç ã\n\n * å¦æç¨æ·åæå¯ç ä¸å¯¹ï¼ä½ å°±ä¼æ¶å°ä¸ä¸ª\"access denied for user\"çéè¯¯ï¼ç¶åå®¢æ·ç«¯ç¨åºç»ææ§è¡ã\n * å¦æç¨æ·åå¯ç è®¤è¯éè¿ï¼è¿æ¥å¨ä¼å°æéè¡¨éé¢æ¥åºä½ æ¥æçæéãä¹åï¼è¿ä¸ªè¿æ¥éé¢çæéå¤æ­é»è¾ï¼é½å°ä¾èµäºæ­¤æ¶è¯»å°çæéã\n\nè¿å°±æå³çï¼ä¸ä¸ªç¨æ·æåå»ºç«è¿æ¥åï¼å³ä½¿ä½ ç¨ç®¡çåè´¦å·å¯¹è¿ä¸ªç¨æ·çæéåäºä¿®æ¹ï¼ä¹ä¸ä¼å½±åå·²ç»å­å¨è¿æ¥çæéãä¿®æ¹å®æåï¼åªæåæ°å»ºçè¿æ¥æä¼ä½¿ç¨æ°çæéè®¾ç½®ã\n\nè¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ï¼\n\n * command åæä¸ä¸ªæ¾ç¤ºâsleepâçè¡ï¼è¡¨ç¤ºç°å¨ç³»ç»éé¢æä¸ä¸ªç©ºé²è¿æ¥\n\nå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãè¿ä¸ªæ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ã\n\næ°æ®åºéé¢ï¼é¿è¿æ¥æ¯æè¿æ¥æååï¼å¦æå®¢æ·ç«¯æç»­æè¯·æ±ï¼åä¸ç´ä½¿ç¨åä¸ä¸ªè¿æ¥ãç­è¿æ¥åæ¯ææ¯æ¬¡æ§è¡å®å¾å°çå æ¬¡æ¥è¯¢å°±æ­å¼è¿æ¥ï¼ä¸æ¬¡æ¥è¯¢åéæ°å»ºç«ä¸ä¸ªã\n\nå»ºç«è¿æ¥çè¿ç¨éå¸¸æ¯æ¯è¾å¤æçï¼æä»¥æå»ºè®®ä½ å¨ä½¿ç¨ä¸­è¦å°½éåå°å»ºç«è¿æ¥çå¨ä½ï¼ä¹å°±æ¯å°½éä½¿ç¨é¿è¿æ¥ã\n\n> ä½æ¯å¨é¨ä½¿ç¨é¿è¿æ¥åï¼ä½ å¯è½ä¼åç°ï¼æäºæ¶å mysql å ç¨åå­æ¶¨å¾ç¹å«å¿«ï¼è¿æ¯å ä¸º mysql å¨æ§è¡è¿ç¨ä¸­ä¸´æ¶ä½¿ç¨çåå­æ¯ç®¡çå¨è¿æ¥å¯¹è±¡éé¢çãè¿äºèµæºä¼å¨è¿æ¥æ­å¼çæ¶åæéæ¾ãæä»¥å¦æé¿è¿æ¥ç´¯ç§¯ä¸æ¥ï¼å¯è½å¯¼è´åå­å ç¨å¤ªå¤§ï¼è¢«ç³»ç»å¼ºè¡ææï¼oomï¼ï¼ä»ç°è±¡çå°±æ¯ mysql å¼å¸¸éå¯äºã æä¹è§£å³è¿ä¸ªé®é¢å¢ï¼ä½ å¯ä»¥èèä»¥ä¸ä¸¤ç§æ¹æ¡ã\n\n * å®ææ­å¼é¿è¿æ¥ãä½¿ç¨ä¸æ®µæ¶é´ï¼æèç¨åºéé¢å¤æ­æ§è¡è¿ä¸ä¸ªå ç¨åå­çå¤§æ¥è¯¢åï¼æ­å¼è¿æ¥ï¼ä¹åè¦æ¥è¯¢åéè¿ã\n\n * å¦æä½ ç¨çæ¯ mysql 5.7 ææ´æ°çæ¬ï¼å¯ä»¥å¨æ¯æ¬¡æ§è¡ä¸ä¸ªæ¯è¾å¤§çæä½åï¼éè¿æ§è¡ mysql_reset_connection æ¥éæ°åå§åè¿æ¥èµæºãè¿ä¸ªè¿ç¨ä¸éè¦éè¿åéæ°åæééªè¯ï¼ä½æ¯ä¼å°è¿æ¥æ¢å¤å°åååå»ºå®æ¶çç¶æã\n\n\n# 2.2 æ¥è¯¢ç¼å­\n\nè¿æ¥å»ºç«å®æåï¼ä½ å°±å¯ä»¥æ§è¡ select è¯­å¥äºãæ§è¡é»è¾å°±ä¼æ¥å°ç¬¬äºæ­¥ï¼æ¥è¯¢ç¼å­ã\n\nmysql æ¿å°ä¸ä¸ªæ¥è¯¢è¯·æ±åï¼ä¼åå°æ¥è¯¢ç¼å­ççï¼ç¼å­å¯è½ä¼ä»¥ key-value å¯¹çå½¢å¼å­å¨äºåå­ä¸­ï¼å½ä¸­åç´æ¥è¿åãkey æ¯æ¥è¯¢çè¯­å¥ï¼value æ¯æ¥è¯¢çç»æã\n\nä½æ¯å¤§å¤æ°æåµä¸æä¼å»ºè®®ä½ ä¸è¦ä½¿ç¨æ¥è¯¢ç¼å­ï¼ä¸ºä»ä¹å¢ï¼å ä¸ºæ¥è¯¢ç¼å­å¾å¾å¼å¤§äºå©ã\n\næ¥è¯¢ç¼å­çå¤±æéå¸¸é¢ç¹ï¼åªè¦æå¯¹ä¸ä¸ªè¡¨çæ´æ°ï¼è¿ä¸ªè¡¨ä¸ææçæ¥è¯¢ç¼å­é½ä¼è¢«æ¸ç©ºãå æ­¤å¾å¯è½ä½ è´¹å²å°æç»æå­èµ·æ¥ï¼è¿æ²¡ä½¿ç¨å¢ï¼å°±è¢«ä¸ä¸ªæ´æ°å¨æ¸ç©ºäºãå¯¹äºæ´æ°ååå¤§çæ°æ®åºæ¥è¯´ï¼æ¥è¯¢ç¼å­çå½ä¸­çä¼éå¸¸ä½ãé¤éä½ çä¸å¡å°±æ¯æä¸å¼ éæè¡¨ï¼å¾é¿æ¶é´æä¼æ´æ°ä¸æ¬¡ãæ¯å¦ï¼ä¸ä¸ªç³»ç»éç½®è¡¨ï¼é£è¿å¼ è¡¨ä¸çæ¥è¯¢æéåä½¿ç¨æ¥è¯¢ç¼å­ã\n\nå¥½å¨ mysql ä¹æä¾äºè¿ç§âæéä½¿ç¨âçæ¹å¼ãä½ å¯ä»¥å°åæ° query_cache_type è®¾ç½®æ demandï¼è¿æ ·å¯¹äºé»è®¤ç sql è¯­å¥é½ä¸ä½¿ç¨æ¥è¯¢ç¼å­ãèå¯¹äºä½ ç¡®å®è¦ä½¿ç¨æ¥è¯¢ç¼å­çè¯­å¥ï¼å¯ä»¥ç¨ sql_cache æ¾å¼æå®ï¼åä¸é¢è¿ä¸ªè¯­å¥ä¸æ ·ï¼\n\nmysql> select sql_cache * from t where id=10ï¼\n\n\n1\n\n\néè¦æ³¨æçæ¯ï¼mysql 8.0 çæ¬ç´æ¥å°æ¥è¯¢ç¼å­çæ´ååè½å æäºï¼ä¹å°±æ¯è¯´ 8.0 å¼å§å½»åºæ²¡æè¿ä¸ªåè½äºã\n\n\n# 2.3 åæå¨\n\nå¦ææ²¡æå½ä¸­æ¥è¯¢ç¼å­ï¼å°±è¦å¼å§çæ­£æ§è¡è¯­å¥äºãé¦åï¼mysql éè¦ç¥éä½ è¦åä»ä¹ï¼å æ­¤éè¦ä½¿ç¨åæå¨å¯¹ sql è¯­å¥åè§£æã\n\n 1. ãè¯æ³åæãè¯å«åº sql ä¸­æ¯ä¸ªè¯ä»£è¡¨ä»ä¹ãæ¯å¦å° select è¯å«åºæ¥è¿æ¯ä¸ä¸ªæ¥è¯¢è¯­å¥ï¼ å¹¶å°å¯¹åºçè¡¨ååååè¯å«åºæ¥ã\n 2. ãè¯­æ³åæãå¤æ­ sql æ¯å¦ç¬¦åè¯­æ³è¦æ±ã\n\nå¦æä½ çè¯­å¥ä¸å¯¹ï¼å°±ä¼æ¶å°âyou have an error in your sql syntaxâçéè¯¯æéã\n\n\n# 2.4 ä¼åå¨\n\nç»è¿äºåæå¨ï¼mysql å°±ç¥éä½ è¦åä»ä¹äºãå¨å¼å§æ§è¡ä¹åï¼è¿è¦åç»è¿ä¼åå¨çå¤çã\n\nä¼åå¨ä¼å sql å·ä½æ§è¡çæ¹æ¡ãæ¯å¦ç´¢å¼çéæ©ãjoin çé¡ºåºç­ã\n\n> ä¸¾ä¾ï¼\n> \n> mysql> select * from t1 join t2 using(id) where t1.c=10 and t2.d=20;\n> \n> \n> 1\n> \n>  * æ¢å¯ä»¥åä»è¡¨ t1 éé¢ååº c=10 çè®°å½ç id å¼ï¼åæ ¹æ® id å¼å³èå°è¡¨ t2ï¼åå¤æ­ t2 éé¢ d çå¼æ¯å¦ç­äº 20ã\n>  * ä¹å¯ä»¥åä»è¡¨ t2 éé¢ååº d=20 çè®°å½ç id å¼ï¼åæ ¹æ® id å¼å³èå° t1ï¼åå¤æ­ t1 éé¢ c çå¼æ¯å¦ç­äº 10ã\n> \n> è¿ä¸¤ç§æ¹æ¡çç»æä¸æ ·ï¼ä¼åå¨æ ¹æ®æçæ¥å³å®ä½¿ç¨åªç§ã\n\n\n# 2.5 æ§è¡å¨\n\nmysql éè¿åæå¨ç¥éäºä½ è¦åä»ä¹ï¼éè¿ä¼åå¨ç¥éäºè¯¥æä¹åï¼äºæ¯å°±è¿å¥äºæ§è¡å¨é¶æ®µï¼å¼å§æ§è¡è¯­å¥ã\n\nå¼å§æ§è¡çæ¶åï¼è¦åå¤æ­ä¸ä¸ä½ å¯¹è¿ä¸ªè¡¨ t ææ²¡ææ§è¡æ¥è¯¢çæéï¼å¦ææ²¡æï¼å°±ä¼è¿åæ²¡ææéçéè¯¯ï¼å¦ä¸æç¤º (å¨å·¥ç¨å®ç°ä¸ï¼å¦æå½ä¸­æ¥è¯¢ç¼å­ï¼ä¼å¨æ¥è¯¢ç¼å­è¿åç»æçæ¶åï¼åæééªè¯ãæ¥è¯¢ä¹ä¼å¨ä¼åå¨ä¹åè°ç¨ precheck éªè¯æé)ã\n\nmysql> select * from t where id=10;\nerror 1142 (42000): select command denied to user 'b'@'localhost' for table 't'\n\n\n1\n2\n\n\nå¦æææéï¼å°±æå¼è¡¨ç»§ç»­æ§è¡ãæå¼è¡¨çæ¶åï¼æ§è¡å¨å°±ä¼æ ¹æ®è¡¨çå¼æå®ä¹ï¼å»ä½¿ç¨è¿ä¸ªå¼ææä¾çæ¥å£ã\n\næ¯å¦æä»¬è¿ä¸ªä¾å­ä¸­çè¡¨ t ä¸­ï¼id å­æ®µæ²¡æç´¢å¼ï¼é£ä¹æ§è¡å¨çæ§è¡æµç¨æ¯è¿æ ·çï¼\n\n 1. è°ç¨ innodb å¼ææ¥å£åè¿ä¸ªè¡¨çç¬¬ä¸è¡ï¼å¤æ­ id å¼æ¯ä¸æ¯ 10ï¼å¦æä¸æ¯åè·³è¿ï¼å¦ææ¯åå°è¿è¡å­å¨ç»æéä¸­ï¼\n 2. è°ç¨å¼ææ¥å£åâä¸ä¸è¡âï¼éå¤ç¸åçå¤æ­é»è¾ï¼ç´å°åå°è¿ä¸ªè¡¨çæåä¸è¡ã\n 3. æ§è¡å¨å°ä¸è¿°éåè¿ç¨ä¸­æææ»¡è¶³æ¡ä»¶çè¡ç»æçè®°å½éä½ä¸ºç»æéè¿åç»å®¢æ·ç«¯ã\n\nä½ ä¼å¨æ°æ®åºçæ¢æ¥è¯¢æ¥å¿ä¸­çå°ä¸ä¸ª rows_examined çå­æ®µï¼è¡¨ç¤ºè¿ä¸ªè¯­å¥æ§è¡è¿ç¨ä¸­æ«æäºå¤å°è¡ãè¿ä¸ªå¼å°±æ¯å¨æ§è¡å¨æ¯æ¬¡è°ç¨å¼æè·åæ°æ®è¡çæ¶åç´¯å çãå¨æäºåºæ¯ä¸ï¼æ§è¡å¨è°ç¨ä¸æ¬¡ï¼å¨å¼æåé¨åæ«æäºå¤è¡ï¼å æ­¤å¼ææ«æè¡æ°è· rows_examined å¹¶ä¸æ¯å®å¨ç¸åçãæä»¬åé¢ä¼ä¸é¨æä¸ç¯æç« æ¥è®²å­å¨å¼æçåé¨æºå¶ï¼éé¢ä¼æè¯¦ç»çè¯´æã\n\n\n# summary\n\nä»å¤©ä»ç»äº mysql çé»è¾æ¶æï¼å¹¶å¸æä½ å¯¹ä¸ä¸ª sql è¯­å¥å®æ´æ§è¡æµç¨çåä¸ªé¶æ®µæäºä¸ä¸ªåæ­¥çå°è±¡ã\n\n\n# qa\n\nqï¼ä¸ºä»ä¹å¯¹æéçæ£æ¥ä¸å¨ä¼åå¨ä¹ååï¼\n\naï¼æäºæ¶åï¼sql è¯­å¥è¦æä½çè¡¨ä¸åªæ¯ sql å­é¢ä¸é£äºãæ¯å¦å¦ææä¸ªè§¦åå¨ï¼å¾å¨æ§è¡å¨é¶æ®µï¼è¿ç¨ä¸­ï¼æè½ç¡®å®ãä¼åå¨é¶æ®µåæ¯æ è½ä¸ºåçã\n\n----------------------------------------\n\nqï¼å¦æè¡¨ t ä¸­æ²¡æå­æ®µ kï¼èä½ æ§è¡äºè¿ä¸ªè¯­å¥ select * from t where k=1, é£è¯å®æ¯ä¼æ¥âä¸å­å¨è¿ä¸ªåâçéè¯¯ï¼ âunknown column âkâ in âwhere clauseââãä½ è§å¾è¿ä¸ªéè¯¯æ¯å¨æä»¬ä¸é¢æå°çåªä¸ªé¶æ®µæ¥åºæ¥çå¢ï¼\n\naï¼åºå½æ¯âä¼åå¨âãä¼åå¨ä¼è¿è¡ä¼ååæï¼æ¯å¦ç¨åæ§è¡åªä¸ªæ¡ä»¶ï¼ä½¿ç¨åªä¸ªç´¢å¼ãå¦ææ²¡æå¯¹åºçå­æ®µå°±ä¼æ¥éçãæäººè®¤ä¸ºæ¯æ§è¡å¨ï¼ç»åºçåå æ¯æ§è¡çæ¶åææå¼è¡¨è·åæ°æ®ï¼ä½æ¯è¡¨çå­æ®µä¸æ¯æ°æ®åï¼æ¯äºåå®ä¹å¥½çï¼æä»¥å¯ä»¥ç´æ¥è¯»åçï¼ä¸éè¦æå¼è¡¨ã",charsets:{cjk:!0},lastUpdated:"2023/05/17, 02:42:28",lastUpdatedTimestamp:1684291348e3},{title:"æ¥å¿ç³»ç»ï¼ä¸æ¡SQLæ´æ°è¯­å¥æ¯å¦ä½æ§è¡çï¼",frontmatter:{title:"æ¥å¿ç³»ç»ï¼ä¸æ¡SQLæ´æ°è¯­å¥æ¯å¦ä½æ§è¡çï¼",date:"2023-05-17T10:44:26.000Z",permalink:"/pages/38bad9/",categories:["ä¸­é´ä»¶","MySQL","ä¸æ ï¼MySQL å®æ 45 è®²"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/06.MySQL/05.%E4%B8%93%E6%A0%8F%EF%BC%9AMySQL%20%E5%AE%9E%E6%88%98%2045%20%E8%AE%B2/02.%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%9A%E4%B8%80%E6%9D%A1SQL%E6%9B%B4%E6%96%B0%E8%AF%AD%E5%8F%A5%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E7%9A%84%EF%BC%9F.html",relativePath:"ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/02.æ¥å¿ç³»ç»ï¼ä¸æ¡SQLæ´æ°è¯­å¥æ¯å¦ä½æ§è¡çï¼.md",key:"v-55200187",path:"/pages/38bad9/",headers:[{level:2,title:"1. éè¦çæ¥å¿æ¨¡åï¼redo log",slug:"_1-éè¦çæ¥å¿æ¨¡å-redo-log",normalizedTitle:"1. éè¦çæ¥å¿æ¨¡åï¼redo log",charIndex:625},{level:2,title:"2. éè¦çæ¥å¿æ¨¡åï¼binlog",slug:"_2-éè¦çæ¥å¿æ¨¡å-binlog",normalizedTitle:"2. éè¦çæ¥å¿æ¨¡åï¼binlog",charIndex:1876},{level:2,title:"3. ä¸¤é¶æ®µæäº¤",slug:"_3-ä¸¤é¶æ®µæäº¤",normalizedTitle:"3. ä¸¤é¶æ®µæäº¤",charIndex:3165},{level:3,title:"3.1 æ°æ®åºçæ¢å¤",slug:"_3-1-æ°æ®åºçæ¢å¤",normalizedTitle:"3.1 æ°æ®åºçæ¢å¤",charIndex:3257},{level:3,title:"3.2 ä¸ºä»ä¹éè¦ä¸¤é¶æ®µæäº¤",slug:"_3-2-ä¸ºä»ä¹éè¦ä¸¤é¶æ®µæäº¤",normalizedTitle:"3.2 ä¸ºä»ä¹éè¦ä¸¤é¶æ®µæäº¤",charIndex:3715},{level:2,title:"Summary",slug:"summary",normalizedTitle:"summary",charIndex:4905},{level:2,title:"è¡¥å",slug:"è¡¥å",normalizedTitle:"è¡¥å",charIndex:5292}],headersStr:"1. éè¦çæ¥å¿æ¨¡åï¼redo log 2. éè¦çæ¥å¿æ¨¡åï¼binlog 3. ä¸¤é¶æ®µæäº¤ 3.1 æ°æ®åºçæ¢å¤ 3.2 ä¸ºä»ä¹éè¦ä¸¤é¶æ®µæäº¤ Summary è¡¥å",content:'> åè 02 | æ¥å¿ç³»ç»ï¼ä¸æ¡SQLæ´æ°è¯­å¥æ¯å¦ä½æ§è¡çï¼| æå®¢æ¶é´\n\nåé¢ä»ç»äºä¸ä¸ªæ¥è¯¢è¯­å¥çæ§è¡æµç¨ï¼ä¸è¬æ¯ç»è¿è¿æ¥å¨ãåæå¨ãä¼åå¨ãæ§è¡å¨ç­åè½æ¨¡åï¼æåå°è¾¾å­å¨å¼æãé£ä¸æ¡æ´æ°è¯­å¥çæ§è¡æµç¨åæ¯ææ ·çå¢ï¼\n\n> ä¹åä½ å¯è½ç»å¸¸å¬ DBA åäºè¯´ï¼MySQL å¯ä»¥æ¢å¤å°åä¸ªæåä»»æä¸ç§çç¶æï¼æå¹çåæ¶ï¼ä½ æ¯ä¸æ¯å¿ä¸­ä¹ä¼ä¸åä¼å¥½å¥ï¼è¿æ¯ææ ·åå°çå¢ï¼\n\næä»¬è¿æ¯ä»ä¸ä¸ªè¡¨çä¸æ¡æ´æ°è¯­å¥è¯´èµ·ï¼ä¸é¢æ¯è¿ä¸ªè¡¨çåå»ºè¯­å¥ï¼è¿ä¸ªè¡¨æä¸ä¸ªä¸»é® ID åä¸ä¸ªæ´åå­æ®µ cï¼\n\nmysql> create table T(ID int primary key, c int);\n\n\n1\n\n\nå¦æè¦å° ID=2 è¿ä¸è¡çå¼å  1ï¼SQL è¯­å¥å°±ä¼è¿ä¹åï¼\n\nmysql> update T set c=c+1 where ID=2;\n\n\n1\n\n\nå¶å®ï¼æ¥è¯¢è¯­å¥çé£ä¸å¥æµç¨ï¼æ´æ°è¯­å¥ä¹ä¼åæ ·èµ°ä¸éï¼ä¸å¾æ¯ä¹åçæ¶æå¾ï¼\n\n * åéè¿è¿æ¥å¨æ¥è¿æ°æ®åº\n * å¨ä¸ä¸ªè¡¨ä¸ææ´æ°çæ¶åï¼è·è¿ä¸ªè¡¨æå³çæ¥è¯¢ç¼å­ä¼å¤±æï¼æä»¥è¿æ¡è¯­å¥å°±ä¼æè¡¨ T ä¸ææç¼å­ç»æé½æ¸ç©º\n * æ¥ä¸æ¥ï¼åæå¨ä¼è§£æå¾ç¥è¿æ¯ä¸æ¡æ´æ°è¯­å¥\n * ä¼åå¨å³å®æ§è¡æ¹æ¡ï¼å³å®ä½¿ç¨ ID è¿ä¸ªç´¢å¼\n * æ§è¡å¨è´è´£å·ä½æ§è¡ï¼æ¾å°è¿ä¸è¡ï¼ç¶åæ´æ°\n\nä¸æ¥è¯¢æµç¨ä¸ä¸æ ·çæ¯ï¼æ´æ°æµç¨è¿æ¶åä¸¤ä¸ªéè¦çæ¥å¿æ¨¡åï¼redo logï¼éåæ¥å¿ï¼å binlogï¼å½æ¡£æ¥å¿ï¼ï¼å®ä¿©æ¯æ¬æçä¸»è§ã\n\n\n# 1. éè¦çæ¥å¿æ¨¡åï¼redo log\n\nè¿è®°å¾ãå­ä¹å·±ãåï¼éåºæææä¸ä¸ªç²æ¿ï¼ä¸é¨ç¨æ¥è®°å½å®¢äººçèµè´¦è®°å½ãå¦æèµè´¦çäººä¸å¤ï¼é£ä¹ä»å¯ä»¥æé¡¾å®¢ååè´¦ç®åå¨æ¿ä¸ãä½å¦æèµè´¦çäººå¤äºï¼ç²æ¿æ»ä¼æè®°ä¸ä¸çæ¶åï¼è¿ä¸ªæ¶åææä¸å®è¿æä¸ä¸ªä¸é¨è®°å½èµè´¦çè´¦æ¬ã\n\nå¦ææäººè¦èµè´¦æèè¿è´¦çè¯ï¼ææä¸è¬æä¸¤ç§åæ³ï¼\n\n * ä¸ç§åæ³æ¯ç´æ¥æè´¦æ¬ç¿»åºæ¥ï¼æ´æ°è´¦æ¬ï¼\n * å¦ä¸ç§åæ³æ¯åå¨ç²æ¿ä¸è®°ä¸è´¦ï¼ç­ç©ºé²åæè´¦æ¬ç¿»åºæ¥æ ¸ç®ã\n\nå¹³æ¶çæå¿çæ¶åï¼ææä¸å®ä¼éåèï¼æ¯ç«åèå¤ªéº»ç¦äºï¼è¿ä¹å¤§çè´¦æ¬å»æ¾ä¸ä¸ªäººå¾è´¹æ¶é´ãç¸æ¯ä¹ä¸ï¼è¿æ¯åå¨ç²æ¿ä¸è®°ä¸ä¸æ¹ä¾¿ãåæ ·ï¼å¨ MySQL éä¹æè¿ä¸ªé®é¢ï¼å¦ææ¯ä¸æ¬¡çæ´æ°æä½é½éè¦åè¿ç£çï¼ç¶åç£çä¹è¦æ¾å°å¯¹åºçé£æ¡è®°å½ï¼ç¶ååæ´æ°ï¼æ´ä¸ªè¿ç¨ IO ææ¬ãæ¥æ¾ææ¬é½å¾é«ãä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼MySQL çè®¾è®¡èå°±ä¹éç¨äºç±»ä¼¼éåºææçåæ³ã\n\nç²æ¿åè´¦æ¬éåçæ´ä¸ªè¿ç¨ï¼å¶å®å°±æ¯ MySQL ä¸­å¸¸è¯´ç WALï¼é¢åæ¥å¿ï¼ææ¯ãWAL çå¨ç§°æ¯ Write-Ahead Loggingï¼å®çå³é®ç¹å°±æ¯ååæ¥å¿ï¼ç­ç©ºé²æ¶ååç£çã\n\nå·ä½æ¥è¯´ï¼å½æä¸æ¡è®°å½éè¦æ´æ°çæ¶åï¼InnoDB å¼æå°±ä¼åæè®°å½åå° redo log éé¢ï¼å¹¶æ´æ°åå­ï¼è¿ä¸ªæ¶åæ´æ°å°±ç®å®æäºãåæ¶ï¼InnoDB å¼æä¼å¨éå½çæ¶åï¼å°è¿ä¸ªæä½è®°å½æ´æ°å°ç£çéé¢ï¼èè¿ä¸ªæ´æ°å¾å¾æ¯å¨ç³»ç»æ¯è¾ç©ºé²çæ¶ååã\n\n> æ³¨æï¼åªè¦åå¥ redo logï¼é£è¿ä¸ªæ°æ®åºå°±ç®åäºè¿ä¸ªäºæï¼ä¹å°±æ¯åäºç¸åºçæ´æ°ï¼å°½ç®¡å¯è½è¿æ²¡ççå»åï¼ä½å¯¹å¤æ¥çå°±æ¯åäºã\n\nç±»ä¼¼äºææçç²æ¿ä¼åæ»¡ï¼InnoDB ç redo log ä¹æ¯åºå®å¤§å°çãæ¯å¦å¯ä»¥éç½®ä¸ºä¸ç» 4 ä¸ªæä»¶ï¼æ¯ä¸ªæä»¶çå¤§å°æ¯ 1GBï¼é£ä¹è¿åâç²æ¿âæ»å±å°±å¯ä»¥è®°å½ 4GB çæä½ãä»å¤´å¼å§åï¼åå°æ«å°¾å°±ååå°å¼å¤´å¾ªç¯åï¼å¦ä¸é¢è¿ä¸ªå¾æç¤ºï¼\n\n * write pos æ¯å½åè®°å½çä½ç½®ï¼ä¸è¾¹åä¸è¾¹åç§»ï¼åå°ç¬¬ 3 å·æä»¶æ«å°¾åå°±åå° 0 å·æä»¶å¼å¤´ã\n * checkpoint æ¯å½åè¦æ¦é¤çä½ç½®ï¼ä¹æ¯å¾åæ¨ç§»å¹¶ä¸å¾ªç¯çï¼æ¦é¤è®°å½åè¦æè®°å½æ´æ°å°æ°æ®æä»¶ã\n\nwrite pos å checkpoint ä¹é´çæ¯âç²æ¿âä¸è¿ç©ºççé¨åï¼å¯ä»¥ç¨æ¥è®°å½æ°çæä½ãå¦æ write pos è¿½ä¸ checkpointï¼è¡¨ç¤ºâç²æ¿âæ»¡äºï¼è¿æ¶åä¸è½åæ§è¡æ°çæ´æ°ï¼å¾åä¸æ¥åæ¦æä¸äºè®°å½ï¼æ checkpoint æ¨è¿ä¸ä¸ã\n\næäº redo logï¼InnoDB å°±å¯ä»¥ä¿è¯å³ä½¿æ°æ®åºåçå¼å¸¸éå¯ï¼ä¹åæäº¤çè®°å½é½ä¸ä¼ä¸¢å¤±ï¼è¿ä¸ªè½åç§°ä¸º crash-safeã\n\n> è¦çè§£ crash-safe è¿ä¸ªæ¦å¿µï¼å¯ä»¥æ³æ³æä»¬åé¢èµè´¦è®°å½çä¾å­ãåªè¦èµè´¦è®°å½è®°å¨äºç²æ¿ä¸æåå¨äºè´¦æ¬ä¸ï¼ä¹åå³ä½¿ææå¿è®°äºï¼æ¯å¦çªç¶åä¸å å¤©ï¼æ¢å¤çæåä¾ç¶å¯ä»¥éè¿è´¦æ¬åç²æ¿ä¸çæ°æ®æç¡®èµè´¦è´¦ç®ã\n> \n> æä»¥æä»¬è¯´äºï¼åªè¦å¾ redo log åäºï¼å°±ç®æ°æ®åºåè¿è¿ä»¶äºäºã\n\n\n# 2. éè¦çæ¥å¿æ¨¡åï¼binlog\n\nåé¢æä»¬è®²è¿ï¼MySQL æ´ä½æ¥çï¼å¶å®å°±æä¸¤åï¼ä¸åæ¯ Server å±ï¼å®ä¸»è¦åçæ¯ MySQL åè½å±é¢çäºæï¼è¿æä¸åæ¯å¼æå±ï¼è´è´£å­å¨ç¸å³çå·ä½äºå®ãä¸é¢æä»¬èå°çç²æ¿ redo log æ¯ InnoDB å¼æç¹æçæ¥å¿ï¼è Server å±ä¹æèªå·±çæ¥å¿ï¼ç§°ä¸º binlogï¼å½æ¡£æ¥å¿ï¼ã\n\n> ä¹è®¸ä½ ä¼é®ï¼ä¸ºä»ä¹ä¼æä¸¤ä»½æ¥å¿å¢ï¼\n> \n> å ä¸ºæå¼å§ MySQL éå¹¶æ²¡æ InnoDB å¼æãMySQL èªå¸¦çå¼ææ¯ MyISAMï¼ä½æ¯ MyISAM æ²¡æ crash-safe çè½åï¼binlog æ¥å¿åªè½ç¨äºå½æ¡£ãè InnoDB æ¯å¦ä¸ä¸ªå¬å¸ä»¥æä»¶å½¢å¼å¼å¥ MySQL çï¼æ¢ç¶åªä¾é  binlog æ¯æ²¡æ crash-safe è½åçï¼æä»¥ InnoDB ä½¿ç¨å¦å¤ä¸å¥æ¥å¿ç³»ç»ââä¹å°±æ¯ redo log æ¥å®ç° crash-safe è½åã\n\nredo log ä¸ binlog æä»¥ä¸ä¸ç¹ä¸åï¼\n\n 1. redo log æ¯ InnoDB å¼æç¹æçï¼binlog æ¯ MySQL ç Server å±å®ç°çï¼ææå¼æé½å¯ä»¥ä½¿ç¨ã\n 2. redo log æ¯ç©çæ¥å¿ï¼è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹âï¼binlog æ¯é»è¾æ¥å¿ï¼è®°å½çæ¯è¿ä¸ªè¯­å¥çåå§é»è¾ï¼æ¯å¦âç» ID=2 è¿ä¸è¡ç c å­æ®µå  1 âã\n 3. redo log æ¯å¾ªç¯åçï¼ç©ºé´åºå®ä¼ç¨å®ï¼binlog æ¯å¯ä»¥è¿½å åå¥çãâè¿½å åâæ¯æ binlog æä»¶åå°ä¸å®å¤§å°åä¼åæ¢å°ä¸ä¸ä¸ªï¼å¹¶ä¸ä¼è¦çä»¥åçæ¥å¿ã\n\næäºå¯¹è¿ä¸¤ä¸ªæ¥å¿çæ¦å¿µæ§çè§£ï¼æä»¬åæ¥çæ§è¡å¨å InnoDB å¼æå¨æ§è¡è¿ä¸ªç®åç update è¯­å¥æ¶çåé¨æµç¨ï¼\n\n 1. æ§è¡å¨åæ¾å¼æå ID=2 è¿ä¸è¡ãID æ¯ä¸»é®ï¼å¼æç´æ¥ç¨æ æç´¢æ¾å°è¿ä¸è¡ãå¦æ ID=2 è¿ä¸è¡æå¨çæ°æ®é¡µæ¬æ¥å°±å¨åå­ä¸­ï¼å°±ç´æ¥è¿åç»æ§è¡å¨ï¼å¦åï¼éè¦åä»ç£çè¯»å¥åå­ï¼ç¶ååè¿åã\n 2. æ§è¡å¨æ¿å°å¼æç»çè¡æ°æ®ï¼æè¿ä¸ªå¼å ä¸ 1ï¼æ¯å¦åæ¥æ¯ Nï¼ç°å¨å°±æ¯ N+1ï¼å¾å°æ°çä¸è¡æ°æ®ï¼åè°ç¨å¼ææ¥å£åå¥è¿è¡æ°æ°æ®ã\n 3. å¼æå°è¿è¡æ°æ°æ®æ´æ°å°åå­ä¸­ï¼åæ¶å°è¿ä¸ªæ´æ°æä½è®°å½å° redo log éé¢ï¼æ­¤æ¶ redo log å¤äº prepare ç¶æãç¶ååç¥æ§è¡å¨æ§è¡å®æäºï¼éæ¶å¯ä»¥æäº¤äºå¡ã\n 4. æ§è¡å¨çæè¿ä¸ªæä½ç binlogï¼å¹¶æ binlog åå¥ç£çã\n 5. æ§è¡å¨è°ç¨å¼æçæäº¤äºå¡æ¥å£ï¼å¼ææåååå¥ç redo log æ¹ææäº¤ï¼commitï¼ç¶æï¼æ´æ°å®æã\n\nä¸é¢ç»åºè¿ä¸ª update è¯­å¥çæ§è¡æµç¨å¾ï¼å¾ä¸­æµè²æ¡è¡¨ç¤ºæ¯å¨ InnoDB åé¨æ§è¡çï¼æ·±è²æ¡è¡¨ç¤ºæ¯å¨æ§è¡å¨ä¸­æ§è¡çã\n\nä½ å¯è½æ³¨æå°äºï¼æåä¸æ­¥çä¸å»æç¹âç»âï¼å° redo log çåå¥ææäºä¸¤ä¸ªæ­¥éª¤ï¼prepare å commitï¼è¿å°±æ¯"ä¸¤é¶æ®µæäº¤"ã\n\n> è¿ä¸ DDIA ä¸­å¨åå¸å¼äºå¡çåå­æäº¤ä¸­æè®²çâä¸¤é¶æ®µæäº¤âæç¹åºå«ï¼è¿éä¸æ¯åå¸å¼äºå¡çã\n\n\n# 3. ä¸¤é¶æ®µæäº¤\n\nä¸ºä»ä¹å¿é¡»æâä¸¤é¶æ®µæäº¤âå¢ï¼è¿æ¯ä¸ºäºè®©ä¸¤ä»½æ¥å¿ä¹é´çé»è¾ä¸è´ãè¦è¯´æè¿ä¸ªé®é¢ï¼æä»¬å¾ä»æç« å¼å¤´çé£ä¸ªé®é¢è¯´èµ·ï¼ææ ·è®©æ°æ®åºæ¢å¤å°åä¸ªæåä»»æä¸ç§çç¶æï¼\n\n\n# 3.1 æ°æ®åºçæ¢å¤\n\nåé¢æä»¬è¯´è¿äºï¼binlog ä¼è®°å½ææçé»è¾æä½ï¼å¹¶ä¸æ¯éç¨âè¿½å åâçå½¢å¼ãå¦æä½ ç DBA æ¿è¯ºè¯´åä¸ªæåå¯ä»¥æ¢å¤ï¼é£ä¹å¤ä»½ç³»ç»ä¸­ä¸å®ä¼ä¿å­æè¿åä¸ªæçææ binlogï¼åæ¶ç³»ç»ä¼å®æåæ´åºå¤ä»½ãè¿éçâå®æâåå³äºç³»ç»çéè¦æ§ï¼å¯ä»¥æ¯ä¸å¤©ä¸å¤ï¼ä¹å¯ä»¥æ¯ä¸å¨ä¸å¤ã\n\n> å·ä½çå¤ä»½é¢çï¼éè¦èè RTOï¼æ¢å¤æ¶é´ç®æ ï¼è¿ä¸ªææ ãå¤ªé¢ç¹ä¼æ¶èå¤ªå¤å­å¨ç©ºé´ï¼ä½å¤ªä¹ä¼ä½¿å¾ RTO å¤ªå¤§ã\n\nå½éè¦æ¢å¤å°æå®çæä¸ç§æ¶ï¼æ¯å¦æå¤©ä¸åä¸¤ç¹åç°ä¸­ååäºç¹æä¸æ¬¡è¯¯å è¡¨ï¼éè¦æ¾åæ°æ®ï¼é£ä½ å¯ä»¥è¿ä¹åï¼\n\n * é¦åæ¾å°æè¿çä¸æ¬¡å¨éå¤ä»½\n * ç¶åä»å¤ä»½çæ¶é´ç¹å¼å§ï¼å°å¤ä»½ç binlog ä¾æ¬¡ååºæ¥ï¼éæ¾å°ä¸­åè¯¯å è¡¨ä¹åçé£ä¸ªæ¶å»\n\nè¿æ ·ä½ çä¸´æ¶åºå°±è·è¯¯å ä¹åççº¿ä¸åºä¸æ ·äºï¼ç¶åä½ å¯ä»¥æè¡¨æ°æ®ä»ä¸´æ¶åºååºæ¥ï¼æéè¦æ¢å¤å°çº¿ä¸åºå»ã\n\né¤äºæ¢å¤è¯¯å çè¡¨ï¼ææ¶åè¿éè¦å¢å ä»èç¹å¯æ¬æ¥å¢å è¯»æ§è½ï¼ç°å¨å¸¸è§çåæ³ä¹æ¯ç¨å¨éå¤ä»½å ä¸åºç¨ binlog æ¥å®ç°çãå æ­¤ï¼è¿ä¸ªæä½ååéè¦ã\n\n\n# 3.2 ä¸ºä»ä¹éè¦ä¸¤é¶æ®µæäº¤\n\nè¯´å®äºæ°æ®æ¢å¤è¿ç¨ï¼æä»¬åæ¥è¯´è¯´ï¼ä¸ºä»ä¹æ¥å¿éè¦âä¸¤é¶æ®µæäº¤âã\n\nè¿éä¸å¦¨ç¨åè¯æ³æ¥è¿è¡è§£éãç±äº redo log å binlog æ¯ä¸¤ä¸ªç¬ç«çé»è¾ï¼å¦æä¸ç¨ä¸¤é¶æ®µæäº¤ï¼è¦ä¹å°±æ¯ååå® redo log åå binlogï¼è¦ä¹éç¨åè¿æ¥çé¡ºåºãæä»¬ççè¿ä¸¤ç§æ¹å¼ä¼æä»ä¹é®é¢ï¼\n\n * åå redo log åå binlogï¼åè®¾å¨ redo log åå®ï¼binlog è¿æ²¡æåå®çæ¶åï¼MySQL è¿ç¨å¼å¸¸éå¯ãç±äºæä»¬åé¢è¯´è¿çï¼redo log åå®ä¹åï¼å°±ç®æ°æ®åºåäºè¿ä»¶äºäºï¼ç³»ç»å³ä½¿å´©æºï¼ä»ç¶è½å¤ææ°æ®æ¢å¤åæ¥ï¼æä»¥æ¢å¤åè¿ä¸è¡ c çå¼æ¯ 1ãä½æ¯ç±äº binlog æ²¡åå®å°± crash äºï¼è¿æ¶å binlog éé¢å°±æ²¡æè®°å½è¿ä¸ªè¯­å¥ãå æ­¤ï¼ä¹åå¤ä»½æ¥å¿çæ¶åï¼å­èµ·æ¥ç binlog éé¢å°±æ²¡æè¿æ¡è¯­å¥ãç¶åä½ ä¼åç°ï¼å¦æéè¦ç¨è¿ä¸ª binlog æ¥æ¢å¤ä¸´æ¶åºçè¯ï¼ç±äºè¿ä¸ªè¯­å¥ç binlog ä¸¢å¤±ï¼è¿ä¸ªä¸´æ¶åºå°±ä¼å°äºè¿ä¸æ¬¡æ´æ°ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 0ï¼ä¸ååºçå¼ä¸åã\n * åå binlog åå redo logï¼å¦æå¨ binlog åå®ä¹å crashï¼ç±äº redo log è¿æ²¡åï¼æä»¥æ°æ®åºå°±ç®è¿æ²¡åè¿ä»¶äºï¼å´©æºæ¢å¤ä»¥åè¿ä¸ªäºå¡æ æï¼æä»¥è¿ä¸è¡ c çå¼æ¯ 0ãä½æ¯ binlog éé¢å·²ç»è®°å½äºâæ c ä» 0 æ¹æ 1âè¿ä¸ªæ¥å¿ãæä»¥ï¼å¨ä¹åç¨ binlog æ¥æ¢å¤çæ¶åå°±å¤äºä¸ä¸ªäºå¡åºæ¥ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 1ï¼ä¸ååºçå¼ä¸åã\n\nå¯ä»¥çå°ï¼å¦æä¸ä½¿ç¨âä¸¤é¶æ®µæäº¤âï¼é£ä¹æ°æ®åºçç¶æå°±æå¯è½åç¨å®çæ¥å¿æ¢å¤åºæ¥çåºçç¶æä¸ä¸è´ãå¨éç¨äºä¸¤é¶æ®µæäº¤ä¹åï¼å¯ä»¥åæè¿ä¹ä¸ä¸ªè¿ç¨ï¼1. prepare é¶æ®µ 2. å binlog 3. commitï¼é£ï¼\n\n * å¦æå¨ 2 ä¹åå´©æºï¼éå¯æ¢å¤ï¼æ¢å¤ååç°æ²¡æ commitï¼äºå¡åæ»ï¼å¤ä»½æ¢å¤æ¶æ²¡æ binlogï¼ä¸¤èä¸è´ã\n * å¦æå¨ 3 ä¹åå´©æºï¼è½ç¶æ²¡ commitï¼ä½æ»¡è¶³ prepare å binlog å®æ´ï¼æä»¥éå¯åä¼èªå¨ commitï¼å¤ä»½æ¢å¤æ¶æ binlogï¼ä¸¤èä¸è´ã\n\n> è¦çæ¸è¿éçå³ç³»ãå½åçå´©æºæ¶ï¼éå¯æ¢å¤æ¯åªä¾é  redo log æ¥å®ç°çå®å¨ãèå½éè¦å¤ä»½ææ¢å¤æ¶ï¼æ¯éè¦ binlog æ¥å®ç°ï¼æ¯ç« binlog çè®°å½ä¸»è¦å°±æ¯ç¨äºå¤ä»½ï¼å®æå®æ´çé»è¾è®°å½ãæä»¬è¦å®ç°çç®æ æ¯éå¯æ¢å¤åå¤ä»½æ¢å¤ä¸¤ä¸ªç¶åµæ¢å¤å¾å°çåºæ¯ä¸æ ·çç¶æï¼è¿æ ·å°±ä¸ç¨æå¿æ¥å¿åéäºã\n\nå¦æä¸ç¨ä¸¤é¶æ®µæäº¤ï¼é£å´©æºæ¢å¤åçä¸»åºå¯è½ä¸å¤ä»½åºæ¥çä»åºäº§çæ°æ®ä¸ä¸è´ç°è±¡ã\n\nç®åè¯´ï¼redo log å binlog é½å¯ä»¥ç¨äºè¡¨ç¤ºäºå¡çæäº¤ç¶æï¼èä¸¤é¶æ®µæäº¤å°±æ¯è®©è¿ä¸¤ä¸ªç¶æä¿æé»è¾ä¸çä¸è´ã\n\n\n# Summary\n\nä»å¤©ä»ç»äº MySQL ä¸­æéè¦çä¸¤ä¸ªæ¥å¿ï¼ç©çæ¥å¿ redo log åé»è¾æ¥å¿ binlogã\n\n * redo log ç¨äºä¿è¯ crash-safe è½åãinnodb_flush_log_at_trx_commit è¿ä¸ªåæ°è®¾ç½®æ 1 çæ¶åï¼è¡¨ç¤ºæ¯æ¬¡äºå¡ç redo log é½ç´æ¥æä¹åå°ç£çãè¿ä¸ªåæ°æå»ºè®®ä½ è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ MySQL å¼å¸¸éå¯ä¹åæ°æ®ä¸ä¸¢å¤±ã\n * binlog æå®æ´çé»è¾è®°å½ï¼å°±å¯ä»¥ç¨äºå¤ä»½æ¢å¤ï¼sync_binlog è¿ä¸ªåæ°è®¾ç½®æ 1 çæ¶åï¼è¡¨ç¤ºæ¯æ¬¡äºå¡ç binlog é½æä¹åå°ç£çãè¿ä¸ªåæ°æä¹å»ºè®®ä½ è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ MySQL å¼å¸¸éå¯ä¹å binlog ä¸ä¸¢å¤±ã\n\nä¸¤é¶æ®µæäº¤æ¯è·¨ç³»ç»ç»´ææ°æ®é»è¾ä¸è´æ§æ¶å¸¸ç¨çä¸ä¸ªæ¹æ¡ï¼å³ä½¿ä½ ä¸åæ°æ®åºåæ ¸å¼åï¼æ¥å¸¸å¼åä¸­ä¹æå¯è½ä¼ç¨å°ã\n\n\n# è¡¥å\n\nInnoDB ä½¿ç¨ redo log çåå ï¼å¶åé¨æä¸ä¸ª Buffer Pool çç»æï¼æ¯ç¨äºç¼å­ MySQL ç£çæ°æ®çåå­ç©ºé´ãæ­¤æ¶ä¼æ¶åå° Buffer Pool ä¸­çæ°æ®è¿æ²¡æ¥å¾åå·çï¼åå­ä¸­çæ°æ®å æ­çµå°±å·²ä¸¢å¤±çé®é¢ãææ¯æ¬¡ä¿®æ¹åçå¼è®°å½å°ç£çä¸ç redo log ä¸­ï¼å¯ä»¥ä¿è¯çªç¶æ­çµï¼ä¹å¯ä»¥æ ¹æ® redo log æ¥æ¢å¤ Buffer Poolï¼è¿æ ·ç¨å°äº Buffer Pool çåå­é«ææ§ï¼ä¹ä¿è¯äºæ°æ®ä¸ä¼ä¸¢å¤±ã\n\né½æ¯ç£çæä½ï¼ä¸ºä»ä¹ä¸ç´æ¥å°ä¿®æ¹çæ°æ®åå°æ°æ®æä»¶éé¢å»å¢ï¼ å ä¸º redo log æ¯ç£çé¡ºåºåï¼æ°æ®å·çæ¯ç£çéæºåï¼ç£ççé¡ºåºåæ¯éæºåé«æçå¤ã',normalizedContent:'> åè 02 | æ¥å¿ç³»ç»ï¼ä¸æ¡sqlæ´æ°è¯­å¥æ¯å¦ä½æ§è¡çï¼| æå®¢æ¶é´\n\nåé¢ä»ç»äºä¸ä¸ªæ¥è¯¢è¯­å¥çæ§è¡æµç¨ï¼ä¸è¬æ¯ç»è¿è¿æ¥å¨ãåæå¨ãä¼åå¨ãæ§è¡å¨ç­åè½æ¨¡åï¼æåå°è¾¾å­å¨å¼æãé£ä¸æ¡æ´æ°è¯­å¥çæ§è¡æµç¨åæ¯ææ ·çå¢ï¼\n\n> ä¹åä½ å¯è½ç»å¸¸å¬ dba åäºè¯´ï¼mysql å¯ä»¥æ¢å¤å°åä¸ªæåä»»æä¸ç§çç¶æï¼æå¹çåæ¶ï¼ä½ æ¯ä¸æ¯å¿ä¸­ä¹ä¼ä¸åä¼å¥½å¥ï¼è¿æ¯ææ ·åå°çå¢ï¼\n\næä»¬è¿æ¯ä»ä¸ä¸ªè¡¨çä¸æ¡æ´æ°è¯­å¥è¯´èµ·ï¼ä¸é¢æ¯è¿ä¸ªè¡¨çåå»ºè¯­å¥ï¼è¿ä¸ªè¡¨æä¸ä¸ªä¸»é® id åä¸ä¸ªæ´åå­æ®µ cï¼\n\nmysql> create table t(id int primary key, c int);\n\n\n1\n\n\nå¦æè¦å° id=2 è¿ä¸è¡çå¼å  1ï¼sql è¯­å¥å°±ä¼è¿ä¹åï¼\n\nmysql> update t set c=c+1 where id=2;\n\n\n1\n\n\nå¶å®ï¼æ¥è¯¢è¯­å¥çé£ä¸å¥æµç¨ï¼æ´æ°è¯­å¥ä¹ä¼åæ ·èµ°ä¸éï¼ä¸å¾æ¯ä¹åçæ¶æå¾ï¼\n\n * åéè¿è¿æ¥å¨æ¥è¿æ°æ®åº\n * å¨ä¸ä¸ªè¡¨ä¸ææ´æ°çæ¶åï¼è·è¿ä¸ªè¡¨æå³çæ¥è¯¢ç¼å­ä¼å¤±æï¼æä»¥è¿æ¡è¯­å¥å°±ä¼æè¡¨ t ä¸ææç¼å­ç»æé½æ¸ç©º\n * æ¥ä¸æ¥ï¼åæå¨ä¼è§£æå¾ç¥è¿æ¯ä¸æ¡æ´æ°è¯­å¥\n * ä¼åå¨å³å®æ§è¡æ¹æ¡ï¼å³å®ä½¿ç¨ id è¿ä¸ªç´¢å¼\n * æ§è¡å¨è´è´£å·ä½æ§è¡ï¼æ¾å°è¿ä¸è¡ï¼ç¶åæ´æ°\n\nä¸æ¥è¯¢æµç¨ä¸ä¸æ ·çæ¯ï¼æ´æ°æµç¨è¿æ¶åä¸¤ä¸ªéè¦çæ¥å¿æ¨¡åï¼redo logï¼éåæ¥å¿ï¼å binlogï¼å½æ¡£æ¥å¿ï¼ï¼å®ä¿©æ¯æ¬æçä¸»è§ã\n\n\n# 1. éè¦çæ¥å¿æ¨¡åï¼redo log\n\nè¿è®°å¾ãå­ä¹å·±ãåï¼éåºæææä¸ä¸ªç²æ¿ï¼ä¸é¨ç¨æ¥è®°å½å®¢äººçèµè´¦è®°å½ãå¦æèµè´¦çäººä¸å¤ï¼é£ä¹ä»å¯ä»¥æé¡¾å®¢ååè´¦ç®åå¨æ¿ä¸ãä½å¦æèµè´¦çäººå¤äºï¼ç²æ¿æ»ä¼æè®°ä¸ä¸çæ¶åï¼è¿ä¸ªæ¶åææä¸å®è¿æä¸ä¸ªä¸é¨è®°å½èµè´¦çè´¦æ¬ã\n\nå¦ææäººè¦èµè´¦æèè¿è´¦çè¯ï¼ææä¸è¬æä¸¤ç§åæ³ï¼\n\n * ä¸ç§åæ³æ¯ç´æ¥æè´¦æ¬ç¿»åºæ¥ï¼æ´æ°è´¦æ¬ï¼\n * å¦ä¸ç§åæ³æ¯åå¨ç²æ¿ä¸è®°ä¸è´¦ï¼ç­ç©ºé²åæè´¦æ¬ç¿»åºæ¥æ ¸ç®ã\n\nå¹³æ¶çæå¿çæ¶åï¼ææä¸å®ä¼éåèï¼æ¯ç«åèå¤ªéº»ç¦äºï¼è¿ä¹å¤§çè´¦æ¬å»æ¾ä¸ä¸ªäººå¾è´¹æ¶é´ãç¸æ¯ä¹ä¸ï¼è¿æ¯åå¨ç²æ¿ä¸è®°ä¸ä¸æ¹ä¾¿ãåæ ·ï¼å¨ mysql éä¹æè¿ä¸ªé®é¢ï¼å¦ææ¯ä¸æ¬¡çæ´æ°æä½é½éè¦åè¿ç£çï¼ç¶åç£çä¹è¦æ¾å°å¯¹åºçé£æ¡è®°å½ï¼ç¶ååæ´æ°ï¼æ´ä¸ªè¿ç¨ io ææ¬ãæ¥æ¾ææ¬é½å¾é«ãä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼mysql çè®¾è®¡èå°±ä¹éç¨äºç±»ä¼¼éåºææçåæ³ã\n\nç²æ¿åè´¦æ¬éåçæ´ä¸ªè¿ç¨ï¼å¶å®å°±æ¯ mysql ä¸­å¸¸è¯´ç walï¼é¢åæ¥å¿ï¼ææ¯ãwal çå¨ç§°æ¯ write-ahead loggingï¼å®çå³é®ç¹å°±æ¯ååæ¥å¿ï¼ç­ç©ºé²æ¶ååç£çã\n\nå·ä½æ¥è¯´ï¼å½æä¸æ¡è®°å½éè¦æ´æ°çæ¶åï¼innodb å¼æå°±ä¼åæè®°å½åå° redo log éé¢ï¼å¹¶æ´æ°åå­ï¼è¿ä¸ªæ¶åæ´æ°å°±ç®å®æäºãåæ¶ï¼innodb å¼æä¼å¨éå½çæ¶åï¼å°è¿ä¸ªæä½è®°å½æ´æ°å°ç£çéé¢ï¼èè¿ä¸ªæ´æ°å¾å¾æ¯å¨ç³»ç»æ¯è¾ç©ºé²çæ¶ååã\n\n> æ³¨æï¼åªè¦åå¥ redo logï¼é£è¿ä¸ªæ°æ®åºå°±ç®åäºè¿ä¸ªäºæï¼ä¹å°±æ¯åäºç¸åºçæ´æ°ï¼å°½ç®¡å¯è½è¿æ²¡ççå»åï¼ä½å¯¹å¤æ¥çå°±æ¯åäºã\n\nç±»ä¼¼äºææçç²æ¿ä¼åæ»¡ï¼innodb ç redo log ä¹æ¯åºå®å¤§å°çãæ¯å¦å¯ä»¥éç½®ä¸ºä¸ç» 4 ä¸ªæä»¶ï¼æ¯ä¸ªæä»¶çå¤§å°æ¯ 1gbï¼é£ä¹è¿åâç²æ¿âæ»å±å°±å¯ä»¥è®°å½ 4gb çæä½ãä»å¤´å¼å§åï¼åå°æ«å°¾å°±ååå°å¼å¤´å¾ªç¯åï¼å¦ä¸é¢è¿ä¸ªå¾æç¤ºï¼\n\n * write pos æ¯å½åè®°å½çä½ç½®ï¼ä¸è¾¹åä¸è¾¹åç§»ï¼åå°ç¬¬ 3 å·æä»¶æ«å°¾åå°±åå° 0 å·æä»¶å¼å¤´ã\n * checkpoint æ¯å½åè¦æ¦é¤çä½ç½®ï¼ä¹æ¯å¾åæ¨ç§»å¹¶ä¸å¾ªç¯çï¼æ¦é¤è®°å½åè¦æè®°å½æ´æ°å°æ°æ®æä»¶ã\n\nwrite pos å checkpoint ä¹é´çæ¯âç²æ¿âä¸è¿ç©ºççé¨åï¼å¯ä»¥ç¨æ¥è®°å½æ°çæä½ãå¦æ write pos è¿½ä¸ checkpointï¼è¡¨ç¤ºâç²æ¿âæ»¡äºï¼è¿æ¶åä¸è½åæ§è¡æ°çæ´æ°ï¼å¾åä¸æ¥åæ¦æä¸äºè®°å½ï¼æ checkpoint æ¨è¿ä¸ä¸ã\n\næäº redo logï¼innodb å°±å¯ä»¥ä¿è¯å³ä½¿æ°æ®åºåçå¼å¸¸éå¯ï¼ä¹åæäº¤çè®°å½é½ä¸ä¼ä¸¢å¤±ï¼è¿ä¸ªè½åç§°ä¸º crash-safeã\n\n> è¦çè§£ crash-safe è¿ä¸ªæ¦å¿µï¼å¯ä»¥æ³æ³æä»¬åé¢èµè´¦è®°å½çä¾å­ãåªè¦èµè´¦è®°å½è®°å¨äºç²æ¿ä¸æåå¨äºè´¦æ¬ä¸ï¼ä¹åå³ä½¿ææå¿è®°äºï¼æ¯å¦çªç¶åä¸å å¤©ï¼æ¢å¤çæåä¾ç¶å¯ä»¥éè¿è´¦æ¬åç²æ¿ä¸çæ°æ®æç¡®èµè´¦è´¦ç®ã\n> \n> æä»¥æä»¬è¯´äºï¼åªè¦å¾ redo log åäºï¼å°±ç®æ°æ®åºåè¿è¿ä»¶äºäºã\n\n\n# 2. éè¦çæ¥å¿æ¨¡åï¼binlog\n\nåé¢æä»¬è®²è¿ï¼mysql æ´ä½æ¥çï¼å¶å®å°±æä¸¤åï¼ä¸åæ¯ server å±ï¼å®ä¸»è¦åçæ¯ mysql åè½å±é¢çäºæï¼è¿æä¸åæ¯å¼æå±ï¼è´è´£å­å¨ç¸å³çå·ä½äºå®ãä¸é¢æä»¬èå°çç²æ¿ redo log æ¯ innodb å¼æç¹æçæ¥å¿ï¼è server å±ä¹æèªå·±çæ¥å¿ï¼ç§°ä¸º binlogï¼å½æ¡£æ¥å¿ï¼ã\n\n> ä¹è®¸ä½ ä¼é®ï¼ä¸ºä»ä¹ä¼æä¸¤ä»½æ¥å¿å¢ï¼\n> \n> å ä¸ºæå¼å§ mysql éå¹¶æ²¡æ innodb å¼æãmysql èªå¸¦çå¼ææ¯ myisamï¼ä½æ¯ myisam æ²¡æ crash-safe çè½åï¼binlog æ¥å¿åªè½ç¨äºå½æ¡£ãè innodb æ¯å¦ä¸ä¸ªå¬å¸ä»¥æä»¶å½¢å¼å¼å¥ mysql çï¼æ¢ç¶åªä¾é  binlog æ¯æ²¡æ crash-safe è½åçï¼æä»¥ innodb ä½¿ç¨å¦å¤ä¸å¥æ¥å¿ç³»ç»ââä¹å°±æ¯ redo log æ¥å®ç° crash-safe è½åã\n\nredo log ä¸ binlog æä»¥ä¸ä¸ç¹ä¸åï¼\n\n 1. redo log æ¯ innodb å¼æç¹æçï¼binlog æ¯ mysql ç server å±å®ç°çï¼ææå¼æé½å¯ä»¥ä½¿ç¨ã\n 2. redo log æ¯ç©çæ¥å¿ï¼è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹âï¼binlog æ¯é»è¾æ¥å¿ï¼è®°å½çæ¯è¿ä¸ªè¯­å¥çåå§é»è¾ï¼æ¯å¦âç» id=2 è¿ä¸è¡ç c å­æ®µå  1 âã\n 3. redo log æ¯å¾ªç¯åçï¼ç©ºé´åºå®ä¼ç¨å®ï¼binlog æ¯å¯ä»¥è¿½å åå¥çãâè¿½å åâæ¯æ binlog æä»¶åå°ä¸å®å¤§å°åä¼åæ¢å°ä¸ä¸ä¸ªï¼å¹¶ä¸ä¼è¦çä»¥åçæ¥å¿ã\n\næäºå¯¹è¿ä¸¤ä¸ªæ¥å¿çæ¦å¿µæ§çè§£ï¼æä»¬åæ¥çæ§è¡å¨å innodb å¼æå¨æ§è¡è¿ä¸ªç®åç update è¯­å¥æ¶çåé¨æµç¨ï¼\n\n 1. æ§è¡å¨åæ¾å¼æå id=2 è¿ä¸è¡ãid æ¯ä¸»é®ï¼å¼æç´æ¥ç¨æ æç´¢æ¾å°è¿ä¸è¡ãå¦æ id=2 è¿ä¸è¡æå¨çæ°æ®é¡µæ¬æ¥å°±å¨åå­ä¸­ï¼å°±ç´æ¥è¿åç»æ§è¡å¨ï¼å¦åï¼éè¦åä»ç£çè¯»å¥åå­ï¼ç¶ååè¿åã\n 2. æ§è¡å¨æ¿å°å¼æç»çè¡æ°æ®ï¼æè¿ä¸ªå¼å ä¸ 1ï¼æ¯å¦åæ¥æ¯ nï¼ç°å¨å°±æ¯ n+1ï¼å¾å°æ°çä¸è¡æ°æ®ï¼åè°ç¨å¼ææ¥å£åå¥è¿è¡æ°æ°æ®ã\n 3. å¼æå°è¿è¡æ°æ°æ®æ´æ°å°åå­ä¸­ï¼åæ¶å°è¿ä¸ªæ´æ°æä½è®°å½å° redo log éé¢ï¼æ­¤æ¶ redo log å¤äº prepare ç¶æãç¶ååç¥æ§è¡å¨æ§è¡å®æäºï¼éæ¶å¯ä»¥æäº¤äºå¡ã\n 4. æ§è¡å¨çæè¿ä¸ªæä½ç binlogï¼å¹¶æ binlog åå¥ç£çã\n 5. æ§è¡å¨è°ç¨å¼æçæäº¤äºå¡æ¥å£ï¼å¼ææåååå¥ç redo log æ¹ææäº¤ï¼commitï¼ç¶æï¼æ´æ°å®æã\n\nä¸é¢ç»åºè¿ä¸ª update è¯­å¥çæ§è¡æµç¨å¾ï¼å¾ä¸­æµè²æ¡è¡¨ç¤ºæ¯å¨ innodb åé¨æ§è¡çï¼æ·±è²æ¡è¡¨ç¤ºæ¯å¨æ§è¡å¨ä¸­æ§è¡çã\n\nä½ å¯è½æ³¨æå°äºï¼æåä¸æ­¥çä¸å»æç¹âç»âï¼å° redo log çåå¥ææäºä¸¤ä¸ªæ­¥éª¤ï¼prepare å commitï¼è¿å°±æ¯"ä¸¤é¶æ®µæäº¤"ã\n\n> è¿ä¸ ddia ä¸­å¨åå¸å¼äºå¡çåå­æäº¤ä¸­æè®²çâä¸¤é¶æ®µæäº¤âæç¹åºå«ï¼è¿éä¸æ¯åå¸å¼äºå¡çã\n\n\n# 3. ä¸¤é¶æ®µæäº¤\n\nä¸ºä»ä¹å¿é¡»æâä¸¤é¶æ®µæäº¤âå¢ï¼è¿æ¯ä¸ºäºè®©ä¸¤ä»½æ¥å¿ä¹é´çé»è¾ä¸è´ãè¦è¯´æè¿ä¸ªé®é¢ï¼æä»¬å¾ä»æç« å¼å¤´çé£ä¸ªé®é¢è¯´èµ·ï¼ææ ·è®©æ°æ®åºæ¢å¤å°åä¸ªæåä»»æä¸ç§çç¶æï¼\n\n\n# 3.1 æ°æ®åºçæ¢å¤\n\nåé¢æä»¬è¯´è¿äºï¼binlog ä¼è®°å½ææçé»è¾æä½ï¼å¹¶ä¸æ¯éç¨âè¿½å åâçå½¢å¼ãå¦æä½ ç dba æ¿è¯ºè¯´åä¸ªæåå¯ä»¥æ¢å¤ï¼é£ä¹å¤ä»½ç³»ç»ä¸­ä¸å®ä¼ä¿å­æè¿åä¸ªæçææ binlogï¼åæ¶ç³»ç»ä¼å®æåæ´åºå¤ä»½ãè¿éçâå®æâåå³äºç³»ç»çéè¦æ§ï¼å¯ä»¥æ¯ä¸å¤©ä¸å¤ï¼ä¹å¯ä»¥æ¯ä¸å¨ä¸å¤ã\n\n> å·ä½çå¤ä»½é¢çï¼éè¦èè rtoï¼æ¢å¤æ¶é´ç®æ ï¼è¿ä¸ªææ ãå¤ªé¢ç¹ä¼æ¶èå¤ªå¤å­å¨ç©ºé´ï¼ä½å¤ªä¹ä¼ä½¿å¾ rto å¤ªå¤§ã\n\nå½éè¦æ¢å¤å°æå®çæä¸ç§æ¶ï¼æ¯å¦æå¤©ä¸åä¸¤ç¹åç°ä¸­ååäºç¹æä¸æ¬¡è¯¯å è¡¨ï¼éè¦æ¾åæ°æ®ï¼é£ä½ å¯ä»¥è¿ä¹åï¼\n\n * é¦åæ¾å°æè¿çä¸æ¬¡å¨éå¤ä»½\n * ç¶åä»å¤ä»½çæ¶é´ç¹å¼å§ï¼å°å¤ä»½ç binlog ä¾æ¬¡ååºæ¥ï¼éæ¾å°ä¸­åè¯¯å è¡¨ä¹åçé£ä¸ªæ¶å»\n\nè¿æ ·ä½ çä¸´æ¶åºå°±è·è¯¯å ä¹åççº¿ä¸åºä¸æ ·äºï¼ç¶åä½ å¯ä»¥æè¡¨æ°æ®ä»ä¸´æ¶åºååºæ¥ï¼æéè¦æ¢å¤å°çº¿ä¸åºå»ã\n\né¤äºæ¢å¤è¯¯å çè¡¨ï¼ææ¶åè¿éè¦å¢å ä»èç¹å¯æ¬æ¥å¢å è¯»æ§è½ï¼ç°å¨å¸¸è§çåæ³ä¹æ¯ç¨å¨éå¤ä»½å ä¸åºç¨ binlog æ¥å®ç°çãå æ­¤ï¼è¿ä¸ªæä½ååéè¦ã\n\n\n# 3.2 ä¸ºä»ä¹éè¦ä¸¤é¶æ®µæäº¤\n\nè¯´å®äºæ°æ®æ¢å¤è¿ç¨ï¼æä»¬åæ¥è¯´è¯´ï¼ä¸ºä»ä¹æ¥å¿éè¦âä¸¤é¶æ®µæäº¤âã\n\nè¿éä¸å¦¨ç¨åè¯æ³æ¥è¿è¡è§£éãç±äº redo log å binlog æ¯ä¸¤ä¸ªç¬ç«çé»è¾ï¼å¦æä¸ç¨ä¸¤é¶æ®µæäº¤ï¼è¦ä¹å°±æ¯ååå® redo log åå binlogï¼è¦ä¹éç¨åè¿æ¥çé¡ºåºãæä»¬ççè¿ä¸¤ç§æ¹å¼ä¼æä»ä¹é®é¢ï¼\n\n * åå redo log åå binlogï¼åè®¾å¨ redo log åå®ï¼binlog è¿æ²¡æåå®çæ¶åï¼mysql è¿ç¨å¼å¸¸éå¯ãç±äºæä»¬åé¢è¯´è¿çï¼redo log åå®ä¹åï¼å°±ç®æ°æ®åºåäºè¿ä»¶äºäºï¼ç³»ç»å³ä½¿å´©æºï¼ä»ç¶è½å¤ææ°æ®æ¢å¤åæ¥ï¼æä»¥æ¢å¤åè¿ä¸è¡ c çå¼æ¯ 1ãä½æ¯ç±äº binlog æ²¡åå®å°± crash äºï¼è¿æ¶å binlog éé¢å°±æ²¡æè®°å½è¿ä¸ªè¯­å¥ãå æ­¤ï¼ä¹åå¤ä»½æ¥å¿çæ¶åï¼å­èµ·æ¥ç binlog éé¢å°±æ²¡æè¿æ¡è¯­å¥ãç¶åä½ ä¼åç°ï¼å¦æéè¦ç¨è¿ä¸ª binlog æ¥æ¢å¤ä¸´æ¶åºçè¯ï¼ç±äºè¿ä¸ªè¯­å¥ç binlog ä¸¢å¤±ï¼è¿ä¸ªä¸´æ¶åºå°±ä¼å°äºè¿ä¸æ¬¡æ´æ°ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 0ï¼ä¸ååºçå¼ä¸åã\n * åå binlog åå redo logï¼å¦æå¨ binlog åå®ä¹å crashï¼ç±äº redo log è¿æ²¡åï¼æä»¥æ°æ®åºå°±ç®è¿æ²¡åè¿ä»¶äºï¼å´©æºæ¢å¤ä»¥åè¿ä¸ªäºå¡æ æï¼æä»¥è¿ä¸è¡ c çå¼æ¯ 0ãä½æ¯ binlog éé¢å·²ç»è®°å½äºâæ c ä» 0 æ¹æ 1âè¿ä¸ªæ¥å¿ãæä»¥ï¼å¨ä¹åç¨ binlog æ¥æ¢å¤çæ¶åå°±å¤äºä¸ä¸ªäºå¡åºæ¥ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 1ï¼ä¸ååºçå¼ä¸åã\n\nå¯ä»¥çå°ï¼å¦æä¸ä½¿ç¨âä¸¤é¶æ®µæäº¤âï¼é£ä¹æ°æ®åºçç¶æå°±æå¯è½åç¨å®çæ¥å¿æ¢å¤åºæ¥çåºçç¶æä¸ä¸è´ãå¨éç¨äºä¸¤é¶æ®µæäº¤ä¹åï¼å¯ä»¥åæè¿ä¹ä¸ä¸ªè¿ç¨ï¼1. prepare é¶æ®µ 2. å binlog 3. commitï¼é£ï¼\n\n * å¦æå¨ 2 ä¹åå´©æºï¼éå¯æ¢å¤ï¼æ¢å¤ååç°æ²¡æ commitï¼äºå¡åæ»ï¼å¤ä»½æ¢å¤æ¶æ²¡æ binlogï¼ä¸¤èä¸è´ã\n * å¦æå¨ 3 ä¹åå´©æºï¼è½ç¶æ²¡ commitï¼ä½æ»¡è¶³ prepare å binlog å®æ´ï¼æä»¥éå¯åä¼èªå¨ commitï¼å¤ä»½æ¢å¤æ¶æ binlogï¼ä¸¤èä¸è´ã\n\n> è¦çæ¸è¿éçå³ç³»ãå½åçå´©æºæ¶ï¼éå¯æ¢å¤æ¯åªä¾é  redo log æ¥å®ç°çå®å¨ãèå½éè¦å¤ä»½ææ¢å¤æ¶ï¼æ¯éè¦ binlog æ¥å®ç°ï¼æ¯ç« binlog çè®°å½ä¸»è¦å°±æ¯ç¨äºå¤ä»½ï¼å®æå®æ´çé»è¾è®°å½ãæä»¬è¦å®ç°çç®æ æ¯éå¯æ¢å¤åå¤ä»½æ¢å¤ä¸¤ä¸ªç¶åµæ¢å¤å¾å°çåºæ¯ä¸æ ·çç¶æï¼è¿æ ·å°±ä¸ç¨æå¿æ¥å¿åéäºã\n\nå¦æä¸ç¨ä¸¤é¶æ®µæäº¤ï¼é£å´©æºæ¢å¤åçä¸»åºå¯è½ä¸å¤ä»½åºæ¥çä»åºäº§çæ°æ®ä¸ä¸è´ç°è±¡ã\n\nç®åè¯´ï¼redo log å binlog é½å¯ä»¥ç¨äºè¡¨ç¤ºäºå¡çæäº¤ç¶æï¼èä¸¤é¶æ®µæäº¤å°±æ¯è®©è¿ä¸¤ä¸ªç¶æä¿æé»è¾ä¸çä¸è´ã\n\n\n# summary\n\nä»å¤©ä»ç»äº mysql ä¸­æéè¦çä¸¤ä¸ªæ¥å¿ï¼ç©çæ¥å¿ redo log åé»è¾æ¥å¿ binlogã\n\n * redo log ç¨äºä¿è¯ crash-safe è½åãinnodb_flush_log_at_trx_commit è¿ä¸ªåæ°è®¾ç½®æ 1 çæ¶åï¼è¡¨ç¤ºæ¯æ¬¡äºå¡ç redo log é½ç´æ¥æä¹åå°ç£çãè¿ä¸ªåæ°æå»ºè®®ä½ è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ mysql å¼å¸¸éå¯ä¹åæ°æ®ä¸ä¸¢å¤±ã\n * binlog æå®æ´çé»è¾è®°å½ï¼å°±å¯ä»¥ç¨äºå¤ä»½æ¢å¤ï¼sync_binlog è¿ä¸ªåæ°è®¾ç½®æ 1 çæ¶åï¼è¡¨ç¤ºæ¯æ¬¡äºå¡ç binlog é½æä¹åå°ç£çãè¿ä¸ªåæ°æä¹å»ºè®®ä½ è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ mysql å¼å¸¸éå¯ä¹å binlog ä¸ä¸¢å¤±ã\n\nä¸¤é¶æ®µæäº¤æ¯è·¨ç³»ç»ç»´ææ°æ®é»è¾ä¸è´æ§æ¶å¸¸ç¨çä¸ä¸ªæ¹æ¡ï¼å³ä½¿ä½ ä¸åæ°æ®åºåæ ¸å¼åï¼æ¥å¸¸å¼åä¸­ä¹æå¯è½ä¼ç¨å°ã\n\n\n# è¡¥å\n\ninnodb ä½¿ç¨ redo log çåå ï¼å¶åé¨æä¸ä¸ª buffer pool çç»æï¼æ¯ç¨äºç¼å­ mysql ç£çæ°æ®çåå­ç©ºé´ãæ­¤æ¶ä¼æ¶åå° buffer pool ä¸­çæ°æ®è¿æ²¡æ¥å¾åå·çï¼åå­ä¸­çæ°æ®å æ­çµå°±å·²ä¸¢å¤±çé®é¢ãææ¯æ¬¡ä¿®æ¹åçå¼è®°å½å°ç£çä¸ç redo log ä¸­ï¼å¯ä»¥ä¿è¯çªç¶æ­çµï¼ä¹å¯ä»¥æ ¹æ® redo log æ¥æ¢å¤ buffer poolï¼è¿æ ·ç¨å°äº buffer pool çåå­é«ææ§ï¼ä¹ä¿è¯äºæ°æ®ä¸ä¼ä¸¢å¤±ã\n\né½æ¯ç£çæä½ï¼ä¸ºä»ä¹ä¸ç´æ¥å°ä¿®æ¹çæ°æ®åå°æ°æ®æä»¶éé¢å»å¢ï¼ å ä¸º redo log æ¯ç£çé¡ºåºåï¼æ°æ®å·çæ¯ç£çéæºåï¼ç£ççé¡ºåºåæ¯éæºåé«æçå¤ã',charsets:{cjk:!0},lastUpdated:"2023/05/17, 03:30:36",lastUpdatedTimestamp:1684294236e3},{title:"äºå¡éç¦»",frontmatter:{title:"äºå¡éç¦»",date:"2023-05-17T14:40:59.000Z",permalink:"/pages/b99352/",categories:["ä¸­é´ä»¶","MySQL","ä¸æ ï¼MySQL å®æ 45 è®²"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/06.MySQL/05.%E4%B8%93%E6%A0%8F%EF%BC%9AMySQL%20%E5%AE%9E%E6%88%98%2045%20%E8%AE%B2/03.%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB.html",relativePath:"ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/03.äºå¡éç¦».md",key:"v-66f73835",path:"/pages/b99352/",headers:[{level:2,title:"1. éç¦»æ§ä¸éç¦»çº§å«",slug:"_1-éç¦»æ§ä¸éç¦»çº§å«",normalizedTitle:"1. éç¦»æ§ä¸éç¦»çº§å«",charIndex:251},{level:2,title:"2. äºå¡éç¦»çå®ç°",slug:"_2-äºå¡éç¦»çå®ç°",normalizedTitle:"2. äºå¡éç¦»çå®ç°",charIndex:2740},{level:2,title:"3. äºå¡çå¯å¨æ¹å¼",slug:"_3-äºå¡çå¯å¨æ¹å¼",normalizedTitle:"3. äºå¡çå¯å¨æ¹å¼",charIndex:3566},{level:2,title:"Summary",slug:"summary",normalizedTitle:"summary",charIndex:4449},{level:2,title:"4. äºå¡å°åºéç¦»è¿æ¯ä¸éç¦»ï¼",slug:"_4-äºå¡å°åºéç¦»è¿æ¯ä¸éç¦»",normalizedTitle:"4. äºå¡å°åºéç¦»è¿æ¯ä¸éç¦»ï¼",charIndex:4559},{level:3,title:"4.1 snapshot å¨ MVCC éæ¯ææ ·å·¥ä½çï¼",slug:"_4-1-snapshot-å¨-mvcc-éæ¯ææ ·å·¥ä½ç",normalizedTitle:"4.1 snapshot å¨ mvcc éæ¯ææ ·å·¥ä½çï¼",charIndex:5539},{level:3,title:"4.2 æ´æ°é»è¾",slug:"_4-2-æ´æ°é»è¾",normalizedTitle:"4.2 æ´æ°é»è¾",charIndex:8723},{level:3,title:"4.3 Summary",slug:"_4-3-summary",normalizedTitle:"4.3 summary",charIndex:10522},{level:2,title:"QA",slug:"qa",normalizedTitle:"qa",charIndex:10858}],headersStr:"1. éç¦»æ§ä¸éç¦»çº§å« 2. äºå¡éç¦»çå®ç° 3. äºå¡çå¯å¨æ¹å¼ Summary 4. äºå¡å°åºéç¦»è¿æ¯ä¸éç¦»ï¼ 4.1 snapshot å¨ MVCC éæ¯ææ ·å·¥ä½çï¼ 4.2 æ´æ°é»è¾ 4.3 Summary QA",content:"> åèï¼\n> \n>  * 03 | äºå¡éç¦»ï¼ä¸ºä»ä¹ä½ æ¹äºæè¿çä¸è§ï¼| æå®¢æ¶é´\n>  * 08 | äºå¡å°åºæ¯éç¦»çè¿æ¯ä¸éç¦»çï¼| æå®¢æ¶é´\n\nç®åæ¥è¯´ï¼äºå¡å°±æ¯è¦ä¿è¯ä¸ç»æ°æ®åºæä½ï¼è¦ä¹å¨é¨æåï¼è¦ä¹å¨é¨å¤±è´¥ãå¨ MySQL ä¸­ï¼äºå¡æ¯ææ¯å¨å¼æå±å®ç°çãMySQL åçç MyISAM å¼æå°±ä¸æ¯æäºå¡ï¼è¿ä¹æ¯ MyISAM è¢« InnoDB åä»£çéè¦åå ä¹ä¸ã\n\nä»å¤©çæç« å°ä»¥ InnoDB ä¸ºä¾ï¼åæ MySQL å¨äºå¡æ¯ææ¹é¢çç¹å®å®ç°ï¼å¹¶åºäºåçç»åºç¸åºçå®è·µå»ºè®®ã\n\n\n# 1. éç¦»æ§ä¸éç¦»çº§å«\n\næå°äºå¡ï¼ä½ è¯å®ä¼æ³å° ACIDï¼ä»å¤©ä¸»è¦è¦è®²çæ¯å¶ä¸­ç Iï¼ä¹å°±æ¯éç¦»æ§ã\n\nå½æ°æ®åºä¸æå¤ä¸ªäºå¡åæ¶æ§è¡çæ¶åï¼å°±å¯è½åºç°èè¯»ï¼dirty readï¼ãä¸å¯éå¤è¯»ï¼non-repeatable readï¼ãå¹»è¯»ï¼phantom readï¼çé®é¢ï¼ä¸ºäºè§£å³è¿äºé®é¢ï¼å°±æäºâéç¦»çº§å«âçæ¦å¿µãå¨è°éç¦»çº§å«ä¹åï¼ä½ é¦åè¦ç¥éï¼ä½ éç¦»å¾è¶ä¸¥å®ï¼æçå°±ä¼è¶ä½ãå æ­¤å¾å¤æ¶åï¼æä»¬é½è¦å¨äºèä¹é´å trade-offã\n\nå¹¶åäºå¡å¯è½åççå¼å¸¸æåµ\n * èåï¼ä¸ä¸ªäºå¡è¦çäºå¦ä¸ä¸ªä»å¨è¿è¡ä¸­ãå°æªæäº¤çäºå¡åå¥çå¼ï¼ç ´åæ°æ®çå®æ´æ§çº¦æï¼ä½¿ç³»ç»æ æ³æ­£ç¡®åæ»äºå¡ï¼\n * èè¯»ï¼ä¸ä¸ªäºå¡è¯»å°äºå¦ä¸ä¸ªå°æªæäº¤çäºå¡åå¥çå¼ï¼ç±äºå¶ä»äºå¡åæ»é æçï¼\n * ä¸å¯éå¤è¯»ï¼å¨ä¸ä¸ªäºå¡ä¸­æ¥è¯¢ä¸ä¸ªå¼ä¸¤æ¬¡ï¼ä½ä¸¤æ¬¡æ¥è¯¢è¿åçå¼ä¸åï¼è¯»å°çæ¯å¶ä»äºå¡å·²ç»æäº¤çæ°æ®ï¼\n * å¹»è¯»ï¼å½ä¸ä¸ªäºå¡è¿è¡æ¡ä»¶æ¥è¯¢æ¶ï¼å¦ä¸ä¸ªäºå¡å¨ä¸­é´æå¥æå é¤äºå¹éè¯¥æ¡ä»¶çæ°æ®ï¼æ­¤æ¶äºå¡åå»è¯»ï¼å°±ä¼åçå¹»è¯»\n * æ´æ°ä¸¢å¤±ï¼ä¸¤ä¸ªäºå¡è¯»ååä¸ä¸ªå¼ï¼é½è¯å¾å°å¶æ´æ°ä¸ºæ°çä¸åçå¼æ¶ï¼ä¼åçæ´æ°ä¸¢å¤±ãå¶ç»ææ¯ä¸¤ä¸ªæ´æ°åªæä¸ä¸ªä¼çæï¼ä½æ§è¡æ´æ°çå¦ä¸ä¸ªäºå¡å¹¶æªè¢«åç¥å¶æ´æ°æ²¡æçæ\n * è¯»å¾æï¼è¯»å°äºæ°æ®ä¸è´æ§çº¦æè¢«ç ´åçæ°æ®ãï¼Bè¯»æ°æ®æé´ï¼Aå¯¹æ°æ®è¿è¡äºåå¥ï¼å¯¼è´å¨Bçæ¥ä¸æ»¡è¶³çº¦ææ¡ä»¶ï¼\n * åå¾æï¼ä¸¤ä¸ªå¹¶åäºå¡é½è¯»å°äºç¸åçæ°æ®éï¼ä½éååèªä¿®æ¹äºä¸ç¸å¹²çæ°æ®éï¼å¯¼è´æ°æ®çä¸è´æ§çº¦æè¢«ç ´åãï¼A B é½æåå¯¼è´çï¼å¦ DDIA å¼ç­çä¾å­ï¼\n\nSQL æ åçäºå¡éç¦»çº§å«åæ¬ï¼\n\n * è¯»æªæäº¤ï¼read uncommittedï¼ï¼æä¸ä¸ªäºå¡è¿æ²¡æäº¤æ¶ï¼å®åçåæ´å°±è½è¢«å«çäºå¡çå°ã\n * è¯»æäº¤ï¼read committedï¼ï¼ä¸ä¸ªäºå¡æäº¤ä¹åï¼å®åçåæ´æä¼è¢«å¶ä»äºå¡çå°ã\n * å¯éå¤è¯»ï¼repeatable readï¼ï¼ä¸ä¸ªäºå¡æ§è¡è¿ç¨ä¸­çå°çæ°æ®ï¼æ»æ¯è·è¿ä¸ªäºå¡å¨å¯å¨æ¶çå°çæ°æ®æ¯ä¸è´çãå½ç¶å¨å¯éå¤è¯»éç¦»çº§å«ä¸ï¼æªæäº¤åæ´å¯¹å¶ä»äºå¡ä¹æ¯ä¸å¯è§çã\n * å¯ä¸²è¡åï¼serializableï¼ï¼é¡¾åæä¹æ¯å¯¹äºåä¸è¡è®°å½ï¼âåâä¼å âåéâï¼âè¯»âä¼å âè¯»éâãå½åºç°è¯»åéå²çªçæ¶åï¼åè®¿é®çäºå¡å¿é¡»ç­åä¸ä¸ªäºå¡æ§è¡å®æï¼æè½ç»§ç»­æ§è¡ã\n\nå¶ä¸­âè¯»æäº¤âåâå¯éå¤è¯»âæ¯è¾é¾çè§£ï¼æä»¥æç¨ä¸ä¸ªä¾å­è¯´æè¿å ç§éç¦»çº§å«ãåè®¾æ°æ®è¡¨ T ä¸­åªæä¸åï¼å¶ä¸­ä¸è¡çå¼ä¸º 1ï¼ä¸é¢æ¯æç§æ¶é´é¡ºåºæ§è¡ä¸¤ä¸ªäºå¡çè¡ä¸ºã\n\nmysql> create table T(c int) engine=InnoDB;\nmysql> insert into T(c) values(1);\n\n\n1\n2\n\n\næä»¬æ¥ççå¨ä¸åçéç¦»çº§å«ä¸ï¼äºå¡ A ä¼æåªäºä¸åçè¿åç»æï¼ä¹å°±æ¯å¾éé¢ V1ãV2ãV3 çè¿åå¼åå«æ¯ä»ä¹ï¼\n\n * è¥éç¦»çº§å«æ¯âè¯»æªæäº¤âï¼ å V1 çå¼å°±æ¯ 2ãè¿æ¶åäºå¡ B è½ç¶è¿æ²¡ææäº¤ï¼ä½æ¯ç»æå·²ç»è¢« A çå°äºãå æ­¤ï¼V2ãV3 ä¹é½æ¯ 2ã\n * è¥éç¦»çº§å«æ¯âè¯»æäº¤âï¼å V1 æ¯ 1ï¼V2 çå¼æ¯ 2ãäºå¡ B çæ´æ°å¨æäº¤åæè½è¢« A çå°ãæä»¥ï¼ V3 çå¼ä¹æ¯ 2ã\n * è¥éç¦»çº§å«æ¯âå¯éå¤è¯»âï¼å V1ãV2 æ¯ 1ï¼V3 æ¯ 2ãä¹æä»¥ V2 è¿æ¯ 1ï¼éµå¾ªçå°±æ¯è¿ä¸ªè¦æ±ï¼äºå¡å¨æ§è¡æé´çå°çæ°æ®ååå¿é¡»æ¯ä¸è´çã\n * è¥éç¦»çº§å«æ¯âä¸²è¡åâï¼åå¨äºå¡ B æ§è¡âå° 1 æ¹æ 2âçæ¶åï¼ä¼è¢«éä½ãç´å°äºå¡ A æäº¤åï¼äºå¡ B æå¯ä»¥ç»§ç»­æ§è¡ãæä»¥ä» A çè§åº¦çï¼ V1ãV2 å¼æ¯ 1ï¼V3 çå¼æ¯ 2ã\n\nå¨å®ç°ä¸ï¼æ°æ®åºéé¢ä¼åå»ºä¸ä¸ªè§å¾ï¼å¿«ç§ï¼ï¼è®¿é®çæ¶åä»¥è§å¾çé»è¾ç»æä¸ºåãå¨âå¯éå¤è¯»âéç¦»çº§å«ä¸ï¼è¿ä¸ªè§å¾ï¼å¿«ç§ï¼æ¯å¨äºå¡å¯å¨æ¶åå»ºçï¼æ´ä¸ªäºå¡å­å¨æé´é½ç¨è¿ä¸ªéæè§å¾ãå¨âè¯»æäº¤âéç¦»çº§å«ä¸ï¼è¿ä¸ªè§å¾æ¯å¨æ¯ä¸ª SQL è¯­å¥å¼å§æ§è¡çæ¶ååå»ºçãè¿ééè¦æ³¨æçæ¯ï¼âè¯»æªæäº¤âéç¦»çº§å«ä¸ç´æ¥è¿åè®°å½ä¸çææ°å¼ï¼æ²¡æè§å¾æ¦å¿µï¼èâä¸²è¡åâéç¦»çº§å«ä¸ç´æ¥ç¨å éçæ¹å¼æ¥é¿åå¹¶è¡è®¿é®ã\n\n> è¿éæè¯´çâè§å¾âå°±æ¯ DDIA ä¸­æè®²çâå¿«ç§çº§å«éç¦»âçå¿«ç§ã\n\næä»¬å¯ä»¥çå°å¨ä¸åçéç¦»çº§å«ä¸ï¼æ°æ®åºè¡ä¸ºæ¯ææä¸åçãOracle æ°æ®åºçé»è®¤éç¦»çº§å«å¶å®å°±æ¯âè¯»æäº¤âï¼å æ­¤å¯¹äºä¸äºä» Oracle è¿ç§»å° MySQL çåºç¨ï¼ä¸ºä¿è¯æ°æ®åºéç¦»çº§å«çä¸è´ï¼ä½ ä¸å®è¦è®°å¾å° MySQL çéç¦»çº§å«è®¾ç½®ä¸ºâè¯»æäº¤âã\n\néç½®çæ¹å¼æ¯ï¼å°å¯å¨åæ° transaction-isolation çå¼è®¾ç½®æ READ-COMMITTEDãä½ å¯ä»¥ç¨ show variables æ¥æ¥çå½åçå¼ã\n\nmysql> show variables like 'transaction_isolation';\n+-----------------------+----------------+\n| Variable_name | Value |\n+-----------------------+----------------+\n| transaction_isolation | READ-COMMITTED |\n+-----------------------+----------------+\n\n\n1\n2\n3\n4\n5\n6\n\n\næ»ç»æ¥è¯´ï¼å­å¨å³åçï¼æ¯ç§éç¦»çº§å«é½æèªå·±çä½¿ç¨åºæ¯ï¼ä½ è¦æ ¹æ®èªå·±çä¸å¡æåµæ¥å®ã\n\nä½ å¯è½ä¼é®é£ä»ä¹æ¶åéè¦âå¯éå¤è¯»âçåºæ¯å¢ï¼æä»¬æ¥çä¸ä¸ªæ°æ®æ ¡å¯¹é»è¾çæ¡ä¾ãåè®¾ä½ å¨ç®¡çä¸ä¸ªä¸ªäººé¶è¡è´¦æ·è¡¨ãä¸ä¸ªè¡¨å­äºè´¦æ·ä½é¢ï¼ä¸ä¸ªè¡¨å­äºè´¦åæç»ãå°äºæåºä½ è¦åæ°æ®æ ¡å¯¹ï¼ä¹å°±æ¯å¤æ­ä¸ä¸ªæçä½é¢åå½åä½é¢çå·®é¢ï¼æ¯å¦ä¸æ¬æçè´¦åæç»ä¸è´ãä½ ä¸å®å¸æå¨æ ¡å¯¹è¿ç¨ä¸­ï¼å³ä½¿æç¨æ·åçäºä¸ç¬æ°çäº¤æï¼ä¹ä¸å½±åä½ çæ ¡å¯¹ç»æãè¿æ¶åä½¿ç¨âå¯éå¤è¯»âéç¦»çº§å«å°±å¾æ¹ä¾¿ãäºå¡å¯å¨æ¶çè§å¾å¯ä»¥è®¤ä¸ºæ¯éæçï¼ä¸åå¶ä»äºå¡æ´æ°çå½±åã\n\n\n# 2. äºå¡éç¦»çå®ç°\n\nçè§£äºäºå¡çéç¦»çº§å«ï¼æä»¬åæ¥ççäºå¡éç¦»å·ä½æ¯æä¹å®ç°çãè¿éæä»¬å±å¼è¯´æâå¯éå¤è¯»âã\n\nå¨ MySQL ä¸­ï¼å®éä¸æ¯æ¡è®°å½å¨æ´æ°çæ¶åé½ä¼åæ¶è®°å½ä¸æ¡åæ»æä½ãè®°å½ä¸çææ°å¼ï¼éè¿åæ»æä½ï¼é½å¯ä»¥å¾å°åä¸ä¸ªç¶æçå¼ã\n\nåè®¾ä¸ä¸ªå¼ä» 1 è¢«æé¡ºåºæ¹æäº 2ã3ã4ï¼å¨åæ»æ¥å¿éé¢å°±ä¼æç±»ä¼¼ä¸é¢çè®°å½ï¼\n\nå½åå¼æ¯ 4ï¼ä½æ¯å¨æ¥è¯¢è¿æ¡è®°å½çæ¶åï¼ä¸åæ¶å»å¯å¨çäºå¡ä¼æä¸åç read-viewãå¦å¾ä¸­çå°çï¼å¨è§å¾ AãBãC éé¢ï¼è¿ä¸ä¸ªè®°å½çå¼åå«æ¯ 1ã2ã4ï¼åä¸æ¡è®°å½å¨ç³»ç»ä¸­å¯ä»¥å­å¨å¤ä¸ªçæ¬ï¼å°±æ¯æ°æ®åºçå¤çæ¬å¹¶åæ§å¶ï¼MVCCï¼ãå¯¹äº read-view Aï¼è¦å¾å° 1ï¼å°±å¿é¡»å°å½åå¼ä¾æ¬¡æ§è¡å¾ä¸­ææçåæ»æä½å¾å°ã\n\nåæ¶ä½ ä¼åç°ï¼å³ä½¿ç°å¨æå¦å¤ä¸ä¸ªäºå¡æ­£å¨å° 4 æ¹æ 5ï¼è¿ä¸ªäºå¡è· read-view AãBãC å¯¹åºçäºå¡æ¯ä¸ä¼å²çªçã\n\nä½ ä¸å®ä¼é®ï¼åæ»æ¥å¿æ»ä¸è½ä¸ç´ä¿çå§ï¼ä»ä¹æ¶åå é¤å¢ï¼ç­æ¡æ¯ï¼å¨ä¸éè¦çæ¶åæå é¤ãä¹å°±æ¯è¯´ï¼ç³»ç»ä¼å¤æ­ï¼å½æ²¡æäºå¡åéè¦ç¨å°è¿äºåæ»æ¥å¿æ¶ï¼åæ»æ¥å¿ä¼è¢«å é¤ãä»ä¹æ¶åæä¸éè¦äºå¢ï¼å°±æ¯å½ç³»ç»éæ²¡ææ¯è¿ä¸ªåæ»æ¥å¿æ´æ©ç read-view çæ¶åã\n\nåºäºä¸é¢çè¯´æï¼æä»¬æ¥è®¨è®ºä¸ä¸ä¸ºä»ä¹å»ºè®®ä½ å°½éä¸è¦ä½¿ç¨é¿äºå¡:\n\n * é¿äºå¡æå³çç³»ç»éé¢ä¼å­å¨å¾èçäºå¡è§å¾ãç±äºè¿äºäºå¡éæ¶å¯è½è®¿é®æ°æ®åºéé¢çä»»ä½æ°æ®ï¼æä»¥è¿ä¸ªäºå¡æäº¤ä¹åï¼æ°æ®åºéé¢å®å¯è½ç¨å°çåæ»è®°å½é½å¿é¡»ä¿çï¼è¿å°±ä¼å¯¼è´å¤§éå ç¨å­å¨ç©ºé´ã\n * å¨ MySQL 5.5 åä»¥åççæ¬ï¼åæ»æ¥å¿æ¯è·æ°æ®å­å¸ä¸èµ·æ¾å¨ ibdata æä»¶éçï¼å³ä½¿é¿äºå¡æç»æäº¤ï¼åæ»æ®µè¢«æ¸çï¼æä»¶ä¹ä¸ä¼åå°ãæè§è¿æ°æ®åªæ 20GBï¼èåæ»æ®µæ 200GB çåºãæç»åªå¥½ä¸ºäºæ¸çåæ»æ®µï¼éå»ºæ´ä¸ªåºã\n * é¤äºå¯¹åæ»æ®µçå½±åï¼é¿äºå¡è¿å ç¨éèµæºï¼ä¹å¯è½æå®æ´ä¸ªåºï¼è¿ä¸ªæä»¬ä¼å¨åé¢è®²éçæ¶åå±å¼ã\n\n\n# 3. äºå¡çå¯å¨æ¹å¼\n\nå¦åé¢æè¿°ï¼é¿äºå¡æè¿äºæ½å¨é£é©ï¼æå½ç¶æ¯å»ºè®®ä½ å°½éé¿åãå¶å®å¾å¤æ¶åä¸å¡å¼ååå­¦å¹¶ä¸æ¯ææä½¿ç¨é¿äºå¡ï¼éå¸¸æ¯ç±äºè¯¯ç¨æè´ãMySQL çäºå¡å¯å¨æ¹å¼æä»¥ä¸å ç§ï¼\n\n 1. æ¾å¼å¯å¨äºå¡è¯­å¥ï¼ begin æ start transactionãéå¥çæäº¤è¯­å¥æ¯ commitï¼åæ»è¯­å¥æ¯ rollbackã\n 2. set autocommit=0ï¼è¿ä¸ªå½ä»¤ä¼å°è¿ä¸ªçº¿ç¨çèªå¨æäº¤å³æãæå³çå¦æä½ åªæ§è¡ä¸ä¸ª select è¯­å¥ï¼è¿ä¸ªäºå¡å°±å¯å¨äºï¼èä¸å¹¶ä¸ä¼èªå¨æäº¤ãè¿ä¸ªäºå¡æç»­å­å¨ç´å°ä½ ä¸»å¨æ§è¡ commit æ rollback è¯­å¥ï¼æèæ­å¼è¿æ¥ã\n\næäºå®¢æ·ç«¯è¿æ¥æ¡æ¶ä¼é»è®¤è¿æ¥æåååæ§è¡ä¸ä¸ª set autocommit=0 çå½ä»¤ãè¿å°±å¯¼è´æ¥ä¸æ¥çæ¥è¯¢é½å¨äºå¡ä¸­ï¼å¦ææ¯é¿è¿æ¥ï¼å°±å¯¼è´äºæå¤çé¿äºå¡ã\n\nå æ­¤ï¼æä¼å»ºè®®ä½ æ»æ¯ä½¿ç¨ set autocommit=1, éè¿æ¾å¼è¯­å¥çæ¹å¼æ¥å¯å¨äºå¡ã\n\nä½æ¯æçå¼ååå­¦ä¼çº ç»âå¤ä¸æ¬¡äº¤äºâçé®é¢ãå¯¹äºä¸ä¸ªéè¦é¢ç¹ä½¿ç¨äºå¡çä¸å¡ï¼ç¬¬äºç§æ¹å¼æ¯ä¸ªäºå¡å¨å¼å§æ¶é½ä¸éè¦ä¸»å¨æ§è¡ä¸æ¬¡ âbeginâï¼åå°äºè¯­å¥çäº¤äºæ¬¡æ°ãå¦æä½ ä¹æè¿ä¸ªé¡¾èï¼æå»ºè®®ä½ ä½¿ç¨ commit work and chain è¯­æ³ï¼å¨ autocommit ä¸º 1 çæåµä¸ï¼ç¨ begin æ¾å¼å¯å¨çäºå¡ï¼å¦ææ§è¡ commit åæäº¤äºå¡ãå¦ææ§è¡ commit work and chainï¼åæ¯æäº¤äºå¡å¹¶èªå¨å¯å¨ä¸ä¸ä¸ªäºå¡ï¼è¿æ ·ä¹çå»äºåæ¬¡æ§è¡ begin è¯­å¥çå¼éãåæ¶å¸¦æ¥çå¥½å¤æ¯ä»ç¨åºå¼åçè§åº¦æç¡®å°ç¥éæ¯ä¸ªè¯­å¥æ¯å¦å¤äºäºå¡ä¸­ã\n\nä½ å¯ä»¥å¨ information_schema åºç innodb_trx è¿ä¸ªè¡¨ä¸­æ¥è¯¢é¿äºå¡ï¼æ¯å¦ä¸é¢è¿ä¸ªè¯­å¥ï¼ç¨äºæ¥æ¾æç»­æ¶é´è¶è¿ 60s çäºå¡ï¼\n\nselect * from information_schema.innodb_trx where TIME_TO_SEC(timediff(now(),trx_started))>60\n\n\n1\n\n\n\n# Summary\n\nä»¥ä¸ä»ç»äº MySQL çäºå¡éç¦»çº§å«çç°è±¡åå®ç°ï¼æ ¹æ®å®ç°åçåæäºé¿äºå¡å­å¨çé£é©ï¼ä»¥åå¦ä½ç¨æ­£ç¡®çæ¹å¼é¿åé¿äºå¡ãå¸ææä¸¾çä¾å­è½å¤å¸®å©ä½ çè§£äºå¡ï¼å¹¶æ´å¥½å°ä½¿ç¨ MySQL çäºå¡ç¹æ§ã\n\n\n# 4. äºå¡å°åºéç¦»è¿æ¯ä¸éç¦»ï¼\n\nåé¢è¯´äºï¼å¦ææ¯å¯éå¤è¯»éç¦»çº§å«ï¼äºå¡ T å¯å¨çæ¶åä¼åå»ºä¸ä¸ªè§å¾ read-viewï¼ä¹åäºå¡ T æ§è¡æé´ï¼å³ä½¿æå¶ä»äºå¡ä¿®æ¹äºæ°æ®ï¼äºå¡ T çå°çä»ç¶è·å¨å¯å¨æ¶çå°çä¸æ ·ãä½å¨å¨å±éãè¡¨çº§éåè¡éä¸­æå°ï¼ä¸ä¸ªäºå¡è¦æ´æ°ä¸è¡ï¼å¦æåå¥½æå¦å¤ä¸ä¸ªäºå¡æ¥æè¿ä¸è¡çè¡éï¼å®åä¸è½è¿ä¹ç¬èº«äºå¤äºï¼å®ä¼è¢«éä½ï¼è¿å¥ç­å¾ç¶æãé®é¢æ¯âï¼æ¢ç¶è¿å¥äºç­å¾ç¶æï¼é£ä¹ç­å°è¿ä¸ªäºå¡èªå·±è·åå°è¡éè¦æ´æ°æ°æ®çæ¶åï¼å®è¯»å°çå¼åæ¯ä»ä¹å¢ï¼\n\nä¸¾ä¸ä¸ªä¾å­ï¼ä¸é¢æ¯ä¸ä¸ªåªæä¸¤è¡çè¡¨çåå§åè¯­å¥ï¼\n\nmysql> CREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `k` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB;\n\ninsert into t(id, k) values(1,1),(2,2);\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\näºå¡ AãBãC çæµç¨å¦ä¸ï¼\n\nè¿éï¼æä»¬éè¦æ³¨æçæ¯äºå¡çå¯å¨æ¶æºãbegin/start transaction å½ä»¤å¹¶ä¸æ¯ä¸ä¸ªäºå¡çèµ·ç¹ï¼å¨æ§è¡å°å®ä»¬ä¹åçç¬¬ä¸ä¸ªæä½ InnoDB è¡¨çè¯­å¥ï¼äºå¡æçæ­£å¯å¨ãå¦æä½ æ³è¦é©¬ä¸å¯å¨ä¸ä¸ªäºå¡ï¼å¯ä»¥ä½¿ç¨ start transaction with consistent snapshot è¿ä¸ªå½ä»¤ã\n\n * ç¬¬ä¸ç§å¯å¨æ¹å¼ï¼ä¸è´æ§è§å¾æ¯å¨æ§è¡ç¬¬ä¸ä¸ªå¿«ç§è¯»è¯­å¥æ¶åå»ºçï¼\n * ç¬¬äºç§å¯å¨æ¹å¼ï¼ä¸è´æ§è§å¾æ¯å¨æ§è¡ start transaction with consistent snapshot æ¶åå»ºçã\n\nè¿éæ³¨æçæ¯ï¼ä¹åå¦ææ²¡æç¹å«è¯´æï¼é½é»è®¤ autocommit=1ï¼ä¹å°±æ¯å³ä½¿æ²¡ææå¨ start transaction å¼å¯äºå¡ï¼mysql é»è®¤ä¹ä¼å°ç¨æ·çæä½å½åäºå¡å³æ¶æäº¤ã\n\n> æ¬ä¾ä¸­çäºå¡ C æ²¡ææ¾å¼å°ä½¿ç¨ begin/commitï¼è¡¨ç¤ºè¿ä¸ª update è¯­å¥æ¬èº«å°±æ¯ä¸ä¸ªäºå¡ï¼è¯­å¥å®æçæ¶åä¼èªå¨æäº¤ã\n\nç°å¨ä½ ç¥é AãB äºå¡çå°çå¼æ¯ä»ä¹åãè¿ä¸å¤§èå°±æè¿ä¸ªçæè§£å¼ï¼æ´æ·±ä¸æ­¥å°çè§£ MVCCã\n\n> æ¬ä¾ä¸­äºå¡ A æ¥å°ç k å¼æ¯ 1ï¼äºå¡ B æ¥å°ç k å¼æ¯ 3ãæç¹æå°±å¾ä¸ç ~\n\n\n# 4.1 snapshot å¨ MVCC éæ¯ææ ·å·¥ä½çï¼\n\nå¨å¯éå¤è¯»éç¦»çº§å«ä¸ï¼äºå¡å¨å¯å¨çæ¶åå°±âæäºä¸ªå¿«ç§âãæ³¨æï¼è¿ä¸ªå¿«ç§æ¯åºäºæ´åºçã\n\nä½ççè¦ç»å¨åºæå¿«ç§åä¸å¤ªå¯è¡ï¼ä¸ä¸ªæ°æ®åºæ 100Gï¼æä¹å¯è½æ¯ä¸ªäºå¡é½åå¤å¶ 100G æ°æ®åºæ¥ãå®éä¸ï¼DB å¹¶ä¸éè¦ççæ·è´è¿ 100G æ°æ®ãæä»¬çä¸ä¸è¿ä¸ª snapshot æ¯æä¹å®ç°çã\n\nInnoDB éé¢æ¯ä¸ªäºå¡æä¸ä¸ªå¯ä¸çäºå¡ IDï¼å«ä½ transaction idãå®æ¯å¨äºå¡å¼å§çæ¶åå InnoDB çäºå¡ç³»ç»ç³è¯·çï¼æ¯æç³è¯·é¡ºåºä¸¥æ ¼éå¢çãèæ¯è¡æ°æ®ä¹é½æ¯æå¤ä¸ªçæ¬çãæ¯æ¬¡äºå¡æ´æ°æ°æ®çæ¶åï¼é½ä¼çæä¸ä¸ªæ°çæ°æ®çæ¬ï¼å¹¶ä¸æ transaction id èµå¼ç»è¿ä¸ªæ°æ®çæ¬çäºå¡ IDï¼è®°ä¸º row trx_idãåæ¶ï¼æ§çæ°æ®çæ¬è¦ä¿çï¼å¹¶ä¸å¨æ°çæ°æ®çæ¬ä¸­ï¼è½å¤æä¿¡æ¯å¯ä»¥ç´æ¥æ¿å°å®ã\n\n> ä¹å°±æ¯è¯´ï¼æ°æ®è¡¨ä¸­çä¸è¡è®°å½ï¼å¶å®å¯è½æå¤ä¸ªçæ¬ (row)ï¼æ¯ä¸ªçæ¬æèªå·±ç row trx_idã\n\nä¸å¾å°±æ¯ä¸ä¸ªè®°å½è¢«å¤ä¸ªäºå¡è¿ç»­æ´æ°åçç¶æï¼\n\nå¾ä¸­èçº¿æ¡éæ¯åä¸è¡æ°æ®ç 4 ä¸ªçæ¬ï¼å½åææ°çæ¬æ¯ V4ï¼k çå¼æ¯ 22ï¼å®æ¯è¢« transaction id ä¸º 25 çäºå¡æ´æ°çï¼å æ­¤å®ç row trx_id ä¹æ¯ 25ã\n\nå¶å®ï¼å¾ä¸­çä¸ä¸ªç»¿è²èçº¿ç®­å¤´å°±æ¯ undo logï¼åæ»æ¥å¿ï¼ï¼èä¸ æ§çæ¬ V1ãV2ãV3 å¹¶ä¸æ¯ç©çä¸çå®å­å¨çï¼èæ¯æ¯æ¬¡éè¦çæ¶åæ ¹æ®å½åçæ¬å undo log è®¡ç®åºæ¥çãæ¯å¦å¨éè¦ V2 çæ¶åï¼å°±æ¯éè¿ V4 ä¾æ¬¡æ§è¡ U3ãU2 ç®åºæ¥ã\n\næç½äºå¤çæ¬å row trx_id çæ¦å¿µåï¼æä»¬åæ¥æ³ä¸ä¸ï¼InnoDB æ¯æä¹å®ä¹é£ä¸ªâ100Gâçå¿«ç§çâã\n\næç§å¯éå¤è¯»çå®ä¹ï¼ä¸ä¸ªäºå¡å¯å¨çæ¶åï¼è½å¤çå°ææå·²ç»æäº¤çäºå¡ç»æãä½æ¯ä¹åï¼è¿ä¸ªäºå¡æ§è¡æé´ï¼å¶ä»äºå¡çæ´æ°å¯¹å®ä¸å¯è§ãå æ­¤ï¼ä¸ä¸ªäºå¡åªéè¦å¨å¯å¨ååªæ¿è®¤é£äºä½äºèªå·±å¯å¨ä¹åçæ°æ®çæ¬åèªå·±æ´æ°çæ°æ®å°±å¥½äºã\n\nå¨å®ç°ä¸ï¼InnoDB ä¸ºæ¯ä¸ªäºå¡æé äºä¸ä¸ªè§å¾æ°ç»ï¼ç¨æ¥ä¿å­è¿ä¸ªäºå¡å¯å¨ç¬é´ï¼å½åæ­£å¨âæ´»è·âçææäºå¡ IDãâæ´»è·âæçå°±æ¯ï¼å¯å¨äºä½è¿æ²¡æäº¤ãæ°ç»éé¢äºå¡ ID çæå°å¼è®°ä¸ºä½æ°´ä½ï¼å½åç³»ç»éé¢å·²ç»åå»ºè¿çäºå¡ ID çæå¤§å¼å  1 è®°ä¸ºé«æ°´ä½ãè¿ä¸ªè§å¾æ°ç»åé«æ°´ä½ï¼å°±ç»æäºå½åäºå¡çä¸è´æ§è§å¾ï¼read-viewï¼ãèæ°æ®çæ¬çå¯è§æ§è§åï¼å°±æ¯åºäºæ°æ®ç row trx_id åè¿ä¸ªä¸è´æ§è§å¾çå¯¹æ¯ç»æå¾å°çã\n\nMySQL ä¸­æä¸¤ä¸ªâè§å¾âçæ¦å¿µï¼\n * ä¸ä¸ªæ¯ viewãå®æ¯ä¸ä¸ªç¨æ¥è¯¢è¯­å¥å®ä¹çèæè¡¨ï¼å¨è°ç¨çæ¶åæ§è¡æ¥è¯¢è¯­å¥å¹¶çæç»æãåå»ºè§å¾çè¯­æ³æ¯ create view â¦ï¼èå®çæ¥è¯¢æ¹æ³ä¸è¡¨ä¸æ ·ã\n * å¦ä¸ä¸ªæ¯ InnoDB å¨å®ç° MVCC æ¶ç¨å°çä¸è´æ§è¯»è§å¾(read-view)ï¼å³ consistent read viewï¼ç¨äºæ¯æ RCï¼Read Committedï¼è¯»æäº¤ï¼å RRï¼Repeatable Readï¼å¯éå¤è¯»ï¼éç¦»çº§å«çå®ç°ã\n\nè¿ä¸ªè§å¾æ°ç»æææç row trx_id åæäºå ç§ä¸åçæåµï¼\n\nè¿æ ·ï¼å¯¹äºå½åäºå¡çå¯å¨ç¬é´æ¥è¯´ï¼ä¸ä¸ªæ°æ®çæ¬ç row trx_idï¼æä»¥ä¸å ç§å¯è½ï¼\n\n 1. å¦æè½å¨ç»¿è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²æäº¤çäºå¡æèæ¯å½åäºå¡èªå·±çæçï¼è¿ä¸ªæ°æ®æ¯å¯è§çï¼\n 2. å¦æè½å¨çº¢è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±å°æ¥å¯å¨çäºå¡çæçï¼æ¯è¯å®ä¸å¯è§çï¼\n 3. å¦æè½å¨é»è²é¨åï¼é£å°±åæ¬ä¸¤ç§æåµï¼\n    * è¥ row trx_id å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±è¿æ²¡æäº¤çäºå¡çæçï¼ä¸å¯è§\n    * è¥ row trx_id ä¸å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²ç»æäº¤äºçäºå¡çæçï¼å¯è§\n\n> ææ··ï¼è½å¨é»è²åºåæå³çæ¯äºå¡ ID å¨ä½æ°´ä½åé«æ°´ä½è¿ä¸ªèå´éé¢ï¼èçæ­£æ¯æ¯å¦å¯è§ï¼çé»è²åºåæ¯å¦æè¿ä¸ªå¼ãå¦æé»è²åºåæ²¡æè¿ä¸ªäºå¡ IDï¼åå¯è§ï¼å¦ææï¼åä¸å¯è§ãå¨è¿ä¸ªèå´éé¢å¹¶ä¸æå³è¿è¿ä¸ªèå´éæè¿ä¸ªå¼ï¼æ¯å¦ [1,2,3,5]ï¼4 å¨è¿ä¸ªæ°ç» 1-5 çèå´éï¼å´æ²¡å¨è¿ä¸ªæ°ç»éé¢ã\n\næ¯å¦ï¼å¯¹äºå¾ 2 ä¸­çæ°æ®æ¥è¯´ï¼å¦ææä¸ä¸ªäºå¡ï¼å®çä½æ°´ä½æ¯ 18ï¼é£ä¹å½å®è®¿é®è¿ä¸è¡æ°æ®æ¶ï¼å°±ä¼ä» V4 éè¿ U3 è®¡ç®åº V3ï¼æä»¥å¨å®çæ¥ï¼è¿ä¸è¡çå¼æ¯ 11ã\n\næäºè¿ä¸ªå¯è§æ§è§åï¼ç³»ç»éé¢éååççæ´æ°å°±ä¸è¿ä¸ªäºå¡çå°çåå®¹æ å³äºï¼æä»¥è¿ä¸ªäºå¡ç snapshot å°±æ¯âéæâçäºãæä»¥ä½ ç°å¨ç¥éäºï¼InnoDB å©ç¨äºâæææ°æ®é½æå¤ä¸ªçæ¬âçè¿ä¸ªç¹æ§ï¼å®ç°äºâç§çº§åå»ºå¿«ç§âçè½åã\n\nç°å¨åå©äºè¿ä¸ªç¥è¯ï¼æä»¬å¯¹ä¹åçä¾å­è¿è¡åæï¼ççä¸ºä»ä¹äºå¡ A è¿åçç»ææ¯ k=1ãæä»¬ä¸å¦¨åè®¾ï¼\n\n 1. äºå¡ A å¼å§åï¼ç³»ç»éé¢åªæä¸ä¸ªæ´»è·äºå¡ ID æ¯ 99ï¼\n 2. äºå¡ AãBãC ççæ¬å·åå«æ¯ 100ã101ã102ï¼ä¸å½åç³»ç»éåªæè¿åä¸ªäºå¡ï¼\n 3. ä¸ä¸ªäºå¡å¼å§åï¼(1,1ï¼è¿ä¸è¡æ°æ®ç row trx_id æ¯ 90ã\n\nè¿æ ·ï¼äºå¡ A çè§å¾æ°ç»å°±æ¯[99,100], äºå¡ B çè§å¾æ°ç»æ¯[99,100,101], äºå¡ C çè§å¾æ°ç»æ¯[99,100,101,102]ãä¸ºäºç®ååæï¼æåæå¶ä»å¹²æ°è¯­å¥å»æï¼åªç»åºè·äºå¡ A æ¥è¯¢é»è¾æå³çæä½ï¼\n\nä»å¾ä¸­å¯ä»¥çå°ï¼ç¬¬ä¸ä¸ªæææ´æ°æ¯äºå¡ Cï¼ææ°æ®ä» (1,1) æ¹æäº (1,2)ãè¿æ¶åï¼è¿ä¸ªæ°æ®çææ°çæ¬ç row trx_id æ¯ 102ï¼è 90 è¿ä¸ªçæ¬å·²ç»æä¸ºäºåå²çæ¬ãç¬¬äºä¸ªæææ´æ°æ¯äºå¡ Bï¼ææ°æ®ä» (1,2) æ¹æäº (1,3)ãè¿æ¶åï¼è¿ä¸ªæ°æ®çææ°çæ¬ï¼å³ row trx_idï¼æ¯ 101ï¼è 102 åæä¸ºäºåå²çæ¬ãä½ å¯è½æ³¨æå°äºï¼å¨äºå¡ A æ¥è¯¢çæ¶åï¼å¶å®äºå¡ B è¿æ²¡ææäº¤ï¼ä½æ¯å®çæç (1,3) è¿ä¸ªçæ¬å·²ç»åæå½åçæ¬äºãä½è¿ä¸ªçæ¬å¯¹äºå¡ A å¿é¡»æ¯ä¸å¯è§çï¼å¦åå°±åæèè¯»äºãå¥½ï¼ç°å¨äºå¡ A è¦æ¥è¯»æ°æ®äºï¼å®çè§å¾æ°ç»æ¯[99,100]ãå½ç¶äºï¼è¯»æ°æ®é½æ¯ä»å½åçæ¬è¯»èµ·çã\n\næä»¥ï¼äºå¡ A æ¥è¯¢è¯­å¥çè¯»æ°æ®æµç¨æ¯è¿æ ·çï¼\n\n * æ¾å° (1,3) çæ¶åï¼å¤æ­åº row trx_id=101ï¼æ¯é«æ°´ä½å¤§ï¼å¤äºçº¢è²åºåï¼ä¸å¯è§ï¼\n * æ¥çï¼æ¾å°ä¸ä¸ä¸ªåå²çæ¬ï¼ä¸ç row trx_id=102ï¼æ¯é«æ°´ä½å¤§ï¼å¤äºçº¢è²åºåï¼ä¸å¯è§ï¼\n * åå¾åæ¾ï¼ç»äºæ¾å°äºï¼1,1)ï¼å®ç row trx_id=90ï¼æ¯ä½æ°´ä½å°ï¼å¤äºç»¿è²åºåï¼å¯è§ã\n\nè¿æ ·æ§è¡ä¸æ¥ï¼è½ç¶æé´è¿ä¸è¡æ°æ®è¢«ä¿®æ¹è¿ï¼ä½æ¯äºå¡ A ä¸è®ºå¨ä»ä¹æ¶åæ¥è¯¢ï¼çå°è¿è¡æ°æ®çç»æé½æ¯ä¸è´çï¼æä»¥æä»¬ç§°ä¹ä¸ºä¸è´æ§è¯»ã\n\nè¿ä¸ªå¤æ­è§åæ¯ä»ä»£ç é»è¾ç´æ¥è½¬è¯è¿æ¥çï¼ä½æ¯æ­£å¦ä½ æè§ï¼ç¨äºäººèåæå¯è§æ§å¾éº»ç¦ãæä»¥ï¼ç¨æ´ç´è§çè¯è¯´ï¼ä¸ä¸ªæ°æ®çæ¬ï¼å¯¹äºä¸ä¸ªäºå¡è§å¾æ¥è¯´ï¼é¤äºèªå·±çæ´æ°æ»æ¯å¯è§ä»¥å¤ï¼æä¸ç§æåµï¼\n\n * çæ¬æªæäº¤ï¼ä¸å¯è§ï¼\n * çæ¬å·²æäº¤ï¼ä½æ¯æ¯å¨è§å¾åå»ºåæäº¤çï¼ä¸å¯è§ï¼\n * çæ¬å·²æäº¤ï¼èä¸æ¯å¨è§å¾åå»ºåæäº¤çï¼å¯è§ã\n\nç°å¨ï¼æä»¬ç¨è¿ä¸ªè§åæ¥å¤æ­ç¤ºä¾ä¸­çæ¥è¯¢ç»æï¼äºå¡ A çæ¥è¯¢è¯­å¥çè§å¾æ°ç»æ¯å¨äºå¡ A å¯å¨çæ¶åçæçï¼è¿æ¶åï¼\n\n * (1,3) è¿æ²¡æäº¤ï¼å±äºæåµ 1ï¼ä¸å¯è§ï¼\n * (1,2) è½ç¶æäº¤äºï¼ä½æ¯æ¯å¨è§å¾æ°ç»åå»ºä¹åæäº¤çï¼å±äºæåµ 2ï¼ä¸å¯è§ï¼\n * (1,1) æ¯å¨è§å¾æ°ç»åå»ºä¹åæäº¤çï¼å¯è§ã\n\nä½ çï¼å»ææ°å­å¯¹æ¯åï¼åªç¨æ¶é´ååé¡ºåºæ¥å¤æ­ï¼åæèµ·æ¥æ¯ä¸æ¯è½»æ¾å¤äºãæä»¥ï¼åé¢æä»¬å°±é½ç¨è¿ä¸ªè§åæ¥åæã\n\n\n# 4.2 æ´æ°é»è¾\n\næ´ç»å¿çè¯ï¼å¯ä»¥æåºè¿æ ·ä¸ä¸ªçé®ï¼äºå¡ B ç update è¯­å¥ï¼å¦ææç§ä¸è´æ§è¯»ï¼å¥½åç»æä¸å¯¹å¦ï¼ä½ çå¾ 5 ä¸­ï¼äºå¡ B çè§å¾æ°ç»æ¯åçæçï¼ä¹åäºå¡ C ææäº¤ï¼ä¸æ¯åºè¯¥çä¸è§ (1,2) åï¼æä¹è½ç®åº (1,3) æ¥ï¼\n\næ¯çï¼å¦æäºå¡ B å¨æ´æ°ä¹åæ¥è¯¢ä¸æ¬¡æ°æ®ï¼è¿ä¸ªæ¥è¯¢è¿åç k çå¼ç¡®å®æ¯ 1ãä½æ¯ï¼å½å®è¦å»æ´æ°æ°æ®çæ¶åï¼å°±ä¸è½åå¨åå²çæ¬ä¸æ´æ°äºï¼å¦åäºå¡ C çæ´æ°å°±ä¸¢å¤±äºãå æ­¤ï¼äºå¡ B æ­¤æ¶ç set k=k+1 æ¯å¨ï¼1,2ï¼çåºç¡ä¸è¿è¡çæä½ã\n\næä»¥ï¼è¿éå°±ç¨å°äºè¿æ ·ä¸æ¡è§åï¼æ´æ°æ°æ®é½æ¯åè¯»ååçï¼èè¿ä¸ªè¯»ï¼åªè½è¯»å½åçå¼ï¼ç§°ä¸ºâå½åè¯»âï¼current readï¼ã\n\nå æ­¤ï¼å¨æ´æ°çæ¶åï¼å½åè¯»æ¿å°çæ°æ®æ¯ (1,2)ï¼æ´æ°åçæäºæ°çæ¬çæ°æ® (1,3)ï¼è¿ä¸ªæ°çæ¬ç row trx_id æ¯ 101ãæä»¥ï¼å¨æ§è¡äºå¡ B æ¥è¯¢è¯­å¥çæ¶åï¼ä¸çèªå·±ççæ¬å·æ¯ 101ï¼ææ°æ°æ®ççæ¬å·ä¹æ¯ 101ï¼æ¯èªå·±çæ´æ°ï¼å¯ä»¥ç´æ¥ä½¿ç¨ï¼æä»¥æ¥è¯¢å¾å°ç k çå¼æ¯ 3ã\n\nè¿éæä»¬æå°äºä¸ä¸ªæ¦å¿µï¼å«ä½å½åè¯»ãå¶å®ï¼é¤äº update è¯­å¥å¤ï¼select è¯­å¥å¦æå éï¼ä¹æ¯å½åè¯»ãæä»¥ï¼å¦ææäºå¡ A çæ¥è¯¢è¯­å¥ select * from t where id=1 ä¿®æ¹ä¸ä¸ï¼å ä¸ lock in share mode æ for updateï¼ä¹é½å¯ä»¥è¯»å°çæ¬å·æ¯ 101 çæ°æ®ï¼è¿åç k çå¼æ¯ 3ãä¸é¢è¿ä¸¤ä¸ª select è¯­å¥ï¼å°±æ¯åå«å äºè¯»éï¼S éï¼å±äº«éï¼ååéï¼X éï¼æä»éï¼ï¼\n\nmysql> select k from t where id=1 lock in share mode;\nmysql> select k from t where id=1 for update;\n\n\n1\n2\n\n\nåå¾åä¸æ­¥ï¼åè®¾äºå¡ C ä¸æ¯é©¬ä¸æäº¤çï¼èæ¯åæäºä¸é¢çäºå¡ Câï¼ä¼æä¹æ ·å¢ï¼\n\näºå¡ Câçä¸åæ¯ï¼æ´æ°åå¹¶æ²¡æé©¬ä¸æäº¤ï¼å¨å®æäº¤åï¼äºå¡ B çæ´æ°è¯­å¥ååèµ·äºãåé¢è¯´è¿äºï¼è½ç¶äºå¡ Câè¿æ²¡æäº¤ï¼ä½æ¯ (1,2) è¿ä¸ªçæ¬ä¹å·²ç»çæäºï¼å¹¶ä¸æ¯å½åçææ°çæ¬ãé£ä¹ï¼äºå¡ B çæ´æ°è¯­å¥ä¼æä¹å¤çå¢ï¼\n\nè¿æ¶åï¼æä»¬å¨ä¸ä¸ç¯æç« ä¸­æå°çâä¸¤é¶æ®µéåè®®âå°±è¦ä¸åºäºãäºå¡ Câ æ²¡æäº¤ï¼ä¹å°±æ¯è¯´ (1,2) è¿ä¸ªçæ¬ä¸çåéè¿æ²¡éæ¾ãèäºå¡ B æ¯å½åè¯»ï¼å¿é¡»è¦è¯»ææ°çæ¬ï¼èä¸å¿é¡»å éï¼å æ­¤å°±è¢«éä½äºï¼å¿é¡»ç­å°äºå¡ Câ éæ¾è¿ä¸ªéï¼æè½ç»§ç»­å®çå½åè¯»ã\n\nå°è¿éï¼æä»¬æä¸è´æ§è¯»ãå½åè¯»åè¡éå°±ä¸²èµ·æ¥äºã\n\nç°å¨ï¼æä»¬ååå°æç« å¼å¤´çé®é¢ï¼äºå¡çå¯éå¤è¯»çè½åæ¯æä¹å®ç°çï¼âå¯éå¤è¯»çæ ¸å¿å°±æ¯ä¸è´æ§è¯»ï¼consistent readï¼ï¼èäºå¡æ´æ°æ°æ®çæ¶åï¼åªè½ç¨å½åè¯»ãå¦æå½åçè®°å½çè¡éè¢«å¶ä»äºå¡å ç¨çè¯ï¼å°±éè¦è¿å¥éç­å¾ã\n\nèè¯»æäº¤çé»è¾åå¯éå¤è¯»çé»è¾ç±»ä¼¼ï¼å®ä»¬æä¸»è¦çåºå«æ¯ï¼\n\n * å¨å¯éå¤è¯»éç¦»çº§å«ä¸ï¼åªéè¦å¨äºå¡å¼å§çæ¶ååå»ºä¸è´æ§è§å¾ï¼ä¹åäºå¡éçå¶ä»æ¥è¯¢é½å±ç¨è¿ä¸ªä¸è´æ§è§å¾ï¼\n * å¨è¯»æäº¤éç¦»çº§å«ä¸ï¼æ¯ä¸ä¸ªè¯­å¥æ§è¡åé½ä¼éæ°ç®åºä¸ä¸ªæ°çè§å¾ã\n\né£ä¹ï¼æä»¬åçä¸ä¸ï¼å¨è¯»æäº¤éç¦»çº§å«ä¸ï¼äºå¡ A åäºå¡ B çæ¥è¯¢è¯­å¥æ¥å°ç kï¼åå«åºè¯¥æ¯å¤å°å¢ï¼\n\n> è¿ééè¦è¯´æä¸ä¸ï¼âstart transaction with consistent snapshot; âçæææ¯ä»è¿ä¸ªè¯­å¥å¼å§ï¼åå»ºä¸ä¸ªæç»­æ´ä¸ªäºå¡çä¸è´æ§å¿«ç§ãæä»¥ï¼å¨è¯»æäº¤éç¦»çº§å«ä¸ï¼è¿ä¸ªç¨æ³å°±æ²¡æä¹äºï¼ç­æäºæ®éç start transactionã\n\nä¸é¢æ¯è¯»æäº¤æ¶çç¶æå¾ï¼å¯ä»¥çå°è¿ä¸¤ä¸ªæ¥è¯¢è¯­å¥çåå»ºè§å¾æ°ç»çæ¶æºåçäºååï¼å°±æ¯å¾ä¸­ç read view æ¡ãï¼æ³¨æï¼è¿éï¼æä»¬ç¨çè¿æ¯äºå¡ C çé»è¾ç´æ¥æäº¤ï¼èä¸æ¯äºå¡ Câï¼\n\nè¿æ¶ï¼äºå¡ A çæ¥è¯¢è¯­å¥çè§å¾æ°ç»æ¯å¨æ§è¡è¿ä¸ªè¯­å¥çæ¶ååå»ºçï¼æ¶åºä¸ (1,2)ã(1,3) ççææ¶é´é½å¨åå»ºè¿ä¸ªè§å¾æ°ç»çæ¶å»ä¹åãä½æ¯ï¼å¨è¿ä¸ªæ¶å»ï¼\n\n * (1,3) è¿æ²¡æäº¤ï¼å±äºæåµ 1ï¼ä¸å¯è§ï¼\n * (1,2) æäº¤äºï¼å±äºæåµ 3ï¼å¯è§ã\n\næä»¥ï¼è¿æ¶åäºå¡ A æ¥è¯¢è¯­å¥è¿åçæ¯ k=2ãæ¾ç¶å°ï¼äºå¡ B æ¥è¯¢ç»æ k=3ã\n\n\n# 4.3 Summary\n\nInnoDB çè¡æ°æ®æå¤ä¸ªçæ¬ï¼æ¯ä¸ªæ°æ®çæ¬æèªå·±ç row trx_idï¼æ¯ä¸ªäºå¡æèè¯­å¥æèªå·±çä¸è´æ§è§å¾ãæ®éæ¥è¯¢è¯­å¥æ¯ä¸è´æ§è¯»ï¼ä¸è´æ§è¯»ä¼æ ¹æ® row trx_id åä¸è´æ§è§å¾ç¡®å®æ°æ®çæ¬çå¯è§æ§ã\n\n * å¯¹äºå¯éå¤è¯»ï¼æ¥è¯¢åªæ¿è®¤å¨äºå¡å¯å¨åå°±å·²ç»æäº¤å®æçæ°æ®ï¼\n * å¯¹äºè¯»æäº¤ï¼æ¥è¯¢åªæ¿è®¤å¨è¯­å¥å¯å¨åå°±å·²ç»æäº¤å®æçæ°æ®ï¼\n\nèå½åè¯»ï¼æ»æ¯è¯»åå·²ç»æäº¤å®æçææ°çæ¬ã\n\nä½ ä¹å¯ä»¥æ³ä¸ä¸ï¼ä¸ºä»ä¹è¡¨ç»æä¸æ¯æâå¯éå¤è¯»âï¼è¿æ¯å ä¸ºè¡¨ç»ææ²¡æå¯¹åºçè¡æ°æ®ï¼ä¹æ²¡æ row trx_idï¼å æ­¤åªè½éµå¾ªå½åè¯»çé»è¾ã\n\nå½ç¶ï¼MySQL 8.0 å·²ç»å¯ä»¥æè¡¨ç»ææ¾å¨ InnoDB å­å¸éäºï¼ä¹è®¸ä»¥åä¼æ¯æè¡¨ç»æçå¯éå¤è¯»ã\n\n\n# QA\n\nQï¼ä½ ç°å¨ç¥éäºç³»ç»éé¢åºè¯¥é¿åé¿äºå¡ï¼å¦æä½ æ¯ä¸å¡å¼åè´è´£äººåæ¶ä¹æ¯æ°æ®åºè´è´£äººï¼ä½ ä¼æä»ä¹æ¹æ¡æ¥é¿ååºç°æèå¤çè¿ç§æåµå¢ï¼\n\nAï¼è¿ä¸ªé®é¢ï¼æä»¬å¯ä»¥ä»åºç¨å¼åç«¯åæ°æ®åºç«¯æ¥çï¼\n\n * ä»åºç¨å¼åç«¯æ¥çï¼\n   1. ç¡®è®¤æ¯å¦ä½¿ç¨äº set autocommit=0ãè¿ä¸ªç¡®è®¤å·¥ä½å¯ä»¥å¨æµè¯ç¯å¢ä¸­å¼å±ï¼æ MySQL ç general_log å¼èµ·æ¥ï¼ç¶åéä¾¿è·ä¸ä¸ªä¸å¡é»è¾ï¼éè¿ general_log çæ¥å¿æ¥ç¡®è®¤ãä¸è¬æ¡æ¶å¦æä¼è®¾ç½®è¿ä¸ªå¼ï¼ä¹å°±ä¼æä¾åæ°æ¥æ§å¶è¡ä¸ºï¼ä½ çç®æ å°±æ¯æå®æ¹æ 1ã\n   2. ç¡®è®¤æ¯å¦æä¸å¿è¦çåªè¯»äºå¡ãæäºæ¡æ¶ä¼ä¹ æ¯ä¸ç®¡ä»ä¹è¯­å¥åç¨ begin/commit æ¡èµ·æ¥ãæè§è¿æäºæ¯ä¸å¡å¹¶æ²¡æè¿ä¸ªéè¦ï¼ä½æ¯ä¹æå¥½å ä¸ª select è¯­å¥æ¾å°äºäºå¡ä¸­ãè¿ç§åªè¯»äºå¡å¯ä»¥å»æã\n   3. ä¸å¡è¿æ¥æ°æ®åºçæ¶åï¼æ ¹æ®ä¸å¡æ¬èº«çé¢ä¼°ï¼éè¿ SET MAX_EXECUTION_TIME å½ä»¤ï¼æ¥æ§å¶æ¯ä¸ªè¯­å¥æ§è¡çæé¿æ¶é´ï¼é¿ååä¸ªè¯­å¥æå¤æ§è¡å¤ªé¿æ¶é´ã\n * ä»æ°æ®åºç«¯æ¥çï¼\n   1. çæ§ information_schema.Innodb_trx è¡¨ï¼è®¾ç½®é¿äºå¡éå¼ï¼è¶è¿å°±æ¥è­¦ / æè killï¼\n   2. Percona ç pt-kill è¿ä¸ªå·¥å·ä¸éï¼æ¨èä½¿ç¨ï¼\n   3. å¨ä¸å¡åè½æµè¯é¶æ®µè¦æ±è¾åºææç general_logï¼åææ¥å¿è¡ä¸ºæååç°é®é¢ï¼\n   4. å¦æä½¿ç¨çæ¯ MySQL 5.6 æèæ´æ°çæ¬ï¼æ innodb_undo_tablespaces è®¾ç½®æ 2ï¼ææ´å¤§çå¼ï¼ãå¦æççåºç°å¤§äºå¡å¯¼è´åæ»æ®µè¿å¤§ï¼è¿æ ·è®¾ç½®åæ¸çèµ·æ¥æ´æ¹ä¾¿ã",normalizedContent:"> åèï¼\n> \n>  * 03 | äºå¡éç¦»ï¼ä¸ºä»ä¹ä½ æ¹äºæè¿çä¸è§ï¼| æå®¢æ¶é´\n>  * 08 | äºå¡å°åºæ¯éç¦»çè¿æ¯ä¸éç¦»çï¼| æå®¢æ¶é´\n\nç®åæ¥è¯´ï¼äºå¡å°±æ¯è¦ä¿è¯ä¸ç»æ°æ®åºæä½ï¼è¦ä¹å¨é¨æåï¼è¦ä¹å¨é¨å¤±è´¥ãå¨ mysql ä¸­ï¼äºå¡æ¯ææ¯å¨å¼æå±å®ç°çãmysql åçç myisam å¼æå°±ä¸æ¯æäºå¡ï¼è¿ä¹æ¯ myisam è¢« innodb åä»£çéè¦åå ä¹ä¸ã\n\nä»å¤©çæç« å°ä»¥ innodb ä¸ºä¾ï¼åæ mysql å¨äºå¡æ¯ææ¹é¢çç¹å®å®ç°ï¼å¹¶åºäºåçç»åºç¸åºçå®è·µå»ºè®®ã\n\n\n# 1. éç¦»æ§ä¸éç¦»çº§å«\n\næå°äºå¡ï¼ä½ è¯å®ä¼æ³å° acidï¼ä»å¤©ä¸»è¦è¦è®²çæ¯å¶ä¸­ç iï¼ä¹å°±æ¯éç¦»æ§ã\n\nå½æ°æ®åºä¸æå¤ä¸ªäºå¡åæ¶æ§è¡çæ¶åï¼å°±å¯è½åºç°èè¯»ï¼dirty readï¼ãä¸å¯éå¤è¯»ï¼non-repeatable readï¼ãå¹»è¯»ï¼phantom readï¼çé®é¢ï¼ä¸ºäºè§£å³è¿äºé®é¢ï¼å°±æäºâéç¦»çº§å«âçæ¦å¿µãå¨è°éç¦»çº§å«ä¹åï¼ä½ é¦åè¦ç¥éï¼ä½ éç¦»å¾è¶ä¸¥å®ï¼æçå°±ä¼è¶ä½ãå æ­¤å¾å¤æ¶åï¼æä»¬é½è¦å¨äºèä¹é´å trade-offã\n\nå¹¶åäºå¡å¯è½åççå¼å¸¸æåµ\n * èåï¼ä¸ä¸ªäºå¡è¦çäºå¦ä¸ä¸ªä»å¨è¿è¡ä¸­ãå°æªæäº¤çäºå¡åå¥çå¼ï¼ç ´åæ°æ®çå®æ´æ§çº¦æï¼ä½¿ç³»ç»æ æ³æ­£ç¡®åæ»äºå¡ï¼\n * èè¯»ï¼ä¸ä¸ªäºå¡è¯»å°äºå¦ä¸ä¸ªå°æªæäº¤çäºå¡åå¥çå¼ï¼ç±äºå¶ä»äºå¡åæ»é æçï¼\n * ä¸å¯éå¤è¯»ï¼å¨ä¸ä¸ªäºå¡ä¸­æ¥è¯¢ä¸ä¸ªå¼ä¸¤æ¬¡ï¼ä½ä¸¤æ¬¡æ¥è¯¢è¿åçå¼ä¸åï¼è¯»å°çæ¯å¶ä»äºå¡å·²ç»æäº¤çæ°æ®ï¼\n * å¹»è¯»ï¼å½ä¸ä¸ªäºå¡è¿è¡æ¡ä»¶æ¥è¯¢æ¶ï¼å¦ä¸ä¸ªäºå¡å¨ä¸­é´æå¥æå é¤äºå¹éè¯¥æ¡ä»¶çæ°æ®ï¼æ­¤æ¶äºå¡åå»è¯»ï¼å°±ä¼åçå¹»è¯»\n * æ´æ°ä¸¢å¤±ï¼ä¸¤ä¸ªäºå¡è¯»ååä¸ä¸ªå¼ï¼é½è¯å¾å°å¶æ´æ°ä¸ºæ°çä¸åçå¼æ¶ï¼ä¼åçæ´æ°ä¸¢å¤±ãå¶ç»ææ¯ä¸¤ä¸ªæ´æ°åªæä¸ä¸ªä¼çæï¼ä½æ§è¡æ´æ°çå¦ä¸ä¸ªäºå¡å¹¶æªè¢«åç¥å¶æ´æ°æ²¡æçæ\n * è¯»å¾æï¼è¯»å°äºæ°æ®ä¸è´æ§çº¦æè¢«ç ´åçæ°æ®ãï¼bè¯»æ°æ®æé´ï¼aå¯¹æ°æ®è¿è¡äºåå¥ï¼å¯¼è´å¨bçæ¥ä¸æ»¡è¶³çº¦ææ¡ä»¶ï¼\n * åå¾æï¼ä¸¤ä¸ªå¹¶åäºå¡é½è¯»å°äºç¸åçæ°æ®éï¼ä½éååèªä¿®æ¹äºä¸ç¸å¹²çæ°æ®éï¼å¯¼è´æ°æ®çä¸è´æ§çº¦æè¢«ç ´åãï¼a b é½æåå¯¼è´çï¼å¦ ddia å¼ç­çä¾å­ï¼\n\nsql æ åçäºå¡éç¦»çº§å«åæ¬ï¼\n\n * è¯»æªæäº¤ï¼read uncommittedï¼ï¼æä¸ä¸ªäºå¡è¿æ²¡æäº¤æ¶ï¼å®åçåæ´å°±è½è¢«å«çäºå¡çå°ã\n * è¯»æäº¤ï¼read committedï¼ï¼ä¸ä¸ªäºå¡æäº¤ä¹åï¼å®åçåæ´æä¼è¢«å¶ä»äºå¡çå°ã\n * å¯éå¤è¯»ï¼repeatable readï¼ï¼ä¸ä¸ªäºå¡æ§è¡è¿ç¨ä¸­çå°çæ°æ®ï¼æ»æ¯è·è¿ä¸ªäºå¡å¨å¯å¨æ¶çå°çæ°æ®æ¯ä¸è´çãå½ç¶å¨å¯éå¤è¯»éç¦»çº§å«ä¸ï¼æªæäº¤åæ´å¯¹å¶ä»äºå¡ä¹æ¯ä¸å¯è§çã\n * å¯ä¸²è¡åï¼serializableï¼ï¼é¡¾åæä¹æ¯å¯¹äºåä¸è¡è®°å½ï¼âåâä¼å âåéâï¼âè¯»âä¼å âè¯»éâãå½åºç°è¯»åéå²çªçæ¶åï¼åè®¿é®çäºå¡å¿é¡»ç­åä¸ä¸ªäºå¡æ§è¡å®æï¼æè½ç»§ç»­æ§è¡ã\n\nå¶ä¸­âè¯»æäº¤âåâå¯éå¤è¯»âæ¯è¾é¾çè§£ï¼æä»¥æç¨ä¸ä¸ªä¾å­è¯´æè¿å ç§éç¦»çº§å«ãåè®¾æ°æ®è¡¨ t ä¸­åªæä¸åï¼å¶ä¸­ä¸è¡çå¼ä¸º 1ï¼ä¸é¢æ¯æç§æ¶é´é¡ºåºæ§è¡ä¸¤ä¸ªäºå¡çè¡ä¸ºã\n\nmysql> create table t(c int) engine=innodb;\nmysql> insert into t(c) values(1);\n\n\n1\n2\n\n\næä»¬æ¥ççå¨ä¸åçéç¦»çº§å«ä¸ï¼äºå¡ a ä¼æåªäºä¸åçè¿åç»æï¼ä¹å°±æ¯å¾éé¢ v1ãv2ãv3 çè¿åå¼åå«æ¯ä»ä¹ï¼\n\n * è¥éç¦»çº§å«æ¯âè¯»æªæäº¤âï¼ å v1 çå¼å°±æ¯ 2ãè¿æ¶åäºå¡ b è½ç¶è¿æ²¡ææäº¤ï¼ä½æ¯ç»æå·²ç»è¢« a çå°äºãå æ­¤ï¼v2ãv3 ä¹é½æ¯ 2ã\n * è¥éç¦»çº§å«æ¯âè¯»æäº¤âï¼å v1 æ¯ 1ï¼v2 çå¼æ¯ 2ãäºå¡ b çæ´æ°å¨æäº¤åæè½è¢« a çå°ãæä»¥ï¼ v3 çå¼ä¹æ¯ 2ã\n * è¥éç¦»çº§å«æ¯âå¯éå¤è¯»âï¼å v1ãv2 æ¯ 1ï¼v3 æ¯ 2ãä¹æä»¥ v2 è¿æ¯ 1ï¼éµå¾ªçå°±æ¯è¿ä¸ªè¦æ±ï¼äºå¡å¨æ§è¡æé´çå°çæ°æ®ååå¿é¡»æ¯ä¸è´çã\n * è¥éç¦»çº§å«æ¯âä¸²è¡åâï¼åå¨äºå¡ b æ§è¡âå° 1 æ¹æ 2âçæ¶åï¼ä¼è¢«éä½ãç´å°äºå¡ a æäº¤åï¼äºå¡ b æå¯ä»¥ç»§ç»­æ§è¡ãæä»¥ä» a çè§åº¦çï¼ v1ãv2 å¼æ¯ 1ï¼v3 çå¼æ¯ 2ã\n\nå¨å®ç°ä¸ï¼æ°æ®åºéé¢ä¼åå»ºä¸ä¸ªè§å¾ï¼å¿«ç§ï¼ï¼è®¿é®çæ¶åä»¥è§å¾çé»è¾ç»æä¸ºåãå¨âå¯éå¤è¯»âéç¦»çº§å«ä¸ï¼è¿ä¸ªè§å¾ï¼å¿«ç§ï¼æ¯å¨äºå¡å¯å¨æ¶åå»ºçï¼æ´ä¸ªäºå¡å­å¨æé´é½ç¨è¿ä¸ªéæè§å¾ãå¨âè¯»æäº¤âéç¦»çº§å«ä¸ï¼è¿ä¸ªè§å¾æ¯å¨æ¯ä¸ª sql è¯­å¥å¼å§æ§è¡çæ¶ååå»ºçãè¿ééè¦æ³¨æçæ¯ï¼âè¯»æªæäº¤âéç¦»çº§å«ä¸ç´æ¥è¿åè®°å½ä¸çææ°å¼ï¼æ²¡æè§å¾æ¦å¿µï¼èâä¸²è¡åâéç¦»çº§å«ä¸ç´æ¥ç¨å éçæ¹å¼æ¥é¿åå¹¶è¡è®¿é®ã\n\n> è¿éæè¯´çâè§å¾âå°±æ¯ ddia ä¸­æè®²çâå¿«ç§çº§å«éç¦»âçå¿«ç§ã\n\næä»¬å¯ä»¥çå°å¨ä¸åçéç¦»çº§å«ä¸ï¼æ°æ®åºè¡ä¸ºæ¯ææä¸åçãoracle æ°æ®åºçé»è®¤éç¦»çº§å«å¶å®å°±æ¯âè¯»æäº¤âï¼å æ­¤å¯¹äºä¸äºä» oracle è¿ç§»å° mysql çåºç¨ï¼ä¸ºä¿è¯æ°æ®åºéç¦»çº§å«çä¸è´ï¼ä½ ä¸å®è¦è®°å¾å° mysql çéç¦»çº§å«è®¾ç½®ä¸ºâè¯»æäº¤âã\n\néç½®çæ¹å¼æ¯ï¼å°å¯å¨åæ° transaction-isolation çå¼è®¾ç½®æ read-committedãä½ å¯ä»¥ç¨ show variables æ¥æ¥çå½åçå¼ã\n\nmysql> show variables like 'transaction_isolation';\n+-----------------------+----------------+\n| variable_name | value |\n+-----------------------+----------------+\n| transaction_isolation | read-committed |\n+-----------------------+----------------+\n\n\n1\n2\n3\n4\n5\n6\n\n\næ»ç»æ¥è¯´ï¼å­å¨å³åçï¼æ¯ç§éç¦»çº§å«é½æèªå·±çä½¿ç¨åºæ¯ï¼ä½ è¦æ ¹æ®èªå·±çä¸å¡æåµæ¥å®ã\n\nä½ å¯è½ä¼é®é£ä»ä¹æ¶åéè¦âå¯éå¤è¯»âçåºæ¯å¢ï¼æä»¬æ¥çä¸ä¸ªæ°æ®æ ¡å¯¹é»è¾çæ¡ä¾ãåè®¾ä½ å¨ç®¡çä¸ä¸ªä¸ªäººé¶è¡è´¦æ·è¡¨ãä¸ä¸ªè¡¨å­äºè´¦æ·ä½é¢ï¼ä¸ä¸ªè¡¨å­äºè´¦åæç»ãå°äºæåºä½ è¦åæ°æ®æ ¡å¯¹ï¼ä¹å°±æ¯å¤æ­ä¸ä¸ªæçä½é¢åå½åä½é¢çå·®é¢ï¼æ¯å¦ä¸æ¬æçè´¦åæç»ä¸è´ãä½ ä¸å®å¸æå¨æ ¡å¯¹è¿ç¨ä¸­ï¼å³ä½¿æç¨æ·åçäºä¸ç¬æ°çäº¤æï¼ä¹ä¸å½±åä½ çæ ¡å¯¹ç»æãè¿æ¶åä½¿ç¨âå¯éå¤è¯»âéç¦»çº§å«å°±å¾æ¹ä¾¿ãäºå¡å¯å¨æ¶çè§å¾å¯ä»¥è®¤ä¸ºæ¯éæçï¼ä¸åå¶ä»äºå¡æ´æ°çå½±åã\n\n\n# 2. äºå¡éç¦»çå®ç°\n\nçè§£äºäºå¡çéç¦»çº§å«ï¼æä»¬åæ¥ççäºå¡éç¦»å·ä½æ¯æä¹å®ç°çãè¿éæä»¬å±å¼è¯´æâå¯éå¤è¯»âã\n\nå¨ mysql ä¸­ï¼å®éä¸æ¯æ¡è®°å½å¨æ´æ°çæ¶åé½ä¼åæ¶è®°å½ä¸æ¡åæ»æä½ãè®°å½ä¸çææ°å¼ï¼éè¿åæ»æä½ï¼é½å¯ä»¥å¾å°åä¸ä¸ªç¶æçå¼ã\n\nåè®¾ä¸ä¸ªå¼ä» 1 è¢«æé¡ºåºæ¹æäº 2ã3ã4ï¼å¨åæ»æ¥å¿éé¢å°±ä¼æç±»ä¼¼ä¸é¢çè®°å½ï¼\n\nå½åå¼æ¯ 4ï¼ä½æ¯å¨æ¥è¯¢è¿æ¡è®°å½çæ¶åï¼ä¸åæ¶å»å¯å¨çäºå¡ä¼æä¸åç read-viewãå¦å¾ä¸­çå°çï¼å¨è§å¾ aãbãc éé¢ï¼è¿ä¸ä¸ªè®°å½çå¼åå«æ¯ 1ã2ã4ï¼åä¸æ¡è®°å½å¨ç³»ç»ä¸­å¯ä»¥å­å¨å¤ä¸ªçæ¬ï¼å°±æ¯æ°æ®åºçå¤çæ¬å¹¶åæ§å¶ï¼mvccï¼ãå¯¹äº read-view aï¼è¦å¾å° 1ï¼å°±å¿é¡»å°å½åå¼ä¾æ¬¡æ§è¡å¾ä¸­ææçåæ»æä½å¾å°ã\n\nåæ¶ä½ ä¼åç°ï¼å³ä½¿ç°å¨æå¦å¤ä¸ä¸ªäºå¡æ­£å¨å° 4 æ¹æ 5ï¼è¿ä¸ªäºå¡è· read-view aãbãc å¯¹åºçäºå¡æ¯ä¸ä¼å²çªçã\n\nä½ ä¸å®ä¼é®ï¼åæ»æ¥å¿æ»ä¸è½ä¸ç´ä¿çå§ï¼ä»ä¹æ¶åå é¤å¢ï¼ç­æ¡æ¯ï¼å¨ä¸éè¦çæ¶åæå é¤ãä¹å°±æ¯è¯´ï¼ç³»ç»ä¼å¤æ­ï¼å½æ²¡æäºå¡åéè¦ç¨å°è¿äºåæ»æ¥å¿æ¶ï¼åæ»æ¥å¿ä¼è¢«å é¤ãä»ä¹æ¶åæä¸éè¦äºå¢ï¼å°±æ¯å½ç³»ç»éæ²¡ææ¯è¿ä¸ªåæ»æ¥å¿æ´æ©ç read-view çæ¶åã\n\nåºäºä¸é¢çè¯´æï¼æä»¬æ¥è®¨è®ºä¸ä¸ä¸ºä»ä¹å»ºè®®ä½ å°½éä¸è¦ä½¿ç¨é¿äºå¡:\n\n * é¿äºå¡æå³çç³»ç»éé¢ä¼å­å¨å¾èçäºå¡è§å¾ãç±äºè¿äºäºå¡éæ¶å¯è½è®¿é®æ°æ®åºéé¢çä»»ä½æ°æ®ï¼æä»¥è¿ä¸ªäºå¡æäº¤ä¹åï¼æ°æ®åºéé¢å®å¯è½ç¨å°çåæ»è®°å½é½å¿é¡»ä¿çï¼è¿å°±ä¼å¯¼è´å¤§éå ç¨å­å¨ç©ºé´ã\n * å¨ mysql 5.5 åä»¥åççæ¬ï¼åæ»æ¥å¿æ¯è·æ°æ®å­å¸ä¸èµ·æ¾å¨ ibdata æä»¶éçï¼å³ä½¿é¿äºå¡æç»æäº¤ï¼åæ»æ®µè¢«æ¸çï¼æä»¶ä¹ä¸ä¼åå°ãæè§è¿æ°æ®åªæ 20gbï¼èåæ»æ®µæ 200gb çåºãæç»åªå¥½ä¸ºäºæ¸çåæ»æ®µï¼éå»ºæ´ä¸ªåºã\n * é¤äºå¯¹åæ»æ®µçå½±åï¼é¿äºå¡è¿å ç¨éèµæºï¼ä¹å¯è½æå®æ´ä¸ªåºï¼è¿ä¸ªæä»¬ä¼å¨åé¢è®²éçæ¶åå±å¼ã\n\n\n# 3. äºå¡çå¯å¨æ¹å¼\n\nå¦åé¢æè¿°ï¼é¿äºå¡æè¿äºæ½å¨é£é©ï¼æå½ç¶æ¯å»ºè®®ä½ å°½éé¿åãå¶å®å¾å¤æ¶åä¸å¡å¼ååå­¦å¹¶ä¸æ¯ææä½¿ç¨é¿äºå¡ï¼éå¸¸æ¯ç±äºè¯¯ç¨æè´ãmysql çäºå¡å¯å¨æ¹å¼æä»¥ä¸å ç§ï¼\n\n 1. æ¾å¼å¯å¨äºå¡è¯­å¥ï¼ begin æ start transactionãéå¥çæäº¤è¯­å¥æ¯ commitï¼åæ»è¯­å¥æ¯ rollbackã\n 2. set autocommit=0ï¼è¿ä¸ªå½ä»¤ä¼å°è¿ä¸ªçº¿ç¨çèªå¨æäº¤å³æãæå³çå¦æä½ åªæ§è¡ä¸ä¸ª select è¯­å¥ï¼è¿ä¸ªäºå¡å°±å¯å¨äºï¼èä¸å¹¶ä¸ä¼èªå¨æäº¤ãè¿ä¸ªäºå¡æç»­å­å¨ç´å°ä½ ä¸»å¨æ§è¡ commit æ rollback è¯­å¥ï¼æèæ­å¼è¿æ¥ã\n\næäºå®¢æ·ç«¯è¿æ¥æ¡æ¶ä¼é»è®¤è¿æ¥æåååæ§è¡ä¸ä¸ª set autocommit=0 çå½ä»¤ãè¿å°±å¯¼è´æ¥ä¸æ¥çæ¥è¯¢é½å¨äºå¡ä¸­ï¼å¦ææ¯é¿è¿æ¥ï¼å°±å¯¼è´äºæå¤çé¿äºå¡ã\n\nå æ­¤ï¼æä¼å»ºè®®ä½ æ»æ¯ä½¿ç¨ set autocommit=1, éè¿æ¾å¼è¯­å¥çæ¹å¼æ¥å¯å¨äºå¡ã\n\nä½æ¯æçå¼ååå­¦ä¼çº ç»âå¤ä¸æ¬¡äº¤äºâçé®é¢ãå¯¹äºä¸ä¸ªéè¦é¢ç¹ä½¿ç¨äºå¡çä¸å¡ï¼ç¬¬äºç§æ¹å¼æ¯ä¸ªäºå¡å¨å¼å§æ¶é½ä¸éè¦ä¸»å¨æ§è¡ä¸æ¬¡ âbeginâï¼åå°äºè¯­å¥çäº¤äºæ¬¡æ°ãå¦æä½ ä¹æè¿ä¸ªé¡¾èï¼æå»ºè®®ä½ ä½¿ç¨ commit work and chain è¯­æ³ï¼å¨ autocommit ä¸º 1 çæåµä¸ï¼ç¨ begin æ¾å¼å¯å¨çäºå¡ï¼å¦ææ§è¡ commit åæäº¤äºå¡ãå¦ææ§è¡ commit work and chainï¼åæ¯æäº¤äºå¡å¹¶èªå¨å¯å¨ä¸ä¸ä¸ªäºå¡ï¼è¿æ ·ä¹çå»äºåæ¬¡æ§è¡ begin è¯­å¥çå¼éãåæ¶å¸¦æ¥çå¥½å¤æ¯ä»ç¨åºå¼åçè§åº¦æç¡®å°ç¥éæ¯ä¸ªè¯­å¥æ¯å¦å¤äºäºå¡ä¸­ã\n\nä½ å¯ä»¥å¨ information_schema åºç innodb_trx è¿ä¸ªè¡¨ä¸­æ¥è¯¢é¿äºå¡ï¼æ¯å¦ä¸é¢è¿ä¸ªè¯­å¥ï¼ç¨äºæ¥æ¾æç»­æ¶é´è¶è¿ 60s çäºå¡ï¼\n\nselect * from information_schema.innodb_trx where time_to_sec(timediff(now(),trx_started))>60\n\n\n1\n\n\n\n# summary\n\nä»¥ä¸ä»ç»äº mysql çäºå¡éç¦»çº§å«çç°è±¡åå®ç°ï¼æ ¹æ®å®ç°åçåæäºé¿äºå¡å­å¨çé£é©ï¼ä»¥åå¦ä½ç¨æ­£ç¡®çæ¹å¼é¿åé¿äºå¡ãå¸ææä¸¾çä¾å­è½å¤å¸®å©ä½ çè§£äºå¡ï¼å¹¶æ´å¥½å°ä½¿ç¨ mysql çäºå¡ç¹æ§ã\n\n\n# 4. äºå¡å°åºéç¦»è¿æ¯ä¸éç¦»ï¼\n\nåé¢è¯´äºï¼å¦ææ¯å¯éå¤è¯»éç¦»çº§å«ï¼äºå¡ t å¯å¨çæ¶åä¼åå»ºä¸ä¸ªè§å¾ read-viewï¼ä¹åäºå¡ t æ§è¡æé´ï¼å³ä½¿æå¶ä»äºå¡ä¿®æ¹äºæ°æ®ï¼äºå¡ t çå°çä»ç¶è·å¨å¯å¨æ¶çå°çä¸æ ·ãä½å¨å¨å±éãè¡¨çº§éåè¡éä¸­æå°ï¼ä¸ä¸ªäºå¡è¦æ´æ°ä¸è¡ï¼å¦æåå¥½æå¦å¤ä¸ä¸ªäºå¡æ¥æè¿ä¸è¡çè¡éï¼å®åä¸è½è¿ä¹ç¬èº«äºå¤äºï¼å®ä¼è¢«éä½ï¼è¿å¥ç­å¾ç¶æãé®é¢æ¯âï¼æ¢ç¶è¿å¥äºç­å¾ç¶æï¼é£ä¹ç­å°è¿ä¸ªäºå¡èªå·±è·åå°è¡éè¦æ´æ°æ°æ®çæ¶åï¼å®è¯»å°çå¼åæ¯ä»ä¹å¢ï¼\n\nä¸¾ä¸ä¸ªä¾å­ï¼ä¸é¢æ¯ä¸ä¸ªåªæä¸¤è¡çè¡¨çåå§åè¯­å¥ï¼\n\nmysql> create table `t` (\n  `id` int(11) not null,\n  `k` int(11) default null,\n  primary key (`id`)\n) engine=innodb;\n\ninsert into t(id, k) values(1,1),(2,2);\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\näºå¡ aãbãc çæµç¨å¦ä¸ï¼\n\nè¿éï¼æä»¬éè¦æ³¨æçæ¯äºå¡çå¯å¨æ¶æºãbegin/start transaction å½ä»¤å¹¶ä¸æ¯ä¸ä¸ªäºå¡çèµ·ç¹ï¼å¨æ§è¡å°å®ä»¬ä¹åçç¬¬ä¸ä¸ªæä½ innodb è¡¨çè¯­å¥ï¼äºå¡æçæ­£å¯å¨ãå¦æä½ æ³è¦é©¬ä¸å¯å¨ä¸ä¸ªäºå¡ï¼å¯ä»¥ä½¿ç¨ start transaction with consistent snapshot è¿ä¸ªå½ä»¤ã\n\n * ç¬¬ä¸ç§å¯å¨æ¹å¼ï¼ä¸è´æ§è§å¾æ¯å¨æ§è¡ç¬¬ä¸ä¸ªå¿«ç§è¯»è¯­å¥æ¶åå»ºçï¼\n * ç¬¬äºç§å¯å¨æ¹å¼ï¼ä¸è´æ§è§å¾æ¯å¨æ§è¡ start transaction with consistent snapshot æ¶åå»ºçã\n\nè¿éæ³¨æçæ¯ï¼ä¹åå¦ææ²¡æç¹å«è¯´æï¼é½é»è®¤ autocommit=1ï¼ä¹å°±æ¯å³ä½¿æ²¡ææå¨ start transaction å¼å¯äºå¡ï¼mysql é»è®¤ä¹ä¼å°ç¨æ·çæä½å½åäºå¡å³æ¶æäº¤ã\n\n> æ¬ä¾ä¸­çäºå¡ c æ²¡ææ¾å¼å°ä½¿ç¨ begin/commitï¼è¡¨ç¤ºè¿ä¸ª update è¯­å¥æ¬èº«å°±æ¯ä¸ä¸ªäºå¡ï¼è¯­å¥å®æçæ¶åä¼èªå¨æäº¤ã\n\nç°å¨ä½ ç¥é aãb äºå¡çå°çå¼æ¯ä»ä¹åãè¿ä¸å¤§èå°±æè¿ä¸ªçæè§£å¼ï¼æ´æ·±ä¸æ­¥å°çè§£ mvccã\n\n> æ¬ä¾ä¸­äºå¡ a æ¥å°ç k å¼æ¯ 1ï¼äºå¡ b æ¥å°ç k å¼æ¯ 3ãæç¹æå°±å¾ä¸ç ~\n\n\n# 4.1 snapshot å¨ mvcc éæ¯ææ ·å·¥ä½çï¼\n\nå¨å¯éå¤è¯»éç¦»çº§å«ä¸ï¼äºå¡å¨å¯å¨çæ¶åå°±âæäºä¸ªå¿«ç§âãæ³¨æï¼è¿ä¸ªå¿«ç§æ¯åºäºæ´åºçã\n\nä½ççè¦ç»å¨åºæå¿«ç§åä¸å¤ªå¯è¡ï¼ä¸ä¸ªæ°æ®åºæ 100gï¼æä¹å¯è½æ¯ä¸ªäºå¡é½åå¤å¶ 100g æ°æ®åºæ¥ãå®éä¸ï¼db å¹¶ä¸éè¦ççæ·è´è¿ 100g æ°æ®ãæä»¬çä¸ä¸è¿ä¸ª snapshot æ¯æä¹å®ç°çã\n\ninnodb éé¢æ¯ä¸ªäºå¡æä¸ä¸ªå¯ä¸çäºå¡ idï¼å«ä½ transaction idãå®æ¯å¨äºå¡å¼å§çæ¶åå innodb çäºå¡ç³»ç»ç³è¯·çï¼æ¯æç³è¯·é¡ºåºä¸¥æ ¼éå¢çãèæ¯è¡æ°æ®ä¹é½æ¯æå¤ä¸ªçæ¬çãæ¯æ¬¡äºå¡æ´æ°æ°æ®çæ¶åï¼é½ä¼çæä¸ä¸ªæ°çæ°æ®çæ¬ï¼å¹¶ä¸æ transaction id èµå¼ç»è¿ä¸ªæ°æ®çæ¬çäºå¡ idï¼è®°ä¸º row trx_idãåæ¶ï¼æ§çæ°æ®çæ¬è¦ä¿çï¼å¹¶ä¸å¨æ°çæ°æ®çæ¬ä¸­ï¼è½å¤æä¿¡æ¯å¯ä»¥ç´æ¥æ¿å°å®ã\n\n> ä¹å°±æ¯è¯´ï¼æ°æ®è¡¨ä¸­çä¸è¡è®°å½ï¼å¶å®å¯è½æå¤ä¸ªçæ¬ (row)ï¼æ¯ä¸ªçæ¬æèªå·±ç row trx_idã\n\nä¸å¾å°±æ¯ä¸ä¸ªè®°å½è¢«å¤ä¸ªäºå¡è¿ç»­æ´æ°åçç¶æï¼\n\nå¾ä¸­èçº¿æ¡éæ¯åä¸è¡æ°æ®ç 4 ä¸ªçæ¬ï¼å½åææ°çæ¬æ¯ v4ï¼k çå¼æ¯ 22ï¼å®æ¯è¢« transaction id ä¸º 25 çäºå¡æ´æ°çï¼å æ­¤å®ç row trx_id ä¹æ¯ 25ã\n\nå¶å®ï¼å¾ä¸­çä¸ä¸ªç»¿è²èçº¿ç®­å¤´å°±æ¯ undo logï¼åæ»æ¥å¿ï¼ï¼èä¸ æ§çæ¬ v1ãv2ãv3 å¹¶ä¸æ¯ç©çä¸çå®å­å¨çï¼èæ¯æ¯æ¬¡éè¦çæ¶åæ ¹æ®å½åçæ¬å undo log è®¡ç®åºæ¥çãæ¯å¦å¨éè¦ v2 çæ¶åï¼å°±æ¯éè¿ v4 ä¾æ¬¡æ§è¡ u3ãu2 ç®åºæ¥ã\n\næç½äºå¤çæ¬å row trx_id çæ¦å¿µåï¼æä»¬åæ¥æ³ä¸ä¸ï¼innodb æ¯æä¹å®ä¹é£ä¸ªâ100gâçå¿«ç§çâã\n\næç§å¯éå¤è¯»çå®ä¹ï¼ä¸ä¸ªäºå¡å¯å¨çæ¶åï¼è½å¤çå°ææå·²ç»æäº¤çäºå¡ç»æãä½æ¯ä¹åï¼è¿ä¸ªäºå¡æ§è¡æé´ï¼å¶ä»äºå¡çæ´æ°å¯¹å®ä¸å¯è§ãå æ­¤ï¼ä¸ä¸ªäºå¡åªéè¦å¨å¯å¨ååªæ¿è®¤é£äºä½äºèªå·±å¯å¨ä¹åçæ°æ®çæ¬åèªå·±æ´æ°çæ°æ®å°±å¥½äºã\n\nå¨å®ç°ä¸ï¼innodb ä¸ºæ¯ä¸ªäºå¡æé äºä¸ä¸ªè§å¾æ°ç»ï¼ç¨æ¥ä¿å­è¿ä¸ªäºå¡å¯å¨ç¬é´ï¼å½åæ­£å¨âæ´»è·âçææäºå¡ idãâæ´»è·âæçå°±æ¯ï¼å¯å¨äºä½è¿æ²¡æäº¤ãæ°ç»éé¢äºå¡ id çæå°å¼è®°ä¸ºä½æ°´ä½ï¼å½åç³»ç»éé¢å·²ç»åå»ºè¿çäºå¡ id çæå¤§å¼å  1 è®°ä¸ºé«æ°´ä½ãè¿ä¸ªè§å¾æ°ç»åé«æ°´ä½ï¼å°±ç»æäºå½åäºå¡çä¸è´æ§è§å¾ï¼read-viewï¼ãèæ°æ®çæ¬çå¯è§æ§è§åï¼å°±æ¯åºäºæ°æ®ç row trx_id åè¿ä¸ªä¸è´æ§è§å¾çå¯¹æ¯ç»æå¾å°çã\n\nmysql ä¸­æä¸¤ä¸ªâè§å¾âçæ¦å¿µï¼\n * ä¸ä¸ªæ¯ viewãå®æ¯ä¸ä¸ªç¨æ¥è¯¢è¯­å¥å®ä¹çèæè¡¨ï¼å¨è°ç¨çæ¶åæ§è¡æ¥è¯¢è¯­å¥å¹¶çæç»æãåå»ºè§å¾çè¯­æ³æ¯ create view â¦ï¼èå®çæ¥è¯¢æ¹æ³ä¸è¡¨ä¸æ ·ã\n * å¦ä¸ä¸ªæ¯ innodb å¨å®ç° mvcc æ¶ç¨å°çä¸è´æ§è¯»è§å¾(read-view)ï¼å³ consistent read viewï¼ç¨äºæ¯æ rcï¼read committedï¼è¯»æäº¤ï¼å rrï¼repeatable readï¼å¯éå¤è¯»ï¼éç¦»çº§å«çå®ç°ã\n\nè¿ä¸ªè§å¾æ°ç»æææç row trx_id åæäºå ç§ä¸åçæåµï¼\n\nè¿æ ·ï¼å¯¹äºå½åäºå¡çå¯å¨ç¬é´æ¥è¯´ï¼ä¸ä¸ªæ°æ®çæ¬ç row trx_idï¼æä»¥ä¸å ç§å¯è½ï¼\n\n 1. å¦æè½å¨ç»¿è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²æäº¤çäºå¡æèæ¯å½åäºå¡èªå·±çæçï¼è¿ä¸ªæ°æ®æ¯å¯è§çï¼\n 2. å¦æè½å¨çº¢è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±å°æ¥å¯å¨çäºå¡çæçï¼æ¯è¯å®ä¸å¯è§çï¼\n 3. å¦æè½å¨é»è²é¨åï¼é£å°±åæ¬ä¸¤ç§æåµï¼\n    * è¥ row trx_id å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±è¿æ²¡æäº¤çäºå¡çæçï¼ä¸å¯è§\n    * è¥ row trx_id ä¸å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²ç»æäº¤äºçäºå¡çæçï¼å¯è§\n\n> ææ··ï¼è½å¨é»è²åºåæå³çæ¯äºå¡ id å¨ä½æ°´ä½åé«æ°´ä½è¿ä¸ªèå´éé¢ï¼èçæ­£æ¯æ¯å¦å¯è§ï¼çé»è²åºåæ¯å¦æè¿ä¸ªå¼ãå¦æé»è²åºåæ²¡æè¿ä¸ªäºå¡ idï¼åå¯è§ï¼å¦ææï¼åä¸å¯è§ãå¨è¿ä¸ªèå´éé¢å¹¶ä¸æå³è¿è¿ä¸ªèå´éæè¿ä¸ªå¼ï¼æ¯å¦ [1,2,3,5]ï¼4 å¨è¿ä¸ªæ°ç» 1-5 çèå´éï¼å´æ²¡å¨è¿ä¸ªæ°ç»éé¢ã\n\næ¯å¦ï¼å¯¹äºå¾ 2 ä¸­çæ°æ®æ¥è¯´ï¼å¦ææä¸ä¸ªäºå¡ï¼å®çä½æ°´ä½æ¯ 18ï¼é£ä¹å½å®è®¿é®è¿ä¸è¡æ°æ®æ¶ï¼å°±ä¼ä» v4 éè¿ u3 è®¡ç®åº v3ï¼æä»¥å¨å®çæ¥ï¼è¿ä¸è¡çå¼æ¯ 11ã\n\næäºè¿ä¸ªå¯è§æ§è§åï¼ç³»ç»éé¢éååççæ´æ°å°±ä¸è¿ä¸ªäºå¡çå°çåå®¹æ å³äºï¼æä»¥è¿ä¸ªäºå¡ç snapshot å°±æ¯âéæâçäºãæä»¥ä½ ç°å¨ç¥éäºï¼innodb å©ç¨äºâæææ°æ®é½æå¤ä¸ªçæ¬âçè¿ä¸ªç¹æ§ï¼å®ç°äºâç§çº§åå»ºå¿«ç§âçè½åã\n\nç°å¨åå©äºè¿ä¸ªç¥è¯ï¼æä»¬å¯¹ä¹åçä¾å­è¿è¡åæï¼ççä¸ºä»ä¹äºå¡ a è¿åçç»ææ¯ k=1ãæä»¬ä¸å¦¨åè®¾ï¼\n\n 1. äºå¡ a å¼å§åï¼ç³»ç»éé¢åªæä¸ä¸ªæ´»è·äºå¡ id æ¯ 99ï¼\n 2. äºå¡ aãbãc ççæ¬å·åå«æ¯ 100ã101ã102ï¼ä¸å½åç³»ç»éåªæè¿åä¸ªäºå¡ï¼\n 3. ä¸ä¸ªäºå¡å¼å§åï¼(1,1ï¼è¿ä¸è¡æ°æ®ç row trx_id æ¯ 90ã\n\nè¿æ ·ï¼äºå¡ a çè§å¾æ°ç»å°±æ¯[99,100], äºå¡ b çè§å¾æ°ç»æ¯[99,100,101], äºå¡ c çè§å¾æ°ç»æ¯[99,100,101,102]ãä¸ºäºç®ååæï¼æåæå¶ä»å¹²æ°è¯­å¥å»æï¼åªç»åºè·äºå¡ a æ¥è¯¢é»è¾æå³çæä½ï¼\n\nä»å¾ä¸­å¯ä»¥çå°ï¼ç¬¬ä¸ä¸ªæææ´æ°æ¯äºå¡ cï¼ææ°æ®ä» (1,1) æ¹æäº (1,2)ãè¿æ¶åï¼è¿ä¸ªæ°æ®çææ°çæ¬ç row trx_id æ¯ 102ï¼è 90 è¿ä¸ªçæ¬å·²ç»æä¸ºäºåå²çæ¬ãç¬¬äºä¸ªæææ´æ°æ¯äºå¡ bï¼ææ°æ®ä» (1,2) æ¹æäº (1,3)ãè¿æ¶åï¼è¿ä¸ªæ°æ®çææ°çæ¬ï¼å³ row trx_idï¼æ¯ 101ï¼è 102 åæä¸ºäºåå²çæ¬ãä½ å¯è½æ³¨æå°äºï¼å¨äºå¡ a æ¥è¯¢çæ¶åï¼å¶å®äºå¡ b è¿æ²¡ææäº¤ï¼ä½æ¯å®çæç (1,3) è¿ä¸ªçæ¬å·²ç»åæå½åçæ¬äºãä½è¿ä¸ªçæ¬å¯¹äºå¡ a å¿é¡»æ¯ä¸å¯è§çï¼å¦åå°±åæèè¯»äºãå¥½ï¼ç°å¨äºå¡ a è¦æ¥è¯»æ°æ®äºï¼å®çè§å¾æ°ç»æ¯[99,100]ãå½ç¶äºï¼è¯»æ°æ®é½æ¯ä»å½åçæ¬è¯»èµ·çã\n\næä»¥ï¼äºå¡ a æ¥è¯¢è¯­å¥çè¯»æ°æ®æµç¨æ¯è¿æ ·çï¼\n\n * æ¾å° (1,3) çæ¶åï¼å¤æ­åº row trx_id=101ï¼æ¯é«æ°´ä½å¤§ï¼å¤äºçº¢è²åºåï¼ä¸å¯è§ï¼\n * æ¥çï¼æ¾å°ä¸ä¸ä¸ªåå²çæ¬ï¼ä¸ç row trx_id=102ï¼æ¯é«æ°´ä½å¤§ï¼å¤äºçº¢è²åºåï¼ä¸å¯è§ï¼\n * åå¾åæ¾ï¼ç»äºæ¾å°äºï¼1,1)ï¼å®ç row trx_id=90ï¼æ¯ä½æ°´ä½å°ï¼å¤äºç»¿è²åºåï¼å¯è§ã\n\nè¿æ ·æ§è¡ä¸æ¥ï¼è½ç¶æé´è¿ä¸è¡æ°æ®è¢«ä¿®æ¹è¿ï¼ä½æ¯äºå¡ a ä¸è®ºå¨ä»ä¹æ¶åæ¥è¯¢ï¼çå°è¿è¡æ°æ®çç»æé½æ¯ä¸è´çï¼æä»¥æä»¬ç§°ä¹ä¸ºä¸è´æ§è¯»ã\n\nè¿ä¸ªå¤æ­è§åæ¯ä»ä»£ç é»è¾ç´æ¥è½¬è¯è¿æ¥çï¼ä½æ¯æ­£å¦ä½ æè§ï¼ç¨äºäººèåæå¯è§æ§å¾éº»ç¦ãæä»¥ï¼ç¨æ´ç´è§çè¯è¯´ï¼ä¸ä¸ªæ°æ®çæ¬ï¼å¯¹äºä¸ä¸ªäºå¡è§å¾æ¥è¯´ï¼é¤äºèªå·±çæ´æ°æ»æ¯å¯è§ä»¥å¤ï¼æä¸ç§æåµï¼\n\n * çæ¬æªæäº¤ï¼ä¸å¯è§ï¼\n * çæ¬å·²æäº¤ï¼ä½æ¯æ¯å¨è§å¾åå»ºåæäº¤çï¼ä¸å¯è§ï¼\n * çæ¬å·²æäº¤ï¼èä¸æ¯å¨è§å¾åå»ºåæäº¤çï¼å¯è§ã\n\nç°å¨ï¼æä»¬ç¨è¿ä¸ªè§åæ¥å¤æ­ç¤ºä¾ä¸­çæ¥è¯¢ç»æï¼äºå¡ a çæ¥è¯¢è¯­å¥çè§å¾æ°ç»æ¯å¨äºå¡ a å¯å¨çæ¶åçæçï¼è¿æ¶åï¼\n\n * (1,3) è¿æ²¡æäº¤ï¼å±äºæåµ 1ï¼ä¸å¯è§ï¼\n * (1,2) è½ç¶æäº¤äºï¼ä½æ¯æ¯å¨è§å¾æ°ç»åå»ºä¹åæäº¤çï¼å±äºæåµ 2ï¼ä¸å¯è§ï¼\n * (1,1) æ¯å¨è§å¾æ°ç»åå»ºä¹åæäº¤çï¼å¯è§ã\n\nä½ çï¼å»ææ°å­å¯¹æ¯åï¼åªç¨æ¶é´ååé¡ºåºæ¥å¤æ­ï¼åæèµ·æ¥æ¯ä¸æ¯è½»æ¾å¤äºãæä»¥ï¼åé¢æä»¬å°±é½ç¨è¿ä¸ªè§åæ¥åæã\n\n\n# 4.2 æ´æ°é»è¾\n\næ´ç»å¿çè¯ï¼å¯ä»¥æåºè¿æ ·ä¸ä¸ªçé®ï¼äºå¡ b ç update è¯­å¥ï¼å¦ææç§ä¸è´æ§è¯»ï¼å¥½åç»æä¸å¯¹å¦ï¼ä½ çå¾ 5 ä¸­ï¼äºå¡ b çè§å¾æ°ç»æ¯åçæçï¼ä¹åäºå¡ c ææäº¤ï¼ä¸æ¯åºè¯¥çä¸è§ (1,2) åï¼æä¹è½ç®åº (1,3) æ¥ï¼\n\næ¯çï¼å¦æäºå¡ b å¨æ´æ°ä¹åæ¥è¯¢ä¸æ¬¡æ°æ®ï¼è¿ä¸ªæ¥è¯¢è¿åç k çå¼ç¡®å®æ¯ 1ãä½æ¯ï¼å½å®è¦å»æ´æ°æ°æ®çæ¶åï¼å°±ä¸è½åå¨åå²çæ¬ä¸æ´æ°äºï¼å¦åäºå¡ c çæ´æ°å°±ä¸¢å¤±äºãå æ­¤ï¼äºå¡ b æ­¤æ¶ç set k=k+1 æ¯å¨ï¼1,2ï¼çåºç¡ä¸è¿è¡çæä½ã\n\næä»¥ï¼è¿éå°±ç¨å°äºè¿æ ·ä¸æ¡è§åï¼æ´æ°æ°æ®é½æ¯åè¯»ååçï¼èè¿ä¸ªè¯»ï¼åªè½è¯»å½åçå¼ï¼ç§°ä¸ºâå½åè¯»âï¼current readï¼ã\n\nå æ­¤ï¼å¨æ´æ°çæ¶åï¼å½åè¯»æ¿å°çæ°æ®æ¯ (1,2)ï¼æ´æ°åçæäºæ°çæ¬çæ°æ® (1,3)ï¼è¿ä¸ªæ°çæ¬ç row trx_id æ¯ 101ãæä»¥ï¼å¨æ§è¡äºå¡ b æ¥è¯¢è¯­å¥çæ¶åï¼ä¸çèªå·±ççæ¬å·æ¯ 101ï¼ææ°æ°æ®ççæ¬å·ä¹æ¯ 101ï¼æ¯èªå·±çæ´æ°ï¼å¯ä»¥ç´æ¥ä½¿ç¨ï¼æä»¥æ¥è¯¢å¾å°ç k çå¼æ¯ 3ã\n\nè¿éæä»¬æå°äºä¸ä¸ªæ¦å¿µï¼å«ä½å½åè¯»ãå¶å®ï¼é¤äº update è¯­å¥å¤ï¼select è¯­å¥å¦æå éï¼ä¹æ¯å½åè¯»ãæä»¥ï¼å¦ææäºå¡ a çæ¥è¯¢è¯­å¥ select * from t where id=1 ä¿®æ¹ä¸ä¸ï¼å ä¸ lock in share mode æ for updateï¼ä¹é½å¯ä»¥è¯»å°çæ¬å·æ¯ 101 çæ°æ®ï¼è¿åç k çå¼æ¯ 3ãä¸é¢è¿ä¸¤ä¸ª select è¯­å¥ï¼å°±æ¯åå«å äºè¯»éï¼s éï¼å±äº«éï¼ååéï¼x éï¼æä»éï¼ï¼\n\nmysql> select k from t where id=1 lock in share mode;\nmysql> select k from t where id=1 for update;\n\n\n1\n2\n\n\nåå¾åä¸æ­¥ï¼åè®¾äºå¡ c ä¸æ¯é©¬ä¸æäº¤çï¼èæ¯åæäºä¸é¢çäºå¡ câï¼ä¼æä¹æ ·å¢ï¼\n\näºå¡ câçä¸åæ¯ï¼æ´æ°åå¹¶æ²¡æé©¬ä¸æäº¤ï¼å¨å®æäº¤åï¼äºå¡ b çæ´æ°è¯­å¥ååèµ·äºãåé¢è¯´è¿äºï¼è½ç¶äºå¡ câè¿æ²¡æäº¤ï¼ä½æ¯ (1,2) è¿ä¸ªçæ¬ä¹å·²ç»çæäºï¼å¹¶ä¸æ¯å½åçææ°çæ¬ãé£ä¹ï¼äºå¡ b çæ´æ°è¯­å¥ä¼æä¹å¤çå¢ï¼\n\nè¿æ¶åï¼æä»¬å¨ä¸ä¸ç¯æç« ä¸­æå°çâä¸¤é¶æ®µéåè®®âå°±è¦ä¸åºäºãäºå¡ câ æ²¡æäº¤ï¼ä¹å°±æ¯è¯´ (1,2) è¿ä¸ªçæ¬ä¸çåéè¿æ²¡éæ¾ãèäºå¡ b æ¯å½åè¯»ï¼å¿é¡»è¦è¯»ææ°çæ¬ï¼èä¸å¿é¡»å éï¼å æ­¤å°±è¢«éä½äºï¼å¿é¡»ç­å°äºå¡ câ éæ¾è¿ä¸ªéï¼æè½ç»§ç»­å®çå½åè¯»ã\n\nå°è¿éï¼æä»¬æä¸è´æ§è¯»ãå½åè¯»åè¡éå°±ä¸²èµ·æ¥äºã\n\nç°å¨ï¼æä»¬ååå°æç« å¼å¤´çé®é¢ï¼äºå¡çå¯éå¤è¯»çè½åæ¯æä¹å®ç°çï¼âå¯éå¤è¯»çæ ¸å¿å°±æ¯ä¸è´æ§è¯»ï¼consistent readï¼ï¼èäºå¡æ´æ°æ°æ®çæ¶åï¼åªè½ç¨å½åè¯»ãå¦æå½åçè®°å½çè¡éè¢«å¶ä»äºå¡å ç¨çè¯ï¼å°±éè¦è¿å¥éç­å¾ã\n\nèè¯»æäº¤çé»è¾åå¯éå¤è¯»çé»è¾ç±»ä¼¼ï¼å®ä»¬æä¸»è¦çåºå«æ¯ï¼\n\n * å¨å¯éå¤è¯»éç¦»çº§å«ä¸ï¼åªéè¦å¨äºå¡å¼å§çæ¶ååå»ºä¸è´æ§è§å¾ï¼ä¹åäºå¡éçå¶ä»æ¥è¯¢é½å±ç¨è¿ä¸ªä¸è´æ§è§å¾ï¼\n * å¨è¯»æäº¤éç¦»çº§å«ä¸ï¼æ¯ä¸ä¸ªè¯­å¥æ§è¡åé½ä¼éæ°ç®åºä¸ä¸ªæ°çè§å¾ã\n\né£ä¹ï¼æä»¬åçä¸ä¸ï¼å¨è¯»æäº¤éç¦»çº§å«ä¸ï¼äºå¡ a åäºå¡ b çæ¥è¯¢è¯­å¥æ¥å°ç kï¼åå«åºè¯¥æ¯å¤å°å¢ï¼\n\n> è¿ééè¦è¯´æä¸ä¸ï¼âstart transaction with consistent snapshot; âçæææ¯ä»è¿ä¸ªè¯­å¥å¼å§ï¼åå»ºä¸ä¸ªæç»­æ´ä¸ªäºå¡çä¸è´æ§å¿«ç§ãæä»¥ï¼å¨è¯»æäº¤éç¦»çº§å«ä¸ï¼è¿ä¸ªç¨æ³å°±æ²¡æä¹äºï¼ç­æäºæ®éç start transactionã\n\nä¸é¢æ¯è¯»æäº¤æ¶çç¶æå¾ï¼å¯ä»¥çå°è¿ä¸¤ä¸ªæ¥è¯¢è¯­å¥çåå»ºè§å¾æ°ç»çæ¶æºåçäºååï¼å°±æ¯å¾ä¸­ç read view æ¡ãï¼æ³¨æï¼è¿éï¼æä»¬ç¨çè¿æ¯äºå¡ c çé»è¾ç´æ¥æäº¤ï¼èä¸æ¯äºå¡ câï¼\n\nè¿æ¶ï¼äºå¡ a çæ¥è¯¢è¯­å¥çè§å¾æ°ç»æ¯å¨æ§è¡è¿ä¸ªè¯­å¥çæ¶ååå»ºçï¼æ¶åºä¸ (1,2)ã(1,3) ççææ¶é´é½å¨åå»ºè¿ä¸ªè§å¾æ°ç»çæ¶å»ä¹åãä½æ¯ï¼å¨è¿ä¸ªæ¶å»ï¼\n\n * (1,3) è¿æ²¡æäº¤ï¼å±äºæåµ 1ï¼ä¸å¯è§ï¼\n * (1,2) æäº¤äºï¼å±äºæåµ 3ï¼å¯è§ã\n\næä»¥ï¼è¿æ¶åäºå¡ a æ¥è¯¢è¯­å¥è¿åçæ¯ k=2ãæ¾ç¶å°ï¼äºå¡ b æ¥è¯¢ç»æ k=3ã\n\n\n# 4.3 summary\n\ninnodb çè¡æ°æ®æå¤ä¸ªçæ¬ï¼æ¯ä¸ªæ°æ®çæ¬æèªå·±ç row trx_idï¼æ¯ä¸ªäºå¡æèè¯­å¥æèªå·±çä¸è´æ§è§å¾ãæ®éæ¥è¯¢è¯­å¥æ¯ä¸è´æ§è¯»ï¼ä¸è´æ§è¯»ä¼æ ¹æ® row trx_id åä¸è´æ§è§å¾ç¡®å®æ°æ®çæ¬çå¯è§æ§ã\n\n * å¯¹äºå¯éå¤è¯»ï¼æ¥è¯¢åªæ¿è®¤å¨äºå¡å¯å¨åå°±å·²ç»æäº¤å®æçæ°æ®ï¼\n * å¯¹äºè¯»æäº¤ï¼æ¥è¯¢åªæ¿è®¤å¨è¯­å¥å¯å¨åå°±å·²ç»æäº¤å®æçæ°æ®ï¼\n\nèå½åè¯»ï¼æ»æ¯è¯»åå·²ç»æäº¤å®æçææ°çæ¬ã\n\nä½ ä¹å¯ä»¥æ³ä¸ä¸ï¼ä¸ºä»ä¹è¡¨ç»æä¸æ¯æâå¯éå¤è¯»âï¼è¿æ¯å ä¸ºè¡¨ç»ææ²¡æå¯¹åºçè¡æ°æ®ï¼ä¹æ²¡æ row trx_idï¼å æ­¤åªè½éµå¾ªå½åè¯»çé»è¾ã\n\nå½ç¶ï¼mysql 8.0 å·²ç»å¯ä»¥æè¡¨ç»ææ¾å¨ innodb å­å¸éäºï¼ä¹è®¸ä»¥åä¼æ¯æè¡¨ç»æçå¯éå¤è¯»ã\n\n\n# qa\n\nqï¼ä½ ç°å¨ç¥éäºç³»ç»éé¢åºè¯¥é¿åé¿äºå¡ï¼å¦æä½ æ¯ä¸å¡å¼åè´è´£äººåæ¶ä¹æ¯æ°æ®åºè´è´£äººï¼ä½ ä¼æä»ä¹æ¹æ¡æ¥é¿ååºç°æèå¤çè¿ç§æåµå¢ï¼\n\naï¼è¿ä¸ªé®é¢ï¼æä»¬å¯ä»¥ä»åºç¨å¼åç«¯åæ°æ®åºç«¯æ¥çï¼\n\n * ä»åºç¨å¼åç«¯æ¥çï¼\n   1. ç¡®è®¤æ¯å¦ä½¿ç¨äº set autocommit=0ãè¿ä¸ªç¡®è®¤å·¥ä½å¯ä»¥å¨æµè¯ç¯å¢ä¸­å¼å±ï¼æ mysql ç general_log å¼èµ·æ¥ï¼ç¶åéä¾¿è·ä¸ä¸ªä¸å¡é»è¾ï¼éè¿ general_log çæ¥å¿æ¥ç¡®è®¤ãä¸è¬æ¡æ¶å¦æä¼è®¾ç½®è¿ä¸ªå¼ï¼ä¹å°±ä¼æä¾åæ°æ¥æ§å¶è¡ä¸ºï¼ä½ çç®æ å°±æ¯æå®æ¹æ 1ã\n   2. ç¡®è®¤æ¯å¦æä¸å¿è¦çåªè¯»äºå¡ãæäºæ¡æ¶ä¼ä¹ æ¯ä¸ç®¡ä»ä¹è¯­å¥åç¨ begin/commit æ¡èµ·æ¥ãæè§è¿æäºæ¯ä¸å¡å¹¶æ²¡æè¿ä¸ªéè¦ï¼ä½æ¯ä¹æå¥½å ä¸ª select è¯­å¥æ¾å°äºäºå¡ä¸­ãè¿ç§åªè¯»äºå¡å¯ä»¥å»æã\n   3. ä¸å¡è¿æ¥æ°æ®åºçæ¶åï¼æ ¹æ®ä¸å¡æ¬èº«çé¢ä¼°ï¼éè¿ set max_execution_time å½ä»¤ï¼æ¥æ§å¶æ¯ä¸ªè¯­å¥æ§è¡çæé¿æ¶é´ï¼é¿ååä¸ªè¯­å¥æå¤æ§è¡å¤ªé¿æ¶é´ã\n * ä»æ°æ®åºç«¯æ¥çï¼\n   1. çæ§ information_schema.innodb_trx è¡¨ï¼è®¾ç½®é¿äºå¡éå¼ï¼è¶è¿å°±æ¥è­¦ / æè killï¼\n   2. percona ç pt-kill è¿ä¸ªå·¥å·ä¸éï¼æ¨èä½¿ç¨ï¼\n   3. å¨ä¸å¡åè½æµè¯é¶æ®µè¦æ±è¾åºææç general_logï¼åææ¥å¿è¡ä¸ºæååç°é®é¢ï¼\n   4. å¦æä½¿ç¨çæ¯ mysql 5.6 æèæ´æ°çæ¬ï¼æ innodb_undo_tablespaces è®¾ç½®æ 2ï¼ææ´å¤§çå¼ï¼ãå¦æççåºç°å¤§äºå¡å¯¼è´åæ»æ®µè¿å¤§ï¼è¿æ ·è®¾ç½®åæ¸çèµ·æ¥æ´æ¹ä¾¿ã",charsets:{cjk:!0},lastUpdated:"2023/05/23, 03:09:13",lastUpdatedTimestamp:1684811353e3},{title:"æ·±å¥æµåºç´¢å¼",frontmatter:{title:"æ·±å¥æµåºç´¢å¼",date:"2023-05-18T16:38:41.000Z",permalink:"/pages/1ea58b/",categories:["ä¸­é´ä»¶","MySQL","ä¸æ ï¼MySQL å®æ 45 è®²"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/06.MySQL/05.%E4%B8%93%E6%A0%8F%EF%BC%9AMySQL%20%E5%AE%9E%E6%88%98%2045%20%E8%AE%B2/04.%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E7%B4%A2%E5%BC%95.html",relativePath:"ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/04.æ·±å¥æµåºç´¢å¼.md",key:"v-7482ba20",path:"/pages/1ea58b/",headers:[{level:2,title:"1. ç´¢å¼çå¸¸è§æ¨¡å",slug:"_1-ç´¢å¼çå¸¸è§æ¨¡å",normalizedTitle:"1. ç´¢å¼çå¸¸è§æ¨¡å",charIndex:139},{level:3,title:"1.1 åå¸è¡¨çç´¢å¼æ¨¡å",slug:"_1-1-åå¸è¡¨çç´¢å¼æ¨¡å",normalizedTitle:"1.1 åå¸è¡¨çç´¢å¼æ¨¡å",charIndex:261},{level:3,title:"1.2 æåºæ°ç»çç´¢å¼æ¨¡å",slug:"_1-2-æåºæ°ç»çç´¢å¼æ¨¡å",normalizedTitle:"1.2 æåºæ°ç»çç´¢å¼æ¨¡å",charIndex:470},{level:3,title:"1.3 æç´¢æ çç´¢å¼æ¨¡å",slug:"_1-3-æç´¢æ çç´¢å¼æ¨¡å",normalizedTitle:"1.3 æç´¢æ çç´¢å¼æ¨¡å",charIndex:732},{level:2,title:"2. InnoDB çç´¢å¼æ¨¡å",slug:"_2-innodb-çç´¢å¼æ¨¡å",normalizedTitle:"2. innodb çç´¢å¼æ¨¡å",charIndex:1628},{level:2,title:"3.ç´¢å¼ç»´æ¤",slug:"_3-ç´¢å¼ç»´æ¤",normalizedTitle:"3.ç´¢å¼ç»´æ¤",charIndex:2530},{level:2,title:"4. å¸¦ç´¢å¼çæ¥è¯¢ä¼å",slug:"_4-å¸¦ç´¢å¼çæ¥è¯¢ä¼å",normalizedTitle:"4. å¸¦ç´¢å¼çæ¥è¯¢ä¼å",charIndex:3748},{level:3,title:"4.1 è¦çç´¢å¼",slug:"_4-1-è¦çç´¢å¼",normalizedTitle:"4.1 è¦çç´¢å¼",charIndex:4514},{level:3,title:"4.2 æå·¦åç¼åå",slug:"_4-2-æå·¦åç¼åå",normalizedTitle:"4.2 æå·¦åç¼åå",charIndex:5503},{level:3,title:"4.3 ç´¢å¼ä¸æ¨",slug:"_4-3-ç´¢å¼ä¸æ¨",normalizedTitle:"4.3 ç´¢å¼ä¸æ¨",charIndex:6531},{level:2,title:"Summary",slug:"summary",normalizedTitle:"summary",charIndex:7346},{level:2,title:"QA",slug:"qa",normalizedTitle:"qa",charIndex:7432}],headersStr:"1. ç´¢å¼çå¸¸è§æ¨¡å 1.1 åå¸è¡¨çç´¢å¼æ¨¡å 1.2 æåºæ°ç»çç´¢å¼æ¨¡å 1.3 æç´¢æ çç´¢å¼æ¨¡å 2. InnoDB çç´¢å¼æ¨¡å 3.ç´¢å¼ç»´æ¤ 4. å¸¦ç´¢å¼çæ¥è¯¢ä¼å 4.1 è¦çç´¢å¼ 4.2 æå·¦åç¼åå 4.3 ç´¢å¼ä¸æ¨ Summary QA",content:"> åèï¼\n> \n>  * 04 | æ·±å¥æµåºç´¢å¼ï¼ä¸ï¼| æå®¢æ¶é´\n>  * 05 | æ·±å¥æµåºç´¢å¼ï¼ä¸ï¼| æå®¢æ¶é´\n\nç´¢å¼æ¯æ°æ®åºç³»ç»éé¢æéè¦çæ¦å¿µä¹ä¸ãä¸å¥è¯ç®åæ¥è¯´ï¼ç´¢å¼çåºç°å¶å®å°±æ¯ä¸ºäºæé«æ°æ®æ¥è¯¢çæçï¼å°±åä¹¦çç®å½ä¸æ ·ï¼è½å¤å¿«éå®ä½å¶ä¸­çæä¸ªç¥è¯ç¹ã\n\n\n# 1. ç´¢å¼çå¸¸è§æ¨¡å\n\nç´¢å¼çåºç°æ¯ä¸ºäºæé«æ¥è¯¢æçï¼ä½æ¯å®ç°ç´¢å¼çæ¹å¼å´æå¾å¤ç§ï¼æä»¥è¿éä¹å°±å¼å¥äºç´¢å¼æ¨¡åçæ¦å¿µãå¯ä»¥ç¨äºæé«è¯»åæççæ°æ®ç»æå¾å¤ï¼è¿éæåä»ç»ä¸ç§å¸¸è§ãä¹æ¯è¾ç®åçæ°æ®ç»æï¼å®ä»¬åå«æ¯åå¸è¡¨ãæåºæ°ç»åæç´¢æ ã\n\n\n# 1.1 åå¸è¡¨çç´¢å¼æ¨¡å\n\nåå¸è¡¨æ¯ä¸ç§ä»¥é® - å¼ï¼key-valueï¼å­å¨æ°æ®çç»æï¼æä»¬åªè¦è¾å¥å¾æ¥æ¾çé®å³ keyï¼å°±å¯ä»¥æ¾å°å¶å¯¹åºçå¼å³ Valueãåå¸å²çªæ¶æåºä¸ä¸ªé¾è¡¨å°±å¥½äºã\n\nåè®¾ï¼ä½ ç°å¨ç»´æ¤çä¸ä¸ªèº«ä»½è¯ä¿¡æ¯åå§åçè¡¨ï¼éè¦æ ¹æ®èº«ä»½è¯å·æ¥æ¾å¯¹åºçåå­ï¼è¿æ¶å¯¹åºçåå¸ç´¢å¼çç¤ºæå¾å¦ä¸æç¤ºï¼\n\nä½åå¸è¡¨çç¼ºç¹æ¯å®ä¸æ¯æåºçï¼æä»¥åå¸ç´¢å¼ååºé´æ¥è¯¢çéåº¦å¾æ¢ï¼è¿ç§ç»æéç¨äºåªæç­å¼æ¥è¯¢çåºæ¯ã\n\n\n# 1.2 æåºæ°ç»çç´¢å¼æ¨¡å\n\næåºæ°ç»å¨ç­å¼æ¥è¯¢åèå´æ¥è¯¢åºæ¯ä¸­çæ§è½å°±é½éå¸¸ä¼ç§ï¼æ¯å¦ä¸é¢é£ä¸ªæ ¹æ®èº«ä»½è¯å·æ¥åå­çä¾å­ï¼å¦æç¨æåºæ°ç»æ¥å®ç°çè¯ï¼å¦ä¸å¾ï¼\n\nè¥è¦æ¥è¯¢æ ID å¯¹åºçåå­ï¼ç¨äºåæ³å°±å¯å¿«éå¾å°ï¼æ¶é´å¤æåº¦æ¯ O(log(N))ã\n\nå¦æä»ä»çæ¥è¯¢æçï¼æåºæ°ç»å°±æ¯æå¥½çæ°æ®ç»æäºãä½æ¯ï¼å¨éè¦æ´æ°æ°æ®çæ¶åå°±éº»ç¦äºï¼ä½ å¾ä¸­é´æå¥ä¸ä¸ªè®°å½å°±å¿é¡»å¾æªå¨åé¢ææçè®°å½ï¼ææ¬å¤ªé«ã\n\næä»¥ï¼æåºæ°ç»ç´¢å¼åªéç¨äºéæå­å¨å¼æï¼æ¯å¦ä½ è¦ä¿å­çæ¯ 2017 å¹´æä¸ªåå¸çææäººå£ä¿¡æ¯ï¼è¿ç±»ä¸ä¼åä¿®æ¹çæ°æ®ã\n\n\n# 1.3 æç´¢æ çç´¢å¼æ¨¡å\n\näºåæç´¢æ ä¹æ¯ç»å¸æ°æ®ç»æäºï¼ä½ä¸ºäºç»´æ $O(\\log(N))$ çæ¥è¯¢å¤æåº¦ï¼ä½ éè¦ä¸ä¸ªå¹³è¡¡äºåæ ãä¸ºäºä¿æå¹³è¡¡ï¼æ´æ°çæ¶é´å¤æåº¦ä¹æ¯ O(log(N))ã\n\n> äºåæç´¢æ çç¹ç¹ï¼æ¯ä¸ªèç¹çå·¦å¿å­å°äºç¶èç¹ï¼ç¶èç¹åå°äºå³å¿å­ã\n\næ å¯ä»¥æäºåï¼ä¹å¯ä»¥æå¤åãäºåæ æ¯æç´¢æçæé«çï¼ä½æ¯å®éä¸å¤§å¤æ°çæ°æ®åºå­å¨å´å¹¶ä¸ä½¿ç¨äºåæ ãå¶åå æ¯ï¼ç´¢å¼ä¸æ­¢å­å¨åå­ä¸­ï¼è¿è¦åå°ç£çä¸ã\n\n> ä½ å¯ä»¥æ³è±¡ä¸ä¸ä¸æ£µ 100 ä¸èç¹çå¹³è¡¡äºåæ ï¼æ é« 20ãä¸æ¬¡æ¥è¯¢å¯è½éè¦è®¿é® 20 ä¸ªæ°æ®åãå¨æºæ¢°ç¡¬çæ¶ä»£ï¼ä»ç£çéæºè¯»ä¸ä¸ªæ°æ®åéè¦ 10 ms å·¦å³çå¯»åæ¶é´ãä¹å°±æ¯è¯´ï¼å¯¹äºä¸ä¸ª 100 ä¸è¡çè¡¨ï¼å¦æä½¿ç¨äºåæ æ¥å­å¨ï¼åç¬è®¿é®ä¸ä¸ªè¡å¯è½éè¦ 20 ä¸ª 10 ms çæ¶é´ï¼è¿ä¸ªæ¥è¯¢å¯çå¤æ¢çã ä¸ºäºè®©ä¸ä¸ªæ¥è¯¢å°½éå°å°è¯»ç£çï¼å°±å¿é¡»è®©æ¥è¯¢è¿ç¨è®¿é®å°½éå°çæ°æ®åãé£ä¹ï¼æä»¬å°±ä¸åºè¯¥ä½¿ç¨äºåæ ï¼èæ¯è¦ä½¿ç¨âN åâæ ãè¿éï¼âN åâæ ä¸­çâNâåå³äºæ°æ®åçå¤§å°ã\n\nä»¥ InnoDB çä¸ä¸ªæ´æ°å­æ®µç´¢å¼ä¸ºä¾ï¼è¿ä¸ª N å·®ä¸å¤æ¯ 1200ãè¿æ£µæ é«æ¯ 4 çæ¶åï¼å°±å¯ä»¥å­ 1200 ç 3 æ¬¡æ¹ä¸ªå¼ï¼è¿å·²ç» 17 äº¿äºãèèå°æ æ ¹çæ°æ®åæ»æ¯å¨åå­ä¸­çï¼ä¸ä¸ª 10 äº¿è¡çè¡¨ä¸ä¸ä¸ªæ´æ°å­æ®µçç´¢å¼ï¼æ¥æ¾ä¸ä¸ªå¼æå¤åªéè¦è®¿é® 3 æ¬¡ç£çãå¶å®ï¼æ çç¬¬äºå±ä¹æå¾å¤§æ¦çå¨åå­ä¸­ï¼é£ä¹è®¿é®ç£ççå¹³åæ¬¡æ°å°±æ´å°äºãN åæ ç±äºå¨è¯»åä¸çæ§è½ä¼ç¹ï¼ä»¥åééç£ççè®¿é®æ¨¡å¼ï¼å·²ç»è¢«å¹¿æ³åºç¨å¨æ°æ®åºå¼æä¸­äºã\n\næ°æ®åºææ¯åå±å°ä»å¤©ï¼è·³è¡¨ãLSM æ ç­æ°æ®ç»æä¹è¢«ç¨äºå¼æè®¾è®¡ä¸­ï¼è¿éæå°±ä¸åä¸ä¸å±å¼äºãä½ å¿éè¦æä¸ªæ¦å¿µï¼æ°æ®åºåºå±å­å¨çæ ¸å¿å°±æ¯åºäºè¿äºæ°æ®æ¨¡åçãæ¯ç¢°å°ä¸ä¸ªæ°æ°æ®åºï¼æä»¬éè¦åå³æ³¨å®çæ°æ®æ¨¡åï¼è¿æ ·æè½ä»çè®ºä¸åæåºè¿ä¸ªæ°æ®åºçéç¨åºæ¯ã\n\nå¨ MySQL ä¸­ï¼ç´¢å¼æ¯å¨å­å¨å¼æå±å®ç°çï¼æä»¥å¹¶æ²¡æç»ä¸çç´¢å¼æ åï¼å³ä¸åå­å¨å¼æçç´¢å¼çå·¥ä½æ¹å¼å¹¶ä¸ä¸æ ·ãèå³ä½¿å¤ä¸ªå­å¨å¼ææ¯æåä¸ç§ç±»åçç´¢å¼ï¼å¶åºå±çå®ç°ä¹å¯è½ä¸åãä¸é¢ä»¥ InnoDB çä¸ºä¾ã\n\n\n# 2. InnoDB çç´¢å¼æ¨¡å\n\nå¨ InnoDB ä¸­ï¼è¡¨é½æ¯æ ¹æ®ä¸»é®é¡ºåºä»¥ç´¢å¼çå½¢å¼å­æ¾çï¼è¿ç§å­å¨æ¹å¼çè¡¨ç§°ä¸ºç´¢å¼ç»ç»è¡¨ãåå ä¸ºåé¢æä»¬æå°çï¼InnoDB ä½¿ç¨äº B+ æ ç´¢å¼æ¨¡åï¼æä»¥æ°æ®é½æ¯å­å¨å¨ B+ æ ä¸­çãæ¯ä¸ä¸ªç´¢å¼å¨ InnoDB éé¢å¯¹åºä¸æ£µ B+ æ ã\n\n> B+ æ è½å¤å¾å¥½å°éåç£ççè¯»åç¹æ§ï¼åå°åæ¬¡æ¥è¯¢çç£çè®¿é®æ¬¡æ°ã\n\nåè®¾ï¼æä»¬æä¸ä¸ªä¸»é®åä¸º ID çè¡¨ï¼è¡¨ä¸­æå­æ®µ kï¼å¹¶ä¸å¨ k ä¸æç´¢å¼ãè¿æ ·çå»ºè¡¨è¯­å¥ä¸ºï¼\n\nmysql> create table T(\n    id int primary key,\n    k int not null,\n    name varchar(16),\n    index (k)) engine=InnoDB;\n\n\n1\n2\n3\n4\n5\n\n\nè¡¨ä¸­ R1~R5 ç (ID,k) å¼åå«ä¸º (100,1)ã(200,2)ã(300,3)ã(500,5) å (600,6)ï¼ä¸¤æ£µæ çç¤ºä¾ç¤ºæå¾å¦ä¸ï¼\n\nä»å¾ä¸­ä¸é¾çåºï¼æ ¹æ®å¶å­èç¹çåå®¹ï¼ç´¢å¼ç±»ååä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ã\n\n * ä¸»é®ç´¢å¼ï¼å¶å­èç¹å­çæ¯æ´è¡æ°æ®ãå¨ InnoDB éï¼ä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºèç°ç´¢å¼ï¼clustered indexï¼ã\n * éä¸»é®ç´¢å¼ï¼å¶å­èç¹åå®¹æ¯ä¸»é®çå¼ãå¨ InnoDB éï¼éä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºäºçº§ç´¢å¼ï¼secondary indexï¼ã\n\n> å®éä¸ä¸»é¡µç´¢å¼ä¸­å­çæ¯å¯¹ä¸ä¸ªç£çé¡µç refãè¿ä¸é¨åå¯ç»å DDIA æ¥å­¦ä¹ ã\n\næ ¹æ®ä¸é¢çç´¢å¼ç»æè¯´æï¼æä»¬æ¥è®¨è®ºä¸ä¸ªé®é¢ï¼åºäºä¸»é®ç´¢å¼åæ®éç´¢å¼çæ¥è¯¢æä»ä¹åºå«ï¼\n\n * å¦æè¯­å¥æ¯ select * from T where ID=500ï¼å³ä¸»é®æ¥è¯¢æ¹å¼ï¼ååªéè¦æç´¢ ID è¿æ£µ B+ æ ï¼\n * å¦æè¯­å¥æ¯ select * from T where k=5ï¼å³æ®éç´¢å¼æ¥è¯¢æ¹å¼ï¼åéè¦åæç´¢ k ç´¢å¼æ ï¼å¾å° ID çå¼ä¸º 500ï¼åå° ID ç´¢å¼æ æç´¢ä¸æ¬¡ãè¿ä¸ªè¿ç¨ç§°ä¸ºåè¡¨ã\n\nä¹å°±æ¯è¯´ï¼åºäºéä¸»é®ç´¢å¼çæ¥è¯¢éè¦å¤æ«æä¸æ£µç´¢å¼æ ãå æ­¤ï¼æä»¬å¨åºç¨ä¸­åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥è¯¢ã\n\n\n# 3.ç´¢å¼ç»´æ¤\n\nB+ æ ä¸ºäºç»´æ¤ç´¢å¼æåºæ§ï¼å¨æå¥æ°å¼çæ¶åéè¦åå¿è¦çç»´æ¤ã\n\n * ä»¥ä¸é¢è¿ä¸ªå¾ä¸ºä¾ï¼å¦ææå¥æ°çè¡ ID å¼ä¸º 700ï¼ååªéè¦å¨ R5 çè®°å½åé¢æå¥ä¸ä¸ªæ°è®°å½ãå¦ææ°æå¥ç ID å¼ä¸º 400ï¼å°±ç¸å¯¹éº»ç¦äºï¼éè¦é»è¾ä¸æªå¨åé¢çæ°æ®ï¼ç©ºåºä½ç½®ã\n * èæ´ç³çæåµæ¯ï¼å¦æ R5 æå¨çæ°æ®é¡µå·²ç»æ»¡äºï¼æ ¹æ® B+ æ çç®æ³ï¼è¿æ¶åéè¦ç³è¯·ä¸ä¸ªæ°çæ°æ®é¡µï¼ç¶åæªå¨é¨åæ°æ®è¿å»ãè¿ä¸ªè¿ç¨ç§°ä¸ºé¡µåè£ãå¨è¿ç§æåµä¸ï¼æ§è½èªç¶ä¼åå½±åã\n\né¤äºæ§è½å¤ï¼é¡µåè£æä½è¿å½±åæ°æ®é¡µçå©ç¨çãåæ¬æ¾å¨ä¸ä¸ªé¡µçæ°æ®ï¼ç°å¨åå°ä¸¤ä¸ªé¡µä¸­ï¼æ´ä½ç©ºé´å©ç¨çéä½å¤§çº¦ 50%ã\n\nå½ç¶æåè£å°±æåå¹¶ãå½ç¸é»ä¸¤ä¸ªé¡µç±äºå é¤äºæ°æ®ï¼å©ç¨çå¾ä½ä¹åï¼ä¼å°æ°æ®é¡µåé¡µåå¹¶ãåå¹¶çè¿ç¨ï¼å¯ä»¥è®¤ä¸ºæ¯åè£è¿ç¨çéè¿ç¨ã\n\nåºäºä¸é¢çç´¢å¼ç»´æ¤è¿ç¨è¯´æï¼æä»¬æ¥è®¨è®ºä¸ä¸ªæ¡ä¾ï¼ä½ å¯è½å¨ä¸äºå»ºè¡¨è§èéé¢è§å°è¿ç±»ä¼¼çæè¿°ï¼è¦æ±å»ºè¡¨è¯­å¥éä¸å®è¦æèªå¢ä¸»é®ãå½ç¶äºæ ç»å¯¹ï¼æä»¬æ¥åæä¸ä¸åªäºåºæ¯ä¸åºè¯¥ä½¿ç¨èªå¢ä¸»é®ï¼èåªäºåºæ¯ä¸ä¸åºè¯¥ã\n\nèªå¢ä¸»é®æ¯æèªå¢åä¸å®ä¹çä¸»é®ï¼å¨å»ºè¡¨è¯­å¥ä¸­ä¸è¬æ¯è¿ä¹å®ä¹çï¼ NOT NULL PRIMARY KEY AUTO_INCREMENTã\n\næå¥æ°è®°å½çæ¶åå¯ä»¥ä¸æå® ID çå¼ï¼ç³»ç»ä¼è·åå½å ID æå¤§å¼å  1 ä½ä¸ºä¸ä¸æ¡è®°å½ç ID å¼ãä¹å°±æ¯è¯´ï¼èªå¢ä¸»é®çæå¥æ°æ®æ¨¡å¼ï¼æ­£ç¬¦åäºæä»¬åé¢æå°çéå¢æå¥çåºæ¯ãæ¯æ¬¡æå¥ä¸æ¡æ°è®°å½ï¼é½æ¯è¿½å æä½ï¼é½ä¸æ¶åå°æªå¨å¶ä»è®°å½ï¼ä¹ä¸ä¼è§¦åå¶å­èç¹çåè£ã\n\nèæä¸å¡é»è¾çå­æ®µåä¸»é®ï¼åå¾å¾ä¸å®¹æä¿è¯æåºæå¥ï¼è¿æ ·åæ°æ®ææ¬ç¸å¯¹è¾é«ã\n\né¤äºèèæ§è½å¤ï¼æä»¬è¿å¯ä»¥ä»å­å¨ç©ºé´çè§åº¦æ¥çãâ åè®¾ä½ çè¡¨ä¸­ç¡®å®æä¸ä¸ªå¯ä¸å­æ®µï¼æ¯å¦å­ç¬¦ä¸²ç±»åçèº«ä»½è¯å·ï¼é£åºè¯¥ç¨èº«ä»½è¯å·åä¸»é®ï¼è¿æ¯ç¨èªå¢å­æ®µåä¸»é®å¢ï¼\n\nç±äºæ¯ä¸ªéä¸»é®ç´¢å¼çå¶å­èç¹ä¸é½æ¯ä¸»é®çå¼ãå¦æç¨èº«ä»½è¯å·åä¸»é®ï¼é£ä¹æ¯ä¸ªäºçº§ç´¢å¼çå¶å­èç¹å ç¨çº¦ 20 ä¸ªå­èï¼èå¦æç¨æ´ååä¸»é®ï¼ååªè¦ 4 ä¸ªå­èï¼å¦ææ¯é¿æ´åï¼bigintï¼åæ¯ 8 ä¸ªå­èãæ¾ç¶ï¼ä¸»é®é¿åº¦è¶å°ï¼æ®éç´¢å¼çå¶å­èç¹å°±è¶å°ï¼æ®éç´¢å¼å ç¨çç©ºé´ä¹å°±è¶å°ãæä»¥ï¼ä»æ§è½åå­å¨ç©ºé´æ¹é¢èéï¼èªå¢ä¸»é®å¾å¾æ¯æ´åççéæ©ã\n\nâ ææ²¡æä»ä¹åºæ¯éåç¨ä¸å¡å­æ®µç´æ¥åä¸»é®çå¢ï¼è¿æ¯æçãæ¯å¦ï¼æäºä¸å¡çåºæ¯éæ±æ¯è¿æ ·çï¼\n\n 1. åªæä¸ä¸ªç´¢å¼ï¼\n 2. è¯¥ç´¢å¼å¿é¡»æ¯å¯ä¸ç´¢å¼ã\n\nè¿å°±æ¯å¸åç KV åºæ¯ãç±äºæ²¡æå¶ä»ç´¢å¼ï¼æä»¥ä¹å°±ä¸ç¨èèå¶ä»ç´¢å¼çå¶å­èç¹å¤§å°çé®é¢ãè¿æ¶åæä»¬å°±è¦ä¼åèèä¸ä¸æ®µæå°çâå°½éä½¿ç¨ä¸»é®æ¥è¯¢âååï¼ç´æ¥å°è¿ä¸ªç´¢å¼è®¾ç½®ä¸ºä¸»é®ï¼å¯ä»¥é¿åæ¯æ¬¡æ¥è¯¢éè¦æç´¢ä¸¤æ£µæ ã\n\næä»¥ï¼ç±äº InnoDB æ¯ç´¢å¼ç»ç»è¡¨ï¼ä¸è¬æåµä¸æä¼å»ºè®®ä½ åå»ºä¸ä¸ªèªå¢ä¸»é®ï¼è¿æ ·éä¸»é®ç´¢å¼å ç¨çç©ºé´æå°ãä½äºæ ç»å¯¹ï¼æä¹è·ä½ è®¨è®ºäºä½¿ç¨ä¸å¡é»è¾å­æ®µåä¸»é®çåºç¨åºæ¯ã\n\n\n# 4. å¸¦ç´¢å¼çæ¥è¯¢ä¼å\n\næä»¬åçä¸ä¸ªé®é¢ï¼å¨ä¸é¢è¿ä¸ªè¡¨ T ä¸­ï¼å¦æææ§è¡ select * from T where k between 3 and 5ï¼éè¦æ§è¡å æ¬¡æ çæç´¢æä½ï¼ä¼æ«æå¤å°è¡ï¼\n\nmysql> create table T (\n    ID int primary key,\n    k int NOT NULL DEFAULT 0,\n    s varchar(16) NOT NULL DEFAULT '',\n    index k(k)) engine=InnoDB;\n\ninsert into T values \n  (100,1, 'aa'),\n  (200,2,'bb'),\n  (300,3,'cc'),\n  (500,5,'ee'),\n  (600,6,'ff'),\n  (700,7,'gg');\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nä¸é¢æ¯ InnoDB çç´¢å¼ç»ç»ç»æï¼\n\nç°å¨ï¼æä»¬ä¸èµ·æ¥ççè¿æ¡ SQL æ¥è¯¢è¯­å¥çæ§è¡æµç¨ï¼\n\n 1. å¨ k ç´¢å¼æ ä¸æ¾å° k=3 çè®°å½ï¼åå¾ ID = 300ï¼\n 2. åå° ID ç´¢å¼æ æ¥å° ID=300 å¯¹åºç R3ï¼\n 3. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=5ï¼åå¾ ID=500ï¼\n 4. ååå° ID ç´¢å¼æ æ¥å° ID=500 å¯¹åºç R4ï¼\n 5. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=6ï¼ä¸æ»¡è¶³æ¡ä»¶ï¼å¾ªç¯ç»æã\n\nå¨è¿ä¸ªè¿ç¨ä¸­ï¼åå°ä¸»é®ç´¢å¼æ æç´¢çè¿ç¨ï¼æä»¬ç§°ä¸ºåè¡¨ãå¯ä»¥çå°ï¼è¿ä¸ªæ¥è¯¢è¿ç¨è¯»äº k ç´¢å¼æ ç 3 æ¡è®°å½ï¼æ­¥éª¤ 1ã3 å 5ï¼ï¼åè¡¨äºä¸¤æ¬¡ï¼æ­¥éª¤ 2 å 4ï¼ã\n\nå¨è¿ä¸ªä¾å­ä¸­ï¼ç±äºæ¥è¯¢ç»ææéè¦çæ°æ®åªå¨ä¸»é®ç´¢å¼ä¸æï¼æä»¥ä¸å¾ä¸åè¡¨ãé£ä¹ï¼ææ²¡æå¯è½ç»è¿ç´¢å¼ä¼åï¼é¿ååè¡¨è¿ç¨å¢ï¼\n\n\n# 4.1 è¦çç´¢å¼\n\nå¦ææ§è¡çè¯­å¥æ¯ select ID from T where k between 3 and 5ï¼è¿æ¶åªéè¦æ¥ ID çå¼ï¼è ID çå¼å·²ç»å¨ k ç´¢å¼æ ä¸äºï¼å æ­¤å¯ä»¥ç´æ¥æä¾æ¥è¯¢ç»æï¼ä¸éè¦åè¡¨ãä¹å°±æ¯è¯´ï¼å¨è¿ä¸ªæ¥è¯¢éé¢ï¼ç´¢å¼ k å·²ç»âè¦çäºâæä»¬çæ¥è¯¢éæ±ï¼æä»¬ç§°ä¸ºè¦çç´¢å¼ã\n\nç±äºè¦çç´¢å¼å¯ä»¥åå°æ çæç´¢æ¬¡æ°ï¼æ¾èæåæ¥è¯¢æ§è½ï¼æä»¥ä½¿ç¨è¦çç´¢å¼æ¯ä¸ä¸ªå¸¸ç¨çæ§è½ä¼åææ®µã\n\n> éè¦æ³¨æçæ¯ï¼å¨å¼æåé¨ä½¿ç¨è¦çç´¢å¼å¨ç´¢å¼ k ä¸å¶å®è¯»äºä¸ä¸ªè®°å½ï¼R3~R5ï¼å¯¹åºçç´¢å¼ k ä¸çè®°å½é¡¹ï¼ï¼ä½æ¯å¯¹äº MySQL ç Server å±æ¥è¯´ï¼å®å°±æ¯æ¾å¼ææ¿å°äºä¸¤æ¡è®°å½ï¼å æ­¤ MySQL è®¤ä¸ºæ«æè¡æ°æ¯ 2ã\n\nåºäºä¸é¢è¦çç´¢å¼çè¯´æï¼æä»¬æ¥è®¨è®ºä¸ä¸ªé®é¢ï¼å¨ä¸ä¸ªå¸æ°ä¿¡æ¯è¡¨ä¸ï¼æ¯å¦æå¿è¦å°èº«ä»½è¯å·ååå­å»ºç«èåç´¢å¼ï¼åè®¾è¿ä¸ªå¸æ°è¡¨çå®ä¹æ¯è¿æ ·çï¼\n\n\nCREATE TABLE `tuser` (\n  `id` int(11) NOT NULL,\n  `id_card` varchar(32) DEFAULT NULL,\n  `name` varchar(32) DEFAULT NULL,\n  `age` int(11) DEFAULT NULL,\n  `ismale` tinyint(1) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `id_card` (`id_card`),\n  KEY `name_age` (`name`,`age`)\n) ENGINE=InnoDB\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næä»¬ç¥éï¼èº«ä»½è¯å·æ¯å¸æ°çå¯ä¸æ è¯ãä¹å°±æ¯è¯´ï¼å¦æææ ¹æ®èº«ä»½è¯å·æ¥è¯¢å¸æ°ä¿¡æ¯çéæ±ï¼æä»¬åªè¦å¨èº«ä»½è¯å·å­æ®µä¸å»ºç«ç´¢å¼å°±å¤äºãèåå»ºç«ä¸ä¸ªï¼èº«ä»½è¯å·ãå§åï¼çèåç´¢å¼ï¼æ¯ä¸æ¯æµªè´¹ç©ºé´ï¼\n\nå¦æç°å¨æä¸ä¸ªé«é¢è¯·æ±ï¼è¦æ ¹æ®å¸æ°çèº«ä»½è¯å·æ¥è¯¢ä»çå§åï¼è¿ä¸ªèåç´¢å¼å°±ææä¹äºãå®å¯ä»¥å¨è¿ä¸ªé«é¢è¯·æ±ä¸ç¨å°è¦çç´¢å¼ï¼ä¸åéè¦åè¡¨æ¥æ´è¡è®°å½ï¼åå°è¯­å¥çæ§è¡æ¶é´ãæä»¥ï¼åå©èåç´¢å¼æå®ç°çç´¢å¼åä½å¯ä»¥æ¯æè¦çç´¢å¼ï¼ä»èä¼åæ¥è¯¢æ§è½ã\n\nå½ç¶ï¼ç´¢å¼å­æ®µçç»´æ¤æ»æ¯æä»£ä»·çãå æ­¤ï¼å¨å»ºç«åä½ç´¢å¼æ¥æ¯æè¦çç´¢å¼æ¶å°±éè¦æè¡¡èèäºãè¿æ­£æ¯ä¸å¡ DBAï¼æèç§°ä¸ºä¸å¡æ°æ®æ¶æå¸çå·¥ä½ã\n\n\n# 4.2 æå·¦åç¼åå\n\nçå°è¿éä½ ä¸å®æä¸ä¸ªçé®ï¼å¦æä¸ºæ¯ä¸ç§æ¥è¯¢é½è®¾è®¡ä¸ä¸ªç´¢å¼ï¼ç´¢å¼æ¯ä¸æ¯å¤ªå¤äºãå¦ææç°å¨è¦æç§å¸æ°çèº«ä»½è¯å·å»æ¥ä»çå®¶åº­å°åå¢ï¼è½ç¶è¿ä¸ªæ¥è¯¢éæ±å¨ä¸å¡ä¸­åºç°çæ¦çä¸é«ï¼ä½æ»ä¸è½è®©å®èµ°å¨è¡¨æ«æå§ï¼åè¿æ¥è¯´ï¼åç¬ä¸ºä¸ä¸ªä¸é¢ç¹çè¯·æ±åå»ºä¸ä¸ªï¼èº«ä»½è¯å·ï¼å°åï¼çç´¢å¼åæè§æç¹æµªè´¹ãåºè¯¥æä¹åå¢ï¼\n\nè¿éç´æ¥è¯´ç»è®ºå§ï¼B+ æ è¿ç§ç´¢å¼ç»æï¼å¯ä»¥å©ç¨ç´¢å¼çâæå·¦åç¼âï¼æ¥å®ä½è®°å½ã\n\nä¸ºäºç´è§å°è¯´æè¿ä¸ªæ¦å¿µï¼æä»¬ç¨ï¼nameï¼ageï¼è¿ä¸ªèåç´¢å¼æ¥åæï¼\n\nå¯ä»¥çå°ï¼ç´¢å¼é¡¹æ¯æç§ç´¢å¼å®ä¹éé¢åºç°çå­æ®µé¡ºåºæåºçï¼å³ä¼åæâå§åâæ¥æåºã\n\n * å½ä½ çé»è¾éæ±æ¯æ¥å°ææåå­æ¯âå¼ ä¸âçäººæ¶ï¼å¯ä»¥å¿«éå®ä½å° ID4ï¼ç¶åååéåå¾å°ææéè¦çç»æã\n * å¦æä½ è¦æ¥çæ¯ææåå­ç¬¬ä¸ä¸ªå­æ¯âå¼ âçäººï¼ä½ ç SQL è¯­å¥çæ¡ä»¶æ¯\"where name like âå¼  %â\"ãè¿æ¶ï¼ä½ ä¹è½å¤ç¨ä¸è¿ä¸ªç´¢å¼ï¼æ¥æ¾å°ç¬¬ä¸ä¸ªç¬¦åæ¡ä»¶çè®°å½æ¯ ID3ï¼ç¶åååéåï¼ç´å°ä¸æ»¡è¶³æ¡ä»¶ä¸ºæ­¢ã\n\nå¯ä»¥çå°ï¼ä¸åªæ¯ç´¢å¼çå¨é¨å®ä¹ï¼åªè¦æ»¡è¶³æå·¦åç¼ï¼å°±å¯ä»¥å©ç¨ç´¢å¼æ¥å éæ£ç´¢ãè¿ä¸ªæå·¦åç¼å¯ä»¥æ¯èåç´¢å¼çæå·¦ N ä¸ªå­æ®µï¼ä¹å¯ä»¥æ¯å­ç¬¦ä¸²ç´¢å¼çæå·¦ M ä¸ªå­ç¬¦ã\n\nåºäºä¸é¢å¯¹æå·¦åç¼ç´¢å¼çè¯´æï¼æä»¬æ¥è®¨è®ºä¸ä¸ªé®é¢ï¼å¨å»ºç«èåç´¢å¼çæ¶åï¼å¦ä½å®æç´¢å¼åçå­æ®µé¡ºåºâ\n\nè¿éæä»¬çè¯ä¼°æ åæ¯ï¼ç´¢å¼çå¤ç¨è½åãå ä¸ºå¯ä»¥æ¯ææå·¦åç¼ï¼æä»¥å½å·²ç»æäº (a,b) è¿ä¸ªèåç´¢å¼åï¼ä¸è¬å°±ä¸éè¦åç¬å¨ a ä¸å»ºç«ç´¢å¼äºãå æ­¤ï¼ç¬¬ä¸ååæ¯ï¼å¦æéè¿è°æ´é¡ºåºï¼å¯ä»¥å°ç»´æ¤ä¸ä¸ªç´¢å¼ï¼é£ä¹è¿ä¸ªé¡ºåºå¾å¾å°±æ¯éè¦ä¼åèèéç¨çã\n\næä»¥ç°å¨ä½ ç¥éäºï¼è¿æ®µå¼å¤´çé®é¢éï¼æä»¬è¦ä¸ºé«é¢è¯·æ±åå»º (èº«ä»½è¯å·ï¼å§åï¼è¿ä¸ªèåç´¢å¼ï¼å¹¶ç¨è¿ä¸ªç´¢å¼æ¥åæ¶æ¯æâæ ¹æ®èº«ä»½è¯å·æ¥è¯¢å°åâçéæ±ã\n\né£ä¹ï¼å¦ææ¢æèåæ¥è¯¢ï¼åæåºäº aãb åèªçæ¥è¯¢å¢ï¼æ¥è¯¢æ¡ä»¶éé¢åªæ b çè¯­å¥ï¼æ¯æ æ³ä½¿ç¨ (a,b) è¿ä¸ªèåç´¢å¼çï¼è¿æ¶åä½ ä¸å¾ä¸ç»´æ¤å¦å¤ä¸ä¸ªç´¢å¼ï¼ä¹å°±æ¯è¯´ä½ éè¦åæ¶ç»´æ¤ (a,b)ã(b) è¿ä¸¤ä¸ªç´¢å¼ãè¿æ¶åï¼æä»¬è¦èèçååå°±æ¯ç©ºé´äºãæ¯å¦ä¸é¢è¿ä¸ªå¸æ°è¡¨çæåµï¼name å­æ®µæ¯æ¯ age å­æ®µå¤§ç ï¼é£æå°±å»ºè®®ä½ åå»ºä¸ä¸ªï¼name,age) çèåç´¢å¼åä¸ä¸ª (age) çåå­æ®µç´¢å¼ã\n\næä»¥å¯ä»¥çå°ï¼è¦ä¸è¦å»ºç«èåç´¢å¼ï¼ä»¥ææ ·çé¡ºåºæ¥å»ºç«èåç´¢å¼ï¼é½æ¯è¦æ ¹æ®ä¸å¡åºæ¯æ¥å³å®çã\n\n\n# 4.3 ç´¢å¼ä¸æ¨\n\nä¸ä¸æ®µæä»¬è¯´å°æ»¡è¶³æå·¦åç¼ååçæ¶åï¼æå·¦åç¼å¯ä»¥ç¨äºå¨ç´¢å¼ä¸­å®ä½è®°å½ãè¿æ¶ï¼ä½ å¯è½è¦é®ï¼é£äºä¸ç¬¦åæå·¦åç¼çé¨åï¼ä¼æä¹æ ·å¢ï¼\n\næä»¬è¿æ¯ä»¥å¸æ°è¡¨çèåç´¢å¼ï¼name, ageï¼ä¸ºä¾ãå¦æç°å¨æä¸ä¸ªéæ±ï¼æ£ç´¢åºè¡¨ä¸­âåå­ç¬¬ä¸ä¸ªå­æ¯å¼ ï¼èä¸å¹´é¾æ¯ 10 å²çææç·å­©âãé£ä¹ï¼SQL è¯­å¥æ¯è¿ä¹åçï¼\n\nmysql> select * from tuser where name like 'å¼ %' and age=10 and ismale=1;\n\n\n1\n\n\nä½ å·²ç»ç¥éäºåç¼ç´¢å¼è§åï¼æä»¥è¿ä¸ªè¯­å¥å¨æç´¢ç´¢å¼æ çæ¶åï¼åªè½ç¨ âå¼ âï¼æ¾å°ç¬¬ä¸ä¸ªæ»¡è¶³æ¡ä»¶çè®°å½ ID3ãå½ç¶ï¼è¿è¿ä¸éï¼æ»æ¯å¨è¡¨æ«æè¦å¥½ã\n\nç¶åå¢ï¼å½ç¶æ¯å¤æ­å¶ä»æ¡ä»¶æ¯å¦æ»¡è¶³ï¼\n\n * å¨ MySQL 5.6 ä¹åï¼åªè½ä» ID3 å¼å§ä¸ä¸ªä¸ªåè¡¨ãå°ä¸»é®ç´¢å¼ä¸æ¾åºæ°æ®è¡ï¼åå¯¹æ¯å­æ®µå¼ã\n * è MySQL 5.6 å¼å¥çç´¢å¼ä¸æ¨ä¼åï¼index condition pushdown)ï¼ å¯ä»¥å¨ç´¢å¼éåè¿ç¨ä¸­ï¼å¯¹ç´¢å¼ä¸­åå«çå­æ®µååå¤æ­ï¼ç´æ¥è¿æ»¤æä¸æ»¡è¶³æ¡ä»¶çè®°å½ï¼åå°åè¡¨æ¬¡æ°ã\n\nå¯è½ä¸é¢çè¯´æ³æ¯è¾æ½è±¡ï¼ä¸é¢ä¸¾ä¸ä¸ªå®éä¾å­ãä¸é¢æ¯ä¸¤ä¸ªæ§è¡è¿ç¨çæµç¨å¾ï¼\n\n * æ ç´¢å¼ä¸æ¨æ§è¡æµç¨ï¼\n\n * ç´¢å¼ä¸æ¨æ§è¡æµç¨ï¼\n\nä¸å¾ä¸­ï¼æ¯ä¸ä¸ªèçº¿ç®­å¤´è¡¨ç¤ºåè¡¨ä¸æ¬¡ã\n\nå¨æ ç´¢å¼ä¸æ¨æ§è¡æµç¨å¾ä¸­ï¼å¨ (name,age) ç´¢å¼éé¢æç¹æå»æäº age çå¼ï¼è¿ä¸ªè¿ç¨ InnoDB å¹¶ä¸ä¼å»ç age çå¼ï¼åªæ¯æé¡ºåºæâname ç¬¬ä¸ä¸ªå­æ¯âå¼ ââçè®°å½ä¸æ¡æ¡ååºæ¥åè¡¨ãå æ­¤ï¼éè¦åè¡¨ 4 æ¬¡ã\n\nå¨ç´¢å¼ä¸æ¨æ§è¡æµç¨ä¸­ï¼nnoDB å¨ (name,age) ç´¢å¼åé¨å°±å¤æ­äº age æ¯å¦ç­äº 10ï¼å¯¹äºä¸ç­äº 10 çè®°å½ï¼ç´æ¥å¤æ­å¹¶è·³è¿ãå¨æä»¬çè¿ä¸ªä¾å­ä¸­ï¼åªéè¦å¯¹ ID4ãID5 è¿ä¸¤æ¡è®°å½åè¡¨åæ°æ®å¤æ­ï¼å°±åªéè¦åè¡¨ 2 æ¬¡ã\n\n\n# Summary\n\nå¨æ»¡è¶³è¯­å¥éæ±çæåµä¸ï¼ å°½éå°å°è®¿é®èµæºæ¯æ°æ®åºè®¾è®¡çéè¦ååä¹ä¸ãæä»¬å¨ä½¿ç¨æ°æ®åºçæ¶åï¼å°¤å¶æ¯å¨è®¾è®¡è¡¨ç»ææ¶ï¼ä¹è¦ä»¥åå°èµæºæ¶èä½ä¸ºç®æ ã\n\n\n# QA\n\nä¸ä¸ªé®é¢ãå¯¹äºç¬¬ 2 å¤§èä¸­çä¾å­ä¸­ç InnoDB è¡¨ Tï¼å¦æä½ è¦éå»ºç´¢å¼ kï¼ä½ çä¸¤ä¸ª SQL è¯­å¥å¯ä»¥è¿ä¹åï¼\n\nalter table T drop index k;\nalter table T add index(k);\n\n\n1\n2\n\n\nå¦æä½ è¦éå»ºä¸»é®ç´¢å¼ï¼ä¹å¯ä»¥è¿ä¹åï¼\n\nalter table T drop primary key;\nalter table T add primary key(id);\n\n\n1\n2\n\n\né®é¢æ¯ï¼å¯¹äºä¸é¢è¿ä¸¤ä¸ªéå»ºç´¢å¼çä½æ³ï¼è¯´åºä½ ççè§£ãå¦ææä¸åéçï¼ä¸ºä»ä¹ï¼æ´å¥½çæ¹æ³æ¯ä»ä¹ï¼\n\nåèç­æ¡ï¼éå»ºç´¢å¼ k çåæ³æ¯åççï¼å¯ä»¥è¾¾å°çç©ºé´çç®çãå ä¸º InnoDB å¼æå¨å é¤äºè¡¨çé¨åè®°å½åï¼ä½æ¯å®çç´¢å¼è¿å¨ï¼å¹¶æªéæ¾ãä½æ¯ï¼éå»ºä¸»é®çè¿ç¨ä¸åçãä¸è®ºæ¯å é¤ä¸»é®è¿æ¯åå»ºä¸»é®ï¼é½ä¼å°æ´ä¸ªè¡¨éå»ºãæä»¥è¿çæ§è¡è¿ä¸¤ä¸ªè¯­å¥çè¯ï¼ç¬¬ä¸ä¸ªè¯­å¥å°±ç½åäºãè¿ä¸¤ä¸ªè¯­å¥ï¼ä½ å¯ä»¥ç¨è¿ä¸ªè¯­å¥ä»£æ¿ ï¼ alter table T engine=InnoDB",normalizedContent:"> åèï¼\n> \n>  * 04 | æ·±å¥æµåºç´¢å¼ï¼ä¸ï¼| æå®¢æ¶é´\n>  * 05 | æ·±å¥æµåºç´¢å¼ï¼ä¸ï¼| æå®¢æ¶é´\n\nç´¢å¼æ¯æ°æ®åºç³»ç»éé¢æéè¦çæ¦å¿µä¹ä¸ãä¸å¥è¯ç®åæ¥è¯´ï¼ç´¢å¼çåºç°å¶å®å°±æ¯ä¸ºäºæé«æ°æ®æ¥è¯¢çæçï¼å°±åä¹¦çç®å½ä¸æ ·ï¼è½å¤å¿«éå®ä½å¶ä¸­çæä¸ªç¥è¯ç¹ã\n\n\n# 1. ç´¢å¼çå¸¸è§æ¨¡å\n\nç´¢å¼çåºç°æ¯ä¸ºäºæé«æ¥è¯¢æçï¼ä½æ¯å®ç°ç´¢å¼çæ¹å¼å´æå¾å¤ç§ï¼æä»¥è¿éä¹å°±å¼å¥äºç´¢å¼æ¨¡åçæ¦å¿µãå¯ä»¥ç¨äºæé«è¯»åæççæ°æ®ç»æå¾å¤ï¼è¿éæåä»ç»ä¸ç§å¸¸è§ãä¹æ¯è¾ç®åçæ°æ®ç»æï¼å®ä»¬åå«æ¯åå¸è¡¨ãæåºæ°ç»åæç´¢æ ã\n\n\n# 1.1 åå¸è¡¨çç´¢å¼æ¨¡å\n\nåå¸è¡¨æ¯ä¸ç§ä»¥é® - å¼ï¼key-valueï¼å­å¨æ°æ®çç»æï¼æä»¬åªè¦è¾å¥å¾æ¥æ¾çé®å³ keyï¼å°±å¯ä»¥æ¾å°å¶å¯¹åºçå¼å³ valueãåå¸å²çªæ¶æåºä¸ä¸ªé¾è¡¨å°±å¥½äºã\n\nåè®¾ï¼ä½ ç°å¨ç»´æ¤çä¸ä¸ªèº«ä»½è¯ä¿¡æ¯åå§åçè¡¨ï¼éè¦æ ¹æ®èº«ä»½è¯å·æ¥æ¾å¯¹åºçåå­ï¼è¿æ¶å¯¹åºçåå¸ç´¢å¼çç¤ºæå¾å¦ä¸æç¤ºï¼\n\nä½åå¸è¡¨çç¼ºç¹æ¯å®ä¸æ¯æåºçï¼æä»¥åå¸ç´¢å¼ååºé´æ¥è¯¢çéåº¦å¾æ¢ï¼è¿ç§ç»æéç¨äºåªæç­å¼æ¥è¯¢çåºæ¯ã\n\n\n# 1.2 æåºæ°ç»çç´¢å¼æ¨¡å\n\næåºæ°ç»å¨ç­å¼æ¥è¯¢åèå´æ¥è¯¢åºæ¯ä¸­çæ§è½å°±é½éå¸¸ä¼ç§ï¼æ¯å¦ä¸é¢é£ä¸ªæ ¹æ®èº«ä»½è¯å·æ¥åå­çä¾å­ï¼å¦æç¨æåºæ°ç»æ¥å®ç°çè¯ï¼å¦ä¸å¾ï¼\n\nè¥è¦æ¥è¯¢æ id å¯¹åºçåå­ï¼ç¨äºåæ³å°±å¯å¿«éå¾å°ï¼æ¶é´å¤æåº¦æ¯ o(log(n))ã\n\nå¦æä»ä»çæ¥è¯¢æçï¼æåºæ°ç»å°±æ¯æå¥½çæ°æ®ç»æäºãä½æ¯ï¼å¨éè¦æ´æ°æ°æ®çæ¶åå°±éº»ç¦äºï¼ä½ å¾ä¸­é´æå¥ä¸ä¸ªè®°å½å°±å¿é¡»å¾æªå¨åé¢ææçè®°å½ï¼ææ¬å¤ªé«ã\n\næä»¥ï¼æåºæ°ç»ç´¢å¼åªéç¨äºéæå­å¨å¼æï¼æ¯å¦ä½ è¦ä¿å­çæ¯ 2017 å¹´æä¸ªåå¸çææäººå£ä¿¡æ¯ï¼è¿ç±»ä¸ä¼åä¿®æ¹çæ°æ®ã\n\n\n# 1.3 æç´¢æ çç´¢å¼æ¨¡å\n\näºåæç´¢æ ä¹æ¯ç»å¸æ°æ®ç»æäºï¼ä½ä¸ºäºç»´æ $o(\\log(n))$ çæ¥è¯¢å¤æåº¦ï¼ä½ éè¦ä¸ä¸ªå¹³è¡¡äºåæ ãä¸ºäºä¿æå¹³è¡¡ï¼æ´æ°çæ¶é´å¤æåº¦ä¹æ¯ o(log(n))ã\n\n> äºåæç´¢æ çç¹ç¹ï¼æ¯ä¸ªèç¹çå·¦å¿å­å°äºç¶èç¹ï¼ç¶èç¹åå°äºå³å¿å­ã\n\næ å¯ä»¥æäºåï¼ä¹å¯ä»¥æå¤åãäºåæ æ¯æç´¢æçæé«çï¼ä½æ¯å®éä¸å¤§å¤æ°çæ°æ®åºå­å¨å´å¹¶ä¸ä½¿ç¨äºåæ ãå¶åå æ¯ï¼ç´¢å¼ä¸æ­¢å­å¨åå­ä¸­ï¼è¿è¦åå°ç£çä¸ã\n\n> ä½ å¯ä»¥æ³è±¡ä¸ä¸ä¸æ£µ 100 ä¸èç¹çå¹³è¡¡äºåæ ï¼æ é« 20ãä¸æ¬¡æ¥è¯¢å¯è½éè¦è®¿é® 20 ä¸ªæ°æ®åãå¨æºæ¢°ç¡¬çæ¶ä»£ï¼ä»ç£çéæºè¯»ä¸ä¸ªæ°æ®åéè¦ 10 ms å·¦å³çå¯»åæ¶é´ãä¹å°±æ¯è¯´ï¼å¯¹äºä¸ä¸ª 100 ä¸è¡çè¡¨ï¼å¦æä½¿ç¨äºåæ æ¥å­å¨ï¼åç¬è®¿é®ä¸ä¸ªè¡å¯è½éè¦ 20 ä¸ª 10 ms çæ¶é´ï¼è¿ä¸ªæ¥è¯¢å¯çå¤æ¢çã ä¸ºäºè®©ä¸ä¸ªæ¥è¯¢å°½éå°å°è¯»ç£çï¼å°±å¿é¡»è®©æ¥è¯¢è¿ç¨è®¿é®å°½éå°çæ°æ®åãé£ä¹ï¼æä»¬å°±ä¸åºè¯¥ä½¿ç¨äºåæ ï¼èæ¯è¦ä½¿ç¨ân åâæ ãè¿éï¼ân åâæ ä¸­çânâåå³äºæ°æ®åçå¤§å°ã\n\nä»¥ innodb çä¸ä¸ªæ´æ°å­æ®µç´¢å¼ä¸ºä¾ï¼è¿ä¸ª n å·®ä¸å¤æ¯ 1200ãè¿æ£µæ é«æ¯ 4 çæ¶åï¼å°±å¯ä»¥å­ 1200 ç 3 æ¬¡æ¹ä¸ªå¼ï¼è¿å·²ç» 17 äº¿äºãèèå°æ æ ¹çæ°æ®åæ»æ¯å¨åå­ä¸­çï¼ä¸ä¸ª 10 äº¿è¡çè¡¨ä¸ä¸ä¸ªæ´æ°å­æ®µçç´¢å¼ï¼æ¥æ¾ä¸ä¸ªå¼æå¤åªéè¦è®¿é® 3 æ¬¡ç£çãå¶å®ï¼æ çç¬¬äºå±ä¹æå¾å¤§æ¦çå¨åå­ä¸­ï¼é£ä¹è®¿é®ç£ççå¹³åæ¬¡æ°å°±æ´å°äºãn åæ ç±äºå¨è¯»åä¸çæ§è½ä¼ç¹ï¼ä»¥åééç£ççè®¿é®æ¨¡å¼ï¼å·²ç»è¢«å¹¿æ³åºç¨å¨æ°æ®åºå¼æä¸­äºã\n\næ°æ®åºææ¯åå±å°ä»å¤©ï¼è·³è¡¨ãlsm æ ç­æ°æ®ç»æä¹è¢«ç¨äºå¼æè®¾è®¡ä¸­ï¼è¿éæå°±ä¸åä¸ä¸å±å¼äºãä½ å¿éè¦æä¸ªæ¦å¿µï¼æ°æ®åºåºå±å­å¨çæ ¸å¿å°±æ¯åºäºè¿äºæ°æ®æ¨¡åçãæ¯ç¢°å°ä¸ä¸ªæ°æ°æ®åºï¼æä»¬éè¦åå³æ³¨å®çæ°æ®æ¨¡åï¼è¿æ ·æè½ä»çè®ºä¸åæåºè¿ä¸ªæ°æ®åºçéç¨åºæ¯ã\n\nå¨ mysql ä¸­ï¼ç´¢å¼æ¯å¨å­å¨å¼æå±å®ç°çï¼æä»¥å¹¶æ²¡æç»ä¸çç´¢å¼æ åï¼å³ä¸åå­å¨å¼æçç´¢å¼çå·¥ä½æ¹å¼å¹¶ä¸ä¸æ ·ãèå³ä½¿å¤ä¸ªå­å¨å¼ææ¯æåä¸ç§ç±»åçç´¢å¼ï¼å¶åºå±çå®ç°ä¹å¯è½ä¸åãä¸é¢ä»¥ innodb çä¸ºä¾ã\n\n\n# 2. innodb çç´¢å¼æ¨¡å\n\nå¨ innodb ä¸­ï¼è¡¨é½æ¯æ ¹æ®ä¸»é®é¡ºåºä»¥ç´¢å¼çå½¢å¼å­æ¾çï¼è¿ç§å­å¨æ¹å¼çè¡¨ç§°ä¸ºç´¢å¼ç»ç»è¡¨ãåå ä¸ºåé¢æä»¬æå°çï¼innodb ä½¿ç¨äº b+ æ ç´¢å¼æ¨¡åï¼æä»¥æ°æ®é½æ¯å­å¨å¨ b+ æ ä¸­çãæ¯ä¸ä¸ªç´¢å¼å¨ innodb éé¢å¯¹åºä¸æ£µ b+ æ ã\n\n> b+ æ è½å¤å¾å¥½å°éåç£ççè¯»åç¹æ§ï¼åå°åæ¬¡æ¥è¯¢çç£çè®¿é®æ¬¡æ°ã\n\nåè®¾ï¼æä»¬æä¸ä¸ªä¸»é®åä¸º id çè¡¨ï¼è¡¨ä¸­æå­æ®µ kï¼å¹¶ä¸å¨ k ä¸æç´¢å¼ãè¿æ ·çå»ºè¡¨è¯­å¥ä¸ºï¼\n\nmysql> create table t(\n    id int primary key,\n    k int not null,\n    name varchar(16),\n    index (k)) engine=innodb;\n\n\n1\n2\n3\n4\n5\n\n\nè¡¨ä¸­ r1~r5 ç (id,k) å¼åå«ä¸º (100,1)ã(200,2)ã(300,3)ã(500,5) å (600,6)ï¼ä¸¤æ£µæ çç¤ºä¾ç¤ºæå¾å¦ä¸ï¼\n\nä»å¾ä¸­ä¸é¾çåºï¼æ ¹æ®å¶å­èç¹çåå®¹ï¼ç´¢å¼ç±»ååä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ã\n\n * ä¸»é®ç´¢å¼ï¼å¶å­èç¹å­çæ¯æ´è¡æ°æ®ãå¨ innodb éï¼ä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºèç°ç´¢å¼ï¼clustered indexï¼ã\n * éä¸»é®ç´¢å¼ï¼å¶å­èç¹åå®¹æ¯ä¸»é®çå¼ãå¨ innodb éï¼éä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºäºçº§ç´¢å¼ï¼secondary indexï¼ã\n\n> å®éä¸ä¸»é¡µç´¢å¼ä¸­å­çæ¯å¯¹ä¸ä¸ªç£çé¡µç refãè¿ä¸é¨åå¯ç»å ddia æ¥å­¦ä¹ ã\n\næ ¹æ®ä¸é¢çç´¢å¼ç»æè¯´æï¼æä»¬æ¥è®¨è®ºä¸ä¸ªé®é¢ï¼åºäºä¸»é®ç´¢å¼åæ®éç´¢å¼çæ¥è¯¢æä»ä¹åºå«ï¼\n\n * å¦æè¯­å¥æ¯ select * from t where id=500ï¼å³ä¸»é®æ¥è¯¢æ¹å¼ï¼ååªéè¦æç´¢ id è¿æ£µ b+ æ ï¼\n * å¦æè¯­å¥æ¯ select * from t where k=5ï¼å³æ®éç´¢å¼æ¥è¯¢æ¹å¼ï¼åéè¦åæç´¢ k ç´¢å¼æ ï¼å¾å° id çå¼ä¸º 500ï¼åå° id ç´¢å¼æ æç´¢ä¸æ¬¡ãè¿ä¸ªè¿ç¨ç§°ä¸ºåè¡¨ã\n\nä¹å°±æ¯è¯´ï¼åºäºéä¸»é®ç´¢å¼çæ¥è¯¢éè¦å¤æ«æä¸æ£µç´¢å¼æ ãå æ­¤ï¼æä»¬å¨åºç¨ä¸­åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥è¯¢ã\n\n\n# 3.ç´¢å¼ç»´æ¤\n\nb+ æ ä¸ºäºç»´æ¤ç´¢å¼æåºæ§ï¼å¨æå¥æ°å¼çæ¶åéè¦åå¿è¦çç»´æ¤ã\n\n * ä»¥ä¸é¢è¿ä¸ªå¾ä¸ºä¾ï¼å¦ææå¥æ°çè¡ id å¼ä¸º 700ï¼ååªéè¦å¨ r5 çè®°å½åé¢æå¥ä¸ä¸ªæ°è®°å½ãå¦ææ°æå¥ç id å¼ä¸º 400ï¼å°±ç¸å¯¹éº»ç¦äºï¼éè¦é»è¾ä¸æªå¨åé¢çæ°æ®ï¼ç©ºåºä½ç½®ã\n * èæ´ç³çæåµæ¯ï¼å¦æ r5 æå¨çæ°æ®é¡µå·²ç»æ»¡äºï¼æ ¹æ® b+ æ çç®æ³ï¼è¿æ¶åéè¦ç³è¯·ä¸ä¸ªæ°çæ°æ®é¡µï¼ç¶åæªå¨é¨åæ°æ®è¿å»ãè¿ä¸ªè¿ç¨ç§°ä¸ºé¡µåè£ãå¨è¿ç§æåµä¸ï¼æ§è½èªç¶ä¼åå½±åã\n\né¤äºæ§è½å¤ï¼é¡µåè£æä½è¿å½±åæ°æ®é¡µçå©ç¨çãåæ¬æ¾å¨ä¸ä¸ªé¡µçæ°æ®ï¼ç°å¨åå°ä¸¤ä¸ªé¡µä¸­ï¼æ´ä½ç©ºé´å©ç¨çéä½å¤§çº¦ 50%ã\n\nå½ç¶æåè£å°±æåå¹¶ãå½ç¸é»ä¸¤ä¸ªé¡µç±äºå é¤äºæ°æ®ï¼å©ç¨çå¾ä½ä¹åï¼ä¼å°æ°æ®é¡µåé¡µåå¹¶ãåå¹¶çè¿ç¨ï¼å¯ä»¥è®¤ä¸ºæ¯åè£è¿ç¨çéè¿ç¨ã\n\nåºäºä¸é¢çç´¢å¼ç»´æ¤è¿ç¨è¯´æï¼æä»¬æ¥è®¨è®ºä¸ä¸ªæ¡ä¾ï¼ä½ å¯è½å¨ä¸äºå»ºè¡¨è§èéé¢è§å°è¿ç±»ä¼¼çæè¿°ï¼è¦æ±å»ºè¡¨è¯­å¥éä¸å®è¦æèªå¢ä¸»é®ãå½ç¶äºæ ç»å¯¹ï¼æä»¬æ¥åæä¸ä¸åªäºåºæ¯ä¸åºè¯¥ä½¿ç¨èªå¢ä¸»é®ï¼èåªäºåºæ¯ä¸ä¸åºè¯¥ã\n\nèªå¢ä¸»é®æ¯æèªå¢åä¸å®ä¹çä¸»é®ï¼å¨å»ºè¡¨è¯­å¥ä¸­ä¸è¬æ¯è¿ä¹å®ä¹çï¼ not null primary key auto_incrementã\n\næå¥æ°è®°å½çæ¶åå¯ä»¥ä¸æå® id çå¼ï¼ç³»ç»ä¼è·åå½å id æå¤§å¼å  1 ä½ä¸ºä¸ä¸æ¡è®°å½ç id å¼ãä¹å°±æ¯è¯´ï¼èªå¢ä¸»é®çæå¥æ°æ®æ¨¡å¼ï¼æ­£ç¬¦åäºæä»¬åé¢æå°çéå¢æå¥çåºæ¯ãæ¯æ¬¡æå¥ä¸æ¡æ°è®°å½ï¼é½æ¯è¿½å æä½ï¼é½ä¸æ¶åå°æªå¨å¶ä»è®°å½ï¼ä¹ä¸ä¼è§¦åå¶å­èç¹çåè£ã\n\nèæä¸å¡é»è¾çå­æ®µåä¸»é®ï¼åå¾å¾ä¸å®¹æä¿è¯æåºæå¥ï¼è¿æ ·åæ°æ®ææ¬ç¸å¯¹è¾é«ã\n\né¤äºèèæ§è½å¤ï¼æä»¬è¿å¯ä»¥ä»å­å¨ç©ºé´çè§åº¦æ¥çãâ åè®¾ä½ çè¡¨ä¸­ç¡®å®æä¸ä¸ªå¯ä¸å­æ®µï¼æ¯å¦å­ç¬¦ä¸²ç±»åçèº«ä»½è¯å·ï¼é£åºè¯¥ç¨èº«ä»½è¯å·åä¸»é®ï¼è¿æ¯ç¨èªå¢å­æ®µåä¸»é®å¢ï¼\n\nç±äºæ¯ä¸ªéä¸»é®ç´¢å¼çå¶å­èç¹ä¸é½æ¯ä¸»é®çå¼ãå¦æç¨èº«ä»½è¯å·åä¸»é®ï¼é£ä¹æ¯ä¸ªäºçº§ç´¢å¼çå¶å­èç¹å ç¨çº¦ 20 ä¸ªå­èï¼èå¦æç¨æ´ååä¸»é®ï¼ååªè¦ 4 ä¸ªå­èï¼å¦ææ¯é¿æ´åï¼bigintï¼åæ¯ 8 ä¸ªå­èãæ¾ç¶ï¼ä¸»é®é¿åº¦è¶å°ï¼æ®éç´¢å¼çå¶å­èç¹å°±è¶å°ï¼æ®éç´¢å¼å ç¨çç©ºé´ä¹å°±è¶å°ãæä»¥ï¼ä»æ§è½åå­å¨ç©ºé´æ¹é¢èéï¼èªå¢ä¸»é®å¾å¾æ¯æ´åççéæ©ã\n\nâ ææ²¡æä»ä¹åºæ¯éåç¨ä¸å¡å­æ®µç´æ¥åä¸»é®çå¢ï¼è¿æ¯æçãæ¯å¦ï¼æäºä¸å¡çåºæ¯éæ±æ¯è¿æ ·çï¼\n\n 1. åªæä¸ä¸ªç´¢å¼ï¼\n 2. è¯¥ç´¢å¼å¿é¡»æ¯å¯ä¸ç´¢å¼ã\n\nè¿å°±æ¯å¸åç kv åºæ¯ãç±äºæ²¡æå¶ä»ç´¢å¼ï¼æä»¥ä¹å°±ä¸ç¨èèå¶ä»ç´¢å¼çå¶å­èç¹å¤§å°çé®é¢ãè¿æ¶åæä»¬å°±è¦ä¼åèèä¸ä¸æ®µæå°çâå°½éä½¿ç¨ä¸»é®æ¥è¯¢âååï¼ç´æ¥å°è¿ä¸ªç´¢å¼è®¾ç½®ä¸ºä¸»é®ï¼å¯ä»¥é¿åæ¯æ¬¡æ¥è¯¢éè¦æç´¢ä¸¤æ£µæ ã\n\næä»¥ï¼ç±äº innodb æ¯ç´¢å¼ç»ç»è¡¨ï¼ä¸è¬æåµä¸æä¼å»ºè®®ä½ åå»ºä¸ä¸ªèªå¢ä¸»é®ï¼è¿æ ·éä¸»é®ç´¢å¼å ç¨çç©ºé´æå°ãä½äºæ ç»å¯¹ï¼æä¹è·ä½ è®¨è®ºäºä½¿ç¨ä¸å¡é»è¾å­æ®µåä¸»é®çåºç¨åºæ¯ã\n\n\n# 4. å¸¦ç´¢å¼çæ¥è¯¢ä¼å\n\næä»¬åçä¸ä¸ªé®é¢ï¼å¨ä¸é¢è¿ä¸ªè¡¨ t ä¸­ï¼å¦æææ§è¡ select * from t where k between 3 and 5ï¼éè¦æ§è¡å æ¬¡æ çæç´¢æä½ï¼ä¼æ«æå¤å°è¡ï¼\n\nmysql> create table t (\n    id int primary key,\n    k int not null default 0,\n    s varchar(16) not null default '',\n    index k(k)) engine=innodb;\n\ninsert into t values \n  (100,1, 'aa'),\n  (200,2,'bb'),\n  (300,3,'cc'),\n  (500,5,'ee'),\n  (600,6,'ff'),\n  (700,7,'gg');\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nä¸é¢æ¯ innodb çç´¢å¼ç»ç»ç»æï¼\n\nç°å¨ï¼æä»¬ä¸èµ·æ¥ççè¿æ¡ sql æ¥è¯¢è¯­å¥çæ§è¡æµç¨ï¼\n\n 1. å¨ k ç´¢å¼æ ä¸æ¾å° k=3 çè®°å½ï¼åå¾ id = 300ï¼\n 2. åå° id ç´¢å¼æ æ¥å° id=300 å¯¹åºç r3ï¼\n 3. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=5ï¼åå¾ id=500ï¼\n 4. ååå° id ç´¢å¼æ æ¥å° id=500 å¯¹åºç r4ï¼\n 5. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=6ï¼ä¸æ»¡è¶³æ¡ä»¶ï¼å¾ªç¯ç»æã\n\nå¨è¿ä¸ªè¿ç¨ä¸­ï¼åå°ä¸»é®ç´¢å¼æ æç´¢çè¿ç¨ï¼æä»¬ç§°ä¸ºåè¡¨ãå¯ä»¥çå°ï¼è¿ä¸ªæ¥è¯¢è¿ç¨è¯»äº k ç´¢å¼æ ç 3 æ¡è®°å½ï¼æ­¥éª¤ 1ã3 å 5ï¼ï¼åè¡¨äºä¸¤æ¬¡ï¼æ­¥éª¤ 2 å 4ï¼ã\n\nå¨è¿ä¸ªä¾å­ä¸­ï¼ç±äºæ¥è¯¢ç»ææéè¦çæ°æ®åªå¨ä¸»é®ç´¢å¼ä¸æï¼æä»¥ä¸å¾ä¸åè¡¨ãé£ä¹ï¼ææ²¡æå¯è½ç»è¿ç´¢å¼ä¼åï¼é¿ååè¡¨è¿ç¨å¢ï¼\n\n\n# 4.1 è¦çç´¢å¼\n\nå¦ææ§è¡çè¯­å¥æ¯ select id from t where k between 3 and 5ï¼è¿æ¶åªéè¦æ¥ id çå¼ï¼è id çå¼å·²ç»å¨ k ç´¢å¼æ ä¸äºï¼å æ­¤å¯ä»¥ç´æ¥æä¾æ¥è¯¢ç»æï¼ä¸éè¦åè¡¨ãä¹å°±æ¯è¯´ï¼å¨è¿ä¸ªæ¥è¯¢éé¢ï¼ç´¢å¼ k å·²ç»âè¦çäºâæä»¬çæ¥è¯¢éæ±ï¼æä»¬ç§°ä¸ºè¦çç´¢å¼ã\n\nç±äºè¦çç´¢å¼å¯ä»¥åå°æ çæç´¢æ¬¡æ°ï¼æ¾èæåæ¥è¯¢æ§è½ï¼æä»¥ä½¿ç¨è¦çç´¢å¼æ¯ä¸ä¸ªå¸¸ç¨çæ§è½ä¼åææ®µã\n\n> éè¦æ³¨æçæ¯ï¼å¨å¼æåé¨ä½¿ç¨è¦çç´¢å¼å¨ç´¢å¼ k ä¸å¶å®è¯»äºä¸ä¸ªè®°å½ï¼r3~r5ï¼å¯¹åºçç´¢å¼ k ä¸çè®°å½é¡¹ï¼ï¼ä½æ¯å¯¹äº mysql ç server å±æ¥è¯´ï¼å®å°±æ¯æ¾å¼ææ¿å°äºä¸¤æ¡è®°å½ï¼å æ­¤ mysql è®¤ä¸ºæ«æè¡æ°æ¯ 2ã\n\nåºäºä¸é¢è¦çç´¢å¼çè¯´æï¼æä»¬æ¥è®¨è®ºä¸ä¸ªé®é¢ï¼å¨ä¸ä¸ªå¸æ°ä¿¡æ¯è¡¨ä¸ï¼æ¯å¦æå¿è¦å°èº«ä»½è¯å·ååå­å»ºç«èåç´¢å¼ï¼åè®¾è¿ä¸ªå¸æ°è¡¨çå®ä¹æ¯è¿æ ·çï¼\n\n\ncreate table `tuser` (\n  `id` int(11) not null,\n  `id_card` varchar(32) default null,\n  `name` varchar(32) default null,\n  `age` int(11) default null,\n  `ismale` tinyint(1) default null,\n  primary key (`id`),\n  key `id_card` (`id_card`),\n  key `name_age` (`name`,`age`)\n) engine=innodb\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næä»¬ç¥éï¼èº«ä»½è¯å·æ¯å¸æ°çå¯ä¸æ è¯ãä¹å°±æ¯è¯´ï¼å¦æææ ¹æ®èº«ä»½è¯å·æ¥è¯¢å¸æ°ä¿¡æ¯çéæ±ï¼æä»¬åªè¦å¨èº«ä»½è¯å·å­æ®µä¸å»ºç«ç´¢å¼å°±å¤äºãèåå»ºç«ä¸ä¸ªï¼èº«ä»½è¯å·ãå§åï¼çèåç´¢å¼ï¼æ¯ä¸æ¯æµªè´¹ç©ºé´ï¼\n\nå¦æç°å¨æä¸ä¸ªé«é¢è¯·æ±ï¼è¦æ ¹æ®å¸æ°çèº«ä»½è¯å·æ¥è¯¢ä»çå§åï¼è¿ä¸ªèåç´¢å¼å°±ææä¹äºãå®å¯ä»¥å¨è¿ä¸ªé«é¢è¯·æ±ä¸ç¨å°è¦çç´¢å¼ï¼ä¸åéè¦åè¡¨æ¥æ´è¡è®°å½ï¼åå°è¯­å¥çæ§è¡æ¶é´ãæä»¥ï¼åå©èåç´¢å¼æå®ç°çç´¢å¼åä½å¯ä»¥æ¯æè¦çç´¢å¼ï¼ä»èä¼åæ¥è¯¢æ§è½ã\n\nå½ç¶ï¼ç´¢å¼å­æ®µçç»´æ¤æ»æ¯æä»£ä»·çãå æ­¤ï¼å¨å»ºç«åä½ç´¢å¼æ¥æ¯æè¦çç´¢å¼æ¶å°±éè¦æè¡¡èèäºãè¿æ­£æ¯ä¸å¡ dbaï¼æèç§°ä¸ºä¸å¡æ°æ®æ¶æå¸çå·¥ä½ã\n\n\n# 4.2 æå·¦åç¼åå\n\nçå°è¿éä½ ä¸å®æä¸ä¸ªçé®ï¼å¦æä¸ºæ¯ä¸ç§æ¥è¯¢é½è®¾è®¡ä¸ä¸ªç´¢å¼ï¼ç´¢å¼æ¯ä¸æ¯å¤ªå¤äºãå¦ææç°å¨è¦æç§å¸æ°çèº«ä»½è¯å·å»æ¥ä»çå®¶åº­å°åå¢ï¼è½ç¶è¿ä¸ªæ¥è¯¢éæ±å¨ä¸å¡ä¸­åºç°çæ¦çä¸é«ï¼ä½æ»ä¸è½è®©å®èµ°å¨è¡¨æ«æå§ï¼åè¿æ¥è¯´ï¼åç¬ä¸ºä¸ä¸ªä¸é¢ç¹çè¯·æ±åå»ºä¸ä¸ªï¼èº«ä»½è¯å·ï¼å°åï¼çç´¢å¼åæè§æç¹æµªè´¹ãåºè¯¥æä¹åå¢ï¼\n\nè¿éç´æ¥è¯´ç»è®ºå§ï¼b+ æ è¿ç§ç´¢å¼ç»æï¼å¯ä»¥å©ç¨ç´¢å¼çâæå·¦åç¼âï¼æ¥å®ä½è®°å½ã\n\nä¸ºäºç´è§å°è¯´æè¿ä¸ªæ¦å¿µï¼æä»¬ç¨ï¼nameï¼ageï¼è¿ä¸ªèåç´¢å¼æ¥åæï¼\n\nå¯ä»¥çå°ï¼ç´¢å¼é¡¹æ¯æç§ç´¢å¼å®ä¹éé¢åºç°çå­æ®µé¡ºåºæåºçï¼å³ä¼åæâå§åâæ¥æåºã\n\n * å½ä½ çé»è¾éæ±æ¯æ¥å°ææåå­æ¯âå¼ ä¸âçäººæ¶ï¼å¯ä»¥å¿«éå®ä½å° id4ï¼ç¶åååéåå¾å°ææéè¦çç»æã\n * å¦æä½ è¦æ¥çæ¯ææåå­ç¬¬ä¸ä¸ªå­æ¯âå¼ âçäººï¼ä½ ç sql è¯­å¥çæ¡ä»¶æ¯\"where name like âå¼  %â\"ãè¿æ¶ï¼ä½ ä¹è½å¤ç¨ä¸è¿ä¸ªç´¢å¼ï¼æ¥æ¾å°ç¬¬ä¸ä¸ªç¬¦åæ¡ä»¶çè®°å½æ¯ id3ï¼ç¶åååéåï¼ç´å°ä¸æ»¡è¶³æ¡ä»¶ä¸ºæ­¢ã\n\nå¯ä»¥çå°ï¼ä¸åªæ¯ç´¢å¼çå¨é¨å®ä¹ï¼åªè¦æ»¡è¶³æå·¦åç¼ï¼å°±å¯ä»¥å©ç¨ç´¢å¼æ¥å éæ£ç´¢ãè¿ä¸ªæå·¦åç¼å¯ä»¥æ¯èåç´¢å¼çæå·¦ n ä¸ªå­æ®µï¼ä¹å¯ä»¥æ¯å­ç¬¦ä¸²ç´¢å¼çæå·¦ m ä¸ªå­ç¬¦ã\n\nåºäºä¸é¢å¯¹æå·¦åç¼ç´¢å¼çè¯´æï¼æä»¬æ¥è®¨è®ºä¸ä¸ªé®é¢ï¼å¨å»ºç«èåç´¢å¼çæ¶åï¼å¦ä½å®æç´¢å¼åçå­æ®µé¡ºåºâ\n\nè¿éæä»¬çè¯ä¼°æ åæ¯ï¼ç´¢å¼çå¤ç¨è½åãå ä¸ºå¯ä»¥æ¯ææå·¦åç¼ï¼æä»¥å½å·²ç»æäº (a,b) è¿ä¸ªèåç´¢å¼åï¼ä¸è¬å°±ä¸éè¦åç¬å¨ a ä¸å»ºç«ç´¢å¼äºãå æ­¤ï¼ç¬¬ä¸ååæ¯ï¼å¦æéè¿è°æ´é¡ºåºï¼å¯ä»¥å°ç»´æ¤ä¸ä¸ªç´¢å¼ï¼é£ä¹è¿ä¸ªé¡ºåºå¾å¾å°±æ¯éè¦ä¼åèèéç¨çã\n\næä»¥ç°å¨ä½ ç¥éäºï¼è¿æ®µå¼å¤´çé®é¢éï¼æä»¬è¦ä¸ºé«é¢è¯·æ±åå»º (èº«ä»½è¯å·ï¼å§åï¼è¿ä¸ªèåç´¢å¼ï¼å¹¶ç¨è¿ä¸ªç´¢å¼æ¥åæ¶æ¯æâæ ¹æ®èº«ä»½è¯å·æ¥è¯¢å°åâçéæ±ã\n\né£ä¹ï¼å¦ææ¢æèåæ¥è¯¢ï¼åæåºäº aãb åèªçæ¥è¯¢å¢ï¼æ¥è¯¢æ¡ä»¶éé¢åªæ b çè¯­å¥ï¼æ¯æ æ³ä½¿ç¨ (a,b) è¿ä¸ªèåç´¢å¼çï¼è¿æ¶åä½ ä¸å¾ä¸ç»´æ¤å¦å¤ä¸ä¸ªç´¢å¼ï¼ä¹å°±æ¯è¯´ä½ éè¦åæ¶ç»´æ¤ (a,b)ã(b) è¿ä¸¤ä¸ªç´¢å¼ãè¿æ¶åï¼æä»¬è¦èèçååå°±æ¯ç©ºé´äºãæ¯å¦ä¸é¢è¿ä¸ªå¸æ°è¡¨çæåµï¼name å­æ®µæ¯æ¯ age å­æ®µå¤§ç ï¼é£æå°±å»ºè®®ä½ åå»ºä¸ä¸ªï¼name,age) çèåç´¢å¼åä¸ä¸ª (age) çåå­æ®µç´¢å¼ã\n\næä»¥å¯ä»¥çå°ï¼è¦ä¸è¦å»ºç«èåç´¢å¼ï¼ä»¥ææ ·çé¡ºåºæ¥å»ºç«èåç´¢å¼ï¼é½æ¯è¦æ ¹æ®ä¸å¡åºæ¯æ¥å³å®çã\n\n\n# 4.3 ç´¢å¼ä¸æ¨\n\nä¸ä¸æ®µæä»¬è¯´å°æ»¡è¶³æå·¦åç¼ååçæ¶åï¼æå·¦åç¼å¯ä»¥ç¨äºå¨ç´¢å¼ä¸­å®ä½è®°å½ãè¿æ¶ï¼ä½ å¯è½è¦é®ï¼é£äºä¸ç¬¦åæå·¦åç¼çé¨åï¼ä¼æä¹æ ·å¢ï¼\n\næä»¬è¿æ¯ä»¥å¸æ°è¡¨çèåç´¢å¼ï¼name, ageï¼ä¸ºä¾ãå¦æç°å¨æä¸ä¸ªéæ±ï¼æ£ç´¢åºè¡¨ä¸­âåå­ç¬¬ä¸ä¸ªå­æ¯å¼ ï¼èä¸å¹´é¾æ¯ 10 å²çææç·å­©âãé£ä¹ï¼sql è¯­å¥æ¯è¿ä¹åçï¼\n\nmysql> select * from tuser where name like 'å¼ %' and age=10 and ismale=1;\n\n\n1\n\n\nä½ å·²ç»ç¥éäºåç¼ç´¢å¼è§åï¼æä»¥è¿ä¸ªè¯­å¥å¨æç´¢ç´¢å¼æ çæ¶åï¼åªè½ç¨ âå¼ âï¼æ¾å°ç¬¬ä¸ä¸ªæ»¡è¶³æ¡ä»¶çè®°å½ id3ãå½ç¶ï¼è¿è¿ä¸éï¼æ»æ¯å¨è¡¨æ«æè¦å¥½ã\n\nç¶åå¢ï¼å½ç¶æ¯å¤æ­å¶ä»æ¡ä»¶æ¯å¦æ»¡è¶³ï¼\n\n * å¨ mysql 5.6 ä¹åï¼åªè½ä» id3 å¼å§ä¸ä¸ªä¸ªåè¡¨ãå°ä¸»é®ç´¢å¼ä¸æ¾åºæ°æ®è¡ï¼åå¯¹æ¯å­æ®µå¼ã\n * è mysql 5.6 å¼å¥çç´¢å¼ä¸æ¨ä¼åï¼index condition pushdown)ï¼ å¯ä»¥å¨ç´¢å¼éåè¿ç¨ä¸­ï¼å¯¹ç´¢å¼ä¸­åå«çå­æ®µååå¤æ­ï¼ç´æ¥è¿æ»¤æä¸æ»¡è¶³æ¡ä»¶çè®°å½ï¼åå°åè¡¨æ¬¡æ°ã\n\nå¯è½ä¸é¢çè¯´æ³æ¯è¾æ½è±¡ï¼ä¸é¢ä¸¾ä¸ä¸ªå®éä¾å­ãä¸é¢æ¯ä¸¤ä¸ªæ§è¡è¿ç¨çæµç¨å¾ï¼\n\n * æ ç´¢å¼ä¸æ¨æ§è¡æµç¨ï¼\n\n * ç´¢å¼ä¸æ¨æ§è¡æµç¨ï¼\n\nä¸å¾ä¸­ï¼æ¯ä¸ä¸ªèçº¿ç®­å¤´è¡¨ç¤ºåè¡¨ä¸æ¬¡ã\n\nå¨æ ç´¢å¼ä¸æ¨æ§è¡æµç¨å¾ä¸­ï¼å¨ (name,age) ç´¢å¼éé¢æç¹æå»æäº age çå¼ï¼è¿ä¸ªè¿ç¨ innodb å¹¶ä¸ä¼å»ç age çå¼ï¼åªæ¯æé¡ºåºæâname ç¬¬ä¸ä¸ªå­æ¯âå¼ ââçè®°å½ä¸æ¡æ¡ååºæ¥åè¡¨ãå æ­¤ï¼éè¦åè¡¨ 4 æ¬¡ã\n\nå¨ç´¢å¼ä¸æ¨æ§è¡æµç¨ä¸­ï¼nnodb å¨ (name,age) ç´¢å¼åé¨å°±å¤æ­äº age æ¯å¦ç­äº 10ï¼å¯¹äºä¸ç­äº 10 çè®°å½ï¼ç´æ¥å¤æ­å¹¶è·³è¿ãå¨æä»¬çè¿ä¸ªä¾å­ä¸­ï¼åªéè¦å¯¹ id4ãid5 è¿ä¸¤æ¡è®°å½åè¡¨åæ°æ®å¤æ­ï¼å°±åªéè¦åè¡¨ 2 æ¬¡ã\n\n\n# summary\n\nå¨æ»¡è¶³è¯­å¥éæ±çæåµä¸ï¼ å°½éå°å°è®¿é®èµæºæ¯æ°æ®åºè®¾è®¡çéè¦ååä¹ä¸ãæä»¬å¨ä½¿ç¨æ°æ®åºçæ¶åï¼å°¤å¶æ¯å¨è®¾è®¡è¡¨ç»ææ¶ï¼ä¹è¦ä»¥åå°èµæºæ¶èä½ä¸ºç®æ ã\n\n\n# qa\n\nä¸ä¸ªé®é¢ãå¯¹äºç¬¬ 2 å¤§èä¸­çä¾å­ä¸­ç innodb è¡¨ tï¼å¦æä½ è¦éå»ºç´¢å¼ kï¼ä½ çä¸¤ä¸ª sql è¯­å¥å¯ä»¥è¿ä¹åï¼\n\nalter table t drop index k;\nalter table t add index(k);\n\n\n1\n2\n\n\nå¦æä½ è¦éå»ºä¸»é®ç´¢å¼ï¼ä¹å¯ä»¥è¿ä¹åï¼\n\nalter table t drop primary key;\nalter table t add primary key(id);\n\n\n1\n2\n\n\né®é¢æ¯ï¼å¯¹äºä¸é¢è¿ä¸¤ä¸ªéå»ºç´¢å¼çä½æ³ï¼è¯´åºä½ ççè§£ãå¦ææä¸åéçï¼ä¸ºä»ä¹ï¼æ´å¥½çæ¹æ³æ¯ä»ä¹ï¼\n\nåèç­æ¡ï¼éå»ºç´¢å¼ k çåæ³æ¯åççï¼å¯ä»¥è¾¾å°çç©ºé´çç®çãå ä¸º innodb å¼æå¨å é¤äºè¡¨çé¨åè®°å½åï¼ä½æ¯å®çç´¢å¼è¿å¨ï¼å¹¶æªéæ¾ãä½æ¯ï¼éå»ºä¸»é®çè¿ç¨ä¸åçãä¸è®ºæ¯å é¤ä¸»é®è¿æ¯åå»ºä¸»é®ï¼é½ä¼å°æ´ä¸ªè¡¨éå»ºãæä»¥è¿çæ§è¡è¿ä¸¤ä¸ªè¯­å¥çè¯ï¼ç¬¬ä¸ä¸ªè¯­å¥å°±ç½åäºãè¿ä¸¤ä¸ªè¯­å¥ï¼ä½ å¯ä»¥ç¨è¿ä¸ªè¯­å¥ä»£æ¿ ï¼ alter table t engine=innodb",charsets:{cjk:!0},lastUpdated:"2023/05/19, 13:07:07",lastUpdatedTimestamp:1684501627e3},{title:"å¨å±éãè¡¨çº§éåè¡é",frontmatter:{title:"å¨å±éãè¡¨çº§éåè¡é",date:"2023-05-19T15:06:00.000Z",permalink:"/pages/376254/",categories:["ä¸­é´ä»¶","MySQL","ä¸æ ï¼MySQL å®æ 45 è®²"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/06.MySQL/05.%E4%B8%93%E6%A0%8F%EF%BC%9AMySQL%20%E5%AE%9E%E6%88%98%2045%20%E8%AE%B2/05.%E5%85%A8%E5%B1%80%E9%94%81%E3%80%81%E8%A1%A8%E7%BA%A7%E9%94%81%E5%92%8C%E8%A1%8C%E9%94%81.html",relativePath:"ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/05.å¨å±éãè¡¨çº§éåè¡é.md",key:"v-2c529f3a",path:"/pages/376254/",headers:[{level:2,title:"1. å¨å±é",slug:"_1-å¨å±é",normalizedTitle:"1. å¨å±é",charIndex:255},{level:3,title:"1.1 ä»ä¹æ¯å¨å±é",slug:"_1-1-ä»ä¹æ¯å¨å±é",normalizedTitle:"1.1 ä»ä¹æ¯å¨å±é",charIndex:266},{level:2,title:"1.2 å¤ä»½ä¸ºä»ä¹è¦å éï¼",slug:"_1-2-å¤ä»½ä¸ºä»ä¹è¦å é",normalizedTitle:"1.2 å¤ä»½ä¸ºä»ä¹è¦å éï¼",charIndex:669},{level:3,title:"1.3 å¨å±å éçæ¹æ³",slug:"_1-3-å¨å±å éçæ¹æ³",normalizedTitle:"1.3 å¨å±å éçæ¹æ³",charIndex:1035},{level:4,title:"1.3.1 å¼å¯äºå¡ï¼single-transaction æ¹æ³ï¼",slug:"_1-3-1-å¼å¯äºå¡-single-transaction-æ¹æ³",normalizedTitle:"1.3.1 å¼å¯äºå¡ï¼single-transaction æ¹æ³ï¼",charIndex:1050},{level:4,title:"1.3.2 set global readonly=true æ¹å¼ vs FTWRL æ¹å¼",slug:"_1-3-2-set-global-readonly-true-æ¹å¼-vs-ftwrl-æ¹å¼",normalizedTitle:"1.3.2 set global readonly=true æ¹å¼ vs ftwrl æ¹å¼",charIndex:1536},{level:3,title:"1.4 å°ç»",slug:"_1-4-å°ç»",normalizedTitle:"1.4 å°ç»",charIndex:2074},{level:2,title:"2. è¡¨çº§é",slug:"_2-è¡¨çº§é",normalizedTitle:"2. è¡¨çº§é",charIndex:2159},{level:3,title:"2.1 lock tables",slug:"_2-1-lock-tables",normalizedTitle:"2.1 lock tables",charIndex:2223},{level:3,title:"2.2 MDL",slug:"_2-2-mdl",normalizedTitle:"2.2 mdl",charIndex:2630},{level:3,title:"2.3 å°ç»",slug:"_2-3-å°ç»",normalizedTitle:"2.3 å°ç»",charIndex:4288},{level:2,title:"3. è¡é",slug:"_3-è¡é",normalizedTitle:"3. è¡é",charIndex:4518},{level:3,title:"3.1 ä»ä¸¤é¶æ®µéè¯´èµ·",slug:"_3-1-ä»ä¸¤é¶æ®µéè¯´èµ·",normalizedTitle:"3.1 ä»ä¸¤é¶æ®µéè¯´èµ·",charIndex:4869},{level:3,title:"3.2 æ­»éåæ­»éæ£æµ",slug:"_3-2-æ­»éåæ­»éæ£æµ",normalizedTitle:"3.2 æ­»éåæ­»éæ£æµ",charIndex:5883},{level:3,title:"3.3 å°ç»",slug:"_3-3-å°ç»",normalizedTitle:"3.3 å°ç»",charIndex:7702},{level:2,title:"QA",slug:"qa",normalizedTitle:"qa",charIndex:7952}],headersStr:"1. å¨å±é 1.1 ä»ä¹æ¯å¨å±é 1.2 å¤ä»½ä¸ºä»ä¹è¦å éï¼ 1.3 å¨å±å éçæ¹æ³ 1.3.1 å¼å¯äºå¡ï¼single-transaction æ¹æ³ï¼ 1.3.2 set global readonly=true æ¹å¼ vs FTWRL æ¹å¼ 1.4 å°ç» 2. è¡¨çº§é 2.1 lock tables 2.2 MDL 2.3 å°ç» 3. è¡é 3.1 ä»ä¸¤é¶æ®µéè¯´èµ· 3.2 æ­»éåæ­»éæ£æµ 3.3 å°ç» QA",content:"> åèï¼\n> \n>  * 06 | å¨å±éåè¡¨é ï¼ç»è¡¨å ä¸ªå­æ®µæä¹æè¿ä¹å¤é»ç¢ï¼| æå®¢æ¶é´\n>  * 07 | è¡éåè¿ï¼æä¹åå°è¡éå¯¹æ§è½çå½±åï¼| æå®¢æ¶é´\n\næ°æ®åºéè®¾è®¡çåè¡·æ¯å¤çå¹¶åé®é¢ãä½ä¸ºå¤ç¨æ·å±äº«çèµæºï¼å½åºç°å¹¶åè®¿é®çæ¶åï¼æ°æ®åºéè¦åçå°æ§å¶èµæºçè®¿é®è§åãèéå°±æ¯ç¨æ¥å®ç°è¿äºè®¿é®è§åçéè¦æ°æ®ç»æã\n\næ ¹æ®å éçèå´ï¼MySQL éé¢çéå¤§è´å¯ä»¥åæå¨å±éãè¡¨çº§éåè¡éä¸ç±»ãç±äºéçè®¾è®¡æ¯è¾å¤æï¼è¿éä¸ä¼æ¶åéçå·ä½å®ç°ç»èï¼ä¸»è¦ä»ç»çæ¯ç¢°å°éæ¶çç°è±¡åå¶èåçåçã\n\n\n# 1. å¨å±é\n\n\n# 1.1 ä»ä¹æ¯å¨å±é\n\nå¨å±éå°±æ¯å¯¹æ´ä¸ªæ°æ®åºå®ä¾å éãMySQL æä¾äºä¸ä¸ªå å¨å±è¯»éçæ¹æ³ï¼å½ä»¤æ¯ Flush tables with read lock (FTWRL)ãå½ä½ éè¦è®©æ´ä¸ªåºå¤äºåªè¯»ç¶æçæ¶åï¼å¯ä»¥ä½¿ç¨è¿ä¸ªå½ä»¤ï¼ä¹åå¶ä»çº¿ç¨çä»¥ä¸è¯­å¥ä¼è¢«é»å¡ï¼æ°æ®æ´æ°è¯­å¥ï¼æ°æ®çå¢å æ¹ï¼ãæ°æ®å®ä¹è¯­å¥ï¼åæ¬å»ºè¡¨ãä¿®æ¹è¡¨ç»æç­ï¼åæ´æ°ç±»äºå¡çæäº¤è¯­å¥ã\n\nå¨å±éçå¸åä½¿ç¨åºæ¯æ¯ï¼åå¨åºé»è¾å¤ä»½ãä¹å°±æ¯ææ´åºæ¯ä¸ªè¡¨é½ select åºæ¥å­æææ¬ã\n\nä»¥åæä¸ç§åæ³ï¼æ¯éè¿ FTWRL ç¡®ä¿ä¸ä¼æå¶ä»çº¿ç¨å¯¹æ°æ®åºåæ´æ°ï¼ç¶åå¯¹æ´ä¸ªåºåå¤ä»½ãæ³¨æï¼å¨å¤ä»½è¿ç¨ä¸­æ´ä¸ªåºå®å¨å¤äºåªè¯»ç¶æãä½æ¯è®©æ´åºé½åªè¯»ï¼å¬ä¸å»å°±å¾å±é©ï¼\n\n * å¦æä½ å¨ä¸»åºä¸å¤ä»½ï¼é£ä¹å¨å¤ä»½æé´é½ä¸è½æ§è¡æ´æ°ï¼ä¸å¡åºæ¬ä¸å°±å¾åæï¼\n * å¦æä½ å¨ä»åºä¸å¤ä»½ï¼é£ä¹å¤ä»½æé´ä»åºä¸è½æ§è¡ä¸»åºåæ­¥è¿æ¥ç binlogï¼ä¼å¯¼è´ä¸»ä»å»¶è¿ã\n\n\n# 1.2 å¤ä»½ä¸ºä»ä¹è¦å éï¼\n\nçæ¥å å¨å±éä¸å¤ªå¥½ãä½æ¯ç»æ³ä¸ä¸ï¼å¤ä»½ä¸ºä»ä¹è¦å éå¢â æä»¬æ¥çä¸ä¸ä¸å éä¼æä»ä¹é®é¢ã\n\nç°å¨åèµ·ä¸ä¸ªé»è¾å¤ä»½ãåè®¾å¤ä»½æé´ï¼æä¸ä¸ªç¨æ·ï¼ä»è´­ä¹°äºä¸é¨è¯¾ç¨ï¼ä¸å¡é»è¾éå°±è¦æ£æä»çä½é¢ï¼ç¶åå¾å·²è´­è¯¾ç¨éé¢å ä¸ä¸é¨è¯¾ãå¦ææ¶é´é¡ºåºä¸æ¯åå¤ä»½è´¦æ·ä½é¢è¡¨ (u_account)ï¼ç¶åç¨æ·è´­ä¹°ï¼ç¶åå¤ä»½ç¨æ·è¯¾ç¨è¡¨ (u_course)ï¼ä¼æä¹æ ·å¢ï¼ä½ å¯ä»¥çä¸ä¸è¿ä¸ªå¾ï¼\n\nå¯ä»¥çå°ï¼è¿ä¸ªå¤ä»½ç»æéï¼ç¨æ· A çæ°æ®ç¶ææ¯âè´¦æ·ä½é¢æ²¡æ£ï¼ä½æ¯ç¨æ·è¯¾ç¨è¡¨éé¢å·²ç»å¤äºä¸é¨è¯¾âãå¦æåé¢ç¨è¿ä¸ªå¤ä»½æ¥æ¢å¤æ°æ®çè¯ï¼ç¨æ· A å°±åç°ï¼èªå·±èµäºãå¦æå¤ä»½è¡¨çé¡ºåºåè¿æ¥ï¼åå¤ä»½ç¨æ·è¯¾ç¨è¡¨åå¤ä»½è´¦æ·ä½é¢è¡¨ï¼é£ç¨æ·å°±äºäºã\n\nä¹å°±æ¯è¯´ï¼ä¸å éçè¯ï¼å¤ä»½ç³»ç»å¤ä»½çå¾å°çåºä¸æ¯ä¸ä¸ªé»è¾æ¶é´ç¹ï¼è¿ä¸ªè§å¾æ¯é»è¾ä¸ä¸è´çã\n\n\n# 1.3 å¨å±å éçæ¹æ³\n\n# 1.3.1 å¼å¯äºå¡ï¼single-transaction æ¹æ³ï¼\n\nè¯´å°è§å¾ä½ è¯å®æ³èµ·æ¥äºï¼æä»¬å¨åé¢è®²äºå¡éç¦»çæ¶åï¼å¶å®æ¯æä¸ä¸ªæ¹æ³è½å¤æ¿å°ä¸è´æ§è§å¾çï¼å¯¹å§ï¼æ¯çï¼å°±æ¯å¨å¯éå¤è¯»éç¦»çº§å«ä¸å¼å¯ä¸ä¸ªäºå¡ã\n\nå®æ¹èªå¸¦çé»è¾å¤ä»½å·¥å·æ¯ mysqldumpãå½ mysqldump ä½¿ç¨åæ° -single-transaction çæ¶åï¼å¯¼æ°æ®ä¹åå°±ä¼å¯å¨ä¸ä¸ªäºå¡ï¼æ¥ç¡®ä¿æ¿å°ä¸è´æ§è§å¾ãèç±äº MVCC çæ¯æï¼è¿ä¸ªè¿ç¨ä¸­æ°æ®æ¯å¯ä»¥æ­£å¸¸æ´æ°çã\n\nä½ ä¸å®å¨çæï¼æäºè¿ä¸ªåè½ï¼ä¸ºä»ä¹è¿éè¦ FTWRL å¢ï¼ä¸è´æ§è¯»æ¯å¥½ï¼ä½åææ¯å¼æè¦æ¯æè¿ä¸ªéç¦»çº§å«ãæ¯å¦ï¼å¯¹äº MyISAM è¿ç§ä¸æ¯æäºå¡çå¼æï¼å¦æå¤ä»½è¿ç¨ä¸­ææ´æ°ï¼æ»æ¯åªè½åå°ææ°çæ°æ®ï¼é£ä¹å°±ç ´åäºå¤ä»½çä¸è´æ§ãè¿æ¶ï¼æä»¬å°±éè¦ä½¿ç¨ FTWRL å½ä»¤äºã\n\næä»¥ï¼single-transaction æ¹æ³åªéç¨äºææçè¡¨ä½¿ç¨äºå¡å¼æçåºãå¦ææçè¡¨ä½¿ç¨äºä¸æ¯æäºå¡çå¼æï¼é£ä¹å¤ä»½å°±åªè½éè¿ FTWRL æ¹æ³ãè¿å¾å¾æ¯ DBA è¦æ±ä¸å¡å¼åäººåä½¿ç¨ InnoDB æ¿ä»£ MyISAM çåå ä¹ä¸ã\n\n# 1.3.2 set global readonly=true æ¹å¼ vs FTWRL æ¹å¼\n\nä½ ä¹è®¸ä¼é®ï¼æ¢ç¶è¦å¨åºåªè¯»ï¼ä¸ºä»ä¹ä¸ä½¿ç¨ set global readonly=true çæ¹å¼å¢ï¼ç¡®å® readonly æ¹å¼ä¹å¯ä»¥è®©å¨åºè¿å¥åªè¯»ç¶æï¼ä½æè¿æ¯ä¼å»ºè®®ä½ ç¨ FTWRL æ¹å¼ï¼ä¸»è¦æä¸¤ä¸ªåå ï¼\n\n * ä¸æ¯ï¼å¨æäºç³»ç»ä¸­ï¼readonly çå¼ä¼è¢«ç¨æ¥åå¶ä»é»è¾ï¼æ¯å¦ç¨æ¥å¤æ­ä¸ä¸ªåºæ¯ä¸»åºè¿æ¯å¤åºãå æ­¤ï¼ä¿®æ¹ global åéçæ¹å¼å½±åé¢æ´å¤§ï¼æä¸å»ºè®®ä½ ä½¿ç¨ã\n * äºæ¯ï¼å¨å¼å¸¸å¤çæºå¶ä¸æå·®å¼ãå¦ææ§è¡ FTWRL å½ä»¤ä¹åç±äºå®¢æ·ç«¯åçå¼å¸¸æ­å¼ï¼é£ä¹ MySQL ä¼èªå¨éæ¾è¿ä¸ªå¨å±éï¼æ´ä¸ªåºåå°å¯ä»¥æ­£å¸¸æ´æ°çç¶æãèå°æ´ä¸ªåºè®¾ç½®ä¸º readonly ä¹åï¼å¦æå®¢æ·ç«¯åçå¼å¸¸ï¼åæ°æ®åºå°±ä¼ä¸ç´ä¿æ readonly ç¶æï¼è¿æ ·ä¼å¯¼è´æ´ä¸ªåºé¿æ¶é´å¤äºä¸å¯åç¶æï¼é£é©è¾é«ã\n\nä¸å¡çæ´æ°ä¸åªæ¯å¢å æ¹æ°æ®(DML)ï¼è¿æå¯è½æ¯å å­æ®µç­ä¿®æ¹è¡¨ç»æçæä½ï¼DDLï¼ãä¸è®ºæ¯åªç§æ¹æ³ï¼ä¸ä¸ªåºè¢«å¨å±éä¸ä»¥åï¼ä½ è¦å¯¹éé¢ä»»ä½ä¸ä¸ªè¡¨åå å­æ®µæä½ï¼é½æ¯ä¼è¢«éä½çã\n\nä½æ¯ï¼å³ä½¿æ²¡æè¢«å¨å±éä½ï¼å å­æ®µä¹ä¸æ¯å°±è½ä¸å¸é£é¡ºçï¼å ä¸ºä½ è¿ä¼ç¢°å°æ¥ä¸æ¥æä»¬è¦ä»ç»çè¡¨çº§éã\n\n\n# 1.4 å°ç»\n\nå¨å±éä¸»è¦ç¨å¨é»è¾å¤ä»½è¿ç¨ä¸­ãå¯¹äºå¨é¨æ¯ InnoDB å¼æçåºï¼æå»ºè®®ä½ éæ©ä½¿ç¨âsingle-transaction åæ°ï¼å¯¹åºç¨ä¼æ´åå¥½ã\n\n\n# 2. è¡¨çº§é\n\nMySQL éé¢è¡¨çº§å«çéæä¸¤ç§ï¼ä¸ç§æ¯è¡¨éï¼ä¸ç§æ¯åæ°æ®éï¼meta data lockï¼MDLï¼ã\n\n\n# 2.1 lock tables\n\nè¡¨éçè¯­æ³æ¯ lock tables â¦ read/writeãä¸ FTWRL ç±»ä¼¼ï¼å¯ä»¥ç¨ unlock tables ä¸»å¨éæ¾éï¼ä¹å¯ä»¥å¨å®¢æ·ç«¯æ­å¼çæ¶åèªå¨éæ¾ãéè¦æ³¨æï¼lock tables è¯­æ³é¤äºä¼éå¶å«ççº¿ç¨çè¯»åå¤ï¼ä¹éå®äºæ¬çº¿ç¨æ¥ä¸æ¥çæä½å¯¹è±¡ã\n\n> ä¸¾ä¸ªä¾å­, å¦æå¨æä¸ªçº¿ç¨ A ä¸­æ§è¡ lock tables t1 read, t2 write; è¿ä¸ªè¯­å¥ï¼åå¶ä»çº¿ç¨å t1ãè¯»å t2 çè¯­å¥é½ä¼è¢«é»å¡ãåæ¶ï¼çº¿ç¨ A å¨æ§è¡ unlock tables ä¹åï¼ä¹åªè½æ§è¡è¯» t1ãè¯»å t2 çæä½ãè¿å t1 é½ä¸åè®¸ï¼èªç¶ä¹ä¸è½è®¿é®å¶ä»è¡¨ã\n\nå¨è¿æ²¡æåºç°æ´ç»ç²åº¦çéçæ¶åï¼è¡¨éæ¯æå¸¸ç¨çå¤çå¹¶åçæ¹å¼ãèå¯¹äº InnoDB è¿ç§æ¯æè¡éçå¼æï¼ä¸è¬ä¸ä½¿ç¨ lock tables å½ä»¤æ¥æ§å¶å¹¶åï¼æ¯ç«éä½æ´ä¸ªè¡¨çå½±åé¢è¿æ¯å¤ªå¤§ã\n\n\n# 2.2 MDL\n\nå¦ä¸ç±»è¡¨çº§çéæ¯ MDLï¼metadata lockï¼ãMDL ä¸éè¦æ¾å¼ä½¿ç¨ï¼å¨è®¿é®ä¸ä¸ªè¡¨çæ¶åä¼è¢«èªå¨å ä¸ãMDL çä½ç¨æ¯ï¼ä¿è¯è¯»åçæ­£ç¡®æ§ãä½ å¯ä»¥æ³è±¡ä¸ä¸ï¼å¦æä¸ä¸ªæ¥è¯¢æ­£å¨éåä¸ä¸ªè¡¨ä¸­çæ°æ®ï¼èæ§è¡æé´å¦ä¸ä¸ªçº¿ç¨å¯¹è¿ä¸ªè¡¨ç»æååæ´ï¼å äºä¸åï¼é£ä¹æ¥è¯¢çº¿ç¨æ¿å°çç»æè·è¡¨ç»æå¯¹ä¸ä¸ï¼è¯å®æ¯ä¸è¡çã\n\nå æ­¤ï¼å¨ MySQL 5.5 çæ¬ä¸­å¼å¥äº MDLï¼å½å¯¹ä¸ä¸ªè¡¨åå¢å æ¹æ¥æä½çæ¶åï¼å  MDL è¯»éï¼å½è¦å¯¹è¡¨åç»æåæ´æä½çæ¶åï¼å  MDL åéã\n\n * è¯»éä¹é´ä¸äºæ¥ï¼å æ­¤ä½ å¯ä»¥æå¤ä¸ªçº¿ç¨åæ¶å¯¹ä¸å¼ è¡¨å¢å æ¹æ¥ã\n * è¯»åéä¹é´ãåéä¹é´æ¯äºæ¥çï¼ç¨æ¥ä¿è¯åæ´è¡¨ç»ææä½çå®å¨æ§ãå æ­¤ï¼å¦ææä¸¤ä¸ªçº¿ç¨è¦åæ¶ç»ä¸ä¸ªè¡¨å å­æ®µï¼å¶ä¸­ä¸ä¸ªè¦ç­å¦ä¸ä¸ªæ§è¡å®æè½å¼å§æ§è¡ã\n\nå æ­¤è¯´ï¼MDL çä½ç¨æ¯é²æ­¢ DDL å DML å¹¶åçå²çªã\n\nè½ç¶ MDL éæ¯ç³»ç»é»è®¤ä¼å çï¼ä½å´æ¯ä½ ä¸è½å¿½ç¥çä¸ä¸ªæºå¶ãæ¯å¦ä¸é¢è¿ä¸ªä¾å­ï¼æç»å¸¸çå°æäººæå°è¿ä¸ªåéï¼ç»ä¸ä¸ªå°è¡¨å ä¸ªå­æ®µï¼å¯¼è´æ´ä¸ªåºæäºã\n\nä½ è¯å®ç¥éï¼ç»ä¸ä¸ªè¡¨å å­æ®µï¼æèä¿®æ¹å­æ®µï¼æèå ç´¢å¼ï¼éè¦æ«æå¨è¡¨çæ°æ®ãå¨å¯¹å¤§è¡¨æä½çæ¶åï¼ä½ è¯å®ä¼ç¹å«å°å¿ï¼ä»¥åå¯¹çº¿ä¸æå¡é æå½±åãèå®éä¸ï¼å³ä½¿æ¯å°è¡¨ï¼æä½ä¸æä¹ä¼åºé®é¢ãæä»¬æ¥çä¸ä¸ä¸é¢çæä½åºåï¼åè®¾è¡¨ t æ¯ä¸ä¸ªå°è¡¨ï¼\n\n 1. æä»¬å¯ä»¥çå° session A åå¯å¨ï¼è¿æ¶åä¼å¯¹è¡¨ t å ä¸ä¸ª MDL è¯»éãç±äº session B éè¦çä¹æ¯ MDL è¯»éï¼å æ­¤å¯ä»¥æ­£å¸¸æ§è¡ã\n 2. ä¹å session C ä¼è¢« blockedï¼æ¯å ä¸º session A ç MDL è¯»éè¿æ²¡æéæ¾ï¼è session C éè¦ MDL åéï¼å æ­¤åªè½è¢«é»å¡ã\n 3. å¦æåªæ session C èªå·±è¢«é»å¡è¿æ²¡ä»ä¹å³ç³»ï¼ä½æ¯ä¹åææè¦å¨è¡¨ t ä¸æ°ç³è¯· MDL è¯»éçè¯·æ±ä¹ä¼è¢« session C é»å¡ãåé¢æä»¬è¯´äºï¼ææå¯¹è¡¨çå¢å æ¹æ¥æä½é½éè¦åç³è¯· MDL è¯»éï¼å°±é½è¢«éä½ï¼ç­äºè¿ä¸ªè¡¨ç°å¨å®å¨ä¸å¯è¯»åäºï¼å ä¸º session A å session B å¯è½æ¯é¿äºå¡ï¼ãå¦ææä¸ªè¡¨ä¸çæ¥è¯¢è¯­å¥é¢ç¹ï¼èä¸å®¢æ·ç«¯æéè¯æºå¶ï¼ä¹å°±æ¯è¯´è¶æ¶åä¼åèµ·ä¸ä¸ªæ° session åè¯·æ±çè¯ï¼è¿ä¸ªåºççº¿ç¨å¾å¿«å°±ä¼çæ»¡ã\n\n> session C æ¿ä¸å° MDL åéèè¢« blockï¼ä¹å session D ä¹ä¼è¢« block èä¸æ¯åæ§è¡ï¼è¿æ ·çè®¾è®¡åè¡·ä¹è®¸æ¯é²æ­¢ session C é¥¿æ­»ã\n\nä½ ç°å¨åºè¯¥ç¥éäºï¼äºå¡ä¸­ç MDL éï¼å¨è¯­å¥æ§è¡å¼å§æ¶ç³è¯·ï¼ä½æ¯è¯­å¥ç»æåå¹¶ä¸ä¼é©¬ä¸éæ¾ï¼èä¼ç­å°æ´ä¸ªäºå¡æäº¤ååéæ¾ãåºäºä¸é¢çåæï¼æä»¬æ¥è®¨è®ºä¸ä¸ªé®é¢ï¼å¦ä½å®å¨å°ç»å°è¡¨å å­æ®µâ\n\né¦åæä»¬è¦è§£å³é¿äºå¡ï¼äºå¡ä¸æäº¤ï¼å°±ä¼ä¸ç´å ç MDL éãå¨ MySQL ç information_schema åºç innodb_trx è¡¨ä¸­ï¼ä½ å¯ä»¥æ¥å°å½åæ§è¡ä¸­çäºå¡ãå¦æä½ è¦å DDL åæ´çè¡¨åå¥½æé¿äºå¡å¨æ§è¡ï¼è¦èèåæå DDLï¼æè kill æè¿ä¸ªé¿äºå¡ã\n\nä½èèä¸ä¸è¿ä¸ªåºæ¯ãå¦æä½ è¦åæ´çè¡¨æ¯ä¸ä¸ªç­ç¹è¡¨ï¼è½ç¶æ°æ®éä¸å¤§ï¼ä½æ¯ä¸é¢çè¯·æ±å¾é¢ç¹ï¼èä½ ä¸å¾ä¸å ä¸ªå­æ®µï¼ä½ è¯¥æä¹åå¢ï¼\n\nè¿æ¶å kill å¯è½æªå¿ç®¡ç¨ï¼å ä¸ºæ°çè¯·æ±é©¬ä¸å°±æ¥äºãæ¯è¾çæ³çæºå¶æ¯ï¼å¨ alter table è¯­å¥éé¢è®¾å®ç­å¾æ¶é´ï¼å¦æå¨è¿ä¸ªæå®çç­å¾æ¶é´éé¢è½å¤æ¿å° MDL åéæå¥½ï¼æ¿ä¸å°ä¹ä¸è¦é»å¡åé¢çä¸å¡è¯­å¥ï¼åæ¾å¼ãä¹åå¼åäººåæè DBA åéè¿éè¯å½ä»¤éå¤è¿ä¸ªè¿ç¨ã\n\nMariaDB å·²ç»åå¹¶äº AliSQL çè¿ä¸ªåè½ï¼æä»¥è¿ä¸¤ä¸ªå¼æºåæ¯ç®åé½æ¯æ DDL NOWAIT/WAIT n è¿ä¸ªè¯­æ³ã\n\nALTER TABLE tbl_name NOWAIT add column ...\nALTER TABLE tbl_name WAIT N add column ...\n\n\n1\n2\n\n\n\n# 2.3 å°ç»\n\nè¡¨éä¸è¬æ¯å¨æ°æ®åºå¼æä¸æ¯æè¡éçæ¶åæä¼è¢«ç¨å°çãå¦æä½ åç°ä½ çåºç¨ç¨åºéæ lock tables è¿æ ·çè¯­å¥ï¼ä½ éè¦è¿½æ¥ä¸ä¸ï¼æ¯è¾å¯è½çæåµæ¯ï¼\n\n * è¦ä¹æ¯ä½ çç³»ç»ç°å¨è¿å¨ç¨ MyISAM è¿ç±»ä¸æ¯æäºå¡çå¼æï¼é£è¦å®æåçº§æ¢å¼æï¼\n * è¦ä¹æ¯ä½ çå¼æåçº§äºï¼ä½æ¯ä»£ç è¿æ²¡åçº§ãæè§è¿è¿æ ·çæåµï¼æåä¸å¡å¼åå°±æ¯æ lock tables å unlock tables æ¹æ begin å commitï¼é®é¢å°±è§£å³äºã\n\n\n# 3. è¡é\n\nMySQL çè¡éæ¯å¨å¼æå±ç±åä¸ªå¼æèªå·±å®ç°çãä½å¹¶ä¸æ¯ææçå¼æé½æ¯æè¡éï¼æ¯å¦ MyISAM å¼æå°±ä¸æ¯æè¡éãä¸æ¯æè¡éæå³çå¹¶åæ§å¶åªè½ä½¿ç¨è¡¨éï¼å¯¹äºè¿ç§å¼æçè¡¨ï¼åä¸å¼ è¡¨ä¸ä»»ä½æ¶å»åªè½æä¸ä¸ªæ´æ°å¨æ§è¡ï¼è¿å°±ä¼å½±åå°ä¸å¡å¹¶ååº¦ãInnoDB æ¯æ¯æè¡éçï¼è¿ä¹æ¯ MyISAM è¢« InnoDB æ¿ä»£çéè¦åå ä¹ä¸ãè¿éä¸»è¦èè InnoDB çè¡éï¼ä»¥åå¦ä½éè¿åå°éå²çªæ¥æåä¸å¡å¹¶ååº¦ã\n\nè¡éå°±æ¯éå¯¹æ°æ®è¡¨ä¸­è¡è®°å½çéãè¿å¾å¥½çè§£ï¼æ¯å¦äºå¡ A æ´æ°äºä¸è¡ï¼èè¿æ¶åäºå¡ B ä¹è¦æ´æ°åä¸è¡ï¼åå¿é¡»ç­äºå¡ A çæä½å®æåæè½è¿è¡æ´æ°ã\n\nå½ç¶ï¼æ°æ®åºä¸­è¿æä¸äºæ²¡é£ä¹ä¸ç®äºç¶çæ¦å¿µåè®¾è®¡ï¼è¿äºæ¦å¿µå¦æçè§£åä½¿ç¨ä¸å½ï¼å®¹æå¯¼è´ç¨åºåºç°éé¢æè¡ä¸ºï¼æ¯å¦ä¸¤é¶æ®µéã\n\n\n# 3.1 ä»ä¸¤é¶æ®µéè¯´èµ·\n\næåç»ä½ ä¸¾ä¸ªä¾å­ãå¨ä¸é¢çæä½åºåä¸­ï¼äºå¡ B ç update è¯­å¥æ§è¡æ¶ä¼æ¯ä»ä¹ç°è±¡å¢ï¼åè®¾å­æ®µ id æ¯è¡¨ t çä¸»é®ã\n\nè¿ä¸ªé®é¢çç»è®ºåå³äºäºå¡ A å¨æ§è¡å®ä¸¤æ¡ update è¯­å¥åï¼ææåªäºéï¼ä»¥åå¨ä»ä¹æ¶åéæ¾ãä½ å¯ä»¥éªè¯ä¸ä¸ï¼å®éä¸äºå¡ B ç update è¯­å¥ä¼è¢«é»å¡ï¼ç´å°äºå¡ A æ§è¡ commit ä¹åï¼äºå¡ B æè½ç»§ç»­æ§è¡ã\n\nç¥éäºè¿ä¸ªç­æ¡ï¼ä½ ä¸å®ç¥éäºäºå¡ A ææçä¸¤ä¸ªè®°å½çè¡éï¼é½æ¯å¨ commit çæ¶åæéæ¾çãä¹å°±æ¯è¯´ï¼å¨ InnoDB äºå¡ä¸­ï¼è¡éæ¯å¨éè¦çæ¶åæå ä¸çï¼ä½å¹¶ä¸æ¯ä¸éè¦äºå°±ç«å»éæ¾ï¼èæ¯è¦ç­å°äºå¡ç»ææ¶æéæ¾ãè¿ä¸ªå°±æ¯ä¸¤é¶æ®µéåè®®ã\n\nç¥éäºè¿ä¸ªè®¾å®ï¼å¯¹æä»¬ä½¿ç¨äºå¡æä»ä¹å¸®å©å¢ï¼é£å°±æ¯ï¼å¦æä½ çäºå¡ä¸­éè¦éå¤ä¸ªè¡ï¼è¦ææå¯è½é æéå²çªãæå¯è½å½±åå¹¶ååº¦çéå°½éå¾åæ¾ãæç»ä½ ä¸¾ä¸ªä¾å­ã\n\nåè®¾ä½ è´è´£å®ç°ä¸ä¸ªçµå½±ç¥¨å¨çº¿äº¤æä¸å¡ï¼é¡¾å®¢ A è¦å¨å½±é¢ B è´­ä¹°çµå½±ç¥¨ãæä»¬ç®åä¸ç¹ï¼è¿ä¸ªä¸å¡éè¦æ¶åå°ä»¥ä¸æä½ï¼\n\n 1. ä»é¡¾å®¢ A è´¦æ·ä½é¢ä¸­æ£é¤çµå½±ç¥¨ä»·ï¼\n 2. ç»å½±é¢ B çè´¦æ·ä½é¢å¢å è¿å¼ çµå½±ç¥¨ä»·ï¼\n 3. è®°å½ä¸æ¡äº¤ææ¥å¿ã\n\nä¹å°±æ¯è¯´ï¼è¦å®æè¿ä¸ªäº¤æï¼æä»¬éè¦ update ä¸¤æ¡è®°å½ï¼å¹¶ insert ä¸æ¡è®°å½ãå½ç¶ï¼ä¸ºäºä¿è¯äº¤æçåå­æ§ï¼æä»¬è¦æè¿ä¸ä¸ªæä½æ¾å¨ä¸ä¸ªäºå¡ä¸­ãé£ä¹ï¼ä½ ä¼ææ ·å®æè¿ä¸ä¸ªè¯­å¥å¨äºå¡ä¸­çé¡ºåºå¢ï¼\n\nè¯æ³å¦æåæ¶æå¦å¤ä¸ä¸ªé¡¾å®¢ C è¦å¨å½±é¢ B ä¹°ç¥¨ï¼é£ä¹è¿ä¸¤ä¸ªäºå¡å²çªçé¨åå°±æ¯è¯­å¥ 2 äºãå ä¸ºå®ä»¬è¦æ´æ°åä¸ä¸ªå½±é¢è´¦æ·çä½é¢ï¼éè¦ä¿®æ¹åä¸è¡æ°æ®ã\n\næ ¹æ®ä¸¤é¶æ®µéåè®®ï¼ä¸è®ºä½ ææ ·å®æè¯­å¥é¡ºåºï¼ææçæä½éè¦çè¡éé½æ¯å¨äºå¡æäº¤çæ¶åæéæ¾çãæä»¥ï¼å¦æä½ æè¯­å¥ 2 å®æå¨æåï¼æ¯å¦æç§ 3ã1ã2 è¿æ ·çé¡ºåºï¼é£ä¹å½±é¢è´¦æ·ä½é¢è¿ä¸è¡çéæ¶é´å°±æå°ãè¿å°±æå¤§ç¨åº¦å°åå°äºäºå¡ä¹é´çéç­å¾ï¼æåäºå¹¶ååº¦ã\n\nå¥½äºï¼ç°å¨ç±äºä½ çæ­£ç¡®è®¾è®¡ï¼å½±é¢ä½é¢è¿ä¸è¡çè¡éå¨ä¸ä¸ªäºå¡ä¸­ä¸ä¼åçå¾é¿æ¶é´ãä½æ¯ï¼è¿å¹¶æ²¡æå®å¨è§£å³ä½ çå°æ°ãå¦æè¿ä¸ªå½±é¢åæ´»å¨ï¼å¯ä»¥ä½ä»·é¢å®ä¸å¹´åææççµå½±ç¥¨ï¼èä¸è¿ä¸ªæ´»å¨åªåä¸å¤©ãäºæ¯å¨æ´»å¨æ¶é´å¼å§çæ¶åï¼ä½ ç MySQL å°±æäºãä½ ç»ä¸æå¡å¨ä¸çï¼CPU æ¶èæ¥è¿ 100%ï¼ä½æ´ä¸ªæ°æ®åºæ¯ç§å°±æ§è¡ä¸å° 100 ä¸ªäºå¡ãè¿æ¯ä»ä¹åå å¢ï¼\n\nè¿éï¼å°±è¦è¯´å°æ­»éåæ­»éæ£æµäºã\n\n\n# 3.2 æ­»éåæ­»éæ£æµ\n\nå½å¹¶åç³»ç»ä¸­ä¸åçº¿ç¨åºç°å¾ªç¯èµæºä¾èµï¼æ¶åççº¿ç¨é½å¨ç­å¾å«ççº¿ç¨éæ¾èµæºæ¶ï¼å°±ä¼å¯¼è´è¿å ä¸ªçº¿ç¨é½è¿å¥æ éç­å¾çç¶æï¼ç§°ä¸ºæ­»éãè¿éæç¨æ°æ®åºä¸­çè¡éä¸¾ä¸ªä¾å­ï¼\n\nè¿æ¶åï¼äºå¡ A å¨ç­å¾äºå¡ B éæ¾ id=2 çè¡éï¼èäºå¡ B å¨ç­å¾äºå¡ A éæ¾ id=1 çè¡éã äºå¡ A åäºå¡ B å¨äºç¸ç­å¾å¯¹æ¹çèµæºéæ¾ï¼å°±æ¯è¿å¥äºæ­»éç¶æãå½åºç°æ­»éä»¥åï¼æä¸¤ç§ç­ç¥ï¼\n\n * ä¸ç§ç­ç¥æ¯ï¼ç´æ¥è¿å¥ç­å¾ï¼ç´å°è¶æ¶ãè¿ä¸ªè¶æ¶æ¶é´å¯ä»¥éè¿åæ° innodb_lock_wait_timeout æ¥è®¾ç½®ã\n * å¦ä¸ç§ç­ç¥æ¯ï¼åèµ·æ­»éæ£æµï¼åç°æ­»éåï¼ä¸»å¨åæ»æ­»éé¾æ¡ä¸­çæä¸ä¸ªäºå¡ï¼è®©å¶ä»äºå¡å¾ä»¥ç»§ç»­æ§è¡ãå°åæ° innodb_deadlock_detect è®¾ç½®ä¸º onï¼è¡¨ç¤ºå¼å¯è¿ä¸ªé»è¾ã\n\nå¨ InnoDB ä¸­ï¼innodb_lock_wait_timeout çé»è®¤å¼æ¯ 50sï¼æå³çå¦æéç¨ç¬¬ä¸ä¸ªç­ç¥ï¼å½åºç°æ­»éä»¥åï¼ç¬¬ä¸ä¸ªè¢«éä½ççº¿ç¨è¦è¿ 50s æä¼è¶æ¶éåºï¼ç¶åå¶ä»çº¿ç¨ææå¯è½ç»§ç»­æ§è¡ãå¯¹äºå¨çº¿æå¡æ¥è¯´ï¼è¿ä¸ªç­å¾æ¶é´å¾å¾æ¯æ æ³æ¥åçã\n\nä½æ¯ï¼æä»¬åä¸å¯è½ç´æ¥æè¿ä¸ªæ¶é´è®¾ç½®æä¸ä¸ªå¾å°çå¼ï¼æ¯å¦ 1sãè¿æ ·å½åºç°æ­»éçæ¶åï¼ç¡®å®å¾å¿«å°±å¯ä»¥è§£å¼ï¼ä½å¦æä¸æ¯æ­»éï¼èæ¯ç®åçéç­å¾å¢ï¼æä»¥ï¼è¶æ¶æ¶é´è®¾ç½®å¤ªç­çè¯ï¼ä¼åºç°å¾å¤è¯¯ä¼¤ã\n\næä»¥ï¼æ­£å¸¸æåµä¸æä»¬è¿æ¯è¦éç¨ç¬¬äºç§ç­ç¥ï¼å³ï¼ä¸»å¨æ­»éæ£æµï¼èä¸ innodb_deadlock_detect çé»è®¤å¼æ¬èº«å°±æ¯ onãä¸»å¨æ­»éæ£æµå¨åçæ­»éçæ¶åï¼æ¯è½å¤å¿«éåç°å¹¶è¿è¡å¤ççï¼ä½æ¯å®ä¹æ¯æé¢å¤è´æçã\n\nä½ å¯ä»¥æ³è±¡ä¸ä¸è¿ä¸ªè¿ç¨ï¼æ¯å½ä¸ä¸ªäºå¡è¢«éçæ¶åï¼å°±è¦ççå®æä¾èµççº¿ç¨ææ²¡æè¢«å«äººéä½ï¼å¦æ­¤å¾ªç¯ï¼æåå¤æ­æ¯å¦åºç°äºå¾ªç¯ç­å¾ï¼ä¹å°±æ¯æ­»éãé£å¦ææ¯æä»¬ä¸é¢è¯´å°çææäºå¡é½è¦æ´æ°åä¸è¡çåºæ¯å¢ï¼æ¯ä¸ªæ°æ¥çè¢«å µä½ççº¿ç¨ï¼é½è¦å¤æ­ä¼ä¸ä¼ç±äºèªå·±çå å¥å¯¼è´äºæ­»éï¼è¿æ¯ä¸ä¸ªæ¶é´å¤æåº¦æ¯ $O(n^2)$ çæä½ãåè®¾æ 1000 ä¸ªå¹¶åçº¿ç¨è¦åæ¶æ´æ°åä¸è¡ï¼é£ä¹æ­»éæ£æµæä½å°±æ¯ 100 ä¸è¿ä¸ªéçº§çãè½ç¶æç»æ£æµçç»ææ¯æ²¡ææ­»éï¼ä½æ¯è¿æé´è¦æ¶èå¤§éç CPU èµæºãå æ­¤ï¼ä½ å°±ä¼çå° CPU å©ç¨çå¾é«ï¼ä½æ¯æ¯ç§å´æ§è¡ä¸äºå ä¸ªäºå¡ã\n\næ ¹æ®ä¸é¢çåæï¼æä»¬æ¥è®¨è®ºä¸ä¸ï¼æä¹è§£å³ç±è¿ç§ç­ç¹è¡æ´æ°å¯¼è´çæ§è½é®é¢å¢â é®é¢ççç»å¨äºï¼æ­»éæ£æµè¦èè´¹å¤§éç CPU èµæºï¼\n\n * ä¸ç§å¤´çå»å¤´çæ¹æ³ï¼å°±æ¯å¦æä½ è½ç¡®ä¿è¿ä¸ªä¸å¡ä¸å®ä¸ä¼åºç°æ­»éï¼å¯ä»¥ä¸´æ¶ææ­»éæ£æµå³æãä½æ¯è¿ç§æä½æ¬èº«å¸¦æä¸å®çé£é©ï¼å ä¸ºä¸å¡è®¾è®¡çæ¶åä¸è¬ä¸ä¼ææ­»éå½åä¸ä¸ªä¸¥ééè¯¯ï¼æ¯ç«åºç°æ­»éäºï¼å°±åæ»ï¼ç¶åéè¿ä¸å¡éè¯ä¸è¬å°±æ²¡é®é¢äºï¼è¿æ¯ä¸å¡æ æçãèå³ææ­»éæ£æµæå³çå¯è½ä¼åºç°å¤§éçè¶æ¶ï¼è¿æ¯ä¸å¡ææçã\n\n * å¦ä¸ä¸ªæè·¯æ¯æ§å¶å¹¶ååº¦ãæ ¹æ®ä¸é¢çåæï¼ä½ ä¼åç°å¦æå¹¶åè½å¤æ§å¶ä½ï¼æ¯å¦åä¸è¡åæ¶æå¤åªæ 10 ä¸ªçº¿ç¨å¨æ´æ°ï¼é£ä¹æ­»éæ£æµçææ¬å¾ä½ï¼å°±ä¸ä¼åºç°è¿ä¸ªé®é¢ãä¸ä¸ªç´æ¥çæ³æ³å°±æ¯ï¼å¨å®¢æ·ç«¯åå¹¶åæ§å¶ãä½æ¯ï¼ä½ ä¼å¾å¿«åç°è¿ä¸ªæ¹æ³ä¸å¤ªå¯è¡ï¼å ä¸ºå®¢æ·ç«¯å¾å¤ãæè§è¿ä¸ä¸ªåºç¨ï¼æ 600 ä¸ªå®¢æ·ç«¯ï¼è¿æ ·å³ä½¿æ¯ä¸ªå®¢æ·ç«¯æ§å¶å°åªæ 5 ä¸ªå¹¶åçº¿ç¨ï¼æ±æ»å°æ°æ®åºæå¡ç«¯ä»¥åï¼å³°å¼å¹¶åæ°ä¹å¯è½è¦è¾¾å° 3000ã\n\nå æ­¤ï¼è¿ä¸ªå¹¶åæ§å¶è¦åå¨æ°æ®åºæå¡ç«¯ãå¦æä½ æä¸­é´ä»¶ï¼å¯ä»¥èèå¨ä¸­é´ä»¶å®ç°ï¼å¦æä½ çå¢éæè½ä¿®æ¹ MySQL æºç çäººï¼ä¹å¯ä»¥åå¨ MySQL éé¢ãåºæ¬æè·¯å°±æ¯ï¼å¯¹äºç¸åè¡çæ´æ°ï¼å¨è¿å¥å¼æä¹åæéãè¿æ ·å¨ InnoDB åé¨å°±ä¸ä¼æå¤§éçæ­»éæ£æµå·¥ä½äºã\n\nå¯è½ä½ ä¼é®ï¼å¦æå¢ééææ¶æ²¡ææ°æ®åºæ¹é¢çä¸å®¶ï¼ä¸è½å®ç°è¿æ ·çæ¹æ¡ï¼è½ä¸è½ä»è®¾è®¡ä¸ä¼åè¿ä¸ªé®é¢å¢ â\n\n * ä½ å¯ä»¥èèéè¿å°ä¸è¡æ¹æé»è¾ä¸çå¤è¡æ¥åå°éå²çªãè¿æ¯ä»¥å½±é¢è´¦æ·ä¸ºä¾ï¼å¯ä»¥èèæ¾å¨å¤æ¡è®°å½ä¸ï¼æ¯å¦ 10 ä¸ªè®°å½ï¼å½±é¢çè´¦æ·æ»é¢ç­äºè¿ 10 ä¸ªè®°å½çå¼çæ»åãè¿æ ·æ¯æ¬¡è¦ç»å½±é¢è´¦æ·å éé¢çæ¶åï¼éæºéå¶ä¸­ä¸æ¡è®°å½æ¥å ãè¿æ ·æ¯æ¬¡å²çªæ¦çåæåæ¥ç 1/10ï¼å¯ä»¥åå°éç­å¾ä¸ªæ°ï¼ä¹å°±åå°äºæ­»éæ£æµç CPU æ¶èã\n\nè¿ä¸ªæ¹æ¡çä¸å»æ¯æ æçï¼ä½å¶å®è¿ç±»æ¹æ¡éè¦æ ¹æ®ä¸å¡é»è¾åè¯¦ç»è®¾è®¡ãå¦æè´¦æ·ä½é¢å¯è½ä¼åå°ï¼æ¯å¦éç¥¨é»è¾ï¼é£ä¹è¿æ¶åå°±éè¦èèå½ä¸é¨åè¡è®°å½åæ 0 çæ¶åï¼ä»£ç è¦æç¹æ®å¤çã\n\n\n# 3.3 å°ç»\n\nè¿ä¸å¤§èä»ç»äº MySQL çè¡éï¼å¹¶ä¸»è¦æ¶åäºä¸¤é¶æ®µéåè®®ãæ­»éåæ­»éæ£æµè¿ä¸¤å¤§é¨ååå®¹ã\n\n * ä»¥ä¸¤é¶æ®µåè®®ä¸ºèµ·ç¹ï¼ä¸èµ·è®¨è®ºäºå¨å¼åçæ¶åå¦ä½å®ææ­£ç¡®çäºå¡è¯­å¥ãè¿éçåå / æç»ä½ çå»ºè®®æ¯ï¼å¦æä½ çäºå¡ä¸­éè¦éå¤ä¸ªè¡ï¼è¦ææå¯è½é æéå²çªãæå¯è½å½±åå¹¶ååº¦çéçç³è¯·æ¶æºå°½éå¾åæ¾ã\n * ä½æ¯ï¼è°æ´è¯­å¥é¡ºåºå¹¶ä¸è½å®å¨é¿åæ­»éãæä»¥æä»¬å¼å¥äºæ­»éåæ­»éæ£æµçæ¦å¿µï¼ä»¥åæä¾äºä¸ä¸ªæ¹æ¡ï¼æ¥åå°æ­»éå¯¹æ°æ®åºçå½±åãåå°æ­»éçä¸»è¦æ¹åï¼å°±æ¯æ§å¶è®¿é®ç¸åèµæºçå¹¶åäºå¡éã\n\n\n# QA\n\nQï¼å¦æä½ è¦å é¤ä¸ä¸ªè¡¨éé¢çå 10000 è¡æ°æ®ï¼æä»¥ä¸ä¸ç§æ¹æ³å¯ä»¥åå°ï¼\n\n * ç¬¬ä¸ç§ï¼ç´æ¥æ§è¡ delete from T limit 10000;\n * ç¬¬äºç§ï¼å¨ä¸ä¸ªè¿æ¥ä¸­å¾ªç¯æ§è¡ 20 æ¬¡ delete from T limit 500;\n * ç¬¬ä¸ç§ï¼å¨ 20 ä¸ªè¿æ¥ä¸­åæ¶æ§è¡ delete from T limit 500ã\n\nä½ ä¼éæ©åªä¸ç§æ¹æ³å¢ï¼ä¸ºä»ä¹å¢ï¼\n\nAï¼ç¬¬äºç§æ¹å¼æ¯ç¸å¯¹è¾å¥½çã\n\n * ç¬¬ä¸ç§æ¹å¼ï¼å³ï¼ç´æ¥æ§è¡ delete from T limit 10000ï¼éé¢ï¼åä¸ªè¯­å¥å ç¨æ¶é´é¿ï¼éçæ¶é´ä¹æ¯è¾é¿ï¼èä¸å¤§äºå¡è¿ä¼å¯¼è´ä¸»ä»å»¶è¿ã\n * ç¬¬ä¸ç§æ¹å¼ï¼å³ï¼å¨ 20 ä¸ªè¿æ¥ä¸­åæ¶æ§è¡ delete from T limit 500ï¼ï¼ä¼äººä¸ºé æéå²çªã",normalizedContent:"> åèï¼\n> \n>  * 06 | å¨å±éåè¡¨é ï¼ç»è¡¨å ä¸ªå­æ®µæä¹æè¿ä¹å¤é»ç¢ï¼| æå®¢æ¶é´\n>  * 07 | è¡éåè¿ï¼æä¹åå°è¡éå¯¹æ§è½çå½±åï¼| æå®¢æ¶é´\n\næ°æ®åºéè®¾è®¡çåè¡·æ¯å¤çå¹¶åé®é¢ãä½ä¸ºå¤ç¨æ·å±äº«çèµæºï¼å½åºç°å¹¶åè®¿é®çæ¶åï¼æ°æ®åºéè¦åçå°æ§å¶èµæºçè®¿é®è§åãèéå°±æ¯ç¨æ¥å®ç°è¿äºè®¿é®è§åçéè¦æ°æ®ç»æã\n\næ ¹æ®å éçèå´ï¼mysql éé¢çéå¤§è´å¯ä»¥åæå¨å±éãè¡¨çº§éåè¡éä¸ç±»ãç±äºéçè®¾è®¡æ¯è¾å¤æï¼è¿éä¸ä¼æ¶åéçå·ä½å®ç°ç»èï¼ä¸»è¦ä»ç»çæ¯ç¢°å°éæ¶çç°è±¡åå¶èåçåçã\n\n\n# 1. å¨å±é\n\n\n# 1.1 ä»ä¹æ¯å¨å±é\n\nå¨å±éå°±æ¯å¯¹æ´ä¸ªæ°æ®åºå®ä¾å éãmysql æä¾äºä¸ä¸ªå å¨å±è¯»éçæ¹æ³ï¼å½ä»¤æ¯ flush tables with read lock (ftwrl)ãå½ä½ éè¦è®©æ´ä¸ªåºå¤äºåªè¯»ç¶æçæ¶åï¼å¯ä»¥ä½¿ç¨è¿ä¸ªå½ä»¤ï¼ä¹åå¶ä»çº¿ç¨çä»¥ä¸è¯­å¥ä¼è¢«é»å¡ï¼æ°æ®æ´æ°è¯­å¥ï¼æ°æ®çå¢å æ¹ï¼ãæ°æ®å®ä¹è¯­å¥ï¼åæ¬å»ºè¡¨ãä¿®æ¹è¡¨ç»æç­ï¼åæ´æ°ç±»äºå¡çæäº¤è¯­å¥ã\n\nå¨å±éçå¸åä½¿ç¨åºæ¯æ¯ï¼åå¨åºé»è¾å¤ä»½ãä¹å°±æ¯ææ´åºæ¯ä¸ªè¡¨é½ select åºæ¥å­æææ¬ã\n\nä»¥åæä¸ç§åæ³ï¼æ¯éè¿ ftwrl ç¡®ä¿ä¸ä¼æå¶ä»çº¿ç¨å¯¹æ°æ®åºåæ´æ°ï¼ç¶åå¯¹æ´ä¸ªåºåå¤ä»½ãæ³¨æï¼å¨å¤ä»½è¿ç¨ä¸­æ´ä¸ªåºå®å¨å¤äºåªè¯»ç¶æãä½æ¯è®©æ´åºé½åªè¯»ï¼å¬ä¸å»å°±å¾å±é©ï¼\n\n * å¦æä½ å¨ä¸»åºä¸å¤ä»½ï¼é£ä¹å¨å¤ä»½æé´é½ä¸è½æ§è¡æ´æ°ï¼ä¸å¡åºæ¬ä¸å°±å¾åæï¼\n * å¦æä½ å¨ä»åºä¸å¤ä»½ï¼é£ä¹å¤ä»½æé´ä»åºä¸è½æ§è¡ä¸»åºåæ­¥è¿æ¥ç binlogï¼ä¼å¯¼è´ä¸»ä»å»¶è¿ã\n\n\n# 1.2 å¤ä»½ä¸ºä»ä¹è¦å éï¼\n\nçæ¥å å¨å±éä¸å¤ªå¥½ãä½æ¯ç»æ³ä¸ä¸ï¼å¤ä»½ä¸ºä»ä¹è¦å éå¢â æä»¬æ¥çä¸ä¸ä¸å éä¼æä»ä¹é®é¢ã\n\nç°å¨åèµ·ä¸ä¸ªé»è¾å¤ä»½ãåè®¾å¤ä»½æé´ï¼æä¸ä¸ªç¨æ·ï¼ä»è´­ä¹°äºä¸é¨è¯¾ç¨ï¼ä¸å¡é»è¾éå°±è¦æ£æä»çä½é¢ï¼ç¶åå¾å·²è´­è¯¾ç¨éé¢å ä¸ä¸é¨è¯¾ãå¦ææ¶é´é¡ºåºä¸æ¯åå¤ä»½è´¦æ·ä½é¢è¡¨ (u_account)ï¼ç¶åç¨æ·è´­ä¹°ï¼ç¶åå¤ä»½ç¨æ·è¯¾ç¨è¡¨ (u_course)ï¼ä¼æä¹æ ·å¢ï¼ä½ å¯ä»¥çä¸ä¸è¿ä¸ªå¾ï¼\n\nå¯ä»¥çå°ï¼è¿ä¸ªå¤ä»½ç»æéï¼ç¨æ· a çæ°æ®ç¶ææ¯âè´¦æ·ä½é¢æ²¡æ£ï¼ä½æ¯ç¨æ·è¯¾ç¨è¡¨éé¢å·²ç»å¤äºä¸é¨è¯¾âãå¦æåé¢ç¨è¿ä¸ªå¤ä»½æ¥æ¢å¤æ°æ®çè¯ï¼ç¨æ· a å°±åç°ï¼èªå·±èµäºãå¦æå¤ä»½è¡¨çé¡ºåºåè¿æ¥ï¼åå¤ä»½ç¨æ·è¯¾ç¨è¡¨åå¤ä»½è´¦æ·ä½é¢è¡¨ï¼é£ç¨æ·å°±äºäºã\n\nä¹å°±æ¯è¯´ï¼ä¸å éçè¯ï¼å¤ä»½ç³»ç»å¤ä»½çå¾å°çåºä¸æ¯ä¸ä¸ªé»è¾æ¶é´ç¹ï¼è¿ä¸ªè§å¾æ¯é»è¾ä¸ä¸è´çã\n\n\n# 1.3 å¨å±å éçæ¹æ³\n\n# 1.3.1 å¼å¯äºå¡ï¼single-transaction æ¹æ³ï¼\n\nè¯´å°è§å¾ä½ è¯å®æ³èµ·æ¥äºï¼æä»¬å¨åé¢è®²äºå¡éç¦»çæ¶åï¼å¶å®æ¯æä¸ä¸ªæ¹æ³è½å¤æ¿å°ä¸è´æ§è§å¾çï¼å¯¹å§ï¼æ¯çï¼å°±æ¯å¨å¯éå¤è¯»éç¦»çº§å«ä¸å¼å¯ä¸ä¸ªäºå¡ã\n\nå®æ¹èªå¸¦çé»è¾å¤ä»½å·¥å·æ¯ mysqldumpãå½ mysqldump ä½¿ç¨åæ° -single-transaction çæ¶åï¼å¯¼æ°æ®ä¹åå°±ä¼å¯å¨ä¸ä¸ªäºå¡ï¼æ¥ç¡®ä¿æ¿å°ä¸è´æ§è§å¾ãèç±äº mvcc çæ¯æï¼è¿ä¸ªè¿ç¨ä¸­æ°æ®æ¯å¯ä»¥æ­£å¸¸æ´æ°çã\n\nä½ ä¸å®å¨çæï¼æäºè¿ä¸ªåè½ï¼ä¸ºä»ä¹è¿éè¦ ftwrl å¢ï¼ä¸è´æ§è¯»æ¯å¥½ï¼ä½åææ¯å¼æè¦æ¯æè¿ä¸ªéç¦»çº§å«ãæ¯å¦ï¼å¯¹äº myisam è¿ç§ä¸æ¯æäºå¡çå¼æï¼å¦æå¤ä»½è¿ç¨ä¸­ææ´æ°ï¼æ»æ¯åªè½åå°ææ°çæ°æ®ï¼é£ä¹å°±ç ´åäºå¤ä»½çä¸è´æ§ãè¿æ¶ï¼æä»¬å°±éè¦ä½¿ç¨ ftwrl å½ä»¤äºã\n\næä»¥ï¼single-transaction æ¹æ³åªéç¨äºææçè¡¨ä½¿ç¨äºå¡å¼æçåºãå¦ææçè¡¨ä½¿ç¨äºä¸æ¯æäºå¡çå¼æï¼é£ä¹å¤ä»½å°±åªè½éè¿ ftwrl æ¹æ³ãè¿å¾å¾æ¯ dba è¦æ±ä¸å¡å¼åäººåä½¿ç¨ innodb æ¿ä»£ myisam çåå ä¹ä¸ã\n\n# 1.3.2 set global readonly=true æ¹å¼ vs ftwrl æ¹å¼\n\nä½ ä¹è®¸ä¼é®ï¼æ¢ç¶è¦å¨åºåªè¯»ï¼ä¸ºä»ä¹ä¸ä½¿ç¨ set global readonly=true çæ¹å¼å¢ï¼ç¡®å® readonly æ¹å¼ä¹å¯ä»¥è®©å¨åºè¿å¥åªè¯»ç¶æï¼ä½æè¿æ¯ä¼å»ºè®®ä½ ç¨ ftwrl æ¹å¼ï¼ä¸»è¦æä¸¤ä¸ªåå ï¼\n\n * ä¸æ¯ï¼å¨æäºç³»ç»ä¸­ï¼readonly çå¼ä¼è¢«ç¨æ¥åå¶ä»é»è¾ï¼æ¯å¦ç¨æ¥å¤æ­ä¸ä¸ªåºæ¯ä¸»åºè¿æ¯å¤åºãå æ­¤ï¼ä¿®æ¹ global åéçæ¹å¼å½±åé¢æ´å¤§ï¼æä¸å»ºè®®ä½ ä½¿ç¨ã\n * äºæ¯ï¼å¨å¼å¸¸å¤çæºå¶ä¸æå·®å¼ãå¦ææ§è¡ ftwrl å½ä»¤ä¹åç±äºå®¢æ·ç«¯åçå¼å¸¸æ­å¼ï¼é£ä¹ mysql ä¼èªå¨éæ¾è¿ä¸ªå¨å±éï¼æ´ä¸ªåºåå°å¯ä»¥æ­£å¸¸æ´æ°çç¶æãèå°æ´ä¸ªåºè®¾ç½®ä¸º readonly ä¹åï¼å¦æå®¢æ·ç«¯åçå¼å¸¸ï¼åæ°æ®åºå°±ä¼ä¸ç´ä¿æ readonly ç¶æï¼è¿æ ·ä¼å¯¼è´æ´ä¸ªåºé¿æ¶é´å¤äºä¸å¯åç¶æï¼é£é©è¾é«ã\n\nä¸å¡çæ´æ°ä¸åªæ¯å¢å æ¹æ°æ®(dml)ï¼è¿æå¯è½æ¯å å­æ®µç­ä¿®æ¹è¡¨ç»æçæä½ï¼ddlï¼ãä¸è®ºæ¯åªç§æ¹æ³ï¼ä¸ä¸ªåºè¢«å¨å±éä¸ä»¥åï¼ä½ è¦å¯¹éé¢ä»»ä½ä¸ä¸ªè¡¨åå å­æ®µæä½ï¼é½æ¯ä¼è¢«éä½çã\n\nä½æ¯ï¼å³ä½¿æ²¡æè¢«å¨å±éä½ï¼å å­æ®µä¹ä¸æ¯å°±è½ä¸å¸é£é¡ºçï¼å ä¸ºä½ è¿ä¼ç¢°å°æ¥ä¸æ¥æä»¬è¦ä»ç»çè¡¨çº§éã\n\n\n# 1.4 å°ç»\n\nå¨å±éä¸»è¦ç¨å¨é»è¾å¤ä»½è¿ç¨ä¸­ãå¯¹äºå¨é¨æ¯ innodb å¼æçåºï¼æå»ºè®®ä½ éæ©ä½¿ç¨âsingle-transaction åæ°ï¼å¯¹åºç¨ä¼æ´åå¥½ã\n\n\n# 2. è¡¨çº§é\n\nmysql éé¢è¡¨çº§å«çéæä¸¤ç§ï¼ä¸ç§æ¯è¡¨éï¼ä¸ç§æ¯åæ°æ®éï¼meta data lockï¼mdlï¼ã\n\n\n# 2.1 lock tables\n\nè¡¨éçè¯­æ³æ¯ lock tables â¦ read/writeãä¸ ftwrl ç±»ä¼¼ï¼å¯ä»¥ç¨ unlock tables ä¸»å¨éæ¾éï¼ä¹å¯ä»¥å¨å®¢æ·ç«¯æ­å¼çæ¶åèªå¨éæ¾ãéè¦æ³¨æï¼lock tables è¯­æ³é¤äºä¼éå¶å«ççº¿ç¨çè¯»åå¤ï¼ä¹éå®äºæ¬çº¿ç¨æ¥ä¸æ¥çæä½å¯¹è±¡ã\n\n> ä¸¾ä¸ªä¾å­, å¦æå¨æä¸ªçº¿ç¨ a ä¸­æ§è¡ lock tables t1 read, t2 write; è¿ä¸ªè¯­å¥ï¼åå¶ä»çº¿ç¨å t1ãè¯»å t2 çè¯­å¥é½ä¼è¢«é»å¡ãåæ¶ï¼çº¿ç¨ a å¨æ§è¡ unlock tables ä¹åï¼ä¹åªè½æ§è¡è¯» t1ãè¯»å t2 çæä½ãè¿å t1 é½ä¸åè®¸ï¼èªç¶ä¹ä¸è½è®¿é®å¶ä»è¡¨ã\n\nå¨è¿æ²¡æåºç°æ´ç»ç²åº¦çéçæ¶åï¼è¡¨éæ¯æå¸¸ç¨çå¤çå¹¶åçæ¹å¼ãèå¯¹äº innodb è¿ç§æ¯æè¡éçå¼æï¼ä¸è¬ä¸ä½¿ç¨ lock tables å½ä»¤æ¥æ§å¶å¹¶åï¼æ¯ç«éä½æ´ä¸ªè¡¨çå½±åé¢è¿æ¯å¤ªå¤§ã\n\n\n# 2.2 mdl\n\nå¦ä¸ç±»è¡¨çº§çéæ¯ mdlï¼metadata lockï¼ãmdl ä¸éè¦æ¾å¼ä½¿ç¨ï¼å¨è®¿é®ä¸ä¸ªè¡¨çæ¶åä¼è¢«èªå¨å ä¸ãmdl çä½ç¨æ¯ï¼ä¿è¯è¯»åçæ­£ç¡®æ§ãä½ å¯ä»¥æ³è±¡ä¸ä¸ï¼å¦æä¸ä¸ªæ¥è¯¢æ­£å¨éåä¸ä¸ªè¡¨ä¸­çæ°æ®ï¼èæ§è¡æé´å¦ä¸ä¸ªçº¿ç¨å¯¹è¿ä¸ªè¡¨ç»æååæ´ï¼å äºä¸åï¼é£ä¹æ¥è¯¢çº¿ç¨æ¿å°çç»æè·è¡¨ç»æå¯¹ä¸ä¸ï¼è¯å®æ¯ä¸è¡çã\n\nå æ­¤ï¼å¨ mysql 5.5 çæ¬ä¸­å¼å¥äº mdlï¼å½å¯¹ä¸ä¸ªè¡¨åå¢å æ¹æ¥æä½çæ¶åï¼å  mdl è¯»éï¼å½è¦å¯¹è¡¨åç»æåæ´æä½çæ¶åï¼å  mdl åéã\n\n * è¯»éä¹é´ä¸äºæ¥ï¼å æ­¤ä½ å¯ä»¥æå¤ä¸ªçº¿ç¨åæ¶å¯¹ä¸å¼ è¡¨å¢å æ¹æ¥ã\n * è¯»åéä¹é´ãåéä¹é´æ¯äºæ¥çï¼ç¨æ¥ä¿è¯åæ´è¡¨ç»ææä½çå®å¨æ§ãå æ­¤ï¼å¦ææä¸¤ä¸ªçº¿ç¨è¦åæ¶ç»ä¸ä¸ªè¡¨å å­æ®µï¼å¶ä¸­ä¸ä¸ªè¦ç­å¦ä¸ä¸ªæ§è¡å®æè½å¼å§æ§è¡ã\n\nå æ­¤è¯´ï¼mdl çä½ç¨æ¯é²æ­¢ ddl å dml å¹¶åçå²çªã\n\nè½ç¶ mdl éæ¯ç³»ç»é»è®¤ä¼å çï¼ä½å´æ¯ä½ ä¸è½å¿½ç¥çä¸ä¸ªæºå¶ãæ¯å¦ä¸é¢è¿ä¸ªä¾å­ï¼æç»å¸¸çå°æäººæå°è¿ä¸ªåéï¼ç»ä¸ä¸ªå°è¡¨å ä¸ªå­æ®µï¼å¯¼è´æ´ä¸ªåºæäºã\n\nä½ è¯å®ç¥éï¼ç»ä¸ä¸ªè¡¨å å­æ®µï¼æèä¿®æ¹å­æ®µï¼æèå ç´¢å¼ï¼éè¦æ«æå¨è¡¨çæ°æ®ãå¨å¯¹å¤§è¡¨æä½çæ¶åï¼ä½ è¯å®ä¼ç¹å«å°å¿ï¼ä»¥åå¯¹çº¿ä¸æå¡é æå½±åãèå®éä¸ï¼å³ä½¿æ¯å°è¡¨ï¼æä½ä¸æä¹ä¼åºé®é¢ãæä»¬æ¥çä¸ä¸ä¸é¢çæä½åºåï¼åè®¾è¡¨ t æ¯ä¸ä¸ªå°è¡¨ï¼\n\n 1. æä»¬å¯ä»¥çå° session a åå¯å¨ï¼è¿æ¶åä¼å¯¹è¡¨ t å ä¸ä¸ª mdl è¯»éãç±äº session b éè¦çä¹æ¯ mdl è¯»éï¼å æ­¤å¯ä»¥æ­£å¸¸æ§è¡ã\n 2. ä¹å session c ä¼è¢« blockedï¼æ¯å ä¸º session a ç mdl è¯»éè¿æ²¡æéæ¾ï¼è session c éè¦ mdl åéï¼å æ­¤åªè½è¢«é»å¡ã\n 3. å¦æåªæ session c èªå·±è¢«é»å¡è¿æ²¡ä»ä¹å³ç³»ï¼ä½æ¯ä¹åææè¦å¨è¡¨ t ä¸æ°ç³è¯· mdl è¯»éçè¯·æ±ä¹ä¼è¢« session c é»å¡ãåé¢æä»¬è¯´äºï¼ææå¯¹è¡¨çå¢å æ¹æ¥æä½é½éè¦åç³è¯· mdl è¯»éï¼å°±é½è¢«éä½ï¼ç­äºè¿ä¸ªè¡¨ç°å¨å®å¨ä¸å¯è¯»åäºï¼å ä¸º session a å session b å¯è½æ¯é¿äºå¡ï¼ãå¦ææä¸ªè¡¨ä¸çæ¥è¯¢è¯­å¥é¢ç¹ï¼èä¸å®¢æ·ç«¯æéè¯æºå¶ï¼ä¹å°±æ¯è¯´è¶æ¶åä¼åèµ·ä¸ä¸ªæ° session åè¯·æ±çè¯ï¼è¿ä¸ªåºççº¿ç¨å¾å¿«å°±ä¼çæ»¡ã\n\n> session c æ¿ä¸å° mdl åéèè¢« blockï¼ä¹å session d ä¹ä¼è¢« block èä¸æ¯åæ§è¡ï¼è¿æ ·çè®¾è®¡åè¡·ä¹è®¸æ¯é²æ­¢ session c é¥¿æ­»ã\n\nä½ ç°å¨åºè¯¥ç¥éäºï¼äºå¡ä¸­ç mdl éï¼å¨è¯­å¥æ§è¡å¼å§æ¶ç³è¯·ï¼ä½æ¯è¯­å¥ç»æåå¹¶ä¸ä¼é©¬ä¸éæ¾ï¼èä¼ç­å°æ´ä¸ªäºå¡æäº¤ååéæ¾ãåºäºä¸é¢çåæï¼æä»¬æ¥è®¨è®ºä¸ä¸ªé®é¢ï¼å¦ä½å®å¨å°ç»å°è¡¨å å­æ®µâ\n\né¦åæä»¬è¦è§£å³é¿äºå¡ï¼äºå¡ä¸æäº¤ï¼å°±ä¼ä¸ç´å ç mdl éãå¨ mysql ç information_schema åºç innodb_trx è¡¨ä¸­ï¼ä½ å¯ä»¥æ¥å°å½åæ§è¡ä¸­çäºå¡ãå¦æä½ è¦å ddl åæ´çè¡¨åå¥½æé¿äºå¡å¨æ§è¡ï¼è¦èèåæå ddlï¼æè kill æè¿ä¸ªé¿äºå¡ã\n\nä½èèä¸ä¸è¿ä¸ªåºæ¯ãå¦æä½ è¦åæ´çè¡¨æ¯ä¸ä¸ªç­ç¹è¡¨ï¼è½ç¶æ°æ®éä¸å¤§ï¼ä½æ¯ä¸é¢çè¯·æ±å¾é¢ç¹ï¼èä½ ä¸å¾ä¸å ä¸ªå­æ®µï¼ä½ è¯¥æä¹åå¢ï¼\n\nè¿æ¶å kill å¯è½æªå¿ç®¡ç¨ï¼å ä¸ºæ°çè¯·æ±é©¬ä¸å°±æ¥äºãæ¯è¾çæ³çæºå¶æ¯ï¼å¨ alter table è¯­å¥éé¢è®¾å®ç­å¾æ¶é´ï¼å¦æå¨è¿ä¸ªæå®çç­å¾æ¶é´éé¢è½å¤æ¿å° mdl åéæå¥½ï¼æ¿ä¸å°ä¹ä¸è¦é»å¡åé¢çä¸å¡è¯­å¥ï¼åæ¾å¼ãä¹åå¼åäººåæè dba åéè¿éè¯å½ä»¤éå¤è¿ä¸ªè¿ç¨ã\n\nmariadb å·²ç»åå¹¶äº alisql çè¿ä¸ªåè½ï¼æä»¥è¿ä¸¤ä¸ªå¼æºåæ¯ç®åé½æ¯æ ddl nowait/wait n è¿ä¸ªè¯­æ³ã\n\nalter table tbl_name nowait add column ...\nalter table tbl_name wait n add column ...\n\n\n1\n2\n\n\n\n# 2.3 å°ç»\n\nè¡¨éä¸è¬æ¯å¨æ°æ®åºå¼æä¸æ¯æè¡éçæ¶åæä¼è¢«ç¨å°çãå¦æä½ åç°ä½ çåºç¨ç¨åºéæ lock tables è¿æ ·çè¯­å¥ï¼ä½ éè¦è¿½æ¥ä¸ä¸ï¼æ¯è¾å¯è½çæåµæ¯ï¼\n\n * è¦ä¹æ¯ä½ çç³»ç»ç°å¨è¿å¨ç¨ myisam è¿ç±»ä¸æ¯æäºå¡çå¼æï¼é£è¦å®æåçº§æ¢å¼æï¼\n * è¦ä¹æ¯ä½ çå¼æåçº§äºï¼ä½æ¯ä»£ç è¿æ²¡åçº§ãæè§è¿è¿æ ·çæåµï¼æåä¸å¡å¼åå°±æ¯æ lock tables å unlock tables æ¹æ begin å commitï¼é®é¢å°±è§£å³äºã\n\n\n# 3. è¡é\n\nmysql çè¡éæ¯å¨å¼æå±ç±åä¸ªå¼æèªå·±å®ç°çãä½å¹¶ä¸æ¯ææçå¼æé½æ¯æè¡éï¼æ¯å¦ myisam å¼æå°±ä¸æ¯æè¡éãä¸æ¯æè¡éæå³çå¹¶åæ§å¶åªè½ä½¿ç¨è¡¨éï¼å¯¹äºè¿ç§å¼æçè¡¨ï¼åä¸å¼ è¡¨ä¸ä»»ä½æ¶å»åªè½æä¸ä¸ªæ´æ°å¨æ§è¡ï¼è¿å°±ä¼å½±åå°ä¸å¡å¹¶ååº¦ãinnodb æ¯æ¯æè¡éçï¼è¿ä¹æ¯ myisam è¢« innodb æ¿ä»£çéè¦åå ä¹ä¸ãè¿éä¸»è¦èè innodb çè¡éï¼ä»¥åå¦ä½éè¿åå°éå²çªæ¥æåä¸å¡å¹¶ååº¦ã\n\nè¡éå°±æ¯éå¯¹æ°æ®è¡¨ä¸­è¡è®°å½çéãè¿å¾å¥½çè§£ï¼æ¯å¦äºå¡ a æ´æ°äºä¸è¡ï¼èè¿æ¶åäºå¡ b ä¹è¦æ´æ°åä¸è¡ï¼åå¿é¡»ç­äºå¡ a çæä½å®æåæè½è¿è¡æ´æ°ã\n\nå½ç¶ï¼æ°æ®åºä¸­è¿æä¸äºæ²¡é£ä¹ä¸ç®äºç¶çæ¦å¿µåè®¾è®¡ï¼è¿äºæ¦å¿µå¦æçè§£åä½¿ç¨ä¸å½ï¼å®¹æå¯¼è´ç¨åºåºç°éé¢æè¡ä¸ºï¼æ¯å¦ä¸¤é¶æ®µéã\n\n\n# 3.1 ä»ä¸¤é¶æ®µéè¯´èµ·\n\næåç»ä½ ä¸¾ä¸ªä¾å­ãå¨ä¸é¢çæä½åºåä¸­ï¼äºå¡ b ç update è¯­å¥æ§è¡æ¶ä¼æ¯ä»ä¹ç°è±¡å¢ï¼åè®¾å­æ®µ id æ¯è¡¨ t çä¸»é®ã\n\nè¿ä¸ªé®é¢çç»è®ºåå³äºäºå¡ a å¨æ§è¡å®ä¸¤æ¡ update è¯­å¥åï¼ææåªäºéï¼ä»¥åå¨ä»ä¹æ¶åéæ¾ãä½ å¯ä»¥éªè¯ä¸ä¸ï¼å®éä¸äºå¡ b ç update è¯­å¥ä¼è¢«é»å¡ï¼ç´å°äºå¡ a æ§è¡ commit ä¹åï¼äºå¡ b æè½ç»§ç»­æ§è¡ã\n\nç¥éäºè¿ä¸ªç­æ¡ï¼ä½ ä¸å®ç¥éäºäºå¡ a ææçä¸¤ä¸ªè®°å½çè¡éï¼é½æ¯å¨ commit çæ¶åæéæ¾çãä¹å°±æ¯è¯´ï¼å¨ innodb äºå¡ä¸­ï¼è¡éæ¯å¨éè¦çæ¶åæå ä¸çï¼ä½å¹¶ä¸æ¯ä¸éè¦äºå°±ç«å»éæ¾ï¼èæ¯è¦ç­å°äºå¡ç»ææ¶æéæ¾ãè¿ä¸ªå°±æ¯ä¸¤é¶æ®µéåè®®ã\n\nç¥éäºè¿ä¸ªè®¾å®ï¼å¯¹æä»¬ä½¿ç¨äºå¡æä»ä¹å¸®å©å¢ï¼é£å°±æ¯ï¼å¦æä½ çäºå¡ä¸­éè¦éå¤ä¸ªè¡ï¼è¦ææå¯è½é æéå²çªãæå¯è½å½±åå¹¶ååº¦çéå°½éå¾åæ¾ãæç»ä½ ä¸¾ä¸ªä¾å­ã\n\nåè®¾ä½ è´è´£å®ç°ä¸ä¸ªçµå½±ç¥¨å¨çº¿äº¤æä¸å¡ï¼é¡¾å®¢ a è¦å¨å½±é¢ b è´­ä¹°çµå½±ç¥¨ãæä»¬ç®åä¸ç¹ï¼è¿ä¸ªä¸å¡éè¦æ¶åå°ä»¥ä¸æä½ï¼\n\n 1. ä»é¡¾å®¢ a è´¦æ·ä½é¢ä¸­æ£é¤çµå½±ç¥¨ä»·ï¼\n 2. ç»å½±é¢ b çè´¦æ·ä½é¢å¢å è¿å¼ çµå½±ç¥¨ä»·ï¼\n 3. è®°å½ä¸æ¡äº¤ææ¥å¿ã\n\nä¹å°±æ¯è¯´ï¼è¦å®æè¿ä¸ªäº¤æï¼æä»¬éè¦ update ä¸¤æ¡è®°å½ï¼å¹¶ insert ä¸æ¡è®°å½ãå½ç¶ï¼ä¸ºäºä¿è¯äº¤æçåå­æ§ï¼æä»¬è¦æè¿ä¸ä¸ªæä½æ¾å¨ä¸ä¸ªäºå¡ä¸­ãé£ä¹ï¼ä½ ä¼ææ ·å®æè¿ä¸ä¸ªè¯­å¥å¨äºå¡ä¸­çé¡ºåºå¢ï¼\n\nè¯æ³å¦æåæ¶æå¦å¤ä¸ä¸ªé¡¾å®¢ c è¦å¨å½±é¢ b ä¹°ç¥¨ï¼é£ä¹è¿ä¸¤ä¸ªäºå¡å²çªçé¨åå°±æ¯è¯­å¥ 2 äºãå ä¸ºå®ä»¬è¦æ´æ°åä¸ä¸ªå½±é¢è´¦æ·çä½é¢ï¼éè¦ä¿®æ¹åä¸è¡æ°æ®ã\n\næ ¹æ®ä¸¤é¶æ®µéåè®®ï¼ä¸è®ºä½ ææ ·å®æè¯­å¥é¡ºåºï¼ææçæä½éè¦çè¡éé½æ¯å¨äºå¡æäº¤çæ¶åæéæ¾çãæä»¥ï¼å¦æä½ æè¯­å¥ 2 å®æå¨æåï¼æ¯å¦æç§ 3ã1ã2 è¿æ ·çé¡ºåºï¼é£ä¹å½±é¢è´¦æ·ä½é¢è¿ä¸è¡çéæ¶é´å°±æå°ãè¿å°±æå¤§ç¨åº¦å°åå°äºäºå¡ä¹é´çéç­å¾ï¼æåäºå¹¶ååº¦ã\n\nå¥½äºï¼ç°å¨ç±äºä½ çæ­£ç¡®è®¾è®¡ï¼å½±é¢ä½é¢è¿ä¸è¡çè¡éå¨ä¸ä¸ªäºå¡ä¸­ä¸ä¼åçå¾é¿æ¶é´ãä½æ¯ï¼è¿å¹¶æ²¡æå®å¨è§£å³ä½ çå°æ°ãå¦æè¿ä¸ªå½±é¢åæ´»å¨ï¼å¯ä»¥ä½ä»·é¢å®ä¸å¹´åææççµå½±ç¥¨ï¼èä¸è¿ä¸ªæ´»å¨åªåä¸å¤©ãäºæ¯å¨æ´»å¨æ¶é´å¼å§çæ¶åï¼ä½ ç mysql å°±æäºãä½ ç»ä¸æå¡å¨ä¸çï¼cpu æ¶èæ¥è¿ 100%ï¼ä½æ´ä¸ªæ°æ®åºæ¯ç§å°±æ§è¡ä¸å° 100 ä¸ªäºå¡ãè¿æ¯ä»ä¹åå å¢ï¼\n\nè¿éï¼å°±è¦è¯´å°æ­»éåæ­»éæ£æµäºã\n\n\n# 3.2 æ­»éåæ­»éæ£æµ\n\nå½å¹¶åç³»ç»ä¸­ä¸åçº¿ç¨åºç°å¾ªç¯èµæºä¾èµï¼æ¶åççº¿ç¨é½å¨ç­å¾å«ççº¿ç¨éæ¾èµæºæ¶ï¼å°±ä¼å¯¼è´è¿å ä¸ªçº¿ç¨é½è¿å¥æ éç­å¾çç¶æï¼ç§°ä¸ºæ­»éãè¿éæç¨æ°æ®åºä¸­çè¡éä¸¾ä¸ªä¾å­ï¼\n\nè¿æ¶åï¼äºå¡ a å¨ç­å¾äºå¡ b éæ¾ id=2 çè¡éï¼èäºå¡ b å¨ç­å¾äºå¡ a éæ¾ id=1 çè¡éã äºå¡ a åäºå¡ b å¨äºç¸ç­å¾å¯¹æ¹çèµæºéæ¾ï¼å°±æ¯è¿å¥äºæ­»éç¶æãå½åºç°æ­»éä»¥åï¼æä¸¤ç§ç­ç¥ï¼\n\n * ä¸ç§ç­ç¥æ¯ï¼ç´æ¥è¿å¥ç­å¾ï¼ç´å°è¶æ¶ãè¿ä¸ªè¶æ¶æ¶é´å¯ä»¥éè¿åæ° innodb_lock_wait_timeout æ¥è®¾ç½®ã\n * å¦ä¸ç§ç­ç¥æ¯ï¼åèµ·æ­»éæ£æµï¼åç°æ­»éåï¼ä¸»å¨åæ»æ­»éé¾æ¡ä¸­çæä¸ä¸ªäºå¡ï¼è®©å¶ä»äºå¡å¾ä»¥ç»§ç»­æ§è¡ãå°åæ° innodb_deadlock_detect è®¾ç½®ä¸º onï¼è¡¨ç¤ºå¼å¯è¿ä¸ªé»è¾ã\n\nå¨ innodb ä¸­ï¼innodb_lock_wait_timeout çé»è®¤å¼æ¯ 50sï¼æå³çå¦æéç¨ç¬¬ä¸ä¸ªç­ç¥ï¼å½åºç°æ­»éä»¥åï¼ç¬¬ä¸ä¸ªè¢«éä½ççº¿ç¨è¦è¿ 50s æä¼è¶æ¶éåºï¼ç¶åå¶ä»çº¿ç¨ææå¯è½ç»§ç»­æ§è¡ãå¯¹äºå¨çº¿æå¡æ¥è¯´ï¼è¿ä¸ªç­å¾æ¶é´å¾å¾æ¯æ æ³æ¥åçã\n\nä½æ¯ï¼æä»¬åä¸å¯è½ç´æ¥æè¿ä¸ªæ¶é´è®¾ç½®æä¸ä¸ªå¾å°çå¼ï¼æ¯å¦ 1sãè¿æ ·å½åºç°æ­»éçæ¶åï¼ç¡®å®å¾å¿«å°±å¯ä»¥è§£å¼ï¼ä½å¦æä¸æ¯æ­»éï¼èæ¯ç®åçéç­å¾å¢ï¼æä»¥ï¼è¶æ¶æ¶é´è®¾ç½®å¤ªç­çè¯ï¼ä¼åºç°å¾å¤è¯¯ä¼¤ã\n\næä»¥ï¼æ­£å¸¸æåµä¸æä»¬è¿æ¯è¦éç¨ç¬¬äºç§ç­ç¥ï¼å³ï¼ä¸»å¨æ­»éæ£æµï¼èä¸ innodb_deadlock_detect çé»è®¤å¼æ¬èº«å°±æ¯ onãä¸»å¨æ­»éæ£æµå¨åçæ­»éçæ¶åï¼æ¯è½å¤å¿«éåç°å¹¶è¿è¡å¤ççï¼ä½æ¯å®ä¹æ¯æé¢å¤è´æçã\n\nä½ å¯ä»¥æ³è±¡ä¸ä¸è¿ä¸ªè¿ç¨ï¼æ¯å½ä¸ä¸ªäºå¡è¢«éçæ¶åï¼å°±è¦ççå®æä¾èµççº¿ç¨ææ²¡æè¢«å«äººéä½ï¼å¦æ­¤å¾ªç¯ï¼æåå¤æ­æ¯å¦åºç°äºå¾ªç¯ç­å¾ï¼ä¹å°±æ¯æ­»éãé£å¦ææ¯æä»¬ä¸é¢è¯´å°çææäºå¡é½è¦æ´æ°åä¸è¡çåºæ¯å¢ï¼æ¯ä¸ªæ°æ¥çè¢«å µä½ççº¿ç¨ï¼é½è¦å¤æ­ä¼ä¸ä¼ç±äºèªå·±çå å¥å¯¼è´äºæ­»éï¼è¿æ¯ä¸ä¸ªæ¶é´å¤æåº¦æ¯ $o(n^2)$ çæä½ãåè®¾æ 1000 ä¸ªå¹¶åçº¿ç¨è¦åæ¶æ´æ°åä¸è¡ï¼é£ä¹æ­»éæ£æµæä½å°±æ¯ 100 ä¸è¿ä¸ªéçº§çãè½ç¶æç»æ£æµçç»ææ¯æ²¡ææ­»éï¼ä½æ¯è¿æé´è¦æ¶èå¤§éç cpu èµæºãå æ­¤ï¼ä½ å°±ä¼çå° cpu å©ç¨çå¾é«ï¼ä½æ¯æ¯ç§å´æ§è¡ä¸äºå ä¸ªäºå¡ã\n\næ ¹æ®ä¸é¢çåæï¼æä»¬æ¥è®¨è®ºä¸ä¸ï¼æä¹è§£å³ç±è¿ç§ç­ç¹è¡æ´æ°å¯¼è´çæ§è½é®é¢å¢â é®é¢ççç»å¨äºï¼æ­»éæ£æµè¦èè´¹å¤§éç cpu èµæºï¼\n\n * ä¸ç§å¤´çå»å¤´çæ¹æ³ï¼å°±æ¯å¦æä½ è½ç¡®ä¿è¿ä¸ªä¸å¡ä¸å®ä¸ä¼åºç°æ­»éï¼å¯ä»¥ä¸´æ¶ææ­»éæ£æµå³æãä½æ¯è¿ç§æä½æ¬èº«å¸¦æä¸å®çé£é©ï¼å ä¸ºä¸å¡è®¾è®¡çæ¶åä¸è¬ä¸ä¼ææ­»éå½åä¸ä¸ªä¸¥ééè¯¯ï¼æ¯ç«åºç°æ­»éäºï¼å°±åæ»ï¼ç¶åéè¿ä¸å¡éè¯ä¸è¬å°±æ²¡é®é¢äºï¼è¿æ¯ä¸å¡æ æçãèå³ææ­»éæ£æµæå³çå¯è½ä¼åºç°å¤§éçè¶æ¶ï¼è¿æ¯ä¸å¡ææçã\n\n * å¦ä¸ä¸ªæè·¯æ¯æ§å¶å¹¶ååº¦ãæ ¹æ®ä¸é¢çåæï¼ä½ ä¼åç°å¦æå¹¶åè½å¤æ§å¶ä½ï¼æ¯å¦åä¸è¡åæ¶æå¤åªæ 10 ä¸ªçº¿ç¨å¨æ´æ°ï¼é£ä¹æ­»éæ£æµçææ¬å¾ä½ï¼å°±ä¸ä¼åºç°è¿ä¸ªé®é¢ãä¸ä¸ªç´æ¥çæ³æ³å°±æ¯ï¼å¨å®¢æ·ç«¯åå¹¶åæ§å¶ãä½æ¯ï¼ä½ ä¼å¾å¿«åç°è¿ä¸ªæ¹æ³ä¸å¤ªå¯è¡ï¼å ä¸ºå®¢æ·ç«¯å¾å¤ãæè§è¿ä¸ä¸ªåºç¨ï¼æ 600 ä¸ªå®¢æ·ç«¯ï¼è¿æ ·å³ä½¿æ¯ä¸ªå®¢æ·ç«¯æ§å¶å°åªæ 5 ä¸ªå¹¶åçº¿ç¨ï¼æ±æ»å°æ°æ®åºæå¡ç«¯ä»¥åï¼å³°å¼å¹¶åæ°ä¹å¯è½è¦è¾¾å° 3000ã\n\nå æ­¤ï¼è¿ä¸ªå¹¶åæ§å¶è¦åå¨æ°æ®åºæå¡ç«¯ãå¦æä½ æä¸­é´ä»¶ï¼å¯ä»¥èèå¨ä¸­é´ä»¶å®ç°ï¼å¦æä½ çå¢éæè½ä¿®æ¹ mysql æºç çäººï¼ä¹å¯ä»¥åå¨ mysql éé¢ãåºæ¬æè·¯å°±æ¯ï¼å¯¹äºç¸åè¡çæ´æ°ï¼å¨è¿å¥å¼æä¹åæéãè¿æ ·å¨ innodb åé¨å°±ä¸ä¼æå¤§éçæ­»éæ£æµå·¥ä½äºã\n\nå¯è½ä½ ä¼é®ï¼å¦æå¢ééææ¶æ²¡ææ°æ®åºæ¹é¢çä¸å®¶ï¼ä¸è½å®ç°è¿æ ·çæ¹æ¡ï¼è½ä¸è½ä»è®¾è®¡ä¸ä¼åè¿ä¸ªé®é¢å¢ â\n\n * ä½ å¯ä»¥èèéè¿å°ä¸è¡æ¹æé»è¾ä¸çå¤è¡æ¥åå°éå²çªãè¿æ¯ä»¥å½±é¢è´¦æ·ä¸ºä¾ï¼å¯ä»¥èèæ¾å¨å¤æ¡è®°å½ä¸ï¼æ¯å¦ 10 ä¸ªè®°å½ï¼å½±é¢çè´¦æ·æ»é¢ç­äºè¿ 10 ä¸ªè®°å½çå¼çæ»åãè¿æ ·æ¯æ¬¡è¦ç»å½±é¢è´¦æ·å éé¢çæ¶åï¼éæºéå¶ä¸­ä¸æ¡è®°å½æ¥å ãè¿æ ·æ¯æ¬¡å²çªæ¦çåæåæ¥ç 1/10ï¼å¯ä»¥åå°éç­å¾ä¸ªæ°ï¼ä¹å°±åå°äºæ­»éæ£æµç cpu æ¶èã\n\nè¿ä¸ªæ¹æ¡çä¸å»æ¯æ æçï¼ä½å¶å®è¿ç±»æ¹æ¡éè¦æ ¹æ®ä¸å¡é»è¾åè¯¦ç»è®¾è®¡ãå¦æè´¦æ·ä½é¢å¯è½ä¼åå°ï¼æ¯å¦éç¥¨é»è¾ï¼é£ä¹è¿æ¶åå°±éè¦èèå½ä¸é¨åè¡è®°å½åæ 0 çæ¶åï¼ä»£ç è¦æç¹æ®å¤çã\n\n\n# 3.3 å°ç»\n\nè¿ä¸å¤§èä»ç»äº mysql çè¡éï¼å¹¶ä¸»è¦æ¶åäºä¸¤é¶æ®µéåè®®ãæ­»éåæ­»éæ£æµè¿ä¸¤å¤§é¨ååå®¹ã\n\n * ä»¥ä¸¤é¶æ®µåè®®ä¸ºèµ·ç¹ï¼ä¸èµ·è®¨è®ºäºå¨å¼åçæ¶åå¦ä½å®ææ­£ç¡®çäºå¡è¯­å¥ãè¿éçåå / æç»ä½ çå»ºè®®æ¯ï¼å¦æä½ çäºå¡ä¸­éè¦éå¤ä¸ªè¡ï¼è¦ææå¯è½é æéå²çªãæå¯è½å½±åå¹¶ååº¦çéçç³è¯·æ¶æºå°½éå¾åæ¾ã\n * ä½æ¯ï¼è°æ´è¯­å¥é¡ºåºå¹¶ä¸è½å®å¨é¿åæ­»éãæä»¥æä»¬å¼å¥äºæ­»éåæ­»éæ£æµçæ¦å¿µï¼ä»¥åæä¾äºä¸ä¸ªæ¹æ¡ï¼æ¥åå°æ­»éå¯¹æ°æ®åºçå½±åãåå°æ­»éçä¸»è¦æ¹åï¼å°±æ¯æ§å¶è®¿é®ç¸åèµæºçå¹¶åäºå¡éã\n\n\n# qa\n\nqï¼å¦æä½ è¦å é¤ä¸ä¸ªè¡¨éé¢çå 10000 è¡æ°æ®ï¼æä»¥ä¸ä¸ç§æ¹æ³å¯ä»¥åå°ï¼\n\n * ç¬¬ä¸ç§ï¼ç´æ¥æ§è¡ delete from t limit 10000;\n * ç¬¬äºç§ï¼å¨ä¸ä¸ªè¿æ¥ä¸­å¾ªç¯æ§è¡ 20 æ¬¡ delete from t limit 500;\n * ç¬¬ä¸ç§ï¼å¨ 20 ä¸ªè¿æ¥ä¸­åæ¶æ§è¡ delete from t limit 500ã\n\nä½ ä¼éæ©åªä¸ç§æ¹æ³å¢ï¼ä¸ºä»ä¹å¢ï¼\n\naï¼ç¬¬äºç§æ¹å¼æ¯ç¸å¯¹è¾å¥½çã\n\n * ç¬¬ä¸ç§æ¹å¼ï¼å³ï¼ç´æ¥æ§è¡ delete from t limit 10000ï¼éé¢ï¼åä¸ªè¯­å¥å ç¨æ¶é´é¿ï¼éçæ¶é´ä¹æ¯è¾é¿ï¼èä¸å¤§äºå¡è¿ä¼å¯¼è´ä¸»ä»å»¶è¿ã\n * ç¬¬ä¸ç§æ¹å¼ï¼å³ï¼å¨ 20 ä¸ªè¿æ¥ä¸­åæ¶æ§è¡ delete from t limit 500ï¼ï¼ä¼äººä¸ºé æéå²çªã",charsets:{cjk:!0},lastUpdated:"2023/05/22, 03:07:46",lastUpdatedTimestamp:1684724866e3},{title:"change buffer",frontmatter:{title:"change buffer",date:"2023-05-23T15:10:15.000Z",permalink:"/pages/02bb58/",categories:["ä¸­é´ä»¶","MySQL","ä¸æ ï¼MySQL å®æ 45 è®²"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/06.MySQL/05.%E4%B8%93%E6%A0%8F%EF%BC%9AMySQL%20%E5%AE%9E%E6%88%98%2045%20%E8%AE%B2/06.change%20buffer.html",relativePath:"ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/06.change buffer.md",key:"v-76fe5474",path:"/pages/02bb58/",headers:[{level:2,title:"1. ä»é®é¢åå¥",slug:"_1-ä»é®é¢åå¥",normalizedTitle:"1. ä»é®é¢åå¥",charIndex:72},{level:3,title:"1.1 æ¥è¯¢è¿ç¨",slug:"_1-1-æ¥è¯¢è¿ç¨",normalizedTitle:"1.1 æ¥è¯¢è¿ç¨",charIndex:533},{level:3,title:"1.2 æ´æ°è¿ç¨",slug:"_1-2-æ´æ°è¿ç¨",normalizedTitle:"1.2 æ´æ°è¿ç¨",charIndex:922},{level:2,title:"2. change buffer çä½¿ç¨åºæ¯",slug:"_2-change-buffer-çä½¿ç¨åºæ¯",normalizedTitle:"2. change buffer çä½¿ç¨åºæ¯",charIndex:2686},{level:2,title:"3. æ®éç´¢å¼åå¯ä¸ç´¢å¼åºè¯¥æä¹éï¼",slug:"_3-æ®éç´¢å¼åå¯ä¸ç´¢å¼åºè¯¥æä¹é",normalizedTitle:"3. æ®éç´¢å¼åå¯ä¸ç´¢å¼åºè¯¥æä¹éï¼",charIndex:3238},{level:2,title:"4. change buffer å redo log",slug:"_4-change-buffer-å-redo-log",normalizedTitle:"4. change buffer å redo log",charIndex:3969},{level:2,title:"5. å°ç»",slug:"_5-å°ç»",normalizedTitle:"5. å°ç»",charIndex:5311},{level:2,title:"QA",slug:"qa",normalizedTitle:"qa",charIndex:5462}],headersStr:"1. ä»é®é¢åå¥ 1.1 æ¥è¯¢è¿ç¨ 1.2 æ´æ°è¿ç¨ 2. change buffer çä½¿ç¨åºæ¯ 3. æ®éç´¢å¼åå¯ä¸ç´¢å¼åºè¯¥æä¹éï¼ 4. change buffer å redo log 5. å°ç» QA",content:"> åèï¼09 æ®éç´¢å¼åå¯ä¸ç´¢å¼ï¼åºè¯¥æä¹éæ©ï¼| æå®¢æ¶é´\n\nè¿ä¸ç« ä¸»è¦è°è°ï¼å¨ä¸åçä¸å¡åºæ¯ä¸ï¼åºè¯¥éæ©æ®éç´¢å¼ï¼è¿æ¯å¯ä¸ç´¢å¼ï¼\n\n\n# 1. ä»é®é¢åå¥\n\nåè®¾ä½ å¨ç»´æ¤ä¸ä¸ªå¸æ°ç³»ç»ï¼æ¯ä¸ªäººé½æä¸ä¸ªå¯ä¸çèº«ä»½è¯å·ï¼èä¸ä¸å¡ä»£ç å·²ç»ä¿è¯äºä¸ä¼åå¥ä¸¤ä¸ªéå¤çèº«ä»½è¯å·ãå¦æå¸æ°ç³»ç»éè¦æç§èº«ä»½è¯å·æ¥å§åï¼å°±ä¼æ§è¡ç±»ä¼¼è¿æ ·ç SQL è¯­å¥ï¼\n\nselect name from CUser where id_card = 'xxxxxxxyyyyyyzzzzz';\n\n\n1\n\n\næä»¥ï¼ä½ ä¸å®ä¼èèå¨ id_card å­æ®µä¸å»ºç´¢å¼ãç±äºèº«ä»½è¯å·å­æ®µæ¯è¾å¤§ï¼æä¸å»ºè®®ä½ æèº«ä»½è¯å·å½åä¸»é®ï¼é£ä¹ç°å¨ä½ æä¸¤ä¸ªéæ©ï¼è¦ä¹ç» id_card å­æ®µåå»ºå¯ä¸ç´¢å¼ï¼è¦ä¹åå»ºä¸ä¸ªæ®éç´¢å¼ãå¦æä¸å¡ä»£ç å·²ç»ä¿è¯äºä¸ä¼åå¥éå¤çèº«ä»½è¯å·ï¼é£ä¹è¿ä¸¤ä¸ªéæ©é»è¾ä¸é½æ¯æ­£ç¡®çã\n\nç°å¨æè¦é®ä½ çæ¯ï¼ä»æ§è½çè§åº¦èèï¼ä½ éæ©å¯ä¸ç´¢å¼è¿æ¯æ®éç´¢å¼å¢ â éæ©çä¾æ®æ¯ä»ä¹å¢ï¼\n\nä¸ºäºæ¹ä¾¿æè¿°ï¼æä»¬åè®¾æä¸ä¸ªä¸»é®åä¸º ID çè¡¨ï¼è¡¨ä¸­æå­æ®µ kï¼å¹¶ä¸å¨ k ä¸æç´¢å¼ï¼èä¸ k å¼ä¸éå¤ãé£ä¹è¿å¼ è¡¨çç´¢å¼ç»ç»ç»æå¦ä¸ï¼\n\næ¥ä¸æ¥ï¼æä»¬å°±ä»è¿ä¸¤ç§ç´¢å¼å¯¹æ¥è¯¢è¯­å¥åæ´æ°è¯­å¥çæ§è½å½±åæ¥è¿è¡åæã\n\n\n# 1.1 æ¥è¯¢è¿ç¨\n\nåè®¾ï¼æ§è¡æ¥è¯¢çè¯­å¥æ¯ select id from T where k=5ãè¿ä¸ªæ¥è¯¢è¯­å¥å¨ç´¢å¼æ ä¸æ¥æ¾çè¿ç¨ï¼åæ¯éè¿ B+ æ ä»æ æ ¹å¼å§ï¼æå±æç´¢å°å¶å­èç¹ï¼ä¹å°±æ¯å¾ä¸­å³ä¸è§çè¿ä¸ªæ°æ®é¡µï¼ç¶åå¯ä»¥è®¤ä¸ºæ°æ®é¡µåé¨éè¿äºåæ³æ¥å®ä½è®°å½ã\n\n * å¯¹äºæ®éç´¢å¼æ¥è¯´ï¼æ¥æ¾å°æ»¡è¶³æ¡ä»¶çç¬¬ä¸ä¸ªè®°å½ (5,500) åï¼éè¦æ¥æ¾ä¸ä¸ä¸ªè®°å½ï¼ç´å°ç¢°å°ç¬¬ä¸ä¸ªä¸æ»¡è¶³ k=5 æ¡ä»¶çè®°å½ã\n * å¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼ç±äºç´¢å¼å®ä¹äºå¯ä¸æ§ï¼æ¥æ¾å°ç¬¬ä¸ä¸ªæ»¡è¶³æ¡ä»¶çè®°å½åï¼å°±ä¼åæ­¢ç»§ç»­æ£ç´¢ã\n\né£ä¹ï¼è¿ä¸ªä¸åå¸¦æ¥çæ§è½å·®è·ä¼æå¤å°å¢ï¼ç­æ¡æ¯ï¼å¾®ä¹å¶å¾®ãå ä¸º InnoDB çæ°æ®æ¯æé¡µä¸ºåä½è¯»åçï¼å æ­¤å®ä»¥é¡µä¸ºåä½å°æ´ä½è¯»å¥åå­ï¼é£ä¹ç¸é»è®°å½çæ¥æ¾ä¸å¤æ­çå¼éæå°ãèä¸æ°å¥½å¤äºè¾¹ç¼æåµå¯¼è´æ¢é¡µçæ¦çå¾ä½å¾ä½ï¼å¯ä»¥å¿½ç¥ä¸è®¡ãæä»¥ï¼ä¸¤ç§ç´¢å¼çæ¥è¯¢è¿ç¨çæ§è½å·®è·å¾®ä¹å¶å¾®ã\n\n\n# 1.2 æ´æ°è¿ç¨\n\nä¸ºäºè¯´ææ®éç´¢å¼åå¯ä¸ç´¢å¼å¯¹æ´æ°è¯­å¥æ§è½çå½±åè¿ä¸ªé®é¢ï¼æéè¦åè·ä½ ä»ç»ä¸ä¸ change bufferï¼\n\nå½éè¦æ´æ°ä¸ä¸ªæ°æ®é¡µæ¶ï¼å¦ææ°æ®é¡µå¨åå­ä¸­å°±ç´æ¥æ´æ°ï¼èå¦æè¿ä¸ªæ°æ®é¡µè¿æ²¡æå¨åå­ä¸­çè¯ï¼å¨ä¸å½±åæ°æ®ä¸è´æ§çåæä¸ï¼InnoDB ä¼å°è¿äºæ´æ°æä½ç¼å­å¨ change buffer ä¸­ï¼è¿æ ·å°±ä¸éè¦ä»ç£çä¸­è¯»å¥è¿ä¸ªæ°æ®é¡µäºãå¨ä¸æ¬¡æ¥è¯¢éè¦è®¿é®è¿ä¸ªæ°æ®é¡µçæ¶åï¼å°æ°æ®é¡µè¯»å¥åå­ï¼ç¶åæ§è¡ change buffer ä¸­ä¸è¿ä¸ªé¡µæå³çæä½ãéè¿è¿ç§æ¹å¼å°±è½ä¿è¯è¿ä¸ªæ°æ®é»è¾çæ­£ç¡®æ§ã\n\n> éè¦è¯´æçæ¯ï¼è½ç¶åå­å«ä½ change bufferï¼å®éä¸å®æ¯å¯ä»¥æä¹åçæ°æ®ãä¹å°±æ¯è¯´ï¼change buffer å¨åå­ä¸­ææ·è´ï¼ä¹ä¼è¢«åå¥å°ç£çä¸ã\n\nå° change buffer ä¸­çæä½åºç¨å°åæ°æ®é¡µï¼å¾å°ææ°ç»æçè¿ç¨ç§°ä¸º mergeãé¤äºè®¿é®è¿ä¸ªæ°æ®é¡µä¼è§¦å merge å¤ï¼ç³»ç»æåå°çº¿ç¨ä¼å®æ mergeãå¨æ°æ®åºæ­£å¸¸å³é­ï¼shutdownï¼çè¿ç¨ä¸­ï¼ä¹ä¼æ§è¡ merge æä½ã\n\nchange buffer å¯ä»¥æé«æ§è½çåå æ¯ï¼\n\n * å°æ´æ°æä½åè®°å½å¨ change bufferï¼ä»èåå°è¯»ç£çï¼è¯­å¥çæ§è¡éåº¦ä¼å¾å°ææ¾çæåã\n * æ°æ®è¯»å¥åå­æ¯éè¦å ç¨ buffer pool çï¼æä»¥ä½¿ç¨è¿ç§æ¹å¼è®©å¾å¤æ¬éè¦å è½½æ°æ®å°åå­çæä½ä¸åéè¦å ç¨åå­ï¼æé«äºåå­å©ç¨çã\n\né£ä¹ï¼ä»ä¹æ¡ä»¶ä¸å¯ä»¥ä½¿ç¨ change buffer å¢âï¼\n\nå¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼ææçæ´æ°æä½é½è¦åå¤æ­è¿ä¸ªæä½æ¯å¦è¿åå¯ä¸æ§çº¦æãæ¯å¦ï¼è¦æå¥ (4,400) è¿ä¸ªè®°å½ï¼å°±è¦åå¤æ­ç°å¨è¡¨ä¸­æ¯å¦å·²ç»å­å¨ k=4 çè®°å½ï¼èè¿å¿é¡»è¦å°æ°æ®é¡µè¯»å¥åå­æè½å¤æ­ãå¦æé½å·²ç»è¯»å¥å°åå­äºï¼é£ç´æ¥æ´æ°åå­ä¼æ´å¿«ï¼å°±æ²¡å¿è¦ä½¿ç¨ change buffer äºã\n\nå æ­¤ï¼å¯ä¸ç´¢å¼çæ´æ°å°±ä¸è½ä½¿ç¨ change bufferï¼å®éä¸ä¹åªææ®éç´¢å¼å¯ä»¥ä½¿ç¨ã\n\næ³¨æ\n\nchange buffer åªè½åºç¨å°éå¯ä¸çäºçº§ç´¢å¼ä¸ï¼ä¸éç¨äºä¸»é®ç´¢å¼ãç©ºé´ç´¢å¼ãå¨æç´¢å¼ä»¥åå¯ä¸ç´¢å¼ã\n\nchange buffer ç¨çæ¯ buffer pool éçåå­ï¼å æ­¤ä¸è½æ éå¢å¤§ãchange buffer çå¤§å°ï¼å¯ä»¥éè¿åæ° innodb_change_buffer_max_size æ¥å¨æè®¾ç½®ãè¿ä¸ªåæ°è®¾ç½®ä¸º 50 çæ¶åï¼è¡¨ç¤º change buffer çå¤§å°æå¤åªè½å ç¨ buffer pool ç 50%ã\n\nç°å¨ï¼ä½ å·²ç»çè§£äº change buffer çæºå¶ï¼é£ä¹æä»¬åä¸èµ·æ¥ççå¦æè¦å¨è¿å¼ è¡¨ä¸­æå¥ä¸ä¸ªæ°è®°å½ (4,400) çè¯ï¼InnoDB çå¤çæµç¨æ¯ææ ·çï¼\n\n * ç¬¬ä¸ç§æåµæ¯ï¼è¿ä¸ªè®°å½è¦æ´æ°çç®æ é¡µå¨åå­ä¸­ãè¿æ¶ï¼InnoDB çå¤çæµç¨å¦ä¸ï¼\n   * å¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼æ¾å° 3 å 5 ä¹é´çä½ç½®ï¼å¤æ­å°æ²¡æå²çªï¼æå¥è¿ä¸ªå¼ï¼è¯­å¥æ§è¡ç»æï¼\n   * å¯¹äºæ®éç´¢å¼æ¥è¯´ï¼æ¾å° 3 å 5 ä¹é´çä½ç½®ï¼æå¥è¿ä¸ªå¼ï¼è¯­å¥æ§è¡ç»æã\n   * è¿æ ·çæ¥ï¼æ®éç´¢å¼åå¯ä¸ç´¢å¼å¯¹æ´æ°è¯­å¥æ§è½å½±åçå·®å«ï¼åªæ¯ä¸ä¸ªå¤æ­ï¼åªä¼èè´¹å¾®å°ç CPU æ¶é´ã\n * ç¬¬äºç§æåµæ¯ï¼è¿ä¸ªè®°å½è¦æ´æ°çç®æ é¡µä¸å¨åå­ä¸­ãè¿æ¶ï¼InnoDB çå¤çæµç¨å¦ä¸ï¼\n   * å¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼éè¦å°æ°æ®é¡µè¯»å¥åå­ï¼å¤æ­å°æ²¡æå²çªï¼æå¥è¿ä¸ªå¼ï¼è¯­å¥æ§è¡ç»æï¼\n   * å¯¹äºæ®éç´¢å¼æ¥è¯´ï¼åæ¯å°æ´æ°è®°å½å¨ change bufferï¼è¯­å¥æ§è¡å°±ç»æäºã\n\nå°æ°æ®ä»ç£çè¯»å¥åå­æ¶åéæº IO çè®¿é®ï¼æ¯æ°æ®åºéé¢ææ¬æé«çæä½ä¹ä¸ãchange buffer å ä¸ºåå°äºéæºç£çè®¿é®ï¼å¯¹æ´æ°æ§è½çæåæ¯ä¼å¾ææ¾çãå¯ä»¥çåºï¼å½æè¦æå¥çè®°å½æå¨æ°æ®é¡µä¸å¨åå­ä¸­æ¶ï¼ä½¿ç¨äº change buffer çæ®éç´¢å¼çæåµå°å·ææ´å¥½çæ§è½ã\n\n> ä¹åæå°±ç¢°å°è¿ä¸ä»¶äºå¿ï¼æä¸ª DBA çåå­¦è·æåé¦è¯´ï¼ä»è´è´£çæä¸ªä¸å¡çåºåå­å½ä¸­ççªç¶ä» 99% éä½å°äº 75%ï¼æ´ä¸ªç³»ç»å¤äºé»å¡ç¶æï¼æ´æ°è¯­å¥å¨é¨å µä½ãèæ¢ç©¶å¶åå åï¼æåç°è¿ä¸ªä¸å¡æå¤§éæå¥æ°æ®çæä½ï¼èä»å¨åä¸å¤©æå¶ä¸­çæä¸ªæ®éç´¢å¼æ¹æäºå¯ä¸ç´¢å¼ã\n\n\n# 2. change buffer çä½¿ç¨åºæ¯\n\néè¿ä¸é¢çåæï¼ä½ å·²ç»æ¸æ¥äºä½¿ç¨ change buffer å¯¹æ´æ°è¿ç¨çå éä½ç¨ï¼ä¹æ¸æ¥äº change buffer åªéäºç¨å¨æ®éç´¢å¼çåºæ¯ä¸ï¼èä¸éç¨äºå¯ä¸ç´¢å¼ã\n\né£ä¹ï¼ç°å¨æä¸ä¸ªé®é¢å°±æ¯ï¼æ®éç´¢å¼çææåºæ¯ï¼ä½¿ç¨ change buffer é½å¯ä»¥èµ·å°å éä½ç¨åï¼\n\nå ä¸º merge çæ¶åæ¯çæ­£è¿è¡æ°æ®æ´æ°çæ¶å»ï¼è change buffer çä¸»è¦ç®çå°±æ¯å°è®°å½çåæ´å¨ä½ç¼å­ä¸æ¥ï¼æä»¥å¨ä¸ä¸ªæ°æ®é¡µå merge ä¹åï¼change buffer è®°å½çåæ´è¶å¤ï¼ä¹å°±æ¯è¿ä¸ªé¡µé¢ä¸è¦æ´æ°çæ¬¡æ°è¶å¤ï¼ï¼æ¶çå°±è¶å¤§ã\n\nå æ­¤ï¼å¯¹äºåå¤è¯»å°çä¸å¡æ¥è¯´ï¼é¡µé¢å¨åå®ä»¥åé©¬ä¸è¢«è®¿é®å°çæ¦çæ¯è¾å°ï¼æ­¤æ¶ change buffer çä½¿ç¨æææå¥½ãè¿ç§ä¸å¡æ¨¡åå¸¸è§çå°±æ¯è´¦åç±»ãæ¥å¿ç±»çç³»ç»ã\n\nåè¿æ¥ï¼åè®¾ä¸ä¸ªä¸å¡çæ´æ°æ¨¡å¼æ¯åå¥ä¹åé©¬ä¸ä¼åæ¥è¯¢ï¼é£ä¹å³ä½¿æ»¡è¶³äºæ¡ä»¶ï¼å°æ´æ°åè®°å½å¨ change bufferï¼ä½ä¹åç±äºé©¬ä¸è¦è®¿é®è¿ä¸ªæ°æ®é¡µï¼ä¼ç«å³è§¦å merge è¿ç¨ãè¿æ ·éæºè®¿é® IO çæ¬¡æ°ä¸ä¼åå°ï¼åèå¢å äº change buffer çç»´æ¤ä»£ä»·ãæä»¥ï¼å¯¹äºè¿ç§ä¸å¡æ¨¡å¼æ¥è¯´ï¼change buffer åèèµ·å°äºå¯ä½ç¨ã\n\n\n# 3. æ®éç´¢å¼åå¯ä¸ç´¢å¼åºè¯¥æä¹éï¼\n\nåå°æä»¬æç« å¼å¤´çé®é¢ï¼æ®éç´¢å¼åå¯ä¸ç´¢å¼åºè¯¥æä¹éæ©ãå¶å®ï¼è¿ä¸¤ç±»ç´¢å¼å¨æ¥è¯¢è½åä¸æ¯æ²¡å·®å«çï¼ä¸»è¦èèçæ¯å¯¹æ´æ°æ§è½çå½±åãæä»¥ï¼æå»ºè®®ä½ å°½ééæ©æ®éç´¢å¼ã\n\nå¦æææçæ´æ°åé¢ï¼é½é©¬ä¸ä¼´éçå¯¹è¿ä¸ªè®°å½çæ¥è¯¢ï¼é£ä¹ä½ åºè¯¥å³é­ change bufferãèå¨å¶ä»æåµä¸ï¼change buffer é½è½æåæ´æ°æ§è½ã\n\nå¨å®éä½¿ç¨ä¸­ï¼ä½ ä¼åç°ï¼æ®éç´¢å¼å change buffer çéåä½¿ç¨ï¼å¯¹äºæ°æ®éå¤§çè¡¨çæ´æ°ä¼åè¿æ¯å¾ææ¾çã\n\nç¹å«å°ï¼å¨ä½¿ç¨æºæ¢°ç¡¬çæ¶ï¼change buffer è¿ä¸ªæºå¶çæ¶ææ¯éå¸¸æ¾èçãæä»¥ï¼å½ä½ æä¸ä¸ªç±»ä¼¼âåå²æ°æ®âçåºï¼å¹¶ä¸åºäºææ¬èèç¨çæ¯æºæ¢°ç¡¬çæ¶ï¼é£ä½ åºè¯¥ç¹å«å³æ³¨è¿äºè¡¨éçç´¢å¼ï¼å°½éä½¿ç¨æ®éç´¢å¼ï¼ç¶åæ change buffer å°½éå¼å¤§ï¼ä»¥ç¡®ä¿è¿ä¸ªâåå²æ°æ®âè¡¨çæ°æ®åå¥éåº¦ã\n\nå³äºå®éä¸­ä¸å¡å¯è½æ æ³ä¿è¯å¯ä¸æ§çæåµ\n * é¦åï¼ä¸å¡æ­£ç¡®æ§ä¼åãå±ä»¬è¿ç¯æç« çåææ¯âä¸å¡ä»£ç å·²ç»ä¿è¯ä¸ä¼åå¥éå¤æ°æ®âçæåµä¸ï¼è®¨è®ºæ§è½é®é¢ãå¦æä¸å¡ä¸è½ä¿è¯ï¼æèä¸å¡å°±æ¯è¦æ±æ°æ®åºæ¥åçº¦æï¼é£ä¹æ²¡å¾éï¼å¿é¡»åå»ºå¯ä¸ç´¢å¼ãè¿ç§æåµä¸ï¼æ¬ç¯æç« çæä¹å¨äºï¼å¦æç¢°ä¸äºå¤§éæå¥æ°æ®æ¢ãåå­å½ä¸­çä½çæ¶åï¼å¯ä»¥ç»ä½ å¤æä¾ä¸ä¸ªææ¥æè·¯ã\n * ç¶åï¼å¨ä¸äºâå½æ¡£åºâçåºæ¯ï¼ä½ æ¯å¯ä»¥èèä½¿ç¨æ®éç´¢å¼çãæ¯å¦ï¼çº¿ä¸æ°æ®åªéè¦ä¿çåå¹´ï¼ç¶ååå²æ°æ®ä¿å­å¨å½æ¡£åºãè¿æ¶åï¼å½æ¡£æ°æ®å·²ç»æ¯ç¡®ä¿æ²¡æå¯ä¸é®å²çªäºãè¦æé«å½æ¡£æçï¼å¯ä»¥èèæè¡¨éé¢çå¯ä¸ç´¢å¼æ¹ææ®éç´¢å¼ã\n * æå®¢æ¶é´çæææ: https://time.geekbang.org/column/article/70848\n\n\n# 4. change buffer å redo log\n\nçè§£äº change buffer çåçï¼ä½ å¯è½ä¼èæ³å°æå¨åé¢æç« ä¸­åä½ ä»ç»è¿ç redo log å WALã\n\nWAL æåæ§è½çæ ¸å¿æºå¶ï¼ä¹çç¡®æ¯å°½éåå°éæºè¯»åï¼è¿ä¸¤ä¸ªæ¦å¿µç¡®å®å®¹ææ··æ·ãæä»¥ï¼è¿éææå®ä»¬æ¾å°äºåä¸ä¸ªæµç¨éæ¥è¯´æï¼ä¾¿äºä½ åºåè¿ä¸¤ä¸ªæ¦å¿µã\n\nç°å¨ï¼æä»¬è¦å¨è¡¨ä¸æ§è¡è¿ä¸ªæå¥è¯­å¥ï¼\n\ninsert into t(id,k) values (id1,k1), (id2,k2);\n\n\n1\n\n\nè¿éï¼æä»¬åè®¾å½å k ç´¢å¼æ çç¶æï¼æ¥æ¾å°ä½ç½®åï¼k1 æå¨çæ°æ®é¡µå¨åå­ (InnoDB buffer pool) ä¸­ï¼k2 æå¨çæ°æ®é¡µä¸å¨åå­ä¸­ãå¦ä¸å¾æ¯å¸¦ change buffer çæ´æ°ç¶æå¾ï¼\n\nåæè¿æ¡æ´æ°è¯­å¥ï¼ä½ ä¼åç°å®æ¶åäºåä¸ªé¨åï¼åå­ãredo logï¼ib_log_fileXï¼ã æ°æ®è¡¨ç©ºé´ï¼t.ibdï¼ãç³»ç»è¡¨ç©ºé´ï¼ibdata1ï¼ã\n\n> ç³»ç»è¡¨ç©ºé´å°±æ¯ç¨æ¥æ¾ç³»ç»ä¿¡æ¯çï¼æ¯å¦æ°æ®å­å¸ä»ä¹çï¼å¯¹åºçç£çæä»¶æ¯ ibdata1, æ°æ®è¡¨ç©ºé´å°±æ¯ä¸ä¸ªä¸ªçè¡¨æ°æ®æä»¶ï¼å¯¹åºçç£çæä»¶å°±æ¯ è¡¨å.ibdã\n\nè¿æ¡æ´æ°è¯­å¥åäºå¦ä¸çæä½ï¼æç§å¾ä¸­çæ°å­é¡ºåºï¼ï¼\n\n 1. Page 1 å¨åå­ä¸­ï¼ç´æ¥æ´æ°åå­ï¼\n 2. Page 2 æ²¡æå¨åå­ä¸­ï¼å°±å¨åå­ç change buffer åºåï¼è®°å½ä¸âæè¦å¾ Page 2 æå¥ä¸è¡âè¿ä¸ªä¿¡æ¯\n 3. å°ä¸è¿°ä¸¤ä¸ªå¨ä½è®°å¥ redo log ä¸­ï¼å¾ä¸­ 3 å 4ï¼ã\n\nåå®ä¸é¢è¿äºï¼äºå¡å°±å¯ä»¥å®æäºãæä»¥ï¼ä½ ä¼çå°ï¼æ§è¡è¿æ¡æ´æ°è¯­å¥çææ¬å¾ä½ï¼å°±æ¯åäºä¸¤å¤åå­ï¼ç¶ååäºä¸å¤ç£çï¼ä¸¤æ¬¡æä½åå¨ä¸èµ·åäºä¸æ¬¡ç£çï¼ï¼èä¸è¿æ¯é¡ºåºåçãåæ¶ï¼å¾ä¸­çä¸¤ä¸ªèçº¿ç®­å¤´ï¼æ¯åå°æä½ï¼ä¸å½±åæ´æ°çååºæ¶é´ã\n\né£å¨è¿ä¹åçè¯»è¯·æ±ï¼è¦æä¹å¤çå¢ï¼\n\næ¯å¦ï¼æä»¬ç°å¨è¦æ§è¡ select * from t where k in (k1, k2)ãè¿éï¼æç»äºè¿ä¸¤ä¸ªè¯»è¯·æ±çæµç¨å¾ã\n\nå¦æè¯»è¯­å¥åçå¨æ´æ°è¯­å¥åä¸ä¹ï¼åå­ä¸­çæ°æ®é½è¿å¨ï¼é£ä¹æ­¤æ¶çè¿ä¸¤ä¸ªè¯»æä½å°±ä¸ç³»ç»è¡¨ç©ºé´ï¼ibdata1ï¼å redo logï¼ib_log_fileXï¼æ å³äºãæä»¥ï¼æå¨å¾ä¸­å°±æ²¡ç»åºè¿ä¸¤é¨åï¼\n\nä»å¾ä¸­å¯ä»¥çå°ï¼\n\n 1. è¯» Page 1 çæ¶åï¼ç´æ¥ä»åå­è¿åãæå ä½åå­¦å¨åé¢æç« çè¯è®ºä¸­é®å°ï¼WAL ä¹åå¦æè¯»æ°æ®ï¼æ¯ä¸æ¯ä¸å®è¦è¯»çï¼æ¯ä¸æ¯ä¸å®è¦ä» redo log éé¢ææ°æ®æ´æ°ä»¥åæå¯ä»¥è¿åï¼å¶å®æ¯ä¸ç¨çãä½ å¯ä»¥çä¸ä¸å¾ 3 çè¿ä¸ªç¶æï¼è½ç¶ç£çä¸è¿æ¯ä¹åçæ°æ®ï¼ä½æ¯è¿éç´æ¥ä»åå­è¿åç»æï¼ç»ææ¯æ­£ç¡®çã\n 2. è¦è¯» Page 2 çæ¶åï¼éè¦æ Page 2 ä»ç£çè¯»å¥åå­ä¸­ï¼ç¶ååºç¨ change buffer éé¢çæä½æ¥å¿ï¼çæä¸ä¸ªæ­£ç¡®ççæ¬å¹¶è¿åç»æã\n\nå¯ä»¥çå°ï¼ç´å°éè¦è¯» Page 2 çæ¶åï¼è¿ä¸ªæ°æ®é¡µæä¼è¢«è¯»å¥åå­ã\n\næä»¥ï¼å¦æè¦ç®åå°å¯¹æ¯è¿ä¸¤ä¸ªæºå¶å¨æåæ´æ°æ§è½ä¸çæ¶ççè¯ï¼redo log ä¸»è¦èççæ¯éæºåç£çç IO æ¶èï¼è½¬æé¡ºåºåï¼ï¼è change buffer ä¸»è¦èççåæ¯éæºè¯»ç£çç IO æ¶èã\n\n\n# 5. å°ç»\n\nä»å¤©ä»æ®éç´¢å¼åå¯ä¸ç´¢å¼çéæ©å¼å§ï¼åäº«äºæ°æ®çæ¥è¯¢åæ´æ°è¿ç¨ï¼ç¶åè¯´æäº change buffer çæºå¶ä»¥ååºç¨åºæ¯ï¼æåè®²å°äºç´¢å¼éæ©çå®è·µã\n\nç±äºå¯ä¸ç´¢å¼ç¨ä¸ä¸ change buffer çä¼åæºå¶ï¼å æ­¤å¦æä¸å¡å¯ä»¥æ¥åï¼ä»æ§è½è§åº¦åºåæå»ºè®®ä½ ä¼åèèéå¯ä¸ç´¢å¼ã\n\n\n# QA\n\nQï¼change buffer ä¸å¼å§æ¯ååå­çï¼é£ä¹å¦æè¿ä¸ªæ¶åæºå¨æçµéå¯ï¼ä¼ä¸ä¼å¯¼è´ change buffer ä¸¢å¤±å¢ï¼change buffer ä¸¢å¤±å¯ä¸æ¯å°äºå¿ï¼åä»ç£çè¯»å¥æ°æ®å¯å°±æ²¡æäº merge è¿ç¨ï¼å°±ç­äºæ¯æ°æ®ä¸¢å¤±äºãä¼ä¸ä¼åºç°è¿ç§æåµå¢ï¼",normalizedContent:"> åèï¼09 æ®éç´¢å¼åå¯ä¸ç´¢å¼ï¼åºè¯¥æä¹éæ©ï¼| æå®¢æ¶é´\n\nè¿ä¸ç« ä¸»è¦è°è°ï¼å¨ä¸åçä¸å¡åºæ¯ä¸ï¼åºè¯¥éæ©æ®éç´¢å¼ï¼è¿æ¯å¯ä¸ç´¢å¼ï¼\n\n\n# 1. ä»é®é¢åå¥\n\nåè®¾ä½ å¨ç»´æ¤ä¸ä¸ªå¸æ°ç³»ç»ï¼æ¯ä¸ªäººé½æä¸ä¸ªå¯ä¸çèº«ä»½è¯å·ï¼èä¸ä¸å¡ä»£ç å·²ç»ä¿è¯äºä¸ä¼åå¥ä¸¤ä¸ªéå¤çèº«ä»½è¯å·ãå¦æå¸æ°ç³»ç»éè¦æç§èº«ä»½è¯å·æ¥å§åï¼å°±ä¼æ§è¡ç±»ä¼¼è¿æ ·ç sql è¯­å¥ï¼\n\nselect name from cuser where id_card = 'xxxxxxxyyyyyyzzzzz';\n\n\n1\n\n\næä»¥ï¼ä½ ä¸å®ä¼èèå¨ id_card å­æ®µä¸å»ºç´¢å¼ãç±äºèº«ä»½è¯å·å­æ®µæ¯è¾å¤§ï¼æä¸å»ºè®®ä½ æèº«ä»½è¯å·å½åä¸»é®ï¼é£ä¹ç°å¨ä½ æä¸¤ä¸ªéæ©ï¼è¦ä¹ç» id_card å­æ®µåå»ºå¯ä¸ç´¢å¼ï¼è¦ä¹åå»ºä¸ä¸ªæ®éç´¢å¼ãå¦æä¸å¡ä»£ç å·²ç»ä¿è¯äºä¸ä¼åå¥éå¤çèº«ä»½è¯å·ï¼é£ä¹è¿ä¸¤ä¸ªéæ©é»è¾ä¸é½æ¯æ­£ç¡®çã\n\nç°å¨æè¦é®ä½ çæ¯ï¼ä»æ§è½çè§åº¦èèï¼ä½ éæ©å¯ä¸ç´¢å¼è¿æ¯æ®éç´¢å¼å¢ â éæ©çä¾æ®æ¯ä»ä¹å¢ï¼\n\nä¸ºäºæ¹ä¾¿æè¿°ï¼æä»¬åè®¾æä¸ä¸ªä¸»é®åä¸º id çè¡¨ï¼è¡¨ä¸­æå­æ®µ kï¼å¹¶ä¸å¨ k ä¸æç´¢å¼ï¼èä¸ k å¼ä¸éå¤ãé£ä¹è¿å¼ è¡¨çç´¢å¼ç»ç»ç»æå¦ä¸ï¼\n\næ¥ä¸æ¥ï¼æä»¬å°±ä»è¿ä¸¤ç§ç´¢å¼å¯¹æ¥è¯¢è¯­å¥åæ´æ°è¯­å¥çæ§è½å½±åæ¥è¿è¡åæã\n\n\n# 1.1 æ¥è¯¢è¿ç¨\n\nåè®¾ï¼æ§è¡æ¥è¯¢çè¯­å¥æ¯ select id from t where k=5ãè¿ä¸ªæ¥è¯¢è¯­å¥å¨ç´¢å¼æ ä¸æ¥æ¾çè¿ç¨ï¼åæ¯éè¿ b+ æ ä»æ æ ¹å¼å§ï¼æå±æç´¢å°å¶å­èç¹ï¼ä¹å°±æ¯å¾ä¸­å³ä¸è§çè¿ä¸ªæ°æ®é¡µï¼ç¶åå¯ä»¥è®¤ä¸ºæ°æ®é¡µåé¨éè¿äºåæ³æ¥å®ä½è®°å½ã\n\n * å¯¹äºæ®éç´¢å¼æ¥è¯´ï¼æ¥æ¾å°æ»¡è¶³æ¡ä»¶çç¬¬ä¸ä¸ªè®°å½ (5,500) åï¼éè¦æ¥æ¾ä¸ä¸ä¸ªè®°å½ï¼ç´å°ç¢°å°ç¬¬ä¸ä¸ªä¸æ»¡è¶³ k=5 æ¡ä»¶çè®°å½ã\n * å¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼ç±äºç´¢å¼å®ä¹äºå¯ä¸æ§ï¼æ¥æ¾å°ç¬¬ä¸ä¸ªæ»¡è¶³æ¡ä»¶çè®°å½åï¼å°±ä¼åæ­¢ç»§ç»­æ£ç´¢ã\n\né£ä¹ï¼è¿ä¸ªä¸åå¸¦æ¥çæ§è½å·®è·ä¼æå¤å°å¢ï¼ç­æ¡æ¯ï¼å¾®ä¹å¶å¾®ãå ä¸º innodb çæ°æ®æ¯æé¡µä¸ºåä½è¯»åçï¼å æ­¤å®ä»¥é¡µä¸ºåä½å°æ´ä½è¯»å¥åå­ï¼é£ä¹ç¸é»è®°å½çæ¥æ¾ä¸å¤æ­çå¼éæå°ãèä¸æ°å¥½å¤äºè¾¹ç¼æåµå¯¼è´æ¢é¡µçæ¦çå¾ä½å¾ä½ï¼å¯ä»¥å¿½ç¥ä¸è®¡ãæä»¥ï¼ä¸¤ç§ç´¢å¼çæ¥è¯¢è¿ç¨çæ§è½å·®è·å¾®ä¹å¶å¾®ã\n\n\n# 1.2 æ´æ°è¿ç¨\n\nä¸ºäºè¯´ææ®éç´¢å¼åå¯ä¸ç´¢å¼å¯¹æ´æ°è¯­å¥æ§è½çå½±åè¿ä¸ªé®é¢ï¼æéè¦åè·ä½ ä»ç»ä¸ä¸ change bufferï¼\n\nå½éè¦æ´æ°ä¸ä¸ªæ°æ®é¡µæ¶ï¼å¦ææ°æ®é¡µå¨åå­ä¸­å°±ç´æ¥æ´æ°ï¼èå¦æè¿ä¸ªæ°æ®é¡µè¿æ²¡æå¨åå­ä¸­çè¯ï¼å¨ä¸å½±åæ°æ®ä¸è´æ§çåæä¸ï¼innodb ä¼å°è¿äºæ´æ°æä½ç¼å­å¨ change buffer ä¸­ï¼è¿æ ·å°±ä¸éè¦ä»ç£çä¸­è¯»å¥è¿ä¸ªæ°æ®é¡µäºãå¨ä¸æ¬¡æ¥è¯¢éè¦è®¿é®è¿ä¸ªæ°æ®é¡µçæ¶åï¼å°æ°æ®é¡µè¯»å¥åå­ï¼ç¶åæ§è¡ change buffer ä¸­ä¸è¿ä¸ªé¡µæå³çæä½ãéè¿è¿ç§æ¹å¼å°±è½ä¿è¯è¿ä¸ªæ°æ®é»è¾çæ­£ç¡®æ§ã\n\n> éè¦è¯´æçæ¯ï¼è½ç¶åå­å«ä½ change bufferï¼å®éä¸å®æ¯å¯ä»¥æä¹åçæ°æ®ãä¹å°±æ¯è¯´ï¼change buffer å¨åå­ä¸­ææ·è´ï¼ä¹ä¼è¢«åå¥å°ç£çä¸ã\n\nå° change buffer ä¸­çæä½åºç¨å°åæ°æ®é¡µï¼å¾å°ææ°ç»æçè¿ç¨ç§°ä¸º mergeãé¤äºè®¿é®è¿ä¸ªæ°æ®é¡µä¼è§¦å merge å¤ï¼ç³»ç»æåå°çº¿ç¨ä¼å®æ mergeãå¨æ°æ®åºæ­£å¸¸å³é­ï¼shutdownï¼çè¿ç¨ä¸­ï¼ä¹ä¼æ§è¡ merge æä½ã\n\nchange buffer å¯ä»¥æé«æ§è½çåå æ¯ï¼\n\n * å°æ´æ°æä½åè®°å½å¨ change bufferï¼ä»èåå°è¯»ç£çï¼è¯­å¥çæ§è¡éåº¦ä¼å¾å°ææ¾çæåã\n * æ°æ®è¯»å¥åå­æ¯éè¦å ç¨ buffer pool çï¼æä»¥ä½¿ç¨è¿ç§æ¹å¼è®©å¾å¤æ¬éè¦å è½½æ°æ®å°åå­çæä½ä¸åéè¦å ç¨åå­ï¼æé«äºåå­å©ç¨çã\n\né£ä¹ï¼ä»ä¹æ¡ä»¶ä¸å¯ä»¥ä½¿ç¨ change buffer å¢âï¼\n\nå¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼ææçæ´æ°æä½é½è¦åå¤æ­è¿ä¸ªæä½æ¯å¦è¿åå¯ä¸æ§çº¦æãæ¯å¦ï¼è¦æå¥ (4,400) è¿ä¸ªè®°å½ï¼å°±è¦åå¤æ­ç°å¨è¡¨ä¸­æ¯å¦å·²ç»å­å¨ k=4 çè®°å½ï¼èè¿å¿é¡»è¦å°æ°æ®é¡µè¯»å¥åå­æè½å¤æ­ãå¦æé½å·²ç»è¯»å¥å°åå­äºï¼é£ç´æ¥æ´æ°åå­ä¼æ´å¿«ï¼å°±æ²¡å¿è¦ä½¿ç¨ change buffer äºã\n\nå æ­¤ï¼å¯ä¸ç´¢å¼çæ´æ°å°±ä¸è½ä½¿ç¨ change bufferï¼å®éä¸ä¹åªææ®éç´¢å¼å¯ä»¥ä½¿ç¨ã\n\næ³¨æ\n\nchange buffer åªè½åºç¨å°éå¯ä¸çäºçº§ç´¢å¼ä¸ï¼ä¸éç¨äºä¸»é®ç´¢å¼ãç©ºé´ç´¢å¼ãå¨æç´¢å¼ä»¥åå¯ä¸ç´¢å¼ã\n\nchange buffer ç¨çæ¯ buffer pool éçåå­ï¼å æ­¤ä¸è½æ éå¢å¤§ãchange buffer çå¤§å°ï¼å¯ä»¥éè¿åæ° innodb_change_buffer_max_size æ¥å¨æè®¾ç½®ãè¿ä¸ªåæ°è®¾ç½®ä¸º 50 çæ¶åï¼è¡¨ç¤º change buffer çå¤§å°æå¤åªè½å ç¨ buffer pool ç 50%ã\n\nç°å¨ï¼ä½ å·²ç»çè§£äº change buffer çæºå¶ï¼é£ä¹æä»¬åä¸èµ·æ¥ççå¦æè¦å¨è¿å¼ è¡¨ä¸­æå¥ä¸ä¸ªæ°è®°å½ (4,400) çè¯ï¼innodb çå¤çæµç¨æ¯ææ ·çï¼\n\n * ç¬¬ä¸ç§æåµæ¯ï¼è¿ä¸ªè®°å½è¦æ´æ°çç®æ é¡µå¨åå­ä¸­ãè¿æ¶ï¼innodb çå¤çæµç¨å¦ä¸ï¼\n   * å¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼æ¾å° 3 å 5 ä¹é´çä½ç½®ï¼å¤æ­å°æ²¡æå²çªï¼æå¥è¿ä¸ªå¼ï¼è¯­å¥æ§è¡ç»æï¼\n   * å¯¹äºæ®éç´¢å¼æ¥è¯´ï¼æ¾å° 3 å 5 ä¹é´çä½ç½®ï¼æå¥è¿ä¸ªå¼ï¼è¯­å¥æ§è¡ç»æã\n   * è¿æ ·çæ¥ï¼æ®éç´¢å¼åå¯ä¸ç´¢å¼å¯¹æ´æ°è¯­å¥æ§è½å½±åçå·®å«ï¼åªæ¯ä¸ä¸ªå¤æ­ï¼åªä¼èè´¹å¾®å°ç cpu æ¶é´ã\n * ç¬¬äºç§æåµæ¯ï¼è¿ä¸ªè®°å½è¦æ´æ°çç®æ é¡µä¸å¨åå­ä¸­ãè¿æ¶ï¼innodb çå¤çæµç¨å¦ä¸ï¼\n   * å¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼éè¦å°æ°æ®é¡µè¯»å¥åå­ï¼å¤æ­å°æ²¡æå²çªï¼æå¥è¿ä¸ªå¼ï¼è¯­å¥æ§è¡ç»æï¼\n   * å¯¹äºæ®éç´¢å¼æ¥è¯´ï¼åæ¯å°æ´æ°è®°å½å¨ change bufferï¼è¯­å¥æ§è¡å°±ç»æäºã\n\nå°æ°æ®ä»ç£çè¯»å¥åå­æ¶åéæº io çè®¿é®ï¼æ¯æ°æ®åºéé¢ææ¬æé«çæä½ä¹ä¸ãchange buffer å ä¸ºåå°äºéæºç£çè®¿é®ï¼å¯¹æ´æ°æ§è½çæåæ¯ä¼å¾ææ¾çãå¯ä»¥çåºï¼å½æè¦æå¥çè®°å½æå¨æ°æ®é¡µä¸å¨åå­ä¸­æ¶ï¼ä½¿ç¨äº change buffer çæ®éç´¢å¼çæåµå°å·ææ´å¥½çæ§è½ã\n\n> ä¹åæå°±ç¢°å°è¿ä¸ä»¶äºå¿ï¼æä¸ª dba çåå­¦è·æåé¦è¯´ï¼ä»è´è´£çæä¸ªä¸å¡çåºåå­å½ä¸­ççªç¶ä» 99% éä½å°äº 75%ï¼æ´ä¸ªç³»ç»å¤äºé»å¡ç¶æï¼æ´æ°è¯­å¥å¨é¨å µä½ãèæ¢ç©¶å¶åå åï¼æåç°è¿ä¸ªä¸å¡æå¤§éæå¥æ°æ®çæä½ï¼èä»å¨åä¸å¤©æå¶ä¸­çæä¸ªæ®éç´¢å¼æ¹æäºå¯ä¸ç´¢å¼ã\n\n\n# 2. change buffer çä½¿ç¨åºæ¯\n\néè¿ä¸é¢çåæï¼ä½ å·²ç»æ¸æ¥äºä½¿ç¨ change buffer å¯¹æ´æ°è¿ç¨çå éä½ç¨ï¼ä¹æ¸æ¥äº change buffer åªéäºç¨å¨æ®éç´¢å¼çåºæ¯ä¸ï¼èä¸éç¨äºå¯ä¸ç´¢å¼ã\n\né£ä¹ï¼ç°å¨æä¸ä¸ªé®é¢å°±æ¯ï¼æ®éç´¢å¼çææåºæ¯ï¼ä½¿ç¨ change buffer é½å¯ä»¥èµ·å°å éä½ç¨åï¼\n\nå ä¸º merge çæ¶åæ¯çæ­£è¿è¡æ°æ®æ´æ°çæ¶å»ï¼è change buffer çä¸»è¦ç®çå°±æ¯å°è®°å½çåæ´å¨ä½ç¼å­ä¸æ¥ï¼æä»¥å¨ä¸ä¸ªæ°æ®é¡µå merge ä¹åï¼change buffer è®°å½çåæ´è¶å¤ï¼ä¹å°±æ¯è¿ä¸ªé¡µé¢ä¸è¦æ´æ°çæ¬¡æ°è¶å¤ï¼ï¼æ¶çå°±è¶å¤§ã\n\nå æ­¤ï¼å¯¹äºåå¤è¯»å°çä¸å¡æ¥è¯´ï¼é¡µé¢å¨åå®ä»¥åé©¬ä¸è¢«è®¿é®å°çæ¦çæ¯è¾å°ï¼æ­¤æ¶ change buffer çä½¿ç¨æææå¥½ãè¿ç§ä¸å¡æ¨¡åå¸¸è§çå°±æ¯è´¦åç±»ãæ¥å¿ç±»çç³»ç»ã\n\nåè¿æ¥ï¼åè®¾ä¸ä¸ªä¸å¡çæ´æ°æ¨¡å¼æ¯åå¥ä¹åé©¬ä¸ä¼åæ¥è¯¢ï¼é£ä¹å³ä½¿æ»¡è¶³äºæ¡ä»¶ï¼å°æ´æ°åè®°å½å¨ change bufferï¼ä½ä¹åç±äºé©¬ä¸è¦è®¿é®è¿ä¸ªæ°æ®é¡µï¼ä¼ç«å³è§¦å merge è¿ç¨ãè¿æ ·éæºè®¿é® io çæ¬¡æ°ä¸ä¼åå°ï¼åèå¢å äº change buffer çç»´æ¤ä»£ä»·ãæä»¥ï¼å¯¹äºè¿ç§ä¸å¡æ¨¡å¼æ¥è¯´ï¼change buffer åèèµ·å°äºå¯ä½ç¨ã\n\n\n# 3. æ®éç´¢å¼åå¯ä¸ç´¢å¼åºè¯¥æä¹éï¼\n\nåå°æä»¬æç« å¼å¤´çé®é¢ï¼æ®éç´¢å¼åå¯ä¸ç´¢å¼åºè¯¥æä¹éæ©ãå¶å®ï¼è¿ä¸¤ç±»ç´¢å¼å¨æ¥è¯¢è½åä¸æ¯æ²¡å·®å«çï¼ä¸»è¦èèçæ¯å¯¹æ´æ°æ§è½çå½±åãæä»¥ï¼æå»ºè®®ä½ å°½ééæ©æ®éç´¢å¼ã\n\nå¦æææçæ´æ°åé¢ï¼é½é©¬ä¸ä¼´éçå¯¹è¿ä¸ªè®°å½çæ¥è¯¢ï¼é£ä¹ä½ åºè¯¥å³é­ change bufferãèå¨å¶ä»æåµä¸ï¼change buffer é½è½æåæ´æ°æ§è½ã\n\nå¨å®éä½¿ç¨ä¸­ï¼ä½ ä¼åç°ï¼æ®éç´¢å¼å change buffer çéåä½¿ç¨ï¼å¯¹äºæ°æ®éå¤§çè¡¨çæ´æ°ä¼åè¿æ¯å¾ææ¾çã\n\nç¹å«å°ï¼å¨ä½¿ç¨æºæ¢°ç¡¬çæ¶ï¼change buffer è¿ä¸ªæºå¶çæ¶ææ¯éå¸¸æ¾èçãæä»¥ï¼å½ä½ æä¸ä¸ªç±»ä¼¼âåå²æ°æ®âçåºï¼å¹¶ä¸åºäºææ¬èèç¨çæ¯æºæ¢°ç¡¬çæ¶ï¼é£ä½ åºè¯¥ç¹å«å³æ³¨è¿äºè¡¨éçç´¢å¼ï¼å°½éä½¿ç¨æ®éç´¢å¼ï¼ç¶åæ change buffer å°½éå¼å¤§ï¼ä»¥ç¡®ä¿è¿ä¸ªâåå²æ°æ®âè¡¨çæ°æ®åå¥éåº¦ã\n\nå³äºå®éä¸­ä¸å¡å¯è½æ æ³ä¿è¯å¯ä¸æ§çæåµ\n * é¦åï¼ä¸å¡æ­£ç¡®æ§ä¼åãå±ä»¬è¿ç¯æç« çåææ¯âä¸å¡ä»£ç å·²ç»ä¿è¯ä¸ä¼åå¥éå¤æ°æ®âçæåµä¸ï¼è®¨è®ºæ§è½é®é¢ãå¦æä¸å¡ä¸è½ä¿è¯ï¼æèä¸å¡å°±æ¯è¦æ±æ°æ®åºæ¥åçº¦æï¼é£ä¹æ²¡å¾éï¼å¿é¡»åå»ºå¯ä¸ç´¢å¼ãè¿ç§æåµä¸ï¼æ¬ç¯æç« çæä¹å¨äºï¼å¦æç¢°ä¸äºå¤§éæå¥æ°æ®æ¢ãåå­å½ä¸­çä½çæ¶åï¼å¯ä»¥ç»ä½ å¤æä¾ä¸ä¸ªææ¥æè·¯ã\n * ç¶åï¼å¨ä¸äºâå½æ¡£åºâçåºæ¯ï¼ä½ æ¯å¯ä»¥èèä½¿ç¨æ®éç´¢å¼çãæ¯å¦ï¼çº¿ä¸æ°æ®åªéè¦ä¿çåå¹´ï¼ç¶ååå²æ°æ®ä¿å­å¨å½æ¡£åºãè¿æ¶åï¼å½æ¡£æ°æ®å·²ç»æ¯ç¡®ä¿æ²¡æå¯ä¸é®å²çªäºãè¦æé«å½æ¡£æçï¼å¯ä»¥èèæè¡¨éé¢çå¯ä¸ç´¢å¼æ¹ææ®éç´¢å¼ã\n * æå®¢æ¶é´çæææ: https://time.geekbang.org/column/article/70848\n\n\n# 4. change buffer å redo log\n\nçè§£äº change buffer çåçï¼ä½ å¯è½ä¼èæ³å°æå¨åé¢æç« ä¸­åä½ ä»ç»è¿ç redo log å walã\n\nwal æåæ§è½çæ ¸å¿æºå¶ï¼ä¹çç¡®æ¯å°½éåå°éæºè¯»åï¼è¿ä¸¤ä¸ªæ¦å¿µç¡®å®å®¹ææ··æ·ãæä»¥ï¼è¿éææå®ä»¬æ¾å°äºåä¸ä¸ªæµç¨éæ¥è¯´æï¼ä¾¿äºä½ åºåè¿ä¸¤ä¸ªæ¦å¿µã\n\nç°å¨ï¼æä»¬è¦å¨è¡¨ä¸æ§è¡è¿ä¸ªæå¥è¯­å¥ï¼\n\ninsert into t(id,k) values (id1,k1), (id2,k2);\n\n\n1\n\n\nè¿éï¼æä»¬åè®¾å½å k ç´¢å¼æ çç¶æï¼æ¥æ¾å°ä½ç½®åï¼k1 æå¨çæ°æ®é¡µå¨åå­ (innodb buffer pool) ä¸­ï¼k2 æå¨çæ°æ®é¡µä¸å¨åå­ä¸­ãå¦ä¸å¾æ¯å¸¦ change buffer çæ´æ°ç¶æå¾ï¼\n\nåæè¿æ¡æ´æ°è¯­å¥ï¼ä½ ä¼åç°å®æ¶åäºåä¸ªé¨åï¼åå­ãredo logï¼ib_log_filexï¼ã æ°æ®è¡¨ç©ºé´ï¼t.ibdï¼ãç³»ç»è¡¨ç©ºé´ï¼ibdata1ï¼ã\n\n> ç³»ç»è¡¨ç©ºé´å°±æ¯ç¨æ¥æ¾ç³»ç»ä¿¡æ¯çï¼æ¯å¦æ°æ®å­å¸ä»ä¹çï¼å¯¹åºçç£çæä»¶æ¯ ibdata1, æ°æ®è¡¨ç©ºé´å°±æ¯ä¸ä¸ªä¸ªçè¡¨æ°æ®æä»¶ï¼å¯¹åºçç£çæä»¶å°±æ¯ è¡¨å.ibdã\n\nè¿æ¡æ´æ°è¯­å¥åäºå¦ä¸çæä½ï¼æç§å¾ä¸­çæ°å­é¡ºåºï¼ï¼\n\n 1. page 1 å¨åå­ä¸­ï¼ç´æ¥æ´æ°åå­ï¼\n 2. page 2 æ²¡æå¨åå­ä¸­ï¼å°±å¨åå­ç change buffer åºåï¼è®°å½ä¸âæè¦å¾ page 2 æå¥ä¸è¡âè¿ä¸ªä¿¡æ¯\n 3. å°ä¸è¿°ä¸¤ä¸ªå¨ä½è®°å¥ redo log ä¸­ï¼å¾ä¸­ 3 å 4ï¼ã\n\nåå®ä¸é¢è¿äºï¼äºå¡å°±å¯ä»¥å®æäºãæä»¥ï¼ä½ ä¼çå°ï¼æ§è¡è¿æ¡æ´æ°è¯­å¥çææ¬å¾ä½ï¼å°±æ¯åäºä¸¤å¤åå­ï¼ç¶ååäºä¸å¤ç£çï¼ä¸¤æ¬¡æä½åå¨ä¸èµ·åäºä¸æ¬¡ç£çï¼ï¼èä¸è¿æ¯é¡ºåºåçãåæ¶ï¼å¾ä¸­çä¸¤ä¸ªèçº¿ç®­å¤´ï¼æ¯åå°æä½ï¼ä¸å½±åæ´æ°çååºæ¶é´ã\n\né£å¨è¿ä¹åçè¯»è¯·æ±ï¼è¦æä¹å¤çå¢ï¼\n\næ¯å¦ï¼æä»¬ç°å¨è¦æ§è¡ select * from t where k in (k1, k2)ãè¿éï¼æç»äºè¿ä¸¤ä¸ªè¯»è¯·æ±çæµç¨å¾ã\n\nå¦æè¯»è¯­å¥åçå¨æ´æ°è¯­å¥åä¸ä¹ï¼åå­ä¸­çæ°æ®é½è¿å¨ï¼é£ä¹æ­¤æ¶çè¿ä¸¤ä¸ªè¯»æä½å°±ä¸ç³»ç»è¡¨ç©ºé´ï¼ibdata1ï¼å redo logï¼ib_log_filexï¼æ å³äºãæä»¥ï¼æå¨å¾ä¸­å°±æ²¡ç»åºè¿ä¸¤é¨åï¼\n\nä»å¾ä¸­å¯ä»¥çå°ï¼\n\n 1. è¯» page 1 çæ¶åï¼ç´æ¥ä»åå­è¿åãæå ä½åå­¦å¨åé¢æç« çè¯è®ºä¸­é®å°ï¼wal ä¹åå¦æè¯»æ°æ®ï¼æ¯ä¸æ¯ä¸å®è¦è¯»çï¼æ¯ä¸æ¯ä¸å®è¦ä» redo log éé¢ææ°æ®æ´æ°ä»¥åæå¯ä»¥è¿åï¼å¶å®æ¯ä¸ç¨çãä½ å¯ä»¥çä¸ä¸å¾ 3 çè¿ä¸ªç¶æï¼è½ç¶ç£çä¸è¿æ¯ä¹åçæ°æ®ï¼ä½æ¯è¿éç´æ¥ä»åå­è¿åç»æï¼ç»ææ¯æ­£ç¡®çã\n 2. è¦è¯» page 2 çæ¶åï¼éè¦æ page 2 ä»ç£çè¯»å¥åå­ä¸­ï¼ç¶ååºç¨ change buffer éé¢çæä½æ¥å¿ï¼çæä¸ä¸ªæ­£ç¡®ççæ¬å¹¶è¿åç»æã\n\nå¯ä»¥çå°ï¼ç´å°éè¦è¯» page 2 çæ¶åï¼è¿ä¸ªæ°æ®é¡µæä¼è¢«è¯»å¥åå­ã\n\næä»¥ï¼å¦æè¦ç®åå°å¯¹æ¯è¿ä¸¤ä¸ªæºå¶å¨æåæ´æ°æ§è½ä¸çæ¶ççè¯ï¼redo log ä¸»è¦èççæ¯éæºåç£çç io æ¶èï¼è½¬æé¡ºåºåï¼ï¼è change buffer ä¸»è¦èççåæ¯éæºè¯»ç£çç io æ¶èã\n\n\n# 5. å°ç»\n\nä»å¤©ä»æ®éç´¢å¼åå¯ä¸ç´¢å¼çéæ©å¼å§ï¼åäº«äºæ°æ®çæ¥è¯¢åæ´æ°è¿ç¨ï¼ç¶åè¯´æäº change buffer çæºå¶ä»¥ååºç¨åºæ¯ï¼æåè®²å°äºç´¢å¼éæ©çå®è·µã\n\nç±äºå¯ä¸ç´¢å¼ç¨ä¸ä¸ change buffer çä¼åæºå¶ï¼å æ­¤å¦æä¸å¡å¯ä»¥æ¥åï¼ä»æ§è½è§åº¦åºåæå»ºè®®ä½ ä¼åèèéå¯ä¸ç´¢å¼ã\n\n\n# qa\n\nqï¼change buffer ä¸å¼å§æ¯ååå­çï¼é£ä¹å¦æè¿ä¸ªæ¶åæºå¨æçµéå¯ï¼ä¼ä¸ä¼å¯¼è´ change buffer ä¸¢å¤±å¢ï¼change buffer ä¸¢å¤±å¯ä¸æ¯å°äºå¿ï¼åä»ç£çè¯»å¥æ°æ®å¯å°±æ²¡æäº merge è¿ç¨ï¼å°±ç­äºæ¯æ°æ®ä¸¢å¤±äºãä¼ä¸ä¼åºç°è¿ç§æåµå¢ï¼",charsets:{cjk:!0},lastUpdated:"2023/05/23, 08:32:03",lastUpdatedTimestamp:1684830723e3},{title:"MySQLä¸ºä»ä¹ææ¶åä¼å éç´¢å¼",frontmatter:{title:"MySQLä¸ºä»ä¹ææ¶åä¼å éç´¢å¼",date:"2023-05-25T16:56:52.000Z",permalink:"/pages/c4cff3/",categories:["ä¸­é´ä»¶","MySQL","ä¸æ ï¼MySQL å®æ 45 è®²"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/06.MySQL/05.%E4%B8%93%E6%A0%8F%EF%BC%9AMySQL%20%E5%AE%9E%E6%88%98%2045%20%E8%AE%B2/07.MySQL%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E6%97%B6%E5%80%99%E4%BC%9A%E5%8A%A0%E9%94%99%E7%B4%A2%E5%BC%95.html",relativePath:"ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/07.MySQLä¸ºä»ä¹ææ¶åä¼å éç´¢å¼.md",key:"v-24aa3866",path:"/pages/c4cff3/",headersStr:null,content:"> åèï¼10 MySQLä¸ºä»ä¹ææ¶åä¼ééç´¢å¼ï¼| æå®¢æ¶é´ å¶å®æ¬ææ²¡æè§£éå¾å¤åçï¼æ¬æçåè¡·åªæ¯åäº«äºå ä¸ªè§£å³æ¹æ³ï¼æè®¸å¯ä»¥å¨ç¢°å°ç±»ä¼¼æåµçæ¶åï¼æä¸äºæè·¯ã\n\næä»¬ç¥éå¨ MySQL ä¸­ï¼ä¸å¼ è¡¨æ¯å¯ä»¥æ¯æå¤ä¸ªç´¢å¼çï¼ä½æä»¬ç SQL è¯­å¥å¹¶ä¸ä¼ä¸»å¨æå®ä½¿ç¨åªä¸ªç´¢å¼ï¼ä¹å°±æ¯è¯´ï¼ä½¿ç¨åªä¸ªç´¢å¼æ¶ç± MySQL æ¥ç¡®å®çã\n\nä¸è¿ææ¶åæä»¬å¯è½ç¢°å°è¿æ ·çæåµï¼ä¸æ¡æ¬æ¥å¯ä»¥æ§è¡å¾å¾å¿«çè¯­å¥ï¼å´ç±äº MySQL ééäºç´¢å¼ï¼èå¯¼è´æ§è¡éåº¦åå¾å¾æ¢ã\n\nä¸é¢çä¸ä¸ªä¾å­ãæä»¬å»ºä¸ä¸ªç®åçè¡¨ï¼æ aãb ä¸¤ä¸ªå­æ®µï¼å¹¶åå«å»ºç«ç´¢å¼ï¼\n\nCREATE TABLE `t` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `a` int(11) DEFAULT NULL,\n  `b` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `a` (`a`),\n  KEY `b` (`b`)\n) ENGINE=InnoDB;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nç¶åï¼æä»¬å¾è¡¨ t ä¸­æå¥ 10 ä¸è¡è®°å½ï¼åå¼ææ´æ°éå¢ï¼å³ï¼(1,1,1)ï¼(2,2,2)ï¼(3,3,3) ç´å° (100000,100000,100000)ãå¦ä¸æ¯ä½¿ç¨å­å¨è¿ç¨æ¥å®ç°è¿ä¸ªæå¥æ°æ®çé»è¾çï¼\n\ndelimiter ;;\ncreate procedure idata()\nbegin\n  declare i int;\n  set i=1;\n  while(i<=100000)do\n    insert into t values(i, i, i);\n    set i=i+1;\n  end while;\nend;;\ndelimiter ;\ncall idata();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥ä¸æ¥ï¼æä»¬åæä¸æ¡ SQL è¯­å¥ï¼\n\nmysql> select * from t where a between 10000 and 20000;\n\n\n1\n\n\nä½ ä¸å®ä¼è¯´ï¼è¿ä¸ªè¯­å¥è¿ç¨åæåï¼å¾ç®ååï¼a ä¸æç´¢å¼ï¼è¯å®æ¯è¦ä½¿ç¨ç´¢å¼ a çãæ²¡éï¼å¾ 1 æ¾ç¤ºçå°±æ¯ä½¿ç¨ explain å½ä»¤çå°çè¿æ¡è¯­å¥çæ§è¡æåµã\n\nå¾ 1 ä½¿ç¨ explain å½ä»¤æ¥çè¯­å¥æ§è¡æåµ\n\nä»å¾ 1 çä¸å»ï¼è¿æ¡æ¥è¯¢è¯­å¥çæ§è¡ä¹ç¡®å®ç¬¦åé¢æï¼key è¿ä¸ªå­æ®µå¼æ¯âaâï¼è¡¨ç¤ºä¼åå¨éæ©äºç´¢å¼ aã",normalizedContent:"> åèï¼10 mysqlä¸ºä»ä¹ææ¶åä¼ééç´¢å¼ï¼| æå®¢æ¶é´ å¶å®æ¬ææ²¡æè§£éå¾å¤åçï¼æ¬æçåè¡·åªæ¯åäº«äºå ä¸ªè§£å³æ¹æ³ï¼æè®¸å¯ä»¥å¨ç¢°å°ç±»ä¼¼æåµçæ¶åï¼æä¸äºæè·¯ã\n\næä»¬ç¥éå¨ mysql ä¸­ï¼ä¸å¼ è¡¨æ¯å¯ä»¥æ¯æå¤ä¸ªç´¢å¼çï¼ä½æä»¬ç sql è¯­å¥å¹¶ä¸ä¼ä¸»å¨æå®ä½¿ç¨åªä¸ªç´¢å¼ï¼ä¹å°±æ¯è¯´ï¼ä½¿ç¨åªä¸ªç´¢å¼æ¶ç± mysql æ¥ç¡®å®çã\n\nä¸è¿ææ¶åæä»¬å¯è½ç¢°å°è¿æ ·çæåµï¼ä¸æ¡æ¬æ¥å¯ä»¥æ§è¡å¾å¾å¿«çè¯­å¥ï¼å´ç±äº mysql ééäºç´¢å¼ï¼èå¯¼è´æ§è¡éåº¦åå¾å¾æ¢ã\n\nä¸é¢çä¸ä¸ªä¾å­ãæä»¬å»ºä¸ä¸ªç®åçè¡¨ï¼æ aãb ä¸¤ä¸ªå­æ®µï¼å¹¶åå«å»ºç«ç´¢å¼ï¼\n\ncreate table `t` (\n  `id` int(11) not null auto_increment,\n  `a` int(11) default null,\n  `b` int(11) default null,\n  primary key (`id`),\n  key `a` (`a`),\n  key `b` (`b`)\n) engine=innodb;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nç¶åï¼æä»¬å¾è¡¨ t ä¸­æå¥ 10 ä¸è¡è®°å½ï¼åå¼ææ´æ°éå¢ï¼å³ï¼(1,1,1)ï¼(2,2,2)ï¼(3,3,3) ç´å° (100000,100000,100000)ãå¦ä¸æ¯ä½¿ç¨å­å¨è¿ç¨æ¥å®ç°è¿ä¸ªæå¥æ°æ®çé»è¾çï¼\n\ndelimiter ;;\ncreate procedure idata()\nbegin\n  declare i int;\n  set i=1;\n  while(i<=100000)do\n    insert into t values(i, i, i);\n    set i=i+1;\n  end while;\nend;;\ndelimiter ;\ncall idata();\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥ä¸æ¥ï¼æä»¬åæä¸æ¡ sql è¯­å¥ï¼\n\nmysql> select * from t where a between 10000 and 20000;\n\n\n1\n\n\nä½ ä¸å®ä¼è¯´ï¼è¿ä¸ªè¯­å¥è¿ç¨åæåï¼å¾ç®ååï¼a ä¸æç´¢å¼ï¼è¯å®æ¯è¦ä½¿ç¨ç´¢å¼ a çãæ²¡éï¼å¾ 1 æ¾ç¤ºçå°±æ¯ä½¿ç¨ explain å½ä»¤çå°çè¿æ¡è¯­å¥çæ§è¡æåµã\n\nå¾ 1 ä½¿ç¨ explain å½ä»¤æ¥çè¯­å¥æ§è¡æåµ\n\nä»å¾ 1 çä¸å»ï¼è¿æ¡æ¥è¯¢è¯­å¥çæ§è¡ä¹ç¡®å®ç¬¦åé¢æï¼key è¿ä¸ªå­æ®µå¼æ¯âaâï¼è¡¨ç¤ºä¼åå¨éæ©äºç´¢å¼ aã",charsets:{cjk:!0},lastUpdated:"2023/05/25, 09:07:23",lastUpdatedTimestamp:1685005643e3},{title:"æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼",frontmatter:{title:"æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼",date:"2023-05-29T14:35:09.000Z",permalink:"/pages/fa9ec1/",categories:["ä¸­é´ä»¶","MySQL","ä¸æ ï¼MySQL å®æ 45 è®²"],tags:[null]},regularPath:"/%E4%B8%AD%E9%97%B4%E4%BB%B6/06.MySQL/05.%E4%B8%93%E6%A0%8F%EF%BC%9AMySQL%20%E5%AE%9E%E6%88%98%2045%20%E8%AE%B2/08.%E6%80%8E%E4%B9%88%E7%BB%99%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%97%E6%AE%B5%E5%8A%A0%E7%B4%A2%E5%BC%95.html",relativePath:"ä¸­é´ä»¶/06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/08.æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼.md",key:"v-18bc1557",path:"/pages/fa9ec1/",headers:[{level:2,title:"1. æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼ï¼",slug:"_1-æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼",normalizedTitle:"1. æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼ï¼",charIndex:31},{level:3,title:"1.1 åç¼ç´¢å¼çä½¿ç¨",slug:"_1-1-åç¼ç´¢å¼çä½¿ç¨",normalizedTitle:"1.1 åç¼ç´¢å¼çä½¿ç¨",charIndex:102},{level:3,title:"1.2 åç¼ç´¢å¼å¯¹è¦çç´¢å¼çå½±å",slug:"_1-2-åç¼ç´¢å¼å¯¹è¦çç´¢å¼çå½±å",normalizedTitle:"1.2 åç¼ç´¢å¼å¯¹è¦çç´¢å¼çå½±å",charIndex:2394},{level:3,title:"1.3 å¶ä»æ¹å¼",slug:"_1-3-å¶ä»æ¹å¼",normalizedTitle:"1.3 å¶ä»æ¹å¼",charIndex:2992},{level:3,title:"1.4 å°ç»",slug:"_1-4-å°ç»",normalizedTitle:"1.4 å°ç»",charIndex:4537}],headersStr:"1. æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼ï¼ 1.1 åç¼ç´¢å¼çä½¿ç¨ 1.2 åç¼ç´¢å¼å¯¹è¦çç´¢å¼çå½±å 1.3 å¶ä»æ¹å¼ 1.4 å°ç»",content:"> åèï¼11 æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼ï¼| æå®¢æ¶é´\n\n\n# 1. æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼ï¼\n\nç°å¨ï¼å ä¹ææçç³»ç»é½æ¯æé®ç®±ç»å½ï¼å¦ä½å¨é®ç®±è¿æ ·çå­æ®µä¸å»ºç«åççç´¢å¼ï¼æ¯æä»¬ä»å¤©è¦è®¨è®ºçé®é¢ã\n\n\n# 1.1 åç¼ç´¢å¼çä½¿ç¨\n\nåè®¾ï¼ä½ ç°å¨ç»´æ¤ä¸ä¸ªæ¯æé®ç®±ç»å½çç³»ç»ï¼ç¨æ·è¡¨æ¯è¿ä¹å®ä¹çï¼\n\ncreate table SUser(\n    ID bigint unsigned primary key,\n    email varchar(64), \n    ... \n) engine=innodb;\n\n\n1\n2\n3\n4\n5\n\n\nç±äºè¦ä½¿ç¨é®ç®±ç»å½ï¼æä»¥ä¸å¡ä»£ç ä¸­ä¸å®ä¼åºç°ç±»ä¼¼äºè¿æ ·çè¯­å¥ï¼\n\nselect f1, f2 from SUser where email='xxx';\n\n\n1\n\n\næä»¬å¯ä»¥ç¥éï¼å¦æ email è¿ä¸ªå­æ®µä¸æ²¡æç´¢å¼ï¼é£ä¹è¿ä¸ªè¯­å¥å°±åªè½åå¨è¡¨æ«æã\n\nåæ¶ï¼MySQL æ¯æ¯æåç¼ç´¢å¼çï¼ä¹å°±æ¯è¯´ï¼ä½ å¯ä»¥å®ä¹å­ç¬¦ä¸²çä¸é¨åä½ä¸ºç´¢å¼ãé»è®¤å°ï¼å¦æä½ åå»ºç´¢å¼çè¯­å¥ä¸æå®åç¼é¿åº¦ï¼é£ä¹ç´¢å¼å°±ä¼åå«æ´ä¸ªå­ç¬¦ä¸²ã\n\næ¯å¦ï¼è¿ä¸¤ä¸ªå¨ email å­æ®µä¸åå»ºç´¢å¼çè¯­å¥ï¼\n\nmysql> alter table SUser add index index1(email);\næ\nmysql> alter table SUser add index index2(email(6));\n\n\n1\n2\n3\n\n * ç¬¬ä¸ä¸ªè¯­å¥åå»ºç index1 ç´¢å¼éé¢ï¼åå«äºæ¯ä¸ªè®°å½çæ´ä¸ªå­ç¬¦ä¸²ï¼\n * ç¬¬äºä¸ªè¯­å¥åå»ºç index2 ç´¢å¼éé¢ï¼å¯¹äºæ¯ä¸ªè®°å½é½æ¯åªåå 6 ä¸ªå­èã\n\né£ä¹ï¼è¿ä¸¤ç§ä¸åçå®ä¹å¨æ°æ®ç»æåå­å¨ä¸æä»ä¹åºå«å¢ï¼å¦ä¸å¾ 1 å 2 å°±æ¯è¿ä¸¤ä¸ªç´¢å¼çç¤ºæå¾ï¼\n\nå¾ 1 email ç´¢å¼ç»æ å¾ 2 email(6) ç´¢å¼ç»æ\n\nä»å¾ä¸­ä½ å¯ä»¥çå°ï¼ç±äº email(6) è¿ä¸ªç´¢å¼ç»æä¸­æ¯ä¸ªé®ç®±å­æ®µé½åªåå 6 ä¸ªå­èï¼å³ï¼zhangsï¼ï¼æä»¥ç´¢å¼å ç¨çç©ºé´ä¼æ´å°ï¼è¿å°±æ¯ä½¿ç¨åç¼ç´¢å¼çä¼å¿ãä½ï¼è¿åæ¶å¸¦æ¥çæå¤±æ¯ï¼å¯è½ä¼å¢å é¢å¤çè®°å½æ«ææ¬¡æ°ã\n\næ¥ä¸æ¥ï¼æä»¬åççä¸é¢è¿ä¸ªè¯­å¥ï¼å¨è¿ä¸¤ä¸ªç´¢å¼å®ä¹ä¸åå«æ¯æä¹æ§è¡ä¸é¢è¿æ¡ SQL çï¼\n\nselect id,name,email from SUser where email='zhangssxyz@xxx.com';\n\n\n1\n\n * å¦æä½¿ç¨çæ¯ index1ï¼å³ email æ´ä¸ªå­ç¬¦ä¸²çç´¢å¼ç»æï¼ï¼æ§è¡é¡ºåºæ¯è¿æ ·çï¼\n   1. ä» index1 ç´¢å¼æ æ¾å°æ»¡è¶³ç´¢å¼å¼æ¯ zhangssxyz@xxx.com çè¿æ¡è®°å½ï¼åå¾ ID2 çå¼ï¼\n   2. å°ä¸»é®ä¸æ¥å°ä¸»é®å¼æ¯ ID2 çè¡ï¼å¤æ­ email çå¼æ¯æ­£ç¡®çï¼å°è¿è¡è®°å½å å¥ç»æéï¼\n   3. å index1 ç´¢å¼æ ä¸ååæ¥å°çä½ç½®çä¸ä¸æ¡è®°å½ï¼åç°å·²ç»ä¸æ»¡è¶³ email='zhangssxyz@xxx.com' çæ¡ä»¶äºï¼å¾ªç¯ç»æã\n\nè¿ä¸ªè¿ç¨ä¸­ï¼åªéè¦åä¸»é®ç´¢å¼åä¸æ¬¡æ°æ®ï¼æä»¥ç³»ç»è®¤ä¸ºåªæ«æäºä¸è¡ã\n\n * å¦æä½¿ç¨çæ¯ index2ï¼å³ email(6) ç´¢å¼ç»æï¼ï¼æ§è¡é¡ºåºæ¯è¿æ ·çï¼\n   1. ä» index2 ç´¢å¼æ æ¾å°æ»¡è¶³ç´¢å¼å¼æ¯âzhangsâçè®°å½ï¼æ¾å°çç¬¬ä¸ä¸ªæ¯ ID1ï¼\n   2. å°ä¸»é®ä¸æ¥å°ä¸»é®å¼æ¯ ID1 çè¡ï¼å¤æ­åº email çå¼ä¸æ¯ zhangssxyz@xxx.comï¼è¿è¡è®°å½ä¸¢å¼ï¼\n   3. å index2 ä¸ååæ¥å°çä½ç½®çä¸ä¸æ¡è®°å½ï¼åç°ä»ç¶æ¯âzhangsâï¼ååº ID2ï¼åå° ID ç´¢å¼ä¸åæ´è¡ç¶åå¤æ­ï¼è¿æ¬¡å¼å¯¹äºï¼å°è¿è¡è®°å½å å¥ç»æéï¼\n   4. éå¤ä¸ä¸æ­¥ï¼ç´å°å¨ idxe2 ä¸åå°çå¼ä¸æ¯âzhangsâæ¶ï¼å¾ªç¯ç»æã\n\nå¨è¿ä¸ªè¿ç¨ä¸­ï¼è¦åä¸»é®ç´¢å¼å 4 æ¬¡æ°æ®ï¼ä¹å°±æ¯æ«æäº 4 è¡ãéè¿è¿ä¸ªå¯¹æ¯ï¼ä½ å¾å®¹æå°±å¯ä»¥åç°ï¼ä½¿ç¨åç¼ç´¢å¼åï¼å¯è½ä¼å¯¼è´æ¥è¯¢è¯­å¥è¯»æ°æ®çæ¬¡æ°åå¤ã\n\nä½æ¯ï¼å¯¹äºè¿ä¸ªæ¥è¯¢è¯­å¥æ¥è¯´ï¼å¦æä½ å®ä¹ç index2 ä¸æ¯ email(6) èæ¯ email(7)ï¼ä¹å°±æ¯è¯´å email å­æ®µçå 7 ä¸ªå­èæ¥æå»ºç´¢å¼çè¯ï¼å³æ»¡è¶³åç¼âzhangssâçè®°å½åªæä¸ä¸ªï¼ä¹è½å¤ç´æ¥æ¥å° ID2ï¼åªæ«æä¸è¡å°±ç»æäºã\n\nä¹å°±æ¯è¯´ä½¿ç¨åç¼ç´¢å¼ï¼å®ä¹å¥½é¿åº¦ï¼å°±å¯ä»¥åå°æ¢èçç©ºé´ï¼åä¸ç¨é¢å¤å¢å å¤ªå¤çæ¥è¯¢ææ¬ã\n\näºæ¯ï¼ä½ å°±æä¸ªé®é¢ï¼å½è¦ç»å­ç¬¦ä¸²åå»ºåç¼ç´¢å¼æ¶ï¼æä»ä¹æ¹æ³è½å¤ç¡®å®æåºè¯¥ä½¿ç¨å¤é¿çåç¼å¢ï¼â\n\nå®éä¸ï¼æä»¬å¨å»ºç«ç´¢å¼æ¶å³æ³¨çæ¯åºååº¦ï¼åºååº¦è¶é«è¶å¥½ãå ä¸ºåºååº¦è¶é«ï¼æå³çéå¤çé®å¼è¶å°ãå æ­¤ï¼æä»¬å¯ä»¥éè¿ç»è®¡ç´¢å¼ä¸æå¤å°ä¸ªä¸åçå¼æ¥å¤æ­è¦ä½¿ç¨å¤é¿çåç¼ã\n\né¦åï¼ä½ å¯ä»¥ä½¿ç¨ä¸é¢è¿ä¸ªè¯­å¥ï¼ç®åºè¿ä¸ªåä¸æå¤å°ä¸ªä¸åçå¼ï¼\n\nselect count(distinct email) as L from SUser;\n\n\n1\n\n\nç¶åï¼ä¾æ¬¡éåä¸åé¿åº¦çåç¼æ¥çè¿ä¸ªå¼ï¼æ¯å¦æä»¬è¦çä¸ä¸ 4~7 ä¸ªå­èçåç¼ç´¢å¼ï¼å¯ä»¥ç¨è¿ä¸ªè¯­å¥ï¼\n\nselect \n  count(distinct left(email,4)ï¼as L4,\n  count(distinct left(email,5)ï¼as L5,\n  count(distinct left(email,6)ï¼as L6,\n  count(distinct left(email,7)ï¼as L7,\nfrom SUser;\n\n\n1\n2\n3\n4\n5\n6\n\n\nå½ç¶ï¼ä½¿ç¨åç¼ç´¢å¼å¾å¯è½ä¼æå¤±åºååº¦ï¼æä»¥ä½ éè¦é¢åè®¾å®ä¸ä¸ªå¯ä»¥æ¥åçæå¤±æ¯ä¾ï¼æ¯å¦ 5%ãç¶åï¼å¨è¿åç L4~L7 ä¸­ï¼æ¾åºä¸å°äº L * 95% çå¼ï¼åè®¾è¿é L6ãL7 é½æ»¡è¶³ï¼ä½ å°±å¯ä»¥éæ©åç¼é¿åº¦ä¸º 6ã\n\n\n# 1.2 åç¼ç´¢å¼å¯¹è¦çç´¢å¼çå½±å\n\nåé¢æä»¬è¯´äºä½¿ç¨åç¼ç´¢å¼å¯è½ä¼å¢å æ«æè¡æ°ï¼è¿ä¼å½±åå°æ§è½ãå¶å®ï¼åç¼ç´¢å¼çå½±åä¸æ­¢å¦æ­¤ï¼æä»¬åçä¸ä¸å¦å¤ä¸ä¸ªåºæ¯ã\n\nä½ åæ¥ççè¿ä¸ª SQL è¯­å¥ï¼\n\nselect id,email from SUser where email='zhangssxyz@xxx.com';\n\n\n1\n\n\nä¸åé¢ä¾å­ä¸­ç SQL è¯­å¥\n\nselect id,name,email from SUser where email='zhangssxyz@xxx.com';\n\n\n1\n\n\nç¸æ¯ï¼è¿ä¸ªè¯­å¥åªè¦æ±è¿å id å email å­æ®µã\n\næä»¥ï¼å¦æä½¿ç¨ index1ï¼å³ email æ´ä¸ªå­ç¬¦ä¸²çç´¢å¼ç»æï¼çè¯ï¼å¯ä»¥å©ç¨è¦çç´¢å¼ï¼ä» index1 æ¥å°ç»æåç´æ¥å°±è¿åäºï¼ä¸éè¦åå° ID ç´¢å¼åå»æ¥ä¸æ¬¡ãèå¦æä½¿ç¨ index2ï¼å³ email(6) ç´¢å¼ç»æï¼çè¯ï¼å°±ä¸å¾ä¸åå° ID ç´¢å¼åå»å¤æ­ email å­æ®µçå¼ã\n\n> å³ä½¿ä½ å° index2 çå®ä¹ä¿®æ¹ä¸º email(18) çåç¼ç´¢å¼ï¼è¿æ¶åè½ç¶ index2 å·²ç»åå«äºææçä¿¡æ¯ï¼ä½ InnoDB è¿æ¯è¦åå° id ç´¢å¼åæ¥ä¸ä¸ï¼å ä¸ºç³»ç»å¹¶ä¸ç¡®å®åç¼ç´¢å¼çå®ä¹æ¯å¦æªæ­äºå®æ´ä¿¡æ¯ã\n\nä¹å°±æ¯è¯´ï¼ä½¿ç¨åç¼ç´¢å¼å°±ç¨ä¸ä¸è¦çç´¢å¼å¯¹æ¥è¯¢æ§è½çä¼åäºï¼è¿ä¹æ¯ä½ å¨éæ©æ¯å¦ä½¿ç¨åç¼ç´¢å¼æ¶éè¦èèçä¸ä¸ªå ç´ ã\n\n\n# 1.3 å¶ä»æ¹å¼\n\nå¯¹äºç±»ä¼¼äºé®ç®±è¿æ ·çå­æ®µæ¥è¯´ï¼ä½¿ç¨åç¼ç´¢å¼çææå¯è½è¿ä¸éãä½æ¯ï¼éå°åç¼çåºååº¦ä¸å¤å¥½çæåµæ¶ï¼æä»¬è¦æä¹åå¢ï¼\n\næ¯å¦ï¼æä»¬å½å®¶çèº«ä»½è¯å·ï¼ä¸å± 18 ä½ï¼å¶ä¸­å 6 ä½æ¯å°åç ï¼æä»¥åä¸ä¸ªå¿çäººçèº«ä»½è¯å·å 6 ä½ä¸è¬ä¼æ¯ç¸åçã\n\nåè®¾ä½ ç»´æ¤çæ°æ®åºæ¯ä¸ä¸ªå¸çå¬æ°ä¿¡æ¯ç³»ç»ï¼è¿æ¶åå¦æå¯¹èº«ä»½è¯å·åé¿åº¦ä¸º 6 çåç¼ç´¢å¼çè¯ï¼è¿ä¸ªç´¢å¼çåºååº¦å°±éå¸¸ä½äºãæç§æä»¬åé¢è¯´çæ¹æ³ï¼å¯è½ä½ éè¦åå»ºé¿åº¦ä¸º 12 ä»¥ä¸çåç¼ç´¢å¼ï¼æè½å¤æ»¡è¶³åºååº¦è¦æ±ãä½æ¯ï¼ç´¢å¼éåçè¶é¿ï¼å ç¨çç£çç©ºé´å°±è¶å¤§ï¼ç¸åçæ°æ®é¡µè½æ¾ä¸çç´¢å¼å¼å°±è¶å°ï¼æç´¢çæçä¹å°±ä¼è¶ä½ã\n\né£ä¹ï¼å¦ææä»¬è½å¤ç¡®å®ä¸å¡éæ±éé¢åªææç§èº«ä»½è¯è¿è¡ç­å¼æ¥è¯¢çéæ±ï¼è¿ææ²¡æå«çå¤çæ¹æ³å¢ï¼è¿ç§æ¹æ³ï¼æ¢å¯ä»¥å ç¨æ´å°çç©ºé´ï¼ä¹è½è¾¾å°ç¸åçæ¥è¯¢æçãç­æ¡æ¯ï¼æçã\n\nç¬¬ä¸ç§æ¹å¼æ¯ä½¿ç¨ååºå­å¨ãå¦æä½ å­å¨èº«ä»½è¯å·çæ¶åæå®åè¿æ¥å­ï¼æ¯æ¬¡æ¥è¯¢çæ¶åï¼ä½ å¯ä»¥è¿ä¹åï¼\n\nselect field_list from t where id_card = reverse('input_id_card_string');\n\n\n1\n\n\nç±äºèº«ä»½è¯å·çæå 6 ä½æ²¡æå°åç è¿æ ·çéå¤é»è¾ï¼æä»¥æåè¿ 6 ä½å¾å¯è½å°±æä¾äºè¶³å¤çåºååº¦ãå½ç¶äºï¼å®è·µä¸­ä½ ä¸è¦å¿è®°ä½¿ç¨ count(distinct) æ¹æ³å»åä¸ªéªè¯ã\n\nç¬¬äºç§æ¹å¼æ¯ä½¿ç¨ hash å­æ®µãä½ å¯ä»¥å¨è¡¨ä¸ååå»ºä¸ä¸ªæ´æ°å­æ®µï¼æ¥ä¿å­èº«ä»½è¯çæ ¡éªç ï¼åæ¶å¨è¿ä¸ªå­æ®µä¸åå»ºç´¢å¼ã\n\nalter table t add id_card_crc int unsigned, add index(id_card_crc);\n\n\n1\n\n\nç¶åæ¯æ¬¡æå¥æ°è®°å½çæ¶åï¼é½åæ¶ç¨ crc32() è¿ä¸ªå½æ°å¾å°æ ¡éªç å¡«å°è¿ä¸ªæ°å­æ®µãç±äºæ ¡éªç å¯è½å­å¨å²çªï¼ä¹å°±æ¯è¯´ä¸¤ä¸ªä¸åçèº«ä»½è¯å·éè¿ crc32() å½æ°å¾å°çç»æå¯è½æ¯ç¸åçï¼æä»¥ä½ çæ¥è¯¢è¯­å¥ where é¨åè¦å¤æ­ id_card çå¼æ¯å¦ç²¾ç¡®ç¸åã\n\nselect field_list from t where id_card_crc=crc32('input_id_card_string') and id_card='input_id_card_string'\n\n\n1\n\n\nè¿æ ·ï¼ç´¢å¼çé¿åº¦åæäº 4 ä¸ªå­èï¼æ¯åæ¥å°äºå¾å¤ã\n\næ¥ä¸æ¥ï¼æä»¬åä¸èµ·ççä½¿ç¨ååºå­å¨åä½¿ç¨ hash å­æ®µè¿ä¸¤ç§æ¹æ³çå¼åç¹ã\n\n * ç¸åç¹æ¯ï¼é½ä¸æ¯æèå´æ¥è¯¢ãååºå­å¨çå­æ®µä¸åå»ºçç´¢å¼æ¯æç§ååºå­ç¬¦ä¸²çæ¹å¼æåºçï¼å·²ç»æ²¡æåæ³å©ç¨ç´¢å¼æ¹å¼æ¥åºèº«ä»½è¯å·ç å¨[ID_X, ID_Y]çææå¸æ°äºãåæ ·å°ï¼hash å­æ®µçæ¹å¼ä¹åªè½æ¯æç­å¼æ¥è¯¢ã\n * åºå«ä¸»è¦ä½ç°å¨ä»¥ä¸ä¸ä¸ªæ¹é¢ï¼\n   * ä»å ç¨çé¢å¤ç©ºé´æ¥çï¼ååºå­å¨æ¹å¼å¨ä¸»é®ç´¢å¼ä¸ï¼ä¸ä¼æ¶èé¢å¤çå­å¨ç©ºé´ï¼è hash å­æ®µæ¹æ³éè¦å¢å ä¸ä¸ªå­æ®µãå½ç¶ï¼ååºå­å¨æ¹å¼ä½¿ç¨ 4 ä¸ªå­èçåç¼é¿åº¦åºè¯¥æ¯ä¸å¤çï¼å¦æåé¿ä¸ç¹ï¼è¿ä¸ªæ¶èè·é¢å¤è¿ä¸ª hash å­æ®µä¹å·®ä¸å¤æµæ¶äºã\n   * å¨ CPU æ¶èæ¹é¢ï¼ååºæ¹å¼æ¯æ¬¡ååè¯»çæ¶åï¼é½éè¦é¢å¤è°ç¨ä¸æ¬¡ reverse å½æ°ï¼è hash å­æ®µçæ¹å¼éè¦é¢å¤è°ç¨ä¸æ¬¡ crc32() å½æ°ãå¦æåªä»è¿ä¸¤ä¸ªå½æ°çè®¡ç®å¤æåº¦æ¥ççè¯ï¼reverse å½æ°é¢å¤æ¶èç CPU èµæºä¼æ´å°äºã\n   * ä»æ¥è¯¢æçä¸çï¼ä½¿ç¨ hash å­æ®µæ¹å¼çæ¥è¯¢æ§è½ç¸å¯¹æ´ç¨³å®ä¸äºãå ä¸º crc32 ç®åºæ¥çå¼è½ç¶æå²çªçæ¦çï¼ä½æ¯æ¦çéå¸¸å°ï¼å¯ä»¥è®¤ä¸ºæ¯æ¬¡æ¥è¯¢çå¹³åæ«æè¡æ°æ¥è¿ 1ãèååºå­å¨æ¹å¼æ¯ç«è¿æ¯ç¨çåç¼ç´¢å¼çæ¹å¼ï¼ä¹å°±æ¯è¯´è¿æ¯ä¼å¢å æ«æè¡æ°ã\n\n\n# 1.4 å°ç»\n\næ»ç»ä¸ä¸ç»å­ç¬¦ä¸²çå­æ®µåå»ºç´¢å¼çæ¹å¼ï¼\n\n * ç´æ¥åå»ºå®æ´ç´¢å¼ï¼è¿æ ·å¯è½æ¯è¾å ç¨ç©ºé´ï¼\n * åå»ºåç¼ç´¢å¼ï¼èçç©ºé´ï¼ä½ä¼å¢å æ¥è¯¢æ«ææ¬¡æ°ï¼å¹¶ä¸ä¸è½ä½¿ç¨è¦çç´¢å¼ï¼\n * ååºå­å¨ï¼ååå»ºåç¼ç´¢å¼ï¼ç¨äºç»è¿å­ç¬¦ä¸²æ¬èº«åç¼çåºååº¦ä¸å¤çé®é¢ï¼\n * åå»º hash å­æ®µç´¢å¼ï¼æ¥è¯¢æ§è½ç¨³å®ï¼æé¢å¤çå­å¨åè®¡ç®æ¶èï¼è·ç¬¬ä¸ç§æ¹å¼ä¸æ ·ï¼é½ä¸æ¯æèå´æ«æã\n\nå¨å®éåºç¨ä¸­ï¼ä½ è¦æ ¹æ®ä¸å¡å­æ®µçç¹ç¹éæ©ä½¿ç¨åªç§æ¹å¼ã",normalizedContent:"> åèï¼11 æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼ï¼| æå®¢æ¶é´\n\n\n# 1. æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼ï¼\n\nç°å¨ï¼å ä¹ææçç³»ç»é½æ¯æé®ç®±ç»å½ï¼å¦ä½å¨é®ç®±è¿æ ·çå­æ®µä¸å»ºç«åççç´¢å¼ï¼æ¯æä»¬ä»å¤©è¦è®¨è®ºçé®é¢ã\n\n\n# 1.1 åç¼ç´¢å¼çä½¿ç¨\n\nåè®¾ï¼ä½ ç°å¨ç»´æ¤ä¸ä¸ªæ¯æé®ç®±ç»å½çç³»ç»ï¼ç¨æ·è¡¨æ¯è¿ä¹å®ä¹çï¼\n\ncreate table suser(\n    id bigint unsigned primary key,\n    email varchar(64), \n    ... \n) engine=innodb;\n\n\n1\n2\n3\n4\n5\n\n\nç±äºè¦ä½¿ç¨é®ç®±ç»å½ï¼æä»¥ä¸å¡ä»£ç ä¸­ä¸å®ä¼åºç°ç±»ä¼¼äºè¿æ ·çè¯­å¥ï¼\n\nselect f1, f2 from suser where email='xxx';\n\n\n1\n\n\næä»¬å¯ä»¥ç¥éï¼å¦æ email è¿ä¸ªå­æ®µä¸æ²¡æç´¢å¼ï¼é£ä¹è¿ä¸ªè¯­å¥å°±åªè½åå¨è¡¨æ«æã\n\nåæ¶ï¼mysql æ¯æ¯æåç¼ç´¢å¼çï¼ä¹å°±æ¯è¯´ï¼ä½ å¯ä»¥å®ä¹å­ç¬¦ä¸²çä¸é¨åä½ä¸ºç´¢å¼ãé»è®¤å°ï¼å¦æä½ åå»ºç´¢å¼çè¯­å¥ä¸æå®åç¼é¿åº¦ï¼é£ä¹ç´¢å¼å°±ä¼åå«æ´ä¸ªå­ç¬¦ä¸²ã\n\næ¯å¦ï¼è¿ä¸¤ä¸ªå¨ email å­æ®µä¸åå»ºç´¢å¼çè¯­å¥ï¼\n\nmysql> alter table suser add index index1(email);\næ\nmysql> alter table suser add index index2(email(6));\n\n\n1\n2\n3\n\n * ç¬¬ä¸ä¸ªè¯­å¥åå»ºç index1 ç´¢å¼éé¢ï¼åå«äºæ¯ä¸ªè®°å½çæ´ä¸ªå­ç¬¦ä¸²ï¼\n * ç¬¬äºä¸ªè¯­å¥åå»ºç index2 ç´¢å¼éé¢ï¼å¯¹äºæ¯ä¸ªè®°å½é½æ¯åªåå 6 ä¸ªå­èã\n\né£ä¹ï¼è¿ä¸¤ç§ä¸åçå®ä¹å¨æ°æ®ç»æåå­å¨ä¸æä»ä¹åºå«å¢ï¼å¦ä¸å¾ 1 å 2 å°±æ¯è¿ä¸¤ä¸ªç´¢å¼çç¤ºæå¾ï¼\n\nå¾ 1 email ç´¢å¼ç»æ å¾ 2 email(6) ç´¢å¼ç»æ\n\nä»å¾ä¸­ä½ å¯ä»¥çå°ï¼ç±äº email(6) è¿ä¸ªç´¢å¼ç»æä¸­æ¯ä¸ªé®ç®±å­æ®µé½åªåå 6 ä¸ªå­èï¼å³ï¼zhangsï¼ï¼æä»¥ç´¢å¼å ç¨çç©ºé´ä¼æ´å°ï¼è¿å°±æ¯ä½¿ç¨åç¼ç´¢å¼çä¼å¿ãä½ï¼è¿åæ¶å¸¦æ¥çæå¤±æ¯ï¼å¯è½ä¼å¢å é¢å¤çè®°å½æ«ææ¬¡æ°ã\n\næ¥ä¸æ¥ï¼æä»¬åççä¸é¢è¿ä¸ªè¯­å¥ï¼å¨è¿ä¸¤ä¸ªç´¢å¼å®ä¹ä¸åå«æ¯æä¹æ§è¡ä¸é¢è¿æ¡ sql çï¼\n\nselect id,name,email from suser where email='zhangssxyz@xxx.com';\n\n\n1\n\n * å¦æä½¿ç¨çæ¯ index1ï¼å³ email æ´ä¸ªå­ç¬¦ä¸²çç´¢å¼ç»æï¼ï¼æ§è¡é¡ºåºæ¯è¿æ ·çï¼\n   1. ä» index1 ç´¢å¼æ æ¾å°æ»¡è¶³ç´¢å¼å¼æ¯ zhangssxyz@xxx.com çè¿æ¡è®°å½ï¼åå¾ id2 çå¼ï¼\n   2. å°ä¸»é®ä¸æ¥å°ä¸»é®å¼æ¯ id2 çè¡ï¼å¤æ­ email çå¼æ¯æ­£ç¡®çï¼å°è¿è¡è®°å½å å¥ç»æéï¼\n   3. å index1 ç´¢å¼æ ä¸ååæ¥å°çä½ç½®çä¸ä¸æ¡è®°å½ï¼åç°å·²ç»ä¸æ»¡è¶³ email='zhangssxyz@xxx.com' çæ¡ä»¶äºï¼å¾ªç¯ç»æã\n\nè¿ä¸ªè¿ç¨ä¸­ï¼åªéè¦åä¸»é®ç´¢å¼åä¸æ¬¡æ°æ®ï¼æä»¥ç³»ç»è®¤ä¸ºåªæ«æäºä¸è¡ã\n\n * å¦æä½¿ç¨çæ¯ index2ï¼å³ email(6) ç´¢å¼ç»æï¼ï¼æ§è¡é¡ºåºæ¯è¿æ ·çï¼\n   1. ä» index2 ç´¢å¼æ æ¾å°æ»¡è¶³ç´¢å¼å¼æ¯âzhangsâçè®°å½ï¼æ¾å°çç¬¬ä¸ä¸ªæ¯ id1ï¼\n   2. å°ä¸»é®ä¸æ¥å°ä¸»é®å¼æ¯ id1 çè¡ï¼å¤æ­åº email çå¼ä¸æ¯ zhangssxyz@xxx.comï¼è¿è¡è®°å½ä¸¢å¼ï¼\n   3. å index2 ä¸ååæ¥å°çä½ç½®çä¸ä¸æ¡è®°å½ï¼åç°ä»ç¶æ¯âzhangsâï¼ååº id2ï¼åå° id ç´¢å¼ä¸åæ´è¡ç¶åå¤æ­ï¼è¿æ¬¡å¼å¯¹äºï¼å°è¿è¡è®°å½å å¥ç»æéï¼\n   4. éå¤ä¸ä¸æ­¥ï¼ç´å°å¨ idxe2 ä¸åå°çå¼ä¸æ¯âzhangsâæ¶ï¼å¾ªç¯ç»æã\n\nå¨è¿ä¸ªè¿ç¨ä¸­ï¼è¦åä¸»é®ç´¢å¼å 4 æ¬¡æ°æ®ï¼ä¹å°±æ¯æ«æäº 4 è¡ãéè¿è¿ä¸ªå¯¹æ¯ï¼ä½ å¾å®¹æå°±å¯ä»¥åç°ï¼ä½¿ç¨åç¼ç´¢å¼åï¼å¯è½ä¼å¯¼è´æ¥è¯¢è¯­å¥è¯»æ°æ®çæ¬¡æ°åå¤ã\n\nä½æ¯ï¼å¯¹äºè¿ä¸ªæ¥è¯¢è¯­å¥æ¥è¯´ï¼å¦æä½ å®ä¹ç index2 ä¸æ¯ email(6) èæ¯ email(7)ï¼ä¹å°±æ¯è¯´å email å­æ®µçå 7 ä¸ªå­èæ¥æå»ºç´¢å¼çè¯ï¼å³æ»¡è¶³åç¼âzhangssâçè®°å½åªæä¸ä¸ªï¼ä¹è½å¤ç´æ¥æ¥å° id2ï¼åªæ«æä¸è¡å°±ç»æäºã\n\nä¹å°±æ¯è¯´ä½¿ç¨åç¼ç´¢å¼ï¼å®ä¹å¥½é¿åº¦ï¼å°±å¯ä»¥åå°æ¢èçç©ºé´ï¼åä¸ç¨é¢å¤å¢å å¤ªå¤çæ¥è¯¢ææ¬ã\n\näºæ¯ï¼ä½ å°±æä¸ªé®é¢ï¼å½è¦ç»å­ç¬¦ä¸²åå»ºåç¼ç´¢å¼æ¶ï¼æä»ä¹æ¹æ³è½å¤ç¡®å®æåºè¯¥ä½¿ç¨å¤é¿çåç¼å¢ï¼â\n\nå®éä¸ï¼æä»¬å¨å»ºç«ç´¢å¼æ¶å³æ³¨çæ¯åºååº¦ï¼åºååº¦è¶é«è¶å¥½ãå ä¸ºåºååº¦è¶é«ï¼æå³çéå¤çé®å¼è¶å°ãå æ­¤ï¼æä»¬å¯ä»¥éè¿ç»è®¡ç´¢å¼ä¸æå¤å°ä¸ªä¸åçå¼æ¥å¤æ­è¦ä½¿ç¨å¤é¿çåç¼ã\n\né¦åï¼ä½ å¯ä»¥ä½¿ç¨ä¸é¢è¿ä¸ªè¯­å¥ï¼ç®åºè¿ä¸ªåä¸æå¤å°ä¸ªä¸åçå¼ï¼\n\nselect count(distinct email) as l from suser;\n\n\n1\n\n\nç¶åï¼ä¾æ¬¡éåä¸åé¿åº¦çåç¼æ¥çè¿ä¸ªå¼ï¼æ¯å¦æä»¬è¦çä¸ä¸ 4~7 ä¸ªå­èçåç¼ç´¢å¼ï¼å¯ä»¥ç¨è¿ä¸ªè¯­å¥ï¼\n\nselect \n  count(distinct left(email,4)ï¼as l4,\n  count(distinct left(email,5)ï¼as l5,\n  count(distinct left(email,6)ï¼as l6,\n  count(distinct left(email,7)ï¼as l7,\nfrom suser;\n\n\n1\n2\n3\n4\n5\n6\n\n\nå½ç¶ï¼ä½¿ç¨åç¼ç´¢å¼å¾å¯è½ä¼æå¤±åºååº¦ï¼æä»¥ä½ éè¦é¢åè®¾å®ä¸ä¸ªå¯ä»¥æ¥åçæå¤±æ¯ä¾ï¼æ¯å¦ 5%ãç¶åï¼å¨è¿åç l4~l7 ä¸­ï¼æ¾åºä¸å°äº l * 95% çå¼ï¼åè®¾è¿é l6ãl7 é½æ»¡è¶³ï¼ä½ å°±å¯ä»¥éæ©åç¼é¿åº¦ä¸º 6ã\n\n\n# 1.2 åç¼ç´¢å¼å¯¹è¦çç´¢å¼çå½±å\n\nåé¢æä»¬è¯´äºä½¿ç¨åç¼ç´¢å¼å¯è½ä¼å¢å æ«æè¡æ°ï¼è¿ä¼å½±åå°æ§è½ãå¶å®ï¼åç¼ç´¢å¼çå½±åä¸æ­¢å¦æ­¤ï¼æä»¬åçä¸ä¸å¦å¤ä¸ä¸ªåºæ¯ã\n\nä½ åæ¥ççè¿ä¸ª sql è¯­å¥ï¼\n\nselect id,email from suser where email='zhangssxyz@xxx.com';\n\n\n1\n\n\nä¸åé¢ä¾å­ä¸­ç sql è¯­å¥\n\nselect id,name,email from suser where email='zhangssxyz@xxx.com';\n\n\n1\n\n\nç¸æ¯ï¼è¿ä¸ªè¯­å¥åªè¦æ±è¿å id å email å­æ®µã\n\næä»¥ï¼å¦æä½¿ç¨ index1ï¼å³ email æ´ä¸ªå­ç¬¦ä¸²çç´¢å¼ç»æï¼çè¯ï¼å¯ä»¥å©ç¨è¦çç´¢å¼ï¼ä» index1 æ¥å°ç»æåç´æ¥å°±è¿åäºï¼ä¸éè¦åå° id ç´¢å¼åå»æ¥ä¸æ¬¡ãèå¦æä½¿ç¨ index2ï¼å³ email(6) ç´¢å¼ç»æï¼çè¯ï¼å°±ä¸å¾ä¸åå° id ç´¢å¼åå»å¤æ­ email å­æ®µçå¼ã\n\n> å³ä½¿ä½ å° index2 çå®ä¹ä¿®æ¹ä¸º email(18) çåç¼ç´¢å¼ï¼è¿æ¶åè½ç¶ index2 å·²ç»åå«äºææçä¿¡æ¯ï¼ä½ innodb è¿æ¯è¦åå° id ç´¢å¼åæ¥ä¸ä¸ï¼å ä¸ºç³»ç»å¹¶ä¸ç¡®å®åç¼ç´¢å¼çå®ä¹æ¯å¦æªæ­äºå®æ´ä¿¡æ¯ã\n\nä¹å°±æ¯è¯´ï¼ä½¿ç¨åç¼ç´¢å¼å°±ç¨ä¸ä¸è¦çç´¢å¼å¯¹æ¥è¯¢æ§è½çä¼åäºï¼è¿ä¹æ¯ä½ å¨éæ©æ¯å¦ä½¿ç¨åç¼ç´¢å¼æ¶éè¦èèçä¸ä¸ªå ç´ ã\n\n\n# 1.3 å¶ä»æ¹å¼\n\nå¯¹äºç±»ä¼¼äºé®ç®±è¿æ ·çå­æ®µæ¥è¯´ï¼ä½¿ç¨åç¼ç´¢å¼çææå¯è½è¿ä¸éãä½æ¯ï¼éå°åç¼çåºååº¦ä¸å¤å¥½çæåµæ¶ï¼æä»¬è¦æä¹åå¢ï¼\n\næ¯å¦ï¼æä»¬å½å®¶çèº«ä»½è¯å·ï¼ä¸å± 18 ä½ï¼å¶ä¸­å 6 ä½æ¯å°åç ï¼æä»¥åä¸ä¸ªå¿çäººçèº«ä»½è¯å·å 6 ä½ä¸è¬ä¼æ¯ç¸åçã\n\nåè®¾ä½ ç»´æ¤çæ°æ®åºæ¯ä¸ä¸ªå¸çå¬æ°ä¿¡æ¯ç³»ç»ï¼è¿æ¶åå¦æå¯¹èº«ä»½è¯å·åé¿åº¦ä¸º 6 çåç¼ç´¢å¼çè¯ï¼è¿ä¸ªç´¢å¼çåºååº¦å°±éå¸¸ä½äºãæç§æä»¬åé¢è¯´çæ¹æ³ï¼å¯è½ä½ éè¦åå»ºé¿åº¦ä¸º 12 ä»¥ä¸çåç¼ç´¢å¼ï¼æè½å¤æ»¡è¶³åºååº¦è¦æ±ãä½æ¯ï¼ç´¢å¼éåçè¶é¿ï¼å ç¨çç£çç©ºé´å°±è¶å¤§ï¼ç¸åçæ°æ®é¡µè½æ¾ä¸çç´¢å¼å¼å°±è¶å°ï¼æç´¢çæçä¹å°±ä¼è¶ä½ã\n\né£ä¹ï¼å¦ææä»¬è½å¤ç¡®å®ä¸å¡éæ±éé¢åªææç§èº«ä»½è¯è¿è¡ç­å¼æ¥è¯¢çéæ±ï¼è¿ææ²¡æå«çå¤çæ¹æ³å¢ï¼è¿ç§æ¹æ³ï¼æ¢å¯ä»¥å ç¨æ´å°çç©ºé´ï¼ä¹è½è¾¾å°ç¸åçæ¥è¯¢æçãç­æ¡æ¯ï¼æçã\n\nç¬¬ä¸ç§æ¹å¼æ¯ä½¿ç¨ååºå­å¨ãå¦æä½ å­å¨èº«ä»½è¯å·çæ¶åæå®åè¿æ¥å­ï¼æ¯æ¬¡æ¥è¯¢çæ¶åï¼ä½ å¯ä»¥è¿ä¹åï¼\n\nselect field_list from t where id_card = reverse('input_id_card_string');\n\n\n1\n\n\nç±äºèº«ä»½è¯å·çæå 6 ä½æ²¡æå°åç è¿æ ·çéå¤é»è¾ï¼æä»¥æåè¿ 6 ä½å¾å¯è½å°±æä¾äºè¶³å¤çåºååº¦ãå½ç¶äºï¼å®è·µä¸­ä½ ä¸è¦å¿è®°ä½¿ç¨ count(distinct) æ¹æ³å»åä¸ªéªè¯ã\n\nç¬¬äºç§æ¹å¼æ¯ä½¿ç¨ hash å­æ®µãä½ å¯ä»¥å¨è¡¨ä¸ååå»ºä¸ä¸ªæ´æ°å­æ®µï¼æ¥ä¿å­èº«ä»½è¯çæ ¡éªç ï¼åæ¶å¨è¿ä¸ªå­æ®µä¸åå»ºç´¢å¼ã\n\nalter table t add id_card_crc int unsigned, add index(id_card_crc);\n\n\n1\n\n\nç¶åæ¯æ¬¡æå¥æ°è®°å½çæ¶åï¼é½åæ¶ç¨ crc32() è¿ä¸ªå½æ°å¾å°æ ¡éªç å¡«å°è¿ä¸ªæ°å­æ®µãç±äºæ ¡éªç å¯è½å­å¨å²çªï¼ä¹å°±æ¯è¯´ä¸¤ä¸ªä¸åçèº«ä»½è¯å·éè¿ crc32() å½æ°å¾å°çç»æå¯è½æ¯ç¸åçï¼æä»¥ä½ çæ¥è¯¢è¯­å¥ where é¨åè¦å¤æ­ id_card çå¼æ¯å¦ç²¾ç¡®ç¸åã\n\nselect field_list from t where id_card_crc=crc32('input_id_card_string') and id_card='input_id_card_string'\n\n\n1\n\n\nè¿æ ·ï¼ç´¢å¼çé¿åº¦åæäº 4 ä¸ªå­èï¼æ¯åæ¥å°äºå¾å¤ã\n\næ¥ä¸æ¥ï¼æä»¬åä¸èµ·ççä½¿ç¨ååºå­å¨åä½¿ç¨ hash å­æ®µè¿ä¸¤ç§æ¹æ³çå¼åç¹ã\n\n * ç¸åç¹æ¯ï¼é½ä¸æ¯æèå´æ¥è¯¢ãååºå­å¨çå­æ®µä¸åå»ºçç´¢å¼æ¯æç§ååºå­ç¬¦ä¸²çæ¹å¼æåºçï¼å·²ç»æ²¡æåæ³å©ç¨ç´¢å¼æ¹å¼æ¥åºèº«ä»½è¯å·ç å¨[id_x, id_y]çææå¸æ°äºãåæ ·å°ï¼hash å­æ®µçæ¹å¼ä¹åªè½æ¯æç­å¼æ¥è¯¢ã\n * åºå«ä¸»è¦ä½ç°å¨ä»¥ä¸ä¸ä¸ªæ¹é¢ï¼\n   * ä»å ç¨çé¢å¤ç©ºé´æ¥çï¼ååºå­å¨æ¹å¼å¨ä¸»é®ç´¢å¼ä¸ï¼ä¸ä¼æ¶èé¢å¤çå­å¨ç©ºé´ï¼è hash å­æ®µæ¹æ³éè¦å¢å ä¸ä¸ªå­æ®µãå½ç¶ï¼ååºå­å¨æ¹å¼ä½¿ç¨ 4 ä¸ªå­èçåç¼é¿åº¦åºè¯¥æ¯ä¸å¤çï¼å¦æåé¿ä¸ç¹ï¼è¿ä¸ªæ¶èè·é¢å¤è¿ä¸ª hash å­æ®µä¹å·®ä¸å¤æµæ¶äºã\n   * å¨ cpu æ¶èæ¹é¢ï¼ååºæ¹å¼æ¯æ¬¡ååè¯»çæ¶åï¼é½éè¦é¢å¤è°ç¨ä¸æ¬¡ reverse å½æ°ï¼è hash å­æ®µçæ¹å¼éè¦é¢å¤è°ç¨ä¸æ¬¡ crc32() å½æ°ãå¦æåªä»è¿ä¸¤ä¸ªå½æ°çè®¡ç®å¤æåº¦æ¥ççè¯ï¼reverse å½æ°é¢å¤æ¶èç cpu èµæºä¼æ´å°äºã\n   * ä»æ¥è¯¢æçä¸çï¼ä½¿ç¨ hash å­æ®µæ¹å¼çæ¥è¯¢æ§è½ç¸å¯¹æ´ç¨³å®ä¸äºãå ä¸º crc32 ç®åºæ¥çå¼è½ç¶æå²çªçæ¦çï¼ä½æ¯æ¦çéå¸¸å°ï¼å¯ä»¥è®¤ä¸ºæ¯æ¬¡æ¥è¯¢çå¹³åæ«æè¡æ°æ¥è¿ 1ãèååºå­å¨æ¹å¼æ¯ç«è¿æ¯ç¨çåç¼ç´¢å¼çæ¹å¼ï¼ä¹å°±æ¯è¯´è¿æ¯ä¼å¢å æ«æè¡æ°ã\n\n\n# 1.4 å°ç»\n\næ»ç»ä¸ä¸ç»å­ç¬¦ä¸²çå­æ®µåå»ºç´¢å¼çæ¹å¼ï¼\n\n * ç´æ¥åå»ºå®æ´ç´¢å¼ï¼è¿æ ·å¯è½æ¯è¾å ç¨ç©ºé´ï¼\n * åå»ºåç¼ç´¢å¼ï¼èçç©ºé´ï¼ä½ä¼å¢å æ¥è¯¢æ«ææ¬¡æ°ï¼å¹¶ä¸ä¸è½ä½¿ç¨è¦çç´¢å¼ï¼\n * ååºå­å¨ï¼ååå»ºåç¼ç´¢å¼ï¼ç¨äºç»è¿å­ç¬¦ä¸²æ¬èº«åç¼çåºååº¦ä¸å¤çé®é¢ï¼\n * åå»º hash å­æ®µç´¢å¼ï¼æ¥è¯¢æ§è½ç¨³å®ï¼æé¢å¤çå­å¨åè®¡ç®æ¶èï¼è·ç¬¬ä¸ç§æ¹å¼ä¸æ ·ï¼é½ä¸æ¯æèå´æ«æã\n\nå¨å®éåºç¨ä¸­ï¼ä½ è¦æ ¹æ®ä¸å¡å­æ®µçç¹ç¹éæ©ä½¿ç¨åªç§æ¹å¼ã",charsets:{cjk:!0},lastUpdated:"2023/05/29, 07:11:57",lastUpdatedTimestamp:1685344317e3},{title:"Linux åºç¡ç¯",frontmatter:{title:"Linux åºç¡ç¯",date:"2022-04-09T10:17:39.000Z",permalink:"/pages/c774f5/",categories:["åºç¡","Linux","é©é¡ºå¹³2021è¯¾ç¨ç¬è®°"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/10.Linux/05.%E9%9F%A9%E9%A1%BA%E5%B9%B32021%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/05.Linux%E5%9F%BA%E7%A1%80%E7%AF%87.html",relativePath:"åºç¡/10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/05.Linuxåºç¡ç¯.md",key:"v-4fda8213",path:"/pages/c774f5/",headers:[{level:2,title:"1. Linuxå¥é¨",slug:"_1-linuxå¥é¨",normalizedTitle:"1. linuxå¥é¨",charIndex:2},{level:2,title:"2. VM å Linux çå®è£",slug:"_2-vm-å-linux-çå®è£",normalizedTitle:"2. vm å linux çå®è£",charIndex:81},{level:3,title:"2.1 èææºçä½¿ç¨",slug:"_2-1-èææºçä½¿ç¨",normalizedTitle:"2.1 èææºçä½¿ç¨",charIndex:103},{level:4,title:"2.1.1 åé",slug:"_2-1-1-åé",normalizedTitle:"2.1.1 åé",charIndex:117},{level:4,title:"2.1.2 å¿«ç§",slug:"_2-1-2-å¿«ç§",normalizedTitle:"2.1.2 å¿«ç§",charIndex:254},{level:4,title:"2.1.3 è¿ç§»åå é¤",slug:"_2-1-3-è¿ç§»åå é¤",normalizedTitle:"2.1.3 è¿ç§»åå é¤",charIndex:282},{level:3,title:"2.2 ç½ç»è¿æ¥çä¸ç§æ¹å¼",slug:"_2-2-ç½ç»è¿æ¥çä¸ç§æ¹å¼",normalizedTitle:"2.2 ç½ç»è¿æ¥çä¸ç§æ¹å¼",charIndex:349},{level:4,title:"1ï¼æ¡¥æ¥æ¨¡å¼ï¼å¼ ä¸ï¼",slug:"_1-æ¡¥æ¥æ¨¡å¼-å¼ ä¸",normalizedTitle:"1ï¼æ¡¥æ¥æ¨¡å¼ï¼å¼ ä¸ï¼",charIndex:416},{level:4,title:"2ï¼NAT æ¨¡å¼ï¼çäºï¼",slug:"_2-nat-æ¨¡å¼-çäº",normalizedTitle:"2ï¼nat æ¨¡å¼ï¼çäºï¼",charIndex:505},{level:4,title:"3ï¼ä»ä¸»æºæ¨¡å¼ï¼æåï¼",slug:"_3-ä»ä¸»æºæ¨¡å¼-æå",normalizedTitle:"3ï¼ä»ä¸»æºæ¨¡å¼ï¼æåï¼",charIndex:642},{level:3,title:"2.3 vmtools",slug:"_2-3-vmtools",normalizedTitle:"2.3 vmtools",charIndex:677},{level:4,title:"2.3.1 vmtools çå®è£",slug:"_2-3-1-vmtools-çå®è£",normalizedTitle:"2.3.1 vmtools çå®è£",charIndex:756},{level:4,title:"2.3.2 ä¸»æºä¸ VM å±äº«æä»¶å¤¹",slug:"_2-3-2-ä¸»æºä¸-vm-å±äº«æä»¶å¤¹",normalizedTitle:"2.3.2 ä¸»æºä¸ vm å±äº«æä»¶å¤¹",charIndex:1069},{level:2,title:"3. Linux çç®å½ç»æ",slug:"_3-linux-çç®å½ç»æ",normalizedTitle:"3. linux çç®å½ç»æ",charIndex:1222},{level:3,title:"3.1 åºæ¬ä»ç»",slug:"_3-1-åºæ¬ä»ç»",normalizedTitle:"3.1 åºæ¬ä»ç»",charIndex:1241},{level:3,title:"3.2 å·ä½çç®å½ç»æ",slug:"_3-2-å·ä½çç®å½ç»æ",normalizedTitle:"3.2 å·ä½çç®å½ç»æ",charIndex:1301},{level:3,title:"3.3 æä»¶ç®å½çç¸å³æä»¤",slug:"_3-3-æä»¶ç®å½çç¸å³æä»¤",normalizedTitle:"3.3 æä»¶ç®å½çç¸å³æä»¤",charIndex:2330},{level:4,title:"3.3.1 *pwd",slug:"_3-3-1-pwd",normalizedTitle:"3.3.1 *pwd",charIndex:2347},{level:4,title:"3.3.2 *ls",slug:"_3-3-2-ls",normalizedTitle:"3.3.2 *ls",charIndex:2377},{level:4,title:"3.3.3 *cd åæ¢å°æå®ç®å½",slug:"_3-3-3-cd-åæ¢å°æå®ç®å½",normalizedTitle:"3.3.3 *cd åæ¢å°æå®ç®å½",charIndex:2589},{level:4,title:"3.3.4 mkdir åå»ºç®å½",slug:"_3-3-4-mkdir-åå»ºç®å½",normalizedTitle:"3.3.4 mkdir åå»ºç®å½",charIndex:2766},{level:4,title:"3.3.5 rmdir å é¤ç®å½",slug:"_3-3-5-rmdir-å é¤ç®å½",normalizedTitle:"3.3.5 rmdir å é¤ç®å½",charIndex:2897},{level:4,title:"3.3.6 touch åå»ºç©ºæä»¶",slug:"_3-3-6-touch-åå»ºç©ºæä»¶",normalizedTitle:"3.3.6 touch åå»ºç©ºæä»¶",charIndex:3022},{level:4,title:"3.3.7 *cp æ·è´",slug:"_3-3-7-cp-æ·è´",normalizedTitle:"3.3.7 *cp æ·è´",charIndex:3054},{level:4,title:"3.3.8 *rm ç§»é¤æä»¶æç®å½",slug:"_3-3-8-rm-ç§»é¤æä»¶æç®å½",normalizedTitle:"3.3.8 *rm ç§»é¤æä»¶æç®å½",charIndex:3147},{level:4,title:"3.3.9 mv ç§»å¨ï¼æä»¶/ç®å½ï¼æéå½å",slug:"_3-3-9-mv-ç§»å¨-æä»¶-ç®å½-æéå½å",normalizedTitle:"3.3.9 mv ç§»å¨ï¼æä»¶/ç®å½ï¼æéå½å",charIndex:3288},{level:4,title:"3.3.10 cat",slug:"_3-3-10-cat",normalizedTitle:"3.3.10 cat",charIndex:3446},{level:4,title:"3.3.11 more",slug:"_3-3-11-more",normalizedTitle:"3.3.11 more",charIndex:3663},{level:4,title:"3.3.12 less",slug:"_3-3-12-less",normalizedTitle:"3.3.12 less",charIndex:3833},{level:4,title:"3.3.13 echo è¾åºåå®¹å°æ§å¶å°",slug:"_3-3-13-echo-è¾åºåå®¹å°æ§å¶å°",normalizedTitle:"3.3.13 echo è¾åºåå®¹å°æ§å¶å°",charIndex:4106},{level:4,title:"3.3.14 head æ¾ç¤ºæä»¶å¼å¤´é¨å",slug:"_3-3-14-head-æ¾ç¤ºæä»¶å¼å¤´é¨å",normalizedTitle:"3.3.14 head æ¾ç¤ºæä»¶å¼å¤´é¨å",charIndex:4230},{level:4,title:"3.3.15 tail æ¾ç¤ºæä»¶ç»å°¾é¨å",slug:"_3-3-15-tail-æ¾ç¤ºæä»¶ç»å°¾é¨å",normalizedTitle:"3.3.15 tail æ¾ç¤ºæä»¶ç»å°¾é¨å",charIndex:4315},{level:4,title:"3.3.16 > å >> éå®å",slug:"_3-3-16-å-éå®å",normalizedTitle:"3.3.16 &gt; å &gt;&gt; éå®å",charIndex:null},{level:4,title:"3.3.17 ln åå»ºè½¯é¾æ¥",slug:"_3-3-17-ln-åå»ºè½¯é¾æ¥",normalizedTitle:"3.3.17 ln åå»ºè½¯é¾æ¥",charIndex:4678},{level:4,title:"3.3.18 history",slug:"_3-3-18-history",normalizedTitle:"3.3.18 history",charIndex:4958},{level:2,title:"4. è¿ç¨ç»å½å° Linux æå¡å¨",slug:"_4-è¿ç¨ç»å½å°-linux-æå¡å¨",normalizedTitle:"4. è¿ç¨ç»å½å° linux æå¡å¨",charIndex:5081}],headersStr:"1. Linuxå¥é¨ 2. VM å Linux çå®è£ 2.1 èææºçä½¿ç¨ 2.1.1 åé 2.1.2 å¿«ç§ 2.1.3 è¿ç§»åå é¤ 2.2 ç½ç»è¿æ¥çä¸ç§æ¹å¼ 1ï¼æ¡¥æ¥æ¨¡å¼ï¼å¼ ä¸ï¼ 2ï¼NAT æ¨¡å¼ï¼çäºï¼ 3ï¼ä»ä¸»æºæ¨¡å¼ï¼æåï¼ 2.3 vmtools 2.3.1 vmtools çå®è£ 2.3.2 ä¸»æºä¸ VM å±äº«æä»¶å¤¹ 3. Linux çç®å½ç»æ 3.1 åºæ¬ä»ç» 3.2 å·ä½çç®å½ç»æ 3.3 æä»¶ç®å½çç¸å³æä»¤ 3.3.1 *pwd 3.3.2 *ls 3.3.3 *cd åæ¢å°æå®ç®å½ 3.3.4 mkdir åå»ºç®å½ 3.3.5 rmdir å é¤ç®å½ 3.3.6 touch åå»ºç©ºæä»¶ 3.3.7 *cp æ·è´ 3.3.8 *rm ç§»é¤æä»¶æç®å½ 3.3.9 mv ç§»å¨ï¼æä»¶/ç®å½ï¼æéå½å 3.3.10 cat 3.3.11 more 3.3.12 less 3.3.13 echo è¾åºåå®¹å°æ§å¶å° 3.3.14 head æ¾ç¤ºæä»¶å¼å¤´é¨å 3.3.15 tail æ¾ç¤ºæä»¶ç»å°¾é¨å 3.3.16 > å >> éå®å 3.3.17 ln åå»ºè½¯é¾æ¥ 3.3.18 history 4. è¿ç¨ç»å½å° Linux æå¡å¨",content:"# 1. Linuxå¥é¨\n\n> ææ° Linux æºç ä¸è½½ï¼The Linux Kernel Archives\n\nLinux å Unix å³ç³»å¾ï¼\n\n\n\n\n# 2. VM å Linux çå®è£\n\n\n# 2.1 èææºçä½¿ç¨\n\n# 2.1.1 åé\n\nå¦æå·²ç»å®è£äºä¸å° Linux æä½ç³»ç»ï¼å¹¶è¿æ³è¦æ´å¤çï¼è¿æ¶æ²¡å¿è¦éæ°å®è£ï¼åªéè¦åéå°±å¯ä»¥äºï¼\n\n * æ¹å¼1ï¼ç´æ¥æ·è´ä¸ä»½å®è£å¥½çèææºæä»¶\n * æ¹å¼2ï¼ä½¿ç¨ VMware çåéæä½ãæ³¨æï¼åéæ¶è¦åå³é­è¦åéçè¿å° Linux ç³»ç»ã\n\n# 2.1.2 å¿«ç§\n\nå¿«éæ¢å¤å°å¿«ç§æ¶çè¿è¡ç¶æã\n\n# 2.1.3 è¿ç§»åå é¤\n\nèæç³»ç»æ¬è´¨å°±æ¯æä»¶ãè¿ç§»åªéè¦æä»¶å¤¹çæ´ä½æ·è´æåªåå°å¦å¤ä½ç½®ãå é¤å¯ä»¥ç´æ¥å é¤å¯¹åºæä»¶å¤¹å³å¯ã\n\n\n# 2.2 ç½ç»è¿æ¥çä¸ç§æ¹å¼\n\n\n\nå¼ ä¸ãæåãçäºä¸äººæ­¤æ¶å¨åä¸ä¸ªç½æ®µä¸ï¼é½æ¯192.168.0.Xï¼ï¼ä»ä»¬å¯ä»¥è¿è¡ç¸äºéä¿¡ã\n\n# 1ï¼æ¡¥æ¥æ¨¡å¼ï¼å¼ ä¸ï¼\n\nå¨æ¡¥æ¥æ¨¡å¼ä¸ï¼èææº IP å°åéè¦ä¸ä¸»æºå¨åä¸ä¸ªç½æ®µï¼ç»èæç³»ç»ååéä¸ä¸ªæ¬ç½æ®µç IPãèæç³»ç»å¯ä»¥åå¤é¨ç³»ç»éè®¯ï¼ä½è¿å®¹æé æ IP å²çªã\n\n# 2ï¼NAT æ¨¡å¼ï¼çäºï¼\n\nNAT æ¨¡å¼ï¼å°±æ¯ç½ç»å°åè½¬æ¢æ¨¡å¼ãèæç³»ç»å¯ä»¥åå¤é¨ç³»ç»éè®¯ï¼ä¸é æ IP å²çªãæ­¤æ¶192.168.0.50 æ¯ä¸ªä»£çï¼èæç³»ç»åªæ¯éè¿ä»£çæ¥åå¤é¨è¿è¡éä¿¡ï¼ä½æ¯å¤é¨æ æ³ç´æ¥è®¿é®å°192.168.100.88 ï¼ææå³ä¾§åªæä¸ä¸ªç®­å¤´ã\n\n# 3ï¼ä»ä¸»æºæ¨¡å¼ï¼æåï¼\n\nä¸ä¸ªç¬ç«çç³»ç»ï¼ä¸åå¤é¨äº§çèç³»ã\n\n\n# 2.3 vmtools\n\nvmtools å¯ä»¥è®©æä»¬å¨ Windows ä¸æ´å¥½çç®¡çèææºï¼æ¯å¦å¯ä»¥è®¾ç½® Windows å Centos å±äº«æä»¶ã\n\n# 2.3.1 vmtools çå®è£\n\n 1. VMware ä¸æ¹ èææº -> ï¼éæ°ï¼å®è£ VM tools\n 2. æ¡é¢ä¸åºç°ä¸ä¸ª VMware toolsï¼æå¼éé¢æä¸ª xxx.tar.gzï¼å°å¶æ·è´å° /opt\n 3. ä½¿ç¨è§£åå½ä»¤ tar -zxvf xx.tar.gz å¾å°ä¸ä¸ªå®è£æä»¶\n 4. è¿å¥è¯¥å®è£æä»¶å¤¹éé¢ï¼æ§è¡å½ä»¤ ./vmware-install.pl è¿è¡å®è£ï¼å®è£è¿ç¨å¨é¨åè½¦é»è®¤å³å¯ï¼ç´å°å®è£å®æã\n\n> æ³¨æç¹ï¼\n> \n>  * å®è£è¿ç¨éè¦æ gccï¼ gcc -væ¥ççæ¬ã\n>  * ç¬¬ä¸æ­¥çç¹å» ï¼éæ°ï¼å®è£ VM tools åå¯è½æ²¡æååºï¼åªéè¦åæ¶ä¸ä¸åéæ°ç¹ä¸ä¸å³å¯ã\n\n# 2.3.2 ä¸»æºä¸ VM å±äº«æä»¶å¤¹\n\n 1. å®è£ VMtools åï¼å¨ VMware ç è®¾ç½® -> éé¡¹ -> å±äº«æä»¶å¤¹\n 2. å¨è¿ä¸ªçé¢ä¸­ï¼åç¹å» æ»æ¯å¯ç¨ ï¼ç¶åå¨ä¸é¢æä»¶å¤¹ä¸­æ·»å éè¦å±äº«çæä»¶å¤¹\n 3. å¨èæç³»ç»ä¸­ï¼/mnt éå¯ä»¥æ¾å°å±äº«çæä»¶å¤¹ï¼å¯¹å¶çä¿®æ¹ä¹ä¼åæ­¥å°ä¸»æºä¸­\n\n\n# 3. Linux çç®å½ç»æ\n\n\n# 3.1 åºæ¬ä»ç»\n\nLinux éç¨å±çº§ç®å½ç»æï¼æä¸å±æ¯æ ¹ç®å½ /ã\n\nå¨ Linux ä¸çéï¼ä¸åçæä»¶ã\n\n\n# 3.2 å·ä½çç®å½ç»æ\n\nç®å½            è¯´æ\n/bin          æ /usr/binã/usr/local/binãBinary çç¼©åï¼å­æ¾çæç»å¸¸ä½¿ç¨çå½ä»¤ã\n/sbin         æ /usr/sbinã/usr/local/sbinãs ââ Super Userï¼å­æ¾çç³»ç»ç®¡çåä½¿ç¨çç¨åºã\n/home         å­æ¾æ®éç¨æ·çä¸»ç®å½ï¼æ¯ä¸ªç¨æ·æä¸ä¸ªèªå·±çç®å½ã\n/root         ç³»ç»ç®¡çåçä¸»ç®å½\n/lib          ç³»ç»å¼æºæéè¦çæåºæ¬çå¨æé¾æ¥å±äº«åºãå ä¹ææåºç¨ç¨åºé½éè¦è¿äºåºã\n/lost+found   ä¸è¬ä¸ºç©ºï¼å½ç³»ç»éæ³å³æºæ¶è¿éå°±å­æ¾äºä¸äºæä»¶ã\n/etc          ææçç³»ç»ç®¡çæéè¦çéç½®æä»¶åå­ç®å½ãæ¯å¦å®è£ mysql æ¶ç my.conf\n/usr          ç¨æ·å®è£çå¾å¤åºç¨ç¨åºé½æ¾å¨è¿ä¸ªç®å½ä¸ãç±»ä¼¼äº Windows ç program filesã\n/boot         å­æ¾çå¯å¨ Linux æ¶ä½¿ç¨çæ ¸å¿æä»¶\n/proc         ãä¸è½å¨ããæ¯ä¸ä¸ªèæç®å½ï¼å®æ¯ç³»ç»åå­çæ å°ï¼è®¿é®è¿ä¸ªç®å½æ¥è·åç³»ç»ä¿¡æ¯ã\n/srv          ãä¸è½å¨ããservice çç¼©åï¼å­æ¾ä¸äºæå¡å¯å¨åéè¦æåçæ°æ®\n/sys          ãä¸è½å¨ããå®è£äº 2.6 åæ ¸ä¸­æ°åºç°çä¸ä¸ªæä»¶ç³»ç» sysfs\n/tmp          å­æ¾ä¸´æ¶æä»¶\n/dev          æææè®¾å¤ç¡¬ä»¶ç¨æä»¶çå½¢å¼å­å¨\n/media        Linux èªå¨è¯å«çä¸äºè®¾å¤ï¼å¦ U çãåé©±ï¼æè½½å°è¿ä¸ªç®å½ä¸ã\n/mnt          è®©ç¨æ·ä¸´æ¶æè½½å«çæä»¶ç³»ç»ãæä»¬å¯ä»¥å°å¤é¨å­å¨æè½½å° /mnt ä¸ï¼ç¶åè¿å¥éé¢æ¥çåå®¹\n/opt          ä¸»æºé¢å¤å®è£è½¯ä»¶æå­æ¾çç®å½ãå¦å®è£ Oracle å°±å¯ä»¥æ¾å°è¿éé¢\n/usr/local    è¿æ¯å¦ä¸ä¸ªç»ä¸»æºé¢å¤å®è£è½¯ä»¶æå­æ¾çç®å½ãè¿éä¸è¬æ¯éè¿ç¼è¯æºç æ¹å¼å®è£çç¨åºãï¼è½¯ä»¶çä½¿ç¨ç®å½ï¼è½¯ä»¶å®è£çç®æ ç®å½ï¼\n/var          å­æ¾çä¸æ­æ©åççä¸è¥¿ï¼ä¹ æ¯å°ç»å¸¸ä¿®æ¹çç®å½æ¾å¨è¿éé¢ï¼å¦æ¥å¿æä»¶ã\n/selinux      Security-Enhanced LinuxãSELinux æ¯ä¸ç§å®å¨å­ç³»ç»ï¼å®è½æ§å¶ç¨åºåªè½è®¿é®ç¹å®æä»¶ã\n\n\n# 3.3 æä»¶ç®å½çç¸å³æä»¤\n\n# 3.3.1 *pwd\n\næ¾ç¤ºå½åå·¥ä½ç®å½çç»å¯¹è·¯å¾ã\n\n# 3.3.2 *ls\n\nls [éé¡¹] [ç®å½ææä»¶]\n\n * -aï¼æ¾ç¤ºåæ¬éèæä»¶å¨åçæææä»¶\n * -lï¼ä»¥ååçæ¹å¼æ¾ç¤ºè¯¦ç»ä¿¡æ¯\n * -hï¼ç»äººçç\n\n> è¡¥åç¥è¯ç¹ï¼\n> \n>  * Linux ä¸ï¼éèæä»¶æ¯ä»¥ . å¼å¤´\n>  * å½ä»¤çéé¡¹å¯ä»¥ç»åä½¿ç¨ï¼æ é¡ºåºå·®å«ï¼æ¯å¦ ls çéé¡¹å¯ä»¥ç»åæ ls -al æè ls -laã\n>  * ls å½ä»¤è¿å¯ä»¥æå®ä¸ä¸ªç®å½ï¼æ¯å¦ ls -l /root\n\n# 3.3.3 *cd åæ¢å°æå®ç®å½\n\n * cd ~ï¼åå°å®¶ç®å½ï¼è¥ä½ æ¯ root ï¼åå° /rootï¼è¥æ¯ tomï¼åå° /home/tom\n * cd ..ï¼åå°ä¸ä¸çº§ç®å½\n * cd /usrï¼åæ¢å° /usr ç®å½\n\n> cd .. å¯ä»¥è¿ç»­ä½¿ç¨ï¼æ¯å¦ï¼å½åå¨ /home/tom ä¸ï¼ä½¿ç¨ cd ../../root å³å¯å° /root\n\n# 3.3.4 mkdir åå»ºç®å½\n\nmkdir [éé¡¹] è¦åå»ºçç®å½\n\n * -pï¼åå»ºå¤çº§ç®å½\n\n> æ¡ä¾ï¼\n> \n>  * åå»ºä¸ä¸ªç®å½ï¼mkdir /home/dog\n>  * åå»ºå¤çº§ç®å½ï¼mkdir -p /home/animal/tiger\n\n# 3.3.5 rmdir å é¤ç®å½\n\nrmdir [éé¡¹] è¦å é¤çç©ºç®å½\n\n\n1\n\n * rmdir å é¤çæ¯ç©ºç®å½ï¼å¦æç®å½ä¸æåå®¹æ¶æ æ³å é¤\n * å¦æéè¦å é¤éç©ºç®å½ï¼åºè¯¥ä½¿ç¨ rm -rf è¦å é¤çç®å½ï¼-r éå½å é¤ï¼-f å¼ºå¶å é¤\n\n# 3.3.6 touch åå»ºç©ºæä»¶\n\ntouch æä»¶å\n\n# 3.3.7 *cp æ·è´\n\ncp [éé¡¹] src dst\n\n * -rï¼éå½å¤å¶æ´ä¸ªæä»¶å¤¹\n * å¼ºå¶è¦çä¸æç¤ºçæ¹æ³ï¼\\cpï¼æ¯å¦ \\cp -r /home/src /opt\n\n# 3.3.8 *rm ç§»é¤æä»¶æç®å½\n\nrm [éé¡¹] è¦ç§»é¤çæä»¶æç®å½\n\n\n1\n\n\n * -rï¼éå½å é¤æ´ä¸ªæä»¶å¤¹\n\n * -fï¼å¼ºå¶å é¤ä¸æç¤ºï¼ä¸å æ­¤éé¡¹æ¶ï¼æ¯å é¤ä¸ä¸ªæä»¶é½è¦æç¤ºä¸æ¬¡\n   \n   rm -rf [dir] ä¸å®è¦ç°å¸¸å°å¿å°æä½ï¼ï¼ç´æ¥å äºæ´ä¸ªç®å½äºï¼\n\n# 3.3.9 mv ç§»å¨ï¼æä»¶/ç®å½ï¼æéå½å\n\nmv old new\n\n * å¯ä»¥ç§»å¨å¹¶ä¸éå½å\n\n> æ¡ä¾ï¼\n> \n>  * mv cat.txt pig.txtï¼å° cat.text éå½åä¸º pig.txt\n>  * mv /home/src /opt/ï¼å° /home/src ç§»å¨å° /opt ä¸é¢\n\n# 3.3.10 cat\n\nåªè½æ¥çä¸è½ä¿®æ¹ï¼æ¯ vim æ´å®å¨ï¼å æ­¤å¯¹äºéè¦çæä»¶ï¼å»ºè®®ç¨ cat å½ä»¤ã\n\ncat [éé¡¹] æä»¶å\n\n * -nï¼æ¾ç¤ºè¡å·\n * ä¸ºäºæµè§æ¹ä¾¿ï¼ä¸è¬ä¼å¸¦ä¸ç®¡éå½ä»¤ | more\n\n> ç®¡éå½ä»¤ï¼å°åä¸ä¸ªæä»¤çè¾åºä½ä¸ºåä¸ä¸ªæä»¤çè¾å¥\n\n> æ¡ä¾ï¼\n> \n>  * cat -n /etc/profile | more ï¼æ¥ç profile æä»¶åå®¹ï¼å¯ä»¥ä½¿ç¨ more å½ä»¤çæé®è¿è¡äº¤äºã\n\n# 3.3.11 more\n\nmore æä»¤ä»¥å¨å±çæ¹å¼æé¡µæ¾ç¤ºææ¬åå®¹ãå¸¸è§æä½ï¼\n\næä½       åè½\nç©ºç½é®      åä¸ç¿»é¡µ\nEnter    åä¸ç¿»ä¸è¡\nq        ç¦»å¼ more\nCtrl F   åä¸æ»å¨ä¸å±\nCtrl B   è¿åä¸ä¸å±\n=        è¾åºå½åè¡å·\n:f       è¾åºæä»¶ååå½åè¡å·\n\n# 3.3.12 less\n\nç¨æ¥åå±æ¥çæä»¶åå®¹ï¼ä¸ more æä»¤ç±»ä¼¼ï¼ä½æ´å å¼ºå¤§ãæ¯æåç§ç»ç«¯ï¼æ¾ç¤ºææ¬æ¶æéå è½½ææ¬åå®¹ï¼å¯¹å¤§åæä»¶æçè¾é«ã\n\næ¥çè¾å¤§çæä»¶æ¶ï¼æ´å»ºè®®ä½¿ç¨ less å½ä»¤ã\n\nå¸¸è§æä½ï¼\n\næä½           åè½\nç©ºç½é®          åä¸ç¿»é¡µ\n[pagedown]   åä¸ç¿»é¡µ\n[pageup]     åä¸ç¿»é¡µ\n/str         åä¸æç´¢ âstrâãn ä¸ä¸ä¸ªï¼N ä¸ä¸ä¸ª\n?str         åä¸æç´¢ âstrâãn ä¸ä¸ä¸ªï¼N ä¸ä¸ä¸ª\nq            ç¦»å¼ less\n\n# 3.3.13 echo è¾åºåå®¹å°æ§å¶å°\n\necho [éé¡¹] [è¾åºåå®¹]\n\n> æ¡ä¾ï¼\n> \n>  * â­ï¸ echo è¾åºç¯å¢åéï¼echo $PATHï¼å¶ä¸­ $ åé¢æ¥ç¯å¢åéåã\n>  * è¾åºä¸»æºåï¼echo $HOSTNAME\n\n# 3.3.14 head æ¾ç¤ºæä»¶å¼å¤´é¨å\n\nhead æä»¶ é»è®¤æ¾ç¤ºæä»¶å 10 è¡åå®¹ã\n\n * -nï¼æå®æ¾ç¤ºåå è¡ï¼æ¯å¦ head -n 5 foo.txt\n\n# 3.3.15 tail æ¾ç¤ºæä»¶ç»å°¾é¨å\n\ntail æä»¶ æ¾ç¤ºæä»¶æåé»è®¤ 10 è¡åå®¹ã\n\n * -nï¼æå®è¡æ°\n * -fï¼å®æ¶è¿½è¸ªè¯¥ææ¡£çæææ´æ°ï¼å¹¶æå°åºæ¥\n\n> -f çä½ç¨ï¼\n> \n>  * åæå¡å¨ç®¡çæ¶ï¼éè¦çæ§æä¸ªæä»¶ï¼æ¯å¦çæ§ååãç½ç»çå®æ¶ååï¼å¯ä»¥ç¨è¿ä¸ªéé¡¹ã\n\n# 3.3.16 > å >> éå®å\n\n * > è¾åºéå®å\n * >> éå®åå¹¶è¿½å \n\n> æ¡ä¾ï¼\n> \n>  * ls -l > foo.txtï¼å° ls çè¾åºè¦çåå¥ foo.txt ä¸­ï¼è¯¥æä»¶ä¸å­å¨æ¶ï¼ä¼èªå¨åå»ºè¿ä¸ªæä»¶\n>  * cat foo.txt > bar.txt ï¼å° foo.txt åå®¹è¦çå° bar.txt\n>  * echo âhelloâ >> foo.txt ï¼å° hello è¿½å å°æä»¶åé¢\n\n# 3.3.17 ln åå»ºè½¯é¾æ¥\n\nlnï¼æ¯ link çç¼©åï¼åå»ºä¸ä¸ªè½¯é¾æ¥ï¼ç±»ä¼¼ Windows çå¿«æ·æ¹å¼ï¼ï¼ä¸»è¦å­æ¾äºé¾æ¥å¶ä»æä»¶çè·¯å¾ã\n\nln -s [åæä»¶æç®å½] [è½¯é¾æ¥å]ï¼ç»åæä»¶åå»ºä¸ä¸ªè½¯é¾æ¥ã\n\ne.g. å¨ /home ç®å½ä¸åå»ºä¸ä¸ªè½¯è¿æ¥ myrootï¼è¿æ¥å° /root ç®å½ï¼\n\nln -s /root /home/myroot\n\n * rm å é¤çæ¯è½¯é¾æ¥ï¼ä¸ä¼å é¤å°åæä»¶\n * pwd æ¥çç®å½æ¶ä»ç¶çå°çæ¯è½¯é¾æ¥æå¨ç®å½\n\n> rm /home/myroot ï¼myroot åé¢ä¸è¦å  / ï¼å¦åä¼è§ä¸ºä¸ä¸ªç®å½\n\n# 3.3.18 history\n\nhistory æ¥çå·²ç»æ§è¡è¿çåå²å½ä»¤ï¼ä¹å¯ä»¥æ§è¡åå²å½ä»¤\n\n * historyï¼æ¾ç¤ºææçåå²å½ä»¤\n * history 10ï¼æ¾ç¤ºæè¿ä½¿ç¨è¿ç 10 ä¸ªæä»¤\n * !5ï¼æä»¤åå²ç¼å·ä¸º 5 çæä»¤\n\n\n# 4. è¿ç¨ç»å½å° Linux æå¡å¨\n\næä»¬è¿éä½¿ç¨ Xshell 6 å Xftp 6 æ¥ä½ä¸ºè¿ç¨ç»å½å®¢æ·ç«¯ã\n\nXshell æ¯ç¨æ¥è¿ç¨ç»å½æå¡å¨å¹¶å¯¹å¶è¿è¡æä½çï¼Xftp æ¯ç¨æ¥æ¬å°åæå¡å¨è¿è¡æä»¶ä¼ è¾çã\n\nå¨èææºä¸­ä½¿ç¨ ifconfig æ¥ç IP å°åï¼ens33å°±æ¯ç½å¡ï¼å¨ç¬¬ä¸é¨åç inet ä¸­å¯ä»¥çå° IPã\n\nç¶åå°è¯ä¸»æºä¸èææºè½å¦è¿éï¼å¨ä¸»æºä¸­ç¨ ping <IP> æµè¯æ¯å¦è½å¤æåã\n\nå¨ Xshell å Xftp ä¸­æ°å»ºä¼è¯å³å¯ã\n\nWindows è¿å¯ä»¥ç¨ FinalShell ä½ä¸ºè¿ç¨ç»å½å·¥å·ï¼åè´¹ä¸ç¸å½äºXshell + Xftp çåä½ã",normalizedContent:"# 1. linuxå¥é¨\n\n> ææ° linux æºç ä¸è½½ï¼the linux kernel archives\n\nlinux å unix å³ç³»å¾ï¼\n\n\n\n\n# 2. vm å linux çå®è£\n\n\n# 2.1 èææºçä½¿ç¨\n\n# 2.1.1 åé\n\nå¦æå·²ç»å®è£äºä¸å° linux æä½ç³»ç»ï¼å¹¶è¿æ³è¦æ´å¤çï¼è¿æ¶æ²¡å¿è¦éæ°å®è£ï¼åªéè¦åéå°±å¯ä»¥äºï¼\n\n * æ¹å¼1ï¼ç´æ¥æ·è´ä¸ä»½å®è£å¥½çèææºæä»¶\n * æ¹å¼2ï¼ä½¿ç¨ vmware çåéæä½ãæ³¨æï¼åéæ¶è¦åå³é­è¦åéçè¿å° linux ç³»ç»ã\n\n# 2.1.2 å¿«ç§\n\nå¿«éæ¢å¤å°å¿«ç§æ¶çè¿è¡ç¶æã\n\n# 2.1.3 è¿ç§»åå é¤\n\nèæç³»ç»æ¬è´¨å°±æ¯æä»¶ãè¿ç§»åªéè¦æä»¶å¤¹çæ´ä½æ·è´æåªåå°å¦å¤ä½ç½®ãå é¤å¯ä»¥ç´æ¥å é¤å¯¹åºæä»¶å¤¹å³å¯ã\n\n\n# 2.2 ç½ç»è¿æ¥çä¸ç§æ¹å¼\n\n\n\nå¼ ä¸ãæåãçäºä¸äººæ­¤æ¶å¨åä¸ä¸ªç½æ®µä¸ï¼é½æ¯192.168.0.xï¼ï¼ä»ä»¬å¯ä»¥è¿è¡ç¸äºéä¿¡ã\n\n# 1ï¼æ¡¥æ¥æ¨¡å¼ï¼å¼ ä¸ï¼\n\nå¨æ¡¥æ¥æ¨¡å¼ä¸ï¼èææº ip å°åéè¦ä¸ä¸»æºå¨åä¸ä¸ªç½æ®µï¼ç»èæç³»ç»ååéä¸ä¸ªæ¬ç½æ®µç ipãèæç³»ç»å¯ä»¥åå¤é¨ç³»ç»éè®¯ï¼ä½è¿å®¹æé æ ip å²çªã\n\n# 2ï¼nat æ¨¡å¼ï¼çäºï¼\n\nnat æ¨¡å¼ï¼å°±æ¯ç½ç»å°åè½¬æ¢æ¨¡å¼ãèæç³»ç»å¯ä»¥åå¤é¨ç³»ç»éè®¯ï¼ä¸é æ ip å²çªãæ­¤æ¶192.168.0.50 æ¯ä¸ªä»£çï¼èæç³»ç»åªæ¯éè¿ä»£çæ¥åå¤é¨è¿è¡éä¿¡ï¼ä½æ¯å¤é¨æ æ³ç´æ¥è®¿é®å°192.168.100.88 ï¼ææå³ä¾§åªæä¸ä¸ªç®­å¤´ã\n\n# 3ï¼ä»ä¸»æºæ¨¡å¼ï¼æåï¼\n\nä¸ä¸ªç¬ç«çç³»ç»ï¼ä¸åå¤é¨äº§çèç³»ã\n\n\n# 2.3 vmtools\n\nvmtools å¯ä»¥è®©æä»¬å¨ windows ä¸æ´å¥½çç®¡çèææºï¼æ¯å¦å¯ä»¥è®¾ç½® windows å centos å±äº«æä»¶ã\n\n# 2.3.1 vmtools çå®è£\n\n 1. vmware ä¸æ¹ èææº -> ï¼éæ°ï¼å®è£ vm tools\n 2. æ¡é¢ä¸åºç°ä¸ä¸ª vmware toolsï¼æå¼éé¢æä¸ª xxx.tar.gzï¼å°å¶æ·è´å° /opt\n 3. ä½¿ç¨è§£åå½ä»¤ tar -zxvf xx.tar.gz å¾å°ä¸ä¸ªå®è£æä»¶\n 4. è¿å¥è¯¥å®è£æä»¶å¤¹éé¢ï¼æ§è¡å½ä»¤ ./vmware-install.pl è¿è¡å®è£ï¼å®è£è¿ç¨å¨é¨åè½¦é»è®¤å³å¯ï¼ç´å°å®è£å®æã\n\n> æ³¨æç¹ï¼\n> \n>  * å®è£è¿ç¨éè¦æ gccï¼ gcc -væ¥ççæ¬ã\n>  * ç¬¬ä¸æ­¥çç¹å» ï¼éæ°ï¼å®è£ vm tools åå¯è½æ²¡æååºï¼åªéè¦åæ¶ä¸ä¸åéæ°ç¹ä¸ä¸å³å¯ã\n\n# 2.3.2 ä¸»æºä¸ vm å±äº«æä»¶å¤¹\n\n 1. å®è£ vmtools åï¼å¨ vmware ç è®¾ç½® -> éé¡¹ -> å±äº«æä»¶å¤¹\n 2. å¨è¿ä¸ªçé¢ä¸­ï¼åç¹å» æ»æ¯å¯ç¨ ï¼ç¶åå¨ä¸é¢æä»¶å¤¹ä¸­æ·»å éè¦å±äº«çæä»¶å¤¹\n 3. å¨èæç³»ç»ä¸­ï¼/mnt éå¯ä»¥æ¾å°å±äº«çæä»¶å¤¹ï¼å¯¹å¶çä¿®æ¹ä¹ä¼åæ­¥å°ä¸»æºä¸­\n\n\n# 3. linux çç®å½ç»æ\n\n\n# 3.1 åºæ¬ä»ç»\n\nlinux éç¨å±çº§ç®å½ç»æï¼æä¸å±æ¯æ ¹ç®å½ /ã\n\nå¨ linux ä¸çéï¼ä¸åçæä»¶ã\n\n\n# 3.2 å·ä½çç®å½ç»æ\n\nç®å½            è¯´æ\n/bin          æ /usr/binã/usr/local/binãbinary çç¼©åï¼å­æ¾çæç»å¸¸ä½¿ç¨çå½ä»¤ã\n/sbin         æ /usr/sbinã/usr/local/sbinãs ââ super userï¼å­æ¾çç³»ç»ç®¡çåä½¿ç¨çç¨åºã\n/home         å­æ¾æ®éç¨æ·çä¸»ç®å½ï¼æ¯ä¸ªç¨æ·æä¸ä¸ªèªå·±çç®å½ã\n/root         ç³»ç»ç®¡çåçä¸»ç®å½\n/lib          ç³»ç»å¼æºæéè¦çæåºæ¬çå¨æé¾æ¥å±äº«åºãå ä¹ææåºç¨ç¨åºé½éè¦è¿äºåºã\n/lost+found   ä¸è¬ä¸ºç©ºï¼å½ç³»ç»éæ³å³æºæ¶è¿éå°±å­æ¾äºä¸äºæä»¶ã\n/etc          ææçç³»ç»ç®¡çæéè¦çéç½®æä»¶åå­ç®å½ãæ¯å¦å®è£ mysql æ¶ç my.conf\n/usr          ç¨æ·å®è£çå¾å¤åºç¨ç¨åºé½æ¾å¨è¿ä¸ªç®å½ä¸ãç±»ä¼¼äº windows ç program filesã\n/boot         å­æ¾çå¯å¨ linux æ¶ä½¿ç¨çæ ¸å¿æä»¶\n/proc         ãä¸è½å¨ããæ¯ä¸ä¸ªèæç®å½ï¼å®æ¯ç³»ç»åå­çæ å°ï¼è®¿é®è¿ä¸ªç®å½æ¥è·åç³»ç»ä¿¡æ¯ã\n/srv          ãä¸è½å¨ããservice çç¼©åï¼å­æ¾ä¸äºæå¡å¯å¨åéè¦æåçæ°æ®\n/sys          ãä¸è½å¨ããå®è£äº 2.6 åæ ¸ä¸­æ°åºç°çä¸ä¸ªæä»¶ç³»ç» sysfs\n/tmp          å­æ¾ä¸´æ¶æä»¶\n/dev          æææè®¾å¤ç¡¬ä»¶ç¨æä»¶çå½¢å¼å­å¨\n/media        linux èªå¨è¯å«çä¸äºè®¾å¤ï¼å¦ u çãåé©±ï¼æè½½å°è¿ä¸ªç®å½ä¸ã\n/mnt          è®©ç¨æ·ä¸´æ¶æè½½å«çæä»¶ç³»ç»ãæä»¬å¯ä»¥å°å¤é¨å­å¨æè½½å° /mnt ä¸ï¼ç¶åè¿å¥éé¢æ¥çåå®¹\n/opt          ä¸»æºé¢å¤å®è£è½¯ä»¶æå­æ¾çç®å½ãå¦å®è£ oracle å°±å¯ä»¥æ¾å°è¿éé¢\n/usr/local    è¿æ¯å¦ä¸ä¸ªç»ä¸»æºé¢å¤å®è£è½¯ä»¶æå­æ¾çç®å½ãè¿éä¸è¬æ¯éè¿ç¼è¯æºç æ¹å¼å®è£çç¨åºãï¼è½¯ä»¶çä½¿ç¨ç®å½ï¼è½¯ä»¶å®è£çç®æ ç®å½ï¼\n/var          å­æ¾çä¸æ­æ©åççä¸è¥¿ï¼ä¹ æ¯å°ç»å¸¸ä¿®æ¹çç®å½æ¾å¨è¿éé¢ï¼å¦æ¥å¿æä»¶ã\n/selinux      security-enhanced linuxãselinux æ¯ä¸ç§å®å¨å­ç³»ç»ï¼å®è½æ§å¶ç¨åºåªè½è®¿é®ç¹å®æä»¶ã\n\n\n# 3.3 æä»¶ç®å½çç¸å³æä»¤\n\n# 3.3.1 *pwd\n\næ¾ç¤ºå½åå·¥ä½ç®å½çç»å¯¹è·¯å¾ã\n\n# 3.3.2 *ls\n\nls [éé¡¹] [ç®å½ææä»¶]\n\n * -aï¼æ¾ç¤ºåæ¬éèæä»¶å¨åçæææä»¶\n * -lï¼ä»¥ååçæ¹å¼æ¾ç¤ºè¯¦ç»ä¿¡æ¯\n * -hï¼ç»äººçç\n\n> è¡¥åç¥è¯ç¹ï¼\n> \n>  * linux ä¸ï¼éèæä»¶æ¯ä»¥ . å¼å¤´\n>  * å½ä»¤çéé¡¹å¯ä»¥ç»åä½¿ç¨ï¼æ é¡ºåºå·®å«ï¼æ¯å¦ ls çéé¡¹å¯ä»¥ç»åæ ls -al æè ls -laã\n>  * ls å½ä»¤è¿å¯ä»¥æå®ä¸ä¸ªç®å½ï¼æ¯å¦ ls -l /root\n\n# 3.3.3 *cd åæ¢å°æå®ç®å½\n\n * cd ~ï¼åå°å®¶ç®å½ï¼è¥ä½ æ¯ root ï¼åå° /rootï¼è¥æ¯ tomï¼åå° /home/tom\n * cd ..ï¼åå°ä¸ä¸çº§ç®å½\n * cd /usrï¼åæ¢å° /usr ç®å½\n\n> cd .. å¯ä»¥è¿ç»­ä½¿ç¨ï¼æ¯å¦ï¼å½åå¨ /home/tom ä¸ï¼ä½¿ç¨ cd ../../root å³å¯å° /root\n\n# 3.3.4 mkdir åå»ºç®å½\n\nmkdir [éé¡¹] è¦åå»ºçç®å½\n\n * -pï¼åå»ºå¤çº§ç®å½\n\n> æ¡ä¾ï¼\n> \n>  * åå»ºä¸ä¸ªç®å½ï¼mkdir /home/dog\n>  * åå»ºå¤çº§ç®å½ï¼mkdir -p /home/animal/tiger\n\n# 3.3.5 rmdir å é¤ç®å½\n\nrmdir [éé¡¹] è¦å é¤çç©ºç®å½\n\n\n1\n\n * rmdir å é¤çæ¯ç©ºç®å½ï¼å¦æç®å½ä¸æåå®¹æ¶æ æ³å é¤\n * å¦æéè¦å é¤éç©ºç®å½ï¼åºè¯¥ä½¿ç¨ rm -rf è¦å é¤çç®å½ï¼-r éå½å é¤ï¼-f å¼ºå¶å é¤\n\n# 3.3.6 touch åå»ºç©ºæä»¶\n\ntouch æä»¶å\n\n# 3.3.7 *cp æ·è´\n\ncp [éé¡¹] src dst\n\n * -rï¼éå½å¤å¶æ´ä¸ªæä»¶å¤¹\n * å¼ºå¶è¦çä¸æç¤ºçæ¹æ³ï¼\\cpï¼æ¯å¦ \\cp -r /home/src /opt\n\n# 3.3.8 *rm ç§»é¤æä»¶æç®å½\n\nrm [éé¡¹] è¦ç§»é¤çæä»¶æç®å½\n\n\n1\n\n\n * -rï¼éå½å é¤æ´ä¸ªæä»¶å¤¹\n\n * -fï¼å¼ºå¶å é¤ä¸æç¤ºï¼ä¸å æ­¤éé¡¹æ¶ï¼æ¯å é¤ä¸ä¸ªæä»¶é½è¦æç¤ºä¸æ¬¡\n   \n   rm -rf [dir] ä¸å®è¦ç°å¸¸å°å¿å°æä½ï¼ï¼ç´æ¥å äºæ´ä¸ªç®å½äºï¼\n\n# 3.3.9 mv ç§»å¨ï¼æä»¶/ç®å½ï¼æéå½å\n\nmv old new\n\n * å¯ä»¥ç§»å¨å¹¶ä¸éå½å\n\n> æ¡ä¾ï¼\n> \n>  * mv cat.txt pig.txtï¼å° cat.text éå½åä¸º pig.txt\n>  * mv /home/src /opt/ï¼å° /home/src ç§»å¨å° /opt ä¸é¢\n\n# 3.3.10 cat\n\nåªè½æ¥çä¸è½ä¿®æ¹ï¼æ¯ vim æ´å®å¨ï¼å æ­¤å¯¹äºéè¦çæä»¶ï¼å»ºè®®ç¨ cat å½ä»¤ã\n\ncat [éé¡¹] æä»¶å\n\n * -nï¼æ¾ç¤ºè¡å·\n * ä¸ºäºæµè§æ¹ä¾¿ï¼ä¸è¬ä¼å¸¦ä¸ç®¡éå½ä»¤ | more\n\n> ç®¡éå½ä»¤ï¼å°åä¸ä¸ªæä»¤çè¾åºä½ä¸ºåä¸ä¸ªæä»¤çè¾å¥\n\n> æ¡ä¾ï¼\n> \n>  * cat -n /etc/profile | more ï¼æ¥ç profile æä»¶åå®¹ï¼å¯ä»¥ä½¿ç¨ more å½ä»¤çæé®è¿è¡äº¤äºã\n\n# 3.3.11 more\n\nmore æä»¤ä»¥å¨å±çæ¹å¼æé¡µæ¾ç¤ºææ¬åå®¹ãå¸¸è§æä½ï¼\n\næä½       åè½\nç©ºç½é®      åä¸ç¿»é¡µ\nenter    åä¸ç¿»ä¸è¡\nq        ç¦»å¼ more\nctrl f   åä¸æ»å¨ä¸å±\nctrl b   è¿åä¸ä¸å±\n=        è¾åºå½åè¡å·\n:f       è¾åºæä»¶ååå½åè¡å·\n\n# 3.3.12 less\n\nç¨æ¥åå±æ¥çæä»¶åå®¹ï¼ä¸ more æä»¤ç±»ä¼¼ï¼ä½æ´å å¼ºå¤§ãæ¯æåç§ç»ç«¯ï¼æ¾ç¤ºææ¬æ¶æéå è½½ææ¬åå®¹ï¼å¯¹å¤§åæä»¶æçè¾é«ã\n\næ¥çè¾å¤§çæä»¶æ¶ï¼æ´å»ºè®®ä½¿ç¨ less å½ä»¤ã\n\nå¸¸è§æä½ï¼\n\næä½           åè½\nç©ºç½é®          åä¸ç¿»é¡µ\n[pagedown]   åä¸ç¿»é¡µ\n[pageup]     åä¸ç¿»é¡µ\n/str         åä¸æç´¢ âstrâãn ä¸ä¸ä¸ªï¼n ä¸ä¸ä¸ª\n?str         åä¸æç´¢ âstrâãn ä¸ä¸ä¸ªï¼n ä¸ä¸ä¸ª\nq            ç¦»å¼ less\n\n# 3.3.13 echo è¾åºåå®¹å°æ§å¶å°\n\necho [éé¡¹] [è¾åºåå®¹]\n\n> æ¡ä¾ï¼\n> \n>  * â­ï¸ echo è¾åºç¯å¢åéï¼echo $pathï¼å¶ä¸­ $ åé¢æ¥ç¯å¢åéåã\n>  * è¾åºä¸»æºåï¼echo $hostname\n\n# 3.3.14 head æ¾ç¤ºæä»¶å¼å¤´é¨å\n\nhead æä»¶ é»è®¤æ¾ç¤ºæä»¶å 10 è¡åå®¹ã\n\n * -nï¼æå®æ¾ç¤ºåå è¡ï¼æ¯å¦ head -n 5 foo.txt\n\n# 3.3.15 tail æ¾ç¤ºæä»¶ç»å°¾é¨å\n\ntail æä»¶ æ¾ç¤ºæä»¶æåé»è®¤ 10 è¡åå®¹ã\n\n * -nï¼æå®è¡æ°\n * -fï¼å®æ¶è¿½è¸ªè¯¥ææ¡£çæææ´æ°ï¼å¹¶æå°åºæ¥\n\n> -f çä½ç¨ï¼\n> \n>  * åæå¡å¨ç®¡çæ¶ï¼éè¦çæ§æä¸ªæä»¶ï¼æ¯å¦çæ§ååãç½ç»çå®æ¶ååï¼å¯ä»¥ç¨è¿ä¸ªéé¡¹ã\n\n# 3.3.16 > å >> éå®å\n\n * > è¾åºéå®å\n * >> éå®åå¹¶è¿½å \n\n> æ¡ä¾ï¼\n> \n>  * ls -l > foo.txtï¼å° ls çè¾åºè¦çåå¥ foo.txt ä¸­ï¼è¯¥æä»¶ä¸å­å¨æ¶ï¼ä¼èªå¨åå»ºè¿ä¸ªæä»¶\n>  * cat foo.txt > bar.txt ï¼å° foo.txt åå®¹è¦çå° bar.txt\n>  * echo âhelloâ >> foo.txt ï¼å° hello è¿½å å°æä»¶åé¢\n\n# 3.3.17 ln åå»ºè½¯é¾æ¥\n\nlnï¼æ¯ link çç¼©åï¼åå»ºä¸ä¸ªè½¯é¾æ¥ï¼ç±»ä¼¼ windows çå¿«æ·æ¹å¼ï¼ï¼ä¸»è¦å­æ¾äºé¾æ¥å¶ä»æä»¶çè·¯å¾ã\n\nln -s [åæä»¶æç®å½] [è½¯é¾æ¥å]ï¼ç»åæä»¶åå»ºä¸ä¸ªè½¯é¾æ¥ã\n\ne.g. å¨ /home ç®å½ä¸åå»ºä¸ä¸ªè½¯è¿æ¥ myrootï¼è¿æ¥å° /root ç®å½ï¼\n\nln -s /root /home/myroot\n\n * rm å é¤çæ¯è½¯é¾æ¥ï¼ä¸ä¼å é¤å°åæä»¶\n * pwd æ¥çç®å½æ¶ä»ç¶çå°çæ¯è½¯é¾æ¥æå¨ç®å½\n\n> rm /home/myroot ï¼myroot åé¢ä¸è¦å  / ï¼å¦åä¼è§ä¸ºä¸ä¸ªç®å½\n\n# 3.3.18 history\n\nhistory æ¥çå·²ç»æ§è¡è¿çåå²å½ä»¤ï¼ä¹å¯ä»¥æ§è¡åå²å½ä»¤\n\n * historyï¼æ¾ç¤ºææçåå²å½ä»¤\n * history 10ï¼æ¾ç¤ºæè¿ä½¿ç¨è¿ç 10 ä¸ªæä»¤\n * !5ï¼æä»¤åå²ç¼å·ä¸º 5 çæä»¤\n\n\n# 4. è¿ç¨ç»å½å° linux æå¡å¨\n\næä»¬è¿éä½¿ç¨ xshell 6 å xftp 6 æ¥ä½ä¸ºè¿ç¨ç»å½å®¢æ·ç«¯ã\n\nxshell æ¯ç¨æ¥è¿ç¨ç»å½æå¡å¨å¹¶å¯¹å¶è¿è¡æä½çï¼xftp æ¯ç¨æ¥æ¬å°åæå¡å¨è¿è¡æä»¶ä¼ è¾çã\n\nå¨èææºä¸­ä½¿ç¨ ifconfig æ¥ç ip å°åï¼ens33å°±æ¯ç½å¡ï¼å¨ç¬¬ä¸é¨åç inet ä¸­å¯ä»¥çå° ipã\n\nç¶åå°è¯ä¸»æºä¸èææºè½å¦è¿éï¼å¨ä¸»æºä¸­ç¨ ping <ip> æµè¯æ¯å¦è½å¤æåã\n\nå¨ xshell å xftp ä¸­æ°å»ºä¼è¯å³å¯ã\n\nwindows è¿å¯ä»¥ç¨ finalshell ä½ä¸ºè¿ç¨ç»å½å·¥å·ï¼åè´¹ä¸ç¸å½äºxshell + xftp çåä½ã",charsets:{cjk:!0},lastUpdated:"2022/07/27, 11:28:29",lastUpdatedTimestamp:1658921309e3},{title:"Linuxå®æç¯ï¼ä¸ï¼",frontmatter:{title:"Linuxå®æç¯ï¼ä¸ï¼",date:"2022-04-11T13:38:58.000Z",permalink:"/pages/4a5b75/",categories:["åºç¡","Linux","é©é¡ºå¹³2021è¯¾ç¨ç¬è®°"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/10.Linux/05.%E9%9F%A9%E9%A1%BA%E5%B9%B32021%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/10.Linux%E5%AE%9E%E6%93%8D%E7%AF%87%EF%BC%88%E4%B8%8A%EF%BC%89.html",relativePath:"åºç¡/10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/10.Linuxå®æç¯ï¼ä¸ï¼.md",key:"v-c45fcee4",path:"/pages/4a5b75/",headers:[{level:2,title:"1. Vi å Vim ç¼è¾å¨",slug:"_1-vi-å-vim-ç¼è¾å¨",normalizedTitle:"1. vi å vim ç¼è¾å¨",charIndex:2},{level:2,title:"2. å¼æºãéå¯ä¸ç¨æ·ç»å½æ³¨é",slug:"_2-å¼æºãéå¯ä¸ç¨æ·ç»å½æ³¨é",normalizedTitle:"2. å¼æºãéå¯ä¸ç¨æ·ç»å½æ³¨é",charIndex:149},{level:3,title:"2.1 å³æº & éå¯å½ä»¤",slug:"_2-1-å³æº-éå¯å½ä»¤",normalizedTitle:"2.1 å³æº &amp; éå¯å½ä»¤",charIndex:null},{level:3,title:"2.2 ç¨æ·ç»å½ä¸æ³¨é",slug:"_2-2-ç¨æ·ç»å½ä¸æ³¨é",normalizedTitle:"2.2 ç¨æ·ç»å½ä¸æ³¨é",charIndex:512},{level:2,title:"3. ç¨æ·ç®¡ç",slug:"_3-ç¨æ·ç®¡ç",normalizedTitle:"3. ç¨æ·ç®¡ç",charIndex:604},{level:3,title:"3.1 æ·»å ç¨æ·",slug:"_3-1-æ·»å ç¨æ·",normalizedTitle:"3.1 æ·»å ç¨æ·",charIndex:639},{level:3,title:"3.2 æå®/ä¿®æ¹å¯ç ",slug:"_3-2-æå®-ä¿®æ¹å¯ç ",normalizedTitle:"3.2 æå®/ä¿®æ¹å¯ç ",charIndex:749},{level:3,title:"3.3 å é¤ç¨æ·",slug:"_3-3-å é¤ç¨æ·",normalizedTitle:"3.3 å é¤ç¨æ·",charIndex:817},{level:3,title:"3.4 æ¥è¯¢ç¨æ·ä¿¡æ¯",slug:"_3-4-æ¥è¯¢ç¨æ·ä¿¡æ¯",normalizedTitle:"3.4 æ¥è¯¢ç¨æ·ä¿¡æ¯",charIndex:926},{level:3,title:"3.5 åæ¢ç¨æ·",slug:"_3-5-åæ¢ç¨æ·",normalizedTitle:"3.5 åæ¢ç¨æ·",charIndex:973},{level:3,title:"3.6 æ¥çå½åç»å½ç¨æ·",slug:"_3-6-æ¥çå½åç»å½ç¨æ·",normalizedTitle:"3.6 æ¥çå½åç»å½ç¨æ·",charIndex:1077},{level:3,title:"3.7 ç¨æ·ç»",slug:"_3-7-ç¨æ·ç»",normalizedTitle:"3.7 ç¨æ·ç»",charIndex:1185},{level:3,title:"3.8 ç¨æ·åç»ç¸å³çæä»¶",slug:"_3-8-ç¨æ·åç»ç¸å³çæä»¶",normalizedTitle:"3.8 ç¨æ·åç»ç¸å³çæä»¶",charIndex:1395},{level:2,title:"4. å®ç¨æä»¤",slug:"_4-å®ç¨æä»¤",normalizedTitle:"4. å®ç¨æä»¤",charIndex:1766},{level:3,title:"4.1 è¿è¡çº§å«",slug:"_4-1-è¿è¡çº§å«",normalizedTitle:"4.1 è¿è¡çº§å«",charIndex:1778},{level:4,title:"CentOS 7 åè¿è¡çº§å«è¯´æ",slug:"centos-7-åè¿è¡çº§å«è¯´æ",normalizedTitle:"centos 7 åè¿è¡çº§å«è¯´æ",charIndex:2016},{level:3,title:"4.2 æ¾å root å¯ç ",slug:"_4-2-æ¾å-root-å¯ç ",normalizedTitle:"4.2 æ¾å root å¯ç ",charIndex:2260},{level:3,title:"4.3 å¸®å©æä»¤",slug:"_4-3-å¸®å©æä»¤",normalizedTitle:"4.3 å¸®å©æä»¤",charIndex:2310},{level:3,title:"4.4 æ¶é´æ¥æç±»",slug:"_4-4-æ¶é´æ¥æç±»",normalizedTitle:"4.4 æ¶é´æ¥æç±»",charIndex:2536},{level:4,title:"4.4.1 date æ¾ç¤ºå½åæ¥æ",slug:"_4-4-1-date-æ¾ç¤ºå½åæ¥æ",normalizedTitle:"4.4.1 date æ¾ç¤ºå½åæ¥æ",charIndex:2549},{level:4,title:"4.4.2 cal æ¾ç¤ºæ¥å",slug:"_4-4-2-cal-æ¾ç¤ºæ¥å",normalizedTitle:"4.4.2 cal æ¾ç¤ºæ¥å",charIndex:2761},{level:3,title:"4.5 æç´¢æ¥æ¾ç±»",slug:"_4-5-æç´¢æ¥æ¾ç±»",normalizedTitle:"4.5 æç´¢æ¥æ¾ç±»",charIndex:2848},{level:4,title:"4.5.1 find",slug:"_4-5-1-find",normalizedTitle:"4.5.1 find",charIndex:2861},{level:4,title:"4.5.2 locate",slug:"_4-5-2-locate",normalizedTitle:"4.5.2 locate",charIndex:3243},{level:4,title:"4.5.3 which",slug:"_4-5-3-which",normalizedTitle:"4.5.3 which",charIndex:3421},{level:4,title:"4.5.4 grep æä»¤åç®¡éç¬¦å· |",slug:"_4-5-4-grep-æä»¤åç®¡éç¬¦å·",normalizedTitle:"4.5.4 grep æä»¤åç®¡éç¬¦å· |",charIndex:3485},{level:3,title:"4.6 åç¼©åè§£åç±»",slug:"_4-6-åç¼©åè§£åç±»",normalizedTitle:"4.6 åç¼©åè§£åç±»",charIndex:3736},{level:4,title:"4.6.1 gzip åç¼© & gunzip è§£å",slug:"_4-6-1-gzip-åç¼©-gunzip-è§£å",normalizedTitle:"4.6.1 gzip åç¼© &amp; gunzip è§£å",charIndex:null},{level:4,title:"4.6.2 zip åç¼© & unzip è§£å",slug:"_4-6-2-zip-åç¼©-unzip-è§£å",normalizedTitle:"4.6.2 zip åç¼© &amp; unzip è§£å",charIndex:null},{level:4,title:"4.6.3 tar æå â­ï¸",slug:"_4-6-3-tar-æå-â­ï¸",normalizedTitle:"4.6.3 tar æå â­ï¸",charIndex:4125},{level:2,title:"5. ç»ç®¡çåæéç®¡ç",slug:"_5-ç»ç®¡çåæéç®¡ç",normalizedTitle:"5. ç»ç®¡çåæéç®¡ç",charIndex:4720},{level:3,title:"5.1 ææè",slug:"_5-1-ææè",normalizedTitle:"5.1 ææè",charIndex:4817},{level:4,title:"5.1.1 æ¥çæä»¶çææè",slug:"_5-1-1-æ¥çæä»¶çææè",normalizedTitle:"5.1.1 æ¥çæä»¶çææè",charIndex:4849},{level:4,title:"5.1.2 ä¿®æ¹æä»¶ææè",slug:"_5-1-2-ä¿®æ¹æä»¶ææè",normalizedTitle:"5.1.2 ä¿®æ¹æä»¶ææè",charIndex:4907},{level:3,title:"5.2 ç»çåå»º",slug:"_5-2-ç»çåå»º",normalizedTitle:"5.2 ç»çåå»º",charIndex:5045},{level:3,title:"5.3 æå¨ç»",slug:"_5-3-æå¨ç»",normalizedTitle:"5.3 æå¨ç»",charIndex:5236},{level:4,title:"53.1 æ¥çæä»¶çæå¨ç»",slug:"_53-1-æ¥çæä»¶çæå¨ç»",normalizedTitle:"53.1 æ¥çæä»¶çæå¨ç»",charIndex:5285},{level:4,title:"5.3.2 ä¿®æ¹æä»¶çæå¨ç»",slug:"_5-3-2-ä¿®æ¹æä»¶çæå¨ç»",normalizedTitle:"5.3.2 ä¿®æ¹æä»¶çæå¨ç»",charIndex:5316},{level:3,title:"5.4 å¶ä»ç»",slug:"_5-4-å¶ä»ç»",normalizedTitle:"5.4 å¶ä»ç»",charIndex:5364},{level:3,title:"5.5 æ¹åç¨æ·çæå¨ç»",slug:"_5-5-æ¹åç¨æ·çæå¨ç»",normalizedTitle:"5.5 æ¹åç¨æ·çæå¨ç»",charIndex:5411},{level:3,title:"5.6 æä»¶çæé",slug:"_5-6-æä»¶çæé",normalizedTitle:"5.6 æä»¶çæé",charIndex:5553},{level:4,title:"5.6.1 æéçåºæ¬ä»ç»",slug:"_5-6-1-æéçåºæ¬ä»ç»",normalizedTitle:"5.6.1 æéçåºæ¬ä»ç»",charIndex:5566},{level:4,title:"5.6.2 rwx æé â­ï¸",slug:"_5-6-2-rwx-æé-â­ï¸",normalizedTitle:"5.6.2 rwx æé â­ï¸",charIndex:5730},{level:5,title:"1ï¼rwx ä½ç¨å°æä»¶**",slug:"_1-rwx-ä½ç¨å°æä»¶",normalizedTitle:"1ï¼rwx ä½ç¨å°æä»¶**",charIndex:5749},{level:5,title:"2ï¼rwx ä½ç¨å°ç®å½**",slug:"_2-rwx-ä½ç¨å°ç®å½",normalizedTitle:"2ï¼rwx ä½ç¨å°ç®å½**",charIndex:5847},{level:4,title:"5.6.3 æéçæ°å­è¡¨ç¤º",slug:"_5-6-3-æéçæ°å­è¡¨ç¤º",normalizedTitle:"5.6.3 æéçæ°å­è¡¨ç¤º",charIndex:5961},{level:4,title:"5.6.4 chmod ä¿®æ¹æé",slug:"_5-6-4-chmod-ä¿®æ¹æé",normalizedTitle:"5.6.4 chmod ä¿®æ¹æé",charIndex:6033},{level:5,title:"1ï¼ç¬¬ä¸ç§æ¹å¼ï¼+ - = åæ´æé",slug:"_1-ç¬¬ä¸ç§æ¹å¼-åæ´æé",normalizedTitle:"1ï¼ç¬¬ä¸ç§æ¹å¼ï¼+ - = åæ´æé",charIndex:6090},{level:5,title:"2ï¼ç¬¬äºç§æ¹å¼ï¼éè¿æ°å­åæ´æé",slug:"_2-ç¬¬äºç§æ¹å¼-éè¿æ°å­åæ´æé",normalizedTitle:"2ï¼ç¬¬äºç§æ¹å¼ï¼éè¿æ°å­åæ´æé",charIndex:6297},{level:4,title:"5.6.5 å¶ä»è¯´æ",slug:"_5-6-5-å¶ä»è¯´æ",normalizedTitle:"5.6.5 å¶ä»è¯´æ",charIndex:6394},{level:2,title:"6. å®æ¶ä»»å¡è°åº¦",slug:"_6-å®æ¶ä»»å¡è°åº¦",normalizedTitle:"6. å®æ¶ä»»å¡è°åº¦",charIndex:6482},{level:3,title:"6.1 crond ä»»å¡è°åº¦",slug:"_6-1-crond-ä»»å¡è°åº¦",normalizedTitle:"6.1 crond ä»»å¡è°åº¦",charIndex:6496},{level:4,title:"6.1.1 æ¦è¿°",slug:"_6-1-1-æ¦è¿°",normalizedTitle:"6.1.1 æ¦è¿°",charIndex:6604},{level:4,title:"6.1.2 åºæ¬è¯­æ³",slug:"_6-1-2-åºæ¬è¯­æ³",normalizedTitle:"6.1.2 åºæ¬è¯­æ³",charIndex:6719},{level:4,title:"6.1.3 å¿«éå¥é¨",slug:"_6-1-3-å¿«éå¥é¨",normalizedTitle:"6.1.3 å¿«éå¥é¨",charIndex:6861},{level:5,title:"ä»»å¡ä¹¦åæ ¼å¼ï¼",slug:"ä»»å¡ä¹¦åæ ¼å¼",normalizedTitle:"ä»»å¡ä¹¦åæ ¼å¼ï¼",charIndex:7022},{level:5,title:"5 ä¸ªå ä½ç¬¦çè¯´æï¼",slug:"_5-ä¸ªå ä½ç¬¦çè¯´æ",normalizedTitle:"5 ä¸ªå ä½ç¬¦çè¯´æï¼",charIndex:7111},{level:5,title:"ç¹æ®ç¬¦å·çè¯´æ",slug:"ç¹æ®ç¬¦å·çè¯´æ",normalizedTitle:"ç¹æ®ç¬¦å·çè¯´æ",charIndex:7425},{level:3,title:"6.2 at å®æ¶ä»»å¡",slug:"_6-2-at-å®æ¶ä»»å¡",normalizedTitle:"6.2 at å®æ¶ä»»å¡",charIndex:7878},{level:4,title:"6.2.1 at æ¶é´å®ä¹çæ¹æ³",slug:"_6-2-1-at-æ¶é´å®ä¹çæ¹æ³",normalizedTitle:"6.2.1 at æ¶é´å®ä¹çæ¹æ³",charIndex:8569},{level:2,title:"7. ç£çååºãæè½½",slug:"_7-ç£çååºãæè½½",normalizedTitle:"7. ç£çååºãæè½½",charIndex:9131},{level:3,title:"7.1 Linux ååº",slug:"_7-1-linux-ååº",normalizedTitle:"7.1 linux ååº",charIndex:9146},{level:4,title:"7.1.1 åçä»ç»",slug:"_7-1-1-åçä»ç»",normalizedTitle:"7.1.1 åçä»ç»",charIndex:9197},{level:4,title:"7.1.2 ç¡¬çè¯´æ",slug:"_7-1-2-ç¡¬çè¯´æ",normalizedTitle:"7.1.2 ç¡¬çè¯´æ",charIndex:9389},{level:4,title:"7.1.3 æ¥çææè®¾å¤æè½½æåµ",slug:"_7-1-3-æ¥çææè®¾å¤æè½½æåµ",normalizedTitle:"7.1.3 æ¥çææè®¾å¤æè½½æåµ",charIndex:9728},{level:3,title:"7.2 æè½½çç»å¸æ¡ä¾ ââ å¢å ä¸åç¡¬ç",slug:"_7-2-æè½½çç»å¸æ¡ä¾-å¢å ä¸åç¡¬ç",normalizedTitle:"7.2 æè½½çç»å¸æ¡ä¾ ââ å¢å ä¸åç¡¬ç",charIndex:9830},{level:4,title:"1ï¼èææºæ·»å ç¡¬ç",slug:"_1-èææºæ·»å ç¡¬ç",normalizedTitle:"1ï¼èææºæ·»å ç¡¬ç",charIndex:9932},{level:4,title:"2ï¼ç£çååº",slug:"_2-ç£çååº",normalizedTitle:"2ï¼ç£çååº",charIndex:10022},{level:4,title:"3ï¼æ ¼å¼åç£ç",slug:"_3-æ ¼å¼åç£ç",normalizedTitle:"3ï¼æ ¼å¼åç£ç",charIndex:10249},{level:4,title:"4ï¼æè½½",slug:"_4-æè½½",normalizedTitle:"4ï¼æè½½",charIndex:10347},{level:4,title:"5ï¼è®¾ç½®èªå¨æè½½",slug:"_5-è®¾ç½®èªå¨æè½½",normalizedTitle:"5ï¼è®¾ç½®èªå¨æè½½",charIndex:10499},{level:3,title:"7.3 ç£çæåµæ¥è¯¢",slug:"_7-3-ç£çæåµæ¥è¯¢",normalizedTitle:"7.3 ç£çæåµæ¥è¯¢",charIndex:10681},{level:4,title:"7.3.1 æ¥è¯¢ç³»ç»æ´ä½ç£çä½¿ç¨æåµ",slug:"_7-3-1-æ¥è¯¢ç³»ç»æ´ä½ç£çä½¿ç¨æåµ",normalizedTitle:"7.3.1 æ¥è¯¢ç³»ç»æ´ä½ç£çä½¿ç¨æåµ",charIndex:10695},{level:4,title:"7.3.2 æ¥è¯¢æå®ç®å½çç£çå ç¨æåµ",slug:"_7-3-2-æ¥è¯¢æå®ç®å½çç£çå ç¨æåµ",normalizedTitle:"7.3.2 æ¥è¯¢æå®ç®å½çç£çå ç¨æåµ",charIndex:11388},{level:3,title:"7.4 ç£çæåµ - å·¥ä½å®ç¨æä»¤",slug:"_7-4-ç£çæåµ-å·¥ä½å®ç¨æä»¤",normalizedTitle:"7.4 ç£çæåµ - å·¥ä½å®ç¨æä»¤",charIndex:11768},{level:4,title:"1ï¼ç»è®¡ /opt æä»¶å¤¹ä¸æä»¶çä¸ªæ°",slug:"_1-ç»è®¡-opt-æä»¶å¤¹ä¸æä»¶çä¸ªæ°",normalizedTitle:"1ï¼ç»è®¡ /opt æä»¶å¤¹ä¸æä»¶çä¸ªæ°",charIndex:11789},{level:4,title:"2ï¼ç»è®¡ /opt æä»¶å¤¹ä¸ç®å½çä¸ªæ°",slug:"_2-ç»è®¡-opt-æä»¶å¤¹ä¸ç®å½çä¸ªæ°",normalizedTitle:"2ï¼ç»è®¡ /opt æä»¶å¤¹ä¸ç®å½çä¸ªæ°",charIndex:11844},{level:4,title:"3ï¼ç»è®¡ /opt æä»¶å¤¹ä¸æä»¶çä¸ªæ°ï¼åæ¬å­æä»¶å¤¹ä¸ç",slug:"_3-ç»è®¡-opt-æä»¶å¤¹ä¸æä»¶çä¸ªæ°-åæ¬å­æä»¶å¤¹ä¸ç",normalizedTitle:"3ï¼ç»è®¡ /opt æä»¶å¤¹ä¸æä»¶çä¸ªæ°ï¼åæ¬å­æä»¶å¤¹ä¸ç",charIndex:11899},{level:4,title:"4ï¼ç»è®¡ /opt æä»¶å¤¹ä¸ç®å½çä¸ªæ°ï¼åæ¬å­æä»¶å¤¹ä¸ç",slug:"_4-ç»è®¡-opt-æä»¶å¤¹ä¸ç®å½çä¸ªæ°-åæ¬å­æä»¶å¤¹ä¸ç",normalizedTitle:"4ï¼ç»è®¡ /opt æä»¶å¤¹ä¸ç®å½çä¸ªæ°ï¼åæ¬å­æä»¶å¤¹ä¸ç",charIndex:11964},{level:4,title:"5ï¼ä»¥æ ç¶æ¾ç¤ºç®å½ç»æ",slug:"_5-ä»¥æ ç¶æ¾ç¤ºç®å½ç»æ",normalizedTitle:"5ï¼ä»¥æ ç¶æ¾ç¤ºç®å½ç»æ",charIndex:12029}],headersStr:"1. Vi å Vim ç¼è¾å¨ 2. å¼æºãéå¯ä¸ç¨æ·ç»å½æ³¨é 2.1 å³æº & éå¯å½ä»¤ 2.2 ç¨æ·ç»å½ä¸æ³¨é 3. ç¨æ·ç®¡ç 3.1 æ·»å ç¨æ· 3.2 æå®/ä¿®æ¹å¯ç  3.3 å é¤ç¨æ· 3.4 æ¥è¯¢ç¨æ·ä¿¡æ¯ 3.5 åæ¢ç¨æ· 3.6 æ¥çå½åç»å½ç¨æ· 3.7 ç¨æ·ç» 3.8 ç¨æ·åç»ç¸å³çæä»¶ 4. å®ç¨æä»¤ 4.1 è¿è¡çº§å« CentOS 7 åè¿è¡çº§å«è¯´æ 4.2 æ¾å root å¯ç  4.3 å¸®å©æä»¤ 4.4 æ¶é´æ¥æç±» 4.4.1 date æ¾ç¤ºå½åæ¥æ 4.4.2 cal æ¾ç¤ºæ¥å 4.5 æç´¢æ¥æ¾ç±» 4.5.1 find 4.5.2 locate 4.5.3 which 4.5.4 grep æä»¤åç®¡éç¬¦å· | 4.6 åç¼©åè§£åç±» 4.6.1 gzip åç¼© & gunzip è§£å 4.6.2 zip åç¼© & unzip è§£å 4.6.3 tar æå â­ï¸ 5. ç»ç®¡çåæéç®¡ç 5.1 ææè 5.1.1 æ¥çæä»¶çææè 5.1.2 ä¿®æ¹æä»¶ææè 5.2 ç»çåå»º 5.3 æå¨ç» 53.1 æ¥çæä»¶çæå¨ç» 5.3.2 ä¿®æ¹æä»¶çæå¨ç» 5.4 å¶ä»ç» 5.5 æ¹åç¨æ·çæå¨ç» 5.6 æä»¶çæé 5.6.1 æéçåºæ¬ä»ç» 5.6.2 rwx æé â­ï¸ 1ï¼rwx ä½ç¨å°æä»¶** 2ï¼rwx ä½ç¨å°ç®å½** 5.6.3 æéçæ°å­è¡¨ç¤º 5.6.4 chmod ä¿®æ¹æé 1ï¼ç¬¬ä¸ç§æ¹å¼ï¼+ - = åæ´æé 2ï¼ç¬¬äºç§æ¹å¼ï¼éè¿æ°å­åæ´æé 5.6.5 å¶ä»è¯´æ 6. å®æ¶ä»»å¡è°åº¦ 6.1 crond ä»»å¡è°åº¦ 6.1.1 æ¦è¿° 6.1.2 åºæ¬è¯­æ³ 6.1.3 å¿«éå¥é¨ ä»»å¡ä¹¦åæ ¼å¼ï¼ 5 ä¸ªå ä½ç¬¦çè¯´æï¼ ç¹æ®ç¬¦å·çè¯´æ 6.2 at å®æ¶ä»»å¡ 6.2.1 at æ¶é´å®ä¹çæ¹æ³ 7. ç£çååºãæè½½ 7.1 Linux ååº 7.1.1 åçä»ç» 7.1.2 ç¡¬çè¯´æ 7.1.3 æ¥çææè®¾å¤æè½½æåµ 7.2 æè½½çç»å¸æ¡ä¾ ââ å¢å ä¸åç¡¬ç 1ï¼èææºæ·»å ç¡¬ç 2ï¼ç£çååº 3ï¼æ ¼å¼åç£ç 4ï¼æè½½ 5ï¼è®¾ç½®èªå¨æè½½ 7.3 ç£çæåµæ¥è¯¢ 7.3.1 æ¥è¯¢ç³»ç»æ´ä½ç£çä½¿ç¨æåµ 7.3.2 æ¥è¯¢æå®ç®å½çç£çå ç¨æåµ 7.4 ç£çæåµ - å·¥ä½å®ç¨æä»¤ 1ï¼ç»è®¡ /opt æä»¶å¤¹ä¸æä»¶çä¸ªæ° 2ï¼ç»è®¡ /opt æä»¶å¤¹ä¸ç®å½çä¸ªæ° 3ï¼ç»è®¡ /opt æä»¶å¤¹ä¸æä»¶çä¸ªæ°ï¼åæ¬å­æä»¶å¤¹ä¸ç 4ï¼ç»è®¡ /opt æä»¶å¤¹ä¸ç®å½çä¸ªæ°ï¼åæ¬å­æä»¶å¤¹ä¸ç 5ï¼ä»¥æ ç¶æ¾ç¤ºç®å½ç»æ",content:'# 1. Vi å Vim ç¼è¾å¨\n\nè¦ä¼ä¸äºåºæ¬çå¿«æ·é®ï¼ä¸è¬å¨ Linux ä¸ä¸éè¦ç¹å«å¤æçæä½ã\n\nä¸ç§æ¨¡å¼ä¹é´çç¸äºåæ¢\n\n * ä¸è¬æ¨¡å¼\n\n * ç¼è¾æ¨¡å¼\n\n * å½ä»¤æ¨¡å¼\n   \n   :wqï¼ä¿å­éåºï¼\n   \n   :qï¼éåºï¼\n   \n   :q!ï¼å¼ºå¶éåºï¼ä¸ä¿å­ï¼\n\n\n# 2. å¼æºãéå¯ä¸ç¨æ·ç»å½æ³¨é\n\n\n# 2.1 å³æº & éå¯å½ä»¤\n\nå½ä»¤                         è¯´æ\nshutdown -h now            ç«å»è¿è¡å³æº\nshutdown -h 2              âhelloï¼2 åéåä¼å³æºäºâ\nshutdown -r now = reboot   ç°å¨éå¯\nhalt                       å³æºï¼ä¸ä¸é¢ä¸æ ·\nsync                       æåå­çæ°æ®åæ­¥å°ç£ç\n\n * ä¸ç®¡æ¯éå¯è¿æ¯å³æºï¼é¦åè¦è¿è¡ sync å½ä»¤ï¼æåå­ä¸­çæ°æ®åå°ç£çä¸­ãç®åç shutdown/reboot/halt ç­å½ä»¤åå¨å³æºåè¿è¡äº syncï¼ä½å°å¿é©¶å¾ä¸å¹´è¹ã\n * root æå¯ä»¥å³æºã\n\n\n# 2.2 ç¨æ·ç»å½ä¸æ³¨é\n\nç»å½æ¶å°½éå°ç¨ root è´¦å·ï¼é¿åæä½å¤±è¯¯ãä½¿ç¨ su <ç¨æ·å> å¯ä»¥åæ¢èº«ä»½ã\n\nlogout å½ä»¤å³å¯æ³¨éç¨æ·ãè¿ä¸ªæä»¤å¨å¾å½¢è¿è¡çº§å«æ æã\n\n\n# 3. ç¨æ·ç®¡ç\n\nLinux æ¯ä¸ä¸ªå¤ç¨æ·å¤ä»»å¡çæä½ç³»ç»ã\n\n\n# 3.1 æ·»å ç¨æ·\n\nè¯­æ³ï¼useradd ç¨æ·å\n\n * å½ç¨æ·åå»ºæååï¼ä¼èªå¨åå»ºä¸ç¨æ·ååçå®¶ç®å½ï¼/home/ç¨æ·åï¼ã\n * ä¹å¯ä»¥éè¿ useradd -d æå®ç®å½ ç¨æ·å æ¥ç»æ°ç¨æ·æå®å®¶ç®å½ã\n\n\n# 3.2 æå®/ä¿®æ¹å¯ç \n\npasswd tomï¼ç» tom æå®å¯ç \n\n**æ³¨ï¼**è¥ä¸æå®ç¨æ·åï¼åæ¯ä¿®æ¹å½åç¨æ·çç¨æ·åã\n\n\n# 3.3 å é¤ç¨æ·\n\n * userdel nrichï¼å é¤ç¨æ· nrichï¼ä½è¦ä¿çå®¶ç®å½\n * userdel -r nrichï¼å é¤ç¨æ·åå¶å®¶ç®å½\n\nä¸è¬æåµä¸ï¼æä»¬å»ºè®®ä¿çï¼æ¯ç«ä»æåçå·¥ä½æ¾å¨äºéé¢ã\n\n\n# 3.4 æ¥è¯¢ç¨æ·ä¿¡æ¯\n\nid ç¨æ·åï¼æ¥è¯¢è¯¥ç¨æ·çä¿¡æ¯ï¼å½ç¨æ·ä¸å­å¨æ¶è¿åæ æ­¤ç¨æ·ã\n\n\n# 3.5 åæ¢ç¨æ·\n\nå½æä½æéä¸å¤æ¶ï¼å¯ä»¥éè¿ su å½ä»¤åæ¢å°é«æéç¨æ·ã\n\n * ä»é«æéå°ä½æéçåæ¢ä¸éè¦å¯ç ï¼åä¹éè¦ã\n * å½éè¦è¿åå°åæ¥ç¨æ·æ¶ï¼ä½¿ç¨ exit/logout æä»¤ã\n\n\n# 3.6 æ¥çå½åç»å½ç¨æ·\n\nwhoami = who am Iï¼æ¾ç¤ºç¬¬ä¸æ¬¡ç»å½æ¶çç¨æ·ã\n\n> æ­¤å¤èªè¡å°è¯æ¶ï¼åç° whoami æ¾ç¤ºçæ¯å½ååæ¢è¿æ¥çç¨æ·ï¼who am i æ¾ç¤ºçæ¯ç¬¬ä¸æ¬¡ç»éæ¶çç¨æ·ã\n\n\n# 3.7 ç¨æ·ç»\n\nç±»ä¼¼äºè§è²ï¼ç¨æ·ç»å¯ä»¥è®©ç³»ç»å¯¹æå±æ§/æéçå¤ä¸ªç¨æ·è¿è¡ç»ä¸ç®¡çã\n\n * groupadd ç»åï¼æ°å¢ç»\n * groupdel ç»åï¼å é¤ç»\n\nå¦ä½å°è®©ä¸ä¸ªç¨æ·å å¥ä¸ä¸ªç»å¢ï¼æä»¥ä¸å ç§æ¹æ³ï¼\n\n 1. å¢å ç¨æ·æ¶ç´æ¥å ä¸ç»ï¼useradd -g ç¨æ·ç» ç¨æ·å\n 2. ä¿®æ¹ç¨æ·çç»ï¼usermod -g ç¨æ·ç» ç¨æ·å\n 3. è¥ä¸ä¸ªç¨æ·æ²¡ææå®å å¥åªä¸ªç»ï¼ä¼é»è®¤å¨ä¸ä¸ªä¸èªå·±ååçç»ä¸­\n\n\n# 3.8 ç¨æ·åç»ç¸å³çæä»¶\n\n * /etc/passwd æä»¶ï¼ç¨æ·çéç½®æä»¶ï¼è®°å½ç¨æ·çåç§ä¿¡æ¯\n   \n   * æ¯è¡çå«ä¹ï¼ç¨æ·å:å£ä»¤:ç¨æ·æ è¯å·(uid):ç»æ è¯å·(gid):æ³¨éæ§æè¿°:ä¸»ç®å½(homeä¸­ç¸åºçç®å½):ç»å½shell\n   \n   * shell çç®åè§£éï¼å¯ä»¥æä¼ ç» Linux åæ ¸çå½ä»¤è§£æï¼ç´æ¥æå½ä»¤ä¼ ç» Linux åæ ¸æ¯æ æ³è¢«è§£æçï¼ï¼å¦ä¸å¾ãæä»¬å¸¸ç¨çæ¯ bashã\n\n * /etc/shadow æä»¶ï¼å£ä»¤çéç½®æä»¶\n   \n   * æ¯è¡çå«ä¹ï¼ç»å½å:å å¯å£ä»¤:æåä¸æ¬¡ä¿®æ¹æ¶é´:æå°æ¶é´é´é:æå¤§æ¶é´é´é:è­¦åæ¶é´:ä¸æ´»å¨æ¶é´:å¤±ææ¶é´:æ å¿\n\n * /etc/group æä»¶ï¼ç»çéç½®æä»¶ï¼è®°å½åç»çä¿¡æ¯\n   \n   * æ¯è¡çå«ä¹ï¼ç»å:å£ä»¤:ç»æ è¯å·:ç»åçç¨æ·åè¡¨\n\n\n# 4. å®ç¨æä»¤\n\n\n# 4.1 è¿è¡çº§å«\n\nè¿è¡çº§å«   è¯´æ\n0      å³æº\n1      åç¨æ·æ¨¡å¼ï¼å¯ä»¥å¸®å©æä»¬æ¾åä¸¢å¤±å¯ç ï¼\n2      å¤ç¨æ·ç¶ææ²¡æç½ç»æå¡\n3      å¤ç¨æ·ç¶ææç½ç»æå¡ãå·¥ä½ä¸­å¸¸ç¨ã\n4      ç³»ç»æªä½¿ç¨ï¼ä¿çç»ç¨æ·\n5      å¾å½¢çé¢\n6      ç³»ç»éå¯\n\n * å¸¸è§è¿è¡çº§å«æ¯ 3 å 5ï¼ä¹å¯ä»¥æå®é»è®¤è¿è¡çº§å«ã\n\ninit <num>ï¼åæ¢å° num è¿è¡çº§å«ï¼å¦ init 3 å°åæ¢å°å¤ç¨æ·ç¶ææç½ç»æå¡æ¨¡å¼ï¼æ²¡æå¾å½¢çé¢ï¼ã\n\n# CentOS 7 åè¿è¡çº§å«è¯´æ\n\n * multi-user.targetï¼ç¸å½äº runlevel 3\n * graphical.targetï¼ç¸å½äº runlevel 5\n\næ¥çå½åé»è®¤è¿è¡çº§å«ï¼systemctl get-default\n\nè®¾ç½®é»è®¤è¿è¡çº§å«ï¼systemctl set-default TARGET.target\n\n> å½æä»¬å¨å¾å½¢åä¸å°é»è®¤è¿è¡çº§å«è®¾ä¸º multi-user.target åï¼éå¯ç³»ç»åä¼é»è®¤è¿å¥é»æ¡æ¡çé¢ï¼å³ runlevel 3ã\n\n\n# 4.2 æ¾å root å¯ç \n\n// TODO\n\nä¸åçæ¬çç³»ç»æ¾åå¯ç å·ä½æä½ææåºå«ã\n\n\n# 4.3 å¸®å©æä»¤\n\n * man [å½ä»¤æéç½®æä»¶]ï¼è·å¾å¸®å©ä¿¡æ¯ï¼æ¯å¦ man ls\n   \n   * ðæ¾ç¤ºä¸å¨ä¹çæç©ºæ ¼é®ç»§ç»­å¾ä¸èµ°\n   * å¨ Linux ä¸ï¼ éèæä»¶æ¯ä»¥ . å¼å¤´ç\n   * éé¡¹å¯ä»¥ç»åä½¿ç¨ï¼æ é¡ºåºåºå«ï¼æ¯å¦ ls -al æè ls -la\n   * ls å½ä»¤è¿å¯ä»¥æå®ä¸ä¸ªç®å½ï¼æ¯å¦ ls -l /root\n\n * help å½ä»¤ï¼è·å¾ shell åç½®å½ä»¤çå¸®å©ä¿¡æ¯\n\nå¦æè±è¯­ä¸å¤ªå¥½ï¼ç¾åº¦æ´ç´æ¥ã\n\n\n# 4.4 æ¶é´æ¥æç±»\n\n# 4.4.1 date æ¾ç¤ºå½åæ¥æ\n\n * date æ¾ç¤ºæ¶é´ï¼\n   \n   * dateï¼æ¾ç¤ºå½åæ¥æ\n   * date "+format"ï¼format ä¸­å¯ä»¥ç¨ %Yï¼å¹´ï¼ã%mï¼æï¼ã%d111ï¼æ¥ï¼ã%Hï¼æ¶ï¼ã%Mï¼æï¼ã%Sï¼ç§ï¼ï¼æ¯å¦ date "+%Y-%m-%d %H:%M:%S"\n\n * date è®¾ç½®æ¶é´ï¼ date -s "2020-11-03 20:02:10" ï¼æ¶é´ä¸ºå­ç¬¦ä¸²æ ¼å¼\n\n# 4.4.2 cal æ¾ç¤ºæ¥å\n\ncalendar çç¼©åã\n\ncal [éé¡¹]\n\n\n1\n\n * é»è®¤æ¾ç¤ºæ¬ææ¥å\n * cal 2020ï¼æ¾ç¤º 2020 å¨å¹´çæ¥å\n\n\n# 4.5 æç´¢æ¥æ¾ç±»\n\n# 4.5.1 find\n\nfind æä»¤å°ä»æå®ç®å½åä¸éå½å°éåå¶åä¸ªå­ç®å½ï¼å°æ»¡è¶³æ¡ä»¶çæä»¶æç®å½æ¾ç¤ºåºæ¥ã\n\nfind [æç´¢èå´] [éé¡¹]\n\n\n1\n\n * -name <æ¥è¯¢æ¹å¼>ï¼ææå®çæä»¶åæ¥æ¾æ¨¡å¼æ¥æ¾æä»¶ï¼ä¹å¯ä»¥å å¹éç¬¦ * ç­ã\n * -user <ç¨æ·å>ï¼æ¥æ¾å±äºæå®ç¨æ·åçæææä»¶\n * -size <æä»¶å¤§å°>ï¼æç§æå®çæä»¶å¤§å°æ¥æ¾æä»¶\n\n> æ¡ä¾ï¼\n> \n>  * æ ¹æ®åç§°æ¥æ¾ /home ç®å½ä¸ç hello.txtï¼find /home -name hello.txt\n>  * æ¥æ¾ /opt ä¸ç¨æ· nrich çæä»¶ï¼find /opt -user nrich\n>  * æ¥æ¾æ´ä¸ª linux ç³»ç»ä¸å¤§äº 200M çæä»¶(+n å¤§äºï¼ -n å°äºï¼åä½æ k, M, G)ï¼find / -size +200M\n\n# 4.5.2 locate\n\nlocate å¯ä»¥å¿«éå®ä½æä»¶è·¯å¾ãlocate æä»¤å©ç¨äºåå»ºç«çæ°æ®åºå®ç°å¿«éå®ä½ï¼å®æ ééåæ´ä¸ªæä»¶ç³»ç»å èè¾å¿«ãä¸ºäºä¿è¯æ¥è¯¢ç»æåç¡®æ§ï¼ç®¡çåå¿é¡»å®ææ´æ° locate æ¶å»ï¼updatedbã\n\nlocate [æç´¢æä»¶]ï¼\n\n * ç¬¬ä¸æ¬¡ä½¿ç¨åï¼å¿é¡»ä½¿ç¨ updatedb æä»¤æ¥åå»º locate æ°æ®åºã\n\n# 4.5.3 which\n\nwhich å¯ä»¥æ¥çæä¸ªæä»¤å¨åªä¸ªç®å½ä¸ãæ¯å¦ which ls æ¥ç ls æä»¤å¨åªä¸ªç®å½ã\n\n# 4.5.4 grep æä»¤åç®¡éç¬¦å· |\n\ngrep è¿æ»¤æ¥æ¾ã\n\nç®¡éå¤« | è¡¨ç¤ºå°åä¸ä¸ªå½ä»¤çå¤çç»æè¾åºä¼ éç»åé¢çå½ä»¤å¤çã\n\ngrep [éé¡¹] æ¥æ¾åå®¹ æºæä»¶\n\n\n1\n\n * -nï¼æ¾ç¤ºå¹éè¡åè¡å·\n * -iï¼å¿½ç¥å­æ¯å¤§å°å\n\n> æ¡ä¾ï¼å¨ hello.text æä»¶ä¸­æ¥æ¾âyesâæå¨è¡ï¼å¹¶æ¾ç¤ºè¡å·\n> \n>  * åæ³1ï¼cat /home/hello.txt | grep -n "yes"\n>  * åæ³2ï¼grep -n "yes" /home/hello.txt\n\n\n# 4.6 åç¼©åè§£åç±»\n\n# 4.6.1 gzip åç¼© & gunzip è§£å\n\n * gzip æä»¶ï¼åç¼©æä»¶ä¸º *.gz æä»¶\n   \n   ð åç¼©çåæ¶ä¼æåæä»¶å é¤ï¼\n\n * gunzip æä»¶.gzï¼è§£å\n\nð è§£åçåæ¶ä¹ä¼æåç¼©æä»¶å é¤\n\n# 4.6.2 zip åç¼© & unzip è§£å\n\n * zip [éé¡¹] xxx.zipï¼åç¼©æä»¶åç®å½ã-r éå½åç¼©ï¼å³åç¼©ç®å½ã\n * unzip [éé¡¹] xxx.zipï¼è§£åç¼©æä»¶ã-d <ç®å½> æå®è§£ååæä»¶çå­æ¾ç®å½ã\n\n> æ¡ä¾ï¼\n> \n>  * å° home æ¬èº«å /home ä¸çæææä»¶åç¼©ï¼zip -r myhome.zip /home/\n>  * å° myhome.zip è§£åå° /opt/tmp ç®å½ä¸ï¼unzip -d /opt/tmp /home/myhome.zip\n\n# 4.6.3 tar æå â­ï¸\n\ntar æ¯æåæä»¤ï¼ä»ä»æåä½ä¸åç¼©ï¼ï¼æåæååçæä»¶æ¯ xxx.tar.gz æä»¶ã\n\ntar [éé¡¹] xxx.tar.gz æåçåå®¹ï¼æåç®å½ï¼åç¼©åçæä»¶æ ¼å¼ä¸º xxx.tar.gz\n\n * -cï¼ãcreateãåå»ºä¸ä¸ªæ°çæåæä»¶\n * -vï¼ãverboseãæ¾ç¤ºè¯¦ç»ä¿¡æ¯\n * -fï¼ãfilenameãæå®åç¼©åçæä»¶å\n * -zï¼ãgzipãæååæ¶ç¨ gzip ç®æ³åç¼©\n * -xï¼ãextractãè§£å .tar æä»¶\n\nå¸¸ç¨çéé¡¹ç»åï¼\n\n * æåå¹¶åç¼©ï¼tar -zcvf xxx.tar.gz [åæä»¶å/ç®å½å]\n * è§£åå¹¶è§£åï¼tar -zxvf xxx.tar.gz [ç®çå°]\n\n> æ¡ä¾ï¼\n> \n>  * å° pig.txt å cat.txt åç¼©æ pc.tar.gzï¼tar -zcvf pc.tar.gz pig.txt cat.txt\n>  * å° /home æä»¶å¤¹åç¼©æ myhome.tar.gzï¼tar -zcvf myhome.tar.gz /home/\n>  * å° pc.tar.gz è§£åå°å½åç®å½ï¼tar -zxvf pc.tar.gz\n>  * å° pc.tar.gz è§£åå° /opt/tmp ç®å½ï¼tar -zxvf pc.tar.gz -C /opt/tmp\n\n\n# 5. ç»ç®¡çåæéç®¡ç\n\nLinux ä¸­æ¯ä¸ªç¨æ·å¿é¡»å±äºä¸ä¸ªç»ï¼ä¸è½ç¬ç«äºç»å¤ãæ¯ä¸ªæä»¶æææèãæå¨ç»ãå¶ä»ç»çæ¦å¿µã\n\n> ç®å½ä¹æ¯ä¸ç§ç¹æ®çæä»¶ï¼æä»¥è¿éçâæä»¶âä¹åæ¬äºç®å½ã\n\n\n# 5.1 ææè\n\nåå»ºæä»¶çäººæ¯ææèï¼ææèå¯ä»¥æ´æ¹ã\n\n# 5.1.1 æ¥çæä»¶çææè\n\nls -ahl\n\n\n1\n\n * æåä¸åçèè²è¡¨ç¤ºè¿æ¯ä¸ªç®å½ï¼ç½è²è¡¨ç¤ºæ¯æä»¶\n\n# 5.1.2 ä¿®æ¹æä»¶ææè\n\n * chown ç¨æ·å æä»¶åï¼ãchange ownerãå°æä»¶çææèæ¹ææå®çç¨æ·\n * chown newOwner:newGroup æä»¶åï¼åæ¶æ¹åææèåæå¨ç»\n * -Rï¼å¦ææ¯ç®å½ï¼åä½¿å¶ä¸ææå­æä»¶æèç®å½éå½çæ\n\n\n# 5.2 ç»çåå»º\n\ngroupadd ç»åï¼åå»ºä¸ä¸ªç»\n\n> æ¡ä¾ï¼\n> \n>  * åå»ºä¸ä¸ªç» monsterï¼groupadd monster\n> \n>  * åå»ºä¸ä¸ªç¨æ· foxï¼å¹¶æ¾å° monster ç»ä¸­ï¼\n>    \n>    useradd -g monster fox\n>    \n>    \n>    1\n>    \n>    * -g è¡¨ç¤º group\n\n\n# 5.3 æå¨ç»\n\nå½æä¸ªç¨æ·åå»ºäºä¸ä¸ªæä»¶åï¼è¿ä¸ªæä»¶çæå¨ç»å°±æ¯è¯¥ç¨æ·æå¨çç»ï¼é»è®¤ï¼ã\n\n# 53.1 æ¥çæä»¶çæå¨ç»\n\nls -ahl\n\n\n1\n\n\n# 5.3.2 ä¿®æ¹æä»¶çæå¨ç»\n\nchgrp ç»å æä»¶åï¼ãchange groupã\n\n\n# 5.4 å¶ä»ç»\n\né¤äºæä»¶çææèåæå¨ç»çç¨æ·å¤ï¼ç³»ç»çå¶ä»ç¨æ·é½æ¯æä»¶çå¶ä»ç»ã\n\n\n# 5.5 æ¹åç¨æ·çæå¨ç»\n\nroot çç®¡çæéå¯ä»¥æ¹åæä¸ªç¨æ·çæå¨ç»ã\n\n * usermod -g æ°ç»å ç¨æ·åï¼ä¿®æ¹ç¨æ·çæå¨ç»ã\n\n> usermod å¯ä»¥ç¨æ¥ä¿®æ¹ç¨æ·è´¦å·çåé¡¹è®¾å®ï¼å·ä½å¯æ¥ usermodå½ä»¤ | èé¸æç¨(opens new window)\n\n\n# 5.6 æä»¶çæé\n\n# 5.6.1 æéçåºæ¬ä»ç»\n\nä¸å¾çç¬¬ä¸åä¾¿æ¯æéï¼\n\n * ç¬¬ 0 ä½è¡¨ç¤ºæä»¶ç±»åï¼l é¾æ¥ï¼d ç®å½ï¼c å­ç¬¦è®¾å¤æä»¶ï¼å¦é¼ æ ãåçï¼ï¼b åè®¾å¤ï¼å¦ç¡¬çï¼ï¼- æ®éæä»¶\n * ç¬¬ 1~3 ä½è¡¨ç¤ºææèæ¥æè¯¥æä»¶çæé\n * ç¬¬ 4~6 ä½è¡¨ç¤ºæå±ç»æ¥æè¯¥æä»¶çæé\n * ç¬¬ 7~9 ä½è¡¨ç¤ºå¶ä»ç¨æ·æ¥æè¯¥æä»¶çæé\n\n# 5.6.2 rwx æé â­ï¸\n\n# 1ï¼rwx ä½ç¨å°æä»¶**\n\n * ãrãå¯è¯»\n * ãwãå¯åãå¯ä»¥ä¿®æ¹ä½ä¸ä»£è¡¨å¯ä»¥å é¤è¯¥æä»¶ï¼å é¤ä¸ä¸ªæä»¶çåææ¡ä»¶æ¯å¯¹è¯¥æä»¶æå¨çç®å½æåæéã\n * ãxãå¯æ§è¡ï¼executeï¼\n\n# 2ï¼rwx ä½ç¨å°ç®å½**\n\n * ãrãå¯è¯»ãls å¯ä»¥æ¥çç®å½åå®¹ã\n * ãwãå¯åãå¯ä»¥å¯¹ç®å½ååå»º + å é¤ + éå½åç®å½ã\n * ãxãå¯æ§è¡ãå¯ä»¥è¿å¥è¯¥ç®å½ãæ­¤æ¶æ ¹æ®ç®å½ä¸­æä»¶çæéï¼å¯¹å¶è¯¥è¯»è¯»ï¼è¯¥ååã\n\n# 5.6.3 æéçæ°å­è¡¨ç¤º\n\n$r=4, w=2, x =1$\n\nå æ­¤ rwx = 4+2+1 = 7ï¼rw- = 4+2 = 6 ç­ã\n\n# 5.6.4 chmod ä¿®æ¹æé\n\nchmod å¯ä»¥ä¿®æ¹æä»¶/ç®å½çæéï¼chmod [åæ´æ¹å¼] æä»¶å\n\n# 1ï¼ç¬¬ä¸ç§æ¹å¼ï¼+ - = åæ´æé\n\n * u ââ ææèï¼user çç®å\n * g ââ ææç»ï¼group çç®å\n * o ââ å¶ä»äººï¼other çç®å\n * a ââ ææäººï¼å³ uãgão çæ»åï¼ï¼all çç®å\n\n> æ¡ä¾ï¼ç» foo.txt çææèèµäºè¯»åæ§è¡çæéï¼å¢å æå¨ç»åçæéï¼é¤å»å¶ä»äººè¯»çæé\n> \n>  * chmod u=rwx,g+w,o-r foo.txt\n\n# 2ï¼ç¬¬äºç§æ¹å¼ï¼éè¿æ°å­åæ´æé\n\n$r=4, w=2, x =1$\n\n> æ¡ä¾ï¼å° bar.txt çæéä¿®æ¹ä¸º rwxr-xr-x\n> \n>  * chmod 755 bar.txt\n\n# 5.6.5 å¶ä»è¯´æ\n\n * æéååçæ°å­åï¼æä»¶çç¡¬è¿æ¥æ° | ç®å½çå­ç®å½æ°ï¼ä¸åå«æ®éæä»¶ï¼ã\n * è¥è¦å¯¹ç®å½åçæä»¶è¿è¡æä½ï¼éè¦åæå¯¹è¯¥ç®å½çç¸åºæéã\n\n\n# 6. å®æ¶ä»»å¡è°åº¦\n\n\n# 6.1 crond ä»»å¡è°åº¦\n\ncrontab è¿è¡å®æ¶ä»»å¡çè®¾ç½®ãè¯¥å½ä»¤æ¯åéä¼å®ææ£æ¥æ¯å¦æè¦æ§è¡çå·¥ä½ï¼å¦ææè¦æ§è¡çå·¥ä½ä¾¿ä¼èªå¨æ§è¡è¯¥å·¥ä½ã\n\n> è±è¯­ï¼crond å®æ¶ä»»å¡ï¼crontab å®æ¶ä»»å¡\n\n# 6.1.1 æ¦è¿°\n\nä»»å¡è°åº¦ï¼æ¯æç³»ç»å¨æä¸ªæ¶é´æ§è¡ç¹å®çå½ä»¤æç¨åºã\n\nä»»å¡è°åº¦åç±»ï¼\n\n * ç³»ç»å·¥ä½ï¼ç³»ç»å¨ææ§æè¦æ§è¡çå·¥ä½ï¼å¦çæ¯æ«æ\n * ä¸ªå«ç¨æ·å·¥ä½ï¼æä¸ªç¨æ·å®æè¦åçå·¥ä½ï¼æ¯å¦å¯¹ MySQL æ°æ®åºçå¤ä»½\n\n# 6.1.2 åºæ¬è¯­æ³\n\ncrontab [éé¡¹]\n\n\n1\n\n * -eï¼ä½¿ç¨ç¼è¾å¨æ¥ç¼è¾ crontab å®æ¶ä»»å¡\n * -lï¼ååºç®åçæ¶ç¨è¡¨\n * -rï¼å é¤å½åç¨æ·çæ¶ç¨è¡¨ï¼å³å é¤ææ crontab ä»»å¡ï¼\n\néå¯ä»»å¡è°åº¦ï¼ service crond restart\n\n# 6.1.3 å¿«éå¥é¨\n\nè®¾ç½®ä»»å¡è°åº¦æä»¶ï¼/etc/crontab\n\nè®¾ç½®ä¸ªäººä»»å¡è°åº¦ï¼æ§è¡ crontab -e å½ä»¤ï¼æ¥çè¾å¥ä»»å¡å°è°åº¦æä»¶ãå¦è¾å¥ */1 * * * * ls -l /etc/ > /tmp/to.txt è¡¨ç¤ºæ¯ä¸ªå°æ¶çæ¯åéæ§è¡ ls -l /etc/ > /tmp/to.txt å½ä»¤ã\n\n# ä»»å¡ä¹¦åæ ¼å¼ï¼\n\nf1 f2 f3 f4 f5 program\n\n\n1\n\n * program å¤ä¸ºå®æ¶æ§è¡çå½ä»¤\n * f1 ~ f5 ä¸ºæç¤ºæ¶é´çå ä½ç¬¦ï¼å·ä½å¯è§ä¸é¢\n\n# 5 ä¸ªå ä½ç¬¦çè¯´æï¼\n\n*    *    *    *    *\n-    -    -    -    -\n|    |    |    |    |\n|    |    |    |    +----- ææä¸­ææå  (0 - 6) (ææå¤© ä¸º0)\n|    |    |    +---------- æä»½ (1 - 12) \n|    |    +--------------- ä¸ä¸ªæä¸­çç¬¬å å¤© (1 - 31)\n|    +-------------------- å°æ¶ (0 - 23)\n+------------------------- åé (0 - 59)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# ç¹æ®ç¬¦å·çè¯´æ\n\nç¹æ®ç¬¦å·   å«ä¹\n*      ä»£è¡¨ä»»ä½æ¶é´ï¼æ¯å¦ç¬¬ä¸ä¸ª * å°±ä»£è¡¨ä¸ä¸ªå°æ¶ä¸­æ¯åéæ§è¡ä¸æ¬¡çææã\n,      ä»£è¡¨ä¸è¿ç»­çæ¶é´ï¼å¦ 0 8,12,16 * * * å½ä»¤å°±ä»£è¡¨æ¯å¤©ç8ç¹0åã12ç¹0åã16ç¹0åé½æ§è¡ä¸æ¬¡å½ä»¤ã\n-      ä»£è¡¨è¿ç»­çæ¶é´èå´ï¼å¦ 0 5 * * 1-6 å½ä»¤å°±ä»£è¡¨å¨ä¸å°å¨å­çåæ¨5ç¹0åæ§è¡å½ä»¤\n*/n    ä»£è¡¨æ¯éå¤ä¹æ§è¡ä¸æ¬¡ï¼å¦ */10 * * * * å°±ä»£è¡¨æ¯é 10 åéå°±æ§è¡ä¸æ¬¡å½ä»¤\n\n> æ¡ä¾å¯è§ crontab å½ä»¤ | èé¸æç¨\n\n> æ¡ä¾ï¼æ¯éä¸åéï¼å°å½åæ¥æåæ¥åé½è¿½å å° /home/mycal æä»¶ä¸­ï¼ï¼1ï¼ vim /home/my.sh ï¼åå¥åå®¹ï¼ date >> /home/mycal å cal >> /home/mycal ï¼2ï¼ç» my.sh å¢å æ§è¡æéï¼chmod u+x /home/my.sh ï¼3ï¼crontab -e å¢å  */1 * * * * /home/my.sh\n\n\n# 6.2 at å®æ¶ä»»å¡\n\ncrond æ¯åå¤æ§è¡çä»»å¡ï¼è at å½ä»¤æ¯ä¸æ¬¡æ§å®æ¶è®¡åä»»å¡ï¼å¶å®æ¤è¿ç¨ atd ä¼ä»¥åå°æ¨¡å¼è¿è¡ï¼æ£æ¥ä»»å¡éåæ¥è¿è¡ã\n\né»è®¤æåµä¸ï¼atd å®æ¤è¿ç¨æ¯åéæ£æ¥ä¸æ¬¡ä½ä¸éåï¼æä½ä¸æ¶ä¼æ£æ¥å¶è¿è¡æ¶é´ï¼è¥å¹éåè¿è¡æ­¤ä½ä¸ãå¨ä½¿ç¨ at å½ä»¤æ¶ï¼ä¸å®è¦ä¿è¯ atd è¿ç¨çå¯å¨ï¼å¯ä»¥ä½¿ç¨ ps -ef | grep atd æ¥æ£æµ atd æ¯å¦å¨è¿è¡ã\n\n * ps -ef | grep atdï¼æ¥çææè¿ç¨å¹¶è¿æ»¤åº atd\n\nå¦å¾æç¤ºï¼ä¸é¢ä¸æ¡è¡¨ç¤º atd è¿ç¨å·²ç»å¯å¨ï¼ä¸é¢ä¸æ¡è¡¨ç¤ºå½åæ¥ç atd æ¯å¦è¿è¡çæä»¤ã\n\n> å¯å¨ atd è¿ç¨ï¼sudo service atd start æ sudo systemctl start atd\n\nå½ä»¤æ ¼å¼ï¼at [éé¡¹] [æ¶é´] ï¼ä¸¤æ¬¡ Ctrl + D ç»æ at å½ä»¤çè¾å¥ï¼Ctrl + Backspace å é¤\n\n * -m å½æå®çä»»å¡è¢«å®æä¹åï¼å°ç»ç¨æ·åéé®ä»¶ï¼å³ä½¿æ²¡ææ åè¾åº\n * -I atqçå«å\n * -d atrmçå«åï¼å é¤å·²ç»è®¾ç½®çä»»å¡ï¼e.g. atrm 4 è¡¨ç¤ºå é¤ job éåä¸­ç¼å·ä¸º4ç jobï¼\n * -v æ¾ç¤ºä»»å¡å°è¢«æ§è¡çæ¶é´\n * -c æå°ä»»å¡çåå®¹å°æ åè¾åº\n * -V æ¾ç¤ºçæ¬ä¿¡æ¯\n * -q<åé> ä½¿ç¨æå®çåé\n * -f<æä»¶> ä»æå®æä»¶è¯»å¥ä»»å¡èä¸æ¯ä»æ åè¾å¥è¯»å¥\n * -t<æ¶é´åæ°> ä»¥æ¶é´åæ°çå½¢å¼æäº¤è¦è¿è¡çä»»å¡\n\n> æ³¨ï¼ atd ä¸æ¬¡åªä¼æ§è¡ä¸ä¸ªä»»å¡ï¼ä» job éåä¸­ä¸æ¬¡æ£æ¥ä¸ä¸ª job æ¯å¦è¯¥æ§è¡äºã\n\n# 6.2.1 at æ¶é´å®ä¹çæ¹æ³\n\n * æ¥åå¨å½å¤©ç hh:mmï¼å°æ¶:åéï¼å¼çæ¶é´æå®ãåå¦è¯¥æ¶é´å·²è¿å»ï¼é£ä¹å°±æ¾å¨ç¬¬äºå¤©æ§è¡ã\n * ä½¿ç¨ midnightï¼æ·±å¤ï¼ï¼noonï¼ä¸­åï¼ï¼teatimeï¼é¥®è¶æ¶é´ï¼ä¸è¬æ¯ä¸å4ç¹ï¼ç­æ¯è¾æ¨¡ç³ç è¯è¯­æ¥æå®æ¶é´ã\n * éç¨ 12 å°æ¶è®¡æ¶å¶ï¼å³å¨æ¶é´åé¢å ä¸ AMï¼ä¸åï¼æ PMï¼ä¸åï¼æ¥è¯´ææ¯ä¸åè¿æ¯ä¸åã\n * æå®å½ä»¤æ§è¡çå·ä½æ¥æï¼æå®æ ¼å¼ä¸º month dayï¼æ æ¥ï¼æ mm/dd/yyï¼æ/æ¥/å¹´ï¼æ dd.mm.yyï¼æ¥.æ.å¹´ï¼ãæå®çæ¥æå¿é¡»è·å¨æå®æ¶é´çåé¢ã\n * ä½¿ç¨ç¸å¯¹è®¡æ¶æ³ï¼æå®æ ¼å¼ä¸ºï¼now + count time-units ï¼now å°±æ¯å½åæ¶é´ï¼time-units æ¯æ¶é´åä½ï¼è¿éè½å¤æ¯minutesï¼åéï¼ãhoursï¼å°æ¶ï¼ãdaysï¼å¤©ï¼ãweeksï¼ææï¼ãcount æ¯æ¶é´çæ°éï¼ç©¶ç«æ¯å å¤©ï¼è¿æ¯å å°æ¶ï¼ç­ç­ãæ¯å¦ now + 5 minutesã\n * ç´æ¥ä½¿ç¨todayï¼ä»å¤©ï¼ãtomorrowï¼æå¤©ï¼æ¥æå®å®æå½ä»¤çæ¶é´ã\n\n> æ¡ä¾ï¼2 å¤©åçä¸å 5 ç¹æ§è¡ /bin/ls /home\n\nåè¾å¥ at [éé¡¹] [æ¶é´] ååè½¦ï¼åæ¥çè¾å¥å½ä»¤ï¼è¾å¥å®åæä¸¤æ¬¡ Ctrl D ç»æè¾å¥\n\n\n# 7. ç£çååºãæè½½\n\n\n# 7.1 Linux ååº\n\nð ç®å½åªæ¯ä¸ªç®å½ï¼ç®å½ä¸­çåå®¹å¨ç©çä¸æ¯å­æ¾å¨ç¡¬ççååºä¸­çã\n\n# 7.1.1 åçä»ç»\n\nLinux æ¥è¯´æ è®ºæå ä¸ªååºï¼åç»åªä¸ç®å½ä½¿ç¨ï¼å®å½æ ¹ç»åºå°±åªæä¸ä¸ªæ ¹ç®å½ï¼ä¸ä¸ªç¬ç«ä¸å¯ä¸çæä»¶ç»æï¼Linux ä¸­æ¯ä¸ªååºé½æ¯ç¨æ¥ç»ææ´ä¸ªæä»¶ç³»ç»çä¸é¨åã\n\nLinux éç¨äºä¸ç§å«âè½½å¥âçå¤çæ¹æ³ï¼å®çæ´ä¸ªæä»¶ç³»ç»ä¸­åå«äºä¸æ´å¥çæä»¶åç®å½ï¼ ä¸å°ä¸ä¸ªååºåä¸ä¸ªç®å½èç³»èµ·æ¥ãè¿æ¶è¦è½½å¥çä¸ä¸ªååºå°ä½¿å®çå­å¨ç©ºé´å¨ä¸ä¸ªç®å½ä¸è·å¾ã\n\nç¤ºæå¾ï¼\n\n# 7.1.2 ç¡¬çè¯´æ\n\nLinux ç¡¬çå IDE ç¡¬çå SCSI ç¡¬çï¼ç®ååºæ¬ä¸æ¯ SCSI ç¡¬çã\n\n * å¯¹äº IDE ç¡¬çï¼é©±å¨å¨æ è¯ç¬¦ä¸ºâhdx~âï¼âhdâè¡¨æååºæå¨è®¾å¤çç±»åï¼è¿éæ¯æIDEç¡¬çãâxâä¸ºçå·ï¼a ä¸ºåºæ¬çï¼b ä¸ºåºæ¬ä»å±çï¼c ä¸ºè¾å©ä¸»çï¼d ä¸ºè¾å©ä»å±çï¼ï¼â~âä»£è¡¨ååºï¼ååä¸ªååºç¨æ°å­1å°4è¡¨ç¤ºï¼å®ä»¬æ¯ä¸»ååºææ©å±ååºï¼ä»5å¼å§å°±æ¯é»è¾ååºãæ¯å¦ hda3 è¡¨ç¤ºä¸ºç¬¬ä¸ä¸ª IDE ç¡¬çä¸çç¬¬ä¸ä¸ªä¸»ååºææ©å±ååºï¼hdb2 è¡¨ç¤ºä¸ºç¬¬äºä¸ª IDE ç¡¬çä¸çç¬¬äºä¸ªä¸»ååºææ©å±ååºã\n * å¯¹äº SCSI ç¡¬çï¼é©±å¨å¨æ è¯ç¬¦ä¸ºâsdx~âï¼SCSI ç¡¬çæ¯ç¨âsdâæ¥è¡¨ç¤ºååºæå¨è®¾å¤çç±»åï¼å¶ä½åå IDE ç¡¬ççè¡¨ç¤ºæ¹æ³ä¸æ ·ã\n\n# 7.1.3 æ¥çææè®¾å¤æè½½æåµ\n\nå½ä»¤ï¼lsblk æè lsblk -f\n\n * lsblkï¼è±ææ¯âlist blockâï¼å³ç¨äºååºææå¯ç¨åè®¾å¤çä¿¡æ¯\n\n> å¾ä¸­ç sr0 æ¯æåé©±ã\n\n\n# 7.2 æè½½çç»å¸æ¡ä¾ ââ å¢å ä¸åç¡¬ç\n\nç®æ ï¼ç» Linux ç³»ç»å¢å ä¸åæ°çç¡¬çï¼å¹¶ä¸æè½½å° /newdisk\n\nä¸»è¦æä»¥ä¸5ä¸ªæ­¥éª¤ï¼èææºæ·»å ç¡¬çãååºãæ ¼å¼åãæè½½ãè®¾ç½®å¯ä»¥èªå¨æè½½ã\n\n# 1ï¼èææºæ·»å ç¡¬ç\n\nå¨ãèææºãèåä¸­ï¼éæ©ãè®¾ç½®ãï¼ç¶åè®¾å¤åè¡¨éæ·»å ç¡¬çï¼ç¶åä¸è·¯ãä¸ä¸æ­¥ãï¼ä¸­é´åªæéæ©ç£çå¤§å°çå°æ¹éè¦ä¿®æ¹ï¼ç´å°å®æãç¶åéå¯ç³»ç»ï¼æè½è¯å«ï¼ï¼\n\n# 2ï¼ç£çååº\n\nååºå½ä»¤ï¼fdisk /dev/sdb\n\nå¼å§å¯¹ /sdb ååºï¼\n\nå½ä»¤   å«ä¹\nm    æ¾ç¤ºå½ä»¤åè¡¨\nn    æ°å¢ååº\nd    å é¤ååº\nw    åå¥å¹¶éåº\n\nåæ³ï¼å¼å§ååºåè¾å¥ nï¼æ°å¢ååºï¼ç¶åéæ© pï¼ååºç±»åä¸ºä¸»ååºï¼ååºå·1-4å¯éï¼é»è®¤ä¸º1ï¼1ä»£è¡¨ä¸ºåªä¸ºç£çååä¸åååºï¼2ä»£è¡¨ä¸ºç£çååä¸¤åååºï¼ä¾æ¬¡ç±»æ¨ãæ­¤æ¬¡æ¡ä¾éæ©1ãä¸¤æ¬¡åè½¦é»è®¤å©ä½å¨é¨ç©ºé´ãæåè¾å¥ w åå¥ååºå¹¶éåºï¼è¥ä¸ä¿å­éåºè¾å¥ qã\n\n# 3ï¼æ ¼å¼åç£ç\n\nå½ä»¤ï¼mkfs -t ext4 /dev/sdb1\n\n * å¶ä¸­ ext4 æ¯ååºç±»å\n\næ ¼å¼åä¹åæä¼æä¸å¾ä¸­ç UUID ï¼å¯ä¸æ è¯ç¬¦ï¼ç»è¿ä¸ªååºï¼æ­¤ååºæå¯ä»¥ä½¿ç¨ã\n\n# 4ï¼æè½½\n\næè½½: å°ä¸ä¸ªååºä¸ä¸ä¸ªç®å½èç³»èµ·æ¥ã\n\nå½ä»¤ï¼mount è®¾å¤åç§° æè½½ç®å½\n\n * æ­¤æ¬¡æ¡ä¾ä¸º mount /dev/sdb1 /newdisk\n * å»é¤æè½½å½ä»¤ä¸º umount è®¾å¤åç§°æèæè½½ç®å½ï¼æ¯å¦ umount /dev/sdb1 æè umount /newdisk\n\n# 5ï¼è®¾ç½®èªå¨æè½½\n\nç¨å½ä»¤è¡æè½½åªè½å®ç°ä¸´æ¶æè½½ï¼éå¯ç³»ç»åï¼æè½½å°±ä¼å¤±æãè®¾ç½®èªå¨æè½½ï¼å³æ°¸ä¹æè½½ï¼å½éå¯ç³»ç»ï¼ä»ç¶å¯ä»¥æè½½å°æå®ç®å½ã\n\néè¿ä¿®æ¹ /etc/fstab æä»¶å®ç°æ°¸ä¹æè½½ã\n\n * æ­¤æ¬¡æ¡ä¾å¨æä»¶ä¸­å¢å  /dev/sdb1 /newdisk ext4 defaults 0 0\n * ä¿å­å¹¶éåºæä»¶åï¼æ§è¡ mount âa å³å»çæ\n\n\n# 7.3 ç£çæåµæ¥è¯¢\n\n# 7.3.1 æ¥è¯¢ç³»ç»æ´ä½ç£çä½¿ç¨æåµ\n\nå½ä»¤ï¼df -h\n\n * dfï¼disk freeï¼æ¾ç¤ºç®åå¨ Linux ç³»ç»ä¸çæä»¶ç³»ç»ç£çä½¿ç¨æåµç»è®¡\n * -hï¼human readableï¼ä½¿ç¨äººç±»å¯è¯»çæ ¼å¼(é¢è®¾å¼æ¯ä¸å è¿ä¸ªéé¡¹ç\n\nå¯ç¨äºæ¥è¯¢ç³»ç»æ´ä½ç£çä½¿ç¨æåµï¼\n\n$ df -h\næä»¶ç³»ç»                 å®¹é  å·²ç¨  å¯ç¨ å·²ç¨% æè½½ç¹\ndevtmpfs                 974M     0  974M    0% /dev\ntmpfs                    991M     0  991M    0% /dev/shm\ntmpfs                    991M   11M  980M    2% /run\ntmpfs                    991M     0  991M    0% /sys/fs/cgroup\n/dev/mapper/centos-root   17G  5.4G   11G   34% /\n/dev/sda1                976M  177M  733M   20% /boot\nvmhgfs-fuse              400G  317G   84G   80% /mnt/hgfs\ntmpfs                    199M   52K  198M    1% /run/user/1000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * å½âå·²ç¨âè¶è¿ 80% åå°±ä¸æ­£å¸¸äºï¼åºè¯¥æ³å°æ©å®¹ã\n\n# 7.3.2 æ¥è¯¢æå®ç®å½çç£çå ç¨æåµ\n\nå½ä»¤ï¼du -h\n\n * duï¼disk usageï¼æ¾ç¤ºæå®çç®å½ææä»¶æå ç¨çç£çç©ºé´ï¼é»è®¤æ¯å½åç®å½ã\n * -sï¼æå®ç®å½å ç¨å¤§å°æ±æ»\n * -hï¼å¸¦è®¡éåä½\n * -aï¼å«æä»¶\n * --max-depth=1ï¼å­ç®å½æ·±åº¦ä¸º1\n * -cï¼ååºæç»çåæ¶ï¼å¢å æ±æ»å¼\n\n> æ¡ä¾ï¼æ¥ç /opt ç®å½çç£çå ç¨æåµï¼æ·±åº¦ä¸º 1\n> \n> $ du -hac --max-depth=1 /opt\n> 163M\t/opt/vmware-tools-distrib\n> 4.0K\t/opt/rh\n> 54M\t    /opt/VMwareTools-10.3.10-13959562.tar.gz\n> 216M\t/opt\n> 216M\tæ»ç¨é\n> \n> \n> 1\n> 2\n> 3\n> 4\n> 5\n> 6\n\n\n# 7.4 ç£çæåµ - å·¥ä½å®ç¨æä»¤\n\n# 1ï¼ç»è®¡ /opt æä»¶å¤¹ä¸æä»¶çä¸ªæ°\n\nls -l /opt | grep "^-" | wc -l\n\n# 2ï¼ç»è®¡ /opt æä»¶å¤¹ä¸ç®å½çä¸ªæ°\n\nls -l /opt | grep "^d" | wc -l\n\n# 3ï¼ç»è®¡ /opt æä»¶å¤¹ä¸æä»¶çä¸ªæ°ï¼åæ¬å­æä»¶å¤¹ä¸ç\n\nls -lR /opt | grep "^-" | wc -l\n\n# 4ï¼ç»è®¡ /opt æä»¶å¤¹ä¸ç®å½çä¸ªæ°ï¼åæ¬å­æä»¶å¤¹ä¸ç\n\nls -lR /opt | grep "^d" | wc -l\n\n# 5ï¼ä»¥æ ç¶æ¾ç¤ºç®å½ç»æ\n\nyum install tree å tree æå®ç®å½\n\n$ tree .\n.\nâââ aaa\nâ   âââ abc.txt\nâââ bar.txt\nâââ foo.txt\n\n\n1\n2\n3\n4\n5\n6\n\n\n> è¡¥åï¼wc å½ä»¤\n> \n> wcï¼Word Countï¼å½ä»¤çåè½ä¸ºç»è®¡æå®æä»¶ä¸­çå­èæ°ãå­æ°ãè¡æ°ï¼å¹¶å°ç»è®¡ç»ææ¾ç¤ºè¾åºã\n> \n> å½ä»¤ï¼wc [éé¡¹] [æä»¶]\n> \n>  * -cï¼ç»è®¡å­èæ°\n>  * -lï¼ç»è®¡è¡æ°\n>  * -mï¼ç»è®¡å­ç¬¦æ°ï¼è¿ä¸ªéé¡¹ä¸è½ä¸ -c ä¸èµ·ä½¿ç¨\n>  * -wï¼ç»è®¡å­æ°ï¼ä¸ä¸ªå­è¢«å®ä¹ä¸ºç±ç©ºç½ãè·³æ ¼ææ¢è¡å­ç¬¦åéçå­ç¬¦ä¸²\n>  * -Lï¼ç»è®¡æé¿è¡çé¿åº¦',normalizedContent:'# 1. vi å vim ç¼è¾å¨\n\nè¦ä¼ä¸äºåºæ¬çå¿«æ·é®ï¼ä¸è¬å¨ linux ä¸ä¸éè¦ç¹å«å¤æçæä½ã\n\nä¸ç§æ¨¡å¼ä¹é´çç¸äºåæ¢\n\n * ä¸è¬æ¨¡å¼\n\n * ç¼è¾æ¨¡å¼\n\n * å½ä»¤æ¨¡å¼\n   \n   :wqï¼ä¿å­éåºï¼\n   \n   :qï¼éåºï¼\n   \n   :q!ï¼å¼ºå¶éåºï¼ä¸ä¿å­ï¼\n\n\n# 2. å¼æºãéå¯ä¸ç¨æ·ç»å½æ³¨é\n\n\n# 2.1 å³æº & éå¯å½ä»¤\n\nå½ä»¤                         è¯´æ\nshutdown -h now            ç«å»è¿è¡å³æº\nshutdown -h 2              âhelloï¼2 åéåä¼å³æºäºâ\nshutdown -r now = reboot   ç°å¨éå¯\nhalt                       å³æºï¼ä¸ä¸é¢ä¸æ ·\nsync                       æåå­çæ°æ®åæ­¥å°ç£ç\n\n * ä¸ç®¡æ¯éå¯è¿æ¯å³æºï¼é¦åè¦è¿è¡ sync å½ä»¤ï¼æåå­ä¸­çæ°æ®åå°ç£çä¸­ãç®åç shutdown/reboot/halt ç­å½ä»¤åå¨å³æºåè¿è¡äº syncï¼ä½å°å¿é©¶å¾ä¸å¹´è¹ã\n * root æå¯ä»¥å³æºã\n\n\n# 2.2 ç¨æ·ç»å½ä¸æ³¨é\n\nç»å½æ¶å°½éå°ç¨ root è´¦å·ï¼é¿åæä½å¤±è¯¯ãä½¿ç¨ su <ç¨æ·å> å¯ä»¥åæ¢èº«ä»½ã\n\nlogout å½ä»¤å³å¯æ³¨éç¨æ·ãè¿ä¸ªæä»¤å¨å¾å½¢è¿è¡çº§å«æ æã\n\n\n# 3. ç¨æ·ç®¡ç\n\nlinux æ¯ä¸ä¸ªå¤ç¨æ·å¤ä»»å¡çæä½ç³»ç»ã\n\n\n# 3.1 æ·»å ç¨æ·\n\nè¯­æ³ï¼useradd ç¨æ·å\n\n * å½ç¨æ·åå»ºæååï¼ä¼èªå¨åå»ºä¸ç¨æ·ååçå®¶ç®å½ï¼/home/ç¨æ·åï¼ã\n * ä¹å¯ä»¥éè¿ useradd -d æå®ç®å½ ç¨æ·å æ¥ç»æ°ç¨æ·æå®å®¶ç®å½ã\n\n\n# 3.2 æå®/ä¿®æ¹å¯ç \n\npasswd tomï¼ç» tom æå®å¯ç \n\n**æ³¨ï¼**è¥ä¸æå®ç¨æ·åï¼åæ¯ä¿®æ¹å½åç¨æ·çç¨æ·åã\n\n\n# 3.3 å é¤ç¨æ·\n\n * userdel nrichï¼å é¤ç¨æ· nrichï¼ä½è¦ä¿çå®¶ç®å½\n * userdel -r nrichï¼å é¤ç¨æ·åå¶å®¶ç®å½\n\nä¸è¬æåµä¸ï¼æä»¬å»ºè®®ä¿çï¼æ¯ç«ä»æåçå·¥ä½æ¾å¨äºéé¢ã\n\n\n# 3.4 æ¥è¯¢ç¨æ·ä¿¡æ¯\n\nid ç¨æ·åï¼æ¥è¯¢è¯¥ç¨æ·çä¿¡æ¯ï¼å½ç¨æ·ä¸å­å¨æ¶è¿åæ æ­¤ç¨æ·ã\n\n\n# 3.5 åæ¢ç¨æ·\n\nå½æä½æéä¸å¤æ¶ï¼å¯ä»¥éè¿ su å½ä»¤åæ¢å°é«æéç¨æ·ã\n\n * ä»é«æéå°ä½æéçåæ¢ä¸éè¦å¯ç ï¼åä¹éè¦ã\n * å½éè¦è¿åå°åæ¥ç¨æ·æ¶ï¼ä½¿ç¨ exit/logout æä»¤ã\n\n\n# 3.6 æ¥çå½åç»å½ç¨æ·\n\nwhoami = who am iï¼æ¾ç¤ºç¬¬ä¸æ¬¡ç»å½æ¶çç¨æ·ã\n\n> æ­¤å¤èªè¡å°è¯æ¶ï¼åç° whoami æ¾ç¤ºçæ¯å½ååæ¢è¿æ¥çç¨æ·ï¼who am i æ¾ç¤ºçæ¯ç¬¬ä¸æ¬¡ç»éæ¶çç¨æ·ã\n\n\n# 3.7 ç¨æ·ç»\n\nç±»ä¼¼äºè§è²ï¼ç¨æ·ç»å¯ä»¥è®©ç³»ç»å¯¹æå±æ§/æéçå¤ä¸ªç¨æ·è¿è¡ç»ä¸ç®¡çã\n\n * groupadd ç»åï¼æ°å¢ç»\n * groupdel ç»åï¼å é¤ç»\n\nå¦ä½å°è®©ä¸ä¸ªç¨æ·å å¥ä¸ä¸ªç»å¢ï¼æä»¥ä¸å ç§æ¹æ³ï¼\n\n 1. å¢å ç¨æ·æ¶ç´æ¥å ä¸ç»ï¼useradd -g ç¨æ·ç» ç¨æ·å\n 2. ä¿®æ¹ç¨æ·çç»ï¼usermod -g ç¨æ·ç» ç¨æ·å\n 3. è¥ä¸ä¸ªç¨æ·æ²¡ææå®å å¥åªä¸ªç»ï¼ä¼é»è®¤å¨ä¸ä¸ªä¸èªå·±ååçç»ä¸­\n\n\n# 3.8 ç¨æ·åç»ç¸å³çæä»¶\n\n * /etc/passwd æä»¶ï¼ç¨æ·çéç½®æä»¶ï¼è®°å½ç¨æ·çåç§ä¿¡æ¯\n   \n   * æ¯è¡çå«ä¹ï¼ç¨æ·å:å£ä»¤:ç¨æ·æ è¯å·(uid):ç»æ è¯å·(gid):æ³¨éæ§æè¿°:ä¸»ç®å½(homeä¸­ç¸åºçç®å½):ç»å½shell\n   \n   * shell çç®åè§£éï¼å¯ä»¥æä¼ ç» linux åæ ¸çå½ä»¤è§£æï¼ç´æ¥æå½ä»¤ä¼ ç» linux åæ ¸æ¯æ æ³è¢«è§£æçï¼ï¼å¦ä¸å¾ãæä»¬å¸¸ç¨çæ¯ bashã\n\n * /etc/shadow æä»¶ï¼å£ä»¤çéç½®æä»¶\n   \n   * æ¯è¡çå«ä¹ï¼ç»å½å:å å¯å£ä»¤:æåä¸æ¬¡ä¿®æ¹æ¶é´:æå°æ¶é´é´é:æå¤§æ¶é´é´é:è­¦åæ¶é´:ä¸æ´»å¨æ¶é´:å¤±ææ¶é´:æ å¿\n\n * /etc/group æä»¶ï¼ç»çéç½®æä»¶ï¼è®°å½åç»çä¿¡æ¯\n   \n   * æ¯è¡çå«ä¹ï¼ç»å:å£ä»¤:ç»æ è¯å·:ç»åçç¨æ·åè¡¨\n\n\n# 4. å®ç¨æä»¤\n\n\n# 4.1 è¿è¡çº§å«\n\nè¿è¡çº§å«   è¯´æ\n0      å³æº\n1      åç¨æ·æ¨¡å¼ï¼å¯ä»¥å¸®å©æä»¬æ¾åä¸¢å¤±å¯ç ï¼\n2      å¤ç¨æ·ç¶ææ²¡æç½ç»æå¡\n3      å¤ç¨æ·ç¶ææç½ç»æå¡ãå·¥ä½ä¸­å¸¸ç¨ã\n4      ç³»ç»æªä½¿ç¨ï¼ä¿çç»ç¨æ·\n5      å¾å½¢çé¢\n6      ç³»ç»éå¯\n\n * å¸¸è§è¿è¡çº§å«æ¯ 3 å 5ï¼ä¹å¯ä»¥æå®é»è®¤è¿è¡çº§å«ã\n\ninit <num>ï¼åæ¢å° num è¿è¡çº§å«ï¼å¦ init 3 å°åæ¢å°å¤ç¨æ·ç¶ææç½ç»æå¡æ¨¡å¼ï¼æ²¡æå¾å½¢çé¢ï¼ã\n\n# centos 7 åè¿è¡çº§å«è¯´æ\n\n * multi-user.targetï¼ç¸å½äº runlevel 3\n * graphical.targetï¼ç¸å½äº runlevel 5\n\næ¥çå½åé»è®¤è¿è¡çº§å«ï¼systemctl get-default\n\nè®¾ç½®é»è®¤è¿è¡çº§å«ï¼systemctl set-default target.target\n\n> å½æä»¬å¨å¾å½¢åä¸å°é»è®¤è¿è¡çº§å«è®¾ä¸º multi-user.target åï¼éå¯ç³»ç»åä¼é»è®¤è¿å¥é»æ¡æ¡çé¢ï¼å³ runlevel 3ã\n\n\n# 4.2 æ¾å root å¯ç \n\n// todo\n\nä¸åçæ¬çç³»ç»æ¾åå¯ç å·ä½æä½ææåºå«ã\n\n\n# 4.3 å¸®å©æä»¤\n\n * man [å½ä»¤æéç½®æä»¶]ï¼è·å¾å¸®å©ä¿¡æ¯ï¼æ¯å¦ man ls\n   \n   * ðæ¾ç¤ºä¸å¨ä¹çæç©ºæ ¼é®ç»§ç»­å¾ä¸èµ°\n   * å¨ linux ä¸ï¼ éèæä»¶æ¯ä»¥ . å¼å¤´ç\n   * éé¡¹å¯ä»¥ç»åä½¿ç¨ï¼æ é¡ºåºåºå«ï¼æ¯å¦ ls -al æè ls -la\n   * ls å½ä»¤è¿å¯ä»¥æå®ä¸ä¸ªç®å½ï¼æ¯å¦ ls -l /root\n\n * help å½ä»¤ï¼è·å¾ shell åç½®å½ä»¤çå¸®å©ä¿¡æ¯\n\nå¦æè±è¯­ä¸å¤ªå¥½ï¼ç¾åº¦æ´ç´æ¥ã\n\n\n# 4.4 æ¶é´æ¥æç±»\n\n# 4.4.1 date æ¾ç¤ºå½åæ¥æ\n\n * date æ¾ç¤ºæ¶é´ï¼\n   \n   * dateï¼æ¾ç¤ºå½åæ¥æ\n   * date "+format"ï¼format ä¸­å¯ä»¥ç¨ %yï¼å¹´ï¼ã%mï¼æï¼ã%d111ï¼æ¥ï¼ã%hï¼æ¶ï¼ã%mï¼æï¼ã%sï¼ç§ï¼ï¼æ¯å¦ date "+%y-%m-%d %h:%m:%s"\n\n * date è®¾ç½®æ¶é´ï¼ date -s "2020-11-03 20:02:10" ï¼æ¶é´ä¸ºå­ç¬¦ä¸²æ ¼å¼\n\n# 4.4.2 cal æ¾ç¤ºæ¥å\n\ncalendar çç¼©åã\n\ncal [éé¡¹]\n\n\n1\n\n * é»è®¤æ¾ç¤ºæ¬ææ¥å\n * cal 2020ï¼æ¾ç¤º 2020 å¨å¹´çæ¥å\n\n\n# 4.5 æç´¢æ¥æ¾ç±»\n\n# 4.5.1 find\n\nfind æä»¤å°ä»æå®ç®å½åä¸éå½å°éåå¶åä¸ªå­ç®å½ï¼å°æ»¡è¶³æ¡ä»¶çæä»¶æç®å½æ¾ç¤ºåºæ¥ã\n\nfind [æç´¢èå´] [éé¡¹]\n\n\n1\n\n * -name <æ¥è¯¢æ¹å¼>ï¼ææå®çæä»¶åæ¥æ¾æ¨¡å¼æ¥æ¾æä»¶ï¼ä¹å¯ä»¥å å¹éç¬¦ * ç­ã\n * -user <ç¨æ·å>ï¼æ¥æ¾å±äºæå®ç¨æ·åçæææä»¶\n * -size <æä»¶å¤§å°>ï¼æç§æå®çæä»¶å¤§å°æ¥æ¾æä»¶\n\n> æ¡ä¾ï¼\n> \n>  * æ ¹æ®åç§°æ¥æ¾ /home ç®å½ä¸ç hello.txtï¼find /home -name hello.txt\n>  * æ¥æ¾ /opt ä¸ç¨æ· nrich çæä»¶ï¼find /opt -user nrich\n>  * æ¥æ¾æ´ä¸ª linux ç³»ç»ä¸å¤§äº 200m çæä»¶(+n å¤§äºï¼ -n å°äºï¼åä½æ k, m, g)ï¼find / -size +200m\n\n# 4.5.2 locate\n\nlocate å¯ä»¥å¿«éå®ä½æä»¶è·¯å¾ãlocate æä»¤å©ç¨äºåå»ºç«çæ°æ®åºå®ç°å¿«éå®ä½ï¼å®æ ééåæ´ä¸ªæä»¶ç³»ç»å èè¾å¿«ãä¸ºäºä¿è¯æ¥è¯¢ç»æåç¡®æ§ï¼ç®¡çåå¿é¡»å®ææ´æ° locate æ¶å»ï¼updatedbã\n\nlocate [æç´¢æä»¶]ï¼\n\n * ç¬¬ä¸æ¬¡ä½¿ç¨åï¼å¿é¡»ä½¿ç¨ updatedb æä»¤æ¥åå»º locate æ°æ®åºã\n\n# 4.5.3 which\n\nwhich å¯ä»¥æ¥çæä¸ªæä»¤å¨åªä¸ªç®å½ä¸ãæ¯å¦ which ls æ¥ç ls æä»¤å¨åªä¸ªç®å½ã\n\n# 4.5.4 grep æä»¤åç®¡éç¬¦å· |\n\ngrep è¿æ»¤æ¥æ¾ã\n\nç®¡éå¤« | è¡¨ç¤ºå°åä¸ä¸ªå½ä»¤çå¤çç»æè¾åºä¼ éç»åé¢çå½ä»¤å¤çã\n\ngrep [éé¡¹] æ¥æ¾åå®¹ æºæä»¶\n\n\n1\n\n * -nï¼æ¾ç¤ºå¹éè¡åè¡å·\n * -iï¼å¿½ç¥å­æ¯å¤§å°å\n\n> æ¡ä¾ï¼å¨ hello.text æä»¶ä¸­æ¥æ¾âyesâæå¨è¡ï¼å¹¶æ¾ç¤ºè¡å·\n> \n>  * åæ³1ï¼cat /home/hello.txt | grep -n "yes"\n>  * åæ³2ï¼grep -n "yes" /home/hello.txt\n\n\n# 4.6 åç¼©åè§£åç±»\n\n# 4.6.1 gzip åç¼© & gunzip è§£å\n\n * gzip æä»¶ï¼åç¼©æä»¶ä¸º *.gz æä»¶\n   \n   ð åç¼©çåæ¶ä¼æåæä»¶å é¤ï¼\n\n * gunzip æä»¶.gzï¼è§£å\n\nð è§£åçåæ¶ä¹ä¼æåç¼©æä»¶å é¤\n\n# 4.6.2 zip åç¼© & unzip è§£å\n\n * zip [éé¡¹] xxx.zipï¼åç¼©æä»¶åç®å½ã-r éå½åç¼©ï¼å³åç¼©ç®å½ã\n * unzip [éé¡¹] xxx.zipï¼è§£åç¼©æä»¶ã-d <ç®å½> æå®è§£ååæä»¶çå­æ¾ç®å½ã\n\n> æ¡ä¾ï¼\n> \n>  * å° home æ¬èº«å /home ä¸çæææä»¶åç¼©ï¼zip -r myhome.zip /home/\n>  * å° myhome.zip è§£åå° /opt/tmp ç®å½ä¸ï¼unzip -d /opt/tmp /home/myhome.zip\n\n# 4.6.3 tar æå â­ï¸\n\ntar æ¯æåæä»¤ï¼ä»ä»æåä½ä¸åç¼©ï¼ï¼æåæååçæä»¶æ¯ xxx.tar.gz æä»¶ã\n\ntar [éé¡¹] xxx.tar.gz æåçåå®¹ï¼æåç®å½ï¼åç¼©åçæä»¶æ ¼å¼ä¸º xxx.tar.gz\n\n * -cï¼ãcreateãåå»ºä¸ä¸ªæ°çæåæä»¶\n * -vï¼ãverboseãæ¾ç¤ºè¯¦ç»ä¿¡æ¯\n * -fï¼ãfilenameãæå®åç¼©åçæä»¶å\n * -zï¼ãgzipãæååæ¶ç¨ gzip ç®æ³åç¼©\n * -xï¼ãextractãè§£å .tar æä»¶\n\nå¸¸ç¨çéé¡¹ç»åï¼\n\n * æåå¹¶åç¼©ï¼tar -zcvf xxx.tar.gz [åæä»¶å/ç®å½å]\n * è§£åå¹¶è§£åï¼tar -zxvf xxx.tar.gz [ç®çå°]\n\n> æ¡ä¾ï¼\n> \n>  * å° pig.txt å cat.txt åç¼©æ pc.tar.gzï¼tar -zcvf pc.tar.gz pig.txt cat.txt\n>  * å° /home æä»¶å¤¹åç¼©æ myhome.tar.gzï¼tar -zcvf myhome.tar.gz /home/\n>  * å° pc.tar.gz è§£åå°å½åç®å½ï¼tar -zxvf pc.tar.gz\n>  * å° pc.tar.gz è§£åå° /opt/tmp ç®å½ï¼tar -zxvf pc.tar.gz -c /opt/tmp\n\n\n# 5. ç»ç®¡çåæéç®¡ç\n\nlinux ä¸­æ¯ä¸ªç¨æ·å¿é¡»å±äºä¸ä¸ªç»ï¼ä¸è½ç¬ç«äºç»å¤ãæ¯ä¸ªæä»¶æææèãæå¨ç»ãå¶ä»ç»çæ¦å¿µã\n\n> ç®å½ä¹æ¯ä¸ç§ç¹æ®çæä»¶ï¼æä»¥è¿éçâæä»¶âä¹åæ¬äºç®å½ã\n\n\n# 5.1 ææè\n\nåå»ºæä»¶çäººæ¯ææèï¼ææèå¯ä»¥æ´æ¹ã\n\n# 5.1.1 æ¥çæä»¶çææè\n\nls -ahl\n\n\n1\n\n * æåä¸åçèè²è¡¨ç¤ºè¿æ¯ä¸ªç®å½ï¼ç½è²è¡¨ç¤ºæ¯æä»¶\n\n# 5.1.2 ä¿®æ¹æä»¶ææè\n\n * chown ç¨æ·å æä»¶åï¼ãchange ownerãå°æä»¶çææèæ¹ææå®çç¨æ·\n * chown newowner:newgroup æä»¶åï¼åæ¶æ¹åææèåæå¨ç»\n * -rï¼å¦ææ¯ç®å½ï¼åä½¿å¶ä¸ææå­æä»¶æèç®å½éå½çæ\n\n\n# 5.2 ç»çåå»º\n\ngroupadd ç»åï¼åå»ºä¸ä¸ªç»\n\n> æ¡ä¾ï¼\n> \n>  * åå»ºä¸ä¸ªç» monsterï¼groupadd monster\n> \n>  * åå»ºä¸ä¸ªç¨æ· foxï¼å¹¶æ¾å° monster ç»ä¸­ï¼\n>    \n>    useradd -g monster fox\n>    \n>    \n>    1\n>    \n>    * -g è¡¨ç¤º group\n\n\n# 5.3 æå¨ç»\n\nå½æä¸ªç¨æ·åå»ºäºä¸ä¸ªæä»¶åï¼è¿ä¸ªæä»¶çæå¨ç»å°±æ¯è¯¥ç¨æ·æå¨çç»ï¼é»è®¤ï¼ã\n\n# 53.1 æ¥çæä»¶çæå¨ç»\n\nls -ahl\n\n\n1\n\n\n# 5.3.2 ä¿®æ¹æä»¶çæå¨ç»\n\nchgrp ç»å æä»¶åï¼ãchange groupã\n\n\n# 5.4 å¶ä»ç»\n\né¤äºæä»¶çææèåæå¨ç»çç¨æ·å¤ï¼ç³»ç»çå¶ä»ç¨æ·é½æ¯æä»¶çå¶ä»ç»ã\n\n\n# 5.5 æ¹åç¨æ·çæå¨ç»\n\nroot çç®¡çæéå¯ä»¥æ¹åæä¸ªç¨æ·çæå¨ç»ã\n\n * usermod -g æ°ç»å ç¨æ·åï¼ä¿®æ¹ç¨æ·çæå¨ç»ã\n\n> usermod å¯ä»¥ç¨æ¥ä¿®æ¹ç¨æ·è´¦å·çåé¡¹è®¾å®ï¼å·ä½å¯æ¥ usermodå½ä»¤ | èé¸æç¨(opens new window)\n\n\n# 5.6 æä»¶çæé\n\n# 5.6.1 æéçåºæ¬ä»ç»\n\nä¸å¾çç¬¬ä¸åä¾¿æ¯æéï¼\n\n * ç¬¬ 0 ä½è¡¨ç¤ºæä»¶ç±»åï¼l é¾æ¥ï¼d ç®å½ï¼c å­ç¬¦è®¾å¤æä»¶ï¼å¦é¼ æ ãåçï¼ï¼b åè®¾å¤ï¼å¦ç¡¬çï¼ï¼- æ®éæä»¶\n * ç¬¬ 1~3 ä½è¡¨ç¤ºææèæ¥æè¯¥æä»¶çæé\n * ç¬¬ 4~6 ä½è¡¨ç¤ºæå±ç»æ¥æè¯¥æä»¶çæé\n * ç¬¬ 7~9 ä½è¡¨ç¤ºå¶ä»ç¨æ·æ¥æè¯¥æä»¶çæé\n\n# 5.6.2 rwx æé â­ï¸\n\n# 1ï¼rwx ä½ç¨å°æä»¶**\n\n * ãrãå¯è¯»\n * ãwãå¯åãå¯ä»¥ä¿®æ¹ä½ä¸ä»£è¡¨å¯ä»¥å é¤è¯¥æä»¶ï¼å é¤ä¸ä¸ªæä»¶çåææ¡ä»¶æ¯å¯¹è¯¥æä»¶æå¨çç®å½æåæéã\n * ãxãå¯æ§è¡ï¼executeï¼\n\n# 2ï¼rwx ä½ç¨å°ç®å½**\n\n * ãrãå¯è¯»ãls å¯ä»¥æ¥çç®å½åå®¹ã\n * ãwãå¯åãå¯ä»¥å¯¹ç®å½ååå»º + å é¤ + éå½åç®å½ã\n * ãxãå¯æ§è¡ãå¯ä»¥è¿å¥è¯¥ç®å½ãæ­¤æ¶æ ¹æ®ç®å½ä¸­æä»¶çæéï¼å¯¹å¶è¯¥è¯»è¯»ï¼è¯¥ååã\n\n# 5.6.3 æéçæ°å­è¡¨ç¤º\n\n$r=4, w=2, x =1$\n\nå æ­¤ rwx = 4+2+1 = 7ï¼rw- = 4+2 = 6 ç­ã\n\n# 5.6.4 chmod ä¿®æ¹æé\n\nchmod å¯ä»¥ä¿®æ¹æä»¶/ç®å½çæéï¼chmod [åæ´æ¹å¼] æä»¶å\n\n# 1ï¼ç¬¬ä¸ç§æ¹å¼ï¼+ - = åæ´æé\n\n * u ââ ææèï¼user çç®å\n * g ââ ææç»ï¼group çç®å\n * o ââ å¶ä»äººï¼other çç®å\n * a ââ ææäººï¼å³ uãgão çæ»åï¼ï¼all çç®å\n\n> æ¡ä¾ï¼ç» foo.txt çææèèµäºè¯»åæ§è¡çæéï¼å¢å æå¨ç»åçæéï¼é¤å»å¶ä»äººè¯»çæé\n> \n>  * chmod u=rwx,g+w,o-r foo.txt\n\n# 2ï¼ç¬¬äºç§æ¹å¼ï¼éè¿æ°å­åæ´æé\n\n$r=4, w=2, x =1$\n\n> æ¡ä¾ï¼å° bar.txt çæéä¿®æ¹ä¸º rwxr-xr-x\n> \n>  * chmod 755 bar.txt\n\n# 5.6.5 å¶ä»è¯´æ\n\n * æéååçæ°å­åï¼æä»¶çç¡¬è¿æ¥æ° | ç®å½çå­ç®å½æ°ï¼ä¸åå«æ®éæä»¶ï¼ã\n * è¥è¦å¯¹ç®å½åçæä»¶è¿è¡æä½ï¼éè¦åæå¯¹è¯¥ç®å½çç¸åºæéã\n\n\n# 6. å®æ¶ä»»å¡è°åº¦\n\n\n# 6.1 crond ä»»å¡è°åº¦\n\ncrontab è¿è¡å®æ¶ä»»å¡çè®¾ç½®ãè¯¥å½ä»¤æ¯åéä¼å®ææ£æ¥æ¯å¦æè¦æ§è¡çå·¥ä½ï¼å¦ææè¦æ§è¡çå·¥ä½ä¾¿ä¼èªå¨æ§è¡è¯¥å·¥ä½ã\n\n> è±è¯­ï¼crond å®æ¶ä»»å¡ï¼crontab å®æ¶ä»»å¡\n\n# 6.1.1 æ¦è¿°\n\nä»»å¡è°åº¦ï¼æ¯æç³»ç»å¨æä¸ªæ¶é´æ§è¡ç¹å®çå½ä»¤æç¨åºã\n\nä»»å¡è°åº¦åç±»ï¼\n\n * ç³»ç»å·¥ä½ï¼ç³»ç»å¨ææ§æè¦æ§è¡çå·¥ä½ï¼å¦çæ¯æ«æ\n * ä¸ªå«ç¨æ·å·¥ä½ï¼æä¸ªç¨æ·å®æè¦åçå·¥ä½ï¼æ¯å¦å¯¹ mysql æ°æ®åºçå¤ä»½\n\n# 6.1.2 åºæ¬è¯­æ³\n\ncrontab [éé¡¹]\n\n\n1\n\n * -eï¼ä½¿ç¨ç¼è¾å¨æ¥ç¼è¾ crontab å®æ¶ä»»å¡\n * -lï¼ååºç®åçæ¶ç¨è¡¨\n * -rï¼å é¤å½åç¨æ·çæ¶ç¨è¡¨ï¼å³å é¤ææ crontab ä»»å¡ï¼\n\néå¯ä»»å¡è°åº¦ï¼ service crond restart\n\n# 6.1.3 å¿«éå¥é¨\n\nè®¾ç½®ä»»å¡è°åº¦æä»¶ï¼/etc/crontab\n\nè®¾ç½®ä¸ªäººä»»å¡è°åº¦ï¼æ§è¡ crontab -e å½ä»¤ï¼æ¥çè¾å¥ä»»å¡å°è°åº¦æä»¶ãå¦è¾å¥ */1 * * * * ls -l /etc/ > /tmp/to.txt è¡¨ç¤ºæ¯ä¸ªå°æ¶çæ¯åéæ§è¡ ls -l /etc/ > /tmp/to.txt å½ä»¤ã\n\n# ä»»å¡ä¹¦åæ ¼å¼ï¼\n\nf1 f2 f3 f4 f5 program\n\n\n1\n\n * program å¤ä¸ºå®æ¶æ§è¡çå½ä»¤\n * f1 ~ f5 ä¸ºæç¤ºæ¶é´çå ä½ç¬¦ï¼å·ä½å¯è§ä¸é¢\n\n# 5 ä¸ªå ä½ç¬¦çè¯´æï¼\n\n*    *    *    *    *\n-    -    -    -    -\n|    |    |    |    |\n|    |    |    |    +----- ææä¸­ææå  (0 - 6) (ææå¤© ä¸º0)\n|    |    |    +---------- æä»½ (1 - 12) \n|    |    +--------------- ä¸ä¸ªæä¸­çç¬¬å å¤© (1 - 31)\n|    +-------------------- å°æ¶ (0 - 23)\n+------------------------- åé (0 - 59)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# ç¹æ®ç¬¦å·çè¯´æ\n\nç¹æ®ç¬¦å·   å«ä¹\n*      ä»£è¡¨ä»»ä½æ¶é´ï¼æ¯å¦ç¬¬ä¸ä¸ª * å°±ä»£è¡¨ä¸ä¸ªå°æ¶ä¸­æ¯åéæ§è¡ä¸æ¬¡çææã\n,      ä»£è¡¨ä¸è¿ç»­çæ¶é´ï¼å¦ 0 8,12,16 * * * å½ä»¤å°±ä»£è¡¨æ¯å¤©ç8ç¹0åã12ç¹0åã16ç¹0åé½æ§è¡ä¸æ¬¡å½ä»¤ã\n-      ä»£è¡¨è¿ç»­çæ¶é´èå´ï¼å¦ 0 5 * * 1-6 å½ä»¤å°±ä»£è¡¨å¨ä¸å°å¨å­çåæ¨5ç¹0åæ§è¡å½ä»¤\n*/n    ä»£è¡¨æ¯éå¤ä¹æ§è¡ä¸æ¬¡ï¼å¦ */10 * * * * å°±ä»£è¡¨æ¯é 10 åéå°±æ§è¡ä¸æ¬¡å½ä»¤\n\n> æ¡ä¾å¯è§ crontab å½ä»¤ | èé¸æç¨\n\n> æ¡ä¾ï¼æ¯éä¸åéï¼å°å½åæ¥æåæ¥åé½è¿½å å° /home/mycal æä»¶ä¸­ï¼ï¼1ï¼ vim /home/my.sh ï¼åå¥åå®¹ï¼ date >> /home/mycal å cal >> /home/mycal ï¼2ï¼ç» my.sh å¢å æ§è¡æéï¼chmod u+x /home/my.sh ï¼3ï¼crontab -e å¢å  */1 * * * * /home/my.sh\n\n\n# 6.2 at å®æ¶ä»»å¡\n\ncrond æ¯åå¤æ§è¡çä»»å¡ï¼è at å½ä»¤æ¯ä¸æ¬¡æ§å®æ¶è®¡åä»»å¡ï¼å¶å®æ¤è¿ç¨ atd ä¼ä»¥åå°æ¨¡å¼è¿è¡ï¼æ£æ¥ä»»å¡éåæ¥è¿è¡ã\n\né»è®¤æåµä¸ï¼atd å®æ¤è¿ç¨æ¯åéæ£æ¥ä¸æ¬¡ä½ä¸éåï¼æä½ä¸æ¶ä¼æ£æ¥å¶è¿è¡æ¶é´ï¼è¥å¹éåè¿è¡æ­¤ä½ä¸ãå¨ä½¿ç¨ at å½ä»¤æ¶ï¼ä¸å®è¦ä¿è¯ atd è¿ç¨çå¯å¨ï¼å¯ä»¥ä½¿ç¨ ps -ef | grep atd æ¥æ£æµ atd æ¯å¦å¨è¿è¡ã\n\n * ps -ef | grep atdï¼æ¥çææè¿ç¨å¹¶è¿æ»¤åº atd\n\nå¦å¾æç¤ºï¼ä¸é¢ä¸æ¡è¡¨ç¤º atd è¿ç¨å·²ç»å¯å¨ï¼ä¸é¢ä¸æ¡è¡¨ç¤ºå½åæ¥ç atd æ¯å¦è¿è¡çæä»¤ã\n\n> å¯å¨ atd è¿ç¨ï¼sudo service atd start æ sudo systemctl start atd\n\nå½ä»¤æ ¼å¼ï¼at [éé¡¹] [æ¶é´] ï¼ä¸¤æ¬¡ ctrl + d ç»æ at å½ä»¤çè¾å¥ï¼ctrl + backspace å é¤\n\n * -m å½æå®çä»»å¡è¢«å®æä¹åï¼å°ç»ç¨æ·åéé®ä»¶ï¼å³ä½¿æ²¡ææ åè¾åº\n * -i atqçå«å\n * -d atrmçå«åï¼å é¤å·²ç»è®¾ç½®çä»»å¡ï¼e.g. atrm 4 è¡¨ç¤ºå é¤ job éåä¸­ç¼å·ä¸º4ç jobï¼\n * -v æ¾ç¤ºä»»å¡å°è¢«æ§è¡çæ¶é´\n * -c æå°ä»»å¡çåå®¹å°æ åè¾åº\n * -v æ¾ç¤ºçæ¬ä¿¡æ¯\n * -q<åé> ä½¿ç¨æå®çåé\n * -f<æä»¶> ä»æå®æä»¶è¯»å¥ä»»å¡èä¸æ¯ä»æ åè¾å¥è¯»å¥\n * -t<æ¶é´åæ°> ä»¥æ¶é´åæ°çå½¢å¼æäº¤è¦è¿è¡çä»»å¡\n\n> æ³¨ï¼ atd ä¸æ¬¡åªä¼æ§è¡ä¸ä¸ªä»»å¡ï¼ä» job éåä¸­ä¸æ¬¡æ£æ¥ä¸ä¸ª job æ¯å¦è¯¥æ§è¡äºã\n\n# 6.2.1 at æ¶é´å®ä¹çæ¹æ³\n\n * æ¥åå¨å½å¤©ç hh:mmï¼å°æ¶:åéï¼å¼çæ¶é´æå®ãåå¦è¯¥æ¶é´å·²è¿å»ï¼é£ä¹å°±æ¾å¨ç¬¬äºå¤©æ§è¡ã\n * ä½¿ç¨ midnightï¼æ·±å¤ï¼ï¼noonï¼ä¸­åï¼ï¼teatimeï¼é¥®è¶æ¶é´ï¼ä¸è¬æ¯ä¸å4ç¹ï¼ç­æ¯è¾æ¨¡ç³ç è¯è¯­æ¥æå®æ¶é´ã\n * éç¨ 12 å°æ¶è®¡æ¶å¶ï¼å³å¨æ¶é´åé¢å ä¸ amï¼ä¸åï¼æ pmï¼ä¸åï¼æ¥è¯´ææ¯ä¸åè¿æ¯ä¸åã\n * æå®å½ä»¤æ§è¡çå·ä½æ¥æï¼æå®æ ¼å¼ä¸º month dayï¼æ æ¥ï¼æ mm/dd/yyï¼æ/æ¥/å¹´ï¼æ dd.mm.yyï¼æ¥.æ.å¹´ï¼ãæå®çæ¥æå¿é¡»è·å¨æå®æ¶é´çåé¢ã\n * ä½¿ç¨ç¸å¯¹è®¡æ¶æ³ï¼æå®æ ¼å¼ä¸ºï¼now + count time-units ï¼now å°±æ¯å½åæ¶é´ï¼time-units æ¯æ¶é´åä½ï¼è¿éè½å¤æ¯minutesï¼åéï¼ãhoursï¼å°æ¶ï¼ãdaysï¼å¤©ï¼ãweeksï¼ææï¼ãcount æ¯æ¶é´çæ°éï¼ç©¶ç«æ¯å å¤©ï¼è¿æ¯å å°æ¶ï¼ç­ç­ãæ¯å¦ now + 5 minutesã\n * ç´æ¥ä½¿ç¨todayï¼ä»å¤©ï¼ãtomorrowï¼æå¤©ï¼æ¥æå®å®æå½ä»¤çæ¶é´ã\n\n> æ¡ä¾ï¼2 å¤©åçä¸å 5 ç¹æ§è¡ /bin/ls /home\n\nåè¾å¥ at [éé¡¹] [æ¶é´] ååè½¦ï¼åæ¥çè¾å¥å½ä»¤ï¼è¾å¥å®åæä¸¤æ¬¡ ctrl d ç»æè¾å¥\n\n\n# 7. ç£çååºãæè½½\n\n\n# 7.1 linux ååº\n\nð ç®å½åªæ¯ä¸ªç®å½ï¼ç®å½ä¸­çåå®¹å¨ç©çä¸æ¯å­æ¾å¨ç¡¬ççååºä¸­çã\n\n# 7.1.1 åçä»ç»\n\nlinux æ¥è¯´æ è®ºæå ä¸ªååºï¼åç»åªä¸ç®å½ä½¿ç¨ï¼å®å½æ ¹ç»åºå°±åªæä¸ä¸ªæ ¹ç®å½ï¼ä¸ä¸ªç¬ç«ä¸å¯ä¸çæä»¶ç»æï¼linux ä¸­æ¯ä¸ªååºé½æ¯ç¨æ¥ç»ææ´ä¸ªæä»¶ç³»ç»çä¸é¨åã\n\nlinux éç¨äºä¸ç§å«âè½½å¥âçå¤çæ¹æ³ï¼å®çæ´ä¸ªæä»¶ç³»ç»ä¸­åå«äºä¸æ´å¥çæä»¶åç®å½ï¼ ä¸å°ä¸ä¸ªååºåä¸ä¸ªç®å½èç³»èµ·æ¥ãè¿æ¶è¦è½½å¥çä¸ä¸ªååºå°ä½¿å®çå­å¨ç©ºé´å¨ä¸ä¸ªç®å½ä¸è·å¾ã\n\nç¤ºæå¾ï¼\n\n# 7.1.2 ç¡¬çè¯´æ\n\nlinux ç¡¬çå ide ç¡¬çå scsi ç¡¬çï¼ç®ååºæ¬ä¸æ¯ scsi ç¡¬çã\n\n * å¯¹äº ide ç¡¬çï¼é©±å¨å¨æ è¯ç¬¦ä¸ºâhdx~âï¼âhdâè¡¨æååºæå¨è®¾å¤çç±»åï¼è¿éæ¯æideç¡¬çãâxâä¸ºçå·ï¼a ä¸ºåºæ¬çï¼b ä¸ºåºæ¬ä»å±çï¼c ä¸ºè¾å©ä¸»çï¼d ä¸ºè¾å©ä»å±çï¼ï¼â~âä»£è¡¨ååºï¼ååä¸ªååºç¨æ°å­1å°4è¡¨ç¤ºï¼å®ä»¬æ¯ä¸»ååºææ©å±ååºï¼ä»5å¼å§å°±æ¯é»è¾ååºãæ¯å¦ hda3 è¡¨ç¤ºä¸ºç¬¬ä¸ä¸ª ide ç¡¬çä¸çç¬¬ä¸ä¸ªä¸»ååºææ©å±ååºï¼hdb2 è¡¨ç¤ºä¸ºç¬¬äºä¸ª ide ç¡¬çä¸çç¬¬äºä¸ªä¸»ååºææ©å±ååºã\n * å¯¹äº scsi ç¡¬çï¼é©±å¨å¨æ è¯ç¬¦ä¸ºâsdx~âï¼scsi ç¡¬çæ¯ç¨âsdâæ¥è¡¨ç¤ºååºæå¨è®¾å¤çç±»åï¼å¶ä½åå ide ç¡¬ççè¡¨ç¤ºæ¹æ³ä¸æ ·ã\n\n# 7.1.3 æ¥çææè®¾å¤æè½½æåµ\n\nå½ä»¤ï¼lsblk æè lsblk -f\n\n * lsblkï¼è±ææ¯âlist blockâï¼å³ç¨äºååºææå¯ç¨åè®¾å¤çä¿¡æ¯\n\n> å¾ä¸­ç sr0 æ¯æåé©±ã\n\n\n# 7.2 æè½½çç»å¸æ¡ä¾ ââ å¢å ä¸åç¡¬ç\n\nç®æ ï¼ç» linux ç³»ç»å¢å ä¸åæ°çç¡¬çï¼å¹¶ä¸æè½½å° /newdisk\n\nä¸»è¦æä»¥ä¸5ä¸ªæ­¥éª¤ï¼èææºæ·»å ç¡¬çãååºãæ ¼å¼åãæè½½ãè®¾ç½®å¯ä»¥èªå¨æè½½ã\n\n# 1ï¼èææºæ·»å ç¡¬ç\n\nå¨ãèææºãèåä¸­ï¼éæ©ãè®¾ç½®ãï¼ç¶åè®¾å¤åè¡¨éæ·»å ç¡¬çï¼ç¶åä¸è·¯ãä¸ä¸æ­¥ãï¼ä¸­é´åªæéæ©ç£çå¤§å°çå°æ¹éè¦ä¿®æ¹ï¼ç´å°å®æãç¶åéå¯ç³»ç»ï¼æè½è¯å«ï¼ï¼\n\n# 2ï¼ç£çååº\n\nååºå½ä»¤ï¼fdisk /dev/sdb\n\nå¼å§å¯¹ /sdb ååºï¼\n\nå½ä»¤   å«ä¹\nm    æ¾ç¤ºå½ä»¤åè¡¨\nn    æ°å¢ååº\nd    å é¤ååº\nw    åå¥å¹¶éåº\n\nåæ³ï¼å¼å§ååºåè¾å¥ nï¼æ°å¢ååºï¼ç¶åéæ© pï¼ååºç±»åä¸ºä¸»ååºï¼ååºå·1-4å¯éï¼é»è®¤ä¸º1ï¼1ä»£è¡¨ä¸ºåªä¸ºç£çååä¸åååºï¼2ä»£è¡¨ä¸ºç£çååä¸¤åååºï¼ä¾æ¬¡ç±»æ¨ãæ­¤æ¬¡æ¡ä¾éæ©1ãä¸¤æ¬¡åè½¦é»è®¤å©ä½å¨é¨ç©ºé´ãæåè¾å¥ w åå¥ååºå¹¶éåºï¼è¥ä¸ä¿å­éåºè¾å¥ qã\n\n# 3ï¼æ ¼å¼åç£ç\n\nå½ä»¤ï¼mkfs -t ext4 /dev/sdb1\n\n * å¶ä¸­ ext4 æ¯ååºç±»å\n\næ ¼å¼åä¹åæä¼æä¸å¾ä¸­ç uuid ï¼å¯ä¸æ è¯ç¬¦ï¼ç»è¿ä¸ªååºï¼æ­¤ååºæå¯ä»¥ä½¿ç¨ã\n\n# 4ï¼æè½½\n\næè½½: å°ä¸ä¸ªååºä¸ä¸ä¸ªç®å½èç³»èµ·æ¥ã\n\nå½ä»¤ï¼mount è®¾å¤åç§° æè½½ç®å½\n\n * æ­¤æ¬¡æ¡ä¾ä¸º mount /dev/sdb1 /newdisk\n * å»é¤æè½½å½ä»¤ä¸º umount è®¾å¤åç§°æèæè½½ç®å½ï¼æ¯å¦ umount /dev/sdb1 æè umount /newdisk\n\n# 5ï¼è®¾ç½®èªå¨æè½½\n\nç¨å½ä»¤è¡æè½½åªè½å®ç°ä¸´æ¶æè½½ï¼éå¯ç³»ç»åï¼æè½½å°±ä¼å¤±æãè®¾ç½®èªå¨æè½½ï¼å³æ°¸ä¹æè½½ï¼å½éå¯ç³»ç»ï¼ä»ç¶å¯ä»¥æè½½å°æå®ç®å½ã\n\néè¿ä¿®æ¹ /etc/fstab æä»¶å®ç°æ°¸ä¹æè½½ã\n\n * æ­¤æ¬¡æ¡ä¾å¨æä»¶ä¸­å¢å  /dev/sdb1 /newdisk ext4 defaults 0 0\n * ä¿å­å¹¶éåºæä»¶åï¼æ§è¡ mount âa å³å»çæ\n\n\n# 7.3 ç£çæåµæ¥è¯¢\n\n# 7.3.1 æ¥è¯¢ç³»ç»æ´ä½ç£çä½¿ç¨æåµ\n\nå½ä»¤ï¼df -h\n\n * dfï¼disk freeï¼æ¾ç¤ºç®åå¨ linux ç³»ç»ä¸çæä»¶ç³»ç»ç£çä½¿ç¨æåµç»è®¡\n * -hï¼human readableï¼ä½¿ç¨äººç±»å¯è¯»çæ ¼å¼(é¢è®¾å¼æ¯ä¸å è¿ä¸ªéé¡¹ç\n\nå¯ç¨äºæ¥è¯¢ç³»ç»æ´ä½ç£çä½¿ç¨æåµï¼\n\n$ df -h\næä»¶ç³»ç»                 å®¹é  å·²ç¨  å¯ç¨ å·²ç¨% æè½½ç¹\ndevtmpfs                 974m     0  974m    0% /dev\ntmpfs                    991m     0  991m    0% /dev/shm\ntmpfs                    991m   11m  980m    2% /run\ntmpfs                    991m     0  991m    0% /sys/fs/cgroup\n/dev/mapper/centos-root   17g  5.4g   11g   34% /\n/dev/sda1                976m  177m  733m   20% /boot\nvmhgfs-fuse              400g  317g   84g   80% /mnt/hgfs\ntmpfs                    199m   52k  198m    1% /run/user/1000\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * å½âå·²ç¨âè¶è¿ 80% åå°±ä¸æ­£å¸¸äºï¼åºè¯¥æ³å°æ©å®¹ã\n\n# 7.3.2 æ¥è¯¢æå®ç®å½çç£çå ç¨æåµ\n\nå½ä»¤ï¼du -h\n\n * duï¼disk usageï¼æ¾ç¤ºæå®çç®å½ææä»¶æå ç¨çç£çç©ºé´ï¼é»è®¤æ¯å½åç®å½ã\n * -sï¼æå®ç®å½å ç¨å¤§å°æ±æ»\n * -hï¼å¸¦è®¡éåä½\n * -aï¼å«æä»¶\n * --max-depth=1ï¼å­ç®å½æ·±åº¦ä¸º1\n * -cï¼ååºæç»çåæ¶ï¼å¢å æ±æ»å¼\n\n> æ¡ä¾ï¼æ¥ç /opt ç®å½çç£çå ç¨æåµï¼æ·±åº¦ä¸º 1\n> \n> $ du -hac --max-depth=1 /opt\n> 163m\t/opt/vmware-tools-distrib\n> 4.0k\t/opt/rh\n> 54m\t    /opt/vmwaretools-10.3.10-13959562.tar.gz\n> 216m\t/opt\n> 216m\tæ»ç¨é\n> \n> \n> 1\n> 2\n> 3\n> 4\n> 5\n> 6\n\n\n# 7.4 ç£çæåµ - å·¥ä½å®ç¨æä»¤\n\n# 1ï¼ç»è®¡ /opt æä»¶å¤¹ä¸æä»¶çä¸ªæ°\n\nls -l /opt | grep "^-" | wc -l\n\n# 2ï¼ç»è®¡ /opt æä»¶å¤¹ä¸ç®å½çä¸ªæ°\n\nls -l /opt | grep "^d" | wc -l\n\n# 3ï¼ç»è®¡ /opt æä»¶å¤¹ä¸æä»¶çä¸ªæ°ï¼åæ¬å­æä»¶å¤¹ä¸ç\n\nls -lr /opt | grep "^-" | wc -l\n\n# 4ï¼ç»è®¡ /opt æä»¶å¤¹ä¸ç®å½çä¸ªæ°ï¼åæ¬å­æä»¶å¤¹ä¸ç\n\nls -lr /opt | grep "^d" | wc -l\n\n# 5ï¼ä»¥æ ç¶æ¾ç¤ºç®å½ç»æ\n\nyum install tree å tree æå®ç®å½\n\n$ tree .\n.\nâââ aaa\nâ   âââ abc.txt\nâââ bar.txt\nâââ foo.txt\n\n\n1\n2\n3\n4\n5\n6\n\n\n> è¡¥åï¼wc å½ä»¤\n> \n> wcï¼word countï¼å½ä»¤çåè½ä¸ºç»è®¡æå®æä»¶ä¸­çå­èæ°ãå­æ°ãè¡æ°ï¼å¹¶å°ç»è®¡ç»ææ¾ç¤ºè¾åºã\n> \n> å½ä»¤ï¼wc [éé¡¹] [æä»¶]\n> \n>  * -cï¼ç»è®¡å­èæ°\n>  * -lï¼ç»è®¡è¡æ°\n>  * -mï¼ç»è®¡å­ç¬¦æ°ï¼è¿ä¸ªéé¡¹ä¸è½ä¸ -c ä¸èµ·ä½¿ç¨\n>  * -wï¼ç»è®¡å­æ°ï¼ä¸ä¸ªå­è¢«å®ä¹ä¸ºç±ç©ºç½ãè·³æ ¼ææ¢è¡å­ç¬¦åéçå­ç¬¦ä¸²\n>  * -lï¼ç»è®¡æé¿è¡çé¿åº¦',charsets:{cjk:!0},lastUpdated:"2022/08/01, 12:48:16",lastUpdatedTimestamp:1659358096e3},{title:"Linuxå®æç¯ï¼ä¸ï¼",frontmatter:{title:"Linuxå®æç¯ï¼ä¸ï¼",date:"2022-08-02T22:00:10.000Z",permalink:"/pages/16468e/",categories:["åºç¡","Linux","é©é¡ºå¹³2021è¯¾ç¨ç¬è®°"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/10.Linux/05.%E9%9F%A9%E9%A1%BA%E5%B9%B32021%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/15.Linux%E5%AE%9E%E6%93%8D%E7%AF%87%EF%BC%88%E4%B8%8B%EF%BC%89.html",relativePath:"åºç¡/10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/15.Linuxå®æç¯ï¼ä¸ï¼.md",key:"v-e36601e4",path:"/pages/16468e/",headers:[{level:2,title:"1. ç½ç»éç½®",slug:"_1-ç½ç»éç½®",normalizedTitle:"1. ç½ç»éç½®",charIndex:2},{level:3,title:"1.1 Linux ç½ç»éç½®åç",slug:"_1-1-linux-ç½ç»éç½®åç",normalizedTitle:"1.1 linux ç½ç»éç½®åç",charIndex:14},{level:3,title:"1.2 æ¥çç½ç» IP åç½å³",slug:"_1-2-æ¥çç½ç»-ip-åç½å³",normalizedTitle:"1.2 æ¥çç½ç» ip åç½å³",charIndex:210},{level:4,title:"1.2.1 æ¥çèææº IP",slug:"_1-2-1-æ¥çèææº-ip",normalizedTitle:"1.2.1 æ¥çèææº ip",charIndex:229},{level:4,title:"1.2.2 æ¥çç½ç»ç¼è¾å¨åç½å³",slug:"_1-2-2-æ¥çç½ç»ç¼è¾å¨åç½å³",normalizedTitle:"1.2.2 æ¥çç½ç»ç¼è¾å¨åç½å³",charIndex:839},{level:4,title:"1.2.3 æ¥ç Windows ç¯å¢ä¸­ç VMnet8 ç½ç»éç½®",slug:"_1-2-3-æ¥ç-windows-ç¯å¢ä¸­ç-vmnet8-ç½ç»éç½®",normalizedTitle:"1.2.3 æ¥ç windows ç¯å¢ä¸­ç vmnet8 ç½ç»éç½®",charIndex:929},{level:3,title:"1.3 ping æµè¯è¿éæ§",slug:"_1-3-ping-æµè¯è¿éæ§",normalizedTitle:"1.3 ping æµè¯è¿éæ§",charIndex:1296},{level:3,title:"1.4 Linux ç½ç»ç¯å¢éç½®",slug:"_1-4-linux-ç½ç»ç¯å¢éç½®",normalizedTitle:"1.4 linux ç½ç»ç¯å¢éç½®",charIndex:1377},{level:4,title:"1.4.1 ç¬¬ä¸ç§æ¹æ³ï¼èªå¨è·å",slug:"_1-4-1-ç¬¬ä¸ç§æ¹æ³-èªå¨è·å",normalizedTitle:"1.4.1 ç¬¬ä¸ç§æ¹æ³ï¼èªå¨è·å",charIndex:1397},{level:4,title:"1.4.2 ç¬¬äºç§æ¹æ³ï¼æå® IP â­ï¸",slug:"_1-4-2-ç¬¬äºç§æ¹æ³-æå®-ip-â­ï¸",normalizedTitle:"1.4.2 ç¬¬äºç§æ¹æ³ï¼æå® ip â­ï¸",charIndex:1481},{level:3,title:"1.5 è®¾ç½®ä¸»æºåå hosts æ å°",slug:"_1-5-è®¾ç½®ä¸»æºåå-hosts-æ å°",normalizedTitle:"1.5 è®¾ç½®ä¸»æºåå hosts æ å°",charIndex:3079},{level:4,title:"1.5.1 è®¾ç½®ä¸»æºå",slug:"_1-5-1-è®¾ç½®ä¸»æºå",normalizedTitle:"1.5.1 è®¾ç½®ä¸»æºå",charIndex:3102},{level:4,title:"1.5.2 è®¾ç½® hosts æ å°",slug:"_1-5-2-è®¾ç½®-hosts-æ å°",normalizedTitle:"1.5.2 è®¾ç½® hosts æ å°",charIndex:3209},{level:3,title:"1.6 åºç¨å®ä¾ï¼æµè§å¨è§£æ www.baidu.com çè¿ç¨",slug:"_1-6-åºç¨å®ä¾-æµè§å¨è§£æ-www-baidu-com-çè¿ç¨",normalizedTitle:"1.6 åºç¨å®ä¾ï¼æµè§å¨è§£æ www.baidu.com çè¿ç¨",charIndex:3538},{level:2,title:"2. è¿ç¨ç®¡çâ­ï¸",slug:"_2-è¿ç¨ç®¡ç",normalizedTitle:"2. è¿ç¨ç®¡çâ­ï¸",charIndex:3940},{level:3,title:"2.1 åºæ¬ä»ç»",slug:"_2-1-åºæ¬ä»ç»",normalizedTitle:"2.1 åºæ¬ä»ç»",charIndex:3954},{level:3,title:"2.2 ps æ¾ç¤ºç³»ç»æ§è¡çè¿ç¨",slug:"_2-2-ps-æ¾ç¤ºç³»ç»æ§è¡çè¿ç¨",normalizedTitle:"2.2 ps æ¾ç¤ºç³»ç»æ§è¡çè¿ç¨",charIndex:4189},{level:4,title:"2.2.1 ps å½ä»¤",slug:"_2-2-1-ps-å½ä»¤",normalizedTitle:"2.2.1 ps å½ä»¤",charIndex:4209},{level:4,title:"2.2.2 ps è¯¦è§£",slug:"_2-2-2-ps-è¯¦è§£",normalizedTitle:"2.2.2 ps è¯¦è§£",charIndex:4650},{level:4,title:"2.2.3 åºç¨å®ä¾",slug:"_2-2-3-åºç¨å®ä¾",normalizedTitle:"2.2.3 åºç¨å®ä¾",charIndex:5029},{level:3,title:"2.3 kill å killall",slug:"_2-3-kill-å-killall",normalizedTitle:"2.3 kill å killall",charIndex:5248},{level:4,title:"ð æ¡ä¾ 1ï¼è¸¢ææä¸ªéæ³ç¨æ·",slug:"ð-æ¡ä¾-1-è¸¢ææä¸ªéæ³ç¨æ·",normalizedTitle:"ð æ¡ä¾ 1ï¼è¸¢ææä¸ªéæ³ç¨æ·",charIndex:5536},{level:4,title:"ð æ¡ä¾ 2ï¼ç»æ­¢è¿ç¨ç»å½æå¡ sshdï¼å¹¶å¨éå½æ¶ååæ¬¡éå¯ sshd æå¡",slug:"ð-æ¡ä¾-2-ç»æ­¢è¿ç¨ç»å½æå¡-sshd-å¹¶å¨éå½æ¶ååæ¬¡éå¯-sshd-æå¡",normalizedTitle:"ð æ¡ä¾ 2ï¼ç»æ­¢è¿ç¨ç»å½æå¡ sshdï¼å¹¶å¨éå½æ¶ååæ¬¡éå¯ sshd æå¡",charIndex:6219},{level:4,title:"ð æ¡ä¾ 3ï¼ç»æ­¢å¤ä¸ª gedit",slug:"ð-æ¡ä¾-3-ç»æ­¢å¤ä¸ª-gedit",normalizedTitle:"ð æ¡ä¾ 3ï¼ç»æ­¢å¤ä¸ª gedit",charIndex:6431},{level:4,title:"ð æ¡ä¾ 4ï¼å¼ºå¶ææä¸ä¸ªç»ç«¯",slug:"ð-æ¡ä¾-4-å¼ºå¶ææä¸ä¸ªç»ç«¯",normalizedTitle:"ð æ¡ä¾ 4ï¼å¼ºå¶ææä¸ä¸ªç»ç«¯",charIndex:6509},{level:3,title:"2.4 pstree æ¥çè¿ç¨æ ",slug:"_2-4-pstree-æ¥çè¿ç¨æ ",normalizedTitle:"2.4 pstree æ¥çè¿ç¨æ ",charIndex:6722},{level:3,title:"2.5 æå¡ï¼serviceï¼ç®¡ç",slug:"_2-5-æå¡-service-ç®¡ç",normalizedTitle:"2.5 æå¡ï¼serviceï¼ç®¡ç",charIndex:6873},{level:4,title:"2.5.1 service ç®¡çæä»¤",slug:"_2-5-1-service-ç®¡çæä»¤",normalizedTitle:"2.5.1 service ç®¡çæä»¤",charIndex:7035},{level:4,title:"2.5.2 æ¥çæå¡å",slug:"_2-5-2-æ¥çæå¡å",normalizedTitle:"2.5.2 æ¥çæå¡å",charIndex:7336},{level:4,title:"2.5.3 æå¡çè¿è¡çº§å«",slug:"_2-5-3-æå¡çè¿è¡çº§å«",normalizedTitle:"2.5.3 æå¡çè¿è¡çº§å«",charIndex:7489},{level:4,title:"2.5.4 CentOS 7 åè¿è¡çº§å«è¯´æ",slug:"_2-5-4-centos-7-åè¿è¡çº§å«è¯´æ",normalizedTitle:"2.5.4 centos 7 åè¿è¡çº§å«è¯´æ",charIndex:7887},{level:4,title:"2.5.5 chkconfig æä»¤",slug:"_2-5-5-chkconfig-æä»¤",normalizedTitle:"2.5.5 chkconfig æä»¤",charIndex:8097},{level:3,title:"2.6 systemctl å½ä»¤ð¶",slug:"_2-6-systemctl-å½ä»¤",normalizedTitle:"2.6 systemctl å½ä»¤ð¶",charIndex:8433},{level:4,title:"2.6.1 systemctl ç®¡çæä»¤",slug:"_2-6-1-systemctl-ç®¡çæä»¤",normalizedTitle:"2.6.1 systemctl ç®¡çæä»¤",charIndex:8479},{level:4,title:"2.6.2 systemctl è®¾ç½®æå¡èªå¯å¨ç¶æ",slug:"_2-6-2-systemctl-è®¾ç½®æå¡èªå¯å¨ç¶æ",normalizedTitle:"2.6.2 systemctl è®¾ç½®æå¡èªå¯å¨ç¶æ",charIndex:8607},{level:3,title:"2.7 é²ç«å¢æå¼åå³é­æå®ç«¯å£ð¶",slug:"_2-7-é²ç«å¢æå¼åå³é­æå®ç«¯å£",normalizedTitle:"2.7 é²ç«å¢æå¼åå³é­æå®ç«¯å£ð¶",charIndex:9160},{level:3,title:"2.8 top å¨æçæ§è¿ç¨",slug:"_2-8-top-å¨æçæ§è¿ç¨",normalizedTitle:"2.8 top å¨æçæ§è¿ç¨",charIndex:9998},{level:4,title:"ð æ¡ä¾ 1ï¼çè§ç¹å®ç¨æ·",slug:"ð-æ¡ä¾-1-çè§ç¹å®ç¨æ·",normalizedTitle:"ð æ¡ä¾ 1ï¼çè§ç¹å®ç¨æ·",charIndex:10308},{level:4,title:"ð æ¡ä¾ 2ï¼ç»æ­¢æå®çè¿ç¨",slug:"ð-æ¡ä¾-2-ç»æ­¢æå®çè¿ç¨",normalizedTitle:"ð æ¡ä¾ 2ï¼ç»æ­¢æå®çè¿ç¨",charIndex:10363},{level:3,title:"2.9 netstat çæ§ç½ç»ç¶æâ­ï¸",slug:"_2-9-netstat-çæ§ç½ç»ç¶æ",normalizedTitle:"2.9 netstat çæ§ç½ç»ç¶æâ­ï¸",charIndex:10429},{level:3,title:"2.10 ping æ£æµä¸»æºè¿æ¥",slug:"_2-10-ping-æ£æµä¸»æºè¿æ¥",normalizedTitle:"2.10 ping æ£æµä¸»æºè¿æ¥",charIndex:10653},{level:2,title:"3. RPM ä¸ YUM",slug:"_3-rpm-ä¸-yum",normalizedTitle:"3. rpm ä¸ yum",charIndex:10738},{level:3,title:"3.1 RPM åçç®¡ç",slug:"_3-1-rpm-åçç®¡ç",normalizedTitle:"3.1 rpm åçç®¡ç",charIndex:10755},{level:4,title:"3.1.1 rpm åçç®åæ¥è¯¢æä»¤",slug:"_3-1-1-rpm-åçç®åæ¥è¯¢æä»¤",normalizedTitle:"3.1.1 rpm åçç®åæ¥è¯¢æä»¤",charIndex:10980},{level:4,title:"3.1.2 rpm åååºæ¬æ ¼å¼",slug:"_3-1-2-rpm-åååºæ¬æ ¼å¼",normalizedTitle:"3.1.2 rpm åååºæ¬æ ¼å¼",charIndex:11191},{level:4,title:"3.1.3 RPM åçå¶å®æ¥è¯¢æä»¤",slug:"_3-1-3-rpm-åçå¶å®æ¥è¯¢æä»¤",normalizedTitle:"3.1.3 rpm åçå¶å®æ¥è¯¢æä»¤",charIndex:11380},{level:4,title:"3.1.4 å¸è½½ rpm å",slug:"_3-1-4-å¸è½½-rpm-å",normalizedTitle:"3.1.4 å¸è½½ rpm å",charIndex:11539},{level:4,title:"3.1.5 å®è£ rpm å",slug:"_3-1-5-å®è£-rpm-å",normalizedTitle:"3.1.5 å®è£ rpm å",charIndex:11778},{level:3,title:"3.2 yum",slug:"_3-2-yum",normalizedTitle:"3.2 yum",charIndex:12009}],headersStr:"1. ç½ç»éç½® 1.1 Linux ç½ç»éç½®åç 1.2 æ¥çç½ç» IP åç½å³ 1.2.1 æ¥çèææº IP 1.2.2 æ¥çç½ç»ç¼è¾å¨åç½å³ 1.2.3 æ¥ç Windows ç¯å¢ä¸­ç VMnet8 ç½ç»éç½® 1.3 ping æµè¯è¿éæ§ 1.4 Linux ç½ç»ç¯å¢éç½® 1.4.1 ç¬¬ä¸ç§æ¹æ³ï¼èªå¨è·å 1.4.2 ç¬¬äºç§æ¹æ³ï¼æå® IP â­ï¸ 1.5 è®¾ç½®ä¸»æºåå hosts æ å° 1.5.1 è®¾ç½®ä¸»æºå 1.5.2 è®¾ç½® hosts æ å° 1.6 åºç¨å®ä¾ï¼æµè§å¨è§£æ www.baidu.com çè¿ç¨ 2. è¿ç¨ç®¡çâ­ï¸ 2.1 åºæ¬ä»ç» 2.2 ps æ¾ç¤ºç³»ç»æ§è¡çè¿ç¨ 2.2.1 ps å½ä»¤ 2.2.2 ps è¯¦è§£ 2.2.3 åºç¨å®ä¾ 2.3 kill å killall ð æ¡ä¾ 1ï¼è¸¢ææä¸ªéæ³ç¨æ· ð æ¡ä¾ 2ï¼ç»æ­¢è¿ç¨ç»å½æå¡ sshdï¼å¹¶å¨éå½æ¶ååæ¬¡éå¯ sshd æå¡ ð æ¡ä¾ 3ï¼ç»æ­¢å¤ä¸ª gedit ð æ¡ä¾ 4ï¼å¼ºå¶ææä¸ä¸ªç»ç«¯ 2.4 pstree æ¥çè¿ç¨æ  2.5 æå¡ï¼serviceï¼ç®¡ç 2.5.1 service ç®¡çæä»¤ 2.5.2 æ¥çæå¡å 2.5.3 æå¡çè¿è¡çº§å« 2.5.4 CentOS 7 åè¿è¡çº§å«è¯´æ 2.5.5 chkconfig æä»¤ 2.6 systemctl å½ä»¤ð¶ 2.6.1 systemctl ç®¡çæä»¤ 2.6.2 systemctl è®¾ç½®æå¡èªå¯å¨ç¶æ 2.7 é²ç«å¢æå¼åå³é­æå®ç«¯å£ð¶ 2.8 top å¨æçæ§è¿ç¨ ð æ¡ä¾ 1ï¼çè§ç¹å®ç¨æ· ð æ¡ä¾ 2ï¼ç»æ­¢æå®çè¿ç¨ 2.9 netstat çæ§ç½ç»ç¶æâ­ï¸ 2.10 ping æ£æµä¸»æºè¿æ¥ 3. RPM ä¸ YUM 3.1 RPM åçç®¡ç 3.1.1 rpm åçç®åæ¥è¯¢æä»¤ 3.1.2 rpm åååºæ¬æ ¼å¼ 3.1.3 RPM åçå¶å®æ¥è¯¢æä»¤ 3.1.4 å¸è½½ rpm å 3.1.5 å®è£ rpm å 3.2 yum",content:'# 1. ç½ç»éç½®\n\n\n# 1.1 Linux ç½ç»éç½®åç\n\nåè®¾æä»¬çç©çä¸»æºå¨ä¸ä¸ªæå®¤çå±åç½åï¼\n\n * Linux èææºå vmnet8 å¨ä¸ä¸ªå­ç½åå½¢æä¸ä¸ªç½ç»ï¼å¯ä»¥äºéï¼ping éï¼\n * æ¬æºçµèçæ çº¿ç½å¡ä¸æå®¤å±åç½çç½å³äºéï¼vmnet8 ååæ çº¿ç½å¡äºé\n * èé©è®²éäºï¼vmnet8 ä¸æ¯èææºçç½å³ï¼åªæ¯ç¨æ¥èææºåå®ä½æºéè®¯çï¼æ vmnet8 ç¦ç¨äºèææºä¹å¯ä»¥è¿æ¥äºèç½ã\n\n\n# 1.2 æ¥çç½ç» IP åç½å³\n\n# 1.2.1 æ¥çèææº IP\n\nå¨ Linux ä¸­ç ifconfig å¯ä»¥çå°æ¬æºç IPï¼\n\n$ ifconfig\nens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 192.168.220.134  netmask 255.255.255.0  broadcast 192.168.220.255\n        inet6 fe80::c84d:947f:c9c3:2aa3  prefixlen 64  scopeid 0x20<link>\n        ether 00:0c:29:f9:c5:14  txqueuelen 1000  (Ethernet)\n        RX packets 142  bytes 14858 (14.5 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 130  bytes 17101 (16.7 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯ä»¥çå° Linux èææºç IP ä¸º 192.168.220.134ã\n\n# 1.2.2 æ¥çç½ç»ç¼è¾å¨åç½å³\n\nå¨ VMware çèæç½ç»ç¼è¾å¨ä¸­ï¼å¯ä»¥çå° NAT è¿æ¥æ¹å¼ä¸æ¬æºçå­ç½ IPï¼\n\n\n\nç¶åå¨ç¹å» NAT è®¾ç½® å¯ä»¥çå°ç½å³ï¼\n\n\n\n# 1.2.3 æ¥ç Windows ç¯å¢ä¸­ç VMnet8 ç½ç»éç½®\n\nä½¿ç¨ ipconfig å½ä»¤ï¼\n\n> ipconfig\n...\nä»¥å¤ªç½ééå¨ VMware Network Adapter VMnet8:\n\n   è¿æ¥ç¹å®ç DNS åç¼ . . . . . . . :\n   æ¬å°é¾æ¥ IPv6 å°å. . . . . . . . : fe80::c823:6a37:c475:ed49%24\n   IPv4 å°å . . . . . . . . . . . . : 192.168.220.1\n   å­ç½æ©ç   . . . . . . . . . . . . : 255.255.255.0\n   é»è®¤ç½å³. . . . . . . . . . . . . :\n...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 1.3 ping æµè¯è¿éæ§\n\nping ç®çä¸»æºï¼æµè¯å½åæå¡å¨æ¯å¦å¯ä»¥è¿æ¥ç®çä¸»æº\n\n> æµè¯æ¯å¦å¯ä»¥è¿æ¥ç¾åº¦ï¼ping www.baidu.com\n\n\n# 1.4 Linux ç½ç»ç¯å¢éç½®\n\n# 1.4.1 ç¬¬ä¸ç§æ¹æ³ï¼èªå¨è·å\n\nç»å½åï¼éè¿çé¢æ¥è®¾ç½®èªå¨è·å IPãç¹ç¹ï¼Linux å¯å¨åä¼èªå¨è·å IPï¼ä½æ¯æ¬¡èªå¨è·åç IP å°åå¯è½ä¸ä¸æ ·ã\n\n\n\n# 1.4.2 ç¬¬äºç§æ¹æ³ï¼æå® IP â­ï¸\n\nç´æ¥ä¿®æ¹éç½®æä»¶æ¥æå® IPï¼å¹¶å¯ä»¥è¿æ¥å°å¤ç½ï¼ç¨åºåæ¨èï¼ã\n\néç½®æä»¶æ ¹æ®ç½å¡ä¸ååå­ææåºå«ï¼ä½æä»¶è·¯å¾ä¸è´ï¼/etc/sysconfig/network-scripts/ï¼å¸¸è§çéç½®æä»¶åæ ifcfg-eth0 æè ifcfg-ens33ï¼å¯ä»¥éè¿ ifconfig æ¥çåç¼ã\n\nä»¥ ifcfg-ens33 ä¸ºä¾ï¼ä½¿ç¨ vim ä¿®æ¹æ­¤æä»¶ vim /etc/sysconfig/network-scripts/ifcfg-ens33ï¼\n\nYPE="Ethernet"\nPROXY_METHOD="none"\nBROWSER_ONLY="no"\n- BOOTPROTO="dhcp"\n+ BOOTPROTO="static"\nDEFROUTE="yes"\nIPV4_FAILURE_FATAL="no"\nIPV6INIT="yes"\nIPV6_AUTOCONF="yes"\nIPV6_DEFROUTE="yes"\nIPV6_FAILURE_FATAL="no"\nIPV6_ADDR_GEN_MODE="stable-privacy"\nNAME="ens33"\nUUID="1af88ac9-573c-49da-993c-9ab4e6c73159"\nDEVICE="ens33"\nONBOOT="yes"\n+ IPADDR=192.168.200.130 # æ¬æº IP å°å\n+ NETMASK=255.255.255.0 # å­ç½æ©ç \n+ GATEWAY=192.168.200.2 # é»è®¤ç½å³\n+ DNS1=192.168.200.2 # ååè§£æå¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä¿®æ¹å¥½åå¹¶ä¿å­ãç¶åè¿å¥ VMware çèæç½ç»ç¼è¾å¨ï¼å° NAT éç½®ä¸­çå­ç½ IP æ¹ä¸º 192.168.200.0ï¼å°ç½å³ IP æ¹ä¸º 192.168.200.2ãä¿®æ¹ä½ç½®å¯è§æ¬æç 1.2.2 èæç¤ºã\n\nå®æä»¥ä¸æä½åï¼éå¯ç½ç»æå¡æéå¯ç³»ç»çæï¼\n\nservice network restartãreboot\n\n\n1\n\n\nä»¥ä¸è¿äºæä½å°±æ¯å°æ¬æ 1.1 èå¾ä¸­ç Linux èææºå vmnet8 çå°ååå«æ¹æäº 192.168.200.130 å 192.168.200.1ãè¿æ¶å¨èææºä¸­ä½¿ç¨ ifconfig å½ä»¤å¯ä»¥çå°ï¼\n\n$ ifconfig\nens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 192.168.200.130  netmask 255.255.255.0  broadcast 192.168.200.255\n        inet6 fe80::c84d:947f:c9c3:2aa3  prefixlen 64  scopeid 0x20<link>\n        ether 00:0c:29:f9:c5:14  txqueuelen 1000  (Ethernet)\n        RX packets 792  bytes 825124 (805.7 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 456  bytes 33428 (32.6 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n * æ¬æº IP å·²ç»æåæ¹ä¸ºäº 192.168.200.130ã\n\n\n# 1.5 è®¾ç½®ä¸»æºåå hosts æ å°\n\n# 1.5.1 è®¾ç½®ä¸»æºå\n\nä¸ºäºæ¹ä¾¿è®°å¿ï¼å¯ä»¥ç» Linux ç³»ç»è®¾ç½®ä¸»æºåï¼ä¹å¯ä»¥æ ¹æ®éè¦ä¿®æ¹ä¸»æºåã\n\næä»¤ hostnameï¼æ¥çä¸»æºå\n\nä¿®æ¹æä»¶å¨ /etc/hostname æå®ãä¿®æ¹åéå¯çæã\n\n# 1.5.2 è®¾ç½® hosts æ å°\n\næèï¼å¦ä½éè¿ä¸»æºåè½å¤æ¾å°ï¼æ¯å¦ pingï¼æä¸ª Linux ç³»ç»ï¼\n\nHostsï¼ä¸ä¸ªè®°å½ IP å hostname ä¹é´æ å°å³ç³»çææ¬æä»¶ã\n\nâï¸ Windows ä¸­ï¼å¨ C:\\Windows\\System32\\drivers\\etc\\hosts æä»¶æå®å³å¯ã\n\n> æ¡ä¾ï¼192.168.200.130 hspEdu100\n> \n>  * ååé¨åæ¯ IP å°åï¼ååé¨åæ¯å¶å¯¹åºçä¸»æºå\n> \n> PSï¼è¿æä¸ä¸ªå¸¸è§çæ¡ä¾æ¯ 127.0.0.1 localhost\n\nâï¸ Linux ä¸­ï¼å¨ /etc/hosts æä»¶æå®å³å¯ã\n\n> æ¡ä¾ï¼192.168.200.1 ThinkPad-PC\n\n\n# 1.6 åºç¨å®ä¾ï¼æµè§å¨è§£æ www.baidu.com çè¿ç¨\n\n 1. æµè§å¨åæ£æ¥æµè§å¨ä¸­ææ²¡æè¯¥ååè§£æ IPï¼æå°±åè°ç¨è¿ä¸ª IP å®æè§£æãå¦ææ²¡æï¼å°±åæ£æ¥ DNS è§£æå¨ç¼å­ï¼å¦ææå°±ç´æ¥è¿å IP å®æè§£æãè¿ä¸¤ä¸ªç¼å­å¯ä»¥çè§£ä¸ºæ¬å°è§£æå¨ç¼å­ã\n 2. ä¸è¬æ¥è¯´ï¼å½çµèç¬¬ä¸æ¬¡æåè®¿é®æä¸ä¸ªç½ç«åï¼å¨ä¸å®æ¶é´åæµè§å¨æ OS ä¼ç¼å­å®ç DNS è§£æè®°å½ã\n\nipconfig /displaydns  // æ¥ç DNS ååè§£æç¼å­\nipconfig /flushdns    // æå¨æ¸ç DNS ç¼å­\n\n\n1\n2\n\n 1. å¦ææ¬å°è§£æå¨ç¼å­æ²¡ææ¾å°å¯¹åºçæ å°ï¼å°±æ£æ¥ç³»ç»ä¸­ hosts æä»¶ä¸­ææ²¡æå¯¹åºçåå IP æ å°ï¼æåå®æè§£æå¹¶è¿åã\n 2. å¦ææ¬å° DNS è§£æå¨ç¼å­å hosts æä»¶é½æ²¡è½è§£æåºå¯¹åºç IPï¼åå°ååæå¡ DNS è¿è¡è§£æåã\n\n\n\n\n# 2. è¿ç¨ç®¡çâ­ï¸\n\n\n# 2.1 åºæ¬ä»ç»\n\nå¨ Linux ä¸­ï¼æ¯ä¸ªæ§è¡çç¨åºï¼ä»£ç ï¼é½ç§°ä¸ºä¸ä¸ªè¿ç¨ãæ¯ä¸ä¸ªè¿ç¨é½åéä¸ä¸ª ID å·ï¼å³è¿ç¨å·ï¼PIDã\n\n> ç¨åºåè¿ç¨ï¼ç¨åº==ä»£ç ï¼æ¯éææ¦å¿µï¼è¿ç¨æ¯è¿è¡èµ·æ¥çå ç¨åå­çç¨åºã\n\næ¯ä¸ªè¿ç¨é½å¯è½ä»¥ä¸¤ç§æ¹å¼å­å¨çï¼åå°ä¸åå°ãæè°åå°è¿ç¨å°±æ¯ç¨æ·ç®åçå±å¹ä¸å¯ä»¥è¿è¡æä½çãåå°è¿ç¨åæ¯å®éå¨æä½ï¼ä½ç±äºå±å¹ä¸æ æ³çå°çè¿ç¨ï¼éå¸¸ä½¿ç¨åå°æ¹å¼æ§è¡ã\n\nä¸è¬ç³»ç»çæå¡é½æ¯ä»¥åå°è¿ç¨çæ¹å¼å­å¨ï¼èä¸é½ä¼å¸¸é©»å¨ç³»ç»ä¸­ï¼ç´å°å³æºææç»æã\n\n\n# 2.2 ps æ¾ç¤ºç³»ç»æ§è¡çè¿ç¨\n\n# 2.2.1 ps å½ä»¤\n\nps å½ä»¤æ¯ Process Status çç¼©åï¼ç¨æ¥ååºç³»ç»ä¸­å½åæ­£å¨è¿è¡çé£äºè¿ç¨ï¼å°±æ¯æ§è¡ ps å½ä»¤çé£ä¸ªæ¶å»çé£äºè¿ç¨çå¿«ç§ã\n\n> ps æ¥ççç»æä¸æ¯å¨æè¿ç»­çï¼å¦ææ³è¦å¨æçæ¾ç¤ºè¿ç¨ä¿¡æ¯ï¼å°±å¯ä»¥ä½¿ç¨ topãhtop å½ä»¤ã\n\n$ ps\n   PID TTY          TIME CMD\n  2149 pts/0    00:00:00 zsh\n  2228 pts/0    00:00:00 ps\n\n\n1\n2\n3\n4\n\n * ps æ¾ç¤ºçä¿¡æ¯å­æ®µï¼\n   * PIDï¼è¿ç¨è¯å«å·\n   * TTYï¼ç»ç«¯æºå·\n   * TIMEï¼è¿ç¨ä½¿ç¨ CPU çæ»æ¶é´\n   * CMDï¼æ­£å¨æ§è¡çå½ä»¤æè¿ç¨å\n * å¸¸ç¨éé¡¹ï¼\n   * -aï¼æ¾ç¤ºå½åç»ç«¯çææè¿ç¨ä¿¡æ¯\n   * -uï¼ä»¥ç¨æ·çæ ¼å¼æ¾ç¤ºè¿ç¨ä¿¡æ¯\n   * -xï¼æ¾ç¤ºåå°è¿ç¨è¿è¡çåæ°\n\n> å¸¸è§æåµä¸æ¯ ps -aux | more ä¸ä¸ªéé¡¹ä¸åç¨ï¼å¹¶åé¡µæ¥ç\n\n# 2.2.2 ps è¯¦è§£\n\nè¾å¥ ps -aux|more åå¯ä»¥çå°ï¼\n\n\n\n * USERï¼ç¨æ·åç§°\n * %CPUï¼è¿ç¨å ç¨ CPU ç¾åæ¯\n * %MEMï¼è¿ç¨å ç¨ç©çåå­çç¾åæ¯\n * VSZï¼è¿ç¨å ç¨çèæåå­å¤§å°ï¼åä½ KBï¼\n * RSSï¼è¿ç¨å ç¨çç©çåå­å¤§å°ï¼åä½ KBï¼\n * TTYï¼ç»ç«¯åç§°ï¼ç¼©å\n * STATï¼è¿ç¨ç¶æãS ç¡ç ï¼s è¡¨ç¤ºè¯¥è¿ç¨æ¯ä¼è¯çåå¯¼è¿ç¨ï¼N è¡¨ç¤ºè¯¥è¿ç¨æ¥ææ¯æ®éä¼åçº§æ´ä½çä¼åçº§ï¼R æ­£å¨è¿è¡ï¼D ç­æç­å¾ï¼Z åµæ­»è¿ç¨ï¼T è¢«è·è¸ªæè¢«åæ­¢ç­\n * STARTï¼è¿ç¨çå¯å¨æ¶é´\n * TIMEï¼è¿ç¨ä½¿ç¨ CPU çæ»æ¶é´\n * COMMANDï¼å¯å¨è¿ç¨æç¨çå½ä»¤ååæ°ï¼å¦æè¿é¿ä¼è¢«æªæ­æ¾ç¤º\n\nä½æ¯ç´æ¥ ps ä¼æ¾ç¤ºå¤ªå¤çè¿ç¨äºï¼å¦ææ³çææ²¡ææä¸ªè¿ç¨ï¼å¯ä»¥ç¨ ps -aux|grep xxxã\n\n# 2.2.3 åºç¨å®ä¾\n\nè¦æ±ï¼ä»¥å¨æ ¼å¼æ¾ç¤ºå½åææçè¿ç¨ï¼æ¥çè¿ç¨çç¶è¿ç¨\n\nps -efï¼ä»¥å¨æ ¼å¼æ¥çç³»ç»ä¸çè¿è¡çææè¿ç¨ ãå¸¸ç¨ã\n\n * -eï¼æ¾ç¤ºè¿è¡å¨ç³»ç»ä¸çææè¿ç¨\n * -fï¼å¨æ ¼å¼ï¼å³æ©å±æ¾ç¤ºè¾åº\n\n\n\n * C å­æ®µæ¯ CPU ç¨äºè®¡ç®æ§è¡ä¼åçº§çå å­ãæ°å¼è¶å¤§ï¼è¡¨æè¿ç¨æ¯ CPU å¯éåè¿ç®ï¼æ§è¡çä¼åçº§ä¼éä½ï¼æ°å¼è¶å°ï¼è¡¨æè¿ç¨æ¯ IO å¯éåè¿ç®ï¼æ§è¡ä¼åçº§ä¼æé«ã\n * PPIDï¼ç¶è¿ç¨ç PID\n\n\n# 2.3 kill å killall\n\n> è¿é¨åå¨ CSAPP ä¸­æè®²è§£\n\nkill å½ä»¤ä¼åæä½ç³»ç»åæ ¸åéä¸ä¸ªä¿¡å·ï¼å¤æ¯ç»æ­¢ä¿¡å·ï¼åç®æ è¿ç¨ç PIDï¼ç¶åç³»ç»åæ ¸æ ¹æ®æ¶å°çä¿¡å·ç±»åï¼å¯¹æå®è¿ç¨è¿è¡ç¸åºçæä½ãé¢è®¾çä¿¡æ¯ä¸º SIGTERM(15)ï¼å¯å°æå®ç¨åºç»æ­¢ã\n\nè¿éåªè®²ç¨ kill å½ä»¤ç»æ­¢è¿ç¨ï¼\n\n * kill [éé¡¹] è¿ç¨å·ï¼ç»æ­¢è¿ç¨\n * killall è¿ç¨åç§°ï¼éè¿è¿ç¨åç§°ææ­»è¿ç¨ï¼åå¶å­è¿ç¨ï¼ï¼ä¹æ¯æééç¬¦ï¼è¿å¨ç³»ç»å è´è½½è¿å¤§èåå¾å¾æ¢æ¶å¾æç¨ãæ­¤å½ä»¤ä¼æå¯¹åºè¿ç¨çææå­è¿ç¨é½ææã\n\nå¸¸ç¨éé¡¹ï¼\n\n * -9ï¼è¡¨ç¤ºå¼ºè¿«è¿ç¨ç«å³ç»æ­¢\n\n# ð æ¡ä¾ 1ï¼è¸¢ææä¸ªéæ³ç¨æ·\n\næä»¬åè®©ç¨æ· fox ç»å½ï¼ç¶å root ä¸è¾å¥ ps -aux | grep sshdï¼å¯ä»¥çå°ï¼\n\n$ ps -aux | grep sshd\nroot       1462  0.0  0.2 112984  4324 ?        Ss   12:24   0:00 /usr/sbin/sshd -D\nroot       2140  0.0  0.2 161072  5584 ?        Ss   12:24   0:00 sshd: yubin [priv]\nyubin      2148  0.0  0.1 161072  2556 ?        S    12:24   0:00 sshd: yubin@pts/0\nroot       2900  0.3  0.2 161080  5584 ?        Ss   13:22   0:00 sshd: fox [priv]\nfox        2907  0.0  0.1 161080  2560 ?        S    13:22   0:00 sshd: fox@pts/1\nroot       3006  0.0  0.0 112828   984 pts/0    S+   13:23   0:00 grep --color=auto sshd\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¯ä»¥çå° fox ç»å½çæ¶åï¼æ¯éè¿è¿ç¨ 2900 ç»å½çï¼äºæ¯æä»¬ kill 2900 åå¯ä»¥çå° fox ç¨æ·è¢«è¸¢æã\n\n# ð æ¡ä¾ 2ï¼ç»æ­¢è¿ç¨ç»å½æå¡ sshdï¼å¹¶å¨éå½æ¶ååæ¬¡éå¯ sshd æå¡\n\nç±»ä¼¼äºæ¡ä¾1ï¼å¨æ¡ä¾ 1 çè¾åºä¸­å¯ä»¥çå°ï¼sshd æå¡ï¼/usr/sbin/sshd -D å¯å¨çè¿ç¨ï¼çè¿ç¨å·æ¯ 1462ï¼æä»¥ kill 1462 å³å¯ç»æ­¢ sshd æå¡ãç»æ­¢åä¼åç°å«çç¨æ·æ æ³åè¿ç¨ç»å½ã\n\nç»æ­¢ sshd åï¼éè¿ /bin/systemctl start sshd.service å³å¯éå¯è¯¥æå¡ã\n\n# ð æ¡ä¾ 3ï¼ç»æ­¢å¤ä¸ª gedit\n\nåå¨å¾å½¢åçé¢ä¸ç¨ gedit æå¼å¤ä¸ªææ¬ç¼è¾é¡µé¢ï¼ç¶å killall gedit å³å¯ä¸æ¬¡æ§å³é­å¨é¨ã\n\n# ð æ¡ä¾ 4ï¼å¼ºå¶ææä¸ä¸ªç»ç«¯\n\nåå¼ä¸ä¸ª bash ç»ç«¯ï¼ç¶å ps -aux|grep bash å³å¯çå°ææç bash è¿ç¨ï¼æ¾å°è¦ææ­»ç bash è¿ç¨å· xxxxï¼ç¶åä½¿ç¨ kill -9 bashå¯¹åºçè¿ç¨å· å³å¯ææ­»ã\n\n * å ä¸ -9 éé¡¹æ¯å ä¸ºå¦æä¸å çè¯ï¼ç³»ç»ä¼è®¤ä¸ºç±äºè¦è¢« kill ç bash æ­£å¨å·¥ä½ï¼èè®¤ä¸ºä½ ç kill æ¯ä¸ä¸ªè¯¯æä½ï¼ä»èç½®ä¹ä¸çï¼åªæå äº -9 æä¼å¼ºå¶ææã\n\n\n# 2.4 pstree æ¥çè¿ç¨æ \n\npstree [éé¡¹]ï¼å¯ä»¥æ´å ç´è§çæ¥çè¿ç¨ä¿¡æ¯ã\n\n * -pï¼æ¾ç¤ºè¿ç¨ç PID\n * -uï¼æ¾ç¤ºè¿ç¨çæå±ç¨æ·\n\n> æ¡ä¾ï¼\n> \n>  * pstree -pï¼æ ç¶çå½¢å¼æ¾ç¤ºè¿ç¨ç PIDã\n>  * pstree -uï¼æ ç¶çå½¢å¼æ¾ç¤ºè¿ç¨çç¨æ·\n\n\n# 2.5 æå¡ï¼serviceï¼ç®¡ç\n\næå¡æ¬è´¨å°±æ¯è¿ç¨ï¼ä½æ¯æ¯è¿è¡å¨åå°çï¼éå¸¸é½ä¼çå¬æä¸ªç«¯å£ï¼ç­å¾å¶å®ç¨åºçè¯·æ±ï¼æ¯å¦(mysqlãsshdãé²ç«å¢ç­)ï¼å æ­¤æä»¬åç§°ä¸ºå®æ¤è¿ç¨ã\n\nè¯·æ±æä¸ªç«¯å£æ¶ï¼æ¬è´¨æ¯è¯·æ±çå¬è¯¥ç«¯å£çå®æ¤è¿ç¨ãæ¯å¦ï¼mysqld æå¡å¸¸çå¬ 3306 ç«¯å£ï¼SSHD æå¡å¸¸çå¬ 22 ç«¯å£ã\n\n# 2.5.1 service ç®¡çæä»¤\n\nservice æå¡å [start | stop | restart | reload | status]\n\n\n1\n\n * å¨ CentOS 7.0 å ä¸åä½¿ç¨ service ,èæ¯ systemctlï¼åé¢ä¸é¨ä»ç»ï¼\n * service æä»¤ç®¡ççæå¡å¨ /etc/init.d æ¥çï¼å³ ls -l /etc/init.d å½ä»¤ã\n\n> æ¡ä¾ï¼\n> \n>  * æ¥çç½ç»ï¼service network status\n>  * å³é­ç½ç»ï¼service network stop\n>  * å¯å¨ç½ç»ï¼service network start\n\n# 2.5.2 æ¥çæå¡å\n\nâï¸ æ¹å¼ä¸ï¼æ§è¡å½ä»¤ setup -> ç³»ç»æå¡ å°±å¯ä»¥çå°å¨é¨ï¼\n\n\n\n * å¸¦æå·çæ¯å¼æºèªå¯å¨çæå¡\n * å¯ä»¥éè¿å½ä»¤ sevice æ systemctl å¯å¨ã\n\nâï¸ æ¹å¼äºï¼è¿è¡ ls -l /etc/init.d æ¥ç service æä»¤ç®¡ççæå¡ã\n\n# 2.5.3 æå¡çè¿è¡çº§å«\n\nLinux ç³»ç»æ7ç§è¿è¡çº§å«ï¼runlevelï¼ï¼å¸¸ç¨çæ¯çº§å« 3 å 5ã\n\n * è¿è¡çº§å« 0ï¼ç³»ç»åæºç¶æï¼ç³»ç»é»è®¤è¿è¡çº§å«ä¸è½è®¾ä¸º0ï¼å¦åä¸è½æ­£å¸¸å¯å¨ã\n * è¿è¡çº§å« 1ï¼åç¨æ·å·¥ä½ç¶æï¼root æéï¼ç¨äºç³»ç»ç»´æ¤ï¼ç¦æ­¢è¿ç¨ç»éã\n * è¿è¡çº§å« 2ï¼å¤ç¨æ·ç¶æ(æ²¡æ NFS)ï¼ä¸æ¯æç½ç»ã\n * ðºè¿è¡çº§å« 3ï¼å®å¨çå¤ç¨æ·ç¶æ(æ NFS)ï¼æ çé¢ï¼ç»éåè¿å¥æ§å¶å°å½ä»¤è¡æ¨¡å¼ããå·¥ä½å¸¸ç¨ã\n * è¿è¡çº§å« 4ï¼ç³»ç»æªä½¿ç¨ï¼ä¿çã\n * è¿è¡çº§å« 5ï¼X11 æ§å¶å°ï¼ç»éåè¿å¥å¾å½¢ GUI æ¨¡å¼\n * è¿è¡çº§å« 6ï¼ç³»ç»æ­£å¸¸å³é­å¹¶éå¯ï¼é»è®¤è¿è¡çº§å«ä¸è½è®¾ä¸º6ï¼å¦åä¸è½æ­£å¸¸å¯å¨ã\n\nå¼æºçæµç¨è¯´æï¼å¼æº -> BIOS -> /boot -> systemd è¿ç¨ 1ï¼ææè¿ç¨çèç¥å®ï¼-> ç¡®å®è¿è¡çº§å« -> å¯å¨è¿è¡çº§å¯¹åºçæå¡\n\n# 2.5.4 CentOS 7 åè¿è¡çº§å«è¯´æ\n\nå¨ /etc/initab è¿è¡äºç®åï¼multi-user.target ç­åäºè¿è¡çº§å« 3ï¼graphical.target ç­åäºè¿è¡çº§å« 5ã\n\n * å½ä»¤ systemctl get-defaultï¼è·åå½åçè¿è¡çº§å«\n * å½ä»¤ systemctl set-default multi-user.targetï¼å°é»è®¤è¿è¡çº§å«è®¾ç½®ä¸º mulit-user\n\n# 2.5.5 chkconfig æä»¤\n\nchkconfig å½ä»¤ç¨äºæ£æ¥ï¼è®¾ç½®ç³»ç»çåç§æå¡ãéè¿ chkconfig å½ä»¤å¯ä»¥ç»æ¯ä¸ªæå¡çåä¸ªè¿è¡çº§å«è®¾ç½®âèªå¯å¨â/âå³é­âï¼æ­¤å¤çæå¡æ¯æ service æä»¤ç®¡ççæå¡ï¼å¨ /etc/init.d æ¥çï¼å³ ls -l /etc/init.d å½ä»¤ã\n\nå¨ CentOS 7.0ä¹åï¼å¾å¤æå¡ä½¿ç¨ systemctl ç®¡çã\n\nåºæ¬è¯­æ³ï¼\n\n * æ¥çæå¡ï¼chkconfig --list | grep æå¡å\n * chkconfig --level 5 æå¡å on/offï¼å°æä¸ä¸ªæå¡å¨ç¹å®çº§å«ä¸è®¾ç½®ä¸ºâèªå¯å¨â/âå³é­â\n\nchkconfig éæ°è®¾ç½®æå¡èªå¯å¨æå³é­åï¼éè¦éå¯æºå¨æè½çæã\n\n\n# 2.6 systemctl å½ä»¤ð¶\n\n> systemctlï¼system ctl\n\n# 2.6.1 systemctl ç®¡çæä»¤\n\nå½ä»¤ï¼systemctl [start | stop | restart | status] æå¡å\n\n * systemctl æä»¤ç®¡ççæå¡å¨ /usr/lib/systemd/system ç®å½æ¥ç\n\n# 2.6.2 systemctl è®¾ç½®æå¡èªå¯å¨ç¶æ\n\n * systemctl list-unit-files| grep æå¡åï¼æ¥çæå¡å¼æºå¯å¨ç¶æï¼ä½¿ç¨ grep è¿è¡è¿æ»¤ã\n * systemctl enable æå¡åï¼è®¾ç½®æå¡å¼æºèªå¯å¨ã\n * systemctl disenable æå¡åï¼å³é­æå¡å¼æºèªå¯å¨ããè¿ä¸¤æ¡æä»¤æ¯è®¾ç½®/å³é­å¨ 3 å 5 è¿è¡çº§å«ä¸çèªå¯å¨ã\n * systemctl is-enable æå¡åï¼æ¥è¯¢æä¸ªæå¡æ¯å¦å¼æºèªå¯å¨ã\n\n> æ¡ä¾ï¼æ¥çå½åé²ç«å¢çç¶åµï¼å³é­å¹¶éå¯å® => firewalld.service\n> \n>  * æ¥çç¶åµï¼\n>    \n>    systemctl status firewalld\n>    \n>    \n>    1\n>    \n>    * è¿éå firewalld æèå¨å firewalld.service åå¯\n> \n>  * å³é­é²ç«å¢ï¼systemctl stop firewalld\n> \n> ç»èè®¨è®ºï¼è¿ç§å³é­é²ç«å¢æ¯ç«å³çæï¼ä½åªæ¯ä¸´æ¶çæï¼éå¯ç³»ç»åè¿æ¯åå½ä»¥åå¯¹æå¡çè®¾ç½®ãå¦æå¸ææä¸ªæå¡èªå¯å¨æèå³é­æ°¸ä¹çæï¼è¦ä½¿ç¨ systemctl [enable|disable] æå¡åã\n\n\n# 2.7 é²ç«å¢æå¼åå³é­æå®ç«¯å£ð¶\n\nå¨çæ­£ççäº§ç¯å¢ï¼å¾å¾éè¦å°é²ç«å¢æå¼ãä½å¦ææé²ç«å¢æå¼ï¼é£ä¹å¤é¨è¯·æ±æ°æ®åå°±ä¸è½è·æå¡å¨çå¬ç«¯å£éè®¯ãè¿æ¶ï¼éè¦æå¼æå®çç«¯å£ã\n\n> é²ç«å¢çä¸ä¸ªåè½å°±æ¯å°è¯·æ±åè®¸çç«¯å£æ¾è¡ï¼ä¸åè®¸çç«¯å£è¿æ»¤æ\n\nfirewall æä»¤ï¼\n\n * æå¼ç«¯å£ï¼firewall-cmd --permanent --add-port=ç«¯å£å·/åè®®\n * å³é­ç«¯å£ï¼firewall-cmd --permanent --remove-port=ç«¯å£å·/åè®®\n * éæ°è½½å¥ï¼æè½çæï¼firewall-cmd --reload\n * æ¥è¯¢ç«¯å£æ¯å¦å¼æ¾ï¼firewall-cmd --query-port=ç«¯å£å·/åè®®\n * ç«¯å£å·ååè®®å¯ä»¥éè¿ netstat è¿è¡çå¬\n\n> æ¡ä¾ï¼\n> \n>  1. åå¯ç¨é²ç«å¢ï¼ç¶åå¨ Windows ä¸­æµè¯è¯·æ± Linux ç 111 ç«¯å£è½å¦ telnet => ä¸è½\n> \n> > telnet 192.168.200.130 111\n> æ­£å¨è¿æ¥192.168.200.130...æ æ³æå¼å°ä¸»æºçè¿æ¥ã å¨ç«¯å£ 111: è¿æ¥å¤±è´¥\n> \n> \n> 1\n> 2\n> \n>  2. å¼æ¾ 111 ç«¯å£ï¼\n> \n> $ firewall-cmd --permanent --add-port=111/tcp;\n> success\n> $ firewall-cmd --reload\n> success\n> \n> \n> 1\n> 2\n> 3\n> 4\n> \n>  3. å¨ Windows ä¸­æµè¯ telnet å°±å¯ä»¥æåäº\n>  4. å³é­ 111 ç«¯å£ï¼\n> \n> $ firewall-cmd --permanent --remove-port=111/tcp;\n> success\n> $ firewall-cmd --reload\n> success\n> \n> \n> 1\n> 2\n> 3\n> 4\n\n\n# 2.8 top å¨æçæ§è¿ç¨\n\ntop ä¸ ps å½ä»¤å¾ç¸ä¼¼ï¼å®ä»¬é½ç¨æ¥æ¾ç¤ºæ­£å¨æ§è¡çè¿ç¨ãtop ä¸ ps æå¤§çä¸åä¹å¤ï¼å¨äº top å¨æ§è¡ä¸æ®µæ¶é´å¯ä»¥æ´æ°æ­£å¨è¿è¡ççè¿ç¨ã\n\nå½ä»¤ï¼top [éé¡¹]\n\n * -dï¼æå® top å½ä»¤æ¯éå ç§æ´æ°ï¼é»è®¤ 3 ç§\n * -iï¼ä½¿ top ä¸æ¾ç¤ºä»»ä½é²ç½®æèåµæ­»è¿ç¨\n * -pï¼éè¿æå®çæ§è¿ç¨ ID æ¥ä»ä»çæ§æä¸ªè¿ç¨çç¶æ\n\n\n\n * åå­æ®µå«ä¹å¯ä»¥ç¾åº¦\n\næ§è¡ top åè¿å¥çæ§é¡µé¢ï¼è¿å¯ä»¥éè¿é®çè¾å¥ä¸ä¸æé®æ¥äº¤äºï¼\n\n * Pï¼ä»¥ CPU ä½¿ç¨çæåºï¼é»è®¤å°±æ¯æ­¤é¡¹\n * Mï¼ä»¥åå­çä½¿ç¨çæåº\n * Nï¼ä»¥ PID æåº\n * qï¼éåº top\n\n# ð æ¡ä¾ 1ï¼çè§ç¹å®ç¨æ·\n\nè¾å¥ top å½ä»¤ï¼æ¥çæ§è¡çè¿ç¨ï¼ç¶åè¾å¥ u åè½¦ï¼åè¾å¥ç¨æ·åã\n\n# ð æ¡ä¾ 2ï¼ç»æ­¢æå®çè¿ç¨\n\nè¾å¥ top å½ä»¤ï¼æ¥çæ§è¡çè¿ç¨ï¼ç¶åè¾å¥ k åè½¦ï¼åè¾å¥è¦ç»æçè¿ç¨ PID å·ã\n\n\n# 2.9 netstat çæ§ç½ç»ç¶æâ­ï¸\n\nnetstat [éé¡¹]ï¼æ¥çç³»ç»ç½ç»æåµ\n\n * -anï¼æä¸å®é¡ºåºæåè¾åº\n * -pï¼æ¾ç¤ºåªä¸ªè¿ç¨å¨è°ç¨\n\n> æ¡ä¾ï¼\n> \n>  * æ¥çæå¡åä¸º sshd æå¡çä¿¡æ¯ï¼netstat -anp|grep sshd\n> \n> > netstat å½ä»¤å¯ä»¥æ¥çå½åçç½ç»åªäºæå¡å¤äºçæ§ç¶æï¼å½åå·²æåªäºè¿æ¥ï¼æ¯å¦ TCP è¿æ¥ç ESTABLISHED å TIMEWAIT ç­ç¶æï¼ã\n\n\n# 2.10 ping æ£æµä¸»æºè¿æ¥\n\nping æ¯ä¸ç§ç½ç»æ£æµå·¥å·ï¼å®ä¸»è¦æ¯ç¨æ¥æ£æµè¿ç¨ä¸»æºæ¯å¦æ­£å¸¸ï¼ææ¯ä¸¤é¨ä¸»æºé´çç½çº¿æç½å¡æéãå¦ ping å¯¹æ¹IPå°åã\n\n\n# 3. RPM ä¸ YUM\n\n\n# 3.1 RPM åçç®¡ç\n\nrpm æ¯ç¨äºäºèç½ä¸è½½åçæååå®è£å·¥å·ï¼å®åå«å¨æäº Linux åè¡çä¸­ãå®çæå·æ.RPM æ©å±åçæä»¶ãRPM æ¯ RedHat Package Managerï¼RedHat è½¯ä»¶åç®¡çå·¥å·ï¼çç¼©åï¼ç±»ä¼¼ Windows ç setup.exeï¼è¿ä¸æä»¶æ ¼å¼åç§°è½ç¶æä¸äº RedHat çæ å¿ï¼ä½çå¿µæ¯éç¨çãLinux çåè¡çæ¬é½æéç¨ï¼RedHatï¼CentOSç­ç­ï¼ï¼å¯ä»¥ç®æ¯å¬è®¤çè¡ä¸æ åäºã\n\n# 3.1.1 rpm åçç®åæ¥è¯¢æä»¤\n\n> æ¥è¯¢æä»¤çéé¡¹æ¯ -qï¼queryï¼ï¼ç¶åååå¶ä»éé¡¹ç»åæ¥ä½¿ç¨ã\n\nrpm -qaï¼æ¥è¯¢å·²å®è£çå¨é¨ rpm è½¯ä»¶å\n\n> æ¡ä¾ï¼ççå½åç³»ç»æ¯å¦å®è£äº Firefoxï¼rpm -qa|grep firefox\n> \n> $ rpm -qa|grep firefox\n> firefox-91.5.0-1.el7.centos.x86_64\n> \n> \n> 1\n> 2\n\n# 3.1.2 rpm åååºæ¬æ ¼å¼\n\nä¸ä¸ª rpm ååï¼firefox-91.5.0-1.el7.centos.x86_64\n\n * åç§°ï¼firefox\n * çæ¬å·ï¼91.5.0-1\n * éç¨ OSï¼el7.centos.x86_64\n   * è¡¨ç¤º centos7.x ç 64 ä½ç³»ç»\n   * å¦ææ¯ i686ãi386è¡¨ç¤º32ä½ç³»ç»ï¼noarch è¡¨ç¤ºéç¨\n\n# 3.1.3 RPM åçå¶å®æ¥è¯¢æä»¤\n\n * rpm -qa | grep è½¯ä»¶ååï¼æ¥è¯¢æå®è£çæ¯å¦æè¯¥è½¯ä»¶å\n * rpm -qi è½¯ä»¶ååï¼æ¥è¯¢è½¯ä»¶åä¿¡æ¯\n * rpm -ql è½¯ä»¶ååï¼æ¥è¯¢è½¯ä»¶åä¸­çæä»¶\n * rpm -qf æä»¶å¨è·¯å¾ï¼æ¥è¯¢æä»¶æå±çè½¯ä»¶åï¼å¦rpm -qf /etc/passwd\n\n# 3.1.4 å¸è½½ rpm å\n\nrpm -e RPMåçåç§°\n\n\n1\n\n * ååä¸éè¦åå¨ç§°ï¼æ¯å¦å¸è½½ç«çåªéè¦å firefox å³å¯ã\n * e ââ erase\n\n> æ¡ä¾ï¼å é¤ firefox è½¯ä»¶åï¼rpm -e firefox\n\nç»èé®é¢\n\n * å¦æå¶å®è½¯ä»¶åä¾èµäºè¦å¸è½½çè½¯ä»¶åï¼å¸è½½æ¶åä¼äº§çéè¯¯ä¿¡æ¯ã\n * å¦æå°±æ¯è¦å é¤è¿ä¸ª rpm åï¼å¯ä»¥å¢å åæ° --nodepsï¼å°±å¯ä»¥å¼ºå¶å é¤ï¼ä½æ¯ä¸è¬ä¸æ¨èè¿æ ·åï¼å ä¸ºä¾èµäºè¯¥è½¯ä»¶åçç¨åºå¯è½æ æ³è¿è¡ã\n\n# 3.1.5 å®è£ rpm å\n\nrpm -ivh RPMåå¨è·¯å¾åç§°\n\n\n1\n\n * -iï¼installï¼å®è£\n * -vï¼verboseï¼æç¤º\n * -hï¼hashï¼è¿åº¦æ¡\n\n> æ¡ä¾ï¼å¸è½½åå®è£ Firefox æµè§å¨\n> \n>  * å¸è½½ï¼rpm -e firefox\n>  * å®è£ï¼rpm -ivh firefoxçrpmå®è£å\n>  * rpmå®è£åçä½ç½®ï¼åçç Package æä»¶å¤¹ä¸­æ¾å°å¯¹åºçåï¼copy å°æ¬å°ç®å½ä¸­ï¼è¿è¡å®è£ã\n\n\n# 3.2 yum\n\nYUM æ¯ä¸ä¸ª Shell åç«¯è½¯ä»¶åç®¡çå¨ãåºäº RPM åç®¡çï¼è½å¤ä»æå®çæå¡å¨èªå¨ä¸è½½ RPM åå¹¶ä¸å®è£ï¼å¯ä»¥èªå¨å¤çä¾èµæ§å³ç³»ï¼å¹¶ä¸ä¸æ¬¡å®è£ææä¾èµçè½¯ä»¶åãä½¿ç¨ YUM çåææ¯å¯ä»¥èç½ã\n\n> å¾å mavenãç¸å½äº Ubuntu ç aptã\n\n * æ¥è¯¢ YUM æå¡å¨æ¯å¦æéè¦å®è£çè½¯ä»¶ï¼yum list | grep è½¯ä»¶å\n * å®è£æå®ç yum åï¼yum install è½¯ä»¶å\n\n> æ¡ä¾ï¼ä½¿ç¨ yum çæ¹å¼æ¥å®è£ firefox\n> \n>  * å é¤ Firefoxï¼rpm -e firefox\n>  * æ¥è¯¢ Firefoxï¼yum install | grep firefox\n>  * å®è£ï¼yum install firefox',normalizedContent:'# 1. ç½ç»éç½®\n\n\n# 1.1 linux ç½ç»éç½®åç\n\nåè®¾æä»¬çç©çä¸»æºå¨ä¸ä¸ªæå®¤çå±åç½åï¼\n\n * linux èææºå vmnet8 å¨ä¸ä¸ªå­ç½åå½¢æä¸ä¸ªç½ç»ï¼å¯ä»¥äºéï¼ping éï¼\n * æ¬æºçµèçæ çº¿ç½å¡ä¸æå®¤å±åç½çç½å³äºéï¼vmnet8 ååæ çº¿ç½å¡äºé\n * èé©è®²éäºï¼vmnet8 ä¸æ¯èææºçç½å³ï¼åªæ¯ç¨æ¥èææºåå®ä½æºéè®¯çï¼æ vmnet8 ç¦ç¨äºèææºä¹å¯ä»¥è¿æ¥äºèç½ã\n\n\n# 1.2 æ¥çç½ç» ip åç½å³\n\n# 1.2.1 æ¥çèææº ip\n\nå¨ linux ä¸­ç ifconfig å¯ä»¥çå°æ¬æºç ipï¼\n\n$ ifconfig\nens33: flags=4163<up,broadcast,running,multicast>  mtu 1500\n        inet 192.168.220.134  netmask 255.255.255.0  broadcast 192.168.220.255\n        inet6 fe80::c84d:947f:c9c3:2aa3  prefixlen 64  scopeid 0x20<link>\n        ether 00:0c:29:f9:c5:14  txqueuelen 1000  (ethernet)\n        rx packets 142  bytes 14858 (14.5 kib)\n        rx errors 0  dropped 0  overruns 0  frame 0\n        tx packets 130  bytes 17101 (16.7 kib)\n        tx errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯ä»¥çå° linux èææºç ip ä¸º 192.168.220.134ã\n\n# 1.2.2 æ¥çç½ç»ç¼è¾å¨åç½å³\n\nå¨ vmware çèæç½ç»ç¼è¾å¨ä¸­ï¼å¯ä»¥çå° nat è¿æ¥æ¹å¼ä¸æ¬æºçå­ç½ ipï¼\n\n\n\nç¶åå¨ç¹å» nat è®¾ç½® å¯ä»¥çå°ç½å³ï¼\n\n\n\n# 1.2.3 æ¥ç windows ç¯å¢ä¸­ç vmnet8 ç½ç»éç½®\n\nä½¿ç¨ ipconfig å½ä»¤ï¼\n\n> ipconfig\n...\nä»¥å¤ªç½ééå¨ vmware network adapter vmnet8:\n\n   è¿æ¥ç¹å®ç dns åç¼ . . . . . . . :\n   æ¬å°é¾æ¥ ipv6 å°å. . . . . . . . : fe80::c823:6a37:c475:ed49%24\n   ipv4 å°å . . . . . . . . . . . . : 192.168.220.1\n   å­ç½æ©ç   . . . . . . . . . . . . : 255.255.255.0\n   é»è®¤ç½å³. . . . . . . . . . . . . :\n...\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 1.3 ping æµè¯è¿éæ§\n\nping ç®çä¸»æºï¼æµè¯å½åæå¡å¨æ¯å¦å¯ä»¥è¿æ¥ç®çä¸»æº\n\n> æµè¯æ¯å¦å¯ä»¥è¿æ¥ç¾åº¦ï¼ping www.baidu.com\n\n\n# 1.4 linux ç½ç»ç¯å¢éç½®\n\n# 1.4.1 ç¬¬ä¸ç§æ¹æ³ï¼èªå¨è·å\n\nç»å½åï¼éè¿çé¢æ¥è®¾ç½®èªå¨è·å ipãç¹ç¹ï¼linux å¯å¨åä¼èªå¨è·å ipï¼ä½æ¯æ¬¡èªå¨è·åç ip å°åå¯è½ä¸ä¸æ ·ã\n\n\n\n# 1.4.2 ç¬¬äºç§æ¹æ³ï¼æå® ip â­ï¸\n\nç´æ¥ä¿®æ¹éç½®æä»¶æ¥æå® ipï¼å¹¶å¯ä»¥è¿æ¥å°å¤ç½ï¼ç¨åºåæ¨èï¼ã\n\néç½®æä»¶æ ¹æ®ç½å¡ä¸ååå­ææåºå«ï¼ä½æä»¶è·¯å¾ä¸è´ï¼/etc/sysconfig/network-scripts/ï¼å¸¸è§çéç½®æä»¶åæ ifcfg-eth0 æè ifcfg-ens33ï¼å¯ä»¥éè¿ ifconfig æ¥çåç¼ã\n\nä»¥ ifcfg-ens33 ä¸ºä¾ï¼ä½¿ç¨ vim ä¿®æ¹æ­¤æä»¶ vim /etc/sysconfig/network-scripts/ifcfg-ens33ï¼\n\nype="ethernet"\nproxy_method="none"\nbrowser_only="no"\n- bootproto="dhcp"\n+ bootproto="static"\ndefroute="yes"\nipv4_failure_fatal="no"\nipv6init="yes"\nipv6_autoconf="yes"\nipv6_defroute="yes"\nipv6_failure_fatal="no"\nipv6_addr_gen_mode="stable-privacy"\nname="ens33"\nuuid="1af88ac9-573c-49da-993c-9ab4e6c73159"\ndevice="ens33"\nonboot="yes"\n+ ipaddr=192.168.200.130 # æ¬æº ip å°å\n+ netmask=255.255.255.0 # å­ç½æ©ç \n+ gateway=192.168.200.2 # é»è®¤ç½å³\n+ dns1=192.168.200.2 # ååè§£æå¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä¿®æ¹å¥½åå¹¶ä¿å­ãç¶åè¿å¥ vmware çèæç½ç»ç¼è¾å¨ï¼å° nat éç½®ä¸­çå­ç½ ip æ¹ä¸º 192.168.200.0ï¼å°ç½å³ ip æ¹ä¸º 192.168.200.2ãä¿®æ¹ä½ç½®å¯è§æ¬æç 1.2.2 èæç¤ºã\n\nå®æä»¥ä¸æä½åï¼éå¯ç½ç»æå¡æéå¯ç³»ç»çæï¼\n\nservice network restartãreboot\n\n\n1\n\n\nä»¥ä¸è¿äºæä½å°±æ¯å°æ¬æ 1.1 èå¾ä¸­ç linux èææºå vmnet8 çå°ååå«æ¹æäº 192.168.200.130 å 192.168.200.1ãè¿æ¶å¨èææºä¸­ä½¿ç¨ ifconfig å½ä»¤å¯ä»¥çå°ï¼\n\n$ ifconfig\nens33: flags=4163<up,broadcast,running,multicast>  mtu 1500\n        inet 192.168.200.130  netmask 255.255.255.0  broadcast 192.168.200.255\n        inet6 fe80::c84d:947f:c9c3:2aa3  prefixlen 64  scopeid 0x20<link>\n        ether 00:0c:29:f9:c5:14  txqueuelen 1000  (ethernet)\n        rx packets 792  bytes 825124 (805.7 kib)\n        rx errors 0  dropped 0  overruns 0  frame 0\n        tx packets 456  bytes 33428 (32.6 kib)\n        tx errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n * æ¬æº ip å·²ç»æåæ¹ä¸ºäº 192.168.200.130ã\n\n\n# 1.5 è®¾ç½®ä¸»æºåå hosts æ å°\n\n# 1.5.1 è®¾ç½®ä¸»æºå\n\nä¸ºäºæ¹ä¾¿è®°å¿ï¼å¯ä»¥ç» linux ç³»ç»è®¾ç½®ä¸»æºåï¼ä¹å¯ä»¥æ ¹æ®éè¦ä¿®æ¹ä¸»æºåã\n\næä»¤ hostnameï¼æ¥çä¸»æºå\n\nä¿®æ¹æä»¶å¨ /etc/hostname æå®ãä¿®æ¹åéå¯çæã\n\n# 1.5.2 è®¾ç½® hosts æ å°\n\næèï¼å¦ä½éè¿ä¸»æºåè½å¤æ¾å°ï¼æ¯å¦ pingï¼æä¸ª linux ç³»ç»ï¼\n\nhostsï¼ä¸ä¸ªè®°å½ ip å hostname ä¹é´æ å°å³ç³»çææ¬æä»¶ã\n\nâï¸ windows ä¸­ï¼å¨ c:\\windows\\system32\\drivers\\etc\\hosts æä»¶æå®å³å¯ã\n\n> æ¡ä¾ï¼192.168.200.130 hspedu100\n> \n>  * ååé¨åæ¯ ip å°åï¼ååé¨åæ¯å¶å¯¹åºçä¸»æºå\n> \n> psï¼è¿æä¸ä¸ªå¸¸è§çæ¡ä¾æ¯ 127.0.0.1 localhost\n\nâï¸ linux ä¸­ï¼å¨ /etc/hosts æä»¶æå®å³å¯ã\n\n> æ¡ä¾ï¼192.168.200.1 thinkpad-pc\n\n\n# 1.6 åºç¨å®ä¾ï¼æµè§å¨è§£æ www.baidu.com çè¿ç¨\n\n 1. æµè§å¨åæ£æ¥æµè§å¨ä¸­ææ²¡æè¯¥ååè§£æ ipï¼æå°±åè°ç¨è¿ä¸ª ip å®æè§£æãå¦ææ²¡æï¼å°±åæ£æ¥ dns è§£æå¨ç¼å­ï¼å¦ææå°±ç´æ¥è¿å ip å®æè§£æãè¿ä¸¤ä¸ªç¼å­å¯ä»¥çè§£ä¸ºæ¬å°è§£æå¨ç¼å­ã\n 2. ä¸è¬æ¥è¯´ï¼å½çµèç¬¬ä¸æ¬¡æåè®¿é®æä¸ä¸ªç½ç«åï¼å¨ä¸å®æ¶é´åæµè§å¨æ os ä¼ç¼å­å®ç dns è§£æè®°å½ã\n\nipconfig /displaydns  // æ¥ç dns ååè§£æç¼å­\nipconfig /flushdns    // æå¨æ¸ç dns ç¼å­\n\n\n1\n2\n\n 1. å¦ææ¬å°è§£æå¨ç¼å­æ²¡ææ¾å°å¯¹åºçæ å°ï¼å°±æ£æ¥ç³»ç»ä¸­ hosts æä»¶ä¸­ææ²¡æå¯¹åºçåå ip æ å°ï¼æåå®æè§£æå¹¶è¿åã\n 2. å¦ææ¬å° dns è§£æå¨ç¼å­å hosts æä»¶é½æ²¡è½è§£æåºå¯¹åºç ipï¼åå°ååæå¡ dns è¿è¡è§£æåã\n\n\n\n\n# 2. è¿ç¨ç®¡çâ­ï¸\n\n\n# 2.1 åºæ¬ä»ç»\n\nå¨ linux ä¸­ï¼æ¯ä¸ªæ§è¡çç¨åºï¼ä»£ç ï¼é½ç§°ä¸ºä¸ä¸ªè¿ç¨ãæ¯ä¸ä¸ªè¿ç¨é½åéä¸ä¸ª id å·ï¼å³è¿ç¨å·ï¼pidã\n\n> ç¨åºåè¿ç¨ï¼ç¨åº==ä»£ç ï¼æ¯éææ¦å¿µï¼è¿ç¨æ¯è¿è¡èµ·æ¥çå ç¨åå­çç¨åºã\n\næ¯ä¸ªè¿ç¨é½å¯è½ä»¥ä¸¤ç§æ¹å¼å­å¨çï¼åå°ä¸åå°ãæè°åå°è¿ç¨å°±æ¯ç¨æ·ç®åçå±å¹ä¸å¯ä»¥è¿è¡æä½çãåå°è¿ç¨åæ¯å®éå¨æä½ï¼ä½ç±äºå±å¹ä¸æ æ³çå°çè¿ç¨ï¼éå¸¸ä½¿ç¨åå°æ¹å¼æ§è¡ã\n\nä¸è¬ç³»ç»çæå¡é½æ¯ä»¥åå°è¿ç¨çæ¹å¼å­å¨ï¼èä¸é½ä¼å¸¸é©»å¨ç³»ç»ä¸­ï¼ç´å°å³æºææç»æã\n\n\n# 2.2 ps æ¾ç¤ºç³»ç»æ§è¡çè¿ç¨\n\n# 2.2.1 ps å½ä»¤\n\nps å½ä»¤æ¯ process status çç¼©åï¼ç¨æ¥ååºç³»ç»ä¸­å½åæ­£å¨è¿è¡çé£äºè¿ç¨ï¼å°±æ¯æ§è¡ ps å½ä»¤çé£ä¸ªæ¶å»çé£äºè¿ç¨çå¿«ç§ã\n\n> ps æ¥ççç»æä¸æ¯å¨æè¿ç»­çï¼å¦ææ³è¦å¨æçæ¾ç¤ºè¿ç¨ä¿¡æ¯ï¼å°±å¯ä»¥ä½¿ç¨ topãhtop å½ä»¤ã\n\n$ ps\n   pid tty          time cmd\n  2149 pts/0    00:00:00 zsh\n  2228 pts/0    00:00:00 ps\n\n\n1\n2\n3\n4\n\n * ps æ¾ç¤ºçä¿¡æ¯å­æ®µï¼\n   * pidï¼è¿ç¨è¯å«å·\n   * ttyï¼ç»ç«¯æºå·\n   * timeï¼è¿ç¨ä½¿ç¨ cpu çæ»æ¶é´\n   * cmdï¼æ­£å¨æ§è¡çå½ä»¤æè¿ç¨å\n * å¸¸ç¨éé¡¹ï¼\n   * -aï¼æ¾ç¤ºå½åç»ç«¯çææè¿ç¨ä¿¡æ¯\n   * -uï¼ä»¥ç¨æ·çæ ¼å¼æ¾ç¤ºè¿ç¨ä¿¡æ¯\n   * -xï¼æ¾ç¤ºåå°è¿ç¨è¿è¡çåæ°\n\n> å¸¸è§æåµä¸æ¯ ps -aux | more ä¸ä¸ªéé¡¹ä¸åç¨ï¼å¹¶åé¡µæ¥ç\n\n# 2.2.2 ps è¯¦è§£\n\nè¾å¥ ps -aux|more åå¯ä»¥çå°ï¼\n\n\n\n * userï¼ç¨æ·åç§°\n * %cpuï¼è¿ç¨å ç¨ cpu ç¾åæ¯\n * %memï¼è¿ç¨å ç¨ç©çåå­çç¾åæ¯\n * vszï¼è¿ç¨å ç¨çèæåå­å¤§å°ï¼åä½ kbï¼\n * rssï¼è¿ç¨å ç¨çç©çåå­å¤§å°ï¼åä½ kbï¼\n * ttyï¼ç»ç«¯åç§°ï¼ç¼©å\n * statï¼è¿ç¨ç¶æãs ç¡ç ï¼s è¡¨ç¤ºè¯¥è¿ç¨æ¯ä¼è¯çåå¯¼è¿ç¨ï¼n è¡¨ç¤ºè¯¥è¿ç¨æ¥ææ¯æ®éä¼åçº§æ´ä½çä¼åçº§ï¼r æ­£å¨è¿è¡ï¼d ç­æç­å¾ï¼z åµæ­»è¿ç¨ï¼t è¢«è·è¸ªæè¢«åæ­¢ç­\n * startï¼è¿ç¨çå¯å¨æ¶é´\n * timeï¼è¿ç¨ä½¿ç¨ cpu çæ»æ¶é´\n * commandï¼å¯å¨è¿ç¨æç¨çå½ä»¤ååæ°ï¼å¦æè¿é¿ä¼è¢«æªæ­æ¾ç¤º\n\nä½æ¯ç´æ¥ ps ä¼æ¾ç¤ºå¤ªå¤çè¿ç¨äºï¼å¦ææ³çææ²¡ææä¸ªè¿ç¨ï¼å¯ä»¥ç¨ ps -aux|grep xxxã\n\n# 2.2.3 åºç¨å®ä¾\n\nè¦æ±ï¼ä»¥å¨æ ¼å¼æ¾ç¤ºå½åææçè¿ç¨ï¼æ¥çè¿ç¨çç¶è¿ç¨\n\nps -efï¼ä»¥å¨æ ¼å¼æ¥çç³»ç»ä¸çè¿è¡çææè¿ç¨ ãå¸¸ç¨ã\n\n * -eï¼æ¾ç¤ºè¿è¡å¨ç³»ç»ä¸çææè¿ç¨\n * -fï¼å¨æ ¼å¼ï¼å³æ©å±æ¾ç¤ºè¾åº\n\n\n\n * c å­æ®µæ¯ cpu ç¨äºè®¡ç®æ§è¡ä¼åçº§çå å­ãæ°å¼è¶å¤§ï¼è¡¨æè¿ç¨æ¯ cpu å¯éåè¿ç®ï¼æ§è¡çä¼åçº§ä¼éä½ï¼æ°å¼è¶å°ï¼è¡¨æè¿ç¨æ¯ io å¯éåè¿ç®ï¼æ§è¡ä¼åçº§ä¼æé«ã\n * ppidï¼ç¶è¿ç¨ç pid\n\n\n# 2.3 kill å killall\n\n> è¿é¨åå¨ csapp ä¸­æè®²è§£\n\nkill å½ä»¤ä¼åæä½ç³»ç»åæ ¸åéä¸ä¸ªä¿¡å·ï¼å¤æ¯ç»æ­¢ä¿¡å·ï¼åç®æ è¿ç¨ç pidï¼ç¶åç³»ç»åæ ¸æ ¹æ®æ¶å°çä¿¡å·ç±»åï¼å¯¹æå®è¿ç¨è¿è¡ç¸åºçæä½ãé¢è®¾çä¿¡æ¯ä¸º sigterm(15)ï¼å¯å°æå®ç¨åºç»æ­¢ã\n\nè¿éåªè®²ç¨ kill å½ä»¤ç»æ­¢è¿ç¨ï¼\n\n * kill [éé¡¹] è¿ç¨å·ï¼ç»æ­¢è¿ç¨\n * killall è¿ç¨åç§°ï¼éè¿è¿ç¨åç§°ææ­»è¿ç¨ï¼åå¶å­è¿ç¨ï¼ï¼ä¹æ¯æééç¬¦ï¼è¿å¨ç³»ç»å è´è½½è¿å¤§èåå¾å¾æ¢æ¶å¾æç¨ãæ­¤å½ä»¤ä¼æå¯¹åºè¿ç¨çææå­è¿ç¨é½ææã\n\nå¸¸ç¨éé¡¹ï¼\n\n * -9ï¼è¡¨ç¤ºå¼ºè¿«è¿ç¨ç«å³ç»æ­¢\n\n# ð æ¡ä¾ 1ï¼è¸¢ææä¸ªéæ³ç¨æ·\n\næä»¬åè®©ç¨æ· fox ç»å½ï¼ç¶å root ä¸è¾å¥ ps -aux | grep sshdï¼å¯ä»¥çå°ï¼\n\n$ ps -aux | grep sshd\nroot       1462  0.0  0.2 112984  4324 ?        ss   12:24   0:00 /usr/sbin/sshd -d\nroot       2140  0.0  0.2 161072  5584 ?        ss   12:24   0:00 sshd: yubin [priv]\nyubin      2148  0.0  0.1 161072  2556 ?        s    12:24   0:00 sshd: yubin@pts/0\nroot       2900  0.3  0.2 161080  5584 ?        ss   13:22   0:00 sshd: fox [priv]\nfox        2907  0.0  0.1 161080  2560 ?        s    13:22   0:00 sshd: fox@pts/1\nroot       3006  0.0  0.0 112828   984 pts/0    s+   13:23   0:00 grep --color=auto sshd\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¯ä»¥çå° fox ç»å½çæ¶åï¼æ¯éè¿è¿ç¨ 2900 ç»å½çï¼äºæ¯æä»¬ kill 2900 åå¯ä»¥çå° fox ç¨æ·è¢«è¸¢æã\n\n# ð æ¡ä¾ 2ï¼ç»æ­¢è¿ç¨ç»å½æå¡ sshdï¼å¹¶å¨éå½æ¶ååæ¬¡éå¯ sshd æå¡\n\nç±»ä¼¼äºæ¡ä¾1ï¼å¨æ¡ä¾ 1 çè¾åºä¸­å¯ä»¥çå°ï¼sshd æå¡ï¼/usr/sbin/sshd -d å¯å¨çè¿ç¨ï¼çè¿ç¨å·æ¯ 1462ï¼æä»¥ kill 1462 å³å¯ç»æ­¢ sshd æå¡ãç»æ­¢åä¼åç°å«çç¨æ·æ æ³åè¿ç¨ç»å½ã\n\nç»æ­¢ sshd åï¼éè¿ /bin/systemctl start sshd.service å³å¯éå¯è¯¥æå¡ã\n\n# ð æ¡ä¾ 3ï¼ç»æ­¢å¤ä¸ª gedit\n\nåå¨å¾å½¢åçé¢ä¸ç¨ gedit æå¼å¤ä¸ªææ¬ç¼è¾é¡µé¢ï¼ç¶å killall gedit å³å¯ä¸æ¬¡æ§å³é­å¨é¨ã\n\n# ð æ¡ä¾ 4ï¼å¼ºå¶ææä¸ä¸ªç»ç«¯\n\nåå¼ä¸ä¸ª bash ç»ç«¯ï¼ç¶å ps -aux|grep bash å³å¯çå°ææç bash è¿ç¨ï¼æ¾å°è¦ææ­»ç bash è¿ç¨å· xxxxï¼ç¶åä½¿ç¨ kill -9 bashå¯¹åºçè¿ç¨å· å³å¯ææ­»ã\n\n * å ä¸ -9 éé¡¹æ¯å ä¸ºå¦æä¸å çè¯ï¼ç³»ç»ä¼è®¤ä¸ºç±äºè¦è¢« kill ç bash æ­£å¨å·¥ä½ï¼èè®¤ä¸ºä½ ç kill æ¯ä¸ä¸ªè¯¯æä½ï¼ä»èç½®ä¹ä¸çï¼åªæå äº -9 æä¼å¼ºå¶ææã\n\n\n# 2.4 pstree æ¥çè¿ç¨æ \n\npstree [éé¡¹]ï¼å¯ä»¥æ´å ç´è§çæ¥çè¿ç¨ä¿¡æ¯ã\n\n * -pï¼æ¾ç¤ºè¿ç¨ç pid\n * -uï¼æ¾ç¤ºè¿ç¨çæå±ç¨æ·\n\n> æ¡ä¾ï¼\n> \n>  * pstree -pï¼æ ç¶çå½¢å¼æ¾ç¤ºè¿ç¨ç pidã\n>  * pstree -uï¼æ ç¶çå½¢å¼æ¾ç¤ºè¿ç¨çç¨æ·\n\n\n# 2.5 æå¡ï¼serviceï¼ç®¡ç\n\næå¡æ¬è´¨å°±æ¯è¿ç¨ï¼ä½æ¯æ¯è¿è¡å¨åå°çï¼éå¸¸é½ä¼çå¬æä¸ªç«¯å£ï¼ç­å¾å¶å®ç¨åºçè¯·æ±ï¼æ¯å¦(mysqlãsshdãé²ç«å¢ç­)ï¼å æ­¤æä»¬åç§°ä¸ºå®æ¤è¿ç¨ã\n\nè¯·æ±æä¸ªç«¯å£æ¶ï¼æ¬è´¨æ¯è¯·æ±çå¬è¯¥ç«¯å£çå®æ¤è¿ç¨ãæ¯å¦ï¼mysqld æå¡å¸¸çå¬ 3306 ç«¯å£ï¼sshd æå¡å¸¸çå¬ 22 ç«¯å£ã\n\n# 2.5.1 service ç®¡çæä»¤\n\nservice æå¡å [start | stop | restart | reload | status]\n\n\n1\n\n * å¨ centos 7.0 å ä¸åä½¿ç¨ service ,èæ¯ systemctlï¼åé¢ä¸é¨ä»ç»ï¼\n * service æä»¤ç®¡ççæå¡å¨ /etc/init.d æ¥çï¼å³ ls -l /etc/init.d å½ä»¤ã\n\n> æ¡ä¾ï¼\n> \n>  * æ¥çç½ç»ï¼service network status\n>  * å³é­ç½ç»ï¼service network stop\n>  * å¯å¨ç½ç»ï¼service network start\n\n# 2.5.2 æ¥çæå¡å\n\nâï¸ æ¹å¼ä¸ï¼æ§è¡å½ä»¤ setup -> ç³»ç»æå¡ å°±å¯ä»¥çå°å¨é¨ï¼\n\n\n\n * å¸¦æå·çæ¯å¼æºèªå¯å¨çæå¡\n * å¯ä»¥éè¿å½ä»¤ sevice æ systemctl å¯å¨ã\n\nâï¸ æ¹å¼äºï¼è¿è¡ ls -l /etc/init.d æ¥ç service æä»¤ç®¡ççæå¡ã\n\n# 2.5.3 æå¡çè¿è¡çº§å«\n\nlinux ç³»ç»æ7ç§è¿è¡çº§å«ï¼runlevelï¼ï¼å¸¸ç¨çæ¯çº§å« 3 å 5ã\n\n * è¿è¡çº§å« 0ï¼ç³»ç»åæºç¶æï¼ç³»ç»é»è®¤è¿è¡çº§å«ä¸è½è®¾ä¸º0ï¼å¦åä¸è½æ­£å¸¸å¯å¨ã\n * è¿è¡çº§å« 1ï¼åç¨æ·å·¥ä½ç¶æï¼root æéï¼ç¨äºç³»ç»ç»´æ¤ï¼ç¦æ­¢è¿ç¨ç»éã\n * è¿è¡çº§å« 2ï¼å¤ç¨æ·ç¶æ(æ²¡æ nfs)ï¼ä¸æ¯æç½ç»ã\n * ðºè¿è¡çº§å« 3ï¼å®å¨çå¤ç¨æ·ç¶æ(æ nfs)ï¼æ çé¢ï¼ç»éåè¿å¥æ§å¶å°å½ä»¤è¡æ¨¡å¼ããå·¥ä½å¸¸ç¨ã\n * è¿è¡çº§å« 4ï¼ç³»ç»æªä½¿ç¨ï¼ä¿çã\n * è¿è¡çº§å« 5ï¼x11 æ§å¶å°ï¼ç»éåè¿å¥å¾å½¢ gui æ¨¡å¼\n * è¿è¡çº§å« 6ï¼ç³»ç»æ­£å¸¸å³é­å¹¶éå¯ï¼é»è®¤è¿è¡çº§å«ä¸è½è®¾ä¸º6ï¼å¦åä¸è½æ­£å¸¸å¯å¨ã\n\nå¼æºçæµç¨è¯´æï¼å¼æº -> bios -> /boot -> systemd è¿ç¨ 1ï¼ææè¿ç¨çèç¥å®ï¼-> ç¡®å®è¿è¡çº§å« -> å¯å¨è¿è¡çº§å¯¹åºçæå¡\n\n# 2.5.4 centos 7 åè¿è¡çº§å«è¯´æ\n\nå¨ /etc/initab è¿è¡äºç®åï¼multi-user.target ç­åäºè¿è¡çº§å« 3ï¼graphical.target ç­åäºè¿è¡çº§å« 5ã\n\n * å½ä»¤ systemctl get-defaultï¼è·åå½åçè¿è¡çº§å«\n * å½ä»¤ systemctl set-default multi-user.targetï¼å°é»è®¤è¿è¡çº§å«è®¾ç½®ä¸º mulit-user\n\n# 2.5.5 chkconfig æä»¤\n\nchkconfig å½ä»¤ç¨äºæ£æ¥ï¼è®¾ç½®ç³»ç»çåç§æå¡ãéè¿ chkconfig å½ä»¤å¯ä»¥ç»æ¯ä¸ªæå¡çåä¸ªè¿è¡çº§å«è®¾ç½®âèªå¯å¨â/âå³é­âï¼æ­¤å¤çæå¡æ¯æ service æä»¤ç®¡ççæå¡ï¼å¨ /etc/init.d æ¥çï¼å³ ls -l /etc/init.d å½ä»¤ã\n\nå¨ centos 7.0ä¹åï¼å¾å¤æå¡ä½¿ç¨ systemctl ç®¡çã\n\nåºæ¬è¯­æ³ï¼\n\n * æ¥çæå¡ï¼chkconfig --list | grep æå¡å\n * chkconfig --level 5 æå¡å on/offï¼å°æä¸ä¸ªæå¡å¨ç¹å®çº§å«ä¸è®¾ç½®ä¸ºâèªå¯å¨â/âå³é­â\n\nchkconfig éæ°è®¾ç½®æå¡èªå¯å¨æå³é­åï¼éè¦éå¯æºå¨æè½çæã\n\n\n# 2.6 systemctl å½ä»¤ð¶\n\n> systemctlï¼system ctl\n\n# 2.6.1 systemctl ç®¡çæä»¤\n\nå½ä»¤ï¼systemctl [start | stop | restart | status] æå¡å\n\n * systemctl æä»¤ç®¡ççæå¡å¨ /usr/lib/systemd/system ç®å½æ¥ç\n\n# 2.6.2 systemctl è®¾ç½®æå¡èªå¯å¨ç¶æ\n\n * systemctl list-unit-files| grep æå¡åï¼æ¥çæå¡å¼æºå¯å¨ç¶æï¼ä½¿ç¨ grep è¿è¡è¿æ»¤ã\n * systemctl enable æå¡åï¼è®¾ç½®æå¡å¼æºèªå¯å¨ã\n * systemctl disenable æå¡åï¼å³é­æå¡å¼æºèªå¯å¨ããè¿ä¸¤æ¡æä»¤æ¯è®¾ç½®/å³é­å¨ 3 å 5 è¿è¡çº§å«ä¸çèªå¯å¨ã\n * systemctl is-enable æå¡åï¼æ¥è¯¢æä¸ªæå¡æ¯å¦å¼æºèªå¯å¨ã\n\n> æ¡ä¾ï¼æ¥çå½åé²ç«å¢çç¶åµï¼å³é­å¹¶éå¯å® => firewalld.service\n> \n>  * æ¥çç¶åµï¼\n>    \n>    systemctl status firewalld\n>    \n>    \n>    1\n>    \n>    * è¿éå firewalld æèå¨å firewalld.service åå¯\n> \n>  * å³é­é²ç«å¢ï¼systemctl stop firewalld\n> \n> ç»èè®¨è®ºï¼è¿ç§å³é­é²ç«å¢æ¯ç«å³çæï¼ä½åªæ¯ä¸´æ¶çæï¼éå¯ç³»ç»åè¿æ¯åå½ä»¥åå¯¹æå¡çè®¾ç½®ãå¦æå¸ææä¸ªæå¡èªå¯å¨æèå³é­æ°¸ä¹çæï¼è¦ä½¿ç¨ systemctl [enable|disable] æå¡åã\n\n\n# 2.7 é²ç«å¢æå¼åå³é­æå®ç«¯å£ð¶\n\nå¨çæ­£ççäº§ç¯å¢ï¼å¾å¾éè¦å°é²ç«å¢æå¼ãä½å¦ææé²ç«å¢æå¼ï¼é£ä¹å¤é¨è¯·æ±æ°æ®åå°±ä¸è½è·æå¡å¨çå¬ç«¯å£éè®¯ãè¿æ¶ï¼éè¦æå¼æå®çç«¯å£ã\n\n> é²ç«å¢çä¸ä¸ªåè½å°±æ¯å°è¯·æ±åè®¸çç«¯å£æ¾è¡ï¼ä¸åè®¸çç«¯å£è¿æ»¤æ\n\nfirewall æä»¤ï¼\n\n * æå¼ç«¯å£ï¼firewall-cmd --permanent --add-port=ç«¯å£å·/åè®®\n * å³é­ç«¯å£ï¼firewall-cmd --permanent --remove-port=ç«¯å£å·/åè®®\n * éæ°è½½å¥ï¼æè½çæï¼firewall-cmd --reload\n * æ¥è¯¢ç«¯å£æ¯å¦å¼æ¾ï¼firewall-cmd --query-port=ç«¯å£å·/åè®®\n * ç«¯å£å·ååè®®å¯ä»¥éè¿ netstat è¿è¡çå¬\n\n> æ¡ä¾ï¼\n> \n>  1. åå¯ç¨é²ç«å¢ï¼ç¶åå¨ windows ä¸­æµè¯è¯·æ± linux ç 111 ç«¯å£è½å¦ telnet => ä¸è½\n> \n> > telnet 192.168.200.130 111\n> æ­£å¨è¿æ¥192.168.200.130...æ æ³æå¼å°ä¸»æºçè¿æ¥ã å¨ç«¯å£ 111: è¿æ¥å¤±è´¥\n> \n> \n> 1\n> 2\n> \n>  2. å¼æ¾ 111 ç«¯å£ï¼\n> \n> $ firewall-cmd --permanent --add-port=111/tcp;\n> success\n> $ firewall-cmd --reload\n> success\n> \n> \n> 1\n> 2\n> 3\n> 4\n> \n>  3. å¨ windows ä¸­æµè¯ telnet å°±å¯ä»¥æåäº\n>  4. å³é­ 111 ç«¯å£ï¼\n> \n> $ firewall-cmd --permanent --remove-port=111/tcp;\n> success\n> $ firewall-cmd --reload\n> success\n> \n> \n> 1\n> 2\n> 3\n> 4\n\n\n# 2.8 top å¨æçæ§è¿ç¨\n\ntop ä¸ ps å½ä»¤å¾ç¸ä¼¼ï¼å®ä»¬é½ç¨æ¥æ¾ç¤ºæ­£å¨æ§è¡çè¿ç¨ãtop ä¸ ps æå¤§çä¸åä¹å¤ï¼å¨äº top å¨æ§è¡ä¸æ®µæ¶é´å¯ä»¥æ´æ°æ­£å¨è¿è¡ççè¿ç¨ã\n\nå½ä»¤ï¼top [éé¡¹]\n\n * -dï¼æå® top å½ä»¤æ¯éå ç§æ´æ°ï¼é»è®¤ 3 ç§\n * -iï¼ä½¿ top ä¸æ¾ç¤ºä»»ä½é²ç½®æèåµæ­»è¿ç¨\n * -pï¼éè¿æå®çæ§è¿ç¨ id æ¥ä»ä»çæ§æä¸ªè¿ç¨çç¶æ\n\n\n\n * åå­æ®µå«ä¹å¯ä»¥ç¾åº¦\n\næ§è¡ top åè¿å¥çæ§é¡µé¢ï¼è¿å¯ä»¥éè¿é®çè¾å¥ä¸ä¸æé®æ¥äº¤äºï¼\n\n * pï¼ä»¥ cpu ä½¿ç¨çæåºï¼é»è®¤å°±æ¯æ­¤é¡¹\n * mï¼ä»¥åå­çä½¿ç¨çæåº\n * nï¼ä»¥ pid æåº\n * qï¼éåº top\n\n# ð æ¡ä¾ 1ï¼çè§ç¹å®ç¨æ·\n\nè¾å¥ top å½ä»¤ï¼æ¥çæ§è¡çè¿ç¨ï¼ç¶åè¾å¥ u åè½¦ï¼åè¾å¥ç¨æ·åã\n\n# ð æ¡ä¾ 2ï¼ç»æ­¢æå®çè¿ç¨\n\nè¾å¥ top å½ä»¤ï¼æ¥çæ§è¡çè¿ç¨ï¼ç¶åè¾å¥ k åè½¦ï¼åè¾å¥è¦ç»æçè¿ç¨ pid å·ã\n\n\n# 2.9 netstat çæ§ç½ç»ç¶æâ­ï¸\n\nnetstat [éé¡¹]ï¼æ¥çç³»ç»ç½ç»æåµ\n\n * -anï¼æä¸å®é¡ºåºæåè¾åº\n * -pï¼æ¾ç¤ºåªä¸ªè¿ç¨å¨è°ç¨\n\n> æ¡ä¾ï¼\n> \n>  * æ¥çæå¡åä¸º sshd æå¡çä¿¡æ¯ï¼netstat -anp|grep sshd\n> \n> > netstat å½ä»¤å¯ä»¥æ¥çå½åçç½ç»åªäºæå¡å¤äºçæ§ç¶æï¼å½åå·²æåªäºè¿æ¥ï¼æ¯å¦ tcp è¿æ¥ç established å timewait ç­ç¶æï¼ã\n\n\n# 2.10 ping æ£æµä¸»æºè¿æ¥\n\nping æ¯ä¸ç§ç½ç»æ£æµå·¥å·ï¼å®ä¸»è¦æ¯ç¨æ¥æ£æµè¿ç¨ä¸»æºæ¯å¦æ­£å¸¸ï¼ææ¯ä¸¤é¨ä¸»æºé´çç½çº¿æç½å¡æéãå¦ ping å¯¹æ¹ipå°åã\n\n\n# 3. rpm ä¸ yum\n\n\n# 3.1 rpm åçç®¡ç\n\nrpm æ¯ç¨äºäºèç½ä¸è½½åçæååå®è£å·¥å·ï¼å®åå«å¨æäº linux åè¡çä¸­ãå®çæå·æ.rpm æ©å±åçæä»¶ãrpm æ¯ redhat package managerï¼redhat è½¯ä»¶åç®¡çå·¥å·ï¼çç¼©åï¼ç±»ä¼¼ windows ç setup.exeï¼è¿ä¸æä»¶æ ¼å¼åç§°è½ç¶æä¸äº redhat çæ å¿ï¼ä½çå¿µæ¯éç¨çãlinux çåè¡çæ¬é½æéç¨ï¼redhatï¼centosç­ç­ï¼ï¼å¯ä»¥ç®æ¯å¬è®¤çè¡ä¸æ åäºã\n\n# 3.1.1 rpm åçç®åæ¥è¯¢æä»¤\n\n> æ¥è¯¢æä»¤çéé¡¹æ¯ -qï¼queryï¼ï¼ç¶åååå¶ä»éé¡¹ç»åæ¥ä½¿ç¨ã\n\nrpm -qaï¼æ¥è¯¢å·²å®è£çå¨é¨ rpm è½¯ä»¶å\n\n> æ¡ä¾ï¼ççå½åç³»ç»æ¯å¦å®è£äº firefoxï¼rpm -qa|grep firefox\n> \n> $ rpm -qa|grep firefox\n> firefox-91.5.0-1.el7.centos.x86_64\n> \n> \n> 1\n> 2\n\n# 3.1.2 rpm åååºæ¬æ ¼å¼\n\nä¸ä¸ª rpm ååï¼firefox-91.5.0-1.el7.centos.x86_64\n\n * åç§°ï¼firefox\n * çæ¬å·ï¼91.5.0-1\n * éç¨ osï¼el7.centos.x86_64\n   * è¡¨ç¤º centos7.x ç 64 ä½ç³»ç»\n   * å¦ææ¯ i686ãi386è¡¨ç¤º32ä½ç³»ç»ï¼noarch è¡¨ç¤ºéç¨\n\n# 3.1.3 rpm åçå¶å®æ¥è¯¢æä»¤\n\n * rpm -qa | grep è½¯ä»¶ååï¼æ¥è¯¢æå®è£çæ¯å¦æè¯¥è½¯ä»¶å\n * rpm -qi è½¯ä»¶ååï¼æ¥è¯¢è½¯ä»¶åä¿¡æ¯\n * rpm -ql è½¯ä»¶ååï¼æ¥è¯¢è½¯ä»¶åä¸­çæä»¶\n * rpm -qf æä»¶å¨è·¯å¾ï¼æ¥è¯¢æä»¶æå±çè½¯ä»¶åï¼å¦rpm -qf /etc/passwd\n\n# 3.1.4 å¸è½½ rpm å\n\nrpm -e rpmåçåç§°\n\n\n1\n\n * ååä¸éè¦åå¨ç§°ï¼æ¯å¦å¸è½½ç«çåªéè¦å firefox å³å¯ã\n * e ââ erase\n\n> æ¡ä¾ï¼å é¤ firefox è½¯ä»¶åï¼rpm -e firefox\n\nç»èé®é¢\n\n * å¦æå¶å®è½¯ä»¶åä¾èµäºè¦å¸è½½çè½¯ä»¶åï¼å¸è½½æ¶åä¼äº§çéè¯¯ä¿¡æ¯ã\n * å¦æå°±æ¯è¦å é¤è¿ä¸ª rpm åï¼å¯ä»¥å¢å åæ° --nodepsï¼å°±å¯ä»¥å¼ºå¶å é¤ï¼ä½æ¯ä¸è¬ä¸æ¨èè¿æ ·åï¼å ä¸ºä¾èµäºè¯¥è½¯ä»¶åçç¨åºå¯è½æ æ³è¿è¡ã\n\n# 3.1.5 å®è£ rpm å\n\nrpm -ivh rpmåå¨è·¯å¾åç§°\n\n\n1\n\n * -iï¼installï¼å®è£\n * -vï¼verboseï¼æç¤º\n * -hï¼hashï¼è¿åº¦æ¡\n\n> æ¡ä¾ï¼å¸è½½åå®è£ firefox æµè§å¨\n> \n>  * å¸è½½ï¼rpm -e firefox\n>  * å®è£ï¼rpm -ivh firefoxçrpmå®è£å\n>  * rpmå®è£åçä½ç½®ï¼åçç package æä»¶å¤¹ä¸­æ¾å°å¯¹åºçåï¼copy å°æ¬å°ç®å½ä¸­ï¼è¿è¡å®è£ã\n\n\n# 3.2 yum\n\nyum æ¯ä¸ä¸ª shell åç«¯è½¯ä»¶åç®¡çå¨ãåºäº rpm åç®¡çï¼è½å¤ä»æå®çæå¡å¨èªå¨ä¸è½½ rpm åå¹¶ä¸å®è£ï¼å¯ä»¥èªå¨å¤çä¾èµæ§å³ç³»ï¼å¹¶ä¸ä¸æ¬¡å®è£ææä¾èµçè½¯ä»¶åãä½¿ç¨ yum çåææ¯å¯ä»¥èç½ã\n\n> å¾å mavenãç¸å½äº ubuntu ç aptã\n\n * æ¥è¯¢ yum æå¡å¨æ¯å¦æéè¦å®è£çè½¯ä»¶ï¼yum list | grep è½¯ä»¶å\n * å®è£æå®ç yum åï¼yum install è½¯ä»¶å\n\n> æ¡ä¾ï¼ä½¿ç¨ yum çæ¹å¼æ¥å®è£ firefox\n> \n>  * å é¤ firefoxï¼rpm -e firefox\n>  * æ¥è¯¢ firefoxï¼yum install | grep firefox\n>  * å®è£ï¼yum install firefox',charsets:{cjk:!0},lastUpdated:"2022/08/15, 13:42:34",lastUpdatedTimestamp:1660570954e3},{title:"JavaEEä¸Pythonå®å¶ç¯",frontmatter:{title:"JavaEEä¸Pythonå®å¶ç¯",date:"2022-08-15T21:48:03.000Z",permalink:"/pages/1e98d9/",categories:["åºç¡","Linux","é©é¡ºå¹³2021è¯¾ç¨ç¬è®°"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/10.Linux/05.%E9%9F%A9%E9%A1%BA%E5%B9%B32021%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/20.JavaEE%E4%B8%8EPython%E5%AE%9A%E5%88%B6%E7%AF%87.html",relativePath:"åºç¡/10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/20.JavaEEä¸Pythonå®å¶ç¯.md",key:"v-1ae0a658",path:"/pages/1e98d9/",headers:[{level:2,title:"ä¸ãJava EE å®å¶ç¯ââæ­å»º Java EE ç¯å¢",slug:"ä¸ãjava-ee-å®å¶ç¯-æ­å»º-java-ee-ç¯å¢",normalizedTitle:"ä¸ãjava ee å®å¶ç¯ââæ­å»º java ee ç¯å¢",charIndex:2},{level:3,title:"1.1 å®è£ JDK 8",slug:"_1-1-å®è£-jdk-8",normalizedTitle:"1.1 å®è£ jdk 8",charIndex:102},{level:3,title:"1.2 å®è£ Tomcat",slug:"_1-2-å®è£-tomcat",normalizedTitle:"1.2 å®è£ tomcat",charIndex:779},{level:3,title:"1.3 å®è£ MySQL 5.7",slug:"_1-3-å®è£-mysql-5-7",normalizedTitle:"1.3 å®è£ mysql 5.7",charIndex:1083},{level:2,title:"äºãPython å®å¶ç¯ ââ Ubuntu",slug:"äºãpython-å®å¶ç¯-ubuntu",normalizedTitle:"äºãpython å®å¶ç¯ ââ ubuntu",charIndex:2270},{level:3,title:"2.1 Ubuntu çå®è£",slug:"_2-1-ubuntu-çå®è£",normalizedTitle:"2.1 ubuntu çå®è£",charIndex:2507},{level:3,title:"2.2 è®¾ç½® Ubuntu ç¯å¢",slug:"_2-2-è®¾ç½®-ubuntu-ç¯å¢",normalizedTitle:"2.2 è®¾ç½® ubuntu ç¯å¢",charIndex:2531},{level:2,title:"ä¸ãAPT è½¯ä»¶ç®¡çåè¿ç¨ç»å½",slug:"ä¸ãapt-è½¯ä»¶ç®¡çåè¿ç¨ç»å½",normalizedTitle:"ä¸ãapt è½¯ä»¶ç®¡çåè¿ç¨ç»å½",charIndex:2557},{level:3,title:"3.1 Ubuntu è½¯ä»¶ç¸å³æä½çç¸å³å½ä»¤",slug:"_3-1-ubuntu-è½¯ä»¶ç¸å³æä½çç¸å³å½ä»¤",normalizedTitle:"3.1 ubuntu è½¯ä»¶ç¸å³æä½çç¸å³å½ä»¤",charIndex:2667}],headersStr:"ä¸ãJava EE å®å¶ç¯ââæ­å»º Java EE ç¯å¢ 1.1 å®è£ JDK 8 1.2 å®è£ Tomcat 1.3 å®è£ MySQL 5.7 äºãPython å®å¶ç¯ ââ Ubuntu 2.1 Ubuntu çå®è£ 2.2 è®¾ç½® Ubuntu ç¯å¢ ä¸ãAPT è½¯ä»¶ç®¡çåè¿ç¨ç»å½ 3.1 Ubuntu è½¯ä»¶ç¸å³æä½çç¸å³å½ä»¤",content:"# ä¸ãJava EE å®å¶ç¯ââæ­å»º Java EE ç¯å¢\n\nå¦æéè¦å¨ Linux ä¸è¿è¡Java EE çå¼åï¼æä»¬éè¦å®è£å¦ä¸è½¯ä»¶ï¼\n\n * JDK\n * Tomcat\n * MySQL\n\n\n# 1.1 å®è£ JDK 8\n\n * mkdir /opt/jdk\n\n * éè¿ Xftp 6ä¸ä¼  JDK å®è£åï¼jdk-8u261-linux-x64.tar.gzï¼å° /opt/jdk\n\n * cd /opt/jdk\n\n * ä½¿ç¨ tar -zxvf jdk-8u261-linux-x64.tar.gz å½ä»¤è§£å JDK å®è£å\n\n * mkdir /usr/local/java\n\n * mv jdk1.8.0_261/ /usr/local/java/\n\n * ä½¿ç¨ echo $PATH å½ä»¤æ¥çå½åçç¯å¢åéï¼æ²¡æ JDK\n\n * éè¿ç¼è¾ /etc/profile æä»¶éç½® JDK ç¯å¢åé\n   \n   * å¢å å½ä»¤ export JAVA_HOME=/usr/local/java/jdk1.8.0_261\n   \n   * å¢å å½ä»¤\n     \n     export PATH=$JAVA_HOME/bin:$PATH\n     \n     \n     1\n     \n     * æ³¨æï¼è¿éå¸¦ä¸ :$PATH æ¯æä¹åç PATH ç¯å¢åéä¹å¸¦ä¸ï¼å¦åä¼ç ´åä¹åçç¯å¢åéï¼å¯¼è´åºå¤§é®é¢\n   \n   * å¶ä¸­ï¼ç¬¬äºæ¡å½ä»¤ç $PATH æ¯ä¹åçç¯å¢åéï¼ä¸å®è¦åä¸ãå¦åï¼ä¸äºå¸¸ç¨æä»¤å°æ æ³ä½¿ç¨ã\n\n * éè¿ source /etc/profile å½ä»¤è®©æ°çç¯å¢åéçæ\n\n * åæ¬¡ä½¿ç¨ echo $PATH å½ä»¤æ¥çå½åçç¯å¢åéï¼JDK ç¯å¢åéæ·»å æå\n\n * éè¿è¿è¡ Java ç¨åºæµè¯æ¯å¦å®è£æå\n\n\n# 1.2 å®è£ Tomcat\n\n * mkdir /opt/tomcat\n * ä¸ä¼ å®è£æä»¶ï¼å¹¶è§£åå° /opt/tomcat\n * è¿å¥è§£åç®å½ /binï¼å¯å¨ Tomcatï¼./startup.sh\n * å¼æ¾ç«¯å£ 8080\n   * ä½¿ç¨ firewall-cmd --permanent --add-port=8080/tcp å½ä»¤æå¼8080ç«¯å£\n   * ä½¿ç¨ firewall-cmd --reload å½ä»¤æ´æ°ç«¯å£ç¶æ\n   * ä½¿ç¨ firewall-cmd --query-port=8080/tcp å½ä»¤æ¥çç«¯å£æ¯å¦æå¼\n\néè¿æµè§å¨è®¿é® IPå°å:8080 æ¥æ¥çæ¯å¦å®è£æå\n\n\n# 1.3 å®è£ MySQL 5.7\n\n * mkdir /opt/mysql\n * ä¸ä¼ å®è£æä»¶ï¼å¹¶è§£åå° /opt/mysqlï¼ç¨ tar -xvf ... è§£åï¼\n * CentOS 7.6èªå¸¦ç MySQL ç±»æ°æ®åºæ¯ mariadbï¼ä¼å MySQL å²çªï¼è¦åå é¤\n   * ä½¿ç¨ rpm -qa | grep mari å½ä»¤æ¥ç mariadb ç¸å³å®è£å\n   * åå«è¿è¡ rpm -e --nodeps mariadb-libs ä»¥å rpm -e --nodeps marisa å½ä»¤å é¤\n   * åæ¬¡ä½¿ç¨ rpm -qa | grep mari å½ä»¤æ¥è¯¢ mariadb ç¸å³å®è£åï¼å·²å é¤å¹²å\n * å¼å§çæ­£å®è£ MySQLï¼ä¾æ¬¡æé¡ºåºè¿è¡ä»¥ä¸å½ä»¤\n   * rpm -ivh mysql-community-common-5.7.26-1.el7.x86_64.rpm\n   * rpm -ivh mysql-community-libs-5.7.26-1.el7.x86_64.rpm\n   * rpm -ivh mysql-community-client-5.7.26-1.el7.x86_64.rpm\n   * rpm -ivh mysql-community-server-5.7.26-1.el7.x86_64.rpm\n * è¿è¡ systemctl start mysqld.service å½ä»¤ï¼å¯å¨ MySQL\n * è®¾ç½® root ç¨æ·å¯ç \n   * MySQL èªå¨ç» root ç¨æ·è®¾ç½®éæºå¯ç ï¼éè¿ grep password /var/log/mysqld.log æ¥æ¥çå½åå¯ç \n   * è¿è¡ mysql -u root -p å½ä»¤ç»å½ root ç¨æ·ï¼è¾å¥ä¸é¢ root ç¨æ·å½åå¯ç ï¼ç»å½è¿å¥ MySQL å½ä»¤è¡\n   * å¯¹äºä¸ªäººå¼åç¯å¢ï¼å¦æè®¾ç½®è¾ç®åç root ç¨æ·å¯ç ï¼å¨ MySQL å½ä»¤è¡è¿è¡ set global validate_password_policy=0; å°å¯ç ç­ç¥ä¿®æ¹ä¸º0ï¼å³å¼±å£ä»¤ï¼é»è®¤æåµä¸º1ï¼ãå¯¹äºçäº§ç¯å¢ï¼è¦è®¾ç½®å¤æç root ç¨æ·å¯ç ã\n   * ä¿®æ¹ root ç¨æ·å¯ç å½ä»¤æ ¼å¼ï¼set password for ç¨æ·å@localhost = password('æ°å¯ç '); æ¯å¦å¨ MySQL å½ä»¤è¡éè¿è¡ set password for root@localhost = password('12345678');\n   * ç»§ç»­å¨ MySQL å½ä»¤è¡éè¾å¥ flush privileges; ä½¿å¯ç è®¾ç½®çæ\n   * è¾å¥ quit éåº\n * éæ°ç»éå³å¯\n\nð æ´ç®åçå®è£æ¹å¼ï¼MySQL å®è£ | èé¸æç¨ (runoob.com)\n\n\n# äºãPython å®å¶ç¯ ââ Ubuntu\n\nUbuntuï¼ä¹ç­å¾ï¼æ¯ä¸ä¸ªä»¥æ¡é¢åºç¨ä¸ºä¸»çå¼æº GNU/Linux æä½ç³»ç»ã\n\nä¸ä¸ç Python å¼åèä¸è¬ä¼éæ© Ubuntu è¿æ¬¾ Linux ç³»ç»ä½ä¸ºçäº§å¹³å°ï¼Ubuntu å Centos é½æ¯åºäº GNU/Linux åæ ¸çï¼å æ­¤åºæ¬ä½¿ç¨å Centos æ¯å ä¹ä¸æ ·çï¼å®ä»¬çåç§æä»¤å¯ä»¥éç¨ãåªæ¯çé¢åé¢å®è£çè½¯ä»¶ææå·®å«ã\n\nä¸è½½å°åï¼Ubuntu ä¸è½½å°å(opens new window)\n\n\n# 2.1 Ubuntu çå®è£\n\n...\n\n\n# 2.2 è®¾ç½® Ubuntu ç¯å¢\n\n...\n\n\n# ä¸ãAPT è½¯ä»¶ç®¡çåè¿ç¨ç»å½\n\nAPT æ¯ Advanced Packaging Tool çç®ç§°ï¼æ¯ä¸æ¬¾å®è£åç®¡çå·¥å·ãå¨ Ubuntu ä¸ï¼æä»¬å¯ä»¥ä½¿ç¨ apt å½ä»¤å¯ç¨äºè½¯ä»¶åçå®è£ãå é¤ãæ¸çç­ã\n\n\n\n\n# 3.1 Ubuntu è½¯ä»¶ç¸å³æä½çç¸å³å½ä»¤",normalizedContent:"# ä¸ãjava ee å®å¶ç¯ââæ­å»º java ee ç¯å¢\n\nå¦æéè¦å¨ linux ä¸è¿è¡java ee çå¼åï¼æä»¬éè¦å®è£å¦ä¸è½¯ä»¶ï¼\n\n * jdk\n * tomcat\n * mysql\n\n\n# 1.1 å®è£ jdk 8\n\n * mkdir /opt/jdk\n\n * éè¿ xftp 6ä¸ä¼  jdk å®è£åï¼jdk-8u261-linux-x64.tar.gzï¼å° /opt/jdk\n\n * cd /opt/jdk\n\n * ä½¿ç¨ tar -zxvf jdk-8u261-linux-x64.tar.gz å½ä»¤è§£å jdk å®è£å\n\n * mkdir /usr/local/java\n\n * mv jdk1.8.0_261/ /usr/local/java/\n\n * ä½¿ç¨ echo $path å½ä»¤æ¥çå½åçç¯å¢åéï¼æ²¡æ jdk\n\n * éè¿ç¼è¾ /etc/profile æä»¶éç½® jdk ç¯å¢åé\n   \n   * å¢å å½ä»¤ export java_home=/usr/local/java/jdk1.8.0_261\n   \n   * å¢å å½ä»¤\n     \n     export path=$java_home/bin:$path\n     \n     \n     1\n     \n     * æ³¨æï¼è¿éå¸¦ä¸ :$path æ¯æä¹åç path ç¯å¢åéä¹å¸¦ä¸ï¼å¦åä¼ç ´åä¹åçç¯å¢åéï¼å¯¼è´åºå¤§é®é¢\n   \n   * å¶ä¸­ï¼ç¬¬äºæ¡å½ä»¤ç $path æ¯ä¹åçç¯å¢åéï¼ä¸å®è¦åä¸ãå¦åï¼ä¸äºå¸¸ç¨æä»¤å°æ æ³ä½¿ç¨ã\n\n * éè¿ source /etc/profile å½ä»¤è®©æ°çç¯å¢åéçæ\n\n * åæ¬¡ä½¿ç¨ echo $path å½ä»¤æ¥çå½åçç¯å¢åéï¼jdk ç¯å¢åéæ·»å æå\n\n * éè¿è¿è¡ java ç¨åºæµè¯æ¯å¦å®è£æå\n\n\n# 1.2 å®è£ tomcat\n\n * mkdir /opt/tomcat\n * ä¸ä¼ å®è£æä»¶ï¼å¹¶è§£åå° /opt/tomcat\n * è¿å¥è§£åç®å½ /binï¼å¯å¨ tomcatï¼./startup.sh\n * å¼æ¾ç«¯å£ 8080\n   * ä½¿ç¨ firewall-cmd --permanent --add-port=8080/tcp å½ä»¤æå¼8080ç«¯å£\n   * ä½¿ç¨ firewall-cmd --reload å½ä»¤æ´æ°ç«¯å£ç¶æ\n   * ä½¿ç¨ firewall-cmd --query-port=8080/tcp å½ä»¤æ¥çç«¯å£æ¯å¦æå¼\n\néè¿æµè§å¨è®¿é® ipå°å:8080 æ¥æ¥çæ¯å¦å®è£æå\n\n\n# 1.3 å®è£ mysql 5.7\n\n * mkdir /opt/mysql\n * ä¸ä¼ å®è£æä»¶ï¼å¹¶è§£åå° /opt/mysqlï¼ç¨ tar -xvf ... è§£åï¼\n * centos 7.6èªå¸¦ç mysql ç±»æ°æ®åºæ¯ mariadbï¼ä¼å mysql å²çªï¼è¦åå é¤\n   * ä½¿ç¨ rpm -qa | grep mari å½ä»¤æ¥ç mariadb ç¸å³å®è£å\n   * åå«è¿è¡ rpm -e --nodeps mariadb-libs ä»¥å rpm -e --nodeps marisa å½ä»¤å é¤\n   * åæ¬¡ä½¿ç¨ rpm -qa | grep mari å½ä»¤æ¥è¯¢ mariadb ç¸å³å®è£åï¼å·²å é¤å¹²å\n * å¼å§çæ­£å®è£ mysqlï¼ä¾æ¬¡æé¡ºåºè¿è¡ä»¥ä¸å½ä»¤\n   * rpm -ivh mysql-community-common-5.7.26-1.el7.x86_64.rpm\n   * rpm -ivh mysql-community-libs-5.7.26-1.el7.x86_64.rpm\n   * rpm -ivh mysql-community-client-5.7.26-1.el7.x86_64.rpm\n   * rpm -ivh mysql-community-server-5.7.26-1.el7.x86_64.rpm\n * è¿è¡ systemctl start mysqld.service å½ä»¤ï¼å¯å¨ mysql\n * è®¾ç½® root ç¨æ·å¯ç \n   * mysql èªå¨ç» root ç¨æ·è®¾ç½®éæºå¯ç ï¼éè¿ grep password /var/log/mysqld.log æ¥æ¥çå½åå¯ç \n   * è¿è¡ mysql -u root -p å½ä»¤ç»å½ root ç¨æ·ï¼è¾å¥ä¸é¢ root ç¨æ·å½åå¯ç ï¼ç»å½è¿å¥ mysql å½ä»¤è¡\n   * å¯¹äºä¸ªäººå¼åç¯å¢ï¼å¦æè®¾ç½®è¾ç®åç root ç¨æ·å¯ç ï¼å¨ mysql å½ä»¤è¡è¿è¡ set global validate_password_policy=0; å°å¯ç ç­ç¥ä¿®æ¹ä¸º0ï¼å³å¼±å£ä»¤ï¼é»è®¤æåµä¸º1ï¼ãå¯¹äºçäº§ç¯å¢ï¼è¦è®¾ç½®å¤æç root ç¨æ·å¯ç ã\n   * ä¿®æ¹ root ç¨æ·å¯ç å½ä»¤æ ¼å¼ï¼set password for ç¨æ·å@localhost = password('æ°å¯ç '); æ¯å¦å¨ mysql å½ä»¤è¡éè¿è¡ set password for root@localhost = password('12345678');\n   * ç»§ç»­å¨ mysql å½ä»¤è¡éè¾å¥ flush privileges; ä½¿å¯ç è®¾ç½®çæ\n   * è¾å¥ quit éåº\n * éæ°ç»éå³å¯\n\nð æ´ç®åçå®è£æ¹å¼ï¼mysql å®è£ | èé¸æç¨ (runoob.com)\n\n\n# äºãpython å®å¶ç¯ ââ ubuntu\n\nubuntuï¼ä¹ç­å¾ï¼æ¯ä¸ä¸ªä»¥æ¡é¢åºç¨ä¸ºä¸»çå¼æº gnu/linux æä½ç³»ç»ã\n\nä¸ä¸ç python å¼åèä¸è¬ä¼éæ© ubuntu è¿æ¬¾ linux ç³»ç»ä½ä¸ºçäº§å¹³å°ï¼ubuntu å centos é½æ¯åºäº gnu/linux åæ ¸çï¼å æ­¤åºæ¬ä½¿ç¨å centos æ¯å ä¹ä¸æ ·çï¼å®ä»¬çåç§æä»¤å¯ä»¥éç¨ãåªæ¯çé¢åé¢å®è£çè½¯ä»¶ææå·®å«ã\n\nä¸è½½å°åï¼ubuntu ä¸è½½å°å(opens new window)\n\n\n# 2.1 ubuntu çå®è£\n\n...\n\n\n# 2.2 è®¾ç½® ubuntu ç¯å¢\n\n...\n\n\n# ä¸ãapt è½¯ä»¶ç®¡çåè¿ç¨ç»å½\n\napt æ¯ advanced packaging tool çç®ç§°ï¼æ¯ä¸æ¬¾å®è£åç®¡çå·¥å·ãå¨ ubuntu ä¸ï¼æä»¬å¯ä»¥ä½¿ç¨ apt å½ä»¤å¯ç¨äºè½¯ä»¶åçå®è£ãå é¤ãæ¸çç­ã\n\n\n\n\n# 3.1 ubuntu è½¯ä»¶ç¸å³æä½çç¸å³å½ä»¤",charsets:{cjk:!0},lastUpdated:"2022/08/22, 01:57:58",lastUpdatedTimestamp:1661133478e3},{title:"å¤§æ°æ®å®å¶ç¯-Shellç¼ç¨",frontmatter:{title:"å¤§æ°æ®å®å¶ç¯-Shellç¼ç¨",date:"2022-08-21T15:39:01.000Z",permalink:"/pages/338288/",categories:["åºç¡","Linux","é©é¡ºå¹³2021è¯¾ç¨ç¬è®°"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/10.Linux/05.%E9%9F%A9%E9%A1%BA%E5%B9%B32021%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/25.%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9A%E5%88%B6%E7%AF%87-Shell%E7%BC%96%E7%A8%8B.html",relativePath:"åºç¡/10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/25.å¤§æ°æ®å®å¶ç¯-Shellç¼ç¨.md",key:"v-97c51d34",path:"/pages/338288/",headers:[{level:2,title:"1. Shell æ¦è¿°",slug:"_1-shell-æ¦è¿°",normalizedTitle:"1. shell æ¦è¿°",charIndex:2},{level:3,title:"1.1 ä¸ºä»ä¹è¦å­¦ä¹  Shell ç¼ç¨",slug:"_1-1-ä¸ºä»ä¹è¦å­¦ä¹ -shell-ç¼ç¨",normalizedTitle:"1.1 ä¸ºä»ä¹è¦å­¦ä¹  shell ç¼ç¨",charIndex:18},{level:3,title:"1.2 shell æ¯ä»ä¹",slug:"_1-2-shell-æ¯ä»ä¹",normalizedTitle:"1.2 shell æ¯ä»ä¹",charIndex:209},{level:2,title:"2. Shell èæ¬çæ§è¡æ¹å¼",slug:"_2-shell-èæ¬çæ§è¡æ¹å¼",normalizedTitle:"2. shell èæ¬çæ§è¡æ¹å¼",charIndex:314},{level:3,title:"2.1 èæ¬æ ¼å¼è¦æ±",slug:"_2-1-èæ¬æ ¼å¼è¦æ±",normalizedTitle:"2.1 èæ¬æ ¼å¼è¦æ±",charIndex:335},{level:3,title:"2.2 ç¼åç¬¬ä¸ä¸ª shell èæ¬",slug:"_2-2-ç¼åç¬¬ä¸ä¸ª-shell-èæ¬",normalizedTitle:"2.2 ç¼åç¬¬ä¸ä¸ª shell èæ¬",charIndex:380},{level:3,title:"2.3 èæ¬çå¸¸ç¨æ§è¡æ¹å¼",slug:"_2-3-èæ¬çå¸¸ç¨æ§è¡æ¹å¼",normalizedTitle:"2.3 èæ¬çå¸¸ç¨æ§è¡æ¹å¼",charIndex:492},{level:4,title:"ð æ¹å¼ä¸ï¼è¾å¥èæ¬çç»å¯¹è·¯å¾æç¸å¯¹è·¯å¾",slug:"ð-æ¹å¼ä¸-è¾å¥èæ¬çç»å¯¹è·¯å¾æç¸å¯¹è·¯å¾",normalizedTitle:"ð æ¹å¼ä¸ï¼è¾å¥èæ¬çç»å¯¹è·¯å¾æç¸å¯¹è·¯å¾",charIndex:509},{level:4,title:"ð æ¹å¼äºï¼sh + èæ¬",slug:"ð-æ¹å¼äº-sh-èæ¬",normalizedTitle:"ð æ¹å¼äºï¼sh + èæ¬",charIndex:559},{level:2,title:"3. shell çåé",slug:"_3-shell-çåé",normalizedTitle:"3. shell çåé",charIndex:617},{level:3,title:"3.1 Shell åéä»ç»",slug:"_3-1-shell-åéä»ç»",normalizedTitle:"3.1 shell åéä»ç»",charIndex:634},{level:3,title:"3.2 Shell åéå®ä¹",slug:"_3-2-shell-åéå®ä¹",normalizedTitle:"3.2 shell åéå®ä¹",charIndex:760},{level:4,title:"åºæ¬è¯­æ³ï¼",slug:"åºæ¬è¯­æ³",normalizedTitle:"åºæ¬è¯­æ³ï¼",charIndex:778},{level:4,title:"å¿«éå¥é¨ï¼",slug:"å¿«éå¥é¨",normalizedTitle:"å¿«éå¥é¨ï¼",charIndex:885},{level:4,title:"è¡¥åï¼shell èæ¬çæ³¨éï¼",slug:"è¡¥å-shell-èæ¬çæ³¨é",normalizedTitle:"è¡¥åï¼shell èæ¬çæ³¨éï¼",charIndex:1139},{level:3,title:"3.3 shell åéçå®ä¹",slug:"_3-3-shell-åéçå®ä¹",normalizedTitle:"3.3 shell åéçå®ä¹",charIndex:1220},{level:4,title:"å®ä¹åéçè§åï¼",slug:"å®ä¹åéçè§å",normalizedTitle:"å®ä¹åéçè§åï¼",charIndex:1239},{level:4,title:"å°å½ä»¤çè¿åå¼èµç»åéï¼",slug:"å°å½ä»¤çè¿åå¼èµç»åé",normalizedTitle:"å°å½ä»¤çè¿åå¼èµç»åéï¼",charIndex:1325},{level:3,title:"3.4 è®¾ç½®ç¯å¢åé",slug:"_3-4-è®¾ç½®ç¯å¢åé",normalizedTitle:"3.4 è®¾ç½®ç¯å¢åé",charIndex:1399},{level:4,title:"åºæ¬è¯­æ³ï¼",slug:"åºæ¬è¯­æ³-2",normalizedTitle:"åºæ¬è¯­æ³ï¼",charIndex:778},{level:4,title:"å¿«éå¥é¨ï¼",slug:"å¿«éå¥é¨-2",normalizedTitle:"å¿«éå¥é¨ï¼",charIndex:885},{level:3,title:"3.5 ä½ç½®åæ°åé",slug:"_3-5-ä½ç½®åæ°åé",normalizedTitle:"3.5 ä½ç½®åæ°åé",charIndex:1832},{level:4,title:"3.5.1 åºæ¬è¯­æ³",slug:"_3-5-1-åºæ¬è¯­æ³",normalizedTitle:"3.5.1 åºæ¬è¯­æ³",charIndex:1964},{level:4,title:"3.5.2 æ¡ä¾",slug:"_3-5-2-æ¡ä¾",normalizedTitle:"3.5.2 æ¡ä¾",charIndex:2127},{level:3,title:"3.6 é¢å®ä¹åé",slug:"_3-6-é¢å®ä¹åé",normalizedTitle:"3.6 é¢å®ä¹åé",charIndex:2257},{level:4,title:"3.6.1 åºæ¬è¯­æ³",slug:"_3-6-1-åºæ¬è¯­æ³",normalizedTitle:"3.6.1 åºæ¬è¯­æ³",charIndex:2314},{level:4,title:"3.6.2 æ¡ä¾",slug:"_3-6-2-æ¡ä¾",normalizedTitle:"3.6.2 æ¡ä¾",charIndex:2455},{level:2,title:"4. è¿ç®ç¬¦",slug:"_4-è¿ç®ç¬¦",normalizedTitle:"4. è¿ç®ç¬¦",charIndex:2580},{level:4,title:"4.1 åºæ¬è¯­æ³",slug:"_4-1-åºæ¬è¯­æ³",normalizedTitle:"4.1 åºæ¬è¯­æ³",charIndex:2610},{level:4,title:"4.2 æ¡ä¾",slug:"_4-2-æ¡ä¾",normalizedTitle:"4.2 æ¡ä¾",charIndex:2785},{level:2,title:"5. æ¡ä»¶å¤æ­",slug:"_5-æ¡ä»¶å¤æ­",normalizedTitle:"5. æ¡ä»¶å¤æ­",charIndex:3129},{level:4,title:"5.1 åºæ¬è¯­æ³",slug:"_5-1-åºæ¬è¯­æ³",normalizedTitle:"5.1 åºæ¬è¯­æ³",charIndex:1966},{level:4,title:"5.2 å¸¸ç¨å¤æ­æ¡ä»¶",slug:"_5-2-å¸¸ç¨å¤æ­æ¡ä»¶",normalizedTitle:"5.2 å¸¸ç¨å¤æ­æ¡ä»¶",charIndex:3230},{level:4,title:"3.8.3 æ¡ä¾",slug:"_3-8-3-æ¡ä¾",normalizedTitle:"3.8.3 æ¡ä¾",charIndex:3483},{level:2,title:"6. æµç¨æ§å¶",slug:"_6-æµç¨æ§å¶",normalizedTitle:"6. æµç¨æ§å¶",charIndex:3881},{level:3,title:"6.1 if å¤æ­",slug:"_6-1-if-å¤æ­",normalizedTitle:"6.1 if å¤æ­",charIndex:3893},{level:3,title:"6.2 case è¯­å¥",slug:"_6-2-case-è¯­å¥",normalizedTitle:"6.2 case è¯­å¥",charIndex:4223},{level:3,title:"6.3 for å¾ªç¯",slug:"_6-3-for-å¾ªç¯",normalizedTitle:"6.3 for å¾ªç¯",charIndex:4659},{level:3,title:"ð åºæ¬è¯­æ³ 1",slug:"ð-åºæ¬è¯­æ³-1",normalizedTitle:"ð åºæ¬è¯­æ³ 1",charIndex:4674},{level:4,title:"ð åºæ¬è¯­æ³ 2",slug:"ð-åºæ¬è¯­æ³-2",normalizedTitle:"ð åºæ¬è¯­æ³ 2",charIndex:5012},{level:3,title:"6.4 while å¾ªç¯",slug:"_6-4-while-å¾ªç¯",normalizedTitle:"6.4 while å¾ªç¯",charIndex:5247},{level:2,title:"7. read è¯»åæ§å¶å°è¾å¥",slug:"_7-read-è¯»åæ§å¶å°è¾å¥",normalizedTitle:"7. read è¯»åæ§å¶å°è¾å¥",charIndex:5536},{level:2,title:"8. å½æ°",slug:"_8-å½æ°",normalizedTitle:"8. å½æ°",charIndex:5858},{level:3,title:"8.1 ç³»ç»å½æ°",slug:"_8-1-ç³»ç»å½æ°",normalizedTitle:"8.1 ç³»ç»å½æ°",charIndex:5893},{level:4,title:"8.1.1 basename å½æ°",slug:"_8-1-1-basename-å½æ°",normalizedTitle:"8.1.1 basename å½æ°",charIndex:5923},{level:4,title:"8.1.2 dirname å½æ°",slug:"_8-1-2-dirname-å½æ°",normalizedTitle:"8.1.2 dirname å½æ°",charIndex:6291},{level:3,title:"8.2 èªå®ä¹å½æ°",slug:"_8-2-èªå®ä¹å½æ°",normalizedTitle:"8.2 èªå®ä¹å½æ°",charIndex:6490},{level:2,title:"9. ç»¼åæ¡ä¾",slug:"_9-ç»¼åæ¡ä¾",normalizedTitle:"9. ç»¼åæ¡ä¾",charIndex:6912}],headersStr:"1. Shell æ¦è¿° 1.1 ä¸ºä»ä¹è¦å­¦ä¹  Shell ç¼ç¨ 1.2 shell æ¯ä»ä¹ 2. Shell èæ¬çæ§è¡æ¹å¼ 2.1 èæ¬æ ¼å¼è¦æ± 2.2 ç¼åç¬¬ä¸ä¸ª shell èæ¬ 2.3 èæ¬çå¸¸ç¨æ§è¡æ¹å¼ ð æ¹å¼ä¸ï¼è¾å¥èæ¬çç»å¯¹è·¯å¾æç¸å¯¹è·¯å¾ ð æ¹å¼äºï¼sh + èæ¬ 3. shell çåé 3.1 Shell åéä»ç» 3.2 Shell åéå®ä¹ åºæ¬è¯­æ³ï¼ å¿«éå¥é¨ï¼ è¡¥åï¼shell èæ¬çæ³¨éï¼ 3.3 shell åéçå®ä¹ å®ä¹åéçè§åï¼ å°å½ä»¤çè¿åå¼èµç»åéï¼ 3.4 è®¾ç½®ç¯å¢åé åºæ¬è¯­æ³ï¼ å¿«éå¥é¨ï¼ 3.5 ä½ç½®åæ°åé 3.5.1 åºæ¬è¯­æ³ 3.5.2 æ¡ä¾ 3.6 é¢å®ä¹åé 3.6.1 åºæ¬è¯­æ³ 3.6.2 æ¡ä¾ 4. è¿ç®ç¬¦ 4.1 åºæ¬è¯­æ³ 4.2 æ¡ä¾ 5. æ¡ä»¶å¤æ­ 5.1 åºæ¬è¯­æ³ 5.2 å¸¸ç¨å¤æ­æ¡ä»¶ 3.8.3 æ¡ä¾ 6. æµç¨æ§å¶ 6.1 if å¤æ­ 6.2 case è¯­å¥ 6.3 for å¾ªç¯ ð åºæ¬è¯­æ³ 1 ð åºæ¬è¯­æ³ 2 6.4 while å¾ªç¯ 7. read è¯»åæ§å¶å°è¾å¥ 8. å½æ° 8.1 ç³»ç»å½æ° 8.1.1 basename å½æ° 8.1.2 dirname å½æ° 8.2 èªå®ä¹å½æ° 9. ç»¼åæ¡ä¾",content:'# 1. Shell æ¦è¿°\n\n\n# 1.1 ä¸ºä»ä¹è¦å­¦ä¹  Shell ç¼ç¨\n\n * Linux è¿ç»´å·¥ç¨å¸å¨è¿è¡æå¡å¨éç¾¤ç®¡çæ¶ï¼éè¦ç¼å Shell ç¨åºæ¥è¿è¡æå¡å¨ç®¡çã\n * å¯¹äº JavaEE å Python ç¨åºåæ¥è¯´ï¼å·¥ä½çéè¦ï¼ä¼è¦æ±ä½ ç¼åä¸äº Shell èæ¬è¿è¡ç¨åºæèæ¯æå¡å¨çç»´æ¤ï¼æ¯å¦ç¼åä¸ä¸ªå®æ¶å¤ä»½æ°æ®åºçèæ¬ã\n * å¯¹äºå¤§æ°æ®ç¨åºåæ¥è¯´ï¼éè¦ç¼å Shell ç¨åºæ¥ç®¡çéç¾¤ã\n\n\n# 1.2 shell æ¯ä»ä¹\n\nShell æ¯ä¸ä¸ªå½ä»¤è¡è§£éå¨ï¼å®ä¸ºç¨æ·æä¾äºä¸ä¸ªå Linux åæ ¸åéè¯·æ±ä»¥ä¾¿è¿è¡ç¨åºççé¢ç³»ç»çº§ç¨åºï¼ç¨æ·å¯ä»¥ç¨ Shell æ¥å¯å¨ãæèµ·ãåæ­¢çè³æ¯ç¼åä¸äºç¨åºã\n\n\n# 2. Shell èæ¬çæ§è¡æ¹å¼\n\n\n# 2.1 èæ¬æ ¼å¼è¦æ±\n\nèæ¬ä»¥ #!/bin/bash å¼å¤´ï¼éè¦æå¯æ§è¡æéã\n\n\n# 2.2 ç¼åç¬¬ä¸ä¸ª shell èæ¬\n\néæ±ï¼åå»ºä¸ä¸ª shell èæ¬ï¼è¾åº hello worldï¼\n\nvim hello.sh\n#!/bin/bash\necho "hello,world~"\n\n\n1\n2\n3\n\n\n\n# 2.3 èæ¬çå¸¸ç¨æ§è¡æ¹å¼\n\n# ð æ¹å¼ä¸ï¼è¾å¥èæ¬çç»å¯¹è·¯å¾æç¸å¯¹è·¯å¾\n\nè¯´æï¼é¦åè¦èµäºèæ¬ +x çæéï¼åæ§è¡èæ¬\n\n# ð æ¹å¼äºï¼sh + èæ¬\n\nè¯´æï¼ä¸ç¨èµäºèæ¬+x æéï¼ç´æ¥æ§è¡å³å¯\n\næ¯å¦ sh hello.sh\n\n\n# 3. shell çåé\n\n\n# 3.1 Shell åéä»ç»\n\n * Shell åéåä¸ºç³»ç»åéåç¨æ·èªå®ä¹åéã\n * ç³»ç»åéï¼$HOMEã$PWDã$SHELLã$USER ç­ç­ï¼æ¯å¦ï¼echo $HOME ç­ç­ã\n * æ¾ç¤º shell ææç³»ç»åéï¼set æä»¤\n\n\n# 3.2 Shell åéå®ä¹\n\n# åºæ¬è¯­æ³ï¼\n\n * å®ä¹åéï¼åéå=å¼\n   * æ³¨æå¨ shell ç¼ç¨ä¸­ï¼è¿ç§ç­å·çä¸¤è¾¹ä¸è¦æç©ºæ ¼ã\n * æ¤éåéï¼unset åé\n * å£°æéæåéï¼readonly åéï¼æ³¨æä¸è½ unset\n\n# å¿«éå¥é¨ï¼\n\n#!/bin/bash\n\n# æ¡ä¾ 1ï¼å®ä¹åé A\nA=100\n# è¾åºåééè¦å ä¸ $\necho A=$A\necho "A=$A"\n# æ¡ä¾ 2ï¼æ¤éåé A\nunset A\necho "A=$A"\n# æ¡ä¾ 3ï¼å£°æéæçåé B=2ï¼ä¸è½æ¤é\nreadonly B=2\necho "B=$B"\n# æ­¤æ¶å¦æ unset Bï¼æ§è¡æ¶ä¼æ¥é\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nvim ä¸­ä¸´æ¶æ¾ç¤ºè¡å·ï¼:nu vim ä¸­æ¾ç¤ºè¡å·ï¼:set nu\n\n# è¡¥åï¼shell èæ¬çæ³¨éï¼\n\n * åè¡æ³¨éï¼#\n * å¤è¡æ³¨éï¼\n\n:<<!\néè¦æ³¨éçç¬¬ä¸è¡åå®¹\néè¦æ³¨éçç¬¬äºè¡åå®¹\n!\n\n\n1\n2\n3\n4\n\n\n\n# 3.3 shell åéçå®ä¹\n\n# å®ä¹åéçè§åï¼\n\n * åéåç§°å¯ä»¥ç±å­æ¯ãæ°å­åä¸åçº¿ç»æï¼ä½æ¯ä¸è½ä»¥æ°å­å¼å¤´ã\n * ç­å·ä¸¤ä¾§ä¸è½æç©ºæ ¼\n * åéåç§°ä¸è¬ä¹ æ¯ä¸ºå¤§åï¼è¿æ¯ä¸ä¸ªè§èï¼éµå®å³å¯\n\n# å°å½ä»¤çè¿åå¼èµç»åéï¼\n\n * A=dateï¼éè¿åå¼å·ï¼è¿è¡éé¢çå½ä»¤ï¼å¹¶æç»æè¿åç»åé A\n * A=$(date) ç­ä»·äºåå¼å·\n\n\n# 3.4 è®¾ç½®ç¯å¢åé\n\n# åºæ¬è¯­æ³ï¼\n\n * export åéå=åéå¼ï¼å° Shell åéè¾åºä¸ºç¯å¢åé\n * source éç½®æä»¶ï¼è®©ä¿®æ¹åçéç½®æä»¶ç«å³çæ\n * echo $åéåï¼æ¥è¯¢ç¯å¢åéçå¼\n\n# å¿«éå¥é¨ï¼\n\n# éè¿ç¼è¾ /etc/profile æä»¶éç½® JDK ç¯å¢åéï¼è¦å¢å ä»¥ä¸å½ä»¤\nexport JAVA_HOME=/usr/local/java/jdk1.8.0_261\nexport PATH=$JAVA_HOME/bin:$PATH\n# ä¿å­éåº /etc/profile æä»¶åï¼æ§è¡ source /etc/profile å½ä»¤ä½¿ä¿®æ¹åçéç½®æä»¶çæ\n\n\n1\n2\n3\n4\n\n\n> å¨ /etc/profile æä»¶ä¸­è®¾ç½®çåéæ¯å¨å±åéãè .bashrcæä»¶ï¼å¨ç¨æ·çå®¶ç®å½ä¸ï¼ååªå¯¹å½åç¨æ·æç¨ã~/.bashrcã~/.bash_file æ¯å½åç¨æ·ç®å½ä¸çéç½®ä¿¡æ¯ãä¿®æ¹åç¨ source å½ä»¤æ´æ°ã\n\n\n# 3.5 ä½ç½®åæ°åé\n\nå½æä»¬æ§è¡ä¸ä¸ª Shell èæ¬æ¶ï¼å¦æå¸æè·åå°å½ä»¤è¡çåæ°ä¿¡æ¯ï¼å°±å¯ä»¥ä½¿ç¨å°ä½ç½®åæ°åéï¼æ¯å¦ ./myshell.sh 100 200 , è¿ä¸ªå°±æ¯ä¸ä¸ªæ§è¡ shell çå½ä»¤è¡ï¼å¯ä»¥å¨ myshell èæ¬ä¸­è·åå°åæ°ä¿¡æ¯ã\n\n# 3.5.1 åºæ¬è¯­æ³\n\n * $nï¼n ä¸ºæ°å­ï¼$0 ä»£è¡¨å½ä»¤æ¬èº«ï¼$1-$9 ä»£è¡¨ç¬¬ä¸å°ç¬¬ä¹ä¸ªåæ°ï¼åä»¥ä¸çåæ°éè¦ç¨å¤§æ¬å·ï¼å¦ ${10}\n * $*ï¼ä»£è¡¨å½ä»¤è¡ä¸­ææçåæ°ï¼$* æææçåæ°çæä¸ä¸ªæ´ä½\n * $@ï¼ä»£è¡¨å½ä»¤è¡ä¸­ææçåæ°ï¼ä¸è¿è¯¥å½ä»¤æ¯ææ¯ä¸ªåæ°åºåå¯¹å¾\n * $#ï¼ä»£è¡¨å½ä»¤è¡ä¸­ææåæ°çä¸ªæ°\n\n# 3.5.2 æ¡ä¾\n\næ¡ä¾ï¼å¨èæ¬ä¸­è·åå°å½ä»¤è¡çåä¸ªåæ°ä¿¡æ¯\n\n#!/bin/bash\necho "0=$0 1=$1 2=$2"\necho "å½ä»¤è¡ææä¼ å¥çåæ°=$*"\necho "$@"\necho "åæ°çä¸ªæ°=$#"\n\n\n1\n2\n3\n4\n5\n\n\n\n# 3.6 é¢å®ä¹åé\n\nShell è®¾è®¡èäºåå·²ç»å®ä¹å¥½çåéï¼å¯ä»¥ç´æ¥å¨ Shell èæ¬ä¸­ä½¿ç¨ãä¸å¸¸ç¨ã\n\n# 3.6.1 åºæ¬è¯­æ³\n\n * $$ï¼å½åè¿ç¨çè¿ç¨å·\n * $!ï¼åå°è¿è¡çæåä¸ä¸ªè¿ç¨çè¿ç¨å·\n * $?ï¼æåä¸æ¬¡æ§è¡çå½ä»¤çè¿åç¶æãå¦æè¿ä¸ªåéçå¼ä¸º 0ï¼è¯æä¸ä¸ä¸ªå½ä»¤æ­£ç¡®æ§è¡ï¼å¦æè¿ä¸ªåéçå¼ä¸ºé 0ï¼å·ä½æ¯åªä¸ªæ°ï¼ç±å½ä»¤èªå·±æ¥å³å®ï¼ï¼åè¯æä¸ä¸ä¸ªå½ä»¤æ§è¡ä¸æ­£ç¡®\n\n# 3.6.2 æ¡ä¾\n\n#!/bin/bash\necho "å½åè¿ç¨å·=$$"\n# åå°æ¹å¼è¿è¡ myShell.sh\n./myShell.sh &\necho "æåççè¿ç¨å·=$!"\necho "æ§è¡çå¼=$?"\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 4. è¿ç®ç¬¦\n\nå¨ Shell ä¸­è¿è¡åç§è¿ç®æä½ã\n\n# 4.1 åºæ¬è¯­æ³\n\n * $((è¿ç®å¼)) æ $[è¿ç®å¼]\n * æ expr m + nãæ³¨æ expr è¿ç®ç¬¦é´è¦æç©ºæ ¼ [æ¨èä½¿ç¨]\n   * å¦æå¸æå° expr çç»æèµç»æä¸ªåéï¼ä½¿ç¨åå¼å· `` å°å®ä»¬åå´èµ·æ¥ã\n * expr \\*ï¼/ï¼ % åå«ä»£è¡¨ä¹ï¼é¤ï¼åä½\n   * æ³¨æå¨ä½¿ç¨ expr æ¶ä¹æ³åé¢æä¸ªè½¬ä¹ç¬¦ï¼\\*\n\n# 4.2 æ¡ä¾\n\n#!/bin/bash\n# æ¡ä¾1ï¼è®¡ç®ï¼2+3ï¼X4 çå¼\n# ä½¿ç¨ç¬¬ä¸ç§æ¹å¼\nRES1=$(((2+3)*4))\necho "res1=$RES1"\n# ä½¿ç¨ç¬¬äºç§æ¹å¼ï¼æ¨èï¼\nRES2=$[(2+3)*4]\necho "res2=$RES2"\n# ä½¿ç¨ç¬¬ä¸ç§æ¹å¼ï¼è¾ä¸ºå¤æï¼\nTEMP=`expr 2 + 3`\nRES3=`expr $TEMP \\* 4` \necho "temp=$TEMP"\necho "res3=$RES3"\necho "æ§è¡çå¼=$?"\n# æ¡ä¾2ï¼è¯·æ±åºå½ä»¤è¡çä¸¤ä¸ªåæ°[æ´æ°]çå\nSUM=$[$1+$2]\necho "sum=$SUM"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# 5. æ¡ä»¶å¤æ­\n\n# 5.1 åºæ¬è¯­æ³\n\n[ condition ] ï¼æ³¨æ condition ååè¦æç©ºæ ¼ï¼ï¼éç©ºè¿å trueï¼å¯ä½¿ç¨ $? éªè¯ï¼0 ä¸º trueï¼>1 ä¸º falseï¼\n\n# 5.2 å¸¸ç¨å¤æ­æ¡ä»¶\n\n1ï¼=ï¼å­ç¬¦ä¸²æ¯å¦ç¸ç­\n\n2ï¼ä¸¤ä¸ªæ´æ°çæ¯è¾\n\néé¡¹    å«ä¹\n-lt   å°äº\n-le   å°äºç­äº\n-eq   ç­äº\n-gt   å¤§äº\n-ge   å¤§äºç­äº\n-ne   ä¸ç­äº\n\n3ï¼æç§æä»¶æéè¿è¡å¤æ­\n\néé¡¹   å«ä¹\n-r   æè¯»çæé\n-w   æåçæé\n-x   ææ§è¡çæé\n\n4ï¼æç§æä»¶ç±»åè¿è¡å¤æ­\n\néé¡¹   å«ä¹\n-f   æä»¶å­å¨å¹¶ä¸æ¯ä¸ä¸ªå¸¸è§çæä»¶\n-e   æä»¶å­å¨\n-d   æä»¶å­å¨å¹¶æ¯ä¸ä¸ªç®å½\n\n * æ³¨æä½¿ç¨æ¶ï¼è¿äº - ä¸è½ä¸¢ã\n\n# 3.8.3 æ¡ä¾\n\n#!/bin/bash\n# æ¡ä¾1ï¼âokâæ¯å¦ç­äºâokâ\n# å¤æ­è¯­å¥ï¼æ¯å¦ =\nif [ "ok" = "ok" ]\nthen\n      echo "equal"\nfi\n# æ¡ä¾2ï¼23æ¯å¦å¤§äºç­äº22\n# å¤æ­è¯­å¥ï¼ä½¿ç¨ -ge\nif [ 23 -ge 22 ] \nthen\n      echo "å¤§äº"\nfi\n# æ¡ä¾3ï¼/root/shcode/aaa.txt ç®å½ä¸­çæä»¶æ¯å¦å­å¨\n# å¤æ­è¯­å¥ï¼ä½¿ç¨ -f\nif [ -f /root/shcode/aaa.txt ]\nthen\n      echo "å­å¨"\nfi\n# å¶ä»æ¡ä¾\nif [ edu ]\nthen\n      echo "hello, edu"\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# 6. æµç¨æ§å¶\n\n\n# 6.1 if å¤æ­\n\nif [ æ¡ä»¶å¤æ­å¼ ]\nthen\n      ç¨åº\nelif [ æ¡ä»¶å¤æ­å¼ ]\nthen\n      ç¨åº\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * æ³¨æï¼[ æ¡ä»¶å¤æ­å¼ ] ä¸­æ¬å·åæ¡ä»¶å¤æ­å¼ä¹é´å¿é¡»æç©ºæ ¼ï¼if ä¸ [ ä¹é´ä¹æç©ºæ ¼ã\n\nFor exampleï¼\n\n#!/bin/bash\n# æ¡ä¾ï¼ç¼åä¸ä¸ª Shell ç¨åºï¼å¦æè¾å¥çåæ°ï¼å¤§äºç­äº60ï¼åè¾åºâåæ ¼äºâï¼å¦æå°äº60ï¼åè¾åº âä¸åæ ¼â\nif [ $1 -ge 60 ]\nthen\n      echo "åæ ¼äº"\nelif [ $1 -lt 60 ]\nthen\n      echo "ä¸åæ ¼"\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 6.2 case è¯­å¥\n\ncase $åéå in\n"å¼ 1")\n      å¦æåéçå¼ç­äºå¼ 1ï¼åæ§è¡ç¨åº 1\n;;\n"å¼ 2")\n      å¦æåéçå¼ç­äºå¼ 2ï¼åæ§è¡ç¨åº 2\n;;\n      ...çç¥å¶ä»åæ¯...\n*)\n      å¦æåéçå¼é½ä¸æ¯ä»¥ä¸çå¼ï¼åæ§è¡æ­¤ç¨åº \n;;\nesac\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n> ä¹è®¸ Shell ç¨åºçèµ·æ¥æ¯è¾è¯¡å¼ï¼ä½å½åè®¾è®¡èå°±æ¯è¿ä¹è®¾è®¡çï¼æä»¬ä¹åªéè¦æ¿è®¤å³å¯ã\n\nFor Exampleï¼\n\n#!/bin/bash\n# æ¡ä¾ï¼å½å½ä»¤è¡åæ°æ¯1æ¶ï¼è¾åºâå¨ä¸âï¼æ¯2æ¶ï¼å°±è¾åºâå¨äºâï¼å¶å®æåµè¾åºâotherâ\ncase $1 in\n"1")\n      echo "å¨ä¸"\n;;\n"2")\n      echo "å¨äº"\n;;\n*)\n      echo "other" \n;;\nesac\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 6.3 for å¾ªç¯\n\n\n# ð åºæ¬è¯­æ³ 1\n\nfor åé in å¼1 å¼2 å¼3 ...\ndo\n      ç¨åº\ndone\n\n\n1\n2\n3\n4\n\n\nFor Exampleï¼\n\n#!/bin/bash\n# æ¡ä¾ï¼æå°å½ä»¤è¡è¾å¥çåæ°ãå¯ä»¥çåº $* å $@ çåºå«ã\n# æ³¨æ $* æ¯æè¾å¥çåæ°ï¼å½ä½ä¸ä¸ªæ´ä½ï¼æä»¥åªä¼è¾åºä¸è¡\nfor i in "$*"\ndo\n      echo "num is $i"\ndone\n# ä½¿ç¨ $@ æ¯æè¾å¥çåæ°ï¼åå«å¯¹å¾ï¼æä»¥æå ä¸ªåæ°ï¼å°±ä¼è¾åºå è¡\nfor j in "$@"\ndo\n      echo "num is $j"\ndone\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n * ä»æ­¤æ¡ä¾å¯ä»¥çåº $* å $@ çåºå«\n\n# ð åºæ¬è¯­æ³ 2\n\nfor (( åå§å¼;å¾ªç¯æ§å¶æ¡ä»¶;åéåå ))\ndo\n      ç¨åº\ndone\n\n\n1\n2\n3\n4\n\n\n1 2 3 4\n\nFor Exampleï¼\n\n#!/bin/bash\n# æ¡ä¾ï¼ä»1å å°100çå¼è¾åºæ¾ç¤º\n# å®ä¹ä¸ä¸ªåé SUM\nSUM=0\nfor (( i=1;i<=100;i++ ))\ndo\n      SUM=$[$SUM+i]\ndone\necho "æ»åSUM=$SUM"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 6.4 while å¾ªç¯\n\nwhile [ æ¡ä»¶å¤æ­å¼ ]\ndo\n      ç¨åº\ndone\n\n\n1\n2\n3\n4\n\n * æ³¨æï¼[ æ¡ä»¶å¤æ­å¼ ] ä¸­æ¬å·åæ¡ä»¶å¤æ­å¼ä¹é´å¿é¡»æç©ºæ ¼ï¼while ä¸ [ ä¹é´ä¹æç©ºæ ¼\n\nFor Exampleï¼\n\n#!/bin/bash\n# æ¡ä¾ï¼ä»å½ä»¤è¡è¾å¥ä¸ä¸ªæ° nï¼ç»è®¡ä» 1+...+ n çå¼\nSUM=0\ni=0\nwhile [ $i -le $1 ]\ndo\n      SUM=$[$i+$SUM]\n      i=$[$i+1]\ndone\necho "æ»åSUM=$SUM"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 7. read è¯»åæ§å¶å°è¾å¥\n\nread [éé¡¹] [åæ°]\n\n\n1\n\n * -pï¼æå®è¯»åå¼æ¶çæç¤ºç¬¦ï¼\n * -tï¼æå®è¯»åå¼æ¶ç­å¾çæ¶é´ï¼ç§ï¼ï¼å¦ææ²¡æå¨æå®çæ¶é´åè¾å¥ï¼å°±ä¸åç­å¾äºã\n * åæ°ï¼æå®è¯»åå¼çåéå\n\nFor Exampleï¼\n\n#!/bin/bash\n# æ¡ä¾1ï¼è¯»åæ§å¶å°è¾å¥ä¸ä¸ª NUM1 å¼\nread -p "è¯·è¾å¥ä¸ä¸ªæ°NUM1=" NUM1\necho "æ¨è¾å¥æ°NUM1=$NUM1"\n# æ¡ä¾2ï¼è¯»åæ§å¶å°è¾å¥ä¸ä¸ª NUM2 å¼ï¼å¨ 10 ç§åè¾å¥\nread -t 10 -p "è¯·è¾å¥ä¸ä¸ªæ°NUM2=" NUM2\necho "æ¨è¾å¥æ°NUM2=$NUM2"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 8. å½æ°\n\nshell ç¼ç¨æç³»ç»å½æ°ï¼ä¹å¯ä»¥èªå®ä¹å½æ°ã\n\n\n# 8.1 ç³»ç»å½æ°\n\nè¿éåªæç å¼çå°ä»ç»ä¸¤ä¸ªç³»ç»å½æ°\n\n# 8.1.1 basename å½æ°\n\nåè½ï¼è¿åå®æ´è·¯å¾æå / çé¨åï¼å¸¸ç¨äºè·åæä»¶å\n\n * basename [pathname] [suffix]\n * basename [string] [suffix]ï¼ä¼å æææçåç¼åæ¬æåä¸ä¸ªï¼â/âï¼å­ç¬¦ï¼ç¶åå°å­ç¬¦ä¸²æ¾ç¤ºåºæ¥ã\n\néé¡¹ï¼suffix ä¸ºåç¼ï¼å¦æ suffix è¢«æå®äºï¼basename ä¼å° pathname æ string ä¸­ç suffix å»æã\n\n> æ¡ä¾ï¼è¯·è¿å /home/aaa/test.txt ç test.txt é¨å\n> \n>  * basename /home/aaa/test.txt\n>  * å¦ææä»¬æå®åç¼ suffixï¼å³ basename /home/aaa/test.txt .txtï¼é£ä¹æ¾ç¤ºçåªæ test\n\n# 8.1.2 dirname å½æ°\n\nåè½ï¼è¿åå®æ´è·¯å¾æå / çåé¢çé¨åï¼å¸¸ç¨äºè¿åè·¯å¾é¨åã\n\n * dirname æä»¶ç»å¯¹è·¯å¾ï¼ä»ç»å®çåå«ç»å¯¹è·¯å¾çæä»¶åä¸­å»é¤æä»¶åï¼éç®å½çé¨åï¼ï¼ç¶åè¿åå©ä¸çè·¯å¾ï¼ç®å½çé¨åï¼ã\n\n> æ¡ä¾ï¼è¯·è¿å /home/aaa/test.txt ç /home/aaa é¨å\n> \n>  * dirname /home/aaa/test.txt\n\n\n# 8.2 èªå®ä¹å½æ°\n\n[ function ] funname[()]\n{\n      Action;\n      [return int;]\n}\n\n\n1\n2\n3\n4\n5\n\n\nè°ç¨ç´æ¥åå½æ°åï¼funname [å¼]\n\nFor Exampleï¼\n\n#!/bin/bash\n# æ¡ä¾1ï¼è®¡ç®è¾å¥ä¸¤ä¸ªåæ°çåï¼å¨æè·åï¼ï¼getSum\n# å®ä¹å½æ° getSum\nfunction getSum()\n{\n      SUM=$[$NUM1+$NUM2] \n      echo "åæ¯=$SUM"\n}\n# è¾å¥ä¸¤ä¸ªå¼\nread -p "è¯·è¾å¥ä¸ä¸ªæ°NUM1=" NUM1\nread -p "è¯·è¾å¥ä¸ä¸ªæ°NUM2=" NUM2\n# è°ç¨èªå®ä¹å½æ°\ngetSum $NUM1 $NUM2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n> å¯ä»¥çåºï¼shell ç¼ç¨ä¸æä»¬å¸¸ç¨çç¼ç¨è¯­è¨è¿æ¯ä¸å¤ªä¸æ ·çï¼æ¢ç¶å­¦äºå°±çå¼ä¸ç¹ã\n\n\n# 9. ç»¼åæ¡ä¾\n\néæ±ï¼\n\n * æ¯å¤©åæ¨2:10ï¼å¤ä»½æ°æ®åº hspedu å° /data/backup/db\n * å¤ä»½å¼å§åå¤ä»½ç»æè½å¤ç»åºç¸åºçæç¤ºä¿¡æ¯\n * å¤ä»½åçæä»¶è¦æ±ä»¥å¤ä»½æ¶é´ä¸ºæä»¶åï¼å¹¶æåæ .tar.gz çå½¢å¼ï¼æ¯å¦ï¼2018-03-12_230201.tar.gz\n * å¨å¤ä»½çåæ¶ï¼æ£æ¥æ¯å¦æ 10 å¤©åå¤ä»½çæ°æ®åºæä»¶ï¼å¦ææå°±å°å¶å é¤ã\n * ç¼åä¸ä¸ª Shell èæ¬ã\n\nshell èæ¬ï¼\n\n#!/bin/bash\n#å®ææ°æ®åºçå®æ¶å¤ä»½\n#å¤ä»½çè·¯å¾\nBACKUP=/data/backup/db\n#å½åçæ¶é´ä½ä¸ºæä»¶å\nDATETIME=$(date +%Y-%m-%d_%H%M%S)\n#å¯ä»¥è¾åºåéè°è¯\n#echo ${DATETIME}\necho "======================å¼å§å¤ä»½=========================="\necho "========å¤ä»½çè·¯å¾ä¸º $BACKUP/$DATETIME.tar.gz =========="\n#æ°æ®åºå°å\nHOST=localhost\n#æ°æ®åºç¨æ·å\nDB_USER=root\n#æ°æ®åºå¯ç \nDB_PW=root\n#å¤ä»½æ°æ®åºå\nDATABASE=hspedu\n#åå»ºå¤ä»½çæä»¶å¤¹\n#å¦æè¯¥å¤ä»½çæä»¶å¤¹æåä½¿ç¨ï¼æ²¡æå°±éæ°åå»ºä¸ä¸ªã\n#-pï¼è¡¨ç¤ºéå½åå»ºç®å½ï¼æèè¯´åå»ºå¤çº§ç®å½ã\n[ ! -d "${BACKUP}/${DATETIME}"] && mkdir -p "${BACKUP}/${DATETIME}"\n#æ§è¡ MySQL å¤ä»½æ°æ®åºçæä»¤\nmysqldump -u${DB_USER} -p${DB_PW} --host=${HOST} ${DATABASE} | gzip > ${BACKUP}/${DATETIME}/$DATETIME.sql.gz\n#å°æä»¶å¤çæ tar.gz\ncd ${BACKUP}\ntar -zcvf $DATETIME.tar.gz ${DATETIME}\n# å é¤å¯¹åºçå¤ä»½ç®å½\nrm -rf ${BACKUP}/${DATETIME}\n#å é¤10å¤©åçå¤ä»½æä»¶\nfind ${BACKUP} -atime +10 -name "*.tar.gz" -exec rm -rf {} \\;\necho "=====================å¤ä»½æä»¶æå========================="\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nè¿è¡ crontab -e æä»¤ï¼å¢å ä¸é¢å½ä»¤ï¼ç»å°¾åæ è¦åçå¨ h ä¸ï¼ï¼ç¨äºå®æ¶è°ç¨ä¸é¢ç Shell èæ¬ï¼\n\n10 2 * * * /usr/sbin/mysql_db_backup.sh\n\n\n1\n',normalizedContent:'# 1. shell æ¦è¿°\n\n\n# 1.1 ä¸ºä»ä¹è¦å­¦ä¹  shell ç¼ç¨\n\n * linux è¿ç»´å·¥ç¨å¸å¨è¿è¡æå¡å¨éç¾¤ç®¡çæ¶ï¼éè¦ç¼å shell ç¨åºæ¥è¿è¡æå¡å¨ç®¡çã\n * å¯¹äº javaee å python ç¨åºåæ¥è¯´ï¼å·¥ä½çéè¦ï¼ä¼è¦æ±ä½ ç¼åä¸äº shell èæ¬è¿è¡ç¨åºæèæ¯æå¡å¨çç»´æ¤ï¼æ¯å¦ç¼åä¸ä¸ªå®æ¶å¤ä»½æ°æ®åºçèæ¬ã\n * å¯¹äºå¤§æ°æ®ç¨åºåæ¥è¯´ï¼éè¦ç¼å shell ç¨åºæ¥ç®¡çéç¾¤ã\n\n\n# 1.2 shell æ¯ä»ä¹\n\nshell æ¯ä¸ä¸ªå½ä»¤è¡è§£éå¨ï¼å®ä¸ºç¨æ·æä¾äºä¸ä¸ªå linux åæ ¸åéè¯·æ±ä»¥ä¾¿è¿è¡ç¨åºççé¢ç³»ç»çº§ç¨åºï¼ç¨æ·å¯ä»¥ç¨ shell æ¥å¯å¨ãæèµ·ãåæ­¢çè³æ¯ç¼åä¸äºç¨åºã\n\n\n# 2. shell èæ¬çæ§è¡æ¹å¼\n\n\n# 2.1 èæ¬æ ¼å¼è¦æ±\n\nèæ¬ä»¥ #!/bin/bash å¼å¤´ï¼éè¦æå¯æ§è¡æéã\n\n\n# 2.2 ç¼åç¬¬ä¸ä¸ª shell èæ¬\n\néæ±ï¼åå»ºä¸ä¸ª shell èæ¬ï¼è¾åº hello worldï¼\n\nvim hello.sh\n#!/bin/bash\necho "hello,world~"\n\n\n1\n2\n3\n\n\n\n# 2.3 èæ¬çå¸¸ç¨æ§è¡æ¹å¼\n\n# ð æ¹å¼ä¸ï¼è¾å¥èæ¬çç»å¯¹è·¯å¾æç¸å¯¹è·¯å¾\n\nè¯´æï¼é¦åè¦èµäºèæ¬ +x çæéï¼åæ§è¡èæ¬\n\n# ð æ¹å¼äºï¼sh + èæ¬\n\nè¯´æï¼ä¸ç¨èµäºèæ¬+x æéï¼ç´æ¥æ§è¡å³å¯\n\næ¯å¦ sh hello.sh\n\n\n# 3. shell çåé\n\n\n# 3.1 shell åéä»ç»\n\n * shell åéåä¸ºç³»ç»åéåç¨æ·èªå®ä¹åéã\n * ç³»ç»åéï¼$homeã$pwdã$shellã$user ç­ç­ï¼æ¯å¦ï¼echo $home ç­ç­ã\n * æ¾ç¤º shell ææç³»ç»åéï¼set æä»¤\n\n\n# 3.2 shell åéå®ä¹\n\n# åºæ¬è¯­æ³ï¼\n\n * å®ä¹åéï¼åéå=å¼\n   * æ³¨æå¨ shell ç¼ç¨ä¸­ï¼è¿ç§ç­å·çä¸¤è¾¹ä¸è¦æç©ºæ ¼ã\n * æ¤éåéï¼unset åé\n * å£°æéæåéï¼readonly åéï¼æ³¨æä¸è½ unset\n\n# å¿«éå¥é¨ï¼\n\n#!/bin/bash\n\n# æ¡ä¾ 1ï¼å®ä¹åé a\na=100\n# è¾åºåééè¦å ä¸ $\necho a=$a\necho "a=$a"\n# æ¡ä¾ 2ï¼æ¤éåé a\nunset a\necho "a=$a"\n# æ¡ä¾ 3ï¼å£°æéæçåé b=2ï¼ä¸è½æ¤é\nreadonly b=2\necho "b=$b"\n# æ­¤æ¶å¦æ unset bï¼æ§è¡æ¶ä¼æ¥é\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nvim ä¸­ä¸´æ¶æ¾ç¤ºè¡å·ï¼:nu vim ä¸­æ¾ç¤ºè¡å·ï¼:set nu\n\n# è¡¥åï¼shell èæ¬çæ³¨éï¼\n\n * åè¡æ³¨éï¼#\n * å¤è¡æ³¨éï¼\n\n:<<!\néè¦æ³¨éçç¬¬ä¸è¡åå®¹\néè¦æ³¨éçç¬¬äºè¡åå®¹\n!\n\n\n1\n2\n3\n4\n\n\n\n# 3.3 shell åéçå®ä¹\n\n# å®ä¹åéçè§åï¼\n\n * åéåç§°å¯ä»¥ç±å­æ¯ãæ°å­åä¸åçº¿ç»æï¼ä½æ¯ä¸è½ä»¥æ°å­å¼å¤´ã\n * ç­å·ä¸¤ä¾§ä¸è½æç©ºæ ¼\n * åéåç§°ä¸è¬ä¹ æ¯ä¸ºå¤§åï¼è¿æ¯ä¸ä¸ªè§èï¼éµå®å³å¯\n\n# å°å½ä»¤çè¿åå¼èµç»åéï¼\n\n * a=dateï¼éè¿åå¼å·ï¼è¿è¡éé¢çå½ä»¤ï¼å¹¶æç»æè¿åç»åé a\n * a=$(date) ç­ä»·äºåå¼å·\n\n\n# 3.4 è®¾ç½®ç¯å¢åé\n\n# åºæ¬è¯­æ³ï¼\n\n * export åéå=åéå¼ï¼å° shell åéè¾åºä¸ºç¯å¢åé\n * source éç½®æä»¶ï¼è®©ä¿®æ¹åçéç½®æä»¶ç«å³çæ\n * echo $åéåï¼æ¥è¯¢ç¯å¢åéçå¼\n\n# å¿«éå¥é¨ï¼\n\n# éè¿ç¼è¾ /etc/profile æä»¶éç½® jdk ç¯å¢åéï¼è¦å¢å ä»¥ä¸å½ä»¤\nexport java_home=/usr/local/java/jdk1.8.0_261\nexport path=$java_home/bin:$path\n# ä¿å­éåº /etc/profile æä»¶åï¼æ§è¡ source /etc/profile å½ä»¤ä½¿ä¿®æ¹åçéç½®æä»¶çæ\n\n\n1\n2\n3\n4\n\n\n> å¨ /etc/profile æä»¶ä¸­è®¾ç½®çåéæ¯å¨å±åéãè .bashrcæä»¶ï¼å¨ç¨æ·çå®¶ç®å½ä¸ï¼ååªå¯¹å½åç¨æ·æç¨ã~/.bashrcã~/.bash_file æ¯å½åç¨æ·ç®å½ä¸çéç½®ä¿¡æ¯ãä¿®æ¹åç¨ source å½ä»¤æ´æ°ã\n\n\n# 3.5 ä½ç½®åæ°åé\n\nå½æä»¬æ§è¡ä¸ä¸ª shell èæ¬æ¶ï¼å¦æå¸æè·åå°å½ä»¤è¡çåæ°ä¿¡æ¯ï¼å°±å¯ä»¥ä½¿ç¨å°ä½ç½®åæ°åéï¼æ¯å¦ ./myshell.sh 100 200 , è¿ä¸ªå°±æ¯ä¸ä¸ªæ§è¡ shell çå½ä»¤è¡ï¼å¯ä»¥å¨ myshell èæ¬ä¸­è·åå°åæ°ä¿¡æ¯ã\n\n# 3.5.1 åºæ¬è¯­æ³\n\n * $nï¼n ä¸ºæ°å­ï¼$0 ä»£è¡¨å½ä»¤æ¬èº«ï¼$1-$9 ä»£è¡¨ç¬¬ä¸å°ç¬¬ä¹ä¸ªåæ°ï¼åä»¥ä¸çåæ°éè¦ç¨å¤§æ¬å·ï¼å¦ ${10}\n * $*ï¼ä»£è¡¨å½ä»¤è¡ä¸­ææçåæ°ï¼$* æææçåæ°çæä¸ä¸ªæ´ä½\n * $@ï¼ä»£è¡¨å½ä»¤è¡ä¸­ææçåæ°ï¼ä¸è¿è¯¥å½ä»¤æ¯ææ¯ä¸ªåæ°åºåå¯¹å¾\n * $#ï¼ä»£è¡¨å½ä»¤è¡ä¸­ææåæ°çä¸ªæ°\n\n# 3.5.2 æ¡ä¾\n\næ¡ä¾ï¼å¨èæ¬ä¸­è·åå°å½ä»¤è¡çåä¸ªåæ°ä¿¡æ¯\n\n#!/bin/bash\necho "0=$0 1=$1 2=$2"\necho "å½ä»¤è¡ææä¼ å¥çåæ°=$*"\necho "$@"\necho "åæ°çä¸ªæ°=$#"\n\n\n1\n2\n3\n4\n5\n\n\n\n# 3.6 é¢å®ä¹åé\n\nshell è®¾è®¡èäºåå·²ç»å®ä¹å¥½çåéï¼å¯ä»¥ç´æ¥å¨ shell èæ¬ä¸­ä½¿ç¨ãä¸å¸¸ç¨ã\n\n# 3.6.1 åºæ¬è¯­æ³\n\n * $$ï¼å½åè¿ç¨çè¿ç¨å·\n * $!ï¼åå°è¿è¡çæåä¸ä¸ªè¿ç¨çè¿ç¨å·\n * $?ï¼æåä¸æ¬¡æ§è¡çå½ä»¤çè¿åç¶æãå¦æè¿ä¸ªåéçå¼ä¸º 0ï¼è¯æä¸ä¸ä¸ªå½ä»¤æ­£ç¡®æ§è¡ï¼å¦æè¿ä¸ªåéçå¼ä¸ºé 0ï¼å·ä½æ¯åªä¸ªæ°ï¼ç±å½ä»¤èªå·±æ¥å³å®ï¼ï¼åè¯æä¸ä¸ä¸ªå½ä»¤æ§è¡ä¸æ­£ç¡®\n\n# 3.6.2 æ¡ä¾\n\n#!/bin/bash\necho "å½åè¿ç¨å·=$$"\n# åå°æ¹å¼è¿è¡ myshell.sh\n./myshell.sh &\necho "æåççè¿ç¨å·=$!"\necho "æ§è¡çå¼=$?"\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 4. è¿ç®ç¬¦\n\nå¨ shell ä¸­è¿è¡åç§è¿ç®æä½ã\n\n# 4.1 åºæ¬è¯­æ³\n\n * $((è¿ç®å¼)) æ $[è¿ç®å¼]\n * æ expr m + nãæ³¨æ expr è¿ç®ç¬¦é´è¦æç©ºæ ¼ [æ¨èä½¿ç¨]\n   * å¦æå¸æå° expr çç»æèµç»æä¸ªåéï¼ä½¿ç¨åå¼å· `` å°å®ä»¬åå´èµ·æ¥ã\n * expr \\*ï¼/ï¼ % åå«ä»£è¡¨ä¹ï¼é¤ï¼åä½\n   * æ³¨æå¨ä½¿ç¨ expr æ¶ä¹æ³åé¢æä¸ªè½¬ä¹ç¬¦ï¼\\*\n\n# 4.2 æ¡ä¾\n\n#!/bin/bash\n# æ¡ä¾1ï¼è®¡ç®ï¼2+3ï¼x4 çå¼\n# ä½¿ç¨ç¬¬ä¸ç§æ¹å¼\nres1=$(((2+3)*4))\necho "res1=$res1"\n# ä½¿ç¨ç¬¬äºç§æ¹å¼ï¼æ¨èï¼\nres2=$[(2+3)*4]\necho "res2=$res2"\n# ä½¿ç¨ç¬¬ä¸ç§æ¹å¼ï¼è¾ä¸ºå¤æï¼\ntemp=`expr 2 + 3`\nres3=`expr $temp \\* 4` \necho "temp=$temp"\necho "res3=$res3"\necho "æ§è¡çå¼=$?"\n# æ¡ä¾2ï¼è¯·æ±åºå½ä»¤è¡çä¸¤ä¸ªåæ°[æ´æ°]çå\nsum=$[$1+$2]\necho "sum=$sum"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# 5. æ¡ä»¶å¤æ­\n\n# 5.1 åºæ¬è¯­æ³\n\n[ condition ] ï¼æ³¨æ condition ååè¦æç©ºæ ¼ï¼ï¼éç©ºè¿å trueï¼å¯ä½¿ç¨ $? éªè¯ï¼0 ä¸º trueï¼>1 ä¸º falseï¼\n\n# 5.2 å¸¸ç¨å¤æ­æ¡ä»¶\n\n1ï¼=ï¼å­ç¬¦ä¸²æ¯å¦ç¸ç­\n\n2ï¼ä¸¤ä¸ªæ´æ°çæ¯è¾\n\néé¡¹    å«ä¹\n-lt   å°äº\n-le   å°äºç­äº\n-eq   ç­äº\n-gt   å¤§äº\n-ge   å¤§äºç­äº\n-ne   ä¸ç­äº\n\n3ï¼æç§æä»¶æéè¿è¡å¤æ­\n\néé¡¹   å«ä¹\n-r   æè¯»çæé\n-w   æåçæé\n-x   ææ§è¡çæé\n\n4ï¼æç§æä»¶ç±»åè¿è¡å¤æ­\n\néé¡¹   å«ä¹\n-f   æä»¶å­å¨å¹¶ä¸æ¯ä¸ä¸ªå¸¸è§çæä»¶\n-e   æä»¶å­å¨\n-d   æä»¶å­å¨å¹¶æ¯ä¸ä¸ªç®å½\n\n * æ³¨æä½¿ç¨æ¶ï¼è¿äº - ä¸è½ä¸¢ã\n\n# 3.8.3 æ¡ä¾\n\n#!/bin/bash\n# æ¡ä¾1ï¼âokâæ¯å¦ç­äºâokâ\n# å¤æ­è¯­å¥ï¼æ¯å¦ =\nif [ "ok" = "ok" ]\nthen\n      echo "equal"\nfi\n# æ¡ä¾2ï¼23æ¯å¦å¤§äºç­äº22\n# å¤æ­è¯­å¥ï¼ä½¿ç¨ -ge\nif [ 23 -ge 22 ] \nthen\n      echo "å¤§äº"\nfi\n# æ¡ä¾3ï¼/root/shcode/aaa.txt ç®å½ä¸­çæä»¶æ¯å¦å­å¨\n# å¤æ­è¯­å¥ï¼ä½¿ç¨ -f\nif [ -f /root/shcode/aaa.txt ]\nthen\n      echo "å­å¨"\nfi\n# å¶ä»æ¡ä¾\nif [ edu ]\nthen\n      echo "hello, edu"\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# 6. æµç¨æ§å¶\n\n\n# 6.1 if å¤æ­\n\nif [ æ¡ä»¶å¤æ­å¼ ]\nthen\n      ç¨åº\nelif [ æ¡ä»¶å¤æ­å¼ ]\nthen\n      ç¨åº\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * æ³¨æï¼[ æ¡ä»¶å¤æ­å¼ ] ä¸­æ¬å·åæ¡ä»¶å¤æ­å¼ä¹é´å¿é¡»æç©ºæ ¼ï¼if ä¸ [ ä¹é´ä¹æç©ºæ ¼ã\n\nfor exampleï¼\n\n#!/bin/bash\n# æ¡ä¾ï¼ç¼åä¸ä¸ª shell ç¨åºï¼å¦æè¾å¥çåæ°ï¼å¤§äºç­äº60ï¼åè¾åºâåæ ¼äºâï¼å¦æå°äº60ï¼åè¾åº âä¸åæ ¼â\nif [ $1 -ge 60 ]\nthen\n      echo "åæ ¼äº"\nelif [ $1 -lt 60 ]\nthen\n      echo "ä¸åæ ¼"\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 6.2 case è¯­å¥\n\ncase $åéå in\n"å¼ 1")\n      å¦æåéçå¼ç­äºå¼ 1ï¼åæ§è¡ç¨åº 1\n;;\n"å¼ 2")\n      å¦æåéçå¼ç­äºå¼ 2ï¼åæ§è¡ç¨åº 2\n;;\n      ...çç¥å¶ä»åæ¯...\n*)\n      å¦æåéçå¼é½ä¸æ¯ä»¥ä¸çå¼ï¼åæ§è¡æ­¤ç¨åº \n;;\nesac\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n> ä¹è®¸ shell ç¨åºçèµ·æ¥æ¯è¾è¯¡å¼ï¼ä½å½åè®¾è®¡èå°±æ¯è¿ä¹è®¾è®¡çï¼æä»¬ä¹åªéè¦æ¿è®¤å³å¯ã\n\nfor exampleï¼\n\n#!/bin/bash\n# æ¡ä¾ï¼å½å½ä»¤è¡åæ°æ¯1æ¶ï¼è¾åºâå¨ä¸âï¼æ¯2æ¶ï¼å°±è¾åºâå¨äºâï¼å¶å®æåµè¾åºâotherâ\ncase $1 in\n"1")\n      echo "å¨ä¸"\n;;\n"2")\n      echo "å¨äº"\n;;\n*)\n      echo "other" \n;;\nesac\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 6.3 for å¾ªç¯\n\n\n# ð åºæ¬è¯­æ³ 1\n\nfor åé in å¼1 å¼2 å¼3 ...\ndo\n      ç¨åº\ndone\n\n\n1\n2\n3\n4\n\n\nfor exampleï¼\n\n#!/bin/bash\n# æ¡ä¾ï¼æå°å½ä»¤è¡è¾å¥çåæ°ãå¯ä»¥çåº $* å $@ çåºå«ã\n# æ³¨æ $* æ¯æè¾å¥çåæ°ï¼å½ä½ä¸ä¸ªæ´ä½ï¼æä»¥åªä¼è¾åºä¸è¡\nfor i in "$*"\ndo\n      echo "num is $i"\ndone\n# ä½¿ç¨ $@ æ¯æè¾å¥çåæ°ï¼åå«å¯¹å¾ï¼æä»¥æå ä¸ªåæ°ï¼å°±ä¼è¾åºå è¡\nfor j in "$@"\ndo\n      echo "num is $j"\ndone\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n * ä»æ­¤æ¡ä¾å¯ä»¥çåº $* å $@ çåºå«\n\n# ð åºæ¬è¯­æ³ 2\n\nfor (( åå§å¼;å¾ªç¯æ§å¶æ¡ä»¶;åéåå ))\ndo\n      ç¨åº\ndone\n\n\n1\n2\n3\n4\n\n\n1 2 3 4\n\nfor exampleï¼\n\n#!/bin/bash\n# æ¡ä¾ï¼ä»1å å°100çå¼è¾åºæ¾ç¤º\n# å®ä¹ä¸ä¸ªåé sum\nsum=0\nfor (( i=1;i<=100;i++ ))\ndo\n      sum=$[$sum+i]\ndone\necho "æ»åsum=$sum"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 6.4 while å¾ªç¯\n\nwhile [ æ¡ä»¶å¤æ­å¼ ]\ndo\n      ç¨åº\ndone\n\n\n1\n2\n3\n4\n\n * æ³¨æï¼[ æ¡ä»¶å¤æ­å¼ ] ä¸­æ¬å·åæ¡ä»¶å¤æ­å¼ä¹é´å¿é¡»æç©ºæ ¼ï¼while ä¸ [ ä¹é´ä¹æç©ºæ ¼\n\nfor exampleï¼\n\n#!/bin/bash\n# æ¡ä¾ï¼ä»å½ä»¤è¡è¾å¥ä¸ä¸ªæ° nï¼ç»è®¡ä» 1+...+ n çå¼\nsum=0\ni=0\nwhile [ $i -le $1 ]\ndo\n      sum=$[$i+$sum]\n      i=$[$i+1]\ndone\necho "æ»åsum=$sum"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 7. read è¯»åæ§å¶å°è¾å¥\n\nread [éé¡¹] [åæ°]\n\n\n1\n\n * -pï¼æå®è¯»åå¼æ¶çæç¤ºç¬¦ï¼\n * -tï¼æå®è¯»åå¼æ¶ç­å¾çæ¶é´ï¼ç§ï¼ï¼å¦ææ²¡æå¨æå®çæ¶é´åè¾å¥ï¼å°±ä¸åç­å¾äºã\n * åæ°ï¼æå®è¯»åå¼çåéå\n\nfor exampleï¼\n\n#!/bin/bash\n# æ¡ä¾1ï¼è¯»åæ§å¶å°è¾å¥ä¸ä¸ª num1 å¼\nread -p "è¯·è¾å¥ä¸ä¸ªæ°num1=" num1\necho "æ¨è¾å¥æ°num1=$num1"\n# æ¡ä¾2ï¼è¯»åæ§å¶å°è¾å¥ä¸ä¸ª num2 å¼ï¼å¨ 10 ç§åè¾å¥\nread -t 10 -p "è¯·è¾å¥ä¸ä¸ªæ°num2=" num2\necho "æ¨è¾å¥æ°num2=$num2"\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 8. å½æ°\n\nshell ç¼ç¨æç³»ç»å½æ°ï¼ä¹å¯ä»¥èªå®ä¹å½æ°ã\n\n\n# 8.1 ç³»ç»å½æ°\n\nè¿éåªæç å¼çå°ä»ç»ä¸¤ä¸ªç³»ç»å½æ°\n\n# 8.1.1 basename å½æ°\n\nåè½ï¼è¿åå®æ´è·¯å¾æå / çé¨åï¼å¸¸ç¨äºè·åæä»¶å\n\n * basename [pathname] [suffix]\n * basename [string] [suffix]ï¼ä¼å æææçåç¼åæ¬æåä¸ä¸ªï¼â/âï¼å­ç¬¦ï¼ç¶åå°å­ç¬¦ä¸²æ¾ç¤ºåºæ¥ã\n\néé¡¹ï¼suffix ä¸ºåç¼ï¼å¦æ suffix è¢«æå®äºï¼basename ä¼å° pathname æ string ä¸­ç suffix å»æã\n\n> æ¡ä¾ï¼è¯·è¿å /home/aaa/test.txt ç test.txt é¨å\n> \n>  * basename /home/aaa/test.txt\n>  * å¦ææä»¬æå®åç¼ suffixï¼å³ basename /home/aaa/test.txt .txtï¼é£ä¹æ¾ç¤ºçåªæ test\n\n# 8.1.2 dirname å½æ°\n\nåè½ï¼è¿åå®æ´è·¯å¾æå / çåé¢çé¨åï¼å¸¸ç¨äºè¿åè·¯å¾é¨åã\n\n * dirname æä»¶ç»å¯¹è·¯å¾ï¼ä»ç»å®çåå«ç»å¯¹è·¯å¾çæä»¶åä¸­å»é¤æä»¶åï¼éç®å½çé¨åï¼ï¼ç¶åè¿åå©ä¸çè·¯å¾ï¼ç®å½çé¨åï¼ã\n\n> æ¡ä¾ï¼è¯·è¿å /home/aaa/test.txt ç /home/aaa é¨å\n> \n>  * dirname /home/aaa/test.txt\n\n\n# 8.2 èªå®ä¹å½æ°\n\n[ function ] funname[()]\n{\n      action;\n      [return int;]\n}\n\n\n1\n2\n3\n4\n5\n\n\nè°ç¨ç´æ¥åå½æ°åï¼funname [å¼]\n\nfor exampleï¼\n\n#!/bin/bash\n# æ¡ä¾1ï¼è®¡ç®è¾å¥ä¸¤ä¸ªåæ°çåï¼å¨æè·åï¼ï¼getsum\n# å®ä¹å½æ° getsum\nfunction getsum()\n{\n      sum=$[$num1+$num2] \n      echo "åæ¯=$sum"\n}\n# è¾å¥ä¸¤ä¸ªå¼\nread -p "è¯·è¾å¥ä¸ä¸ªæ°num1=" num1\nread -p "è¯·è¾å¥ä¸ä¸ªæ°num2=" num2\n# è°ç¨èªå®ä¹å½æ°\ngetsum $num1 $num2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n> å¯ä»¥çåºï¼shell ç¼ç¨ä¸æä»¬å¸¸ç¨çç¼ç¨è¯­è¨è¿æ¯ä¸å¤ªä¸æ ·çï¼æ¢ç¶å­¦äºå°±çå¼ä¸ç¹ã\n\n\n# 9. ç»¼åæ¡ä¾\n\néæ±ï¼\n\n * æ¯å¤©åæ¨2:10ï¼å¤ä»½æ°æ®åº hspedu å° /data/backup/db\n * å¤ä»½å¼å§åå¤ä»½ç»æè½å¤ç»åºç¸åºçæç¤ºä¿¡æ¯\n * å¤ä»½åçæä»¶è¦æ±ä»¥å¤ä»½æ¶é´ä¸ºæä»¶åï¼å¹¶æåæ .tar.gz çå½¢å¼ï¼æ¯å¦ï¼2018-03-12_230201.tar.gz\n * å¨å¤ä»½çåæ¶ï¼æ£æ¥æ¯å¦æ 10 å¤©åå¤ä»½çæ°æ®åºæä»¶ï¼å¦ææå°±å°å¶å é¤ã\n * ç¼åä¸ä¸ª shell èæ¬ã\n\nshell èæ¬ï¼\n\n#!/bin/bash\n#å®ææ°æ®åºçå®æ¶å¤ä»½\n#å¤ä»½çè·¯å¾\nbackup=/data/backup/db\n#å½åçæ¶é´ä½ä¸ºæä»¶å\ndatetime=$(date +%y-%m-%d_%h%m%s)\n#å¯ä»¥è¾åºåéè°è¯\n#echo ${datetime}\necho "======================å¼å§å¤ä»½=========================="\necho "========å¤ä»½çè·¯å¾ä¸º $backup/$datetime.tar.gz =========="\n#æ°æ®åºå°å\nhost=localhost\n#æ°æ®åºç¨æ·å\ndb_user=root\n#æ°æ®åºå¯ç \ndb_pw=root\n#å¤ä»½æ°æ®åºå\ndatabase=hspedu\n#åå»ºå¤ä»½çæä»¶å¤¹\n#å¦æè¯¥å¤ä»½çæä»¶å¤¹æåä½¿ç¨ï¼æ²¡æå°±éæ°åå»ºä¸ä¸ªã\n#-pï¼è¡¨ç¤ºéå½åå»ºç®å½ï¼æèè¯´åå»ºå¤çº§ç®å½ã\n[ ! -d "${backup}/${datetime}"] && mkdir -p "${backup}/${datetime}"\n#æ§è¡ mysql å¤ä»½æ°æ®åºçæä»¤\nmysqldump -u${db_user} -p${db_pw} --host=${host} ${database} | gzip > ${backup}/${datetime}/$datetime.sql.gz\n#å°æä»¶å¤çæ tar.gz\ncd ${backup}\ntar -zcvf $datetime.tar.gz ${datetime}\n# å é¤å¯¹åºçå¤ä»½ç®å½\nrm -rf ${backup}/${datetime}\n#å é¤10å¤©åçå¤ä»½æä»¶\nfind ${backup} -atime +10 -name "*.tar.gz" -exec rm -rf {} \\;\necho "=====================å¤ä»½æä»¶æå========================="\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nè¿è¡ crontab -e æä»¤ï¼å¢å ä¸é¢å½ä»¤ï¼ç»å°¾åæ è¦åçå¨ h ä¸ï¼ï¼ç¨äºå®æ¶è°ç¨ä¸é¢ç shell èæ¬ï¼\n\n10 2 * * * /usr/sbin/mysql_db_backup.sh\n\n\n1\n',charsets:{cjk:!0},lastUpdated:"2022/08/22, 08:23:58",lastUpdatedTimestamp:1661156638e3},{title:"å¸¦ä½ å®ç°Linuxå½ä»¤èªç±",frontmatter:{title:"å¸¦ä½ å®ç°Linuxå½ä»¤èªç±",date:"2022-09-09T10:05:35.000Z",permalink:"/pages/dd2e0e/",categories:["åºç¡","Linux","Fromå¬ä¼å·"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/10.Linux/10.From%E5%85%AC%E4%BC%97%E5%8F%B7/5.%E5%B8%A6%E4%BD%A0%E5%AE%9E%E7%8E%B0Linux%E5%91%BD%E4%BB%A4%E8%87%AA%E7%94%B1.html",relativePath:"åºç¡/10.Linux/10.Fromå¬ä¼å·/5.å¸¦ä½ å®ç°Linuxå½ä»¤èªç±.md",key:"v-02285212",path:"/pages/dd2e0e/",headers:[{level:2,title:"ç®å½",slug:"ç®å½",normalizedTitle:"ç®å½",charIndex:2},{level:2,title:"ä»ä¹æ¯ Linux",slug:"ä»ä¹æ¯-linux",normalizedTitle:"ä»ä¹æ¯ linux",charIndex:9},{level:3,title:"Linux ç³»ç»åæ ¸ä¸ Linux åè¡å¥ä»¶çåºå«",slug:"linux-ç³»ç»åæ ¸ä¸-linux-åè¡å¥ä»¶çåºå«",normalizedTitle:"linux ç³»ç»åæ ¸ä¸ linux åè¡å¥ä»¶çåºå«",charIndex:28},{level:3,title:"Linux ç³»ç»ç§ç±»",slug:"linux-ç³»ç»ç§ç±»",normalizedTitle:"linux ç³»ç»ç§ç±»",charIndex:63},{level:2,title:"Shell",slug:"shell",normalizedTitle:"shell",charIndex:78},{level:2,title:"å½ä»¤",slug:"å½ä»¤",normalizedTitle:"å½ä»¤",charIndex:88},{level:3,title:"å½ä»¤è¡æç¤ºç¬¦",slug:"å½ä»¤è¡æç¤ºç¬¦",normalizedTitle:"å½ä»¤è¡æç¤ºç¬¦",charIndex:100},{level:2,title:"æä»¶åç®å½",slug:"æä»¶åç®å½",normalizedTitle:"æä»¶åç®å½",charIndex:111},{level:3,title:"æä»¶çç»ç»",slug:"æä»¶çç»ç»",normalizedTitle:"æä»¶çç»ç»",charIndex:126},{level:3,title:"æ¥çè·¯å¾",slug:"æ¥çè·¯å¾",normalizedTitle:"æ¥çè·¯å¾",charIndex:141},{level:4,title:"pwd",slug:"pwd",normalizedTitle:"pwd",charIndex:159},{level:4,title:"which",slug:"which",normalizedTitle:"which",charIndex:176},{level:3,title:"æµè§ååæ¢ç®å½",slug:"æµè§ååæ¢ç®å½",normalizedTitle:"æµè§ååæ¢ç®å½",charIndex:191},{level:4,title:"ls",slug:"ls",normalizedTitle:"ls",charIndex:212},{level:4,title:"cd",slug:"cd",normalizedTitle:"cd",charIndex:228},{level:4,title:"du",slug:"du",normalizedTitle:"du",charIndex:244},{level:3,title:"æµè§ååå»ºæä»¶",slug:"æµè§ååå»ºæä»¶",normalizedTitle:"æµè§ååå»ºæä»¶",charIndex:256},{level:4,title:"cat",slug:"cat",normalizedTitle:"cat",charIndex:277},{level:4,title:"less",slug:"less",normalizedTitle:"less",charIndex:294},{level:4,title:"head",slug:"head",normalizedTitle:"head",charIndex:312},{level:4,title:"tail",slug:"tail",normalizedTitle:"tail",charIndex:330},{level:4,title:"touch",slug:"touch",normalizedTitle:"touch",charIndex:348},{level:4,title:"mkdir",slug:"mkdir",normalizedTitle:"mkdir",charIndex:367},{level:3,title:"æä»¶çå¤å¶åç§»å¨",slug:"æä»¶çå¤å¶åç§»å¨",normalizedTitle:"æä»¶çå¤å¶åç§»å¨",charIndex:382},{level:4,title:"cp",slug:"cp",normalizedTitle:"cp",charIndex:404},{level:4,title:"mv",slug:"mv",normalizedTitle:"mv",charIndex:420},{level:3,title:"æä»¶çå é¤åé¾æ¥",slug:"æä»¶çå é¤åé¾æ¥",normalizedTitle:"æä»¶çå é¤åé¾æ¥",charIndex:432},{level:4,title:"rm",slug:"rm",normalizedTitle:"rm",charIndex:454},{level:4,title:"ln",slug:"ln",normalizedTitle:"ln",charIndex:470},{level:4,title:"ç¡¬é¾æ¥",slug:"ç¡¬é¾æ¥",normalizedTitle:"ç¡¬é¾æ¥",charIndex:486},{level:4,title:"è½¯é¾æ¥",slug:"è½¯é¾æ¥",normalizedTitle:"è½¯é¾æ¥",charIndex:503},{level:2,title:"ç¨æ·ä¸æé",slug:"ç¨æ·ä¸æé",normalizedTitle:"ç¨æ·ä¸æé",charIndex:511},{level:3,title:"ç¨æ·",slug:"ç¨æ·",normalizedTitle:"ç¨æ·",charIndex:511},{level:4,title:"sudo",slug:"sudo",normalizedTitle:"sudo",charIndex:542},{level:4,title:"useradd + passwd",slug:"useradd-passwd",normalizedTitle:"useradd + passwd",charIndex:560},{level:4,title:"userdel",slug:"userdel",normalizedTitle:"userdel",charIndex:590},{level:4,title:"su",slug:"su",normalizedTitle:"su",charIndex:542},{level:3,title:"ç¾¤ç»çç®¡ç",slug:"ç¾¤ç»çç®¡ç",normalizedTitle:"ç¾¤ç»çç®¡ç",charIndex:623},{level:4,title:"groupadd",slug:"groupadd",normalizedTitle:"groupadd",charIndex:642},{level:4,title:"groupdel",slug:"groupdel",normalizedTitle:"groupdel",charIndex:664},{level:4,title:"groups",slug:"groups",normalizedTitle:"groups",charIndex:686},{level:4,title:"usermod",slug:"usermod",normalizedTitle:"usermod",charIndex:706},{level:4,title:"chgrp",slug:"chgrp",normalizedTitle:"chgrp",charIndex:727},{level:4,title:"chown",slug:"chown",normalizedTitle:"chown",charIndex:746},{level:3,title:"æä»¶æéç®¡ç",slug:"æä»¶æéç®¡ç",normalizedTitle:"æä»¶æéç®¡ç",charIndex:761},{level:4,title:"chmod",slug:"chmod",normalizedTitle:"chmod",charIndex:781},{level:4,title:"æ°å­åéæé",slug:"æ°å­åéæé",normalizedTitle:"æ°å­åéæé",charIndex:800},{level:4,title:"ç¨å­æ¯æ¥åéæé",slug:"ç¨å­æ¯æ¥åéæé",normalizedTitle:"ç¨å­æ¯æ¥åéæé",charIndex:820},{level:2,title:"æ¥æ¾æä»¶",slug:"æ¥æ¾æä»¶",normalizedTitle:"æ¥æ¾æä»¶",charIndex:833},{level:3,title:"locate",slug:"locate",normalizedTitle:"locate",charIndex:847},{level:4,title:"å®è£ locate",slug:"å®è£-locate",normalizedTitle:"å®è£ locate",charIndex:867},{level:3,title:"find",slug:"find",normalizedTitle:"find",charIndex:886},{level:4,title:"æ ¹æ®æä»¶åæ¥æ¾",slug:"æ ¹æ®æä»¶åæ¥æ¾",normalizedTitle:"æ ¹æ®æä»¶åæ¥æ¾",charIndex:904},{level:4,title:"æ ¹æ®æä»¶å¤§å°æ¥æ¾",slug:"æ ¹æ®æä»¶å¤§å°æ¥æ¾",normalizedTitle:"æ ¹æ®æä»¶å¤§å°æ¥æ¾",charIndex:925},{level:4,title:"æ ¹æ®æä»¶æè¿è®¿é®æ¶é´æ¥æ¾",slug:"æ ¹æ®æä»¶æè¿è®¿é®æ¶é´æ¥æ¾",normalizedTitle:"æ ¹æ®æä»¶æè¿è®¿é®æ¶é´æ¥æ¾",charIndex:947},{level:4,title:"ä»æ¥æ¾ç®å½ææä»¶",slug:"ä»æ¥æ¾ç®å½ææä»¶",normalizedTitle:"ä»æ¥æ¾ç®å½ææä»¶",charIndex:973},{level:4,title:"æä½æ¥æ¾ç»æ",slug:"æä½æ¥æ¾ç»æ",normalizedTitle:"æä½æ¥æ¾ç»æ",charIndex:995}],headersStr:"ç®å½ ä»ä¹æ¯ Linux Linux ç³»ç»åæ ¸ä¸ Linux åè¡å¥ä»¶çåºå« Linux ç³»ç»ç§ç±» Shell å½ä»¤ å½ä»¤è¡æç¤ºç¬¦ æä»¶åç®å½ æä»¶çç»ç» æ¥çè·¯å¾ pwd which æµè§ååæ¢ç®å½ ls cd du æµè§ååå»ºæä»¶ cat less head tail touch mkdir æä»¶çå¤å¶åç§»å¨ cp mv æä»¶çå é¤åé¾æ¥ rm ln ç¡¬é¾æ¥ è½¯é¾æ¥ ç¨æ·ä¸æé ç¨æ· sudo useradd + passwd userdel su ç¾¤ç»çç®¡ç groupadd groupdel groups usermod chgrp chown æä»¶æéç®¡ç chmod æ°å­åéæé ç¨å­æ¯æ¥åéæé æ¥æ¾æä»¶ locate å®è£ locate find æ ¹æ®æä»¶åæ¥æ¾ æ ¹æ®æä»¶å¤§å°æ¥æ¾ æ ¹æ®æä»¶æè¿è®¿é®æ¶é´æ¥æ¾ ä»æ¥æ¾ç®å½ææä»¶ æä½æ¥æ¾ç»æ",content:'# ç®å½\n\n * ä»ä¹æ¯ Linux\n   \n   * Linux ç³»ç»åæ ¸ä¸ Linux åè¡å¥ä»¶çåºå«\n   \n   * Linux ç³»ç»ç§ç±»\n\n * Shell\n\n * å½ä»¤\n   \n   * å½ä»¤è¡æç¤ºç¬¦\n\n * æä»¶åç®å½\n   \n   * æä»¶çç»ç»\n   \n   * æ¥çè·¯å¾\n     \n     * pwd\n     \n     * which\n   \n   * æµè§ååæ¢ç®å½\n     \n     * ls\n     \n     * cd\n     \n     * du\n   \n   * æµè§ååå»ºæä»¶\n     \n     * cat\n     \n     * less\n     \n     * head\n     \n     * tail\n     \n     * touch\n     \n     * mkdir\n   \n   * æä»¶çå¤å¶åç§»å¨\n     \n     * cp\n     \n     * mv\n   \n   * æä»¶çå é¤åé¾æ¥\n     \n     * rm\n     \n     * ln\n     \n     * ç¡¬é¾æ¥\n     \n     * è½¯é¾æ¥\n\n * ç¨æ·ä¸æé\n   \n   * ç¨æ·\n     \n     * sudo\n     \n     * useradd + passwd\n     \n     * userdel\n     \n     * su\n   \n   * ç¾¤ç»çç®¡ç\n     \n     * groupadd\n     \n     * groupdel\n     \n     * groups\n     \n     * usermod\n     \n     * chgrp\n     \n     * chown\n   \n   * æä»¶æéç®¡ç\n     \n     * chmod\n     \n     * æ°å­åéæé\n     \n     * ç¨å­æ¯æ¥åéæé\n\n * æ¥æ¾æä»¶\n   \n   * locate\n     \n     * å®è£ locate\n   \n   * find\n     \n     * æ ¹æ®æä»¶åæ¥æ¾\n     \n     * æ ¹æ®æä»¶å¤§å°æ¥æ¾\n     \n     * æ ¹æ®æä»¶æè¿è®¿é®æ¶é´æ¥æ¾\n     \n     * ä»æ¥æ¾ç®å½ææä»¶\n     \n     * æä½æ¥æ¾ç»æ\n\n\n# å¸¦ä½ å®ç°Linuxå½ä»¤èªç±\n\næ¥èªââå°å¤å­¦ç®æ³\n\n----------------------------------------\n\n\n# ä»ä¹æ¯ Linux\n\n\n# Linux ç³»ç»åæ ¸ä¸ Linux åè¡å¥ä»¶çåºå«\n\n * LinuxÂ ç³»ç»åæ ¸æçæ¯ç±Â Linus TorvaldsÂ è´è´£ç»´æ¤ï¼æä¾ç¡¬ä»¶æ½è±¡å±ãç¡¬çåæä»¶ç³»ç»æ§å¶åå¤ä»»å¡åè½çç³»ç»æ ¸å¿ç¨åºã\n\n * LinuxÂ åè¡å¥ä»¶ç³»ç»æ¯æä»¬å¸¸è¯´çÂ LinuxÂ æä½ç³»ç»ï¼ä¹å³æ¯ç±Â LinuxÂ åæ ¸ä¸åç§å¸¸ç¨è½¯ä»¶çéåäº§åã\n\næ»ç»ï¼çæ­£çÂ Â æçæ¯ç³»ç»åæ ¸ï¼èæä»¬å¸¸è¯´çÂ Â æçæ¯âåè¡çå®æ´çåå«ä¸äºåºç¡è½¯ä»¶çæä½ç³»ç»âã\n\n\n# Linux ç³»ç»ç§ç±»\n\n * çº¢å¸½ä¼ä¸çÂ LinuxÂ ï¼RHELÂ æ¯å¨ä¸çåä½¿ç¨æå¹¿æ³çÂ LinuxÂ ç³»ç»ãå®å·ææå¼ºçæ§è½ä¸ç¨³å®æ§ï¼æ¯ä¼å¤çæç¯å¢ä¸­ä½¿ç¨çï¼æ¶è´¹çï¼ç³»ç»ã\n\n * FedoraÂ ï¼ç±çº¢å¸½å¬å¸åå¸çæ¡é¢çç³»ç»å¥ä»¶ï¼ç¨æ·å¯ä»¥åè´¹ä½éªå°ææ°çææ¯æå·¥å·ï¼è¿äºææ¯æå·¥å·å¨æçåä¼è¢«å å¥å°Â RHELÂ ç³»ç»ä¸­ï¼å æ­¤Â FedoraÂ ä¹æä¸ºÂ RHELÂ ç³»ç»çè¯éªçæ¬ã\n\n * CentOSÂ ï¼éè¿æÂ RHELÂ ç³»ç»éæ°ç¼è¯å¹¶åå¸ç»ç¨æ·åè´¹ä½¿ç¨çÂ LinuxÂ ç³»ç»ï¼å·æå¹¿æ³çä½¿ç¨äººç¾¤ã\n\n * DeepinÂ ï¼ä¸­å½åè¡ï¼å¯¹ä¼ç§çå¼æºæåè¿è¡éæåéç½®ã\n\n * DebianÂ ï¼ç¨³å®æ§ãå®å¨æ§å¼ºï¼æä¾äºåè´¹çåºç¡æ¯æï¼å¨å½å¤æ¥æå¾é«çè®¤å¯åº¦åä½¿ç¨çã\n\n * UbuntuÂ ï¼æ¯ä¸æ¬¾æ´¾çèªÂ DebianÂ çæä½ç³»ç»ï¼å¯¹æ°æ¬¾ç¡¬ä»¶å·ææå¼ºçå¼å®¹è½åãUbuntuÂ ä¸Â FedoraÂ é½æ¯æå¶åºè²çÂ LinuxÂ æ¡é¢ç³»ç»ï¼èä¸Â UbuntuÂ ä¹å¯ç¨äºæå¡å¨é¢åã\n\n\n# Shell\n\nShellÂ è¿ä¸ªåè¯çåææ¯âå¤å£³âï¼è·Â kernelï¼åæ ¸ï¼ç¸å¯¹åºï¼æ¯å»åæ ¸å¤é¢çä¸å±ï¼å³ç¨æ·è·åæ ¸äº¤äºçå¯¹è¯çé¢ã\n\n * ShellÂ æ¯ä¸ä¸ªç¨åºï¼æä¾ä¸ä¸ªä¸ç¨æ·å¯¹è¯çç¯å¢ãè¿ä¸ªç¯å¢åªæä¸ä¸ªå½ä»¤æç¤ºç¬¦ï¼è®©ç¨æ·ä»é®çè¾å¥å½ä»¤ï¼æä»¥åç§°ä¸ºå½ä»¤è¡ç¯å¢ï¼Â command line interfaceÂ ï¼ç®åä¸ºÂ CLIÂ ï¼ãShellÂ æ¥æ¶å°ç¨æ·è¾å¥çå½ä»¤ï¼å°å½ä»¤éå¥æä½ç³»ç»æ§è¡ï¼å¹¶å°ç»æè¿åç»ç¨æ·ã\n\n * ShellÂ æ¯ä¸ä¸ªå½ä»¤è§£éå¨ï¼è§£éç¨æ·è¾å¥çå½ä»¤ãå®æ¯æåéãæ¡ä»¶å¤æ­ãå¾ªç¯æä½ç­è¯­æ³ï¼æä»¥ç¨æ·å¯ä»¥ç¨Â ShellÂ å½ä»¤ååºåç§å°ç¨åºï¼åç§°ä¸ºÂ ShellÂ èæ¬ãè¿äºèæ¬é½éè¿ShellÂ çè§£éæ§è¡ï¼èä¸éè¿ç¼è¯ã\n\n * ShellÂ æ¯ä¸ä¸ªå·¥å·ç®±ï¼æä¾äºåç§å°å·¥å·ï¼ä¾ç¨æ·æ¹ä¾¿å°ä½¿ç¨æä½ç³»ç»çåè½ã\n\nBash æ¯ç®åæå¸¸ç¨ç Shell ãMacOS ä¸­çé»è®¤ Shell å°±æ¯ Bash ã éè¿æ§è¡ echo $SHELL å½ä»¤å¯ä»¥æ¥çå°å½åæ­£å¨ä½¿ç¨ç Shell ãè¿å¯ä»¥éè¿ cat /etc/shells æ¥çå½åç³»ç»å®è£çææ Shell ç§ç±»ã\n\n\n# å½ä»¤\n\n\n# å½ä»¤è¡æç¤ºç¬¦\n\nè¿å¥å½ä»¤è¡ç¯å¢ä»¥åï¼ç¨æ·ä¼çå°Â ShellÂ çæç¤ºç¬¦ãæç¤ºç¬¦å¾å¾æ¯ä¸ä¸²åç¼ï¼æåä»¥ä¸ä¸ªç¾åç¬¦å·Â $Â ç»å°¾ï¼ç¨æ·å¯ä»¥å¨è¿ä¸ªç¬¦å·åé¢è¾å¥åç§å½ä»¤ã\n\nå½ä»¤è§£æï¼\n\n * rootï¼è¡¨ç¤ºç¨æ·åï¼\n\n * iZm5e8dsxce9ufaic7hi3uZï¼è¡¨ç¤ºä¸»æºåï¼\n\n * ~ï¼è¡¨ç¤ºç®åæå¨ç®å½ä¸ºå®¶ç®å½ï¼å¶ä¸­Â rootÂ ç¨æ·çå®¶ç®å½æ¯Â /rootÂ æ®éç¨æ·çå®¶ç®å½å¨Â /homeÂ ä¸ï¼\n\n * #ï¼æç¤ºä½ æå·æçæéï¼Â rootÂ ç¨æ·ä¸ºÂ #Â ï¼æ®éç¨æ·ä¸ºÂ $Â ï¼ã\n\n * æ§è¡Â whoamiÂ å½ä»¤å¯ä»¥æ¥çå½åç¨æ·åï¼\n\n * æ§è¡Â hostnameÂ å½ä»¤å¯ä»¥æ¥çå½åä¸»æºåï¼\n\nå³äºå¦ä½åå»ºãåæ¢ãå é¤ç¨æ·ï¼å¨åé¢çç¨æ·ä¸æéä¼å·ä½è®²è§£ï¼è¿éåä½¿ç¨Â rootÂ ç¨æ·è¿è¡æ¼ç¤ºã\n\n[å¤æ³¨] root æ¯è¶çº§ç¨æ·ï¼å·å¤æä½ç³»ç»çä¸åæéãåæ¢å°rootï¼su rootï¼æ¯æ¬¡ç»éç³»ç»rootçå¯ç é½ä¸ä¸æ ·ï¼æ¯éæºçãä½å¯ä»¥ä¿®æ¹ã\n\n\n# æä»¶åç®å½\n\n\n# æä»¶çç»ç»\n\n\n\n\n# æ¥çè·¯å¾\n\n# pwd\n\næ¾ç¤ºå½åç®å½çè·¯å¾\n\n\n\n# which\n\næ¥çå½ä»¤çå¯æ§è¡æä»¶æå¨è·¯å¾ï¼Â LinuxÂ ä¸ï¼æ¯ä¸æ¡å½ä»¤å¶å®é½å¯¹åºä¸ä¸ªå¯æ§è¡ç¨åºï¼å¨ç»ç«¯ä¸­è¾å¥å½ä»¤ï¼æåè½¦çæ¶åï¼å°±æ¯æ§è¡äºå¯¹åºçé£ä¸ªç¨åºï¼Â whichÂ å½ä»¤æ¬èº«å¯¹åºçç¨åºä¹å­å¨äºÂ LinuxÂ ä¸­ã\n\næ»çæ¥è¯´ä¸ä¸ªå½ä»¤å°±æ¯ä¸ä¸ªå¯æ§è¡ç¨åºã\n\n\n\n\n# æµè§ååæ¢ç®å½\n\n# ls\n\nååºæä»¶åç®å½ï¼å®æ¯Â LinuxÂ æå¸¸ç¨çå½ä»¤ä¹ä¸ã\n\nãå¸¸ç¨åæ°ã\n\n * -aÂ æ¾ç¤ºæææä»¶åç®å½åæ¬éèç\n\n * -lÂ æ¾ç¤ºè¯¦ç»åè¡¨\n\n * -hÂ éåäººç±»éè¯»ç\n\n * -tÂ ææä»¶æè¿ä¸æ¬¡ä¿®æ¹æ¶é´æåº\n\n * -iÂ æ¾ç¤ºæä»¶çÂ inodeÂ ï¼Â inodeÂ æ¯æä»¶åå®¹çæ è¯ï¼\n\n\n\n# cd\n\ncdÂ æ¯è±è¯­Â change directoryÂ çç¼©åï¼è¡¨ç¤ºåæ¢ç®å½ã\n\ncdÂ /Â --\x3eÂ è·³è½¬å°æ ¹ç®å½ cdÂ ~Â --\x3eÂ è·³è½¬å°å®¶ç®å½ cdÂ ..Â --\x3eÂ è·³è½¬å°ä¸çº§ç®å½ cdÂ ./homeÂ --\x3eÂ è·³è½¬å°å½åç®å½çhomeç®å½ä¸ cdÂ /home/lionÂ --\x3eÂ è·³è½¬å°æ ¹ç®å½ä¸çhomeç®å½ä¸çlionç®å½ cdÂ --\x3eÂ ä¸æ·»å ä»»ä½åæ°ï¼ä¹æ¯åå°å®¶ç®å½ å¤å¶ä»£ç \n\n[æ³¨æ] è¾å¥cd /hoÂ + åæ¬¡Â tabÂ é®ä¼èªå¨è¡¥å¨è·¯å¾ + ä¸¤æ¬¡Â tabÂ é®ä¼ååºææå¯è½çç®å½åè¡¨ã\n\n# du\n\nåä¸¾ç®å½å¤§å°ä¿¡æ¯ã\n\nãå¸¸ç¨åæ°ã\n\n * -hÂ éåäººç±»éè¯»çï¼\n\n * -aÂ åæ¶åä¸¾åºç®å½ä¸æä»¶çå¤§å°ä¿¡æ¯ï¼\n\n * -sÂ åªæ¾ç¤ºæ»è®¡å¤§å°ï¼ä¸æ¾ç¤ºå·ä½ä¿¡æ¯ã\n\n\n# æµè§ååå»ºæä»¶\n\n# cat\n\nä¸æ¬¡æ§æ¾ç¤ºæä»¶ææåå®¹ï¼æ´éåæ¥çå°çæä»¶ã\n\ncatÂ cloud-init.log å¤å¶ä»£ç \n\nãå¸¸ç¨åæ°ã\n\n * -nÂ æ¾ç¤ºè¡å·ã\n\n# less\n\nåé¡µæ¾ç¤ºæä»¶åå®¹ï¼æ´éåæ¥çå¤§çæä»¶ã\n\nlessÂ cloud-init.log å¤å¶ä»£ç \n\nãå¿«æ·æä½ã\n\n * ç©ºæ ¼é®ï¼åè¿ä¸é¡µï¼ä¸ä¸ªå±å¹ï¼ï¼\n\n * bÂ é®ï¼åéä¸é¡µï¼\n\n * åè½¦é®ï¼åè¿ä¸è¡ï¼\n\n * yÂ é®ï¼åéä¸è¡ï¼\n\n * ä¸ä¸é®ï¼åéæåè¿ä¸è¡ï¼\n\n * dÂ é®ï¼åè¿åé¡µï¼\n\n * uÂ é®ï¼åéåé¡µï¼\n\n * qÂ é®ï¼åæ­¢è¯»åæä»¶ï¼ä¸­æ­¢Â lessÂ å½ä»¤ï¼\n\n * =Â é®ï¼æ¾ç¤ºå½åé¡µé¢çåå®¹æ¯æä»¶ä¸­çç¬¬å è¡å°ç¬¬å è¡ä»¥åä¸äºå¶å®å³äºæ¬é¡µåå®¹çè¯¦ç»ä¿¡æ¯ï¼\n\n * hÂ é®ï¼æ¾ç¤ºå¸®å©ææ¡£ï¼\n\n * /Â é®ï¼è¿å¥æç´¢æ¨¡å¼åï¼æÂ nÂ é®è·³å°ä¸ä¸ªç¬¦åé¡¹ç®ï¼æÂ NÂ é®è·³å°ä¸ä¸ä¸ªç¬¦åé¡¹ç®ï¼åæ¶ä¹å¯ä»¥è¾å¥æ­£åè¡¨è¾¾å¼å¹éã\n\n# head\n\næ¾ç¤ºæä»¶çå¼å¤´å è¡ï¼é»è®¤æ¯10è¡ï¼\n\nheadÂ cloud-init.log å¤å¶ä»£ç \n\nãåæ°ã\n\n * -nÂ æå®è¡æ°Â head cloud-init.log -n 2\n\n# tail\n\næ¾ç¤ºæä»¶çç»å°¾å è¡ï¼é»è®¤æ¯10è¡ï¼\n\ntailÂ cloud-init.logå¤å¶ä»£ç \n\nãåæ°ã\n\n * -nÂ æå®è¡æ°Â tail cloud-init.log -n 2\n\n * -fÂ ä¼æ¯è¿1ç§æ£æ¥ä¸æä»¶æ¯å¦ææ´æ°åå®¹ï¼ä¹å¯ä»¥ç¨Â -sÂ åæ°æå®é´éæ¶é´Â tail -f -s 4 xxx.log\n\n# touch\n\nåå»ºä¸ä¸ªæä»¶\n\ntouchÂ new_fileå¤å¶ä»£ç \n\n# mkdir\n\nåå»ºä¸ä¸ªç®å½\n\nmkdirÂ new_folderå¤å¶ä»£ç \n\nãå¸¸ç¨åæ°ã\n\n * -pÂ éå½çåå»ºç®å½ç»æÂ mkdir -p one/two/three\n\n\n# æä»¶çå¤å¶åç§»å¨\n\n# cp\n\næ·è´æä»¶åç®å½\n\ncp file file_copy --\x3e file æ¯ç®æ æä»¶ï¼file_copy æ¯æ·è´åºæ¥çæä»¶\ncp file one --\x3e æ file æä»¶æ·è´å° one ç®å½ä¸ï¼å¹¶ä¸æä»¶åä¾ç¶ä¸º file\ncp file one/file_copy --\x3e æ file æä»¶æ·è´å° one ç®å½ä¸ï¼æä»¶åä¸ºfile_copy\ncp *.txt folder --\x3e æå½åç®å½ä¸ææ txt æä»¶æ·è´å° folder ç®å½ä¸å¤å¶ä»£ç    \n\n\n1\n2\n3\n4\n\n\nãå¸¸ç¨åæ°ã\n\n * -rÂ éå½çæ·è´ï¼å¸¸ç¨æ¥æ·è´ä¸æ´ä¸ªç®å½\n\n# mv\n\nç§»å¨ï¼éå½åï¼æä»¶æç®å½ï¼ä¸cpå½ä»¤ç¨æ³ç¸ä¼¼ã\n\nmv file one --\x3e å° file æä»¶ç§»å¨å° one ç®å½ä¸\nmv new_folder one --\x3e å° new_folder æä»¶å¤¹ç§»å¨å°oneç®å½ä¸\nmv *.txt folder --\x3e æå½åç®å½ä¸ææ txt æä»¶ç§»å¨å° folder ç®å½ä¸\nmv file new_file --\x3e file æä»¶éå½åä¸º new_fileå¤å¶ä»£ç    \n\n\n1\n2\n3\n4\n\n\n\n# æä»¶çå é¤åé¾æ¥\n\n# rm\n\nå é¤æä»¶åç®å½ï¼ç±äºÂ LinuxÂ ä¸æ²¡æåæ¶ç«ï¼ä¸æ¦å é¤éå¸¸é¾æ¢å¤ï¼å æ­¤éè¦è°¨ææä½\n\nrm new_file  --\x3e å é¤ new_file æä»¶\nrm f1 f2 f3  --\x3e åæ¶å é¤ f1 f2 f3 3ä¸ªæä»¶å¤å¶ä»£ç    \n\n\n1\n2\n\n\nãå¸¸ç¨åæ°ã\n\n * -iÂ åç¨æ·ç¡®è®¤æ¯å¦å é¤ï¼\n\n * -fÂ æä»¶å¼ºå¶å é¤ï¼\n\n * -rÂ éå½å é¤æä»¶å¤¹ï¼èåçå é¤æä½Â rm -rfÂ ã\n\n# ln\n\nè±æÂ LinkÂ çç¼©åï¼è¡¨ç¤ºåå»ºé¾æ¥ã\n\nå­¦ä¹ åå»ºé¾æ¥ä¹åï¼é¦åè¦çè§£é¾æ¥æ¯ä»ä¹ï¼æä»¬åæ¥ççÂ LinuxÂ çæä»¶æ¯å¦ä½å­å¨çï¼\n\nLinuxÂ æä»¶çå­å¨æ¹å¼åä¸º3ä¸ªé¨åï¼æä»¶åãæä»¶åå®¹ä»¥åæéï¼å¶ä¸­æä»¶åçåè¡¨æ¯å­å¨å¨ç¡¬ççå¶å®å°æ¹åæä»¶åå®¹æ¯åå¼å­æ¾çï¼æ¯ä¸ªæä»¶åéè¿Â inodeÂ æ è¯ç»å®å°æä»¶åå®¹ã\n\nLinux ä¸æä¸¤ç§é¾æ¥ç±»åï¼ç¡¬é¾æ¥åè½¯é¾æ¥ã\n\n# ç¡¬é¾æ¥\n\nä½¿é¾æ¥çä¸¤ä¸ªæä»¶å±äº«åæ ·æä»¶åå®¹ï¼å°±æ¯åæ ·çÂ inodeÂ ï¼ä¸æ¦æä»¶1åæä»¶2ä¹é´æäºç¡¬é¾æ¥ï¼é£ä¹ä¿®æ¹ä»»ä½ä¸ä¸ªæä»¶ï¼ä¿®æ¹çé½æ¯åä¸ååå®¹ï¼å®çç¼ºç¹æ¯ï¼åªè½åå»ºæåæä»¶çç¡¬é¾æ¥ï¼ä¸è½åå»ºæåç®å½çï¼å¶å®ä¹å¯ä»¥ï¼ä½æ¯è¾å¤æï¼èè½¯é¾æ¥é½å¯ä»¥ï¼å æ­¤è½¯é¾æ¥ä½¿ç¨æ´å å¹¿æ³ã\n\nln file1 file2  --\x3e åå»º file2 ä¸º file1 çç¡¬é¾æ¥å¤å¶ä»£ç  \n\n\n1\n\n\n\n\nå¦ææä»¬ç¨Â rm file1Â æ¥å é¤Â file1Â ï¼å¯¹Â file2Â æ²¡æä»ä¹å½±åï¼å¯¹äºç¡¬é¾æ¥æ¥è¯´ï¼å é¤ä»»æä¸æ¹çæä»¶ï¼å±åæåçæä»¶åå®¹å¹¶ä¸ä¼ä»ç¡¬çä¸å é¤ãåªæåæ¶å é¤äºÂ file1Â ä¸file2Â åï¼å®ä»¬å±åæåçæä»¶åå®¹æä¼æ¶å¤±ã\n\n# è½¯é¾æ¥\n\nè½¯é¾æ¥å°±ç±»ä¼¼Â windowsÂ ä¸å¿«æ·æ¹å¼ã\n\nln -s file1 file2å¤å¶ä»£ç    \n\n\n1\n\n\n\n\næ§è¡Â ls -lÂ å½åæ¥çå½åç®å½ä¸æä»¶çå·ä½ä¿¡æ¯\n\ntotal 0-rw-r--r-- 1 root root 0 Jan 14 06:29 file1lrwxrwxrwx 1 root root 5 Jan 14 06:42 file2 -> file1  # è¡¨ç¤ºfile2 æå file1å¤å¶ä»£ç    \n\n\n1\n\n\nå¶å®Â file2Â åªæ¯Â file1Â çä¸ä¸ªå¿«æ·æ¹å¼ï¼å®æåçæ¯Â file1Â ï¼æä»¥æ¾ç¤ºçæ¯Â file1Â çåå®¹ï¼ä½å¶å®Â file2Â çÂ inodeÂ ä¸Â file1Â å¹¶ä¸ç¸åãå¦ææä»¬å é¤äºÂ file2Â çè¯ï¼Â file1æ¯ä¸ä¼åå½±åçï¼ä½å¦æå é¤Â file1Â çè¯ï¼Â file2Â å°±ä¼åææ­»é¾æ¥ï¼å ä¸ºæåçæä»¶ä¸è§äºã\n\n\n# ç¨æ·ä¸æé\n\n\n# ç¨æ·\n\nLinuxÂ æ¯ä¸ä¸ªå¤ç¨æ·çæä½ç³»ç»ãå¨Â LinuxÂ ä¸­ï¼çè®ºä¸æ¥è¯´ï¼æä»¬å¯ä»¥åå»ºæ æ°ä¸ªç¨æ·ï¼ä½æ¯è¿äºç¨æ·æ¯è¢«ååå°ä¸åçç¾¤ç»éé¢çï¼æä¸ä¸ªç¨æ·ï¼åå«Â rootÂ ï¼æ¯ä¸ä¸ªå¾ç¹æ®çç¨æ·ï¼å®æ¯è¶çº§ç¨æ·ï¼æ¥ææé«æéã\n\n\n\nèªå·±åå»ºçç¨æ·æ¯æéæéçç¨æ·ï¼è¿æ ·å¤§å¤§æé«äºÂ LinuxÂ ç³»ç»çå®å¨æ§ï¼ææé²æ­¢è¯¯æä½ææ¯çæ¯æ»å»ï¼ä½æ¯æä»¬æ§è¡çæäºå½ä»¤éè¦æ´é«æéæ¶å¯ä»¥ä½¿ç¨Â sudoÂ å½ä»¤ã\n\n# sudo\n\nä»¥Â rootÂ èº«ä»½è¿è¡å½ä»¤\n\nsudo date  --\x3e å½ç¶æ¥çæ¥ææ¯ä¸éè¦sudoçè¿éåªæ¯æ¼ç¤ºï¼sudo å®ä¹åä¸è¬è¿éè¦è¾å¥ç¨æ·å¯ç çå¤å¶ä»£ç    \n\n\n1\n\n\n# useradd + passwd\n\n * useraddÂ æ·»å æ°ç¨æ·\n\n * passwdÂ ä¿®æ¹ç¨æ·å¯ç \n\nè¿ä¸¤ä¸ªå½ä»¤éè¦Â rootÂ ç¨æ·æé\n\nuseradd lion --\x3e æ·»å ä¸ä¸ªlionç¨æ·ï¼æ·»å å®ä¹åå¨ /home è·¯å¾ä¸å¯ä»¥æ¥çpasswd lion --\x3e ä¿®æ¹lionç¨æ·çå¯ç å¤å¶ä»£ç    \n\n\n1\n\n\n# userdel\n\nå é¤ç¨æ·ï¼éè¦Â rootÂ ç¨æ·æé\n\nuserdel lion --\x3e åªä¼å é¤ç¨æ·åï¼ä¸ä¼ä»/homeä¸­å é¤å¯¹åºæä»¶å¤¹userdel lion -r --\x3e ä¼åæ¶å é¤/homeä¸çå¯¹åºæä»¶å¤¹å¤å¶ä»£ç  \n\n\n1\n\n\n# su\n\nåæ¢ç¨æ·ï¼éè¦Â rootÂ ç¨æ·æé\n\nsudo su --\x3e åæ¢ä¸ºrootç¨æ·ï¼exit å½ä»¤æ CTRL + D å¿«æ·é®é½å¯ä»¥ä½¿æ®éç¨æ·åæ¢ä¸º root ç¨æ·ï¼\nsu lion --\x3e åæ¢ä¸ºæ®éç¨æ·su - --\x3e åæ¢ä¸ºrootç¨æ·å¤å¶ä»£ç    \n\n\n1\n2\n\n\n\n# ç¾¤ç»çç®¡ç\n\nLinuxÂ ä¸­æ¯ä¸ªç¨æ·é½å±äºä¸ä¸ªç¹å®çç¾¤ç»ï¼å¦æä½ ä¸è®¾ç½®ç¨æ·çç¾¤ç»ï¼é»è®¤ä¼åå»ºä¸ä¸ªåå®çç¨æ·åä¸æ ·çç¾¤ç»ï¼å¹¶ä¸æç¨æ·åå½å°è¿ä¸ªç¾¤ç»ã\n\n# groupadd\n\nåå»ºç¾¤ç»ï¼ç¨æ³åÂ useraddÂ ç±»ä¼¼ã\n\ngroupadd friendså¤å¶ä»£ç    \n\n\n1\n\n\n# groupdel\n\nå é¤ä¸ä¸ªå·²å­å¨çç¾¤ç»\n\ngroupdel foo  --\x3e å é¤fooç¾¤ç»å¤å¶ä»£ç    \n\n\n1\n\n\n# groups\n\næ¥çç¨æ·æå¨ç¾¤ç»\n\ngroups lion  --\x3e æ¥ç lion ç¨æ·æå¨çç¾¤ç»å¤å¶ä»£ç \n\n\n1\n\n\n# usermod\n\nç¨äºä¿®æ¹ç¨æ·çè´¦æ·ã\n\nãå¸¸ç¨åæ°ã\n\n * -lÂ å¯¹ç¨æ·éå½åãéè¦æ³¨æçæ¯Â /homeÂ ä¸­çç¨æ·å®¶ç®å½çåå­ä¸ä¼æ¹åï¼éè¦æå¨ä¿®æ¹ã\n\n * -gÂ ä¿®æ¹ç¨æ·æå¨çç¾¤ç»ï¼ä¾å¦Â usermod -g friends lionä¿®æ¹Â lionÂ ç¨æ·çç¾¤ç»ä¸ºÂ friendsÂ ã\n\n * -GÂ ä¸æ¬¡æ§è®©ç¨æ·æ·»å å¤ä¸ªç¾¤ç»ï¼ä¾å¦Â usermod -G friends,foo,bar lionÂ ã\n\n * -aÂ -GÂ ä¼è®©ä½ ç¦»å¼ååçç¾¤ç»ï¼å¦æä½ ä¸æ³è¿æ ·åçè¯ï¼å°±å¾åæ·»å Â -aÂ åæ°ï¼æå³çappendÂ è¿½å çææã\n\n# chgrp\n\nç¨äºä¿®æ¹æä»¶çç¾¤ç»ã\n\nchgrp bar file.txt --\x3e file.txtæä»¶çç¾¤ç»ä¿®æ¹ä¸ºbarå¤å¶ä»£ç  \n\n\n1\n\n\n# chown\n\næ¹åæä»¶çææèï¼éè¦Â rootÂ èº«ä»½æè½è¿è¡ã\n\nchown lion file.txt --\x3e æå¶å®ç¨æ·åå»ºçfile.txtè½¬è®©ç»lionç¨æ·chown lion:bar file.txt --\x3e æfile.txtçç¨æ·æ¹ä¸ºlionï¼ç¾¤ç»æ¹ä¸ºbarå¤å¶ä»£ç    \n\n\n1\n\n\nãå¸¸ç¨åæ°ã\n\n * -RÂ éå½è®¾ç½®å­ç®å½åå­æä»¶ï¼Â chown -R lion:lion /home/frankÂ æÂ frankÂ æä»¶å¤¹çç¨æ·åç¾¤ç»é½æ¹ä¸ºÂ lionÂ ã\n\n\n# æä»¶æéç®¡ç\n\n# chmod\n\nä¿®æ¹è®¿é®æéã\n\nchmod 740 file.txt\n\n\n1\n\n\nãå¸¸ç¨åæ°ã\n\n * -RÂ å¯ä»¥éå½å°ä¿®æ¹æä»¶è®¿é®æéï¼ä¾å¦Â chmod -R 777 /home/lion\n\nä¿®æ¹æéçç¡®ç®åï¼ä½æ¯çè§£å¶æ·±å±æ¬¡çæä¹ææ¯æ´å éè¦çãä¸é¢æä»¬æ¥ç³»ç»çå­¦ä¹ LinuxÂ çæä»¶æéã\n\n[root@lion ~]# ls -ldrwxr-xr-x 5 root root 4096 Apr 13  2020 climblrwxrwxrwx 1 root root    7 Jan 14 06:41 hello2.c -> hello.c-rw-r--r-- 1 root root  149 Jan 13 06:14 hello.cå¤å¶ä»£ç    \n\n\n1\n\n\nå¶ä¸­Â drwxr-xr-xÂ è¡¨ç¤ºæä»¶æç®å½çæéãè®©æä»¬ä¸èµ·æ¥è§£è¯»å®å·ä½ä»£è¡¨ä»ä¹ï¼\n\n * dÂ ï¼è¡¨ç¤ºç®å½ï¼å°±æ¯è¯´è¿æ¯ä¸ä¸ªç®å½ï¼æ®éæä»¶æ¯Â -Â ï¼é¾æ¥æ¯Â lÂ ã\n\n * rÂ ï¼readÂ è¡¨ç¤ºæä»¶å¯è¯»ã\n\n * wÂ ï¼writeÂ è¡¨ç¤ºæä»¶å¯åï¼ä¸è¬æåçæéï¼å°±æå é¤çæéã\n\n * xÂ ï¼executeÂ è¡¨ç¤ºæä»¶å¯æ§è¡ã\n\n * -Â ï¼è¡¨ç¤ºæ²¡æç¸åºæéã\n\næéçæ´ä½æ¯æç¨æ·æ¥ååçï¼å¦ä¸å¾æç¤ºï¼\n\n\n\nç°å¨åæ¥çè§£è¿å¥æéÂ drwxr-xr-xÂ çææï¼\n\n * å®æ¯ä¸ä¸ªæä»¶å¤¹ï¼\n\n * å®çææèå·æï¼è¯»ãåãæ§è¡æéï¼\n\n * å®çç¾¤ç»ç¨æ·å·æï¼è¯»ãæ§è¡çæéï¼æ²¡æåçæéï¼\n\n * å®çå¶å®ç¨æ·å·æï¼è¯»ãæ§è¡çæéï¼æ²¡æåçæéã\n\nç°å¨çè§£äºæéï¼æä»¬ä½¿ç¨Â chmodÂ æ¥å°è¯ä¿®æ¹æéãchmodÂ å®ä¸éè¦æ¯Â rootÂ ç¨æ·æè½è¿è¡çï¼åªè¦ä½ æ¯æ­¤æä»¶ææèï¼å°±å¯ä»¥ç¨Â chmodÂ æ¥ä¿®æ¹æä»¶çè®¿é®æéã\n\n# æ°å­åéæé\n\næé   æ°å­\nr    4\nw    2\nx    1\n\nå æ­¤è¦æ¹åæéï¼åªè¦åä¸äºç®åçå æ³å°±è¡ï¼\n\nchmod 640 hello.c # åæ6 = 4 + 2 + 0 è¡¨ç¤ºææèå·æ rw æé4 = 4 + 0 + 0 è¡¨ç¤ºç¾¤ç»ç¨æ·å·æ r æé0 = 0 + 0 + 0 è¡¨ç¤ºå¶å®ç¨æ·æ²¡ææéå¯¹åºæå­æéä¸ºï¼-rw-r-----å¤å¶ä»£ç \n\n\n1\n\n\n# ç¨å­æ¯æ¥åéæé\n\n * uÂ ï¼userÂ çç¼©åï¼ç¨æ·çææï¼è¡¨ç¤ºææèã\n\n * gÂ ï¼groupÂ çç¼©åï¼ç¾¤ç»çææï¼è¡¨ç¤ºç¾¤ç»ç¨æ·ã\n\n * oÂ ï¼otherÂ çç¼©åï¼å¶å®çææï¼è¡¨ç¤ºå¶å®ç¨æ·ã\n\n * aÂ ï¼allÂ çç¼©åï¼ææçææï¼è¡¨ç¤ºææç¨æ·ã\n\n * +Â ï¼å å·ï¼è¡¨ç¤ºæ·»å æéã\n\n * -Â ï¼åå·ï¼è¡¨ç¤ºå»é¤æéã\n\n * =Â ï¼ç­äºå·ï¼è¡¨ç¤ºåéæéã\n\nchmod u+rx file --\x3e æä»¶fileçææèå¢å è¯»åè¿è¡çæé\nchmod g+r file --\x3e æä»¶fileçç¾¤ç»ç¨æ·å¢å è¯»çæé\nchmod o-r file --\x3e æä»¶fileçå¶å®ç¨æ·ç§»é¤è¯»çæé\nchmod g+r o-r file --\x3e æä»¶fileçç¾¤ç»ç¨æ·å¢å è¯»çæéï¼å¶å®ç¨æ·ç§»é¤è¯»çæé\nchmod go-r file --\x3e æä»¶fileçç¾¤ç»åå¶ä»ç¨æ·ç§»é¤è¯»çæé\nchmod +x file --\x3e æä»¶fileçææç¨æ·å¢å è¿è¡çæé\nchmod u=rwx,g=r,o=- file --\x3e æä»¶fileçææèåéè¯»ååæ§è¡çæéï¼ç¾¤ç»å¶å®ç¨æ·åéè¯»çæéï¼å¶ä»ç¨æ·æ²¡æä»»ä½æéå¤å¶ä»£ç    \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# æ¥æ¾æä»¶\n\n\n# locate\n\næç´¢åå«å³é®å­çæææä»¶åç®å½ãåæ¥éè¦æ¥æ¾çæä»¶åï¼ä¹å¯ä»¥ç¨æ­£åè¡¨è¾¾å¼ã\n\n# å®è£ locate\n\nyumÂ -yÂ installÂ mlocateÂ --\x3eÂ å®è£åupdatedbÂ --\x3eÂ æ´æ°æ°æ®åºå¤å¶ä»£ç locateÂ file.txtlocateÂ fil*.txtå¤å¶ä»£ç \n\n[æ³¨æ]Â locateÂ å½ä»¤ä¼å»æä»¶æ°æ®åºä¸­æ¥æ¾å½ä»¤ï¼èä¸æ¯å¨ç£çæ¥æ¾ï¼å æ­¤ååå»ºçæä»¶å¹¶ä¸ä¼æ´æ°å°æ°æ®åºä¸­ï¼æä»¥æ æ³è¢«æ¥æ¾å°ï¼å¯ä»¥æ§è¡Â updatedbÂ å½ä»¤å»æ´æ°æ°æ®åºã\n\n\n# find\n\nç¨äºæ¥æ¾æä»¶ï¼å®ä¼å»éåä½ çå®éç¡¬çè¿è¡æ¥æ¾ï¼èä¸å®åè®¸æä»¬å¯¹æ¯ä¸ªæ¾å°çæä»¶è¿è¡åç»­æä½ï¼åè½éå¸¸å¼ºå¤§ã\n\nfindÂ <ä½å¤>Â <ä½ç©>Â <åä»ä¹>å¤å¶ä»£ç \n\n * ä½å¤ï¼æå®å¨åªä¸ªç®å½æ¥æ¾ï¼æ­¤ç®å½çææå­ç®å½ä¹ä¼è¢«æ¥æ¾ã\n\n * ä½ç©ï¼æ¥æ¾ä»ä¹ï¼å¯ä»¥æ ¹æ®æä»¶çåå­æ¥æ¥æ¾ï¼ä¹å¯ä»¥æ ¹æ®å¶å¤§å°æ¥æ¥æ¾ï¼è¿å¯ä»¥æ ¹æ®å¶æè¿è®¿é®æ¶é´æ¥æ¥æ¾ã\n\n * åä»ä¹ï¼æ¾å°æä»¶åï¼å¯ä»¥è¿è¡åç»­å¤çï¼å¦æä¸æå®è¿ä¸ªåæ°ï¼Â findÂ å½ä»¤åªä¼æ¾ç¤ºæ¾å°çæä»¶ã\n\n# æ ¹æ®æä»¶åæ¥æ¾\n\nfindÂ -nameÂ "file.txt"Â --\x3eÂ å½åç®å½ä»¥åå­ç®å½ä¸éè¿åç§°æ¥æ¾æä»¶findÂ .Â -nameÂ "syslog"Â --\x3eÂ å½åç®å½ä»¥åå­ç®å½ä¸éè¿åç§°æ¥æ¾æä»¶findÂ /Â -nameÂ "syslog"Â --\x3eÂ æ´ä¸ªç¡¬çä¸æ¥æ¾syslogfindÂ /var/logÂ -nameÂ "syslog"Â --\x3eÂ å¨æå®çç®å½/var/logä¸æ¥æ¾syslogæä»¶findÂ /var/logÂ -nameÂ "syslog*"Â --\x3eÂ æ¥æ¾syslog1ãsyslog2Â ...Â ç­æä»¶ï¼ééç¬¦è¡¨ç¤ºææfindÂ /var/logÂ -nameÂ "*syslog*"Â --\x3eÂ æ¥æ¾åå«syslogçæä»¶Â å¤å¶ä»£ç \n\n[æ³¨æ]Â findÂ å½ä»¤åªä¼æ¥æ¾å®å¨ç¬¦å âä½ç©â å­ç¬¦ä¸²çæä»¶ï¼èÂ locateÂ ä¼æ¥æ¾ææåå«å³é®å­çæä»¶ã\n\n# æ ¹æ®æä»¶å¤§å°æ¥æ¾\n\nfindÂ /varÂ -sizeÂ +10MÂ --\x3eÂ /varÂ ç®å½ä¸æ¥æ¾æä»¶å¤§å°è¶è¿Â 10MÂ çæä»¶findÂ /varÂ -sizeÂ -50kÂ --\x3eÂ /varÂ ç®å½ä¸æ¥æ¾æä»¶å¤§å°å°äºÂ 50kÂ çæä»¶findÂ /varÂ -sizeÂ +1GÂ --\x3eÂ /varÂ ç®å½ä¸æ¥æ¾æä»¶å¤§å°æ¥è¿Â 1GÂ çæä»¶findÂ /varÂ -sizeÂ 1MÂ --\x3eÂ /varÂ ç®å½ä¸æ¥æ¾æä»¶å¤§å°ç­äºÂ 1MÂ çæä»¶å¤å¶ä»£ç \n\n# æ ¹æ®æä»¶æè¿è®¿é®æ¶é´æ¥æ¾\n\nfindÂ -nameÂ "*.txt"Â -atimeÂ -7Â Â --\x3eÂ è¿Â 7å¤©åè®¿é®è¿ç.txtç»å°¾çæä»¶å¤å¶ä»£ç \n\n# ä»æ¥æ¾ç®å½ææä»¶\n\nfindÂ .Â -nameÂ "file"Â -typeÂ fÂ Â --\x3eÂ åªæ¥æ¾å½åç®å½ä¸çfileæä»¶findÂ .Â -nameÂ "file"Â -typeÂ dÂ Â --\x3eÂ åªæ¥æ¾å½åç®å½ä¸çfileç®å½å¤å¶ä»£ç \n\n# æä½æ¥æ¾ç»æ\n\nfindÂ -nameÂ "*.txt"Â -printfÂ "%pÂ -Â %u\\n"Â --\x3eÂ æ¾åºææåç¼ä¸ºtxtçæä»¶ï¼å¹¶æç§Â %pÂ -Â %u\\nÂ æ ¼å¼æå°ï¼å¶ä¸­%p=æä»¶åï¼%u=æä»¶ææèfindÂ -nameÂ "*.jpg"Â -deleteÂ --\x3eÂ å é¤å½åç®å½ä»¥åå­ç®å½ä¸ææ.jpgä¸ºåç¼çæä»¶ï¼ä¸ä¼æå é¤æç¤ºï¼å æ­¤è¦æç¨findÂ -nameÂ "*.c"Â -execÂ chmodÂ 600Â {}Â \\;Â --\x3eÂ å¯¹æ¯ä¸ª.cç»å°¾çæä»¶ï¼é½è¿è¡Â -execÂ åæ°æå®çæä½ï¼{}Â ä¼è¢«æ¥æ¾å°çæä»¶æ¿ä»£ï¼\\;Â æ¯å¿é¡»çç»å°¾findÂ -nameÂ "*.c"Â -okÂ chmodÂ 600Â {}Â \\;Â --\x3eÂ åä¸é¢çåè½ä¸ç´ï¼ä¼å¤ä¸ä¸ªç¡®è®¤æç¤ºå¤å¶ä»£ç ',normalizedContent:'# ç®å½\n\n * ä»ä¹æ¯ linux\n   \n   * linux ç³»ç»åæ ¸ä¸ linux åè¡å¥ä»¶çåºå«\n   \n   * linux ç³»ç»ç§ç±»\n\n * shell\n\n * å½ä»¤\n   \n   * å½ä»¤è¡æç¤ºç¬¦\n\n * æä»¶åç®å½\n   \n   * æä»¶çç»ç»\n   \n   * æ¥çè·¯å¾\n     \n     * pwd\n     \n     * which\n   \n   * æµè§ååæ¢ç®å½\n     \n     * ls\n     \n     * cd\n     \n     * du\n   \n   * æµè§ååå»ºæä»¶\n     \n     * cat\n     \n     * less\n     \n     * head\n     \n     * tail\n     \n     * touch\n     \n     * mkdir\n   \n   * æä»¶çå¤å¶åç§»å¨\n     \n     * cp\n     \n     * mv\n   \n   * æä»¶çå é¤åé¾æ¥\n     \n     * rm\n     \n     * ln\n     \n     * ç¡¬é¾æ¥\n     \n     * è½¯é¾æ¥\n\n * ç¨æ·ä¸æé\n   \n   * ç¨æ·\n     \n     * sudo\n     \n     * useradd + passwd\n     \n     * userdel\n     \n     * su\n   \n   * ç¾¤ç»çç®¡ç\n     \n     * groupadd\n     \n     * groupdel\n     \n     * groups\n     \n     * usermod\n     \n     * chgrp\n     \n     * chown\n   \n   * æä»¶æéç®¡ç\n     \n     * chmod\n     \n     * æ°å­åéæé\n     \n     * ç¨å­æ¯æ¥åéæé\n\n * æ¥æ¾æä»¶\n   \n   * locate\n     \n     * å®è£ locate\n   \n   * find\n     \n     * æ ¹æ®æä»¶åæ¥æ¾\n     \n     * æ ¹æ®æä»¶å¤§å°æ¥æ¾\n     \n     * æ ¹æ®æä»¶æè¿è®¿é®æ¶é´æ¥æ¾\n     \n     * ä»æ¥æ¾ç®å½ææä»¶\n     \n     * æä½æ¥æ¾ç»æ\n\n\n# å¸¦ä½ å®ç°linuxå½ä»¤èªç±\n\næ¥èªââå°å¤å­¦ç®æ³\n\n----------------------------------------\n\n\n# ä»ä¹æ¯ linux\n\n\n# linux ç³»ç»åæ ¸ä¸ linux åè¡å¥ä»¶çåºå«\n\n * linuxÂ ç³»ç»åæ ¸æçæ¯ç±Â linus torvaldsÂ è´è´£ç»´æ¤ï¼æä¾ç¡¬ä»¶æ½è±¡å±ãç¡¬çåæä»¶ç³»ç»æ§å¶åå¤ä»»å¡åè½çç³»ç»æ ¸å¿ç¨åºã\n\n * linuxÂ åè¡å¥ä»¶ç³»ç»æ¯æä»¬å¸¸è¯´çÂ linuxÂ æä½ç³»ç»ï¼ä¹å³æ¯ç±Â linuxÂ åæ ¸ä¸åç§å¸¸ç¨è½¯ä»¶çéåäº§åã\n\næ»ç»ï¼çæ­£çÂ Â æçæ¯ç³»ç»åæ ¸ï¼èæä»¬å¸¸è¯´çÂ Â æçæ¯âåè¡çå®æ´çåå«ä¸äºåºç¡è½¯ä»¶çæä½ç³»ç»âã\n\n\n# linux ç³»ç»ç§ç±»\n\n * çº¢å¸½ä¼ä¸çÂ linuxÂ ï¼rhelÂ æ¯å¨ä¸çåä½¿ç¨æå¹¿æ³çÂ linuxÂ ç³»ç»ãå®å·ææå¼ºçæ§è½ä¸ç¨³å®æ§ï¼æ¯ä¼å¤çæç¯å¢ä¸­ä½¿ç¨çï¼æ¶è´¹çï¼ç³»ç»ã\n\n * fedoraÂ ï¼ç±çº¢å¸½å¬å¸åå¸çæ¡é¢çç³»ç»å¥ä»¶ï¼ç¨æ·å¯ä»¥åè´¹ä½éªå°ææ°çææ¯æå·¥å·ï¼è¿äºææ¯æå·¥å·å¨æçåä¼è¢«å å¥å°Â rhelÂ ç³»ç»ä¸­ï¼å æ­¤Â fedoraÂ ä¹æä¸ºÂ rhelÂ ç³»ç»çè¯éªçæ¬ã\n\n * centosÂ ï¼éè¿æÂ rhelÂ ç³»ç»éæ°ç¼è¯å¹¶åå¸ç»ç¨æ·åè´¹ä½¿ç¨çÂ linuxÂ ç³»ç»ï¼å·æå¹¿æ³çä½¿ç¨äººç¾¤ã\n\n * deepinÂ ï¼ä¸­å½åè¡ï¼å¯¹ä¼ç§çå¼æºæåè¿è¡éæåéç½®ã\n\n * debianÂ ï¼ç¨³å®æ§ãå®å¨æ§å¼ºï¼æä¾äºåè´¹çåºç¡æ¯æï¼å¨å½å¤æ¥æå¾é«çè®¤å¯åº¦åä½¿ç¨çã\n\n * ubuntuÂ ï¼æ¯ä¸æ¬¾æ´¾çèªÂ debianÂ çæä½ç³»ç»ï¼å¯¹æ°æ¬¾ç¡¬ä»¶å·ææå¼ºçå¼å®¹è½åãubuntuÂ ä¸Â fedoraÂ é½æ¯æå¶åºè²çÂ linuxÂ æ¡é¢ç³»ç»ï¼èä¸Â ubuntuÂ ä¹å¯ç¨äºæå¡å¨é¢åã\n\n\n# shell\n\nshellÂ è¿ä¸ªåè¯çåææ¯âå¤å£³âï¼è·Â kernelï¼åæ ¸ï¼ç¸å¯¹åºï¼æ¯å»åæ ¸å¤é¢çä¸å±ï¼å³ç¨æ·è·åæ ¸äº¤äºçå¯¹è¯çé¢ã\n\n * shellÂ æ¯ä¸ä¸ªç¨åºï¼æä¾ä¸ä¸ªä¸ç¨æ·å¯¹è¯çç¯å¢ãè¿ä¸ªç¯å¢åªæä¸ä¸ªå½ä»¤æç¤ºç¬¦ï¼è®©ç¨æ·ä»é®çè¾å¥å½ä»¤ï¼æä»¥åç§°ä¸ºå½ä»¤è¡ç¯å¢ï¼Â command line interfaceÂ ï¼ç®åä¸ºÂ cliÂ ï¼ãshellÂ æ¥æ¶å°ç¨æ·è¾å¥çå½ä»¤ï¼å°å½ä»¤éå¥æä½ç³»ç»æ§è¡ï¼å¹¶å°ç»æè¿åç»ç¨æ·ã\n\n * shellÂ æ¯ä¸ä¸ªå½ä»¤è§£éå¨ï¼è§£éç¨æ·è¾å¥çå½ä»¤ãå®æ¯æåéãæ¡ä»¶å¤æ­ãå¾ªç¯æä½ç­è¯­æ³ï¼æä»¥ç¨æ·å¯ä»¥ç¨Â shellÂ å½ä»¤ååºåç§å°ç¨åºï¼åç§°ä¸ºÂ shellÂ èæ¬ãè¿äºèæ¬é½éè¿shellÂ çè§£éæ§è¡ï¼èä¸éè¿ç¼è¯ã\n\n * shellÂ æ¯ä¸ä¸ªå·¥å·ç®±ï¼æä¾äºåç§å°å·¥å·ï¼ä¾ç¨æ·æ¹ä¾¿å°ä½¿ç¨æä½ç³»ç»çåè½ã\n\nbash æ¯ç®åæå¸¸ç¨ç shell ãmacos ä¸­çé»è®¤ shell å°±æ¯ bash ã éè¿æ§è¡ echo $shell å½ä»¤å¯ä»¥æ¥çå°å½åæ­£å¨ä½¿ç¨ç shell ãè¿å¯ä»¥éè¿ cat /etc/shells æ¥çå½åç³»ç»å®è£çææ shell ç§ç±»ã\n\n\n# å½ä»¤\n\n\n# å½ä»¤è¡æç¤ºç¬¦\n\nè¿å¥å½ä»¤è¡ç¯å¢ä»¥åï¼ç¨æ·ä¼çå°Â shellÂ çæç¤ºç¬¦ãæç¤ºç¬¦å¾å¾æ¯ä¸ä¸²åç¼ï¼æåä»¥ä¸ä¸ªç¾åç¬¦å·Â $Â ç»å°¾ï¼ç¨æ·å¯ä»¥å¨è¿ä¸ªç¬¦å·åé¢è¾å¥åç§å½ä»¤ã\n\nå½ä»¤è§£æï¼\n\n * rootï¼è¡¨ç¤ºç¨æ·åï¼\n\n * izm5e8dsxce9ufaic7hi3uzï¼è¡¨ç¤ºä¸»æºåï¼\n\n * ~ï¼è¡¨ç¤ºç®åæå¨ç®å½ä¸ºå®¶ç®å½ï¼å¶ä¸­Â rootÂ ç¨æ·çå®¶ç®å½æ¯Â /rootÂ æ®éç¨æ·çå®¶ç®å½å¨Â /homeÂ ä¸ï¼\n\n * #ï¼æç¤ºä½ æå·æçæéï¼Â rootÂ ç¨æ·ä¸ºÂ #Â ï¼æ®éç¨æ·ä¸ºÂ $Â ï¼ã\n\n * æ§è¡Â whoamiÂ å½ä»¤å¯ä»¥æ¥çå½åç¨æ·åï¼\n\n * æ§è¡Â hostnameÂ å½ä»¤å¯ä»¥æ¥çå½åä¸»æºåï¼\n\nå³äºå¦ä½åå»ºãåæ¢ãå é¤ç¨æ·ï¼å¨åé¢çç¨æ·ä¸æéä¼å·ä½è®²è§£ï¼è¿éåä½¿ç¨Â rootÂ ç¨æ·è¿è¡æ¼ç¤ºã\n\n[å¤æ³¨] root æ¯è¶çº§ç¨æ·ï¼å·å¤æä½ç³»ç»çä¸åæéãåæ¢å°rootï¼su rootï¼æ¯æ¬¡ç»éç³»ç»rootçå¯ç é½ä¸ä¸æ ·ï¼æ¯éæºçãä½å¯ä»¥ä¿®æ¹ã\n\n\n# æä»¶åç®å½\n\n\n# æä»¶çç»ç»\n\n\n\n\n# æ¥çè·¯å¾\n\n# pwd\n\næ¾ç¤ºå½åç®å½çè·¯å¾\n\n\n\n# which\n\næ¥çå½ä»¤çå¯æ§è¡æä»¶æå¨è·¯å¾ï¼Â linuxÂ ä¸ï¼æ¯ä¸æ¡å½ä»¤å¶å®é½å¯¹åºä¸ä¸ªå¯æ§è¡ç¨åºï¼å¨ç»ç«¯ä¸­è¾å¥å½ä»¤ï¼æåè½¦çæ¶åï¼å°±æ¯æ§è¡äºå¯¹åºçé£ä¸ªç¨åºï¼Â whichÂ å½ä»¤æ¬èº«å¯¹åºçç¨åºä¹å­å¨äºÂ linuxÂ ä¸­ã\n\næ»çæ¥è¯´ä¸ä¸ªå½ä»¤å°±æ¯ä¸ä¸ªå¯æ§è¡ç¨åºã\n\n\n\n\n# æµè§ååæ¢ç®å½\n\n# ls\n\nååºæä»¶åç®å½ï¼å®æ¯Â linuxÂ æå¸¸ç¨çå½ä»¤ä¹ä¸ã\n\nãå¸¸ç¨åæ°ã\n\n * -aÂ æ¾ç¤ºæææä»¶åç®å½åæ¬éèç\n\n * -lÂ æ¾ç¤ºè¯¦ç»åè¡¨\n\n * -hÂ éåäººç±»éè¯»ç\n\n * -tÂ ææä»¶æè¿ä¸æ¬¡ä¿®æ¹æ¶é´æåº\n\n * -iÂ æ¾ç¤ºæä»¶çÂ inodeÂ ï¼Â inodeÂ æ¯æä»¶åå®¹çæ è¯ï¼\n\n\n\n# cd\n\ncdÂ æ¯è±è¯­Â change directoryÂ çç¼©åï¼è¡¨ç¤ºåæ¢ç®å½ã\n\ncdÂ /Â --\x3eÂ è·³è½¬å°æ ¹ç®å½ cdÂ ~Â --\x3eÂ è·³è½¬å°å®¶ç®å½ cdÂ ..Â --\x3eÂ è·³è½¬å°ä¸çº§ç®å½ cdÂ ./homeÂ --\x3eÂ è·³è½¬å°å½åç®å½çhomeç®å½ä¸ cdÂ /home/lionÂ --\x3eÂ è·³è½¬å°æ ¹ç®å½ä¸çhomeç®å½ä¸çlionç®å½ cdÂ --\x3eÂ ä¸æ·»å ä»»ä½åæ°ï¼ä¹æ¯åå°å®¶ç®å½ å¤å¶ä»£ç \n\n[æ³¨æ] è¾å¥cd /hoÂ + åæ¬¡Â tabÂ é®ä¼èªå¨è¡¥å¨è·¯å¾ + ä¸¤æ¬¡Â tabÂ é®ä¼ååºææå¯è½çç®å½åè¡¨ã\n\n# du\n\nåä¸¾ç®å½å¤§å°ä¿¡æ¯ã\n\nãå¸¸ç¨åæ°ã\n\n * -hÂ éåäººç±»éè¯»çï¼\n\n * -aÂ åæ¶åä¸¾åºç®å½ä¸æä»¶çå¤§å°ä¿¡æ¯ï¼\n\n * -sÂ åªæ¾ç¤ºæ»è®¡å¤§å°ï¼ä¸æ¾ç¤ºå·ä½ä¿¡æ¯ã\n\n\n# æµè§ååå»ºæä»¶\n\n# cat\n\nä¸æ¬¡æ§æ¾ç¤ºæä»¶ææåå®¹ï¼æ´éåæ¥çå°çæä»¶ã\n\ncatÂ cloud-init.log å¤å¶ä»£ç \n\nãå¸¸ç¨åæ°ã\n\n * -nÂ æ¾ç¤ºè¡å·ã\n\n# less\n\nåé¡µæ¾ç¤ºæä»¶åå®¹ï¼æ´éåæ¥çå¤§çæä»¶ã\n\nlessÂ cloud-init.log å¤å¶ä»£ç \n\nãå¿«æ·æä½ã\n\n * ç©ºæ ¼é®ï¼åè¿ä¸é¡µï¼ä¸ä¸ªå±å¹ï¼ï¼\n\n * bÂ é®ï¼åéä¸é¡µï¼\n\n * åè½¦é®ï¼åè¿ä¸è¡ï¼\n\n * yÂ é®ï¼åéä¸è¡ï¼\n\n * ä¸ä¸é®ï¼åéæåè¿ä¸è¡ï¼\n\n * dÂ é®ï¼åè¿åé¡µï¼\n\n * uÂ é®ï¼åéåé¡µï¼\n\n * qÂ é®ï¼åæ­¢è¯»åæä»¶ï¼ä¸­æ­¢Â lessÂ å½ä»¤ï¼\n\n * =Â é®ï¼æ¾ç¤ºå½åé¡µé¢çåå®¹æ¯æä»¶ä¸­çç¬¬å è¡å°ç¬¬å è¡ä»¥åä¸äºå¶å®å³äºæ¬é¡µåå®¹çè¯¦ç»ä¿¡æ¯ï¼\n\n * hÂ é®ï¼æ¾ç¤ºå¸®å©ææ¡£ï¼\n\n * /Â é®ï¼è¿å¥æç´¢æ¨¡å¼åï¼æÂ nÂ é®è·³å°ä¸ä¸ªç¬¦åé¡¹ç®ï¼æÂ nÂ é®è·³å°ä¸ä¸ä¸ªç¬¦åé¡¹ç®ï¼åæ¶ä¹å¯ä»¥è¾å¥æ­£åè¡¨è¾¾å¼å¹éã\n\n# head\n\næ¾ç¤ºæä»¶çå¼å¤´å è¡ï¼é»è®¤æ¯10è¡ï¼\n\nheadÂ cloud-init.log å¤å¶ä»£ç \n\nãåæ°ã\n\n * -nÂ æå®è¡æ°Â head cloud-init.log -n 2\n\n# tail\n\næ¾ç¤ºæä»¶çç»å°¾å è¡ï¼é»è®¤æ¯10è¡ï¼\n\ntailÂ cloud-init.logå¤å¶ä»£ç \n\nãåæ°ã\n\n * -nÂ æå®è¡æ°Â tail cloud-init.log -n 2\n\n * -fÂ ä¼æ¯è¿1ç§æ£æ¥ä¸æä»¶æ¯å¦ææ´æ°åå®¹ï¼ä¹å¯ä»¥ç¨Â -sÂ åæ°æå®é´éæ¶é´Â tail -f -s 4 xxx.log\n\n# touch\n\nåå»ºä¸ä¸ªæä»¶\n\ntouchÂ new_fileå¤å¶ä»£ç \n\n# mkdir\n\nåå»ºä¸ä¸ªç®å½\n\nmkdirÂ new_folderå¤å¶ä»£ç \n\nãå¸¸ç¨åæ°ã\n\n * -pÂ éå½çåå»ºç®å½ç»æÂ mkdir -p one/two/three\n\n\n# æä»¶çå¤å¶åç§»å¨\n\n# cp\n\næ·è´æä»¶åç®å½\n\ncp file file_copy --\x3e file æ¯ç®æ æä»¶ï¼file_copy æ¯æ·è´åºæ¥çæä»¶\ncp file one --\x3e æ file æä»¶æ·è´å° one ç®å½ä¸ï¼å¹¶ä¸æä»¶åä¾ç¶ä¸º file\ncp file one/file_copy --\x3e æ file æä»¶æ·è´å° one ç®å½ä¸ï¼æä»¶åä¸ºfile_copy\ncp *.txt folder --\x3e æå½åç®å½ä¸ææ txt æä»¶æ·è´å° folder ç®å½ä¸å¤å¶ä»£ç    \n\n\n1\n2\n3\n4\n\n\nãå¸¸ç¨åæ°ã\n\n * -rÂ éå½çæ·è´ï¼å¸¸ç¨æ¥æ·è´ä¸æ´ä¸ªç®å½\n\n# mv\n\nç§»å¨ï¼éå½åï¼æä»¶æç®å½ï¼ä¸cpå½ä»¤ç¨æ³ç¸ä¼¼ã\n\nmv file one --\x3e å° file æä»¶ç§»å¨å° one ç®å½ä¸\nmv new_folder one --\x3e å° new_folder æä»¶å¤¹ç§»å¨å°oneç®å½ä¸\nmv *.txt folder --\x3e æå½åç®å½ä¸ææ txt æä»¶ç§»å¨å° folder ç®å½ä¸\nmv file new_file --\x3e file æä»¶éå½åä¸º new_fileå¤å¶ä»£ç    \n\n\n1\n2\n3\n4\n\n\n\n# æä»¶çå é¤åé¾æ¥\n\n# rm\n\nå é¤æä»¶åç®å½ï¼ç±äºÂ linuxÂ ä¸æ²¡æåæ¶ç«ï¼ä¸æ¦å é¤éå¸¸é¾æ¢å¤ï¼å æ­¤éè¦è°¨ææä½\n\nrm new_file  --\x3e å é¤ new_file æä»¶\nrm f1 f2 f3  --\x3e åæ¶å é¤ f1 f2 f3 3ä¸ªæä»¶å¤å¶ä»£ç    \n\n\n1\n2\n\n\nãå¸¸ç¨åæ°ã\n\n * -iÂ åç¨æ·ç¡®è®¤æ¯å¦å é¤ï¼\n\n * -fÂ æä»¶å¼ºå¶å é¤ï¼\n\n * -rÂ éå½å é¤æä»¶å¤¹ï¼èåçå é¤æä½Â rm -rfÂ ã\n\n# ln\n\nè±æÂ linkÂ çç¼©åï¼è¡¨ç¤ºåå»ºé¾æ¥ã\n\nå­¦ä¹ åå»ºé¾æ¥ä¹åï¼é¦åè¦çè§£é¾æ¥æ¯ä»ä¹ï¼æä»¬åæ¥ççÂ linuxÂ çæä»¶æ¯å¦ä½å­å¨çï¼\n\nlinuxÂ æä»¶çå­å¨æ¹å¼åä¸º3ä¸ªé¨åï¼æä»¶åãæä»¶åå®¹ä»¥åæéï¼å¶ä¸­æä»¶åçåè¡¨æ¯å­å¨å¨ç¡¬ççå¶å®å°æ¹åæä»¶åå®¹æ¯åå¼å­æ¾çï¼æ¯ä¸ªæä»¶åéè¿Â inodeÂ æ è¯ç»å®å°æä»¶åå®¹ã\n\nlinux ä¸æä¸¤ç§é¾æ¥ç±»åï¼ç¡¬é¾æ¥åè½¯é¾æ¥ã\n\n# ç¡¬é¾æ¥\n\nä½¿é¾æ¥çä¸¤ä¸ªæä»¶å±äº«åæ ·æä»¶åå®¹ï¼å°±æ¯åæ ·çÂ inodeÂ ï¼ä¸æ¦æä»¶1åæä»¶2ä¹é´æäºç¡¬é¾æ¥ï¼é£ä¹ä¿®æ¹ä»»ä½ä¸ä¸ªæä»¶ï¼ä¿®æ¹çé½æ¯åä¸ååå®¹ï¼å®çç¼ºç¹æ¯ï¼åªè½åå»ºæåæä»¶çç¡¬é¾æ¥ï¼ä¸è½åå»ºæåç®å½çï¼å¶å®ä¹å¯ä»¥ï¼ä½æ¯è¾å¤æï¼èè½¯é¾æ¥é½å¯ä»¥ï¼å æ­¤è½¯é¾æ¥ä½¿ç¨æ´å å¹¿æ³ã\n\nln file1 file2  --\x3e åå»º file2 ä¸º file1 çç¡¬é¾æ¥å¤å¶ä»£ç  \n\n\n1\n\n\n\n\nå¦ææä»¬ç¨Â rm file1Â æ¥å é¤Â file1Â ï¼å¯¹Â file2Â æ²¡æä»ä¹å½±åï¼å¯¹äºç¡¬é¾æ¥æ¥è¯´ï¼å é¤ä»»æä¸æ¹çæä»¶ï¼å±åæåçæä»¶åå®¹å¹¶ä¸ä¼ä»ç¡¬çä¸å é¤ãåªæåæ¶å é¤äºÂ file1Â ä¸file2Â åï¼å®ä»¬å±åæåçæä»¶åå®¹æä¼æ¶å¤±ã\n\n# è½¯é¾æ¥\n\nè½¯é¾æ¥å°±ç±»ä¼¼Â windowsÂ ä¸å¿«æ·æ¹å¼ã\n\nln -s file1 file2å¤å¶ä»£ç    \n\n\n1\n\n\n\n\næ§è¡Â ls -lÂ å½åæ¥çå½åç®å½ä¸æä»¶çå·ä½ä¿¡æ¯\n\ntotal 0-rw-r--r-- 1 root root 0 jan 14 06:29 file1lrwxrwxrwx 1 root root 5 jan 14 06:42 file2 -> file1  # è¡¨ç¤ºfile2 æå file1å¤å¶ä»£ç    \n\n\n1\n\n\nå¶å®Â file2Â åªæ¯Â file1Â çä¸ä¸ªå¿«æ·æ¹å¼ï¼å®æåçæ¯Â file1Â ï¼æä»¥æ¾ç¤ºçæ¯Â file1Â çåå®¹ï¼ä½å¶å®Â file2Â çÂ inodeÂ ä¸Â file1Â å¹¶ä¸ç¸åãå¦ææä»¬å é¤äºÂ file2Â çè¯ï¼Â file1æ¯ä¸ä¼åå½±åçï¼ä½å¦æå é¤Â file1Â çè¯ï¼Â file2Â å°±ä¼åææ­»é¾æ¥ï¼å ä¸ºæåçæä»¶ä¸è§äºã\n\n\n# ç¨æ·ä¸æé\n\n\n# ç¨æ·\n\nlinuxÂ æ¯ä¸ä¸ªå¤ç¨æ·çæä½ç³»ç»ãå¨Â linuxÂ ä¸­ï¼çè®ºä¸æ¥è¯´ï¼æä»¬å¯ä»¥åå»ºæ æ°ä¸ªç¨æ·ï¼ä½æ¯è¿äºç¨æ·æ¯è¢«ååå°ä¸åçç¾¤ç»éé¢çï¼æä¸ä¸ªç¨æ·ï¼åå«Â rootÂ ï¼æ¯ä¸ä¸ªå¾ç¹æ®çç¨æ·ï¼å®æ¯è¶çº§ç¨æ·ï¼æ¥ææé«æéã\n\n\n\nèªå·±åå»ºçç¨æ·æ¯æéæéçç¨æ·ï¼è¿æ ·å¤§å¤§æé«äºÂ linuxÂ ç³»ç»çå®å¨æ§ï¼ææé²æ­¢è¯¯æä½ææ¯çæ¯æ»å»ï¼ä½æ¯æä»¬æ§è¡çæäºå½ä»¤éè¦æ´é«æéæ¶å¯ä»¥ä½¿ç¨Â sudoÂ å½ä»¤ã\n\n# sudo\n\nä»¥Â rootÂ èº«ä»½è¿è¡å½ä»¤\n\nsudo date  --\x3e å½ç¶æ¥çæ¥ææ¯ä¸éè¦sudoçè¿éåªæ¯æ¼ç¤ºï¼sudo å®ä¹åä¸è¬è¿éè¦è¾å¥ç¨æ·å¯ç çå¤å¶ä»£ç    \n\n\n1\n\n\n# useradd + passwd\n\n * useraddÂ æ·»å æ°ç¨æ·\n\n * passwdÂ ä¿®æ¹ç¨æ·å¯ç \n\nè¿ä¸¤ä¸ªå½ä»¤éè¦Â rootÂ ç¨æ·æé\n\nuseradd lion --\x3e æ·»å ä¸ä¸ªlionç¨æ·ï¼æ·»å å®ä¹åå¨ /home è·¯å¾ä¸å¯ä»¥æ¥çpasswd lion --\x3e ä¿®æ¹lionç¨æ·çå¯ç å¤å¶ä»£ç    \n\n\n1\n\n\n# userdel\n\nå é¤ç¨æ·ï¼éè¦Â rootÂ ç¨æ·æé\n\nuserdel lion --\x3e åªä¼å é¤ç¨æ·åï¼ä¸ä¼ä»/homeä¸­å é¤å¯¹åºæä»¶å¤¹userdel lion -r --\x3e ä¼åæ¶å é¤/homeä¸çå¯¹åºæä»¶å¤¹å¤å¶ä»£ç  \n\n\n1\n\n\n# su\n\nåæ¢ç¨æ·ï¼éè¦Â rootÂ ç¨æ·æé\n\nsudo su --\x3e åæ¢ä¸ºrootç¨æ·ï¼exit å½ä»¤æ ctrl + d å¿«æ·é®é½å¯ä»¥ä½¿æ®éç¨æ·åæ¢ä¸º root ç¨æ·ï¼\nsu lion --\x3e åæ¢ä¸ºæ®éç¨æ·su - --\x3e åæ¢ä¸ºrootç¨æ·å¤å¶ä»£ç    \n\n\n1\n2\n\n\n\n# ç¾¤ç»çç®¡ç\n\nlinuxÂ ä¸­æ¯ä¸ªç¨æ·é½å±äºä¸ä¸ªç¹å®çç¾¤ç»ï¼å¦æä½ ä¸è®¾ç½®ç¨æ·çç¾¤ç»ï¼é»è®¤ä¼åå»ºä¸ä¸ªåå®çç¨æ·åä¸æ ·çç¾¤ç»ï¼å¹¶ä¸æç¨æ·åå½å°è¿ä¸ªç¾¤ç»ã\n\n# groupadd\n\nåå»ºç¾¤ç»ï¼ç¨æ³åÂ useraddÂ ç±»ä¼¼ã\n\ngroupadd friendså¤å¶ä»£ç    \n\n\n1\n\n\n# groupdel\n\nå é¤ä¸ä¸ªå·²å­å¨çç¾¤ç»\n\ngroupdel foo  --\x3e å é¤fooç¾¤ç»å¤å¶ä»£ç    \n\n\n1\n\n\n# groups\n\næ¥çç¨æ·æå¨ç¾¤ç»\n\ngroups lion  --\x3e æ¥ç lion ç¨æ·æå¨çç¾¤ç»å¤å¶ä»£ç \n\n\n1\n\n\n# usermod\n\nç¨äºä¿®æ¹ç¨æ·çè´¦æ·ã\n\nãå¸¸ç¨åæ°ã\n\n * -lÂ å¯¹ç¨æ·éå½åãéè¦æ³¨æçæ¯Â /homeÂ ä¸­çç¨æ·å®¶ç®å½çåå­ä¸ä¼æ¹åï¼éè¦æå¨ä¿®æ¹ã\n\n * -gÂ ä¿®æ¹ç¨æ·æå¨çç¾¤ç»ï¼ä¾å¦Â usermod -g friends lionä¿®æ¹Â lionÂ ç¨æ·çç¾¤ç»ä¸ºÂ friendsÂ ã\n\n * -gÂ ä¸æ¬¡æ§è®©ç¨æ·æ·»å å¤ä¸ªç¾¤ç»ï¼ä¾å¦Â usermod -g friends,foo,bar lionÂ ã\n\n * -aÂ -gÂ ä¼è®©ä½ ç¦»å¼ååçç¾¤ç»ï¼å¦æä½ ä¸æ³è¿æ ·åçè¯ï¼å°±å¾åæ·»å Â -aÂ åæ°ï¼æå³çappendÂ è¿½å çææã\n\n# chgrp\n\nç¨äºä¿®æ¹æä»¶çç¾¤ç»ã\n\nchgrp bar file.txt --\x3e file.txtæä»¶çç¾¤ç»ä¿®æ¹ä¸ºbarå¤å¶ä»£ç  \n\n\n1\n\n\n# chown\n\næ¹åæä»¶çææèï¼éè¦Â rootÂ èº«ä»½æè½è¿è¡ã\n\nchown lion file.txt --\x3e æå¶å®ç¨æ·åå»ºçfile.txtè½¬è®©ç»lionç¨æ·chown lion:bar file.txt --\x3e æfile.txtçç¨æ·æ¹ä¸ºlionï¼ç¾¤ç»æ¹ä¸ºbarå¤å¶ä»£ç    \n\n\n1\n\n\nãå¸¸ç¨åæ°ã\n\n * -rÂ éå½è®¾ç½®å­ç®å½åå­æä»¶ï¼Â chown -r lion:lion /home/frankÂ æÂ frankÂ æä»¶å¤¹çç¨æ·åç¾¤ç»é½æ¹ä¸ºÂ lionÂ ã\n\n\n# æä»¶æéç®¡ç\n\n# chmod\n\nä¿®æ¹è®¿é®æéã\n\nchmod 740 file.txt\n\n\n1\n\n\nãå¸¸ç¨åæ°ã\n\n * -rÂ å¯ä»¥éå½å°ä¿®æ¹æä»¶è®¿é®æéï¼ä¾å¦Â chmod -r 777 /home/lion\n\nä¿®æ¹æéçç¡®ç®åï¼ä½æ¯çè§£å¶æ·±å±æ¬¡çæä¹ææ¯æ´å éè¦çãä¸é¢æä»¬æ¥ç³»ç»çå­¦ä¹ linuxÂ çæä»¶æéã\n\n[root@lion ~]# ls -ldrwxr-xr-x 5 root root 4096 apr 13  2020 climblrwxrwxrwx 1 root root    7 jan 14 06:41 hello2.c -> hello.c-rw-r--r-- 1 root root  149 jan 13 06:14 hello.cå¤å¶ä»£ç    \n\n\n1\n\n\nå¶ä¸­Â drwxr-xr-xÂ è¡¨ç¤ºæä»¶æç®å½çæéãè®©æä»¬ä¸èµ·æ¥è§£è¯»å®å·ä½ä»£è¡¨ä»ä¹ï¼\n\n * dÂ ï¼è¡¨ç¤ºç®å½ï¼å°±æ¯è¯´è¿æ¯ä¸ä¸ªç®å½ï¼æ®éæä»¶æ¯Â -Â ï¼é¾æ¥æ¯Â lÂ ã\n\n * rÂ ï¼readÂ è¡¨ç¤ºæä»¶å¯è¯»ã\n\n * wÂ ï¼writeÂ è¡¨ç¤ºæä»¶å¯åï¼ä¸è¬æåçæéï¼å°±æå é¤çæéã\n\n * xÂ ï¼executeÂ è¡¨ç¤ºæä»¶å¯æ§è¡ã\n\n * -Â ï¼è¡¨ç¤ºæ²¡æç¸åºæéã\n\næéçæ´ä½æ¯æç¨æ·æ¥ååçï¼å¦ä¸å¾æç¤ºï¼\n\n\n\nç°å¨åæ¥çè§£è¿å¥æéÂ drwxr-xr-xÂ çææï¼\n\n * å®æ¯ä¸ä¸ªæä»¶å¤¹ï¼\n\n * å®çææèå·æï¼è¯»ãåãæ§è¡æéï¼\n\n * å®çç¾¤ç»ç¨æ·å·æï¼è¯»ãæ§è¡çæéï¼æ²¡æåçæéï¼\n\n * å®çå¶å®ç¨æ·å·æï¼è¯»ãæ§è¡çæéï¼æ²¡æåçæéã\n\nç°å¨çè§£äºæéï¼æä»¬ä½¿ç¨Â chmodÂ æ¥å°è¯ä¿®æ¹æéãchmodÂ å®ä¸éè¦æ¯Â rootÂ ç¨æ·æè½è¿è¡çï¼åªè¦ä½ æ¯æ­¤æä»¶ææèï¼å°±å¯ä»¥ç¨Â chmodÂ æ¥ä¿®æ¹æä»¶çè®¿é®æéã\n\n# æ°å­åéæé\n\næé   æ°å­\nr    4\nw    2\nx    1\n\nå æ­¤è¦æ¹åæéï¼åªè¦åä¸äºç®åçå æ³å°±è¡ï¼\n\nchmod 640 hello.c # åæ6 = 4 + 2 + 0 è¡¨ç¤ºææèå·æ rw æé4 = 4 + 0 + 0 è¡¨ç¤ºç¾¤ç»ç¨æ·å·æ r æé0 = 0 + 0 + 0 è¡¨ç¤ºå¶å®ç¨æ·æ²¡ææéå¯¹åºæå­æéä¸ºï¼-rw-r-----å¤å¶ä»£ç \n\n\n1\n\n\n# ç¨å­æ¯æ¥åéæé\n\n * uÂ ï¼userÂ çç¼©åï¼ç¨æ·çææï¼è¡¨ç¤ºææèã\n\n * gÂ ï¼groupÂ çç¼©åï¼ç¾¤ç»çææï¼è¡¨ç¤ºç¾¤ç»ç¨æ·ã\n\n * oÂ ï¼otherÂ çç¼©åï¼å¶å®çææï¼è¡¨ç¤ºå¶å®ç¨æ·ã\n\n * aÂ ï¼allÂ çç¼©åï¼ææçææï¼è¡¨ç¤ºææç¨æ·ã\n\n * +Â ï¼å å·ï¼è¡¨ç¤ºæ·»å æéã\n\n * -Â ï¼åå·ï¼è¡¨ç¤ºå»é¤æéã\n\n * =Â ï¼ç­äºå·ï¼è¡¨ç¤ºåéæéã\n\nchmod u+rx file --\x3e æä»¶fileçææèå¢å è¯»åè¿è¡çæé\nchmod g+r file --\x3e æä»¶fileçç¾¤ç»ç¨æ·å¢å è¯»çæé\nchmod o-r file --\x3e æä»¶fileçå¶å®ç¨æ·ç§»é¤è¯»çæé\nchmod g+r o-r file --\x3e æä»¶fileçç¾¤ç»ç¨æ·å¢å è¯»çæéï¼å¶å®ç¨æ·ç§»é¤è¯»çæé\nchmod go-r file --\x3e æä»¶fileçç¾¤ç»åå¶ä»ç¨æ·ç§»é¤è¯»çæé\nchmod +x file --\x3e æä»¶fileçææç¨æ·å¢å è¿è¡çæé\nchmod u=rwx,g=r,o=- file --\x3e æä»¶fileçææèåéè¯»ååæ§è¡çæéï¼ç¾¤ç»å¶å®ç¨æ·åéè¯»çæéï¼å¶ä»ç¨æ·æ²¡æä»»ä½æéå¤å¶ä»£ç    \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# æ¥æ¾æä»¶\n\n\n# locate\n\næç´¢åå«å³é®å­çæææä»¶åç®å½ãåæ¥éè¦æ¥æ¾çæä»¶åï¼ä¹å¯ä»¥ç¨æ­£åè¡¨è¾¾å¼ã\n\n# å®è£ locate\n\nyumÂ -yÂ installÂ mlocateÂ --\x3eÂ å®è£åupdatedbÂ --\x3eÂ æ´æ°æ°æ®åºå¤å¶ä»£ç locateÂ file.txtlocateÂ fil*.txtå¤å¶ä»£ç \n\n[æ³¨æ]Â locateÂ å½ä»¤ä¼å»æä»¶æ°æ®åºä¸­æ¥æ¾å½ä»¤ï¼èä¸æ¯å¨ç£çæ¥æ¾ï¼å æ­¤ååå»ºçæä»¶å¹¶ä¸ä¼æ´æ°å°æ°æ®åºä¸­ï¼æä»¥æ æ³è¢«æ¥æ¾å°ï¼å¯ä»¥æ§è¡Â updatedbÂ å½ä»¤å»æ´æ°æ°æ®åºã\n\n\n# find\n\nç¨äºæ¥æ¾æä»¶ï¼å®ä¼å»éåä½ çå®éç¡¬çè¿è¡æ¥æ¾ï¼èä¸å®åè®¸æä»¬å¯¹æ¯ä¸ªæ¾å°çæä»¶è¿è¡åç»­æä½ï¼åè½éå¸¸å¼ºå¤§ã\n\nfindÂ <ä½å¤>Â <ä½ç©>Â <åä»ä¹>å¤å¶ä»£ç \n\n * ä½å¤ï¼æå®å¨åªä¸ªç®å½æ¥æ¾ï¼æ­¤ç®å½çææå­ç®å½ä¹ä¼è¢«æ¥æ¾ã\n\n * ä½ç©ï¼æ¥æ¾ä»ä¹ï¼å¯ä»¥æ ¹æ®æä»¶çåå­æ¥æ¥æ¾ï¼ä¹å¯ä»¥æ ¹æ®å¶å¤§å°æ¥æ¥æ¾ï¼è¿å¯ä»¥æ ¹æ®å¶æè¿è®¿é®æ¶é´æ¥æ¥æ¾ã\n\n * åä»ä¹ï¼æ¾å°æä»¶åï¼å¯ä»¥è¿è¡åç»­å¤çï¼å¦æä¸æå®è¿ä¸ªåæ°ï¼Â findÂ å½ä»¤åªä¼æ¾ç¤ºæ¾å°çæä»¶ã\n\n# æ ¹æ®æä»¶åæ¥æ¾\n\nfindÂ -nameÂ "file.txt"Â --\x3eÂ å½åç®å½ä»¥åå­ç®å½ä¸éè¿åç§°æ¥æ¾æä»¶findÂ .Â -nameÂ "syslog"Â --\x3eÂ å½åç®å½ä»¥åå­ç®å½ä¸éè¿åç§°æ¥æ¾æä»¶findÂ /Â -nameÂ "syslog"Â --\x3eÂ æ´ä¸ªç¡¬çä¸æ¥æ¾syslogfindÂ /var/logÂ -nameÂ "syslog"Â --\x3eÂ å¨æå®çç®å½/var/logä¸æ¥æ¾syslogæä»¶findÂ /var/logÂ -nameÂ "syslog*"Â --\x3eÂ æ¥æ¾syslog1ãsyslog2Â ...Â ç­æä»¶ï¼ééç¬¦è¡¨ç¤ºææfindÂ /var/logÂ -nameÂ "*syslog*"Â --\x3eÂ æ¥æ¾åå«syslogçæä»¶Â å¤å¶ä»£ç \n\n[æ³¨æ]Â findÂ å½ä»¤åªä¼æ¥æ¾å®å¨ç¬¦å âä½ç©â å­ç¬¦ä¸²çæä»¶ï¼èÂ locateÂ ä¼æ¥æ¾ææåå«å³é®å­çæä»¶ã\n\n# æ ¹æ®æä»¶å¤§å°æ¥æ¾\n\nfindÂ /varÂ -sizeÂ +10mÂ --\x3eÂ /varÂ ç®å½ä¸æ¥æ¾æä»¶å¤§å°è¶è¿Â 10mÂ çæä»¶findÂ /varÂ -sizeÂ -50kÂ --\x3eÂ /varÂ ç®å½ä¸æ¥æ¾æä»¶å¤§å°å°äºÂ 50kÂ çæä»¶findÂ /varÂ -sizeÂ +1gÂ --\x3eÂ /varÂ ç®å½ä¸æ¥æ¾æä»¶å¤§å°æ¥è¿Â 1gÂ çæä»¶findÂ /varÂ -sizeÂ 1mÂ --\x3eÂ /varÂ ç®å½ä¸æ¥æ¾æä»¶å¤§å°ç­äºÂ 1mÂ çæä»¶å¤å¶ä»£ç \n\n# æ ¹æ®æä»¶æè¿è®¿é®æ¶é´æ¥æ¾\n\nfindÂ -nameÂ "*.txt"Â -atimeÂ -7Â Â --\x3eÂ è¿Â 7å¤©åè®¿é®è¿ç.txtç»å°¾çæä»¶å¤å¶ä»£ç \n\n# ä»æ¥æ¾ç®å½ææä»¶\n\nfindÂ .Â -nameÂ "file"Â -typeÂ fÂ Â --\x3eÂ åªæ¥æ¾å½åç®å½ä¸çfileæä»¶findÂ .Â -nameÂ "file"Â -typeÂ dÂ Â --\x3eÂ åªæ¥æ¾å½åç®å½ä¸çfileç®å½å¤å¶ä»£ç \n\n# æä½æ¥æ¾ç»æ\n\nfindÂ -nameÂ "*.txt"Â -printfÂ "%pÂ -Â %u\\n"Â --\x3eÂ æ¾åºææåç¼ä¸ºtxtçæä»¶ï¼å¹¶æç§Â %pÂ -Â %u\\nÂ æ ¼å¼æå°ï¼å¶ä¸­%p=æä»¶åï¼%u=æä»¶ææèfindÂ -nameÂ "*.jpg"Â -deleteÂ --\x3eÂ å é¤å½åç®å½ä»¥åå­ç®å½ä¸ææ.jpgä¸ºåç¼çæä»¶ï¼ä¸ä¼æå é¤æç¤ºï¼å æ­¤è¦æç¨findÂ -nameÂ "*.c"Â -execÂ chmodÂ 600Â {}Â \\;Â --\x3eÂ å¯¹æ¯ä¸ª.cç»å°¾çæä»¶ï¼é½è¿è¡Â -execÂ åæ°æå®çæä½ï¼{}Â ä¼è¢«æ¥æ¾å°çæä»¶æ¿ä»£ï¼\\;Â æ¯å¿é¡»çç»å°¾findÂ -nameÂ "*.c"Â -okÂ chmodÂ 600Â {}Â \\;Â --\x3eÂ åä¸é¢çåè½ä¸ç´ï¼ä¼å¤ä¸ä¸ªç¡®è®¤æç¤ºå¤å¶ä»£ç ',charsets:{cjk:!0},lastUpdated:"2023/01/24, 08:14:58",lastUpdatedTimestamp:1674548098e3},{title:"LSM æ ",frontmatter:{title:"LSM æ ",date:"2023-05-24T09:44:43.000Z",permalink:"/pages/c2aef8/",categories:["åºç¡","æ°æ®ç»æ","å¸¸è§æ°æ®ç»æ"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/15.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/05.%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/05.LSM%20%E6%A0%91.html",relativePath:"åºç¡/15.æ°æ®ç»æ/05.å¸¸è§æ°æ®ç»æ/05.LSM æ .md",key:"v-2bcd0941",path:"/pages/c2aef8/",headers:[{level:2,title:"1. LSM æ æ°æ®ç»æå®ä¹",slug:"_1-lsm-æ æ°æ®ç»æå®ä¹",normalizedTitle:"1. lsm æ æ°æ®ç»æå®ä¹",charIndex:165},{level:2,title:"2. LSM æ çå¢å æ¹æ¥",slug:"_2-lsm-æ çå¢å æ¹æ¥",normalizedTitle:"2. lsm æ çå¢å æ¹æ¥",charIndex:1225},{level:3,title:"2.1 æå¥æä½",slug:"_2-1-æå¥æä½",normalizedTitle:"2.1 æå¥æä½",charIndex:1243},{level:3,title:"2.2 å é¤æä½",slug:"_2-2-å é¤æä½",normalizedTitle:"2.2 å é¤æä½",charIndex:1427},{level:4,title:"2.2.1 å¾å é¤æ°æ®å¨åå­ä¸­",slug:"_2-2-1-å¾å é¤æ°æ®å¨åå­ä¸­",normalizedTitle:"2.2.1 å¾å é¤æ°æ®å¨åå­ä¸­",charIndex:1532},{level:4,title:"2.2.2 å¾å é¤æ°æ®å¨ç£çä¸­",slug:"_2-2-2-å¾å é¤æ°æ®å¨ç£çä¸­",normalizedTitle:"2.2.2 å¾å é¤æ°æ®å¨ç£çä¸­",charIndex:1610},{level:4,title:"2.2.3 å¾å é¤æ°æ®ä¸å­å¨",slug:"_2-2-3-å¾å é¤æ°æ®ä¸å­å¨",normalizedTitle:"2.2.3 å¾å é¤æ°æ®ä¸å­å¨",charIndex:1707},{level:3,title:"2.3 ä¿®æ¹æä½",slug:"_2-3-ä¿®æ¹æä½",normalizedTitle:"2.3 ä¿®æ¹æä½",charIndex:1904},{level:4,title:"2.3.1 å¾ä¿®æ¹æ°æ®å¨åå­ä¸­",slug:"_2-3-1-å¾ä¿®æ¹æ°æ®å¨åå­ä¸­",normalizedTitle:"2.3.1 å¾ä¿®æ¹æ°æ®å¨åå­ä¸­",charIndex:1970},{level:4,title:"2.3.2 å¾ä¿®æ¹æ°æ®å¨ç£çä¸­",slug:"_2-3-2-å¾ä¿®æ¹æ°æ®å¨ç£çä¸­",normalizedTitle:"2.3.2 å¾ä¿®æ¹æ°æ®å¨ç£çä¸­",charIndex:2046},{level:4,title:"2.3.3 è¯¥æ°æ®ä¸å­å¨",slug:"_2-3-3-è¯¥æ°æ®ä¸å­å¨",normalizedTitle:"2.3.3 è¯¥æ°æ®ä¸å­å¨",charIndex:2141},{level:3,title:"2.4 æ¥è¯¢æä½",slug:"_2-4-æ¥è¯¢æä½",normalizedTitle:"2.4 æ¥è¯¢æä½",charIndex:2371},{level:4,title:"2.4.1 å¾æ¥è¯¢æ°æ®å¨åå­ä¸­",slug:"_2-4-1-å¾æ¥è¯¢æ°æ®å¨åå­ä¸­",normalizedTitle:"2.4.1 å¾æ¥è¯¢æ°æ®å¨åå­ä¸­",charIndex:2543},{level:4,title:"2.4.2 å¾æ¥è¯¢æ°æ®å¨ç£çä¸­",slug:"_2-4-2-å¾æ¥è¯¢æ°æ®å¨ç£çä¸­",normalizedTitle:"2.4.2 å¾æ¥è¯¢æ°æ®å¨ç£çä¸­",charIndex:2714},{level:2,title:"3. LSM æ çåå¹¶æä½",slug:"_3-lsm-æ çåå¹¶æä½",normalizedTitle:"3. lsm æ çåå¹¶æä½",charIndex:3024},{level:3,title:"3.1 åå­æ°æ®åå¥ç£ççåºæ¯",slug:"_3-1-åå­æ°æ®åå¥ç£ççåºæ¯",normalizedTitle:"3.1 åå­æ°æ®åå¥ç£ççåºæ¯",charIndex:3281},{level:3,title:"3.2 ç£çä¸­å¤ä¸ªåçå½å¹¶",slug:"_3-2-ç£çä¸­å¤ä¸ªåçå½å¹¶",normalizedTitle:"3.2 ç£çä¸­å¤ä¸ªåçå½å¹¶",charIndex:3494},{level:2,title:"4. ä¼ç¼ºç¹åæ",slug:"_4-ä¼ç¼ºç¹åæ",normalizedTitle:"4. ä¼ç¼ºç¹åæ",charIndex:3815},{level:2,title:"5. æ»ç»",slug:"_5-æ»ç»",normalizedTitle:"5. æ»ç»",charIndex:4329}],headersStr:"1. LSM æ æ°æ®ç»æå®ä¹ 2. LSM æ çå¢å æ¹æ¥ 2.1 æå¥æä½ 2.2 å é¤æä½ 2.2.1 å¾å é¤æ°æ®å¨åå­ä¸­ 2.2.2 å¾å é¤æ°æ®å¨ç£çä¸­ 2.2.3 å¾å é¤æ°æ®ä¸å­å¨ 2.3 ä¿®æ¹æä½ 2.3.1 å¾ä¿®æ¹æ°æ®å¨åå­ä¸­ 2.3.2 å¾ä¿®æ¹æ°æ®å¨ç£çä¸­ 2.3.3 è¯¥æ°æ®ä¸å­å¨ 2.4 æ¥è¯¢æä½ 2.4.1 å¾æ¥è¯¢æ°æ®å¨åå­ä¸­ 2.4.2 å¾æ¥è¯¢æ°æ®å¨ç£çä¸­ 3. LSM æ çåå¹¶æä½ 3.1 åå­æ°æ®åå¥ç£ççåºæ¯ 3.2 ç£çä¸­å¤ä¸ªåçå½å¹¶ 4. ä¼ç¼ºç¹åæ 5. æ»ç»",content:'> åèï¼æ·±å¥æµåºåæLSMæ ï¼æ¥å¿ç»æåå¹¶æ ï¼\n\nä½¿ç¨åºæ¯ï¼å¾å¤ NoSQL æ°æ®åºçåºå±å­å¨å¼æé½æ¯ LSM æ ï¼å¦ RocksDBãLevelDBãHBase ä»¥å Prometheus ç­ãç¸æ¯äºB/B+æ æèåæç´¢å¼ï¼LSMTreeéç¨äºâç¯çå°ä¸é¡¾ä¸åâçå¹²å¥é½ç£çé¡ºåºåçæ¹æ¡ï¼èµäºäºå®æ ä¸ä¼¦æ¯çåååéã\n\n\n# 1. LSM æ æ°æ®ç»æå®ä¹\n\nLSM æ å¹¶æ²¡æä¸ç§åºå®æ­»çå®ç°æ¹å¼ï¼æ´å¤çæ¯ä¸ç§å°å ç§ç¹æ§ç»ä¸å¨ä¸èµ·çææ³ï¼\n\n * âç£çé¡ºåºåâ\n * âå¤ä¸ªæ (ç¶æ°æ®ç»æ)â\n * âå·ç­ï¼æ°èï¼æ°æ®åçº§â\n * âå®æå½å¹¶â\n * âéåå°æ´æ°â\n\nLSMæ çå®ä¹ï¼\n\n 1. LSMæ æ¯ä¸ä¸ªæ¨ªè·¨åå­åç£ççï¼åå«å¤é¢"å­æ "çä¸ä¸ªæ£®æã\n 2. LSMæ åä¸ºLevel 0ï¼Level 1ï¼Level 2 ... Level n å¤é¢å­æ ï¼å¶ä¸­åªæLevel 0å¨åå­ä¸­ï¼å¶ä½Level 1-nå¨ç£çä¸­ã\n 3. åå­ä¸­çLevel 0å­æ ä¸è¬éç¨æåºæ ï¼çº¢é»æ /AVLæ ï¼ãè·³è¡¨æèTreeMapç­è¿ç±»æåºçæ°æ®ç»æï¼æ¹ä¾¿åç»­é¡ºåºåç£çã\n 4. ç£çä¸­çLevel 1-nå­æ ï¼æ¬è´¨æ¯æ°æ®æå¥½åºåé¡ºåºåå°ç£çä¸çæä»¶ï¼åªæ¯å«åæ èå·²ã\n 5. æ¯ä¸å±çå­æ é½æä¸ä¸ªéå¼å¤§å°ï¼è¾¾å°éå¼åä¼è¿è¡åå¹¶ï¼åå¹¶ç»æåå¥ä¸ä¸å±ã\n 6. åªæåå­ä¸­æ°æ®åè®¸åå°æ´æ°ï¼ç£çä¸æ°æ®çåæ´åªåè®¸è¿½å åï¼ä¸ååå°æ´æ°ã\n\nä»¥ä¸6æ¡å®ä¹ç»æäºLSMæ ï¼å¦ä¸å¾ã\n\n * å¾1ä¸­åæäºå·¦ä¾§ç»¿è²çåå­é¨ååå³ä¾§èè²çç£çé¨åï¼å®ä¹1ï¼ã\n * å¾1å·¦ä¾§ç»¿è²çåå­é¨ååªåå«Level 0æ ï¼å³ä¾§èè²çç£çé¨åååå«Level 1-nç­å¤æ£µ"æ "ï¼å®ä¹2ï¼\n * å¾1å·¦ä¾§ç»¿è²çåå­é¨åä¸­Level 0æ¯ä¸é¢äºåæåºæ ï¼å®ä¹3ï¼ãæ³¨æè¿éçæåºæ§ï¼è¯¥æ§è´¨å³å®äºLSMæ ä¼å¼çè¯»åæ§è½ã\n * å¾1å³ä¾§èè²çç£çé¨åæåå«çLevel 1å°Level nå¤é¢æ ï¼è½ç¶å«åâæ âï¼ä½æ¬è´¨æ¯ææ°æ®keyæå¥½åºåï¼é¡ºåºåå¨ç£çä¸çä¸ä¸ªä¸ªæä»¶ï¼å®ä¹4ï¼ ï¼æ³¨æè¿éåæ¬¡åºç°äºæåºæ§ã\n * åå­ä¸­çLevel 0æ å¨è¾¾å°éå¼åï¼ä¼å¨åå­ä¸­éåæå¥½åºçLevel 0æ å¹¶é¡ºåºåå¥ç£ççLevel 1ãåæ ·çï¼å¨ç£çä¸­çLevel nï¼n>0ï¼è¾¾å°éå¼æ¶ï¼åä¼å°Level nå±çå¤ä¸ªæä»¶è¿è¡å½å¹¶ï¼åå¥Level n+1å±ãï¼å®ä¹5ï¼ é¤äºåå­ä¸­çLevel 0å±ååå°æ´æ°å¤ï¼å¯¹å·²åå¥ç£çä¸çæ°æ®ï¼é½éç¨Appendå½¢å¼çç£çé¡ºåºåï¼å³æ´æ°åå é¤æä½å¹¶ä¸å»ä¿®æ¹èæ°æ®ï¼åªæ¯ç®åçè¿½å æ°æ°æ®ãå¾1ä¸­å³ä¾§èè²çç£çé¨åï¼Level 1åLevel 2ååå«keyä¸º2çæ°æ®ï¼åæ¶å¾1å·¦ä¾§ç»¿è²åå­ä¸­çLevel 0æ ä¹åå«keyä¸º2çæ°æ®èç¹ãï¼å®ä¹6ï¼\n\nä¸é¢æä»¬éµå¾ª LSM æ ç 6 æ¡å®ä¹ï¼éè¿å¨å¾å¯¹ LSM æ çå¢ãå ãæ¹ãæ¥åå½å¹¶è¿è¡è¯¦ç»åæã\n\n\n# 2. LSM æ çå¢å æ¹æ¥\n\n\n# 2.1 æå¥æä½\n\nLSMæ çæå¥è¾ç®åï¼æ°æ®æ èå¾åå­ä¸­çLevel 0æåºæ ä¸¢å³å¯ï¼å¹¶ä¸å³å¿è¯¥æ°æ®æ¯å¦å·²ç»å¨åå­æç£çä¸­å­å¨ãï¼å·²ç»å­å¨è¯¥æ°æ®çè¯ï¼ååºæ¯è½¬æ¢ææ´æ°æä½ï¼\n\næå¥æ°æ®æ¶ï¼æç§ key çå¤§å°ï¼æå¥åå­ä¸­ç Level 0 æåºæ ä¸­ï¼è¯¥æä½å¤æåº¦ä¸ºæ é« log(n)ï¼n ä¸º Level 0 æ çæ°æ®éï¼æä»¥ä»£ä»·å¾ä½ï¼è½å®ç°æé«çåååéã\n\n\n# 2.2 å é¤æä½\n\nLSMæ çå é¤æä½å¹¶ä¸æ¯ç´æ¥å é¤æ°æ®ï¼èæ¯éè¿ä¸ç§å«âå¢ç¢æ è®°âçç¹æ®æ°æ®æ¥æ è¯æ°æ®çå é¤ã\n\nå é¤æä½åä¸ºï¼å¾å é¤æ°æ®å¨åå­ä¸­ãå¾å é¤æ°æ®å¨ç£çä¸­ å è¯¥æ°æ®æ ¹æ¬ä¸å­å¨ ä¸ç§æåµã\n\n# 2.2.1 å¾å é¤æ°æ®å¨åå­ä¸­\n\nå° Level 0 æ ä¸­çå¯¹åºèç¹éç¨å¢ç¢æ è®°å°å¶è¦çã\n\nç¤ºä¾ï¼å é¤ key ç­äº 2 çæ°æ®ï¼ç»æå¦ä¸å¾æç¤ºï¼\n\n# 2.2.2 å¾å é¤æ°æ®å¨ç£çä¸­\n\nä¸å»ä¿®æ¹ç£çä¸çæ°æ®ï¼çé½ä¸çå®ï¼ï¼èæ¯ç´æ¥ååå­ä¸­ç Level 0 æ ä¸­æå¥å¢ç¢æ è®°å³å¯ã\n\nç¤ºä¾ï¼å é¤ key ç­äº 2 çæ°æ®ï¼ç»æå¦ä¸å¾æç¤ºï¼\n\n# 2.2.3 å¾å é¤æ°æ®ä¸å­å¨\n\nè¿ç§æåµç­ä»·äºå¨åå­ç Level 0 æ ä¸­æ°å¢ä¸æ¡å¢ç¢æ è®°ï¼åºæ¯è½¬æ¢ä¸ºæåµ 2.2.3 çåå­ä¸­æå¥å¢ç¢æ è®°æä½ã\n\n----------------------------------------\n\nç»¼åçå¾ä¸è¿°ä¸ç§æåµï¼åç°ä¸è®ºæ°æ®ææ²¡æãå¨åªéï¼å é¤æä½é½æ¯ç­ä»·äºå Level 0 æ ä¸­åå¥å¢ç¢æ è®°ãè¯¥æä½å¤æåº¦ä¸ºæ é«log(n)ï¼ä»£ä»·å¾ä½ã\n\n\n# 2.3 ä¿®æ¹æä½\n\nLSM æ çä¿®æ¹æä½åå é¤æä½å¾åï¼ä¹æ¯åä¸ºä¸ç§æåµï¼å¾ä¿®æ¹æ°æ®å¨åå­ä¸­ãå¨ç£çä¸­å è¯¥æ°æ®æ ¹æ¬ä¸å­å¨ã\n\n# 2.3.1 å¾ä¿®æ¹æ°æ®å¨åå­ä¸­\n\nç¤ºä¾ï¼ä¿®æ¹ key=7 çæ°æ®ãç´æ¥å®ä½å°åå­ä¸­ Level 0 æ ä¸é»è²çæ§ key=7 çä½ç½®ï¼å°å¶è¦çã\n\n# 2.3.2 å¾ä¿®æ¹æ°æ®å¨ç£çä¸­\n\nLSM æ å¹¶ä¸ä¼å»ç£çä¸­ç Level 1 æ ä¸åå°æ´æ°èç key=7 çæ°æ®ï¼èæ¯ç´æ¥å°æ°çèè²çèç¹ 7 æå¥åå­ä¸­ç Level 0 æ ä¸­ã\n\n# 2.3.3 è¯¥æ°æ®ä¸å­å¨\n\næ­¤åºæ¯ç­ä»·äºæåµbï¼ç´æ¥ååå­ä¸­çLevel 0æ æå¥æ°çæ°æ®å³å¯ã\n\n----------------------------------------\n\nç»¼ä¸ä¸ç§æåµå¯ä»¥çåºï¼ä¿®æ¹æä½é½æ¯å¯¹åå­ä¸­ Level 0 è¿è¡è¦ç/æ°å¢æä½ãè¯¥æä½å¤æåº¦ä¸ºæ é« log(n)ï¼ä»£ä»·å¾ä½ã\n\næä»¬ä¼åç°ï¼LSM æ çå¢å ãå é¤ãä¿®æ¹ï¼è¿ä¸ä¸ªé½å±äºåæä½ï¼é½æ¯å¨åå­ä¸­åè¾ï¼å®å¨æ²¡æ¶åå°ç£çæä½ï¼æä»¥éåº¦é£å¿«ï¼åååéé«çç¦»è°±ããã\n\n\n# 2.4 æ¥è¯¢æä½\n\nLSM æ çæ¥è¯¢æä½ä¼æé¡ºåºæ¥æ¾ Level 0ãLevel 1ãLevel 2 ... Level n æ¯ä¸é¢æ ï¼ä¸æ¦å¹éä¾¿è¿åç®æ æ°æ®ï¼ä¸åç»§ç»­æ¥è¯¢ãè¯¥ç­ç¥ä¿è¯äºæ¥å°çä¸å®æ¯ç®æ  key ææ°çæ¬çæ°æ®ï¼æç¹MVCCçæè§ï¼ã\n\næä»¬æ¥ååºæ¯åæï¼ä¾ç¶åä¸º å¾æ¥è¯¢æ°æ®å¨åå­ä¸­ å å¾æ¥è¯¢æ°æ®å¨ç£çä¸­ ä¸¤ç§æåµã\n\n# 2.4.1 å¾æ¥è¯¢æ°æ®å¨åå­ä¸­\n\næ²¿çåå­ä¸­å·²æå¥½åºçLevel 0æ éå½åä¸æ¯è¾æ¥è¯¢ï¼è¿åç®æ èç¹å³å¯ãæä»¬æ³¨æå°ç£çä¸çLevel 1æ ä¸­åæ ·åæ¬ä¸ä¸ªkey=6çè¾èçæ°æ®ãä½LSMæ æ¥è¯¢çæ¶åä¼æç§Level 0ã1ã2 ... nçé¡ºåºæ¥è¯¢ï¼ä¸æ¦æ¥å°ç¬¬ä¸ä¸ªå°±è¿åï¼å æ­¤ç£çä¸èçkey=6çæ°æ®æ²¡äººçå®ï¼æ´ä¸ä¼ä½ä¸ºç»æè¢«è¿åã\n\n# 2.4.2 å¾æ¥è¯¢æ°æ®å¨ç£çä¸­\n\nåæ¥è¯¢åå­ä¸­çLevel 0æ ï¼æ²¡æ¥å°ä¾¿æ¥è¯¢ç£çä¸­çLevel 1æ ï¼è¿æ¯æ²¡æ¥å°ï¼äºæ¯æ¥è¯¢ç£çä¸­çLevel 2æ ï¼å¹éåè¿åkey=6çæ°æ®ã\n\n----------------------------------------\n\nç»¼åä¸è¿°ä¸¤ç§æåµï¼æä»¬åç°ï¼LSM æ çæ¥è¯¢æä½ç¸å¯¹æ¥è¯´ä»£ä»·æ¯è¾é«ï¼éè¦ä»Level 0å°Level nä¸ç´é¡ºåºæ¥ä¸å»ãæç«¯æåµæ¯LSMæ ä¸­ä¸å­å¨è¯¥æ°æ®ï¼åéè¦ææ´ä¸ªåºä»Level 0å°Level nç»æ«äºä¸éï¼ç¶åè¿åæ¥æ æ­¤äººï¼å¯ä»¥éè¿ å¸éè¿æ»¤å¨ + å»ºç«ç¨çç´¢å¼ æ¥ä¼åæ¥è¯¢æä½ï¼ãä»£ä»·å¤§äºä»¥B/B+æ ä¸ºåºæ¬æ°æ®ç»æçä¼ ç»RDBå­å¨å¼æã\n\n\n# 3. LSM æ çåå¹¶æä½\n\nåå¹¶æä½æ¯LSMæ çæ ¸å¿ï¼æ¯ç«LSMæ çåå­å°±å«: æ¥å¿ç»æåå¹¶æ ï¼ç´æ¥ç¹åäºåå¹¶è¿ä¸æä½ï¼\n\nä¹æä»¥å¨å¢ãå ãæ¹ãæ¥è¿åä¸ªåºæ¬æä½ä¹å¤è¿éè¦åå¹¶æä½ï¼\n\n * ä¸æ¯ åå­ => ç£çãå ä¸ºåå­ä¸æ¯æ éå¤§ï¼Level 0æ è¾¾å°éå¼æ¶ï¼éè¦å°æ°æ®ä»åå­å·å°ç£çä¸­ï¼\n * äºæ¯ ç£çå1 + ç£çå2 => å½å¹¶å¥ä¸ä¸å±ãéè¦å¯¹ç£çä¸è¾¾å°éå¼çé¡ºåºæä»¶è¿è¡å½å¹¶ï¼å¹¶å°å½å¹¶ç»æåå¥ä¸ä¸å±ï¼å½å¹¶è¿ç¨ä¸­ä¼æ¸çéå¤çæ°æ®åè¢«å é¤çæ°æ®(å¢ç¢æ è®°)ã\n\næä»¬åå«å¯¹ä¸è¿°ä¸¤ä¸ªåºæ¯è¿è¡åæï¼\n\n\n# 3.1 åå­æ°æ®åå¥ç£ççåºæ¯\n\nä¸å¾å±ç¤ºäºåå­ä¸­ Level 0 æ å¨è¾¾å°éå¼åï¼å½å¹¶åå¥ç£ç Level 1 æ çåºæ¯ã\n\nå½å¹¶ä¹åï¼\n\nå½å¹¶ä¹åï¼\n\nå¯¹åå­ä¸­çLevel 0æ è¿è¡ä¸­åºéåï¼å°æ°æ®é¡ºåºåå¥ç£ççLevel 1å±å³å¯ï¼æä»¬å¯ä»¥çå°å ä¸ºLevel 0æ æ¯å·²ç»æå¥½åºçï¼æä»¥åå¥çLevel 1ä¸­çæ°åä¹æ¯æåºçï¼æåºæ§ä¿è¯äºæ¥è¯¢åå½å¹¶æä½çé«æï¼ã\n\næ­¤æ¶ç£ççLevel 1å±æä¸¤ä¸ªBlockåã\n\n\n# 3.2 ç£çä¸­å¤ä¸ªåçå½å¹¶\n\nä¸å¾å±ç¤ºäºç£çä¸­ Level 1 å±è¾¾å°éå¼æ¶ï¼å¯¹å¶åå«çä¸¤ä¸ª Block åè¿è¡å½å¹¶ï¼å¹¶å°å½å¹¶ç»æåå¥ Level 2 å±çè¿ç¨ã\n\nå½å¹¶ä¹åï¼\n\nå½å¹¶ä¹åï¼\n\næä»¬æ³¨æå° key=5 å key=7 çæ°æ®åæ¶å­å¨äºè¾èçBlock 1åè¾æ°çBlock 2ä¸­ãèå½å¹¶çè¿ç¨æ¯ä¿çè¾æ°çæ°æ®ï¼äºæ¯æä»¬çå°ç»æä¸­ï¼key=5å7çæ°æ®é½æ¯çº¢è²çï¼æ¥èªäºè¾æ°çBlock2ï¼ã\n\n----------------------------------------\n\nç»¼ä¸æä»¬å¯ä»¥çå°ï¼ä¸è®ºæ¯åºæ¯6.1è¿æ¯åºæ¯6.2ï¼ç±äºåå§æ°æ®é½æ¯æåºçï¼å æ­¤å½å¹¶çè¿ç¨åªéè¦å¯¹æ°æ®éè¿è¡ä¸æ¬¡æ«æå³å¯ï¼å¤æåº¦ä¸ºO(n)ã\n\n\n# 4. ä¼ç¼ºç¹åæ\n\nå¯ä»¥çå° LSM æ å°å¢ãå ãæ¹è¿ä¸ç§æä½é½è½¬åä¸ºåå­ insert + ç£çé¡ºåºå(å½Level 0æ»¡çæ¶å)ï¼éè¿è¿ç§æ¹å¼å¾å°äºæ ä¸ä¼¦æ¯çåååéã\n\nLSM æ çæ¥è¯¢è½ååç¸å¯¹è¢«å¼±åï¼ç¸æ¯äº B+ æ çæå¤3~4æ¬¡ç£ç IOï¼LSM æ åè¦ä» Level 0 ä¸è·¯æ¥è¯¢ Level nï¼æç«¯æåµä¸ç­äºåäºå¨è¡¨æ«æãï¼å³ä¾¿åäºç¨çç´¢å¼ï¼ä¹æ¯lg(N0)+lg(N1)+...+lg(Nn)çå¤æåº¦ï¼å¤§äºB+æ çlg(N0+N1+...+Nn)çæ¶é´å¤æåº¦ï¼ã\n\nåæ¶ï¼LSMæ åªappendè¿½å ä¸åå°ä¿®æ¹çç¹æ§å¼å¥äºå½å¹¶æä½ï¼å½å¹¶æä½æ¶åå°å¤§éçç£çIOï¼æ¯è¾æ¶èæ§è½ï¼éè¦åçè®¾ç½®è§¦åè¯¥æä½çåæ°ã\n\nç»¼ä¸æä»¬å¯ä»¥ç»åºLSMæ çä¼ç¼ºç¹ï¼\n\n * ä¼ï¼å¢ãå ãæ¹æä½é£å¿«ï¼åååéæå¤§ã\n * ç¼ºï¼è¯»æä½æ§è½ç¸å¯¹è¢«å¼±åï¼ä¸æé¿åºé´èå´çè¯»æä½ï¼ å½å¹¶æä½è¾èè´¹èµæºã\n\nLSMTreeçå¢ãå ãæ¹ãæ¥åç§åºæ¬æä½çæ¶é´å¤æåº¦åæå¦ä¸æç¤ºï¼\n\næä½   å¹³åä»£ä»·   æåæåµä»£ä»·\nå é¤   1      1\næå¥   1      1\nä¿®æ¹   1      1\næ¥æ¾   lgN    lgN\n\n\n# 5. æ»ç»\n\nLSMæ çè®¾è®¡ååï¼\n\n * ååå­åç£ç\n * åå­åå°æ´æ°\n * ç£çè¿½å æ´æ°\n * å½å¹¶ä¿çæ°å¼\n\nå¦æè¯´B/B+æ çè¯»åæ§è½åºæ¬å¹³è¡¡çè¯ï¼LSMæ çè®¾è®¡ååéè¿èå¼é¨åè¯»æ§è½ï¼æ¢åäºæ ä¸ä¼¦æ¯çåæ§è½ãè¯¥æ°æ®ç»æéåç¨äºåååéè¿è¿å¤§äºè¯»ååéçåºæ¯ï¼å¾å°äºNoSQLå±çåç±åå¥½è¯ã',normalizedContent:'> åèï¼æ·±å¥æµåºåælsmæ ï¼æ¥å¿ç»æåå¹¶æ ï¼\n\nä½¿ç¨åºæ¯ï¼å¾å¤ nosql æ°æ®åºçåºå±å­å¨å¼æé½æ¯ lsm æ ï¼å¦ rocksdbãleveldbãhbase ä»¥å prometheus ç­ãç¸æ¯äºb/b+æ æèåæç´¢å¼ï¼lsmtreeéç¨äºâç¯çå°ä¸é¡¾ä¸åâçå¹²å¥é½ç£çé¡ºåºåçæ¹æ¡ï¼èµäºäºå®æ ä¸ä¼¦æ¯çåååéã\n\n\n# 1. lsm æ æ°æ®ç»æå®ä¹\n\nlsm æ å¹¶æ²¡æä¸ç§åºå®æ­»çå®ç°æ¹å¼ï¼æ´å¤çæ¯ä¸ç§å°å ç§ç¹æ§ç»ä¸å¨ä¸èµ·çææ³ï¼\n\n * âç£çé¡ºåºåâ\n * âå¤ä¸ªæ (ç¶æ°æ®ç»æ)â\n * âå·ç­ï¼æ°èï¼æ°æ®åçº§â\n * âå®æå½å¹¶â\n * âéåå°æ´æ°â\n\nlsmæ çå®ä¹ï¼\n\n 1. lsmæ æ¯ä¸ä¸ªæ¨ªè·¨åå­åç£ççï¼åå«å¤é¢"å­æ "çä¸ä¸ªæ£®æã\n 2. lsmæ åä¸ºlevel 0ï¼level 1ï¼level 2 ... level n å¤é¢å­æ ï¼å¶ä¸­åªælevel 0å¨åå­ä¸­ï¼å¶ä½level 1-nå¨ç£çä¸­ã\n 3. åå­ä¸­çlevel 0å­æ ä¸è¬éç¨æåºæ ï¼çº¢é»æ /avlæ ï¼ãè·³è¡¨æètreemapç­è¿ç±»æåºçæ°æ®ç»æï¼æ¹ä¾¿åç»­é¡ºåºåç£çã\n 4. ç£çä¸­çlevel 1-nå­æ ï¼æ¬è´¨æ¯æ°æ®æå¥½åºåé¡ºåºåå°ç£çä¸çæä»¶ï¼åªæ¯å«åæ èå·²ã\n 5. æ¯ä¸å±çå­æ é½æä¸ä¸ªéå¼å¤§å°ï¼è¾¾å°éå¼åä¼è¿è¡åå¹¶ï¼åå¹¶ç»æåå¥ä¸ä¸å±ã\n 6. åªæåå­ä¸­æ°æ®åè®¸åå°æ´æ°ï¼ç£çä¸æ°æ®çåæ´åªåè®¸è¿½å åï¼ä¸ååå°æ´æ°ã\n\nä»¥ä¸6æ¡å®ä¹ç»æäºlsmæ ï¼å¦ä¸å¾ã\n\n * å¾1ä¸­åæäºå·¦ä¾§ç»¿è²çåå­é¨ååå³ä¾§èè²çç£çé¨åï¼å®ä¹1ï¼ã\n * å¾1å·¦ä¾§ç»¿è²çåå­é¨ååªåå«level 0æ ï¼å³ä¾§èè²çç£çé¨åååå«level 1-nç­å¤æ£µ"æ "ï¼å®ä¹2ï¼\n * å¾1å·¦ä¾§ç»¿è²çåå­é¨åä¸­level 0æ¯ä¸é¢äºåæåºæ ï¼å®ä¹3ï¼ãæ³¨æè¿éçæåºæ§ï¼è¯¥æ§è´¨å³å®äºlsmæ ä¼å¼çè¯»åæ§è½ã\n * å¾1å³ä¾§èè²çç£çé¨åæåå«çlevel 1å°level nå¤é¢æ ï¼è½ç¶å«åâæ âï¼ä½æ¬è´¨æ¯ææ°æ®keyæå¥½åºåï¼é¡ºåºåå¨ç£çä¸çä¸ä¸ªä¸ªæä»¶ï¼å®ä¹4ï¼ ï¼æ³¨æè¿éåæ¬¡åºç°äºæåºæ§ã\n * åå­ä¸­çlevel 0æ å¨è¾¾å°éå¼åï¼ä¼å¨åå­ä¸­éåæå¥½åºçlevel 0æ å¹¶é¡ºåºåå¥ç£ççlevel 1ãåæ ·çï¼å¨ç£çä¸­çlevel nï¼n>0ï¼è¾¾å°éå¼æ¶ï¼åä¼å°level nå±çå¤ä¸ªæä»¶è¿è¡å½å¹¶ï¼åå¥level n+1å±ãï¼å®ä¹5ï¼ é¤äºåå­ä¸­çlevel 0å±ååå°æ´æ°å¤ï¼å¯¹å·²åå¥ç£çä¸çæ°æ®ï¼é½éç¨appendå½¢å¼çç£çé¡ºåºåï¼å³æ´æ°åå é¤æä½å¹¶ä¸å»ä¿®æ¹èæ°æ®ï¼åªæ¯ç®åçè¿½å æ°æ°æ®ãå¾1ä¸­å³ä¾§èè²çç£çé¨åï¼level 1ålevel 2ååå«keyä¸º2çæ°æ®ï¼åæ¶å¾1å·¦ä¾§ç»¿è²åå­ä¸­çlevel 0æ ä¹åå«keyä¸º2çæ°æ®èç¹ãï¼å®ä¹6ï¼\n\nä¸é¢æä»¬éµå¾ª lsm æ ç 6 æ¡å®ä¹ï¼éè¿å¨å¾å¯¹ lsm æ çå¢ãå ãæ¹ãæ¥åå½å¹¶è¿è¡è¯¦ç»åæã\n\n\n# 2. lsm æ çå¢å æ¹æ¥\n\n\n# 2.1 æå¥æä½\n\nlsmæ çæå¥è¾ç®åï¼æ°æ®æ èå¾åå­ä¸­çlevel 0æåºæ ä¸¢å³å¯ï¼å¹¶ä¸å³å¿è¯¥æ°æ®æ¯å¦å·²ç»å¨åå­æç£çä¸­å­å¨ãï¼å·²ç»å­å¨è¯¥æ°æ®çè¯ï¼ååºæ¯è½¬æ¢ææ´æ°æä½ï¼\n\næå¥æ°æ®æ¶ï¼æç§ key çå¤§å°ï¼æå¥åå­ä¸­ç level 0 æåºæ ä¸­ï¼è¯¥æä½å¤æåº¦ä¸ºæ é« log(n)ï¼n ä¸º level 0 æ çæ°æ®éï¼æä»¥ä»£ä»·å¾ä½ï¼è½å®ç°æé«çåååéã\n\n\n# 2.2 å é¤æä½\n\nlsmæ çå é¤æä½å¹¶ä¸æ¯ç´æ¥å é¤æ°æ®ï¼èæ¯éè¿ä¸ç§å«âå¢ç¢æ è®°âçç¹æ®æ°æ®æ¥æ è¯æ°æ®çå é¤ã\n\nå é¤æä½åä¸ºï¼å¾å é¤æ°æ®å¨åå­ä¸­ãå¾å é¤æ°æ®å¨ç£çä¸­ å è¯¥æ°æ®æ ¹æ¬ä¸å­å¨ ä¸ç§æåµã\n\n# 2.2.1 å¾å é¤æ°æ®å¨åå­ä¸­\n\nå° level 0 æ ä¸­çå¯¹åºèç¹éç¨å¢ç¢æ è®°å°å¶è¦çã\n\nç¤ºä¾ï¼å é¤ key ç­äº 2 çæ°æ®ï¼ç»æå¦ä¸å¾æç¤ºï¼\n\n# 2.2.2 å¾å é¤æ°æ®å¨ç£çä¸­\n\nä¸å»ä¿®æ¹ç£çä¸çæ°æ®ï¼çé½ä¸çå®ï¼ï¼èæ¯ç´æ¥ååå­ä¸­ç level 0 æ ä¸­æå¥å¢ç¢æ è®°å³å¯ã\n\nç¤ºä¾ï¼å é¤ key ç­äº 2 çæ°æ®ï¼ç»æå¦ä¸å¾æç¤ºï¼\n\n# 2.2.3 å¾å é¤æ°æ®ä¸å­å¨\n\nè¿ç§æåµç­ä»·äºå¨åå­ç level 0 æ ä¸­æ°å¢ä¸æ¡å¢ç¢æ è®°ï¼åºæ¯è½¬æ¢ä¸ºæåµ 2.2.3 çåå­ä¸­æå¥å¢ç¢æ è®°æä½ã\n\n----------------------------------------\n\nç»¼åçå¾ä¸è¿°ä¸ç§æåµï¼åç°ä¸è®ºæ°æ®ææ²¡æãå¨åªéï¼å é¤æä½é½æ¯ç­ä»·äºå level 0 æ ä¸­åå¥å¢ç¢æ è®°ãè¯¥æä½å¤æåº¦ä¸ºæ é«log(n)ï¼ä»£ä»·å¾ä½ã\n\n\n# 2.3 ä¿®æ¹æä½\n\nlsm æ çä¿®æ¹æä½åå é¤æä½å¾åï¼ä¹æ¯åä¸ºä¸ç§æåµï¼å¾ä¿®æ¹æ°æ®å¨åå­ä¸­ãå¨ç£çä¸­å è¯¥æ°æ®æ ¹æ¬ä¸å­å¨ã\n\n# 2.3.1 å¾ä¿®æ¹æ°æ®å¨åå­ä¸­\n\nç¤ºä¾ï¼ä¿®æ¹ key=7 çæ°æ®ãç´æ¥å®ä½å°åå­ä¸­ level 0 æ ä¸é»è²çæ§ key=7 çä½ç½®ï¼å°å¶è¦çã\n\n# 2.3.2 å¾ä¿®æ¹æ°æ®å¨ç£çä¸­\n\nlsm æ å¹¶ä¸ä¼å»ç£çä¸­ç level 1 æ ä¸åå°æ´æ°èç key=7 çæ°æ®ï¼èæ¯ç´æ¥å°æ°çèè²çèç¹ 7 æå¥åå­ä¸­ç level 0 æ ä¸­ã\n\n# 2.3.3 è¯¥æ°æ®ä¸å­å¨\n\næ­¤åºæ¯ç­ä»·äºæåµbï¼ç´æ¥ååå­ä¸­çlevel 0æ æå¥æ°çæ°æ®å³å¯ã\n\n----------------------------------------\n\nç»¼ä¸ä¸ç§æåµå¯ä»¥çåºï¼ä¿®æ¹æä½é½æ¯å¯¹åå­ä¸­ level 0 è¿è¡è¦ç/æ°å¢æä½ãè¯¥æä½å¤æåº¦ä¸ºæ é« log(n)ï¼ä»£ä»·å¾ä½ã\n\næä»¬ä¼åç°ï¼lsm æ çå¢å ãå é¤ãä¿®æ¹ï¼è¿ä¸ä¸ªé½å±äºåæä½ï¼é½æ¯å¨åå­ä¸­åè¾ï¼å®å¨æ²¡æ¶åå°ç£çæä½ï¼æä»¥éåº¦é£å¿«ï¼åååéé«çç¦»è°±ããã\n\n\n# 2.4 æ¥è¯¢æä½\n\nlsm æ çæ¥è¯¢æä½ä¼æé¡ºåºæ¥æ¾ level 0ãlevel 1ãlevel 2 ... level n æ¯ä¸é¢æ ï¼ä¸æ¦å¹éä¾¿è¿åç®æ æ°æ®ï¼ä¸åç»§ç»­æ¥è¯¢ãè¯¥ç­ç¥ä¿è¯äºæ¥å°çä¸å®æ¯ç®æ  key ææ°çæ¬çæ°æ®ï¼æç¹mvccçæè§ï¼ã\n\næä»¬æ¥ååºæ¯åæï¼ä¾ç¶åä¸º å¾æ¥è¯¢æ°æ®å¨åå­ä¸­ å å¾æ¥è¯¢æ°æ®å¨ç£çä¸­ ä¸¤ç§æåµã\n\n# 2.4.1 å¾æ¥è¯¢æ°æ®å¨åå­ä¸­\n\næ²¿çåå­ä¸­å·²æå¥½åºçlevel 0æ éå½åä¸æ¯è¾æ¥è¯¢ï¼è¿åç®æ èç¹å³å¯ãæä»¬æ³¨æå°ç£çä¸çlevel 1æ ä¸­åæ ·åæ¬ä¸ä¸ªkey=6çè¾èçæ°æ®ãä½lsmæ æ¥è¯¢çæ¶åä¼æç§level 0ã1ã2 ... nçé¡ºåºæ¥è¯¢ï¼ä¸æ¦æ¥å°ç¬¬ä¸ä¸ªå°±è¿åï¼å æ­¤ç£çä¸èçkey=6çæ°æ®æ²¡äººçå®ï¼æ´ä¸ä¼ä½ä¸ºç»æè¢«è¿åã\n\n# 2.4.2 å¾æ¥è¯¢æ°æ®å¨ç£çä¸­\n\nåæ¥è¯¢åå­ä¸­çlevel 0æ ï¼æ²¡æ¥å°ä¾¿æ¥è¯¢ç£çä¸­çlevel 1æ ï¼è¿æ¯æ²¡æ¥å°ï¼äºæ¯æ¥è¯¢ç£çä¸­çlevel 2æ ï¼å¹éåè¿åkey=6çæ°æ®ã\n\n----------------------------------------\n\nç»¼åä¸è¿°ä¸¤ç§æåµï¼æä»¬åç°ï¼lsm æ çæ¥è¯¢æä½ç¸å¯¹æ¥è¯´ä»£ä»·æ¯è¾é«ï¼éè¦ä»level 0å°level nä¸ç´é¡ºåºæ¥ä¸å»ãæç«¯æåµæ¯lsmæ ä¸­ä¸å­å¨è¯¥æ°æ®ï¼åéè¦ææ´ä¸ªåºä»level 0å°level nç»æ«äºä¸éï¼ç¶åè¿åæ¥æ æ­¤äººï¼å¯ä»¥éè¿ å¸éè¿æ»¤å¨ + å»ºç«ç¨çç´¢å¼ æ¥ä¼åæ¥è¯¢æä½ï¼ãä»£ä»·å¤§äºä»¥b/b+æ ä¸ºåºæ¬æ°æ®ç»æçä¼ ç»rdbå­å¨å¼æã\n\n\n# 3. lsm æ çåå¹¶æä½\n\nåå¹¶æä½æ¯lsmæ çæ ¸å¿ï¼æ¯ç«lsmæ çåå­å°±å«: æ¥å¿ç»æåå¹¶æ ï¼ç´æ¥ç¹åäºåå¹¶è¿ä¸æä½ï¼\n\nä¹æä»¥å¨å¢ãå ãæ¹ãæ¥è¿åä¸ªåºæ¬æä½ä¹å¤è¿éè¦åå¹¶æä½ï¼\n\n * ä¸æ¯ åå­ => ç£çãå ä¸ºåå­ä¸æ¯æ éå¤§ï¼level 0æ è¾¾å°éå¼æ¶ï¼éè¦å°æ°æ®ä»åå­å·å°ç£çä¸­ï¼\n * äºæ¯ ç£çå1 + ç£çå2 => å½å¹¶å¥ä¸ä¸å±ãéè¦å¯¹ç£çä¸è¾¾å°éå¼çé¡ºåºæä»¶è¿è¡å½å¹¶ï¼å¹¶å°å½å¹¶ç»æåå¥ä¸ä¸å±ï¼å½å¹¶è¿ç¨ä¸­ä¼æ¸çéå¤çæ°æ®åè¢«å é¤çæ°æ®(å¢ç¢æ è®°)ã\n\næä»¬åå«å¯¹ä¸è¿°ä¸¤ä¸ªåºæ¯è¿è¡åæï¼\n\n\n# 3.1 åå­æ°æ®åå¥ç£ççåºæ¯\n\nä¸å¾å±ç¤ºäºåå­ä¸­ level 0 æ å¨è¾¾å°éå¼åï¼å½å¹¶åå¥ç£ç level 1 æ çåºæ¯ã\n\nå½å¹¶ä¹åï¼\n\nå½å¹¶ä¹åï¼\n\nå¯¹åå­ä¸­çlevel 0æ è¿è¡ä¸­åºéåï¼å°æ°æ®é¡ºåºåå¥ç£ççlevel 1å±å³å¯ï¼æä»¬å¯ä»¥çå°å ä¸ºlevel 0æ æ¯å·²ç»æå¥½åºçï¼æä»¥åå¥çlevel 1ä¸­çæ°åä¹æ¯æåºçï¼æåºæ§ä¿è¯äºæ¥è¯¢åå½å¹¶æä½çé«æï¼ã\n\næ­¤æ¶ç£ççlevel 1å±æä¸¤ä¸ªblockåã\n\n\n# 3.2 ç£çä¸­å¤ä¸ªåçå½å¹¶\n\nä¸å¾å±ç¤ºäºç£çä¸­ level 1 å±è¾¾å°éå¼æ¶ï¼å¯¹å¶åå«çä¸¤ä¸ª block åè¿è¡å½å¹¶ï¼å¹¶å°å½å¹¶ç»æåå¥ level 2 å±çè¿ç¨ã\n\nå½å¹¶ä¹åï¼\n\nå½å¹¶ä¹åï¼\n\næä»¬æ³¨æå° key=5 å key=7 çæ°æ®åæ¶å­å¨äºè¾èçblock 1åè¾æ°çblock 2ä¸­ãèå½å¹¶çè¿ç¨æ¯ä¿çè¾æ°çæ°æ®ï¼äºæ¯æä»¬çå°ç»æä¸­ï¼key=5å7çæ°æ®é½æ¯çº¢è²çï¼æ¥èªäºè¾æ°çblock2ï¼ã\n\n----------------------------------------\n\nç»¼ä¸æä»¬å¯ä»¥çå°ï¼ä¸è®ºæ¯åºæ¯6.1è¿æ¯åºæ¯6.2ï¼ç±äºåå§æ°æ®é½æ¯æåºçï¼å æ­¤å½å¹¶çè¿ç¨åªéè¦å¯¹æ°æ®éè¿è¡ä¸æ¬¡æ«æå³å¯ï¼å¤æåº¦ä¸ºo(n)ã\n\n\n# 4. ä¼ç¼ºç¹åæ\n\nå¯ä»¥çå° lsm æ å°å¢ãå ãæ¹è¿ä¸ç§æä½é½è½¬åä¸ºåå­ insert + ç£çé¡ºåºå(å½level 0æ»¡çæ¶å)ï¼éè¿è¿ç§æ¹å¼å¾å°äºæ ä¸ä¼¦æ¯çåååéã\n\nlsm æ çæ¥è¯¢è½ååç¸å¯¹è¢«å¼±åï¼ç¸æ¯äº b+ æ çæå¤3~4æ¬¡ç£ç ioï¼lsm æ åè¦ä» level 0 ä¸è·¯æ¥è¯¢ level nï¼æç«¯æåµä¸ç­äºåäºå¨è¡¨æ«æãï¼å³ä¾¿åäºç¨çç´¢å¼ï¼ä¹æ¯lg(n0)+lg(n1)+...+lg(nn)çå¤æåº¦ï¼å¤§äºb+æ çlg(n0+n1+...+nn)çæ¶é´å¤æåº¦ï¼ã\n\nåæ¶ï¼lsmæ åªappendè¿½å ä¸åå°ä¿®æ¹çç¹æ§å¼å¥äºå½å¹¶æä½ï¼å½å¹¶æä½æ¶åå°å¤§éçç£çioï¼æ¯è¾æ¶èæ§è½ï¼éè¦åçè®¾ç½®è§¦åè¯¥æä½çåæ°ã\n\nç»¼ä¸æä»¬å¯ä»¥ç»åºlsmæ çä¼ç¼ºç¹ï¼\n\n * ä¼ï¼å¢ãå ãæ¹æä½é£å¿«ï¼åååéæå¤§ã\n * ç¼ºï¼è¯»æä½æ§è½ç¸å¯¹è¢«å¼±åï¼ä¸æé¿åºé´èå´çè¯»æä½ï¼ å½å¹¶æä½è¾èè´¹èµæºã\n\nlsmtreeçå¢ãå ãæ¹ãæ¥åç§åºæ¬æä½çæ¶é´å¤æåº¦åæå¦ä¸æç¤ºï¼\n\næä½   å¹³åä»£ä»·   æåæåµä»£ä»·\nå é¤   1      1\næå¥   1      1\nä¿®æ¹   1      1\næ¥æ¾   lgn    lgn\n\n\n# 5. æ»ç»\n\nlsmæ çè®¾è®¡ååï¼\n\n * ååå­åç£ç\n * åå­åå°æ´æ°\n * ç£çè¿½å æ´æ°\n * å½å¹¶ä¿çæ°å¼\n\nå¦æè¯´b/b+æ çè¯»åæ§è½åºæ¬å¹³è¡¡çè¯ï¼lsmæ çè®¾è®¡ååéè¿èå¼é¨åè¯»æ§è½ï¼æ¢åäºæ ä¸ä¼¦æ¯çåæ§è½ãè¯¥æ°æ®ç»æéåç¨äºåååéè¿è¿å¤§äºè¯»ååéçåºæ¯ï¼å¾å°äºnosqlå±çåç±åå¥½è¯ã',charsets:{cjk:!0},lastUpdated:"2023/05/24, 09:11:54",lastUpdatedTimestamp:1684919514e3},{title:"å¼ç¯è¯",frontmatter:{title:"å¼ç¯è¯",date:"2023-05-30T10:34:39.000Z",permalink:"/pages/850e00/",categories:["åºç¡","äºåç","Kuberneteså¥é¨å®æè¯¾-ç½åé"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/20.%E4%BA%91%E5%8E%9F%E7%94%9F/15.Kubernetes%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98%E8%AF%BE-%E7%BD%97%E5%89%91%E9%94%8B/01.%E5%BC%80%E7%AF%87%E8%AF%8D.html",relativePath:"åºç¡/20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/01.å¼ç¯è¯.md",key:"v-6e3c4c48",path:"/pages/850e00/",headers:[{level:2,title:"ç°å¨çKubernetes",slug:"ç°å¨çkubernetes",normalizedTitle:"ç°å¨çkubernetes",charIndex:2},{level:2,title:"å­¦ä¹  Kubernetes",slug:"å­¦ä¹ -kubernetes",normalizedTitle:"å­¦ä¹  kubernetes",charIndex:232}],headersStr:"ç°å¨çKubernetes å­¦ä¹  Kubernetes",content:"# ç°å¨çKubernetes\n\nKubernetes æä¸ºäºäºå®ä¸çäºåçæä½ç³»ç»ï¼æ¯å®¹å¨ç¼æé¢åççèè³å°ã\n\næ¯ç«ï¼ç°ä»£åºç¨æ¯ä»ä¹ï¼æ¯å¾®æå¡ï¼æ¯æå¡ç½æ ¼ï¼è¿äºç»ç»è¦å´ç»çå®¹å¨æ¥å¼åãé¨ç½²åè¿è¡ï¼èä½¿ç¨å®¹å¨å°±å¿ç¶è¦ç¨å°å®¹å¨ç¼æææ¯ï¼å¨ç°å¨åªæå¯ä¸çéé¡¹ï¼é£å°±æ¯Kubernetesã\n\nDockeråKubernetesç¨çé½æ¯Goã\n\nWHY USE DOCKER ? è¦å¨å®¢æ·çç¯å¢éé¨ç½²èªç åºç¨ï¼ä½ä¾èµåºå·®å¼å¤ªå¤§ï¼å¾é¾æå®ï¼ä½ç¨å®¹å¨ä¼æ¹ä¾¿å¾å¤ã\n\n\n# å­¦ä¹  Kubernetes\n\n * å®ç½æç¨ + åèæå\n * ç½ç»æç¨\n * å¤å¨æï¼çè®ºåå®éæ¯æå·®å«ç\n * æ¬ä¸æ åªæ¯ä¸ªâå¥é¨â\n\nPod ç­ä¼å¤ API å¯¹è±¡ä¹é´çå³ç³»ï¼",normalizedContent:"# ç°å¨çkubernetes\n\nkubernetes æä¸ºäºäºå®ä¸çäºåçæä½ç³»ç»ï¼æ¯å®¹å¨ç¼æé¢åççèè³å°ã\n\næ¯ç«ï¼ç°ä»£åºç¨æ¯ä»ä¹ï¼æ¯å¾®æå¡ï¼æ¯æå¡ç½æ ¼ï¼è¿äºç»ç»è¦å´ç»çå®¹å¨æ¥å¼åãé¨ç½²åè¿è¡ï¼èä½¿ç¨å®¹å¨å°±å¿ç¶è¦ç¨å°å®¹å¨ç¼æææ¯ï¼å¨ç°å¨åªæå¯ä¸çéé¡¹ï¼é£å°±æ¯kubernetesã\n\ndockeråkubernetesç¨çé½æ¯goã\n\nwhy use docker ? è¦å¨å®¢æ·çç¯å¢éé¨ç½²èªç åºç¨ï¼ä½ä¾èµåºå·®å¼å¤ªå¤§ï¼å¾é¾æå®ï¼ä½ç¨å®¹å¨ä¼æ¹ä¾¿å¾å¤ã\n\n\n# å­¦ä¹  kubernetes\n\n * å®ç½æç¨ + åèæå\n * ç½ç»æç¨\n * å¤å¨æï¼çè®ºåå®éæ¯æå·®å«ç\n * æ¬ä¸æ åªæ¯ä¸ªâå¥é¨â\n\npod ç­ä¼å¤ api å¯¹è±¡ä¹é´çå³ç³»ï¼",charsets:{cjk:!0},lastUpdated:"2023/06/07, 00:44:58",lastUpdatedTimestamp:1686098698e3},{title:"åè¯å®¹å¨",frontmatter:{title:"åè¯å®¹å¨",date:"2023-05-30T11:01:16.000Z",permalink:"/pages/1cc8db/",categories:["åºç¡","äºåç","Kuberneteså¥é¨å®æè¯¾-ç½åé"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/20.%E4%BA%91%E5%8E%9F%E7%94%9F/15.Kubernetes%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98%E8%AF%BE-%E7%BD%97%E5%89%91%E9%94%8B/02.%E5%88%9D%E8%AF%86%E5%AE%B9%E5%99%A8.html",relativePath:"åºç¡/20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/02.åè¯å®¹å¨.md",key:"v-2d5f867f",path:"/pages/1cc8db/",headers:[{level:2,title:"1. åè¯å®¹å¨ï¼ä¸äºå¼å¤´é¾",slug:"_1-åè¯å®¹å¨-ä¸äºå¼å¤´é¾",normalizedTitle:"1. åè¯å®¹å¨ï¼ä¸äºå¼å¤´é¾",charIndex:2},{level:3,title:"Docker çå½¢æ",slug:"docker-çå½¢æ",normalizedTitle:"docker çå½¢æ",charIndex:20},{level:3,title:"Docker å½ä»¤",slug:"docker-å½ä»¤",normalizedTitle:"docker å½ä»¤",charIndex:350},{level:3,title:"Docker çæ¶æ",slug:"docker-çæ¶æ",normalizedTitle:"docker çæ¶æ",charIndex:520},{level:3,title:"ä¸èææºçåºå«",slug:"ä¸èææºçåºå«",normalizedTitle:"ä¸èææºçåºå«",charIndex:852},{level:2,title:"2. è¢«éç¦»çè¿ç¨ï¼ä¸èµ·æ¥ççå®¹å¨çæ¬è´¨",slug:"_2-è¢«éç¦»çè¿ç¨-ä¸èµ·æ¥ççå®¹å¨çæ¬è´¨",normalizedTitle:"2. è¢«éç¦»çè¿ç¨ï¼ä¸èµ·æ¥ççå®¹å¨çæ¬è´¨",charIndex:864},{level:3,title:"éç¦»æ¯æä¹å®ç°ç",slug:"éç¦»æ¯æä¹å®ç°ç",normalizedTitle:"éç¦»æ¯æä¹å®ç°ç",charIndex:1259},{level:2,title:"3. å®¹å¨åçåºç¨",slug:"_3-å®¹å¨åçåºç¨",normalizedTitle:"3. å®¹å¨åçåºç¨",charIndex:1673},{level:3,title:"ä»ä¹æ¯å®¹å¨åçåºç¨",slug:"ä»ä¹æ¯å®¹å¨åçåºç¨",normalizedTitle:"ä»ä¹æ¯å®¹å¨åçåºç¨",charIndex:1687},{level:3,title:"æçºµå®¹å¨ååºç¨ï¼å¸¸ç¨å½ä»¤ï¼",slug:"æçºµå®¹å¨ååºç¨-å¸¸ç¨å½ä»¤",normalizedTitle:"æçºµå®¹å¨ååºç¨ï¼å¸¸ç¨å½ä»¤ï¼",charIndex:2031},{level:2,title:"4. åå»ºå®¹å¨éåï¼ç¼åDockerfileï¼",slug:"_4-åå»ºå®¹å¨éå-ç¼ådockerfile",normalizedTitle:"4. åå»ºå®¹å¨éåï¼ç¼ådockerfileï¼",charIndex:2049},{level:3,title:"éåçåé¨æºå¶:åå±",slug:"éåçåé¨æºå¶-åå±",normalizedTitle:"éåçåé¨æºå¶:åå±",charIndex:2121},{level:3,title:"Dockerfile æ¯ä»ä¹",slug:"dockerfile-æ¯ä»ä¹",normalizedTitle:"dockerfile æ¯ä»ä¹",charIndex:2740},{level:3,title:"ææ ·ç¼åæ­£ç¡®ãé«æçDockerfile",slug:"ææ ·ç¼åæ­£ç¡®ãé«æçdockerfile",normalizedTitle:"ææ ·ç¼åæ­£ç¡®ãé«æçdockerfile",charIndex:2759},{level:3,title:"docker buildæ¯æä¹å·¥ä½ç",slug:"docker-buildæ¯æä¹å·¥ä½ç",normalizedTitle:"docker buildæ¯æä¹å·¥ä½ç",charIndex:4264},{level:2,title:"5. éåä»åºï¼è¯¥ææ ·ç¨å¥½Docker Hubè¿ä¸ªå®è",slug:"_5-éåä»åº-è¯¥ææ ·ç¨å¥½docker-hubè¿ä¸ªå®è",normalizedTitle:"5. éåä»åºï¼è¯¥ææ ·ç¨å¥½docker hubè¿ä¸ªå®è",charIndex:4516},{level:2,title:"6. æç ´æ¬¡åå£ï¼å®¹å¨è¯¥å¦ä½ä¸å¤çäºèäºé",slug:"_6-æç ´æ¬¡åå£-å®¹å¨è¯¥å¦ä½ä¸å¤çäºèäºé",normalizedTitle:"6. æç ´æ¬¡åå£ï¼å®¹å¨è¯¥å¦ä½ä¸å¤çäºèäºé",charIndex:4553},{level:3,title:"å¦ä½æ·è´å®¹å¨åçæ°æ®",slug:"å¦ä½æ·è´å®¹å¨åçæ°æ®",normalizedTitle:"å¦ä½æ·è´å®¹å¨åçæ°æ®",charIndex:4920},{level:3,title:"å¦ä½å±äº«ä¸»æºä¸çæä»¶ï¼æè½½",slug:"å¦ä½å±äº«ä¸»æºä¸çæä»¶-æè½½",normalizedTitle:"å¦ä½å±äº«ä¸»æºä¸çæä»¶ï¼æè½½",charIndex:5314},{level:3,title:"å¦ä½å®ç°ç½ç»äºé",slug:"å¦ä½å®ç°ç½ç»äºé",normalizedTitle:"å¦ä½å®ç°ç½ç»äºé",charIndex:6317},{level:3,title:"å¦ä½åéæå¡ç«¯å£å·",slug:"å¦ä½åéæå¡ç«¯å£å·",normalizedTitle:"å¦ä½åéæå¡ç«¯å£å·",charIndex:7664}],headersStr:"1. åè¯å®¹å¨ï¼ä¸äºå¼å¤´é¾ Docker çå½¢æ Docker å½ä»¤ Docker çæ¶æ ä¸èææºçåºå« 2. è¢«éç¦»çè¿ç¨ï¼ä¸èµ·æ¥ççå®¹å¨çæ¬è´¨ éç¦»æ¯æä¹å®ç°ç 3. å®¹å¨åçåºç¨ ä»ä¹æ¯å®¹å¨åçåºç¨ æçºµå®¹å¨ååºç¨ï¼å¸¸ç¨å½ä»¤ï¼ 4. åå»ºå®¹å¨éåï¼ç¼åDockerfileï¼ éåçåé¨æºå¶:åå± Dockerfile æ¯ä»ä¹ ææ ·ç¼åæ­£ç¡®ãé«æçDockerfile docker buildæ¯æä¹å·¥ä½ç 5. éåä»åºï¼è¯¥ææ ·ç¨å¥½Docker Hubè¿ä¸ªå®è 6. æç ´æ¬¡åå£ï¼å®¹å¨è¯¥å¦ä½ä¸å¤çäºèäºé å¦ä½æ·è´å®¹å¨åçæ°æ® å¦ä½å±äº«ä¸»æºä¸çæä»¶ï¼æè½½ å¦ä½å®ç°ç½ç»äºé å¦ä½åéæå¡ç«¯å£å·",content:'# 1. åè¯å®¹å¨ï¼ä¸äºå¼å¤´é¾\n\n\n# Docker çå½¢æ\n\nç®åä½¿ç¨Dockeråºæ¬ä¸æä¸¤ä¸ªéæ©ï¼ Docker Desktop å Docker Engineã\n\n * Docker Desktopæ¯ä¸é¨éå¯¹ä¸ªäººä½¿ç¨èè®¾è®¡çï¼æ¯æMacåWindowså¿«éå®è£ï¼å·æç´è§çå¾å½¢çé¢ï¼è¿éæäºè®¸å¤å¨è¾¹å·¥å·ï¼æ¹ä¾¿æç¨ãåªæ¯å¯¹ä¸ªäººå­¦ä¹ åè´¹ï¼åæ¡æ¬¾éå¶ä¸è½åç¨ï¼æä»¬å¨æ¥å¸¸å·¥ä½ä¸­é¾åä¼âè¸©å°é·åºâã\n * Docker Engine åªè½å¨Linuxä¸è¿è¡ï¼åªè½ä½¿ç¨å½ä»¤è¡æä½ï¼ç¼ºä¹è¾å©å·¥å·ï¼éè¦æä»¬èªå·±å¨æDIYè¿è¡ç¯å¢ãä¸è¿è¦æ¯è¾èµ·çæ¥ï¼å®ææ¯Dockerå½åççæ­£å½¢æï¼âè¡èâæçº¯æ­£ï¼ä¹æ¯ç°å¨åä¸ªå¬å¸å¨çäº§ç¯å¢ä¸­å®éä½¿ç¨çDockeräº§åï¼æ¯ç«æºæ¿é99%çæå¡å¨è·çé½æ¯Linuxã\n\n\n# Docker å½ä»¤\n\nDocker Engineéè¦ä½¿ç¨å½ä»¤è¡æä½ï¼ä¸»å½ä»¤æ¯ dockerï¼åé¢åæ¥åç§å­å½ä»¤ã\n\næ¥çDockerçåºæ¬ä¿¡æ¯çå½ä»¤æ¯ docker version å docker info ï¼å¶ä»å¸¸ç¨çå½ä»¤æ docker psã docker pullã docker imagesã docker runã\n\n\n# Docker çæ¶æ\n\næä»¬æ²çå½ä»¤è¡ docker å®éä¸æ¯ä¸ä¸ªå®¢æ·ç«¯client ï¼å®ä¼ä¸Docker Engineéçåå°æå¡Docker daemonéä¿¡ï¼èéååå­å¨å¨è¿ç«¯çä»åºRegistryéï¼å®¢æ·ç«¯å¹¶ä¸è½ç´æ¥è®¿é®éåä»åºã\n\nDocker clientå¯ä»¥éè¿ buildã pullã run ç­å½ä»¤åDocker daemonåéè¯·æ±ï¼èDocker daemonåæ¯å®¹å¨åéåçâå¤§ç®¡å®¶âï¼è´è´£ä»è¿ç«¯æåéåãå¨æ¬å°å­å¨éåï¼è¿æä»éåçæå®¹å¨ãç®¡çå®¹å¨ç­ææåè½ã æä»¥ï¼å¨Docker Engineéï¼çæ­£å¹²æ´»çå¶å®æ¯é»é»è¿è¡å¨åå°çDocker daemonï¼èæä»¬å®éæä½çå½ä»¤è¡å·¥å·âdockerâåªæ¯ä¸ªâä¼ å£°ç­âçè§è²ã\n\n\n# ä¸èææºçåºå«\n\n\n# 2. è¢«éç¦»çè¿ç¨ï¼ä¸èµ·æ¥ççå®¹å¨çæ¬è´¨\n\nå¹¿ä¹ä¸æ¥è¯´ï¼å®¹å¨ææ¯æ¯å¨æçå®¹å¨ãéæçéååè¿ç«¯çä»åºè¿ä¸èçç»åãä»å¤©å°±æ¥ççç©¶ç«ä»ä¹æ¯å®¹å¨ï¼å³ç­ä¹çãå¨æçå®¹å¨ï¼ã\n\nå®¹å¨å°è£äºè¿è¡ä¸­çè¿ç¨ï¼å¹¶æè¿ç¨ä¸å¤çç¯å¢éç¦»å¼ï¼è®©è¿ç¨ä¸å¤é¨ç³»ç»äºä¸å½±åãå®å°±æ¯ä¸ä¸ªç¹æ®çéç¦»ç¯å¢ï¼å®è½å¤è®©è¿ç¨åªçå°è¿ä¸ªç¯å¢éçæéä¿¡æ¯ï¼ä¸è½å¯¹å¤çç¯å¢æ½å å½±åã\n\nä½¿ç¨å®¹å¨ææ¯ï¼æä»¬å°±å¯ä»¥è®©åºç¨ç¨åºè¿è¡å¨ä¸ä¸ªæä¸¥å¯é²æ¤ç**âæ²çâï¼Sandboxï¼**ç¯å¢ä¹åï¼å°±å¥½åæ¯æè¿ç¨è¯·è¿äºâéç¦»éåºâï¼å®å¯ä»¥å¨è¿ä¸ªç¯å¢éèªç±æ´»å¨ï¼ä½ç»ä¸åè®¸âè¶çâï¼ä»èä¿è¯äºå®¹å¨å¤ç³»ç»çå®å¨ã\n\nå®¹å¨ææ¯çå¦ä¸ä¸ªæ¬é¢å°±æ¯ä¸ºåºç¨ç¨åºå ä¸èµæºéç¦»ï¼å¨ç³»ç»éåååºä¸é¨åèµæºï¼è®©å®åªè½ä½¿ç¨æå®çéé¢ãè¿å¯ä»¥é¿åå®¹å¨åè¿ç¨çè¿æ¸¡ç³»ç»æ¶èï¼å¹¶ååå©ç¨è®¡ç®æºç¡¬ä»¶ï¼è®©æéçèµæºè½å¤æä¾ç¨³å®å¯é çæå¡ã\n\nå®¹å¨æ¬è´¨ä¸å°±æ¯ä¸ç§ç¹æ®çè¿ç¨ã\n\n\n# éç¦»æ¯æä¹å®ç°ç\n\nå¥¥ç§å¨äº Linux åæ ¸ææä¾çä¸ä¸ªææ¯ï¼namespaceãcgroup å chrootï¼è½ç¶è¿ä¸ä¸ªææ¯çåè¡·é½ä¸æ¯ä¸ºäºå®ç°å®¹å¨ï¼ä½ç»åå¨ä¸èµ·å°±ä¼åçå¥å¦çâåå­¦ååºâã\n\n * namespaceï¼å®å¯ä»¥åå»ºåºç¬ç«çæä»¶ç³»ç»ãä¸»æºåãè¿ç¨å·ãç½ç»ç­èµæºç©ºé´ï¼ç¸å½äºç»è¿ç¨çäºä¸é´å°æ¿æ¿ï¼è¿æ ·å°±å®ç°äºç³»ç»å¨å±èµæºåè¿ç¨å±é¨èµæºçéç¦»ã\n * cgroupï¼å¨ç§°æ¯ Linux Control Groupï¼ç¨æ¥å®ç°å¯¹è¿ç¨ç CPUãåå­ç­èµæºçä¼åçº§åéé¢éå¶ï¼ç¸å½äºç»è¿ç¨çå°æ¿æ¿å äºä¸ä¸ªå¤©è±æ¿ã\n * chrootï¼å®å¯ä»¥æ´æ¹è¿ç¨çæ ¹ç®å½ï¼ä¹å°±æ¯éå¶è®¿é®æä»¶ç³»ç»ï¼ç¸å½äºç»è¿ç¨çå°æ¿æ¿éºä¸äºå°ç ã ç»¼åè¿ç¨ä»¥ä¸ä¸ä¸ªææ¯ï¼ä¸ä¸ªååæ¹æ¹ãå·æå®åçéç¦»ç¹æ§çå®¹å¨å°±æ­¤åºç°äºï¼è¿ç¨ä¹å°±å¯ä»¥æ¬è¿å»å¿«ä¹çæ´»å¦ã\n\n> ç®åå®¹å¨ææ¯åºæ¬ä¸åä½¿ç¨å¤èç chroot äºï¼èæ¯æ¹ç¨ pivot_rootã\n\n\n# 3. å®¹å¨åçåºç¨\n\n\n# ä»ä¹æ¯å®¹å¨åçåºç¨\n\néåæ¯å®¹å¨çéæå½¢å¼ï¼å®æåäºåºç¨ç¨åºçææè¿è¡ä¾èµé¡¹ï¼æ¹ä¾¿ä¿å­åä¼ è¾ãä½¿ç¨å®¹å¨ææ¯è¿è¡éåï¼å°±å½¢æäºå¨æçå®¹å¨ï¼ç±äºéååªè¯»ä¸å¯ä¿®æ¹ï¼æä»¥åºç¨ç¨åºçè¿è¡ç¯å¢æ»æ¯ä¸è´çã\n\nä»»ä½åºç¨é½è½å¤æåååååè¿è¡ï¼è¿ä¹æ¯æ æ°å¼åèæ¢¦å¯ä»¥æ±çâä¸æ¬¡ç¼åï¼å°å¤è¿è¡ï¼Build once, Run anywhereï¼âçè³é«å¢çãæä»¥ï¼ æè°çâå®¹å¨åçåºç¨âï¼æèâåºç¨çå®¹å¨åâï¼å°±æ¯æåºç¨ç¨åºä¸åç´æ¥åæä½ç³»ç»æäº¤éï¼èæ¯å°è£æéåï¼åäº¤ç»å®¹å¨ç¯å¢å»è¿è¡ã\n\nç°å¨ä½ å°±åºè¯¥ç¥éäºï¼éåå°±æ¯éæçåºç¨å®¹å¨ï¼å®¹å¨å°±æ¯å¨æçåºç¨éåï¼ä¸¤èäºç¸ä¾å­ï¼äºç¸è½¬åï¼å¯ä¸å¯åã\n\n> Dockeråªä¸è¿æ¯ä¼å¤å®¹å¨è¿è¡æ¶ï¼Container Runtimeï¼ä¸­æåºåçä¸æ¬¾èå·²ã\n\n\n# æçºµå®¹å¨ååºç¨ï¼å¸¸ç¨å½ä»¤ï¼\n\n\n# 4. åå»ºå®¹å¨éåï¼ç¼åDockerfileï¼\n\næ¬èè®²è§£éåçåé¨æºå¶ï¼è¿æé«æãæ­£ç¡®å°ç¼åDockerfileå¶ä½å®¹å¨éåçæ¹æ³ã\n\n\n# éåçåé¨æºå¶:åå±\n\néåå°±æ¯ä¸ä¸ªæåæä»¶ï¼éé¢åå«äºåºç¨ç¨åºè¿æå®è¿è¡æä¾èµçç¯å¢ï¼ä¾å¦æä»¶ç³»ç»ãç¯å¢åéãéç½®åæ°ç­ç­ã\n\n * ç¯å¢åéãéç½®åæ°ï¼ç¨ä¸ä¸ªmanifestæ¸åå°±å¯ä»¥ç®¡ç\n * æä»¶ç³»ç»ï¼è¾éº»ç¦ãä¸ºäºä¿è¯å®¹å¨è¿è¡ç¯å¢çä¸è´æ§ï¼éåå¿é¡»æåºç¨ç¨åºæå¨æä½ç³»ç»çæ ¹ç®å½ï¼rootfsï¼ï¼é½åå«è¿æ¥ã\n\nä¸ºé¿åå¤ä¸ªéåé½å¯¹Ubuntuæ ¹ç®å½æä»¶æåï¼é æå¯¹ç£çå­å¨ãç½ç»ä¼ è¾çæµªè´¹ï¼éå¯¹å®¹å¨éåæäºâåå±âï¼layerï¼çæ¦å¿µã\n\n> å®¹å¨éåæ¯ç±å¤ä¸ªåªè¯»çLayerææçï¼åä¸ä¸ªLayerå¯ä»¥è¢«ä¸åçéåå±äº«ï¼åå°äºå­å¨åä¼ è¾çææ¬ã\n\nå®¹å¨éååé¨å¹¶ä¸æ¯ä¸ä¸ªå¹³å¦çç»æï¼èæ¯ç±è®¸å¤çéåå±ç»æçï¼æ¯å±é½æ¯åªè¯»ä¸å¯ä¿®æ¹çä¸ç»æä»¶ï¼ç¸åçå±å¯ä»¥å¨éåä¹é´å±äº«ï¼ç¶åå¤ä¸ªå±åæ­ç§¯æ¨ä¸æ ·å å èµ·æ¥ï¼åä½¿ç¨ä¸ç§å«â Union FSèåæä»¶ç³»ç»âçææ¯æå®ä»¬åå¹¶å¨ä¸èµ·ï¼å°±å½¢æäºå®¹å¨æç»çå°çæä»¶ç³»ç»ï¼ å¾çæ¥æºï¼ã\n\nå¯ä»¥ç¨å½ä»¤ docker inspect æ¥æ¥çéåçåå±ä¿¡æ¯ï¼å®çåå±ä¿¡æ¯å¨âRootFSâé¨åã\n\nç¸ä¿¡ä½ ç°å¨ä¹å°±æç½ï¼ä¹åå¨ä½¿ç¨ docker pullã docker rmi ç­å½ä»¤æä½éåçæ¶åï¼é£äºâå¥æªâçè¾åºä¿¡æ¯æ¯ä»ä¹äºï¼å¶å®å°±æ¯éåéçåä¸ªLayerãDockerä¼æ£æ¥æ¯å¦æéå¤çå±ï¼å¦ææ¬å°å·²ç»å­å¨å°±ä¸ä¼éå¤ä¸è½½ï¼å¦æå±è¢«å¶ä»éåå±äº«å°±ä¸ä¼å é¤ï¼è¿æ ·å°±å¯ä»¥èçº¦ç£çåç½ç»ææ¬ã\n\n\n# Dockerfile æ¯ä»ä¹\n\n\n# ææ ·ç¼åæ­£ç¡®ãé«æçDockerfile\n\n * FROM: åºç¡éå\n * COPY: ä¸äºéè¦æåè¿éåéçæºç ãéç½®ç­æä»¶\n * ADD: ä¸ COPY çåºå«æ¯COPYçSRCåªè½æ¯æ¬å°æä»¶ï¼å¶ä»ç¨æ³ä¸è´\n * RUN: æ§è¡ä»»æçShellå½ä»¤ï¼æ¯å¦æ´æ°ç³»ç»ãå®è£åºç¨ãä¸è½½æä»¶ãåå»ºç®å½ãç¼è¯ç¨åºç­ç­ï¼å®ç°ä»»æçéåæå»ºæ­¥éª¤ï¼éå¸¸çµæ´»\n * ARG: åå»ºçåéåªå¨éåæå»ºè¿ç¨ä¸­å¯è§ï¼å®¹å¨è¿è¡æ¶ä¸å¯è§\n * ENV: åå»ºçåéä¸ä»è½å¤å¨æå»ºéåçè¿ç¨ä¸­ä½¿ç¨ï¼å¨å®¹å¨è¿è¡æ¶ä¹è½å¤ä»¥ç¯å¢åéçå½¢å¼è¢«åºç¨ç¨åºä½¿ç¨\n * EXPOSE: å£°æå®¹å¨å¯¹å¤æå¡çç«¯å£å·\n * ENTRYPOINT:\n\nEXPOSE 443           # é»è®¤æ¯tcpåè®®\nEXPOSE 53/udp        # å¯ä»¥æå®udpåè®®\n\n\n\n1\n2\n3\n\nå³äº RUN æä»¤çä¸äºç»è\n\nRUN éå¸¸ä¼æ¯Dockerfileéæå¤æçæä»¤ï¼ä¼åå«å¾å¤çShellå½ä»¤ï¼ä½Dockerfileéä¸æ¡æä»¤åªè½æ¯ä¸è¡ï¼æä»¥æç RUN æä»¤ä¼å¨æ¯è¡çæ«å°¾ä½¿ç¨ç»­è¡ç¬¦ \\ï¼å½ä»¤ä¹é´ä¹ä¼ç¨ && æ¥è¿æ¥ï¼è¿æ ·ä¿è¯å¨é»è¾ä¸æ¯ä¸è¡ï¼å°±åä¸é¢è¿æ ·ï¼\n\nRUN apt-get update \\\n    && apt-get install -y \\\n        build-essential \\\n        curl \\\n        make \\\n        unzip \\\n    && cd /tmp \\\n    && curl -fSL xxx.tar.gz -o xxx.tar.gz\\\n    && tar xzf xxx.tar.gz \\\n    && cd xxx \\\n    && ./config \\\n    && make \\\n    && make clean\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næçæ¶åå¨Dockerfileéåè¿ç§è¶é¿ç RUN æä»¤å¾ä¸ç¾è§ï¼èä¸ä¸æ¦åéäºï¼æ¯æ¬¡è°è¯é½è¦éæ°æå»ºä¹å¾éº»ç¦ï¼æä»¥ä½ å¯ä»¥éç¨ä¸ç§åéçæå·§ï¼ æè¿äºShellå½ä»¤éä¸­å°ä¸ä¸ªèæ¬æä»¶éï¼ç¨ COPY å½ä»¤æ·è´è¿å»åç¨ RUN æ¥æ§è¡ï¼\n\nCOPY setup.sh  /tmp/                # æ·è´èæ¬å°/tmpç®å½\n\nRUN cd /tmp && chmod +x setup.sh \\  # æ·»å æ§è¡æé\n    && ./setup.sh && rm setup.sh    # è¿è¡èæ¬ç¶ååå é¤\n\n\n\n1\n2\n3\n4\n5\n\n\nRUN æä»¤å®éä¸å°±æ¯Shellç¼ç¨ï¼å¦æä½ å¯¹å®ææäºè§£ï¼å°±åºè¯¥ç¥éå®æåéçæ¦å¿µï¼å¯ä»¥å®ç°åæ°åè¿è¡ï¼è¿å¨Dockerfileéä¹å¯ä»¥åå°ï¼éè¦ä½¿ç¨ä¸¤ä¸ªæä»¤ ARG å ENVã\n\n`ARG` å `ENV` çåºå«\n\nä¸é¢æ¯ä¸ä¸ªç®åçä¾å­ï¼ä½¿ç¨ ARG å®ä¹äºåºç¡éåçåå­ï¼å¯ä»¥ç¨å¨âFROMâæä»¤éï¼ï¼ä½¿ç¨ ENV å®ä¹äºä¸¤ä¸ªç¯å¢åéï¼\n\nARG IMAGE_BASE="node"\nARG IMAGE_TAG="alpine"\n\nENV PATH=$PATH:/tmp\nENV DEBUG=OFF\n\n\n1\n2\n3\n4\n5\n\n\nè®²äºè¿äºDockerfileæä»¤ä¹åï¼æè¿è¦ç¹å«å¼ºè°ä¸ä¸ï¼å ä¸ºå ä¸º RUN, COPY, ADD ä¼çææ°çéåå±ï¼å¶å®æä»¤åªä¼äº§çä¸´æ¶å±ï¼ä¸å½±åæå»ºå¤§å°ï¼æä»¥Dockerfileéæå¥½ä¸è¦æ»¥ç¨æä»¤ï¼å°½éç²¾ç®åå¹¶ï¼å¦åå¤ªå¤çå±ä¼å¯¼è´éåèè¿ä¸å ªã\n\n\n# docker buildæ¯æä¹å·¥ä½ç\n\nDockerfileå¿é¡»è¦ç»è¿ docker build æè½çæï¼æä»¥æä»¬åæ¥çç docker build çè¯¦ç»ç¨æ³ã\n\nåæ°ï¼\n\n * -f: æå®Dockerfileï¼å¦æä¸æå®å°±ä½¿ç¨å½åç®å½ä¸åå­æ¯âDockerfileâçæä»¶\n * -t: ä¸ºéåèµ·ä¸ä¸ªææä¹çåå­ï¼æ¹ä¾¿ç®¡ç\n\n> docker build éè¦æå®âæå»ºä¸ä¸æâï¼å¶ä¸­çæä»¶ä¼æåä¸ä¼ å°Docker daemonï¼æä»¥å°½éä¸è¦å¨âæå»ºä¸ä¸æâä¸­å­æ¾å¤ä½çæä»¶ã\n\nå¾è¡¥å\n\n\n# 5. éåä»åºï¼è¯¥ææ ·ç¨å¥½Docker Hubè¿ä¸ªå®è\n\nå¾è¡¥å\n\n\n# 6. æç ´æ¬¡åå£ï¼å®¹å¨è¯¥å¦ä½ä¸å¤çäºèäºé\n\nå¨åé¢çå èè¯¾éï¼æä»¬å·²ç»å­¦ä¹ äºå®¹å¨ãéåãéåä»åºçæ¦å¿µåç¨æ³ï¼ä¹ç¥éäºåºè¯¥å¦ä½åå»ºéåï¼åä»¥å®¹å¨çå½¢å¼å¯å¨åºç¨ã\n\nä¸è¿ï¼ç¨å®¹å¨æ¥è¿è¡âbusyboxââhello worldâè¿æ ·æ¯è¾ç®åçåºç¨è¿å¥½ï¼å¦ææ¯NginxãRedisãMySQLè¿æ ·çåå°æå¡åºç¨ï¼å ä¸ºå®ä»¬è¿è¡å¨å®¹å¨çâæ²çâéï¼å®å¨ä¸å¤çéç¦»ï¼æ æ³å¯¹å¤æä¾æå¡ï¼ä¹å°±å¤±å»äºä»·å¼ãè¿ä¸ªæ¶åï¼å®¹å¨çéç¦»ç¯å¢åèæä¸ºäºä¸ç§è´é¢ç¹æ§ã\n\næä»¥ï¼å®¹å¨çè¿ä¸ªâå°æ¿æ¿âä¸åºè¯¥æ¯ä¸ä¸ªå®å¨å¯é­çéå±å­ï¼èæ¯åºè¯¥ç»å®å¼å æé¨çªï¼è®©åºç¨å¨âè¶³ä¸åºæ·âçæåµä¸ï¼ä¹è½å¤ä¸å¤çäº¤æ¢æ°æ®ãäºéææ ï¼è¿æ ·âæéçéç¦»âææ¯æä»¬çæ­£æéè¦çè¿è¡ç¯å¢ã\n\né£ä¹ä»å¤©ï¼æå°±ä»¥Dockerä¸ºä¾ï¼æ¥è®²è®²æåªäºææ®µè½å¤å¨å®¹å¨ä¸å¤é¨ç³»ç»ä¹é´æ²éäº¤æµã\n\n\n# å¦ä½æ·è´å®¹å¨åçæ°æ®\n\nDockeræä¾ç docker cp å½ä»¤ï¼å¾ç±»ä¼¼Linuxçâcpââscpâï¼å®å¯ä»¥å¨å®¿ä¸»æºåå®¹å¨ä¹é´æ·è´æä»¶ï¼æ¯æåºæ¬çä¸ç§æ°æ®äº¤æ¢åè½ã\n\nç¨æ³ï¼\n\n * ææä»¶æ·è´è¿å®¹å¨ï¼docker cp [src path] [container id/name]:[dest path]\n * ææä»¶æ·è´åºå®¹å¨: æ´æ¢æºè·¯å¾ï¼src pathï¼åç®æ è·¯å¾ï¼dest pathï¼å°±å¯ä»¥äº\n\nåè®¾å½åç®å½ä¸æä¸ä¸ªâa.txtâçæä»¶ï¼ç°å¨æä»¬è¦æå®æ·è´è¿Rediså®¹å¨çâ/tmpâç®å½ï¼å¦æä½¿ç¨å®¹å¨IDï¼å½ä»¤å°±ä¼æ¯è¿æ ·ï¼\n\ndocker cp a.txt 062:/tmp\n\n\n1\n\n\n> docker cp çç¨æ³æ¨¡ä»¿äºæä½ç³»ç»çæ·è´å½ä»¤ï¼å¶å°ä¸ä¸¤æ¬¡çæä»¶å±äº«è¿å¯ä»¥åºä»ï¼å¦æå®¹å¨è¿è¡æ¶ç»å¸¸ææä»¶æ¥å¾äºéï¼è¿æ ·åå¤å°æ·æ¥æ·å»å°±æ¾å¾å¾éº»ç¦ï¼ä¹å¾å®¹æåºéã\n\n\n# å¦ä½å±äº«ä¸»æºä¸çæä»¶ï¼æè½½\n\nå®¹å¨æä¾äºç±»ä¼¼èææºå±äº«å®¿ä¸»æºç®å½çåè½ï¼ææä¹å ä¹ä¸æ ·ï¼ç¨èµ·æ¥å¾æ¹ä¾¿ï¼åªéè¦å¨ docker run å½ä»¤å¯å¨å®¹å¨çæ¶åä½¿ç¨ -v åæ°å°±è¡ï¼å·ä½çæ ¼å¼æ¯â å®¿ä¸»æºè·¯å¾:å®¹å¨åè·¯å¾âã--\x3e æå®¿ä¸»æºç®å½æè½½è¿å®¹å¨åé¨.\n\n> -v æè½½ç®å½æ¶è¥åç°æºè·¯å¾ä¸å­å¨ï¼ä¼èªå¨åå»ºï¼è¿ææ¶åä¼æ¯ä¸ä¸ªâåâï¼å½ä¸»æºç®å½è¢«æå¤å é¤æ¶ä¼å¯¼è´å®¹å¨éåºç°ç©ºç®å½ï¼è®©åºç¨æ æ³æé¢æ³çæµç¨å·¥ä½ã -v æè½½ç®å½é»è®¤æ¯å¯è¯»å¯åçï¼ä½ä¹å¯ä»¥å ä¸roåæåªè¯»ï¼å¯ä»¥é²æ­¢å®¹å¨æå¤ä¿®æ¹æä»¶ï¼ä¾å¦ -Vtmp:/tmp:roã\n\nä¸ä¸ªæä»¶æè½½çä¾å­\n\næè¿æ¯ä»¥Redisä¸ºä¾ï¼å¯å¨å®¹å¨ï¼ä½¿ç¨ -v åæ°ææ¬æºçâ/tmpâç®å½æè½½å°å®¹å¨éçâ/tmpâç®å½ï¼ä¹å°±æ¯è¯´è®©å®¹å¨å±äº«å®¿ä¸»æºçâ/tmpâç®å½ï¼\n\ndocker run -d --rm -v /tmp:/tmp redis\n\n\n1\n\n\nç¶åæä»¬åç¨ docker exec è¿å¥å®¹å¨ï¼æ¥çä¸ä¸å®¹å¨åçâ/tmpâç®å½ï¼åºè¯¥å°±å¯ä»¥çå°æä»¶ä¸å®¿ä¸»æºæ¯å®å¨ä¸è´çã\n\ndocker exec -it b5a sh    # b5aæ¯å®¹å¨ID\n\n\n1\n\n\n-v åæ°æè½½å®¿ä¸»æºç®å½çè¿ä¸ªåè½ï¼å¯¹äºæä»¬æ¥å¸¸å¼åæµè¯å·¥ä½æ¥è¯´éå¸¸æç¨ï¼æä»¬å¯ä»¥å¨ä¸åå¨æ¬æºç¯å¢çåæä¸ï¼ä½¿ç¨éåå®è£ä»»æçåºç¨ï¼ç¶åç´æ¥ä»¥å®¹å¨æ¥è¿è¡æä»¬æ¬å°çæºç ãèæ¬ï¼éå¸¸æ¹ä¾¿ã\n\nè¿éæä¸¾ä¸ä¸ªç®åçä¾å­ãæ¯å¦ææ¬æºä¸åªæPython 2.7ï¼ä½ææ³ç¨Python 3å¼åï¼å¦æåæ¶å®è£Python 2åPython 3å¾å®¹æå°±ä¼æç³»ç»æä¹±ï¼æä»¥æå°±å¯ä»¥è¿ä¹åï¼\n\n 1. åä½¿ç¨ docker pull æåä¸ä¸ªPython 3çéåï¼å ä¸ºå®æåäºå®æ´çè¿è¡ç¯å¢ï¼è¿è¡æ¶æéç¦»ï¼æä»¥ä¸ä¼å¯¹ç°æç³»ç»çPython 2.7äº§çä»»ä½å½±åã\n 2. å¨æ¬å°çæä¸ªç®å½ç¼åPythonä»£ç ï¼ç¶åç¨ -v åæ°è®©å®¹å¨å±äº«è¿ä¸ªç®å½ã\n 3. ç°å¨å°±å¯ä»¥å¨å®¹å¨éä»¥Python 3æ¥å®è£åç§åï¼åè¿è¡èæ¬åå¼åäºã\n\ndocker pull python:alpine\ndocker run -it --rm -v `pwd`:/tmp python:alpine sh\n\n\n\n1\n2\n3\n\n\næ¾ç¶ï¼è¿ç§æ¹å¼æ¯ææä»¶æåå°éåæè docker cp ä¼æ´å çµæ´»ï¼éå¸¸éåæé¢ç¹ä¿®æ¹çå¼åæµè¯å·¥ä½ã\n\n\n# å¦ä½å®ç°ç½ç»äºé\n\nä½¿ç¨ docker cp å docker run -v å¯ä»¥è§£å³å®¹å¨ä¸å¤ççæä»¶äºéé®é¢ï¼ä½å¯¹äºNginxãRedisè¿äºæå¡å¨æ¥è¯´ï¼ç½ç»äºéææ¯æ´è¦ç´§çé®é¢ãç½ç»äºéçå³é®å¨äºâæéâå®¹å¨åå¤çç½ç»ã\n\nDockeræä¾äºä¸ç§ç½ç»æ¨¡å¼ï¼åå«æ¯ nullã host å bridgeã\n\n * null æ¯æç®åçæ¨¡å¼ï¼ä¹å°±æ¯æ²¡æç½ç»ï¼ä½åè®¸å¶ä»çç½ç»æä»¶æ¥èªå®ä¹ç½ç»è¿æ¥\n * host çæææ¯ç´æ¥ä½¿ç¨å®¿ä¸»æºç½ç»ï¼ç¸å½äºå»æäºå®¹å¨çç½ç»éç¦»ï¼å¶ä»éç¦»ä¾ç¶ä¿çï¼ï¼ææçå®¹å¨ä¼å±äº«å®¿ä¸»æºçIPå°ååç½å¡ãè¿ç§æ¨¡å¼æ²¡æä¸­é´å±ï¼èªç¶éä¿¡æçé«ï¼ä½ç¼ºå°äºéç¦»ï¼è¿è¡å¤ªå¤çå®¹å¨ä¹å®¹æå¯¼è´ç«¯å£å²çªã\n   * hostæ¨¡å¼éè¦å¨ docker run æ¶ä½¿ç¨ --net=host åæ°\n\nä½¿ç¨ host ç½ç»æ¨¡å¼çä¾å­\n\nä¸é¢ç¨--net=hostè¿ä¸ªåæ°å¯å¨Nginxï¼\n\ndocker run -d --rm --net=host nginx:alpine\n\n\n1\n\n\nä¸ºäºéªè¯ææï¼æä»¬å¯ä»¥å¨æ¬æºåå®¹å¨éåå«æ§è¡ ip addr å½ä»¤ï¼æ¥çç½å¡ä¿¡æ¯:\n\nip addr                    # æ¬æºæ¥çç½å¡\ndocker exec xxx ip addr    # å®¹å¨æ¥çç½å¡\n\n\n1\n2\n\n\nå¯ä»¥åç°è¿ä¸¤ä¸ªå½ä»¤çè¾åºä¿¡æ¯æ¯å®å¨ä¸æ ·çï¼å¦ç½å¡ ensxxx å IP å°åã\n\n * bridgeï¼ä¹å°±æ¯æ¡¥æ¥æ¨¡å¼ï¼å®æç¹ç±»ä¼¼ç°å®ä¸çéçäº¤æ¢æºãè·¯ç±å¨ï¼åªä¸è¿æ¯ç±è½¯ä»¶èæåºæ¥çï¼å®¹å¨åå®¿ä¸»æºåéè¿èæç½å¡æ¥å¥è¿ä¸ªç½æ¡¥ï¼å¾ä¸­çdocker0ï¼ï¼é£ä¹å®ä»¬ä¹é´ä¹å°±å¯ä»¥æ­£å¸¸çæ¶åç½ç»æ°æ®åäºãä¸è¿åhostæ¨¡å¼ç¸æ¯ï¼bridgeæ¨¡å¼å¤äºèæç½æ¡¥åç½å¡ï¼éä¿¡æçä¼ä½ä¸äºã\n   * å¯ä»¥ç¨ --net=bridge æ¥å¯ç¨æ¡¥æ¥æ¨¡å¼ï¼ä½å¶å®ä¸å¿è¦ï¼å ä¸ºDockeré»è®¤çç½ç»æ¨¡å¼å°±æ¯bridgeï¼æä»¥ä¸è¬ä¸éè¦æ¾å¼æå®ã\n   * \n\nä½¿ç¨ bridge ç½ç»æ¨¡å¼çä¾å­\n\nä¸é¢æä»¬å¯å¨ä¸¤ä¸ªå®¹å¨NginxåRedisï¼å°±ååæè¯´çï¼æ²¡æç¹æ®æå®å°±ä¼ä½¿ç¨bridgeæ¨¡å¼ï¼\n\ndocker run -d --rm nginx:alpine    # é»è®¤ä½¿ç¨æ¡¥æ¥æ¨¡å¼\ndocker run -d --rm redis           # é»è®¤ä½¿ç¨æ¡¥æ¥æ¨¡å¼\n\n\n1\n2\n\n\nç¶åæä»¬è¿æ¯å¨æ¬æºåå®¹å¨éæ§è¡ ip addr å½ä»¤ï¼Rediså®¹å¨éæ²¡æipå½ä»¤ï¼æä»¥åªè½å¨Nginxå®¹å¨éæ§è¡ï¼ï¼\n\nå¯¹æ¯ä¸ä¸åæhostæ¨¡å¼çè¾åºï¼å°±å¯ä»¥åç°å®¹å¨éçç½å¡è®¾ç½®ä¸å®¿ä¸»æºå®å¨ä¸åï¼eth0æ¯ä¸ä¸ªèæç½å¡ï¼IPå°åæ¯Bç±»ç§æå°åâ172.17.0.4âã\n\næä»¬è¿å¯ä»¥ç¨ docker inspect ç´æ¥æ¥çå®¹å¨çipå°åï¼\n\ndocker inspect xxx |grep IPAddress\n\n\n1\n\n\nè¿æ¾ç¤ºåºä¸¤ä¸ªå®¹å¨çIPå°ååå«æ¯â172.17.0.3âåâ172.17.0.4âï¼èå®¿ä¸»æºçIPå°ååæ¯â172.17.0.1âï¼æä»¥å®ä»¬é½å¨â172.17.0.0/16âè¿ä¸ªDockerçé»è®¤ç½æ®µï¼å½¼æ­¤ä¹é´å°±è½å¤ä½¿ç¨IPå°åæ¥å®ç°ç½ç»éä¿¡äºã\n\n\n# å¦ä½åéæå¡ç«¯å£å·\n\næå¡å¨åºç¨é½å¿é¡»è¦æç«¯å£å·æè½å¯¹å¤æä¾æå¡ãåé¢ç¬¬4èæä»¬å¨å­¦ä¹ ç¼åDockerfileçæ¶åä¹çå°è¿ï¼å¯ä»¥ç¨ EXPOSE æä»¤å£°æå®¹å¨å¯¹å¤çç«¯å£å·ã\n\nä¸å°ä¸»æºä¸çç«¯å£å·æ°éæ¯æéçï¼èä¸å¤ä¸ªæå¡ä¹é´è¿ä¸è½å¤å²çªï¼ä½æä»¬æåéååºç¨çæ¶åéå¸¸é½ä½¿ç¨çæ¯é»è®¤ç«¯å£ï¼å®¹å¨å®éè¿è¡èµ·æ¥å°±å¾å®¹æå ä¸ºç«¯å£å·è¢«å ç¨èæ æ³å¯å¨ã\n\nè§£å³è¿ä¸ªé®é¢çæ¹æ³å°±æ¯å å¥ä¸ä¸ªâä¸­é´å±âï¼ç±å®¹å¨ç¯å¢ä¾å¦Dockeræ¥ç»ä¸ç®¡çåéç«¯å£å·ï¼å¨æ¬æºç«¯å£åå®¹å¨ç«¯å£ä¹é´åä¸ä¸ªâæ å°âæä½ï¼å®¹å¨åé¨è¿æ¯ç¨èªå·±çç«¯å£å·ï¼ä½å¤ççå°çå´æ¯å¦å¤ä¸ä¸ªç«¯å£å·ï¼è¿æ ·å°±å¾å¥½å°é¿åäºå²çªã\n\nç«¯å£å·æ å°éè¦ä½¿ç¨bridgeæ¨¡å¼ï¼å¹¶ä¸å¨ docker run å¯å¨å®¹å¨æ¶ä½¿ç¨ -p åæ°ï¼å½¢å¼åå±äº«ç®å½ç -v åæ°å¾ç±»ä¼¼ï¼ç¨ : åéæ¬æºç«¯å£åå®¹å¨ç«¯å£ã\n\nåéæå¡ç«¯å£å·çä¾å­\n\nå¦æè¦å¯å¨ä¸¤ä¸ªNginxå®¹å¨ï¼åå«è·å¨80å8080ç«¯å£ä¸ï¼\n\ndocker run -d -p 80:80 --rm nginx:alpine\ndocker run -d -p 8080:80 --rm nginx:alpine\n\n\n1\n2\n\n\nè¿æ ·å°±ææ¬æºç80å8080ç«¯å£åå«âæ å°âå°äºä¸¤ä¸ªå®¹å¨éç80ç«¯å£ï¼ä¸ä¼åçå²çªï¼æä»¬å¯ä»¥ç¨curlåéªè¯ä¸ä¸ã\n\nä½¿ç¨ docker ps å½ä»¤è½å¤å¨âPORTSâæ éæ´ç´è§å°çå°ç«¯å£çæ å°æåµã',normalizedContent:'# 1. åè¯å®¹å¨ï¼ä¸äºå¼å¤´é¾\n\n\n# docker çå½¢æ\n\nç®åä½¿ç¨dockeråºæ¬ä¸æä¸¤ä¸ªéæ©ï¼ docker desktop å docker engineã\n\n * docker desktopæ¯ä¸é¨éå¯¹ä¸ªäººä½¿ç¨èè®¾è®¡çï¼æ¯æmacåwindowså¿«éå®è£ï¼å·æç´è§çå¾å½¢çé¢ï¼è¿éæäºè®¸å¤å¨è¾¹å·¥å·ï¼æ¹ä¾¿æç¨ãåªæ¯å¯¹ä¸ªäººå­¦ä¹ åè´¹ï¼åæ¡æ¬¾éå¶ä¸è½åç¨ï¼æä»¬å¨æ¥å¸¸å·¥ä½ä¸­é¾åä¼âè¸©å°é·åºâã\n * docker engine åªè½å¨linuxä¸è¿è¡ï¼åªè½ä½¿ç¨å½ä»¤è¡æä½ï¼ç¼ºä¹è¾å©å·¥å·ï¼éè¦æä»¬èªå·±å¨ædiyè¿è¡ç¯å¢ãä¸è¿è¦æ¯è¾èµ·çæ¥ï¼å®ææ¯dockerå½åççæ­£å½¢æï¼âè¡èâæçº¯æ­£ï¼ä¹æ¯ç°å¨åä¸ªå¬å¸å¨çäº§ç¯å¢ä¸­å®éä½¿ç¨çdockeräº§åï¼æ¯ç«æºæ¿é99%çæå¡å¨è·çé½æ¯linuxã\n\n\n# docker å½ä»¤\n\ndocker engineéè¦ä½¿ç¨å½ä»¤è¡æä½ï¼ä¸»å½ä»¤æ¯ dockerï¼åé¢åæ¥åç§å­å½ä»¤ã\n\næ¥çdockerçåºæ¬ä¿¡æ¯çå½ä»¤æ¯ docker version å docker info ï¼å¶ä»å¸¸ç¨çå½ä»¤æ docker psã docker pullã docker imagesã docker runã\n\n\n# docker çæ¶æ\n\næä»¬æ²çå½ä»¤è¡ docker å®éä¸æ¯ä¸ä¸ªå®¢æ·ç«¯client ï¼å®ä¼ä¸docker engineéçåå°æå¡docker daemonéä¿¡ï¼èéååå­å¨å¨è¿ç«¯çä»åºregistryéï¼å®¢æ·ç«¯å¹¶ä¸è½ç´æ¥è®¿é®éåä»åºã\n\ndocker clientå¯ä»¥éè¿ buildã pullã run ç­å½ä»¤ådocker daemonåéè¯·æ±ï¼èdocker daemonåæ¯å®¹å¨åéåçâå¤§ç®¡å®¶âï¼è´è´£ä»è¿ç«¯æåéåãå¨æ¬å°å­å¨éåï¼è¿æä»éåçæå®¹å¨ãç®¡çå®¹å¨ç­ææåè½ã æä»¥ï¼å¨docker engineéï¼çæ­£å¹²æ´»çå¶å®æ¯é»é»è¿è¡å¨åå°çdocker daemonï¼èæä»¬å®éæä½çå½ä»¤è¡å·¥å·âdockerâåªæ¯ä¸ªâä¼ å£°ç­âçè§è²ã\n\n\n# ä¸èææºçåºå«\n\n\n# 2. è¢«éç¦»çè¿ç¨ï¼ä¸èµ·æ¥ççå®¹å¨çæ¬è´¨\n\nå¹¿ä¹ä¸æ¥è¯´ï¼å®¹å¨ææ¯æ¯å¨æçå®¹å¨ãéæçéååè¿ç«¯çä»åºè¿ä¸èçç»åãä»å¤©å°±æ¥ççç©¶ç«ä»ä¹æ¯å®¹å¨ï¼å³ç­ä¹çãå¨æçå®¹å¨ï¼ã\n\nå®¹å¨å°è£äºè¿è¡ä¸­çè¿ç¨ï¼å¹¶æè¿ç¨ä¸å¤çç¯å¢éç¦»å¼ï¼è®©è¿ç¨ä¸å¤é¨ç³»ç»äºä¸å½±åãå®å°±æ¯ä¸ä¸ªç¹æ®çéç¦»ç¯å¢ï¼å®è½å¤è®©è¿ç¨åªçå°è¿ä¸ªç¯å¢éçæéä¿¡æ¯ï¼ä¸è½å¯¹å¤çç¯å¢æ½å å½±åã\n\nä½¿ç¨å®¹å¨ææ¯ï¼æä»¬å°±å¯ä»¥è®©åºç¨ç¨åºè¿è¡å¨ä¸ä¸ªæä¸¥å¯é²æ¤ç**âæ²çâï¼sandboxï¼**ç¯å¢ä¹åï¼å°±å¥½åæ¯æè¿ç¨è¯·è¿äºâéç¦»éåºâï¼å®å¯ä»¥å¨è¿ä¸ªç¯å¢éèªç±æ´»å¨ï¼ä½ç»ä¸åè®¸âè¶çâï¼ä»èä¿è¯äºå®¹å¨å¤ç³»ç»çå®å¨ã\n\nå®¹å¨ææ¯çå¦ä¸ä¸ªæ¬é¢å°±æ¯ä¸ºåºç¨ç¨åºå ä¸èµæºéç¦»ï¼å¨ç³»ç»éåååºä¸é¨åèµæºï¼è®©å®åªè½ä½¿ç¨æå®çéé¢ãè¿å¯ä»¥é¿åå®¹å¨åè¿ç¨çè¿æ¸¡ç³»ç»æ¶èï¼å¹¶ååå©ç¨è®¡ç®æºç¡¬ä»¶ï¼è®©æéçèµæºè½å¤æä¾ç¨³å®å¯é çæå¡ã\n\nå®¹å¨æ¬è´¨ä¸å°±æ¯ä¸ç§ç¹æ®çè¿ç¨ã\n\n\n# éç¦»æ¯æä¹å®ç°ç\n\nå¥¥ç§å¨äº linux åæ ¸ææä¾çä¸ä¸ªææ¯ï¼namespaceãcgroup å chrootï¼è½ç¶è¿ä¸ä¸ªææ¯çåè¡·é½ä¸æ¯ä¸ºäºå®ç°å®¹å¨ï¼ä½ç»åå¨ä¸èµ·å°±ä¼åçå¥å¦çâåå­¦ååºâã\n\n * namespaceï¼å®å¯ä»¥åå»ºåºç¬ç«çæä»¶ç³»ç»ãä¸»æºåãè¿ç¨å·ãç½ç»ç­èµæºç©ºé´ï¼ç¸å½äºç»è¿ç¨çäºä¸é´å°æ¿æ¿ï¼è¿æ ·å°±å®ç°äºç³»ç»å¨å±èµæºåè¿ç¨å±é¨èµæºçéç¦»ã\n * cgroupï¼å¨ç§°æ¯ linux control groupï¼ç¨æ¥å®ç°å¯¹è¿ç¨ç cpuãåå­ç­èµæºçä¼åçº§åéé¢éå¶ï¼ç¸å½äºç»è¿ç¨çå°æ¿æ¿å äºä¸ä¸ªå¤©è±æ¿ã\n * chrootï¼å®å¯ä»¥æ´æ¹è¿ç¨çæ ¹ç®å½ï¼ä¹å°±æ¯éå¶è®¿é®æä»¶ç³»ç»ï¼ç¸å½äºç»è¿ç¨çå°æ¿æ¿éºä¸äºå°ç ã ç»¼åè¿ç¨ä»¥ä¸ä¸ä¸ªææ¯ï¼ä¸ä¸ªååæ¹æ¹ãå·æå®åçéç¦»ç¹æ§çå®¹å¨å°±æ­¤åºç°äºï¼è¿ç¨ä¹å°±å¯ä»¥æ¬è¿å»å¿«ä¹çæ´»å¦ã\n\n> ç®åå®¹å¨ææ¯åºæ¬ä¸åä½¿ç¨å¤èç chroot äºï¼èæ¯æ¹ç¨ pivot_rootã\n\n\n# 3. å®¹å¨åçåºç¨\n\n\n# ä»ä¹æ¯å®¹å¨åçåºç¨\n\néåæ¯å®¹å¨çéæå½¢å¼ï¼å®æåäºåºç¨ç¨åºçææè¿è¡ä¾èµé¡¹ï¼æ¹ä¾¿ä¿å­åä¼ è¾ãä½¿ç¨å®¹å¨ææ¯è¿è¡éåï¼å°±å½¢æäºå¨æçå®¹å¨ï¼ç±äºéååªè¯»ä¸å¯ä¿®æ¹ï¼æä»¥åºç¨ç¨åºçè¿è¡ç¯å¢æ»æ¯ä¸è´çã\n\nä»»ä½åºç¨é½è½å¤æåååååè¿è¡ï¼è¿ä¹æ¯æ æ°å¼åèæ¢¦å¯ä»¥æ±çâä¸æ¬¡ç¼åï¼å°å¤è¿è¡ï¼build once, run anywhereï¼âçè³é«å¢çãæä»¥ï¼ æè°çâå®¹å¨åçåºç¨âï¼æèâåºç¨çå®¹å¨åâï¼å°±æ¯æåºç¨ç¨åºä¸åç´æ¥åæä½ç³»ç»æäº¤éï¼èæ¯å°è£æéåï¼åäº¤ç»å®¹å¨ç¯å¢å»è¿è¡ã\n\nç°å¨ä½ å°±åºè¯¥ç¥éäºï¼éåå°±æ¯éæçåºç¨å®¹å¨ï¼å®¹å¨å°±æ¯å¨æçåºç¨éåï¼ä¸¤èäºç¸ä¾å­ï¼äºç¸è½¬åï¼å¯ä¸å¯åã\n\n> dockeråªä¸è¿æ¯ä¼å¤å®¹å¨è¿è¡æ¶ï¼container runtimeï¼ä¸­æåºåçä¸æ¬¾èå·²ã\n\n\n# æçºµå®¹å¨ååºç¨ï¼å¸¸ç¨å½ä»¤ï¼\n\n\n# 4. åå»ºå®¹å¨éåï¼ç¼ådockerfileï¼\n\næ¬èè®²è§£éåçåé¨æºå¶ï¼è¿æé«æãæ­£ç¡®å°ç¼ådockerfileå¶ä½å®¹å¨éåçæ¹æ³ã\n\n\n# éåçåé¨æºå¶:åå±\n\néåå°±æ¯ä¸ä¸ªæåæä»¶ï¼éé¢åå«äºåºç¨ç¨åºè¿æå®è¿è¡æä¾èµçç¯å¢ï¼ä¾å¦æä»¶ç³»ç»ãç¯å¢åéãéç½®åæ°ç­ç­ã\n\n * ç¯å¢åéãéç½®åæ°ï¼ç¨ä¸ä¸ªmanifestæ¸åå°±å¯ä»¥ç®¡ç\n * æä»¶ç³»ç»ï¼è¾éº»ç¦ãä¸ºäºä¿è¯å®¹å¨è¿è¡ç¯å¢çä¸è´æ§ï¼éåå¿é¡»æåºç¨ç¨åºæå¨æä½ç³»ç»çæ ¹ç®å½ï¼rootfsï¼ï¼é½åå«è¿æ¥ã\n\nä¸ºé¿åå¤ä¸ªéåé½å¯¹ubuntuæ ¹ç®å½æä»¶æåï¼é æå¯¹ç£çå­å¨ãç½ç»ä¼ è¾çæµªè´¹ï¼éå¯¹å®¹å¨éåæäºâåå±âï¼layerï¼çæ¦å¿µã\n\n> å®¹å¨éåæ¯ç±å¤ä¸ªåªè¯»çlayerææçï¼åä¸ä¸ªlayerå¯ä»¥è¢«ä¸åçéåå±äº«ï¼åå°äºå­å¨åä¼ è¾çææ¬ã\n\nå®¹å¨éååé¨å¹¶ä¸æ¯ä¸ä¸ªå¹³å¦çç»æï¼èæ¯ç±è®¸å¤çéåå±ç»æçï¼æ¯å±é½æ¯åªè¯»ä¸å¯ä¿®æ¹çä¸ç»æä»¶ï¼ç¸åçå±å¯ä»¥å¨éåä¹é´å±äº«ï¼ç¶åå¤ä¸ªå±åæ­ç§¯æ¨ä¸æ ·å å èµ·æ¥ï¼åä½¿ç¨ä¸ç§å«â union fsèåæä»¶ç³»ç»âçææ¯æå®ä»¬åå¹¶å¨ä¸èµ·ï¼å°±å½¢æäºå®¹å¨æç»çå°çæä»¶ç³»ç»ï¼ å¾çæ¥æºï¼ã\n\nå¯ä»¥ç¨å½ä»¤ docker inspect æ¥æ¥çéåçåå±ä¿¡æ¯ï¼å®çåå±ä¿¡æ¯å¨ârootfsâé¨åã\n\nç¸ä¿¡ä½ ç°å¨ä¹å°±æç½ï¼ä¹åå¨ä½¿ç¨ docker pullã docker rmi ç­å½ä»¤æä½éåçæ¶åï¼é£äºâå¥æªâçè¾åºä¿¡æ¯æ¯ä»ä¹äºï¼å¶å®å°±æ¯éåéçåä¸ªlayerãdockerä¼æ£æ¥æ¯å¦æéå¤çå±ï¼å¦ææ¬å°å·²ç»å­å¨å°±ä¸ä¼éå¤ä¸è½½ï¼å¦æå±è¢«å¶ä»éåå±äº«å°±ä¸ä¼å é¤ï¼è¿æ ·å°±å¯ä»¥èçº¦ç£çåç½ç»ææ¬ã\n\n\n# dockerfile æ¯ä»ä¹\n\n\n# ææ ·ç¼åæ­£ç¡®ãé«æçdockerfile\n\n * from: åºç¡éå\n * copy: ä¸äºéè¦æåè¿éåéçæºç ãéç½®ç­æä»¶\n * add: ä¸ copy çåºå«æ¯copyçsrcåªè½æ¯æ¬å°æä»¶ï¼å¶ä»ç¨æ³ä¸è´\n * run: æ§è¡ä»»æçshellå½ä»¤ï¼æ¯å¦æ´æ°ç³»ç»ãå®è£åºç¨ãä¸è½½æä»¶ãåå»ºç®å½ãç¼è¯ç¨åºç­ç­ï¼å®ç°ä»»æçéåæå»ºæ­¥éª¤ï¼éå¸¸çµæ´»\n * arg: åå»ºçåéåªå¨éåæå»ºè¿ç¨ä¸­å¯è§ï¼å®¹å¨è¿è¡æ¶ä¸å¯è§\n * env: åå»ºçåéä¸ä»è½å¤å¨æå»ºéåçè¿ç¨ä¸­ä½¿ç¨ï¼å¨å®¹å¨è¿è¡æ¶ä¹è½å¤ä»¥ç¯å¢åéçå½¢å¼è¢«åºç¨ç¨åºä½¿ç¨\n * expose: å£°æå®¹å¨å¯¹å¤æå¡çç«¯å£å·\n * entrypoint:\n\nexpose 443           # é»è®¤æ¯tcpåè®®\nexpose 53/udp        # å¯ä»¥æå®udpåè®®\n\n\n\n1\n2\n3\n\nå³äº run æä»¤çä¸äºç»è\n\nrun éå¸¸ä¼æ¯dockerfileéæå¤æçæä»¤ï¼ä¼åå«å¾å¤çshellå½ä»¤ï¼ä½dockerfileéä¸æ¡æä»¤åªè½æ¯ä¸è¡ï¼æä»¥æç run æä»¤ä¼å¨æ¯è¡çæ«å°¾ä½¿ç¨ç»­è¡ç¬¦ \\ï¼å½ä»¤ä¹é´ä¹ä¼ç¨ && æ¥è¿æ¥ï¼è¿æ ·ä¿è¯å¨é»è¾ä¸æ¯ä¸è¡ï¼å°±åä¸é¢è¿æ ·ï¼\n\nrun apt-get update \\\n    && apt-get install -y \\\n        build-essential \\\n        curl \\\n        make \\\n        unzip \\\n    && cd /tmp \\\n    && curl -fsl xxx.tar.gz -o xxx.tar.gz\\\n    && tar xzf xxx.tar.gz \\\n    && cd xxx \\\n    && ./config \\\n    && make \\\n    && make clean\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næçæ¶åå¨dockerfileéåè¿ç§è¶é¿ç run æä»¤å¾ä¸ç¾è§ï¼èä¸ä¸æ¦åéäºï¼æ¯æ¬¡è°è¯é½è¦éæ°æå»ºä¹å¾éº»ç¦ï¼æä»¥ä½ å¯ä»¥éç¨ä¸ç§åéçæå·§ï¼ æè¿äºshellå½ä»¤éä¸­å°ä¸ä¸ªèæ¬æä»¶éï¼ç¨ copy å½ä»¤æ·è´è¿å»åç¨ run æ¥æ§è¡ï¼\n\ncopy setup.sh  /tmp/                # æ·è´èæ¬å°/tmpç®å½\n\nrun cd /tmp && chmod +x setup.sh \\  # æ·»å æ§è¡æé\n    && ./setup.sh && rm setup.sh    # è¿è¡èæ¬ç¶ååå é¤\n\n\n\n1\n2\n3\n4\n5\n\n\nrun æä»¤å®éä¸å°±æ¯shellç¼ç¨ï¼å¦æä½ å¯¹å®ææäºè§£ï¼å°±åºè¯¥ç¥éå®æåéçæ¦å¿µï¼å¯ä»¥å®ç°åæ°åè¿è¡ï¼è¿å¨dockerfileéä¹å¯ä»¥åå°ï¼éè¦ä½¿ç¨ä¸¤ä¸ªæä»¤ arg å envã\n\n`arg` å `env` çåºå«\n\nä¸é¢æ¯ä¸ä¸ªç®åçä¾å­ï¼ä½¿ç¨ arg å®ä¹äºåºç¡éåçåå­ï¼å¯ä»¥ç¨å¨âfromâæä»¤éï¼ï¼ä½¿ç¨ env å®ä¹äºä¸¤ä¸ªç¯å¢åéï¼\n\narg image_base="node"\narg image_tag="alpine"\n\nenv path=$path:/tmp\nenv debug=off\n\n\n1\n2\n3\n4\n5\n\n\nè®²äºè¿äºdockerfileæä»¤ä¹åï¼æè¿è¦ç¹å«å¼ºè°ä¸ä¸ï¼å ä¸ºå ä¸º run, copy, add ä¼çææ°çéåå±ï¼å¶å®æä»¤åªä¼äº§çä¸´æ¶å±ï¼ä¸å½±åæå»ºå¤§å°ï¼æä»¥dockerfileéæå¥½ä¸è¦æ»¥ç¨æä»¤ï¼å°½éç²¾ç®åå¹¶ï¼å¦åå¤ªå¤çå±ä¼å¯¼è´éåèè¿ä¸å ªã\n\n\n# docker buildæ¯æä¹å·¥ä½ç\n\ndockerfileå¿é¡»è¦ç»è¿ docker build æè½çæï¼æä»¥æä»¬åæ¥çç docker build çè¯¦ç»ç¨æ³ã\n\nåæ°ï¼\n\n * -f: æå®dockerfileï¼å¦æä¸æå®å°±ä½¿ç¨å½åç®å½ä¸åå­æ¯âdockerfileâçæä»¶\n * -t: ä¸ºéåèµ·ä¸ä¸ªææä¹çåå­ï¼æ¹ä¾¿ç®¡ç\n\n> docker build éè¦æå®âæå»ºä¸ä¸æâï¼å¶ä¸­çæä»¶ä¼æåä¸ä¼ å°docker daemonï¼æä»¥å°½éä¸è¦å¨âæå»ºä¸ä¸æâä¸­å­æ¾å¤ä½çæä»¶ã\n\nå¾è¡¥å\n\n\n# 5. éåä»åºï¼è¯¥ææ ·ç¨å¥½docker hubè¿ä¸ªå®è\n\nå¾è¡¥å\n\n\n# 6. æç ´æ¬¡åå£ï¼å®¹å¨è¯¥å¦ä½ä¸å¤çäºèäºé\n\nå¨åé¢çå èè¯¾éï¼æä»¬å·²ç»å­¦ä¹ äºå®¹å¨ãéåãéåä»åºçæ¦å¿µåç¨æ³ï¼ä¹ç¥éäºåºè¯¥å¦ä½åå»ºéåï¼åä»¥å®¹å¨çå½¢å¼å¯å¨åºç¨ã\n\nä¸è¿ï¼ç¨å®¹å¨æ¥è¿è¡âbusyboxââhello worldâè¿æ ·æ¯è¾ç®åçåºç¨è¿å¥½ï¼å¦ææ¯nginxãredisãmysqlè¿æ ·çåå°æå¡åºç¨ï¼å ä¸ºå®ä»¬è¿è¡å¨å®¹å¨çâæ²çâéï¼å®å¨ä¸å¤çéç¦»ï¼æ æ³å¯¹å¤æä¾æå¡ï¼ä¹å°±å¤±å»äºä»·å¼ãè¿ä¸ªæ¶åï¼å®¹å¨çéç¦»ç¯å¢åèæä¸ºäºä¸ç§è´é¢ç¹æ§ã\n\næä»¥ï¼å®¹å¨çè¿ä¸ªâå°æ¿æ¿âä¸åºè¯¥æ¯ä¸ä¸ªå®å¨å¯é­çéå±å­ï¼èæ¯åºè¯¥ç»å®å¼å æé¨çªï¼è®©åºç¨å¨âè¶³ä¸åºæ·âçæåµä¸ï¼ä¹è½å¤ä¸å¤çäº¤æ¢æ°æ®ãäºéææ ï¼è¿æ ·âæéçéç¦»âææ¯æä»¬çæ­£æéè¦çè¿è¡ç¯å¢ã\n\né£ä¹ä»å¤©ï¼æå°±ä»¥dockerä¸ºä¾ï¼æ¥è®²è®²æåªäºææ®µè½å¤å¨å®¹å¨ä¸å¤é¨ç³»ç»ä¹é´æ²éäº¤æµã\n\n\n# å¦ä½æ·è´å®¹å¨åçæ°æ®\n\ndockeræä¾ç docker cp å½ä»¤ï¼å¾ç±»ä¼¼linuxçâcpââscpâï¼å®å¯ä»¥å¨å®¿ä¸»æºåå®¹å¨ä¹é´æ·è´æä»¶ï¼æ¯æåºæ¬çä¸ç§æ°æ®äº¤æ¢åè½ã\n\nç¨æ³ï¼\n\n * ææä»¶æ·è´è¿å®¹å¨ï¼docker cp [src path] [container id/name]:[dest path]\n * ææä»¶æ·è´åºå®¹å¨: æ´æ¢æºè·¯å¾ï¼src pathï¼åç®æ è·¯å¾ï¼dest pathï¼å°±å¯ä»¥äº\n\nåè®¾å½åç®å½ä¸æä¸ä¸ªâa.txtâçæä»¶ï¼ç°å¨æä»¬è¦æå®æ·è´è¿rediså®¹å¨çâ/tmpâç®å½ï¼å¦æä½¿ç¨å®¹å¨idï¼å½ä»¤å°±ä¼æ¯è¿æ ·ï¼\n\ndocker cp a.txt 062:/tmp\n\n\n1\n\n\n> docker cp çç¨æ³æ¨¡ä»¿äºæä½ç³»ç»çæ·è´å½ä»¤ï¼å¶å°ä¸ä¸¤æ¬¡çæä»¶å±äº«è¿å¯ä»¥åºä»ï¼å¦æå®¹å¨è¿è¡æ¶ç»å¸¸ææä»¶æ¥å¾äºéï¼è¿æ ·åå¤å°æ·æ¥æ·å»å°±æ¾å¾å¾éº»ç¦ï¼ä¹å¾å®¹æåºéã\n\n\n# å¦ä½å±äº«ä¸»æºä¸çæä»¶ï¼æè½½\n\nå®¹å¨æä¾äºç±»ä¼¼èææºå±äº«å®¿ä¸»æºç®å½çåè½ï¼ææä¹å ä¹ä¸æ ·ï¼ç¨èµ·æ¥å¾æ¹ä¾¿ï¼åªéè¦å¨ docker run å½ä»¤å¯å¨å®¹å¨çæ¶åä½¿ç¨ -v åæ°å°±è¡ï¼å·ä½çæ ¼å¼æ¯â å®¿ä¸»æºè·¯å¾:å®¹å¨åè·¯å¾âã--\x3e æå®¿ä¸»æºç®å½æè½½è¿å®¹å¨åé¨.\n\n> -v æè½½ç®å½æ¶è¥åç°æºè·¯å¾ä¸å­å¨ï¼ä¼èªå¨åå»ºï¼è¿ææ¶åä¼æ¯ä¸ä¸ªâåâï¼å½ä¸»æºç®å½è¢«æå¤å é¤æ¶ä¼å¯¼è´å®¹å¨éåºç°ç©ºç®å½ï¼è®©åºç¨æ æ³æé¢æ³çæµç¨å·¥ä½ã -v æè½½ç®å½é»è®¤æ¯å¯è¯»å¯åçï¼ä½ä¹å¯ä»¥å ä¸roåæåªè¯»ï¼å¯ä»¥é²æ­¢å®¹å¨æå¤ä¿®æ¹æä»¶ï¼ä¾å¦ -vtmp:/tmp:roã\n\nä¸ä¸ªæä»¶æè½½çä¾å­\n\næè¿æ¯ä»¥redisä¸ºä¾ï¼å¯å¨å®¹å¨ï¼ä½¿ç¨ -v åæ°ææ¬æºçâ/tmpâç®å½æè½½å°å®¹å¨éçâ/tmpâç®å½ï¼ä¹å°±æ¯è¯´è®©å®¹å¨å±äº«å®¿ä¸»æºçâ/tmpâç®å½ï¼\n\ndocker run -d --rm -v /tmp:/tmp redis\n\n\n1\n\n\nç¶åæä»¬åç¨ docker exec è¿å¥å®¹å¨ï¼æ¥çä¸ä¸å®¹å¨åçâ/tmpâç®å½ï¼åºè¯¥å°±å¯ä»¥çå°æä»¶ä¸å®¿ä¸»æºæ¯å®å¨ä¸è´çã\n\ndocker exec -it b5a sh    # b5aæ¯å®¹å¨id\n\n\n1\n\n\n-v åæ°æè½½å®¿ä¸»æºç®å½çè¿ä¸ªåè½ï¼å¯¹äºæä»¬æ¥å¸¸å¼åæµè¯å·¥ä½æ¥è¯´éå¸¸æç¨ï¼æä»¬å¯ä»¥å¨ä¸åå¨æ¬æºç¯å¢çåæä¸ï¼ä½¿ç¨éåå®è£ä»»æçåºç¨ï¼ç¶åç´æ¥ä»¥å®¹å¨æ¥è¿è¡æä»¬æ¬å°çæºç ãèæ¬ï¼éå¸¸æ¹ä¾¿ã\n\nè¿éæä¸¾ä¸ä¸ªç®åçä¾å­ãæ¯å¦ææ¬æºä¸åªæpython 2.7ï¼ä½ææ³ç¨python 3å¼åï¼å¦æåæ¶å®è£python 2åpython 3å¾å®¹æå°±ä¼æç³»ç»æä¹±ï¼æä»¥æå°±å¯ä»¥è¿ä¹åï¼\n\n 1. åä½¿ç¨ docker pull æåä¸ä¸ªpython 3çéåï¼å ä¸ºå®æåäºå®æ´çè¿è¡ç¯å¢ï¼è¿è¡æ¶æéç¦»ï¼æä»¥ä¸ä¼å¯¹ç°æç³»ç»çpython 2.7äº§çä»»ä½å½±åã\n 2. å¨æ¬å°çæä¸ªç®å½ç¼åpythonä»£ç ï¼ç¶åç¨ -v åæ°è®©å®¹å¨å±äº«è¿ä¸ªç®å½ã\n 3. ç°å¨å°±å¯ä»¥å¨å®¹å¨éä»¥python 3æ¥å®è£åç§åï¼åè¿è¡èæ¬åå¼åäºã\n\ndocker pull python:alpine\ndocker run -it --rm -v `pwd`:/tmp python:alpine sh\n\n\n\n1\n2\n3\n\n\næ¾ç¶ï¼è¿ç§æ¹å¼æ¯ææä»¶æåå°éåæè docker cp ä¼æ´å çµæ´»ï¼éå¸¸éåæé¢ç¹ä¿®æ¹çå¼åæµè¯å·¥ä½ã\n\n\n# å¦ä½å®ç°ç½ç»äºé\n\nä½¿ç¨ docker cp å docker run -v å¯ä»¥è§£å³å®¹å¨ä¸å¤ççæä»¶äºéé®é¢ï¼ä½å¯¹äºnginxãredisè¿äºæå¡å¨æ¥è¯´ï¼ç½ç»äºéææ¯æ´è¦ç´§çé®é¢ãç½ç»äºéçå³é®å¨äºâæéâå®¹å¨åå¤çç½ç»ã\n\ndockeræä¾äºä¸ç§ç½ç»æ¨¡å¼ï¼åå«æ¯ nullã host å bridgeã\n\n * null æ¯æç®åçæ¨¡å¼ï¼ä¹å°±æ¯æ²¡æç½ç»ï¼ä½åè®¸å¶ä»çç½ç»æä»¶æ¥èªå®ä¹ç½ç»è¿æ¥\n * host çæææ¯ç´æ¥ä½¿ç¨å®¿ä¸»æºç½ç»ï¼ç¸å½äºå»æäºå®¹å¨çç½ç»éç¦»ï¼å¶ä»éç¦»ä¾ç¶ä¿çï¼ï¼ææçå®¹å¨ä¼å±äº«å®¿ä¸»æºçipå°ååç½å¡ãè¿ç§æ¨¡å¼æ²¡æä¸­é´å±ï¼èªç¶éä¿¡æçé«ï¼ä½ç¼ºå°äºéç¦»ï¼è¿è¡å¤ªå¤çå®¹å¨ä¹å®¹æå¯¼è´ç«¯å£å²çªã\n   * hostæ¨¡å¼éè¦å¨ docker run æ¶ä½¿ç¨ --net=host åæ°\n\nä½¿ç¨ host ç½ç»æ¨¡å¼çä¾å­\n\nä¸é¢ç¨--net=hostè¿ä¸ªåæ°å¯å¨nginxï¼\n\ndocker run -d --rm --net=host nginx:alpine\n\n\n1\n\n\nä¸ºäºéªè¯ææï¼æä»¬å¯ä»¥å¨æ¬æºåå®¹å¨éåå«æ§è¡ ip addr å½ä»¤ï¼æ¥çç½å¡ä¿¡æ¯:\n\nip addr                    # æ¬æºæ¥çç½å¡\ndocker exec xxx ip addr    # å®¹å¨æ¥çç½å¡\n\n\n1\n2\n\n\nå¯ä»¥åç°è¿ä¸¤ä¸ªå½ä»¤çè¾åºä¿¡æ¯æ¯å®å¨ä¸æ ·çï¼å¦ç½å¡ ensxxx å ip å°åã\n\n * bridgeï¼ä¹å°±æ¯æ¡¥æ¥æ¨¡å¼ï¼å®æç¹ç±»ä¼¼ç°å®ä¸çéçäº¤æ¢æºãè·¯ç±å¨ï¼åªä¸è¿æ¯ç±è½¯ä»¶èæåºæ¥çï¼å®¹å¨åå®¿ä¸»æºåéè¿èæç½å¡æ¥å¥è¿ä¸ªç½æ¡¥ï¼å¾ä¸­çdocker0ï¼ï¼é£ä¹å®ä»¬ä¹é´ä¹å°±å¯ä»¥æ­£å¸¸çæ¶åç½ç»æ°æ®åäºãä¸è¿åhostæ¨¡å¼ç¸æ¯ï¼bridgeæ¨¡å¼å¤äºèæç½æ¡¥åç½å¡ï¼éä¿¡æçä¼ä½ä¸äºã\n   * å¯ä»¥ç¨ --net=bridge æ¥å¯ç¨æ¡¥æ¥æ¨¡å¼ï¼ä½å¶å®ä¸å¿è¦ï¼å ä¸ºdockeré»è®¤çç½ç»æ¨¡å¼å°±æ¯bridgeï¼æä»¥ä¸è¬ä¸éè¦æ¾å¼æå®ã\n   * \n\nä½¿ç¨ bridge ç½ç»æ¨¡å¼çä¾å­\n\nä¸é¢æä»¬å¯å¨ä¸¤ä¸ªå®¹å¨nginxåredisï¼å°±ååæè¯´çï¼æ²¡æç¹æ®æå®å°±ä¼ä½¿ç¨bridgeæ¨¡å¼ï¼\n\ndocker run -d --rm nginx:alpine    # é»è®¤ä½¿ç¨æ¡¥æ¥æ¨¡å¼\ndocker run -d --rm redis           # é»è®¤ä½¿ç¨æ¡¥æ¥æ¨¡å¼\n\n\n1\n2\n\n\nç¶åæä»¬è¿æ¯å¨æ¬æºåå®¹å¨éæ§è¡ ip addr å½ä»¤ï¼rediså®¹å¨éæ²¡æipå½ä»¤ï¼æä»¥åªè½å¨nginxå®¹å¨éæ§è¡ï¼ï¼\n\nå¯¹æ¯ä¸ä¸åæhostæ¨¡å¼çè¾åºï¼å°±å¯ä»¥åç°å®¹å¨éçç½å¡è®¾ç½®ä¸å®¿ä¸»æºå®å¨ä¸åï¼eth0æ¯ä¸ä¸ªèæç½å¡ï¼ipå°åæ¯bç±»ç§æå°åâ172.17.0.4âã\n\næä»¬è¿å¯ä»¥ç¨ docker inspect ç´æ¥æ¥çå®¹å¨çipå°åï¼\n\ndocker inspect xxx |grep ipaddress\n\n\n1\n\n\nè¿æ¾ç¤ºåºä¸¤ä¸ªå®¹å¨çipå°ååå«æ¯â172.17.0.3âåâ172.17.0.4âï¼èå®¿ä¸»æºçipå°ååæ¯â172.17.0.1âï¼æä»¥å®ä»¬é½å¨â172.17.0.0/16âè¿ä¸ªdockerçé»è®¤ç½æ®µï¼å½¼æ­¤ä¹é´å°±è½å¤ä½¿ç¨ipå°åæ¥å®ç°ç½ç»éä¿¡äºã\n\n\n# å¦ä½åéæå¡ç«¯å£å·\n\næå¡å¨åºç¨é½å¿é¡»è¦æç«¯å£å·æè½å¯¹å¤æä¾æå¡ãåé¢ç¬¬4èæä»¬å¨å­¦ä¹ ç¼ådockerfileçæ¶åä¹çå°è¿ï¼å¯ä»¥ç¨ expose æä»¤å£°æå®¹å¨å¯¹å¤çç«¯å£å·ã\n\nä¸å°ä¸»æºä¸çç«¯å£å·æ°éæ¯æéçï¼èä¸å¤ä¸ªæå¡ä¹é´è¿ä¸è½å¤å²çªï¼ä½æä»¬æåéååºç¨çæ¶åéå¸¸é½ä½¿ç¨çæ¯é»è®¤ç«¯å£ï¼å®¹å¨å®éè¿è¡èµ·æ¥å°±å¾å®¹æå ä¸ºç«¯å£å·è¢«å ç¨èæ æ³å¯å¨ã\n\nè§£å³è¿ä¸ªé®é¢çæ¹æ³å°±æ¯å å¥ä¸ä¸ªâä¸­é´å±âï¼ç±å®¹å¨ç¯å¢ä¾å¦dockeræ¥ç»ä¸ç®¡çåéç«¯å£å·ï¼å¨æ¬æºç«¯å£åå®¹å¨ç«¯å£ä¹é´åä¸ä¸ªâæ å°âæä½ï¼å®¹å¨åé¨è¿æ¯ç¨èªå·±çç«¯å£å·ï¼ä½å¤ççå°çå´æ¯å¦å¤ä¸ä¸ªç«¯å£å·ï¼è¿æ ·å°±å¾å¥½å°é¿åäºå²çªã\n\nç«¯å£å·æ å°éè¦ä½¿ç¨bridgeæ¨¡å¼ï¼å¹¶ä¸å¨ docker run å¯å¨å®¹å¨æ¶ä½¿ç¨ -p åæ°ï¼å½¢å¼åå±äº«ç®å½ç -v åæ°å¾ç±»ä¼¼ï¼ç¨ : åéæ¬æºç«¯å£åå®¹å¨ç«¯å£ã\n\nåéæå¡ç«¯å£å·çä¾å­\n\nå¦æè¦å¯å¨ä¸¤ä¸ªnginxå®¹å¨ï¼åå«è·å¨80å8080ç«¯å£ä¸ï¼\n\ndocker run -d -p 80:80 --rm nginx:alpine\ndocker run -d -p 8080:80 --rm nginx:alpine\n\n\n1\n2\n\n\nè¿æ ·å°±ææ¬æºç80å8080ç«¯å£åå«âæ å°âå°äºä¸¤ä¸ªå®¹å¨éç80ç«¯å£ï¼ä¸ä¼åçå²çªï¼æä»¬å¯ä»¥ç¨curlåéªè¯ä¸ä¸ã\n\nä½¿ç¨ docker ps å½ä»¤è½å¤å¨âportsâæ éæ´ç´è§å°çå°ç«¯å£çæ å°æåµã',charsets:{cjk:!0},lastUpdated:"2023/06/07, 00:44:58",lastUpdatedTimestamp:1686098698e3},{title:"Kubernetes çå®è£ä¸åºæ¬æ¶æ",frontmatter:{title:"Kubernetes çå®è£ä¸åºæ¬æ¶æ",date:"2023-06-04T21:22:52.000Z",permalink:"/pages/757154/",categories:["åºç¡","äºåç","Kuberneteså¥é¨å®æè¯¾-ç½åé"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/20.%E4%BA%91%E5%8E%9F%E7%94%9F/15.Kubernetes%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98%E8%AF%BE-%E7%BD%97%E5%89%91%E9%94%8B/09.Kubernetes%20%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84.html",relativePath:"åºç¡/20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/09.Kubernetes çå®è£ä¸åºæ¬æ¶æ.md",key:"v-7a34202e",path:"/pages/757154/",headers:[{level:2,title:"Kubernetes çå®è£ä¸åºæ¬æ¶æ",slug:"kubernetes-çå®è£ä¸åºæ¬æ¶æ",normalizedTitle:"kubernetes çå®è£ä¸åºæ¬æ¶æ",charIndex:2},{level:3,title:"èµ°è¿äºåçï¼å¨æ¬æºæ­å»º Kubernetes å°éç¾¤",slug:"èµ°è¿äºåç-å¨æ¬æºæ­å»º-kubernetes-å°éç¾¤",normalizedTitle:"èµ°è¿äºåçï¼å¨æ¬æºæ­å»º kubernetes å°éç¾¤",charIndex:26},{level:3,title:"å®è£ç¯å¢",slug:"å®è£ç¯å¢",normalizedTitle:"å®è£ç¯å¢",charIndex:116},{level:3,title:"å®ééªè¯ minikuybe ç¯å¢",slug:"å®ééªè¯-minikuybe-ç¯å¢",normalizedTitle:"å®ééªè¯ minikuybe ç¯å¢",charIndex:628},{level:3,title:"å¨Kuberneteséè¿è¡ä¸ä¸ªNginxåºç¨",slug:"å¨kuberneteséè¿è¡ä¸ä¸ªnginxåºç¨",normalizedTitle:"å¨kuberneteséè¿è¡ä¸ä¸ªnginxåºç¨",charIndex:1200},{level:3,title:"å³äºäºåç",slug:"å³äºäºåç",normalizedTitle:"å³äºäºåç",charIndex:1493},{level:2,title:"èªå¨åçè¿ç»´ç®¡çï¼æ¢ç©¶ Kubernetes å·¥ä½æºå¶çå¥¥ç§",slug:"èªå¨åçè¿ç»´ç®¡ç-æ¢ç©¶-kubernetes-å·¥ä½æºå¶çå¥¥ç§",normalizedTitle:"èªå¨åçè¿ç»´ç®¡çï¼æ¢ç©¶ kubernetes å·¥ä½æºå¶çå¥¥ç§",charIndex:1686},{level:3,title:"äºè®¡ç®æ¶ä»£çæä½ç³»ç»",slug:"äºè®¡ç®æ¶ä»£çæä½ç³»ç»",normalizedTitle:"äºè®¡ç®æ¶ä»£çæä½ç³»ç»",charIndex:1768},{level:3,title:"Kubernetesçåºæ¬æ¶æ",slug:"kubernetesçåºæ¬æ¶æ",normalizedTitle:"kubernetesçåºæ¬æ¶æ",charIndex:2004},{level:3,title:"èç¹åé¨çç»æ",slug:"èç¹åé¨çç»æ",normalizedTitle:"èç¹åé¨çç»æ",charIndex:2870},{level:4,title:"(1) Masteréçç»ä»¶æåªäº",slug:"_1-masteréçç»ä»¶æåªäº",normalizedTitle:"(1) masteréçç»ä»¶æåªäº",charIndex:3061},{level:4,title:"(2) Node éçç»ä»¶æåªäºï¼",slug:"_2-node-éçç»ä»¶æåªäº",normalizedTitle:"(2) node éçç»ä»¶æåªäºï¼",charIndex:4480},{level:4,title:"(3) æä»¶ï¼Addonsï¼æåªäºï¼",slug:"_3-æä»¶-addons-æåªäº",normalizedTitle:"(3) æä»¶ï¼addonsï¼æåªäºï¼",charIndex:6328},{level:3,title:"å°ç»",slug:"å°ç»",normalizedTitle:"å°ç»",charIndex:7001}],headersStr:"Kubernetes çå®è£ä¸åºæ¬æ¶æ èµ°è¿äºåçï¼å¨æ¬æºæ­å»º Kubernetes å°éç¾¤ å®è£ç¯å¢ å®ééªè¯ minikuybe ç¯å¢ å¨Kuberneteséè¿è¡ä¸ä¸ªNginxåºç¨ å³äºäºåç èªå¨åçè¿ç»´ç®¡çï¼æ¢ç©¶ Kubernetes å·¥ä½æºå¶çå¥¥ç§ äºè®¡ç®æ¶ä»£çæä½ç³»ç» Kubernetesçåºæ¬æ¶æ èç¹åé¨çç»æ (1) Masteréçç»ä»¶æåªäº (2) Node éçç»ä»¶æåªäºï¼ (3) æä»¶ï¼Addonsï¼æåªäºï¼ å°ç»",content:'# Kubernetes çå®è£ä¸åºæ¬æ¶æ\n\n\n# èµ°è¿äºåçï¼å¨æ¬æºæ­å»º Kubernetes å°éç¾¤\n\nKuberneteså°±æ¯ä¸ä¸ª çäº§çº§å«çå®¹å¨ç¼æå¹³å°åéç¾¤ç®¡çç³»ç»ï¼ä¸ä»è½å¤åå»ºãè°åº¦å®¹å¨ï¼è¿è½å¤çæ§ãç®¡çæå¡å¨\n\n\n# å®è£ç¯å¢\n\n * minicube\n   * kind å minikubeï¼å®ä»¬é½å¯ä»¥å¨æ¬æºä¸è¿è¡å®æ´çKubernetesç¯å¢ã\n   * minikubeæå¤§ç¹ç¹å°±æ¯âå°èç¾âï¼å¯æ§è¡æä»¶ä»æä¸å°100MBï¼è¿è¡éåä¹ä¸è¿1GBï¼ä½å°±å¨è¿ä¹å°çç©ºé´éå´éæäºKubernetesçç»å¤§å¤æ°åè½ç¹æ§ï¼ä¸ä»ææ ¸å¿çå®¹å¨ç¼æåè½ï¼è¿æä¸°å¯çæä»¶ï¼ä¾å¦DashboardãGPUãIngressãIstioãKongãRegistryç­ç­ï¼ç»¼åæ¥çéå¸¸å®åã\n   * minikubeåªè½å¤æ­å»ºKubernetesç¯å¢\n * kubectl\n   * ç¨æ¥æä½Kubernetesçå®¢æ·ç«¯å·¥å·\n   * kubectlçä½ç¨æç¹ç±»ä¼¼ä¹åæä»¬å­¦ä¹ å®¹å¨ææ¯æ¶åçå·¥å·âdockerâï¼å®ä¹æ¯ä¸ä¸ªå½ä»¤è¡å·¥å·ï¼ä½ç¨ä¹æ¯è¾ç±»ä¼¼ï¼åæ ·æ¯ä¸Kubernetesåå°æå¡éä¿¡ï¼ææä»¬çå½ä»¤è½¬åç»Kubernetesï¼å®ç°å®¹å¨åéç¾¤çç®¡çåè½ã\n\næä»¥ï¼å¨minikubeç¯å¢éï¼æä»¬ä¼ç¨å°ä¸¤ä¸ªå®¢æ·ç«¯ï¼minikubeç®¡çKuberneteséç¾¤ç¯å¢ï¼kubectlæä½å®éçKubernetesåè½ï¼åDockeræ¯èµ·æ¥æç¹å¤æã\n\n\n# å®ééªè¯ minikuybe ç¯å¢\n\nåé¢çå·¥ä½é½åå®ä¹åï¼æä»¬å°±å¯ä»¥å¨æ¬æºä¸è¿è¡minikubeï¼åå»ºKuberneteså®éªç¯å¢äºã\n\nä½¿ç¨å½ä»¤ minikube start ä¼ä»Docker Hubä¸æåéåæ¶ï¼å½ä»¤ï¼minikube start --kubernetes-version=v1.23.3 ä¼åºç°é®é¢ï¼\n\n> The "docker" driver should not be used with root privileges. (æ æ³ç¨ root æéæ§è¡ docker é©±å¨)\n\nå ä¸ºä¸è½ç¨ root æéå¯å¨ minikubeãå¯¹å½ä»¤æå®ä¸äºåæ°å°±å¯ä»¥äºï¼å½ä»¤æ¹ä¸ºå¦ä¸ï¼\n\n minikube start --kubernetes-version=v1.23.3 --driver=docker --container-runtime=containerd --image-mirror-country=cn --force\n\n\n1\n\n\n> åèåå®¢\n\nç°å¨Kuberneteséç¾¤å°±å·²ç»å¨æä»¬æ¬å°è¿è¡äºï¼ä½ å¯ä»¥ä½¿ç¨ minikube statusã minikube node list è¿ä¸¤ä¸ªå½ä»¤æ¥æ¥çéç¾¤çç¶æï¼\n\nminikube status\nminikube node list\n\n\n1\n2\n\n\n\n# å¨Kuberneteséè¿è¡ä¸ä¸ªNginxåºç¨\n\nå½ä»¤ä¸Dockerä¸æ ·ï¼ä¹æ¯ runï¼ä¸è¿å½¢å¼ä¸æç¹åºå«ï¼éè¦ç¨ --image æå®éå**ï¼ç¶åKubernetesä¼èªå¨æåå¹¶è¿è¡ï¼\n\nkubectl run ngx --image=nginx:alpine\n\n\n1\n\n\nè¿éæ¶åKuberneteséçä¸ä¸ªéå¸¸éè¦çæ¦å¿µï¼ Podï¼ä½ å¯ä»¥ææ¶æå®çè§£ææ¯âç©¿äºé©¬ç²âçå®¹å¨ï¼æ¥çPodåè¡¨éè¦ä½¿ç¨å½ä»¤ kubectl get podï¼å®çææç±»ä¼¼ docker psã\n\nkubectlçç¨æ³ä¸dockerç±»ä¼¼ï¼ä¹å¯ä»¥æåéåè¿è¡ï¼ä½æä½çä¸æ¯ç®åçå®¹å¨ï¼èæ¯Podã\n\n\n# å³äºäºåç\n\næè°çâäºâï¼ç°å¨å°±æçæ¯Kubernetesï¼é£ä¹âäºåçâçææå°±æ¯åºç¨çå¼åãé¨ç½²ãè¿ç»´ç­ä¸ç³»åå·¥ä½é½è¦åKubernetesçé½ï¼ä½¿ç¨å®¹å¨ãå¾®æå¡ãå£°æå¼APIç­ææ¯ï¼ä¿è¯åºç¨çæ´ä¸ªçå½å¨æé½è½å¤å¨Kubernetesç¯å¢éé¡ºå©å®æ½ï¼ä¸éè¦éå é¢å¤çæ¡ä»¶ã\n\næ¢å¥è¯è¯´ï¼âäºåçâå°±æ¯Kuberneteséçâåä½æ°âï¼èä¸æ¯ä»å¶ä»ç¯å¢è¿è¿æ¥çâç§»æ°âã\n\n\n# èªå¨åçè¿ç»´ç®¡çï¼æ¢ç©¶ Kubernetes å·¥ä½æºå¶çå¥¥ç§\n\nè¿ä¸èå°±æ¥çä¸ä¸ Kubernetes çåé¨æ¶æåå·¥ä½æºå¶ï¼äºè§£å®è½å²è§ç¾¤éçç§å¯æå¨ã\n\n\n# äºè®¡ç®æ¶ä»£çæä½ç³»ç»\n\nKubernetes ç®¡çäºèµæºãæå¡ï¼ä»æç§è§åº¦æ¥çï¼å®å¯ä»¥è¯´æ¯ä¸ä¸ªéç¾¤çº§å«çæä½ç³»ç»ï¼ä¸»è¦åè½å°±æ¯èµæºç®¡çåä½ä¸è°åº¦ãKubernetes è¿ä¸ªæä½ç³»ç»ä¸ Linux è¿æä¸ç¹åºå«ä½ å¼å¾æ³¨æãLinux çç¨æ·éå¸¸æ¯ä¸¤ç±»äººï¼Dev å Opsï¼èå¨ Kubernetes éååªæä¸ç±»äººï¼DevOpsã\n\n> ç±äºäºåççå´èµ·ï¼å¼åäººåä»ä¸å¼å§å°±å¿é¡»èèåç»­çé¨ç½²è¿ç»´å·¥ä½ï¼èè¿ç»´äººåä¹éè¦å¨æ©æä»å¥å¼åï¼æè½åå¥½åºç¨çè¿ç»´çæ§å·¥ä½ã\n\n\n# Kubernetesçåºæ¬æ¶æ\n\nKubernetes çæ¶æå¾å¦ä¸å¾æç¤ºï¼\n\nKubernetes éç¨äºç°ä»æµè¡çâæ§å¶é¢/æ°æ®é¢âï¼Control Plane / Data Planeï¼æ¶æï¼éç¾¤éçè®¡ç®æºè¢«ç§°ä¸ºâèç¹âï¼Nodeï¼ï¼å¯ä»¥æ¯å®æºä¹å¯ä»¥æ¯èæºï¼å°éçèç¹ç¨ä½æ§å¶é¢æ¥æ§è¡éç¾¤çç®¡çç»´æ¤å·¥ä½ï¼å¶ä»çå¤§é¨åèç¹é½è¢«åå½æ°æ®é¢ï¼ç¨æ¥è·ä¸å¡åºç¨ã\n\n * Control Plan çèç¹å«å Master Nodeï¼ä¸è¬ç®ç§° Masterï¼å¯ä»¥è¯´æ¯ Kubernetes çå¤§èåå¿èã\n * Data Plan çèç¹å«å Worker Nodeï¼ä¸è¬ç®ç§° Worker æ Nodeï¼ç¸å½äº Kubernetes çæåèï¼å¨ Master çææ¥ä¸å¹²æ´»ã\n\nNode çæ°ééå¸¸å¤ï¼ææäºä¸ä¸ªèµæºæ± ï¼Kubernetes å°±å¨è¿ä¸ªæ± éåéèµæºï¼è°åº¦åºç¨ãå ä¸ºèµæºè¢«âæ± åâäºï¼æä»¥ç®¡çä¹å°±åå¾æ¯è¾ç®åï¼å¯ä»¥å¨éç¾¤ä¸­ä»»ææ·»å æèå é¤èç¹ã\n\nå¨è¿å¼ æ¶æå¾éï¼æä»¬è¿å¯ä»¥çå°æä¸ä¸ª kubectlï¼å®å°±æ¯ Kubernetes çå®¢æ·ç«¯å·¥å·ï¼ç¨æ¥æä½ Kubernetesï¼ä½å®ä½äºéç¾¤ä¹å¤ï¼çè®ºä¸ä¸å±äºéç¾¤ãå¯ä»¥ä½¿ç¨å½ä»¤ kubectl get node æ¥æ¥ç k8s çèç¹ç¶æï¼\n\n$ kubectl get node\nNAME       STATUS   ROLES                  AGE   VERSION\nminikube   Ready    control-plane,master   93m   v1.23.3\n\n\n1\n2\n3\n\n\nå¯ä»¥çå°å½åç minikube éç¾¤éåªæä¸ä¸ª Masterï¼é£ Node æä¹ä¸è§äºï¼è¿æ¯å ä¸º Master å Node çååä¸æ¯ç»å¯¹çãå½éç¾¤çè§æ¨¡è¾å°ï¼å·¥ä½è´è½½è¾å°çæ¶åï¼Master ä¹å¯ä»¥æ¿æ Node çå·¥ä½ï¼å°±åæä»¬æ­å»ºç minikube ç¯å¢ï¼å®å°±åªæä¸ä¸ªèç¹ï¼è¿ä¸ªèç¹æ¢æ¯ Master åæ¯ Nodeã\n\n\n# èç¹åé¨çç»æ\n\nKubernetesçèç¹åé¨ä¹å·æå¤æçç»æï¼æ¯ç±å¾å¤çæ¨¡åææçï¼è¿äºæ¨¡ååå¯ä»¥åæç»ä»¶ï¼Componentï¼åæä»¶ï¼Addonï¼ä¸¤ç±»ã\n\n * ç»ä»¶å®ç°äºKubernetesçæ ¸å¿åè½ç¹æ§ï¼æ²¡æè¿äºç»ä»¶Kuberneteså°±æ æ³å¯å¨\n * æä»¶åæ¯Kubernetesçä¸äºéå åè½ï¼å±äºâé¦ä¸æ·»è±âï¼ä¸å®è£ä¹ä¸ä¼å½±åKubernetesçæ­£å¸¸è¿è¡ã\n\n# (1) Masteréçç»ä»¶æåªäº\n\nMasteréæ4ä¸ªç»ä»¶ï¼åå«æ¯ apiserverã etcdã schedulerã controller-managerã\n\n * apiserverï¼æ´ä¸ª Kubernetes ç³»ç»çå¯ä¸å¥å£ï¼å®å¯¹å¤å¬å¼äºä¸ç³»åç RESTful APIï¼å¹¶ä¸å ä¸äºéªè¯ãææç­åè½ï¼ææå¶ä»ç»ä»¶é½åªè½åå®ç´æ¥éä¿¡ï¼å¯ä»¥è¯´æ¯ Kubernetes éçèç»åã\n * etcdï¼ä¸ä¸ªé«å¯ç¨ç KV æ°æ®åºï¼ç¨æ¥æä¹åå­å¨ç³»ç»éçåç§èµæºå¯¹è±¡åç¶æãæ³¨æå®åªä¸ apiserver æç´æ¥èç³»ï¼ä¹å°±æ¯è¯´ä»»ä½å¶ä»ç»ä»¶æ³è¦è¯»å etcd éçæ°æ®é½å¿é¡»ç»è¿ apiserverã\n * schedulerï¼è´è´£å®¹å¨çç¼æå·¥ä½ï¼æ£æ¥èç¹çèµæºç¶æï¼æ Pod è°åº¦å°æéåçèç¹ä¸è¿è¡ï¼ç¸å½äºé¨ç½²äººåãå ä¸ºèç¹ç¶æå Pod ä¿¡æ¯é½å­å¨å¨ etcd éï¼æä»¥ scheduler å¿é¡»éè¿ apiserver æè½è·å¾ã\n * controller-managerï¼è´è´£ç»´æ¤å®¹å¨åèç¹ç­èµæºçç¶æï¼å®ç°æéæ£æµãæå¡è¿ç§»ãåºç¨ä¼¸ç¼©ç­åè½ï¼ç¸å½äºçæ§è¿ç»´äººåãåæ ·å°ï¼å®ä¹å¿é¡»éè¿ apiserver è·å¾å­å¨å¨ etcd éçä¿¡æ¯ï¼æè½å¤å®ç°å¯¹èµæºçåç§æä½ã\n\n> API å¯¹è±¡å°±è¢« apiserver å­å¨å¨æ°æ®åº etcd éï¼ç¶å kubeletãschedulerãcontroller-manager ç­ç»ä»¶éè¿ apiserver æ¥æä½å®ä»¬ï¼å°±å¨APIå¯¹è±¡è¿ä¸ªæ½è±¡å±æ¬¡å®ç°äºå¯¹æ´ä¸ªéç¾¤çç®¡çã\n\nè¿4ä¸ªç»ä»¶ä¹é½è¢«å®¹å¨åäºï¼è¿è¡å¨éç¾¤ç Pod éï¼æä»¬å¯ä»¥ç¨ kubectl æ¥æ¥çå®ä»¬çç¶æï¼ä½¿ç¨å½ä»¤ï¼\n\n\n\n\n\nÂ \nÂ \nÂ \n\nÂ \n\n\n\n$ kubectl get pod -n kube-system\nNAME                               READY   STATUS             RESTARTS   AGE\ncoredns-64897985d-64hv8            1/1     Running            0          100m\netcd-minikube                      1/1     Running            0          100m\nkube-apiserver-minikube            1/1     Running            0          100m\nkube-controller-manager-minikube   1/1     Running            0          100m\nkube-proxy-r2b4g                   1/1     Running            0          100m\nkube-scheduler-minikube            1/1     Running            0          100m\nstorage-provisioner                0/1     ImagePullBackOff   0          100m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# (2) Node éçç»ä»¶æåªäºï¼\n\nMasteréçapiserverãschedulerç­ç»ä»¶éè¦è·åèç¹çåç§ä¿¡æ¯æè½å¤ä½åºç®¡çå³ç­ï¼é£è¿äºä¿¡æ¯è¯¥æä¹æ¥å¢ï¼è¿å°±éè¦Nodeéç3ä¸ªç»ä»¶äºï¼åå«æ¯ kubeletãkube-proxyãcontainer-runtimeï¼\n\n * kubeletï¼Node çä»£çï¼è´è´£ç®¡ç Node ç¸å³çç»å¤§é¨åæä½ï¼Node ä¸åªæå®è½å¤ä¸ apiserver éä¿¡ï¼å®ç°ç¶ææ¥åãå½ä»¤ä¸åãå¯åå®¹å¨ç­åè½ï¼ç¸å½äºæ¯ Node ä¸çä¸ä¸ªâå°ç®¡å®¶âã\n * kube-proxyï¼Node çç½ç»ä»£çï¼åªè´è´£ç®¡çå®¹å¨çç½ç»éä¿¡ï¼ç®åæ¥è¯´å°±æ¯ä¸º Pod è½¬å TCP/UDP æ°æ®åï¼ç¸å½äºæ¯ä¸èçâå°é®å·®âã\n * container-runtimeï¼å®æ¯å®¹å¨åéåçå®éä½¿ç¨èï¼éå¸¸ä¸º Dockerï¼å¨ kubelet çææ¥ä¸åå»ºå®¹å¨ï¼ç®¡ç Pod ççå½å¨æï¼æ¯çæ­£å¹²æ´»çâè¦åâã\n\n> æä»¬ä¸å®è¦æ³¨æï¼å ä¸º Kubernetes çå®ä½æ¯å®¹å¨ç¼æå¹³å°ï¼æä»¥å®æ²¡æéå® container-runtime å¿é¡»æ¯ Dockerï¼å®å¨å¯ä»¥æ¿æ¢æä»»ä½ç¬¦åæ åçå¶ä»å®¹å¨è¿è¡æ¶ï¼ä¾å¦ containerdãCRI-O ç­ç­ï¼åªä¸è¿å¨è¿éæä»¬ä½¿ç¨çæ¯ Dockerã\n\nè¿3ä¸ªç»ä»¶ä¸­åªæ kube-proxy è¢«å®¹å¨åäºï¼è kubelet å ä¸ºå¿é¡»è¦ç®¡çæ´ä¸ªèç¹ï¼å®¹å¨åä¼éå¶å®çè½åï¼æä»¥å®å¿é¡»å¨ container-runtime ä¹å¤è¿è¡ã\n\nä½¿ç¨ minikube ssh å½ä»¤ç»å½å°èç¹åï¼å¯ä»¥ç¨ docker ps çå° kube-proxyï¼\n\nÂ \n\n\nÂ \n\n\n\n\n$ minikube ssh\nLast login: Sat Apr 22 11:43:55 2023 from 192.168.49.1\n\ndocker@minikube:~$ docker ps | grep kube-proxy\n2089b7b713b1   9b7cc9982109           "/usr/local/bin/kubeâ¦"   2 hours ago      Up 2 hours                k8s_kube-proxy_kube-proxy-r2b4g_kube-system_86dd0c2b-f392-4327-82b8-32422e441a75_0\n4d3598fc2131   k8s.gcr.io/pause:3.6   "/pause"                 2 hours ago      Up 2 hours                k8s_POD_kube-proxy-r2b4g_kube-system_86dd0c2b-f392-4327-82b8-32422e441a75_0\n\n\n1\n2\n3\n4\n5\n6\n\n\n> ????????????ä¸ºå¥ææ§è¡è¿ä¸ªæé®é¢ï¼ï¼ï¼ï¼ï¼\n\nè kubelet ç¨ docker ps æ¯æ¾ä¸å°çï¼éè¦ç¨æä½ç³»ç»ç ps å½ä»¤ï¼\n\nps -ef | grep kubelet\n\n\n1\n\n\nç°å¨ï¼æä»¬åæ Node éçç»ä»¶å Master éçç»ä»¶æ¾å¨ä¸èµ·æ¥çï¼å°±è½å¤æç½ Kubernetes çå¤§è´å·¥ä½æµç¨äºï¼\n\n * æ¯ä¸ª Node ä¸ç kubelet ä¼å®æå apiserver ä¸æ¥èç¹ç¶æï¼apiserver åå­å° etcd éã\n * æ¯ä¸ª Node ä¸ç kube-proxy å®ç°äº TCP/UDP ååä»£çï¼è®©å®¹å¨å¯¹å¤æä¾ç¨³å®çæå¡ã\n * scheduler éè¿ apiserver å¾å°å½åçèç¹ç¶æï¼è°åº¦ Podï¼ç¶å apiserver ä¸åå½ä»¤ç»æä¸ª Node ç kubeletï¼kubelet è°ç¨ container-runtime å¯å¨å®¹å¨ã\n * controller-manager ä¹éè¿ apiserver å¾å°å®æ¶çèç¹ç¶æï¼çæ§å¯è½çå¼å¸¸æåµï¼åä½¿ç¨ç¸åºçææ®µå»è°èæ¢å¤ã\n\nå¶å®ï¼è¿åæä»¬å¨ Kubernetes åºç°ä¹åçæä½æµç¨ä¹å·®ä¸äºå¤å°ï¼ä½ Kubernetes çé«æä¹å¤å°±å¨äºæè¿äºé½æ½è±¡åè§èåäºãäºæ¯ï¼è¿äºç»ä»¶å°±å¥½åæ¯æ æ°ä¸ªä¸ç¥ç²å¦çè¿ç»´å·¥ç¨å¸ï¼æååç¹çä½æçäººåå·¥ä½æ¬è¿äºé«æçè®¡ç®æºéï¼å°±è½å¤éæ¶åç°éç¾¤éçåååå¼å¸¸ï¼åäºç¸åä½ï¼ç»´æ¤éç¾¤çå¥åº·ç¶æã\n\n# (3) æä»¶ï¼Addonsï¼æåªäºï¼\n\nåªè¦æå¡å¨èç¹ä¸è¿è¡äº apiserverãschedulerãkubeletãkube-proxyãcontainer-runtime ç­ç»ä»¶ï¼å°±å¯ä»¥è¯´æ¯ä¸ä¸ªåè½é½å¨ç Kubernetes éç¾¤äºã\n\nä¸è¿å°±åLinuxä¸æ ·ï¼æä½ç³»ç»æä¾çåºç¡åè½è½ç¶âå¯ç¨âï¼ä½æ³è¾¾å°âå¥½ç¨âçç¨åº¦ï¼è¿æ¯è¦åå®è£ä¸äºéå åè½ï¼è¿å¨Kuberneteséå°±æ¯æä»¶ï¼Addonï¼ãç±äºKubernetesæ¬èº«çè®¾è®¡éå¸¸çµæ´»ï¼æä»¥å°±æå¤§éçæä»¶ç¨æ¥æ©å±ãå¢å¼ºå®å¯¹åºç¨åéç¾¤çç®¡çè½åã\n\nminikubeä¹æ¯æå¾å¤çæä»¶ï¼ä½¿ç¨å½ä»¤ minikube addons list å°±å¯ä»¥æ¥çæä»¶åè¡¨ï¼\n\næä»¶ä¸­æä¸ªäººè®¤ä¸ºæ¯è¾éè¦çæä¸¤ä¸ªï¼DNS å Dashboardã\n\n * DNS å¨ Kubernetes éç¾¤éå®ç°äºååè§£ææå¡ï¼è½å¤è®©æä»¬ä»¥ååèä¸æ¯ IP å°åçæ¹å¼æ¥äºç¸éä¿¡ï¼æ¯æå¡åç°åè´è½½åè¡¡çåºç¡ãç±äºå®å¯¹å¾®æå¡ãæå¡ç½æ ¼ç­æ¶æè³å³éè¦ï¼æä»¥åºæ¬ä¸æ¯ Kubernetes çå¿å¤æä»¶ã\n * Dashboard å°±æ¯ä»ªè¡¨çï¼ä¸º Kubernetes æä¾äºä¸ä¸ªå¾å½¢åçæä½çé¢ï¼éå¸¸ç´è§åå¥½ï¼è½ç¶å¤§å¤æ° Kubernetes å·¥ä½é½æ¯ä½¿ç¨å½ä»¤è¡ kubectlï¼ä½æçæ¶åå¨ Dashboard ä¸æ¥çä¿¡æ¯ä¹æ¯æºæ¹ä¾¿çã\n\nä½ åªè¦å¨ minikube ç¯å¢éæ§è¡ä¸æ¡ç®åçå½ä»¤ï¼å°±å¯ä»¥èªå¨ç¨æµè§å¨æå¼ Dashboard é¡µé¢ï¼èä¸è¿æ¯æä¸­æï¼\n\nminikube dashboard\n\n\n1\n\n\n\n# å°ç»\n\nå°ç»ä¸ä¸è¿ä¸èçè¦ç¹ï¼\n\n 1. Kubernetes è½å¤å¨éç¾¤çº§å«ç®¡çåºç¨åæå¡å¨ï¼å¯ä»¥è®¤ä¸ºæ¯ä¸ç§éç¾¤æä½ç³»ç»ãå®ä½¿ç¨âæ§å¶é¢/æ°æ®é¢âçåºæ¬æ¶æï¼Master èç¹å®ç°ç®¡çæ§å¶åè½ï¼Worker èç¹è¿è¡å·ä½ä¸å¡ã\n 2. Kubernetes ç±å¾å¤æ¨¡åç»æï¼å¯åä¸ºæ ¸å¿çç»ä»¶åééçæä»¶ä¸¤ç±»ã\n 3. Master éæ 4 ä¸ªç»ä»¶ï¼åå«æ¯ apiserverãetcdãschedulerãcontroller-managerã\n 4. Node éæ 3 ä¸ªç»ä»¶ï¼åå«æ¯ kubeletãkube-proxyãcontainer-runtimeã\n 5. éå¸¸å¿å¤çæä»¶æ DNS å Dashboardã\n\nè¯¾å¤å°è´´å£«ï¼\n\n * ä¸ºç¡®ä¿æ§å¶é¢çé«å¯ç¨ï¼Kubernetes éç¾¤éé½ä¼é¨ç½²å¤ä¸ª Master èç¹ï¼æ°éä¸è¬ä¼æ¯å¥æ° (3/5/7)ï¼è¿æ¯ç± etcd çç¹æ§å³å®çã\n * etcd ç± CoreOS å¬å¸å¼åï¼åºäºç±» Paxos ç Raft ç®æ³å®ç°æ°æ®ä¸è´æ§ã\n * controller-manager æ¯å¾å¤ä¸ª controller çéåä½æ¯ä¸ä¸ª controller è´è´£ä¸ç§æ§å¶å¾ªç¯ (å¦ node con-trollerãnamespace controller)ï¼ä½ä¸ºäºç®åè¢«åå¹¶å¨ä¸ä¸ªè¿ç¨éæ§è¡ã\n * minikube ç Dashboard åªåè®¸å¨æ¬æºè¿è¡çæµè§å¨è®¿é®ï¼ä¸è¿ä½ ä¹å¯ä»¥ç»å®éç½® Nginx ååä»£çã',normalizedContent:'# kubernetes çå®è£ä¸åºæ¬æ¶æ\n\n\n# èµ°è¿äºåçï¼å¨æ¬æºæ­å»º kubernetes å°éç¾¤\n\nkuberneteså°±æ¯ä¸ä¸ª çäº§çº§å«çå®¹å¨ç¼æå¹³å°åéç¾¤ç®¡çç³»ç»ï¼ä¸ä»è½å¤åå»ºãè°åº¦å®¹å¨ï¼è¿è½å¤çæ§ãç®¡çæå¡å¨\n\n\n# å®è£ç¯å¢\n\n * minicube\n   * kind å minikubeï¼å®ä»¬é½å¯ä»¥å¨æ¬æºä¸è¿è¡å®æ´çkubernetesç¯å¢ã\n   * minikubeæå¤§ç¹ç¹å°±æ¯âå°èç¾âï¼å¯æ§è¡æä»¶ä»æä¸å°100mbï¼è¿è¡éåä¹ä¸è¿1gbï¼ä½å°±å¨è¿ä¹å°çç©ºé´éå´éæäºkubernetesçç»å¤§å¤æ°åè½ç¹æ§ï¼ä¸ä»ææ ¸å¿çå®¹å¨ç¼æåè½ï¼è¿æä¸°å¯çæä»¶ï¼ä¾å¦dashboardãgpuãingressãistioãkongãregistryç­ç­ï¼ç»¼åæ¥çéå¸¸å®åã\n   * minikubeåªè½å¤æ­å»ºkubernetesç¯å¢\n * kubectl\n   * ç¨æ¥æä½kubernetesçå®¢æ·ç«¯å·¥å·\n   * kubectlçä½ç¨æç¹ç±»ä¼¼ä¹åæä»¬å­¦ä¹ å®¹å¨ææ¯æ¶åçå·¥å·âdockerâï¼å®ä¹æ¯ä¸ä¸ªå½ä»¤è¡å·¥å·ï¼ä½ç¨ä¹æ¯è¾ç±»ä¼¼ï¼åæ ·æ¯ä¸kubernetesåå°æå¡éä¿¡ï¼ææä»¬çå½ä»¤è½¬åç»kubernetesï¼å®ç°å®¹å¨åéç¾¤çç®¡çåè½ã\n\næä»¥ï¼å¨minikubeç¯å¢éï¼æä»¬ä¼ç¨å°ä¸¤ä¸ªå®¢æ·ç«¯ï¼minikubeç®¡çkuberneteséç¾¤ç¯å¢ï¼kubectlæä½å®éçkubernetesåè½ï¼ådockeræ¯èµ·æ¥æç¹å¤æã\n\n\n# å®ééªè¯ minikuybe ç¯å¢\n\nåé¢çå·¥ä½é½åå®ä¹åï¼æä»¬å°±å¯ä»¥å¨æ¬æºä¸è¿è¡minikubeï¼åå»ºkuberneteså®éªç¯å¢äºã\n\nä½¿ç¨å½ä»¤ minikube start ä¼ä»docker hubä¸æåéåæ¶ï¼å½ä»¤ï¼minikube start --kubernetes-version=v1.23.3 ä¼åºç°é®é¢ï¼\n\n> the "docker" driver should not be used with root privileges. (æ æ³ç¨ root æéæ§è¡ docker é©±å¨)\n\nå ä¸ºä¸è½ç¨ root æéå¯å¨ minikubeãå¯¹å½ä»¤æå®ä¸äºåæ°å°±å¯ä»¥äºï¼å½ä»¤æ¹ä¸ºå¦ä¸ï¼\n\n minikube start --kubernetes-version=v1.23.3 --driver=docker --container-runtime=containerd --image-mirror-country=cn --force\n\n\n1\n\n\n> åèåå®¢\n\nç°å¨kuberneteséç¾¤å°±å·²ç»å¨æä»¬æ¬å°è¿è¡äºï¼ä½ å¯ä»¥ä½¿ç¨ minikube statusã minikube node list è¿ä¸¤ä¸ªå½ä»¤æ¥æ¥çéç¾¤çç¶æï¼\n\nminikube status\nminikube node list\n\n\n1\n2\n\n\n\n# å¨kuberneteséè¿è¡ä¸ä¸ªnginxåºç¨\n\nå½ä»¤ä¸dockerä¸æ ·ï¼ä¹æ¯ runï¼ä¸è¿å½¢å¼ä¸æç¹åºå«ï¼éè¦ç¨ --image æå®éå**ï¼ç¶åkubernetesä¼èªå¨æåå¹¶è¿è¡ï¼\n\nkubectl run ngx --image=nginx:alpine\n\n\n1\n\n\nè¿éæ¶åkuberneteséçä¸ä¸ªéå¸¸éè¦çæ¦å¿µï¼ podï¼ä½ å¯ä»¥ææ¶æå®çè§£ææ¯âç©¿äºé©¬ç²âçå®¹å¨ï¼æ¥çpodåè¡¨éè¦ä½¿ç¨å½ä»¤ kubectl get podï¼å®çææç±»ä¼¼ docker psã\n\nkubectlçç¨æ³ä¸dockerç±»ä¼¼ï¼ä¹å¯ä»¥æåéåè¿è¡ï¼ä½æä½çä¸æ¯ç®åçå®¹å¨ï¼èæ¯podã\n\n\n# å³äºäºåç\n\næè°çâäºâï¼ç°å¨å°±æçæ¯kubernetesï¼é£ä¹âäºåçâçææå°±æ¯åºç¨çå¼åãé¨ç½²ãè¿ç»´ç­ä¸ç³»åå·¥ä½é½è¦åkubernetesçé½ï¼ä½¿ç¨å®¹å¨ãå¾®æå¡ãå£°æå¼apiç­ææ¯ï¼ä¿è¯åºç¨çæ´ä¸ªçå½å¨æé½è½å¤å¨kubernetesç¯å¢éé¡ºå©å®æ½ï¼ä¸éè¦éå é¢å¤çæ¡ä»¶ã\n\næ¢å¥è¯è¯´ï¼âäºåçâå°±æ¯kuberneteséçâåä½æ°âï¼èä¸æ¯ä»å¶ä»ç¯å¢è¿è¿æ¥çâç§»æ°âã\n\n\n# èªå¨åçè¿ç»´ç®¡çï¼æ¢ç©¶ kubernetes å·¥ä½æºå¶çå¥¥ç§\n\nè¿ä¸èå°±æ¥çä¸ä¸ kubernetes çåé¨æ¶æåå·¥ä½æºå¶ï¼äºè§£å®è½å²è§ç¾¤éçç§å¯æå¨ã\n\n\n# äºè®¡ç®æ¶ä»£çæä½ç³»ç»\n\nkubernetes ç®¡çäºèµæºãæå¡ï¼ä»æç§è§åº¦æ¥çï¼å®å¯ä»¥è¯´æ¯ä¸ä¸ªéç¾¤çº§å«çæä½ç³»ç»ï¼ä¸»è¦åè½å°±æ¯èµæºç®¡çåä½ä¸è°åº¦ãkubernetes è¿ä¸ªæä½ç³»ç»ä¸ linux è¿æä¸ç¹åºå«ä½ å¼å¾æ³¨æãlinux çç¨æ·éå¸¸æ¯ä¸¤ç±»äººï¼dev å opsï¼èå¨ kubernetes éååªæä¸ç±»äººï¼devopsã\n\n> ç±äºäºåççå´èµ·ï¼å¼åäººåä»ä¸å¼å§å°±å¿é¡»èèåç»­çé¨ç½²è¿ç»´å·¥ä½ï¼èè¿ç»´äººåä¹éè¦å¨æ©æä»å¥å¼åï¼æè½åå¥½åºç¨çè¿ç»´çæ§å·¥ä½ã\n\n\n# kubernetesçåºæ¬æ¶æ\n\nkubernetes çæ¶æå¾å¦ä¸å¾æç¤ºï¼\n\nkubernetes éç¨äºç°ä»æµè¡çâæ§å¶é¢/æ°æ®é¢âï¼control plane / data planeï¼æ¶æï¼éç¾¤éçè®¡ç®æºè¢«ç§°ä¸ºâèç¹âï¼nodeï¼ï¼å¯ä»¥æ¯å®æºä¹å¯ä»¥æ¯èæºï¼å°éçèç¹ç¨ä½æ§å¶é¢æ¥æ§è¡éç¾¤çç®¡çç»´æ¤å·¥ä½ï¼å¶ä»çå¤§é¨åèç¹é½è¢«åå½æ°æ®é¢ï¼ç¨æ¥è·ä¸å¡åºç¨ã\n\n * control plan çèç¹å«å master nodeï¼ä¸è¬ç®ç§° masterï¼å¯ä»¥è¯´æ¯ kubernetes çå¤§èåå¿èã\n * data plan çèç¹å«å worker nodeï¼ä¸è¬ç®ç§° worker æ nodeï¼ç¸å½äº kubernetes çæåèï¼å¨ master çææ¥ä¸å¹²æ´»ã\n\nnode çæ°ééå¸¸å¤ï¼ææäºä¸ä¸ªèµæºæ± ï¼kubernetes å°±å¨è¿ä¸ªæ± éåéèµæºï¼è°åº¦åºç¨ãå ä¸ºèµæºè¢«âæ± åâäºï¼æä»¥ç®¡çä¹å°±åå¾æ¯è¾ç®åï¼å¯ä»¥å¨éç¾¤ä¸­ä»»ææ·»å æèå é¤èç¹ã\n\nå¨è¿å¼ æ¶æå¾éï¼æä»¬è¿å¯ä»¥çå°æä¸ä¸ª kubectlï¼å®å°±æ¯ kubernetes çå®¢æ·ç«¯å·¥å·ï¼ç¨æ¥æä½ kubernetesï¼ä½å®ä½äºéç¾¤ä¹å¤ï¼çè®ºä¸ä¸å±äºéç¾¤ãå¯ä»¥ä½¿ç¨å½ä»¤ kubectl get node æ¥æ¥ç k8s çèç¹ç¶æï¼\n\n$ kubectl get node\nname       status   roles                  age   version\nminikube   ready    control-plane,master   93m   v1.23.3\n\n\n1\n2\n3\n\n\nå¯ä»¥çå°å½åç minikube éç¾¤éåªæä¸ä¸ª masterï¼é£ node æä¹ä¸è§äºï¼è¿æ¯å ä¸º master å node çååä¸æ¯ç»å¯¹çãå½éç¾¤çè§æ¨¡è¾å°ï¼å·¥ä½è´è½½è¾å°çæ¶åï¼master ä¹å¯ä»¥æ¿æ node çå·¥ä½ï¼å°±åæä»¬æ­å»ºç minikube ç¯å¢ï¼å®å°±åªæä¸ä¸ªèç¹ï¼è¿ä¸ªèç¹æ¢æ¯ master åæ¯ nodeã\n\n\n# èç¹åé¨çç»æ\n\nkubernetesçèç¹åé¨ä¹å·æå¤æçç»æï¼æ¯ç±å¾å¤çæ¨¡åææçï¼è¿äºæ¨¡ååå¯ä»¥åæç»ä»¶ï¼componentï¼åæä»¶ï¼addonï¼ä¸¤ç±»ã\n\n * ç»ä»¶å®ç°äºkubernetesçæ ¸å¿åè½ç¹æ§ï¼æ²¡æè¿äºç»ä»¶kuberneteså°±æ æ³å¯å¨\n * æä»¶åæ¯kubernetesçä¸äºéå åè½ï¼å±äºâé¦ä¸æ·»è±âï¼ä¸å®è£ä¹ä¸ä¼å½±åkubernetesçæ­£å¸¸è¿è¡ã\n\n# (1) masteréçç»ä»¶æåªäº\n\nmasteréæ4ä¸ªç»ä»¶ï¼åå«æ¯ apiserverã etcdã schedulerã controller-managerã\n\n * apiserverï¼æ´ä¸ª kubernetes ç³»ç»çå¯ä¸å¥å£ï¼å®å¯¹å¤å¬å¼äºä¸ç³»åç restful apiï¼å¹¶ä¸å ä¸äºéªè¯ãææç­åè½ï¼ææå¶ä»ç»ä»¶é½åªè½åå®ç´æ¥éä¿¡ï¼å¯ä»¥è¯´æ¯ kubernetes éçèç»åã\n * etcdï¼ä¸ä¸ªé«å¯ç¨ç kv æ°æ®åºï¼ç¨æ¥æä¹åå­å¨ç³»ç»éçåç§èµæºå¯¹è±¡åç¶æãæ³¨æå®åªä¸ apiserver æç´æ¥èç³»ï¼ä¹å°±æ¯è¯´ä»»ä½å¶ä»ç»ä»¶æ³è¦è¯»å etcd éçæ°æ®é½å¿é¡»ç»è¿ apiserverã\n * schedulerï¼è´è´£å®¹å¨çç¼æå·¥ä½ï¼æ£æ¥èç¹çèµæºç¶æï¼æ pod è°åº¦å°æéåçèç¹ä¸è¿è¡ï¼ç¸å½äºé¨ç½²äººåãå ä¸ºèç¹ç¶æå pod ä¿¡æ¯é½å­å¨å¨ etcd éï¼æä»¥ scheduler å¿é¡»éè¿ apiserver æè½è·å¾ã\n * controller-managerï¼è´è´£ç»´æ¤å®¹å¨åèç¹ç­èµæºçç¶æï¼å®ç°æéæ£æµãæå¡è¿ç§»ãåºç¨ä¼¸ç¼©ç­åè½ï¼ç¸å½äºçæ§è¿ç»´äººåãåæ ·å°ï¼å®ä¹å¿é¡»éè¿ apiserver è·å¾å­å¨å¨ etcd éçä¿¡æ¯ï¼æè½å¤å®ç°å¯¹èµæºçåç§æä½ã\n\n> api å¯¹è±¡å°±è¢« apiserver å­å¨å¨æ°æ®åº etcd éï¼ç¶å kubeletãschedulerãcontroller-manager ç­ç»ä»¶éè¿ apiserver æ¥æä½å®ä»¬ï¼å°±å¨apiå¯¹è±¡è¿ä¸ªæ½è±¡å±æ¬¡å®ç°äºå¯¹æ´ä¸ªéç¾¤çç®¡çã\n\nè¿4ä¸ªç»ä»¶ä¹é½è¢«å®¹å¨åäºï¼è¿è¡å¨éç¾¤ç pod éï¼æä»¬å¯ä»¥ç¨ kubectl æ¥æ¥çå®ä»¬çç¶æï¼ä½¿ç¨å½ä»¤ï¼\n\n\n\n\n\nÂ \nÂ \nÂ \n\nÂ \n\n\n\n$ kubectl get pod -n kube-system\nname                               ready   status             restarts   age\ncoredns-64897985d-64hv8            1/1     running            0          100m\netcd-minikube                      1/1     running            0          100m\nkube-apiserver-minikube            1/1     running            0          100m\nkube-controller-manager-minikube   1/1     running            0          100m\nkube-proxy-r2b4g                   1/1     running            0          100m\nkube-scheduler-minikube            1/1     running            0          100m\nstorage-provisioner                0/1     imagepullbackoff   0          100m\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# (2) node éçç»ä»¶æåªäºï¼\n\nmasteréçapiserverãschedulerç­ç»ä»¶éè¦è·åèç¹çåç§ä¿¡æ¯æè½å¤ä½åºç®¡çå³ç­ï¼é£è¿äºä¿¡æ¯è¯¥æä¹æ¥å¢ï¼è¿å°±éè¦nodeéç3ä¸ªç»ä»¶äºï¼åå«æ¯ kubeletãkube-proxyãcontainer-runtimeï¼\n\n * kubeletï¼node çä»£çï¼è´è´£ç®¡ç node ç¸å³çç»å¤§é¨åæä½ï¼node ä¸åªæå®è½å¤ä¸ apiserver éä¿¡ï¼å®ç°ç¶ææ¥åãå½ä»¤ä¸åãå¯åå®¹å¨ç­åè½ï¼ç¸å½äºæ¯ node ä¸çä¸ä¸ªâå°ç®¡å®¶âã\n * kube-proxyï¼node çç½ç»ä»£çï¼åªè´è´£ç®¡çå®¹å¨çç½ç»éä¿¡ï¼ç®åæ¥è¯´å°±æ¯ä¸º pod è½¬å tcp/udp æ°æ®åï¼ç¸å½äºæ¯ä¸èçâå°é®å·®âã\n * container-runtimeï¼å®æ¯å®¹å¨åéåçå®éä½¿ç¨èï¼éå¸¸ä¸º dockerï¼å¨ kubelet çææ¥ä¸åå»ºå®¹å¨ï¼ç®¡ç pod ççå½å¨æï¼æ¯çæ­£å¹²æ´»çâè¦åâã\n\n> æä»¬ä¸å®è¦æ³¨æï¼å ä¸º kubernetes çå®ä½æ¯å®¹å¨ç¼æå¹³å°ï¼æä»¥å®æ²¡æéå® container-runtime å¿é¡»æ¯ dockerï¼å®å¨å¯ä»¥æ¿æ¢æä»»ä½ç¬¦åæ åçå¶ä»å®¹å¨è¿è¡æ¶ï¼ä¾å¦ containerdãcri-o ç­ç­ï¼åªä¸è¿å¨è¿éæä»¬ä½¿ç¨çæ¯ dockerã\n\nè¿3ä¸ªç»ä»¶ä¸­åªæ kube-proxy è¢«å®¹å¨åäºï¼è kubelet å ä¸ºå¿é¡»è¦ç®¡çæ´ä¸ªèç¹ï¼å®¹å¨åä¼éå¶å®çè½åï¼æä»¥å®å¿é¡»å¨ container-runtime ä¹å¤è¿è¡ã\n\nä½¿ç¨ minikube ssh å½ä»¤ç»å½å°èç¹åï¼å¯ä»¥ç¨ docker ps çå° kube-proxyï¼\n\nÂ \n\n\nÂ \n\n\n\n\n$ minikube ssh\nlast login: sat apr 22 11:43:55 2023 from 192.168.49.1\n\ndocker@minikube:~$ docker ps | grep kube-proxy\n2089b7b713b1   9b7cc9982109           "/usr/local/bin/kubeâ¦"   2 hours ago      up 2 hours                k8s_kube-proxy_kube-proxy-r2b4g_kube-system_86dd0c2b-f392-4327-82b8-32422e441a75_0\n4d3598fc2131   k8s.gcr.io/pause:3.6   "/pause"                 2 hours ago      up 2 hours                k8s_pod_kube-proxy-r2b4g_kube-system_86dd0c2b-f392-4327-82b8-32422e441a75_0\n\n\n1\n2\n3\n4\n5\n6\n\n\n> ????????????ä¸ºå¥ææ§è¡è¿ä¸ªæé®é¢ï¼ï¼ï¼ï¼ï¼\n\nè kubelet ç¨ docker ps æ¯æ¾ä¸å°çï¼éè¦ç¨æä½ç³»ç»ç ps å½ä»¤ï¼\n\nps -ef | grep kubelet\n\n\n1\n\n\nç°å¨ï¼æä»¬åæ node éçç»ä»¶å master éçç»ä»¶æ¾å¨ä¸èµ·æ¥çï¼å°±è½å¤æç½ kubernetes çå¤§è´å·¥ä½æµç¨äºï¼\n\n * æ¯ä¸ª node ä¸ç kubelet ä¼å®æå apiserver ä¸æ¥èç¹ç¶æï¼apiserver åå­å° etcd éã\n * æ¯ä¸ª node ä¸ç kube-proxy å®ç°äº tcp/udp ååä»£çï¼è®©å®¹å¨å¯¹å¤æä¾ç¨³å®çæå¡ã\n * scheduler éè¿ apiserver å¾å°å½åçèç¹ç¶æï¼è°åº¦ podï¼ç¶å apiserver ä¸åå½ä»¤ç»æä¸ª node ç kubeletï¼kubelet è°ç¨ container-runtime å¯å¨å®¹å¨ã\n * controller-manager ä¹éè¿ apiserver å¾å°å®æ¶çèç¹ç¶æï¼çæ§å¯è½çå¼å¸¸æåµï¼åä½¿ç¨ç¸åºçææ®µå»è°èæ¢å¤ã\n\nå¶å®ï¼è¿åæä»¬å¨ kubernetes åºç°ä¹åçæä½æµç¨ä¹å·®ä¸äºå¤å°ï¼ä½ kubernetes çé«æä¹å¤å°±å¨äºæè¿äºé½æ½è±¡åè§èåäºãäºæ¯ï¼è¿äºç»ä»¶å°±å¥½åæ¯æ æ°ä¸ªä¸ç¥ç²å¦çè¿ç»´å·¥ç¨å¸ï¼æååç¹çä½æçäººåå·¥ä½æ¬è¿äºé«æçè®¡ç®æºéï¼å°±è½å¤éæ¶åç°éç¾¤éçåååå¼å¸¸ï¼åäºç¸åä½ï¼ç»´æ¤éç¾¤çå¥åº·ç¶æã\n\n# (3) æä»¶ï¼addonsï¼æåªäºï¼\n\nåªè¦æå¡å¨èç¹ä¸è¿è¡äº apiserverãschedulerãkubeletãkube-proxyãcontainer-runtime ç­ç»ä»¶ï¼å°±å¯ä»¥è¯´æ¯ä¸ä¸ªåè½é½å¨ç kubernetes éç¾¤äºã\n\nä¸è¿å°±ålinuxä¸æ ·ï¼æä½ç³»ç»æä¾çåºç¡åè½è½ç¶âå¯ç¨âï¼ä½æ³è¾¾å°âå¥½ç¨âçç¨åº¦ï¼è¿æ¯è¦åå®è£ä¸äºéå åè½ï¼è¿å¨kuberneteséå°±æ¯æä»¶ï¼addonï¼ãç±äºkubernetesæ¬èº«çè®¾è®¡éå¸¸çµæ´»ï¼æä»¥å°±æå¤§éçæä»¶ç¨æ¥æ©å±ãå¢å¼ºå®å¯¹åºç¨åéç¾¤çç®¡çè½åã\n\nminikubeä¹æ¯æå¾å¤çæä»¶ï¼ä½¿ç¨å½ä»¤ minikube addons list å°±å¯ä»¥æ¥çæä»¶åè¡¨ï¼\n\næä»¶ä¸­æä¸ªäººè®¤ä¸ºæ¯è¾éè¦çæä¸¤ä¸ªï¼dns å dashboardã\n\n * dns å¨ kubernetes éç¾¤éå®ç°äºååè§£ææå¡ï¼è½å¤è®©æä»¬ä»¥ååèä¸æ¯ ip å°åçæ¹å¼æ¥äºç¸éä¿¡ï¼æ¯æå¡åç°åè´è½½åè¡¡çåºç¡ãç±äºå®å¯¹å¾®æå¡ãæå¡ç½æ ¼ç­æ¶æè³å³éè¦ï¼æä»¥åºæ¬ä¸æ¯ kubernetes çå¿å¤æä»¶ã\n * dashboard å°±æ¯ä»ªè¡¨çï¼ä¸º kubernetes æä¾äºä¸ä¸ªå¾å½¢åçæä½çé¢ï¼éå¸¸ç´è§åå¥½ï¼è½ç¶å¤§å¤æ° kubernetes å·¥ä½é½æ¯ä½¿ç¨å½ä»¤è¡ kubectlï¼ä½æçæ¶åå¨ dashboard ä¸æ¥çä¿¡æ¯ä¹æ¯æºæ¹ä¾¿çã\n\nä½ åªè¦å¨ minikube ç¯å¢éæ§è¡ä¸æ¡ç®åçå½ä»¤ï¼å°±å¯ä»¥èªå¨ç¨æµè§å¨æå¼ dashboard é¡µé¢ï¼èä¸è¿æ¯æä¸­æï¼\n\nminikube dashboard\n\n\n1\n\n\n\n# å°ç»\n\nå°ç»ä¸ä¸è¿ä¸èçè¦ç¹ï¼\n\n 1. kubernetes è½å¤å¨éç¾¤çº§å«ç®¡çåºç¨åæå¡å¨ï¼å¯ä»¥è®¤ä¸ºæ¯ä¸ç§éç¾¤æä½ç³»ç»ãå®ä½¿ç¨âæ§å¶é¢/æ°æ®é¢âçåºæ¬æ¶æï¼master èç¹å®ç°ç®¡çæ§å¶åè½ï¼worker èç¹è¿è¡å·ä½ä¸å¡ã\n 2. kubernetes ç±å¾å¤æ¨¡åç»æï¼å¯åä¸ºæ ¸å¿çç»ä»¶åééçæä»¶ä¸¤ç±»ã\n 3. master éæ 4 ä¸ªç»ä»¶ï¼åå«æ¯ apiserverãetcdãschedulerãcontroller-managerã\n 4. node éæ 3 ä¸ªç»ä»¶ï¼åå«æ¯ kubeletãkube-proxyãcontainer-runtimeã\n 5. éå¸¸å¿å¤çæä»¶æ dns å dashboardã\n\nè¯¾å¤å°è´´å£«ï¼\n\n * ä¸ºç¡®ä¿æ§å¶é¢çé«å¯ç¨ï¼kubernetes éç¾¤éé½ä¼é¨ç½²å¤ä¸ª master èç¹ï¼æ°éä¸è¬ä¼æ¯å¥æ° (3/5/7)ï¼è¿æ¯ç± etcd çç¹æ§å³å®çã\n * etcd ç± coreos å¬å¸å¼åï¼åºäºç±» paxos ç raft ç®æ³å®ç°æ°æ®ä¸è´æ§ã\n * controller-manager æ¯å¾å¤ä¸ª controller çéåä½æ¯ä¸ä¸ª controller è´è´£ä¸ç§æ§å¶å¾ªç¯ (å¦ node con-trollerãnamespace controller)ï¼ä½ä¸ºäºç®åè¢«åå¹¶å¨ä¸ä¸ªè¿ç¨éæ§è¡ã\n * minikube ç dashboard åªåè®¸å¨æ¬æºè¿è¡çæµè§å¨è®¿é®ï¼ä¸è¿ä½ ä¹å¯ä»¥ç»å®éç½® nginx ååä»£çã',charsets:{cjk:!0},lastUpdated:"2023/06/09, 05:49:53",lastUpdatedTimestamp:1686289793e3},{title:"YAMLãPodãJobãCronJobãConfigMapãSecret",frontmatter:{title:"YAMLãPodãJobãCronJobãConfigMapãSecret",date:"2023-06-06T21:10:06.000Z",permalink:"/pages/c0d84b/",categories:["åºç¡","äºåç","Kuberneteså¥é¨å®æè¯¾-ç½åé"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/20.%E4%BA%91%E5%8E%9F%E7%94%9F/15.Kubernetes%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98%E8%AF%BE-%E7%BD%97%E5%89%91%E9%94%8B/11.YAML%E3%80%81Pod%E3%80%81Job%E3%80%81CronJob%E3%80%81ConfigMap%E3%80%81Secret.html",relativePath:"åºç¡/20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/11.YAMLãPodãJobãCronJobãConfigMapãSecret.md",key:"v-ac009106",path:"/pages/c0d84b/",headers:[{level:2,title:"1. YAMLï¼Kubernetesä¸çéçéç¨è¯­",slug:"_1-yaml-kubernetesä¸çéçéç¨è¯­",normalizedTitle:"1. yamlï¼kubernetesä¸çéçéç¨è¯­",charIndex:2},{level:3,title:"1.1 å£°æå¼ä¸å½ä»¤å¼æ¯æä¹åäº",slug:"_1-1-å£°æå¼ä¸å½ä»¤å¼æ¯æä¹åäº",normalizedTitle:"1.1 å£°æå¼ä¸å½ä»¤å¼æ¯æä¹åäº",charIndex:61},{level:3,title:"1.2 ä»ä¹æ¯ YAML",slug:"_1-2-ä»ä¹æ¯-yaml",normalizedTitle:"1.2 ä»ä¹æ¯ yaml",charIndex:846},{level:3,title:"1.3 ä»ä¹æ¯ API å¯¹è±¡",slug:"_1-3-ä»ä¹æ¯-api-å¯¹è±¡",normalizedTitle:"1.3 ä»ä¹æ¯ api å¯¹è±¡",charIndex:1006},{level:3,title:"1.4 å¦ä½æè¿°APIå¯¹è±¡",slug:"_1-4-å¦ä½æè¿°apiå¯¹è±¡",normalizedTitle:"1.4 å¦ä½æè¿°apiå¯¹è±¡",charIndex:1927},{level:3,title:"1.5 å¦ä½ç¼å YAML",slug:"_1-5-å¦ä½ç¼å-yaml",normalizedTitle:"1.5 å¦ä½ç¼å yaml",charIndex:3846},{level:3,title:"1.6 è¯¾å¤å°è´´å£«",slug:"_1-6-è¯¾å¤å°è´´å£«",normalizedTitle:"1.6 è¯¾å¤å°è´´å£«",charIndex:5164},{level:2,title:"2. Podï¼å¦ä½çè§£è¿ä¸ªKuberneteséææ ¸å¿çæ¦å¿µï¼",slug:"_2-pod-å¦ä½çè§£è¿ä¸ªkuberneteséææ ¸å¿çæ¦å¿µ",normalizedTitle:"2. podï¼å¦ä½çè§£è¿ä¸ªkuberneteséææ ¸å¿çæ¦å¿µï¼",charIndex:5447},{level:3,title:"2.1 ä¸ºä»ä¹è¦æ Pod",slug:"_2-1-ä¸ºä»ä¹è¦æ-pod",normalizedTitle:"2.1 ä¸ºä»ä¹è¦æ pod",charIndex:5483},{level:2,title:"3. Job/CronJobï¼ä¸ºä»ä¹ä¸ç´æ¥ç¨Podæ¥å¤çä¸å¡ï¼",slug:"_3-job-cronjob-ä¸ºä»ä¹ä¸ç´æ¥ç¨podæ¥å¤çä¸å¡",normalizedTitle:"3. job/cronjobï¼ä¸ºä»ä¹ä¸ç´æ¥ç¨podæ¥å¤çä¸å¡ï¼",charIndex:5770},{level:3,title:"3.1 ä¸ºä»ä¹ä¸ç´æ¥ä½¿ç¨Pod",slug:"_3-1-ä¸ºä»ä¹ä¸ç´æ¥ä½¿ç¨pod",normalizedTitle:"3.1 ä¸ºä»ä¹ä¸ç´æ¥ä½¿ç¨pod",charIndex:6146},{level:3,title:"å°ç»",slug:"å°ç»",normalizedTitle:"å°ç»",charIndex:6166},{level:2,title:"4. ConfigMap/Secretï¼ææ ·éç½®ãå®å¶æçåºç¨",slug:"_4-configmap-secret-ææ ·éç½®ãå®å¶æçåºç¨",normalizedTitle:"4. configmap/secretï¼ææ ·éç½®ãå®å¶æçåºç¨",charIndex:6701},{level:3,title:"4.1 ConfigMap/Secret",slug:"_4-1-configmap-secret",normalizedTitle:"4.1 configmap/secret",charIndex:6853},{level:4,title:"4.1.1 ä»ä¹æ¯ConfigMap",slug:"_4-1-1-ä»ä¹æ¯configmap",normalizedTitle:"4.1.1 ä»ä¹æ¯configmap",charIndex:7118},{level:4,title:"4.1.2 ä»ä¹æ¯Secret",slug:"_4-1-2-ä»ä¹æ¯secret",normalizedTitle:"4.1.2 ä»ä¹æ¯secret",charIndex:8035},{level:3,title:"4.2 å¦ä½ä½¿ç¨",slug:"_4-2-å¦ä½ä½¿ç¨",normalizedTitle:"4.2 å¦ä½ä½¿ç¨",charIndex:9341},{level:4,title:"4.2.1 ä»¥ç¯å¢åéçæ¹å¼ä½¿ç¨",slug:"_4-2-1-ä»¥ç¯å¢åéçæ¹å¼ä½¿ç¨",normalizedTitle:"4.2.1 ä»¥ç¯å¢åéçæ¹å¼ä½¿ç¨",charIndex:9353},{level:4,title:"4.2.2 ä»¥Volumeçæ¹å¼ä½¿ç¨",slug:"_4-2-2-ä»¥volumeçæ¹å¼ä½¿ç¨",normalizedTitle:"4.2.2 ä»¥volumeçæ¹å¼ä½¿ç¨",charIndex:11096},{level:3,title:"4.3 å°ç»",slug:"_4-3-å°ç»",normalizedTitle:"4.3 å°ç»",charIndex:12819}],headersStr:"1. YAMLï¼Kubernetesä¸çéçéç¨è¯­ 1.1 å£°æå¼ä¸å½ä»¤å¼æ¯æä¹åäº 1.2 ä»ä¹æ¯ YAML 1.3 ä»ä¹æ¯ API å¯¹è±¡ 1.4 å¦ä½æè¿°APIå¯¹è±¡ 1.5 å¦ä½ç¼å YAML 1.6 è¯¾å¤å°è´´å£« 2. Podï¼å¦ä½çè§£è¿ä¸ªKuberneteséææ ¸å¿çæ¦å¿µï¼ 2.1 ä¸ºä»ä¹è¦æ Pod 3. Job/CronJobï¼ä¸ºä»ä¹ä¸ç´æ¥ç¨Podæ¥å¤çä¸å¡ï¼ 3.1 ä¸ºä»ä¹ä¸ç´æ¥ä½¿ç¨Pod å°ç» 4. ConfigMap/Secretï¼ææ ·éç½®ãå®å¶æçåºç¨ 4.1 ConfigMap/Secret 4.1.1 ä»ä¹æ¯ConfigMap 4.1.2 ä»ä¹æ¯Secret 4.2 å¦ä½ä½¿ç¨ 4.2.1 ä»¥ç¯å¢åéçæ¹å¼ä½¿ç¨ 4.2.2 ä»¥Volumeçæ¹å¼ä½¿ç¨ 4.3 å°ç»",content:'# 1. YAMLï¼Kubernetesä¸çéçéç¨è¯­\n\nKubernetesä¸çéçæ åå·¥ä½è¯­è¨æ¯ YAMLã\n\n\n# 1.1 å£°æå¼ä¸å½ä»¤å¼æ¯æä¹åäº\n\n> YAML æ¯âå£°æå¼âã\n\nDockerå½ä»¤åDockerfileå°±å±äºâå½ä»¤å¼âï¼å¤§å¤æ°ç¼ç¨è¯­è¨ä¹å±äºå½ä»¤å¼ï¼å®çç¹ç¹æ¯äº¤äºæ§å¼ºï¼æ³¨éé¡ºåºåè¿ç¨ï¼ä½ å¿é¡»âåè¯âè®¡ç®æºæ¯æ­¥è¯¥åä»ä¹ï¼ææçæ­¥éª¤é½åæ¸æ¥ï¼è¿æ ·ç¨åºæè½å¤ä¸æ­¥æ­¥èµ°ä¸å»ï¼æåå®æä»»å¡ï¼æ¾å¾è®¡ç®æºæç¹âç¬¨âã\n\nâå£°æå¼âï¼å¨Kubernetesåºç°ä¹åæ¯è¾å°è§ï¼å®ä¸âå½ä»¤å¼âå®å¨ç¸åï¼ä¸å³å¿å·ä½çè¿ç¨ï¼æ´æ³¨éç»æãæä»¬ä¸éè¦âæâè®¡ç®æºè¯¥æä¹åï¼åªè¦åè¯å®ä¸ä¸ªç®æ ç¶æï¼å®èªå·±å°±ä¼æ³åæ³å»å®æä»»å¡ï¼ç¸æ¯èµ·æ¥èªå¨åãæºè½åç¨åº¦æ´é«ã\n\nä»¥âæè½¦âæ¥å½¢è±¡å°è§£éä¸ä¸âå½ä»¤å¼âåâå£°æå¼âçåºå«ã\n\n * åè®¾ä½ è¦æè½¦å»é«éç«ï¼ä½å¸æºä¸çæè·¯åµï¼ä½ å°±åªå¥½ä¸åå¶ç¦å°åè¯ä»è¯¥èµ°åªæ¡è·¯ãå¨åªä¸ªè·¯å£è½¬åãå¨åªéè¿åºä¸»è·¯ãååªä¸ªç«å£ãè½ç¶æåå°è¾¾äºç®çå°ï¼ä½è¿ä¸è·¯ä¸ä¹è´¹äºå¾å¤å£èï¼ååºäºæ æ°çâå½ä»¤âãå¾æ¾ç¶ï¼è¿æ®µè·¯ç¨å°±å±äºâå½ä»¤å¼âã\n * åæ ·æ¯å»é«éç«ï¼ä½å¸æºç»éªä¸°å¯ï¼ä»ç¥éåªéææ¥å µãåªæ¡è·¯ççº¢ç»¿ç¯å¤ãåªæ®µè·¯æä¸´æ¶ç®¡æ§ãåªéå¯ä»¥æå°éï¼æ­¤æ¶ä½ åå¤å´æ çä¼å¹²æ°ä»çæ­£å¸¸é©¾é©¶ï¼æä»¥ï¼ä½ åªè¦ç»ä»ä¸ä¸ªâå£°æâï¼æè¦å»é«éç«ï¼æ¥ä¸æ¥å°±å¯ä»¥èèææå°èººå¨ååº§ä¸ä¼æ¯ï¼é¡ºå©å°è¾¾ç®çå°äº\n\nå¨è¿ä¸ªâæè½¦âçä¾å­éï¼Kuberneteså°±æ¯è¿æ ·çä¸ä½çç»çå¸æºï¼Master/Nodeæ¶æè®©å®å¯¹æ´ä¸ªéç¾¤çç¶æäºå¦ææï¼åé¨çä¼å¤ç»ä»¶åæä»¶ä¹è½å¤èªå¨çæ§ç®¡çåºç¨ãæä»¬æå¥½æ¯åä¸ä¸ªâ ç©æææâï¼ç¨âå£°æå¼âæä»»å¡çç®æ åè¯å®ï¼æ¯å¦ä½¿ç¨åªä¸ªéåãä»ä¹æ¶åè¿è¡ï¼è®©å®èªå·±å»å¤çæ§è¡è¿ç¨ä¸­çç»èã\n\né£ä¹ï¼YAML è¯­è¨å°±æ¯ç» Kubernetes ååºä¸ä¸ªâå£°æâçæ¹å¼ã\n\n> å®¹å¨ææ¯éçShellèæ¬åDockerfileå¯ä»¥å¾å¥½å°æè¿°âå½ä»¤å¼âï¼ä½å¯¹äºâå£°æå¼âå°±ä¸å¤ªåéäº\n\n\n# 1.2 ä»ä¹æ¯ YAML\n\n> YAML v.s. XML:\n> \n>  * XML æ¯ä¸ç§ç±»ä¼¼ HTML çæ ç­¾å¼è¯­è¨ï¼æå¾å¤ç¹æç¼èã\n>  * YAML å®è´¨ä¸ä¸XMLå®å¨ä¸åï¼æ´éåäººç±»éè¯»ï¼è®¡ç®æºè§£æèµ·æ¥ä¹å¾å®¹æ\n\næYAMLçæ°ç»ãå¯¹è±¡ç»åèµ·æ¥ï¼æä»¬å°±å¯ä»¥æè¿°åºä»»æçKubernetesèµæºå¯¹è±¡ã\n\n\n# 1.3 ä»ä¹æ¯ API å¯¹è±¡\n\nYAMLè¯­è¨åªç¸å½äºâè¯­æ³âï¼è¦ä¸Kuberneteså¯¹è¯ï¼æä»¬è¿å¿é¡»æè¶³å¤çâè¯æ±âæ¥è¡¨ç¤ºâè¯­ä¹âãä½ä¸ºä¸ä¸ªéç¾¤æä½ç³»ç»ï¼Kuberneteså½çº³æ»ç»äºGoogleå¤å¹´çç»éªï¼å¨çè®ºå±é¢æ½è±¡åºäºå¾å¤ä¸ªæ¦å¿µï¼ç¨æ¥æè¿°ç³»ç»çç®¡çè¿ç»´å·¥ä½ï¼è¿äºæ¦å¿µå°±å«åâ APIå¯¹è±¡âã\n\nè¯´å°è¿ä¸ªåå­ï¼ä½ ä¹è®¸ä¼èæ³å°ä¸æ¬¡è¯¾éè®²å°çKubernetesç»ä»¶ apiserverãæ²¡éï¼å®æ­£æ¯æ¥æºäºæ­¤ãå ä¸ºapiserveræ¯Kubernetesç³»ç»çå¯ä¸å¥å£ï¼å¤é¨ç¨æ·ååé¨ç»ä»¶é½å¿é¡»åå®éä¿¡ï¼èå®éç¨äºHTTPåè®®çURLèµæºçå¿µï¼APIé£æ ¼ä¹ç¨RESTfulçGET/POST/DELETEç­ç­ï¼æä»¥ï¼è¿äºæ¦å¿µå¾èªç¶å°å°±è¢«ç§°ä¸ºæ¯âAPIå¯¹è±¡âäºã\n\né£é½æåªäºAPIå¯¹è±¡å¢ï¼\n\nä½¿ç¨ kubectl api-resources æ¥æ¥çå½åKubernetesçæ¬æ¯æçææå¯¹è±¡ï¼\n\nkubectl api-resources\n\n\n1\n\n\nå¨è¾åºçâNAMEâä¸æ ï¼å°±æ¯å¯¹è±¡çåå­ï¼æ¯å¦ConfigMapãPodãServiceç­ç­ï¼ç¬¬äºæ âSHORTNAMESâåæ¯è¿ç§èµæºçç®åï¼å¨æä»¬ä½¿ç¨kubectlå½ä»¤çæ¶åå¾æç¨ï¼å¯ä»¥å°æ²å æ¬¡é®çï¼æ¯å¦Podå¯ä»¥ç®åæpoï¼Serviceå¯ä»¥ç®åæsvcã\n\nå¨ä½¿ç¨kubectlå½ä»¤çæ¶åï¼ä½ è¿å¯ä»¥å ä¸ä¸ä¸ªåæ° --v=9ï¼å®ä¼æ¾ç¤ºåºè¯¦ç»çå½ä»¤æ§è¡è¿ç¨ï¼æ¸æ¥å°çå°ååºçHTTPè¯·æ±ï¼æ¯å¦ï¼\n\nkubectl get pod --v=9\n\n\n1\n\n\nä»æªå¾éå¯ä»¥çå°ï¼kubectlå®¢æ·ç«¯ç­ä»·äºè°ç¨äºcurlï¼å8443ç«¯å£åéäºHTTP GET è¯·æ±ï¼URLæ¯ /api/v1/namespaces/default/podsã\n\nç®åçKubernetes 1.23çæ¬æ50å¤ç§APIå¯¹è±¡ï¼å¨é¢å°æè¿°äºéç¾¤çèç¹ãåºç¨ãéç½®ãæå¡ãè´¦å·ç­ç­ä¿¡æ¯ï¼apiserverä¼æå®ä»¬é½å­å¨å¨æ°æ®åºetcdéï¼ç¶åkubeletãschedulerãcontroller-managerç­ç»ä»¶éè¿apiserveræ¥æä½å®ä»¬ï¼å°±å¨APIå¯¹è±¡è¿ä¸ªæ½è±¡å±æ¬¡å®ç°äºå¯¹æ´ä¸ªéç¾¤çç®¡çã\n\n\n# 1.4 å¦ä½æè¿°APIå¯¹è±¡\n\n> Kubernetesæéç¾¤éçä¸åèµæºé½å®ä¹ä¸ºAPIå¯¹è±¡ï¼éè¿RESTfulæ¥å£æ¥ç®¡çãæè¿°APIå¯¹è±¡éè¦ä½¿ç¨YAMLè¯­è¨ï¼å¿é¡»çå­æ®µæ¯ apiVersionãkindãmetadataã\n\nä¹åæä»¬ä½¿ç¨ kubectl è¿è¡ nginx çå½ä»¤ç¨çæ¯å½ä»¤å¼ç kubectl runï¼\n\nkubectl run ngx --image=nginx:alpine\n\n\n1\n\n\nä¸é¢çä¸ä¸å¦ä½ä»¥ YAML è¯­è¨æ¥å£°æå¼å°å¨ k8s ä¸­æè¿°å¹¶åå»º API å¯¹è±¡ãå¨ YAML ä¸­ï¼æä»¬éè¦è¯´æ¸æ¥æä»¬çç®æ ç¶æï¼è®© Kubernetes èªå·±å»å³å®å¦ä½æåéåå¹¶è¿è¡ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: ngx-pod\n  labels:\n    env: demo\n    owner: nrich\n\nspec:\n  containers:\n  - image: nginx:alpine\n    name: ngx\n    ports:\n    - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå¯ä»¥çåºï¼è¿éæ¯åå»ºä¸ä¸ª podï¼è¦ä½¿ç¨ nginx:alpine ç image æ¥åå»ºä¸ä¸ª containerï¼å¹¶å¼æ¾ 80 ç«¯å£ï¼èå¶ä»é¨åå°±æ¯ k8s å¯¹ API å¯¹è±¡å¼ºå¶çæ ¼å¼è¦æ±äºã\n\nå ä¸ºAPIå¯¹è±¡éç¨æ åç HTTP åè®®ï¼ä¸ºäºæ¹ä¾¿çè§£ï¼æä»¬å¯ä»¥åé´ä¸ä¸ HTTP çæ¥ææ ¼å¼ï¼æ API å¯¹è±¡çæè¿°åæâheaderâåâbodyâä¸¤é¨åã\n\nheader åå«çæ¯ API å¯¹è±¡çåºæ¬ä¿¡æ¯ï¼æä¸ä¸ªå­æ®µï¼\n\n * apiVersionï¼è¡¨ç¤ºæä½è¿ç§èµæºç API çæ¬å·ï¼ç±äº Kubernetes çè¿­ä»£éåº¦å¾å¿«ï¼ä¸åççæ¬åå»ºçå¯¹è±¡ä¼æå·®å¼ï¼ä¸ºäºåºåè¿äºçæ¬å°±éè¦ä½¿ç¨ apiVersion è¿ä¸ªå­æ®µï¼æ¯å¦ v1ãv1alpha1ãv1beta1 ç­ç­ã\n * kindï¼è¡¨ç¤ºèµæºå¯¹è±¡çç±»åï¼æ¯å¦ PodãNodeãJobãService ç­ã\n * metadataï¼è¡¨ç¤ºçæ¯èµæºçä¸äºåä¿¡æ¯ï¼ä¹å°±æ¯ç¨æ¥æ è®°å¯¹è±¡ï¼æ¹ä¾¿ Kubernetes ç®¡ççä¸äºä¿¡æ¯ãå¨ä¸é¢çç¤ºä¾ä¸­æä¸¤ä¸ªåä¿¡æ¯ï¼\n   * nameï¼ç» pod èµ·äºä¸ªåå­\n   * labelsï¼ç» pod è´´ä¸ä¸äºä¾¿äºæ¥æ¾çæ ç­¾ï¼åå«æ¯ env å ownerã\n\nä»¥ä¸ä¿¡æ¯é½è¢« kubectl ç¨äºçæ HTTP è¯·æ±åç» apiserverï¼ä½ å¯ä»¥ç¨ --v=9 åæ°å¨è¯·æ±ç URL éçå°å®ä»¬ï¼æ¯å¦ï¼\n\nhttps://192.168.49.2:8443/api/v1/namespaces/default/pods/ngx-pod\n\n\n1\n\n\nheader ä¸­ç apiVersionãkindãmetadata è¿ä¸ä¸ªå­æ®µé½æ¯ä»»ä½å¯¹è±¡é½å¿é¡»æçï¼è body é¨ååä¼ä¸å¯¹è±¡ç¹å®ç¸å³ï¼æ¯ç§å¯¹è±¡ä¼æä¸åçè§æ ¼å®ä¹ï¼å¨ YAML éå°±è¡¨ç°ä¸º spec å­æ®µï¼å³ specificationï¼ï¼è¡¨ç¤ºæä»¬å¯¹å¯¹è±¡çâææç¶æâï¼desired statusï¼ã\n\nè¿æ¯æ¥çè¿ä¸ª Podï¼å®ç spec éå°±æ¯ä¸ä¸ª containers æ°ç»ï¼éé¢çæ¯ä¸ªåç´ åæ¯ä¸ä¸ªå¯¹è±¡ï¼æå®äºåå­ãéåãç«¯å£ç­ä¿¡æ¯ï¼\n\nspec:\n  containers:\n  - image: nginx:alpine\n    name: ngx\n    ports:\n    - containerPort: 80\n\n\n1\n2\n3\n4\n5\n6\n\n\nç°å¨æè¿äºå­æ®µç»¼åèµ·æ¥ï¼æä»¬å°±è½å¤çåºï¼è¿ä»½ YAML ææ¡£å®æ´å°æè¿°äºä¸ä¸ªç±»åæ¯ Pod ç API å¯¹è±¡ï¼è¦æ±ä½¿ç¨ v1 çæ¬ç API æ¥å£å»ç®¡çï¼å¶ä»æ´å·ä½çåç§°ãæ ç­¾ãç¶æç­ç»èé½è®°å½å¨äº metadata å spec å­æ®µç­éã\n\nä½¿ç¨ kubectl applyã kubectl deleteï¼åå ä¸åæ° -fï¼ä½ å°±å¯ä»¥ä½¿ç¨è¿ä¸ª YAML æä»¶ï¼åå»ºæèå é¤å¯¹è±¡äºï¼\n\nkubectl apply -f ngx-pod.yml    # åå»º API å¯¹è±¡\nkubectl delete -f ngx-pod.yml   # å é¤ API å¯¹è±¡\n\n\n1\n2\n\n\nKubernetes æ¶å°è¿ä»½âå£°æå¼âçæ°æ®ï¼åæ ¹æ® HTTP è¯·æ±éç POST/DELETE ç­æ¹æ³ï¼å°±ä¼èªå¨æä½è¿ä¸ªèµæºå¯¹è±¡ï¼è³äºå¯¹è±¡å¨åªä¸ªèç¹ä¸ãæä¹åå»ºãæä¹å é¤å®å¨ä¸ç¨æä»¬æå¿ã\n\n\n# 1.5 å¦ä½ç¼å YAML\n\nè¿ä¹å¤å­æ®µï¼æä»¬ææ ·æè½ç¼åæ­£ç¡®ç YAML å¢ï¼\n\nè¿ä¸ªé®é¢çææå¨çç­æ¡èªç¶æ¯ k8s çå®æ¹ææ¡£ï¼API å¯¹è±¡çææå­æ®µé½å¯ä»¥å¨éé¢æ¾å°ãä½è¿åå®¹å¤ªå¤ï¼ä¸é¢ä»ç»ä¸äºå®ç¨çå°æå·§ã\n\nç¬¬ä¸ä¸ªæå·§å¶å®åé¢å·²ç»è¯´è¿äºï¼å°±æ¯ kubectl api-resources å½ä»¤ï¼å®ä¼æ¾ç¤ºåºèµæºå¯¹è±¡ç¸åºçAPIçæ¬åç±»åï¼æ¯å¦Podççæ¬æ¯âv1âï¼Ingressççæ¬æ¯ânetworking.k8s.io/v1âï¼ç§çå®åç»å¯¹ä¸ä¼éã\n\nç¬¬äºä¸ªæå·§ï¼æ¯å½ä»¤ kubectl explainï¼å®ç¸å½äºæ¯Kubernetesèªå¸¦çAPIææ¡£ï¼ä¼ç»åºå¯¹è±¡å­æ®µçè¯¦ç»è¯´æï¼è¿æ ·æä»¬å°±ä¸å¿å»ç½ä¸æ¥æ¾äºãæ¯å¦æ³è¦çPodéçå­æ®µè¯¥æä¹åï¼å°±å¯ä»¥è¿æ ·ï¼\n\nkubectl explain pod\nkubectl explain pod.metadata\nkubectl explain pod.spec\nkubectl explain pod.spec.containers\n\n\n1\n2\n3\n4\n\n\nä½¿ç¨åä¸¤ä¸ªæå·§ç¼å YAML å°±åºæ¬ä¸æ²¡æé¾åº¦äºã\n\nâ­ï¸ ç¬¬ä¸ä¸ªæå·§å°±æ¯kubectlçä¸¤ä¸ªç¹æ®åæ° --dry-run=client å -o yamlï¼åèæ¯ç©ºè¿è¡ï¼åèæ¯çæYAMLæ ¼å¼ï¼ç»åèµ·æ¥ä½¿ç¨å°±ä¼è®© kubectl ä¸ä¼æå®éçåå»ºå¨ä½ï¼èåªçæ YAML æä»¶ãä¾å¦ï¼æ³è¦çæä¸ä¸ªPodçYAMLæ ·æ¿ç¤ºä¾ï¼å¯ä»¥å¨ kubectl run åé¢å ä¸è¿ä¸¤ä¸ªåæ°ï¼\n\nkubectl run ngx --image=nginx:alpine --dry-run=client -o yaml\n\n\n1\n\n\nå°±ä¼çæä¸ä¸ªç»å¯¹æ­£ç¡®ç YAML æä»¶ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  creationTimestamp: null\n  labels:\n    run: ngx\n  name: ngx\nspec:\n  containers:\n  - image: nginx:alpine\n    name: ngx\n    resources: {}\n  dnsPolicy: ClusterFirst\n  restartPolicy: Always\nstatus: {}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\næ¥ä¸æ¥ä½ è¦åçï¼å°±æ¯æ¥éå¯¹è±¡çè¯´æææ¡£ï¼æ·»å æèå é¤å­æ®µæ¥å®å¶è¿ä¸ª YAML äºã\n\nè¿ä¸ªå°æå·§è¿å¯ä»¥åè¿åä¸ä¸ï¼æè¿æ®µåæ°å®ä¹æShellåéï¼åå­ä»»æï¼æ¯å¦$do/$goï¼è¿éç¨çæ¯ $outï¼ï¼ç¨èµ·æ¥ä¼æ´çäºï¼æ¯å¦ï¼\n\nexport out="--dry-run=client -o yaml"\nkubectl run ngx --image=nginx:alpine $out\n\n\n1\n2\n\n\nä»åé¤äºä¸äºç¹æ®æåµï¼æä»¬é½ä¸ä¼åä½¿ç¨ kubectl run è¿æ ·çå½ä»¤å»ç´æ¥åå»º Podï¼èæ¯ä¼ç¼å YAMLï¼ç¨âå£°æå¼âæ¥æè¿°å¯¹è±¡ï¼åç¨ kubectl apply å»åå¸ YAML æ¥åå»ºå¯¹è±¡ã\n\n\n# 1.6 è¯¾å¤å°è´´å£«\n\n * .æ¨èä¸ä¸ªç¥åç JSON/YAML å·¥å·ç½ç«: BEJSONï¼æ¯æ JSON æ ¼å¼æ ¡éªä¹å¯ä»¥è½¬æ¢ YAMLã\n * Kubernetes ç API çæ¬å½åææç¡®è§èï¼æ­£å¼çæ¬(GAï¼Generally available) æ¯ v1 è¿æ ·ççº¯æ°å­ï¼è¯éªæ§è´¨ãä¸ç¨³å®çæ¯ alpha,æ¯è¾ç¨³å®ãå³å°åå¸çæ¯ betaã\n * å ä¸º Kubernetes çå¼åè¯­è¨æ¯ Goï¼æä»¥ API å¯¹è±¡å­æ®µç¨çé½æ¯ Go è¯­æ³è§èï¼ä¾å¦å­æ®µå½åéµå¾ªâCamel Caseâï¼ç±»åæ¯ booleanãstringã[]Object ç­ã\n\n\n# 2. Podï¼å¦ä½çè§£è¿ä¸ªKuberneteséææ ¸å¿çæ¦å¿µï¼\n\n\n# 2.1 ä¸ºä»ä¹è¦æ Pod\n\nPodè¿ä¸ªè¯åææ¯âè±è±èâï¼åæ¥åå»¶ä¼¸åºâè±å®¤ââå¤ªç©ºè±âç­å«ä¹ï¼å½¢è±¡å°æ¥è¯´Podå°±æ¯åå«äºå¾å¤ç»ä»¶ãæåçä¸ç§ç»æã\n\nä¸ºäºè§£å³å¤åºç¨èåè¿è¡çé®é¢ï¼åæ¶è¿è¦ä¸ç ´åå®¹å¨çéç¦»ï¼å°±éè¦å¨å®¹å¨å¤é¢åå»ºç«ä¸ä¸ªâæ¶çº³è±âï¼è®©å¤ä¸ªå®¹å¨æ¢ä¿æç¸å¯¹ç¬ç«ï¼åè½å¤å°èå´å±äº«ç½ç»ãå­å¨ç­èµæºï¼èä¸æ°¸è¿æ¯âç»å¨ä¸èµ·âçç¶æã\n\næä»¥ï¼åºç°äºPodçæ¦å¿µï¼å®¹å¨æ­£æ¯âè±èâéé£äºå°å°çâè±è±âï¼ä½ å¯ä»¥å¨PodçYAMLéçå°ï¼âspec.containersâå­æ®µå¶å®æ¯ä¸ä¸ªæ°ç»ï¼éé¢åè®¸å®ä¹å¤ä¸ªå®¹å¨ãPod è½è®©è¿ç¨ä½å¾æ´èæã\n\nTODO: å¾è¡¥å\n\n\n# 3. Job/CronJobï¼ä¸ºä»ä¹ä¸ç´æ¥ç¨Podæ¥å¤çä¸å¡ï¼\n\nKubernetesçæ ¸å¿å¯¹è±¡Podï¼ç¨æ¥ç¼æä¸ä¸ªæå¤ä¸ªå®¹å¨ï¼è®©è¿äºå®¹å¨å±äº«ç½ç»ãå­å¨ç­èµæºï¼æ»æ¯å±åè°åº¦ï¼ä»èç´§å¯ååå·¥ä½ãPodæ¯å®¹å¨æ´è½å¤è¡¨ç¤ºå®éçåºç¨ï¼æä»¥Kubernetesä¸ä¼å¨å®¹å¨å±é¢æ¥ç¼æä¸å¡ï¼èæ¯æPodä½ä¸ºå¨éç¾¤éè°åº¦è¿ç»´çæå°åä½ã\n\nåé¢æä»¬ä¹çå°äºä¸å¼ Kubernetesçèµæºå¯¹è±¡å³ç³»å¾ï¼ä»¥Podä¸ºä¸­å¿ï¼å»¶ä¼¸åºäºå¾å¤è¡¨ç¤ºåç§ä¸å¡çå¶ä»èµæºå¯¹è±¡ãé£ä¹ä½ ä¼ä¸ä¼æè¿æ ·ççé®ï¼Podçåè½å·²ç»è¶³å¤å®åäºï¼ä¸ºä»ä¹è¿è¦å®ä¹è¿äºé¢å¤çå¯¹è±¡å¢ï¼ä¸ºä»ä¹ä¸ç´æ¥å¨Podéæ·»å åè½ï¼æ¥å¤çä¸å¡éæ±å¢ï¼\n\nè¿ä¸ªé®é¢ä½ç°äºGoogleå¯¹å¤§è§æ¨¡è®¡ç®éç¾¤ç®¡ççæ·±åº¦æèï¼ä»å¤©æå°±è¯´è¯´KubernetesåºäºPodçè®¾è®¡çå¿µï¼åä»æç®åçä¸¤ç§å¯¹è±¡ââJobåCronJobè®²èµ·ã\n\n\n# 3.1 ä¸ºä»ä¹ä¸ç´æ¥ä½¿ç¨Pod\n\n\n# å°ç»\n\nå¥½äºï¼ä»å¤©æä»¬ä»¥é¢åå¯¹è±¡ææ³åæäºä¸ä¸Kuberneteséçèµæºå¯¹è±¡è®¾è®¡ï¼å®å¼ºè°âèè´£åä¸âåâå¯¹è±¡ç»åâï¼ç®åæ¥è¯´å°±æ¯âå¯¹è±¡å¥å¯¹è±¡âã\n\néè¿è¿ç§åµå¥æ¹å¼ï¼Kuberneteséçè¿äºAPIå¯¹è±¡å°±å½¢æäºä¸ä¸ªâæ§å¶é¾âï¼\n\nCronJobä½¿ç¨å®æ¶è§åæ§å¶Jobï¼Jobä½¿ç¨å¹¶åæ°éæ§å¶Podï¼Podåå®ä¹åæ°æ§å¶å®¹å¨ï¼å®¹å¨åéç¦»æ§å¶è¿ç¨ï¼è¿ç¨æç»å®ç°ä¸å¡åè½ï¼å±å±éè¿çå½¢å¼æç¹åè®¾è®¡æ¨¡å¼éçDecoratorï¼è£é¥°æ¨¡å¼ï¼ï¼é¾æ¡éçæ¯ä¸ªç¯èé½åå¸å¶èï¼å¨Kubernetesçç»ä¸ææ¥ä¸å®æä»»å¡ã\n\nå°ç»ä¸ä¸ä»å¤©çåå®¹ï¼\n\n 1. Podæ¯Kubernetesçæå°è°åº¦ååï¼ä½ä¸ºäºä¿æå®çç¬ç«æ§ï¼ä¸åºè¯¥åå®æ·»å å¤ä½çåè½ã\n 2. Kubernetesä¸ºç¦»çº¿ä¸å¡æä¾äºJobåCronJobä¸¤ç§APIå¯¹è±¡ï¼åå«å¤çâä¸´æ¶ä»»å¡âåâå®æ¶ä»»å¡âã\n 3. Jobçå³é®å­æ®µæ¯ spec.templateï¼éé¢å®ä¹äºç¨æ¥è¿è¡ä¸å¡çPodæ¨¡æ¿ï¼å¶ä»çéè¦å­æ®µæ completionsã parallelism ç­\n 4. CronJobçå³é®å­æ®µæ¯ spec.jobTemplate å spec.scheduleï¼åå«å®ä¹äºJobæ¨¡æ¿åå®æ¶è¿è¡çè§åã\n\n\n# 4. ConfigMap/Secretï¼ææ ·éç½®ãå®å¶æçåºç¨\n\næ¬èè¦è§£å³çé®é¢ï¼ä½¿ç¨ YAML è¯­è¨æ¥å®ä¹ API å¯¹è±¡ï¼åç»åèµ·æ¥å®ç°å¨æéç½®ã\n\nä¸é¢è®²è§£Kuberneteséä¸é¨ç¨æ¥ç®¡çéç½®ä¿¡æ¯çä¸¤ç§å¯¹è±¡ï¼ ConfigMap å Secretï¼ä½¿ç¨å®ä»¬æ¥çµæ´»å°éç½®ãå®å¶æä»¬çåºç¨ã\n\n\n# 4.1 ConfigMap/Secret\n\né¦åä½ è¦ç¥éï¼åºç¨ç¨åºæå¾å¤ç±»å«çéç½®ä¿¡æ¯ï¼ä½ä»æ°æ®å®å¨çè§åº¦æ¥çå¯ä»¥åæä¸¤ç±»ï¼\n\n * ä¸ç±»æ¯ææéç½®ï¼ä¹å°±æ¯ä¸ä¿å¯ï¼å¯ä»¥ä»»ææ¥è¯¢ä¿®æ¹ï¼æ¯å¦æå¡ç«¯å£ãè¿è¡åæ°ãæä»¶è·¯å¾ç­ç­ã\n * å¦ä¸ç±»åæ¯æºå¯éç½®ï¼ç±äºæ¶åææä¿¡æ¯éè¦ä¿å¯ï¼ä¸è½éä¾¿æ¥çï¼æ¯å¦å¯ç ãå¯é¥ãè¯ä¹¦ç­ç­ã\n\nè¿ä¸¤ç±»éç½®ä¿¡æ¯æ¬è´¨ä¸é½æ¯å­ç¬¦ä¸²ï¼åªæ¯ç±äºå®å¨æ§çåå ï¼å¨å­æ¾åä½¿ç¨æ¹é¢æäºå·®å¼ï¼æä»¥Kubernetesä¹å°±å®ä¹äºä¸¤ä¸ªAPIå¯¹è±¡ï¼ ConfigMap ç¨æ¥ä¿å­ææéç½®ï¼ Secret ç¨æ¥ä¿å­ç§å¯éç½®ã\n\n# 4.1.1 ä»ä¹æ¯ConfigMap\n\nConfigMap çç®åï¼âcmâï¼åé¢é½å¯ä»¥ç´æ¥ç¨ç®åä»£æ¿ãç¨å½ä»¤ kubectl create æ¥åå»ºä¸ä¸ªå®çYAMLæ ·æ¿ã\n\nexport out="--dry-run=client -o yaml"        # å®ä¹Shellåé\nkubectl create cm info [--from-literal=k=v] $out\n\n\n1\n2\n\n\nåæ° --from-literal=k=v æ¯è¡¨ç¤ºè¦çæå¸¦æâdataâå­æ®µçYAMLæ ·æ¿ãæ³¨æï¼å ä¸ºå¨ConfigMapéçæ°æ®é½æ¯Key-Valueç»æï¼æä»¥ --from-literal åæ°éè¦ä½¿ç¨ k=v çå½¢å¼ã\n\nå¾å°çæ ·æ¿æä»¶å¤§æ¦æ¯è¿ä¸ªæ ·å­ï¼\n\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: info\ndata:\n  k: v\n\n\n1\n2\n3\n4\n5\n6\n\n\næYAMLæ ·æ¿æä»¶ä¿®æ¹ä¸ä¸ï¼åå¤å¢æ·»ä¸äºKey-Valueï¼å°±å¾å°äºä¸ä¸ªæ¯è¾å®æ´çConfigMapå¯¹è±¡ï¼\n\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: info\n\ndata:\n  count: \'10\'\n  debug: \'on\'\n  path: \'/etc/systemd\'\n  greeting: |\n    say hello to kubernetes.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç°å¨å°±å¯ä»¥ä½¿ç¨ kubectl apply æè¿ä¸ªYAMLäº¤ç»Kubernetesï¼è®©å®åå»ºConfigMapå¯¹è±¡äºï¼\n\nkubectl apply -f cm.yml\n\n\n1\n\n\nåå»ºæååï¼æä»¬è¿æ¯å¯ä»¥ç¨ kubectl getã kubectl describe æ¥æ¥çConfigMapçç¶æï¼\n\nkubectl get cm\nkubectl describe cm info\n\n\n1\n2\n\n\nä½ å¯ä»¥çå°ï¼ç°å¨ConfigMapçKey-Valueä¿¡æ¯å°±å·²ç»å­å¥äºetcdæ°æ®åºï¼åç»­å°±å¯ä»¥è¢«å¶ä»APIå¯¹è±¡ä½¿ç¨ã\n\n# 4.1.2 ä»ä¹æ¯Secret\n\nSecret åConfigMapçç»æåç¨æ³å¾ç±»ä¼¼ï¼ä¸è¿å¨KuberneteséSecretå¯¹è±¡åç»ååºå¾å¤ç±»ï¼æ¯å¦ï¼\n\n * è®¿é®ç§æéåä»åºçè®¤è¯ä¿¡æ¯\n * èº«ä»½è¯å«çå­è¯ä¿¡æ¯\n * HTTPSéä¿¡çè¯ä¹¦åç§é¥\n * ä¸è¬çæºå¯ä¿¡æ¯ï¼æ ¼å¼ç±ç¨æ·èªè¡è§£éï¼\n\nåå ç§æä»¬ç°å¨ææ¶ç¨ä¸å°ï¼æä»¥å°±åªä½¿ç¨æåä¸ç§ï¼åå»ºYAMLæ ·æ¿çå½ä»¤æ¯ kubectl create secret generic ï¼åæ ·ï¼ä¹è¦ä½¿ç¨åæ° --from-literal ç»åºKey-Valueå¼ï¼\n\nkubectl create secret generic user --from-literal=name=root $out\n\n\n1\n\n\nå¾å°çSecretå¯¹è±¡å¤§æ¦æ¯è¿ä¸ªæ ·å­ï¼\n\napiVersion: v1\nkind: Secret\nmetadata:\n  name: user\n\ndata:\n  name: cm9vdA==\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nSecretå¯¹è±¡åªæ¯âkindâå­æ®µç±âConfigMapâåæäºâSecretâï¼åé¢åæ ·ä¹æ¯âdataâå­æ®µï¼éé¢ä¹æ¯Key-Valueçæ°æ®ãä½Secret ä¸è½åConfigMapé£æ ·ç´æ¥ä¿å­ææäºï¼å¯¹æ°æ®ä½¿ç¨äº BASE64 ç¼ç ï¼æ ¹æ¬ç®ä¸ä¸çæ­£çå å¯ï¼ãæä»¥ Secret å¯¹è±¡ä¸è®©ç¨æ·ç´æ¥çå°åå§æ°æ®ï¼èµ·å°ä¸å®çä¿å¯ä½ç¨ã\n\nèªå·±ç¨Linuxå·¥å·å¯¹æ°æ®è¿è¡ base64 ç¼ç \n\næä»¬å®å¨å¯ä»¥ç»å¼kubectlï¼èªå·±ç¨Linuxå°å·¥å·âbase64âæ¥å¯¹æ°æ®ç¼ç ï¼ç¶ååå¥YAMLæä»¶ï¼æ¯å¦ï¼\n\necho -n "123456" | base64\nMTIzNDU2\n\n\n1\n2\n\n\nè¦æ³¨æè¿æ¡å½ä»¤éç echo ï¼å¿é¡»è¦å åæ° -n å»æå­ç¬¦ä¸²ééå«çæ¢è¡ç¬¦ï¼å¦åBase64ç¼ç åºæ¥çå­ç¬¦ä¸²å°±æ¯éè¯¯çã\n\næä»¬åæ¥éæ°ç¼è¾SecretçYAMLï¼ä¸ºå®æ·»å ä¸¤ä¸ªæ°çæ°æ®ï¼æ¹å¼å¯ä»¥æ¯åæ° --from-literal èªå¨ç¼ç ï¼ä¹å¯ä»¥æ¯èªå·±æå¨ç¼ç ï¼\n\napiVersion: v1\nkind: Secret\nmetadata:\n  name: user\n\ndata:\n  name: cm9vdA==  # root\n  pwd: MTIzNDU2   # 123456\n  db: bXlzcWw=    # mysql\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ¥ä¸æ¥çåå»ºåæ¥çå¯¹è±¡æä½åConfigMapæ¯ä¸æ ·çï¼ä½¿ç¨ kubectl applyã kubectl getã kubectl describeï¼\n\nkubectl apply  -f secret.yml\nkubectl get secret\nkubectl describe secret user\n\n\n\n1\n2\n3\n4\n\n\nè¿æ ·ä¸ä¸ªå­å¨ææä¿¡æ¯çSecretå¯¹è±¡ä¹å°±åå»ºå¥½äºï¼èä¸å ä¸ºå®æ¯ä¿å¯çï¼ä½¿ç¨ kubectl describe ä¸è½ç´æ¥çå°åå®¹ï¼åªè½çå°æ°æ®çå¤§å°ï¼ä½ å¯ä»¥åConfigMapå¯¹æ¯ä¸ä¸ã\n\n\n# 4.2 å¦ä½ä½¿ç¨\n\n# 4.2.1 ä»¥ç¯å¢åéçæ¹å¼ä½¿ç¨\n\nä¸é¢æå°±æå¼ç¨äºConfigMapåSecretå¯¹è±¡çPodååºæ¥ï¼ç»ä½ åä¸ªç¤ºèï¼ä¸ºäºæéä½ æ³¨æï¼ææâ envâå­æ®µæå°äºåé¢ï¼\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: env-pod\n\nspec:\n  containers:\n  - env:\n      - name: COUNT\n        valueFrom:\n          configMapKeyRef:\n            name: info\n            key: count\n      - name: GREETING\n        valueFrom:\n          configMapKeyRef:\n            name: info\n            key: greeting\n      - name: USERNAME\n        valueFrom:\n          secretKeyRef:\n            name: user\n            key: name\n      - name: PASSWORD\n        valueFrom:\n          secretKeyRef:\n            name: user\n            key: pwd\n\n    image: busybox\n    name: busy\n    imagePullPolicy: IfNotPresent\n    command: ["/bin/sleep", "300"]\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\nè¿ä¸ªPodçåå­æ¯âenv-podâï¼éåæ¯âbusyboxâï¼æ§è¡å½ä»¤sleepç¡ç 300ç§ï¼æä»¬å¯ä»¥å¨è¿æ®µæ¶é´éä½¿ç¨å½ä»¤ kubectl exec è¿å¥Podè§å¯ç¯å¢åéã\n\nä½ éè¦éç¹å³æ³¨çæ¯å®çâenvâå­æ®µï¼éé¢å®ä¹äº4ä¸ªç¯å¢åéï¼ COUNTã GREETINGã USERNAMEã PASSWORDã\n\nå¯¹äºææéç½®æ°æ®ï¼ COUNTã GREETING å¼ç¨çæ¯ConfigMapå¯¹è±¡ï¼æä»¥ä½¿ç¨å­æ®µâ configMapKeyRefâï¼éé¢çânameâæ¯ConfigMapå¯¹è±¡çåå­ï¼ä¹å°±æ¯ä¹åæä»¬åå»ºçâinfoâï¼èâkeyâå­æ®µåå«æ¯âinfoâå¯¹è±¡éç count å greetingã\n\nåæ ·çå¯¹äºæºå¯éç½®æ°æ®ï¼ USERNAMEã PASSWORD å¼ç¨çæ¯Secretå¯¹è±¡ï¼è¦ä½¿ç¨å­æ®µâ secretKeyRefâï¼åç¨ânameâæå®Secretå¯¹è±¡çåå­ userï¼ç¨âkeyâå­æ®µåºç¨å®éé¢ç name å pwd ã\n\nConfigMapåSecretå¨Podéçç»åå³ç³»å¦å¾æç¤ºï¼\n\nä»è¿å¼ å¾ä½ å°±åºè¯¥è½å¤æ¯è¾æ¸æ¥å°çåºPodä¸ConfigMapãSecretçâæ¾è¦åâå³ç³»ï¼å®ä»¬ä¸æ¯ç´æ¥åµå¥åå«ï¼èæ¯ä½¿ç¨âKeyRefâå­æ®µé´æ¥å¼ç¨å¯¹è±¡ï¼è¿æ ·ï¼åä¸æ®µéç½®ä¿¡æ¯å°±å¯ä»¥å¨ä¸åçå¯¹è±¡ä¹é´å±äº«ã\n\nå¼æ¸æ¥äºç¯å¢åéçæ³¨å¥æ¹å¼ä¹åï¼è®©æä»¬ç¨ kubectl apply åå»ºPodï¼åç¨ kubectl exec è¿å¥Podï¼éªè¯ç¯å¢åéæ¯å¦çæï¼\n\nkubectl apply -f env-pod.yml\nkubectl exec -it env-pod -- sh\n\necho $COUNT\necho $GREETING\necho $USERNAME $PASSWORD\n\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿å¼ æªå¾å°±æ¾ç¤ºäºPodçè¿è¡ç»æï¼å¯ä»¥çå°å¨Podéä½¿ç¨ echo å½ä»¤ç¡®å®è¾åºäºæä»¬å¨ä¸¤ä¸ªYAMLéå®ä¹çéç½®ä¿¡æ¯ï¼ä¹å°±è¯æPodå¯¹è±¡æåç»åäºConfigMapåSecretå¯¹è±¡ã\n\nä»¥ç¯å¢åéçæ¹å¼ä½¿ç¨ConfigMap/Secretè¿æ¯æ¯è¾ç®åçï¼ä¸é¢æ¥çç¬¬äºç§å è½½æä»¶çæ¹å¼ã\n\n# 4.2.2 ä»¥Volumeçæ¹å¼ä½¿ç¨\n\nKubernetesä¸ºPodå®ä¹äºä¸ä¸ªâ Volumeâçæ¦å¿µï¼å¯ä»¥ç¿»è¯ææ¯âå­å¨å·âãå¦ææPodçè§£ææ¯ä¸ä¸ªèææºï¼é£ä¹Volumeå°±ç¸å½äºæ¯èææºéçç£çã\n\næä»¬å¯ä»¥ä¸ºPodâæè½½ï¼mountï¼âå¤ä¸ªVolumeï¼éé¢å­æ¾ä¾Podè®¿é®çæ°æ®ï¼è¿ç§æ¹å¼æç¹ç±»ä¼¼ docker run -vï¼è½ç¶ç¨æ³å¤æäºä¸äºï¼ä½åè½ä¹ç¸åºå¼ºå¤§ä¸äºã\n\nå¨Podéæè½½Volumeå¾å®¹æï¼åªéè¦å¨â specâéå¢å ä¸ä¸ªâ volumesâå­æ®µï¼ç¶ååå®ä¹å·çåå­åå¼ç¨çConfigMap/Secretå°±å¯ä»¥äºãè¦æ³¨æçæ¯Volumeå±äºPodï¼ä¸å±äºå®¹å¨ï¼æä»¥å®åå­æ®µâcontainersâæ¯åçº§çï¼é½å±äºâspecâã\n\nä¸é¢æä»¬åå®ä¹ä¸¤ä¸ªVolumeï¼åå«å¼ç¨ConfigMapåSecretï¼åå­æ¯ cm-vol å sec-volãæäºVolumeçå®ä¹ä¹åï¼å°±å¯ä»¥å¨å®¹å¨éæè½½äºï¼è¿è¦ç¨å°â volumeMountsâå­æ®µï¼æ­£å¦å®çå­é¢å«ä¹ï¼å¯ä»¥æå®ä¹å¥½çVolumeæè½½å°å®¹å¨éçæä¸ªè·¯å¾ä¸ï¼æä»¥éè¦å¨éé¢ç¨â mountPathââ nameâæç¡®å°æå®æè½½è·¯å¾åVolumeçåå­ã\n\næâ volumesâåâ volumeMountsâå­æ®µé½åå¥½ä¹åï¼éç½®ä¿¡æ¯å°±å¯ä»¥å è½½ææä»¶äºãä¸å¾è¡¨ç¤ºä»ä»¬ä¹é´çå¼ç¨å³ç³»ï¼\n\nä½ å¯ä»¥çå°ï¼æè½½Volumeçæ¹å¼åç¯å¢åéåä¸å¤ªç¸åãç¯å¢åéæ¯ç´æ¥å¼ç¨äºConfigMap/Secretï¼èVolumeåå¤å äºä¸ä¸ªç¯èï¼éè¦åç¨Volumeå¼ç¨ConfigMap/Secretï¼ç¶åå¨å®¹å¨éæè½½Volumeï¼æç¹âååå­ââå¼¯å¼¯ç»âã\n\nè¿ç§æ¹å¼çå¥½å¤å¨äºï¼ä»¥Volumeçæ¦å¿µç»ä¸æ½è±¡äºææçå­å¨ï¼ä¸ä»ç°å¨æ¯æConfigMap/Secretï¼ä»¥åè¿è½å¤æ¯æä¸´æ¶å·ãæä¹å·ãå¨æå·ãå¿«ç§å·ç­è®¸å¤å½¢å¼çå­å¨ï¼æ©å±æ§éå¸¸å¥½ã\n\nç°å¨ææPodçå®æ´YAMLæè¿°ååºæ¥ï¼ç¶åä½¿ç¨ kubectl apply åå»ºå®ï¼\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\n\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: vol-pod11\n\nspec:\n  volumes:\n  - name: cm-vol\n    configMap:\n      name: info\n  - name: sec-vol\n    secret:\n      secretName: user1\n\n  containers:\n  - volumeMounts:\n    - mountPath: /tmp/cm-items\n      name: cm-vol\n    - mountPath: /tmp/sec-items\n      name: sec-vol\n\n    image: busybox:latest\n    name: busy11\n    imagePullPolicy: IfNotPresent\n    command: ["/bin/sleep", "300"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\nåå»ºä¹åï¼æä»¬è¿æ¯ç¨ kubectl exec è¿å¥Podï¼ççéç½®ä¿¡æ¯è¢«å è½½æäºä»ä¹å½¢å¼ï¼\n\nkubectl apply -f vol-pod.yml\nkubectl get pod\nkubectl exec -it vol-pod -- sh\n\n\n1\n2\n3\n\n\nä½ ä¼çå°ï¼ConfigMapåSecreté½åæäºç®å½çå½¢å¼ï¼èå®ä»¬éé¢çKey-Valueåæäºä¸ä¸ªä¸ªçæä»¶ï¼èæä»¶åå°±æ¯Keyã(Key => æä»¶åï¼Value => æä»¶åå®¹)\n\nå ä¸ºè¿ç§å½¢å¼ä¸çå·®å¼ï¼ä»¥Volumeçæ¹å¼æ¥ä½¿ç¨ConfigMap/Secretï¼å°±åç¯å¢åéä¸å¤ªä¸æ ·ãç¯å¢åéç¨æ³ç®åï¼æ´éåå­æ¾ç®ç­çå­ç¬¦ä¸²ï¼èVolumeæ´éåå­æ¾å¤§æ°æ®éçéç½®æä»¶ï¼å¨Podéå è½½ææä»¶åè®©åºç¨ç´æ¥è¯»åä½¿ç¨ã\n\n\n# 4.3 å°ç»\n\nä»¥ä¸å­¦ä¹ äºä¸¤ç§å¨Kuberneteséç®¡çéç½®ä¿¡æ¯çAPIå¯¹è±¡ConfigMapåSecretï¼å®ä»¬åå«ä»£è¡¨äºææä¿¡æ¯åæºå¯ææä¿¡æ¯ï¼å­å¨å¨etcdéï¼å¨éè¦çæ¶åå¯ä»¥æ³¨å¥Podä¾Podä½¿ç¨ã',normalizedContent:'# 1. yamlï¼kubernetesä¸çéçéç¨è¯­\n\nkubernetesä¸çéçæ åå·¥ä½è¯­è¨æ¯ yamlã\n\n\n# 1.1 å£°æå¼ä¸å½ä»¤å¼æ¯æä¹åäº\n\n> yaml æ¯âå£°æå¼âã\n\ndockerå½ä»¤ådockerfileå°±å±äºâå½ä»¤å¼âï¼å¤§å¤æ°ç¼ç¨è¯­è¨ä¹å±äºå½ä»¤å¼ï¼å®çç¹ç¹æ¯äº¤äºæ§å¼ºï¼æ³¨éé¡ºåºåè¿ç¨ï¼ä½ å¿é¡»âåè¯âè®¡ç®æºæ¯æ­¥è¯¥åä»ä¹ï¼ææçæ­¥éª¤é½åæ¸æ¥ï¼è¿æ ·ç¨åºæè½å¤ä¸æ­¥æ­¥èµ°ä¸å»ï¼æåå®æä»»å¡ï¼æ¾å¾è®¡ç®æºæç¹âç¬¨âã\n\nâå£°æå¼âï¼å¨kubernetesåºç°ä¹åæ¯è¾å°è§ï¼å®ä¸âå½ä»¤å¼âå®å¨ç¸åï¼ä¸å³å¿å·ä½çè¿ç¨ï¼æ´æ³¨éç»æãæä»¬ä¸éè¦âæâè®¡ç®æºè¯¥æä¹åï¼åªè¦åè¯å®ä¸ä¸ªç®æ ç¶æï¼å®èªå·±å°±ä¼æ³åæ³å»å®æä»»å¡ï¼ç¸æ¯èµ·æ¥èªå¨åãæºè½åç¨åº¦æ´é«ã\n\nä»¥âæè½¦âæ¥å½¢è±¡å°è§£éä¸ä¸âå½ä»¤å¼âåâå£°æå¼âçåºå«ã\n\n * åè®¾ä½ è¦æè½¦å»é«éç«ï¼ä½å¸æºä¸çæè·¯åµï¼ä½ å°±åªå¥½ä¸åå¶ç¦å°åè¯ä»è¯¥èµ°åªæ¡è·¯ãå¨åªä¸ªè·¯å£è½¬åãå¨åªéè¿åºä¸»è·¯ãååªä¸ªç«å£ãè½ç¶æåå°è¾¾äºç®çå°ï¼ä½è¿ä¸è·¯ä¸ä¹è´¹äºå¾å¤å£èï¼ååºäºæ æ°çâå½ä»¤âãå¾æ¾ç¶ï¼è¿æ®µè·¯ç¨å°±å±äºâå½ä»¤å¼âã\n * åæ ·æ¯å»é«éç«ï¼ä½å¸æºç»éªä¸°å¯ï¼ä»ç¥éåªéææ¥å µãåªæ¡è·¯ççº¢ç»¿ç¯å¤ãåªæ®µè·¯æä¸´æ¶ç®¡æ§ãåªéå¯ä»¥æå°éï¼æ­¤æ¶ä½ åå¤å´æ çä¼å¹²æ°ä»çæ­£å¸¸é©¾é©¶ï¼æä»¥ï¼ä½ åªè¦ç»ä»ä¸ä¸ªâå£°æâï¼æè¦å»é«éç«ï¼æ¥ä¸æ¥å°±å¯ä»¥èèææå°èººå¨ååº§ä¸ä¼æ¯ï¼é¡ºå©å°è¾¾ç®çå°äº\n\nå¨è¿ä¸ªâæè½¦âçä¾å­éï¼kuberneteså°±æ¯è¿æ ·çä¸ä½çç»çå¸æºï¼master/nodeæ¶æè®©å®å¯¹æ´ä¸ªéç¾¤çç¶æäºå¦ææï¼åé¨çä¼å¤ç»ä»¶åæä»¶ä¹è½å¤èªå¨çæ§ç®¡çåºç¨ãæä»¬æå¥½æ¯åä¸ä¸ªâ ç©æææâï¼ç¨âå£°æå¼âæä»»å¡çç®æ åè¯å®ï¼æ¯å¦ä½¿ç¨åªä¸ªéåãä»ä¹æ¶åè¿è¡ï¼è®©å®èªå·±å»å¤çæ§è¡è¿ç¨ä¸­çç»èã\n\né£ä¹ï¼yaml è¯­è¨å°±æ¯ç» kubernetes ååºä¸ä¸ªâå£°æâçæ¹å¼ã\n\n> å®¹å¨ææ¯éçshellèæ¬ådockerfileå¯ä»¥å¾å¥½å°æè¿°âå½ä»¤å¼âï¼ä½å¯¹äºâå£°æå¼âå°±ä¸å¤ªåéäº\n\n\n# 1.2 ä»ä¹æ¯ yaml\n\n> yaml v.s. xml:\n> \n>  * xml æ¯ä¸ç§ç±»ä¼¼ html çæ ç­¾å¼è¯­è¨ï¼æå¾å¤ç¹æç¼èã\n>  * yaml å®è´¨ä¸ä¸xmlå®å¨ä¸åï¼æ´éåäººç±»éè¯»ï¼è®¡ç®æºè§£æèµ·æ¥ä¹å¾å®¹æ\n\næyamlçæ°ç»ãå¯¹è±¡ç»åèµ·æ¥ï¼æä»¬å°±å¯ä»¥æè¿°åºä»»æçkubernetesèµæºå¯¹è±¡ã\n\n\n# 1.3 ä»ä¹æ¯ api å¯¹è±¡\n\nyamlè¯­è¨åªç¸å½äºâè¯­æ³âï¼è¦ä¸kuberneteså¯¹è¯ï¼æä»¬è¿å¿é¡»æè¶³å¤çâè¯æ±âæ¥è¡¨ç¤ºâè¯­ä¹âãä½ä¸ºä¸ä¸ªéç¾¤æä½ç³»ç»ï¼kuberneteså½çº³æ»ç»äºgoogleå¤å¹´çç»éªï¼å¨çè®ºå±é¢æ½è±¡åºäºå¾å¤ä¸ªæ¦å¿µï¼ç¨æ¥æè¿°ç³»ç»çç®¡çè¿ç»´å·¥ä½ï¼è¿äºæ¦å¿µå°±å«åâ apiå¯¹è±¡âã\n\nè¯´å°è¿ä¸ªåå­ï¼ä½ ä¹è®¸ä¼èæ³å°ä¸æ¬¡è¯¾éè®²å°çkubernetesç»ä»¶ apiserverãæ²¡éï¼å®æ­£æ¯æ¥æºäºæ­¤ãå ä¸ºapiserveræ¯kubernetesç³»ç»çå¯ä¸å¥å£ï¼å¤é¨ç¨æ·ååé¨ç»ä»¶é½å¿é¡»åå®éä¿¡ï¼èå®éç¨äºhttpåè®®çurlèµæºçå¿µï¼apié£æ ¼ä¹ç¨restfulçget/post/deleteç­ç­ï¼æä»¥ï¼è¿äºæ¦å¿µå¾èªç¶å°å°±è¢«ç§°ä¸ºæ¯âapiå¯¹è±¡âäºã\n\né£é½æåªäºapiå¯¹è±¡å¢ï¼\n\nä½¿ç¨ kubectl api-resources æ¥æ¥çå½åkubernetesçæ¬æ¯æçææå¯¹è±¡ï¼\n\nkubectl api-resources\n\n\n1\n\n\nå¨è¾åºçânameâä¸æ ï¼å°±æ¯å¯¹è±¡çåå­ï¼æ¯å¦configmapãpodãserviceç­ç­ï¼ç¬¬äºæ âshortnamesâåæ¯è¿ç§èµæºçç®åï¼å¨æä»¬ä½¿ç¨kubectlå½ä»¤çæ¶åå¾æç¨ï¼å¯ä»¥å°æ²å æ¬¡é®çï¼æ¯å¦podå¯ä»¥ç®åæpoï¼serviceå¯ä»¥ç®åæsvcã\n\nå¨ä½¿ç¨kubectlå½ä»¤çæ¶åï¼ä½ è¿å¯ä»¥å ä¸ä¸ä¸ªåæ° --v=9ï¼å®ä¼æ¾ç¤ºåºè¯¦ç»çå½ä»¤æ§è¡è¿ç¨ï¼æ¸æ¥å°çå°ååºçhttpè¯·æ±ï¼æ¯å¦ï¼\n\nkubectl get pod --v=9\n\n\n1\n\n\nä»æªå¾éå¯ä»¥çå°ï¼kubectlå®¢æ·ç«¯ç­ä»·äºè°ç¨äºcurlï¼å8443ç«¯å£åéäºhttp get è¯·æ±ï¼urlæ¯ /api/v1/namespaces/default/podsã\n\nç®åçkubernetes 1.23çæ¬æ50å¤ç§apiå¯¹è±¡ï¼å¨é¢å°æè¿°äºéç¾¤çèç¹ãåºç¨ãéç½®ãæå¡ãè´¦å·ç­ç­ä¿¡æ¯ï¼apiserverä¼æå®ä»¬é½å­å¨å¨æ°æ®åºetcdéï¼ç¶åkubeletãschedulerãcontroller-managerç­ç»ä»¶éè¿apiserveræ¥æä½å®ä»¬ï¼å°±å¨apiå¯¹è±¡è¿ä¸ªæ½è±¡å±æ¬¡å®ç°äºå¯¹æ´ä¸ªéç¾¤çç®¡çã\n\n\n# 1.4 å¦ä½æè¿°apiå¯¹è±¡\n\n> kubernetesæéç¾¤éçä¸åèµæºé½å®ä¹ä¸ºapiå¯¹è±¡ï¼éè¿restfulæ¥å£æ¥ç®¡çãæè¿°apiå¯¹è±¡éè¦ä½¿ç¨yamlè¯­è¨ï¼å¿é¡»çå­æ®µæ¯ apiversionãkindãmetadataã\n\nä¹åæä»¬ä½¿ç¨ kubectl è¿è¡ nginx çå½ä»¤ç¨çæ¯å½ä»¤å¼ç kubectl runï¼\n\nkubectl run ngx --image=nginx:alpine\n\n\n1\n\n\nä¸é¢çä¸ä¸å¦ä½ä»¥ yaml è¯­è¨æ¥å£°æå¼å°å¨ k8s ä¸­æè¿°å¹¶åå»º api å¯¹è±¡ãå¨ yaml ä¸­ï¼æä»¬éè¦è¯´æ¸æ¥æä»¬çç®æ ç¶æï¼è®© kubernetes èªå·±å»å³å®å¦ä½æåéåå¹¶è¿è¡ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: ngx-pod\n  labels:\n    env: demo\n    owner: nrich\n\nspec:\n  containers:\n  - image: nginx:alpine\n    name: ngx\n    ports:\n    - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå¯ä»¥çåºï¼è¿éæ¯åå»ºä¸ä¸ª podï¼è¦ä½¿ç¨ nginx:alpine ç image æ¥åå»ºä¸ä¸ª containerï¼å¹¶å¼æ¾ 80 ç«¯å£ï¼èå¶ä»é¨åå°±æ¯ k8s å¯¹ api å¯¹è±¡å¼ºå¶çæ ¼å¼è¦æ±äºã\n\nå ä¸ºapiå¯¹è±¡éç¨æ åç http åè®®ï¼ä¸ºäºæ¹ä¾¿çè§£ï¼æä»¬å¯ä»¥åé´ä¸ä¸ http çæ¥ææ ¼å¼ï¼æ api å¯¹è±¡çæè¿°åæâheaderâåâbodyâä¸¤é¨åã\n\nheader åå«çæ¯ api å¯¹è±¡çåºæ¬ä¿¡æ¯ï¼æä¸ä¸ªå­æ®µï¼\n\n * apiversionï¼è¡¨ç¤ºæä½è¿ç§èµæºç api çæ¬å·ï¼ç±äº kubernetes çè¿­ä»£éåº¦å¾å¿«ï¼ä¸åççæ¬åå»ºçå¯¹è±¡ä¼æå·®å¼ï¼ä¸ºäºåºåè¿äºçæ¬å°±éè¦ä½¿ç¨ apiversion è¿ä¸ªå­æ®µï¼æ¯å¦ v1ãv1alpha1ãv1beta1 ç­ç­ã\n * kindï¼è¡¨ç¤ºèµæºå¯¹è±¡çç±»åï¼æ¯å¦ podãnodeãjobãservice ç­ã\n * metadataï¼è¡¨ç¤ºçæ¯èµæºçä¸äºåä¿¡æ¯ï¼ä¹å°±æ¯ç¨æ¥æ è®°å¯¹è±¡ï¼æ¹ä¾¿ kubernetes ç®¡ççä¸äºä¿¡æ¯ãå¨ä¸é¢çç¤ºä¾ä¸­æä¸¤ä¸ªåä¿¡æ¯ï¼\n   * nameï¼ç» pod èµ·äºä¸ªåå­\n   * labelsï¼ç» pod è´´ä¸ä¸äºä¾¿äºæ¥æ¾çæ ç­¾ï¼åå«æ¯ env å ownerã\n\nä»¥ä¸ä¿¡æ¯é½è¢« kubectl ç¨äºçæ http è¯·æ±åç» apiserverï¼ä½ å¯ä»¥ç¨ --v=9 åæ°å¨è¯·æ±ç url éçå°å®ä»¬ï¼æ¯å¦ï¼\n\nhttps://192.168.49.2:8443/api/v1/namespaces/default/pods/ngx-pod\n\n\n1\n\n\nheader ä¸­ç apiversionãkindãmetadata è¿ä¸ä¸ªå­æ®µé½æ¯ä»»ä½å¯¹è±¡é½å¿é¡»æçï¼è body é¨ååä¼ä¸å¯¹è±¡ç¹å®ç¸å³ï¼æ¯ç§å¯¹è±¡ä¼æä¸åçè§æ ¼å®ä¹ï¼å¨ yaml éå°±è¡¨ç°ä¸º spec å­æ®µï¼å³ specificationï¼ï¼è¡¨ç¤ºæä»¬å¯¹å¯¹è±¡çâææç¶æâï¼desired statusï¼ã\n\nè¿æ¯æ¥çè¿ä¸ª podï¼å®ç spec éå°±æ¯ä¸ä¸ª containers æ°ç»ï¼éé¢çæ¯ä¸ªåç´ åæ¯ä¸ä¸ªå¯¹è±¡ï¼æå®äºåå­ãéåãç«¯å£ç­ä¿¡æ¯ï¼\n\nspec:\n  containers:\n  - image: nginx:alpine\n    name: ngx\n    ports:\n    - containerport: 80\n\n\n1\n2\n3\n4\n5\n6\n\n\nç°å¨æè¿äºå­æ®µç»¼åèµ·æ¥ï¼æä»¬å°±è½å¤çåºï¼è¿ä»½ yaml ææ¡£å®æ´å°æè¿°äºä¸ä¸ªç±»åæ¯ pod ç api å¯¹è±¡ï¼è¦æ±ä½¿ç¨ v1 çæ¬ç api æ¥å£å»ç®¡çï¼å¶ä»æ´å·ä½çåç§°ãæ ç­¾ãç¶æç­ç»èé½è®°å½å¨äº metadata å spec å­æ®µç­éã\n\nä½¿ç¨ kubectl applyã kubectl deleteï¼åå ä¸åæ° -fï¼ä½ å°±å¯ä»¥ä½¿ç¨è¿ä¸ª yaml æä»¶ï¼åå»ºæèå é¤å¯¹è±¡äºï¼\n\nkubectl apply -f ngx-pod.yml    # åå»º api å¯¹è±¡\nkubectl delete -f ngx-pod.yml   # å é¤ api å¯¹è±¡\n\n\n1\n2\n\n\nkubernetes æ¶å°è¿ä»½âå£°æå¼âçæ°æ®ï¼åæ ¹æ® http è¯·æ±éç post/delete ç­æ¹æ³ï¼å°±ä¼èªå¨æä½è¿ä¸ªèµæºå¯¹è±¡ï¼è³äºå¯¹è±¡å¨åªä¸ªèç¹ä¸ãæä¹åå»ºãæä¹å é¤å®å¨ä¸ç¨æä»¬æå¿ã\n\n\n# 1.5 å¦ä½ç¼å yaml\n\nè¿ä¹å¤å­æ®µï¼æä»¬ææ ·æè½ç¼åæ­£ç¡®ç yaml å¢ï¼\n\nè¿ä¸ªé®é¢çææå¨çç­æ¡èªç¶æ¯ k8s çå®æ¹ææ¡£ï¼api å¯¹è±¡çææå­æ®µé½å¯ä»¥å¨éé¢æ¾å°ãä½è¿åå®¹å¤ªå¤ï¼ä¸é¢ä»ç»ä¸äºå®ç¨çå°æå·§ã\n\nç¬¬ä¸ä¸ªæå·§å¶å®åé¢å·²ç»è¯´è¿äºï¼å°±æ¯ kubectl api-resources å½ä»¤ï¼å®ä¼æ¾ç¤ºåºèµæºå¯¹è±¡ç¸åºçapiçæ¬åç±»åï¼æ¯å¦podççæ¬æ¯âv1âï¼ingressççæ¬æ¯ânetworking.k8s.io/v1âï¼ç§çå®åç»å¯¹ä¸ä¼éã\n\nç¬¬äºä¸ªæå·§ï¼æ¯å½ä»¤ kubectl explainï¼å®ç¸å½äºæ¯kubernetesèªå¸¦çapiææ¡£ï¼ä¼ç»åºå¯¹è±¡å­æ®µçè¯¦ç»è¯´æï¼è¿æ ·æä»¬å°±ä¸å¿å»ç½ä¸æ¥æ¾äºãæ¯å¦æ³è¦çpodéçå­æ®µè¯¥æä¹åï¼å°±å¯ä»¥è¿æ ·ï¼\n\nkubectl explain pod\nkubectl explain pod.metadata\nkubectl explain pod.spec\nkubectl explain pod.spec.containers\n\n\n1\n2\n3\n4\n\n\nä½¿ç¨åä¸¤ä¸ªæå·§ç¼å yaml å°±åºæ¬ä¸æ²¡æé¾åº¦äºã\n\nâ­ï¸ ç¬¬ä¸ä¸ªæå·§å°±æ¯kubectlçä¸¤ä¸ªç¹æ®åæ° --dry-run=client å -o yamlï¼åèæ¯ç©ºè¿è¡ï¼åèæ¯çæyamlæ ¼å¼ï¼ç»åèµ·æ¥ä½¿ç¨å°±ä¼è®© kubectl ä¸ä¼æå®éçåå»ºå¨ä½ï¼èåªçæ yaml æä»¶ãä¾å¦ï¼æ³è¦çæä¸ä¸ªpodçyamlæ ·æ¿ç¤ºä¾ï¼å¯ä»¥å¨ kubectl run åé¢å ä¸è¿ä¸¤ä¸ªåæ°ï¼\n\nkubectl run ngx --image=nginx:alpine --dry-run=client -o yaml\n\n\n1\n\n\nå°±ä¼çæä¸ä¸ªç»å¯¹æ­£ç¡®ç yaml æä»¶ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  creationtimestamp: null\n  labels:\n    run: ngx\n  name: ngx\nspec:\n  containers:\n  - image: nginx:alpine\n    name: ngx\n    resources: {}\n  dnspolicy: clusterfirst\n  restartpolicy: always\nstatus: {}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\næ¥ä¸æ¥ä½ è¦åçï¼å°±æ¯æ¥éå¯¹è±¡çè¯´æææ¡£ï¼æ·»å æèå é¤å­æ®µæ¥å®å¶è¿ä¸ª yaml äºã\n\nè¿ä¸ªå°æå·§è¿å¯ä»¥åè¿åä¸ä¸ï¼æè¿æ®µåæ°å®ä¹æshellåéï¼åå­ä»»æï¼æ¯å¦$do/$goï¼è¿éç¨çæ¯ $outï¼ï¼ç¨èµ·æ¥ä¼æ´çäºï¼æ¯å¦ï¼\n\nexport out="--dry-run=client -o yaml"\nkubectl run ngx --image=nginx:alpine $out\n\n\n1\n2\n\n\nä»åé¤äºä¸äºç¹æ®æåµï¼æä»¬é½ä¸ä¼åä½¿ç¨ kubectl run è¿æ ·çå½ä»¤å»ç´æ¥åå»º podï¼èæ¯ä¼ç¼å yamlï¼ç¨âå£°æå¼âæ¥æè¿°å¯¹è±¡ï¼åç¨ kubectl apply å»åå¸ yaml æ¥åå»ºå¯¹è±¡ã\n\n\n# 1.6 è¯¾å¤å°è´´å£«\n\n * .æ¨èä¸ä¸ªç¥åç json/yaml å·¥å·ç½ç«: bejsonï¼æ¯æ json æ ¼å¼æ ¡éªä¹å¯ä»¥è½¬æ¢ yamlã\n * kubernetes ç api çæ¬å½åææç¡®è§èï¼æ­£å¼çæ¬(gaï¼generally available) æ¯ v1 è¿æ ·ççº¯æ°å­ï¼è¯éªæ§è´¨ãä¸ç¨³å®çæ¯ alpha,æ¯è¾ç¨³å®ãå³å°åå¸çæ¯ betaã\n * å ä¸º kubernetes çå¼åè¯­è¨æ¯ goï¼æä»¥ api å¯¹è±¡å­æ®µç¨çé½æ¯ go è¯­æ³è§èï¼ä¾å¦å­æ®µå½åéµå¾ªâcamel caseâï¼ç±»åæ¯ booleanãstringã[]object ç­ã\n\n\n# 2. podï¼å¦ä½çè§£è¿ä¸ªkuberneteséææ ¸å¿çæ¦å¿µï¼\n\n\n# 2.1 ä¸ºä»ä¹è¦æ pod\n\npodè¿ä¸ªè¯åææ¯âè±è±èâï¼åæ¥åå»¶ä¼¸åºâè±å®¤ââå¤ªç©ºè±âç­å«ä¹ï¼å½¢è±¡å°æ¥è¯´podå°±æ¯åå«äºå¾å¤ç»ä»¶ãæåçä¸ç§ç»æã\n\nä¸ºäºè§£å³å¤åºç¨èåè¿è¡çé®é¢ï¼åæ¶è¿è¦ä¸ç ´åå®¹å¨çéç¦»ï¼å°±éè¦å¨å®¹å¨å¤é¢åå»ºç«ä¸ä¸ªâæ¶çº³è±âï¼è®©å¤ä¸ªå®¹å¨æ¢ä¿æç¸å¯¹ç¬ç«ï¼åè½å¤å°èå´å±äº«ç½ç»ãå­å¨ç­èµæºï¼èä¸æ°¸è¿æ¯âç»å¨ä¸èµ·âçç¶æã\n\næä»¥ï¼åºç°äºpodçæ¦å¿µï¼å®¹å¨æ­£æ¯âè±èâéé£äºå°å°çâè±è±âï¼ä½ å¯ä»¥å¨podçyamléçå°ï¼âspec.containersâå­æ®µå¶å®æ¯ä¸ä¸ªæ°ç»ï¼éé¢åè®¸å®ä¹å¤ä¸ªå®¹å¨ãpod è½è®©è¿ç¨ä½å¾æ´èæã\n\ntodo: å¾è¡¥å\n\n\n# 3. job/cronjobï¼ä¸ºä»ä¹ä¸ç´æ¥ç¨podæ¥å¤çä¸å¡ï¼\n\nkubernetesçæ ¸å¿å¯¹è±¡podï¼ç¨æ¥ç¼æä¸ä¸ªæå¤ä¸ªå®¹å¨ï¼è®©è¿äºå®¹å¨å±äº«ç½ç»ãå­å¨ç­èµæºï¼æ»æ¯å±åè°åº¦ï¼ä»èç´§å¯ååå·¥ä½ãpodæ¯å®¹å¨æ´è½å¤è¡¨ç¤ºå®éçåºç¨ï¼æä»¥kubernetesä¸ä¼å¨å®¹å¨å±é¢æ¥ç¼æä¸å¡ï¼èæ¯æpodä½ä¸ºå¨éç¾¤éè°åº¦è¿ç»´çæå°åä½ã\n\nåé¢æä»¬ä¹çå°äºä¸å¼ kubernetesçèµæºå¯¹è±¡å³ç³»å¾ï¼ä»¥podä¸ºä¸­å¿ï¼å»¶ä¼¸åºäºå¾å¤è¡¨ç¤ºåç§ä¸å¡çå¶ä»èµæºå¯¹è±¡ãé£ä¹ä½ ä¼ä¸ä¼æè¿æ ·ççé®ï¼podçåè½å·²ç»è¶³å¤å®åäºï¼ä¸ºä»ä¹è¿è¦å®ä¹è¿äºé¢å¤çå¯¹è±¡å¢ï¼ä¸ºä»ä¹ä¸ç´æ¥å¨podéæ·»å åè½ï¼æ¥å¤çä¸å¡éæ±å¢ï¼\n\nè¿ä¸ªé®é¢ä½ç°äºgoogleå¯¹å¤§è§æ¨¡è®¡ç®éç¾¤ç®¡ççæ·±åº¦æèï¼ä»å¤©æå°±è¯´è¯´kubernetesåºäºpodçè®¾è®¡çå¿µï¼åä»æç®åçä¸¤ç§å¯¹è±¡ââjobåcronjobè®²èµ·ã\n\n\n# 3.1 ä¸ºä»ä¹ä¸ç´æ¥ä½¿ç¨pod\n\n\n# å°ç»\n\nå¥½äºï¼ä»å¤©æä»¬ä»¥é¢åå¯¹è±¡ææ³åæäºä¸ä¸kuberneteséçèµæºå¯¹è±¡è®¾è®¡ï¼å®å¼ºè°âèè´£åä¸âåâå¯¹è±¡ç»åâï¼ç®åæ¥è¯´å°±æ¯âå¯¹è±¡å¥å¯¹è±¡âã\n\néè¿è¿ç§åµå¥æ¹å¼ï¼kuberneteséçè¿äºapiå¯¹è±¡å°±å½¢æäºä¸ä¸ªâæ§å¶é¾âï¼\n\ncronjobä½¿ç¨å®æ¶è§åæ§å¶jobï¼jobä½¿ç¨å¹¶åæ°éæ§å¶podï¼podåå®ä¹åæ°æ§å¶å®¹å¨ï¼å®¹å¨åéç¦»æ§å¶è¿ç¨ï¼è¿ç¨æç»å®ç°ä¸å¡åè½ï¼å±å±éè¿çå½¢å¼æç¹åè®¾è®¡æ¨¡å¼éçdecoratorï¼è£é¥°æ¨¡å¼ï¼ï¼é¾æ¡éçæ¯ä¸ªç¯èé½åå¸å¶èï¼å¨kubernetesçç»ä¸ææ¥ä¸å®æä»»å¡ã\n\nå°ç»ä¸ä¸ä»å¤©çåå®¹ï¼\n\n 1. podæ¯kubernetesçæå°è°åº¦ååï¼ä½ä¸ºäºä¿æå®çç¬ç«æ§ï¼ä¸åºè¯¥åå®æ·»å å¤ä½çåè½ã\n 2. kubernetesä¸ºç¦»çº¿ä¸å¡æä¾äºjobåcronjobä¸¤ç§apiå¯¹è±¡ï¼åå«å¤çâä¸´æ¶ä»»å¡âåâå®æ¶ä»»å¡âã\n 3. jobçå³é®å­æ®µæ¯ spec.templateï¼éé¢å®ä¹äºç¨æ¥è¿è¡ä¸å¡çpodæ¨¡æ¿ï¼å¶ä»çéè¦å­æ®µæ completionsã parallelism ç­\n 4. cronjobçå³é®å­æ®µæ¯ spec.jobtemplate å spec.scheduleï¼åå«å®ä¹äºjobæ¨¡æ¿åå®æ¶è¿è¡çè§åã\n\n\n# 4. configmap/secretï¼ææ ·éç½®ãå®å¶æçåºç¨\n\næ¬èè¦è§£å³çé®é¢ï¼ä½¿ç¨ yaml è¯­è¨æ¥å®ä¹ api å¯¹è±¡ï¼åç»åèµ·æ¥å®ç°å¨æéç½®ã\n\nä¸é¢è®²è§£kuberneteséä¸é¨ç¨æ¥ç®¡çéç½®ä¿¡æ¯çä¸¤ç§å¯¹è±¡ï¼ configmap å secretï¼ä½¿ç¨å®ä»¬æ¥çµæ´»å°éç½®ãå®å¶æä»¬çåºç¨ã\n\n\n# 4.1 configmap/secret\n\né¦åä½ è¦ç¥éï¼åºç¨ç¨åºæå¾å¤ç±»å«çéç½®ä¿¡æ¯ï¼ä½ä»æ°æ®å®å¨çè§åº¦æ¥çå¯ä»¥åæä¸¤ç±»ï¼\n\n * ä¸ç±»æ¯ææéç½®ï¼ä¹å°±æ¯ä¸ä¿å¯ï¼å¯ä»¥ä»»ææ¥è¯¢ä¿®æ¹ï¼æ¯å¦æå¡ç«¯å£ãè¿è¡åæ°ãæä»¶è·¯å¾ç­ç­ã\n * å¦ä¸ç±»åæ¯æºå¯éç½®ï¼ç±äºæ¶åææä¿¡æ¯éè¦ä¿å¯ï¼ä¸è½éä¾¿æ¥çï¼æ¯å¦å¯ç ãå¯é¥ãè¯ä¹¦ç­ç­ã\n\nè¿ä¸¤ç±»éç½®ä¿¡æ¯æ¬è´¨ä¸é½æ¯å­ç¬¦ä¸²ï¼åªæ¯ç±äºå®å¨æ§çåå ï¼å¨å­æ¾åä½¿ç¨æ¹é¢æäºå·®å¼ï¼æä»¥kubernetesä¹å°±å®ä¹äºä¸¤ä¸ªapiå¯¹è±¡ï¼ configmap ç¨æ¥ä¿å­ææéç½®ï¼ secret ç¨æ¥ä¿å­ç§å¯éç½®ã\n\n# 4.1.1 ä»ä¹æ¯configmap\n\nconfigmap çç®åï¼âcmâï¼åé¢é½å¯ä»¥ç´æ¥ç¨ç®åä»£æ¿ãç¨å½ä»¤ kubectl create æ¥åå»ºä¸ä¸ªå®çyamlæ ·æ¿ã\n\nexport out="--dry-run=client -o yaml"        # å®ä¹shellåé\nkubectl create cm info [--from-literal=k=v] $out\n\n\n1\n2\n\n\nåæ° --from-literal=k=v æ¯è¡¨ç¤ºè¦çæå¸¦æâdataâå­æ®µçyamlæ ·æ¿ãæ³¨æï¼å ä¸ºå¨configmapéçæ°æ®é½æ¯key-valueç»æï¼æä»¥ --from-literal åæ°éè¦ä½¿ç¨ k=v çå½¢å¼ã\n\nå¾å°çæ ·æ¿æä»¶å¤§æ¦æ¯è¿ä¸ªæ ·å­ï¼\n\napiversion: v1\nkind: configmap\nmetadata:\n  name: info\ndata:\n  k: v\n\n\n1\n2\n3\n4\n5\n6\n\n\næyamlæ ·æ¿æä»¶ä¿®æ¹ä¸ä¸ï¼åå¤å¢æ·»ä¸äºkey-valueï¼å°±å¾å°äºä¸ä¸ªæ¯è¾å®æ´çconfigmapå¯¹è±¡ï¼\n\napiversion: v1\nkind: configmap\nmetadata:\n  name: info\n\ndata:\n  count: \'10\'\n  debug: \'on\'\n  path: \'/etc/systemd\'\n  greeting: |\n    say hello to kubernetes.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç°å¨å°±å¯ä»¥ä½¿ç¨ kubectl apply æè¿ä¸ªyamläº¤ç»kubernetesï¼è®©å®åå»ºconfigmapå¯¹è±¡äºï¼\n\nkubectl apply -f cm.yml\n\n\n1\n\n\nåå»ºæååï¼æä»¬è¿æ¯å¯ä»¥ç¨ kubectl getã kubectl describe æ¥æ¥çconfigmapçç¶æï¼\n\nkubectl get cm\nkubectl describe cm info\n\n\n1\n2\n\n\nä½ å¯ä»¥çå°ï¼ç°å¨configmapçkey-valueä¿¡æ¯å°±å·²ç»å­å¥äºetcdæ°æ®åºï¼åç»­å°±å¯ä»¥è¢«å¶ä»apiå¯¹è±¡ä½¿ç¨ã\n\n# 4.1.2 ä»ä¹æ¯secret\n\nsecret åconfigmapçç»æåç¨æ³å¾ç±»ä¼¼ï¼ä¸è¿å¨kubernetesésecretå¯¹è±¡åç»ååºå¾å¤ç±»ï¼æ¯å¦ï¼\n\n * è®¿é®ç§æéåä»åºçè®¤è¯ä¿¡æ¯\n * èº«ä»½è¯å«çå­è¯ä¿¡æ¯\n * httpséä¿¡çè¯ä¹¦åç§é¥\n * ä¸è¬çæºå¯ä¿¡æ¯ï¼æ ¼å¼ç±ç¨æ·èªè¡è§£éï¼\n\nåå ç§æä»¬ç°å¨ææ¶ç¨ä¸å°ï¼æä»¥å°±åªä½¿ç¨æåä¸ç§ï¼åå»ºyamlæ ·æ¿çå½ä»¤æ¯ kubectl create secret generic ï¼åæ ·ï¼ä¹è¦ä½¿ç¨åæ° --from-literal ç»åºkey-valueå¼ï¼\n\nkubectl create secret generic user --from-literal=name=root $out\n\n\n1\n\n\nå¾å°çsecretå¯¹è±¡å¤§æ¦æ¯è¿ä¸ªæ ·å­ï¼\n\napiversion: v1\nkind: secret\nmetadata:\n  name: user\n\ndata:\n  name: cm9vda==\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nsecretå¯¹è±¡åªæ¯âkindâå­æ®µç±âconfigmapâåæäºâsecretâï¼åé¢åæ ·ä¹æ¯âdataâå­æ®µï¼éé¢ä¹æ¯key-valueçæ°æ®ãä½secret ä¸è½åconfigmapé£æ ·ç´æ¥ä¿å­ææäºï¼å¯¹æ°æ®ä½¿ç¨äº base64 ç¼ç ï¼æ ¹æ¬ç®ä¸ä¸çæ­£çå å¯ï¼ãæä»¥ secret å¯¹è±¡ä¸è®©ç¨æ·ç´æ¥çå°åå§æ°æ®ï¼èµ·å°ä¸å®çä¿å¯ä½ç¨ã\n\nèªå·±ç¨linuxå·¥å·å¯¹æ°æ®è¿è¡ base64 ç¼ç \n\næä»¬å®å¨å¯ä»¥ç»å¼kubectlï¼èªå·±ç¨linuxå°å·¥å·âbase64âæ¥å¯¹æ°æ®ç¼ç ï¼ç¶ååå¥yamlæä»¶ï¼æ¯å¦ï¼\n\necho -n "123456" | base64\nmtizndu2\n\n\n1\n2\n\n\nè¦æ³¨æè¿æ¡å½ä»¤éç echo ï¼å¿é¡»è¦å åæ° -n å»æå­ç¬¦ä¸²ééå«çæ¢è¡ç¬¦ï¼å¦åbase64ç¼ç åºæ¥çå­ç¬¦ä¸²å°±æ¯éè¯¯çã\n\næä»¬åæ¥éæ°ç¼è¾secretçyamlï¼ä¸ºå®æ·»å ä¸¤ä¸ªæ°çæ°æ®ï¼æ¹å¼å¯ä»¥æ¯åæ° --from-literal èªå¨ç¼ç ï¼ä¹å¯ä»¥æ¯èªå·±æå¨ç¼ç ï¼\n\napiversion: v1\nkind: secret\nmetadata:\n  name: user\n\ndata:\n  name: cm9vda==  # root\n  pwd: mtizndu2   # 123456\n  db: bxlzcww=    # mysql\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ¥ä¸æ¥çåå»ºåæ¥çå¯¹è±¡æä½åconfigmapæ¯ä¸æ ·çï¼ä½¿ç¨ kubectl applyã kubectl getã kubectl describeï¼\n\nkubectl apply  -f secret.yml\nkubectl get secret\nkubectl describe secret user\n\n\n\n1\n2\n3\n4\n\n\nè¿æ ·ä¸ä¸ªå­å¨ææä¿¡æ¯çsecretå¯¹è±¡ä¹å°±åå»ºå¥½äºï¼èä¸å ä¸ºå®æ¯ä¿å¯çï¼ä½¿ç¨ kubectl describe ä¸è½ç´æ¥çå°åå®¹ï¼åªè½çå°æ°æ®çå¤§å°ï¼ä½ å¯ä»¥åconfigmapå¯¹æ¯ä¸ä¸ã\n\n\n# 4.2 å¦ä½ä½¿ç¨\n\n# 4.2.1 ä»¥ç¯å¢åéçæ¹å¼ä½¿ç¨\n\nä¸é¢æå°±æå¼ç¨äºconfigmapåsecretå¯¹è±¡çpodååºæ¥ï¼ç»ä½ åä¸ªç¤ºèï¼ä¸ºäºæéä½ æ³¨æï¼ææâ envâå­æ®µæå°äºåé¢ï¼\n\napiversion: v1\nkind: pod\nmetadata:\n  name: env-pod\n\nspec:\n  containers:\n  - env:\n      - name: count\n        valuefrom:\n          configmapkeyref:\n            name: info\n            key: count\n      - name: greeting\n        valuefrom:\n          configmapkeyref:\n            name: info\n            key: greeting\n      - name: username\n        valuefrom:\n          secretkeyref:\n            name: user\n            key: name\n      - name: password\n        valuefrom:\n          secretkeyref:\n            name: user\n            key: pwd\n\n    image: busybox\n    name: busy\n    imagepullpolicy: ifnotpresent\n    command: ["/bin/sleep", "300"]\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\nè¿ä¸ªpodçåå­æ¯âenv-podâï¼éåæ¯âbusyboxâï¼æ§è¡å½ä»¤sleepç¡ç 300ç§ï¼æä»¬å¯ä»¥å¨è¿æ®µæ¶é´éä½¿ç¨å½ä»¤ kubectl exec è¿å¥podè§å¯ç¯å¢åéã\n\nä½ éè¦éç¹å³æ³¨çæ¯å®çâenvâå­æ®µï¼éé¢å®ä¹äº4ä¸ªç¯å¢åéï¼ countã greetingã usernameã passwordã\n\nå¯¹äºææéç½®æ°æ®ï¼ countã greeting å¼ç¨çæ¯configmapå¯¹è±¡ï¼æä»¥ä½¿ç¨å­æ®µâ configmapkeyrefâï¼éé¢çânameâæ¯configmapå¯¹è±¡çåå­ï¼ä¹å°±æ¯ä¹åæä»¬åå»ºçâinfoâï¼èâkeyâå­æ®µåå«æ¯âinfoâå¯¹è±¡éç count å greetingã\n\nåæ ·çå¯¹äºæºå¯éç½®æ°æ®ï¼ usernameã password å¼ç¨çæ¯secretå¯¹è±¡ï¼è¦ä½¿ç¨å­æ®µâ secretkeyrefâï¼åç¨ânameâæå®secretå¯¹è±¡çåå­ userï¼ç¨âkeyâå­æ®µåºç¨å®éé¢ç name å pwd ã\n\nconfigmapåsecretå¨podéçç»åå³ç³»å¦å¾æç¤ºï¼\n\nä»è¿å¼ å¾ä½ å°±åºè¯¥è½å¤æ¯è¾æ¸æ¥å°çåºpodä¸configmapãsecretçâæ¾è¦åâå³ç³»ï¼å®ä»¬ä¸æ¯ç´æ¥åµå¥åå«ï¼èæ¯ä½¿ç¨âkeyrefâå­æ®µé´æ¥å¼ç¨å¯¹è±¡ï¼è¿æ ·ï¼åä¸æ®µéç½®ä¿¡æ¯å°±å¯ä»¥å¨ä¸åçå¯¹è±¡ä¹é´å±äº«ã\n\nå¼æ¸æ¥äºç¯å¢åéçæ³¨å¥æ¹å¼ä¹åï¼è®©æä»¬ç¨ kubectl apply åå»ºpodï¼åç¨ kubectl exec è¿å¥podï¼éªè¯ç¯å¢åéæ¯å¦çæï¼\n\nkubectl apply -f env-pod.yml\nkubectl exec -it env-pod -- sh\n\necho $count\necho $greeting\necho $username $password\n\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿å¼ æªå¾å°±æ¾ç¤ºäºpodçè¿è¡ç»æï¼å¯ä»¥çå°å¨podéä½¿ç¨ echo å½ä»¤ç¡®å®è¾åºäºæä»¬å¨ä¸¤ä¸ªyamléå®ä¹çéç½®ä¿¡æ¯ï¼ä¹å°±è¯æpodå¯¹è±¡æåç»åäºconfigmapåsecretå¯¹è±¡ã\n\nä»¥ç¯å¢åéçæ¹å¼ä½¿ç¨configmap/secretè¿æ¯æ¯è¾ç®åçï¼ä¸é¢æ¥çç¬¬äºç§å è½½æä»¶çæ¹å¼ã\n\n# 4.2.2 ä»¥volumeçæ¹å¼ä½¿ç¨\n\nkubernetesä¸ºpodå®ä¹äºä¸ä¸ªâ volumeâçæ¦å¿µï¼å¯ä»¥ç¿»è¯ææ¯âå­å¨å·âãå¦ææpodçè§£ææ¯ä¸ä¸ªèææºï¼é£ä¹volumeå°±ç¸å½äºæ¯èææºéçç£çã\n\næä»¬å¯ä»¥ä¸ºpodâæè½½ï¼mountï¼âå¤ä¸ªvolumeï¼éé¢å­æ¾ä¾podè®¿é®çæ°æ®ï¼è¿ç§æ¹å¼æç¹ç±»ä¼¼ docker run -vï¼è½ç¶ç¨æ³å¤æäºä¸äºï¼ä½åè½ä¹ç¸åºå¼ºå¤§ä¸äºã\n\nå¨podéæè½½volumeå¾å®¹æï¼åªéè¦å¨â specâéå¢å ä¸ä¸ªâ volumesâå­æ®µï¼ç¶ååå®ä¹å·çåå­åå¼ç¨çconfigmap/secretå°±å¯ä»¥äºãè¦æ³¨æçæ¯volumeå±äºpodï¼ä¸å±äºå®¹å¨ï¼æä»¥å®åå­æ®µâcontainersâæ¯åçº§çï¼é½å±äºâspecâã\n\nä¸é¢æä»¬åå®ä¹ä¸¤ä¸ªvolumeï¼åå«å¼ç¨configmapåsecretï¼åå­æ¯ cm-vol å sec-volãæäºvolumeçå®ä¹ä¹åï¼å°±å¯ä»¥å¨å®¹å¨éæè½½äºï¼è¿è¦ç¨å°â volumemountsâå­æ®µï¼æ­£å¦å®çå­é¢å«ä¹ï¼å¯ä»¥æå®ä¹å¥½çvolumeæè½½å°å®¹å¨éçæä¸ªè·¯å¾ä¸ï¼æä»¥éè¦å¨éé¢ç¨â mountpathââ nameâæç¡®å°æå®æè½½è·¯å¾åvolumeçåå­ã\n\næâ volumesâåâ volumemountsâå­æ®µé½åå¥½ä¹åï¼éç½®ä¿¡æ¯å°±å¯ä»¥å è½½ææä»¶äºãä¸å¾è¡¨ç¤ºä»ä»¬ä¹é´çå¼ç¨å³ç³»ï¼\n\nä½ å¯ä»¥çå°ï¼æè½½volumeçæ¹å¼åç¯å¢åéåä¸å¤ªç¸åãç¯å¢åéæ¯ç´æ¥å¼ç¨äºconfigmap/secretï¼èvolumeåå¤å äºä¸ä¸ªç¯èï¼éè¦åç¨volumeå¼ç¨configmap/secretï¼ç¶åå¨å®¹å¨éæè½½volumeï¼æç¹âååå­ââå¼¯å¼¯ç»âã\n\nè¿ç§æ¹å¼çå¥½å¤å¨äºï¼ä»¥volumeçæ¦å¿µç»ä¸æ½è±¡äºææçå­å¨ï¼ä¸ä»ç°å¨æ¯æconfigmap/secretï¼ä»¥åè¿è½å¤æ¯æä¸´æ¶å·ãæä¹å·ãå¨æå·ãå¿«ç§å·ç­è®¸å¤å½¢å¼çå­å¨ï¼æ©å±æ§éå¸¸å¥½ã\n\nç°å¨ææpodçå®æ´yamlæè¿°ååºæ¥ï¼ç¶åä½¿ç¨ kubectl apply åå»ºå®ï¼\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\n\n\napiversion: v1\nkind: pod\nmetadata:\n  name: vol-pod11\n\nspec:\n  volumes:\n  - name: cm-vol\n    configmap:\n      name: info\n  - name: sec-vol\n    secret:\n      secretname: user1\n\n  containers:\n  - volumemounts:\n    - mountpath: /tmp/cm-items\n      name: cm-vol\n    - mountpath: /tmp/sec-items\n      name: sec-vol\n\n    image: busybox:latest\n    name: busy11\n    imagepullpolicy: ifnotpresent\n    command: ["/bin/sleep", "300"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\nåå»ºä¹åï¼æä»¬è¿æ¯ç¨ kubectl exec è¿å¥podï¼ççéç½®ä¿¡æ¯è¢«å è½½æäºä»ä¹å½¢å¼ï¼\n\nkubectl apply -f vol-pod.yml\nkubectl get pod\nkubectl exec -it vol-pod -- sh\n\n\n1\n2\n3\n\n\nä½ ä¼çå°ï¼configmapåsecreté½åæäºç®å½çå½¢å¼ï¼èå®ä»¬éé¢çkey-valueåæäºä¸ä¸ªä¸ªçæä»¶ï¼èæä»¶åå°±æ¯keyã(key => æä»¶åï¼value => æä»¶åå®¹)\n\nå ä¸ºè¿ç§å½¢å¼ä¸çå·®å¼ï¼ä»¥volumeçæ¹å¼æ¥ä½¿ç¨configmap/secretï¼å°±åç¯å¢åéä¸å¤ªä¸æ ·ãç¯å¢åéç¨æ³ç®åï¼æ´éåå­æ¾ç®ç­çå­ç¬¦ä¸²ï¼èvolumeæ´éåå­æ¾å¤§æ°æ®éçéç½®æä»¶ï¼å¨podéå è½½ææä»¶åè®©åºç¨ç´æ¥è¯»åä½¿ç¨ã\n\n\n# 4.3 å°ç»\n\nä»¥ä¸å­¦ä¹ äºä¸¤ç§å¨kuberneteséç®¡çéç½®ä¿¡æ¯çapiå¯¹è±¡configmapåsecretï¼å®ä»¬åå«ä»£è¡¨äºææä¿¡æ¯åæºå¯ææä¿¡æ¯ï¼å­å¨å¨etcdéï¼å¨éè¦çæ¶åå¯ä»¥æ³¨å¥podä¾podä½¿ç¨ã',charsets:{cjk:!0},lastUpdated:"2023/06/10, 02:04:21",lastUpdatedTimestamp:1686362661e3},{title:"Gitåºç¡",frontmatter:{title:"Gitåºç¡",date:"2022-03-29T08:34:25.000Z",permalink:"/pages/0d79ac/",categories:["å¼å","Git"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/5.Git/05.Git%E5%9F%BA%E7%A1%80.html",relativePath:"åºç¡/5.Git/05.Gitåºç¡.md",key:"v-31ed6925",path:"/pages/0d79ac/",headers:[{level:3,title:"1. ä¸ç§ç¶æ",slug:"_1-ä¸ç§ç¶æ",normalizedTitle:"1. ä¸ç§ç¶æ",charIndex:49},{level:3,title:"2. è·åGitä»åº",slug:"_2-è·ågitä»åº",normalizedTitle:"2. è·ågitä»åº",charIndex:687},{level:4,title:"2.1 å¨ç°æç®å½ä¸­åå§åä»åº",slug:"_2-1-å¨ç°æç®å½ä¸­åå§åä»åº",normalizedTitle:"2.1 å¨ç°æç®å½ä¸­åå§åä»åº",charIndex:775},{level:4,title:"2.2 åéç°æçä»åº",slug:"_2-2-åéç°æçä»åº",normalizedTitle:"2.2 åéç°æçä»åº",charIndex:1155},{level:3,title:"3.è®°å½æ¯æ¬¡æ´æ°å°ä»åº",slug:"_3-è®°å½æ¯æ¬¡æ´æ°å°ä»åº",normalizedTitle:"3.è®°å½æ¯æ¬¡æ´æ°å°ä»åº",charIndex:1500},{level:4,title:"3.1 æ£æ¥å½åæä»¶ç¶æ",slug:"_3-1-æ£æ¥å½åæä»¶ç¶æ",normalizedTitle:"3.1 æ£æ¥å½åæä»¶ç¶æ",charIndex:1790},{level:4,title:"3.2 è·è¸ªæ°æä»¶",slug:"_3-2-è·è¸ªæ°æä»¶",normalizedTitle:"3.2 è·è¸ªæ°æä»¶",charIndex:2131},{level:4,title:"3.3 æå­å·²ä¿®æ¹æä»¶",slug:"_3-3-æå­å·²ä¿®æ¹æä»¶",normalizedTitle:"3.3 æå­å·²ä¿®æ¹æä»¶",charIndex:2206},{level:4,title:"3.4 å¿½ç¥æä»¶",slug:"_3-4-å¿½ç¥æä»¶",normalizedTitle:"3.4 å¿½ç¥æä»¶",charIndex:2486},{level:4,title:"3.5 æ¥çå·²æå­åæªæå­çä¿®æ¹",slug:"_3-5-æ¥çå·²æå­åæªæå­çä¿®æ¹",normalizedTitle:"3.5 æ¥çå·²æå­åæªæå­çä¿®æ¹",charIndex:2645},{level:4,title:"3.6 æäº¤æ´æ°",slug:"_3-6-æäº¤æ´æ°",normalizedTitle:"3.6 æäº¤æ´æ°",charIndex:3062},{level:3,title:"4. æ¥çæäº¤åå²",slug:"_4-æ¥çæäº¤åå²",normalizedTitle:"4. æ¥çæäº¤åå²",charIndex:3465},{level:3,title:"5. æ¤æ¶æä½",slug:"_5-æ¤æ¶æä½",normalizedTitle:"5. æ¤æ¶æä½",charIndex:3933},{level:4,title:"5.1 åæ¶æå­çæä»¶",slug:"_5-1-åæ¶æå­çæä»¶",normalizedTitle:"5.1 åæ¶æå­çæä»¶",charIndex:4268},{level:4,title:"5.2 æ¤æ¶å¯¹æä»¶çä¿®æ¹",slug:"_5-2-æ¤æ¶å¯¹æä»¶çä¿®æ¹",normalizedTitle:"5.2 æ¤æ¶å¯¹æä»¶çä¿®æ¹",charIndex:5260}],headersStr:"1. ä¸ç§ç¶æ 2. è·åGitä»åº 2.1 å¨ç°æç®å½ä¸­åå§åä»åº 2.2 åéç°æçä»åº 3.è®°å½æ¯æ¬¡æ´æ°å°ä»åº 3.1 æ£æ¥å½åæä»¶ç¶æ 3.2 è·è¸ªæ°æä»¶ 3.3 æå­å·²ä¿®æ¹æä»¶ 3.4 å¿½ç¥æä»¶ 3.5 æ¥çå·²æå­åæªæå­çä¿®æ¹ 3.6 æäº¤æ´æ° 4. æ¥çæäº¤åå² 5. æ¤æ¶æä½ 5.1 åæ¶æå­çæä»¶ 5.2 æ¤æ¶å¯¹æä»¶çä¿®æ¹",content:'# Git åºç¡\n\nGit ä¿å­çä¸æ¯æä»¶çååæèå·®å¼ï¼èæ¯ä¸ç³»åä¸åæ¶å»çæä»¶å¿«ç§ã\n\n\n# 1. ä¸ç§ç¶æ\n\nGit æä¸ç§ç¶æï¼ä½ çæä»¶å¯è½å¤äºå¶ä¸­ä¹ä¸ï¼\n\n * å·²æäº¤ï¼committedï¼\n   \n   è¡¨ç¤ºæ°æ®å·²ç»å®å¨çä¿å­å¨æ¬å°æ°æ®åºä¸­ã\n\n * å·²ä¿®æ¹ï¼modifiedï¼\n   \n   è¡¨ç¤ºä¿®æ¹äºæä»¶ï¼ä½è¿æ²¡ä¿å­å°æ°æ®åºä¸­ã\n\n * å·²æå­ï¼stagedï¼\n   \n   è¡¨ç¤ºå¯¹ä¸ä¸ªå·²ä¿®æ¹æä»¶çå½åçæ¬åäºæ è®°ï¼ä½¿ä¹åå«å¨ä¸æ¬¡æäº¤çå¿«ç§ä¸­ã\n\nGit é¡¹ç®çä¸ä¸ªå·¥ä½åºåçæ¦å¿µï¼\n\n * Git ä»åº\n   \n   æ¯ Git ç¨æ¥ä¿å­é¡¹ç®çåæ°æ®åå¯¹è±¡æ°æ®åºçå°æ¹ã è¿æ¯ Git ä¸­æéè¦çé¨åï¼ä»å¶å®è®¡ç®æºåéä»åºæ¶ï¼æ·è´çå°±æ¯è¿éçæ°æ®ã\n\n * å·¥ä½ç®å½\n   \n   æ¯å¯¹é¡¹ç®çæä¸ªçæ¬ç¬ç«æååºæ¥çåå®¹ã è¿äºä» Git ä»åºçåç¼©æ°æ®åºä¸­æååºæ¥çæä»¶ï¼æ¾å¨ç£çä¸ä¾ä½ ä½¿ç¨æä¿®æ¹ã\n\n * æå­åºå\n   \n   æ¯ä¸ä¸ªæä»¶ï¼ä¿å­äºä¸æ¬¡å°æäº¤çæä»¶åè¡¨ä¿¡æ¯ï¼ä¸è¬å¨ Git ä»åºç®å½ä¸­ã ææ¶åä¹è¢«ç§°ä½âç´¢å¼âï¼ä¸è¿ä¸è¬è¯´æ³è¿æ¯å«æå­åºåã\n   \n   \n\nåºæ¬ç Git å·¥ä½æµç¨å¦ä¸ï¼\n\n 1. å¨å·¥ä½ç®å½ä¸­ä¿®æ¹æä»¶ã\n 2. æå­æä»¶ï¼å°æä»¶çå¿«ç§æ¾å¥æå­åºåã\n 3. æäº¤æ´æ°ï¼æ¾å°æå­åºåçæä»¶ï¼å°å¿«ç§æ°¸ä¹æ§å­å¨å° Git ä»åºç®å½ã\n\nå¦æ Git ç®å½ä¸­ä¿å­ççç¹å®çæ¬æä»¶ï¼å°±å±äºå·²æäº¤ç¶æã å¦æä½äºä¿®æ¹å¹¶å·²æ¾å¥æå­åºåï¼å°±å±äºå·²æå­ç¶æã å¦æèªä¸æ¬¡ååºåï¼ä½äºä¿®æ¹ä½è¿æ²¡ææ¾å°æå­åºåï¼å°±æ¯å·²ä¿®æ¹ç¶æã\n\n\n# 2. è·åGitä»åº\n\næä¸¤ç§åå¾ Git é¡¹ç®ä»åºçæ¹æ³ã ç¬¬ä¸ç§æ¯å¨ç°æé¡¹ç®æç®å½ä¸å¯¼å¥æææä»¶å° Git ä¸­ï¼ ç¬¬äºç§æ¯ä»ä¸ä¸ªæå¡å¨åéä¸ä¸ªç°æç Git ä»åºã\n\n# 2.1 å¨ç°æç®å½ä¸­åå§åä»åº\n\nå¦æä½ æç®ä½¿ç¨ Git æ¥å¯¹ç°æçé¡¹ç®è¿è¡ç®¡çï¼ä½ åªéè¦è¿å¥è¯¥é¡¹ç®ç®å½å¹¶è¾å¥ï¼\n\n$ git init\n\n\n1\n\n\nè¯¥å½ä»¤å°åå»ºä¸ä¸ªåä¸º .git çå­ç®å½ï¼è¿ä¸ªå­ç®å½å«æä½ åå§åç Git ä»åºä¸­ææçå¿é¡»æä»¶ï¼è¿äºæä»¶æ¯ Git ä»åºçéª¨å¹²ã ä½æ¯ï¼å¨è¿ä¸ªæ¶åï¼æä»¬ä»ä»æ¯åäºä¸ä¸ªåå§åçæä½ï¼ä½ çé¡¹ç®éçæä»¶è¿æ²¡æè¢«è·è¸ªã\n\nå¦æä½ æ¯å¨ä¸ä¸ªå·²ç»å­å¨æä»¶çæä»¶å¤¹ï¼èä¸æ¯ç©ºæä»¶å¤¹ï¼ä¸­åå§å Git ä»åºæ¥è¿è¡çæ¬æ§å¶çè¯ï¼ä½ åºè¯¥å¼å§è·è¸ªè¿äºæä»¶å¹¶æäº¤ã ä½ å¯éè¿ git add å½ä»¤æ¥å®ç°å¯¹æå®æä»¶çè·è¸ªï¼ç¶åæ§è¡ git commit æäº¤ï¼\n\n$ git add *.c\n$ git add LICENSE\n$ git commit -m \'initial project version\'\n\n\n1\n2\n3\n\n\n# 2.2 åéç°æçä»åº\n\nå¦æä½ æ³è·å¾ä¸ä»½å·²ç»å­å¨äºç Git ä»åºçæ·è´ï¼æ¯å¦è¯´ï¼ä½ æ³ä¸ºæä¸ªå¼æºé¡¹ç®è´¡ç®èªå·±çä¸ä»½åï¼è¿æ¶å°±è¦ç¨å° git clone å½ä»¤ã\n\nåéä»åºçå½ä»¤æ ¼å¼æ¯ git clone [url] ã æ¯å¦ï¼è¦åé Git çå¯é¾æ¥åº libgit2ï¼å¯ä»¥ç¨ä¸é¢çå½ä»¤ï¼\n\n$ git clone https://github.com/libgit2/libgit2\n\n\n1\n\n\nå¦æä½ æ³å¨åéè¿ç¨ä»åºçæ¶åï¼èªå®ä¹æ¬å°ä»åºçåå­ï¼ä½ å¯ä»¥ä½¿ç¨å¦ä¸å½ä»¤ï¼\n\n$ git clone https://github.com/libgit2/libgit2 mylibgit\n\n\n1\n\n\nè¿å°æ§è¡ä¸ä¸ä¸ä¸ªå½ä»¤ç¸åçæä½ï¼ä¸è¿å¨æ¬å°åå»ºçä»åºåå­åä¸º mylibgitã\n\n\n# 3.è®°å½æ¯æ¬¡æ´æ°å°ä»åº\n\nç°å¨æä»¬æä¸æäºä¸ä¸ªçå®é¡¹ç®ç Git ä»åºï¼å¹¶ä»è¿ä¸ªä»åºä¸­ååºäºæææä»¶çå·¥ä½æ·è´ã æ¥ä¸æ¥ï¼å¯¹è¿äºæä»¶åäºä¿®æ¹ï¼å¨å®æäºä¸ä¸ªé¶æ®µçç®æ ä¹åï¼æäº¤æ¬æ¬¡æ´æ°å°ä»åºã\n\nè¯·è®°ä½ï¼ä½ å·¥ä½ç®å½ä¸çæ¯ä¸ä¸ªæä»¶é½ä¸å¤ä¹è¿ä¸¤ç§ç¶æï¼å·²è·è¸ªææªè·è¸ªãå·²è·è¸ªçæä»¶æ¯æé£äºè¢«çº³å¥äºçæ¬æ§å¶çæä»¶ï¼å¨ä¸ä¸æ¬¡å¿«ç§ä¸­æå®ä»¬çè®°å½ï¼å¨å·¥ä½ä¸æ®µæ¶é´åï¼å®ä»¬çç¶æå¯è½å¤äºæªä¿®æ¹ï¼å·²ä¿®æ¹æå·²æ¾å¥æå­åºã\n\n\n\næ°å»ºä¸ä¸ªæä»¶ï¼æ­¤æ¶æ¯ Untracked ç¶æï¼è¥ä½¿ç¨git addå½ä»¤å°æä»¶æå­ï¼åæ¯ Staged ç¶æï¼æ­¤æ¶commitåä¼åä¸º Unmodified ç¶æã\n\n# 3.1 æ£æ¥å½åæä»¶ç¶æ\n\nè¦æ¥çåªäºæä»¶å¤äºä»ä¹ç¶æï¼å¯ä»¥ç¨ git status å½ä»¤ã\n\nè¿è¡ git status å½ä»¤ï¼åºç°å¨ Changes not staged for commit è¿è¡ä¸é¢ï¼è¯´æå·²è·è¸ªæä»¶çåå®¹åçäºååï¼ä½è¿æ²¡ææ¾å°æå­åºã è¦æå­è¿æ¬¡æ´æ°ï¼éè¦è¿è¡ git add å½ä»¤ã è¿æ¯ä¸ªå¤åè½å½ä»¤ï¼å¯ä»¥ç¨å®å¼å§è·è¸ªæ°æä»¶ï¼æèæå·²è·è¸ªçæä»¶æ¾å°æå­åºï¼è¿è½ç¨äºåå¹¶æ¶ææå²çªçæä»¶æ è®°ä¸ºå·²è§£å³ç¶æç­ã å°è¿ä¸ªå½ä»¤çè§£ä¸ºâæ·»å åå®¹å°ä¸ä¸æ¬¡æäº¤ä¸­âèä¸æ¯âå°ä¸ä¸ªæä»¶æ·»å å°é¡¹ç®ä¸­âè¦æ´å åéã\n\nåªè¦å¨ Changes to be committed è¿è¡ä¸é¢çï¼å°±è¯´ææ¯å·²æå­ç¶æã å¦ææ­¤æ¶æäº¤ï¼é£ä¹è¯¥æä»¶æ­¤æ¶æ­¤å»ççæ¬å°è¢«çå­å¨åå²è®°å½ä¸­ã\n\n# 3.2 è·è¸ªæ°æä»¶\n\nä½¿ç¨å½ä»¤ git add å¼å§è·è¸ªä¸ä¸ªæä»¶ãè¿è¡ git status å½ä»¤ï¼ä¼çå°ç¸åºçæä»¶å·²è¢«è·è¸ªï¼å¹¶å¤äºæå­ç¶æã\n\n# 3.3 æå­å·²ä¿®æ¹æä»¶\n\nå¦3.1ä¸­æè¿°è¿è¡æå­ï¼è¥git addä¹ååè¿è¡å¯¹ç¸å³æä»¶ï¼åè®¾æ¯CONTRIBUTING.mdï¼çä¿®æ¹ï¼è¦è¿è¡æäº¤ï¼æ­¤æ¶æä»¶ä¼åæ¶åºç°å¨æå­åºåéæå­åºãè¿æä¹å¯è½å¢ï¼ å¥½å§ï¼å®éä¸ Git åªä¸è¿æå­äºä½ è¿è¡ git add å½ä»¤æ¶ççæ¬ï¼ å¦æä½ ç°å¨æäº¤ï¼CONTRIBUTING.md ççæ¬æ¯ä½ æåä¸æ¬¡è¿è¡ git add å½ä»¤æ¶çé£ä¸ªçæ¬ï¼èä¸æ¯ä½ è¿è¡ git commit æ¶ï¼å¨å·¥ä½ç®å½ä¸­çå½åçæ¬ã æä»¥ï¼è¿è¡äº git add ä¹ååä½äºä¿®è®¢çæä»¶ï¼éè¦éæ°è¿è¡ git add æææ°çæ¬éæ°æå­èµ·æ¥ã\n\n# 3.4 å¿½ç¥æä»¶\n\nä¸è¬æä»¬æ»ä¼æäºæä»¶æ éçº³å¥ Git çç®¡çï¼ä¹ä¸å¸æå®ä»¬æ»åºç°å¨æªè·è¸ªæä»¶åè¡¨ã éå¸¸é½æ¯äºèªå¨çæçæä»¶ï¼æ¯å¦æ¥å¿æä»¶ï¼æèç¼è¯è¿ç¨ä¸­åå»ºçä¸´æ¶æä»¶ç­ã å¨è¿ç§æåµä¸ï¼æä»¬å¯ä»¥åå»ºä¸ä¸ªåä¸º .gitignore çæä»¶ï¼ååºè¦å¿½ç¥çæä»¶æ¨¡å¼ã\n\nè¯¦è§ãPro Git ä¸­æçï¼ç¬¬äºçï¼ã\n\n# 3.5 æ¥çå·²æå­åæªæå­çä¿®æ¹\n\nå¦æ git status å½ä»¤çè¾åºå¯¹äºä½ æ¥è¯´è¿äºæ¨¡ç³ï¼ä½ æ³ç¥éå·ä½ä¿®æ¹äºä»ä¹å°æ¹ï¼å¯ä»¥ç¨ git diff å½ä»¤ãéå¸¸ä¼ç¨å®æ¥åç­è¿ä¸¤ä¸ªé®é¢ï¼å½ååçåªäºæ´æ°è¿æ²¡ææå­ï¼ æåªäºæ´æ°å·²ç»æå­èµ·æ¥åå¤å¥½äºä¸æ¬¡æäº¤ï¼\n\nè¦æ¥çå°æªæå­çæä»¶æ´æ°äºåªäºé¨åï¼ä¸å åæ°ç´æ¥è¾å¥ git diffï¼æ­¤å½ä»¤æ¯è¾çæ¯å·¥ä½ç®å½ä¸­å½åæä»¶åæå­åºåå¿«ç§ä¹é´çå·®å¼ï¼ ä¹å°±æ¯ä¿®æ¹ä¹åè¿æ²¡ææå­èµ·æ¥çåååå®¹ã\n\nè¥è¦æ¥çå·²æå­çå°è¦æ·»å å°ä¸æ¬¡æäº¤éçåå®¹ï¼å¯ä»¥ç¨ git diff --cached å½ä»¤ãï¼Git 1.6.1 åæ´é«çæ¬è¿åè®¸ä½¿ç¨ git diff --stagedï¼æææ¯ç¸åçï¼ä½æ´å¥½è®°äºãï¼\n\nè¯·æ³¨æï¼git diff æ¬èº«åªæ¾ç¤ºå°æªæå­çæ¹å¨ï¼èä¸æ¯èªä¸æ¬¡æäº¤ä»¥æ¥æåçæææ¹å¨ã æä»¥ææ¶åä½ ä¸ä¸å­æå­äºæææ´æ°è¿çæä»¶åï¼è¿è¡ git diff åå´ä»ä¹ä¹æ²¡æï¼å°±æ¯è¿ä¸ªåå ã\n\n# 3.6 æäº¤æ´æ°\n\n 1. æ¯æ¬¡åå¤æäº¤åï¼åç¨ git status çä¸ï¼æ¯ä¸æ¯é½å·²æå­èµ·æ¥äºï¼ ç¶ååè¿è¡æäº¤å½ä»¤ git commitï¼\n\n$ git commit\n\n\n1\n\n\nè¿ç§æ¹å¼ä¼å¯å¨ææ¬ç¼è¾å¨ä»¥ä¾¿è¾å¥æ¬æ¬¡æäº¤çè¯´æã (é»è®¤ä¼å¯ç¨ shell çç¯å¢åé $EDITOR ææå®çè½¯ä»¶ï¼ä¸è¬é½æ¯ vim æ emacsã\n\n 2. å¯ä»¥å¨ commit å½ä»¤åæ·»å  -m éé¡¹ï¼å°æäº¤ä¿¡æ¯ä¸å½ä»¤æ¾å¨åä¸è¡ï¼\n\næäº¤åå®ä¼åè¯ä½ ï¼å½åæ¯å¨åªä¸ªåæ¯ï¼masterï¼æäº¤çï¼æ¬æ¬¡æäº¤çå®æ´ SHA-1 æ ¡éªåæ¯ä»ä¹ï¼463dc4fï¼ï¼ä»¥åå¨æ¬æ¬¡æäº¤ä¸­ï¼æå¤å°æä»¶ä¿®è®¢è¿ï¼å¤å°è¡æ·»å åå æ¹è¿ã\n\nè¯·è®°ä½ï¼æäº¤æ¶è®°å½çæ¯æ¾å¨æå­åºåçå¿«ç§ã ä»»ä½è¿æªæå­çä»ç¶ä¿æå·²ä¿®æ¹ç¶æï¼å¯ä»¥å¨ä¸æ¬¡æäº¤æ¶çº³å¥çæ¬ç®¡çã æ¯ä¸æ¬¡è¿è¡æäº¤æä½ï¼é½æ¯å¯¹ä½ é¡¹ç®ä½ä¸æ¬¡å¿«ç§ï¼ä»¥åå¯ä»¥åå°è¿ä¸ªç¶æï¼æèè¿è¡æ¯è¾ã\n\n\n# 4. æ¥çæäº¤åå²\n\nå®æè¿ä¸ªä»»å¡æç®åèåææçå·¥å·æ¯ git log å½ä»¤ã\n\né»è®¤ä¸ç¨ä»»ä½åæ°çè¯ï¼git log ä¼ææäº¤æ¶é´ååºææçæ´æ°ï¼æè¿çæ´æ°æå¨æä¸é¢ã æ­£å¦ä½ æçå°çï¼è¿ä¸ªå½ä»¤ä¼ååºæ¯ä¸ªæäº¤ç SHA-1 æ ¡éªåãä½èçåå­åçµå­é®ä»¶å°åãæäº¤æ¶é´ä»¥åæäº¤è¯´æã\n\ngit log æè®¸å¤éé¡¹å¯ä»¥å¸®å©ä½ æå¯»ä½ æè¦æ¾çæäº¤ï¼ æ¥ä¸æ¥æä»¬ä»ç»äºæå¸¸ç¨çã\n\n * ä¸ä¸ªå¸¸ç¨çéé¡¹æ¯ -pï¼ç¨æ¥æ¾ç¤ºæ¯æ¬¡æäº¤çåå®¹å·®å¼ã ä½ ä¹å¯ä»¥å ä¸ -2 æ¥ä»æ¾ç¤ºæè¿ä¸¤æ¬¡æäº¤ã\n * --stat éé¡¹å¨æ¯æ¬¡æäº¤çä¸é¢ååºé¢ææè¢«ä¿®æ¹è¿çæä»¶ãæå¤å°æä»¶è¢«ä¿®æ¹äºä»¥åè¢«ä¿®æ¹è¿çæä»¶çåªäºè¡è¢«ç§»é¤ææ¯æ·»å äºã å¨æ¯æ¬¡æäº¤çæåè¿æä¸ä¸ªæ»ç»ã\n * --prettyã è¿ä¸ªéé¡¹å¯ä»¥æå®ä½¿ç¨ä¸åäºé»è®¤æ ¼å¼çæ¹å¼å±ç¤ºæäº¤åå²ã è¿ä¸ªéé¡¹æä¸äºåå»ºçå­éé¡¹ä¾ä½ ä½¿ç¨ã æ¯å¦ç¨ oneline å°æ¯ä¸ªæäº¤æ¾å¨ä¸è¡æ¾ç¤ºï¼æ¥ççæäº¤æ°å¾å¤§æ¶éå¸¸æç¨ã å¦å¤è¿æ shortï¼full å fuller å¯ä»¥ç¨ï¼å±ç¤ºçä¿¡æ¯æå¤æå°æäºä¸åã\n\n\n# 5. æ¤æ¶æä½\n\nå¨ä»»ä½ä¸ä¸ªé¶æ®µï¼ä½ é½æå¯è½æ³è¦æ¤æ¶æäºæä½ã è¿éï¼æä»¬å°ä¼å­¦ä¹ å ä¸ªæ¤æ¶ä½ æåä¿®æ¹çåºæ¬å·¥å·ã æ³¨æï¼æäºæ¤æ¶æä½æ¯ä¸å¯éçã è¿æ¯å¨ä½¿ç¨ Git çè¿ç¨ä¸­ï¼ä¼å ä¸ºæä½å¤±è¯¯èå¯¼è´ä¹åçå·¥ä½ä¸¢å¤±çå°æçå ä¸ªå°æ¹ä¹ä¸ã\n\nææ¶åæä»¬æäº¤å®äºæåç°æ¼æäºå ä¸ªæä»¶æ²¡ææ·»å ï¼æèæäº¤ä¿¡æ¯åéäºã æ­¤æ¶ï¼å¯ä»¥è¿è¡å¸¦æ --amend éé¡¹çæäº¤å½ä»¤å°è¯éæ°æäº¤ï¼\n\n$ git commit --amend\n\n\n1\n\n\nè¿ä¸ªå½ä»¤ä¼å°æå­åºä¸­çæä»¶æäº¤ã å¦æèªä¸æ¬¡æäº¤ä»¥æ¥ä½ è¿æªåä»»ä½ä¿®æ¹ï¼ä¾å¦ï¼å¨ä¸æ¬¡æäº¤åé©¬ä¸æ§è¡äºæ­¤å½ä»¤ï¼ï¼é£ä¹å¿«ç§ä¼ä¿æä¸åï¼èä½ æä¿®æ¹çåªæ¯æäº¤ä¿¡æ¯ã\n\nææ¬ç¼è¾å¨å¯å¨åï¼å¯ä»¥çå°ä¹åçæäº¤ä¿¡æ¯ã ç¼è¾åä¿å­ä¼è¦çåæ¥çæäº¤ä¿¡æ¯ã\n\n# 5.1 åæ¶æå­çæä»¶\n\næ¥ä¸æ¥çä¸¤ä¸ªå°èæ¼ç¤ºå¦ä½æä½æå­åºåä¸å·¥ä½ç®å½ä¸­å·²ä¿®æ¹çæä»¶ã è¿äºå½ä»¤å¨ä¿®æ¹æä»¶ç¶æçåæ¶ï¼ä¹ä¼æç¤ºå¦ä½æ¤æ¶æä½ã ä¾å¦ï¼ä½ å·²ç»ä¿®æ¹äºä¸¤ä¸ªæä»¶å¹¶ä¸æ³è¦å°å®ä»¬ä½ä¸ºä¸¤æ¬¡ç¬ç«çä¿®æ¹æäº¤ï¼ä½æ¯å´æå¤å°è¾å¥äº git add * æå­äºå®ä»¬ä¸¤ä¸ªã å¦ä½åªåæ¶æå­ä¸¤ä¸ªä¸­çä¸ä¸ªå¢ï¼ git status å½ä»¤æç¤ºäºä½ ï¼\n\n$ git add *\n$ git status\nOn branch master\nChanges to be committed:\n  (use "git reset HEAD <file>..." to unstage)\n\n    renamed:    README.md -> README\n    modified:   CONTRIBUTING.md\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨ âChanges to be committedâ æå­æ­£ä¸æ¹ï¼æç¤ºä½¿ç¨ git reset HEAD <file>... æ¥åæ¶æå­ã æä»¥ï¼æä»¬å¯ä»¥è¿æ ·æ¥åæ¶æå­ CONTRIBUTING.md æä»¶ï¼\n\n$ git reset HEAD CONTRIBUTING.md\nUnstaged changes after reset:\nM\tCONTRIBUTING.md\n$ git status\nOn branch master\nChanges to be committed:\n  (use "git reset HEAD <file>..." to unstage)\n\n    renamed:    README.md -> README\n\nChanges not staged for commit:\n  (use "git add <file>..." to update what will be committed)\n  (use "git checkout -- <file>..." to discard changes in working directory)\n\n    modified:   CONTRIBUTING.md\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿ä¸ªå½ä»¤æç¹å¿å¥æªï¼ä½æ¯èµ·ä½ç¨äºã CONTRIBUTING.md æä»¶å·²ç»æ¯ä¿®æ¹æªæå­çç¶æäºã\n\n# 5.2 æ¤æ¶å¯¹æä»¶çä¿®æ¹\n\nå¦æä½ å¹¶ä¸æ³ä¿çå¯¹ CONTRIBUTING.md æä»¶çä¿®æ¹æä¹åï¼ ä½ è¯¥å¦ä½æ¹ä¾¿å°æ¤æ¶ä¿®æ¹ - å°å®è¿åæä¸æ¬¡æäº¤æ¶çæ ·å­ï¼æèååéå®çæ ·å­ï¼æèåæå®æ¾å¥å·¥ä½ç®å½æ¶çæ ·å­ï¼ï¼ å¹¸è¿çæ¯ï¼git status ä¹åè¯äºä½ åºè¯¥å¦ä½åã\n\nè®°ä½ï¼å¨ Git ä¸­ä»»ä½ å·²æäº¤ç ä¸è¥¿å ä¹æ»æ¯å¯ä»¥æ¢å¤çã çè³é£äºè¢«å é¤çåæ¯ä¸­çæäº¤æä½¿ç¨ --amend éé¡¹è¦ççæäº¤ä¹å¯ä»¥æ¢å¤ï¼éè¯» æ°æ®æ¢å¤ äºè§£æ°æ®æ¢å¤ï¼ã ç¶èï¼ä»»ä½ä½ æªæäº¤çä¸è¥¿ä¸¢å¤±åå¾å¯è½åä¹æ¾ä¸å°äºã\n\n> å¨æï¼ å¦ä½æ°å»ºä¸ä¸ªgiteeä»åº_å°æçåå®¢-CSDNåå®¢_giteeåå»ºä»åº',normalizedContent:'# git åºç¡\n\ngit ä¿å­çä¸æ¯æä»¶çååæèå·®å¼ï¼èæ¯ä¸ç³»åä¸åæ¶å»çæä»¶å¿«ç§ã\n\n\n# 1. ä¸ç§ç¶æ\n\ngit æä¸ç§ç¶æï¼ä½ çæä»¶å¯è½å¤äºå¶ä¸­ä¹ä¸ï¼\n\n * å·²æäº¤ï¼committedï¼\n   \n   è¡¨ç¤ºæ°æ®å·²ç»å®å¨çä¿å­å¨æ¬å°æ°æ®åºä¸­ã\n\n * å·²ä¿®æ¹ï¼modifiedï¼\n   \n   è¡¨ç¤ºä¿®æ¹äºæä»¶ï¼ä½è¿æ²¡ä¿å­å°æ°æ®åºä¸­ã\n\n * å·²æå­ï¼stagedï¼\n   \n   è¡¨ç¤ºå¯¹ä¸ä¸ªå·²ä¿®æ¹æä»¶çå½åçæ¬åäºæ è®°ï¼ä½¿ä¹åå«å¨ä¸æ¬¡æäº¤çå¿«ç§ä¸­ã\n\ngit é¡¹ç®çä¸ä¸ªå·¥ä½åºåçæ¦å¿µï¼\n\n * git ä»åº\n   \n   æ¯ git ç¨æ¥ä¿å­é¡¹ç®çåæ°æ®åå¯¹è±¡æ°æ®åºçå°æ¹ã è¿æ¯ git ä¸­æéè¦çé¨åï¼ä»å¶å®è®¡ç®æºåéä»åºæ¶ï¼æ·è´çå°±æ¯è¿éçæ°æ®ã\n\n * å·¥ä½ç®å½\n   \n   æ¯å¯¹é¡¹ç®çæä¸ªçæ¬ç¬ç«æååºæ¥çåå®¹ã è¿äºä» git ä»åºçåç¼©æ°æ®åºä¸­æååºæ¥çæä»¶ï¼æ¾å¨ç£çä¸ä¾ä½ ä½¿ç¨æä¿®æ¹ã\n\n * æå­åºå\n   \n   æ¯ä¸ä¸ªæä»¶ï¼ä¿å­äºä¸æ¬¡å°æäº¤çæä»¶åè¡¨ä¿¡æ¯ï¼ä¸è¬å¨ git ä»åºç®å½ä¸­ã ææ¶åä¹è¢«ç§°ä½âç´¢å¼âï¼ä¸è¿ä¸è¬è¯´æ³è¿æ¯å«æå­åºåã\n   \n   \n\nåºæ¬ç git å·¥ä½æµç¨å¦ä¸ï¼\n\n 1. å¨å·¥ä½ç®å½ä¸­ä¿®æ¹æä»¶ã\n 2. æå­æä»¶ï¼å°æä»¶çå¿«ç§æ¾å¥æå­åºåã\n 3. æäº¤æ´æ°ï¼æ¾å°æå­åºåçæä»¶ï¼å°å¿«ç§æ°¸ä¹æ§å­å¨å° git ä»åºç®å½ã\n\nå¦æ git ç®å½ä¸­ä¿å­ççç¹å®çæ¬æä»¶ï¼å°±å±äºå·²æäº¤ç¶æã å¦æä½äºä¿®æ¹å¹¶å·²æ¾å¥æå­åºåï¼å°±å±äºå·²æå­ç¶æã å¦æèªä¸æ¬¡ååºåï¼ä½äºä¿®æ¹ä½è¿æ²¡ææ¾å°æå­åºåï¼å°±æ¯å·²ä¿®æ¹ç¶æã\n\n\n# 2. è·ågitä»åº\n\næä¸¤ç§åå¾ git é¡¹ç®ä»åºçæ¹æ³ã ç¬¬ä¸ç§æ¯å¨ç°æé¡¹ç®æç®å½ä¸å¯¼å¥æææä»¶å° git ä¸­ï¼ ç¬¬äºç§æ¯ä»ä¸ä¸ªæå¡å¨åéä¸ä¸ªç°æç git ä»åºã\n\n# 2.1 å¨ç°æç®å½ä¸­åå§åä»åº\n\nå¦æä½ æç®ä½¿ç¨ git æ¥å¯¹ç°æçé¡¹ç®è¿è¡ç®¡çï¼ä½ åªéè¦è¿å¥è¯¥é¡¹ç®ç®å½å¹¶è¾å¥ï¼\n\n$ git init\n\n\n1\n\n\nè¯¥å½ä»¤å°åå»ºä¸ä¸ªåä¸º .git çå­ç®å½ï¼è¿ä¸ªå­ç®å½å«æä½ åå§åç git ä»åºä¸­ææçå¿é¡»æä»¶ï¼è¿äºæä»¶æ¯ git ä»åºçéª¨å¹²ã ä½æ¯ï¼å¨è¿ä¸ªæ¶åï¼æä»¬ä»ä»æ¯åäºä¸ä¸ªåå§åçæä½ï¼ä½ çé¡¹ç®éçæä»¶è¿æ²¡æè¢«è·è¸ªã\n\nå¦æä½ æ¯å¨ä¸ä¸ªå·²ç»å­å¨æä»¶çæä»¶å¤¹ï¼èä¸æ¯ç©ºæä»¶å¤¹ï¼ä¸­åå§å git ä»åºæ¥è¿è¡çæ¬æ§å¶çè¯ï¼ä½ åºè¯¥å¼å§è·è¸ªè¿äºæä»¶å¹¶æäº¤ã ä½ å¯éè¿ git add å½ä»¤æ¥å®ç°å¯¹æå®æä»¶çè·è¸ªï¼ç¶åæ§è¡ git commit æäº¤ï¼\n\n$ git add *.c\n$ git add license\n$ git commit -m \'initial project version\'\n\n\n1\n2\n3\n\n\n# 2.2 åéç°æçä»åº\n\nå¦æä½ æ³è·å¾ä¸ä»½å·²ç»å­å¨äºç git ä»åºçæ·è´ï¼æ¯å¦è¯´ï¼ä½ æ³ä¸ºæä¸ªå¼æºé¡¹ç®è´¡ç®èªå·±çä¸ä»½åï¼è¿æ¶å°±è¦ç¨å° git clone å½ä»¤ã\n\nåéä»åºçå½ä»¤æ ¼å¼æ¯ git clone [url] ã æ¯å¦ï¼è¦åé git çå¯é¾æ¥åº libgit2ï¼å¯ä»¥ç¨ä¸é¢çå½ä»¤ï¼\n\n$ git clone https://github.com/libgit2/libgit2\n\n\n1\n\n\nå¦æä½ æ³å¨åéè¿ç¨ä»åºçæ¶åï¼èªå®ä¹æ¬å°ä»åºçåå­ï¼ä½ å¯ä»¥ä½¿ç¨å¦ä¸å½ä»¤ï¼\n\n$ git clone https://github.com/libgit2/libgit2 mylibgit\n\n\n1\n\n\nè¿å°æ§è¡ä¸ä¸ä¸ä¸ªå½ä»¤ç¸åçæä½ï¼ä¸è¿å¨æ¬å°åå»ºçä»åºåå­åä¸º mylibgitã\n\n\n# 3.è®°å½æ¯æ¬¡æ´æ°å°ä»åº\n\nç°å¨æä»¬æä¸æäºä¸ä¸ªçå®é¡¹ç®ç git ä»åºï¼å¹¶ä»è¿ä¸ªä»åºä¸­ååºäºæææä»¶çå·¥ä½æ·è´ã æ¥ä¸æ¥ï¼å¯¹è¿äºæä»¶åäºä¿®æ¹ï¼å¨å®æäºä¸ä¸ªé¶æ®µçç®æ ä¹åï¼æäº¤æ¬æ¬¡æ´æ°å°ä»åºã\n\nè¯·è®°ä½ï¼ä½ å·¥ä½ç®å½ä¸çæ¯ä¸ä¸ªæä»¶é½ä¸å¤ä¹è¿ä¸¤ç§ç¶æï¼å·²è·è¸ªææªè·è¸ªãå·²è·è¸ªçæä»¶æ¯æé£äºè¢«çº³å¥äºçæ¬æ§å¶çæä»¶ï¼å¨ä¸ä¸æ¬¡å¿«ç§ä¸­æå®ä»¬çè®°å½ï¼å¨å·¥ä½ä¸æ®µæ¶é´åï¼å®ä»¬çç¶æå¯è½å¤äºæªä¿®æ¹ï¼å·²ä¿®æ¹æå·²æ¾å¥æå­åºã\n\n\n\næ°å»ºä¸ä¸ªæä»¶ï¼æ­¤æ¶æ¯ untracked ç¶æï¼è¥ä½¿ç¨git addå½ä»¤å°æä»¶æå­ï¼åæ¯ staged ç¶æï¼æ­¤æ¶commitåä¼åä¸º unmodified ç¶æã\n\n# 3.1 æ£æ¥å½åæä»¶ç¶æ\n\nè¦æ¥çåªäºæä»¶å¤äºä»ä¹ç¶æï¼å¯ä»¥ç¨ git status å½ä»¤ã\n\nè¿è¡ git status å½ä»¤ï¼åºç°å¨ changes not staged for commit è¿è¡ä¸é¢ï¼è¯´æå·²è·è¸ªæä»¶çåå®¹åçäºååï¼ä½è¿æ²¡ææ¾å°æå­åºã è¦æå­è¿æ¬¡æ´æ°ï¼éè¦è¿è¡ git add å½ä»¤ã è¿æ¯ä¸ªå¤åè½å½ä»¤ï¼å¯ä»¥ç¨å®å¼å§è·è¸ªæ°æä»¶ï¼æèæå·²è·è¸ªçæä»¶æ¾å°æå­åºï¼è¿è½ç¨äºåå¹¶æ¶ææå²çªçæä»¶æ è®°ä¸ºå·²è§£å³ç¶æç­ã å°è¿ä¸ªå½ä»¤çè§£ä¸ºâæ·»å åå®¹å°ä¸ä¸æ¬¡æäº¤ä¸­âèä¸æ¯âå°ä¸ä¸ªæä»¶æ·»å å°é¡¹ç®ä¸­âè¦æ´å åéã\n\nåªè¦å¨ changes to be committed è¿è¡ä¸é¢çï¼å°±è¯´ææ¯å·²æå­ç¶æã å¦ææ­¤æ¶æäº¤ï¼é£ä¹è¯¥æä»¶æ­¤æ¶æ­¤å»ççæ¬å°è¢«çå­å¨åå²è®°å½ä¸­ã\n\n# 3.2 è·è¸ªæ°æä»¶\n\nä½¿ç¨å½ä»¤ git add å¼å§è·è¸ªä¸ä¸ªæä»¶ãè¿è¡ git status å½ä»¤ï¼ä¼çå°ç¸åºçæä»¶å·²è¢«è·è¸ªï¼å¹¶å¤äºæå­ç¶æã\n\n# 3.3 æå­å·²ä¿®æ¹æä»¶\n\nå¦3.1ä¸­æè¿°è¿è¡æå­ï¼è¥git addä¹ååè¿è¡å¯¹ç¸å³æä»¶ï¼åè®¾æ¯contributing.mdï¼çä¿®æ¹ï¼è¦è¿è¡æäº¤ï¼æ­¤æ¶æä»¶ä¼åæ¶åºç°å¨æå­åºåéæå­åºãè¿æä¹å¯è½å¢ï¼ å¥½å§ï¼å®éä¸ git åªä¸è¿æå­äºä½ è¿è¡ git add å½ä»¤æ¶ççæ¬ï¼ å¦æä½ ç°å¨æäº¤ï¼contributing.md ççæ¬æ¯ä½ æåä¸æ¬¡è¿è¡ git add å½ä»¤æ¶çé£ä¸ªçæ¬ï¼èä¸æ¯ä½ è¿è¡ git commit æ¶ï¼å¨å·¥ä½ç®å½ä¸­çå½åçæ¬ã æä»¥ï¼è¿è¡äº git add ä¹ååä½äºä¿®è®¢çæä»¶ï¼éè¦éæ°è¿è¡ git add æææ°çæ¬éæ°æå­èµ·æ¥ã\n\n# 3.4 å¿½ç¥æä»¶\n\nä¸è¬æä»¬æ»ä¼æäºæä»¶æ éçº³å¥ git çç®¡çï¼ä¹ä¸å¸æå®ä»¬æ»åºç°å¨æªè·è¸ªæä»¶åè¡¨ã éå¸¸é½æ¯äºèªå¨çæçæä»¶ï¼æ¯å¦æ¥å¿æä»¶ï¼æèç¼è¯è¿ç¨ä¸­åå»ºçä¸´æ¶æä»¶ç­ã å¨è¿ç§æåµä¸ï¼æä»¬å¯ä»¥åå»ºä¸ä¸ªåä¸º .gitignore çæä»¶ï¼ååºè¦å¿½ç¥çæä»¶æ¨¡å¼ã\n\nè¯¦è§ãpro git ä¸­æçï¼ç¬¬äºçï¼ã\n\n# 3.5 æ¥çå·²æå­åæªæå­çä¿®æ¹\n\nå¦æ git status å½ä»¤çè¾åºå¯¹äºä½ æ¥è¯´è¿äºæ¨¡ç³ï¼ä½ æ³ç¥éå·ä½ä¿®æ¹äºä»ä¹å°æ¹ï¼å¯ä»¥ç¨ git diff å½ä»¤ãéå¸¸ä¼ç¨å®æ¥åç­è¿ä¸¤ä¸ªé®é¢ï¼å½ååçåªäºæ´æ°è¿æ²¡ææå­ï¼ æåªäºæ´æ°å·²ç»æå­èµ·æ¥åå¤å¥½äºä¸æ¬¡æäº¤ï¼\n\nè¦æ¥çå°æªæå­çæä»¶æ´æ°äºåªäºé¨åï¼ä¸å åæ°ç´æ¥è¾å¥ git diffï¼æ­¤å½ä»¤æ¯è¾çæ¯å·¥ä½ç®å½ä¸­å½åæä»¶åæå­åºåå¿«ç§ä¹é´çå·®å¼ï¼ ä¹å°±æ¯ä¿®æ¹ä¹åè¿æ²¡ææå­èµ·æ¥çåååå®¹ã\n\nè¥è¦æ¥çå·²æå­çå°è¦æ·»å å°ä¸æ¬¡æäº¤éçåå®¹ï¼å¯ä»¥ç¨ git diff --cached å½ä»¤ãï¼git 1.6.1 åæ´é«çæ¬è¿åè®¸ä½¿ç¨ git diff --stagedï¼æææ¯ç¸åçï¼ä½æ´å¥½è®°äºãï¼\n\nè¯·æ³¨æï¼git diff æ¬èº«åªæ¾ç¤ºå°æªæå­çæ¹å¨ï¼èä¸æ¯èªä¸æ¬¡æäº¤ä»¥æ¥æåçæææ¹å¨ã æä»¥ææ¶åä½ ä¸ä¸å­æå­äºæææ´æ°è¿çæä»¶åï¼è¿è¡ git diff åå´ä»ä¹ä¹æ²¡æï¼å°±æ¯è¿ä¸ªåå ã\n\n# 3.6 æäº¤æ´æ°\n\n 1. æ¯æ¬¡åå¤æäº¤åï¼åç¨ git status çä¸ï¼æ¯ä¸æ¯é½å·²æå­èµ·æ¥äºï¼ ç¶ååè¿è¡æäº¤å½ä»¤ git commitï¼\n\n$ git commit\n\n\n1\n\n\nè¿ç§æ¹å¼ä¼å¯å¨ææ¬ç¼è¾å¨ä»¥ä¾¿è¾å¥æ¬æ¬¡æäº¤çè¯´æã (é»è®¤ä¼å¯ç¨ shell çç¯å¢åé $editor ææå®çè½¯ä»¶ï¼ä¸è¬é½æ¯ vim æ emacsã\n\n 2. å¯ä»¥å¨ commit å½ä»¤åæ·»å  -m éé¡¹ï¼å°æäº¤ä¿¡æ¯ä¸å½ä»¤æ¾å¨åä¸è¡ï¼\n\næäº¤åå®ä¼åè¯ä½ ï¼å½åæ¯å¨åªä¸ªåæ¯ï¼masterï¼æäº¤çï¼æ¬æ¬¡æäº¤çå®æ´ sha-1 æ ¡éªåæ¯ä»ä¹ï¼463dc4fï¼ï¼ä»¥åå¨æ¬æ¬¡æäº¤ä¸­ï¼æå¤å°æä»¶ä¿®è®¢è¿ï¼å¤å°è¡æ·»å åå æ¹è¿ã\n\nè¯·è®°ä½ï¼æäº¤æ¶è®°å½çæ¯æ¾å¨æå­åºåçå¿«ç§ã ä»»ä½è¿æªæå­çä»ç¶ä¿æå·²ä¿®æ¹ç¶æï¼å¯ä»¥å¨ä¸æ¬¡æäº¤æ¶çº³å¥çæ¬ç®¡çã æ¯ä¸æ¬¡è¿è¡æäº¤æä½ï¼é½æ¯å¯¹ä½ é¡¹ç®ä½ä¸æ¬¡å¿«ç§ï¼ä»¥åå¯ä»¥åå°è¿ä¸ªç¶æï¼æèè¿è¡æ¯è¾ã\n\n\n# 4. æ¥çæäº¤åå²\n\nå®æè¿ä¸ªä»»å¡æç®åèåææçå·¥å·æ¯ git log å½ä»¤ã\n\né»è®¤ä¸ç¨ä»»ä½åæ°çè¯ï¼git log ä¼ææäº¤æ¶é´ååºææçæ´æ°ï¼æè¿çæ´æ°æå¨æä¸é¢ã æ­£å¦ä½ æçå°çï¼è¿ä¸ªå½ä»¤ä¼ååºæ¯ä¸ªæäº¤ç sha-1 æ ¡éªåãä½èçåå­åçµå­é®ä»¶å°åãæäº¤æ¶é´ä»¥åæäº¤è¯´æã\n\ngit log æè®¸å¤éé¡¹å¯ä»¥å¸®å©ä½ æå¯»ä½ æè¦æ¾çæäº¤ï¼ æ¥ä¸æ¥æä»¬ä»ç»äºæå¸¸ç¨çã\n\n * ä¸ä¸ªå¸¸ç¨çéé¡¹æ¯ -pï¼ç¨æ¥æ¾ç¤ºæ¯æ¬¡æäº¤çåå®¹å·®å¼ã ä½ ä¹å¯ä»¥å ä¸ -2 æ¥ä»æ¾ç¤ºæè¿ä¸¤æ¬¡æäº¤ã\n * --stat éé¡¹å¨æ¯æ¬¡æäº¤çä¸é¢ååºé¢ææè¢«ä¿®æ¹è¿çæä»¶ãæå¤å°æä»¶è¢«ä¿®æ¹äºä»¥åè¢«ä¿®æ¹è¿çæä»¶çåªäºè¡è¢«ç§»é¤ææ¯æ·»å äºã å¨æ¯æ¬¡æäº¤çæåè¿æä¸ä¸ªæ»ç»ã\n * --prettyã è¿ä¸ªéé¡¹å¯ä»¥æå®ä½¿ç¨ä¸åäºé»è®¤æ ¼å¼çæ¹å¼å±ç¤ºæäº¤åå²ã è¿ä¸ªéé¡¹æä¸äºåå»ºçå­éé¡¹ä¾ä½ ä½¿ç¨ã æ¯å¦ç¨ oneline å°æ¯ä¸ªæäº¤æ¾å¨ä¸è¡æ¾ç¤ºï¼æ¥ççæäº¤æ°å¾å¤§æ¶éå¸¸æç¨ã å¦å¤è¿æ shortï¼full å fuller å¯ä»¥ç¨ï¼å±ç¤ºçä¿¡æ¯æå¤æå°æäºä¸åã\n\n\n# 5. æ¤æ¶æä½\n\nå¨ä»»ä½ä¸ä¸ªé¶æ®µï¼ä½ é½æå¯è½æ³è¦æ¤æ¶æäºæä½ã è¿éï¼æä»¬å°ä¼å­¦ä¹ å ä¸ªæ¤æ¶ä½ æåä¿®æ¹çåºæ¬å·¥å·ã æ³¨æï¼æäºæ¤æ¶æä½æ¯ä¸å¯éçã è¿æ¯å¨ä½¿ç¨ git çè¿ç¨ä¸­ï¼ä¼å ä¸ºæä½å¤±è¯¯èå¯¼è´ä¹åçå·¥ä½ä¸¢å¤±çå°æçå ä¸ªå°æ¹ä¹ä¸ã\n\nææ¶åæä»¬æäº¤å®äºæåç°æ¼æäºå ä¸ªæä»¶æ²¡ææ·»å ï¼æèæäº¤ä¿¡æ¯åéäºã æ­¤æ¶ï¼å¯ä»¥è¿è¡å¸¦æ --amend éé¡¹çæäº¤å½ä»¤å°è¯éæ°æäº¤ï¼\n\n$ git commit --amend\n\n\n1\n\n\nè¿ä¸ªå½ä»¤ä¼å°æå­åºä¸­çæä»¶æäº¤ã å¦æèªä¸æ¬¡æäº¤ä»¥æ¥ä½ è¿æªåä»»ä½ä¿®æ¹ï¼ä¾å¦ï¼å¨ä¸æ¬¡æäº¤åé©¬ä¸æ§è¡äºæ­¤å½ä»¤ï¼ï¼é£ä¹å¿«ç§ä¼ä¿æä¸åï¼èä½ æä¿®æ¹çåªæ¯æäº¤ä¿¡æ¯ã\n\nææ¬ç¼è¾å¨å¯å¨åï¼å¯ä»¥çå°ä¹åçæäº¤ä¿¡æ¯ã ç¼è¾åä¿å­ä¼è¦çåæ¥çæäº¤ä¿¡æ¯ã\n\n# 5.1 åæ¶æå­çæä»¶\n\næ¥ä¸æ¥çä¸¤ä¸ªå°èæ¼ç¤ºå¦ä½æä½æå­åºåä¸å·¥ä½ç®å½ä¸­å·²ä¿®æ¹çæä»¶ã è¿äºå½ä»¤å¨ä¿®æ¹æä»¶ç¶æçåæ¶ï¼ä¹ä¼æç¤ºå¦ä½æ¤æ¶æä½ã ä¾å¦ï¼ä½ å·²ç»ä¿®æ¹äºä¸¤ä¸ªæä»¶å¹¶ä¸æ³è¦å°å®ä»¬ä½ä¸ºä¸¤æ¬¡ç¬ç«çä¿®æ¹æäº¤ï¼ä½æ¯å´æå¤å°è¾å¥äº git add * æå­äºå®ä»¬ä¸¤ä¸ªã å¦ä½åªåæ¶æå­ä¸¤ä¸ªä¸­çä¸ä¸ªå¢ï¼ git status å½ä»¤æç¤ºäºä½ ï¼\n\n$ git add *\n$ git status\non branch master\nchanges to be committed:\n  (use "git reset head <file>..." to unstage)\n\n    renamed:    readme.md -> readme\n    modified:   contributing.md\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå¨ âchanges to be committedâ æå­æ­£ä¸æ¹ï¼æç¤ºä½¿ç¨ git reset head <file>... æ¥åæ¶æå­ã æä»¥ï¼æä»¬å¯ä»¥è¿æ ·æ¥åæ¶æå­ contributing.md æä»¶ï¼\n\n$ git reset head contributing.md\nunstaged changes after reset:\nm\tcontributing.md\n$ git status\non branch master\nchanges to be committed:\n  (use "git reset head <file>..." to unstage)\n\n    renamed:    readme.md -> readme\n\nchanges not staged for commit:\n  (use "git add <file>..." to update what will be committed)\n  (use "git checkout -- <file>..." to discard changes in working directory)\n\n    modified:   contributing.md\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿ä¸ªå½ä»¤æç¹å¿å¥æªï¼ä½æ¯èµ·ä½ç¨äºã contributing.md æä»¶å·²ç»æ¯ä¿®æ¹æªæå­çç¶æäºã\n\n# 5.2 æ¤æ¶å¯¹æä»¶çä¿®æ¹\n\nå¦æä½ å¹¶ä¸æ³ä¿çå¯¹ contributing.md æä»¶çä¿®æ¹æä¹åï¼ ä½ è¯¥å¦ä½æ¹ä¾¿å°æ¤æ¶ä¿®æ¹ - å°å®è¿åæä¸æ¬¡æäº¤æ¶çæ ·å­ï¼æèååéå®çæ ·å­ï¼æèåæå®æ¾å¥å·¥ä½ç®å½æ¶çæ ·å­ï¼ï¼ å¹¸è¿çæ¯ï¼git status ä¹åè¯äºä½ åºè¯¥å¦ä½åã\n\nè®°ä½ï¼å¨ git ä¸­ä»»ä½ å·²æäº¤ç ä¸è¥¿å ä¹æ»æ¯å¯ä»¥æ¢å¤çã çè³é£äºè¢«å é¤çåæ¯ä¸­çæäº¤æä½¿ç¨ --amend éé¡¹è¦ççæäº¤ä¹å¯ä»¥æ¢å¤ï¼éè¯» æ°æ®æ¢å¤ äºè§£æ°æ®æ¢å¤ï¼ã ç¶èï¼ä»»ä½ä½ æªæäº¤çä¸è¥¿ä¸¢å¤±åå¾å¯è½åä¹æ¾ä¸å°äºã\n\n> å¨æï¼ å¦ä½æ°å»ºä¸ä¸ªgiteeä»åº_å°æçåå®¢-csdnåå®¢_giteeåå»ºä»åº',charsets:{cjk:!0},lastUpdated:"2022/08/02, 02:37:31",lastUpdatedTimestamp:1659407851e3},{title:"Gitçä½¿ç¨",frontmatter:{title:"Gitçä½¿ç¨",date:"2022-03-29T11:00:58.000Z",permalink:"/pages/dc4ebe/",categories:["å¼å","Git"],tags:[null]},regularPath:"/%E5%9F%BA%E7%A1%80/5.Git/10.Git%E7%9A%84%E4%BD%BF%E7%94%A8.html",relativePath:"åºç¡/5.Git/10.Gitçä½¿ç¨.md",key:"v-45526b4e",path:"/pages/dc4ebe/",headers:[{level:3,title:"!image-20220329110148709",slug:"image-20220329110148709-https-blog-1310567564-cos-ap-beijing-myqcloud-com-img-image-20220329110148709-png",normalizedTitle:"!image-20220329110148709",charIndex:null},{level:4,title:"æ¥ççæ¬",slug:"æ¥ççæ¬",normalizedTitle:"æ¥ççæ¬",charIndex:163},{level:4,title:"æ¥çæä½è®°å½",slug:"æ¥çæä½è®°å½",normalizedTitle:"æ¥çæä½è®°å½",charIndex:180},{level:4,title:"åéçæ¬",slug:"åéçæ¬",normalizedTitle:"åéçæ¬",charIndex:202},{level:4,title:"åå»ºæ°åæ¯",slug:"åå»ºæ°åæ¯",normalizedTitle:"åå»ºæ°åæ¯",charIndex:477},{level:4,title:"æ¥çåæ¯",slug:"æ¥çåæ¯",normalizedTitle:"æ¥çåæ¯",charIndex:648},{level:4,title:"åæ¢åæ¯",slug:"åæ¢åæ¯",normalizedTitle:"åæ¢åæ¯",charIndex:747},{level:4,title:"åå¹¶åæ¯çåæ´",slug:"åå¹¶åæ¯çåæ´",normalizedTitle:"åå¹¶åæ¯çåæ´",charIndex:808}],headersStr:"!image-20220329110148709 æ¥ççæ¬ æ¥çæä½è®°å½ åéçæ¬ åå»ºæ°åæ¯ æ¥çåæ¯ åæ¢åæ¯ åå¹¶åæ¯çåæ´",content:"# Gitçä½¿ç¨\n\næä»¶åæ´æ¶ï¼ågit addå°æä»¶åç»¿ï¼ å git commit descrpæäº¤æ­¤æ¬¡åæ´å°ä»åºã\n\n\n#\n\nå·²ç»addäºä¸ä¸ªæä»¶ï¼åæäºï¼å¨commitä¹åå¯ä»¥git reset <filename>å°ç»¿è²æä»¶åæçº¢è²ï¼å·²ä¿®æ¹ï¼æªå å°æå­åºï¼ã\n\n> æ­¤å¤æè¯´çç»¿ï¼ç¼å²åºç¶æï¼çº¢ï¼å·²ä¿®æ¹ç¶æã\n\n# æ¥ççæ¬\n\ngit log\n\n# æ¥çæä½è®°å½\n\ngit reglog\n\n# åéçæ¬\n\ngit reset <commitID>\n\nåæ¬¡ git logæ¶ï¼ä¼åç°è¢«åéæççæ¬æ¶å¤±äºã\n\nè¥æ³åå°æ´æ°ççæ¬ï¼åéè¦æ¥çæä½è®°å½æ¾å°å½æ¶ç commitID ï¼è¿è¡ resetãè¥æ³åå°ææ°ççæ¬ï¼ååªé git pullå³å¯ã\n\nå³äºcommitID\n\næ¯ä¸ª hash å¼ï¼å¾é¿ï¼ä½éå¸¸åªéè¦å7ä½å°±å¯ä»¥ç¡®å®æä¸ªç¹å® ID ã\n\ngit reset çåæ°ï¼\n\n * --hard ä¸ä¿å­ææåæ´\n * --soft ä¿çåæ´ä¸åæ´åå®¹å¤äº Staged\n * --mixed ä¿çåæ´ä¸åæ´åå®¹å¤äº Modified\n\n# åå»ºæ°åæ¯\n\ngit checkout -b <name> <template>\n\n-- nameåæ°ï¼æ°åæ¯åå­\n\n-- template åæ°ï¼æä»¥åªä¸ªåæ¯æ commit ä¸ºæ¨¡æ¿ï¼é»è®¤ä»¥å½åæå¨åæ¯ä¸ºæ¨¡æ¿\n\næ¨¡æ¿çè§£\n\nä»¥ä¸ä¸ªæ¨¡æ¿åå»ºæ°åæ¯ï¼ç¸å½äºåå»ºäºä¸ä¸ªè¿ä¸ªæ¨¡æ¿çåèº«ï¼è¿ä¸ªåèº«å¯ä»¥å¹²èªå·±çäºæï¼å¹¶ä¸ä»èªå·±ä¸å½±åæ¬ä½ççæ­»ã\n\n# æ¥çåæ¯\n\n 1. æ¥çææåæ¯\n    \n    git branch -a\n\n 2. æ¥çå½åä½¿ç¨çåæ¯(ç»æåè¡¨ä¸­åé¢æ *å·çè¡¨ç¤ºå½åä½¿ç¨åæ¯)\n    \n    git branch\n\n# åæ¢åæ¯\n\ngit checkout <name>\n\nåæ¢çæ¬æ°çæ¹æ³\n\nå¯ç´æ¥åæ¢åæ¯ï¼èä¸å¿ä¸ç´åæ¢ ID ã\n\n# åå¹¶åæ¯çåæ´\n\ngit merge <branch Name>\n\nåå¹¶åæ¯çåæ´ï¼èéåæ¯çåå®¹",normalizedContent:"# gitçä½¿ç¨\n\næä»¶åæ´æ¶ï¼ågit addå°æä»¶åç»¿ï¼ å git commit descrpæäº¤æ­¤æ¬¡åæ´å°ä»åºã\n\n\n#\n\nå·²ç»addäºä¸ä¸ªæä»¶ï¼åæäºï¼å¨commitä¹åå¯ä»¥git reset <filename>å°ç»¿è²æä»¶åæçº¢è²ï¼å·²ä¿®æ¹ï¼æªå å°æå­åºï¼ã\n\n> æ­¤å¤æè¯´çç»¿ï¼ç¼å²åºç¶æï¼çº¢ï¼å·²ä¿®æ¹ç¶æã\n\n# æ¥ççæ¬\n\ngit log\n\n# æ¥çæä½è®°å½\n\ngit reglog\n\n# åéçæ¬\n\ngit reset <commitid>\n\nåæ¬¡ git logæ¶ï¼ä¼åç°è¢«åéæççæ¬æ¶å¤±äºã\n\nè¥æ³åå°æ´æ°ççæ¬ï¼åéè¦æ¥çæä½è®°å½æ¾å°å½æ¶ç commitid ï¼è¿è¡ resetãè¥æ³åå°ææ°ççæ¬ï¼ååªé git pullå³å¯ã\n\nå³äºcommitid\n\næ¯ä¸ª hash å¼ï¼å¾é¿ï¼ä½éå¸¸åªéè¦å7ä½å°±å¯ä»¥ç¡®å®æä¸ªç¹å® id ã\n\ngit reset çåæ°ï¼\n\n * --hard ä¸ä¿å­ææåæ´\n * --soft ä¿çåæ´ä¸åæ´åå®¹å¤äº staged\n * --mixed ä¿çåæ´ä¸åæ´åå®¹å¤äº modified\n\n# åå»ºæ°åæ¯\n\ngit checkout -b <name> <template>\n\n-- nameåæ°ï¼æ°åæ¯åå­\n\n-- template åæ°ï¼æä»¥åªä¸ªåæ¯æ commit ä¸ºæ¨¡æ¿ï¼é»è®¤ä»¥å½åæå¨åæ¯ä¸ºæ¨¡æ¿\n\næ¨¡æ¿çè§£\n\nä»¥ä¸ä¸ªæ¨¡æ¿åå»ºæ°åæ¯ï¼ç¸å½äºåå»ºäºä¸ä¸ªè¿ä¸ªæ¨¡æ¿çåèº«ï¼è¿ä¸ªåèº«å¯ä»¥å¹²èªå·±çäºæï¼å¹¶ä¸ä»èªå·±ä¸å½±åæ¬ä½ççæ­»ã\n\n# æ¥çåæ¯\n\n 1. æ¥çææåæ¯\n    \n    git branch -a\n\n 2. æ¥çå½åä½¿ç¨çåæ¯(ç»æåè¡¨ä¸­åé¢æ *å·çè¡¨ç¤ºå½åä½¿ç¨åæ¯)\n    \n    git branch\n\n# åæ¢åæ¯\n\ngit checkout <name>\n\nåæ¢çæ¬æ°çæ¹æ³\n\nå¯ç´æ¥åæ¢åæ¯ï¼èä¸å¿ä¸ç´åæ¢ id ã\n\n# åå¹¶åæ¯çåæ´\n\ngit merge <branch name>\n\nåå¹¶åæ¯çåæ´ï¼èéåæ¯çåå®¹",charsets:{cjk:!0},lastUpdated:"2022/04/09, 07:49:44",lastUpdatedTimestamp:1649490584e3},{title:"Java åºç¡è¯­æ³",frontmatter:{title:"Java åºç¡è¯­æ³",date:"2023-01-24T10:56:01.000Z",permalink:"/pages/483565/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/05.Java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95.html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/05.Javaåºç¡è¯­æ³.md",key:"v-11669a46",path:"/pages/483565/",headers:[{level:2,title:"0. ç±»åè½¬æ¢é®é¢",slug:"_0-ç±»åè½¬æ¢é®é¢",normalizedTitle:"0. ç±»åè½¬æ¢é®é¢",charIndex:15},{level:4,title:"ç±»åè½¬æ¢ï¼çè§£ï¼",slug:"ç±»åè½¬æ¢-çè§£",normalizedTitle:"ç±»åè½¬æ¢ï¼çè§£ï¼",charIndex:28},{level:4,title:"èªå¨ç±»åè½¬æ¢",slug:"èªå¨ç±»åè½¬æ¢",normalizedTitle:"èªå¨ç±»åè½¬æ¢",charIndex:90},{level:4,title:"è¡¨è¾¾å¼çèªå¨ç±»åè½¬æ¢",slug:"è¡¨è¾¾å¼çèªå¨ç±»åè½¬æ¢",normalizedTitle:"è¡¨è¾¾å¼çèªå¨ç±»åè½¬æ¢",charIndex:359},{level:4,title:"å¼ºå¶ç±»åè½¬æ¢",slug:"å¼ºå¶ç±»åè½¬æ¢",normalizedTitle:"å¼ºå¶ç±»åè½¬æ¢",charIndex:97},{level:2,title:"1. è¿ç®ç¬¦",slug:"_1-è¿ç®ç¬¦",normalizedTitle:"1. è¿ç®ç¬¦",charIndex:896},{level:3,title:"1.1 ç®æ¯è¿ç®ç¬¦ï¼çè§£ï¼",slug:"_1-1-ç®æ¯è¿ç®ç¬¦-çè§£",normalizedTitle:"1.1 ç®æ¯è¿ç®ç¬¦ï¼çè§£ï¼",charIndex:907},{level:4,title:"å­ç¬¦çâ+âæä½",slug:"å­ç¬¦ç-æä½",normalizedTitle:"å­ç¬¦çâ+âæä½",charIndex:924},{level:3,title:"1.2 é»è¾è¿ç®ç¬¦ï¼åºç¨ï¼",slug:"_1-2-é»è¾è¿ç®ç¬¦-åºç¨",normalizedTitle:"1.2 é»è¾è¿ç®ç¬¦ï¼åºç¨ï¼",charIndex:1971},{level:4,title:"ç­è·¯é»è¾è¿ç®ç¬¦",slug:"ç­è·¯é»è¾è¿ç®ç¬¦",normalizedTitle:"ç­è·¯é»è¾è¿ç®ç¬¦",charIndex:2058},{level:3,title:"1.3 ä¸åè¿ç®ç¬¦ï¼çè§£ï¼",slug:"_1-3-ä¸åè¿ç®ç¬¦-çè§£",normalizedTitle:"1.3 ä¸åè¿ç®ç¬¦ï¼çè§£ï¼",charIndex:2374}],headersStr:"0. ç±»åè½¬æ¢é®é¢ ç±»åè½¬æ¢ï¼çè§£ï¼ èªå¨ç±»åè½¬æ¢ è¡¨è¾¾å¼çèªå¨ç±»åè½¬æ¢ å¼ºå¶ç±»åè½¬æ¢ 1. è¿ç®ç¬¦ 1.1 ç®æ¯è¿ç®ç¬¦ï¼çè§£ï¼ å­ç¬¦çâ+âæä½ 1.2 é»è¾è¿ç®ç¬¦ï¼åºç¨ï¼ ç­è·¯é»è¾è¿ç®ç¬¦ 1.3 ä¸åè¿ç®ç¬¦ï¼çè§£ï¼",content:"# Javaåºç¡è¯­æ³\n\n\n# 0. ç±»åè½¬æ¢é®é¢\n\n# ç±»åè½¬æ¢ï¼çè§£ï¼\n\nå¨Javaä¸­ï¼ä¼å­å¨ä¸åç±»åçæ°æ®éè¦ä¸èµ·åä¸è¿ç®ï¼æä»¥è¿äºæ°æ®ç±»åä¹é´æ¯éè¦ç¸äºè½¬æ¢çï¼åä¸ºä¸¤ç§æåµï¼èªå¨ç±»åè½¬æ¢åå¼ºå¶ç±»åè½¬æ¢ã\n\n# èªå¨ç±»åè½¬æ¢\n\n*ç±»åèå´å°çåéï¼å¯ä»¥ç´æ¥èµå¼ç»ç±»åèå´å¤§**çåéã\n\n\n\næä¸ä¸ªè¡¨ç¤ºæ°æ®èå´å°çæ°å¼æèåéèµå¼ç»å¦ä¸ä¸ªè¡¨ç¤ºæ°æ®èå´å¤§çåéãè¿ç§è½¬æ¢æ¹å¼æ¯èªå¨çï¼ç´æ¥ä¹¦åå³å¯ãä¾å¦ï¼\n\ndouble num = 10; // å°intç±»åç10ç´æ¥èµå¼ç»doubleç±»å\nSystem.out.println(num); // è¾åº10.0\n\nbyte a = 12 ;\nint b = a;\nSystem.out.println(b); // 12\n\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# è¡¨è¾¾å¼çèªå¨ç±»åè½¬æ¢\n\nå¨è¡¨è¾¾å¼ä¸­ï¼å°èå´ç±»åçåéä¼èªå¨è½¬æ¢æå½åè¾å¤§èå´çç±»ååè¿ç®ã\n\n\n\næ³¨æäºé¡¹ï¼\n\n * è¡¨è¾¾å¼çæç»ç»æç±»åç±è¡¨è¾¾å¼ä¸­çæé«ç±»åå³å®ã\n\n * å¨è¡¨è¾¾å¼ä¸­ï¼byteãshortãchar æ¯ç´æ¥è½¬æ¢æintç±»ååä¸è¿ç®çã\n\nbyte b1 = 10;\nbyte b2 = 20;\nbyte b3 = b1 + b2; \n// ç¬¬ä¸è¡ä»£ç ä¼æ¥éï¼b1åb2ä¼èªå¨è½¬æ¢ä¸ºintç±»åï¼è®¡ç®ç»æä¸ºintï¼intèµå¼ç»byteéè¦å¼ºå¶ç±»åè½¬æ¢ã\n// ä¿®æ¹ä¸º:\nint num = b1 + b2;\n// æèï¼\nbyte b3 = (byte) (b1 + b2);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * booleanç±»åä¸è½ä¸å¶ä»åºæ¬æ°æ®ç±»åç¸äºè½¬æ¢ã\n\n# å¼ºå¶ç±»åè½¬æ¢\n\nç±»åèå´å¤§çæ°æ®æèåéï¼ä¸è½ç´æ¥èµå¼ç»ç±»åèå´å°çåéï¼ä¼æ¥éï¼æä¸ä¸ªè¡¨ç¤ºæ°æ®èå´å¤§çæ°å¼æèåéèµå¼ç»å¦ä¸ä¸ªè¡¨ç¤ºæ°æ®èå´å°çåéå¿é¡»è¿è¡å¼ºå¶ç±»åè½¬æ¢ã\n\nå¼ºå¶ç±»åè½¬æ¢æ ¼å¼ï¼ç®æ æ°æ®ç±»å åéå = (ç®æ æ°æ®ç±»å)å¼æèåé;\n\næ³¨æäºé¡¹ï¼\n\n * å¼ºå¶ç±»åè½¬æ¢å¯è½é ææ°æ®(ä¸¢å¤±)æº¢åºï¼\n * æµ®ç¹åå¼ºè½¬ææ´åï¼ç´æ¥ä¸¢æå°æ°é¨åï¼ä¿çæ´æ°é¨åè¿åã\n\n\n# 1. è¿ç®ç¬¦\n\n\n# 1.1 ç®æ¯è¿ç®ç¬¦ï¼çè§£ï¼\n\n# å­ç¬¦çâ+âæä½\n\ncharç±»ååä¸ç®æ¯è¿ç®ï¼ä½¿ç¨çæ¯è®¡ç®æºåºå±å¯¹åºçåè¿å¶æ°å¼ãéè¦æä»¬è®°ä½ä¸ä¸ªå­ç¬¦å¯¹åºçæ°å¼ï¼\n\n * 'a' -- 97 a-zæ¯è¿ç»­çï¼æä»¥'b'å¯¹åºçæ°å¼æ¯98ï¼'c'æ¯99ï¼ä¾æ¬¡éå \n\n * 'A' -- 65 A-Zæ¯è¿ç»­çï¼æä»¥'B'å¯¹åºçæ°å¼æ¯66ï¼'C'æ¯67ï¼ä¾æ¬¡éå \n\n * '0' -- 48 0-9æ¯è¿ç»­çï¼æä»¥'1'å¯¹åºçæ°å¼æ¯49ï¼'2'æ¯50ï¼ä¾æ¬¡éå \n\n// å¯ä»¥éè¿ä½¿ç¨å­ç¬¦ä¸æ´æ°åç®æ¯è¿ç®ï¼å¾åºå­ç¬¦å¯¹åºçæ°å¼æ¯å¤å°\nchar ch1 = 'a';\nSystem.out.println(ch1 + 1); // è¾åº98ï¼97 + 1 = 98\n\nchar ch2 = 'A';\nSystem.out.println(ch2 + 1); // è¾åº66ï¼65 + 1 = 66\n\nchar ch3 = '0';\nSystem.out.println(ch3 + 1); // è¾åº49ï¼48 + 1 = 49\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nç®æ¯è¡¨è¾¾å¼ä¸­åå«ä¸åçåºæ¬æ°æ®ç±»åçå¼çæ¶åï¼æ´ä¸ªç®æ¯è¡¨è¾¾å¼çç±»åä¼èªå¨è¿è¡æåã\n\ntipsï¼æ­£æ¯ç±äºä¸è¿°åå ï¼æä»¥å¨ç¨åºå¼åä¸­æä»¬å¾å°ä½¿ç¨byteæèshortç±»åå®ä¹æ´æ°ãä¹å¾å°ä¼ä½¿ç¨charç±»åå®ä¹å­ç¬¦ï¼èä½¿ç¨å­ç¬¦ä¸²ç±»åï¼æ´ä¸ä¼ä½¿ç¨charç±»ååç®æ¯è¿ç®ã\n\næç¤º\n\nä¸¤ä¸ªæ´æ°ç¸é¤æ³å¾å°å°æ°ç»æï¼é¤æ°æè¢«é¤æ° x0.1\n\npublic class OperatorDemo1 {\n    public static void main(String[] args) {\n        int a = 10;\n        int b = 3;\n        System.out.println(a / b); // 3.3333 ==> 3\n        System,out.println(a * 1. / b); // 3.3333\n        System.out.println(3 / 2);\n        System.out.println(3 * 1.0 / 2); // 1.5\n        System.out.println(3 / 2 * 1.0); // 1.0\n        System.out.printin(a % b); // 1\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# 1.2 é»è¾è¿ç®ç¬¦ï¼åºç¨ï¼\n\né»è¾è¿ç®ç¬¦æåä¸ªè¿ç®çå³ç³»è¡¨è¾¾å¼è¿æ¥èµ·æ¥ç»æä¸ä¸ªå¤æçé»è¾è¡¨è¾¾å¼ï¼ä»¥å¤æ­ç¨åºä¸­çè¡¨è¾¾å¼æ¯å¦æç«ï¼å¤æ­çç»ææ¯ true æ falseã\n\n# ç­è·¯é»è¾è¿ç®ç¬¦\n\nç¬¦å·   ä½ç¨    è¯´æ\n&&   ç­è·¯ä¸   ä½ç¨å&ç¸åï¼ä½æ¯æç­è·¯ææ\n||   ç­è·¯æ   ä½ç¨å|ç¸åï¼ä½æ¯æç­è·¯ææ\n\nå¨é»è¾ä¸è¿ç®ä¸­ï¼åªè¦æä¸ä¸ªè¡¨è¾¾å¼çå¼ä¸ºfalseï¼é£ä¹ç»æå°±å¯ä»¥å¤å®ä¸ºfalseäºï¼æ²¡æå¿è¦å°ææè¡¨è¾¾å¼çå¼é½è®¡ç®åºæ¥ï¼ç­è·¯ä¸æä½å°±æè¿æ ·çææï¼å¯ä»¥æé«æçãåçå¨é»è¾æè¿ç®ä¸­ï¼ä¸æ¦åç°å¼ä¸ºtrueï¼å³è¾¹çè¡¨è¾¾å¼å°ä¸ååä¸è¿ç®ã\n\n * é»è¾ä¸&ï¼æ è®ºå·¦è¾¹çåï¼å³è¾¹é½è¦æ§è¡ã\n\n * ç­è·¯ä¸&&ï¼å¦æå·¦è¾¹ä¸ºçï¼å³è¾¹æ§è¡ï¼å¦æå·¦è¾¹ä¸ºåï¼å³è¾¹ä¸æ§è¡ã\n\n * é»è¾æ|ï¼æ è®ºå·¦è¾¹çåï¼å³è¾¹é½è¦æ§è¡ã\n\n * ç­è·¯æ||ï¼å¦æå·¦è¾¹ä¸ºåï¼å³è¾¹æ§è¡ï¼å¦æå·¦è¾¹ä¸ºçï¼å³è¾¹ä¸æ§è¡ã\n\n\n# 1.3 ä¸åè¿ç®ç¬¦ï¼çè§£ï¼\n\nä¸åè¿ç®ç¬¦è¯­æ³æ ¼å¼ï¼\n\nå³ç³»è¡¨è¾¾å¼ ? è¡¨è¾¾å¼1 : è¡¨è¾¾å¼2;\n\n\n1\n",normalizedContent:"# javaåºç¡è¯­æ³\n\n\n# 0. ç±»åè½¬æ¢é®é¢\n\n# ç±»åè½¬æ¢ï¼çè§£ï¼\n\nå¨javaä¸­ï¼ä¼å­å¨ä¸åç±»åçæ°æ®éè¦ä¸èµ·åä¸è¿ç®ï¼æä»¥è¿äºæ°æ®ç±»åä¹é´æ¯éè¦ç¸äºè½¬æ¢çï¼åä¸ºä¸¤ç§æåµï¼èªå¨ç±»åè½¬æ¢åå¼ºå¶ç±»åè½¬æ¢ã\n\n# èªå¨ç±»åè½¬æ¢\n\n*ç±»åèå´å°çåéï¼å¯ä»¥ç´æ¥èµå¼ç»ç±»åèå´å¤§**çåéã\n\n\n\næä¸ä¸ªè¡¨ç¤ºæ°æ®èå´å°çæ°å¼æèåéèµå¼ç»å¦ä¸ä¸ªè¡¨ç¤ºæ°æ®èå´å¤§çåéãè¿ç§è½¬æ¢æ¹å¼æ¯èªå¨çï¼ç´æ¥ä¹¦åå³å¯ãä¾å¦ï¼\n\ndouble num = 10; // å°intç±»åç10ç´æ¥èµå¼ç»doubleç±»å\nsystem.out.println(num); // è¾åº10.0\n\nbyte a = 12 ;\nint b = a;\nsystem.out.println(b); // 12\n\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# è¡¨è¾¾å¼çèªå¨ç±»åè½¬æ¢\n\nå¨è¡¨è¾¾å¼ä¸­ï¼å°èå´ç±»åçåéä¼èªå¨è½¬æ¢æå½åè¾å¤§èå´çç±»ååè¿ç®ã\n\n\n\næ³¨æäºé¡¹ï¼\n\n * è¡¨è¾¾å¼çæç»ç»æç±»åç±è¡¨è¾¾å¼ä¸­çæé«ç±»åå³å®ã\n\n * å¨è¡¨è¾¾å¼ä¸­ï¼byteãshortãchar æ¯ç´æ¥è½¬æ¢æintç±»ååä¸è¿ç®çã\n\nbyte b1 = 10;\nbyte b2 = 20;\nbyte b3 = b1 + b2; \n// ç¬¬ä¸è¡ä»£ç ä¼æ¥éï¼b1åb2ä¼èªå¨è½¬æ¢ä¸ºintç±»åï¼è®¡ç®ç»æä¸ºintï¼intèµå¼ç»byteéè¦å¼ºå¶ç±»åè½¬æ¢ã\n// ä¿®æ¹ä¸º:\nint num = b1 + b2;\n// æèï¼\nbyte b3 = (byte) (b1 + b2);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * booleanç±»åä¸è½ä¸å¶ä»åºæ¬æ°æ®ç±»åç¸äºè½¬æ¢ã\n\n# å¼ºå¶ç±»åè½¬æ¢\n\nç±»åèå´å¤§çæ°æ®æèåéï¼ä¸è½ç´æ¥èµå¼ç»ç±»åèå´å°çåéï¼ä¼æ¥éï¼æä¸ä¸ªè¡¨ç¤ºæ°æ®èå´å¤§çæ°å¼æèåéèµå¼ç»å¦ä¸ä¸ªè¡¨ç¤ºæ°æ®èå´å°çåéå¿é¡»è¿è¡å¼ºå¶ç±»åè½¬æ¢ã\n\nå¼ºå¶ç±»åè½¬æ¢æ ¼å¼ï¼ç®æ æ°æ®ç±»å åéå = (ç®æ æ°æ®ç±»å)å¼æèåé;\n\næ³¨æäºé¡¹ï¼\n\n * å¼ºå¶ç±»åè½¬æ¢å¯è½é ææ°æ®(ä¸¢å¤±)æº¢åºï¼\n * æµ®ç¹åå¼ºè½¬ææ´åï¼ç´æ¥ä¸¢æå°æ°é¨åï¼ä¿çæ´æ°é¨åè¿åã\n\n\n# 1. è¿ç®ç¬¦\n\n\n# 1.1 ç®æ¯è¿ç®ç¬¦ï¼çè§£ï¼\n\n# å­ç¬¦çâ+âæä½\n\ncharç±»ååä¸ç®æ¯è¿ç®ï¼ä½¿ç¨çæ¯è®¡ç®æºåºå±å¯¹åºçåè¿å¶æ°å¼ãéè¦æä»¬è®°ä½ä¸ä¸ªå­ç¬¦å¯¹åºçæ°å¼ï¼\n\n * 'a' -- 97 a-zæ¯è¿ç»­çï¼æä»¥'b'å¯¹åºçæ°å¼æ¯98ï¼'c'æ¯99ï¼ä¾æ¬¡éå \n\n * 'a' -- 65 a-zæ¯è¿ç»­çï¼æä»¥'b'å¯¹åºçæ°å¼æ¯66ï¼'c'æ¯67ï¼ä¾æ¬¡éå \n\n * '0' -- 48 0-9æ¯è¿ç»­çï¼æä»¥'1'å¯¹åºçæ°å¼æ¯49ï¼'2'æ¯50ï¼ä¾æ¬¡éå \n\n// å¯ä»¥éè¿ä½¿ç¨å­ç¬¦ä¸æ´æ°åç®æ¯è¿ç®ï¼å¾åºå­ç¬¦å¯¹åºçæ°å¼æ¯å¤å°\nchar ch1 = 'a';\nsystem.out.println(ch1 + 1); // è¾åº98ï¼97 + 1 = 98\n\nchar ch2 = 'a';\nsystem.out.println(ch2 + 1); // è¾åº66ï¼65 + 1 = 66\n\nchar ch3 = '0';\nsystem.out.println(ch3 + 1); // è¾åº49ï¼48 + 1 = 49\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nç®æ¯è¡¨è¾¾å¼ä¸­åå«ä¸åçåºæ¬æ°æ®ç±»åçå¼çæ¶åï¼æ´ä¸ªç®æ¯è¡¨è¾¾å¼çç±»åä¼èªå¨è¿è¡æåã\n\ntipsï¼æ­£æ¯ç±äºä¸è¿°åå ï¼æä»¥å¨ç¨åºå¼åä¸­æä»¬å¾å°ä½¿ç¨byteæèshortç±»åå®ä¹æ´æ°ãä¹å¾å°ä¼ä½¿ç¨charç±»åå®ä¹å­ç¬¦ï¼èä½¿ç¨å­ç¬¦ä¸²ç±»åï¼æ´ä¸ä¼ä½¿ç¨charç±»ååç®æ¯è¿ç®ã\n\næç¤º\n\nä¸¤ä¸ªæ´æ°ç¸é¤æ³å¾å°å°æ°ç»æï¼é¤æ°æè¢«é¤æ° x0.1\n\npublic class operatordemo1 {\n    public static void main(string[] args) {\n        int a = 10;\n        int b = 3;\n        system.out.println(a / b); // 3.3333 ==> 3\n        system,out.println(a * 1. / b); // 3.3333\n        system.out.println(3 / 2);\n        system.out.println(3 * 1.0 / 2); // 1.5\n        system.out.println(3 / 2 * 1.0); // 1.0\n        system.out.printin(a % b); // 1\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# 1.2 é»è¾è¿ç®ç¬¦ï¼åºç¨ï¼\n\né»è¾è¿ç®ç¬¦æåä¸ªè¿ç®çå³ç³»è¡¨è¾¾å¼è¿æ¥èµ·æ¥ç»æä¸ä¸ªå¤æçé»è¾è¡¨è¾¾å¼ï¼ä»¥å¤æ­ç¨åºä¸­çè¡¨è¾¾å¼æ¯å¦æç«ï¼å¤æ­çç»ææ¯ true æ falseã\n\n# ç­è·¯é»è¾è¿ç®ç¬¦\n\nç¬¦å·   ä½ç¨    è¯´æ\n&&   ç­è·¯ä¸   ä½ç¨å&ç¸åï¼ä½æ¯æç­è·¯ææ\n||   ç­è·¯æ   ä½ç¨å|ç¸åï¼ä½æ¯æç­è·¯ææ\n\nå¨é»è¾ä¸è¿ç®ä¸­ï¼åªè¦æä¸ä¸ªè¡¨è¾¾å¼çå¼ä¸ºfalseï¼é£ä¹ç»æå°±å¯ä»¥å¤å®ä¸ºfalseäºï¼æ²¡æå¿è¦å°ææè¡¨è¾¾å¼çå¼é½è®¡ç®åºæ¥ï¼ç­è·¯ä¸æä½å°±æè¿æ ·çææï¼å¯ä»¥æé«æçãåçå¨é»è¾æè¿ç®ä¸­ï¼ä¸æ¦åç°å¼ä¸ºtrueï¼å³è¾¹çè¡¨è¾¾å¼å°ä¸ååä¸è¿ç®ã\n\n * é»è¾ä¸&ï¼æ è®ºå·¦è¾¹çåï¼å³è¾¹é½è¦æ§è¡ã\n\n * ç­è·¯ä¸&&ï¼å¦æå·¦è¾¹ä¸ºçï¼å³è¾¹æ§è¡ï¼å¦æå·¦è¾¹ä¸ºåï¼å³è¾¹ä¸æ§è¡ã\n\n * é»è¾æ|ï¼æ è®ºå·¦è¾¹çåï¼å³è¾¹é½è¦æ§è¡ã\n\n * ç­è·¯æ||ï¼å¦æå·¦è¾¹ä¸ºåï¼å³è¾¹æ§è¡ï¼å¦æå·¦è¾¹ä¸ºçï¼å³è¾¹ä¸æ§è¡ã\n\n\n# 1.3 ä¸åè¿ç®ç¬¦ï¼çè§£ï¼\n\nä¸åè¿ç®ç¬¦è¯­æ³æ ¼å¼ï¼\n\nå³ç³»è¡¨è¾¾å¼ ? è¡¨è¾¾å¼1 : è¡¨è¾¾å¼2;\n\n\n1\n",charsets:{cjk:!0},lastUpdated:"2023/01/24, 08:14:58",lastUpdatedTimestamp:1674548098e3},{title:"æ°ç»",frontmatter:{title:"æ°ç»",date:"2023-01-24T20:27:46.000Z",permalink:"/pages/a6522a/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/10.%E6%95%B0%E7%BB%84.html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/10.æ°ç».md",key:"v-2c0bb97b",path:"/pages/a6522a/",headers:[{level:2,title:"1. æ°ç»å®ä¹æ ¼å¼ãè®°å¿ã",slug:"_1-æ°ç»å®ä¹æ ¼å¼ãè®°å¿ã",normalizedTitle:"1. æ°ç»å®ä¹æ ¼å¼ãè®°å¿ã",charIndex:82},{level:2,title:"2. æ°ç»åå§åãåºç¨ã",slug:"_2-æ°ç»åå§åãåºç¨ã",normalizedTitle:"2. æ°ç»åå§åãåºç¨ã",charIndex:252},{level:3,title:"2.1 éæåå§åæ°ç»",slug:"_2-1-éæåå§åæ°ç»",normalizedTitle:"2.1 éæåå§åæ°ç»",charIndex:269},{level:4,title:"2.1.1 æ ¼å¼ï¼",slug:"_2-1-1-æ ¼å¼",normalizedTitle:"2.1.1 æ ¼å¼ï¼",charIndex:301},{level:3,title:"2.2 å¨æåå§åæ°ç»",slug:"_2-2-å¨æåå§åæ°ç»",normalizedTitle:"2.2 å¨æåå§åæ°ç»",charIndex:486},{level:4,title:"2.2.1 æ ¼å¼ï¼",slug:"_2-2-1-æ ¼å¼",normalizedTitle:"2.2.1 æ ¼å¼ï¼",charIndex:535},{level:4,title:"2.2.2 å¨æåå§åæ°ç»çåç´ é»è®¤å¼",slug:"_2-2-2-å¨æåå§åæ°ç»çåç´ é»è®¤å¼",normalizedTitle:"2.2.2 å¨æåå§åæ°ç»çåç´ é»è®¤å¼",charIndex:607},{level:2,title:"3. æ°ç»åç´ è®¿é®ãåºç¨ã",slug:"_3-æ°ç»åç´ è®¿é®ãåºç¨ã",normalizedTitle:"3. æ°ç»åç´ è®¿é®ãåºç¨ã",charIndex:698},{level:2,title:"4. Java åå­åéãçè§£ã",slug:"_4-java-åå­åéãçè§£ã",normalizedTitle:"4. java åå­åéãçè§£ã",charIndex:1142},{level:3,title:"4.1 åå­æ¦è¿°",slug:"_4-1-åå­æ¦è¿°",normalizedTitle:"4.1 åå­æ¦è¿°",charIndex:1163},{level:3,title:"4.2 javaä¸­çåå­åé",slug:"_4-2-javaä¸­çåå­åé",normalizedTitle:"4.2 javaä¸­çåå­åé",charIndex:1295}],headersStr:"1. æ°ç»å®ä¹æ ¼å¼ãè®°å¿ã 2. æ°ç»åå§åãåºç¨ã 2.1 éæåå§åæ°ç» 2.1.1 æ ¼å¼ï¼ 2.2 å¨æåå§åæ°ç» 2.2.1 æ ¼å¼ï¼ 2.2.2 å¨æåå§åæ°ç»çåç´ é»è®¤å¼ 3. æ°ç»åç´ è®¿é®ãåºç¨ã 4. Java åå­åéãçè§£ã 4.1 åå­æ¦è¿° 4.2 javaä¸­çåå­åé",content:"# æ°ç»\n\næ°ç»åéåä¸­å­å¨çæ¯æ°ç»å¨åå­ä¸­çå°åï¼æ°ç»æ¯å¼ç¨ç±»åï¼ä¸åäºåºæ¬ç±»åï¼ã\n\næç¤º\n\næ°ç»ä¸æ¦å®ä¹åºæ¥ï¼ç¨åºæ§è¡çè¿ç¨ä¸­ï¼é¿åº¦ãç±»åå°±åºå®äºã\n\n\n# 1. æ°ç»å®ä¹æ ¼å¼ãè®°å¿ã\n\nç¬¬ä¸ç§\n\næ°æ®ç±»å[] æ°ç»å\n\nç¤ºä¾ï¼\n\nint[] arr;        \ndouble[] arr;      \nchar[] arr;\n\n\n1\n2\n3\n\n\nç¬¬äºç§\n\næ°æ®ç±»å æ°ç»å[]\n\nç¤ºä¾ï¼\n\nint arr[];\ndouble arr[];\nchar arr[];\n\n\n1\n2\n3\n\n\n\n# 2. æ°ç»åå§åãåºç¨ã\n\n\n# 2.1 éæåå§åæ°ç»\n\nå®ä¹æ°ç»çæ¶åç´æ¥ç»æ°ç»èµå¼ã\n\n# 2.1.1 æ ¼å¼ï¼\n\n * å®æ´çæ ¼å¼\n\næ°æ®ç±»å[] æ°ç»å = new æ°æ®ç±»å[]{åç´ 1ï¼åç´ 2 ï¼åç´ 3â¦ };\nint[] ages = new int[]{12, 24, 36}\n\n\n1\n2\n\n * ç®åçæ ¼å¼\n\næ°æ®ç±»å[] æ°ç»å = { åç´ 1ï¼åç´ 2 ï¼åç´ 3ï¼â¦ };\nint[] ages = {12, 24, 36};\n\n\n1\n2\n\n\n\n# 2.2 å¨æåå§åæ°ç»\n\nå®ä¹æ°ç»çæ¶ååªç¡®å®åç´ çç±»ååæ°ç»çé¿åº¦ï¼ä¹ååå­å¥å·ä½æ°æ®ã\n\n# 2.2.1 æ ¼å¼ï¼\n\næ°æ®ç±»å[] æ°ç»å = new æ°æ®ç±»å[é¿åº¦];\nint[] arr = new int[3];\n\n\n1\n2\n\n\n# 2.2.2 å¨æåå§åæ°ç»çåç´ é»è®¤å¼\n\nä¸¤ç§æ°ç»åå§åçç¹ç¹ååºæ¯åºå«\n\n * å½åå·²ç»ç¥éå­å¥çåç´ å¼ï¼ç¨éæåå§åã\n * å½åè¿ä¸æ¸æ¥è¦å­å¥åªäºæ°æ®ï¼ç¨å¨æåå§åã\n\n\n# 3. æ°ç»åç´ è®¿é®ãåºç¨ã\n\n * æ°ç»çé¿åº¦ï¼æ°ç»åç§°.length\n\n * è·åæ°ç»çæå¤§ç´¢å¼ï¼æ°ç»åç§°.length - 1\n   \n   â ï¸ æ­¤æ¹æ³è·åæ°ç»çæå¤§ç´¢å¼ï¼éè¦åç´ ä¸ªæ°å¤§äº0çåæã\n\n * éåæ°ç»åç´ æ¶ï¼æ³¨æå¤æ­æ¯å¦ä¸ºnullï¼ææ¯å¦é¿åº¦ä¸º0ã\n   \n   int[] nums = null;   // æ°ç»ä¸º null\n   int[] nums2 = {};    // æ°ç»é¿åº¦ä¸º 0\n   \n   public static int getMax(int[] arr) {\n       if (arr != null && arr.length > 0) {\n           // æ¹æ³çé»è¾\n       } else {\n           // æ°ç»ä¸ºç©ºæé¿åº¦ä¸º0çå¤ç\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   \n\n\n# 4. Java åå­åéãçè§£ã\n\n\n# 4.1 åå­æ¦è¿°\n\nåå­æ¯è®¡ç®æºä¸­çéè¦åä»¶ï¼ä¸´æ¶å­å¨åºåï¼ä½ç¨æ¯è¿è¡ç¨åºã\n\næä»¬ç¼åçç¨åºæ¯å­æ¾å¨ç¡¬çä¸­çï¼å¨ç¡¬çä¸­çç¨åºæ¯ä¸ä¼è¿è¡çã\n\nå¿é¡»æ¾è¿åå­ä¸­æè½è¿è¡ï¼è¿è¡å®æ¯åä¼æ¸ç©ºåå­ã\n\nJavaèææºè¦è¿è¡ç¨åºï¼å¿é¡»è¦å¯¹åå­è¿è¡ç©ºé´çåéåç®¡çã\n\n\n# 4.2 javaä¸­çåå­åé\n\n * ç®åæä»¬åªéè¦è®°ä½ä¸¤ä¸ªåå­ï¼åå«æ¯ï¼æ åå­åå åå­\n\nåºååç§°    ä½ç¨\nå¯å­å¨     ç»CPUä½¿ç¨ï¼åæä»¬å¼åæ å³ã\næ¬å°æ¹æ³æ    JVMå¨ä½¿ç¨æä½ç³»ç»åè½çæ¶åä½¿ç¨ï¼åæä»¬å¼åæ å³ã\næ¹æ³åº     å­å¨å¯ä»¥è¿è¡çclassæä»¶ã\nå åå­     å­å¨å¯¹è±¡æèæ°ç»ï¼newæ¥åå»ºçï¼é½å­å¨å¨å åå­ã\næ¹æ³æ      æ¹æ³è¿è¡æ¶ä½¿ç¨çåå­ï¼æ¯å¦mainæ¹æ³è¿è¡ï¼è¿å¥æ¹æ³æ ä¸­æ§è¡ã",normalizedContent:"# æ°ç»\n\næ°ç»åéåä¸­å­å¨çæ¯æ°ç»å¨åå­ä¸­çå°åï¼æ°ç»æ¯å¼ç¨ç±»åï¼ä¸åäºåºæ¬ç±»åï¼ã\n\næç¤º\n\næ°ç»ä¸æ¦å®ä¹åºæ¥ï¼ç¨åºæ§è¡çè¿ç¨ä¸­ï¼é¿åº¦ãç±»åå°±åºå®äºã\n\n\n# 1. æ°ç»å®ä¹æ ¼å¼ãè®°å¿ã\n\nç¬¬ä¸ç§\n\næ°æ®ç±»å[] æ°ç»å\n\nç¤ºä¾ï¼\n\nint[] arr;        \ndouble[] arr;      \nchar[] arr;\n\n\n1\n2\n3\n\n\nç¬¬äºç§\n\næ°æ®ç±»å æ°ç»å[]\n\nç¤ºä¾ï¼\n\nint arr[];\ndouble arr[];\nchar arr[];\n\n\n1\n2\n3\n\n\n\n# 2. æ°ç»åå§åãåºç¨ã\n\n\n# 2.1 éæåå§åæ°ç»\n\nå®ä¹æ°ç»çæ¶åç´æ¥ç»æ°ç»èµå¼ã\n\n# 2.1.1 æ ¼å¼ï¼\n\n * å®æ´çæ ¼å¼\n\næ°æ®ç±»å[] æ°ç»å = new æ°æ®ç±»å[]{åç´ 1ï¼åç´ 2 ï¼åç´ 3â¦ };\nint[] ages = new int[]{12, 24, 36}\n\n\n1\n2\n\n * ç®åçæ ¼å¼\n\næ°æ®ç±»å[] æ°ç»å = { åç´ 1ï¼åç´ 2 ï¼åç´ 3ï¼â¦ };\nint[] ages = {12, 24, 36};\n\n\n1\n2\n\n\n\n# 2.2 å¨æåå§åæ°ç»\n\nå®ä¹æ°ç»çæ¶ååªç¡®å®åç´ çç±»ååæ°ç»çé¿åº¦ï¼ä¹ååå­å¥å·ä½æ°æ®ã\n\n# 2.2.1 æ ¼å¼ï¼\n\næ°æ®ç±»å[] æ°ç»å = new æ°æ®ç±»å[é¿åº¦];\nint[] arr = new int[3];\n\n\n1\n2\n\n\n# 2.2.2 å¨æåå§åæ°ç»çåç´ é»è®¤å¼\n\nä¸¤ç§æ°ç»åå§åçç¹ç¹ååºæ¯åºå«\n\n * å½åå·²ç»ç¥éå­å¥çåç´ å¼ï¼ç¨éæåå§åã\n * å½åè¿ä¸æ¸æ¥è¦å­å¥åªäºæ°æ®ï¼ç¨å¨æåå§åã\n\n\n# 3. æ°ç»åç´ è®¿é®ãåºç¨ã\n\n * æ°ç»çé¿åº¦ï¼æ°ç»åç§°.length\n\n * è·åæ°ç»çæå¤§ç´¢å¼ï¼æ°ç»åç§°.length - 1\n   \n   â ï¸ æ­¤æ¹æ³è·åæ°ç»çæå¤§ç´¢å¼ï¼éè¦åç´ ä¸ªæ°å¤§äº0çåæã\n\n * éåæ°ç»åç´ æ¶ï¼æ³¨æå¤æ­æ¯å¦ä¸ºnullï¼ææ¯å¦é¿åº¦ä¸º0ã\n   \n   int[] nums = null;   // æ°ç»ä¸º null\n   int[] nums2 = {};    // æ°ç»é¿åº¦ä¸º 0\n   \n   public static int getmax(int[] arr) {\n       if (arr != null && arr.length > 0) {\n           // æ¹æ³çé»è¾\n       } else {\n           // æ°ç»ä¸ºç©ºæé¿åº¦ä¸º0çå¤ç\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   \n\n\n# 4. java åå­åéãçè§£ã\n\n\n# 4.1 åå­æ¦è¿°\n\nåå­æ¯è®¡ç®æºä¸­çéè¦åä»¶ï¼ä¸´æ¶å­å¨åºåï¼ä½ç¨æ¯è¿è¡ç¨åºã\n\næä»¬ç¼åçç¨åºæ¯å­æ¾å¨ç¡¬çä¸­çï¼å¨ç¡¬çä¸­çç¨åºæ¯ä¸ä¼è¿è¡çã\n\nå¿é¡»æ¾è¿åå­ä¸­æè½è¿è¡ï¼è¿è¡å®æ¯åä¼æ¸ç©ºåå­ã\n\njavaèææºè¦è¿è¡ç¨åºï¼å¿é¡»è¦å¯¹åå­è¿è¡ç©ºé´çåéåç®¡çã\n\n\n# 4.2 javaä¸­çåå­åé\n\n * ç®åæä»¬åªéè¦è®°ä½ä¸¤ä¸ªåå­ï¼åå«æ¯ï¼æ åå­åå åå­\n\nåºååç§°    ä½ç¨\nå¯å­å¨     ç»cpuä½¿ç¨ï¼åæä»¬å¼åæ å³ã\næ¬å°æ¹æ³æ    jvmå¨ä½¿ç¨æä½ç³»ç»åè½çæ¶åä½¿ç¨ï¼åæä»¬å¼åæ å³ã\næ¹æ³åº     å­å¨å¯ä»¥è¿è¡çclassæä»¶ã\nå åå­     å­å¨å¯¹è±¡æèæ°ç»ï¼newæ¥åå»ºçï¼é½å­å¨å¨å åå­ã\næ¹æ³æ      æ¹æ³è¿è¡æ¶ä½¿ç¨çåå­ï¼æ¯å¦mainæ¹æ³è¿è¡ï¼è¿å¥æ¹æ³æ ä¸­æ§è¡ã",charsets:{cjk:!0},lastUpdated:"2023/01/24, 15:21:13",lastUpdatedTimestamp:1674573673e3},{title:"æ¹æ³",frontmatter:{title:"æ¹æ³",date:"2023-01-24T23:03:17.000Z",permalink:"/pages/615479/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/15.%E6%96%B9%E6%B3%95.html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/15.æ¹æ³.md",key:"v-43f0e09d",path:"/pages/615479/",headers:[{level:2,title:"1. æ¹æ³è°ç¨è¿ç¨å¾è§£ï¼çè§£ï¼",slug:"_1-æ¹æ³è°ç¨è¿ç¨å¾è§£-çè§£",normalizedTitle:"1. æ¹æ³è°ç¨è¿ç¨å¾è§£ï¼çè§£ï¼",charIndex:9},{level:2,title:"2. æ¹æ³çåæ°ä¼ éæºå¶",slug:"_2-æ¹æ³çåæ°ä¼ éæºå¶",normalizedTitle:"2. æ¹æ³çåæ°ä¼ éæºå¶",charIndex:160},{level:2,title:"3. æ¹æ³éè½½",slug:"_3-æ¹æ³éè½½",normalizedTitle:"3. æ¹æ³éè½½",charIndex:273},{level:3,title:"3.1 æ¹æ³éè½½æ¦å¿µ",slug:"_3-1-æ¹æ³éè½½æ¦å¿µ",normalizedTitle:"3.1 æ¹æ³éè½½æ¦å¿µ",charIndex:285},{level:3,title:"3.2 æ¹æ³éè½½çè¯å«æå·§",slug:"_3-2-æ¹æ³éè½½çè¯å«æå·§",normalizedTitle:"3.2 æ¹æ³éè½½çè¯å«æå·§",charIndex:399},{level:2,title:"4. åç¬ä½¿ç¨returnå³é®å­",slug:"_4-åç¬ä½¿ç¨returnå³é®å­",normalizedTitle:"4. åç¬ä½¿ç¨returnå³é®å­",charIndex:519}],headersStr:"1. æ¹æ³è°ç¨è¿ç¨å¾è§£ï¼çè§£ï¼ 2. æ¹æ³çåæ°ä¼ éæºå¶ 3. æ¹æ³éè½½ 3.1 æ¹æ³éè½½æ¦å¿µ 3.2 æ¹æ³éè½½çè¯å«æå·§ 4. åç¬ä½¿ç¨returnå³é®å­",content:'# æ¹æ³\n\n\n# 1. æ¹æ³è°ç¨è¿ç¨å¾è§£ï¼çè§£ï¼\n\næ¯ä¸ªæ¹æ³å¨è¢«è°ç¨æ§è¡çæ¶åï¼é½ä¼è¿å¥æ åå­ï¼å¹¶ä¸æ¥æèªå·±ç¬ç«çåå­ç©ºé´ï¼æ¹æ³åé¨ä»£ç è°ç¨å®æ¯ä¹åï¼ä¼ä»æ åå­ä¸­å¼¹æ æ¶å¤±ã\n\n * æ¹æ³æ²¡æè¢«è°ç¨çæ¶åï¼å¨æ¹æ³åºä¸­çå­èç æä»¶ä¸­å­æ¾\n\n * æ¹æ³è¢«è°ç¨çæ¶åï¼éè¦è¿å¥å°æ åå­ä¸­è¿è¡ââæ¹æ³çè¿è¡åºåå¨æ åå­ä¸­\n\n\n# 2. æ¹æ³çåæ°ä¼ éæºå¶\n\n 1. åºæ¬ç±»åçåæ°ä¼ é\n\n 2. å¼ç¨ç±»åçåæ°ä¼ é\n\nä¸¤ç§åæ°ä¼ éæºå¶çåºå«\n\n * é½æ¯å¼ä¼ éã\n\n * åºæ¬ç±»åçåæ°ä¼ è¾å­å¨çæ°æ®å¼ã\n\n * å¼ç¨ç±»åçåæ°ä¼ è¾å­å¨çå°åå¼ã\n\n\n# 3. æ¹æ³éè½½\n\n\n# 3.1 æ¹æ³éè½½æ¦å¿µ\n\næ¹æ³éè½½æåä¸ä¸ªç±»ä¸­å®ä¹çå¤ä¸ªæ¹æ³ä¹é´çå³ç³»ï¼æ»¡è¶³ä¸åæ¡ä»¶çå¤ä¸ªæ¹æ³ç¸äºææéè½½ï¼\n\n * å¤ä¸ªæ¹æ³å¨åä¸ä¸ªç±»ä¸­\n * å¤ä¸ªæ¹æ³å·æç¸åçæ¹æ³å\n * å¤ä¸ªæ¹æ³çåæ°ä¸ç¸åï¼ç±»åä¸åæèæ°éä¸å\n\n\n# 3.2 æ¹æ³éè½½çè¯å«æå·§\n\n * åªè¦æ¯åä¸ä¸ªç±»ä¸­ï¼æ¹æ³åç§°ç¸åãå½¢ååè¡¨ä¸åï¼é£ä¹ä»ä»¬å°±æ¯éè½½çæ¹æ³ï¼å¶ä»é½ä¸ç®¡ï¼ ï¼å¦ï¼ä¿®é¥°ç¬¦ï¼è¿åå¼ç±»åé½æ æè°ï¼\n\n * å½¢ååè¡¨ä¸åæçæ¯ï¼å½¢åçä¸ªæ°ãç±»åãé¡ºåºä¸åï¼ä¸å³å¿å½¢åçåç§°ã\n\n\n# 4. åç¬ä½¿ç¨returnå³é®å­\n\nreturn; ---\x3e å¯ä»¥ç«å³è·³åºå¹¶ç»æå½åæ¹æ³çæ§è¡; returnå³é®å­åç¬ä½¿ç¨å¯ä»¥æ¾å¨ä»»ä½æ¹æ³ä¸­ã\n\npublic class Test {\n    public static void main(String[] args) {\n        System.out.println("å¼å§");\n        chu(10 , 0);\n        System.out.println("ç»æ");\n    }\n     \n    public static void chu(int a , int b) {\n        if(b == 0){\n            System.err.println("æ¨çæ°æ®æè¯¯ï¼ï¼ä¸æ§è¡ï¼ï¼");\n            return; // ç´æ¥ç»æå½åæ¹æ³chu\n        }\n        int c = a / b;\n        System.out.println("é¤æ³ç»ææ¯ï¼"+c);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n',normalizedContent:'# æ¹æ³\n\n\n# 1. æ¹æ³è°ç¨è¿ç¨å¾è§£ï¼çè§£ï¼\n\næ¯ä¸ªæ¹æ³å¨è¢«è°ç¨æ§è¡çæ¶åï¼é½ä¼è¿å¥æ åå­ï¼å¹¶ä¸æ¥æèªå·±ç¬ç«çåå­ç©ºé´ï¼æ¹æ³åé¨ä»£ç è°ç¨å®æ¯ä¹åï¼ä¼ä»æ åå­ä¸­å¼¹æ æ¶å¤±ã\n\n * æ¹æ³æ²¡æè¢«è°ç¨çæ¶åï¼å¨æ¹æ³åºä¸­çå­èç æä»¶ä¸­å­æ¾\n\n * æ¹æ³è¢«è°ç¨çæ¶åï¼éè¦è¿å¥å°æ åå­ä¸­è¿è¡ââæ¹æ³çè¿è¡åºåå¨æ åå­ä¸­\n\n\n# 2. æ¹æ³çåæ°ä¼ éæºå¶\n\n 1. åºæ¬ç±»åçåæ°ä¼ é\n\n 2. å¼ç¨ç±»åçåæ°ä¼ é\n\nä¸¤ç§åæ°ä¼ éæºå¶çåºå«\n\n * é½æ¯å¼ä¼ éã\n\n * åºæ¬ç±»åçåæ°ä¼ è¾å­å¨çæ°æ®å¼ã\n\n * å¼ç¨ç±»åçåæ°ä¼ è¾å­å¨çå°åå¼ã\n\n\n# 3. æ¹æ³éè½½\n\n\n# 3.1 æ¹æ³éè½½æ¦å¿µ\n\næ¹æ³éè½½æåä¸ä¸ªç±»ä¸­å®ä¹çå¤ä¸ªæ¹æ³ä¹é´çå³ç³»ï¼æ»¡è¶³ä¸åæ¡ä»¶çå¤ä¸ªæ¹æ³ç¸äºææéè½½ï¼\n\n * å¤ä¸ªæ¹æ³å¨åä¸ä¸ªç±»ä¸­\n * å¤ä¸ªæ¹æ³å·æç¸åçæ¹æ³å\n * å¤ä¸ªæ¹æ³çåæ°ä¸ç¸åï¼ç±»åä¸åæèæ°éä¸å\n\n\n# 3.2 æ¹æ³éè½½çè¯å«æå·§\n\n * åªè¦æ¯åä¸ä¸ªç±»ä¸­ï¼æ¹æ³åç§°ç¸åãå½¢ååè¡¨ä¸åï¼é£ä¹ä»ä»¬å°±æ¯éè½½çæ¹æ³ï¼å¶ä»é½ä¸ç®¡ï¼ ï¼å¦ï¼ä¿®é¥°ç¬¦ï¼è¿åå¼ç±»åé½æ æè°ï¼\n\n * å½¢ååè¡¨ä¸åæçæ¯ï¼å½¢åçä¸ªæ°ãç±»åãé¡ºåºä¸åï¼ä¸å³å¿å½¢åçåç§°ã\n\n\n# 4. åç¬ä½¿ç¨returnå³é®å­\n\nreturn; ---\x3e å¯ä»¥ç«å³è·³åºå¹¶ç»æå½åæ¹æ³çæ§è¡; returnå³é®å­åç¬ä½¿ç¨å¯ä»¥æ¾å¨ä»»ä½æ¹æ³ä¸­ã\n\npublic class test {\n    public static void main(string[] args) {\n        system.out.println("å¼å§");\n        chu(10 , 0);\n        system.out.println("ç»æ");\n    }\n     \n    public static void chu(int a , int b) {\n        if(b == 0){\n            system.err.println("æ¨çæ°æ®æè¯¯ï¼ï¼ä¸æ§è¡ï¼ï¼");\n            return; // ç´æ¥ç»æå½åæ¹æ³chu\n        }\n        int c = a / b;\n        system.out.println("é¤æ³ç»ææ¯ï¼"+c);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n',charsets:{cjk:!0},lastUpdated:"2023/01/24, 15:21:13",lastUpdatedTimestamp:1674573673e3},{title:"é¢åå¯¹è±¡åºç¡",frontmatter:{title:"é¢åå¯¹è±¡åºç¡",date:"2023-01-29T13:55:56.000Z",permalink:"/pages/d4e408/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/20.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%9F%BA%E7%A1%80.html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/20.é¢åå¯¹è±¡åºç¡.md",key:"v-2b382624",path:"/pages/d4e408/",headers:[{level:2,title:"1. ç±»åå¯¹è±¡",slug:"_1-ç±»åå¯¹è±¡",normalizedTitle:"1. ç±»åå¯¹è±¡",charIndex:13},{level:3,title:"1.1 ç±»åå¯¹è±¡ççè§£",slug:"_1-1-ç±»åå¯¹è±¡ççè§£",normalizedTitle:"1.1 ç±»åå¯¹è±¡ççè§£",charIndex:25},{level:3,title:"1.2 ç±»çå®ä¹",slug:"_1-2-ç±»çå®ä¹",normalizedTitle:"1.2 ç±»çå®ä¹",charIndex:389},{level:2,title:"2. å¯¹è±¡åå­å¾",slug:"_2-å¯¹è±¡åå­å¾",normalizedTitle:"2. å¯¹è±¡åå­å¾",charIndex:925},{level:3,title:"2.1 å¤ä¸ªå¯¹è±¡åå­å¾",slug:"_2-1-å¤ä¸ªå¯¹è±¡åå­å¾",normalizedTitle:"2.1 å¤ä¸ªå¯¹è±¡åå­å¾",charIndex:938},{level:3,title:"2.2 å¤ä¸ªå¯¹è±¡æåç¸ååå­å¾",slug:"_2-2-å¤ä¸ªå¯¹è±¡æåç¸ååå­å¾",normalizedTitle:"2.2 å¤ä¸ªå¯¹è±¡æåç¸ååå­å¾",charIndex:1160},{level:3,title:"2.3 åå¾åæ¶",slug:"_2-3-åå¾åæ¶",normalizedTitle:"2.3 åå¾åæ¶",charIndex:1276},{level:2,title:"3. æé å¨",slug:"_3-æé å¨",normalizedTitle:"3. æé å¨",charIndex:1453},{level:3,title:"3.1 æé å¨çä½ç¨",slug:"_3-1-æé å¨çä½ç¨",normalizedTitle:"3.1 æé å¨çä½ç¨",charIndex:1464},{level:3,title:"3.2 æé å¨çåç±»",slug:"_3-2-æé å¨çåç±»",normalizedTitle:"3.2 æé å¨çåç±»",charIndex:1498},{level:2,title:"4. this å³é®å­",slug:"_4-this-å³é®å­",normalizedTitle:"4. this å³é®å­",charIndex:1874},{level:2,title:"5. å°è£",slug:"_5-å°è£",normalizedTitle:"5. å°è£",charIndex:1960},{level:3,title:"5.1 ä»ä¹æ¯å°è£",slug:"_5-1-ä»ä¹æ¯å°è£",normalizedTitle:"5.1 ä»ä¹æ¯å°è£",charIndex:1970},{level:3,title:"5.2 å°è£çå®ç°æ­¥éª¤",slug:"_5-2-å°è£çå®ç°æ­¥éª¤",normalizedTitle:"5.2 å°è£çå®ç°æ­¥éª¤",charIndex:2041},{level:3,title:"5.3 å°è£çå¥½å¤",slug:"_5-3-å°è£çå¥½å¤",normalizedTitle:"5.3 å°è£çå¥½å¤",charIndex:2250},{level:2,title:"6. æ å JavaBean",slug:"_6-æ å-javabean",normalizedTitle:"6. æ å javabean",charIndex:2315},{level:2,title:"7.  æååéåå±é¨åé",slug:"_7-æååéåå±é¨åé",normalizedTitle:"7.  æååéåå±é¨åé",charIndex:null},{level:3,title:"7.1 æååéåå±é¨åéçåºå«",slug:"_7-1-æååéåå±é¨åéçåºå«",normalizedTitle:"7.1 æååéåå±é¨åéçåºå«",charIndex:2485}],headersStr:"1. ç±»åå¯¹è±¡ 1.1 ç±»åå¯¹è±¡ççè§£ 1.2 ç±»çå®ä¹ 2. å¯¹è±¡åå­å¾ 2.1 å¤ä¸ªå¯¹è±¡åå­å¾ 2.2 å¤ä¸ªå¯¹è±¡æåç¸ååå­å¾ 2.3 åå¾åæ¶ 3. æé å¨ 3.1 æé å¨çä½ç¨ 3.2 æé å¨çåç±» 4. this å³é®å­ 5. å°è£ 5.1 ä»ä¹æ¯å°è£ 5.2 å°è£çå®ç°æ­¥éª¤ 5.3 å°è£çå¥½å¤ 6. æ å JavaBean 7.  æååéåå±é¨åé 7.1 æååéåå±é¨åéçåºå«",content:"# é¢åå¯¹è±¡åºç¡\n\n\n# 1. ç±»åå¯¹è±¡\n\n\n# 1.1 ç±»åå¯¹è±¡ççè§£\n\nå®¢è§å­å¨çäºç©çä¸ºå¯¹è±¡ ï¼æä»¥æä»¬ä¹å¸¸å¸¸è¯´ä¸ç©çå¯¹è±¡ã\n\n * ç±»\n   * ç±»ççè§£\n     * ç±»æ¯å¯¹ç°å®çæ´»ä¸­ä¸ç±»å·æå±åå±æ§åè¡ä¸ºçäºç©çæ½è±¡\n     * ç±»æ¯å¯¹è±¡çæ°æ®ç±»åï¼ç±»æ¯å·æç¸åå±æ§åè¡ä¸ºçä¸ç»å¯¹è±¡çéå\n     * ç®åçè§£ï¼ç±»å°±æ¯å¯¹ç°å®äºç©çä¸ç§æè¿°\n   * ç±»çç»æ\n     * å±æ§ï¼æäºç©çç¹å¾ï¼ä¾å¦ï¼ææºäºç©ï¼åçï¼ä»·æ ¼ï¼å°ºå¯¸ï¼\n     * è¡ä¸ºï¼æäºç©è½æ§è¡çæä½ï¼ä¾å¦ï¼ææºäºç©ï¼æçµè¯ï¼åç­ä¿¡ï¼\n * ç±»åå¯¹è±¡çå³ç³»\n   * ç±»ï¼ç±»æ¯å¯¹ç°å®çæ´»ä¸­ä¸ç±»å·æå±åå±æ§åè¡ä¸ºçäºç©çæ½è±¡ï¼æ¯å¯¹è±¡å±åç¹å¾çæè¿°\n   * å¯¹è±¡ï¼æ¯è½å¤çå¾å°æ¸ççççå®å­å¨çå®ä½ï¼æ¯çå®å­å¨çå·ä½å®ä¾\n   * ç®åçè§£ï¼ç±»æ¯å¯¹äºç©çä¸ç§æè¿°ï¼å¯¹è±¡åä¸ºå·ä½å­å¨çäºç©\n\n\n# 1.2 ç±»çå®ä¹\n\nç±»çç»ææ¯ç±å±æ§åè¡ä¸ºä¸¤é¨åç»æ\n\n * å±æ§ï¼å¨ç±»ä¸­éè¿æååéæ¥ä½ç°ï¼ç±»ä¸­æ¹æ³å¤çåéï¼\n * è¡ä¸ºï¼å¨ç±»ä¸­éè¿æåæ¹æ³æ¥ä½ç°ï¼ååé¢çæ¹æ³ç¸æ¯å»æstaticå³é®å­å³å¯ï¼\n\nâ ï¸ è¡¥åæ³¨æäºé¡¹ï¼\n\n * ç±»åé¦å­æ¯å»ºè®®å¤§åï¼ä¸ææä¹ï¼æ»¡è¶³âé©¼å³°æ¨¡å¼âã\n\n * ä¸ä¸ªJavaæä»¶ä¸­å¯ä»¥å®ä¹å¤ä¸ªclassç±»ï¼ä¸åªè½ä¸ä¸ªç±»æ¯publicä¿®é¥°ï¼èä¸publicä¿®é¥°çç±»åå¿é¡»æä¸ºä»£ç æä»¶åã å®éå¼åä¸­å»ºè®®è¿æ¯ä¸ä¸ªæä»¶å®ä¹ä¸ä¸ªclassç±»ã\n\n * æååéçå®æ´å®ä¹æ ¼å¼æ¯ï¼ä¿®é¥°ç¬¦ æ°æ®ç±»å åéåç§° = åå§åå¼ï¼ ä¸è¬æ éæå®åå§åå¼ï¼å­å¨é»è®¤å¼ã\n   \n   * å¯¹è±¡çæååéçé»è®¤å¼è§åï¼\n   \n   * æ°æ®ç±»å   æç»                         é»è®¤å¼\n     åºæ¬ç±»å   byteãshortãcharãintãlong   0\n     åºæ¬ç±»å   floatãdouble               0.0\n     åºæ¬ç±»å   boolean                    false\n     å¼ç¨ç±»å   ç±»ãæ¥å£ãæ°ç»ãString             null\n\n\n# 2. å¯¹è±¡åå­å¾\n\n\n# 2.1 å¤ä¸ªå¯¹è±¡åå­å¾\n\n * å¯¹è±¡çæåæ¹æ³ä¸ç´æ¥å è½½å°å åå­ä¸­ï¼èæ¯å¨å åå­ä¸­å¼ç¨æ¹æ³åºä¸­çåå®¹ã\n * å¯¹è±¡çæååéå­å¨å¼å¨å åå­ä¸­ä¿®æ¹ã\n\n\n\n * æ§è¡å°ç¬¬äºä¸ªå¯¹è±¡åå»ºæ¶ï¼å¨å åå­ä¸­åå¼è¾ä¸ä¸ªæ°çç©ºé´å­æ­¤æ°å¯¹è±¡ã\n\n\n\næ»ç»ï¼\n\n * å¯¹è±¡æ¾å¨å åå­ä¸­ã\n * Car c = new Car(); è¯­å¥ä¸­ï¼c åéåä¸­å­å¨çæ¯å¯¹è±¡å¨å åå­ä¸­çå°åã\n * æååéï¼nameãpriceï¼çæ°æ®æ¾å¨å¯¹è±¡ä¸­ï¼å­å¨å åå­ä¸­ã\n\n\n# 2.2 å¤ä¸ªå¯¹è±¡æåç¸ååå­å¾\n\n\n\næ»ç»ï¼\n\n * å½å¤ä¸ªå¯¹è±¡çå¼ç¨æååä¸ä¸ªåå­ç©ºé´ï¼åéæè®°å½çå°åå¼æ¯ä¸æ ·çï¼\n\n * åªè¦æä»»ä½ä¸ä¸ªå¯¹è±¡ä¿®æ¹äºåå­ä¸­çæ°æ®ï¼éåï¼æ è®ºä½¿ç¨åªä¸ä¸ªå¯¹è±¡è¿è¡æ°æ®è·åï¼é½æ¯ä¿®æ¹åçæ°æ®ã\n\n\n# 2.3 åå¾åæ¶\n\n * å½å åå­ä¸­çç±»å¯¹è±¡ææ°ç»å¯¹è±¡ï¼æ²¡æè¢«ä»»ä½åéå¼ç¨ï¼æåï¼æ¶ï¼å°±ä¼è¢«å¤å®ä¸ºåå­ä¸­çâåå¾âã\n   \n   * å¦ä¸å¾ä¸­è¥ä»£ç ä¸­åç»­è¿æ s1=null; s2=null; ï¼ä¼å¯¼è´å·¦ä¾§ä¸¤æ¡æåå åå­ä¸­å¯¹è±¡å­å¨åºåççº¢çº¿ä¸å­å¨ï¼æ­¤æ¶å åå­çç½è²åºååæäºåå­åå¾ã\n\n * Java å­å¨èªå¨åå¾åæ¶å¨ï¼ä¼å®æè¿è¡æ¸çã\n\n\n# 3. æé å¨\n\n\n# 3.1 æé å¨çä½ç¨\n\nåå§åç±»çå¯¹è±¡ï¼å¹¶è¿åå¯¹è±¡çå°åã\n\n\n# 3.2 æé å¨çåç±»\n\n * æ åæ°æé å¨\n   \n   * ï¼é»è®¤å­å¨çï¼ï¼åå§åå¯¹è±¡æ¶ï¼æååéçæ°æ®åéç¨é»è®¤å¼ã\n\n * æåæ°æé å¨\n   \n   * å¨åå§åå¯¹è±¡çæ¶åï¼åæ¶å¯ä»¥ä¸ºå¯¹è±¡è¿è¡èµå¼ã\n\nâ ï¸ æ³¨æäºé¡¹ï¼\n\n * ä»»ä½ç±»å®ä¹åºæ¥ï¼é»è®¤å°±èªå¸¦äºæ åæ°æé å¨ï¼åä¸åé½æã\n\n * ä¸æ¦å®ä¹äºæåæ°æé å¨ï¼æ åæ°æé å¨å°±æ²¡æäºï¼æ­¤æ¶å°±éè¦èªå·±åä¸ä¸ªæ åæ°æé å¨äºã\n\npublic class Car {\n    ...\n    // æ åæ°æé å¨ï¼æ­¤æ¶éè¦æç¡®ååºæ¥ï¼\n    public Car(){\n        \n    }\n    // æåæ°æé å¨\n    public Car(String n, String b){\n        \n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# 4. this å³é®å­\n\n * ä½ç¨\n   * ä»£è¡¨å½åå¯¹è±¡çå°å\n * thiså³é®å­å¨æé å¨ä¸­ãæåæ¹æ³ä¸­å¯ä»¥åä»ä¹\n   * å¯ä»¥ç¨äºè®¿é®å½åå¯¹è±¡çæååé\n\n\n# 5. å°è£\n\n\n# 5.1 ä»ä¹æ¯å°è£\n\n * é¢åå¯¹è±¡çä¸å¤§ç¹å¾ï¼å°è£ï¼ç»§æ¿ï¼å¤æ\n\n * éèå®ç°ç»èï¼æ´é²åºåéçè®¿é®æ¹å¼ãï¼åçéèãåçæ´é²ï¼\n\n\n# 5.2 å°è£çå®ç°æ­¥éª¤\n\n * ä¸è¬å¯¹æååéä½¿ç¨ private (ç§æ)å³é®å­ä¿®é¥°è¿è¡éèï¼private ä¿®é¥°åè¯¥æååéå°±åªè½å¨å½åç±»ä¸­è®¿é®ã\n\n * æä¾ public ä¿®é¥°çå¬å¼ç getterãsetter æ¹æ³æ´é²å¶åå¼åèµå¼ã\n   \n   * IDEA ä¸­å¯ä»¥èªå¨çæ getterãsetter æ¹æ³\n\næ¹æ³ååªä¸ªå¯¹è±¡å°è£å¨ä¸èµ·æä¹ç¡®å® ï¼\n\næ¹æ³å¯¼è´è°çå±æ§ååï¼è¯¥æ¹æ³å°±å±äºåªä¸ªå¯¹è±¡\n\n\n# 5.3 å°è£çå¥½å¤\n\n * å å¼ºäºç¨åºä»£ç çå®å¨æ§ã\n * éå½çå°è£å¯ä»¥æåå¼åæçï¼åæ¶å¯ä»¥è®©ç¨åºæ´å®¹æçè§£ä¸ç»´æ¤ã\n\n\n# 6. æ å JavaBean\n\nJavaBean: ä¹å¯ä»¥çè§£æå®ä½ç±»ï¼å¶å¯¹è±¡å¯ä»¥ç¨äºå¨ç¨åºä¸­å°è£æ°æ®ã\n\næ åJavaBeané¡»æ»¡è¶³å¦ä¸è¦æ±ï¼\n\n * æååéä½¿ç¨ private ä¿®é¥°ã\n * æä¾æ¯ä¸ä¸ªæååéå¯¹åºç setXxx() / getXxx()ã\n * å¿é¡»æä¾ä¸ä¸ªæ åæé å¨ã\n\n\n# 7. æååéåå±é¨åé\n\n\n# 7.1 æååéåå±é¨åéçåºå«\n\nåºå«        æååé                    å±é¨åé\nç±»ä¸­ä½ç½®ä¸å    ç±»ä¸­ï¼æ¹æ³å¤                  å¸¸è§äºæ¹æ³ä¸­\nåå§åå¼ä¸å    æé»è®¤åå§åå¼                 æ²¡æï¼ä½¿ç¨ä¹åéè¦å®æèµå¼\nåå­ä¸­ä½ç½®ä¸å   å åå­                     æ åå­\nçå½å¨æä¸å    éçå¯¹è±¡çåå»ºèå­å¨ï¼éçå¯¹è±¡çæ¶å¤±èæ¶å¤±   éçæ¹æ³çè°ç¨èå­å¨ï¼éçæ¹æ³çè¿è¡ç»æèæ¶å¤±\nä½ç¨å       (ä¸ä¸å®)                   å¨æå½å±çå¤§æ¬å·ä¸­",normalizedContent:"# é¢åå¯¹è±¡åºç¡\n\n\n# 1. ç±»åå¯¹è±¡\n\n\n# 1.1 ç±»åå¯¹è±¡ççè§£\n\nå®¢è§å­å¨çäºç©çä¸ºå¯¹è±¡ ï¼æä»¥æä»¬ä¹å¸¸å¸¸è¯´ä¸ç©çå¯¹è±¡ã\n\n * ç±»\n   * ç±»ççè§£\n     * ç±»æ¯å¯¹ç°å®çæ´»ä¸­ä¸ç±»å·æå±åå±æ§åè¡ä¸ºçäºç©çæ½è±¡\n     * ç±»æ¯å¯¹è±¡çæ°æ®ç±»åï¼ç±»æ¯å·æç¸åå±æ§åè¡ä¸ºçä¸ç»å¯¹è±¡çéå\n     * ç®åçè§£ï¼ç±»å°±æ¯å¯¹ç°å®äºç©çä¸ç§æè¿°\n   * ç±»çç»æ\n     * å±æ§ï¼æäºç©çç¹å¾ï¼ä¾å¦ï¼ææºäºç©ï¼åçï¼ä»·æ ¼ï¼å°ºå¯¸ï¼\n     * è¡ä¸ºï¼æäºç©è½æ§è¡çæä½ï¼ä¾å¦ï¼ææºäºç©ï¼æçµè¯ï¼åç­ä¿¡ï¼\n * ç±»åå¯¹è±¡çå³ç³»\n   * ç±»ï¼ç±»æ¯å¯¹ç°å®çæ´»ä¸­ä¸ç±»å·æå±åå±æ§åè¡ä¸ºçäºç©çæ½è±¡ï¼æ¯å¯¹è±¡å±åç¹å¾çæè¿°\n   * å¯¹è±¡ï¼æ¯è½å¤çå¾å°æ¸ççççå®å­å¨çå®ä½ï¼æ¯çå®å­å¨çå·ä½å®ä¾\n   * ç®åçè§£ï¼ç±»æ¯å¯¹äºç©çä¸ç§æè¿°ï¼å¯¹è±¡åä¸ºå·ä½å­å¨çäºç©\n\n\n# 1.2 ç±»çå®ä¹\n\nç±»çç»ææ¯ç±å±æ§åè¡ä¸ºä¸¤é¨åç»æ\n\n * å±æ§ï¼å¨ç±»ä¸­éè¿æååéæ¥ä½ç°ï¼ç±»ä¸­æ¹æ³å¤çåéï¼\n * è¡ä¸ºï¼å¨ç±»ä¸­éè¿æåæ¹æ³æ¥ä½ç°ï¼ååé¢çæ¹æ³ç¸æ¯å»æstaticå³é®å­å³å¯ï¼\n\nâ ï¸ è¡¥åæ³¨æäºé¡¹ï¼\n\n * ç±»åé¦å­æ¯å»ºè®®å¤§åï¼ä¸ææä¹ï¼æ»¡è¶³âé©¼å³°æ¨¡å¼âã\n\n * ä¸ä¸ªjavaæä»¶ä¸­å¯ä»¥å®ä¹å¤ä¸ªclassç±»ï¼ä¸åªè½ä¸ä¸ªç±»æ¯publicä¿®é¥°ï¼èä¸publicä¿®é¥°çç±»åå¿é¡»æä¸ºä»£ç æä»¶åã å®éå¼åä¸­å»ºè®®è¿æ¯ä¸ä¸ªæä»¶å®ä¹ä¸ä¸ªclassç±»ã\n\n * æååéçå®æ´å®ä¹æ ¼å¼æ¯ï¼ä¿®é¥°ç¬¦ æ°æ®ç±»å åéåç§° = åå§åå¼ï¼ ä¸è¬æ éæå®åå§åå¼ï¼å­å¨é»è®¤å¼ã\n   \n   * å¯¹è±¡çæååéçé»è®¤å¼è§åï¼\n   \n   * æ°æ®ç±»å   æç»                         é»è®¤å¼\n     åºæ¬ç±»å   byteãshortãcharãintãlong   0\n     åºæ¬ç±»å   floatãdouble               0.0\n     åºæ¬ç±»å   boolean                    false\n     å¼ç¨ç±»å   ç±»ãæ¥å£ãæ°ç»ãstring             null\n\n\n# 2. å¯¹è±¡åå­å¾\n\n\n# 2.1 å¤ä¸ªå¯¹è±¡åå­å¾\n\n * å¯¹è±¡çæåæ¹æ³ä¸ç´æ¥å è½½å°å åå­ä¸­ï¼èæ¯å¨å åå­ä¸­å¼ç¨æ¹æ³åºä¸­çåå®¹ã\n * å¯¹è±¡çæååéå­å¨å¼å¨å åå­ä¸­ä¿®æ¹ã\n\n\n\n * æ§è¡å°ç¬¬äºä¸ªå¯¹è±¡åå»ºæ¶ï¼å¨å åå­ä¸­åå¼è¾ä¸ä¸ªæ°çç©ºé´å­æ­¤æ°å¯¹è±¡ã\n\n\n\næ»ç»ï¼\n\n * å¯¹è±¡æ¾å¨å åå­ä¸­ã\n * car c = new car(); è¯­å¥ä¸­ï¼c åéåä¸­å­å¨çæ¯å¯¹è±¡å¨å åå­ä¸­çå°åã\n * æååéï¼nameãpriceï¼çæ°æ®æ¾å¨å¯¹è±¡ä¸­ï¼å­å¨å åå­ä¸­ã\n\n\n# 2.2 å¤ä¸ªå¯¹è±¡æåç¸ååå­å¾\n\n\n\næ»ç»ï¼\n\n * å½å¤ä¸ªå¯¹è±¡çå¼ç¨æååä¸ä¸ªåå­ç©ºé´ï¼åéæè®°å½çå°åå¼æ¯ä¸æ ·çï¼\n\n * åªè¦æä»»ä½ä¸ä¸ªå¯¹è±¡ä¿®æ¹äºåå­ä¸­çæ°æ®ï¼éåï¼æ è®ºä½¿ç¨åªä¸ä¸ªå¯¹è±¡è¿è¡æ°æ®è·åï¼é½æ¯ä¿®æ¹åçæ°æ®ã\n\n\n# 2.3 åå¾åæ¶\n\n * å½å åå­ä¸­çç±»å¯¹è±¡ææ°ç»å¯¹è±¡ï¼æ²¡æè¢«ä»»ä½åéå¼ç¨ï¼æåï¼æ¶ï¼å°±ä¼è¢«å¤å®ä¸ºåå­ä¸­çâåå¾âã\n   \n   * å¦ä¸å¾ä¸­è¥ä»£ç ä¸­åç»­è¿æ s1=null; s2=null; ï¼ä¼å¯¼è´å·¦ä¾§ä¸¤æ¡æåå åå­ä¸­å¯¹è±¡å­å¨åºåççº¢çº¿ä¸å­å¨ï¼æ­¤æ¶å åå­çç½è²åºååæäºåå­åå¾ã\n\n * java å­å¨èªå¨åå¾åæ¶å¨ï¼ä¼å®æè¿è¡æ¸çã\n\n\n# 3. æé å¨\n\n\n# 3.1 æé å¨çä½ç¨\n\nåå§åç±»çå¯¹è±¡ï¼å¹¶è¿åå¯¹è±¡çå°åã\n\n\n# 3.2 æé å¨çåç±»\n\n * æ åæ°æé å¨\n   \n   * ï¼é»è®¤å­å¨çï¼ï¼åå§åå¯¹è±¡æ¶ï¼æååéçæ°æ®åéç¨é»è®¤å¼ã\n\n * æåæ°æé å¨\n   \n   * å¨åå§åå¯¹è±¡çæ¶åï¼åæ¶å¯ä»¥ä¸ºå¯¹è±¡è¿è¡èµå¼ã\n\nâ ï¸ æ³¨æäºé¡¹ï¼\n\n * ä»»ä½ç±»å®ä¹åºæ¥ï¼é»è®¤å°±èªå¸¦äºæ åæ°æé å¨ï¼åä¸åé½æã\n\n * ä¸æ¦å®ä¹äºæåæ°æé å¨ï¼æ åæ°æé å¨å°±æ²¡æäºï¼æ­¤æ¶å°±éè¦èªå·±åä¸ä¸ªæ åæ°æé å¨äºã\n\npublic class car {\n    ...\n    // æ åæ°æé å¨ï¼æ­¤æ¶éè¦æç¡®ååºæ¥ï¼\n    public car(){\n        \n    }\n    // æåæ°æé å¨\n    public car(string n, string b){\n        \n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# 4. this å³é®å­\n\n * ä½ç¨\n   * ä»£è¡¨å½åå¯¹è±¡çå°å\n * thiså³é®å­å¨æé å¨ä¸­ãæåæ¹æ³ä¸­å¯ä»¥åä»ä¹\n   * å¯ä»¥ç¨äºè®¿é®å½åå¯¹è±¡çæååé\n\n\n# 5. å°è£\n\n\n# 5.1 ä»ä¹æ¯å°è£\n\n * é¢åå¯¹è±¡çä¸å¤§ç¹å¾ï¼å°è£ï¼ç»§æ¿ï¼å¤æ\n\n * éèå®ç°ç»èï¼æ´é²åºåéçè®¿é®æ¹å¼ãï¼åçéèãåçæ´é²ï¼\n\n\n# 5.2 å°è£çå®ç°æ­¥éª¤\n\n * ä¸è¬å¯¹æååéä½¿ç¨ private (ç§æ)å³é®å­ä¿®é¥°è¿è¡éèï¼private ä¿®é¥°åè¯¥æååéå°±åªè½å¨å½åç±»ä¸­è®¿é®ã\n\n * æä¾ public ä¿®é¥°çå¬å¼ç getterãsetter æ¹æ³æ´é²å¶åå¼åèµå¼ã\n   \n   * idea ä¸­å¯ä»¥èªå¨çæ getterãsetter æ¹æ³\n\næ¹æ³ååªä¸ªå¯¹è±¡å°è£å¨ä¸èµ·æä¹ç¡®å® ï¼\n\næ¹æ³å¯¼è´è°çå±æ§ååï¼è¯¥æ¹æ³å°±å±äºåªä¸ªå¯¹è±¡\n\n\n# 5.3 å°è£çå¥½å¤\n\n * å å¼ºäºç¨åºä»£ç çå®å¨æ§ã\n * éå½çå°è£å¯ä»¥æåå¼åæçï¼åæ¶å¯ä»¥è®©ç¨åºæ´å®¹æçè§£ä¸ç»´æ¤ã\n\n\n# 6. æ å javabean\n\njavabean: ä¹å¯ä»¥çè§£æå®ä½ç±»ï¼å¶å¯¹è±¡å¯ä»¥ç¨äºå¨ç¨åºä¸­å°è£æ°æ®ã\n\næ åjavabeané¡»æ»¡è¶³å¦ä¸è¦æ±ï¼\n\n * æååéä½¿ç¨ private ä¿®é¥°ã\n * æä¾æ¯ä¸ä¸ªæååéå¯¹åºç setxxx() / getxxx()ã\n * å¿é¡»æä¾ä¸ä¸ªæ åæé å¨ã\n\n\n# 7. æååéåå±é¨åé\n\n\n# 7.1 æååéåå±é¨åéçåºå«\n\nåºå«        æååé                    å±é¨åé\nç±»ä¸­ä½ç½®ä¸å    ç±»ä¸­ï¼æ¹æ³å¤                  å¸¸è§äºæ¹æ³ä¸­\nåå§åå¼ä¸å    æé»è®¤åå§åå¼                 æ²¡æï¼ä½¿ç¨ä¹åéè¦å®æèµå¼\nåå­ä¸­ä½ç½®ä¸å   å åå­                     æ åå­\nçå½å¨æä¸å    éçå¯¹è±¡çåå»ºèå­å¨ï¼éçå¯¹è±¡çæ¶å¤±èæ¶å¤±   éçæ¹æ³çè°ç¨èå­å¨ï¼éçæ¹æ³çè¿è¡ç»æèæ¶å¤±\nä½ç¨å       (ä¸ä¸å®)                   å¨æå½å±çå¤§æ¬å·ä¸­",charsets:{cjk:!0},lastUpdated:"2023/01/29, 08:40:33",lastUpdatedTimestamp:1674981633e3},{title:"å¸¸ç¨API(StringãArrayList)",frontmatter:{title:"å¸¸ç¨API(StringãArrayList)",date:"2023-02-01T10:49:22.000Z",permalink:"/pages/8f676c/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/25.%E5%B8%B8%E7%94%A8API(String%E3%80%81ArrayList).html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/25.å¸¸ç¨API(StringãArrayList).md",key:"v-36c9cb62",path:"/pages/8f676c/",headers:[{level:2,title:"1. API",slug:"_1-api",normalizedTitle:"1. api",charIndex:20},{level:3,title:"1.1 APIæ¦è¿°",slug:"_1-1-apiæ¦è¿°",normalizedTitle:"1.1 apiæ¦è¿°",charIndex:31},{level:2,title:"2. Stringç±»",slug:"_2-stringç±»",normalizedTitle:"2. stringç±»",charIndex:230},{level:3,title:"2.1 Stringç±»æ¦è¿°",slug:"_2-1-stringç±»æ¦è¿°",normalizedTitle:"2.1 stringç±»æ¦è¿°",charIndex:245},{level:3,title:"2.2 Stringç±»çç¹ç¹",slug:"_2-2-stringç±»çç¹ç¹",normalizedTitle:"2.2 stringç±»çç¹ç¹",charIndex:422},{level:3,title:"2.3 Stringç±»åå»ºå¯¹è±¡ç2ç§æ¹å¼",slug:"_2-3-stringç±»åå»ºå¯¹è±¡ç2ç§æ¹å¼",normalizedTitle:"2.3 stringç±»åå»ºå¯¹è±¡ç2ç§æ¹å¼",charIndex:880},{level:4,title:"2.3.1 ä¸¤ç§æ¹å¼",slug:"_2-3-1-ä¸¤ç§æ¹å¼",normalizedTitle:"2.3.1 ä¸¤ç§æ¹å¼",charIndex:904},{level:4,title:"2.3.2 ä¸¤ç§æ¹å¼çåºå«ï¼",slug:"_2-3-2-ä¸¤ç§æ¹å¼çåºå«",normalizedTitle:"2.3.2 ä¸¤ç§æ¹å¼çåºå«ï¼",charIndex:2257},{level:4,title:"2.3.3 String å¸¸è§é¢è¯é¢",slug:"_2-3-3-string-å¸¸è§é¢è¯é¢",normalizedTitle:"2.3.3 string å¸¸è§é¢è¯é¢",charIndex:2737},{level:3,title:"2.4 å­ç¬¦ä¸²åå®¹æ¯è¾",slug:"_2-4-å­ç¬¦ä¸²åå®¹æ¯è¾",normalizedTitle:"2.4 å­ç¬¦ä¸²åå®¹æ¯è¾",charIndex:3684},{level:4,title:"2.4.1 == å·çä½ç¨",slug:"_2-4-1-å·çä½ç¨",normalizedTitle:"2.4.1 == å·çä½ç¨",charIndex:3699},{level:4,title:"2.4.2 equals æ¹æ³çä½ç¨",slug:"_2-4-2-equals-æ¹æ³çä½ç¨",normalizedTitle:"2.4.2 equals æ¹æ³çä½ç¨",charIndex:3760},{level:3,title:"2.5 String å¶ä»å¸¸ç¨API",slug:"_2-5-string-å¶ä»å¸¸ç¨api",normalizedTitle:"2.5 string å¶ä»å¸¸ç¨api",charIndex:4421},{level:2,title:"3. ArrayList",slug:"_3-arraylist",normalizedTitle:"3. arraylist",charIndex:4542},{level:3,title:"3.1 éåæ¦è¿°",slug:"_3-1-éåæ¦è¿°",normalizedTitle:"3.1 éåæ¦è¿°",charIndex:4559},{level:3,title:"3.2 ArrayList éå",slug:"_3-2-arraylist-éå",normalizedTitle:"3.2 arraylist éå",charIndex:4788},{level:4,title:"3.2.1 ArrayListéåçå¯¹è±¡è·å",slug:"_3-2-1-arraylistéåçå¯¹è±¡è·å",normalizedTitle:"3.2.1 arraylistéåçå¯¹è±¡è·å",charIndex:4849},{level:4,title:"3.2.2 ArrayList å¯¹äºæ³åçæ¯æ",slug:"_3-2-2-arraylist-å¯¹äºæ³åçæ¯æ",normalizedTitle:"3.2.2 arraylist å¯¹äºæ³åçæ¯æ",charIndex:4948},{level:3,title:"3.3 ArrayList éåå¸¸ç¨æ¹æ³",slug:"_3-3-arraylist-éåå¸¸ç¨æ¹æ³",normalizedTitle:"3.3 arraylist éåå¸¸ç¨æ¹æ³",charIndex:5195},{level:3,title:"3.4 ArrayList éåæéç¹ï¼éåå¹¶å é¤åç´ ",slug:"_3-4-arraylist-éåæéç¹-éåå¹¶å é¤åç´ ",normalizedTitle:"3.4 arraylist éåæéç¹ï¼éåå¹¶å é¤åç´ ",charIndex:5273}],headersStr:"1. API 1.1 APIæ¦è¿° 2. Stringç±» 2.1 Stringç±»æ¦è¿° 2.2 Stringç±»çç¹ç¹ 2.3 Stringç±»åå»ºå¯¹è±¡ç2ç§æ¹å¼ 2.3.1 ä¸¤ç§æ¹å¼ 2.3.2 ä¸¤ç§æ¹å¼çåºå«ï¼ 2.3.3 String å¸¸è§é¢è¯é¢ 2.4 å­ç¬¦ä¸²åå®¹æ¯è¾ 2.4.1 == å·çä½ç¨ 2.4.2 equals æ¹æ³çä½ç¨ 2.5 String å¶ä»å¸¸ç¨API 3. ArrayList 3.1 éåæ¦è¿° 3.2 ArrayList éå 3.2.1 ArrayListéåçå¯¹è±¡è·å 3.2.2 ArrayList å¯¹äºæ³åçæ¯æ 3.3 ArrayList éåå¸¸ç¨æ¹æ³ 3.4 ArrayList éåæéç¹ï¼éåå¹¶å é¤åç´ ",content:'12131231\n\n\n# å¸¸ç¨\n\n\n# 1. API\n\n\n# 1.1 APIæ¦è¿°\n\n * ä»ä¹æ¯API\n   \n   API (Application Programming Interface) ï¼åºç¨ç¨åºç¼ç¨æ¥å£\n\n * javaä¸­çAPI\n   \n   æçå°±æ¯ JDK ä¸­æä¾çåç§åè½ç Javaç±»ï¼è¿äºç±»å°åºå±çå®ç°å°è£äºèµ·æ¥ï¼æä»¬ä¸éè¦å³å¿è¿äºç±»æ¯å¦ä½å®ç°çï¼åªéè¦å­¦ä¹ è¿äºç±»å¦ä½ä½¿ç¨å³å¯ï¼æä»¬å¯ä»¥éè¿å¸®å©ææ¡£æ¥å­¦ä¹ è¿äºAPIå¦ä½ä½¿ç¨ã\n\n\n# 2. Stringç±»\n\n\n# 2.1 Stringç±»æ¦è¿°\n\nString ç±»ä»£è¡¨å­ç¬¦ä¸²ï¼Java ç¨åºä¸­çææå­ç¬¦ä¸²æå­ï¼ä¾å¦âabcâï¼é½è¢«å®ç°ä¸ºæ­¤ç±»çå®ä¾ãä¹å°±æ¯è¯´ï¼Java ç¨åºä¸­ææçåå¼å·å­ç¬¦ä¸²ï¼é½æ¯ String ç±»çå¯¹è±¡ãString ç±»å¨ java.lang åä¸ï¼æä»¥ä½¿ç¨çæ¶åä¸éè¦å¯¼åï¼\n\nString æ¯å­ç¬¦ä¸²ç±»åï¼å¯ä»¥å®ä¹å­ç¬¦ä¸²åéæåå­ç¬¦ä¸²å¯¹è±¡ã\n\n\n# 2.2 Stringç±»çç¹ç¹\n\n * String å¸¸è¢«ç§°ä¸ºä¸å¯åå­ç¬¦ä¸²ç±»åï¼å®çå¯¹è±¡å¨åå»ºåä¸è½è¢«æ´æ¹ã\n * è½ç¶ String çå¼æ¯ä¸å¯åçï¼ä½æ¯å®ä»¬å¯ä»¥è¢«å±äº«\n * å­ç¬¦ä¸²ææä¸ç¸å½äºå­ç¬¦æ°ç»( char[] )ï¼ä½æ¯åºå±åçæ¯å­èæ°ç»( byte[] )\n\nå­ç¬¦ä¸²å¯¹è±¡å­å¨åªéï¼\n\nð¡ ä»¥ ââ æ¹å¼ç»åºçå­ç¬¦ä¸²å¯¹è±¡ï¼å¨å­ç¬¦ä¸²å¸¸éæ± ä¸­å­å¨ã\n\n\n\nä¸å¾ä¸­ï¼é¦åç± "" ç»åºäºâä¼ æºâå­ç¬¦ä¸²å¸¸éï¼å­å¨äºå­ç¬¦ä¸²å¸¸éæ± ï¼æ§è¡å°å½åæ­¤è¡æ¶ï¼å°âæè²âä¹å­å¥å­ç¬¦ä¸²å¸¸éæ± ï¼äºèæ¿æ¥åè¿ç®ï¼æ°è¿ç®å¾å°çå¯¹è±¡âä¼ æºæè²âç´æ¥æ¾å¨å åå­ä¸­ï¼å¹¶å° name ï¼String ç±»åéï¼æåæ°çè¿ä¸ªå¯¹è±¡ãå æ­¤ String çå¯¹è±¡åå»ºåºæ¥ä¹åçç¡®æªæ¹åï¼åªæ¯æ¯æ¬¡é½å¨æåæ°çå¯¹è±¡ï¼æè¯´ String çå¯¹è±¡æ¯ä¸å¯åå¯¹è±¡ã\n\nä¸å¾åçã\n\n\n\nString æ¯ä¸å¯åå­ç¬¦ä¸²çåå ï¼\n\n * String åéæ¯æ¬¡çä¿®æ¹å¶å®é½æ¯äº§çå¹¶æåäºæ°çå­ç¬¦ä¸²å¯¹è±¡ã\n * åæ¥çå­ç¬¦ä¸²å¯¹è±¡é½æ¯æ²¡ææ¹åçï¼æä»¥ç§°ä¸å¯åå­ç¬¦ä¸²ã\n\n\n# 2.3 Stringç±»åå»ºå¯¹è±¡ç2ç§æ¹å¼\n\n# 2.3.1 ä¸¤ç§æ¹å¼\n\n * æ¹å¼ä¸ï¼ç´æ¥ä½¿ç¨ââå®ä¹ãï¼æ¨èæ¹å¼ï¼\n   \n   String name = "Nrich";\n\n * æ¹å¼äºï¼éè¿Stringç±»çæé å¨åå»ºå¯¹è±¡ã\n   \n   * å¸¸ç¨çæé æ¹æ³ï¼\n   \n   æé å¨                             è¯´æ\n   public String()                 åå»ºä¸ä¸ªç©ºç½å­ç¬¦ä¸²å¯¹è±¡ï¼ä¸å«æä»»ä½åå®¹ï¼åºæ¬ä¸ç¨ï¼\n   public String(String original   æ ¹æ®ä¼ å¥çå­ç¬¦ä¸²åå®¹ï¼æ¥åå»ºå­ç¬¦ä¸²å¯¹è±¡ï¼åºæ¬ä¸ç¨ï¼\n   public String(char[] chs)       æ ¹æ®å­ç¬¦æ°ç»çåå®¹ï¼æ¥åå»ºå­ç¬¦ä¸²å¯¹è±¡\n   public String(byte[] chs)       æ ¹æ®å­èæ°ç»çåå®¹ï¼æ¥åå»ºå­ç¬¦ä¸²å¯¹è±¡\n   \n   * ç¤ºä¾ä»£ç \n     \n     public class StringDemo01 {\n         public static void main(String[] args) {\n             //public String()ï¼åå»ºä¸ä¸ªç©ºç½å­ç¬¦ä¸²å¯¹è±¡ï¼ä¸å«æä»»ä½åå®¹ [åºæ¬ä¸ç¨]\n             String s1 = new String();\n             System.out.println("s1:" + s1);\n     \n             //public String(char[] chs)ï¼æ ¹æ®å­ç¬¦æ°ç»çåå®¹ï¼æ¥åå»ºå­ç¬¦ä¸²å¯¹è±¡\n             char[] chs = {\'a\', \'b\', \'c\'};\n             String s2 = new String(chs);\n             System.out.println("s2:" + s2);\n     \n             //public String(byte[] bys)ï¼æ ¹æ®å­èæ°ç»çåå®¹ï¼æ¥åå»ºå­ç¬¦ä¸²å¯¹è±¡\n             byte[] bys = {97, 98, 99};\n             String s3 = new String(bys);\n             System.out.println("s3:" + s3);\n     \n             //String s = âabcâ;\tç´æ¥èµå¼çæ¹å¼åå»ºå­ç¬¦ä¸²å¯¹è±¡ï¼åå®¹å°±æ¯abc\n             String s4 = "abc";\n             System.out.println("s4:" + s4);\n         }\n     }\n     \n     \n     1\n     2\n     3\n     4\n     5\n     6\n     7\n     8\n     9\n     10\n     11\n     12\n     13\n     14\n     15\n     16\n     17\n     18\n     19\n     20\n     21\n     \n\n# 2.3.2 ä¸¤ç§æ¹å¼çåºå«ï¼\n\n * ä»¥ââæ¹å¼ç»åºçå­ç¬¦ä¸²å¯¹è±¡ï¼å¨å­ç¬¦ä¸²å¸¸éæ± ä¸­å­å¨ï¼èä¸ç¸ååå®¹åªä¼å¨å¶ä¸­å­å¨ä¸ä»½ï¼ä»¥èçåå­èµæºã\n   \n   ä¸å¾ä¸­æ¯è¾ç»æä¸º trueï¼å ä¸ºæ¯è¾çæ¯åéä¸­æå­çå°åï¼è¾åºæ¯å°åä¸­çåå®¹æ¯å ä¸ºåäºå«çå¤çã\n   \n   \n\n * éè¿æé å¨newå¯¹è±¡ï¼æ¯newä¸æ¬¡é½ä¼äº§çä¸ä¸ªæ°å¯¹è±¡ï¼æ¾å¨å åå­ä¸­ã\n\n\n\n * ä»£ç ç¤ºä¾ï¼\n   \n   String s1 = "abc";\n   String s2 = "abc";\n   System.out.println(s1 == s2); // true\n   \n   char[] chs = {\'a\', \'b\', \'c\'};\n   String s3 = new String(chs);\n   String s4 = new String(chs);\n   \n   System.out.println(s3 == s4); // false\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   \n\n# 2.3.3 String å¸¸è§é¢è¯é¢\n\né®é¢ 1 ï¼ä¸åä»£ç çè¿è¡ç»ææ¯ï¼\n\npublic class Test2 {\n    public static void main(String[] args) {\n        \n        String s2 = new String("abc");\n        \n        String s1 = "abc";\n        System.out.println(s1 == s2);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nç»æï¼false â ï¸\n\nè¯´æï¼\n\nLine 4 å®éä¸åå»ºäºä¸¤ä¸ªå¯¹è±¡ï¼âabcâ å¨å­ç¬¦ä¸²å¸¸éæ± åå»ºäºä¸ä¸ªï¼new åå¨å åå­åå»ºäºä¸ä¸ªã\n\nLine 6 å®éä¸æ²¡æåå»ºå¯¹è±¡ï¼ç´æ¥å±ç¨ Line 4 å¨å­ç¬¦ä¸²å¸¸éæ± ä¸­åå»ºçå¯¹è±¡ã\n\nå åå­å¾å¦ä¸ï¼\n\né®é¢ 2 ï¼ä¸åä»£ç çè¿è¡ç»æåå«æ¯ï¼\n\npublic class Test3 {\n    public static void main(String[] args) {\n        String s1 = "abc";\n        String s2 = "ab";\n        String s3 = s2 + "c";\n        System.out.println(s1 == s3);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nç»æï¼false\n\npublic class Test4 {\n    public static void main(String[] args) {\n        String s1 = "abc";\n        String s2 = "a" + "b" + "c";\n        System.out.println(s1 == s2);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nç»æï¼true â ï¸\n\nè¯´æï¼Javaå­å¨ç¼è¯ä¼åæºå¶ï¼ç¨åºå¨ç¼è¯æ¶ï¼ âaâ + âbâ + âcâ ä¼ç´æ¥è½¬æ "abc"ãå ä¸ºå¨ç¼è¯æ¶å·²å¯ä»¥ç¡®å®è¿ä¸ªå¼æ¯å¥ï¼æä¸ç­å°è¿è¡æ¶åæµªè´¹æ§è½è¿è¡è®¡ç®ãä½å½å­å¨åéæ¶ï¼æ æ³å¨ç¼è¯é¶æ®µç¡®å®å¼æ¯å¥ã\n\n\n# 2.4 å­ç¬¦ä¸²åå®¹æ¯è¾\n\n# 2.4.1 == å·çä½ç¨\n\n * æ¯è¾åºæ¬æ°æ®ç±»åï¼æ¯è¾çæ¯å·ä½çå¼\n * æ¯è¾å¼ç¨æ°æ®ç±»åï¼æ¯è¾çæ¯å¯¹è±¡å°åå¼\n\n# 2.4.2 equals æ¹æ³çä½ç¨\n\næ¹æ³å                                                      è¯´æ\npublic boolean equals (Object anObject)                  å°æ­¤å­ç¬¦ä¸²ä¸æå®å¯¹è±¡è¿è¡æ¯è¾ãåªå³å¿å­ç¬¦åå®¹æ¯å¦ä¸è´ï¼\npublic boolean equalsIgnoreCase (String anotherString)   å°æ­¤å­ç¬¦ä¸²ä¸æå®å¯¹è±¡è¿è¡æ¯è¾ï¼å¿½ç¥å¤§å°åæ¯è¾å­ç¬¦ä¸²ãåªå³å¿å­ç¬¦åå®¹æ¯å¦ä¸è´ï¼\n\n * ç¤ºä¾ä»£ç \n   \n   public class StringDemo02 {\n       public static void main(String[] args) {\n           //æé æ¹æ³çæ¹å¼å¾å°å¯¹è±¡\n           char[] chs = {\'a\', \'b\', \'c\'};\n           String s1 = new String(chs);\n           String s2 = new String(chs);\n   \n           //æ¯è¾å­ç¬¦ä¸²åå®¹æ¯å¦ç¸å\n           System.out.println(s1.equals(s2));\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   \n\n\n# 2.5 String å¶ä»å¸¸ç¨API\n\n\n\næç¤º\n\n * Ctrl + Alt + V å¯ä»¥ç´æ¥çæåé\n * æªååæ°ç¬¬ 7 ä½å°åæ°ç¬¬ 4 ä½çå­ä¸²ï¼s.substring(s.length()-7, s.length()-4)\n\n\n# 3. ArrayList\n\n\n# 3.1 éåæ¦è¿°\n\néåæ¯ä¸æ°ç»ç±»ä¼¼ï¼ä¹æ¯ä¸ç§å®¹å¨ï¼ç¨äºè£æ°æ®çã\n\n * æ°ç»çç¹ç¹ï¼\n   \n   æ°ç»å®ä¹å®æå¹¶å¯å¨åï¼ç±»åç¡®å®ãé¿åº¦åºå®ã\n\n * éåçç¹ç¹\n   \n   éåçå¤§å°ä¸åºå®ï¼å¯å¨åå¯ä»¥å¨æååï¼ç±»åä¹å¯ä»¥éæ©ä¸åºå®ã\n   \n   éåéå¸¸éåååç´ ä¸ªæ°ä¸ç¡®å®ï¼ä¸è¦è¿è¡å¢å æä½çä¸å¡åºæ¯ã\n   \n   éåè¿æä¾äºè®¸å¤ä¸°å¯ãå¥½ç¨çåè½ï¼èæ°ç»çåè½å¾åä¸ã\n\nð¡ æ³¨ï¼éåä¸­å­å¨çåç´ å¹¶ä¸æ¯å¯¹è±¡æ¬èº«ï¼èæ¯å¯¹è±¡çå°åã\n\n\n# 3.2 ArrayList éå\n\nArrayListæ¯éåä¸­çä¸ç§ï¼å®æ¯æç´¢å¼ãåºå±æ¯æ°ç»å®ç°çï¼é¿åº¦å¯ä»¥ååã\n\n# 3.2.1 ArrayListéåçå¯¹è±¡è·å\n\nä½¿ç¨æé å¨ public ArrayList()ï¼åå»ºä¸ä¸ªç©ºçéåå¯¹è±¡ãå¦ï¼ArrayList list = new ArrayList();\n\n# 3.2.2 ArrayList å¯¹äºæ³åçæ¯æ\n\nArrayList<E> ï¼ä¸ä¸ªæ³åç±»ï¼å¯ä»¥å¨ç¼è¯é¶æ®µçº¦æéåå¯¹è±¡åªè½æä½æç§ E æ°æ®ç±»åã\n\nä¾å¦ï¼\n\n * ArrayList<String> ï¼æ­¤éååªè½æä½å­ç¬¦ä¸²ç±»åçåç´ ã\n\n * ArrayList<Integer>ï¼æ­¤éååªè½æä½æ´æ°ç±»åçåç´ ã\n\nâ ï¸ æ³¨æï¼\n\néåä¸­åªè½å­å¨å¼ç¨ç±»åï¼ä¸æ¯æåºæ¬æ°æ®ç±»åã\n\nArrayList ä¸è¬é½ä¼ä½¿ç¨æ³åï¼åªæéè¦å¥ç±»åé½æ¯æï¼ä¹ä¼å  ArrayList<Object>ã\n\n\n# 3.3 ArrayList éåå¸¸ç¨æ¹æ³\n\n * ArrayList éåæ·»å åç´ çæ¹æ³ï¼\n\n\n\n * ArrayList éåå¶ä»å¸¸ç¨æ¹æ³ï¼\n\n\n\n\n# 3.4 ArrayList éåæéç¹ï¼éåå¹¶å é¤åç´ \n\néè¯¯åæ³ï¼\n\npublic class ArrayListTest {\n    public static void main(String[] args) {\n        //åå»ºéåå¯¹è±¡\n        ArrayList<Integer> scores = new ArrayList<>();\n\n        //æ·»å æç»©å°éåä¸­\n        scores.add(98);\n        scores.add(20);\n        scores.add(78);\n\n        //éåéåï¼éç¨éç¨éåæ ¼å¼å®ç°\n        for (int i = 0; i < scores.size(); i++) {\n            int score = scores.get(i);\n            if (score < 80){\n                // å»ææç»©ä½äº80åç\n                scores.remove(i);  \n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nåºç°çé®é¢ï¼\n\néç¨ä»¥ä¸çå¸¸è§ fori å½¢å¼è¾¹éåè¾¹å é¤ï¼ä¼å¯¼è´æ¼å é¨ååç´ ãå ä¸º ArrayList çé¿åº¦æ¯å¨æååçï¼å é¤ä¹åä¼åºç°è¡¥ä½çæåµã\n\nè§£å³ï¼\n\nâ  remove ä¹åï¼ i-- ãå³ Line 16 ä¹åæ·»å  i--;\n\nâ¡ ä»éååé¢åçéåç¶åå é¤ï¼ä»£ç å¦ä¸ï¼\n\nfor (int i = scores.size() - 1; i >= 0 ; i--) {\n    int score = scores.get(i);\n    if (score < 80){\n        scores.remove(i);  \n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n',normalizedContent:'12131231\n\n\n# å¸¸ç¨\n\n\n# 1. api\n\n\n# 1.1 apiæ¦è¿°\n\n * ä»ä¹æ¯api\n   \n   api (application programming interface) ï¼åºç¨ç¨åºç¼ç¨æ¥å£\n\n * javaä¸­çapi\n   \n   æçå°±æ¯ jdk ä¸­æä¾çåç§åè½ç javaç±»ï¼è¿äºç±»å°åºå±çå®ç°å°è£äºèµ·æ¥ï¼æä»¬ä¸éè¦å³å¿è¿äºç±»æ¯å¦ä½å®ç°çï¼åªéè¦å­¦ä¹ è¿äºç±»å¦ä½ä½¿ç¨å³å¯ï¼æä»¬å¯ä»¥éè¿å¸®å©ææ¡£æ¥å­¦ä¹ è¿äºapiå¦ä½ä½¿ç¨ã\n\n\n# 2. stringç±»\n\n\n# 2.1 stringç±»æ¦è¿°\n\nstring ç±»ä»£è¡¨å­ç¬¦ä¸²ï¼java ç¨åºä¸­çææå­ç¬¦ä¸²æå­ï¼ä¾å¦âabcâï¼é½è¢«å®ç°ä¸ºæ­¤ç±»çå®ä¾ãä¹å°±æ¯è¯´ï¼java ç¨åºä¸­ææçåå¼å·å­ç¬¦ä¸²ï¼é½æ¯ string ç±»çå¯¹è±¡ãstring ç±»å¨ java.lang åä¸ï¼æä»¥ä½¿ç¨çæ¶åä¸éè¦å¯¼åï¼\n\nstring æ¯å­ç¬¦ä¸²ç±»åï¼å¯ä»¥å®ä¹å­ç¬¦ä¸²åéæåå­ç¬¦ä¸²å¯¹è±¡ã\n\n\n# 2.2 stringç±»çç¹ç¹\n\n * string å¸¸è¢«ç§°ä¸ºä¸å¯åå­ç¬¦ä¸²ç±»åï¼å®çå¯¹è±¡å¨åå»ºåä¸è½è¢«æ´æ¹ã\n * è½ç¶ string çå¼æ¯ä¸å¯åçï¼ä½æ¯å®ä»¬å¯ä»¥è¢«å±äº«\n * å­ç¬¦ä¸²ææä¸ç¸å½äºå­ç¬¦æ°ç»( char[] )ï¼ä½æ¯åºå±åçæ¯å­èæ°ç»( byte[] )\n\nå­ç¬¦ä¸²å¯¹è±¡å­å¨åªéï¼\n\nð¡ ä»¥ ââ æ¹å¼ç»åºçå­ç¬¦ä¸²å¯¹è±¡ï¼å¨å­ç¬¦ä¸²å¸¸éæ± ä¸­å­å¨ã\n\n\n\nä¸å¾ä¸­ï¼é¦åç± "" ç»åºäºâä¼ æºâå­ç¬¦ä¸²å¸¸éï¼å­å¨äºå­ç¬¦ä¸²å¸¸éæ± ï¼æ§è¡å°å½åæ­¤è¡æ¶ï¼å°âæè²âä¹å­å¥å­ç¬¦ä¸²å¸¸éæ± ï¼äºèæ¿æ¥åè¿ç®ï¼æ°è¿ç®å¾å°çå¯¹è±¡âä¼ æºæè²âç´æ¥æ¾å¨å åå­ä¸­ï¼å¹¶å° name ï¼string ç±»åéï¼æåæ°çè¿ä¸ªå¯¹è±¡ãå æ­¤ string çå¯¹è±¡åå»ºåºæ¥ä¹åçç¡®æªæ¹åï¼åªæ¯æ¯æ¬¡é½å¨æåæ°çå¯¹è±¡ï¼æè¯´ string çå¯¹è±¡æ¯ä¸å¯åå¯¹è±¡ã\n\nä¸å¾åçã\n\n\n\nstring æ¯ä¸å¯åå­ç¬¦ä¸²çåå ï¼\n\n * string åéæ¯æ¬¡çä¿®æ¹å¶å®é½æ¯äº§çå¹¶æåäºæ°çå­ç¬¦ä¸²å¯¹è±¡ã\n * åæ¥çå­ç¬¦ä¸²å¯¹è±¡é½æ¯æ²¡ææ¹åçï¼æä»¥ç§°ä¸å¯åå­ç¬¦ä¸²ã\n\n\n# 2.3 stringç±»åå»ºå¯¹è±¡ç2ç§æ¹å¼\n\n# 2.3.1 ä¸¤ç§æ¹å¼\n\n * æ¹å¼ä¸ï¼ç´æ¥ä½¿ç¨ââå®ä¹ãï¼æ¨èæ¹å¼ï¼\n   \n   string name = "nrich";\n\n * æ¹å¼äºï¼éè¿stringç±»çæé å¨åå»ºå¯¹è±¡ã\n   \n   * å¸¸ç¨çæé æ¹æ³ï¼\n   \n   æé å¨                             è¯´æ\n   public string()                 åå»ºä¸ä¸ªç©ºç½å­ç¬¦ä¸²å¯¹è±¡ï¼ä¸å«æä»»ä½åå®¹ï¼åºæ¬ä¸ç¨ï¼\n   public string(string original   æ ¹æ®ä¼ å¥çå­ç¬¦ä¸²åå®¹ï¼æ¥åå»ºå­ç¬¦ä¸²å¯¹è±¡ï¼åºæ¬ä¸ç¨ï¼\n   public string(char[] chs)       æ ¹æ®å­ç¬¦æ°ç»çåå®¹ï¼æ¥åå»ºå­ç¬¦ä¸²å¯¹è±¡\n   public string(byte[] chs)       æ ¹æ®å­èæ°ç»çåå®¹ï¼æ¥åå»ºå­ç¬¦ä¸²å¯¹è±¡\n   \n   * ç¤ºä¾ä»£ç \n     \n     public class stringdemo01 {\n         public static void main(string[] args) {\n             //public string()ï¼åå»ºä¸ä¸ªç©ºç½å­ç¬¦ä¸²å¯¹è±¡ï¼ä¸å«æä»»ä½åå®¹ [åºæ¬ä¸ç¨]\n             string s1 = new string();\n             system.out.println("s1:" + s1);\n     \n             //public string(char[] chs)ï¼æ ¹æ®å­ç¬¦æ°ç»çåå®¹ï¼æ¥åå»ºå­ç¬¦ä¸²å¯¹è±¡\n             char[] chs = {\'a\', \'b\', \'c\'};\n             string s2 = new string(chs);\n             system.out.println("s2:" + s2);\n     \n             //public string(byte[] bys)ï¼æ ¹æ®å­èæ°ç»çåå®¹ï¼æ¥åå»ºå­ç¬¦ä¸²å¯¹è±¡\n             byte[] bys = {97, 98, 99};\n             string s3 = new string(bys);\n             system.out.println("s3:" + s3);\n     \n             //string s = âabcâ;\tç´æ¥èµå¼çæ¹å¼åå»ºå­ç¬¦ä¸²å¯¹è±¡ï¼åå®¹å°±æ¯abc\n             string s4 = "abc";\n             system.out.println("s4:" + s4);\n         }\n     }\n     \n     \n     1\n     2\n     3\n     4\n     5\n     6\n     7\n     8\n     9\n     10\n     11\n     12\n     13\n     14\n     15\n     16\n     17\n     18\n     19\n     20\n     21\n     \n\n# 2.3.2 ä¸¤ç§æ¹å¼çåºå«ï¼\n\n * ä»¥ââæ¹å¼ç»åºçå­ç¬¦ä¸²å¯¹è±¡ï¼å¨å­ç¬¦ä¸²å¸¸éæ± ä¸­å­å¨ï¼èä¸ç¸ååå®¹åªä¼å¨å¶ä¸­å­å¨ä¸ä»½ï¼ä»¥èçåå­èµæºã\n   \n   ä¸å¾ä¸­æ¯è¾ç»æä¸º trueï¼å ä¸ºæ¯è¾çæ¯åéä¸­æå­çå°åï¼è¾åºæ¯å°åä¸­çåå®¹æ¯å ä¸ºåäºå«çå¤çã\n   \n   \n\n * éè¿æé å¨newå¯¹è±¡ï¼æ¯newä¸æ¬¡é½ä¼äº§çä¸ä¸ªæ°å¯¹è±¡ï¼æ¾å¨å åå­ä¸­ã\n\n\n\n * ä»£ç ç¤ºä¾ï¼\n   \n   string s1 = "abc";\n   string s2 = "abc";\n   system.out.println(s1 == s2); // true\n   \n   char[] chs = {\'a\', \'b\', \'c\'};\n   string s3 = new string(chs);\n   string s4 = new string(chs);\n   \n   system.out.println(s3 == s4); // false\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   \n\n# 2.3.3 string å¸¸è§é¢è¯é¢\n\né®é¢ 1 ï¼ä¸åä»£ç çè¿è¡ç»ææ¯ï¼\n\npublic class test2 {\n    public static void main(string[] args) {\n        \n        string s2 = new string("abc");\n        \n        string s1 = "abc";\n        system.out.println(s1 == s2);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nç»æï¼false â ï¸\n\nè¯´æï¼\n\nline 4 å®éä¸åå»ºäºä¸¤ä¸ªå¯¹è±¡ï¼âabcâ å¨å­ç¬¦ä¸²å¸¸éæ± åå»ºäºä¸ä¸ªï¼new åå¨å åå­åå»ºäºä¸ä¸ªã\n\nline 6 å®éä¸æ²¡æåå»ºå¯¹è±¡ï¼ç´æ¥å±ç¨ line 4 å¨å­ç¬¦ä¸²å¸¸éæ± ä¸­åå»ºçå¯¹è±¡ã\n\nå åå­å¾å¦ä¸ï¼\n\né®é¢ 2 ï¼ä¸åä»£ç çè¿è¡ç»æåå«æ¯ï¼\n\npublic class test3 {\n    public static void main(string[] args) {\n        string s1 = "abc";\n        string s2 = "ab";\n        string s3 = s2 + "c";\n        system.out.println(s1 == s3);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nç»æï¼false\n\npublic class test4 {\n    public static void main(string[] args) {\n        string s1 = "abc";\n        string s2 = "a" + "b" + "c";\n        system.out.println(s1 == s2);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nç»æï¼true â ï¸\n\nè¯´æï¼javaå­å¨ç¼è¯ä¼åæºå¶ï¼ç¨åºå¨ç¼è¯æ¶ï¼ âaâ + âbâ + âcâ ä¼ç´æ¥è½¬æ "abc"ãå ä¸ºå¨ç¼è¯æ¶å·²å¯ä»¥ç¡®å®è¿ä¸ªå¼æ¯å¥ï¼æä¸ç­å°è¿è¡æ¶åæµªè´¹æ§è½è¿è¡è®¡ç®ãä½å½å­å¨åéæ¶ï¼æ æ³å¨ç¼è¯é¶æ®µç¡®å®å¼æ¯å¥ã\n\n\n# 2.4 å­ç¬¦ä¸²åå®¹æ¯è¾\n\n# 2.4.1 == å·çä½ç¨\n\n * æ¯è¾åºæ¬æ°æ®ç±»åï¼æ¯è¾çæ¯å·ä½çå¼\n * æ¯è¾å¼ç¨æ°æ®ç±»åï¼æ¯è¾çæ¯å¯¹è±¡å°åå¼\n\n# 2.4.2 equals æ¹æ³çä½ç¨\n\næ¹æ³å                                                      è¯´æ\npublic boolean equals (object anobject)                  å°æ­¤å­ç¬¦ä¸²ä¸æå®å¯¹è±¡è¿è¡æ¯è¾ãåªå³å¿å­ç¬¦åå®¹æ¯å¦ä¸è´ï¼\npublic boolean equalsignorecase (string anotherstring)   å°æ­¤å­ç¬¦ä¸²ä¸æå®å¯¹è±¡è¿è¡æ¯è¾ï¼å¿½ç¥å¤§å°åæ¯è¾å­ç¬¦ä¸²ãåªå³å¿å­ç¬¦åå®¹æ¯å¦ä¸è´ï¼\n\n * ç¤ºä¾ä»£ç \n   \n   public class stringdemo02 {\n       public static void main(string[] args) {\n           //æé æ¹æ³çæ¹å¼å¾å°å¯¹è±¡\n           char[] chs = {\'a\', \'b\', \'c\'};\n           string s1 = new string(chs);\n           string s2 = new string(chs);\n   \n           //æ¯è¾å­ç¬¦ä¸²åå®¹æ¯å¦ç¸å\n           system.out.println(s1.equals(s2));\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   \n\n\n# 2.5 string å¶ä»å¸¸ç¨api\n\n\n\næç¤º\n\n * ctrl + alt + v å¯ä»¥ç´æ¥çæåé\n * æªååæ°ç¬¬ 7 ä½å°åæ°ç¬¬ 4 ä½çå­ä¸²ï¼s.substring(s.length()-7, s.length()-4)\n\n\n# 3. arraylist\n\n\n# 3.1 éåæ¦è¿°\n\néåæ¯ä¸æ°ç»ç±»ä¼¼ï¼ä¹æ¯ä¸ç§å®¹å¨ï¼ç¨äºè£æ°æ®çã\n\n * æ°ç»çç¹ç¹ï¼\n   \n   æ°ç»å®ä¹å®æå¹¶å¯å¨åï¼ç±»åç¡®å®ãé¿åº¦åºå®ã\n\n * éåçç¹ç¹\n   \n   éåçå¤§å°ä¸åºå®ï¼å¯å¨åå¯ä»¥å¨æååï¼ç±»åä¹å¯ä»¥éæ©ä¸åºå®ã\n   \n   éåéå¸¸éåååç´ ä¸ªæ°ä¸ç¡®å®ï¼ä¸è¦è¿è¡å¢å æä½çä¸å¡åºæ¯ã\n   \n   éåè¿æä¾äºè®¸å¤ä¸°å¯ãå¥½ç¨çåè½ï¼èæ°ç»çåè½å¾åä¸ã\n\nð¡ æ³¨ï¼éåä¸­å­å¨çåç´ å¹¶ä¸æ¯å¯¹è±¡æ¬èº«ï¼èæ¯å¯¹è±¡çå°åã\n\n\n# 3.2 arraylist éå\n\narraylistæ¯éåä¸­çä¸ç§ï¼å®æ¯æç´¢å¼ãåºå±æ¯æ°ç»å®ç°çï¼é¿åº¦å¯ä»¥ååã\n\n# 3.2.1 arraylistéåçå¯¹è±¡è·å\n\nä½¿ç¨æé å¨ public arraylist()ï¼åå»ºä¸ä¸ªç©ºçéåå¯¹è±¡ãå¦ï¼arraylist list = new arraylist();\n\n# 3.2.2 arraylist å¯¹äºæ³åçæ¯æ\n\narraylist<e> ï¼ä¸ä¸ªæ³åç±»ï¼å¯ä»¥å¨ç¼è¯é¶æ®µçº¦æéåå¯¹è±¡åªè½æä½æç§ e æ°æ®ç±»åã\n\nä¾å¦ï¼\n\n * arraylist<string> ï¼æ­¤éååªè½æä½å­ç¬¦ä¸²ç±»åçåç´ ã\n\n * arraylist<integer>ï¼æ­¤éååªè½æä½æ´æ°ç±»åçåç´ ã\n\nâ ï¸ æ³¨æï¼\n\néåä¸­åªè½å­å¨å¼ç¨ç±»åï¼ä¸æ¯æåºæ¬æ°æ®ç±»åã\n\narraylist ä¸è¬é½ä¼ä½¿ç¨æ³åï¼åªæéè¦å¥ç±»åé½æ¯æï¼ä¹ä¼å  arraylist<object>ã\n\n\n# 3.3 arraylist éåå¸¸ç¨æ¹æ³\n\n * arraylist éåæ·»å åç´ çæ¹æ³ï¼\n\n\n\n * arraylist éåå¶ä»å¸¸ç¨æ¹æ³ï¼\n\n\n\n\n# 3.4 arraylist éåæéç¹ï¼éåå¹¶å é¤åç´ \n\néè¯¯åæ³ï¼\n\npublic class arraylisttest {\n    public static void main(string[] args) {\n        //åå»ºéåå¯¹è±¡\n        arraylist<integer> scores = new arraylist<>();\n\n        //æ·»å æç»©å°éåä¸­\n        scores.add(98);\n        scores.add(20);\n        scores.add(78);\n\n        //éåéåï¼éç¨éç¨éåæ ¼å¼å®ç°\n        for (int i = 0; i < scores.size(); i++) {\n            int score = scores.get(i);\n            if (score < 80){\n                // å»ææç»©ä½äº80åç\n                scores.remove(i);  \n            }\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nåºç°çé®é¢ï¼\n\néç¨ä»¥ä¸çå¸¸è§ fori å½¢å¼è¾¹éåè¾¹å é¤ï¼ä¼å¯¼è´æ¼å é¨ååç´ ãå ä¸º arraylist çé¿åº¦æ¯å¨æååçï¼å é¤ä¹åä¼åºç°è¡¥ä½çæåµã\n\nè§£å³ï¼\n\nâ  remove ä¹åï¼ i-- ãå³ line 16 ä¹åæ·»å  i--;\n\nâ¡ ä»éååé¢åçéåç¶åå é¤ï¼ä»£ç å¦ä¸ï¼\n\nfor (int i = scores.size() - 1; i >= 0 ; i--) {\n    int score = scores.get(i);\n    if (score < 80){\n        scores.remove(i);  \n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n',charsets:{cjk:!0},lastUpdated:"2023/02/01, 05:47:49",lastUpdatedTimestamp:1675230469e3},{title:"é¢åå¯¹è±¡è¿é¶1ï¼staticãåä¾ãä»£ç åãç»§æ¿ï¼",frontmatter:{title:"é¢åå¯¹è±¡è¿é¶1ï¼staticãåä¾ãä»£ç åãç»§æ¿ï¼",date:"2023-02-24T09:46:01.000Z",permalink:"/pages/46cfbb/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/30.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B61%EF%BC%88static%E3%80%81%E5%8D%95%E4%BE%8B%E3%80%81%E4%BB%A3%E7%A0%81%E5%9D%97%E3%80%81%E7%BB%A7%E6%89%BF%EF%BC%89.html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/30.é¢åå¯¹è±¡è¿é¶1ï¼staticãåä¾ãä»£ç åãç»§æ¿ï¼.md",key:"v-7e68add3",path:"/pages/46cfbb/",headers:[{level:2,title:"1. static å³é®å­",slug:"_1-static-å³é®å­",normalizedTitle:"1. static å³é®å­",charIndex:32},{level:3,title:"1.1 static æ¯ä»ä¹ãä¿®é¥°æååéåæåæ¹æ³çç¨æ³",slug:"_1-1-static-æ¯ä»ä¹ãä¿®é¥°æååéåæåæ¹æ³çç¨æ³",normalizedTitle:"1.1 static æ¯ä»ä¹ãä¿®é¥°æååéåæåæ¹æ³çç¨æ³",charIndex:50},{level:4,title:"1.1.1 static æ¯ä»ä¹",slug:"_1-1-1-static-æ¯ä»ä¹",normalizedTitle:"1.1.1 static æ¯ä»ä¹",charIndex:83},{level:4,title:"1.1.2 æååé",slug:"_1-1-2-æååé",normalizedTitle:"1.1.2 æååé",charIndex:183},{level:4,title:"1.1.3 æåæ¹æ³",slug:"_1-1-3-æåæ¹æ³",normalizedTitle:"1.1.3 æåæ¹æ³",charIndex:610},{level:3,title:"1.2 static ä¿®é¥°æååéçåå­åç",slug:"_1-2-static-ä¿®é¥°æååéçåå­åç",normalizedTitle:"1.2 static ä¿®é¥°æååéçåå­åç",charIndex:844},{level:3,title:"1.3 static ä¿®é¥°æåæ¹æ³çåå­åç",slug:"_1-3-static-ä¿®é¥°æåæ¹æ³çåå­åç",normalizedTitle:"1.3 static ä¿®é¥°æåæ¹æ³çåå­åç",charIndex:1073},{level:3,title:"1.4 static è®¿é®çæ³¨æäºé¡¹",slug:"_1-4-static-è®¿é®çæ³¨æäºé¡¹",normalizedTitle:"1.4 static è®¿é®çæ³¨æäºé¡¹",charIndex:1266},{level:2,title:"2. static åºç¨ç¥è¯",slug:"_2-static-åºç¨ç¥è¯",normalizedTitle:"2. static åºç¨ç¥è¯",charIndex:1561},{level:3,title:"2.1 å·¥å·ç±»",slug:"_2-1-å·¥å·ç±»",normalizedTitle:"2.1 å·¥å·ç±»",charIndex:1580},{level:4,title:"2.1.1 ä»ä¹æ¯å·¥å·ç±»",slug:"_2-1-1-ä»ä¹æ¯å·¥å·ç±»",normalizedTitle:"2.1.1 ä»ä¹æ¯å·¥å·ç±»",charIndex:1591},{level:4,title:"2.1.2 å·¥å·ç±»çå¥½å¤",slug:"_2-1-2-å·¥å·ç±»çå¥½å¤",normalizedTitle:"2.1.2 å·¥å·ç±»çå¥½å¤",charIndex:1687},{level:4,title:"2.1.3 ä¸ºä»ä¹å·¥å·ç±»ä¸­çæ¹æ³ä¸ç¨å®ä¾æ¹æ³åï¼",slug:"_2-1-3-ä¸ºä»ä¹å·¥å·ç±»ä¸­çæ¹æ³ä¸ç¨å®ä¾æ¹æ³å",normalizedTitle:"2.1.3 ä¸ºä»ä¹å·¥å·ç±»ä¸­çæ¹æ³ä¸ç¨å®ä¾æ¹æ³åï¼",charIndex:1734},{level:4,title:"2.1.4 å·¥å·ç±»å®ä¹æ¶çå¶ä»è¦æ±ï¼é¦ä¸æ·»è±ï¼",slug:"_2-1-4-å·¥å·ç±»å®ä¹æ¶çå¶ä»è¦æ±-é¦ä¸æ·»è±",normalizedTitle:"2.1.4 å·¥å·ç±»å®ä¹æ¶çå¶ä»è¦æ±ï¼é¦ä¸æ·»è±ï¼",charIndex:1800},{level:3,title:"2.2 ä»£ç å",slug:"_2-2-ä»£ç å",normalizedTitle:"2.2 ä»£ç å",charIndex:1899},{level:4,title:"2.2.1 ä»£ç åæ¦è¿°",slug:"_2-2-1-ä»£ç åæ¦è¿°",normalizedTitle:"2.2.1 ä»£ç åæ¦è¿°",charIndex:1910},{level:4,title:"2.2.2 ä»£ç ååç±»",slug:"_2-2-2-ä»£ç ååç±»",normalizedTitle:"2.2.2 ä»£ç ååç±»",charIndex:2007},{level:4,title:"2.2.3 æ¡ä¾ââæå°ä¸»æ¸¸æ",slug:"_2-2-3-æ¡ä¾-æå°ä¸»æ¸¸æ",normalizedTitle:"2.2.3 æ¡ä¾ââæå°ä¸»æ¸¸æ",charIndex:2877},{level:3,title:"2.3 è®¾è®¡æ¨¡å¼ï¼åä¾",slug:"_2-3-è®¾è®¡æ¨¡å¼-åä¾",normalizedTitle:"2.3 è®¾è®¡æ¨¡å¼ï¼åä¾",charIndex:3126},{level:4,title:"2.3.1 ä»ä¹æ¯è®¾è®¡æ¨¡å¼",slug:"_2-3-1-ä»ä¹æ¯è®¾è®¡æ¨¡å¼",normalizedTitle:"2.3.1 ä»ä¹æ¯è®¾è®¡æ¨¡å¼",charIndex:3141},{level:4,title:"2.3.2 åä¾æ¨¡å¼",slug:"_2-3-2-åä¾æ¨¡å¼",normalizedTitle:"2.3.2 åä¾æ¨¡å¼",charIndex:3331},{level:4,title:"2.3.3 é¥¿æ±åä¾æ¨¡å¼",slug:"_2-3-3-é¥¿æ±åä¾æ¨¡å¼",normalizedTitle:"2.3.3 é¥¿æ±åä¾æ¨¡å¼",charIndex:3456},{level:4,title:"2.3.4 ææ±åä¾æ¨¡å¼",slug:"_2-3-4-ææ±åä¾æ¨¡å¼",normalizedTitle:"2.3.4 ææ±åä¾æ¨¡å¼",charIndex:4112},{level:4,title:"2.3.5 é¥¿æ±åä¾æ¨¡å¼ VS ææ±åä¾æ¨¡å¼",slug:"_2-3-5-é¥¿æ±åä¾æ¨¡å¼-vs-ææ±åä¾æ¨¡å¼",normalizedTitle:"2.3.5 é¥¿æ±åä¾æ¨¡å¼ vs ææ±åä¾æ¨¡å¼",charIndex:5035},{level:2,title:"4. é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹äºï¼ç»§æ¿",slug:"_4-é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹äº-ç»§æ¿",normalizedTitle:"4. é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹äºï¼ç»§æ¿",charIndex:5124},{level:3,title:"4.1 ç»§æ¿æ¦è¿°",slug:"_4-1-ç»§æ¿æ¦è¿°",normalizedTitle:"4.1 ç»§æ¿æ¦è¿°",charIndex:5145},{level:3,title:"4.2 ç»§æ¿çè®¾è®¡è§è",slug:"_4-2-ç»§æ¿çè®¾è®¡è§è",normalizedTitle:"4.2 ç»§æ¿çè®¾è®¡è§è",charIndex:5334},{level:3,title:"4.3 ç»§æ¿çåå­è¿è¡åç",slug:"_4-3-ç»§æ¿çåå­è¿è¡åç",normalizedTitle:"4.3 ç»§æ¿çåå­è¿è¡åç",charIndex:5401},{level:3,title:"4.4 ç»§æ¿çç¹ç¹",slug:"_4-4-ç»§æ¿çç¹ç¹",normalizedTitle:"4.4 ç»§æ¿çç¹ç¹",charIndex:5484},{level:3,title:"4.5 ç»§æ¿ä¹åçç¹ç¹",slug:"_4-5-ç»§æ¿ä¹åçç¹ç¹",normalizedTitle:"4.5 ç»§æ¿ä¹åçç¹ç¹",charIndex:6061},{level:4,title:"4.5.1 æååéãæåæ¹æ³çè®¿é®ç¹ç¹",slug:"_4-5-1-æååéãæåæ¹æ³çè®¿é®ç¹ç¹",normalizedTitle:"4.5.1 æååéãæåæ¹æ³çè®¿é®ç¹ç¹",charIndex:6076},{level:4,title:"4.5.2 ç»§æ¿åï¼æ¹æ³éå",slug:"_4-5-2-ç»§æ¿å-æ¹æ³éå",normalizedTitle:"4.5.2 ç»§æ¿åï¼æ¹æ³éå",charIndex:6275},{level:4,title:"4.5.3 ç»§æ¿åï¼å­ç±»æé å¨çç¹ç¹",slug:"_4-5-3-ç»§æ¿å-å­ç±»æé å¨çç¹ç¹",normalizedTitle:"4.5.3 ç»§æ¿åï¼å­ç±»æé å¨çç¹ç¹",charIndex:6892},{level:4,title:"4.5.4 ç»§æ¿åï¼å­ç±»æé å¨è®¿é®ç¶ç±»æåæé å¨",slug:"_4-5-4-ç»§æ¿å-å­ç±»æé å¨è®¿é®ç¶ç±»æåæé å¨",normalizedTitle:"4.5.4 ç»§æ¿åï¼å­ç±»æé å¨è®¿é®ç¶ç±»æåæé å¨",charIndex:7113},{level:3,title:"4.6 thisãsuper ä½¿ç¨æ»ç»",slug:"_4-6-thisãsuper-ä½¿ç¨æ»ç»",normalizedTitle:"4.6 thisãsuper ä½¿ç¨æ»ç»",charIndex:7392}],headersStr:"1. static å³é®å­ 1.1 static æ¯ä»ä¹ãä¿®é¥°æååéåæåæ¹æ³çç¨æ³ 1.1.1 static æ¯ä»ä¹ 1.1.2 æååé 1.1.3 æåæ¹æ³ 1.2 static ä¿®é¥°æååéçåå­åç 1.3 static ä¿®é¥°æåæ¹æ³çåå­åç 1.4 static è®¿é®çæ³¨æäºé¡¹ 2. static åºç¨ç¥è¯ 2.1 å·¥å·ç±» 2.1.1 ä»ä¹æ¯å·¥å·ç±» 2.1.2 å·¥å·ç±»çå¥½å¤ 2.1.3 ä¸ºä»ä¹å·¥å·ç±»ä¸­çæ¹æ³ä¸ç¨å®ä¾æ¹æ³åï¼ 2.1.4 å·¥å·ç±»å®ä¹æ¶çå¶ä»è¦æ±ï¼é¦ä¸æ·»è±ï¼ 2.2 ä»£ç å 2.2.1 ä»£ç åæ¦è¿° 2.2.2 ä»£ç ååç±» 2.2.3 æ¡ä¾ââæå°ä¸»æ¸¸æ 2.3 è®¾è®¡æ¨¡å¼ï¼åä¾ 2.3.1 ä»ä¹æ¯è®¾è®¡æ¨¡å¼ 2.3.2 åä¾æ¨¡å¼ 2.3.3 é¥¿æ±åä¾æ¨¡å¼ 2.3.4 ææ±åä¾æ¨¡å¼ 2.3.5 é¥¿æ±åä¾æ¨¡å¼ VS ææ±åä¾æ¨¡å¼ 4. é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹äºï¼ç»§æ¿ 4.1 ç»§æ¿æ¦è¿° 4.2 ç»§æ¿çè®¾è®¡è§è 4.3 ç»§æ¿çåå­è¿è¡åç 4.4 ç»§æ¿çç¹ç¹ 4.5 ç»§æ¿ä¹åçç¹ç¹ 4.5.1 æååéãæåæ¹æ³çè®¿é®ç¹ç¹ 4.5.2 ç»§æ¿åï¼æ¹æ³éå 4.5.3 ç»§æ¿åï¼å­ç±»æé å¨çç¹ç¹ 4.5.4 ç»§æ¿åï¼å­ç±»æé å¨è®¿é®ç¶ç±»æåæé å¨ 4.6 thisãsuper ä½¿ç¨æ»ç»",content:'# é¢åå¯¹è±¡è¿é¶1ï¼staticãåä¾ãä»£ç åãç»§æ¿ï¼\n\n\n# 1. static å³é®å­\n\n\n# 1.1 static æ¯ä»ä¹ãä¿®é¥°æååéåæåæ¹æ³çç¨æ³\n\n# 1.1.1 static æ¯ä»ä¹\n\n * static æ¯éæçææï¼å¯ç¨æ¥ä¿®é¥°æååéåæåæ¹æ³\n\n * static ä¿®é¥°æååéè¡¨ç¤ºè¯¥æååéåªå¨åå­ä¸­åªå­å¨ä¸ä»½ï¼å¯ä»¥è¢«å±äº«è®¿é®ãä¿®æ¹ã\n\n# 1.1.2 æååé\n\næååéå¯ä»¥åä¸º2ç±»ï¼\n\n * éææååé\n   \n   * æ static ä¿®é¥°ï¼å±äºç±»ï¼åå­ä¸­å è½½ä¸æ¬¡\n   \n   * å¸¸è¡¨ç¤ºå¦å¨çº¿äººæ°ä¿¡æ¯ãç­éè¦è¢«å±äº«çä¿¡æ¯ï¼å¯ä»¥è¢«å±äº«è®¿é®\n   \n   * ç¤ºä¾ä»£ç \n     \n     public class User {\n         // éææååé\n         public static String onlineNumber= 161;\n     }\n     \n     \n     1\n     2\n     3\n     4\n     \n   \n   * è®¿é®æ ¼å¼ï¼æ¨èä½¿ç¨ ç±»å.éææååéï¼ä¸æ¨è å¯¹è±¡.éææååé\n\n * å®ä¾æååé\n   \n   * æ staticä¿®é¥°ï¼å­å¨äºæ¯ä¸ªå¯¹è±¡ä¸­\n   * å¸¸è¡¨ç¤ºå§ånameãå¹´é¾ageãç­å±äºæ¯ä¸ªå¯¹è±¡çä¿¡æ¯ãå±äºæ¯ä¸ªå¯¹è±¡ï¼ä¸æ¯ä¸ªå¯¹è±¡çä¿¡æ¯ä¸å\n   * è®¿é®æ ¼å¼ï¼å¯¹è±¡.å®ä¾æååé\n\n# 1.1.3 æåæ¹æ³\n\næåæ¹æ³å¯ä»¥åä¸º2ç±»ï¼\n\n * éææåæ¹æ³\n   * æ static ä¿®é¥°ï¼å±äºç±»\n   * ä½¿ç¨åºæ¯ï¼å¦æè¯¥æ¹æ³æ¯ä»¥æ§è¡ä¸ä¸ªå±ç¨åè½ä¸ºç®çï¼åå¯ä»¥ç³ææéææ¹æ³\n   * è®¿é®ï¼å»ºè®®ç¨ç±»åè®¿é®ï¼ä¹å¯ä»¥ç¨å¯¹è±¡è®¿é®ãç±»å.éææåæ¹æ³\n * å®ä¾æåæ¹æ³\n   * æ  static ä¿®é¥°ï¼å±äºå¯¹è±¡\n   * ä½¿ç¨åºæ¯ï¼è¡¨ç¤ºå¯¹è±¡èªå·±çè¡ä¸ºçï¼ä¸æ¹æ³ä¸­éè¦è®¿é®å®ä¾æåçï¼åè¯¥æ¹æ³å¿é¡»ç³ææå®ä¾æ¹æ³\n   * è®¿é®ï¼åªè½ç¨å¯¹è±¡è§¦åè®¿é®\n\n\n# 1.2 static ä¿®é¥°æååéçåå­åç\n\nå¨å è½½ä¸ä¸ªç±»æ¶ï¼ä¼åå°æ­¤ç±»å è½½å°æ¹æ³åºï¼åæ¶ä¼å¨å åå­ä¸­å¼è¾ä¸åæ­¤ç±»çéæåéåº\n\n-> ç¶åå° main æ¹æ³å è½½è¿æ åå­è¿è¡\n\næ³¨ï¼æ­¤æ¶åå­ä¸­è¿æ²¡æ nameãage å®ä¾æååéï¼å ä¸ºä»ä»¬æ¯å±äºå¯¹è±¡ç\n\n\n\n-> å¨åå»ºå¯¹è±¡æ¶ï¼æå¨å åå­ä¸­å¼è¾ä¸ä¸ªæ°çç©ºé´åºæ¥ã\n\n\n\n-> ææ°çå¯¹è±¡åå»ºæ¶ï¼å¨å åå­ä¸­å¼è¾å¦ä¸ä¸ªç©ºé´è¡¨ç¤ºæ­¤å¯¹è±¡ã\n\n\n\næç¤º\n\nåä¸ä¸ªç±»ä¸­è®¿é®éææååéæ¶ï¼ç±»åå¯ä»¥çç¥ä¸åã\n\n\n# 1.3 static ä¿®é¥°æåæ¹æ³çåå­åç\n\nå¨åå§å è½½ç±»æ¶ï¼ä¾¿ä¼å°è¯¥ç±»çéææ¹æ³åæ¶å è½½å°åå­çæ¹æ³åºä¸­ï¼ä½å®ä¾æåæ¹æ³æ­¤æ¶è¿ä¸ä¼å è½½è¿æ¥ã æ§è¡å¾ä¸­ç getMax æ¹æ³æ¶ï¼å°è¯¥æ¹æ³æå°æ åå­ä¸­è¿è¡ï¼è¾åºç»æä¹åè¿è¡ä¸ä¸æ­¥ã\n\n\n\n-> åå»ºä¸ä¸ªå¯¹è±¡ä¹åï¼å¨å åå­ä¸­å¼è¾ç©ºé´ï¼å¹¶å°å®ä¾æåæ¹æ³ study å è½½å¥æ¹æ³åºï¼å¨å¯¹è±¡ä¸­æåå¯¹ç¸åºéææ¹æ³åè¯¥å®ä¾æ¹æ³çå¼ç¨ã\n\n\n\n\n# 1.4 static è®¿é®çæ³¨æäºé¡¹\n\n * éææ¹æ³åªè½è®¿é®éæçæåï¼ä¸å¯ä»¥ç´æ¥è®¿é®å®ä¾æåã\n   \n   * åªæ¯ä¸è½ç´æ¥å¨ä¸ä¸ªéææ¹æ³ä¸­è®¿é®å®ä¾æååéï¼ä½å¯ä»¥åå¨æ­¤æ¹æ³ä¸­ååå»ºä¸ä¸ªå®ä¾æååéï¼ç¶åè®¿é®å¶åéã\n   * åæ¶ä¹ä¸è½ç´æ¥è®¿é®å®ä¾æåæ¹æ³ã\n\n * å®ä¾æ¹æ³å¯ä»¥è®¿é®éæçæåï¼ä¹å¯ä»¥è®¿é®å®ä¾æåã\n\n * éææ¹æ³ä¸­æ¯ä¸å¯ä»¥åºç° this å³é®å­çã\n   \n   * å ä¸º this ä»£è¡¨å½åå¯¹è±¡ï¼ä½æ¯éææ¹æ³å¯ä»¥ä¸éè¿å¯¹è±¡æ¥è°ç¨ã\n\n> å®ä¾æ¹æ³/åé â å¯¹è±¡ï¼éææ¹æ³/åé â ç±»ã éææååéä¸è¬è®¾ä¸º public ï¼å ä¸ºå®å¨å±åªæä¸ä»½ã\n\n\n# 2. static åºç¨ç¥è¯\n\n\n# 2.1 å·¥å·ç±»\n\n# 2.1.1 ä»ä¹æ¯å·¥å·ç±»\n\nå·¥å·ç±»ä¸­å®ä¹çé½æ¯ä¸äºéææ¹æ³ï¼æ¯ä¸ªæ¹æ³é½æ¯ä»¥å®æä¸ä¸ªå±ç¨çåè½ä¸ºç®çã\n\næ¯å¦ï¼ä¸ä¸ªç³»ç»çå¾å¤é¨åé½éè¦çæéªè¯ç ï¼æ­¤æ¶å¯ä»¥å¼åä¸ä¸ªçæéªè¯ç çéææ¹æ³ã\n\n# 2.1.2 å·¥å·ç±»çå¥½å¤\n\n * è°ç¨æ¹ä¾¿\n * æé«äºä»£ç å¤ç¨ï¼ä¸æ¬¡ç¼åï¼å¤å¤å¯ç¨ï¼\n\n# 2.1.3 ä¸ºä»ä¹å·¥å·ç±»ä¸­çæ¹æ³ä¸ç¨å®ä¾æ¹æ³åï¼\n\nå®ä¾æ¹æ³éè¦åå»ºå¯¹è±¡è°ç¨ï¼æ­¤æ¶ç¨å¯¹è±¡åªæ¯ä¸ºäºè°ç¨æ¹æ³ï¼è¿æ ·åªä¼æµªè´¹åå­ã\n\n# 2.1.4 å·¥å·ç±»å®ä¹æ¶çå¶ä»è¦æ±ï¼é¦ä¸æ·»è±ï¼\n\n * å·¥å·ç±»ä¸­é½æ¯éææ¹æ³ï¼ç´æ¥ç¨ç±»åè®¿é®å³å¯ã\n * å·¥å·ç±»æ éåå»ºå¯¹è±¡ï¼å»ºè®®å°å·¥å·ç±»çæé å¨è¿è¡ç§æåãï¼ç¨ private éå²æï¼\n\n\n# 2.2 ä»£ç å\n\n# 2.2.1 ä»£ç åæ¦è¿°\n\n * ä»£ç åæ¯ç±»ç5å¤§æåä¹ä¸ï¼æååéãæé å¨ï¼æ¹æ³ï¼ä»£ç åï¼åé¨ç±»ï¼ï¼å®ä¹å¨ç±»ä¸­æ¹æ³å¤ã\n\n * å¨Javaç±»ä¸ï¼ä½¿ç¨ { } æ¬èµ·æ¥çä»£ç è¢«ç§°ä¸ºä»£ç å ã\n\n# 2.2.2 ä»£ç ååç±»\n\n * éæä»£ç å\n   \n   * æ ¼å¼ï¼static{}\n   \n   * ç¹ç¹ï¼éè¦éè¿ static å³é®å­ä¿®é¥°ï¼éçç±»çå è½½èå è½½ï¼å¹¶ä¸èªå¨è§¦åãåªæ§è¡ä¸æ¬¡\n   \n   * ä½ç¨ï¼è¥è¦å¨å¯å¨ç³»ç»æ¶å¯¹æ°æ®è¿è¡åå§åï¼å»ºè®®ä½¿ç¨éæä»£ç åå®ææ°æ®çåå§åæä½ï¼ä»£ç ä¼é\n   \n   * ä½¿ç¨åºæ¯ï¼å¨ç±»å è½½çæ¶ååä¸äºéææ°æ®åå§åçæä½ï¼ä»¥ä¾¿åç»­ä½¿ç¨ãæ¯å¦ï¼æ°æ®åºçè¿æ¥å¯ä»¥å¨ static { } ä¸­æ§è¡ï¼è¿è¡éæèµæºçåå§åã\n   \n   * ä»£ç ç¤ºä¾ï¼\n     \n     public class StaticDemo {\n         \n         public static void main(String[] args) {\n             System.out.println("----mainæ¹æ³æ§è¡----");\n         }\n         \n         /**\n          éæä»£ç åï¼æstaticä¿®é¥°ï¼å±äºç±»ï¼ä¸ç±»ä¸èµ·ä¼åå è½½ä¸æ¬¡ï¼èªå¨è§¦åæ§è¡\n         */\n         static {\n             System.out.println("----éæä»£ç åè¢«è§¦åæ§è¡äº----");\n         }\n     }\n     \n     // ä»¥ä¸ä»£ç ä¸­åè§¦åéæä»£ç åï¼ç¶åæ§è¡mainæ¹æ³\n     \n     \n     1\n     2\n     3\n     4\n     5\n     6\n     7\n     8\n     9\n     10\n     11\n     12\n     13\n     14\n     15\n     \n\n * æé ä»£ç åï¼äºè§£ï¼ç¨çå°ï¼\n   \n   * ä¹å¯ä»¥å«å®ä¾ä»£ç å\n   * æ ¼å¼ï¼{}\n   * ç¹ç¹ï¼æ¯æ¬¡åå»ºå¯¹è±¡ï¼è°ç¨æé å¨æ§è¡æ¶ï¼é½ä¼æ§è¡è¯¥ä»£ç åä¸­çä»£ç ï¼å¹¶ä¸å¨æé å¨æ§è¡åæ§è¡\n   * ä½¿ç¨åºæ¯ï¼åå§åå®ä¾èµæºã\n\n# 2.2.3 æ¡ä¾ââæå°ä¸»æ¸¸æ\n\néæ±ï¼\n\nå¨å¯å¨æ¸¸ææ¿é´çæ¶åï¼åºè¯¥æååå¤å¥½54å¼ çï¼åç»­æå¯ä»¥ç´æ¥ä½¿ç¨è¿äºçæ°æ®ã\n\nåæï¼\n\nâ è¯¥æ¿é´åªéè¦ä¸å¯çã\n\nâ¡å®ä¹ä¸ä¸ªéæç ArrayList éåå­å¨ 54 å¼ çå¯¹è±¡ï¼éæçéååªä¼å è½½ä¸ä»½ã\n\nâ¢å¨å¯å¨æ¸¸ææ¿é´åï¼åºè¯¥å° 54 å¼ çåå§åå¥½\n\nâ£å½ç³»ç»å¯å¨çåæ¶éè¦åå¤å¥½ 54 å¼ çæ°æ®ï¼æ­¤æ¶å¯ä»¥ç¨éæä»£ç åå®æã\n\næ»ç»ï¼\n\néè¦æååå¤æ°æ®ï¼å¹¶ä¸æ¯åªéè¦ä¸ä»½è¿ä¸ªæ°æ®ï¼å æ­¤ä½¿ç¨ static ä¿®é¥°çæ¶åï¼éè¦ç¨å°éæä»£ç åã\n\n\n# 2.3 è®¾è®¡æ¨¡å¼ï¼åä¾\n\n# 2.3.1 ä»ä¹æ¯è®¾è®¡æ¨¡å¼\n\n * å¼åä¸­ç»å¸¸éå°ä¸äºé®é¢ï¼ä¸ä¸ªé®é¢éå¸¸ænç§è§£æ³çï¼ä½å¶ä¸­æä¸ç§è§£æ³æ¯æä¼çï¼è¿ä¸ªæä¼çè§£æ³è¢«æ»ç»åºæ¥ï¼ç§°ä¹ä¸ºè®¾è®¡æ¨¡å¼ã\n\n * è®¾è®¡æ¨¡å¼æ20å¤ç§ï¼å¯¹åº20å¤ç§è½¯ä»¶å¼åä¸­ä¼éå°çé®é¢ï¼å­¦è®¾è®¡æ¨¡å¼ä¸»è¦æ¯å­¦2ç¹ï¼\n   \n   * ç¬¬ä¸ï¼è¿ç§æ¨¡å¼ç¨æ¥è§£å³ä»ä¹é®é¢ã\n   * ç¬¬äºï¼éå°è¿ç§é®é¢äºï¼è¯¥æ¨¡å¼æ¯æä¹åçï¼ä»æ¯å¦ä½è§£å³è¿ä¸ªé®é¢çã\n\n# 2.3.2 åä¾æ¨¡å¼\n\nå¯ä»¥ä¿è¯ç³»ç»ä¸­ï¼åºç¨è¯¥æ¨¡å¼çè¿ä¸ªç±»æ°¸è¿åªæä¸ä¸ªå®ä¾ï¼å³ä¿è¯ä¸ä¸ªç±»æ°¸è¿åªè½åå»ºä¸ä¸ªå¯¹è±¡ãä¾å¦ä»»å¡ç®¡çå¨å¯¹è±¡æä»¬åªéè¦ä¸ä¸ªå°±å¯ä»¥è§£å³é®é¢äºï¼è¿æ ·å¯ä»¥èçåå­ç©ºé´ã\n\nåä¾çå®ç°æ¹å¼æå¾å¤ï¼å¦é¥¿æ±åä¾æ¨¡å¼ãææ±åä¾æ¨¡å¼ï¼â¦â¦\n\n# 2.3.3 é¥¿æ±åä¾æ¨¡å¼\n\n * å¨ç¨ç±»è·åå¯¹è±¡çæ¶åï¼å¯¹è±¡å·²ç»æåä¸ºä½ åå»ºå¥½äºã\n\n * è®¾è®¡æ­¥éª¤ï¼\n   \n   * å®ä¹ä¸ä¸ªç±»ï¼ææé å¨ç§æ\n   \n   * å®ä¹ä¸ä¸ªéæåéå­å¨ä¸ä¸ªå¯¹è±¡\n\n * ä»£ç ç¤ºä¾ï¼\n   \n   /** aãå®ä¹ä¸ä¸ªåä¾ç±» */\n   public class SingleInstance {\n       /** c.å®ä¹ä¸ä¸ªéæåéå­å¨ä¸ä¸ªå¯¹è±¡å³å¯ï¼å±äºç±»ï¼ä¸ç±»ä¸èµ·å è½½ä¸æ¬¡ */\n       public static SingleInstance instance = new SingleInstance();\n       \n       /** b.åä¾å¿é¡»ç§ææé å¨*/\n       private SingleInstance(){\n           System.out.println("åå»ºäºä¸ä¸ªå¯¹è±¡");\n       }\n   }\n   \n   \n   /** \n     å«çç±»ä¸­çä½¿ç¨ï¼ç´æ¥è·åè¯¥åä¾çå¯¹è±¡\n   */\n   SingleInstance s1 = SingleInstance.instance;\n   \n   // å½æå¤æ¡è¯­å¥åå»ºs1ãs2ãs3...æ¶ï¼ä»ä»¬é½æ¯ç¸ç­çï¼æ¯åä¸ä¸ªå¯¹è±¡\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   18\n   \n\n# 2.3.4 ææ±åä¾æ¨¡å¼\n\n * å¨çæ­£éè¦è¯¥å¯¹è±¡çæ¶åï¼æå»åå»ºä¸ä¸ªå¯¹è±¡(å»¶è¿å è½½å¯¹è±¡)ã\n\n * è®¾è®¡æ­¥éª¤ï¼\n   \n   * å®ä¹ä¸ä¸ªç±»ï¼ææé å¨ç§æ\n   * å®ä¹ä¸ä¸ªéæåéå­å¨ä¸ä¸ªå¯¹è±¡\n   * æä¾ä¸ä¸ªè¿ååä¾å¯¹è±¡çæ¹æ³\n\n * ä»£ç ç¤ºä¾ï¼\n   \n   /** å®ä¹ä¸ä¸ªåä¾ç±» */\n   class SingleInstance{\n       /** å®ä¹ä¸ä¸ªéæåéå­å¨ä¸ä¸ªå¯¹è±¡å³å¯:å±äºç±»ï¼ä¸ç±»ä¸èµ·å è½½ä¸æ¬¡ */\n       private static SingleInstance instance ; // é»è®¤å¼ï¼null\n       \n       /** åä¾å¿é¡»ç§ææé å¨*/\n       private SingleInstance(){\n           \n       }\n       \n       /** å¿é¡»æä¾ä¸ä¸ªæ¹æ³è¿åä¸ä¸ªåä¾å¯¹è±¡  */\n       public static SingleInstance getInstance(){\n           if(instance == null){\n           \t// ç¬¬ä¸æ¬¡æ¥æ¿å¯¹è±¡ï¼æ­¤æ¶éè¦åå»ºå¯¹è±¡    \n   \t        instance = new SingleInstance();\n           }\n           return instance;\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   18\n   19\n   \n   \n   â ï¸ ä¸è¿°ä»£ç ä¸­ï¼line 4 ä¸­ç¨ private ä¿®é¥°å¯¹è±¡ï¼æ­¤æ¶æ æ³ä»è¯¥ç±»å¤é¨ä½¿ç¨ SingleInstance s1 = SingleInstance.instance è·åå¯¹è±¡äºï¼åªè½ä½¿ç¨SingleInstance s1 = SingleInstance.getInstance() è·åãå¦åå¯è½ä¼æ¿å° null å¼ï¼ä¸ç¬¦åéæ±ã\n\n# 2.3.5 é¥¿æ±åä¾æ¨¡å¼ VS ææ±åä¾æ¨¡å¼\n\nææ±åä¾æ¨¡å¼èçåå­ï¼å¨ä¸éè¦åå»ºå¯¹è±¡æ¶ï¼ä¸ä¼å¨æ åå­ä¸­åå»ºåå­ã\n\né¥¿æ±åä¾æ¨¡å¼æ´å¿«äºï¼å½éè¦å¯¹è±¡æ¶ï¼å·²ç»å¨åå­ä¸­äºã\n\n\n# 4. é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹äºï¼ç»§æ¿\n\n\n# 4.1 ç»§æ¿æ¦è¿°\n\n * å³é®å­ï¼extendsï¼å»ºç«ä¸¤ä¸ªç±»ä¹é´çç¶å­å³ç³»\n\n * åºæ¬ä½¿ç¨ï¼public class Student extends People {} ã Student ç§°ä¸ºå­ç±»ï¼æ´¾çç±»ï¼ï¼People ç§°ä¸ºç¶ç±»(åºç±» æè¶ç±»)ã\n\n * å¥½å¤ï¼å­ç±»ç»§æ¿ç¶ç±»åï¼å¯ä»¥ç´æ¥ä½¿ç¨ç¶ç±»å¬å±çå±æ§åæ¹æ³äºãå æ­¤ï¼ç¨å¥½è¿ä¸ªææ¯å¯ä»¥å¾å¥½çæä»¬æé«ä»£ç çå¤ç¨æ§\n\n\n# 4.2 ç»§æ¿çè®¾è®¡è§è\n\nå­ç±»ä»¬ç¸åç¹å¾ï¼å±æ§å±æ§ï¼å±æ§æ¹æ³ï¼æ¾å¨ç¶ç±»ä¸­å®ä¹ï¼å­ç±»ç¬æççå±æ§åè¡ä¸ºåºè¯¥å®ä¹å¨å­ç±»èªå·±éé¢ã\n\n\n# 4.3 ç»§æ¿çåå­è¿è¡åç\n\nåå»ºä¸ä¸ªå­ç±»å¯¹è±¡æ¶ï¼å®éä¼å¨å åå­ä¸­åä¸ºç¶ç±»ç©ºé´åå­ç±»ç©ºé´ä¸¤é¨åï¼å¯¹å¤æ¯ä¸ä¸ªå¯¹è±¡ï¼å¯¹åä¼åä¸ºä¸¤é¨åï¼æ´ä¸ªä»£è¡¨ä¸ä¸ªå­ç±»å¯¹è±¡ã\n\n\n\n\n# 4.4 ç»§æ¿çç¹ç¹\n\n * å­ç±»å¯ä»¥ç»§æ¿ç¶ç±»çå±æ§åè¡ä¸ºï¼ä½æ¯å­ç±»ä¸è½ç»§æ¿ç¶ç±»çæé å¨ã\n   \n   * å­ç±»æèªå·±çæé å¨ï¼ç¶ç±»æé å¨ç¨äºåå§åç¶ç±»å¯¹è±¡ã\n\n * Javaæ¯åç»§æ¿æ¨¡å¼ï¼ä¸ä¸ªç±»åªè½ç»§æ¿ä¸ä¸ªç´æ¥ç¶ç±»ã\n   \n   * ä¸ºå¥ï¼åè¯ï¼å½å¤ä¸ªç¸ç¸ä¸­è®©ä½ å¤ä¹ ä¸ä¸æ ·çåå®¹ï¼é£ä½ å°±ä¸ç¥éè¯¥å¤ä¹ åªé¨å¦ï¼åºç°äºäºä¹æ§\n\n * Javaä¸æ¯æå¤ç»§æ¿ãä½æ¯æ¯æå¤å±ç»§æ¿ã\n   \n   * å¤å±ç»§æ¿ï¼å¿å­ -> ç¸ç¸ -> ç·ç·\n   * åºäºå°±è¿ååä½¿ç¨ç¶ç±»ä¸­çæååéåæåæ¹æ³\n\n * Javaä¸­ææçç±»é½æ¯ Object ç±»çå­ç±»ã\n   \n   * è¦ä¹ç´æ¥ç»§æ¿äºObject , è¦ä¹é»è®¤ç»§æ¿äºObject , è¦ä¹é´æ¥ç»§æ¿äºObject\n   * Objectæ¯ç¥å®ç±»ã\n\nä¸äºå°æ³¨æç¹\n\n 1. å­ç±»æ¯å¦å¯ä»¥ç»§æ¿ç¶ç±»çç§ææåï¼\n    \n    å­ç±»å¯ä»¥ç»§æ¿ç¶ç±»çç§ææåï¼ä½ä¸è½ç´æ¥è®¿é®ãå¦ï¼å¤§å¤´å¿å­ç»§æ¿äºå°å¤´ç¸ç¸çä¿é©æï¼ä½ä»æ²¡æå¯ç ï¼æä¸å¼ã\n\n 2. å­ç±»æ¯å¦å¯ä»¥ç»§æ¿ç¶ç±»çéææåï¼\n    \n    æäºè®®çç¥è¯ç¹ã\n    \n    å­ç±»å¯ä»¥ç´æ¥ä½¿ç¨ç¶ç±»çéææåï¼å±äº«ï¼ã\n    \n    ä½é»é©¬è®¤ä¸ºï¼å­ç±»ä¸è½ç»§æ¿ç¶ç±»çéææåãï¼å±äº«å¹¶éç»§æ¿ï¼ãå¦ï¼ç¸ç¸çè½¦ç»å¿å­å¼ï¼è¿åªæ¯å±äº«ï¼ä¸æ¯ç»§æ¿ï¼è½¦æ²¡æç»å¿å­ã\n\n\n# 4.5 ç»§æ¿ä¹åçç¹ç¹\n\n# 4.5.1 æååéãæåæ¹æ³çè®¿é®ç¹ç¹\n\n * å¨å­ç±»æ¹æ³ä¸­è®¿é®æåï¼æååéãæåæ¹æ³ï¼æ»¡è¶³ï¼å°±è¿åå\n   * å­ç±»å±é¨èå´æ¾ â å­ç±»æåèå´æ¾ â ç¶ç±»æåèå´æ¾ï¼å¦æç¶ç±»èå´è¿æ²¡ææ¾å°åæ¥éã\n * å¨å­ç±»ä¸­ä½¿ç¨ç¶ç±»çéåæåæä¹åï¼\n   * å­ç±»ç¶ç±»åºç°éåæåï¼ä¼åä½¿ç¨å­ç±»ç\n   * å¯éè¿ super å³é®å­ï¼æå®è®¿é®ç¶ç±»çæåï¼æ ¼å¼ï¼super.ç¶ç±»æååé/æ¹æ³\n\n# 4.5.2 ç»§æ¿åï¼æ¹æ³éå\n\næ¹æ³éåçåºæ¬ç¥è¯ï¼\n\n * ä»ä¹æ¯æ¹æ³éåï¼\n   * å¨ç»§æ¿ä½ç³»ä¸­ï¼å­ç±»åºç°äºåç¶ç±»ä¸­ä¸æ¨¡ä¸æ ·çæ¹æ³å£°æï¼ç§°å­ç±»çè¿ä¸ªæ¹æ³æ¯éåçæ¹æ³ã\n * æ¹æ³éåçåºç¨åºæ¯\n   * å­ç±»éè¦ç¶ç±»çåè½ï¼ä½ç¶ç±»çè¯¥åè½ä¸å®å¨æ»¡è¶³èªå·±çéæ±æ¶\n * æ¡ä¾ï¼\n   * æ§ææºçåè½åªè½æ¯åºæ¬çæçµè¯ï¼åä¿¡æ¯\n   * æ°ææºçåè½éè¦è½å¤ï¼åºæ¬çæçµè¯ä¸æ¯æè§é¢éè¯ãåºæ¬çåä¿¡æ¯ä¸æ¯æåéè¯­é³åå¾ç\n\n@override æ³¨è§£ï¼\n\n * @Override æ¯æ¾å¨éååçæ¹æ³ä¸ï¼ä½ä¸ºéåæ¯å¦æ­£ç¡®çæ ¡éªæ³¨è§£ã\n * å ä¸è¯¥æ³¨è§£åå¦æéåéè¯¯ï¼ç¼è¯é¶æ®µä¼åºç°éè¯¯æç¤ºã\n * å»ºè®®éåæ¹æ³é½å  @Override æ³¨è§£ï¼ä»£ç å®å¨ï¼ä¼éï¼\n\næ¹æ³éåæ³¨æäºé¡¹åè¦æ±ï¼\n\n * éåæ¹æ³çåç§°ãå½¢ååè¡¨å¿é¡»ä¸è¢«éåæ¹æ³çåç§°ååæ°åè¡¨ä¸è´ï¼ç³æå¿é¡»ä¸æ ·ï¼è®¿é®æéä¹ä¸è¬é½æ¯ä¸æ ·çï¼ã\n   * ç³æä¸åï¼éæ°å®ç°\n * ç§ææ¹æ³ä¸è½è¢«éåã\n * å­ç±»éåç¶ç±»æ¹æ³æ¶ï¼è®¿é®æéå¿é¡»å¤§äºæèç­äºç¶ç±» ï¼private < ç¼ºç < protected < publicï¼\n * å­ç±»ä¸è½éåç¶ç±»çéææ¹æ³ï¼å¦æéåä¼æ¥éçã\n   * åå ï¼å­ç±»æ¬èº«å°±æ²¡æç»§æ¿å°ç¶ç±»çéææ¹æ³ï¼åªæ¯å±äº«ï¼å æ­¤æ æ³è¦çå®ãè°ç¨ä¸­ä¹æ¯ç¶ç±»çéææ¹æ³ç¨ âç¶ç±»å.ç¶ç±»éææ¹æ³åâ è°ç¨ï¼å­ç±»çç¨å­ç±»å¯¹åºçæ¹æ³è°ç¨ï¼ä¸ä¼äºç¸å½±åã\n\n# 4.5.3 ç»§æ¿åï¼å­ç±»æé å¨çç¹ç¹\n\nå­ç±»ç»§æ¿ç¶ç±»åæé å¨çç¹ç¹ï¼\n\n * å­ç±»ä¸­ææçæé å¨é»è®¤é½ä¼åè®¿é®ç¶ç±»ç**æ åæé å¨**ï¼åæ§è¡èªå·±ã\n\nåå ï¼\n\n * å­ç±»å¨åå§åçæ¶åï¼æå¯è½ä¼ä½¿ç¨å°ç¶ç±»ä¸­çæ°æ®ï¼å¦æç¶ç±»æ²¡æå®æåå§åï¼å­ç±»å°æ æ³ä½¿ç¨ç¶ç±»çæ°æ®ã\n * å­ç±»åå§åä¹åï¼ä¸å®è¦è°ç¨ç¶ç±»æé å¨åå®æç¶ç±»æ°æ®ç©ºé´çåå§åã\n\næä¹è°ç¨ç¶ç±»æé å¨çï¼\n\n * å­ç±»æé å¨çç¬¬ä¸è¡è¯­å¥é»è®¤é½æ¯ï¼super()ï¼ä¸åä¹å­å¨ã\n\n# 4.5.4 ç»§æ¿åï¼å­ç±»æé å¨è®¿é®ç¶ç±»æåæé å¨\n\nsuperè°ç¨ç¶ç±»æåæ°æé å¨çä½ç¨ï¼\n\n * åå§åç»§æ¿èªç¶ç±»çæ°æ®ã\n * å³ï¼Teacher ç±»ç»§æ¿äº People ç±»ï¼å¨ Teacher ä¸­åå§å People å®ä¹å¥½ç nameï¼age\n\nå¦æç¶ç±»ä¸­æ²¡ææ åæ°æé å¨ï¼åªææåæé å¨ï¼ä¼åºç°ä»ä¹ç°è±¡å¢ï¼\n\n * ä¼æ¥éãå ä¸ºå­ç±»é»è®¤æ¯è°ç¨ç¶ç±»æ åæé å¨çã\n\n * ä½å­ç±»ä¸­å¦æåªè°ç¨äºç¶ç±»çæåæé å¨ï¼æ¯ä¸ä¼æ¥éçã\n\n * è§£å³ï¼å­ç±»æé å¨ä¸­éè¿ super(â¦)ï¼æå¨è°ç¨ç¶ç±»çæåæ°æé å¨\n\n * å»ºè®®ï¼å°æ åæé å¨å¨é½ååºæ¥\n\n\n# 4.6 thisãsuper ä½¿ç¨æ»ç»\n\n * thisï¼ä»£è¡¨æ¬ç±»å¯¹è±¡çå¼ç¨ï¼\n\n * superï¼ä»£è¡¨ç¶ç±»å­å¨ç©ºé´çæ è¯ã\n\n * ç¤ºä¾ä»£ç \n   \n   /**\n   \tåå°åå»ºå¯¹è±¡å°è£æ°æ®çæ¶åå¦æç¨æ·æ²¡æè¾å¥å­¦æ ¡ï¼åé»è®¤ä½¿ç¨âé»é©¬å¹è®­ä¸­å¿â;å¦æç¨æ·è¾å¥äºå­¦æ ¡åä½¿ç¨ç¨æ·è¾å¥çå­¦æ ¡ä¿¡æ¯\n   */\n   public class Student {        \n       private String schoolName;\n       private String name;\n      \n       public Student(String name){\n             this(name , âé»é©¬å¹è®­ä¸­å¿â);\t// è°ç¨ä¸¤ä¸ªåæ°çæé å¨\n       }\t\n        \n       public Student(String name , String schoolName ){\n             this.name = name;\n           this.schoolName = schoolName;\n       }\t\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   \n\nthis(...) å super(...) ä½¿ç¨æ³¨æç¹\n\n * å­ç±»éè¿ this (...ï¼å»è°ç¨æ¬ç±»çå¶ä»æé å¨ï¼å¦æåæé å¨ï¼ï¼æ¬ç±»å¶ä»æé å¨ä¼éè¿ super å»æå¨è°ç¨ç¶ç±»çæé å¨ï¼æç»è¿æ¯ä¼è°ç¨ç¶ç±»æé å¨çã\n\n * this(â¦) super(â¦) é½åªè½æ¾å¨æé å¨çç¬¬ä¸è¡ï¼æä»¥äºèä¸è½å±å­å¨åä¸ä¸ªæé å¨ä¸­ã\n   \n   * ç¨ this() æé å¨æ¶ï¼å¯è½ä¼è°ç¨åå¼æé å¨ï¼åå¼æé å¨ä¹ä¼è°ç¨ä»ç¸ super()ï¼è¥èªå·±ä¹è°ç¨super()ï¼ä¼é æè°ç¨ä¸¤æ¬¡ super()',normalizedContent:'# é¢åå¯¹è±¡è¿é¶1ï¼staticãåä¾ãä»£ç åãç»§æ¿ï¼\n\n\n# 1. static å³é®å­\n\n\n# 1.1 static æ¯ä»ä¹ãä¿®é¥°æååéåæåæ¹æ³çç¨æ³\n\n# 1.1.1 static æ¯ä»ä¹\n\n * static æ¯éæçææï¼å¯ç¨æ¥ä¿®é¥°æååéåæåæ¹æ³\n\n * static ä¿®é¥°æååéè¡¨ç¤ºè¯¥æååéåªå¨åå­ä¸­åªå­å¨ä¸ä»½ï¼å¯ä»¥è¢«å±äº«è®¿é®ãä¿®æ¹ã\n\n# 1.1.2 æååé\n\næååéå¯ä»¥åä¸º2ç±»ï¼\n\n * éææååé\n   \n   * æ static ä¿®é¥°ï¼å±äºç±»ï¼åå­ä¸­å è½½ä¸æ¬¡\n   \n   * å¸¸è¡¨ç¤ºå¦å¨çº¿äººæ°ä¿¡æ¯ãç­éè¦è¢«å±äº«çä¿¡æ¯ï¼å¯ä»¥è¢«å±äº«è®¿é®\n   \n   * ç¤ºä¾ä»£ç \n     \n     public class user {\n         // éææååé\n         public static string onlinenumber= 161;\n     }\n     \n     \n     1\n     2\n     3\n     4\n     \n   \n   * è®¿é®æ ¼å¼ï¼æ¨èä½¿ç¨ ç±»å.éææååéï¼ä¸æ¨è å¯¹è±¡.éææååé\n\n * å®ä¾æååé\n   \n   * æ staticä¿®é¥°ï¼å­å¨äºæ¯ä¸ªå¯¹è±¡ä¸­\n   * å¸¸è¡¨ç¤ºå§ånameãå¹´é¾ageãç­å±äºæ¯ä¸ªå¯¹è±¡çä¿¡æ¯ãå±äºæ¯ä¸ªå¯¹è±¡ï¼ä¸æ¯ä¸ªå¯¹è±¡çä¿¡æ¯ä¸å\n   * è®¿é®æ ¼å¼ï¼å¯¹è±¡.å®ä¾æååé\n\n# 1.1.3 æåæ¹æ³\n\næåæ¹æ³å¯ä»¥åä¸º2ç±»ï¼\n\n * éææåæ¹æ³\n   * æ static ä¿®é¥°ï¼å±äºç±»\n   * ä½¿ç¨åºæ¯ï¼å¦æè¯¥æ¹æ³æ¯ä»¥æ§è¡ä¸ä¸ªå±ç¨åè½ä¸ºç®çï¼åå¯ä»¥ç³ææéææ¹æ³\n   * è®¿é®ï¼å»ºè®®ç¨ç±»åè®¿é®ï¼ä¹å¯ä»¥ç¨å¯¹è±¡è®¿é®ãç±»å.éææåæ¹æ³\n * å®ä¾æåæ¹æ³\n   * æ  static ä¿®é¥°ï¼å±äºå¯¹è±¡\n   * ä½¿ç¨åºæ¯ï¼è¡¨ç¤ºå¯¹è±¡èªå·±çè¡ä¸ºçï¼ä¸æ¹æ³ä¸­éè¦è®¿é®å®ä¾æåçï¼åè¯¥æ¹æ³å¿é¡»ç³ææå®ä¾æ¹æ³\n   * è®¿é®ï¼åªè½ç¨å¯¹è±¡è§¦åè®¿é®\n\n\n# 1.2 static ä¿®é¥°æååéçåå­åç\n\nå¨å è½½ä¸ä¸ªç±»æ¶ï¼ä¼åå°æ­¤ç±»å è½½å°æ¹æ³åºï¼åæ¶ä¼å¨å åå­ä¸­å¼è¾ä¸åæ­¤ç±»çéæåéåº\n\n-> ç¶åå° main æ¹æ³å è½½è¿æ åå­è¿è¡\n\næ³¨ï¼æ­¤æ¶åå­ä¸­è¿æ²¡æ nameãage å®ä¾æååéï¼å ä¸ºä»ä»¬æ¯å±äºå¯¹è±¡ç\n\n\n\n-> å¨åå»ºå¯¹è±¡æ¶ï¼æå¨å åå­ä¸­å¼è¾ä¸ä¸ªæ°çç©ºé´åºæ¥ã\n\n\n\n-> ææ°çå¯¹è±¡åå»ºæ¶ï¼å¨å åå­ä¸­å¼è¾å¦ä¸ä¸ªç©ºé´è¡¨ç¤ºæ­¤å¯¹è±¡ã\n\n\n\næç¤º\n\nåä¸ä¸ªç±»ä¸­è®¿é®éææååéæ¶ï¼ç±»åå¯ä»¥çç¥ä¸åã\n\n\n# 1.3 static ä¿®é¥°æåæ¹æ³çåå­åç\n\nå¨åå§å è½½ç±»æ¶ï¼ä¾¿ä¼å°è¯¥ç±»çéææ¹æ³åæ¶å è½½å°åå­çæ¹æ³åºä¸­ï¼ä½å®ä¾æåæ¹æ³æ­¤æ¶è¿ä¸ä¼å è½½è¿æ¥ã æ§è¡å¾ä¸­ç getmax æ¹æ³æ¶ï¼å°è¯¥æ¹æ³æå°æ åå­ä¸­è¿è¡ï¼è¾åºç»æä¹åè¿è¡ä¸ä¸æ­¥ã\n\n\n\n-> åå»ºä¸ä¸ªå¯¹è±¡ä¹åï¼å¨å åå­ä¸­å¼è¾ç©ºé´ï¼å¹¶å°å®ä¾æåæ¹æ³ study å è½½å¥æ¹æ³åºï¼å¨å¯¹è±¡ä¸­æåå¯¹ç¸åºéææ¹æ³åè¯¥å®ä¾æ¹æ³çå¼ç¨ã\n\n\n\n\n# 1.4 static è®¿é®çæ³¨æäºé¡¹\n\n * éææ¹æ³åªè½è®¿é®éæçæåï¼ä¸å¯ä»¥ç´æ¥è®¿é®å®ä¾æåã\n   \n   * åªæ¯ä¸è½ç´æ¥å¨ä¸ä¸ªéææ¹æ³ä¸­è®¿é®å®ä¾æååéï¼ä½å¯ä»¥åå¨æ­¤æ¹æ³ä¸­ååå»ºä¸ä¸ªå®ä¾æååéï¼ç¶åè®¿é®å¶åéã\n   * åæ¶ä¹ä¸è½ç´æ¥è®¿é®å®ä¾æåæ¹æ³ã\n\n * å®ä¾æ¹æ³å¯ä»¥è®¿é®éæçæåï¼ä¹å¯ä»¥è®¿é®å®ä¾æåã\n\n * éææ¹æ³ä¸­æ¯ä¸å¯ä»¥åºç° this å³é®å­çã\n   \n   * å ä¸º this ä»£è¡¨å½åå¯¹è±¡ï¼ä½æ¯éææ¹æ³å¯ä»¥ä¸éè¿å¯¹è±¡æ¥è°ç¨ã\n\n> å®ä¾æ¹æ³/åé â å¯¹è±¡ï¼éææ¹æ³/åé â ç±»ã éææååéä¸è¬è®¾ä¸º public ï¼å ä¸ºå®å¨å±åªæä¸ä»½ã\n\n\n# 2. static åºç¨ç¥è¯\n\n\n# 2.1 å·¥å·ç±»\n\n# 2.1.1 ä»ä¹æ¯å·¥å·ç±»\n\nå·¥å·ç±»ä¸­å®ä¹çé½æ¯ä¸äºéææ¹æ³ï¼æ¯ä¸ªæ¹æ³é½æ¯ä»¥å®æä¸ä¸ªå±ç¨çåè½ä¸ºç®çã\n\næ¯å¦ï¼ä¸ä¸ªç³»ç»çå¾å¤é¨åé½éè¦çæéªè¯ç ï¼æ­¤æ¶å¯ä»¥å¼åä¸ä¸ªçæéªè¯ç çéææ¹æ³ã\n\n# 2.1.2 å·¥å·ç±»çå¥½å¤\n\n * è°ç¨æ¹ä¾¿\n * æé«äºä»£ç å¤ç¨ï¼ä¸æ¬¡ç¼åï¼å¤å¤å¯ç¨ï¼\n\n# 2.1.3 ä¸ºä»ä¹å·¥å·ç±»ä¸­çæ¹æ³ä¸ç¨å®ä¾æ¹æ³åï¼\n\nå®ä¾æ¹æ³éè¦åå»ºå¯¹è±¡è°ç¨ï¼æ­¤æ¶ç¨å¯¹è±¡åªæ¯ä¸ºäºè°ç¨æ¹æ³ï¼è¿æ ·åªä¼æµªè´¹åå­ã\n\n# 2.1.4 å·¥å·ç±»å®ä¹æ¶çå¶ä»è¦æ±ï¼é¦ä¸æ·»è±ï¼\n\n * å·¥å·ç±»ä¸­é½æ¯éææ¹æ³ï¼ç´æ¥ç¨ç±»åè®¿é®å³å¯ã\n * å·¥å·ç±»æ éåå»ºå¯¹è±¡ï¼å»ºè®®å°å·¥å·ç±»çæé å¨è¿è¡ç§æåãï¼ç¨ private éå²æï¼\n\n\n# 2.2 ä»£ç å\n\n# 2.2.1 ä»£ç åæ¦è¿°\n\n * ä»£ç åæ¯ç±»ç5å¤§æåä¹ä¸ï¼æååéãæé å¨ï¼æ¹æ³ï¼ä»£ç åï¼åé¨ç±»ï¼ï¼å®ä¹å¨ç±»ä¸­æ¹æ³å¤ã\n\n * å¨javaç±»ä¸ï¼ä½¿ç¨ { } æ¬èµ·æ¥çä»£ç è¢«ç§°ä¸ºä»£ç å ã\n\n# 2.2.2 ä»£ç ååç±»\n\n * éæä»£ç å\n   \n   * æ ¼å¼ï¼static{}\n   \n   * ç¹ç¹ï¼éè¦éè¿ static å³é®å­ä¿®é¥°ï¼éçç±»çå è½½èå è½½ï¼å¹¶ä¸èªå¨è§¦åãåªæ§è¡ä¸æ¬¡\n   \n   * ä½ç¨ï¼è¥è¦å¨å¯å¨ç³»ç»æ¶å¯¹æ°æ®è¿è¡åå§åï¼å»ºè®®ä½¿ç¨éæä»£ç åå®ææ°æ®çåå§åæä½ï¼ä»£ç ä¼é\n   \n   * ä½¿ç¨åºæ¯ï¼å¨ç±»å è½½çæ¶ååä¸äºéææ°æ®åå§åçæä½ï¼ä»¥ä¾¿åç»­ä½¿ç¨ãæ¯å¦ï¼æ°æ®åºçè¿æ¥å¯ä»¥å¨ static { } ä¸­æ§è¡ï¼è¿è¡éæèµæºçåå§åã\n   \n   * ä»£ç ç¤ºä¾ï¼\n     \n     public class staticdemo {\n         \n         public static void main(string[] args) {\n             system.out.println("----mainæ¹æ³æ§è¡----");\n         }\n         \n         /**\n          éæä»£ç åï¼æstaticä¿®é¥°ï¼å±äºç±»ï¼ä¸ç±»ä¸èµ·ä¼åå è½½ä¸æ¬¡ï¼èªå¨è§¦åæ§è¡\n         */\n         static {\n             system.out.println("----éæä»£ç åè¢«è§¦åæ§è¡äº----");\n         }\n     }\n     \n     // ä»¥ä¸ä»£ç ä¸­åè§¦åéæä»£ç åï¼ç¶åæ§è¡mainæ¹æ³\n     \n     \n     1\n     2\n     3\n     4\n     5\n     6\n     7\n     8\n     9\n     10\n     11\n     12\n     13\n     14\n     15\n     \n\n * æé ä»£ç åï¼äºè§£ï¼ç¨çå°ï¼\n   \n   * ä¹å¯ä»¥å«å®ä¾ä»£ç å\n   * æ ¼å¼ï¼{}\n   * ç¹ç¹ï¼æ¯æ¬¡åå»ºå¯¹è±¡ï¼è°ç¨æé å¨æ§è¡æ¶ï¼é½ä¼æ§è¡è¯¥ä»£ç åä¸­çä»£ç ï¼å¹¶ä¸å¨æé å¨æ§è¡åæ§è¡\n   * ä½¿ç¨åºæ¯ï¼åå§åå®ä¾èµæºã\n\n# 2.2.3 æ¡ä¾ââæå°ä¸»æ¸¸æ\n\néæ±ï¼\n\nå¨å¯å¨æ¸¸ææ¿é´çæ¶åï¼åºè¯¥æååå¤å¥½54å¼ çï¼åç»­æå¯ä»¥ç´æ¥ä½¿ç¨è¿äºçæ°æ®ã\n\nåæï¼\n\nâ è¯¥æ¿é´åªéè¦ä¸å¯çã\n\nâ¡å®ä¹ä¸ä¸ªéæç arraylist éåå­å¨ 54 å¼ çå¯¹è±¡ï¼éæçéååªä¼å è½½ä¸ä»½ã\n\nâ¢å¨å¯å¨æ¸¸ææ¿é´åï¼åºè¯¥å° 54 å¼ çåå§åå¥½\n\nâ£å½ç³»ç»å¯å¨çåæ¶éè¦åå¤å¥½ 54 å¼ çæ°æ®ï¼æ­¤æ¶å¯ä»¥ç¨éæä»£ç åå®æã\n\næ»ç»ï¼\n\néè¦æååå¤æ°æ®ï¼å¹¶ä¸æ¯åªéè¦ä¸ä»½è¿ä¸ªæ°æ®ï¼å æ­¤ä½¿ç¨ static ä¿®é¥°çæ¶åï¼éè¦ç¨å°éæä»£ç åã\n\n\n# 2.3 è®¾è®¡æ¨¡å¼ï¼åä¾\n\n# 2.3.1 ä»ä¹æ¯è®¾è®¡æ¨¡å¼\n\n * å¼åä¸­ç»å¸¸éå°ä¸äºé®é¢ï¼ä¸ä¸ªé®é¢éå¸¸ænç§è§£æ³çï¼ä½å¶ä¸­æä¸ç§è§£æ³æ¯æä¼çï¼è¿ä¸ªæä¼çè§£æ³è¢«æ»ç»åºæ¥ï¼ç§°ä¹ä¸ºè®¾è®¡æ¨¡å¼ã\n\n * è®¾è®¡æ¨¡å¼æ20å¤ç§ï¼å¯¹åº20å¤ç§è½¯ä»¶å¼åä¸­ä¼éå°çé®é¢ï¼å­¦è®¾è®¡æ¨¡å¼ä¸»è¦æ¯å­¦2ç¹ï¼\n   \n   * ç¬¬ä¸ï¼è¿ç§æ¨¡å¼ç¨æ¥è§£å³ä»ä¹é®é¢ã\n   * ç¬¬äºï¼éå°è¿ç§é®é¢äºï¼è¯¥æ¨¡å¼æ¯æä¹åçï¼ä»æ¯å¦ä½è§£å³è¿ä¸ªé®é¢çã\n\n# 2.3.2 åä¾æ¨¡å¼\n\nå¯ä»¥ä¿è¯ç³»ç»ä¸­ï¼åºç¨è¯¥æ¨¡å¼çè¿ä¸ªç±»æ°¸è¿åªæä¸ä¸ªå®ä¾ï¼å³ä¿è¯ä¸ä¸ªç±»æ°¸è¿åªè½åå»ºä¸ä¸ªå¯¹è±¡ãä¾å¦ä»»å¡ç®¡çå¨å¯¹è±¡æä»¬åªéè¦ä¸ä¸ªå°±å¯ä»¥è§£å³é®é¢äºï¼è¿æ ·å¯ä»¥èçåå­ç©ºé´ã\n\nåä¾çå®ç°æ¹å¼æå¾å¤ï¼å¦é¥¿æ±åä¾æ¨¡å¼ãææ±åä¾æ¨¡å¼ï¼â¦â¦\n\n# 2.3.3 é¥¿æ±åä¾æ¨¡å¼\n\n * å¨ç¨ç±»è·åå¯¹è±¡çæ¶åï¼å¯¹è±¡å·²ç»æåä¸ºä½ åå»ºå¥½äºã\n\n * è®¾è®¡æ­¥éª¤ï¼\n   \n   * å®ä¹ä¸ä¸ªç±»ï¼ææé å¨ç§æ\n   \n   * å®ä¹ä¸ä¸ªéæåéå­å¨ä¸ä¸ªå¯¹è±¡\n\n * ä»£ç ç¤ºä¾ï¼\n   \n   /** aãå®ä¹ä¸ä¸ªåä¾ç±» */\n   public class singleinstance {\n       /** c.å®ä¹ä¸ä¸ªéæåéå­å¨ä¸ä¸ªå¯¹è±¡å³å¯ï¼å±äºç±»ï¼ä¸ç±»ä¸èµ·å è½½ä¸æ¬¡ */\n       public static singleinstance instance = new singleinstance();\n       \n       /** b.åä¾å¿é¡»ç§ææé å¨*/\n       private singleinstance(){\n           system.out.println("åå»ºäºä¸ä¸ªå¯¹è±¡");\n       }\n   }\n   \n   \n   /** \n     å«çç±»ä¸­çä½¿ç¨ï¼ç´æ¥è·åè¯¥åä¾çå¯¹è±¡\n   */\n   singleinstance s1 = singleinstance.instance;\n   \n   // å½æå¤æ¡è¯­å¥åå»ºs1ãs2ãs3...æ¶ï¼ä»ä»¬é½æ¯ç¸ç­çï¼æ¯åä¸ä¸ªå¯¹è±¡\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   18\n   \n\n# 2.3.4 ææ±åä¾æ¨¡å¼\n\n * å¨çæ­£éè¦è¯¥å¯¹è±¡çæ¶åï¼æå»åå»ºä¸ä¸ªå¯¹è±¡(å»¶è¿å è½½å¯¹è±¡)ã\n\n * è®¾è®¡æ­¥éª¤ï¼\n   \n   * å®ä¹ä¸ä¸ªç±»ï¼ææé å¨ç§æ\n   * å®ä¹ä¸ä¸ªéæåéå­å¨ä¸ä¸ªå¯¹è±¡\n   * æä¾ä¸ä¸ªè¿ååä¾å¯¹è±¡çæ¹æ³\n\n * ä»£ç ç¤ºä¾ï¼\n   \n   /** å®ä¹ä¸ä¸ªåä¾ç±» */\n   class singleinstance{\n       /** å®ä¹ä¸ä¸ªéæåéå­å¨ä¸ä¸ªå¯¹è±¡å³å¯:å±äºç±»ï¼ä¸ç±»ä¸èµ·å è½½ä¸æ¬¡ */\n       private static singleinstance instance ; // é»è®¤å¼ï¼null\n       \n       /** åä¾å¿é¡»ç§ææé å¨*/\n       private singleinstance(){\n           \n       }\n       \n       /** å¿é¡»æä¾ä¸ä¸ªæ¹æ³è¿åä¸ä¸ªåä¾å¯¹è±¡  */\n       public static singleinstance getinstance(){\n           if(instance == null){\n           \t// ç¬¬ä¸æ¬¡æ¥æ¿å¯¹è±¡ï¼æ­¤æ¶éè¦åå»ºå¯¹è±¡    \n   \t        instance = new singleinstance();\n           }\n           return instance;\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   18\n   19\n   \n   \n   â ï¸ ä¸è¿°ä»£ç ä¸­ï¼line 4 ä¸­ç¨ private ä¿®é¥°å¯¹è±¡ï¼æ­¤æ¶æ æ³ä»è¯¥ç±»å¤é¨ä½¿ç¨ singleinstance s1 = singleinstance.instance è·åå¯¹è±¡äºï¼åªè½ä½¿ç¨singleinstance s1 = singleinstance.getinstance() è·åãå¦åå¯è½ä¼æ¿å° null å¼ï¼ä¸ç¬¦åéæ±ã\n\n# 2.3.5 é¥¿æ±åä¾æ¨¡å¼ vs ææ±åä¾æ¨¡å¼\n\nææ±åä¾æ¨¡å¼èçåå­ï¼å¨ä¸éè¦åå»ºå¯¹è±¡æ¶ï¼ä¸ä¼å¨æ åå­ä¸­åå»ºåå­ã\n\né¥¿æ±åä¾æ¨¡å¼æ´å¿«äºï¼å½éè¦å¯¹è±¡æ¶ï¼å·²ç»å¨åå­ä¸­äºã\n\n\n# 4. é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹äºï¼ç»§æ¿\n\n\n# 4.1 ç»§æ¿æ¦è¿°\n\n * å³é®å­ï¼extendsï¼å»ºç«ä¸¤ä¸ªç±»ä¹é´çç¶å­å³ç³»\n\n * åºæ¬ä½¿ç¨ï¼public class student extends people {} ã student ç§°ä¸ºå­ç±»ï¼æ´¾çç±»ï¼ï¼people ç§°ä¸ºç¶ç±»(åºç±» æè¶ç±»)ã\n\n * å¥½å¤ï¼å­ç±»ç»§æ¿ç¶ç±»åï¼å¯ä»¥ç´æ¥ä½¿ç¨ç¶ç±»å¬å±çå±æ§åæ¹æ³äºãå æ­¤ï¼ç¨å¥½è¿ä¸ªææ¯å¯ä»¥å¾å¥½çæä»¬æé«ä»£ç çå¤ç¨æ§\n\n\n# 4.2 ç»§æ¿çè®¾è®¡è§è\n\nå­ç±»ä»¬ç¸åç¹å¾ï¼å±æ§å±æ§ï¼å±æ§æ¹æ³ï¼æ¾å¨ç¶ç±»ä¸­å®ä¹ï¼å­ç±»ç¬æççå±æ§åè¡ä¸ºåºè¯¥å®ä¹å¨å­ç±»èªå·±éé¢ã\n\n\n# 4.3 ç»§æ¿çåå­è¿è¡åç\n\nåå»ºä¸ä¸ªå­ç±»å¯¹è±¡æ¶ï¼å®éä¼å¨å åå­ä¸­åä¸ºç¶ç±»ç©ºé´åå­ç±»ç©ºé´ä¸¤é¨åï¼å¯¹å¤æ¯ä¸ä¸ªå¯¹è±¡ï¼å¯¹åä¼åä¸ºä¸¤é¨åï¼æ´ä¸ªä»£è¡¨ä¸ä¸ªå­ç±»å¯¹è±¡ã\n\n\n\n\n# 4.4 ç»§æ¿çç¹ç¹\n\n * å­ç±»å¯ä»¥ç»§æ¿ç¶ç±»çå±æ§åè¡ä¸ºï¼ä½æ¯å­ç±»ä¸è½ç»§æ¿ç¶ç±»çæé å¨ã\n   \n   * å­ç±»æèªå·±çæé å¨ï¼ç¶ç±»æé å¨ç¨äºåå§åç¶ç±»å¯¹è±¡ã\n\n * javaæ¯åç»§æ¿æ¨¡å¼ï¼ä¸ä¸ªç±»åªè½ç»§æ¿ä¸ä¸ªç´æ¥ç¶ç±»ã\n   \n   * ä¸ºå¥ï¼åè¯ï¼å½å¤ä¸ªç¸ç¸ä¸­è®©ä½ å¤ä¹ ä¸ä¸æ ·çåå®¹ï¼é£ä½ å°±ä¸ç¥éè¯¥å¤ä¹ åªé¨å¦ï¼åºç°äºäºä¹æ§\n\n * javaä¸æ¯æå¤ç»§æ¿ãä½æ¯æ¯æå¤å±ç»§æ¿ã\n   \n   * å¤å±ç»§æ¿ï¼å¿å­ -> ç¸ç¸ -> ç·ç·\n   * åºäºå°±è¿ååä½¿ç¨ç¶ç±»ä¸­çæååéåæåæ¹æ³\n\n * javaä¸­ææçç±»é½æ¯ object ç±»çå­ç±»ã\n   \n   * è¦ä¹ç´æ¥ç»§æ¿äºobject , è¦ä¹é»è®¤ç»§æ¿äºobject , è¦ä¹é´æ¥ç»§æ¿äºobject\n   * objectæ¯ç¥å®ç±»ã\n\nä¸äºå°æ³¨æç¹\n\n 1. å­ç±»æ¯å¦å¯ä»¥ç»§æ¿ç¶ç±»çç§ææåï¼\n    \n    å­ç±»å¯ä»¥ç»§æ¿ç¶ç±»çç§ææåï¼ä½ä¸è½ç´æ¥è®¿é®ãå¦ï¼å¤§å¤´å¿å­ç»§æ¿äºå°å¤´ç¸ç¸çä¿é©æï¼ä½ä»æ²¡æå¯ç ï¼æä¸å¼ã\n\n 2. å­ç±»æ¯å¦å¯ä»¥ç»§æ¿ç¶ç±»çéææåï¼\n    \n    æäºè®®çç¥è¯ç¹ã\n    \n    å­ç±»å¯ä»¥ç´æ¥ä½¿ç¨ç¶ç±»çéææåï¼å±äº«ï¼ã\n    \n    ä½é»é©¬è®¤ä¸ºï¼å­ç±»ä¸è½ç»§æ¿ç¶ç±»çéææåãï¼å±äº«å¹¶éç»§æ¿ï¼ãå¦ï¼ç¸ç¸çè½¦ç»å¿å­å¼ï¼è¿åªæ¯å±äº«ï¼ä¸æ¯ç»§æ¿ï¼è½¦æ²¡æç»å¿å­ã\n\n\n# 4.5 ç»§æ¿ä¹åçç¹ç¹\n\n# 4.5.1 æååéãæåæ¹æ³çè®¿é®ç¹ç¹\n\n * å¨å­ç±»æ¹æ³ä¸­è®¿é®æåï¼æååéãæåæ¹æ³ï¼æ»¡è¶³ï¼å°±è¿åå\n   * å­ç±»å±é¨èå´æ¾ â å­ç±»æåèå´æ¾ â ç¶ç±»æåèå´æ¾ï¼å¦æç¶ç±»èå´è¿æ²¡ææ¾å°åæ¥éã\n * å¨å­ç±»ä¸­ä½¿ç¨ç¶ç±»çéåæåæä¹åï¼\n   * å­ç±»ç¶ç±»åºç°éåæåï¼ä¼åä½¿ç¨å­ç±»ç\n   * å¯éè¿ super å³é®å­ï¼æå®è®¿é®ç¶ç±»çæåï¼æ ¼å¼ï¼super.ç¶ç±»æååé/æ¹æ³\n\n# 4.5.2 ç»§æ¿åï¼æ¹æ³éå\n\næ¹æ³éåçåºæ¬ç¥è¯ï¼\n\n * ä»ä¹æ¯æ¹æ³éåï¼\n   * å¨ç»§æ¿ä½ç³»ä¸­ï¼å­ç±»åºç°äºåç¶ç±»ä¸­ä¸æ¨¡ä¸æ ·çæ¹æ³å£°æï¼ç§°å­ç±»çè¿ä¸ªæ¹æ³æ¯éåçæ¹æ³ã\n * æ¹æ³éåçåºç¨åºæ¯\n   * å­ç±»éè¦ç¶ç±»çåè½ï¼ä½ç¶ç±»çè¯¥åè½ä¸å®å¨æ»¡è¶³èªå·±çéæ±æ¶\n * æ¡ä¾ï¼\n   * æ§ææºçåè½åªè½æ¯åºæ¬çæçµè¯ï¼åä¿¡æ¯\n   * æ°ææºçåè½éè¦è½å¤ï¼åºæ¬çæçµè¯ä¸æ¯æè§é¢éè¯ãåºæ¬çåä¿¡æ¯ä¸æ¯æåéè¯­é³åå¾ç\n\n@override æ³¨è§£ï¼\n\n * @override æ¯æ¾å¨éååçæ¹æ³ä¸ï¼ä½ä¸ºéåæ¯å¦æ­£ç¡®çæ ¡éªæ³¨è§£ã\n * å ä¸è¯¥æ³¨è§£åå¦æéåéè¯¯ï¼ç¼è¯é¶æ®µä¼åºç°éè¯¯æç¤ºã\n * å»ºè®®éåæ¹æ³é½å  @override æ³¨è§£ï¼ä»£ç å®å¨ï¼ä¼éï¼\n\næ¹æ³éåæ³¨æäºé¡¹åè¦æ±ï¼\n\n * éåæ¹æ³çåç§°ãå½¢ååè¡¨å¿é¡»ä¸è¢«éåæ¹æ³çåç§°ååæ°åè¡¨ä¸è´ï¼ç³æå¿é¡»ä¸æ ·ï¼è®¿é®æéä¹ä¸è¬é½æ¯ä¸æ ·çï¼ã\n   * ç³æä¸åï¼éæ°å®ç°\n * ç§ææ¹æ³ä¸è½è¢«éåã\n * å­ç±»éåç¶ç±»æ¹æ³æ¶ï¼è®¿é®æéå¿é¡»å¤§äºæèç­äºç¶ç±» ï¼private < ç¼ºç < protected < publicï¼\n * å­ç±»ä¸è½éåç¶ç±»çéææ¹æ³ï¼å¦æéåä¼æ¥éçã\n   * åå ï¼å­ç±»æ¬èº«å°±æ²¡æç»§æ¿å°ç¶ç±»çéææ¹æ³ï¼åªæ¯å±äº«ï¼å æ­¤æ æ³è¦çå®ãè°ç¨ä¸­ä¹æ¯ç¶ç±»çéææ¹æ³ç¨ âç¶ç±»å.ç¶ç±»éææ¹æ³åâ è°ç¨ï¼å­ç±»çç¨å­ç±»å¯¹åºçæ¹æ³è°ç¨ï¼ä¸ä¼äºç¸å½±åã\n\n# 4.5.3 ç»§æ¿åï¼å­ç±»æé å¨çç¹ç¹\n\nå­ç±»ç»§æ¿ç¶ç±»åæé å¨çç¹ç¹ï¼\n\n * å­ç±»ä¸­ææçæé å¨é»è®¤é½ä¼åè®¿é®ç¶ç±»ç**æ åæé å¨**ï¼åæ§è¡èªå·±ã\n\nåå ï¼\n\n * å­ç±»å¨åå§åçæ¶åï¼æå¯è½ä¼ä½¿ç¨å°ç¶ç±»ä¸­çæ°æ®ï¼å¦æç¶ç±»æ²¡æå®æåå§åï¼å­ç±»å°æ æ³ä½¿ç¨ç¶ç±»çæ°æ®ã\n * å­ç±»åå§åä¹åï¼ä¸å®è¦è°ç¨ç¶ç±»æé å¨åå®æç¶ç±»æ°æ®ç©ºé´çåå§åã\n\næä¹è°ç¨ç¶ç±»æé å¨çï¼\n\n * å­ç±»æé å¨çç¬¬ä¸è¡è¯­å¥é»è®¤é½æ¯ï¼super()ï¼ä¸åä¹å­å¨ã\n\n# 4.5.4 ç»§æ¿åï¼å­ç±»æé å¨è®¿é®ç¶ç±»æåæé å¨\n\nsuperè°ç¨ç¶ç±»æåæ°æé å¨çä½ç¨ï¼\n\n * åå§åç»§æ¿èªç¶ç±»çæ°æ®ã\n * å³ï¼teacher ç±»ç»§æ¿äº people ç±»ï¼å¨ teacher ä¸­åå§å people å®ä¹å¥½ç nameï¼age\n\nå¦æç¶ç±»ä¸­æ²¡ææ åæ°æé å¨ï¼åªææåæé å¨ï¼ä¼åºç°ä»ä¹ç°è±¡å¢ï¼\n\n * ä¼æ¥éãå ä¸ºå­ç±»é»è®¤æ¯è°ç¨ç¶ç±»æ åæé å¨çã\n\n * ä½å­ç±»ä¸­å¦æåªè°ç¨äºç¶ç±»çæåæé å¨ï¼æ¯ä¸ä¼æ¥éçã\n\n * è§£å³ï¼å­ç±»æé å¨ä¸­éè¿ super(â¦)ï¼æå¨è°ç¨ç¶ç±»çæåæ°æé å¨\n\n * å»ºè®®ï¼å°æ åæé å¨å¨é½ååºæ¥\n\n\n# 4.6 thisãsuper ä½¿ç¨æ»ç»\n\n * thisï¼ä»£è¡¨æ¬ç±»å¯¹è±¡çå¼ç¨ï¼\n\n * superï¼ä»£è¡¨ç¶ç±»å­å¨ç©ºé´çæ è¯ã\n\n * ç¤ºä¾ä»£ç \n   \n   /**\n   \tåå°åå»ºå¯¹è±¡å°è£æ°æ®çæ¶åå¦æç¨æ·æ²¡æè¾å¥å­¦æ ¡ï¼åé»è®¤ä½¿ç¨âé»é©¬å¹è®­ä¸­å¿â;å¦æç¨æ·è¾å¥äºå­¦æ ¡åä½¿ç¨ç¨æ·è¾å¥çå­¦æ ¡ä¿¡æ¯\n   */\n   public class student {        \n       private string schoolname;\n       private string name;\n      \n       public student(string name){\n             this(name , âé»é©¬å¹è®­ä¸­å¿â);\t// è°ç¨ä¸¤ä¸ªåæ°çæé å¨\n       }\t\n        \n       public student(string name , string schoolname ){\n             this.name = name;\n           this.schoolname = schoolname;\n       }\t\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   \n\nthis(...) å super(...) ä½¿ç¨æ³¨æç¹\n\n * å­ç±»éè¿ this (...ï¼å»è°ç¨æ¬ç±»çå¶ä»æé å¨ï¼å¦æåæé å¨ï¼ï¼æ¬ç±»å¶ä»æé å¨ä¼éè¿ super å»æå¨è°ç¨ç¶ç±»çæé å¨ï¼æç»è¿æ¯ä¼è°ç¨ç¶ç±»æé å¨çã\n\n * this(â¦) super(â¦) é½åªè½æ¾å¨æé å¨çç¬¬ä¸è¡ï¼æä»¥äºèä¸è½å±å­å¨åä¸ä¸ªæé å¨ä¸­ã\n   \n   * ç¨ this() æé å¨æ¶ï¼å¯è½ä¼è°ç¨åå¼æé å¨ï¼åå¼æé å¨ä¹ä¼è°ç¨ä»ç¸ super()ï¼è¥èªå·±ä¹è°ç¨super()ï¼ä¼é æè°ç¨ä¸¤æ¬¡ super()',charsets:{cjk:!0},lastUpdated:"2023/03/15, 14:34:12",lastUpdatedTimestamp:1678890852e3},{title:"é¢åå¯¹è±¡è¿é¶2ï¼åãæéä¿®é¥°ç¬¦ãæ½è±¡ç±»ãæ¥å£ï¼",frontmatter:{title:"é¢åå¯¹è±¡è¿é¶2ï¼åãæéä¿®é¥°ç¬¦ãæ½è±¡ç±»ãæ¥å£ï¼",date:"2023-02-28T10:16:51.000Z",permalink:"/pages/b127ae/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/31.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B62%EF%BC%88%E5%8C%85%E3%80%81%E6%9D%83%E9%99%90%E4%BF%AE%E9%A5%B0%E7%AC%A6%E3%80%81%E6%8A%BD%E8%B1%A1%E7%B1%BB%E3%80%81%E6%8E%A5%E5%8F%A3%EF%BC%89.html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/31.é¢åå¯¹è±¡è¿é¶2ï¼åãæéä¿®é¥°ç¬¦ãæ½è±¡ç±»ãæ¥å£ï¼.md",key:"v-087079a8",path:"/pages/b127ae/",headers:[{level:2,title:"1. å",slug:"_1-å",normalizedTitle:"1. å",charIndex:30},{level:3,title:"1.1 ä»ä¹æ¯å",slug:"_1-1-ä»ä¹æ¯å",normalizedTitle:"1.1 ä»ä¹æ¯å",charIndex:39},{level:3,title:"1.2 å¯¼å",slug:"_1-2-å¯¼å",normalizedTitle:"1.2 å¯¼å",charIndex:302},{level:2,title:"2. æéä¿®é¥°ç¬¦",slug:"_2-æéä¿®é¥°ç¬¦",normalizedTitle:"2. æéä¿®é¥°ç¬¦",charIndex:423},{level:3,title:"2.1 ä»ä¹æ¯æéä¿®é¥°ç¬¦ï¼",slug:"_2-1-ä»ä¹æ¯æéä¿®é¥°ç¬¦",normalizedTitle:"2.1 ä»ä¹æ¯æéä¿®é¥°ç¬¦ï¼",charIndex:436},{level:3,title:"2.2 æéä¿®é¥°ç¬¦çåç±»åä½ç¨èå´",slug:"_2-2-æéä¿®é¥°ç¬¦çåç±»åä½ç¨èå´",normalizedTitle:"2.2 æéä¿®é¥°ç¬¦çåç±»åä½ç¨èå´",charIndex:528},{level:3,title:"2.3 æéä¿®é¥°ç¬¦çä½¿ç¨",slug:"_2-3-æéä¿®é¥°ç¬¦çä½¿ç¨",normalizedTitle:"2.3 æéä¿®é¥°ç¬¦çä½¿ç¨",charIndex:843},{level:2,title:"3. final å³é®å­åå¸¸éãæä¸¾",slug:"_3-final-å³é®å­åå¸¸éãæä¸¾",normalizedTitle:"3. final å³é®å­åå¸¸éãæä¸¾",charIndex:1033},{level:2,title:"3.1 final å³é®å­",slug:"_3-1-final-å³é®å­",normalizedTitle:"3.1 final å³é®å­",charIndex:1056},{level:3,title:"3.2 å¸¸é",slug:"_3-2-å¸¸é",normalizedTitle:"3.2 å¸¸é",charIndex:1563},{level:4,title:"3.2.1 å¸¸éæ¦è¿°ååºæ¬ä½ç¨",slug:"_3-2-1-å¸¸éæ¦è¿°ååºæ¬ä½ç¨",normalizedTitle:"3.2.1 å¸¸éæ¦è¿°ååºæ¬ä½ç¨",charIndex:1573},{level:4,title:"3.2.2 å¸¸éåä¿¡æ¯æ å¿ååç±»",slug:"_3-2-2-å¸¸éåä¿¡æ¯æ å¿ååç±»",normalizedTitle:"3.2.2 å¸¸éåä¿¡æ¯æ å¿ååç±»",charIndex:1834},{level:3,title:"3.3 æä¸¾",slug:"_3-3-æä¸¾",normalizedTitle:"3.3 æä¸¾",charIndex:2058},{level:4,title:"3.3.1 æä¸¾çæ¦è¿°",slug:"_3-3-1-æä¸¾çæ¦è¿°",normalizedTitle:"3.3.1 æä¸¾çæ¦è¿°",charIndex:2068},{level:4,title:"3.3.2 æä¸¾çä½¿ç¨åºæ¯",slug:"_3-3-2-æä¸¾çä½¿ç¨åºæ¯",normalizedTitle:"3.3.2 æä¸¾çä½¿ç¨åºæ¯",charIndex:3171},{level:2,title:"4. æ½è±¡ç±»",slug:"_4-æ½è±¡ç±»",normalizedTitle:"4. æ½è±¡ç±»",charIndex:3367},{level:3,title:"4.1 æ½è±¡ç±»æ¦è¿°",slug:"_4-1-æ½è±¡ç±»æ¦è¿°",normalizedTitle:"4.1 æ½è±¡ç±»æ¦è¿°",charIndex:3378},{level:3,title:"4.2 æ½è±¡ç±»çæ¡ä¾",slug:"_4-2-æ½è±¡ç±»çæ¡ä¾",normalizedTitle:"4.2 æ½è±¡ç±»çæ¡ä¾",charIndex:3664},{level:3,title:"4.3 è®¾è®¡æ¨¡å¼ï¼æ¨¡æ¿æ¹æ³æ¨¡å¼",slug:"_4-3-è®¾è®¡æ¨¡å¼-æ¨¡æ¿æ¹æ³æ¨¡å¼",normalizedTitle:"4.3 è®¾è®¡æ¨¡å¼ï¼æ¨¡æ¿æ¹æ³æ¨¡å¼",charIndex:4297},{level:4,title:"4.3.1 æ¨¡æ¿æ¹æ³æ¨¡å¼çä½¿ç¨åºæ¯",slug:"_4-3-1-æ¨¡æ¿æ¹æ³æ¨¡å¼çä½¿ç¨åºæ¯",normalizedTitle:"4.3.1 æ¨¡æ¿æ¹æ³æ¨¡å¼çä½¿ç¨åºæ¯",charIndex:4332},{level:4,title:"4.3.2 æ¨¡æ¿æ¹æ³æ¨¡å¼çå®ç°æ­¥éª¤",slug:"_4-3-2-æ¨¡æ¿æ¹æ³æ¨¡å¼çå®ç°æ­¥éª¤",normalizedTitle:"4.3.2 æ¨¡æ¿æ¹æ³æ¨¡å¼çå®ç°æ­¥éª¤",charIndex:4411},{level:4,title:"4.3.3 æ¡ä¾ï¼ä¸­å°å­¦çåä½æ",slug:"_4-3-3-æ¡ä¾-ä¸­å°å­¦çåä½æ",normalizedTitle:"4.3.3 æ¡ä¾ï¼ä¸­å°å­¦çåä½æ",charIndex:4516},{level:2,title:"5. æ¥å£",slug:"_5-æ¥å£",normalizedTitle:"5. æ¥å£",charIndex:4765},{level:3,title:"5.1 æ¥å£çæ¦è¿°åç¹ç¹",slug:"_5-1-æ¥å£çæ¦è¿°åç¹ç¹",normalizedTitle:"5.1 æ¥å£çæ¦è¿°åç¹ç¹",charIndex:4775},{level:4,title:"5.1.1 å¥æ¯æ¥å£",slug:"_5-1-1-å¥æ¯æ¥å£",normalizedTitle:"5.1.1 å¥æ¯æ¥å£",charIndex:4791},{level:4,title:"5.1.2 æ¥å£çç¹ç¹",slug:"_5-1-2-æ¥å£çç¹ç¹",normalizedTitle:"5.1.2 æ¥å£çç¹ç¹",charIndex:4969},{level:3,title:"5.2 æ¥å£çåºæ¬ä½¿ç¨ï¼è¢«å®ç°",slug:"_5-2-æ¥å£çåºæ¬ä½¿ç¨-è¢«å®ç°",normalizedTitle:"5.2 æ¥å£çåºæ¬ä½¿ç¨ï¼è¢«å®ç°",charIndex:5181},{level:3,title:"5.3 JDK8 å¼å§æ¥å£æ°å¢æ¹æ³",slug:"_5-3-jdk8-å¼å§æ¥å£æ°å¢æ¹æ³",normalizedTitle:"5.3 jdk8 å¼å§æ¥å£æ°å¢æ¹æ³",charIndex:5680},{level:4,title:"5.3.1 é»è®¤æ¹æ³",slug:"_5-3-1-é»è®¤æ¹æ³",normalizedTitle:"5.3.1 é»è®¤æ¹æ³",charIndex:5952},{level:4,title:"5.3.2 éææ¹æ³",slug:"_5-3-2-éææ¹æ³",normalizedTitle:"5.3.2 éææ¹æ³",charIndex:6037},{level:4,title:"5.3.3 ç§ææ¹æ³",slug:"_5-3-3-ç§ææ¹æ³",normalizedTitle:"5.3.3 ç§ææ¹æ³",charIndex:6108}],headersStr:"1. å 1.1 ä»ä¹æ¯å 1.2 å¯¼å 2. æéä¿®é¥°ç¬¦ 2.1 ä»ä¹æ¯æéä¿®é¥°ç¬¦ï¼ 2.2 æéä¿®é¥°ç¬¦çåç±»åä½ç¨èå´ 2.3 æéä¿®é¥°ç¬¦çä½¿ç¨ 3. final å³é®å­åå¸¸éãæä¸¾ 3.1 final å³é®å­ 3.2 å¸¸é 3.2.1 å¸¸éæ¦è¿°ååºæ¬ä½ç¨ 3.2.2 å¸¸éåä¿¡æ¯æ å¿ååç±» 3.3 æä¸¾ 3.3.1 æä¸¾çæ¦è¿° 3.3.2 æä¸¾çä½¿ç¨åºæ¯ 4. æ½è±¡ç±» 4.1 æ½è±¡ç±»æ¦è¿° 4.2 æ½è±¡ç±»çæ¡ä¾ 4.3 è®¾è®¡æ¨¡å¼ï¼æ¨¡æ¿æ¹æ³æ¨¡å¼ 4.3.1 æ¨¡æ¿æ¹æ³æ¨¡å¼çä½¿ç¨åºæ¯ 4.3.2 æ¨¡æ¿æ¹æ³æ¨¡å¼çå®ç°æ­¥éª¤ 4.3.3 æ¡ä¾ï¼ä¸­å°å­¦çåä½æ 5. æ¥å£ 5.1 æ¥å£çæ¦è¿°åç¹ç¹ 5.1.1 å¥æ¯æ¥å£ 5.1.2 æ¥å£çç¹ç¹ 5.2 æ¥å£çåºæ¬ä½¿ç¨ï¼è¢«å®ç° 5.3 JDK8 å¼å§æ¥å£æ°å¢æ¹æ³ 5.3.1 é»è®¤æ¹æ³ 5.3.2 éææ¹æ³ 5.3.3 ç§ææ¹æ³",content:'# é¢åå¯¹è±¡è¿é¶2ï¼åãæéä¿®é¥°ç¬¦ãæ½è±¡ç±»ãæ¥å£ï¼\n\n\n# 1. å\n\n\n# 1.1 ä»ä¹æ¯å\n\n * åæ¯ç¨æ¥åé¨å«ç±»çç®¡çåç§ä¸åç±»çï¼ç±»ä¼¼äºæä»¶å¤¹ãå»ºåå©äºç¨åºçç®¡çåç»´æ¤\n\n * å»ºåçè¯­æ³æ ¼å¼ï¼package å¬å¸åååå.ææ¯åç§°ãæ¥åå»ºè®®å¨é¨è±æå°åï¼ä¸å·å¤æä¹\n   \n   å¦ï¼\n   \n   package com.itheima.javabean;\n   public class Student {\n          \n   }\n   \n   \n   \n   1\n   2\n   3\n   4\n   5\n   \n\n * å»ºåè¯­å¥å¿é¡»å¨ç¬¬ä¸è¡ï¼ä¸è¬IDEAå·¥å·ä¼å¸®å©åå»º\n\n\n# 1.2 å¯¼å\n\n * ç¸ååä¸çç±»å¯ä»¥ç´æ¥è®¿é®ï¼ä¸ååä¸çç±»å¿é¡»å¯¼åï¼æå¯ä»¥ä½¿ç¨ï¼\n\n * å¯¼åæ ¼å¼ï¼import åå.ç±»å\n\n * è¥ä¸ä¸ªç±»ä¸­è¦ç¨å°ä¸åç±»ï¼èè¿ä¸ªä¸¤ä¸ªç±»çåç§°æ¯ä¸æ ·çï¼é£ä¹é»è®¤åªè½å¯¼å¥ä¸ä¸ªç±»ï¼å¦ä¸ä¸ªç±»è¦å¸¦ååè®¿é®\n\n\n# 2. æéä¿®é¥°ç¬¦\n\n\n# 2.1 ä»ä¹æ¯æéä¿®é¥°ç¬¦ï¼\n\n * ç¨æ¥æ§å¶ä¸ä¸ªæåè½å¤è¢«è®¿é®çèå´çã\n\n * å¯ä»¥ä¿®é¥°æååéãæ¹æ³ãæé å¨ãåé¨ç±»ï¼ä¸åæéä¿®é¥°ç¬¦ä¿®é¥°çæåè½å¤è¢«è®¿é®çèå´å°åå°éå¶ã\n\n\n# 2.2 æéä¿®é¥°ç¬¦çåç±»åä½ç¨èå´\n\nåç§ä½ç¨èå´ç±å°å°å¤§ä¸ºï¼private -> ç¼ºç -> protected - > public\n\nç¼ºçä¸ºåè®¿é®æéã\n\nä¿®é¥°ç¬¦         åä¸ä¸ªç±»ä¸­   åä¸ä¸ªåä¸­ å¶ä»ç±»   ä¸ååä¸ç å­ç±»   ä¸ååä¸ç æ å³ç±»\nprivate     â                              \nç¼ºç          â       â                      \nprotected   â       â           â          \npublic      â       â           â          â\n\n\n# 2.3 æéä¿®é¥°ç¬¦çä½¿ç¨\n\nèªå·±å®ä¹æåï¼æ¹æ³ï¼æååéï¼æé å¨ç­ï¼ä¸è¬æ»¡è¶³å¦ä¸è¦æ±ï¼\n\n * æååéä¸è¬ç§æã\n * æ¹æ³ä¸è¬å¬å¼ã\n * å¦æè¯¥æååªå¸ææ¬ç±»è®¿é®ï¼ä½¿ç¨ private ä¿®é¥°ã\n * å¦æè¯¥æååªå¸ææ¬ç±»ãåä¸ä¸ªåä¸çå¶ä»ç±»åå­ç±»è®¿é®ï¼ä½¿ç¨ protected ä¿®é¥°ã\n   * å­ç±»è®¿é®æ¯è¯´ï¼è¦å¨å­ç±»ä¸­ç¨å­ç±»å¯¹è±¡è®¿é®ï¼ç¨ç¶ç±»å¯¹è±¡è®¿é®è¿æ¯ä¼æ¥éçã\n\n\n# 3. final å³é®å­åå¸¸éãæä¸¾\n\n\n# 3.1 final å³é®å­\n\n * å¯ä»¥ä¿®é¥° æ¹æ³ï¼åéï¼ç±»\n   \n   * ä¿®é¥°æ¹æ³ï¼è¡¨æè¯¥æ¹æ³æ¯æç»æ¹æ³ï¼ä¸è½è¢«éå\n   * ä¿®é¥°åéï¼è¡¨ç¤ºè¯¥åéç¬¬ä¸æ¬¡èµå¼åï¼ä¸è½åæ¬¡è¢«èµå¼(æä¸ä»è½è¢«èµå¼ä¸æ¬¡)\n     * final ä¿®é¥°å®ä¾æååéï¼å ä¹ä¸ç¨ãå ä¸ºå®ä¾æååéå±äºå¯¹è±¡ï¼å½ä»æå®ä¹åï¼è¡¨ç¤ºæ¯ä¸ªå¯¹è±¡çè¿ä¸ªæååéé½æ¯åºå®çäºï¼æ²¡æä¹ã\n     * final ä¿®é¥°éææååéï¼è¯¥åéå°±åæäºå¸¸éã\n   * ä¿®é¥°ç±»ï¼è¡¨æè¯¥ç±»æ¯æç»ç±»ï¼ä¸è½è¢«ç»§æ¿ <è¢«ç»è²äºï¼ï¼>\n     * æ¯å¦å·¥å·ç±»ï¼å°±å¯ä»¥ç¨ final ä¿®é¥°ï¼å·¥å·ç±»å°±ä¸è¦ç»§æ¿å¦ï¼ä½ æ¿æ¥ç´æ¥ç¨å°±è¡å¦~\n\n * final ä¿®é¥°åéçæ³¨æ\n   \n   * final ä¿®é¥°çåéæ¯åºæ¬ç±»åï¼é£ä¹åéå­å¨çæ°æ®å¼ä¸è½åçæ¹å\n   * final ä¿®é¥°çåéæ¯å¼ç¨ç±»åï¼é£ä¹åéå­å¨çå°åå¼ä¸è½åçæ¹åï¼ä½æ¯å°åæåçå¯¹è±¡åå®¹æ¯å¯ä»¥åçååç\n     * è¿ä¸ªå°åå°±ç¸å½äºé¥åï¼é¥åä¸è½åäºï¼ä½å®¶éæ¯å¯ä»¥ååçã\n     * å³å½ t æåäºä¸ä¸ªå¯¹è±¡æ¶ï¼t=null æ¯ä¸åæ³çï¼ä½ t æåçåå®¹ä¸­çæååéå¼æ¯å¯ä»¥ååçã\n\n\n# 3.2 å¸¸é\n\n# 3.2.1 å¸¸éæ¦è¿°ååºæ¬ä½ç¨\n\n * å¥æ¯å¸¸é\n   * å¸¸éæ¯ä½¿ç¨äº public static final ä¿®é¥°çæååéï¼å¿é¡»æåå§åå¼ï¼èä¸æ§è¡çè¿ç¨ä¸­å¶å¼ä¸è½è¢«æ¹å\n   * å¸¸éçä½ç¨åå¥½å¤ï¼å¯ä»¥ç¨äºåç³»ç»çéç½®ä¿¡æ¯ï¼æ¹ä¾¿ç¨åºçç»´æ¤ï¼åæ¶ä¹è½æé«å¯è¯»æ§\n * å¸¸éå½åè§è\n   * è±æåè¯å¨é¨å¤§åï¼å¤ä¸ªåè¯ä¸åçº¿è¿æ¥èµ·æ¥\n * å¸¸éçæ§è¡åç\n   * å¨ç¼è¯é¶æ®µä¼è¿è¡âå®æ¿æ¢âï¼æä½¿ç¨å¸¸éçå°æ¹å¨é¨æ¿æ¢æçå®çå­é¢é\n   * è¿æ ·åçå¥½å¤æ¯è®©ä½¿ç¨å¸¸éçç¨åºçæ§è¡æ§è½ä¸ç´æ¥ä½¿ç¨å­é¢éæ¯ä¸æ ·ç\n\n# 3.2.2 å¸¸éåä¿¡æ¯æ å¿ååç±»\n\næ¡ä¾ï¼å¼åè¶çº§çä¸½æ¸¸æéè¦æ¥æ¶ç¨æ·è¾å¥çåä¸ªæ¹åçä¿¡å·ï¼ä¸ä¸å·¦å³ï¼ï¼ä»¥ä¾¿æ§å¶çä¸½ç§»å¨çæ¹å\n\nå®ç°ï¼ç¨ UP=1, DOWN=2, LEFT=3, RIGHT=4 åå«è¡¨ç¤ºåç§å¨ä½ï¼è°ç¨ç§»å¨å½æ° move() æ¶ï¼å°±å¯ä»¥ç´æ¥ä¼  UP ç­å¸¸éè¿æ¥ï¼èä¸æ¯ä¼  1ï¼ 2.... è¿æ¥ï¼ä»£ç å¯è¯»æ§æ´å¥½ã\n\nç¨å¸¸éåä¿¡æ¯æ å¿ååç±»ï¼ä»£ç å¯è¯»æ§å¥½ï¼å®ç°äºè½¯ç¼ç å½¢å¼\n\nâ ï¸ ç¨å¸¸éåä¿¡æ¯æ å¿ä¸æ¯å¾å¥½ï¼ç¨æä¸¾ä¼æ´å¥½\n\n\n# 3.3 æä¸¾\n\n# 3.3.1 æä¸¾çæ¦è¿°\n\n * æä¸¾æ¯ Java ä¸­çä¸ç§ç¹æ®ç±»å\n\n * æä¸¾çä½ç¨ï¼"æ¯ä¸ºäºåä¿¡æ¯çæ å¿åä¿¡æ¯çåç±»"\n\n * å®ä¹æä¸¾çæ ¼å¼ï¼\n   \n   * ä¿®é¥°ç¬¦ enum æä¸¾åç§°{\n      \tç¬¬ä¸è¡é½æ¯ç½åæä¸¾ç±»å®ä¾çåç§°ã\n     }\n     \n     \n     1\n     2\n     3\n     \n   \n   * ä¾ï¼\n     \n     enum Season{\n         SPRING , SUMMER , AUTUMN , WINTER;\n     }\n     \n     \n     1\n     2\n     3\n     \n     \n     åç¼è¯åçç»æï¼\n     \n     Compiled from "Season.java"\n         public final class Season extends java.lang.Enum<Season> {\n             public static final Season SPRING = new Season();\n             public static final Season SUMMER = new Season();\n             public static final Season AUTUMN = new Season();\n             public static final Season WINTER = new Season();\n             public static Season[] values();\n             public static Season valueOf(java.lang.String);\n     \n         }\n     \n     \n     1\n     2\n     3\n     4\n     5\n     6\n     7\n     8\n     9\n     10\n     \n   \n   * å¶å®å°±æ¯ææ®éç±»å®ä¹ä¸­ç class æ¢æäº enumï¼ä¹å¯ä»¥å æéä¿®é¥°ç¬¦\n\n * æä¸¾çç¹å¾\n   \n   * æä¸¾ç±»é½æ¯ç»§æ¿äºæä¸¾ç±»åï¼java.lang.Enum\n   * æä¸¾é½æ¯æç»ç±»ï¼ä¸å¯ä»¥è¢«ç»§æ¿\n   * â ï¸ æé å¨é½æ¯ç§æçï¼æä¸¾å¯¹å¤ä¸è½åå»ºå¯¹è±¡\n   * æä¸¾ç±»çç¬¬ä¸è¡é»è®¤ç½åæä¸¾å¯¹è±¡çåç§°\n   * æä¸¾ç±»ç¸å½äºå¤ä¾æ¨¡å¼\n     * å¯¹å¤ä¸è½ååå»ºå¯¹è±¡äºï¼èåé¨å·²ç»åå»ºäºåä¸ªå¯¹è±¡\n\n# 3.3.2 æä¸¾çä½¿ç¨åºæ¯\n\næ¡ä¾ï¼å¼åè¶çº§çä¸½æ¸¸æ\n\n * éæ©å¸¸éåä¿¡æ¯æ å¿ååç±»ï¼\n   * è½ç¶å¯ä»¥å®ç°å¯è¯»æ§ï¼ä½æ¯å¥åå¼ä¸åçº¦æï¼ä»£ç ç¸å¯¹ä¸å¤ä¸¥è°¨ãï¼å®ä¹äº UP=1ï¼æä¹å¯ä»¥ä¸ç¨ UPï¼å°±éå¾ç¨ 1ï¼æ­¤æ¶ä¹æ¯å¯ä»¥çãæèæç¨ä¸åæ³çæ°å¼ä½ä¸ºåæ°ï¼ä¹æ²¡ææ ¡éªï¼\n * æä¸¾åä¿¡æ¯æ å¿ååç±»ï¼\n   * ä»£ç å¯è¯»æ§å¥½ï¼å¥åçº¦æä¸¥è°¨ï¼ä»£ç ä¼éï¼æ¯æå¥½çä¿¡æ¯åç±»ææ¯ï¼å»ºè®®ä½¿ç¨ï¼\n\n\n# 4. æ½è±¡ç±»\n\n\n# 4.1 æ½è±¡ç±»æ¦è¿°\n\nè¥ä¸ä¸ªç±»ä¸­çæä¸ªæ¹æ³çå·ä½å®ç°ä¸è½ç¡®å®ï¼å°±å¯ä»¥ç³ææ abstract ä¿®é¥°çæ½è±¡æ¹æ³ï¼ä¸è½åæ¹æ³ä½äºï¼ï¼å¯¹åºçç±»ä¹å¿é¡»ç¨ abstract ä¿®é¥°ï¼è¢«ç§°ä¸ºæ½è±¡ç±»ã\n\nç¤ºä¾ä»£ç ï¼\n\npublic abstract class Animal{\n    public abstract void run();\n}\n\n\n1\n2\n3\n\n * æ½è±¡ç±»çä½ç¨ï¼\n   * å¯ä»¥è¢«å­ç±»ç»§æ¿ãåå½æ¨¡æ¿ï¼åæ¶ä¹å¯ä»¥æé«ä»£ç å¤ç¨\n * æ½è±¡ç±»çæ³¨æäºé¡¹ï¼\n   * ä¸ä¸ªç±»å¦æç»§æ¿äºæ½è±¡ç±»ï¼é£ä¹è¿ä¸ªç±»å¿é¡»éåå®æ½è±¡ç±»çå¨é¨æ½è±¡æ¹æ³ï¼å¦åè¿ä¸ªç±»ä¹å¿é¡»å®ä¹ææ½è±¡ç±»ã\n\n\n# 4.2 æ½è±¡ç±»çæ¡ä¾\n\nç³»ç»éæ±ï¼\n\nå æ²¹ç«æ¨åºä¸¤ç§æ¯ä»å¡ï¼éå¡åé¶å¡ï¼äº«åä¸åçææä¼æ ï¼éå¡8æï¼é¶å¡8.5æãåå«å®ç°2ç§å¡çè¿å¥æ¶é¶ç³»ç»åçé»è¾ï¼å¡çéè¦åå«ä¸»äººåç§°ï¼ä½é¢ï¼æ¯ä»åè½ã\n\nåæå®ç°ï¼\n\nåå»ºä¸å¼ å¡çç¶ç±»ï¼å®ä¹å±æ§åæ¬ä¸»äººåç§°ãä½é¢ãæ¯ä»åè½ï¼å·ä½å®ç°äº¤ç»å­ç±»ï¼\n\nåå»ºä¸å¼ ç½éå¡ç±»ï¼éåæ¯ä»åè½ï¼æç§åä»·ç8æè®¡ç®è¾åºã\n\nåå»ºä¸å¼ é¶å¡ç±»ï¼éåæ¯ä»åè½ï¼æç§åä»·ç8.5æè®¡ç®è¾åºã\n\næ½è±¡ç±»çç¹å¾åæ³¨æäºé¡¹\n\n * æå¾æå¤±: å¾å°äºæ½è±¡æ¹æ³ï¼å¤±å»äºåå»ºå¯¹è±¡çè½å\n   * å³ï¼æ½è±¡ç±»ä¸è½åå»ºå¯¹è±¡\n   * åå ï¼\n     * è¥è½å¤åå»ºå¯¹è±¡ï¼åè°ç¨å¶ä¸­çæ½è±¡æ¹æ³æ æ³æ­£å¸¸è¿è¡ï¼è¿æ¹æ³ä½é½æ²¡æï¼\n     * åªæè¿ä¸ªæ½è±¡ç±»ä¸­æ²¡ææ½è±¡æ¹æ³ï¼ä¹ä¸è½å®ä¾å\n * ç±»æçæåï¼æååéãæ¹æ³ãæé å¨ï¼æ½è±¡ç±»é½å·å¤\n * æ½è±¡ç±»ä¸­ä¸ä¸å®ææ½è±¡æ¹æ³ï¼ææ½è±¡æ¹æ³çç±»ä¸å®æ¯æ½è±¡ç±»\n * ä¸ä¸ªç±»ç»§æ¿äºæ½è±¡ç±»å¿é¡»éåå®æ½è±¡ç±»çå¨é¨æ½è±¡æ¹æ³ï¼å¦åè¿ä¸ªç±»ä¹å¿é¡»å®ä¹ææ½è±¡ç±»\n   * ä¸è¬ä¸å±å±æ½è±¡ä½¿ç¨\n * ä¸è½ç¨abstractä¿®é¥°åéãä»£ç åãæé å¨ï¼åªè½ç¨æ¥ä¿®é¥°ç±»åæ¹æ³\n\nfinal å abstract çå³ç³»\n\nfinal å abstract ä¸º**äºæ¥å³ç³»**ï¼\n\n * abstract å®ä¹çæ½è±¡ç±»ä½ä¸ºæ¨¡æ¿è®©å­ç±»ç»§æ¿ï¼finalå® ä¹çç±»ä¸è½è¢«ç»§æ¿\n * æ½è±¡æ¹æ³å®ä¹éç¨åè½è®©å­ç±»éåï¼final å®ä¹çæ¹æ³å­ç±»ä¸è½éå\n\n\n# 4.3 è®¾è®¡æ¨¡å¼ï¼æ¨¡æ¿æ¹æ³æ¨¡å¼\n\næ¨¡æ¿æ¹æ³æ¨¡å¼ä¸ºæ½è±¡ç±»çåºç¨ã\n\n# 4.3.1 æ¨¡æ¿æ¹æ³æ¨¡å¼çä½¿ç¨åºæ¯\n\nå½ç³»ç»ä¸­åºç°åä¸ä¸ªåè½å¤å¤å¨å¼åï¼èè¯¥åè½ä¸­å¤§é¨åä»£ç æ¯ä¸æ ·çï¼åªæå¶ä¸­é¨åå¯è½ä¸åçæ¶åï¼éå¸¸ç¨æ¨¡æ¿æ¹æ³æ¨¡å¼ã\n\n# 4.3.2 æ¨¡æ¿æ¹æ³æ¨¡å¼çå®ç°æ­¥éª¤\n\n * æåè½å®ä¹æä¸ä¸ªæè°çæ¨¡æ¿æ¹æ³ï¼æ¾å¨æ½è±¡ç±»ä¸­ï¼æ¨¡æ¿æ¹æ³ä¸­åªå®ä¹éç¨ä¸è½ç¡®å®çä»£ç ï¼ä¸ä¸ªéç¨ç»æï¼\n * æ¨¡æ¿æ¹æ³ä¸­ä¸è½å³å®çåè½å®ä¹ææ½è±¡æ¹æ³è®©å·ä½å­ç±»å»å®ç°\n\n# 4.3.3 æ¡ä¾ï¼ä¸­å°å­¦çåä½æ\n\néæ±ï¼ä¸­ãå°å­¦çé½è¦åãæçç¸ç¸ãï¼æ¯ç±»å­¦ççæ é¢ãç¬¬ä¸æ®µãæåä¸æ®µçåå®¹å¿é¡»ä¸æ ·ï¼æ­£æèªå·±åæ¥ã\n\nè§£å³ï¼ç¶ç±»å®ä¹ä¸ºæ½è±¡æ¹æ³ï¼å°å±åé¨åå®ç°ï¼å©ä¸çæ­£æä¹¦åé¨åå®ä¹ä¸ºæ½è±¡æ¹æ³ï¼è®©å­ç±»å»å®ç°ã\n\næ¨¡æ¿æ¹æ³å»ºè®®ä½¿ç¨ final ä¿®é¥°ï¼æ´ä¸ä¸ï¼åå ï¼\n\næ¨¡æ¿æ¹æ³æ¯ç»å­ç±»ç´æ¥ä½¿ç¨çï¼ä¸æ¯è®©å­ç±»éåçï¼ä¸æ¦å­ç±»éåäºæ¨¡æ¿æ¹æ³å°±å¤±æäºã\n\nä½¿ç¨èåªéè¦å³å¿èªå·±éè¦å®ç°çåè½å³å¯ã\n\nå¦ï¼ä¸å¾ä¸­ï¼ç¨ final ä¿®é¥°æ¨¡æ¿æ¹æ³ writeï¼é²æ­¢å­ç±»å¯¹å¶éåã\n\n\n\n\n# 5. æ¥å£\n\n\n# 5.1 æ¥å£çæ¦è¿°åç¹ç¹\n\n# 5.1.1 å¥æ¯æ¥å£\n\n * æ¥å£æ¯ä¸ç§è§èï¼è§èä¸å®æ¯å¬å¼ç\n\n * æ¯ä¸ç§ç¹æ®çæ½è±¡ç±»\n\n * å³é®å­ï¼interface\n\n * å®ä¹æ ¼å¼ï¼\n   \n   public interface æ¥å£å {\n          // å¸¸é\n          // æ½è±¡æ¹æ³\n   }\n   \n   \n   1\n   2\n   3\n   4\n   \n\n# 5.1.2 æ¥å£çç¹ç¹\n\n * æ¯ä¸ç§ç¹æ®çæ½è±¡ç±»\n * é»è®¤æ¯å¬å¼ç\n * JDK8 ä¹åæ¥å£ä¸­åªè½æ¯æ½è±¡æ¹æ³åå¸¸éï¼æ²¡æå¶ä»æåäºã\n   * è¥æå¶ä»ä¸è¥¿ï¼å°±åææ®éçæ½è±¡ç±»äº\n * æ¥å£ä¸è½å®ä¾åã\n * æ¥å£ä¸­çæåé½æ¯ public ä¿®é¥°çï¼åä¸åé½æ¯ï¼å ä¸ºè§èçç®çæ¯ä¸ºäºå¬å¼åã\n   * æååéå¯ä»¥çç¥ public staticï¼ä¹æ¯é»è®¤å¬å¼ç\n   * æåæ¹æ³ç´æ¥ä¸å public å¸¸ç¨\n\n\n# 5.2 æ¥å£çåºæ¬ä½¿ç¨ï¼è¢«å®ç°\n\næ¥å£æ¯ç¨æ¥è¢«ç±»å®ç°ï¼implementsï¼çï¼å®ç°æ¥å£çç±»ç§°ä¸º**å®ç°ç±»**ãå®ç°ç±»å¯ä»¥çè§£ææè°çå­ç±»ã\n\nç¤ºä¾ï¼\n\nä¿®é¥°ç¬¦ class å®ç°ç±» implements æ¥å£1, æ¥å£2, æ¥å£3 , ... {\n}\n\n\n1\n2\n\n\næ¥å£å¯ä»¥è¢«ç±»åå®ç°ï¼ä¹å¯ä»¥è¢«ç±»å¤å®ç°ã\n\nâ ï¸ ä¸ä¸ªç±»å®ç°æ¥å£ï¼å¿é¡»éåå®å¨é¨æ¥å£çå¨é¨æ½è±¡æ¹æ³ï¼å¦åè¿ä¸ªç±»éè¦å®ä¹ææ½è±¡ç±»\n\ninterface VS abstract\n\n * æ¥å£æ²¡å¯¹è±¡\n\n * æ¥å£å¯ä»¥å¤å®ç°ï¼implementsï¼\n\n * æ½è±¡ç±»ä¸ä¸ªå¿å­åªè½æä¸ä¸ªäº²ç¸ï¼å¯ä»¥æå¤ä¸ªå¿å­æåä¸ä¸ªäº²ç¸\n\n * æ¥å£ä¸ä¸ªå¿å­å¯ä»¥æå¤ä¸ªå¹²ç¹\n\næç¤º\n\n * ç±»åç±»çå³ç³»ï¼åç»§æ¿\n * ç±»åæ¥å£çå³ç³»ï¼å¤å®ç°\n * æ¥å£åæ¥å£çå³ç³»ï¼å¤ç»§æ¿ï¼ä¸ä¸ªæ¥å£å¯ä»¥åæ¶ç»§æ¿å¤ä¸ªæ¥å£\n   * ä½ç¨ï¼è§èåå¹¶ï¼æ´åå¤ä¸ªæ¥å£ä¸ºåä¸ä¸ªæ¥å£ï¼ä¾¿äºå­ç±»å®ç°\n   * ä¾å¦ï¼ç¯®çè¿å¨åè¦å®ç°è¿å¨åãéµçºªå®æ³ãäººçæ¥å£ï¼å¨å®ä¹è¿ä¸ªç±»æ¶éè¦å¯¹å¤ä¸ªæ¥å£è¿è¡å®ç°ï¼ä½è¥æå¦å¨åæ¥å£å·²ç»å¤ç»§æ¿äºéµçºªå®æ³ãäººçæ¥å£æ¶ï¼ç¯®çè¿å¨åå°±å¯ä»¥åªå®ç°è¿å¨åæ¥å£äº\n\n\n# 5.3 JDK8 å¼å§æ¥å£æ°å¢æ¹æ³\n\nJDK8 çæ¬å¼å§åï¼Java å¯¹æ¥å£çæåæ¹æ³è¿è¡äºæ°å¢ã\n\nåå ï¼\n\nå½é¡¹ç® 1.0 æåä¸çº¿æ²¡é®é¢ä¹åï¼ 2.0 çæ¬éè¦å¯¹æä¸ªæ¥å£è¿è¡ä¸°å¯ï¼å å¥æ´å¤æ½è±¡æ¹æ³ï¼æ­¤æ¶ï¼å¦æä¿®æ¹è¿ä¸ªæ¥å£ï¼å°±æå³çæ­¤æ¥å£çææå®ç°ç±»é½è¦å»å®ç°ææçè¿äºæ¹æ³ï¼è¿äºå®ç°ç±»é½éè¦åå»ä¿®æ¹ä»£ç ã\n\né®é¢æ¥å¦ï¼ åå°±è½å¨ä¸°å¯æ¥å£åè½çåæ¶åä¸å¯¹å­ç±»ä»£ç è¿è¡æ´æ¹å¢ï¼ï¼\n\nââsolveï¼åè®¸æ¥å£ä¸­ç´æ¥å®ä¹å¸¦ææ¹æ³ä½çæ¹æ³ï¼æJDK8 ä¹åæ°å¢çæ¹æ³æï¼é»è®¤æ¹æ³ãéææ¹æ³ãç§ææ¹æ³ä¸ç§ï¼ä»ä»¬é½ä¼é»è®¤è¢« public ä¿®é¥°ã\n\n# 5.3.1 é»è®¤æ¹æ³\n\næ¬è´¨ä¸å°±æ¯ä¹åæå°çæ®éå®ä¾æ¹æ³ï¼å¿é¡»æ default ä¿®é¥°ã\n\né»è®¤ä¼ public ä¿®é¥°ã\n\nâ ï¸ éè¦ç¨æ¥å£çå®ç°ç±»çå¯¹è±¡æ¥è°ç¨ã\n\n# 5.3.2 éææ¹æ³\n\nå¿é¡» static ä¿®é¥°ï¼é»è®¤ä¼ public ä¿®é¥°ã\n\nâ ï¸ æ³¨æï¼æ¥å£çéææ¹æ³å¿é¡»ç¨æ¬èº«çæ¥å£åæ¥è°ç¨ã\n\n# 5.3.3 ç§ææ¹æ³\n\næ¬è´¨å°±æ¯ç§æçå®ä¾æ¹æ³ï¼å¿é¡»ä½¿ç¨ private ä¿®é¥°ï¼ä» JDK 1.9 æå¼å§æçã\n\nåªè½å¨**æ¬ç±»ä¸­ï¼æ¬æ¥å£ä¸­ï¼**è¢«å¶ä»çé»è®¤æ¹æ³æèç§ææ¹æ³è®¿é®ã\n\nâ ï¸ åªè½å¨æ¥å£åé¨è¢«è°ç¨ã\n\n> heimaï¼JDK8 æ°å¢ç 3 ç§æ¹æ³æä»¬èªå·±å¨å¼åä¸­å¾å°ä½¿ç¨ï¼éå¸¸æ¯ Java æºç æ¶åå°çï¼æä»¬éè¦çè§£ãè¯å«è¯­æ³ãæç½è°ç¨å³ç³»å³å¯ã\n\næ¥å£çæ³¨æäºé¡¹\n\n1ãæ¥å£ä¸è½åå»ºå¯¹è±¡ã\n\n2ãä¸ä¸ªç±»å®ç°å¤ä¸ªæ¥å£ï¼å¤ä¸ªæ¥å£ä¸­æåæ ·çéææ¹æ³ä¸å²çªã\n\nå ä¸ºæ¥å£çéææ¹æ³åªè½ç¨æ¥å£æ¬èº«æ¥è°ç¨ã\n\n3ãä¸ä¸ªç±»ç»§æ¿äºç¶ç±»ï¼åæ¶åå®ç°äºæ¥å£ï¼ç¶ç±»ä¸­åæ¥å£ä¸­æååæ¹æ³ï¼é»è®¤ç¨ç¶ç±»çã\n\nç¶ç±»æ¯äº²ç¸ï¼æ¥å£æ¯å¹²ç¹ã\n\nä¸ä¸ª class è¦å extends åimplementsã\n\n4ãä¸ä¸ªç±»å®ç°äºå¤ä¸ªæ¥å£ï¼å¤ä¸ªæ¥å£ä¸­å­å¨ååçé»è®¤æ¹æ³ï¼ä¸å²çªï¼è¿ä¸ªç±»éåè¯¥æ¹æ³å³å¯ã\n\n5ãä¸ä¸ªæ¥å£ç»§æ¿å¤ä¸ªæ¥å£ï¼æ¯æ²¡æé®é¢çï¼å¦æå¤ä¸ªæ¥å£ä¸­å­å¨è§èå²çªåä¸è½å¤ç»§æ¿ã',normalizedContent:'# é¢åå¯¹è±¡è¿é¶2ï¼åãæéä¿®é¥°ç¬¦ãæ½è±¡ç±»ãæ¥å£ï¼\n\n\n# 1. å\n\n\n# 1.1 ä»ä¹æ¯å\n\n * åæ¯ç¨æ¥åé¨å«ç±»çç®¡çåç§ä¸åç±»çï¼ç±»ä¼¼äºæä»¶å¤¹ãå»ºåå©äºç¨åºçç®¡çåç»´æ¤\n\n * å»ºåçè¯­æ³æ ¼å¼ï¼package å¬å¸åååå.ææ¯åç§°ãæ¥åå»ºè®®å¨é¨è±æå°åï¼ä¸å·å¤æä¹\n   \n   å¦ï¼\n   \n   package com.itheima.javabean;\n   public class student {\n          \n   }\n   \n   \n   \n   1\n   2\n   3\n   4\n   5\n   \n\n * å»ºåè¯­å¥å¿é¡»å¨ç¬¬ä¸è¡ï¼ä¸è¬ideaå·¥å·ä¼å¸®å©åå»º\n\n\n# 1.2 å¯¼å\n\n * ç¸ååä¸çç±»å¯ä»¥ç´æ¥è®¿é®ï¼ä¸ååä¸çç±»å¿é¡»å¯¼åï¼æå¯ä»¥ä½¿ç¨ï¼\n\n * å¯¼åæ ¼å¼ï¼import åå.ç±»å\n\n * è¥ä¸ä¸ªç±»ä¸­è¦ç¨å°ä¸åç±»ï¼èè¿ä¸ªä¸¤ä¸ªç±»çåç§°æ¯ä¸æ ·çï¼é£ä¹é»è®¤åªè½å¯¼å¥ä¸ä¸ªç±»ï¼å¦ä¸ä¸ªç±»è¦å¸¦ååè®¿é®\n\n\n# 2. æéä¿®é¥°ç¬¦\n\n\n# 2.1 ä»ä¹æ¯æéä¿®é¥°ç¬¦ï¼\n\n * ç¨æ¥æ§å¶ä¸ä¸ªæåè½å¤è¢«è®¿é®çèå´çã\n\n * å¯ä»¥ä¿®é¥°æååéãæ¹æ³ãæé å¨ãåé¨ç±»ï¼ä¸åæéä¿®é¥°ç¬¦ä¿®é¥°çæåè½å¤è¢«è®¿é®çèå´å°åå°éå¶ã\n\n\n# 2.2 æéä¿®é¥°ç¬¦çåç±»åä½ç¨èå´\n\nåç§ä½ç¨èå´ç±å°å°å¤§ä¸ºï¼private -> ç¼ºç -> protected - > public\n\nç¼ºçä¸ºåè®¿é®æéã\n\nä¿®é¥°ç¬¦         åä¸ä¸ªç±»ä¸­   åä¸ä¸ªåä¸­ å¶ä»ç±»   ä¸ååä¸ç å­ç±»   ä¸ååä¸ç æ å³ç±»\nprivate     â                              \nç¼ºç          â       â                      \nprotected   â       â           â          \npublic      â       â           â          â\n\n\n# 2.3 æéä¿®é¥°ç¬¦çä½¿ç¨\n\nèªå·±å®ä¹æåï¼æ¹æ³ï¼æååéï¼æé å¨ç­ï¼ä¸è¬æ»¡è¶³å¦ä¸è¦æ±ï¼\n\n * æååéä¸è¬ç§æã\n * æ¹æ³ä¸è¬å¬å¼ã\n * å¦æè¯¥æååªå¸ææ¬ç±»è®¿é®ï¼ä½¿ç¨ private ä¿®é¥°ã\n * å¦æè¯¥æååªå¸ææ¬ç±»ãåä¸ä¸ªåä¸çå¶ä»ç±»åå­ç±»è®¿é®ï¼ä½¿ç¨ protected ä¿®é¥°ã\n   * å­ç±»è®¿é®æ¯è¯´ï¼è¦å¨å­ç±»ä¸­ç¨å­ç±»å¯¹è±¡è®¿é®ï¼ç¨ç¶ç±»å¯¹è±¡è®¿é®è¿æ¯ä¼æ¥éçã\n\n\n# 3. final å³é®å­åå¸¸éãæä¸¾\n\n\n# 3.1 final å³é®å­\n\n * å¯ä»¥ä¿®é¥° æ¹æ³ï¼åéï¼ç±»\n   \n   * ä¿®é¥°æ¹æ³ï¼è¡¨æè¯¥æ¹æ³æ¯æç»æ¹æ³ï¼ä¸è½è¢«éå\n   * ä¿®é¥°åéï¼è¡¨ç¤ºè¯¥åéç¬¬ä¸æ¬¡èµå¼åï¼ä¸è½åæ¬¡è¢«èµå¼(æä¸ä»è½è¢«èµå¼ä¸æ¬¡)\n     * final ä¿®é¥°å®ä¾æååéï¼å ä¹ä¸ç¨ãå ä¸ºå®ä¾æååéå±äºå¯¹è±¡ï¼å½ä»æå®ä¹åï¼è¡¨ç¤ºæ¯ä¸ªå¯¹è±¡çè¿ä¸ªæååéé½æ¯åºå®çäºï¼æ²¡æä¹ã\n     * final ä¿®é¥°éææååéï¼è¯¥åéå°±åæäºå¸¸éã\n   * ä¿®é¥°ç±»ï¼è¡¨æè¯¥ç±»æ¯æç»ç±»ï¼ä¸è½è¢«ç»§æ¿ <è¢«ç»è²äºï¼ï¼>\n     * æ¯å¦å·¥å·ç±»ï¼å°±å¯ä»¥ç¨ final ä¿®é¥°ï¼å·¥å·ç±»å°±ä¸è¦ç»§æ¿å¦ï¼ä½ æ¿æ¥ç´æ¥ç¨å°±è¡å¦~\n\n * final ä¿®é¥°åéçæ³¨æ\n   \n   * final ä¿®é¥°çåéæ¯åºæ¬ç±»åï¼é£ä¹åéå­å¨çæ°æ®å¼ä¸è½åçæ¹å\n   * final ä¿®é¥°çåéæ¯å¼ç¨ç±»åï¼é£ä¹åéå­å¨çå°åå¼ä¸è½åçæ¹åï¼ä½æ¯å°åæåçå¯¹è±¡åå®¹æ¯å¯ä»¥åçååç\n     * è¿ä¸ªå°åå°±ç¸å½äºé¥åï¼é¥åä¸è½åäºï¼ä½å®¶éæ¯å¯ä»¥ååçã\n     * å³å½ t æåäºä¸ä¸ªå¯¹è±¡æ¶ï¼t=null æ¯ä¸åæ³çï¼ä½ t æåçåå®¹ä¸­çæååéå¼æ¯å¯ä»¥ååçã\n\n\n# 3.2 å¸¸é\n\n# 3.2.1 å¸¸éæ¦è¿°ååºæ¬ä½ç¨\n\n * å¥æ¯å¸¸é\n   * å¸¸éæ¯ä½¿ç¨äº public static final ä¿®é¥°çæååéï¼å¿é¡»æåå§åå¼ï¼èä¸æ§è¡çè¿ç¨ä¸­å¶å¼ä¸è½è¢«æ¹å\n   * å¸¸éçä½ç¨åå¥½å¤ï¼å¯ä»¥ç¨äºåç³»ç»çéç½®ä¿¡æ¯ï¼æ¹ä¾¿ç¨åºçç»´æ¤ï¼åæ¶ä¹è½æé«å¯è¯»æ§\n * å¸¸éå½åè§è\n   * è±æåè¯å¨é¨å¤§åï¼å¤ä¸ªåè¯ä¸åçº¿è¿æ¥èµ·æ¥\n * å¸¸éçæ§è¡åç\n   * å¨ç¼è¯é¶æ®µä¼è¿è¡âå®æ¿æ¢âï¼æä½¿ç¨å¸¸éçå°æ¹å¨é¨æ¿æ¢æçå®çå­é¢é\n   * è¿æ ·åçå¥½å¤æ¯è®©ä½¿ç¨å¸¸éçç¨åºçæ§è¡æ§è½ä¸ç´æ¥ä½¿ç¨å­é¢éæ¯ä¸æ ·ç\n\n# 3.2.2 å¸¸éåä¿¡æ¯æ å¿ååç±»\n\næ¡ä¾ï¼å¼åè¶çº§çä¸½æ¸¸æéè¦æ¥æ¶ç¨æ·è¾å¥çåä¸ªæ¹åçä¿¡å·ï¼ä¸ä¸å·¦å³ï¼ï¼ä»¥ä¾¿æ§å¶çä¸½ç§»å¨çæ¹å\n\nå®ç°ï¼ç¨ up=1, down=2, left=3, right=4 åå«è¡¨ç¤ºåç§å¨ä½ï¼è°ç¨ç§»å¨å½æ° move() æ¶ï¼å°±å¯ä»¥ç´æ¥ä¼  up ç­å¸¸éè¿æ¥ï¼èä¸æ¯ä¼  1ï¼ 2.... è¿æ¥ï¼ä»£ç å¯è¯»æ§æ´å¥½ã\n\nç¨å¸¸éåä¿¡æ¯æ å¿ååç±»ï¼ä»£ç å¯è¯»æ§å¥½ï¼å®ç°äºè½¯ç¼ç å½¢å¼\n\nâ ï¸ ç¨å¸¸éåä¿¡æ¯æ å¿ä¸æ¯å¾å¥½ï¼ç¨æä¸¾ä¼æ´å¥½\n\n\n# 3.3 æä¸¾\n\n# 3.3.1 æä¸¾çæ¦è¿°\n\n * æä¸¾æ¯ java ä¸­çä¸ç§ç¹æ®ç±»å\n\n * æä¸¾çä½ç¨ï¼"æ¯ä¸ºäºåä¿¡æ¯çæ å¿åä¿¡æ¯çåç±»"\n\n * å®ä¹æä¸¾çæ ¼å¼ï¼\n   \n   * ä¿®é¥°ç¬¦ enum æä¸¾åç§°{\n      \tç¬¬ä¸è¡é½æ¯ç½åæä¸¾ç±»å®ä¾çåç§°ã\n     }\n     \n     \n     1\n     2\n     3\n     \n   \n   * ä¾ï¼\n     \n     enum season{\n         spring , summer , autumn , winter;\n     }\n     \n     \n     1\n     2\n     3\n     \n     \n     åç¼è¯åçç»æï¼\n     \n     compiled from "season.java"\n         public final class season extends java.lang.enum<season> {\n             public static final season spring = new season();\n             public static final season summer = new season();\n             public static final season autumn = new season();\n             public static final season winter = new season();\n             public static season[] values();\n             public static season valueof(java.lang.string);\n     \n         }\n     \n     \n     1\n     2\n     3\n     4\n     5\n     6\n     7\n     8\n     9\n     10\n     \n   \n   * å¶å®å°±æ¯ææ®éç±»å®ä¹ä¸­ç class æ¢æäº enumï¼ä¹å¯ä»¥å æéä¿®é¥°ç¬¦\n\n * æä¸¾çç¹å¾\n   \n   * æä¸¾ç±»é½æ¯ç»§æ¿äºæä¸¾ç±»åï¼java.lang.enum\n   * æä¸¾é½æ¯æç»ç±»ï¼ä¸å¯ä»¥è¢«ç»§æ¿\n   * â ï¸ æé å¨é½æ¯ç§æçï¼æä¸¾å¯¹å¤ä¸è½åå»ºå¯¹è±¡\n   * æä¸¾ç±»çç¬¬ä¸è¡é»è®¤ç½åæä¸¾å¯¹è±¡çåç§°\n   * æä¸¾ç±»ç¸å½äºå¤ä¾æ¨¡å¼\n     * å¯¹å¤ä¸è½ååå»ºå¯¹è±¡äºï¼èåé¨å·²ç»åå»ºäºåä¸ªå¯¹è±¡\n\n# 3.3.2 æä¸¾çä½¿ç¨åºæ¯\n\næ¡ä¾ï¼å¼åè¶çº§çä¸½æ¸¸æ\n\n * éæ©å¸¸éåä¿¡æ¯æ å¿ååç±»ï¼\n   * è½ç¶å¯ä»¥å®ç°å¯è¯»æ§ï¼ä½æ¯å¥åå¼ä¸åçº¦æï¼ä»£ç ç¸å¯¹ä¸å¤ä¸¥è°¨ãï¼å®ä¹äº up=1ï¼æä¹å¯ä»¥ä¸ç¨ upï¼å°±éå¾ç¨ 1ï¼æ­¤æ¶ä¹æ¯å¯ä»¥çãæèæç¨ä¸åæ³çæ°å¼ä½ä¸ºåæ°ï¼ä¹æ²¡ææ ¡éªï¼\n * æä¸¾åä¿¡æ¯æ å¿ååç±»ï¼\n   * ä»£ç å¯è¯»æ§å¥½ï¼å¥åçº¦æä¸¥è°¨ï¼ä»£ç ä¼éï¼æ¯æå¥½çä¿¡æ¯åç±»ææ¯ï¼å»ºè®®ä½¿ç¨ï¼\n\n\n# 4. æ½è±¡ç±»\n\n\n# 4.1 æ½è±¡ç±»æ¦è¿°\n\nè¥ä¸ä¸ªç±»ä¸­çæä¸ªæ¹æ³çå·ä½å®ç°ä¸è½ç¡®å®ï¼å°±å¯ä»¥ç³ææ abstract ä¿®é¥°çæ½è±¡æ¹æ³ï¼ä¸è½åæ¹æ³ä½äºï¼ï¼å¯¹åºçç±»ä¹å¿é¡»ç¨ abstract ä¿®é¥°ï¼è¢«ç§°ä¸ºæ½è±¡ç±»ã\n\nç¤ºä¾ä»£ç ï¼\n\npublic abstract class animal{\n    public abstract void run();\n}\n\n\n1\n2\n3\n\n * æ½è±¡ç±»çä½ç¨ï¼\n   * å¯ä»¥è¢«å­ç±»ç»§æ¿ãåå½æ¨¡æ¿ï¼åæ¶ä¹å¯ä»¥æé«ä»£ç å¤ç¨\n * æ½è±¡ç±»çæ³¨æäºé¡¹ï¼\n   * ä¸ä¸ªç±»å¦æç»§æ¿äºæ½è±¡ç±»ï¼é£ä¹è¿ä¸ªç±»å¿é¡»éåå®æ½è±¡ç±»çå¨é¨æ½è±¡æ¹æ³ï¼å¦åè¿ä¸ªç±»ä¹å¿é¡»å®ä¹ææ½è±¡ç±»ã\n\n\n# 4.2 æ½è±¡ç±»çæ¡ä¾\n\nç³»ç»éæ±ï¼\n\nå æ²¹ç«æ¨åºä¸¤ç§æ¯ä»å¡ï¼éå¡åé¶å¡ï¼äº«åä¸åçææä¼æ ï¼éå¡8æï¼é¶å¡8.5æãåå«å®ç°2ç§å¡çè¿å¥æ¶é¶ç³»ç»åçé»è¾ï¼å¡çéè¦åå«ä¸»äººåç§°ï¼ä½é¢ï¼æ¯ä»åè½ã\n\nåæå®ç°ï¼\n\nåå»ºä¸å¼ å¡çç¶ç±»ï¼å®ä¹å±æ§åæ¬ä¸»äººåç§°ãä½é¢ãæ¯ä»åè½ï¼å·ä½å®ç°äº¤ç»å­ç±»ï¼\n\nåå»ºä¸å¼ ç½éå¡ç±»ï¼éåæ¯ä»åè½ï¼æç§åä»·ç8æè®¡ç®è¾åºã\n\nåå»ºä¸å¼ é¶å¡ç±»ï¼éåæ¯ä»åè½ï¼æç§åä»·ç8.5æè®¡ç®è¾åºã\n\næ½è±¡ç±»çç¹å¾åæ³¨æäºé¡¹\n\n * æå¾æå¤±: å¾å°äºæ½è±¡æ¹æ³ï¼å¤±å»äºåå»ºå¯¹è±¡çè½å\n   * å³ï¼æ½è±¡ç±»ä¸è½åå»ºå¯¹è±¡\n   * åå ï¼\n     * è¥è½å¤åå»ºå¯¹è±¡ï¼åè°ç¨å¶ä¸­çæ½è±¡æ¹æ³æ æ³æ­£å¸¸è¿è¡ï¼è¿æ¹æ³ä½é½æ²¡æï¼\n     * åªæè¿ä¸ªæ½è±¡ç±»ä¸­æ²¡ææ½è±¡æ¹æ³ï¼ä¹ä¸è½å®ä¾å\n * ç±»æçæåï¼æååéãæ¹æ³ãæé å¨ï¼æ½è±¡ç±»é½å·å¤\n * æ½è±¡ç±»ä¸­ä¸ä¸å®ææ½è±¡æ¹æ³ï¼ææ½è±¡æ¹æ³çç±»ä¸å®æ¯æ½è±¡ç±»\n * ä¸ä¸ªç±»ç»§æ¿äºæ½è±¡ç±»å¿é¡»éåå®æ½è±¡ç±»çå¨é¨æ½è±¡æ¹æ³ï¼å¦åè¿ä¸ªç±»ä¹å¿é¡»å®ä¹ææ½è±¡ç±»\n   * ä¸è¬ä¸å±å±æ½è±¡ä½¿ç¨\n * ä¸è½ç¨abstractä¿®é¥°åéãä»£ç åãæé å¨ï¼åªè½ç¨æ¥ä¿®é¥°ç±»åæ¹æ³\n\nfinal å abstract çå³ç³»\n\nfinal å abstract ä¸º**äºæ¥å³ç³»**ï¼\n\n * abstract å®ä¹çæ½è±¡ç±»ä½ä¸ºæ¨¡æ¿è®©å­ç±»ç»§æ¿ï¼finalå® ä¹çç±»ä¸è½è¢«ç»§æ¿\n * æ½è±¡æ¹æ³å®ä¹éç¨åè½è®©å­ç±»éåï¼final å®ä¹çæ¹æ³å­ç±»ä¸è½éå\n\n\n# 4.3 è®¾è®¡æ¨¡å¼ï¼æ¨¡æ¿æ¹æ³æ¨¡å¼\n\næ¨¡æ¿æ¹æ³æ¨¡å¼ä¸ºæ½è±¡ç±»çåºç¨ã\n\n# 4.3.1 æ¨¡æ¿æ¹æ³æ¨¡å¼çä½¿ç¨åºæ¯\n\nå½ç³»ç»ä¸­åºç°åä¸ä¸ªåè½å¤å¤å¨å¼åï¼èè¯¥åè½ä¸­å¤§é¨åä»£ç æ¯ä¸æ ·çï¼åªæå¶ä¸­é¨åå¯è½ä¸åçæ¶åï¼éå¸¸ç¨æ¨¡æ¿æ¹æ³æ¨¡å¼ã\n\n# 4.3.2 æ¨¡æ¿æ¹æ³æ¨¡å¼çå®ç°æ­¥éª¤\n\n * æåè½å®ä¹æä¸ä¸ªæè°çæ¨¡æ¿æ¹æ³ï¼æ¾å¨æ½è±¡ç±»ä¸­ï¼æ¨¡æ¿æ¹æ³ä¸­åªå®ä¹éç¨ä¸è½ç¡®å®çä»£ç ï¼ä¸ä¸ªéç¨ç»æï¼\n * æ¨¡æ¿æ¹æ³ä¸­ä¸è½å³å®çåè½å®ä¹ææ½è±¡æ¹æ³è®©å·ä½å­ç±»å»å®ç°\n\n# 4.3.3 æ¡ä¾ï¼ä¸­å°å­¦çåä½æ\n\néæ±ï¼ä¸­ãå°å­¦çé½è¦åãæçç¸ç¸ãï¼æ¯ç±»å­¦ççæ é¢ãç¬¬ä¸æ®µãæåä¸æ®µçåå®¹å¿é¡»ä¸æ ·ï¼æ­£æèªå·±åæ¥ã\n\nè§£å³ï¼ç¶ç±»å®ä¹ä¸ºæ½è±¡æ¹æ³ï¼å°å±åé¨åå®ç°ï¼å©ä¸çæ­£æä¹¦åé¨åå®ä¹ä¸ºæ½è±¡æ¹æ³ï¼è®©å­ç±»å»å®ç°ã\n\næ¨¡æ¿æ¹æ³å»ºè®®ä½¿ç¨ final ä¿®é¥°ï¼æ´ä¸ä¸ï¼åå ï¼\n\næ¨¡æ¿æ¹æ³æ¯ç»å­ç±»ç´æ¥ä½¿ç¨çï¼ä¸æ¯è®©å­ç±»éåçï¼ä¸æ¦å­ç±»éåäºæ¨¡æ¿æ¹æ³å°±å¤±æäºã\n\nä½¿ç¨èåªéè¦å³å¿èªå·±éè¦å®ç°çåè½å³å¯ã\n\nå¦ï¼ä¸å¾ä¸­ï¼ç¨ final ä¿®é¥°æ¨¡æ¿æ¹æ³ writeï¼é²æ­¢å­ç±»å¯¹å¶éåã\n\n\n\n\n# 5. æ¥å£\n\n\n# 5.1 æ¥å£çæ¦è¿°åç¹ç¹\n\n# 5.1.1 å¥æ¯æ¥å£\n\n * æ¥å£æ¯ä¸ç§è§èï¼è§èä¸å®æ¯å¬å¼ç\n\n * æ¯ä¸ç§ç¹æ®çæ½è±¡ç±»\n\n * å³é®å­ï¼interface\n\n * å®ä¹æ ¼å¼ï¼\n   \n   public interface æ¥å£å {\n          // å¸¸é\n          // æ½è±¡æ¹æ³\n   }\n   \n   \n   1\n   2\n   3\n   4\n   \n\n# 5.1.2 æ¥å£çç¹ç¹\n\n * æ¯ä¸ç§ç¹æ®çæ½è±¡ç±»\n * é»è®¤æ¯å¬å¼ç\n * jdk8 ä¹åæ¥å£ä¸­åªè½æ¯æ½è±¡æ¹æ³åå¸¸éï¼æ²¡æå¶ä»æåäºã\n   * è¥æå¶ä»ä¸è¥¿ï¼å°±åææ®éçæ½è±¡ç±»äº\n * æ¥å£ä¸è½å®ä¾åã\n * æ¥å£ä¸­çæåé½æ¯ public ä¿®é¥°çï¼åä¸åé½æ¯ï¼å ä¸ºè§èçç®çæ¯ä¸ºäºå¬å¼åã\n   * æååéå¯ä»¥çç¥ public staticï¼ä¹æ¯é»è®¤å¬å¼ç\n   * æåæ¹æ³ç´æ¥ä¸å public å¸¸ç¨\n\n\n# 5.2 æ¥å£çåºæ¬ä½¿ç¨ï¼è¢«å®ç°\n\næ¥å£æ¯ç¨æ¥è¢«ç±»å®ç°ï¼implementsï¼çï¼å®ç°æ¥å£çç±»ç§°ä¸º**å®ç°ç±»**ãå®ç°ç±»å¯ä»¥çè§£ææè°çå­ç±»ã\n\nç¤ºä¾ï¼\n\nä¿®é¥°ç¬¦ class å®ç°ç±» implements æ¥å£1, æ¥å£2, æ¥å£3 , ... {\n}\n\n\n1\n2\n\n\næ¥å£å¯ä»¥è¢«ç±»åå®ç°ï¼ä¹å¯ä»¥è¢«ç±»å¤å®ç°ã\n\nâ ï¸ ä¸ä¸ªç±»å®ç°æ¥å£ï¼å¿é¡»éåå®å¨é¨æ¥å£çå¨é¨æ½è±¡æ¹æ³ï¼å¦åè¿ä¸ªç±»éè¦å®ä¹ææ½è±¡ç±»\n\ninterface vs abstract\n\n * æ¥å£æ²¡å¯¹è±¡\n\n * æ¥å£å¯ä»¥å¤å®ç°ï¼implementsï¼\n\n * æ½è±¡ç±»ä¸ä¸ªå¿å­åªè½æä¸ä¸ªäº²ç¸ï¼å¯ä»¥æå¤ä¸ªå¿å­æåä¸ä¸ªäº²ç¸\n\n * æ¥å£ä¸ä¸ªå¿å­å¯ä»¥æå¤ä¸ªå¹²ç¹\n\næç¤º\n\n * ç±»åç±»çå³ç³»ï¼åç»§æ¿\n * ç±»åæ¥å£çå³ç³»ï¼å¤å®ç°\n * æ¥å£åæ¥å£çå³ç³»ï¼å¤ç»§æ¿ï¼ä¸ä¸ªæ¥å£å¯ä»¥åæ¶ç»§æ¿å¤ä¸ªæ¥å£\n   * ä½ç¨ï¼è§èåå¹¶ï¼æ´åå¤ä¸ªæ¥å£ä¸ºåä¸ä¸ªæ¥å£ï¼ä¾¿äºå­ç±»å®ç°\n   * ä¾å¦ï¼ç¯®çè¿å¨åè¦å®ç°è¿å¨åãéµçºªå®æ³ãäººçæ¥å£ï¼å¨å®ä¹è¿ä¸ªç±»æ¶éè¦å¯¹å¤ä¸ªæ¥å£è¿è¡å®ç°ï¼ä½è¥æå¦å¨åæ¥å£å·²ç»å¤ç»§æ¿äºéµçºªå®æ³ãäººçæ¥å£æ¶ï¼ç¯®çè¿å¨åå°±å¯ä»¥åªå®ç°è¿å¨åæ¥å£äº\n\n\n# 5.3 jdk8 å¼å§æ¥å£æ°å¢æ¹æ³\n\njdk8 çæ¬å¼å§åï¼java å¯¹æ¥å£çæåæ¹æ³è¿è¡äºæ°å¢ã\n\nåå ï¼\n\nå½é¡¹ç® 1.0 æåä¸çº¿æ²¡é®é¢ä¹åï¼ 2.0 çæ¬éè¦å¯¹æä¸ªæ¥å£è¿è¡ä¸°å¯ï¼å å¥æ´å¤æ½è±¡æ¹æ³ï¼æ­¤æ¶ï¼å¦æä¿®æ¹è¿ä¸ªæ¥å£ï¼å°±æå³çæ­¤æ¥å£çææå®ç°ç±»é½è¦å»å®ç°ææçè¿äºæ¹æ³ï¼è¿äºå®ç°ç±»é½éè¦åå»ä¿®æ¹ä»£ç ã\n\né®é¢æ¥å¦ï¼ åå°±è½å¨ä¸°å¯æ¥å£åè½çåæ¶åä¸å¯¹å­ç±»ä»£ç è¿è¡æ´æ¹å¢ï¼ï¼\n\nââsolveï¼åè®¸æ¥å£ä¸­ç´æ¥å®ä¹å¸¦ææ¹æ³ä½çæ¹æ³ï¼æjdk8 ä¹åæ°å¢çæ¹æ³æï¼é»è®¤æ¹æ³ãéææ¹æ³ãç§ææ¹æ³ä¸ç§ï¼ä»ä»¬é½ä¼é»è®¤è¢« public ä¿®é¥°ã\n\n# 5.3.1 é»è®¤æ¹æ³\n\næ¬è´¨ä¸å°±æ¯ä¹åæå°çæ®éå®ä¾æ¹æ³ï¼å¿é¡»æ default ä¿®é¥°ã\n\né»è®¤ä¼ public ä¿®é¥°ã\n\nâ ï¸ éè¦ç¨æ¥å£çå®ç°ç±»çå¯¹è±¡æ¥è°ç¨ã\n\n# 5.3.2 éææ¹æ³\n\nå¿é¡» static ä¿®é¥°ï¼é»è®¤ä¼ public ä¿®é¥°ã\n\nâ ï¸ æ³¨æï¼æ¥å£çéææ¹æ³å¿é¡»ç¨æ¬èº«çæ¥å£åæ¥è°ç¨ã\n\n# 5.3.3 ç§ææ¹æ³\n\næ¬è´¨å°±æ¯ç§æçå®ä¾æ¹æ³ï¼å¿é¡»ä½¿ç¨ private ä¿®é¥°ï¼ä» jdk 1.9 æå¼å§æçã\n\nåªè½å¨**æ¬ç±»ä¸­ï¼æ¬æ¥å£ä¸­ï¼**è¢«å¶ä»çé»è®¤æ¹æ³æèç§ææ¹æ³è®¿é®ã\n\nâ ï¸ åªè½å¨æ¥å£åé¨è¢«è°ç¨ã\n\n> heimaï¼jdk8 æ°å¢ç 3 ç§æ¹æ³æä»¬èªå·±å¨å¼åä¸­å¾å°ä½¿ç¨ï¼éå¸¸æ¯ java æºç æ¶åå°çï¼æä»¬éè¦çè§£ãè¯å«è¯­æ³ãæç½è°ç¨å³ç³»å³å¯ã\n\næ¥å£çæ³¨æäºé¡¹\n\n1ãæ¥å£ä¸è½åå»ºå¯¹è±¡ã\n\n2ãä¸ä¸ªç±»å®ç°å¤ä¸ªæ¥å£ï¼å¤ä¸ªæ¥å£ä¸­æåæ ·çéææ¹æ³ä¸å²çªã\n\nå ä¸ºæ¥å£çéææ¹æ³åªè½ç¨æ¥å£æ¬èº«æ¥è°ç¨ã\n\n3ãä¸ä¸ªç±»ç»§æ¿äºç¶ç±»ï¼åæ¶åå®ç°äºæ¥å£ï¼ç¶ç±»ä¸­åæ¥å£ä¸­æååæ¹æ³ï¼é»è®¤ç¨ç¶ç±»çã\n\nç¶ç±»æ¯äº²ç¸ï¼æ¥å£æ¯å¹²ç¹ã\n\nä¸ä¸ª class è¦å extends åimplementsã\n\n4ãä¸ä¸ªç±»å®ç°äºå¤ä¸ªæ¥å£ï¼å¤ä¸ªæ¥å£ä¸­å­å¨ååçé»è®¤æ¹æ³ï¼ä¸å²çªï¼è¿ä¸ªç±»éåè¯¥æ¹æ³å³å¯ã\n\n5ãä¸ä¸ªæ¥å£ç»§æ¿å¤ä¸ªæ¥å£ï¼æ¯æ²¡æé®é¢çï¼å¦æå¤ä¸ªæ¥å£ä¸­å­å¨è§èå²çªåä¸è½å¤ç»§æ¿ã',charsets:{cjk:!0},lastUpdated:"2023/03/15, 14:34:12",lastUpdatedTimestamp:1678890852e3},{title:"é¢åå¯¹è±¡è¿é¶3ï¼å¤æãåé¨ç±»ãå¸¸ç¨APIï¼",frontmatter:{title:"é¢åå¯¹è±¡è¿é¶3ï¼å¤æãåé¨ç±»ãå¸¸ç¨APIï¼",date:"2023-03-08T20:17:52.000Z",permalink:"/pages/a4fc75/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/32.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B63%EF%BC%88%E5%A4%9A%E6%80%81%E3%80%81%E5%86%85%E9%83%A8%E7%B1%BB%E3%80%81%E5%B8%B8%E7%94%A8API%EF%BC%89.html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/32.é¢åå¯¹è±¡è¿é¶3ï¼å¤æãåé¨ç±»ãå¸¸ç¨APIï¼.md",key:"v-b1a79552",path:"/pages/a4fc75/",headers:[{level:2,title:"1. å¤æï¼é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹ä¸",slug:"_1-å¤æ-é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹ä¸",normalizedTitle:"1. å¤æï¼é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹ä¸",charIndex:29},{level:3,title:"1.1 å¤æçæ¦è¿°ãå½¢å¼",slug:"_1-1-å¤æçæ¦è¿°ãå½¢å¼",normalizedTitle:"1.1 å¤æçæ¦è¿°ãå½¢å¼",charIndex:50},{level:3,title:"1.2 å¤æçä¼å¿",slug:"_1-2-å¤æçä¼å¿",normalizedTitle:"1.2 å¤æçä¼å¿",charIndex:410},{level:3,title:"1.3 å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢",slug:"_1-3-å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢",normalizedTitle:"1.3 å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢",charIndex:736},{level:3,title:"1.4 å¤æçæ¡ä¾",slug:"_1-4-å¤æçæ¡ä¾",normalizedTitle:"1.4 å¤æçæ¡ä¾",charIndex:1719},{level:2,title:"2. åé¨ç±»",slug:"_2-åé¨ç±»",normalizedTitle:"2. åé¨ç±»",charIndex:1934},{level:3,title:"2.1 åé¨ç±»çæ¦è¿°",slug:"_2-1-åé¨ç±»çæ¦è¿°",normalizedTitle:"2.1 åé¨ç±»çæ¦è¿°",charIndex:1945},{level:3,title:"2.2 åé¨ç±»çä½¿ç¨åºæ¯ãä½ç¨",slug:"_2-2-åé¨ç±»çä½¿ç¨åºæ¯ãä½ç¨",normalizedTitle:"2.2 åé¨ç±»çä½¿ç¨åºæ¯ãä½ç¨",charIndex:2095},{level:3,title:"2.3 åé¨ç±»çåç±»",slug:"_2-3-åé¨ç±»çåç±»",normalizedTitle:"2.3 åé¨ç±»çåç±»",charIndex:2304},{level:4,title:"2.3.1 éæåé¨ç±»",slug:"_2-3-1-éæåé¨ç±»",normalizedTitle:"2.3.1 éæåé¨ç±»",charIndex:2318},{level:4,title:"2.3.2 æååé¨ç±»",slug:"_2-3-2-æååé¨ç±»",normalizedTitle:"2.3.2 æååé¨ç±»",charIndex:2616},{level:4,title:"2.3.3 å±é¨åé¨ç±»",slug:"_2-3-3-å±é¨åé¨ç±»",normalizedTitle:"2.3.3 å±é¨åé¨ç±»",charIndex:3081},{level:4,title:"2.3.4 å¿ååé¨ç±»",slug:"_2-3-4-å¿ååé¨ç±»",normalizedTitle:"2.3.4 å¿ååé¨ç±»",charIndex:3180},{level:4,title:"2.3.5 å¿ååé¨ç±»å¸¸è§ä½¿ç¨å½¢å¼",slug:"_2-3-5-å¿ååé¨ç±»å¸¸è§ä½¿ç¨å½¢å¼",normalizedTitle:"2.3.5 å¿ååé¨ç±»å¸¸è§ä½¿ç¨å½¢å¼",charIndex:4097},{level:2,title:"3. å¸¸ç¨ API",slug:"_3-å¸¸ç¨-api",normalizedTitle:"3. å¸¸ç¨ api",charIndex:4757},{level:3,title:"3.1 Object ç±»",slug:"_3-1-object-ç±»",normalizedTitle:"3.1 object ç±»",charIndex:4771},{level:3,title:"3.2 Objects ç±»",slug:"_3-2-objects-ç±»",normalizedTitle:"3.2 objects ç±»",charIndex:5330},{level:3,title:"3.3 StringBuilder ç±»",slug:"_3-3-stringbuilder-ç±»",normalizedTitle:"3.3 stringbuilder ç±»",charIndex:6199},{level:3,title:"3.4 Math ç±»",slug:"_3-4-math-ç±»",normalizedTitle:"3.4 math ç±»",charIndex:7226},{level:3,title:"3.5 System ç±»",slug:"_3-5-system-ç±»",normalizedTitle:"3.5 system ç±»",charIndex:7776},{level:3,title:"3.6 BigDecimal ç±»",slug:"_3-6-bigdecimal-ç±»",normalizedTitle:"3.6 bigdecimal ç±»",charIndex:8353}],headersStr:"1. å¤æï¼é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹ä¸ 1.1 å¤æçæ¦è¿°ãå½¢å¼ 1.2 å¤æçä¼å¿ 1.3 å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢ 1.4 å¤æçæ¡ä¾ 2. åé¨ç±» 2.1 åé¨ç±»çæ¦è¿° 2.2 åé¨ç±»çä½¿ç¨åºæ¯ãä½ç¨ 2.3 åé¨ç±»çåç±» 2.3.1 éæåé¨ç±» 2.3.2 æååé¨ç±» 2.3.3 å±é¨åé¨ç±» 2.3.4 å¿ååé¨ç±» 2.3.5 å¿ååé¨ç±»å¸¸è§ä½¿ç¨å½¢å¼ 3. å¸¸ç¨ API 3.1 Object ç±» 3.2 Objects ç±» 3.3 StringBuilder ç±» 3.4 Math ç±» 3.5 System ç±» 3.6 BigDecimal ç±»",content:'# é¢åå¯¹è±¡è¿é¶3ï¼å¤æãåé¨ç±»ãå¸¸ç¨ APIï¼\n\n\n# 1. å¤æï¼é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹ä¸\n\n\n# 1.1 å¤æçæ¦è¿°ãå½¢å¼\n\n * å¥æ¯å¤æ\n   * åä¸ç¶ç±»åçå¯¹è±¡ï¼æ§è¡åä¸ä¸ªè¡ä¸ºæ¶ï¼ä¼è¡¨ç°åºä¸åçè¡ä¸ºç¹å¾ã\n * å¤æçå¸¸è§å½¢å¼\n   * ç¶ç±»ç±»å å¯¹è±¡åç§° = new å­ç±»æé å¨; ï¼ç¶ç±»ç±»åæåä¸ä¸ªå­ç±»çå¯¹è±¡ï¼\n   * æ¥å£ å¯¹è±¡åç§° = new å®ç°ç±»æé å¨;ï¼æ¥å£ç¸å½äºä¸ä¸ªå¹²ç¹ï¼å®ç°ç±»ç¸å½äºå¿å­ï¼\n   * å·ä½çè¡ä¸ºæ¹æ³å¨å­ç±»ä¸­éå\n * å¤æä¸­æåè®¿é®ç¹ç¹-\n   * æ¹æ³è°ç¨ï¼ç¼è¯çå·¦è¾¹ï¼è¿è¡çå³è¾¹ã\n   * åéè°ç¨ï¼ç¼è¯çå·¦è¾¹ï¼è¿è¡ä¹çå·¦è¾¹ãï¼å¤æä¾§éè¡ä¸ºå¤æï¼åéæ²¡æå¤æçæ¦å¿µï¼\n     * å³å¯¹äºåéè°ç¨ï¼è¿æ¯ä¼ä½¿ç¨ç¶ç±»ä¸­çåéï¼èæ¹æ³æ¯ä¼ä½¿ç¨å­ç±»ä¸­éåçæ¹æ³çã\n * å¤æçåæ\n   * æç»§æ¿/å®ç°å³ç³»\n   * æç¶ç±»å¼ç¨æåå­ç±»å¯¹è±¡\n   * ææ¹æ³éå\n\n\n# 1.2 å¤æçä¼å¿\n\n 1. å¨å¤æå½¢å¼ä¸ï¼å³è¾¹å¯¹è±¡å¯ä»¥å®ç°è§£è¦åï¼ä¾¿äºæ©å±åç»´æ¤ã\n\nAnimal a = new Dog();\na.run(); // åç»­ä¸å¡è¡ä¸ºéå¯¹è±¡èåï¼åç»­ä»£ç æ éä¿®æ¹\n\n\n1\n2\n\n\nä¸è¿°ä»£ç ä¸­ï¼è¥åç»­ä¸å¡éè¦å° Dog å­ç±»æ¹ä¸ºTortoise å­ç±»ï¼åç´æ¥æ¹â=âå³ä¾§çå­ç±»ç±»åå³å¯ï¼åç»­ä»£ç ä¸­çè¡ä¸ºéçå¯¹è±¡çæ¹åèç´æ¥ååäºï¼æ éä¿®æ¹å¾å¤åç»­çä»£ç ã\n\n 2. å®ä¹æ¹æ³çæ¶åï¼ä½¿ç¨ç¶ç±»åä½ä¸ºåæ°ï¼è¯¥æ¹æ³å°±å¯ä»¥æ¥æ¶è¿ç¶ç±»çä¸åå­ç±»å¯¹è±¡ï¼ä½ç°åºå¤æçæ©å±æ§ä¸ä¾¿å©\n\nå¤æä¸ä¼äº§ççä¸ä¸ªé®é¢\n\nå¤æä¸ä¸è½ä½¿ç¨å­ç±»çç¬æåè½ï¼å ä¸ºç¼è¯æ¶ä¼ä½¿ç¨å·¦ä¾§çç¶ç±»ä¸­çè¡ä¸ºã\n\nsolveï¼ä½¿ç¨å¼ºå¶ç±»åè½¬æ¢ï¼å°ç¶è½¬ä¸ºå­ç±»åã\n\n\n# 1.3 å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢\n\nå¨å¤æä¸ä¼æä¸¤ç§ç±»åè½¬æ¢ï¼\n\n * èªå¨ç±»åè½¬æ¢ï¼ä»å­å°ç¶ï¼\n * å¼ºå¶ç±»åè½¬æ¢ï¼ä»ç¶å°å­ï¼\n\nå³äºå¼ºå¶ç±»åè½¬æ¢ï¼\n\n * å­ç±»ç±»å å¯¹è±¡åé = (å­ç±»)ç¶ç±»ç±»åçåé\n   \n   ä»£ç ç¤ºä¾ï¼\n   \n   // èªå¨ç±»åè½¬æ¢\n   Animal a = new Dog();\n   a.run();\n   // å¼ºå¶ç±»åè½¬æ¢:å¯ä»¥å®ç°è°ç¨å­ç±»ç¬æåè½ç\n   Dog d = (Dog) a;\n   d.lookDoor();\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   \n\n * ä½ç¨ï¼å¯ä»¥è§£å³å¤æä¸çå£å¿ï¼å¯ä»¥å®ç°è°ç¨å­ç±»ç¬æçåè½\n\n * æ³¨æï¼ å¦æè½¬ååçç±»ååå¯¹è±¡çå®ç±»åä¸æ¯åä¸ç§ç±»åï¼é£ä¹å¨è½¬æ¢çæ¶åå°±ä¼æ¥é ClassCastExceptionï¼ç±»åè½¬æ¢å¼å¸¸ï¼\n\nå¼ºè½¬è½¬æ¢çä¸ç¹å»ºè®®\n\nè§å®ï¼æç»§æ¿æèå®ç°å³ç³»ç2ä¸ªç±»åå°±å¯ä»¥å¼ºå¶ç±»åè½¬æ¢ï¼æç¼è¯æ¶å¯è½æ²¡é®é¢ï¼ä½è¿è¡æ¶åç°å¼ºå¶è½¬æ¢åçç±»åä¸æ¯å¯¹è±¡çå®ç±»åèæ¥éã\n\nJava å»ºè®®å¼ºè½¬è½¬æ¢åä½¿ç¨ instanceof å¤æ­å½åå¯¹è±¡ççå®ç±»åï¼åè¿è¡å¼ºå¶è½¬æ¢ã\n\nå³äº instanceof å³é®å­çä½¿ç¨ï¼\n\nåéå instanceof çå®ç±»å\n\nå¤æ­å³é®å­å·¦è¾¹çåéæåçå¯¹è±¡ççå®ç±»åï¼æ¯å¦æ¯å³è¾¹çç±»åæèæ¯å¶å­ç±»ç±»åï¼æ¯åè¿åtrueï¼åä¹falseã\n\nä»£ç ç¤ºä¾ï¼\n\npublic static void go(Animal a){  // åæ°ç±»åä¸ºç¶ç±»ç±»åï¼ä¿è¯åç§å¨ç©é½å¯ä»¥ä½¿ç¨goæ¹æ³\n    System.out.println("é¢å¤~~~");\n    a.run();\n    // ç¬æåè½\n    if(a instanceof Tortoise){\n        Tortoise t = (Tortoise) a;\n        t.layEggs();\n    }else if(a instanceof Dog){\n        Dog d1 = (Dog) a;\n        d1.lookDoor();\n    }\n    System.out.println("ç»æ~~~~");\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 1.4 å¤æçæ¡ä¾\n\néæ±ï¼è®¾è®¡ä¸ä¸ªçµèå¯¹è±¡ï¼å¯ä»¥å®è£2ä¸ªUSBè®¾å¤ãé¼ æ ï¼è¢«å®è£æ¶å¯ä»¥å®ææ¥å¥ãè°ç¨ç¹å»åè½ãæåºåè½ï¼é®çï¼è¢«å®è£æ¶å¯ä»¥å®ææ¥å¥ãè°ç¨æå­åè½ãæåºåè½ã\n\nåæï¼\n\nâ å®ä¹ä¸ä¸ªUSBçæ¥å£ï¼ç³æUSBè®¾å¤çè§èå¿é¡»æ¯ï¼å¯ä»¥æ¥å¥åæåºï¼ã\n\nâ¡æä¾2ä¸ªUSBå®ç°ç±»ä»£è¡¨é¼ æ åé®çï¼è®©å¶å®ç°USBæ¥å£ï¼å¹¶åå«å®ä¹ç¬æåè½ã\n\nâ¢åå»ºçµèå¯¹è±¡ï¼åå»º2ä¸ªUSBå®ç°ç±»å¯¹è±¡ï¼åå«å®è£å°çµèä¸­å¹¶è§¦ååè½çæ§è¡ã\n\n\n# 2. åé¨ç±»\n\n\n# 2.1 åé¨ç±»çæ¦è¿°\n\nåé¨ç±»å°±æ¯å®ä¹å¨ä¸ä¸ªç±»éé¢çç±»ï¼éé¢çç±»å¯ä»¥çè§£æï¼å¯çï¼ï¼å¤é¨ç±»å¯ä»¥çè§£æï¼å®¿ä¸»ï¼ã\n\nå¦ï¼å¿èåäººçå³ç³»ï¼\n\npublic class People{\n    // åé¨ç±»\n    public class Heart{\n    }\n}\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2.2 åé¨ç±»çä½¿ç¨åºæ¯ãä½ç¨\n\n * å½ä¸ä¸ªäºç©çåé¨ï¼è¿æä¸ä¸ªé¨åéè¦ä¸ä¸ªå®æ´çç»æè¿è¡æè¿°ï¼èè¿ä¸ªåé¨çå®æ´çç»æååªä¸ºå¤é¨äºç©æä¾æå¡ï¼é£ä¹æ´ä¸ªåé¨çå®æ´ç»æå¯ä»¥éæ©ä½¿ç¨åé¨ç±»æ¥è®¾è®¡ã\n * åé¨ç±»éå¸¸å¯ä»¥æ¹ä¾¿è®¿é®å¤é¨ç±»çæåï¼åæ¬ç§æçæåã\n * åé¨ç±»æä¾äºæ´å¥½çå°è£æ§ï¼åé¨ç±»æ¬èº«å°±å¯ä»¥ç¨ privateãprotected ç­ä¿®é¥°ï¼å°è£æ§å¯ä»¥åæ´å¤æ§å¶ãï¼å¤é¨ç±»åªè½ç¨ public ä¿®é¥°ï¼\n\n\n# 2.3 åé¨ç±»çåç±»\n\n# 2.3.1 éæåé¨ç±»\n\n * æstaticä¿®é¥°ï¼å±äºå¤é¨ç±»æ¬èº«\n * ç¹ç¹ãä½¿ç¨ä¸æ®éç±»æ¯ä¸æ ·çï¼ç±»æçæåå®é½æï¼åªæ¯ä½ç½®å¨å«äººéé¢èå·²\n * å¯ä»¥ç´æ¥è®¿é®å¤é¨ç±»çéææåï¼ä¸è½ç´æ¥è®¿é®å¤é¨ç±»çå®ä¾æåï¼å¯ä»¥åå»ºä¸ä¸ªå¤é¨ç±»å¯¹è±¡ï¼åè®¿é®å¶å®ä¾æåï¼\n * æ³¨æï¼å¼åä¸­å®éä¸ç¨çè¿æ¯æ¯è¾å°\n * å®ä¹ç¤ºä¾ï¼\n\npublic class Outer{\n        // éææååé¨ç±»\n    public static class Inner{\n    }\n}\n\n\n1\n2\n3\n4\n5\n\n * åå»ºå¯¹è±¡çæ ¼å¼ï¼Outer.Inner in = new Outer.Inner();\n\n# 2.3.2 æååé¨ç±»\n\n * æ  static ä¿®é¥°ï¼å±äºå¤é¨ç±»çå¯¹è±¡\n * JDK16 ä¹åï¼æååé¨ç±»ä¸­ä¸è½å®ä¹éææåï¼JDK 16 å¼å§ä¹å¯ä»¥å®ä¹éææåäº\n * ç¹ç¹ï¼å¯ä»¥ç´æ¥è®¿é®å¤é¨ç±»çéææåï¼å®ä¾æ¹æ³ä¸­å¯ä»¥ç´æ¥è®¿é®å¤é¨ç±»çå®ä¾æåï¼å ä¸ºå¿é¡»åæå¤é¨ç±»å¯¹è±¡ï¼æè½ææååé¨ç±»å¯¹è±¡ï¼æä»¥å¯ä»¥ç´æ¥è®¿é®å¤é¨ç±»å¯¹è±¡çå®ä¾æåï¼\n * å®ä¹ç¤ºä¾ï¼\n\npublic class Outer {\n    // æååé¨ç±»\n    public class Inner {        \n    }\n}\n\n\n1\n2\n3\n4\n5\n\n * åå»ºå¯¹è±¡æ ¼å¼ï¼Outer.Inner in = new Outer().new Inner(); ï¼æ³¨æå¤é¨ç±»å¯¹è±¡åé¢è¦å () ï¼\n * ç¸å³é¢è¯é¢ï¼\n   * å¨æååé¨ç±»ä¸­è®¿é®æå¨å¤é¨ç±»å¯¹è±¡ï¼æ ¼å¼ï¼å¤é¨ç±»å.this.valueï¼å¦ï¼System.out.println(People.this.heartbeat);\n   * è®¿é®å½åå¯¹è±¡çæååéï¼è¦ç¨ this.value\n\n# 2.3.3 å±é¨åé¨ç±»\n\n * é¸¡èè¯­æ³ï¼äºè§£å³å¯\n * å±é¨åé¨ç±»æ¾å¨æ¹æ³ãä»£ç åãæé å¨ç­æ§è¡ä½ä¸­\n * å±é¨åé¨ç±»ç¼è¯åä¹ä¼æå¯¹åºçç±»æä»¶ï¼å¶ç±»æä»¶åä¸ºï¼ å¤é¨ç±»$Nåé¨ç±».class\n\n# 2.3.4 å¿ååé¨ç±»\n\n * æ¬è´¨ä¸æ¯ä¸ä¸ªæ²¡æåå­çå±é¨åé¨ç±»ï¼å®ä¹å¨æ¹æ³ä¸­ãä»£ç åä¸­ãç­\n\n * ä½ç¨ï¼æ¹ä¾¿åå»ºå­ç±»å¯¹è±¡ï¼æç»ç®çä¸ºäºç®åä»£ç ç¼å\n\n * ç¹ç¹\n   \n   * å¿ååé¨ç±»ååºæ¥å°±ä¼äº§çä¸ä¸ªå¿ååé¨ç±»çå¯¹è±¡\n   * å¿ååé¨ç±»çå¯¹è±¡ç±»åç¸å½äºæ¯å½å new çé£ä¸ªçç±»åçå­ç±»ç±»åï¼å¯ä»¥è§ä¸ºæ¯ Animal çå­ç±» Tiger ç±»ï¼\n\n * æ ¼å¼\n\nnew ç±»|æ½è±¡ç±»å|æèæ¥å£å() {\n    éåæ¹æ³;\n};\n\n\n1\n2\n3\n\n\nAnimal a = new Animal() {\n    public void run() {\n    }\n};\na. run();\n\n\n1\n2\n3\n4\n5\n\n\nâ ï¸ ç´æ¥ new abstract_class() æ¯ä¸å¯ä»¥çï¼æåé¢å ä¸ {} è¿è¡æ¹æ³çéåï¼å®ç°ä¸ä¸ªå¿ååé¨ç±»ã\n\nç®åç¤ºä¾ï¼\n\nline3 ç­å·å ~ line8 çé¨åç¸å½äº Tiger ç±»äºã\n\npublic class Test {\n    public static void main(String[] args) {\n        Animal a = new Animal(){\n            @Override\n            public void run() {\n                System.out.println("èèè·çå~~~");\n            }\n        };\n        a.run();\n    }\n}\n\n//class Tiger extends Animal{\n//    @Override\n//    public void run() {\n//        System.out.println("èèè·çå~~~");\n//    }\n//}\n\nabstract class Animal{\n    public abstract void run();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# 2.3.5 å¿ååé¨ç±»å¸¸è§ä½¿ç¨å½¢å¼\n\nå¿ååé¨ç±»éå¸¸ä½ä¸ºæ¹æ³çå®éåæ°è¿è¡ä¼ è¾ã\n\nç¤ºä¾ä»£ç ï¼\n\npublic class Test2 {\n    public static void main(String[] args) {\n        \n        go(new Swimming() {\n            @Override\n            public void swim() {\n                System.out.println("è¿å¨åæ³³ðçè´¼å¿«~~~~~");\n            }\n        });\n\n    /**\n       å­¦ç èå¸ è¿å¨åå¯ä»¥ä¸èµ·åå æ¸¸æ³³æ¯èµ\n     */\n    public static void go(Swimming s){\n        System.out.println("å¼å§ããã");\n        s.swim();\n        System.out.println("ç»æããã");\n    }\n}\n    \ninterface Swimming{\n    void swim();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¯¹è±¡åè°ï¼\n\næç¤º\n\nå¼åä¸­ä¸æ¯æä»¬ä¸»å¨å»å®ä¹å¿ååé¨ç±»çï¼èæ¯å«äººéè¦æä»¬åæèæä»¬å¯ä»¥åçæ¶åæä¼ä½¿ç¨ã\n\nå¿ååé¨ç±»çä»£ç å¯ä»¥å®ç°ä»£ç è¿ä¸æ­¥çç®åã\n\n\n# 3. å¸¸ç¨ API\n\n\n# 3.1 Object ç±»\n\n * Object ç±»çæ¹æ³æ¯ä¸åå­ç±»å¯¹è±¡é½å¯ä»¥ç´æ¥ä½¿ç¨çï¼æä»¥æä»¬è¦å­¦ä¹  Object ç±»çæ¹æ³ã\n\n * ä¸ä¸ªç±»è¦ä¹é»è®¤ç»§æ¿äº Object ç±»ï¼è¦ä¹é´æ¥ç»§æ¿äº Object ç±»ï¼Object ç±»æ¯ Java ä¸­çç¥å®ç±»\n\n * Objectç±»çå¸¸ç¨æ¹æ³\n\næ¹æ³å                               è¯´æ\npublic String toString()          é»è®¤æ¯è¿åå½åå¯¹è±¡å¨å åå­ä¸­çå°åä¿¡æ¯:ç±»çå¨éå@åå­å°å\npublic boolean equals(Object o)   é»è®¤æ¯æ¯è¾å½åå¯¹è±¡ä¸å¦ä¸ä¸ªå¯¹è±¡çå°åæ¯å¦ç¸åï¼ç¸åè¿åtrueï¼ä¸åè¿åfalse\n\n * ä¸è¬ç´æ¥å¨ IDEA ä¸­èªå¨éåå¯¹åºç±»çè¿ä¸¤ä¸ªæ¹æ³å³å¯ã\n\ntoString æ¹æ³ï¼\n\nå ä¸º toString é»è®¤è¾åºå¯¹è±¡çå°åå¨å¼åä¸­æ¯«æ æä¹ï¼æ´å¤æ¯å¸æçå°å¯¹è±¡çåå®¹æ°æ®ï¼\n\ntoString æ¹æ³å­å¨çæä¹å°±æ¯ä¸ºäºè¢«å­ç±»éåï¼ä»¥ä¾¿è¿åå¯¹è±¡çåå®¹ä¿¡æ¯ï¼èä¸æ¯å°åä¿¡æ¯\n\nequals æ¹æ³ï¼\n\nç´æ¥æ¯è¾ä¸¤ä¸ªå¯¹è±¡çå°åæ¯å¦ç¸åå®å¨å¯ä»¥ç¨ â==â æ¿ä»£ equals\n\nç¶ç±» equals æ¹æ³å­å¨çæä¹å°±æ¯ä¸ºäºè¢«å­ç±»éåï¼ä»¥ä¾¿å­ç±»èªå·±æ¥å®å¶æ¯è¾è§å\n\n\n# 3.2 Objects ç±»\n\nObjects æ¯ä¸ä¸ªå·¥å·ç±»ï¼æä¾äºä¸äºæ¹æ³å»å®æä¸äºåè½\n\nObjects ç±»ä¸ Object ç±»ä¹æ¯ç»§æ¿å³ç³»ã\n\nObjects ç±»æ¯ä» JDK1.7 ä¹åææçã\n\nå®æ¹å¨è¿è¡å­ç¬¦ä¸²æ¯è¾æ¶ï¼èªå¨éåç equals æ¹æ³ï¼ï¼æ²¡æç¨å­ç¬¦ä¸²å¯¹è±¡çç equals æ¹æ³ï¼èæ¯éæ©äº Objects ç equals æ¹æ³æ¥æ¯è¾ã\n\nåå ï¼ä½¿ç¨Objects ç equals æ¹æ³å¨è¿è¡å¯¹è±¡çåå®¹æ¯è¾æ¶ä¼æ´å®å¨ã\n\nä½¿ç¨ Objects ç equals æ¹æ³å¨è¿è¡å¯¹è±¡çåå®¹æ¯è¾æ¶æ´å®å¨çåå \n\nObjects ç equals æ¹æ³å¨æ¯è¾æ¶ï¼åºå±ä¼åè¿è¡éç©ºå¤æ­ï¼ä»èå¯ä»¥é¿åç©ºæéå¼å¸¸ãåè¿è¡ equals æ¯è¾\n\næºç åæï¼\n\npublic static boolean equals(Object a, Object b) {\n    return (a == b) || (a != null && a.equals(b));\n}\n\n\n1\n2\n3\n\n\nè¥ç´æ¥ä½¿ç¨ equals æ¹æ³æ¯è¾æ¶ï¼å¯è½ä¼åºç°ç©ºæéå¼å¸¸ï¼ä¾å¦ï¼\n\npublic class Test {\n    public static void main(String[] args) {\n        String s1 = null;\n        String s2 = new String("itheima");\n\n        // System.out.println(s1.equals(s2));   // çä¸äºéæ£ï¼å¯è½åºç°ç©ºæéå¼å¸¸ã\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nString ç equals æ¹æ³ VS ç±»ç equals æ¹æ³\n\nå­ç¬¦ä¸²å¯ä»¥ç´æ¥ç¨ equals æ¯è¾åå®¹ï¼å ä¸º String ç±»å·²ç»éåè¿è¯¥æ¹æ³äºï¼ä½èªå®ä¹çç±»è¦éå equals æ¹æ³ã\n\nâ ï¸ String ä¸è½ç¨ â==â æ¯è¾åå®¹æ¯å¦ä¸æ ·ï¼å ä¸º â==â ä¼è§ä¸ºæ¯è¾çäºèä¸ºä¸åçå¯¹è±¡\n\n\n# 3.3 StringBuilder ç±»\n\n * StringBuilder æ¯ä¸ä¸ªå¯åçå­ç¬¦ä¸²ç±»ï¼æä»¬å¯ä»¥æå®çææ¯ä¸ä¸ªå¯¹è±¡å®¹å¨ãï¼String æ¯ä¸å¯åå­ç¬¦ä¸²ç±»ï¼\n\n * ä½ç¨ï¼æé«å­ç¬¦ä¸²çæä½æçï¼å¦æ¼æ¥ãä¿®æ¹ç­ã\n\n * StringBuilder å¸¸ç¨æ¹æ³\n\næ¹æ³åç§°                                è¯´æ\npublic StringBuilder append(ä»»æç±»å)   æ·»å æ°æ®å¹¶è¿åStringBuilderå¯¹è±¡æ¬èº«\npublic StringBuilder reverse()      å°å¯¹è±¡çåå®¹åè½¬ï¼ä¼ç´æ¥å°å¯¹è±¡æ¬èº«ä¿®æ¹\npublic int length()                 è¿åå¯¹è±¡åå®¹é¿åº¦\npublic String toString()            éè¿toString()å°±å¯ä»¥å®ç°æStringBuilderè½¬æ¢ä¸ºString\n\n * StringBuilder æ¯æé¾å¼ç¼ç¨ï¼e.g. sb1.append("a").append("b").append("c").append("æç±ä½ ä¸­å½");\n\nâ ï¸ æ³¨æï¼StringBuilder åªæ¯æ¼æ¥å­ç¬¦ä¸²çææ®µï¼æçå¥½ï¼ä½¿ç¨æ¶æç»è¿æ¯è¦è½¬æ Stringã ç¨ toString æ¢å¤ Stringãæ å®ä¹å­ç¬¦ä¸²ç¨ Stringï¼æ¼æ¥ãä¿®æ¹ç­æä½å­ç¬¦ä¸²ä½¿ç¨ StringBuilderã\n\nç¤ºä¾ä»£ç ï¼\n\nStringBuilder sb2 = new StringBuilder();\nsb2.append("123").append("456");\n// æ¢å¤æStringç±»å\nString rs = sb2.toString();\ncheck(rs); // ä½¿ç¨å­ç¬¦ä¸²\n\npublic static void check(String data){\n    System.out.println(data);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\nåå­åç\n\nString ç±»æ¼æ¥å­ç¬¦ä¸²æ¶ï¼ä¸ä¸ªå å·ä¼å¯¼è´å åå­ä¸­åå»ºä¸¤ä¸ªå¯¹è±¡ï¼ä¸ä¸ªæ¯æ¼æ¥æ¶ç StringBuilder å¯¹è±¡ï¼ä¸ä¸ªæ¯æ¼å¥½åè½¬æ¢è¿å»ç String å¯¹è±¡ã\n\n\n\nStringBuilder ç±»æ¼æ¥å­ç¬¦ä¸²æ¶ï¼åªä¼å¨å åå­ä¸­åå»ºä¸ä¸ª StringBuilder å¯¹è±¡ï¼æææ¼æ¥æä½é½å¨è¿ä¸ªå¯¹è±¡ä¸­å®æãæçåé«ã\n\n\n\n\n# 3.4 Math ç±»\n\nåå«æ§è¡åºæ¬æ°å­è¿ç®çæ¹æ³ï¼Mathç±»æ²¡ææä¾å¬å¼çæé å¨\n\n**å¦ä½ä½¿ç¨ç±»ä¸­çæåå¢ï¼**çç±»çæåæ¯å¦é½æ¯éæçï¼å¦ææ¯ï¼éè¿ç±»åå°±å¯ä»¥ç´æ¥è°ç¨\n\nMath ç±»çå¸¸ç¨æ¹æ³\n\næ¹æ³å                                           è¯´æ\npublic static int abs(int a)                  è·ååæ°ç»å¯¹å¼\npublic static double ceil(double a)           åä¸åæ´\npublic static double floor(double a)          åä¸åæ´\npublic static int round(float a)              åèäºå¥\npublic static int max(int a,int b)            è·åä¸¤ä¸ªintå¼ä¸­çè¾å¤§å¼\npublic static double pow(double a,double b)   è¿åaçbæ¬¡å¹çå¼\npublic static double random()                 è¿åå¼ä¸ºdoubleçéæºå¼ï¼èå´[0.0,1.0)\n\n\n# 3.5 System ç±»\n\nSystem ä¹æ¯ä¸ä¸ªå·¥å·ç±»ï¼ä»£è¡¨äºå½åç³»ç»ï¼æä¾äºä¸äºä¸ç³»ç»ç¸å³çæ¹æ³\n\nSystem ç±»çå¸¸ç¨æ¹æ³\n\næ¹æ³å                                                            è¯´æ\npublic static void exit(int status)                            ç»æ­¢å½åè¿è¡ç Java èææºï¼éé¶è¡¨ç¤ºå¼å¸¸ç»æ­¢\npublic static long currentTimeMillis()                         è¿åå½åç³»ç»çæ¶é´æ¯«ç§å¼å½¢å¼\npublic static void arraycopy(æ°æ®æºæ°ç», èµ·å§ç´¢å¼, ç®çå°æ°ç», èµ·å§ç´¢å¼, æ·è´ä¸ªæ°)   æ°ç»æ·è´ ï¼äºè§£ï¼\n\næ³¨æï¼System.exit() ç¸å½äºå åºè·è·¯ï¼å¯ä¸è½çç¨ï¼ï¼ï¼\n\nå³äºæ¶é´æ¯«ç§å¼ï¼\n\n * è®¡ç®æºè®¤ä¸ºæ¶é´æ¯æèµ·ç¹çï¼èµ·å§æ¶é´ï¼ 1970å¹´1æ1æ¥ 00:00:00\n\n * æ¶é´æ¯«ç§å¼ï¼æçæ¯ä»1970å¹´1æ1æ¥ 00:00:00èµ°å°æ­¤å»çæ»çæ¯«ç§æ°ï¼åºè¯¥æ¯å¾å¤§çã 1s = 1000msã\n\n * System.currentTimeMillis() å¯ä»¥ç¨æ¥è¿è¡æ¶é´çè®¡ç®ï¼æ§è½åæã\n\n\n# 3.6 BigDecimal ç±»\n\nï¼å¤§æ°æ®ç±»åï¼ç¨äºè§£å³æµ®ç¹åè¿ç®ç²¾åº¦å¤±ççé®é¢\n\næµ®ç¹åè¿ç®çæ¶åç´æ¥+ * / å¯è½ä¼åºç°æ°æ®å¤±çï¼ç²¾åº¦é®é¢ï¼ã\n\nBigDecimal çä½¿ç¨ï¼\n\nåå»ºå¯¹è±¡ BigDecimal å°è£æµ®ç¹åæ°æ®ï¼æå¥½çæ¹å¼æ¯è°ç¨æ¹æ³ï¼\n\nâ ï¸ é¿éå¼åè§èï¼ç¦æ­¢ä½¿ç¨æé æ¹æ³ BigDecimal(double)çæ¹å¼æ double å¼è½¬åä¸º BigDerimal å¯¹è±¡ã\n\nåå ï¼BigDecimal(double)å­å¨ç²¾åº¦æå¤±é£é©ï¼å¨ç²¾ç¡®è®¡ç®æå¼æ¯è¾çåºæ¯ä¸­å¯è½ä¼å¯¼è´ä¸å¡é»è¾å¼å¸¸ãå¦:BigDecimalg = new BigDecimal(0.1F);å®éçå­å¨å¼ä¸º:0.10000000149\n\næ­£ä¾ï¼ä¼åæ¨èå¥åä¸ºString çæé æ¹æ³ï¼æä½¿ç¨ BigDecimal ç valueof æ¹æ³ï¼æ­¤æ¹æ³åé¨å¶å®æ§è¡äºDouble ç toStringï¼è Double ç toString æ double çå®éè½è¡¨è¾¾çç²¾åº¦å¯¹å°¾æ°è¿è¡äºæªæ­ã\n\nBigDecimal recommend1 = new BigDecimal("0.1");\n\nBigDecimal recommend2 = BigDecimal.valueOf(0.1);\n\nâ ï¸ æ³¨æï¼BigDecimal åªæ¯ææ®µï¼æçå¥½ï¼ä½¿ç¨æ¶æç»è¿æ¯è¦è½¬æ å¯¹åºç double æ°æ®ç±»åã ä½¿ç¨ doubleValue() è½¬ä¸º doubleã\n\nç¤ºä¾ä»£ç ï¼\n\n// åè£æµ®ç¹åæ°æ®æä¸ºå¤§æ°æ®å¯¹è±¡ BigDeciaml\nBigDecimal a1 = BigDecimal.valueOf(a);\nBigDecimal b1 = BigDecimal.valueOf(b);\nBigDecimal c1 = a1.add(b1);\n// BigDecimal c1 = a1.subtract(b1);\n// BigDecimal c1 = a1.multiply(b1);\n// BigDecimal c1 = a1.divide(b1);\nSystem.out.println(c1);\n\n// ç®çï¼double\ndouble rs = c1.doubleValue();\nSystem.out.println(rs);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nâ ï¸ BigDecimal æ¯ä¸å®è¦ç²¾åº¦è¿ç®ç\n\nå¦ï¼10/3 å°±æ æ³ç²¾ç¡®è¿ç®ï¼æ BigDecimal ä¼æåºå¼å¸¸ã\n\nsolveï¼ public BigDecimal divide (å¦ä¸ä¸ªBigDecimalå¯¹è±¡ï¼ç²¾ç¡®å ä½ï¼èå¥æ¨¡å¼)',normalizedContent:'# é¢åå¯¹è±¡è¿é¶3ï¼å¤æãåé¨ç±»ãå¸¸ç¨ apiï¼\n\n\n# 1. å¤æï¼é¢åå¯¹è±¡ä¸å¤§ç¹å¾ä¹ä¸\n\n\n# 1.1 å¤æçæ¦è¿°ãå½¢å¼\n\n * å¥æ¯å¤æ\n   * åä¸ç¶ç±»åçå¯¹è±¡ï¼æ§è¡åä¸ä¸ªè¡ä¸ºæ¶ï¼ä¼è¡¨ç°åºä¸åçè¡ä¸ºç¹å¾ã\n * å¤æçå¸¸è§å½¢å¼\n   * ç¶ç±»ç±»å å¯¹è±¡åç§° = new å­ç±»æé å¨; ï¼ç¶ç±»ç±»åæåä¸ä¸ªå­ç±»çå¯¹è±¡ï¼\n   * æ¥å£ å¯¹è±¡åç§° = new å®ç°ç±»æé å¨;ï¼æ¥å£ç¸å½äºä¸ä¸ªå¹²ç¹ï¼å®ç°ç±»ç¸å½äºå¿å­ï¼\n   * å·ä½çè¡ä¸ºæ¹æ³å¨å­ç±»ä¸­éå\n * å¤æä¸­æåè®¿é®ç¹ç¹-\n   * æ¹æ³è°ç¨ï¼ç¼è¯çå·¦è¾¹ï¼è¿è¡çå³è¾¹ã\n   * åéè°ç¨ï¼ç¼è¯çå·¦è¾¹ï¼è¿è¡ä¹çå·¦è¾¹ãï¼å¤æä¾§éè¡ä¸ºå¤æï¼åéæ²¡æå¤æçæ¦å¿µï¼\n     * å³å¯¹äºåéè°ç¨ï¼è¿æ¯ä¼ä½¿ç¨ç¶ç±»ä¸­çåéï¼èæ¹æ³æ¯ä¼ä½¿ç¨å­ç±»ä¸­éåçæ¹æ³çã\n * å¤æçåæ\n   * æç»§æ¿/å®ç°å³ç³»\n   * æç¶ç±»å¼ç¨æåå­ç±»å¯¹è±¡\n   * ææ¹æ³éå\n\n\n# 1.2 å¤æçä¼å¿\n\n 1. å¨å¤æå½¢å¼ä¸ï¼å³è¾¹å¯¹è±¡å¯ä»¥å®ç°è§£è¦åï¼ä¾¿äºæ©å±åç»´æ¤ã\n\nanimal a = new dog();\na.run(); // åç»­ä¸å¡è¡ä¸ºéå¯¹è±¡èåï¼åç»­ä»£ç æ éä¿®æ¹\n\n\n1\n2\n\n\nä¸è¿°ä»£ç ä¸­ï¼è¥åç»­ä¸å¡éè¦å° dog å­ç±»æ¹ä¸ºtortoise å­ç±»ï¼åç´æ¥æ¹â=âå³ä¾§çå­ç±»ç±»åå³å¯ï¼åç»­ä»£ç ä¸­çè¡ä¸ºéçå¯¹è±¡çæ¹åèç´æ¥ååäºï¼æ éä¿®æ¹å¾å¤åç»­çä»£ç ã\n\n 2. å®ä¹æ¹æ³çæ¶åï¼ä½¿ç¨ç¶ç±»åä½ä¸ºåæ°ï¼è¯¥æ¹æ³å°±å¯ä»¥æ¥æ¶è¿ç¶ç±»çä¸åå­ç±»å¯¹è±¡ï¼ä½ç°åºå¤æçæ©å±æ§ä¸ä¾¿å©\n\nå¤æä¸ä¼äº§ççä¸ä¸ªé®é¢\n\nå¤æä¸ä¸è½ä½¿ç¨å­ç±»çç¬æåè½ï¼å ä¸ºç¼è¯æ¶ä¼ä½¿ç¨å·¦ä¾§çç¶ç±»ä¸­çè¡ä¸ºã\n\nsolveï¼ä½¿ç¨å¼ºå¶ç±»åè½¬æ¢ï¼å°ç¶è½¬ä¸ºå­ç±»åã\n\n\n# 1.3 å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢\n\nå¨å¤æä¸ä¼æä¸¤ç§ç±»åè½¬æ¢ï¼\n\n * èªå¨ç±»åè½¬æ¢ï¼ä»å­å°ç¶ï¼\n * å¼ºå¶ç±»åè½¬æ¢ï¼ä»ç¶å°å­ï¼\n\nå³äºå¼ºå¶ç±»åè½¬æ¢ï¼\n\n * å­ç±»ç±»å å¯¹è±¡åé = (å­ç±»)ç¶ç±»ç±»åçåé\n   \n   ä»£ç ç¤ºä¾ï¼\n   \n   // èªå¨ç±»åè½¬æ¢\n   animal a = new dog();\n   a.run();\n   // å¼ºå¶ç±»åè½¬æ¢:å¯ä»¥å®ç°è°ç¨å­ç±»ç¬æåè½ç\n   dog d = (dog) a;\n   d.lookdoor();\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   \n\n * ä½ç¨ï¼å¯ä»¥è§£å³å¤æä¸çå£å¿ï¼å¯ä»¥å®ç°è°ç¨å­ç±»ç¬æçåè½\n\n * æ³¨æï¼ å¦æè½¬ååçç±»ååå¯¹è±¡çå®ç±»åä¸æ¯åä¸ç§ç±»åï¼é£ä¹å¨è½¬æ¢çæ¶åå°±ä¼æ¥é classcastexceptionï¼ç±»åè½¬æ¢å¼å¸¸ï¼\n\nå¼ºè½¬è½¬æ¢çä¸ç¹å»ºè®®\n\nè§å®ï¼æç»§æ¿æèå®ç°å³ç³»ç2ä¸ªç±»åå°±å¯ä»¥å¼ºå¶ç±»åè½¬æ¢ï¼æç¼è¯æ¶å¯è½æ²¡é®é¢ï¼ä½è¿è¡æ¶åç°å¼ºå¶è½¬æ¢åçç±»åä¸æ¯å¯¹è±¡çå®ç±»åèæ¥éã\n\njava å»ºè®®å¼ºè½¬è½¬æ¢åä½¿ç¨ instanceof å¤æ­å½åå¯¹è±¡ççå®ç±»åï¼åè¿è¡å¼ºå¶è½¬æ¢ã\n\nå³äº instanceof å³é®å­çä½¿ç¨ï¼\n\nåéå instanceof çå®ç±»å\n\nå¤æ­å³é®å­å·¦è¾¹çåéæåçå¯¹è±¡ççå®ç±»åï¼æ¯å¦æ¯å³è¾¹çç±»åæèæ¯å¶å­ç±»ç±»åï¼æ¯åè¿åtrueï¼åä¹falseã\n\nä»£ç ç¤ºä¾ï¼\n\npublic static void go(animal a){  // åæ°ç±»åä¸ºç¶ç±»ç±»åï¼ä¿è¯åç§å¨ç©é½å¯ä»¥ä½¿ç¨goæ¹æ³\n    system.out.println("é¢å¤~~~");\n    a.run();\n    // ç¬æåè½\n    if(a instanceof tortoise){\n        tortoise t = (tortoise) a;\n        t.layeggs();\n    }else if(a instanceof dog){\n        dog d1 = (dog) a;\n        d1.lookdoor();\n    }\n    system.out.println("ç»æ~~~~");\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 1.4 å¤æçæ¡ä¾\n\néæ±ï¼è®¾è®¡ä¸ä¸ªçµèå¯¹è±¡ï¼å¯ä»¥å®è£2ä¸ªusbè®¾å¤ãé¼ æ ï¼è¢«å®è£æ¶å¯ä»¥å®ææ¥å¥ãè°ç¨ç¹å»åè½ãæåºåè½ï¼é®çï¼è¢«å®è£æ¶å¯ä»¥å®ææ¥å¥ãè°ç¨æå­åè½ãæåºåè½ã\n\nåæï¼\n\nâ å®ä¹ä¸ä¸ªusbçæ¥å£ï¼ç³æusbè®¾å¤çè§èå¿é¡»æ¯ï¼å¯ä»¥æ¥å¥åæåºï¼ã\n\nâ¡æä¾2ä¸ªusbå®ç°ç±»ä»£è¡¨é¼ æ åé®çï¼è®©å¶å®ç°usbæ¥å£ï¼å¹¶åå«å®ä¹ç¬æåè½ã\n\nâ¢åå»ºçµèå¯¹è±¡ï¼åå»º2ä¸ªusbå®ç°ç±»å¯¹è±¡ï¼åå«å®è£å°çµèä¸­å¹¶è§¦ååè½çæ§è¡ã\n\n\n# 2. åé¨ç±»\n\n\n# 2.1 åé¨ç±»çæ¦è¿°\n\nåé¨ç±»å°±æ¯å®ä¹å¨ä¸ä¸ªç±»éé¢çç±»ï¼éé¢çç±»å¯ä»¥çè§£æï¼å¯çï¼ï¼å¤é¨ç±»å¯ä»¥çè§£æï¼å®¿ä¸»ï¼ã\n\nå¦ï¼å¿èåäººçå³ç³»ï¼\n\npublic class people{\n    // åé¨ç±»\n    public class heart{\n    }\n}\n\n\n1\n2\n3\n4\n5\n\n\n\n# 2.2 åé¨ç±»çä½¿ç¨åºæ¯ãä½ç¨\n\n * å½ä¸ä¸ªäºç©çåé¨ï¼è¿æä¸ä¸ªé¨åéè¦ä¸ä¸ªå®æ´çç»æè¿è¡æè¿°ï¼èè¿ä¸ªåé¨çå®æ´çç»æååªä¸ºå¤é¨äºç©æä¾æå¡ï¼é£ä¹æ´ä¸ªåé¨çå®æ´ç»æå¯ä»¥éæ©ä½¿ç¨åé¨ç±»æ¥è®¾è®¡ã\n * åé¨ç±»éå¸¸å¯ä»¥æ¹ä¾¿è®¿é®å¤é¨ç±»çæåï¼åæ¬ç§æçæåã\n * åé¨ç±»æä¾äºæ´å¥½çå°è£æ§ï¼åé¨ç±»æ¬èº«å°±å¯ä»¥ç¨ privateãprotected ç­ä¿®é¥°ï¼å°è£æ§å¯ä»¥åæ´å¤æ§å¶ãï¼å¤é¨ç±»åªè½ç¨ public ä¿®é¥°ï¼\n\n\n# 2.3 åé¨ç±»çåç±»\n\n# 2.3.1 éæåé¨ç±»\n\n * æstaticä¿®é¥°ï¼å±äºå¤é¨ç±»æ¬èº«\n * ç¹ç¹ãä½¿ç¨ä¸æ®éç±»æ¯ä¸æ ·çï¼ç±»æçæåå®é½æï¼åªæ¯ä½ç½®å¨å«äººéé¢èå·²\n * å¯ä»¥ç´æ¥è®¿é®å¤é¨ç±»çéææåï¼ä¸è½ç´æ¥è®¿é®å¤é¨ç±»çå®ä¾æåï¼å¯ä»¥åå»ºä¸ä¸ªå¤é¨ç±»å¯¹è±¡ï¼åè®¿é®å¶å®ä¾æåï¼\n * æ³¨æï¼å¼åä¸­å®éä¸ç¨çè¿æ¯æ¯è¾å°\n * å®ä¹ç¤ºä¾ï¼\n\npublic class outer{\n        // éææååé¨ç±»\n    public static class inner{\n    }\n}\n\n\n1\n2\n3\n4\n5\n\n * åå»ºå¯¹è±¡çæ ¼å¼ï¼outer.inner in = new outer.inner();\n\n# 2.3.2 æååé¨ç±»\n\n * æ  static ä¿®é¥°ï¼å±äºå¤é¨ç±»çå¯¹è±¡\n * jdk16 ä¹åï¼æååé¨ç±»ä¸­ä¸è½å®ä¹éææåï¼jdk 16 å¼å§ä¹å¯ä»¥å®ä¹éææåäº\n * ç¹ç¹ï¼å¯ä»¥ç´æ¥è®¿é®å¤é¨ç±»çéææåï¼å®ä¾æ¹æ³ä¸­å¯ä»¥ç´æ¥è®¿é®å¤é¨ç±»çå®ä¾æåï¼å ä¸ºå¿é¡»åæå¤é¨ç±»å¯¹è±¡ï¼æè½ææååé¨ç±»å¯¹è±¡ï¼æä»¥å¯ä»¥ç´æ¥è®¿é®å¤é¨ç±»å¯¹è±¡çå®ä¾æåï¼\n * å®ä¹ç¤ºä¾ï¼\n\npublic class outer {\n    // æååé¨ç±»\n    public class inner {        \n    }\n}\n\n\n1\n2\n3\n4\n5\n\n * åå»ºå¯¹è±¡æ ¼å¼ï¼outer.inner in = new outer().new inner(); ï¼æ³¨æå¤é¨ç±»å¯¹è±¡åé¢è¦å () ï¼\n * ç¸å³é¢è¯é¢ï¼\n   * å¨æååé¨ç±»ä¸­è®¿é®æå¨å¤é¨ç±»å¯¹è±¡ï¼æ ¼å¼ï¼å¤é¨ç±»å.this.valueï¼å¦ï¼system.out.println(people.this.heartbeat);\n   * è®¿é®å½åå¯¹è±¡çæååéï¼è¦ç¨ this.value\n\n# 2.3.3 å±é¨åé¨ç±»\n\n * é¸¡èè¯­æ³ï¼äºè§£å³å¯\n * å±é¨åé¨ç±»æ¾å¨æ¹æ³ãä»£ç åãæé å¨ç­æ§è¡ä½ä¸­\n * å±é¨åé¨ç±»ç¼è¯åä¹ä¼æå¯¹åºçç±»æä»¶ï¼å¶ç±»æä»¶åä¸ºï¼ å¤é¨ç±»$nåé¨ç±».class\n\n# 2.3.4 å¿ååé¨ç±»\n\n * æ¬è´¨ä¸æ¯ä¸ä¸ªæ²¡æåå­çå±é¨åé¨ç±»ï¼å®ä¹å¨æ¹æ³ä¸­ãä»£ç åä¸­ãç­\n\n * ä½ç¨ï¼æ¹ä¾¿åå»ºå­ç±»å¯¹è±¡ï¼æç»ç®çä¸ºäºç®åä»£ç ç¼å\n\n * ç¹ç¹\n   \n   * å¿ååé¨ç±»ååºæ¥å°±ä¼äº§çä¸ä¸ªå¿ååé¨ç±»çå¯¹è±¡\n   * å¿ååé¨ç±»çå¯¹è±¡ç±»åç¸å½äºæ¯å½å new çé£ä¸ªçç±»åçå­ç±»ç±»åï¼å¯ä»¥è§ä¸ºæ¯ animal çå­ç±» tiger ç±»ï¼\n\n * æ ¼å¼\n\nnew ç±»|æ½è±¡ç±»å|æèæ¥å£å() {\n    éåæ¹æ³;\n};\n\n\n1\n2\n3\n\n\nanimal a = new animal() {\n    public void run() {\n    }\n};\na. run();\n\n\n1\n2\n3\n4\n5\n\n\nâ ï¸ ç´æ¥ new abstract_class() æ¯ä¸å¯ä»¥çï¼æåé¢å ä¸ {} è¿è¡æ¹æ³çéåï¼å®ç°ä¸ä¸ªå¿ååé¨ç±»ã\n\nç®åç¤ºä¾ï¼\n\nline3 ç­å·å ~ line8 çé¨åç¸å½äº tiger ç±»äºã\n\npublic class test {\n    public static void main(string[] args) {\n        animal a = new animal(){\n            @override\n            public void run() {\n                system.out.println("èèè·çå~~~");\n            }\n        };\n        a.run();\n    }\n}\n\n//class tiger extends animal{\n//    @override\n//    public void run() {\n//        system.out.println("èèè·çå~~~");\n//    }\n//}\n\nabstract class animal{\n    public abstract void run();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# 2.3.5 å¿ååé¨ç±»å¸¸è§ä½¿ç¨å½¢å¼\n\nå¿ååé¨ç±»éå¸¸ä½ä¸ºæ¹æ³çå®éåæ°è¿è¡ä¼ è¾ã\n\nç¤ºä¾ä»£ç ï¼\n\npublic class test2 {\n    public static void main(string[] args) {\n        \n        go(new swimming() {\n            @override\n            public void swim() {\n                system.out.println("è¿å¨åæ³³ðçè´¼å¿«~~~~~");\n            }\n        });\n\n    /**\n       å­¦ç èå¸ è¿å¨åå¯ä»¥ä¸èµ·åå æ¸¸æ³³æ¯èµ\n     */\n    public static void go(swimming s){\n        system.out.println("å¼å§ããã");\n        s.swim();\n        system.out.println("ç»æããã");\n    }\n}\n    \ninterface swimming{\n    void swim();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¯¹è±¡åè°ï¼\n\næç¤º\n\nå¼åä¸­ä¸æ¯æä»¬ä¸»å¨å»å®ä¹å¿ååé¨ç±»çï¼èæ¯å«äººéè¦æä»¬åæèæä»¬å¯ä»¥åçæ¶åæä¼ä½¿ç¨ã\n\nå¿ååé¨ç±»çä»£ç å¯ä»¥å®ç°ä»£ç è¿ä¸æ­¥çç®åã\n\n\n# 3. å¸¸ç¨ api\n\n\n# 3.1 object ç±»\n\n * object ç±»çæ¹æ³æ¯ä¸åå­ç±»å¯¹è±¡é½å¯ä»¥ç´æ¥ä½¿ç¨çï¼æä»¥æä»¬è¦å­¦ä¹  object ç±»çæ¹æ³ã\n\n * ä¸ä¸ªç±»è¦ä¹é»è®¤ç»§æ¿äº object ç±»ï¼è¦ä¹é´æ¥ç»§æ¿äº object ç±»ï¼object ç±»æ¯ java ä¸­çç¥å®ç±»\n\n * objectç±»çå¸¸ç¨æ¹æ³\n\næ¹æ³å                               è¯´æ\npublic string tostring()          é»è®¤æ¯è¿åå½åå¯¹è±¡å¨å åå­ä¸­çå°åä¿¡æ¯:ç±»çå¨éå@åå­å°å\npublic boolean equals(object o)   é»è®¤æ¯æ¯è¾å½åå¯¹è±¡ä¸å¦ä¸ä¸ªå¯¹è±¡çå°åæ¯å¦ç¸åï¼ç¸åè¿åtrueï¼ä¸åè¿åfalse\n\n * ä¸è¬ç´æ¥å¨ idea ä¸­èªå¨éåå¯¹åºç±»çè¿ä¸¤ä¸ªæ¹æ³å³å¯ã\n\ntostring æ¹æ³ï¼\n\nå ä¸º tostring é»è®¤è¾åºå¯¹è±¡çå°åå¨å¼åä¸­æ¯«æ æä¹ï¼æ´å¤æ¯å¸æçå°å¯¹è±¡çåå®¹æ°æ®ï¼\n\ntostring æ¹æ³å­å¨çæä¹å°±æ¯ä¸ºäºè¢«å­ç±»éåï¼ä»¥ä¾¿è¿åå¯¹è±¡çåå®¹ä¿¡æ¯ï¼èä¸æ¯å°åä¿¡æ¯\n\nequals æ¹æ³ï¼\n\nç´æ¥æ¯è¾ä¸¤ä¸ªå¯¹è±¡çå°åæ¯å¦ç¸åå®å¨å¯ä»¥ç¨ â==â æ¿ä»£ equals\n\nç¶ç±» equals æ¹æ³å­å¨çæä¹å°±æ¯ä¸ºäºè¢«å­ç±»éåï¼ä»¥ä¾¿å­ç±»èªå·±æ¥å®å¶æ¯è¾è§å\n\n\n# 3.2 objects ç±»\n\nobjects æ¯ä¸ä¸ªå·¥å·ç±»ï¼æä¾äºä¸äºæ¹æ³å»å®æä¸äºåè½\n\nobjects ç±»ä¸ object ç±»ä¹æ¯ç»§æ¿å³ç³»ã\n\nobjects ç±»æ¯ä» jdk1.7 ä¹åææçã\n\nå®æ¹å¨è¿è¡å­ç¬¦ä¸²æ¯è¾æ¶ï¼èªå¨éåç equals æ¹æ³ï¼ï¼æ²¡æç¨å­ç¬¦ä¸²å¯¹è±¡çç equals æ¹æ³ï¼èæ¯éæ©äº objects ç equals æ¹æ³æ¥æ¯è¾ã\n\nåå ï¼ä½¿ç¨objects ç equals æ¹æ³å¨è¿è¡å¯¹è±¡çåå®¹æ¯è¾æ¶ä¼æ´å®å¨ã\n\nä½¿ç¨ objects ç equals æ¹æ³å¨è¿è¡å¯¹è±¡çåå®¹æ¯è¾æ¶æ´å®å¨çåå \n\nobjects ç equals æ¹æ³å¨æ¯è¾æ¶ï¼åºå±ä¼åè¿è¡éç©ºå¤æ­ï¼ä»èå¯ä»¥é¿åç©ºæéå¼å¸¸ãåè¿è¡ equals æ¯è¾\n\næºç åæï¼\n\npublic static boolean equals(object a, object b) {\n    return (a == b) || (a != null && a.equals(b));\n}\n\n\n1\n2\n3\n\n\nè¥ç´æ¥ä½¿ç¨ equals æ¹æ³æ¯è¾æ¶ï¼å¯è½ä¼åºç°ç©ºæéå¼å¸¸ï¼ä¾å¦ï¼\n\npublic class test {\n    public static void main(string[] args) {\n        string s1 = null;\n        string s2 = new string("itheima");\n\n        // system.out.println(s1.equals(s2));   // çä¸äºéæ£ï¼å¯è½åºç°ç©ºæéå¼å¸¸ã\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nstring ç equals æ¹æ³ vs ç±»ç equals æ¹æ³\n\nå­ç¬¦ä¸²å¯ä»¥ç´æ¥ç¨ equals æ¯è¾åå®¹ï¼å ä¸º string ç±»å·²ç»éåè¿è¯¥æ¹æ³äºï¼ä½èªå®ä¹çç±»è¦éå equals æ¹æ³ã\n\nâ ï¸ string ä¸è½ç¨ â==â æ¯è¾åå®¹æ¯å¦ä¸æ ·ï¼å ä¸º â==â ä¼è§ä¸ºæ¯è¾çäºèä¸ºä¸åçå¯¹è±¡\n\n\n# 3.3 stringbuilder ç±»\n\n * stringbuilder æ¯ä¸ä¸ªå¯åçå­ç¬¦ä¸²ç±»ï¼æä»¬å¯ä»¥æå®çææ¯ä¸ä¸ªå¯¹è±¡å®¹å¨ãï¼string æ¯ä¸å¯åå­ç¬¦ä¸²ç±»ï¼\n\n * ä½ç¨ï¼æé«å­ç¬¦ä¸²çæä½æçï¼å¦æ¼æ¥ãä¿®æ¹ç­ã\n\n * stringbuilder å¸¸ç¨æ¹æ³\n\næ¹æ³åç§°                                è¯´æ\npublic stringbuilder append(ä»»æç±»å)   æ·»å æ°æ®å¹¶è¿åstringbuilderå¯¹è±¡æ¬èº«\npublic stringbuilder reverse()      å°å¯¹è±¡çåå®¹åè½¬ï¼ä¼ç´æ¥å°å¯¹è±¡æ¬èº«ä¿®æ¹\npublic int length()                 è¿åå¯¹è±¡åå®¹é¿åº¦\npublic string tostring()            éè¿tostring()å°±å¯ä»¥å®ç°æstringbuilderè½¬æ¢ä¸ºstring\n\n * stringbuilder æ¯æé¾å¼ç¼ç¨ï¼e.g. sb1.append("a").append("b").append("c").append("æç±ä½ ä¸­å½");\n\nâ ï¸ æ³¨æï¼stringbuilder åªæ¯æ¼æ¥å­ç¬¦ä¸²çææ®µï¼æçå¥½ï¼ä½¿ç¨æ¶æç»è¿æ¯è¦è½¬æ stringã ç¨ tostring æ¢å¤ stringãæ å®ä¹å­ç¬¦ä¸²ç¨ stringï¼æ¼æ¥ãä¿®æ¹ç­æä½å­ç¬¦ä¸²ä½¿ç¨ stringbuilderã\n\nç¤ºä¾ä»£ç ï¼\n\nstringbuilder sb2 = new stringbuilder();\nsb2.append("123").append("456");\n// æ¢å¤æstringç±»å\nstring rs = sb2.tostring();\ncheck(rs); // ä½¿ç¨å­ç¬¦ä¸²\n\npublic static void check(string data){\n    system.out.println(data);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\nåå­åç\n\nstring ç±»æ¼æ¥å­ç¬¦ä¸²æ¶ï¼ä¸ä¸ªå å·ä¼å¯¼è´å åå­ä¸­åå»ºä¸¤ä¸ªå¯¹è±¡ï¼ä¸ä¸ªæ¯æ¼æ¥æ¶ç stringbuilder å¯¹è±¡ï¼ä¸ä¸ªæ¯æ¼å¥½åè½¬æ¢è¿å»ç string å¯¹è±¡ã\n\n\n\nstringbuilder ç±»æ¼æ¥å­ç¬¦ä¸²æ¶ï¼åªä¼å¨å åå­ä¸­åå»ºä¸ä¸ª stringbuilder å¯¹è±¡ï¼æææ¼æ¥æä½é½å¨è¿ä¸ªå¯¹è±¡ä¸­å®æãæçåé«ã\n\n\n\n\n# 3.4 math ç±»\n\nåå«æ§è¡åºæ¬æ°å­è¿ç®çæ¹æ³ï¼mathç±»æ²¡ææä¾å¬å¼çæé å¨\n\n**å¦ä½ä½¿ç¨ç±»ä¸­çæåå¢ï¼**çç±»çæåæ¯å¦é½æ¯éæçï¼å¦ææ¯ï¼éè¿ç±»åå°±å¯ä»¥ç´æ¥è°ç¨\n\nmath ç±»çå¸¸ç¨æ¹æ³\n\næ¹æ³å                                           è¯´æ\npublic static int abs(int a)                  è·ååæ°ç»å¯¹å¼\npublic static double ceil(double a)           åä¸åæ´\npublic static double floor(double a)          åä¸åæ´\npublic static int round(float a)              åèäºå¥\npublic static int max(int a,int b)            è·åä¸¤ä¸ªintå¼ä¸­çè¾å¤§å¼\npublic static double pow(double a,double b)   è¿åaçbæ¬¡å¹çå¼\npublic static double random()                 è¿åå¼ä¸ºdoubleçéæºå¼ï¼èå´[0.0,1.0)\n\n\n# 3.5 system ç±»\n\nsystem ä¹æ¯ä¸ä¸ªå·¥å·ç±»ï¼ä»£è¡¨äºå½åç³»ç»ï¼æä¾äºä¸äºä¸ç³»ç»ç¸å³çæ¹æ³\n\nsystem ç±»çå¸¸ç¨æ¹æ³\n\næ¹æ³å                                                            è¯´æ\npublic static void exit(int status)                            ç»æ­¢å½åè¿è¡ç java èææºï¼éé¶è¡¨ç¤ºå¼å¸¸ç»æ­¢\npublic static long currenttimemillis()                         è¿åå½åç³»ç»çæ¶é´æ¯«ç§å¼å½¢å¼\npublic static void arraycopy(æ°æ®æºæ°ç», èµ·å§ç´¢å¼, ç®çå°æ°ç», èµ·å§ç´¢å¼, æ·è´ä¸ªæ°)   æ°ç»æ·è´ ï¼äºè§£ï¼\n\næ³¨æï¼system.exit() ç¸å½äºå åºè·è·¯ï¼å¯ä¸è½çç¨ï¼ï¼ï¼\n\nå³äºæ¶é´æ¯«ç§å¼ï¼\n\n * è®¡ç®æºè®¤ä¸ºæ¶é´æ¯æèµ·ç¹çï¼èµ·å§æ¶é´ï¼ 1970å¹´1æ1æ¥ 00:00:00\n\n * æ¶é´æ¯«ç§å¼ï¼æçæ¯ä»1970å¹´1æ1æ¥ 00:00:00èµ°å°æ­¤å»çæ»çæ¯«ç§æ°ï¼åºè¯¥æ¯å¾å¤§çã 1s = 1000msã\n\n * system.currenttimemillis() å¯ä»¥ç¨æ¥è¿è¡æ¶é´çè®¡ç®ï¼æ§è½åæã\n\n\n# 3.6 bigdecimal ç±»\n\nï¼å¤§æ°æ®ç±»åï¼ç¨äºè§£å³æµ®ç¹åè¿ç®ç²¾åº¦å¤±ççé®é¢\n\næµ®ç¹åè¿ç®çæ¶åç´æ¥+ * / å¯è½ä¼åºç°æ°æ®å¤±çï¼ç²¾åº¦é®é¢ï¼ã\n\nbigdecimal çä½¿ç¨ï¼\n\nåå»ºå¯¹è±¡ bigdecimal å°è£æµ®ç¹åæ°æ®ï¼æå¥½çæ¹å¼æ¯è°ç¨æ¹æ³ï¼\n\nâ ï¸ é¿éå¼åè§èï¼ç¦æ­¢ä½¿ç¨æé æ¹æ³ bigdecimal(double)çæ¹å¼æ double å¼è½¬åä¸º bigderimal å¯¹è±¡ã\n\nåå ï¼bigdecimal(double)å­å¨ç²¾åº¦æå¤±é£é©ï¼å¨ç²¾ç¡®è®¡ç®æå¼æ¯è¾çåºæ¯ä¸­å¯è½ä¼å¯¼è´ä¸å¡é»è¾å¼å¸¸ãå¦:bigdecimalg = new bigdecimal(0.1f);å®éçå­å¨å¼ä¸º:0.10000000149\n\næ­£ä¾ï¼ä¼åæ¨èå¥åä¸ºstring çæé æ¹æ³ï¼æä½¿ç¨ bigdecimal ç valueof æ¹æ³ï¼æ­¤æ¹æ³åé¨å¶å®æ§è¡äºdouble ç tostringï¼è double ç tostring æ double çå®éè½è¡¨è¾¾çç²¾åº¦å¯¹å°¾æ°è¿è¡äºæªæ­ã\n\nbigdecimal recommend1 = new bigdecimal("0.1");\n\nbigdecimal recommend2 = bigdecimal.valueof(0.1);\n\nâ ï¸ æ³¨æï¼bigdecimal åªæ¯ææ®µï¼æçå¥½ï¼ä½¿ç¨æ¶æç»è¿æ¯è¦è½¬æ å¯¹åºç double æ°æ®ç±»åã ä½¿ç¨ doublevalue() è½¬ä¸º doubleã\n\nç¤ºä¾ä»£ç ï¼\n\n// åè£æµ®ç¹åæ°æ®æä¸ºå¤§æ°æ®å¯¹è±¡ bigdeciaml\nbigdecimal a1 = bigdecimal.valueof(a);\nbigdecimal b1 = bigdecimal.valueof(b);\nbigdecimal c1 = a1.add(b1);\n// bigdecimal c1 = a1.subtract(b1);\n// bigdecimal c1 = a1.multiply(b1);\n// bigdecimal c1 = a1.divide(b1);\nsystem.out.println(c1);\n\n// ç®çï¼double\ndouble rs = c1.doublevalue();\nsystem.out.println(rs);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nâ ï¸ bigdecimal æ¯ä¸å®è¦ç²¾åº¦è¿ç®ç\n\nå¦ï¼10/3 å°±æ æ³ç²¾ç¡®è¿ç®ï¼æ bigdecimal ä¼æåºå¼å¸¸ã\n\nsolveï¼ public bigdecimal divide (å¦ä¸ä¸ªbigdecimalå¯¹è±¡ï¼ç²¾ç¡®å ä½ï¼èå¥æ¨¡å¼)',charsets:{cjk:!0},lastUpdated:"2023/03/15, 14:34:12",lastUpdatedTimestamp:1678890852e3},{title:"é¢åå¯¹è±¡è¿é¶4ï¼å¸¸ç¨æ¥æAPIãæ­£åãArraysç±»ãLambdaï¼",frontmatter:{title:"é¢åå¯¹è±¡è¿é¶4ï¼å¸¸ç¨æ¥æAPIãæ­£åãArraysç±»ãLambdaï¼",date:"2023-03-12T10:11:10.000Z",permalink:"/pages/4cb625/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/33.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B64%EF%BC%88%E5%B8%B8%E7%94%A8%E6%97%A5%E6%9C%9FAPI%E3%80%81%E6%AD%A3%E5%88%99%E3%80%81Arrays%E7%B1%BB%E3%80%81Lambda%EF%BC%89.html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/33.é¢åå¯¹è±¡è¿é¶4ï¼å¸¸ç¨æ¥æAPIãæ­£åãArraysç±»ãLambdaï¼.md",key:"v-433c42bb",path:"/pages/4cb625/",headers:[{level:2,title:"1. æ¥æä¸æ¶é´",slug:"_1-æ¥æä¸æ¶é´",normalizedTitle:"1. æ¥æä¸æ¶é´",charIndex:41},{level:3,title:"1.1 Date ç±»",slug:"_1-1-date-ç±»",normalizedTitle:"1.1 date ç±»",charIndex:88},{level:3,title:"1.2 SimpleDateFormat",slug:"_1-2-simpledateformat",normalizedTitle:"1.2 simpledateformat",charIndex:593},{level:3,title:"1.3 Calendar",slug:"_1-3-calendar",normalizedTitle:"1.3 calendar",charIndex:1020},{level:2,title:"2. JDK8 æ°å¢æ¥æç±»",slug:"_2-jdk8-æ°å¢æ¥æç±»",normalizedTitle:"2. jdk8 æ°å¢æ¥æç±»",charIndex:1557},{level:3,title:"2.1 LocalDateãLocalTimeãLocalDateTime",slug:"_2-1-localdateãlocaltimeãlocaldatetime",normalizedTitle:"2.1 localdateãlocaltimeãlocaldatetime",charIndex:1937},{level:3,title:"2.2 Instant æ¶é´æ³",slug:"_2-2-instant-æ¶é´æ³",normalizedTitle:"2.2 instant æ¶é´æ³",charIndex:3722},{level:3,title:"2.3 DateTimeFormatter",slug:"_2-3-datetimeformatter",normalizedTitle:"2.3 datetimeformatter",charIndex:4139},{level:3,title:"2.4 Duration/Period/ChronoUnit",slug:"_2-4-duration-period-chronounit",normalizedTitle:"2.4 duration/period/chronounit",charIndex:5080},{level:4,title:"2.4.1 Period ç±»",slug:"_2-4-1-period-ç±»",normalizedTitle:"2.4.1 period ç±»",charIndex:5246},{level:4,title:"2.4.2 Duration ç±»",slug:"_2-4-2-duration-ç±»",normalizedTitle:"2.4.2 duration ç±»",charIndex:5914},{level:4,title:"2.4.3 ChronoUnit ç±»",slug:"_2-4-3-chronounit-ç±»",normalizedTitle:"2.4.3 chronounit ç±»",charIndex:6759},{level:2,title:"3. åè£ç±»",slug:"_3-åè£ç±»",normalizedTitle:"3. åè£ç±»",charIndex:8542},{level:2,title:"4. æ­£åè¡¨è¾¾å¼",slug:"_4-æ­£åè¡¨è¾¾å¼",normalizedTitle:"4. æ­£åè¡¨è¾¾å¼",charIndex:9749},{level:2,title:"5. Arrays ç±»",slug:"_5-arrays-ç±»",normalizedTitle:"5. arrays ç±»",charIndex:12140},{level:2,title:"6. Lambda è¡¨è¾¾å¼",slug:"_6-lambda-è¡¨è¾¾å¼",normalizedTitle:"6. lambda è¡¨è¾¾å¼",charIndex:13781}],headersStr:"1. æ¥æä¸æ¶é´ 1.1 Date ç±» 1.2 SimpleDateFormat 1.3 Calendar 2. JDK8 æ°å¢æ¥æç±» 2.1 LocalDateãLocalTimeãLocalDateTime 2.2 Instant æ¶é´æ³ 2.3 DateTimeFormatter 2.4 Duration/Period/ChronoUnit 2.4.1 Period ç±» 2.4.2 Duration ç±» 2.4.3 ChronoUnit ç±» 3. åè£ç±» 4. æ­£åè¡¨è¾¾å¼ 5. Arrays ç±» 6. Lambda è¡¨è¾¾å¼",content:'# é¢åå¯¹è±¡è¿é¶4ï¼å¸¸ç¨æ¥æAPIãæ­£åãArraysç±»ãLambdaï¼\n\n\n# 1. æ¥æä¸æ¶é´\n\n> è¿é¨åçåå®¹äºè§£å³å¯ï¼JDK8 æ°å¢çæ¥æç±»æ¯æ¬é¨åä¸­çå¥½ç¨\n\n\n# 1.1 Date ç±»\n\nDate ç±»ä»£è¡¨å½åæå¨ç³»ç»çæ¥ææ¶é´ä¿¡æ¯\n\næé å¨\n\nåç§°                       è¯´æ\npublic Date()            åå»ºä¸ä¸ªDateå¯¹è±¡ï¼ä»£è¡¨çæ¯ç³»ç»å½åæ­¤å»æ¥ææ¶é´ã\npublic Date(long time)   ææ¶é´æ¯«ç§å¼è½¬æ¢æDateæ¥æå¯¹è±¡\n\nå¸¸ç¨æ¹æ³\n\nåç§°                               è¯´æ\npublic long getTime()            è¿åä»1970å¹´1æ1æ¥ 00:00:00èµ°å°æ­¤å»çæ»çæ¯«ç§æ°\npublic void setTime(long time)   è®¾ç½®æ¥æå¯¹è±¡çæ¶é´ä¸ºå½åæ¶é´æ¯«ç§å¼å¯¹åºçæ¶é´\n\n * æ¥æå¯¹è±¡å¦ä½åå»ºï¼å¦ä½è·åæ¶é´æ¯«ç§å¼ï¼\n   \n   * public Date();\n   \n   * public long getTime();\n\n * æ¶é´æ¯«ç§å¼æä¹æ¢å¤ææ¥æå¯¹è±¡?\n   \n   * public Date(long time);\n   \n   * public void setTime(long time);\n\n\n# 1.2 SimpleDateFormat\n\nä½ç¨ï¼\n\n 1. å®ææ¥ææ¶é´çæ ¼å¼åæä½\n    \n    public SimpleDateFormat(String pattern)ï¼æé ä¸ä¸ªSimpleDateFormatï¼ä½¿ç¨æå®çæ ¼å¼\n    \n    æ ¼å¼åæ¹æ³                                     è¯´æ\n    public final String format(Date date)     å°æ¥ææ ¼å¼åææ¥æ/æ¶é´å­ç¬¦ä¸²\n    public final String format(Object time)   å°æ¶é´æ¯«ç§å¼å¼åææ¥æ/æ¶é´å­ç¬¦ä¸²\n\n 2. è§£æå­ç¬¦ä¸²æ¶é´æä¸ºæ¥æå¯¹è±¡\n    \n    2011-11-11 11:11:22 -> Dateæ¥æå¯¹è±¡\n    \n    public Date parse(String source)ï¼ä»ç»å®å­ç¬¦ä¸²çå¼å§è§£æææ¬ä»¥çææ¥æ\n\n\n# 1.3 Calendar\n\n * Calendarä»£è¡¨äºç³»ç»æ­¤å»æ¥æå¯¹åºçæ¥åå¯¹è±¡\n\n * Calendaræ¯ä¸ä¸ªæ½è±¡ç±»ï¼ä¸è½ç´æ¥åå»ºå¯¹è±¡\n   \n   Calendaræ¥åç±»åå»ºæ¥åå¯¹è±¡çæ¹æ³ï¼public static Calendar getInstance()ï¼è·åå½åæ¥åå¯¹è±¡\n\n * Calendarå¸¸ç¨æ¹æ³\n   \n   æ¹æ³å                                     è¯´æ\n   public int get(int field)               åæ¥æä¸­çæä¸ªå­æ®µä¿¡æ¯ã\n   public void set(int field,int value)    ä¿®æ¹æ¥åçæä¸ªå­æ®µä¿¡æ¯ã\n   public void add(int field,int amount)   ä¸ºæä¸ªå­æ®µå¢å /åå°æå®çå¼\n   public final Date getTime()             æ¿å°æ­¤å»æ¥æå¯¹è±¡ã\n   public long getTimeInMillis()           æ¿å°æ­¤å»æ¶é´æ¯«ç§å¼\n\nâ ï¸ **æ³¨æï¼calendaræ¯å¯åæ¥æå¯¹è±¡ï¼ä¸æ¦ä¿®æ¹åå¶å¯¹è±¡æ¬èº«è¡¨ç¤ºçæ¶é´å°äº§çåå\n\n\n# 2. JDK8 æ°å¢æ¥æç±»\n\n * ä»Java 8å¼å§ï¼java.timeåæä¾äºæ°çæ¥æåæ¶é´APIï¼ä¸»è¦æ¶åçç±»åæï¼\n   \n   * LocalDateï¼ä¸åå«å·ä½æ¶é´çæ¥æã\n   \n   * LocalTimeï¼ä¸å«æ¥æçæ¶é´ã\n   \n   * LocalDateTimeï¼åå«äºæ¥æåæ¶é´ã\n   \n   * Instantï¼ä»£è¡¨çæ¯æ¶é´æ³ã\n   \n   * DateTimeFormatter ç¨äºåæ¶é´çæ ¼å¼ååè§£æç\n   \n   * Duration:ç¨äºè®¡ç®ä¸¤ä¸ªâæ¶é´âé´é\n   \n   * Period:ç¨äºè®¡ç®ä¸¤ä¸ªâæ¥æâé´é\n\n * æ°å¢çAPIä¸¥æ ¼åºåäºæ¶å»ãæ¬å°æ¥æãæ¬å°æ¶é´ï¼å¹¶ä¸ï¼å¯¹æ¥æåæ¶é´è¿è¡è¿ç®æ´å æ¹ä¾¿\n\n * æ°APIçç±»åå ä¹å¨é¨æ¯ä¸åç±»åï¼åStringçä½¿ç¨ç±»ä¼¼ï¼ï¼å¯ä»¥æ¾å¿ä½¿ç¨ä¸å¿æå¿è¢«ä¿®æ¹\n\n\n# 2.1 LocalDateãLocalTimeãLocalDateTime\n\nåå«è¡¨ç¤ºæ¥æãæ¶é´ãæ¥ææ¶é´å¯¹è±¡ï¼ä»ä»¬çç±»çå®ä¾æ¯ä¸å¯åçå¯¹è±¡ï¼ä»ä»¬ä¸èæå»ºå¯¹è±¡åAPIé½æ¯éç¨ç\n\næå»ºå¯¹è±¡çæ¹å¼å¦ä¸ï¼\n\næ¹æ³å                         è¯´æ                 \npublic static Xxxx now();   éææ¹æ³ï¼æ ¹æ®å½åæ¶é´åå»ºå¯¹è±¡    LocaDate localDate = LocalDate.now(); LocalTime llocalTime =\n                                               LocalTime.now(); LocalDateTime localDateTime =\n                                               LocalDateTime.now();\npublic static Xxxx of(â¦);   éææ¹æ³ï¼æå®æ¥æ/æ¶é´åå»ºå¯¹è±¡   LocalDate localDate1 = LocalDate.of(2099 , 11,11); LocalTime\n                                               localTime1 = LocalTime.of(11, 11, 11); LocalDateTime\n                                               localDateTime1 = LocalDateTime.of(2020, 10, 6, 13, 23, 43);\n\nLocalDateãLocalTimeãLocalDateTimeè·åä¿¡æ¯çAPIï¼\n\næ¹æ³å                               è¯´æ\npublic int geYear()               è·åå¹´\npublic int getMonthValue()        è·åæä»½ï¼1-12ï¼\nPublic int getDayOfMonth()        è·åæä¸­ç¬¬å å¤©ä¹æ³\nPublic int getDayOfYear()         è·åå¹´ä¸­ç¬¬å å¤©\nPublic DayOfWeek getDayOfWeek()   è·åææ\n\næç¤º\n\nå·ä½ä½¿ç¨æ¶æ¥ç IDEA æç¤ºçæ¹æ³å³å¯\n\nè½¬æ¢ç¸å³ APIï¼\n\nLocalDateTimeçè½¬æ¢APIï¼\n\næ¹æ³å                              è¯´æ\npublic LocalDate toLocalDate()   è½¬æ¢æä¸ä¸ªLocalDateå¯¹è±¡\npublic LocalTime toLocalTime()   è½¬æ¢æä¸ä¸ªLocalTimeå¯¹è±¡\n\nåæ¶é´ä¿®æ¹ç¸å³ç APIï¼\n\nLocalDateTime ç»¼åäº LocalDate å LocalTime éé¢çæ¹æ³ï¼æä»¥ä¸é¢åªç¨ LocalDate å LocalTime æ¥ä¸¾ä¾ãè¿äºæ¹æ³è¿åçæ¯ä¸ä¸ªæ°çå®ä¾å¼ç¨ï¼å ä¸ºLocalDateTime ãLocalDate ãLocalTime é½æ¯ä¸å¯åç\n\næ¹æ³å                                                  è¯´æ\nplusDays, plusWeeks, plusMonths, plusYears           åå½å LocalDate å¯¹è±¡æ·»å å å¤©ã å å¨ãå ä¸ªæãå å¹´\nminusDays, minusWeeks, minusMonths, minusYears       ä»å½å LocalDate å¯¹è±¡åå»å å¤©ã å å¨ãå ä¸ªæãå å¹´\nwithDayOfMonth, withDayOfYear, withMonth, withYear   å°æä»½å¤©æ°ãå¹´ä»½å¤©æ°ãæä»½ãå¹´ ä»½ ä¿® æ¹ ä¸º æ å® ç å¼ å¹¶ è¿ å æ° ç LocalDate å¯¹è±¡\nisBefore, isAfter, equals                            æ¯è¾ä¸¤ä¸ª LocalDate\n\n\n# 2.2 Instant æ¶é´æ³\n\nJDK8 è·åæ¶é´æ³ç¹å«ç®åï¼ä¸åè½æ´ä¸°å¯ãInstant ç±»ç±ä¸ä¸ªéæçå·¥åæ¹æ³ now() å¯ä»¥è¿åå½åæ¶é´æ³\n\nÂ \n\n\nÂ \n\n\nÂ \n\n\n\nInstant instant = Instant.now();\n System.out.println("å½åæ¶é´æ³æ¯ï¼" + instant);\n\n Date date = Date.from(instant);\n System.out.println("å½åæ¶é´æ³æ¯ï¼" + date);\n\n instant = date.toInstant();\n System.out.println(instant);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nð¡ æ¶é´æ³æ¯åå«æ¥æåæ¶é´çï¼ä¸ java.util.Date å¾ç±»ä¼¼ï¼äºå®ä¸ Instant å°±æ¯ç±»ä¼¼ JDK8 ä»¥åç Dateã\n\nð¡ InstantåDateè¿ä¸¤ä¸ªç±»å¯ä»¥è¿è¡è½¬æ¢\n\n\n# 2.3 DateTimeFormatter\n\nå¨ JDK8 ä¸­ï¼å¼å¥äºä¸ä¸ªå¨æ°çæ¥æä¸æ¶é´æ ¼å¼å¨ DateTimeFormatterï¼æ­£åé½è½è°ç¨formatæ¹æ³ã\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\npublic class Demo06DateTimeFormat {\n    public static void main(String[] args) {\n        // æ¬å°æ­¤å»  æ¥ææ¶é´ å¯¹è±¡\n        LocalDateTime ldt = LocalDateTime.now();\n        System.out.println(ldt);\n\n        // è§£æ/æ ¼å¼åå¨\n        DateTimeFormatter dtf = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss EEE a");\n        // æ­£åæ ¼å¼åï¼å¯¹è±¡è°ç¨å¯ä»¥çæï¼\n        System.out.println(dtf.format(ldt));\n        // éåæ ¼å¼å\n        System.out.println(ldt.format(dtf));\n\n        // è§£æå­ç¬¦ä¸²æ¶é´\n        DateTimeFormatter dtf1 = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");\n        // è§£æå½åå­ç¬¦ä¸²æ¶é´æä¸ºæ¬å°æ¥ææ¶é´å¯¹è±¡\n        LocalDateTime ldt1 = LocalDateTime.parse("2019-11-11 11:11:11" ,  dtf1);\n        System.out.println(ldt1);\n        System.out.println(ldt1.getDayOfYear());\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\næ ¼å¼åçæ¶é´å½¢å¼çå¸¸ç¨çæ¨¡å¼å¯¹åºå³ç³»å¦ä¸ï¼\n\n\n# 2.4 Duration/Period/ChronoUnit\n\nJDK8 ä¸­ï¼ç¨æ¥è®¡ç®ä¸¤ä¸ª**âæ¥æâé´éçç±»ï¼java.time.Periodï¼ç¨æ¥è®¡ç®ä¸¤ä¸ªâæ¶é´âé´é**çç±»ï¼java.time.Durationã\n\næå¨çå·¥å·ç±»ï¼java.time.temporal.ChronoUnitï¼å¯ä»¥ç¨äºæ¯è¾ææçæ¶é´åä½ã\n\n# 2.4.1 Period ç±»\n\nä¸»è¦æ¯ Period ç±»æ¹æ³ getYears()ï¼getMonths() å getDays() æ¥è®¡ç®,åªè½ç²¾ç¡®å°å¹´ææ¥ã\n\nç¨äº LocalDate ä¹é´çæ¯è¾\n\nç¤ºä¾ä»£ç ï¼\n\npublic class Demo07Period {\n    public static void main(String[] args) {\n        // å½åæ¬å° å¹´ææ¥\n        LocalDate today = LocalDate.now();\n        System.out.println(today);//\n\n        // çæ¥ç å¹´ææ¥\n        LocalDate birthDate = LocalDate.of(1998, 10, 13);\n        System.out.println(birthDate);\n\n        Period period = Period.between(birthDate, today);//ç¬¬äºä¸ªåæ°åç¬¬ä¸ä¸ªåæ°\n\n        System.out.println(period.getYears());\n        System.out.println(period.getMonths());\n        System.out.println(period.getDays());\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# 2.4.2 Duration ç±»\n\næä¾äºä½¿ç¨åºäºæ¶é´çå¼æµéæ¶é´éçæ¹æ³\n\nç¨äº LocalDateTime ä¹é´çæ¯è¾ãä¹å¯ç¨äº Instant ä¹é´çæ¯è¾\n\nç¤ºä¾ä»£ç ï¼\n\npublic class Demo08Duration {\n    public static void main(String[] args) {\n        // æ¬å°æ¥ææ¶é´å¯¹è±¡ã\n        LocalDateTime today = LocalDateTime.now();\n        System.out.println(today);\n\n        // åºççæ¥ææ¶é´å¯¹è±¡\n        LocalDateTime birthDate = LocalDateTime.of(2021,8,06,01,00,00);\n\n        System.out.println(birthDate);\n\n        Duration duration = Duration.between(today, birthDate);//ç¬¬äºä¸ªåæ°åç¬¬ä¸ä¸ªåæ°\n\n        System.out.println(duration.toDays());//ä¸¤ä¸ªæ¶é´å·®çå¤©æ°\n        System.out.println(duration.toHours());//ä¸¤ä¸ªæ¶é´å·®çå°æ¶æ°\n        System.out.println(duration.toMinutes());//ä¸¤ä¸ªæ¶é´å·®çåéæ°\n        System.out.println(duration.toMillis());//ä¸¤ä¸ªæ¶é´å·®çæ¯«ç§æ°\n        System.out.println(duration.toNanos());//ä¸¤ä¸ªæ¶é´å·®ççº³ç§æ°\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# 2.4.3 ChronoUnit ç±»\n\nChronoUnit ç±»å¯ç¨äºå¨åä¸ªæ¶é´åä½åæµéä¸æ®µæ¶é´ï¼è¿ä¸ªå·¥å·ç±»æ¯æå¨çäºï¼å¯ä»¥ç¨äºæ¯è¾ææçæ¶é´åä½ã\n\nç¤ºä¾ä»£ç ï¼\n\npublic class Demo09ChronoUnit {\n    public static void main(String[] args) {\n        // æ¬å°æ¥ææ¶é´å¯¹è±¡ï¼æ­¤å»ç\n        LocalDateTime today = LocalDateTime.now();\n        System.out.println(today);\n\n        // çæ¥æ¶é´\n        LocalDateTime birthDate = LocalDateTime.of(1990,10,1,\n                10,50,59);\n        System.out.println(birthDate);\n\n        System.out.println("ç¸å·®çå¹´æ°ï¼" + ChronoUnit.YEARS.between(birthDate, today));\n        System.out.println("ç¸å·®çææ°ï¼" + ChronoUnit.MONTHS.between(birthDate, today));\n        System.out.println("ç¸å·®çå¨æ°ï¼" + ChronoUnit.WEEKS.between(birthDate, today));\n        System.out.println("ç¸å·®çå¤©æ°ï¼" + ChronoUnit.DAYS.between(birthDate, today));\n        System.out.println("ç¸å·®çæ¶æ°ï¼" + ChronoUnit.HOURS.between(birthDate, today));\n        System.out.println("ç¸å·®çåæ°ï¼" + ChronoUnit.MINUTES.between(birthDate, today));\n        System.out.println("ç¸å·®çç§æ°ï¼" + ChronoUnit.SECONDS.between(birthDate, today));\n        System.out.println("ç¸å·®çæ¯«ç§æ°ï¼" + ChronoUnit.MILLIS.between(birthDate, today));\n        System.out.println("ç¸å·®çå¾®ç§æ°ï¼" + ChronoUnit.MICROS.between(birthDate, today));\n        System.out.println("ç¸å·®ççº³ç§æ°ï¼" + ChronoUnit.NANOS.between(birthDate, today));\n        System.out.println("ç¸å·®çåå¤©æ°ï¼" + ChronoUnit.HALF_DAYS.between(birthDate, today));\n        System.out.println("ç¸å·®çåå¹´æ°ï¼" + ChronoUnit.DECADES.between(birthDate, today));\n        System.out.println("ç¸å·®çä¸çºªï¼ç¾å¹´ï¼æ°ï¼" + ChronoUnit.CENTURIES.between(birthDate, today));\n        System.out.println("ç¸å·®çåå¹´æ°ï¼" + ChronoUnit.MILLENNIA.between(birthDate, today));\n        System.out.println("ç¸å·®ççºªåæ°ï¼" + ChronoUnit.ERAS.between(birthDate, today));\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# 3. åè£ç±»\n\n8ç§åºæ¬æ°æ®ç±»åå¯¹åºçå¼ç¨ç±»å\n\nåºæ¬æ°æ®ç±»å    å¼ç¨æ°æ®ç±»å\nbyte      Byte\nshort     Short\nint       Integer\nlong      Long\nchar      Character\nfloat     Float\ndouble    Double\nboolean   Boolean\n\nð¡ æä¾åè£ç±»çåå ï¼\n\n 1. Javaä¸ºäºå®ç°ä¸åçå¯¹è±¡ï¼ä¸º8ç§åºæ¬ç±»åæä¾äºå¯¹åºçå¼ç¨ç±»åã\n 2. éååæ³ååªæ¯æåè£ç±»åï¼ä¸æ¯æåºæ¬æ°æ®ç±»å\n\nåè£ç±»çç¹æ§ï¼\n\n * èªå¨è£ç®±ï¼åºæ¬ç±»åçæ°æ®ååéå¯ä»¥ç´æ¥èµå¼ç»åè£ç±»åçåé\n\n * **èªå¨æç®±ï¼**åè£ç±»åçåéå¯ä»¥ç´æ¥èµå¼ç»åºæ¬æ°æ®ç±»åçåé\n\nåè£ç±»çç¹æåè½ï¼\n\n * â¨ åè£ç±»çåéçé»è®¤å¼å¯ä»¥æ¯nullï¼å®¹éçæ´é«\n\n * å¯ä»¥æåºæ¬ç±»åçæ°æ®è½¬æ¢æå­ç¬¦ä¸²ç±»å(ç¨å¤ä¸å¤§)\n   \n   * å ä¸ºå¯ä»¥ç´æ¥+å­ç¬¦ä¸²å¾å°å­ç¬¦ä¸²ç±»å\n     \n     å¦ï¼String rs2 = i3 + "";\n   \n   * â è°ç¨toString()æ¹æ³å¾å°å­ç¬¦ä¸²ç»æã\n     \n     â¡è°ç¨Integer.toString(åºæ¬ç±»åçæ°æ®)ã\n\n * â¨ å¯ä»¥æå­ç¬¦ä¸²ç±»åçæ°å¼è½¬æ¢æçå®çæ°æ®ç±»åï¼ççå¾æç¨ï¼\n   \n   * â Integer.parseInt(âå­ç¬¦ä¸²ç±»åçæ´æ°â)\n     \n     â¡Double.parseDouble(âå­ç¬¦ä¸²ç±»åçå°æ°â)\n     \n     â¢Integer/Double.valueOf(âå­ç¬¦ä¸²ç±»åçæ°å¼â) --\x3e æ¯åä¸¤ä¸ªå¥½ä½¿ï¼ç´æ¥ä½¿ç¨ç»ä¸çæ¹æ³\n   \n   * ä»£ç ç¤ºä¾ï¼\n     \n     String number = "23";\n     //è½¬æ¢ææ´æ°\n     // int age = Integer.parseInt(number);\n     int age = Integer.valueOf(number);\n     System.out.println(age + 1);  // 24\n     \n     String number1 = "99.9";\n     //è½¬æ¢æå°æ°\n     //double score = Double.parseDouble(number1);\n     double score = Double.valueOf(number1);\n     System.out.println(score + 0.1);  // 100.0\n     \n     \n     1\n     2\n     3\n     4\n     5\n     6\n     7\n     8\n     9\n     10\n     11\n     \n\n\n# 4. æ­£åè¡¨è¾¾å¼\n\næ­£åè¡¨è¾¾å¼å¯ä»¥ç¨ä¸äºè§å®çå­ç¬¦æ¥å¶å®è§åï¼å¹¶ç¨æ¥æ ¡éªæ°æ®æ ¼å¼çåæ³ãå¦ï¼æ ¡éªç¨æ·åãå¯ç ãéªè¯ç ç­è¾å¥æ°æ®çåæ³æ§ã\n\nå­ç¬¦ä¸²å¯¹è±¡æä¾äºå¹éæ­£åè¡¨è¾¾å¼çæ¹æ³ï¼\n\npublic boolean matches([String regex): å¤æ­æ¯å¦å¹éæ­£åè¡¨è¾¾å¼ï¼å¹éè¿åtrueï¼ä¸å¹éè¿åfalse\n\nå¹éè§åï¼\n\n * å­ç¬¦ç±»(é»è®¤å¹éä¸ä¸ªå­ç¬¦)\n   \n   æ­£åè¡¨è¾¾å¼           å¹éç»æ\n   [abc]           åªè½æ¯a, b, æc\n   [^abc]          é¤äºa, b, cä¹å¤çä»»ä½å­ç¬¦\n   [a-zA-Z]        aå°z Aå°Zï¼åæ¬ï¼èå´ï¼\n   [a-d[m-p]]]     aå°dï¼æméè¿pï¼ï¼[a-dm-p]èåï¼\n   [a-z&&[def]]    d, e, æf(äº¤é)\n   [a-z&&[^bc]]    aå°zï¼é¤äºbåc\n   [a-z&&[^m-p]]   aå°zï¼é¤äºmå°p\n\n * é¢å®ä¹çå­ç¬¦ç±»(é»è®¤å¹éä¸ä¸ªå­ç¬¦)\n   \n   æ­£åè¡¨è¾¾å¼   å¹éç»æ\n   .       ä»»ä½å­ç¬¦\n   \\d      ä¸ä¸ªæ°å­ï¼ [0-9]\n   \\D      éæ°å­ï¼ [^0-9]\n   \\s      ä¸ä¸ªç©ºç½å­ç¬¦ï¼[ \\t\\n\\x0B\\f\\r]\n   \\S      éç©ºç½å­ç¬¦ï¼[^\\s]\n   \\w      [a-zA-Z_0-9] è±æãæ°å­ãä¸åçº¿\n   \\W      [^\\w] ä¸ä¸ªéåè¯å­ç¬¦\n   \n   â ï¸ æ­¤å¤ç â\\...â å¨åä»£ç æ¶è¦ç¨â\\\\âã\n\n * è´ªå©ªçéè¯ï¼éåå¹éå¤ä¸ªå­ç¬¦ï¼\n   \n   æ­£åè¡¨è¾¾å¼    å¹éç»æ\n   X?       X , ä¸æ¬¡ææ ¹æ¬ä¸\n   X*       Xï¼é¶æ¬¡æå¤æ¬¡\n   X+       Xï¼ä¸æ¬¡æå¤æ¬¡\n   X{n}     Xï¼æ­£å¥½næ¬¡\n   X{n,}    Xï¼è³å°næ¬¡\n   X{n,m}   Xï¼è³å°nä½ä¸è¶è¿mæ¬¡\n\næ­£åè¡¨è¾¾å¼å¨å­ç¬¦ä¸²æ¹æ³ä¸­çä½¿ç¨ï¼\n\næ¹æ³å                                                    è¯´æ\npublic String replaceAll(String regex,String newStr)   æç§æ­£åè¡¨è¾¾å¼å¹éçåå®¹è¿è¡æ¿æ¢\npublic String[] split(String regex)ï¼                   æç§æ­£åè¡¨è¾¾å¼å¹éçåå®¹è¿è¡åå²å­ç¬¦ä¸²ï¼ååä¸ä¸ªå­ç¬¦ä¸²æ°ç»ã\n\nä»£ç ç¤ºä¾ï¼\n\npublic class RegexDemo04 {\n    public static void main(String[] args) {\n        String names = "å°è·¯dhdfhdf342èå¿43fdffdfbjdfafå°ä½";\n\n        String[] arrs = names.split("\\\\w+");\n        for (int i = 0; i < arrs.length; i++) {\n            System.out.println(arrs[i]);\n        }\n\n        String names2 = names.replaceAll("\\\\w+", "  ");\n        System.out.println(names2);  // å°è·¯  èå¿  å°ä½\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nä½¿ç¨æ­£åè¡¨è¾¾å¼ç¬åä¿¡æ¯ä¸­çåå®¹ï¼\n\nç¤ºä¾ä»£ç ï¼\n\npublic class RegexDemo05 {\n    public static void main(String[] args) {\n        String rs = "æ¥é»é©¬ç¨åºå­¦ä¹ Java,çµè¯020-43422424ï¼æèèç³»é®ç®±" +\n                "itcast@itcast.cn,çµè¯18762832633ï¼0203232323" +\n                "é®ç®±bozai@itcast.cnï¼400-100-3233 ï¼4001003232";\n\n        // éæ±ï¼ä»ä¸é¢çåå®¹ä¸­ç¬ååº çµè¯å·ç åé®ç®±ã\n        // 1ãå®ä¹ç¬åè§åï¼å­ç¬¦ä¸²å½¢å¼\n        String regex = "(\\\\w{1,30}@[a-zA-Z0-9]{2,20}(\\\\.[a-zA-Z0-9]{2,20}){1,2})|(1[3-9]\\\\d{9})|(0\\\\d{2,6}-?\\\\d{5,20})|(400-?\\\\d{3,9}-?\\\\d{3,9})";\n\n        // 2ãæè¿ä¸ªç¬åè§åç¼è¯æå¹éå¯¹è±¡ã\n        Pattern pattern = Pattern.compile(regex);\n\n        // 3ãå¾å°ä¸ä¸ªåå®¹å¹éå¨å¯¹è±¡\n        Matcher matcher = pattern.matcher(rs);\n\n        // 4ãå¼å§æ¾äº\n        while (matcher.find()) {\n            String rs1 = matcher.group();\n            System.out.println(rs1);\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# 5. Arrays ç±»\n\nArrays ç±»æ¯æ°ç»æä½å·¥å·ç±»ï¼ä¸é¨ç¨äºæä½æ°ç»åç´ çã\n\nArraysç±»çå¸¸ç¨ API ï¼\n\næ¹æ³å                                                            è¯´æ\npublic static String toString(ç±»å[] a)                          è¿åæ°ç»çåå®¹ï¼å­ç¬¦ä¸²å½¢å¼ï¼\npublic static void sort(ç±»å[] a)                                å¯¹æ°ç»è¿è¡é»è®¤ååºæåº\npublic static <T> void sort(ç±»å[] a, Comparator<? super T> c)   ä½¿ç¨æ¯è¾å¨å¯¹è±¡èªå®ä¹æåº\npublic static int binarySearch(int[] a, int key)               äºåæç´¢æ°ç»ä¸­çæ°æ®ï¼å­å¨è¿åç´¢å¼ï¼ä¸å­å¨è¿å-1\n\nä»£ç ç¤ºä¾ï¼\n\nint[] arr = {10, 2, 55, 23, 24, 100};\nSystem.out.println(Arrays.toString(arr));\n\nArrays.sort(arr);\nSystem.out.println(Arrays.toString(arr));\n\n\n1\n2\n3\n4\n5\n\n\nArrays ç±»å¯¹äº Comparator æ¯è¾å¨çæ¯æï¼\n\nå¯ä»¥éè¿è®¾ç½® Comparator æ¥å£å¯¹åºçæ¯è¾å¨å¯¹è±¡ï¼æ¥å®å¶æ¯è¾è§å\n\n * å¦æè®¤ä¸ºå·¦è¾¹æ°æ® å¤§äº å³è¾¹æ°æ® è¿åæ­£æ´æ°\n   \n   å¦æè®¤ä¸ºå·¦è¾¹æ°æ® å°äº å³è¾¹æ°æ® è¿åè´æ´æ°\n   \n   å¦æè®¤ä¸ºå·¦è¾¹æ°æ® ç­äº å³è¾¹æ°æ® è¿å0\n\nâ ï¸ è¢«æåºçæ°ç» å¿é¡»æ¯å¼ç¨ç±»åçåç´ \n\nä»£ç ç¤ºä¾ï¼\n\n\n\n\n\n\n\n\nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \n\n\n\n        // 2ãéæ±ï¼éåºæåºï¼(èªå®ä¹æ¯è¾å¨å¯¹è±¡ï¼åªè½æ¯æå¼ç¨ç±»åçæåºï¼ï¼)\n        Integer[] ages1 = {34, 12, 42, 23};\n        /**\n           åæ°ä¸ï¼è¢«æåºçæ°ç» å¿é¡»æ¯å¼ç¨ç±»åçåç´ \n           åæ°äºï¼å¿ååé¨ç±»å¯¹è±¡ï¼ä»£è¡¨äºä¸ä¸ªæ¯è¾å¨å¯¹è±¡ã\n         */\n        Arrays.sort(ages1, new Comparator<Integer>() {\n            @Override\n            public int compare(Integer o1, Integer o2) {\n                // æå®æ¯è¾è§åã\n//                if(o1 > o2){\n//                    return 1;\n//                }else if(o1 < o2){\n//                    return -1;\n//                }\n//                return 0;\n                // return o1 - o2; // é»è®¤ååº\n                return o2 - o1; //  éåº\n            }\n        });\n        System.out.println(Arrays.toString(ages1));\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nä¸è¿°æ¯è¾è§åå¯ä»¥ç®åä¸ºï¼\n\nArrays.sort(ages1, ( o1,  o2 ) ->  o2 - o1 );\n\n\n1\n\n\n\n# 6. Lambda è¡¨è¾¾å¼\n\nLambdaè¡¨è¾¾å¼æ¯JDK 8å¼å§åçä¸ç§æ°è¯­æ³å½¢å¼\n\n**ä½ç¨ï¼**ç®åå¿ååé¨ç±»çä»£ç åæ³\n\nLambda è¡¨è¾¾å¼çç®åæ ¼å¼ï¼\n\n(å¿ååé¨ç±»è¢«éåæ¹æ³çå½¢ååè¡¨) -> {\n  è¢«éåæ¹æ³çæ¹æ³ä½ä»£ç ã\n }\n\næ³¨ï¼-> æ¯è¯­æ³å½¢å¼ï¼æ å®éå«ä¹\n\n\n1\n2\n3\n4\n5\n\n\nâ ï¸ æ³¨æ: Lambda è¡¨è¾¾å¼åªè½ç®åå½æ°å¼æ¥å£çå¿ååé¨ç±»çåæ³å½¢å¼\n\nå½æ°å¼æ¥å£è¦æ±ï¼\n\n 1. å¿é¡»æ¯æ¥å£\n 2. æ¥å£ä¸­æä¸ä»æä¸ä¸ªæ½è±¡æ¹æ³\n 3. è¥æ@FunctionalInterfaceæ³¨è§£ï¼åè¡¨æè¯¥æ¥å£æ¯ä¸ä¸ªå½æ°å¼æ¥å£\n\nç¤ºä¾ç®åå¸¸è§å½æ°å¼æ¥å£ï¼\n\n\n\n\n\n**Lambda è¡¨è¾¾å¼ççç¥è§å: **\n\n * åæ°ç±»åå¯ä»¥çç¥ä¸åã\n * å¦æåªæä¸ä¸ªåæ°ï¼åæ°ç±»åå¯ä»¥çç¥ï¼åæ¶()ä¹å¯ä»¥çç¥ã\n * å¦æLambdaè¡¨è¾¾å¼çæ¹æ³ä½ä»£ç åªæä¸è¡ä»£ç ãå¯ä»¥çç¥å¤§æ¬å·ä¸å,åæ¶è¦çç¥åå·ï¼\n * å¦æLambdaè¡¨è¾¾å¼çæ¹æ³ä½ä»£ç åªæä¸è¡ä»£ç ãå¯ä»¥çç¥å¤§æ¬å·ä¸åãæ­¤æ¶ï¼å¦æè¿è¡ä»£ç æ¯returnè¯­å¥ï¼å¿é¡»çç¥returnä¸åï¼åæ¶ä¹å¿é¡»çç¥";"ä¸å',normalizedContent:'# é¢åå¯¹è±¡è¿é¶4ï¼å¸¸ç¨æ¥æapiãæ­£åãarraysç±»ãlambdaï¼\n\n\n# 1. æ¥æä¸æ¶é´\n\n> è¿é¨åçåå®¹äºè§£å³å¯ï¼jdk8 æ°å¢çæ¥æç±»æ¯æ¬é¨åä¸­çå¥½ç¨\n\n\n# 1.1 date ç±»\n\ndate ç±»ä»£è¡¨å½åæå¨ç³»ç»çæ¥ææ¶é´ä¿¡æ¯\n\næé å¨\n\nåç§°                       è¯´æ\npublic date()            åå»ºä¸ä¸ªdateå¯¹è±¡ï¼ä»£è¡¨çæ¯ç³»ç»å½åæ­¤å»æ¥ææ¶é´ã\npublic date(long time)   ææ¶é´æ¯«ç§å¼è½¬æ¢ædateæ¥æå¯¹è±¡\n\nå¸¸ç¨æ¹æ³\n\nåç§°                               è¯´æ\npublic long gettime()            è¿åä»1970å¹´1æ1æ¥ 00:00:00èµ°å°æ­¤å»çæ»çæ¯«ç§æ°\npublic void settime(long time)   è®¾ç½®æ¥æå¯¹è±¡çæ¶é´ä¸ºå½åæ¶é´æ¯«ç§å¼å¯¹åºçæ¶é´\n\n * æ¥æå¯¹è±¡å¦ä½åå»ºï¼å¦ä½è·åæ¶é´æ¯«ç§å¼ï¼\n   \n   * public date();\n   \n   * public long gettime();\n\n * æ¶é´æ¯«ç§å¼æä¹æ¢å¤ææ¥æå¯¹è±¡?\n   \n   * public date(long time);\n   \n   * public void settime(long time);\n\n\n# 1.2 simpledateformat\n\nä½ç¨ï¼\n\n 1. å®ææ¥ææ¶é´çæ ¼å¼åæä½\n    \n    public simpledateformat(string pattern)ï¼æé ä¸ä¸ªsimpledateformatï¼ä½¿ç¨æå®çæ ¼å¼\n    \n    æ ¼å¼åæ¹æ³                                     è¯´æ\n    public final string format(date date)     å°æ¥ææ ¼å¼åææ¥æ/æ¶é´å­ç¬¦ä¸²\n    public final string format(object time)   å°æ¶é´æ¯«ç§å¼å¼åææ¥æ/æ¶é´å­ç¬¦ä¸²\n\n 2. è§£æå­ç¬¦ä¸²æ¶é´æä¸ºæ¥æå¯¹è±¡\n    \n    2011-11-11 11:11:22 -> dateæ¥æå¯¹è±¡\n    \n    public date parse(string source)ï¼ä»ç»å®å­ç¬¦ä¸²çå¼å§è§£æææ¬ä»¥çææ¥æ\n\n\n# 1.3 calendar\n\n * calendarä»£è¡¨äºç³»ç»æ­¤å»æ¥æå¯¹åºçæ¥åå¯¹è±¡\n\n * calendaræ¯ä¸ä¸ªæ½è±¡ç±»ï¼ä¸è½ç´æ¥åå»ºå¯¹è±¡\n   \n   calendaræ¥åç±»åå»ºæ¥åå¯¹è±¡çæ¹æ³ï¼public static calendar getinstance()ï¼è·åå½åæ¥åå¯¹è±¡\n\n * calendarå¸¸ç¨æ¹æ³\n   \n   æ¹æ³å                                     è¯´æ\n   public int get(int field)               åæ¥æä¸­çæä¸ªå­æ®µä¿¡æ¯ã\n   public void set(int field,int value)    ä¿®æ¹æ¥åçæä¸ªå­æ®µä¿¡æ¯ã\n   public void add(int field,int amount)   ä¸ºæä¸ªå­æ®µå¢å /åå°æå®çå¼\n   public final date gettime()             æ¿å°æ­¤å»æ¥æå¯¹è±¡ã\n   public long gettimeinmillis()           æ¿å°æ­¤å»æ¶é´æ¯«ç§å¼\n\nâ ï¸ **æ³¨æï¼calendaræ¯å¯åæ¥æå¯¹è±¡ï¼ä¸æ¦ä¿®æ¹åå¶å¯¹è±¡æ¬èº«è¡¨ç¤ºçæ¶é´å°äº§çåå\n\n\n# 2. jdk8 æ°å¢æ¥æç±»\n\n * ä»java 8å¼å§ï¼java.timeåæä¾äºæ°çæ¥æåæ¶é´apiï¼ä¸»è¦æ¶åçç±»åæï¼\n   \n   * localdateï¼ä¸åå«å·ä½æ¶é´çæ¥æã\n   \n   * localtimeï¼ä¸å«æ¥æçæ¶é´ã\n   \n   * localdatetimeï¼åå«äºæ¥æåæ¶é´ã\n   \n   * instantï¼ä»£è¡¨çæ¯æ¶é´æ³ã\n   \n   * datetimeformatter ç¨äºåæ¶é´çæ ¼å¼ååè§£æç\n   \n   * duration:ç¨äºè®¡ç®ä¸¤ä¸ªâæ¶é´âé´é\n   \n   * period:ç¨äºè®¡ç®ä¸¤ä¸ªâæ¥æâé´é\n\n * æ°å¢çapiä¸¥æ ¼åºåäºæ¶å»ãæ¬å°æ¥æãæ¬å°æ¶é´ï¼å¹¶ä¸ï¼å¯¹æ¥æåæ¶é´è¿è¡è¿ç®æ´å æ¹ä¾¿\n\n * æ°apiçç±»åå ä¹å¨é¨æ¯ä¸åç±»åï¼åstringçä½¿ç¨ç±»ä¼¼ï¼ï¼å¯ä»¥æ¾å¿ä½¿ç¨ä¸å¿æå¿è¢«ä¿®æ¹\n\n\n# 2.1 localdateãlocaltimeãlocaldatetime\n\nåå«è¡¨ç¤ºæ¥æãæ¶é´ãæ¥ææ¶é´å¯¹è±¡ï¼ä»ä»¬çç±»çå®ä¾æ¯ä¸å¯åçå¯¹è±¡ï¼ä»ä»¬ä¸èæå»ºå¯¹è±¡åapié½æ¯éç¨ç\n\næå»ºå¯¹è±¡çæ¹å¼å¦ä¸ï¼\n\næ¹æ³å                         è¯´æ                 \npublic static xxxx now();   éææ¹æ³ï¼æ ¹æ®å½åæ¶é´åå»ºå¯¹è±¡    locadate localdate = localdate.now(); localtime llocaltime =\n                                               localtime.now(); localdatetime localdatetime =\n                                               localdatetime.now();\npublic static xxxx of(â¦);   éææ¹æ³ï¼æå®æ¥æ/æ¶é´åå»ºå¯¹è±¡   localdate localdate1 = localdate.of(2099 , 11,11); localtime\n                                               localtime1 = localtime.of(11, 11, 11); localdatetime\n                                               localdatetime1 = localdatetime.of(2020, 10, 6, 13, 23, 43);\n\nlocaldateãlocaltimeãlocaldatetimeè·åä¿¡æ¯çapiï¼\n\næ¹æ³å                               è¯´æ\npublic int geyear()               è·åå¹´\npublic int getmonthvalue()        è·åæä»½ï¼1-12ï¼\npublic int getdayofmonth()        è·åæä¸­ç¬¬å å¤©ä¹æ³\npublic int getdayofyear()         è·åå¹´ä¸­ç¬¬å å¤©\npublic dayofweek getdayofweek()   è·åææ\n\næç¤º\n\nå·ä½ä½¿ç¨æ¶æ¥ç idea æç¤ºçæ¹æ³å³å¯\n\nè½¬æ¢ç¸å³ apiï¼\n\nlocaldatetimeçè½¬æ¢apiï¼\n\næ¹æ³å                              è¯´æ\npublic localdate tolocaldate()   è½¬æ¢æä¸ä¸ªlocaldateå¯¹è±¡\npublic localtime tolocaltime()   è½¬æ¢æä¸ä¸ªlocaltimeå¯¹è±¡\n\nåæ¶é´ä¿®æ¹ç¸å³ç apiï¼\n\nlocaldatetime ç»¼åäº localdate å localtime éé¢çæ¹æ³ï¼æä»¥ä¸é¢åªç¨ localdate å localtime æ¥ä¸¾ä¾ãè¿äºæ¹æ³è¿åçæ¯ä¸ä¸ªæ°çå®ä¾å¼ç¨ï¼å ä¸ºlocaldatetime ãlocaldate ãlocaltime é½æ¯ä¸å¯åç\n\næ¹æ³å                                                  è¯´æ\nplusdays, plusweeks, plusmonths, plusyears           åå½å localdate å¯¹è±¡æ·»å å å¤©ã å å¨ãå ä¸ªæãå å¹´\nminusdays, minusweeks, minusmonths, minusyears       ä»å½å localdate å¯¹è±¡åå»å å¤©ã å å¨ãå ä¸ªæãå å¹´\nwithdayofmonth, withdayofyear, withmonth, withyear   å°æä»½å¤©æ°ãå¹´ä»½å¤©æ°ãæä»½ãå¹´ ä»½ ä¿® æ¹ ä¸º æ å® ç å¼ å¹¶ è¿ å æ° ç localdate å¯¹è±¡\nisbefore, isafter, equals                            æ¯è¾ä¸¤ä¸ª localdate\n\n\n# 2.2 instant æ¶é´æ³\n\njdk8 è·åæ¶é´æ³ç¹å«ç®åï¼ä¸åè½æ´ä¸°å¯ãinstant ç±»ç±ä¸ä¸ªéæçå·¥åæ¹æ³ now() å¯ä»¥è¿åå½åæ¶é´æ³\n\nÂ \n\n\nÂ \n\n\nÂ \n\n\n\ninstant instant = instant.now();\n system.out.println("å½åæ¶é´æ³æ¯ï¼" + instant);\n\n date date = date.from(instant);\n system.out.println("å½åæ¶é´æ³æ¯ï¼" + date);\n\n instant = date.toinstant();\n system.out.println(instant);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nð¡ æ¶é´æ³æ¯åå«æ¥æåæ¶é´çï¼ä¸ java.util.date å¾ç±»ä¼¼ï¼äºå®ä¸ instant å°±æ¯ç±»ä¼¼ jdk8 ä»¥åç dateã\n\nð¡ instantådateè¿ä¸¤ä¸ªç±»å¯ä»¥è¿è¡è½¬æ¢\n\n\n# 2.3 datetimeformatter\n\nå¨ jdk8 ä¸­ï¼å¼å¥äºä¸ä¸ªå¨æ°çæ¥æä¸æ¶é´æ ¼å¼å¨ datetimeformatterï¼æ­£åé½è½è°ç¨formatæ¹æ³ã\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\npublic class demo06datetimeformat {\n    public static void main(string[] args) {\n        // æ¬å°æ­¤å»  æ¥ææ¶é´ å¯¹è±¡\n        localdatetime ldt = localdatetime.now();\n        system.out.println(ldt);\n\n        // è§£æ/æ ¼å¼åå¨\n        datetimeformatter dtf = datetimeformatter.ofpattern("yyyy-mm-dd hh:mm:ss eee a");\n        // æ­£åæ ¼å¼åï¼å¯¹è±¡è°ç¨å¯ä»¥çæï¼\n        system.out.println(dtf.format(ldt));\n        // éåæ ¼å¼å\n        system.out.println(ldt.format(dtf));\n\n        // è§£æå­ç¬¦ä¸²æ¶é´\n        datetimeformatter dtf1 = datetimeformatter.ofpattern("yyyy-mm-dd hh:mm:ss");\n        // è§£æå½åå­ç¬¦ä¸²æ¶é´æä¸ºæ¬å°æ¥ææ¶é´å¯¹è±¡\n        localdatetime ldt1 = localdatetime.parse("2019-11-11 11:11:11" ,  dtf1);\n        system.out.println(ldt1);\n        system.out.println(ldt1.getdayofyear());\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\næ ¼å¼åçæ¶é´å½¢å¼çå¸¸ç¨çæ¨¡å¼å¯¹åºå³ç³»å¦ä¸ï¼\n\n\n# 2.4 duration/period/chronounit\n\njdk8 ä¸­ï¼ç¨æ¥è®¡ç®ä¸¤ä¸ª**âæ¥æâé´éçç±»ï¼java.time.periodï¼ç¨æ¥è®¡ç®ä¸¤ä¸ªâæ¶é´âé´é**çç±»ï¼java.time.durationã\n\næå¨çå·¥å·ç±»ï¼java.time.temporal.chronounitï¼å¯ä»¥ç¨äºæ¯è¾ææçæ¶é´åä½ã\n\n# 2.4.1 period ç±»\n\nä¸»è¦æ¯ period ç±»æ¹æ³ getyears()ï¼getmonths() å getdays() æ¥è®¡ç®,åªè½ç²¾ç¡®å°å¹´ææ¥ã\n\nç¨äº localdate ä¹é´çæ¯è¾\n\nç¤ºä¾ä»£ç ï¼\n\npublic class demo07period {\n    public static void main(string[] args) {\n        // å½åæ¬å° å¹´ææ¥\n        localdate today = localdate.now();\n        system.out.println(today);//\n\n        // çæ¥ç å¹´ææ¥\n        localdate birthdate = localdate.of(1998, 10, 13);\n        system.out.println(birthdate);\n\n        period period = period.between(birthdate, today);//ç¬¬äºä¸ªåæ°åç¬¬ä¸ä¸ªåæ°\n\n        system.out.println(period.getyears());\n        system.out.println(period.getmonths());\n        system.out.println(period.getdays());\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# 2.4.2 duration ç±»\n\næä¾äºä½¿ç¨åºäºæ¶é´çå¼æµéæ¶é´éçæ¹æ³\n\nç¨äº localdatetime ä¹é´çæ¯è¾ãä¹å¯ç¨äº instant ä¹é´çæ¯è¾\n\nç¤ºä¾ä»£ç ï¼\n\npublic class demo08duration {\n    public static void main(string[] args) {\n        // æ¬å°æ¥ææ¶é´å¯¹è±¡ã\n        localdatetime today = localdatetime.now();\n        system.out.println(today);\n\n        // åºççæ¥ææ¶é´å¯¹è±¡\n        localdatetime birthdate = localdatetime.of(2021,8,06,01,00,00);\n\n        system.out.println(birthdate);\n\n        duration duration = duration.between(today, birthdate);//ç¬¬äºä¸ªåæ°åç¬¬ä¸ä¸ªåæ°\n\n        system.out.println(duration.todays());//ä¸¤ä¸ªæ¶é´å·®çå¤©æ°\n        system.out.println(duration.tohours());//ä¸¤ä¸ªæ¶é´å·®çå°æ¶æ°\n        system.out.println(duration.tominutes());//ä¸¤ä¸ªæ¶é´å·®çåéæ°\n        system.out.println(duration.tomillis());//ä¸¤ä¸ªæ¶é´å·®çæ¯«ç§æ°\n        system.out.println(duration.tonanos());//ä¸¤ä¸ªæ¶é´å·®ççº³ç§æ°\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# 2.4.3 chronounit ç±»\n\nchronounit ç±»å¯ç¨äºå¨åä¸ªæ¶é´åä½åæµéä¸æ®µæ¶é´ï¼è¿ä¸ªå·¥å·ç±»æ¯æå¨çäºï¼å¯ä»¥ç¨äºæ¯è¾ææçæ¶é´åä½ã\n\nç¤ºä¾ä»£ç ï¼\n\npublic class demo09chronounit {\n    public static void main(string[] args) {\n        // æ¬å°æ¥ææ¶é´å¯¹è±¡ï¼æ­¤å»ç\n        localdatetime today = localdatetime.now();\n        system.out.println(today);\n\n        // çæ¥æ¶é´\n        localdatetime birthdate = localdatetime.of(1990,10,1,\n                10,50,59);\n        system.out.println(birthdate);\n\n        system.out.println("ç¸å·®çå¹´æ°ï¼" + chronounit.years.between(birthdate, today));\n        system.out.println("ç¸å·®çææ°ï¼" + chronounit.months.between(birthdate, today));\n        system.out.println("ç¸å·®çå¨æ°ï¼" + chronounit.weeks.between(birthdate, today));\n        system.out.println("ç¸å·®çå¤©æ°ï¼" + chronounit.days.between(birthdate, today));\n        system.out.println("ç¸å·®çæ¶æ°ï¼" + chronounit.hours.between(birthdate, today));\n        system.out.println("ç¸å·®çåæ°ï¼" + chronounit.minutes.between(birthdate, today));\n        system.out.println("ç¸å·®çç§æ°ï¼" + chronounit.seconds.between(birthdate, today));\n        system.out.println("ç¸å·®çæ¯«ç§æ°ï¼" + chronounit.millis.between(birthdate, today));\n        system.out.println("ç¸å·®çå¾®ç§æ°ï¼" + chronounit.micros.between(birthdate, today));\n        system.out.println("ç¸å·®ççº³ç§æ°ï¼" + chronounit.nanos.between(birthdate, today));\n        system.out.println("ç¸å·®çåå¤©æ°ï¼" + chronounit.half_days.between(birthdate, today));\n        system.out.println("ç¸å·®çåå¹´æ°ï¼" + chronounit.decades.between(birthdate, today));\n        system.out.println("ç¸å·®çä¸çºªï¼ç¾å¹´ï¼æ°ï¼" + chronounit.centuries.between(birthdate, today));\n        system.out.println("ç¸å·®çåå¹´æ°ï¼" + chronounit.millennia.between(birthdate, today));\n        system.out.println("ç¸å·®ççºªåæ°ï¼" + chronounit.eras.between(birthdate, today));\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n\n# 3. åè£ç±»\n\n8ç§åºæ¬æ°æ®ç±»åå¯¹åºçå¼ç¨ç±»å\n\nåºæ¬æ°æ®ç±»å    å¼ç¨æ°æ®ç±»å\nbyte      byte\nshort     short\nint       integer\nlong      long\nchar      character\nfloat     float\ndouble    double\nboolean   boolean\n\nð¡ æä¾åè£ç±»çåå ï¼\n\n 1. javaä¸ºäºå®ç°ä¸åçå¯¹è±¡ï¼ä¸º8ç§åºæ¬ç±»åæä¾äºå¯¹åºçå¼ç¨ç±»åã\n 2. éååæ³ååªæ¯æåè£ç±»åï¼ä¸æ¯æåºæ¬æ°æ®ç±»å\n\nåè£ç±»çç¹æ§ï¼\n\n * èªå¨è£ç®±ï¼åºæ¬ç±»åçæ°æ®ååéå¯ä»¥ç´æ¥èµå¼ç»åè£ç±»åçåé\n\n * **èªå¨æç®±ï¼**åè£ç±»åçåéå¯ä»¥ç´æ¥èµå¼ç»åºæ¬æ°æ®ç±»åçåé\n\nåè£ç±»çç¹æåè½ï¼\n\n * â¨ åè£ç±»çåéçé»è®¤å¼å¯ä»¥æ¯nullï¼å®¹éçæ´é«\n\n * å¯ä»¥æåºæ¬ç±»åçæ°æ®è½¬æ¢æå­ç¬¦ä¸²ç±»å(ç¨å¤ä¸å¤§)\n   \n   * å ä¸ºå¯ä»¥ç´æ¥+å­ç¬¦ä¸²å¾å°å­ç¬¦ä¸²ç±»å\n     \n     å¦ï¼string rs2 = i3 + "";\n   \n   * â è°ç¨tostring()æ¹æ³å¾å°å­ç¬¦ä¸²ç»æã\n     \n     â¡è°ç¨integer.tostring(åºæ¬ç±»åçæ°æ®)ã\n\n * â¨ å¯ä»¥æå­ç¬¦ä¸²ç±»åçæ°å¼è½¬æ¢æçå®çæ°æ®ç±»åï¼ççå¾æç¨ï¼\n   \n   * â integer.parseint(âå­ç¬¦ä¸²ç±»åçæ´æ°â)\n     \n     â¡double.parsedouble(âå­ç¬¦ä¸²ç±»åçå°æ°â)\n     \n     â¢integer/double.valueof(âå­ç¬¦ä¸²ç±»åçæ°å¼â) --\x3e æ¯åä¸¤ä¸ªå¥½ä½¿ï¼ç´æ¥ä½¿ç¨ç»ä¸çæ¹æ³\n   \n   * ä»£ç ç¤ºä¾ï¼\n     \n     string number = "23";\n     //è½¬æ¢ææ´æ°\n     // int age = integer.parseint(number);\n     int age = integer.valueof(number);\n     system.out.println(age + 1);  // 24\n     \n     string number1 = "99.9";\n     //è½¬æ¢æå°æ°\n     //double score = double.parsedouble(number1);\n     double score = double.valueof(number1);\n     system.out.println(score + 0.1);  // 100.0\n     \n     \n     1\n     2\n     3\n     4\n     5\n     6\n     7\n     8\n     9\n     10\n     11\n     \n\n\n# 4. æ­£åè¡¨è¾¾å¼\n\næ­£åè¡¨è¾¾å¼å¯ä»¥ç¨ä¸äºè§å®çå­ç¬¦æ¥å¶å®è§åï¼å¹¶ç¨æ¥æ ¡éªæ°æ®æ ¼å¼çåæ³ãå¦ï¼æ ¡éªç¨æ·åãå¯ç ãéªè¯ç ç­è¾å¥æ°æ®çåæ³æ§ã\n\nå­ç¬¦ä¸²å¯¹è±¡æä¾äºå¹éæ­£åè¡¨è¾¾å¼çæ¹æ³ï¼\n\npublic boolean matches([string regex): å¤æ­æ¯å¦å¹éæ­£åè¡¨è¾¾å¼ï¼å¹éè¿åtrueï¼ä¸å¹éè¿åfalse\n\nå¹éè§åï¼\n\n * å­ç¬¦ç±»(é»è®¤å¹éä¸ä¸ªå­ç¬¦)\n   \n   æ­£åè¡¨è¾¾å¼           å¹éç»æ\n   [abc]           åªè½æ¯a, b, æc\n   [^abc]          é¤äºa, b, cä¹å¤çä»»ä½å­ç¬¦\n   [a-za-z]        aå°z aå°zï¼åæ¬ï¼èå´ï¼\n   [a-d[m-p]]]     aå°dï¼æméè¿pï¼ï¼[a-dm-p]èåï¼\n   [a-z&&[def]]    d, e, æf(äº¤é)\n   [a-z&&[^bc]]    aå°zï¼é¤äºbåc\n   [a-z&&[^m-p]]   aå°zï¼é¤äºmå°p\n\n * é¢å®ä¹çå­ç¬¦ç±»(é»è®¤å¹éä¸ä¸ªå­ç¬¦)\n   \n   æ­£åè¡¨è¾¾å¼   å¹éç»æ\n   .       ä»»ä½å­ç¬¦\n   \\d      ä¸ä¸ªæ°å­ï¼ [0-9]\n   \\d      éæ°å­ï¼ [^0-9]\n   \\s      ä¸ä¸ªç©ºç½å­ç¬¦ï¼[ \\t\\n\\x0b\\f\\r]\n   \\s      éç©ºç½å­ç¬¦ï¼[^\\s]\n   \\w      [a-za-z_0-9] è±æãæ°å­ãä¸åçº¿\n   \\w      [^\\w] ä¸ä¸ªéåè¯å­ç¬¦\n   \n   â ï¸ æ­¤å¤ç â\\...â å¨åä»£ç æ¶è¦ç¨â\\\\âã\n\n * è´ªå©ªçéè¯ï¼éåå¹éå¤ä¸ªå­ç¬¦ï¼\n   \n   æ­£åè¡¨è¾¾å¼    å¹éç»æ\n   x?       x , ä¸æ¬¡ææ ¹æ¬ä¸\n   x*       xï¼é¶æ¬¡æå¤æ¬¡\n   x+       xï¼ä¸æ¬¡æå¤æ¬¡\n   x{n}     xï¼æ­£å¥½næ¬¡\n   x{n,}    xï¼è³å°næ¬¡\n   x{n,m}   xï¼è³å°nä½ä¸è¶è¿mæ¬¡\n\næ­£åè¡¨è¾¾å¼å¨å­ç¬¦ä¸²æ¹æ³ä¸­çä½¿ç¨ï¼\n\næ¹æ³å                                                    è¯´æ\npublic string replaceall(string regex,string newstr)   æç§æ­£åè¡¨è¾¾å¼å¹éçåå®¹è¿è¡æ¿æ¢\npublic string[] split(string regex)ï¼                   æç§æ­£åè¡¨è¾¾å¼å¹éçåå®¹è¿è¡åå²å­ç¬¦ä¸²ï¼ååä¸ä¸ªå­ç¬¦ä¸²æ°ç»ã\n\nä»£ç ç¤ºä¾ï¼\n\npublic class regexdemo04 {\n    public static void main(string[] args) {\n        string names = "å°è·¯dhdfhdf342èå¿43fdffdfbjdfafå°ä½";\n\n        string[] arrs = names.split("\\\\w+");\n        for (int i = 0; i < arrs.length; i++) {\n            system.out.println(arrs[i]);\n        }\n\n        string names2 = names.replaceall("\\\\w+", "  ");\n        system.out.println(names2);  // å°è·¯  èå¿  å°ä½\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nä½¿ç¨æ­£åè¡¨è¾¾å¼ç¬åä¿¡æ¯ä¸­çåå®¹ï¼\n\nç¤ºä¾ä»£ç ï¼\n\npublic class regexdemo05 {\n    public static void main(string[] args) {\n        string rs = "æ¥é»é©¬ç¨åºå­¦ä¹ java,çµè¯020-43422424ï¼æèèç³»é®ç®±" +\n                "itcast@itcast.cn,çµè¯18762832633ï¼0203232323" +\n                "é®ç®±bozai@itcast.cnï¼400-100-3233 ï¼4001003232";\n\n        // éæ±ï¼ä»ä¸é¢çåå®¹ä¸­ç¬ååº çµè¯å·ç åé®ç®±ã\n        // 1ãå®ä¹ç¬åè§åï¼å­ç¬¦ä¸²å½¢å¼\n        string regex = "(\\\\w{1,30}@[a-za-z0-9]{2,20}(\\\\.[a-za-z0-9]{2,20}){1,2})|(1[3-9]\\\\d{9})|(0\\\\d{2,6}-?\\\\d{5,20})|(400-?\\\\d{3,9}-?\\\\d{3,9})";\n\n        // 2ãæè¿ä¸ªç¬åè§åç¼è¯æå¹éå¯¹è±¡ã\n        pattern pattern = pattern.compile(regex);\n\n        // 3ãå¾å°ä¸ä¸ªåå®¹å¹éå¨å¯¹è±¡\n        matcher matcher = pattern.matcher(rs);\n\n        // 4ãå¼å§æ¾äº\n        while (matcher.find()) {\n            string rs1 = matcher.group();\n            system.out.println(rs1);\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# 5. arrays ç±»\n\narrays ç±»æ¯æ°ç»æä½å·¥å·ç±»ï¼ä¸é¨ç¨äºæä½æ°ç»åç´ çã\n\narraysç±»çå¸¸ç¨ api ï¼\n\næ¹æ³å                                                            è¯´æ\npublic static string tostring(ç±»å[] a)                          è¿åæ°ç»çåå®¹ï¼å­ç¬¦ä¸²å½¢å¼ï¼\npublic static void sort(ç±»å[] a)                                å¯¹æ°ç»è¿è¡é»è®¤ååºæåº\npublic static <t> void sort(ç±»å[] a, comparator<? super t> c)   ä½¿ç¨æ¯è¾å¨å¯¹è±¡èªå®ä¹æåº\npublic static int binarysearch(int[] a, int key)               äºåæç´¢æ°ç»ä¸­çæ°æ®ï¼å­å¨è¿åç´¢å¼ï¼ä¸å­å¨è¿å-1\n\nä»£ç ç¤ºä¾ï¼\n\nint[] arr = {10, 2, 55, 23, 24, 100};\nsystem.out.println(arrays.tostring(arr));\n\narrays.sort(arr);\nsystem.out.println(arrays.tostring(arr));\n\n\n1\n2\n3\n4\n5\n\n\narrays ç±»å¯¹äº comparator æ¯è¾å¨çæ¯æï¼\n\nå¯ä»¥éè¿è®¾ç½® comparator æ¥å£å¯¹åºçæ¯è¾å¨å¯¹è±¡ï¼æ¥å®å¶æ¯è¾è§å\n\n * å¦æè®¤ä¸ºå·¦è¾¹æ°æ® å¤§äº å³è¾¹æ°æ® è¿åæ­£æ´æ°\n   \n   å¦æè®¤ä¸ºå·¦è¾¹æ°æ® å°äº å³è¾¹æ°æ® è¿åè´æ´æ°\n   \n   å¦æè®¤ä¸ºå·¦è¾¹æ°æ® ç­äº å³è¾¹æ°æ® è¿å0\n\nâ ï¸ è¢«æåºçæ°ç» å¿é¡»æ¯å¼ç¨ç±»åçåç´ \n\nä»£ç ç¤ºä¾ï¼\n\n\n\n\n\n\n\n\nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \nÂ \n\n\n\n        // 2ãéæ±ï¼éåºæåºï¼(èªå®ä¹æ¯è¾å¨å¯¹è±¡ï¼åªè½æ¯æå¼ç¨ç±»åçæåºï¼ï¼)\n        integer[] ages1 = {34, 12, 42, 23};\n        /**\n           åæ°ä¸ï¼è¢«æåºçæ°ç» å¿é¡»æ¯å¼ç¨ç±»åçåç´ \n           åæ°äºï¼å¿ååé¨ç±»å¯¹è±¡ï¼ä»£è¡¨äºä¸ä¸ªæ¯è¾å¨å¯¹è±¡ã\n         */\n        arrays.sort(ages1, new comparator<integer>() {\n            @override\n            public int compare(integer o1, integer o2) {\n                // æå®æ¯è¾è§åã\n//                if(o1 > o2){\n//                    return 1;\n//                }else if(o1 < o2){\n//                    return -1;\n//                }\n//                return 0;\n                // return o1 - o2; // é»è®¤ååº\n                return o2 - o1; //  éåº\n            }\n        });\n        system.out.println(arrays.tostring(ages1));\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nä¸è¿°æ¯è¾è§åå¯ä»¥ç®åä¸ºï¼\n\narrays.sort(ages1, ( o1,  o2 ) ->  o2 - o1 );\n\n\n1\n\n\n\n# 6. lambda è¡¨è¾¾å¼\n\nlambdaè¡¨è¾¾å¼æ¯jdk 8å¼å§åçä¸ç§æ°è¯­æ³å½¢å¼\n\n**ä½ç¨ï¼**ç®åå¿ååé¨ç±»çä»£ç åæ³\n\nlambda è¡¨è¾¾å¼çç®åæ ¼å¼ï¼\n\n(å¿ååé¨ç±»è¢«éåæ¹æ³çå½¢ååè¡¨) -> {\n  è¢«éåæ¹æ³çæ¹æ³ä½ä»£ç ã\n }\n\næ³¨ï¼-> æ¯è¯­æ³å½¢å¼ï¼æ å®éå«ä¹\n\n\n1\n2\n3\n4\n5\n\n\nâ ï¸ æ³¨æ: lambda è¡¨è¾¾å¼åªè½ç®åå½æ°å¼æ¥å£çå¿ååé¨ç±»çåæ³å½¢å¼\n\nå½æ°å¼æ¥å£è¦æ±ï¼\n\n 1. å¿é¡»æ¯æ¥å£\n 2. æ¥å£ä¸­æä¸ä»æä¸ä¸ªæ½è±¡æ¹æ³\n 3. è¥æ@functionalinterfaceæ³¨è§£ï¼åè¡¨æè¯¥æ¥å£æ¯ä¸ä¸ªå½æ°å¼æ¥å£\n\nç¤ºä¾ç®åå¸¸è§å½æ°å¼æ¥å£ï¼\n\n\n\n\n\n**lambda è¡¨è¾¾å¼ççç¥è§å: **\n\n * åæ°ç±»åå¯ä»¥çç¥ä¸åã\n * å¦æåªæä¸ä¸ªåæ°ï¼åæ°ç±»åå¯ä»¥çç¥ï¼åæ¶()ä¹å¯ä»¥çç¥ã\n * å¦ælambdaè¡¨è¾¾å¼çæ¹æ³ä½ä»£ç åªæä¸è¡ä»£ç ãå¯ä»¥çç¥å¤§æ¬å·ä¸å,åæ¶è¦çç¥åå·ï¼\n * å¦ælambdaè¡¨è¾¾å¼çæ¹æ³ä½ä»£ç åªæä¸è¡ä»£ç ãå¯ä»¥çç¥å¤§æ¬å·ä¸åãæ­¤æ¶ï¼å¦æè¿è¡ä»£ç æ¯returnè¯­å¥ï¼å¿é¡»çç¥returnä¸åï¼åæ¶ä¹å¿é¡»çç¥";"ä¸å',charsets:{cjk:!0},lastUpdated:"2023/03/15, 14:34:12",lastUpdatedTimestamp:1678890852e3},{title:"é¢åå¯¹è±¡è¿é¶5ï¼éåä½ç³»ï¼",frontmatter:{title:"é¢åå¯¹è±¡è¿é¶5ï¼éåä½ç³»ï¼",date:"2023-03-15T15:18:28.000Z",permalink:"/pages/6013df/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/34.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B65%EF%BC%88%E9%9B%86%E5%90%88%E4%BD%93%E7%B3%BB%EF%BC%89.html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/34.é¢åå¯¹è±¡è¿é¶5ï¼éåä½ç³»ï¼.md",key:"v-4f80c998",path:"/pages/6013df/",headers:[{level:2,title:"1. éåä½ç³»æ¦è¿°",slug:"_1-éåä½ç³»æ¦è¿°",normalizedTitle:"1. éåä½ç³»æ¦è¿°",charIndex:2},{level:3,title:"1.1 éåä¸æ°ç»",slug:"_1-1-éåä¸æ°ç»",normalizedTitle:"1.1 éåä¸æ°ç»",charIndex:16},{level:3,title:"1.2 éåç±»çä½ç³»ç»æ",slug:"_1-2-éåç±»çä½ç³»ç»æ",normalizedTitle:"1.2 éåç±»çä½ç³»ç»æ",charIndex:234},{level:3,title:"1.3 Collection éåçä½ç³»",slug:"_1-3-collection-éåçä½ç³»",normalizedTitle:"1.3 collection éåçä½ç³»",charIndex:337},{level:3,title:"1.4 éåå¯¹æ³åçæ¯æ",slug:"_1-4-éåå¯¹æ³åçæ¯æ",normalizedTitle:"1.4 éåå¯¹æ³åçæ¯æ",charIndex:595},{level:4,title:"1.4.1 èªå®ä¹æ³åç±»",slug:"_1-4-1-èªå®ä¹æ³åç±»",normalizedTitle:"1.4.1 èªå®ä¹æ³åç±»",charIndex:981},{level:4,title:"1.4.2 èªå®ä¹æ³åæ¹æ³",slug:"_1-4-2-èªå®ä¹æ³åæ¹æ³",normalizedTitle:"1.4.2 èªå®ä¹æ³åæ¹æ³",charIndex:1480},{level:4,title:"1.4.3 èªå®ä¹æ³åæ¥å£",slug:"_1-4-3-èªå®ä¹æ³åæ¥å£",normalizedTitle:"1.4.3 èªå®ä¹æ³åæ¥å£",charIndex:1961},{level:4,title:"1.4.4 æ³åééç¬¦ãä¸ä¸é",slug:"_1-4-4-æ³åééç¬¦ãä¸ä¸é",normalizedTitle:"1.4.4 æ³åééç¬¦ãä¸ä¸é",charIndex:3222},{level:2,title:"2. Collection éå",slug:"_2-collection-éå",normalizedTitle:"2. collection éå",charIndex:3412},{level:3,title:"2.1 å³äº Collection èªèº«",slug:"_2-1-å³äº-collection-èªèº«",normalizedTitle:"2.1 å³äº collection èªèº«",charIndex:3433},{level:3,title:"2.2 å¸¸è§çæ°æ®ç»æ",slug:"_2-2-å¸¸è§çæ°æ®ç»æ",normalizedTitle:"2.2 å¸¸è§çæ°æ®ç»æ",charIndex:8231},{level:3,title:"2.3 Collection ä¹ List ç³»åéå",slug:"_2-3-collection-ä¹-list-ç³»åéå",normalizedTitle:"2.3 collection ä¹ list ç³»åéå",charIndex:8441},{level:4,title:"2.3.1 ArrayList éåçåºå±åç",slug:"_2-3-1-arraylist-éåçåºå±åç",normalizedTitle:"2.3.1 arraylist éåçåºå±åç",charIndex:8944},{level:4,title:"2.3.2 LinkedList éåçåºå±åç",slug:"_2-3-2-linkedlist-éåçåºå±åç",normalizedTitle:"2.3.2 linkedlist éåçåºå±åç",charIndex:9095},{level:3,title:"2.4 Collection ä¹ Set ç³»åéå",slug:"_2-4-collection-ä¹-set-ç³»åéå",normalizedTitle:"2.4 collection ä¹ set ç³»åéå",charIndex:10347},{level:4,title:"2.4.1 HashSet éåçåºå±åç",slug:"_2-4-1-hashset-éåçåºå±åç",normalizedTitle:"2.4.1 hashset éåçåºå±åç",charIndex:10586},{level:4,title:"2.4.2 LinkedHashSet éå",slug:"_2-4-2-linkedhashset-éå",normalizedTitle:"2.4.2 linkedhashset éå",charIndex:11464},{level:4,title:"2.4.3 TreeSet éå",slug:"_2-4-3-treeset-éå",normalizedTitle:"2.4.3 treeset éå",charIndex:11606},{level:3,title:"2.5 Collection ä½ç³»çç¹ç¹ãä½¿ç¨åºæ¯æ»ç»",slug:"_2-5-collection-ä½ç³»çç¹ç¹ãä½¿ç¨åºæ¯æ»ç»",normalizedTitle:"2.5 collection ä½ç³»çç¹ç¹ãä½¿ç¨åºæ¯æ»ç»",charIndex:14124},{level:2,title:"3. Collections éåå·¥å·ç±»",slug:"_3-collections-éåå·¥å·ç±»",normalizedTitle:"3. collections éåå·¥å·ç±»",charIndex:14449}],headersStr:"1. éåä½ç³»æ¦è¿° 1.1 éåä¸æ°ç» 1.2 éåç±»çä½ç³»ç»æ 1.3 Collection éåçä½ç³» 1.4 éåå¯¹æ³åçæ¯æ 1.4.1 èªå®ä¹æ³åç±» 1.4.2 èªå®ä¹æ³åæ¹æ³ 1.4.3 èªå®ä¹æ³åæ¥å£ 1.4.4 æ³åééç¬¦ãä¸ä¸é 2. Collection éå 2.1 å³äº Collection èªèº« 2.2 å¸¸è§çæ°æ®ç»æ 2.3 Collection ä¹ List ç³»åéå 2.3.1 ArrayList éåçåºå±åç 2.3.2 LinkedList éåçåºå±åç 2.4 Collection ä¹ Set ç³»åéå 2.4.1 HashSet éåçåºå±åç 2.4.2 LinkedHashSet éå 2.4.3 TreeSet éå 2.5 Collection ä½ç³»çç¹ç¹ãä½¿ç¨åºæ¯æ»ç» 3. Collections éåå·¥å·ç±»",content:'# 1. éåä½ç³»æ¦è¿°\n\n\n# 1.1 éåä¸æ°ç»\n\néååæ°ç»é½æ¯å®¹å¨\n\n * å³äºå­å¨åç´ çä¸ªæ°ï¼\n   \n   æ°ç»å®ä¹åç±»åç¡®å®ï¼é¿åº¦åºå®\n   \n   éåç±»åå¯ä»¥ä¸åºå®ï¼å¤§å°æ¯å¯åç\n\n * å³äºå­å¨åç´ çç±»åï¼\n   \n   æ°ç»å¯ä»¥å­å¨åºæ¬ç±»ååå¼ç¨ç±»åçæ°æ®\n   \n   éååªè½å­å¼ç¨æ°æ®ç±»åçæ°æ®\n\n * å³äºéåçåºæ¯ï¼\n   \n   æ°ç»éååæ°æ®ä¸ªæ°åç±»åç¡®å®çåºæ¯\n   \n   éåéååæ°æ®ä¸ªæ°ä¸ç¡®å®ï¼ä¸è¦åå¢å åç´ çåºæ¯\n\n\n# 1.2 éåç±»çä½ç³»ç»æ\n\n\n\néåç±»åä¸ºä¸¤ç§ä½ç³»ï¼Collection å MapãCollection ååéåï¼æ¯ä¸ªåç´ ï¼æ°æ®ï¼åªåå«ä¸ä¸ªå¼ï¼Map ååéåï¼æ¯ä¸ªåç´ åå«ä¸¤ä¸ªå¼ï¼é®å¼å¯¹ï¼ã\n\n\n# 1.3 Collection éåçä½ç³»\n\n\n\n> ä¸å¾ä¸­åªæ¯ååºäºå ä¸ªå¸¸ç¨çç±»åã\n\nCollection éååä¸ºä¸¤ç±»å¸¸ç¨çéåä½ç³»ï¼\n\n * List ç³»åéåï¼æ·»å çåç´ æåºãå¯éå¤ãæç´¢å¼\n   * ArrayListãLinekdList ï¼æåºãå¯éå¤ãæç´¢å¼\n * Set ç³»åéåï¼æ·»å çåç´ æ¯æ åºãä¸éå¤ãæ ç´¢å¼\n   * HashSet: æ åºãä¸éå¤ãæ ç´¢å¼ï¼LinkedHashSet: æåºãä¸éå¤ãæ ç´¢å¼\n   * TreeSetï¼**æç§å¤§å°é»è®¤ååºæåºã**ä¸éå¤ãæ ç´¢å¼\n\n\n# 1.4 éåå¯¹æ³åçæ¯æ\n\néåä½ç³»çå¨é¨æ¥å£åå®ç°ç±»é½æ¯æ¯ææ³åçä½¿ç¨çï¼å¯ä»¥å¨ç¼è¯é¶æ®µçº¦æéååªè½æä½æç§æ°æ®ç±»åãï¼æè¿è¡æ¶æçé®é¢æåå°äºç¼è¯æé´ï¼é¿åäºå¼ºå¶ç±»åè½¬æ¢å¯è½åºç°çå¼å¸¸ï¼\n\nCollection<String> lists = new ArrayList<String>();\nCollection<String> lists = new ArrayList<>(); // JDK 1.7å¼å§åé¢çæ³åç±»åç³æå¯ä»¥çç¥ä¸å\n\n\n1\n2\n\n\nâ ï¸ æ³¨æï¼éååæ³åé½åªè½æ¯æå¼ç¨æ°æ®ç±»åï¼ä¸æ¯æåºæ¬æ°æ®ç±»åï¼æä»¥éåä¸­å­å¨çåç´ é½è®¤ä¸ºæ¯å¯¹è±¡\n\næ³åçåçï¼\n\næåºç°æ³ååéçå°æ¹å¨é¨æ¿æ¢æä¼ è¾ççå®æ°æ®ç±»åã\n\næ³åçå®ä¹ä½ç½®ï¼\n\n * ç±»åé¢ --- > æ³åç±»\n * æ¹æ³ç³æä¸ --- > æ³åæ¹æ³\n * æ¥å£åé¢ --- > æ³åæ¥å£\n\n# 1.4.1 èªå®ä¹æ³åç±»\n\næ³åç±»çæ ¼å¼ï¼ä¿®é¥°ç¬¦ class ç±»å<æ³ååé>{ }ï¼æ­¤å¤æ³ååé T å¯ä»¥éä¾¿åä¸ºä»»ææ è¯ï¼å¸¸è§çå¦ EãTãKãV ç­\n\nä½ç¨ï¼ç¼è¯é¶æ®µçº¦å®æä½çæ°æ®çç±»åï¼ç±»ä¼¼äºéåçä½ç¨ã\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\nÂ \n\n\n\nÂ \n\n\n\n\n\n\n\n\n\n\npublic class MyArrayList<E> {\n    private ArrayList lists = new ArrayList();\n\n    public void add(E e){  // ä¸æ¯æ³åæ¹æ³ãåªæ¯ä½¿ç¨ç±»å®ä¹çè¿ä¸ªæ³å Eï¼èä¸æ¯ä»èªå·±å®ä¹äºæ³å\n        lists.add(e);\n    }\n\n    public void remove(E e){\n        lists.remove(e);\n    }\n\n    @Override\n    public String toString() {\n        return lists.toString();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# 1.4.2 èªå®ä¹æ³åæ¹æ³\n\næ³åæ¹æ³çæ ¼å¼ï¼ä¿®é¥°ç¬¦ <æ³ååé> æ¹æ³è¿åå¼ æ¹æ³åç§°(å½¢ååè¡¨){}\n\nä½ç¨ï¼æ¹æ³ä¸­å¯ä»¥ä½¿ç¨æ³åæ¥æ¶ä¸åå®éç±»åçåæ°ï¼æ¹æ³æ´å·å¤éç¨æ§\n\nç¤ºä¾ä»£ç ï¼\n\npublic static void main(String[] args) {\n    String[] names = {"å°ç", "èå®¹", "å°ä½"};\n    printArray(names);\n\n    Integer[] ages = {10, 20, 30};\n    printArray(ages);\n\n    Integer[] ages2 = getArr(ages);  // è°ç¨æ³åå½æ°ï¼å¾å°çåå®¹ä¸éè¦å¼ºè½¬ä¸ºå·ä½çç±»å\n    String[]  names2 = getArr(names);  // ä¼ è¿å»å¥ç±»åï¼è¿ååºæ¥è¿æ¯å¥ç±»å\n}\n\npublic static <T> T[] getArr(T[] arr){\n    return arr;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# 1.4.3 èªå®ä¹æ³åæ¥å£\n\næ³åæ¥å£çæ ¼å¼ï¼ä¿®é¥°ç¬¦ interface æ¥å£åç§°<æ³ååé>{}\n\nä½ç¨ï¼æ³åæ¥å£å¯ä»¥è®©å®ç°ç±»éæ©å½ååè½éè¦æä½çæ°æ®ç±»åã\n\nå®ç°ç±»å¯ä»¥å¨å®ç°æ¥å£çæ¶åä¼ å¥èªå·±æä½çæ°æ®ç±»åï¼è¿æ ·éåçæ¹æ³é½å°æ¯éå¯¹äºè¯¥ç±»åçæä½ã\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\n\n\n\nÂ \nÂ \n\nÂ \n\n\n\nÂ \n\nÂ \n\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\nÂ \n\nÂ \n\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\n\n\n// éæ±ï¼æå¡ç³»ç»ï¼æä¾ä¸ä¸ªæ¥å£å¯çº¦æä¸å®è¦å®ææ°æ®ï¼å­¦çï¼èå¸ï¼çå¢å æ¹æ¥æä½\npublic class Student {\n}\n\npublic class Teacher {\n}\n\npublic interface Data<E> {  // æä½æ°æ®çæ¥å£\n    void add(E e);\n    void delete(int id);\n    void update(E e);\n    E queryById(int id);\n}\n\npublic class StudentData implements Data<Student>{  // æä½å­¦çç±»æ°æ®çå®ç°\n    @Override\n    public void add(Student student) {\n\n    }\n\n    @Override\n    public void delete(int id) {\n\n    }\n\n    @Override\n    public void update(Student student) {\n\n    }\n\n    @Override\n    public Student queryById(int id) {\n        return null;\n    }\n}\n\npublic class TeacherData implements Data<Teacher>{  // æä½æå¸ç±»æ°æ®çå®ç°\n    @Override\n    public void add(Teacher teacher) {\n\n    }\n\n    @Override\n    public void delete(int id) {\n\n    }\n\n    @Override\n    public void update(Teacher teacher) {\n\n    }\n\n    @Override\n    public Teacher queryById(int id) {\n        return null;\n    }\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n\n\n# 1.4.4 æ³åééç¬¦ãä¸ä¸é\n\nééç¬¦ï¼?\n\n * ? å¯ä»¥å¨âä½¿ç¨æ³åâçæ¶åä»£è¡¨ä¸åç±»åãå°±æ¯å¨åºè¯¥å¡«æ³åçä½ç½®ï¼å¡« â<?>â ã\n\n * E T K V æ¯å¨å®ä¹æ³åçæ¶åä½¿ç¨çã\n\næ³åçä¸ä¸éï¼\n\n * æ³åä¸éï¼ <? extends Car>ï¼å¿é¡»æ¯Caræèå¶å­ç±»\n * æ³åä¸éï¼<? super Car> ï¼å¿é¡»æ¯Caræèå¶ç¶ç±» ï¼ç¨çç¸å¯¹è¾å°\n\n\n# 2. Collection éå\n\n\n# 2.1 å³äº Collection èªèº«\n\nCollection æ¯ååéåçç¥å®æ¥å£ï¼å®çåè½æ¯å¨é¨ååéåé½å¯ä»¥ç»§æ¿ä½¿ç¨çã\n\nCollection çå¸¸ç¨ APIï¼\n\næ¹æ³åç§°                                  è¯´æ\npublic boolean add(E e)               æç»å®çå¯¹è±¡æ·»å å°å½åéåä¸­\npublic boolean addAll(E e)            æc2(åæ°)éåçåç´ å¨é¨åå¥å°c1(è¢«è°éå)ä¸­å»\npublic void clear()                   æ¸ç©ºéåä¸­ææçåç´ \npublic boolean remove(E e)            æç»å®çå¯¹è±¡å¨å½åéåä¸­å é¤\npublic boolean contains(Object obj)   å¤æ­å½åéåä¸­æ¯å¦åå«ç»å®çå¯¹è±¡\npublic boolean isEmpty()              å¤æ­å½åéåæ¯å¦ä¸ºç©º\npublic int size()                     è¿åéåä¸­åç´ çä¸ªæ°ã\npublic Object[] toArray()             æéåä¸­çåç´ ï¼å­å¨å°æ°ç»ä¸­\n\nCollection éåçéåï¼\n\n * æ³1ï¼è¿­ä»£å¨\n   \n   è¿­ä»£å¨ï¼Java ä¸­ä¸º Iteratorï¼æ¯éåçä¸ç¨éåæ¹å¼ã\n   \n   Collection éåè·åè¿­ä»£å¨ï¼\n   \n   Iterator<E> iterator()ï¼è¿åéåä¸­çè¿­ä»£å¨å¯¹è±¡ï¼è¯¥è¿­ä»£å¨å¯¹è±¡é»è®¤æåå½åéåç 0 ç´¢å¼\n   \n   Iteratorä¸­çå¸¸ç¨æ¹æ³ï¼\n   \n   æ¹æ³åç§°                è¯´æ\n   boolean hasNext()   è¯¢é®å½åä½ç½®æ¯å¦æåç´ å­å¨ï¼å­å¨è¿åtrue ,ä¸å­å¨è¿åfalse\n   E next()            è·åå½åä½ç½®çåç´ ï¼å¹¶åæ¶å°è¿­ä»£å¨å¯¹è±¡ç§»åä¸ä¸ä¸ªä½ç½®ï¼æ³¨æé²æ­¢ååºè¶çã\n   \n   è¿­ä»£å¨ååç´ è¶çä¼åºç° NoSuchElementException å¼å¸¸ã\n   \n   éåæµç¨çç¤ºä¾ä»£ç ï¼\n   \n   \n   \n   \n   \n   \n   \n   \n   \n   Â \n   \n   \n   \n   Â \n   Â \n   \n   \n   \n   \n   \n   \n   public class CollectionDemo01 {\n       public static void main(String[] args) {\n           ArrayList<String> lists = new ArrayList<>();\n           Collections.addAll(lists, "èµµæ","å°æ­", "ç´ ç´ ","ç­ç»");\n           System.out.println(lists);  // [èµµæ, å°æ­, ç´ ç´ , ç­ç»]\n   \n           // 1ãå¾å°å½åéåçè¿­ä»£å¨å¯¹è±¡ã\n           Iterator<String> it = lists.iterator();\n   \n           // 2ãå®ä¹whileå¾ªç¯\n           while (it.hasNext()){\n               String ele = it.next();\n               System.out.println(ele);\n           }\n           System.out.println("-----------------------------");\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   \n\n * æ³2ï¼foreach / å¢å¼º for å¾ªç¯\n   \n   å¢å¼º for å¾ªç¯ï¼æ¢å¯ä»¥éåéåä¹å¯ä»¥éåæ°ç»\n   \n   éåæ ¼å¼ï¼\n   \n    for(è¢«éåéåæèæ°ç»ä¸­åç´ çç±»å åéåç§° : è¢«éåéåæèæ°ç»){\n     //å¨æ­¤å¤ä½¿ç¨åéå³å¯ï¼è¯¥åéå°±æ¯åç´ \n   }\n   \n   \n   1\n   2\n   3\n   \n   \n   éåæµç¨çç¤ºä¾ä»£ç ï¼\n   \n   public static void main(String[] args) {\n       Collection<String> lists = new ArrayList<>();\n       System.out.println(lists);  // [èµµæ, å°æ­, æ®·ç´ ç´ , å¨è·è¥]\n   \n       for (String ele : lists) {\n           System.out.println(ele);\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   \n   \n   â ï¸ æ³¨æï¼ä¿®æ¹ç¬¬ä¸æ¹åéçå¼ä¸ä¼å½±åå°éåä¸­çåç´ ãå³ï¼å¨ä¸è¿°ä»£ç ä¸­ä¿®æ¹ ele çå¼ï¼ä¸ä¼å½±åå° lists ä¸­å½ååç´ çå¼ï¼æä¸è½éè¿ foreach å¾ªç¯æ¥ä¿®æ¹åç´ çå¼ã\n   \n   ä½¿ç¨å¢å¼º for çå¿«æ·é®\n   \n   IDEA ä¸­è¾å¥ï¼lists.forï¼æ­¤æ¶ä¼èªå¨æç¤ºå¢å¼º for\n\n * æ³3ï¼lambda è¡¨è¾¾å¼\n   \n   JDK 1.8å¼å§ä¹åçæ°ææ¯Lambdaè¡¨è¾¾å¼ï¼ææä¸ç§æ´ç®åãæ´ç´æ¥çéåéåçæ¹å¼\n   \n   Collection ç»å Lambda éåéåç APIï¼\n   \n   æ¹æ³åç§°                                                è¯´æ\n   default void forEach(Consumer<? super T> action):   ç»ålambdaéåéå\n   \n   éåæµç¨çç¤ºä¾ä»£ç ï¼\n   \n   lists.forEach(new Consumer<String>() {\n       @Override\n       public void accept(String s) {\n           System.out.println(s);\n       }\n   });\n   \n   // ç®åä¸ºï¼ãéè¦ææ¡çæ¹æ³ã\n   lists.forEach(s -> {\n       System.out.println(s);\n   });\n   \n   // è¿ä¸æ­¥ç®å:\n   lists.forEach(s ->  System.out.println(s) );\n   \n   // ç»çç®åï¼\n   lists.forEach(System.out::println );\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   \n   \n   ð consumer çå·ä½å«ä¹åä¸ç¨ç®¡ï¼ä¼ç¨ forEach è¿ä¸ªæ¹æ³éåå°±è¡äºã\n\néåä¸­å­å¨çåç´ æ¯åç´ å¯¹è±¡çå°å\n\néåçå¹¶åä¿®æ¹å¼å¸¸é®é¢\n\nQï¼å½æä»¬ä»éåä¸­æ¾åºæä¸ªåç´ å¹¶å é¤çæ¶åå¯è½åºç°ä¸ç§å¹¶åä¿®æ¹å¼å¸¸é®é¢\n\nåªäºéåå­å¨é®é¢ï¼\n\n * è¿­ä»£å¨éåéåä¸ç´æ¥ç¨éåå é¤åç´ çæ¶åå¯è½åºç°\n * å¢å¼º for å¾ªç¯éåéåä¸ç´æ¥ç¨éåå é¤åç´ çæ¶åå¯è½åºç°\n * Lambda éåä¸è½è¾¹éåè¾¹å é¤ï¼ä¼åº bug\n\nåªç§éåä¸å é¤åç´ ä¸åºé®é¢ï¼\n\n * è¿­ä»£å¨éåéåä½æ¯ç¨è¿­ä»£å¨èªå·±çå é¤æ¹æ³æä½å¯ä»¥è§£å³\n * ä½¿ç¨ for å¾ªç¯éåå¹¶å é¤åç´ ä¸ä¼å­å¨è¿ä¸ªé®é¢\n\nç¤ºä¾ï¼\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \nÂ \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\n    public static void main(String[] args) {\n        // 1ãåå¤æ°æ®\n        ArrayList<String> list = new ArrayList<>();\n        // æ·»å ä¸æ¹åç´ \n        System.out.println(list); // [é»é©¬, Java, Java, èµµæ, èµµæ, ç´ ç´ ]\n\n        // éæ±ï¼å é¤å¨é¨çJavaä¿¡æ¯ã\n        // aãè¿­ä»£å¨éåå é¤\n        Iterator<String> it = list.iterator();\n        while (it.hasNext()){\n            String ele = it.next();\n            if("Java".equals(ele)){\n                // å é¤Java\n                // list.remove(ele); // éåå é¤ä¼åºæ¯ç\n                it.remove(); // å é¤è¿­ä»£å¨æå¨ä½ç½®çåç´ å¼ï¼æ²¡æ¯çï¼\n            }\n        }\n        System.out.println(list);\n\n        // bãforeachéåå é¤ (ä¼åºç°é®é¢ï¼è¿ç§æ æ³è§£å³çï¼foreachä¸è½è¾¹éåè¾¹å é¤ï¼ä¼åºbug)\n        for (String s : list) {\n            if("Java".equals(s)){\n                list.remove(s);\n            }\n        }\n\n        // cãlambdaè¡¨è¾¾å¼(ä¼åºç°é®é¢ï¼è¿ç§æ æ³è§£å³çï¼Lambdaéåä¸è½è¾¹éåè¾¹å é¤ï¼ä¼åºbug)\n        list.forEach(s -> {\n            if("Java".equals(s)){\n                list.remove(s);\n            }\n        });\n\n        // dãforå¾ªç¯(è¾¹éåè¾¹å é¤éåæ²¡æ¯çï¼ä½æ¯å¿é¡»ä»åé¢å¼å§éåå é¤æä¸ä¼åºç°æ¼æåºè¯¥å é¤çåç´ )\n        for (int i = list.size() - 1; i >= 0 ; i--) {\n            String ele = list.get(i);\n            if("Java".equals(ele)){\n                list.remove(ele);\n            }\n        }\n        System.out.println(list);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\n\n# 2.2 å¸¸è§çæ°æ®ç»æ\n\néåï¼åè¿ååºï¼åè¿ååºã\n\næ ï¼åè¿ååºï¼åè¿ååºã\n\næ°ç»ï¼åå­è¿ç»­åºåï¼æ¥è¯¢å¿«ï¼å¢å æ¢ã\n\né¾è¡¨ï¼åç´ æ¯æ¸¸ç¦»çï¼æ¥è¯¢æ¢ï¼é¦å°¾æä½æå¿«ã\n\näºåæ ï¼æ°¸è¿åªæä¸ä¸ªæ ¹èç¹, æ¯ä¸ªç»ç¹ä¸è¶è¿2ä¸ªå­èç¹çæ ã\n\næ¥æ¾äºåæ ï¼å°çå·¦è¾¹ï¼å¤§çå³è¾¹ï¼ä½æ¯å¯è½æ å¾é«ï¼æ¥è¯¢æ§è½åå·®ã\n\nå¹³è¡¡æ¥æ¾äºåæ ï¼è®©æ çé«åº¦å·®ä¸å¤§äº1ï¼å¢å æ¹æ¥é½æé«äºã\n\nçº¢é»æ ï¼å°±æ¯åºäºçº¢é»è§åå®ç°äºèªå¹³è¡¡çæåºäºåæ ï¼\n\n\n# 2.3 Collection ä¹ List ç³»åéå\n\nList ç³»åéåç¹ç¹ï¼ï¼1ï¼æåºï¼å­å¨åååºçåç´ é¡ºåºä¸è´ï¼ï¼2ï¼æç´¢å¼ï¼å¯ä»¥éè¿ç´¢å¼æä½åç´ ï¼ï¼3ï¼å¯éå¤ï¼å­å¨çåç´ å¯ä»¥éå¤ã\n\nå¸¸è§çä¸¤ç§ä¸º ArrayListãLinekdListã\n\nList ç³»åéåç¹æçæ¹æ³ï¼\n\n> Listéåå ä¸ºæ¯æç´¢å¼ï¼æä»¥å¤äºå¾å¤ç´¢å¼æä½çç¬ç¹apiï¼å¶ä»Collectionçåè½Listä¹é½ç»§æ¿äº\n\næ¹æ³åç§°                            è¯´æ\nvoid add(int index,E element)   å¨æ­¤éåä¸­çæå®ä½ç½®æå¥æå®çåç´ \nE remove(int index)             å é¤æå®ç´¢å¼å¤çåç´ ï¼è¿åè¢«å é¤çåç´ \nE set(int index,E element)      ä¿®æ¹æå®ç´¢å¼å¤çåç´ ï¼è¿åè¢«ä¿®æ¹çåç´ \nE get(int index)                è¿åæå®ç´¢å¼å¤çåç´ \n\nList ç³»åéåçéåæ¹å¼ï¼\n\nâ è¿­ä»£å¨\n\nâ¡å¢å¼ºforå¾ªç¯\n\nâ¢Lambdaè¡¨è¾¾å¼\n\nâ£forå¾ªç¯ï¼å ä¸ºListéåå­å¨ç´¢å¼ï¼\n\n# 2.3.1 ArrayList éåçåºå±åç\n\nArrayList åºå±æ¯åºäºæ°ç»å®ç°çï¼æ ¹æ®ç´¢å¼å®ä½åç´ ï¼å¿«ï¼å¢å ç¸å¯¹æ¢ï¼éè¦ååç´ çç§»ä½æä½ã\n\nç¬¬ä¸æ¬¡åå»ºéåå¹¶æ·»å ç¬¬ä¸ä¸ªåç´ çæ¶åï¼å¨åºå±åå»ºä¸ä¸ªé»è®¤é¿åº¦ä¸º10çæ°ç»\n\nListéåå­å¨çåç´ è¦è¶è¿å®¹éæ¶ï¼æ©å®¹å°åæ¥å¤§å°ç 1.5 åã\n\n# 2.3.2 LinkedList éåçåºå±åç\n\nLinkedList åºå±åºäºåé¾è¡¨å®ç°çï¼æ¥è¯¢åç´ æ¢ï¼å¢å é¦å°¾åç´ éå¸¸å¿«ï¼æä»¥å¤äºå¾å¤é¦å°¾æä½çç¹æ APIã\n\nList ç³»åéåç¹æçæ¹æ³ï¼\n\næ¹æ³åç§°                        è¯´æ\npublic void addFirst(E e)   å¨è¯¥åè¡¨å¼å¤´æå¥æå®çåç´ \npublic void addLast(E e)    å°æå®çåç´ è¿½å å°æ­¤åè¡¨çæ«å°¾\npublic E getFirst()         è¿åæ­¤åè¡¨ä¸­çç¬¬ä¸ä¸ªåç´ \npublic E getLast()          è¿åæ­¤åè¡¨ä¸­çæåä¸ä¸ªåç´ \npublic E removeFirst()      ä»æ­¤åè¡¨ä¸­å é¤å¹¶è¿åç¬¬ä¸ä¸ªåç´ \npublic E removeLast()       ä»æ­¤åè¡¨ä¸­å é¤å¹¶è¿åæåä¸ä¸ªåç´ \n\nâ¨ LinkedList å¯ä»¥å®æéåç»æï¼åæ ç»æ ï¼åé¾è¡¨ï¼ï¼ç¤ºä¾ä»£ç ï¼\n\npublic static void main(String[] args) {\n    // 1ãåä¸ä¸ªéåï¼\n    LinkedList<String> queue = new LinkedList<>();\n    // å¥é\n    queue.addLast("1å·");\n    queue.addLast("2å·");\n    queue.addLast("3å·");\n    System.out.println(queue);\n    // åºé\n    System.out.println(queue.removeFirst());\n    System.out.println(queue.removeFirst());\n    System.out.println(queue);\n\n    // 2ãåä¸ä¸ªæ \n    LinkedList<String> stack = new LinkedList<>();\n    // å¥æ  åæ  (push)\n    stack.push("ç¬¬1é¢å­å¼¹");\n    stack.push("ç¬¬2é¢å­å¼¹");\n    stack.push("ç¬¬3é¢å­å¼¹");\n    stack.push("ç¬¬4é¢å­å¼¹");\n    System.out.println(stack);\n\n    // åºæ   å¼¹æ  pop\n    System.out.println(stack.pop());\n    System.out.println(stack.pop());\n    System.out.println(stack.pop());\n    System.out.println(stack);\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# 2.4 Collection ä¹ Set ç³»åéå\n\nSet ç³»åéåçç¹ç¹ï¼ï¼1ï¼æ åºï¼å­åé¡ºåºä¸ä¸è´ï¼ï¼2ï¼ä¸éå¤ï¼å¯ä»¥å»é¤éå¤ï¼ï¼3ï¼æ ç´¢å¼ï¼æ²¡æå¸¦ç´¢å¼çæ¹æ³ï¼ä¸è½ç¨æ®éforå¾ªç¯éåï¼ä¹ä¸è½éè¿ç´¢å¼æ¥è·ååç´ ã\n\nSet éåå®ç°ç±»çç¹ç¹ï¼\n\n * HashSet : æ åºãä¸éå¤ãæ ç´¢å¼\n * LinkedHashSetï¼æåºãä¸éå¤ãæ ç´¢å¼\n * TreeSetï¼æåºãä¸éå¤ãæ ç´¢å¼\n\nSet éåçåè½ï¼åºæ¬ä¸ Collection ç API ä¸è´ã\n\n# 2.4.1 HashSet éåçåºå±åç\n\nHashSet éååºå±éååå¸è¡¨å­å¨çæ°æ®ï¼å¯¹å¢å æ¹æ¥æ§è½é½å¾å¥½ã\n\nHashè¡¨çç»æï¼\n\n * JDK8ä¹åçï¼åºå±ä½¿ç¨æ°ç» + é¾è¡¨ç»æ\n * JDK8å¼å§åï¼åºå±éç¨æ°ç» + é¾è¡¨ + çº¢é»æ ç»æ\n\nHash å¼ï¼\n\nJDK æ ¹æ®å¯¹è±¡çå°åï¼æç§æç§è§åç®åºæ¥ç int ç±»åçæ°å¼ã\n\néè¿ Object ç±»ç API public int hashCode() æ¥è¿åå¯¹è±¡çåå¸å¼ã\n\nå¯¹è±¡ç Hash å¼çç¹ç¹ï¼\n\n * åä¸ä¸ªå¯¹è±¡å¤æ¬¡è°ç¨ hashCode() æ¹æ³è¿åçåå¸å¼æ¯ç¸åç\n * é»è®¤æåµä¸ï¼ä¸åå¯¹è±¡çåå¸å¼ä¸å\n\nHashSet åçè¯¦ç»æµç¨è§£æï¼\n\n 1. åå»ºä¸ä¸ªé»è®¤é¿åº¦ 16 ãå è½½å å­ 0.75 çæ°ç»ï¼æ°ç»åtable\n 2. æ ¹æ®åç´ çåå¸å¼è·æ°ç»çé¿åº¦æ±ä½è®¡ç®åºåºå­å¥çä½ç½®ï¼åå¸ç®æ³ï¼\n 3. å¤æ­å½åä½ç½®æ¯å¦ä¸º nullï¼å¦ææ¯ null ç´æ¥å­å¥\n 4. å¦æä½ç½®ä¸ä¸º nullï¼è¡¨ç¤ºæåç´ ï¼åè°ç¨ equals æ¹æ³æ¯è¾å±æ§å¼\n    1. å¦æä¸æ ·ï¼åä¸å­ï¼\n    2. å¦æä¸ä¸æ ·ï¼åå­å¥æ°ç»ï¼\n    * JDK 7 æ°åç´ å èåç´ ä½ç½®ï¼æåèåç´ \n    * JDK 8 ä¸­æ°åç´ æå¨èåç´ ä¸é¢\n 5. å½æå¨åç´ ä¸é¢çæ°æ®è¿å¤æ¶ï¼æ¥è¯¢æ§è½éä½ã ä» JDK8 å¼å§ï¼å½é¾è¡¨é¿åº¦è¶è¿ 8 çæ¶åï¼èªå¨è½¬æ¢ä¸ºçº¢é»æ ã\n 6. å½æ°ç»å­æ»¡å° 16*0.75=12 æ¶ï¼å°±èªå¨æ©å®¹ï¼æ¯æ¬¡æ©å®¹ååçä¸¤åã\n\n> åå¸è¡¨å¼å¥çº¢é»æ è¿ä¸æ­¥æé«äºæä½æ°æ®çæ§è½ã\n\næ»ç»ï¼\n\n * HashSet åç´ æ åºçåºå±åçï¼ä½¿ç¨äºåå¸è¡¨ï¼Hash å¼çè®¡ç®è§åå¯¼è´äºæ åºï¼ã\n\n * HashSet å»éå¤çåºå±åçï¼å½è¯¥åç´ è¦å­å¥çä½ç½®ä¸ä¸º null æ¶ï¼ä¼è¿è¡åç´ æ¯è¾ï¼ä¸ä¸æ ·çæä¼å­å¥ãå¦æµç¨ 4 ä¸­æè¿°ã\n\nð¡ å¦æå¸æ Set éåè®¤ä¸ºä¸¤ä¸ªåå®¹ä¸æ ·ï¼èéå°åä¸æ ·ï¼çå¯¹è±¡æ¯éå¤çï¼å¿é¡»éåå¯¹è±¡ç hashCode() å equals() æ¹æ³\n\n# 2.4.2 LinkedHashSet éå\n\nç¹ç¹ï¼æåº ä¸éå¤ æ ç´¢å¼\n\nLinkedHashSet éåä¸­âæåºâçç¹ç¹æçæ¯ä¿è¯å­å¨åååºçåç´ é¡ºåºä¸è´ã\n\nLinkedHashSet éååºå±ä¹æ¯åºäºåå¸è¡¨å®ç°çï¼åªæ¯æ¯ä¸ªåç´ åé¢å¤å¤äºä¸ä¸ªåé¾è¡¨æºå¶è®°å½å­å¨çé¡ºåºã\n\n# 2.4.3 TreeSet éå\n\nç¹ç¹ï¼ä¸éå¤ æ ç´¢å¼ å¯æåº\n\nTreeSet éåä¸­âå¯æåºâçç¹ç¹æçæ¯æç§åç´ çå¤§å°é»è®¤ååºï¼æå°å°å¤§ï¼æåº.\n\nTreeSet éååºå±æ¯åºäºçº¢é»æ çæ°æ®ç»æå®ç°æåºçï¼å¢å æ¹æ¥æ§è½é½è¾å¥½.\n\nð¡ TreeSet éåæ¯ä¸å®è¦æåºçï¼å¯ä»¥å°åç´ æç§æå®çè§åè¿è¡æåºã\n\nTreeSet éåé»è®¤çæåºè§åï¼\n\n * æ°å¼ç±»åï¼Integer , Doubleï¼å®æ¹é»è®¤æç§å¤§å°è¿è¡ååºæåºã\n * å­ç¬¦ä¸²ç±»åï¼é»è®¤æç§é¦å­ç¬¦çç¼å·ååºæåºã\n * èªå®ä¹ç±»åå¦ Student å¯¹è±¡ï¼TreeSet æ æ³ç´æ¥æåºã\n\nä½¿ç¨ TreeSet å­å¨èªå®ä¹ç±»åï¼éè¦å¶å®æåºè§å:\n\n * æ¹æ³ä¸ï¼è®©èªå®ä¹çç±»ï¼å¦è¹æç±»ï¼å®ç° Comparable æ¥å£éåéé¢ç compareTo æ¹æ³æ¥å®å¶æ¯è¾è§åï¼\n * æ¹æ³äºï¼æ¨èï¼ï¼TreeSet éåæåæ°æé å¨ï¼å¯ä»¥è®¾ç½® Comparator æ¥å£å¯¹åºçæ¯è¾å¨å¯¹è±¡ï¼æ¥å®å¶æ¯è¾è§åã\n\nå³äºè¿åå¼çè§åï¼\n\n * åç´ 1 > åç´ 2ï¼return æ­£æ´æ°ï¼\n * åç´ 1 < åç´ 2ï¼return è´æ´æ°ï¼\n * åç´ 1 == åç´ 2ï¼return 0ï¼æ­¤æ¶ Treeset éååªä¼ä¿çä¸ä¸ªåç´ ï¼è®¤ä¸ºä¸¤èéå¤ã\n\nç¤ºä¾ä»£ç ï¼\n\nÂ \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \n\nÂ \n\n\n\n\n\npublic class Apple implements Comparable<Apple>{\n    private String name;\n    private String color;\n    private double price;\n    private int weight;\n\n    public Apple() {\n    }\n\n    @Override\n    public String toString() {\n        return "Apple{" +\n                "name=\'" + name + \'\\\'\' +\n                ", color=\'" + color + \'\\\'\' +\n                ", price=" + price +\n                ", weight=" + weight +\n                \'}\';\n    }\n\n    /**\n      æ¹å¼ä¸ï¼ç±»èªå®ä¹æ¯è¾è§å\n      o1.compareTo(o2)\n     * @param o\n     * @return\n     */\n    @Override\n    public int compareTo(Apple o) {\n        // æç§ééè¿è¡æ¯è¾ç\n        return this.weight - o.weight ; // å»ééééå¤çåç´ \n        // return this.weight - o.weight >= 0 ? 1 : -1; // ä¿çéééå¤çåç´ \n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\npublic class SetDemo5 {\n    public static void main(String[] args) {\n        // æ¹å¼äºï¼éåèªå¸¦æ¯è¾å¨å¯¹è±¡è¿è¡è§åå®å¶\n        //\n//        Set<Apple> apples = new TreeSet<>(new Comparator<Apple>() {\n//            @Override\n//            public int compare(Apple o1, Apple o2) {\n//                // return o1.getWeight() - o2.getWeight(); // ååº\n//                // return o2.getWeight() - o1.getWeight(); // éåº\n//                // æ³¨æï¼æµ®ç¹åå»ºè®®ç´æ¥ä½¿ç¨Double.compareè¿è¡æ¯è¾\n//                // return Double.compare(o1.getPrice() , o2.getPrice()); // ååº\n//                return Double.compare(o2.getPrice() , o1.getPrice()); // éåº\n//            }\n//        });\n\n        Set<Apple> apples = new TreeSet<>(( o1,  o2) ->  Double.compare(o2.getPrice() , o1.getPrice())  );\n        apples.add(new Apple("çº¢å¯å£«", "çº¢è²", 9.9, 500));\n        apples.add(new Apple("éè¹æ", "ç»¿è²", 15.9, 300));\n        apples.add(new Apple("ç»¿è¹æ", "éè²", 29.9, 400));\n        apples.add(new Apple("é»è¹æ", "é»è²", 9.8, 500));\n        System.out.println(apples);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# 2.5 Collection ä½ç³»çç¹ç¹ãä½¿ç¨åºæ¯æ»ç»\n\n * å¦æå¸æåç´ å¯ä»¥éå¤ï¼åæç´¢å¼ï¼ç´¢å¼æ¥è¯¢è¦å¿«ï¼\n   * ç¨ ArrayList éåï¼åºäºæ°ç»çãï¼ç¨çæå¤ï¼\n * å¦æå¸æåç´ å¯ä»¥éå¤ï¼åæç´¢å¼ï¼å¢å é¦å°¾æä½å¿«ï¼\n   * ç¨ LinkedList éåï¼åºäºé¾è¡¨çã\n * å¦æå¸æå¢å æ¹æ¥é½å¿«ï¼ä½æ¯åç´ ä¸éå¤ãæ åºãæ ç´¢å¼ã\n   * ç¨ HashSet éåï¼åºäºåå¸è¡¨ç\n * å¦æå¸æå¢å æ¹æ¥é½å¿«ï¼ä½æ¯åç´ ä¸éå¤ãæåºãæ ç´¢å¼ã\n   * ç¨ LinkedHashSet éåï¼åºäºåå¸è¡¨ååé¾è¡¨ã\n * å¦æè¦å¯¹å¯¹è±¡è¿è¡æåºã\n   * ç¨ TreeSet éåï¼åºäºçº¢é»æ ãåç»­ä¹å¯ä»¥ç¨Listéåå®ç°æåº\n\n\n# 3. Collections éåå·¥å·ç±»\n\njava.utils.Collectionsï¼æ¯éåå·¥å·ç±»\n\nä½ç¨ï¼ç¨æ¥æä½éåçä¸ä¸ªå·¥å·ç±»ã\n\nâ ï¸ Collections å¹¶ä¸å±äºéåï¼åªæ¯ä¸ä¸ªä¸ºäºæä½éåèé åºçä¸ä¸ªå·¥å·ç±»ã\n\nCollections çå¸¸ç¨APIï¼\n\næ¹æ³åç§°                                                        è¯´æ\npublic static <T> boolean addAll(Collection<? super T> c,   ç»éåå¯¹è±¡æ¹éæ·»å åç´ \nT... elements)\npublic static void shuffle(List<?> list)                    æä¹±Listéååç´ çé¡ºåº\n\nCollections æåºç¸å³APIï¼\n\nä½¿ç¨èå´ï¼åªè½å¯¹äºListéåçæåºã\n\næåºæ¹å¼1ï¼\n\næ¹æ³åç§°                                        è¯´æ\npublic static <T> void sort(List<T> list)   å°éåä¸­åç´ æç§é»è®¤è§åæåº\n\nâ ï¸ æ³¨æï¼æ¬æ¹å¼ä¸å¯ä»¥ç´æ¥å¯¹èªå®ä¹ç±»åçListéåæåºï¼é¤éèªå®ä¹ç±»åå®ç°äºæ¯è¾è§åComparableæ¥å£ã\n\næåºæ¹å¼2ï¼\n\næ¹æ³åç§°                                                           è¯´æ\npublic static <T> void sort(List<T> list, Comparator<? super   å°éåä¸­åç´ æç§æå®è§åæåº\nT> c)\n\nç¤ºä¾ä»£ç  1ï¼ (ä½¿ç¨æåºæ¹å¼ 1)\n\npublic class CollectionsDemo01 {\n    public static void main(String[] args) {\n        List<String> names = new ArrayList<>();\n        //names.add("æ¥çé¦");\n        //names.add("è¡éè±");\n        //names.add("å¼ æ å¿");\n        //names.add("éå°å¤");\n        Collections.addAll(names, "æ¥çé¦","è¡éè±", "å¼ æ å¿","éå°å¤");\n        System.out.println(names);\n\n        // 2ãpublic static void shuffle(List<?> list) :æä¹±éåé¡ºåºã\n        Collections.shuffle(names);\n        System.out.println(names);\n\n        // 3ã public static <T> void sort(List<T> list):å°éåä¸­åç´ æç§é»è®¤è§åæåºã ï¼æå¼ç¹æ§çåç´ ï¼\n        List<Integer> list = new ArrayList<>();\n        Collections.addAll(list, 12, 23, 2, 4);\n        System.out.println(list);\n        Collections.sort(list);\n        System.out.println(list);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nç¤ºä¾ä»£ç  2ï¼ (ä½¿ç¨æåºæ¹å¼ 2)\n\npublic class CollectionsDemo02 {\n    public static void main(String[] args) {\n        List<Apple> apples = new ArrayList<>(); // å¯ä»¥éå¤ï¼\n        apples.add(new Apple("çº¢å¯å£«", "çº¢è²", 9.9, 500));\n        apples.add(new Apple("éè¹æ", "ç»¿è²", 15.9, 300));\n        apples.add(new Apple("ç»¿è¹æ", "éè²", 29.9, 400));\n        apples.add(new Apple("é»è¹æ", "é»è²", 9.8, 500));\n\n//        Collections.sort(apples); // æ¹æ³ä¸ï¼å¯ä»¥çï¼Appleç±»å·²ç»éåäºæ¯è¾è§å\n//        System.out.println(apples);\n\n        // æ¹å¼äºï¼sortæ¹æ³èªå¸¦æ¯è¾å¨å¯¹è±¡\n//        Collections.sort(apples, new Comparator<Apple>() {\n//            @Override\n//            public int compare(Apple o1, Apple o2) {\n//                return Double.compare(o1.getPrice() , o2.getPrice()); // æç§ä»·æ ¼æåºï¼ï¼\n//            }\n//        });\n\n        Collections.sort(apples, ( o1,  o2) ->  Double.compare(o1.getPrice() , o2.getPrice()) );\n        System.out.println(apples);\n\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n',normalizedContent:'# 1. éåä½ç³»æ¦è¿°\n\n\n# 1.1 éåä¸æ°ç»\n\néååæ°ç»é½æ¯å®¹å¨\n\n * å³äºå­å¨åç´ çä¸ªæ°ï¼\n   \n   æ°ç»å®ä¹åç±»åç¡®å®ï¼é¿åº¦åºå®\n   \n   éåç±»åå¯ä»¥ä¸åºå®ï¼å¤§å°æ¯å¯åç\n\n * å³äºå­å¨åç´ çç±»åï¼\n   \n   æ°ç»å¯ä»¥å­å¨åºæ¬ç±»ååå¼ç¨ç±»åçæ°æ®\n   \n   éååªè½å­å¼ç¨æ°æ®ç±»åçæ°æ®\n\n * å³äºéåçåºæ¯ï¼\n   \n   æ°ç»éååæ°æ®ä¸ªæ°åç±»åç¡®å®çåºæ¯\n   \n   éåéååæ°æ®ä¸ªæ°ä¸ç¡®å®ï¼ä¸è¦åå¢å åç´ çåºæ¯\n\n\n# 1.2 éåç±»çä½ç³»ç»æ\n\n\n\néåç±»åä¸ºä¸¤ç§ä½ç³»ï¼collection å mapãcollection ååéåï¼æ¯ä¸ªåç´ ï¼æ°æ®ï¼åªåå«ä¸ä¸ªå¼ï¼map ååéåï¼æ¯ä¸ªåç´ åå«ä¸¤ä¸ªå¼ï¼é®å¼å¯¹ï¼ã\n\n\n# 1.3 collection éåçä½ç³»\n\n\n\n> ä¸å¾ä¸­åªæ¯ååºäºå ä¸ªå¸¸ç¨çç±»åã\n\ncollection éååä¸ºä¸¤ç±»å¸¸ç¨çéåä½ç³»ï¼\n\n * list ç³»åéåï¼æ·»å çåç´ æåºãå¯éå¤ãæç´¢å¼\n   * arraylistãlinekdlist ï¼æåºãå¯éå¤ãæç´¢å¼\n * set ç³»åéåï¼æ·»å çåç´ æ¯æ åºãä¸éå¤ãæ ç´¢å¼\n   * hashset: æ åºãä¸éå¤ãæ ç´¢å¼ï¼linkedhashset: æåºãä¸éå¤ãæ ç´¢å¼\n   * treesetï¼**æç§å¤§å°é»è®¤ååºæåºã**ä¸éå¤ãæ ç´¢å¼\n\n\n# 1.4 éåå¯¹æ³åçæ¯æ\n\néåä½ç³»çå¨é¨æ¥å£åå®ç°ç±»é½æ¯æ¯ææ³åçä½¿ç¨çï¼å¯ä»¥å¨ç¼è¯é¶æ®µçº¦æéååªè½æä½æç§æ°æ®ç±»åãï¼æè¿è¡æ¶æçé®é¢æåå°äºç¼è¯æé´ï¼é¿åäºå¼ºå¶ç±»åè½¬æ¢å¯è½åºç°çå¼å¸¸ï¼\n\ncollection<string> lists = new arraylist<string>();\ncollection<string> lists = new arraylist<>(); // jdk 1.7å¼å§åé¢çæ³åç±»åç³æå¯ä»¥çç¥ä¸å\n\n\n1\n2\n\n\nâ ï¸ æ³¨æï¼éååæ³åé½åªè½æ¯æå¼ç¨æ°æ®ç±»åï¼ä¸æ¯æåºæ¬æ°æ®ç±»åï¼æä»¥éåä¸­å­å¨çåç´ é½è®¤ä¸ºæ¯å¯¹è±¡\n\næ³åçåçï¼\n\næåºç°æ³ååéçå°æ¹å¨é¨æ¿æ¢æä¼ è¾ççå®æ°æ®ç±»åã\n\næ³åçå®ä¹ä½ç½®ï¼\n\n * ç±»åé¢ --- > æ³åç±»\n * æ¹æ³ç³æä¸ --- > æ³åæ¹æ³\n * æ¥å£åé¢ --- > æ³åæ¥å£\n\n# 1.4.1 èªå®ä¹æ³åç±»\n\næ³åç±»çæ ¼å¼ï¼ä¿®é¥°ç¬¦ class ç±»å<æ³ååé>{ }ï¼æ­¤å¤æ³ååé t å¯ä»¥éä¾¿åä¸ºä»»ææ è¯ï¼å¸¸è§çå¦ eãtãkãv ç­\n\nä½ç¨ï¼ç¼è¯é¶æ®µçº¦å®æä½çæ°æ®çç±»åï¼ç±»ä¼¼äºéåçä½ç¨ã\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\nÂ \n\n\n\nÂ \n\n\n\n\n\n\n\n\n\n\npublic class myarraylist<e> {\n    private arraylist lists = new arraylist();\n\n    public void add(e e){  // ä¸æ¯æ³åæ¹æ³ãåªæ¯ä½¿ç¨ç±»å®ä¹çè¿ä¸ªæ³å eï¼èä¸æ¯ä»èªå·±å®ä¹äºæ³å\n        lists.add(e);\n    }\n\n    public void remove(e e){\n        lists.remove(e);\n    }\n\n    @override\n    public string tostring() {\n        return lists.tostring();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# 1.4.2 èªå®ä¹æ³åæ¹æ³\n\næ³åæ¹æ³çæ ¼å¼ï¼ä¿®é¥°ç¬¦ <æ³ååé> æ¹æ³è¿åå¼ æ¹æ³åç§°(å½¢ååè¡¨){}\n\nä½ç¨ï¼æ¹æ³ä¸­å¯ä»¥ä½¿ç¨æ³åæ¥æ¶ä¸åå®éç±»åçåæ°ï¼æ¹æ³æ´å·å¤éç¨æ§\n\nç¤ºä¾ä»£ç ï¼\n\npublic static void main(string[] args) {\n    string[] names = {"å°ç", "èå®¹", "å°ä½"};\n    printarray(names);\n\n    integer[] ages = {10, 20, 30};\n    printarray(ages);\n\n    integer[] ages2 = getarr(ages);  // è°ç¨æ³åå½æ°ï¼å¾å°çåå®¹ä¸éè¦å¼ºè½¬ä¸ºå·ä½çç±»å\n    string[]  names2 = getarr(names);  // ä¼ è¿å»å¥ç±»åï¼è¿ååºæ¥è¿æ¯å¥ç±»å\n}\n\npublic static <t> t[] getarr(t[] arr){\n    return arr;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# 1.4.3 èªå®ä¹æ³åæ¥å£\n\næ³åæ¥å£çæ ¼å¼ï¼ä¿®é¥°ç¬¦ interface æ¥å£åç§°<æ³ååé>{}\n\nä½ç¨ï¼æ³åæ¥å£å¯ä»¥è®©å®ç°ç±»éæ©å½ååè½éè¦æä½çæ°æ®ç±»åã\n\nå®ç°ç±»å¯ä»¥å¨å®ç°æ¥å£çæ¶åä¼ å¥èªå·±æä½çæ°æ®ç±»åï¼è¿æ ·éåçæ¹æ³é½å°æ¯éå¯¹äºè¯¥ç±»åçæä½ã\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\n\n\n\nÂ \nÂ \n\nÂ \n\n\n\nÂ \n\nÂ \n\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\nÂ \n\nÂ \n\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\n\n\n// éæ±ï¼æå¡ç³»ç»ï¼æä¾ä¸ä¸ªæ¥å£å¯çº¦æä¸å®è¦å®ææ°æ®ï¼å­¦çï¼èå¸ï¼çå¢å æ¹æ¥æä½\npublic class student {\n}\n\npublic class teacher {\n}\n\npublic interface data<e> {  // æä½æ°æ®çæ¥å£\n    void add(e e);\n    void delete(int id);\n    void update(e e);\n    e querybyid(int id);\n}\n\npublic class studentdata implements data<student>{  // æä½å­¦çç±»æ°æ®çå®ç°\n    @override\n    public void add(student student) {\n\n    }\n\n    @override\n    public void delete(int id) {\n\n    }\n\n    @override\n    public void update(student student) {\n\n    }\n\n    @override\n    public student querybyid(int id) {\n        return null;\n    }\n}\n\npublic class teacherdata implements data<teacher>{  // æä½æå¸ç±»æ°æ®çå®ç°\n    @override\n    public void add(teacher teacher) {\n\n    }\n\n    @override\n    public void delete(int id) {\n\n    }\n\n    @override\n    public void update(teacher teacher) {\n\n    }\n\n    @override\n    public teacher querybyid(int id) {\n        return null;\n    }\n}\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n\n\n# 1.4.4 æ³åééç¬¦ãä¸ä¸é\n\nééç¬¦ï¼?\n\n * ? å¯ä»¥å¨âä½¿ç¨æ³åâçæ¶åä»£è¡¨ä¸åç±»åãå°±æ¯å¨åºè¯¥å¡«æ³åçä½ç½®ï¼å¡« â<?>â ã\n\n * e t k v æ¯å¨å®ä¹æ³åçæ¶åä½¿ç¨çã\n\næ³åçä¸ä¸éï¼\n\n * æ³åä¸éï¼ <? extends car>ï¼å¿é¡»æ¯caræèå¶å­ç±»\n * æ³åä¸éï¼<? super car> ï¼å¿é¡»æ¯caræèå¶ç¶ç±» ï¼ç¨çç¸å¯¹è¾å°\n\n\n# 2. collection éå\n\n\n# 2.1 å³äº collection èªèº«\n\ncollection æ¯ååéåçç¥å®æ¥å£ï¼å®çåè½æ¯å¨é¨ååéåé½å¯ä»¥ç»§æ¿ä½¿ç¨çã\n\ncollection çå¸¸ç¨ apiï¼\n\næ¹æ³åç§°                                  è¯´æ\npublic boolean add(e e)               æç»å®çå¯¹è±¡æ·»å å°å½åéåä¸­\npublic boolean addall(e e)            æc2(åæ°)éåçåç´ å¨é¨åå¥å°c1(è¢«è°éå)ä¸­å»\npublic void clear()                   æ¸ç©ºéåä¸­ææçåç´ \npublic boolean remove(e e)            æç»å®çå¯¹è±¡å¨å½åéåä¸­å é¤\npublic boolean contains(object obj)   å¤æ­å½åéåä¸­æ¯å¦åå«ç»å®çå¯¹è±¡\npublic boolean isempty()              å¤æ­å½åéåæ¯å¦ä¸ºç©º\npublic int size()                     è¿åéåä¸­åç´ çä¸ªæ°ã\npublic object[] toarray()             æéåä¸­çåç´ ï¼å­å¨å°æ°ç»ä¸­\n\ncollection éåçéåï¼\n\n * æ³1ï¼è¿­ä»£å¨\n   \n   è¿­ä»£å¨ï¼java ä¸­ä¸º iteratorï¼æ¯éåçä¸ç¨éåæ¹å¼ã\n   \n   collection éåè·åè¿­ä»£å¨ï¼\n   \n   iterator<e> iterator()ï¼è¿åéåä¸­çè¿­ä»£å¨å¯¹è±¡ï¼è¯¥è¿­ä»£å¨å¯¹è±¡é»è®¤æåå½åéåç 0 ç´¢å¼\n   \n   iteratorä¸­çå¸¸ç¨æ¹æ³ï¼\n   \n   æ¹æ³åç§°                è¯´æ\n   boolean hasnext()   è¯¢é®å½åä½ç½®æ¯å¦æåç´ å­å¨ï¼å­å¨è¿åtrue ,ä¸å­å¨è¿åfalse\n   e next()            è·åå½åä½ç½®çåç´ ï¼å¹¶åæ¶å°è¿­ä»£å¨å¯¹è±¡ç§»åä¸ä¸ä¸ªä½ç½®ï¼æ³¨æé²æ­¢ååºè¶çã\n   \n   è¿­ä»£å¨ååç´ è¶çä¼åºç° nosuchelementexception å¼å¸¸ã\n   \n   éåæµç¨çç¤ºä¾ä»£ç ï¼\n   \n   \n   \n   \n   \n   \n   \n   \n   \n   Â \n   \n   \n   \n   Â \n   Â \n   \n   \n   \n   \n   \n   \n   public class collectiondemo01 {\n       public static void main(string[] args) {\n           arraylist<string> lists = new arraylist<>();\n           collections.addall(lists, "èµµæ","å°æ­", "ç´ ç´ ","ç­ç»");\n           system.out.println(lists);  // [èµµæ, å°æ­, ç´ ç´ , ç­ç»]\n   \n           // 1ãå¾å°å½åéåçè¿­ä»£å¨å¯¹è±¡ã\n           iterator<string> it = lists.iterator();\n   \n           // 2ãå®ä¹whileå¾ªç¯\n           while (it.hasnext()){\n               string ele = it.next();\n               system.out.println(ele);\n           }\n           system.out.println("-----------------------------");\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   \n\n * æ³2ï¼foreach / å¢å¼º for å¾ªç¯\n   \n   å¢å¼º for å¾ªç¯ï¼æ¢å¯ä»¥éåéåä¹å¯ä»¥éåæ°ç»\n   \n   éåæ ¼å¼ï¼\n   \n    for(è¢«éåéåæèæ°ç»ä¸­åç´ çç±»å åéåç§° : è¢«éåéåæèæ°ç»){\n     //å¨æ­¤å¤ä½¿ç¨åéå³å¯ï¼è¯¥åéå°±æ¯åç´ \n   }\n   \n   \n   1\n   2\n   3\n   \n   \n   éåæµç¨çç¤ºä¾ä»£ç ï¼\n   \n   public static void main(string[] args) {\n       collection<string> lists = new arraylist<>();\n       system.out.println(lists);  // [èµµæ, å°æ­, æ®·ç´ ç´ , å¨è·è¥]\n   \n       for (string ele : lists) {\n           system.out.println(ele);\n       }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   \n   \n   â ï¸ æ³¨æï¼ä¿®æ¹ç¬¬ä¸æ¹åéçå¼ä¸ä¼å½±åå°éåä¸­çåç´ ãå³ï¼å¨ä¸è¿°ä»£ç ä¸­ä¿®æ¹ ele çå¼ï¼ä¸ä¼å½±åå° lists ä¸­å½ååç´ çå¼ï¼æä¸è½éè¿ foreach å¾ªç¯æ¥ä¿®æ¹åç´ çå¼ã\n   \n   ä½¿ç¨å¢å¼º for çå¿«æ·é®\n   \n   idea ä¸­è¾å¥ï¼lists.forï¼æ­¤æ¶ä¼èªå¨æç¤ºå¢å¼º for\n\n * æ³3ï¼lambda è¡¨è¾¾å¼\n   \n   jdk 1.8å¼å§ä¹åçæ°ææ¯lambdaè¡¨è¾¾å¼ï¼ææä¸ç§æ´ç®åãæ´ç´æ¥çéåéåçæ¹å¼\n   \n   collection ç»å lambda éåéåç apiï¼\n   \n   æ¹æ³åç§°                                                è¯´æ\n   default void foreach(consumer<? super t> action):   ç»ålambdaéåéå\n   \n   éåæµç¨çç¤ºä¾ä»£ç ï¼\n   \n   lists.foreach(new consumer<string>() {\n       @override\n       public void accept(string s) {\n           system.out.println(s);\n       }\n   });\n   \n   // ç®åä¸ºï¼ãéè¦ææ¡çæ¹æ³ã\n   lists.foreach(s -> {\n       system.out.println(s);\n   });\n   \n   // è¿ä¸æ­¥ç®å:\n   lists.foreach(s ->  system.out.println(s) );\n   \n   // ç»çç®åï¼\n   lists.foreach(system.out::println );\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   \n   \n   ð consumer çå·ä½å«ä¹åä¸ç¨ç®¡ï¼ä¼ç¨ foreach è¿ä¸ªæ¹æ³éåå°±è¡äºã\n\néåä¸­å­å¨çåç´ æ¯åç´ å¯¹è±¡çå°å\n\néåçå¹¶åä¿®æ¹å¼å¸¸é®é¢\n\nqï¼å½æä»¬ä»éåä¸­æ¾åºæä¸ªåç´ å¹¶å é¤çæ¶åå¯è½åºç°ä¸ç§å¹¶åä¿®æ¹å¼å¸¸é®é¢\n\nåªäºéåå­å¨é®é¢ï¼\n\n * è¿­ä»£å¨éåéåä¸ç´æ¥ç¨éåå é¤åç´ çæ¶åå¯è½åºç°\n * å¢å¼º for å¾ªç¯éåéåä¸ç´æ¥ç¨éåå é¤åç´ çæ¶åå¯è½åºç°\n * lambda éåä¸è½è¾¹éåè¾¹å é¤ï¼ä¼åº bug\n\nåªç§éåä¸å é¤åç´ ä¸åºé®é¢ï¼\n\n * è¿­ä»£å¨éåéåä½æ¯ç¨è¿­ä»£å¨èªå·±çå é¤æ¹æ³æä½å¯ä»¥è§£å³\n * ä½¿ç¨ for å¾ªç¯éåå¹¶å é¤åç´ ä¸ä¼å­å¨è¿ä¸ªé®é¢\n\nç¤ºä¾ï¼\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \nÂ \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\n    public static void main(string[] args) {\n        // 1ãåå¤æ°æ®\n        arraylist<string> list = new arraylist<>();\n        // æ·»å ä¸æ¹åç´ \n        system.out.println(list); // [é»é©¬, java, java, èµµæ, èµµæ, ç´ ç´ ]\n\n        // éæ±ï¼å é¤å¨é¨çjavaä¿¡æ¯ã\n        // aãè¿­ä»£å¨éåå é¤\n        iterator<string> it = list.iterator();\n        while (it.hasnext()){\n            string ele = it.next();\n            if("java".equals(ele)){\n                // å é¤java\n                // list.remove(ele); // éåå é¤ä¼åºæ¯ç\n                it.remove(); // å é¤è¿­ä»£å¨æå¨ä½ç½®çåç´ å¼ï¼æ²¡æ¯çï¼\n            }\n        }\n        system.out.println(list);\n\n        // bãforeachéåå é¤ (ä¼åºç°é®é¢ï¼è¿ç§æ æ³è§£å³çï¼foreachä¸è½è¾¹éåè¾¹å é¤ï¼ä¼åºbug)\n        for (string s : list) {\n            if("java".equals(s)){\n                list.remove(s);\n            }\n        }\n\n        // cãlambdaè¡¨è¾¾å¼(ä¼åºç°é®é¢ï¼è¿ç§æ æ³è§£å³çï¼lambdaéåä¸è½è¾¹éåè¾¹å é¤ï¼ä¼åºbug)\n        list.foreach(s -> {\n            if("java".equals(s)){\n                list.remove(s);\n            }\n        });\n\n        // dãforå¾ªç¯(è¾¹éåè¾¹å é¤éåæ²¡æ¯çï¼ä½æ¯å¿é¡»ä»åé¢å¼å§éåå é¤æä¸ä¼åºç°æ¼æåºè¯¥å é¤çåç´ )\n        for (int i = list.size() - 1; i >= 0 ; i--) {\n            string ele = list.get(i);\n            if("java".equals(ele)){\n                list.remove(ele);\n            }\n        }\n        system.out.println(list);\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\n\n# 2.2 å¸¸è§çæ°æ®ç»æ\n\néåï¼åè¿ååºï¼åè¿ååºã\n\næ ï¼åè¿ååºï¼åè¿ååºã\n\næ°ç»ï¼åå­è¿ç»­åºåï¼æ¥è¯¢å¿«ï¼å¢å æ¢ã\n\né¾è¡¨ï¼åç´ æ¯æ¸¸ç¦»çï¼æ¥è¯¢æ¢ï¼é¦å°¾æä½æå¿«ã\n\näºåæ ï¼æ°¸è¿åªæä¸ä¸ªæ ¹èç¹, æ¯ä¸ªç»ç¹ä¸è¶è¿2ä¸ªå­èç¹çæ ã\n\næ¥æ¾äºåæ ï¼å°çå·¦è¾¹ï¼å¤§çå³è¾¹ï¼ä½æ¯å¯è½æ å¾é«ï¼æ¥è¯¢æ§è½åå·®ã\n\nå¹³è¡¡æ¥æ¾äºåæ ï¼è®©æ çé«åº¦å·®ä¸å¤§äº1ï¼å¢å æ¹æ¥é½æé«äºã\n\nçº¢é»æ ï¼å°±æ¯åºäºçº¢é»è§åå®ç°äºèªå¹³è¡¡çæåºäºåæ ï¼\n\n\n# 2.3 collection ä¹ list ç³»åéå\n\nlist ç³»åéåç¹ç¹ï¼ï¼1ï¼æåºï¼å­å¨åååºçåç´ é¡ºåºä¸è´ï¼ï¼2ï¼æç´¢å¼ï¼å¯ä»¥éè¿ç´¢å¼æä½åç´ ï¼ï¼3ï¼å¯éå¤ï¼å­å¨çåç´ å¯ä»¥éå¤ã\n\nå¸¸è§çä¸¤ç§ä¸º arraylistãlinekdlistã\n\nlist ç³»åéåç¹æçæ¹æ³ï¼\n\n> listéåå ä¸ºæ¯æç´¢å¼ï¼æä»¥å¤äºå¾å¤ç´¢å¼æä½çç¬ç¹apiï¼å¶ä»collectionçåè½listä¹é½ç»§æ¿äº\n\næ¹æ³åç§°                            è¯´æ\nvoid add(int index,e element)   å¨æ­¤éåä¸­çæå®ä½ç½®æå¥æå®çåç´ \ne remove(int index)             å é¤æå®ç´¢å¼å¤çåç´ ï¼è¿åè¢«å é¤çåç´ \ne set(int index,e element)      ä¿®æ¹æå®ç´¢å¼å¤çåç´ ï¼è¿åè¢«ä¿®æ¹çåç´ \ne get(int index)                è¿åæå®ç´¢å¼å¤çåç´ \n\nlist ç³»åéåçéåæ¹å¼ï¼\n\nâ è¿­ä»£å¨\n\nâ¡å¢å¼ºforå¾ªç¯\n\nâ¢lambdaè¡¨è¾¾å¼\n\nâ£forå¾ªç¯ï¼å ä¸ºlistéåå­å¨ç´¢å¼ï¼\n\n# 2.3.1 arraylist éåçåºå±åç\n\narraylist åºå±æ¯åºäºæ°ç»å®ç°çï¼æ ¹æ®ç´¢å¼å®ä½åç´ ï¼å¿«ï¼å¢å ç¸å¯¹æ¢ï¼éè¦ååç´ çç§»ä½æä½ã\n\nç¬¬ä¸æ¬¡åå»ºéåå¹¶æ·»å ç¬¬ä¸ä¸ªåç´ çæ¶åï¼å¨åºå±åå»ºä¸ä¸ªé»è®¤é¿åº¦ä¸º10çæ°ç»\n\nlistéåå­å¨çåç´ è¦è¶è¿å®¹éæ¶ï¼æ©å®¹å°åæ¥å¤§å°ç 1.5 åã\n\n# 2.3.2 linkedlist éåçåºå±åç\n\nlinkedlist åºå±åºäºåé¾è¡¨å®ç°çï¼æ¥è¯¢åç´ æ¢ï¼å¢å é¦å°¾åç´ éå¸¸å¿«ï¼æä»¥å¤äºå¾å¤é¦å°¾æä½çç¹æ apiã\n\nlist ç³»åéåç¹æçæ¹æ³ï¼\n\næ¹æ³åç§°                        è¯´æ\npublic void addfirst(e e)   å¨è¯¥åè¡¨å¼å¤´æå¥æå®çåç´ \npublic void addlast(e e)    å°æå®çåç´ è¿½å å°æ­¤åè¡¨çæ«å°¾\npublic e getfirst()         è¿åæ­¤åè¡¨ä¸­çç¬¬ä¸ä¸ªåç´ \npublic e getlast()          è¿åæ­¤åè¡¨ä¸­çæåä¸ä¸ªåç´ \npublic e removefirst()      ä»æ­¤åè¡¨ä¸­å é¤å¹¶è¿åç¬¬ä¸ä¸ªåç´ \npublic e removelast()       ä»æ­¤åè¡¨ä¸­å é¤å¹¶è¿åæåä¸ä¸ªåç´ \n\nâ¨ linkedlist å¯ä»¥å®æéåç»æï¼åæ ç»æ ï¼åé¾è¡¨ï¼ï¼ç¤ºä¾ä»£ç ï¼\n\npublic static void main(string[] args) {\n    // 1ãåä¸ä¸ªéåï¼\n    linkedlist<string> queue = new linkedlist<>();\n    // å¥é\n    queue.addlast("1å·");\n    queue.addlast("2å·");\n    queue.addlast("3å·");\n    system.out.println(queue);\n    // åºé\n    system.out.println(queue.removefirst());\n    system.out.println(queue.removefirst());\n    system.out.println(queue);\n\n    // 2ãåä¸ä¸ªæ \n    linkedlist<string> stack = new linkedlist<>();\n    // å¥æ  åæ  (push)\n    stack.push("ç¬¬1é¢å­å¼¹");\n    stack.push("ç¬¬2é¢å­å¼¹");\n    stack.push("ç¬¬3é¢å­å¼¹");\n    stack.push("ç¬¬4é¢å­å¼¹");\n    system.out.println(stack);\n\n    // åºæ   å¼¹æ  pop\n    system.out.println(stack.pop());\n    system.out.println(stack.pop());\n    system.out.println(stack.pop());\n    system.out.println(stack);\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# 2.4 collection ä¹ set ç³»åéå\n\nset ç³»åéåçç¹ç¹ï¼ï¼1ï¼æ åºï¼å­åé¡ºåºä¸ä¸è´ï¼ï¼2ï¼ä¸éå¤ï¼å¯ä»¥å»é¤éå¤ï¼ï¼3ï¼æ ç´¢å¼ï¼æ²¡æå¸¦ç´¢å¼çæ¹æ³ï¼ä¸è½ç¨æ®éforå¾ªç¯éåï¼ä¹ä¸è½éè¿ç´¢å¼æ¥è·ååç´ ã\n\nset éåå®ç°ç±»çç¹ç¹ï¼\n\n * hashset : æ åºãä¸éå¤ãæ ç´¢å¼\n * linkedhashsetï¼æåºãä¸éå¤ãæ ç´¢å¼\n * treesetï¼æåºãä¸éå¤ãæ ç´¢å¼\n\nset éåçåè½ï¼åºæ¬ä¸ collection ç api ä¸è´ã\n\n# 2.4.1 hashset éåçåºå±åç\n\nhashset éååºå±éååå¸è¡¨å­å¨çæ°æ®ï¼å¯¹å¢å æ¹æ¥æ§è½é½å¾å¥½ã\n\nhashè¡¨çç»æï¼\n\n * jdk8ä¹åçï¼åºå±ä½¿ç¨æ°ç» + é¾è¡¨ç»æ\n * jdk8å¼å§åï¼åºå±éç¨æ°ç» + é¾è¡¨ + çº¢é»æ ç»æ\n\nhash å¼ï¼\n\njdk æ ¹æ®å¯¹è±¡çå°åï¼æç§æç§è§åç®åºæ¥ç int ç±»åçæ°å¼ã\n\néè¿ object ç±»ç api public int hashcode() æ¥è¿åå¯¹è±¡çåå¸å¼ã\n\nå¯¹è±¡ç hash å¼çç¹ç¹ï¼\n\n * åä¸ä¸ªå¯¹è±¡å¤æ¬¡è°ç¨ hashcode() æ¹æ³è¿åçåå¸å¼æ¯ç¸åç\n * é»è®¤æåµä¸ï¼ä¸åå¯¹è±¡çåå¸å¼ä¸å\n\nhashset åçè¯¦ç»æµç¨è§£æï¼\n\n 1. åå»ºä¸ä¸ªé»è®¤é¿åº¦ 16 ãå è½½å å­ 0.75 çæ°ç»ï¼æ°ç»åtable\n 2. æ ¹æ®åç´ çåå¸å¼è·æ°ç»çé¿åº¦æ±ä½è®¡ç®åºåºå­å¥çä½ç½®ï¼åå¸ç®æ³ï¼\n 3. å¤æ­å½åä½ç½®æ¯å¦ä¸º nullï¼å¦ææ¯ null ç´æ¥å­å¥\n 4. å¦æä½ç½®ä¸ä¸º nullï¼è¡¨ç¤ºæåç´ ï¼åè°ç¨ equals æ¹æ³æ¯è¾å±æ§å¼\n    1. å¦æä¸æ ·ï¼åä¸å­ï¼\n    2. å¦æä¸ä¸æ ·ï¼åå­å¥æ°ç»ï¼\n    * jdk 7 æ°åç´ å èåç´ ä½ç½®ï¼æåèåç´ \n    * jdk 8 ä¸­æ°åç´ æå¨èåç´ ä¸é¢\n 5. å½æå¨åç´ ä¸é¢çæ°æ®è¿å¤æ¶ï¼æ¥è¯¢æ§è½éä½ã ä» jdk8 å¼å§ï¼å½é¾è¡¨é¿åº¦è¶è¿ 8 çæ¶åï¼èªå¨è½¬æ¢ä¸ºçº¢é»æ ã\n 6. å½æ°ç»å­æ»¡å° 16*0.75=12 æ¶ï¼å°±èªå¨æ©å®¹ï¼æ¯æ¬¡æ©å®¹ååçä¸¤åã\n\n> åå¸è¡¨å¼å¥çº¢é»æ è¿ä¸æ­¥æé«äºæä½æ°æ®çæ§è½ã\n\næ»ç»ï¼\n\n * hashset åç´ æ åºçåºå±åçï¼ä½¿ç¨äºåå¸è¡¨ï¼hash å¼çè®¡ç®è§åå¯¼è´äºæ åºï¼ã\n\n * hashset å»éå¤çåºå±åçï¼å½è¯¥åç´ è¦å­å¥çä½ç½®ä¸ä¸º null æ¶ï¼ä¼è¿è¡åç´ æ¯è¾ï¼ä¸ä¸æ ·çæä¼å­å¥ãå¦æµç¨ 4 ä¸­æè¿°ã\n\nð¡ å¦æå¸æ set éåè®¤ä¸ºä¸¤ä¸ªåå®¹ä¸æ ·ï¼èéå°åä¸æ ·ï¼çå¯¹è±¡æ¯éå¤çï¼å¿é¡»éåå¯¹è±¡ç hashcode() å equals() æ¹æ³\n\n# 2.4.2 linkedhashset éå\n\nç¹ç¹ï¼æåº ä¸éå¤ æ ç´¢å¼\n\nlinkedhashset éåä¸­âæåºâçç¹ç¹æçæ¯ä¿è¯å­å¨åååºçåç´ é¡ºåºä¸è´ã\n\nlinkedhashset éååºå±ä¹æ¯åºäºåå¸è¡¨å®ç°çï¼åªæ¯æ¯ä¸ªåç´ åé¢å¤å¤äºä¸ä¸ªåé¾è¡¨æºå¶è®°å½å­å¨çé¡ºåºã\n\n# 2.4.3 treeset éå\n\nç¹ç¹ï¼ä¸éå¤ æ ç´¢å¼ å¯æåº\n\ntreeset éåä¸­âå¯æåºâçç¹ç¹æçæ¯æç§åç´ çå¤§å°é»è®¤ååºï¼æå°å°å¤§ï¼æåº.\n\ntreeset éååºå±æ¯åºäºçº¢é»æ çæ°æ®ç»æå®ç°æåºçï¼å¢å æ¹æ¥æ§è½é½è¾å¥½.\n\nð¡ treeset éåæ¯ä¸å®è¦æåºçï¼å¯ä»¥å°åç´ æç§æå®çè§åè¿è¡æåºã\n\ntreeset éåé»è®¤çæåºè§åï¼\n\n * æ°å¼ç±»åï¼integer , doubleï¼å®æ¹é»è®¤æç§å¤§å°è¿è¡ååºæåºã\n * å­ç¬¦ä¸²ç±»åï¼é»è®¤æç§é¦å­ç¬¦çç¼å·ååºæåºã\n * èªå®ä¹ç±»åå¦ student å¯¹è±¡ï¼treeset æ æ³ç´æ¥æåºã\n\nä½¿ç¨ treeset å­å¨èªå®ä¹ç±»åï¼éè¦å¶å®æåºè§å:\n\n * æ¹æ³ä¸ï¼è®©èªå®ä¹çç±»ï¼å¦è¹æç±»ï¼å®ç° comparable æ¥å£éåéé¢ç compareto æ¹æ³æ¥å®å¶æ¯è¾è§åï¼\n * æ¹æ³äºï¼æ¨èï¼ï¼treeset éåæåæ°æé å¨ï¼å¯ä»¥è®¾ç½® comparator æ¥å£å¯¹åºçæ¯è¾å¨å¯¹è±¡ï¼æ¥å®å¶æ¯è¾è§åã\n\nå³äºè¿åå¼çè§åï¼\n\n * åç´ 1 > åç´ 2ï¼return æ­£æ´æ°ï¼\n * åç´ 1 < åç´ 2ï¼return è´æ´æ°ï¼\n * åç´ 1 == åç´ 2ï¼return 0ï¼æ­¤æ¶ treeset éååªä¼ä¿çä¸ä¸ªåç´ ï¼è®¤ä¸ºä¸¤èéå¤ã\n\nç¤ºä¾ä»£ç ï¼\n\nÂ \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \n\nÂ \n\n\n\n\n\npublic class apple implements comparable<apple>{\n    private string name;\n    private string color;\n    private double price;\n    private int weight;\n\n    public apple() {\n    }\n\n    @override\n    public string tostring() {\n        return "apple{" +\n                "name=\'" + name + \'\\\'\' +\n                ", color=\'" + color + \'\\\'\' +\n                ", price=" + price +\n                ", weight=" + weight +\n                \'}\';\n    }\n\n    /**\n      æ¹å¼ä¸ï¼ç±»èªå®ä¹æ¯è¾è§å\n      o1.compareto(o2)\n     * @param o\n     * @return\n     */\n    @override\n    public int compareto(apple o) {\n        // æç§ééè¿è¡æ¯è¾ç\n        return this.weight - o.weight ; // å»ééééå¤çåç´ \n        // return this.weight - o.weight >= 0 ? 1 : -1; // ä¿çéééå¤çåç´ \n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \n\n\n\n\n\n\n\n\n\npublic class setdemo5 {\n    public static void main(string[] args) {\n        // æ¹å¼äºï¼éåèªå¸¦æ¯è¾å¨å¯¹è±¡è¿è¡è§åå®å¶\n        //\n//        set<apple> apples = new treeset<>(new comparator<apple>() {\n//            @override\n//            public int compare(apple o1, apple o2) {\n//                // return o1.getweight() - o2.getweight(); // ååº\n//                // return o2.getweight() - o1.getweight(); // éåº\n//                // æ³¨æï¼æµ®ç¹åå»ºè®®ç´æ¥ä½¿ç¨double.compareè¿è¡æ¯è¾\n//                // return double.compare(o1.getprice() , o2.getprice()); // ååº\n//                return double.compare(o2.getprice() , o1.getprice()); // éåº\n//            }\n//        });\n\n        set<apple> apples = new treeset<>(( o1,  o2) ->  double.compare(o2.getprice() , o1.getprice())  );\n        apples.add(new apple("çº¢å¯å£«", "çº¢è²", 9.9, 500));\n        apples.add(new apple("éè¹æ", "ç»¿è²", 15.9, 300));\n        apples.add(new apple("ç»¿è¹æ", "éè²", 29.9, 400));\n        apples.add(new apple("é»è¹æ", "é»è²", 9.8, 500));\n        system.out.println(apples);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# 2.5 collection ä½ç³»çç¹ç¹ãä½¿ç¨åºæ¯æ»ç»\n\n * å¦æå¸æåç´ å¯ä»¥éå¤ï¼åæç´¢å¼ï¼ç´¢å¼æ¥è¯¢è¦å¿«ï¼\n   * ç¨ arraylist éåï¼åºäºæ°ç»çãï¼ç¨çæå¤ï¼\n * å¦æå¸æåç´ å¯ä»¥éå¤ï¼åæç´¢å¼ï¼å¢å é¦å°¾æä½å¿«ï¼\n   * ç¨ linkedlist éåï¼åºäºé¾è¡¨çã\n * å¦æå¸æå¢å æ¹æ¥é½å¿«ï¼ä½æ¯åç´ ä¸éå¤ãæ åºãæ ç´¢å¼ã\n   * ç¨ hashset éåï¼åºäºåå¸è¡¨ç\n * å¦æå¸æå¢å æ¹æ¥é½å¿«ï¼ä½æ¯åç´ ä¸éå¤ãæåºãæ ç´¢å¼ã\n   * ç¨ linkedhashset éåï¼åºäºåå¸è¡¨ååé¾è¡¨ã\n * å¦æè¦å¯¹å¯¹è±¡è¿è¡æåºã\n   * ç¨ treeset éåï¼åºäºçº¢é»æ ãåç»­ä¹å¯ä»¥ç¨listéåå®ç°æåº\n\n\n# 3. collections éåå·¥å·ç±»\n\njava.utils.collectionsï¼æ¯éåå·¥å·ç±»\n\nä½ç¨ï¼ç¨æ¥æä½éåçä¸ä¸ªå·¥å·ç±»ã\n\nâ ï¸ collections å¹¶ä¸å±äºéåï¼åªæ¯ä¸ä¸ªä¸ºäºæä½éåèé åºçä¸ä¸ªå·¥å·ç±»ã\n\ncollections çå¸¸ç¨apiï¼\n\næ¹æ³åç§°                                                        è¯´æ\npublic static <t> boolean addall(collection<? super t> c,   ç»éåå¯¹è±¡æ¹éæ·»å åç´ \nt... elements)\npublic static void shuffle(list<?> list)                    æä¹±listéååç´ çé¡ºåº\n\ncollections æåºç¸å³apiï¼\n\nä½¿ç¨èå´ï¼åªè½å¯¹äºlistéåçæåºã\n\næåºæ¹å¼1ï¼\n\næ¹æ³åç§°                                        è¯´æ\npublic static <t> void sort(list<t> list)   å°éåä¸­åç´ æç§é»è®¤è§åæåº\n\nâ ï¸ æ³¨æï¼æ¬æ¹å¼ä¸å¯ä»¥ç´æ¥å¯¹èªå®ä¹ç±»åçlistéåæåºï¼é¤éèªå®ä¹ç±»åå®ç°äºæ¯è¾è§åcomparableæ¥å£ã\n\næåºæ¹å¼2ï¼\n\næ¹æ³åç§°                                                           è¯´æ\npublic static <t> void sort(list<t> list, comparator<? super   å°éåä¸­åç´ æç§æå®è§åæåº\nt> c)\n\nç¤ºä¾ä»£ç  1ï¼ (ä½¿ç¨æåºæ¹å¼ 1)\n\npublic class collectionsdemo01 {\n    public static void main(string[] args) {\n        list<string> names = new arraylist<>();\n        //names.add("æ¥çé¦");\n        //names.add("è¡éè±");\n        //names.add("å¼ æ å¿");\n        //names.add("éå°å¤");\n        collections.addall(names, "æ¥çé¦","è¡éè±", "å¼ æ å¿","éå°å¤");\n        system.out.println(names);\n\n        // 2ãpublic static void shuffle(list<?> list) :æä¹±éåé¡ºåºã\n        collections.shuffle(names);\n        system.out.println(names);\n\n        // 3ã public static <t> void sort(list<t> list):å°éåä¸­åç´ æç§é»è®¤è§åæåºã ï¼æå¼ç¹æ§çåç´ ï¼\n        list<integer> list = new arraylist<>();\n        collections.addall(list, 12, 23, 2, 4);\n        system.out.println(list);\n        collections.sort(list);\n        system.out.println(list);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nç¤ºä¾ä»£ç  2ï¼ (ä½¿ç¨æåºæ¹å¼ 2)\n\npublic class collectionsdemo02 {\n    public static void main(string[] args) {\n        list<apple> apples = new arraylist<>(); // å¯ä»¥éå¤ï¼\n        apples.add(new apple("çº¢å¯å£«", "çº¢è²", 9.9, 500));\n        apples.add(new apple("éè¹æ", "ç»¿è²", 15.9, 300));\n        apples.add(new apple("ç»¿è¹æ", "éè²", 29.9, 400));\n        apples.add(new apple("é»è¹æ", "é»è²", 9.8, 500));\n\n//        collections.sort(apples); // æ¹æ³ä¸ï¼å¯ä»¥çï¼appleç±»å·²ç»éåäºæ¯è¾è§å\n//        system.out.println(apples);\n\n        // æ¹å¼äºï¼sortæ¹æ³èªå¸¦æ¯è¾å¨å¯¹è±¡\n//        collections.sort(apples, new comparator<apple>() {\n//            @override\n//            public int compare(apple o1, apple o2) {\n//                return double.compare(o1.getprice() , o2.getprice()); // æç§ä»·æ ¼æåºï¼ï¼\n//            }\n//        });\n\n        collections.sort(apples, ( o1,  o2) ->  double.compare(o1.getprice() , o2.getprice()) );\n        system.out.println(apples);\n\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n',charsets:{cjk:!0},lastUpdated:"2023/03/29, 08:00:21",lastUpdatedTimestamp:1680076821e3},{title:"é¢åå¯¹è±¡è¿é¶6ï¼éåä½ç³»ä¹Mapï¼",frontmatter:{title:"é¢åå¯¹è±¡è¿é¶6ï¼éåä½ç³»ä¹Mapï¼",date:"2023-03-30T11:30:45.000Z",permalink:"/pages/134c54/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/35.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B66%EF%BC%88%E9%9B%86%E5%90%88%E4%BD%93%E7%B3%BB%E4%B9%8BMap%EF%BC%89.html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/35.é¢åå¯¹è±¡è¿é¶6ï¼éåä½ç³»ä¹Mapï¼.md",key:"v-3161e9d4",path:"/pages/134c54/",headers:[{level:2,title:"1. Map éå",slug:"_1-map-éå",normalizedTitle:"1. map éå",charIndex:2},{level:3,title:"1.1 å³äº Map éåèªèº«",slug:"_1-1-å³äº-map-éåèªèº«",normalizedTitle:"1.1 å³äº map éåèªèº«",charIndex:16},{level:3,title:"1.2 Map éåä½ç³»",slug:"_1-2-map-éåä½ç³»",normalizedTitle:"1.2 map éåä½ç³»",charIndex:222},{level:3,title:"1.3 Map éåçéå",slug:"_1-3-map-éåçéå",normalizedTitle:"1.3 map éåçéå",charIndex:1023},{level:4,title:"1.3.1 éåæ¹å¼ä¸ï¼é®æ¾å¼",slug:"_1-3-1-éåæ¹å¼ä¸-é®æ¾å¼",normalizedTitle:"1.3.1 éåæ¹å¼ä¸ï¼é®æ¾å¼",charIndex:1153},{level:4,title:"1.3.2 éåæ¹å¼äºï¼é®å¼å¯¹æµç¨",slug:"_1-3-2-éåæ¹å¼äº-é®å¼å¯¹æµç¨",normalizedTitle:"1.3.2 éåæ¹å¼äºï¼é®å¼å¯¹æµç¨",charIndex:2034},{level:4,title:"1.3.3 éåæ¹å¼ä¸ï¼Lambda",slug:"_1-3-3-éåæ¹å¼ä¸-lambda",normalizedTitle:"1.3.3 éåæ¹å¼ä¸ï¼lambda",charIndex:3372},{level:3,title:"1.4 Map éåä¹å®ç°ç±»",slug:"_1-4-map-éåä¹å®ç°ç±»",normalizedTitle:"1.4 map éåä¹å®ç°ç±»",charIndex:4349},{level:4,title:"1.4.1 HashMap",slug:"_1-4-1-hashmap",normalizedTitle:"1.4.1 hashmap",charIndex:4367}],headersStr:"1. Map éå 1.1 å³äº Map éåèªèº« 1.2 Map éåä½ç³» 1.3 Map éåçéå 1.3.1 éåæ¹å¼ä¸ï¼é®æ¾å¼ 1.3.2 éåæ¹å¼äºï¼é®å¼å¯¹æµç¨ 1.3.3 éåæ¹å¼ä¸ï¼Lambda 1.4 Map éåä¹å®ç°ç±» 1.4.1 HashMap",content:'# 1. Map éå\n\n\n# 1.1 å³äº Map éåèªèº«\n\nMap éåæ¯ä¸ç§ååéåï¼ä¹è¢«ç§°ä¸ºâé®å¼å¯¹éåâãæ¯ä¸ªåç´ åå«ä¸¤ä¸ªæ°æ®ãæ¯ä¸ªåç´ çæ ¼å¼ï¼key=value(é®å¼å¯¹åç´ )\n\nMap éåçå®æ´æ ¼å¼ï¼\n\n{key1=value1 , key2=value2 , key3=value3 , ...}\n\n> Collectionéåçæ ¼å¼: [åç´ 1,åç´ 2,åç´ 3..]\n\nMap éåéå¸¸éååè´­ç©è½¦è¿æ ·çä¸å¡åºæ¯ã\n\n\n# 1.2 Map éåä½ç³»\n\nä½¿ç¨æå¤ç Map éåæ¯ HashMapã\n\néç¹ææ¡ HashMap , LinkedHashMap , TreeMapãå¶ä»çåç»­çè§£ã\n\nMap éåä½ç³»çç¹ç¹ï¼\n\n * Map éåçç¹ç¹é½æ¯ç±é®å³å®çã\n * Map éåçé®æ¯æ åºãä¸éå¤ãæ ç´¢å¼çï¼å¼ä¸åè¦æ±ï¼å¯ä»¥éå¤ï¼ã\n * Map éååé¢éå¤çé®å¯¹åºçå¼ä¼è¦çåé¢éå¤é®çå¼ã\n * Map éåçé®å¼å¯¹é½å¯ä»¥ä¸º nullã\n\nMap éåå®ç°ç±»ç¹ç¹:\n\n * HashMap: åç´ æç§é®æ¯æ åºï¼ä¸éå¤ï¼æ ç´¢å¼ï¼å¼ä¸åè¦æ±ãï¼ä¸Mapä½ç³»ä¸è´ï¼\n * LinkedHashMap: åç´ æç§é®æ¯æåºï¼ä¸éå¤ï¼æ ç´¢å¼ï¼å¼ä¸åè¦æ±ã\n * TreeMapï¼åç´ æç§å»ºæ¯æåºï¼ä¸éå¤ï¼æ ç´¢å¼çï¼å¼ä¸åè¦æ±ã\n\nMap éåå¸¸ç¨ API:\n\nè¯´æï¼Map æ¯ååéåçç¥å®æ¥å£ï¼å®çåè½æ¯å¨é¨ååéåé½å¯ä»¥ç»§æ¿ä½¿ç¨çã\n\næ¹æ³åç§°                                  è¯´æ\nV put(K key,V value)                  æ·»å åç´ \nV remove(Object key)                  æ ¹æ®é®å é¤é®å¼å¯¹åç´ \nvoid clear()                          ç§»é¤ææçé®å¼å¯¹åç´ \nboolean containsKey(Object key)       å¤æ­éåæ¯å¦åå«æå®çé®\nboolean containsValue(Object value)   å¤æ­éåæ¯å¦åå«æå®çå¼\nboolean isEmpty()                     å¤æ­éåæ¯å¦ä¸ºç©º\nint size()                            éåçé¿åº¦ï¼ä¹å°±æ¯éåä¸­é®å¼å¯¹çä¸ªæ°\n\n\n# 1.3 Map éåçéå\n\nMap éåéåæä¸ç§æ¹å¼ï¼\n\n * é®æ¾å¼çæ¹å¼éåï¼åè·åMapéåå¨é¨çé®ï¼åæ ¹æ®éåé®æ¾å¼ã\n * é®å¼å¯¹çæ¹å¼éåï¼æâé®å¼å¯¹âçæä¸ä¸ªæ´ä½ï¼é¾åº¦è¾å¤§ã\n * JDK 1.8å¼å§ä¹åçæ°ææ¯ï¼Lambdaè¡¨è¾¾å¼ã\n\n# 1.3.1 éåæ¹å¼ä¸ï¼é®æ¾å¼\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \n\n\nÂ \n\n\n\n\n\n\n\n/**\n    a.âé®æ¾å¼âçæ¹å¼éåMapéåã\n        1.åè·åMapéåçå¨é¨é®çSetéåã\n        2.éåé®çSetéåï¼ç¶åéè¿é®æ¾å¼ã\n */\npublic class MapDemo01 {\n    public static void main(String[] args) {\n        Map<String , Integer> maps = new HashMap<>();\n        // 1.æ·»å åç´ : æ åºï¼ä¸éå¤ï¼æ ç´¢å¼ã\n        maps.put("å¨å¨",30);\n        maps.put("iphoneX",100);\n        maps.put("huawei",1000);\n        maps.put("çæ´»ç¨å",10);\n        maps.put("æè¡¨",10);\n        System.out.println(maps);\n        // maps = {huawei=1000, æè¡¨=10, çæ´»ç¨å=10, iphoneX=100, å¨å¨=30}\n\n        // 1ãé®æ¾å¼ï¼ç¬¬ä¸æ­¥ï¼åæ¿å°éåçå¨é¨é®ã\n        Set<String> keys = maps.keySet();\n        // 2ãç¬¬äºæ­¥ï¼éåæ¯ä¸ªé®ï¼æ ¹æ®é®æåå¼\n        for (String key : keys) {\n            int value = maps.get(key);\n            System.out.println(key + "===>" + value);\n        }\n\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n# 1.3.2 éåæ¹å¼äºï¼é®å¼å¯¹æµç¨\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \n\n\nÂ \nÂ \n\n\n\n\n\n\n/**\n    b.âé®å¼å¯¹âçæ¹å¼éåï¼\n        1.æMapéåè½¬æ¢æä¸ä¸ªSetéå:Set<Map.Entry<K, V>> entrySet();\n        2.æ­¤æ¶é®å¼å¯¹åç´ çç±»åå°±ç¡®å®äºï¼ç±»åæ¯é®å¼å¯¹å®ä½ç±»åï¼Map.Entry<K, V>\n        3.æ¥ä¸æ¥å°±å¯ä»¥ç¨foreachéåè¿ä¸ªSetéåï¼ç±»åç¨Map.Entry<K, V>\n */\npublic class MapDemo02 {\n    public static void main(String[] args) {\n        Map<String , Integer> maps = new HashMap<>();\n        // 1.æ·»å åç´ : æ åºï¼ä¸éå¤ï¼æ ç´¢å¼ã\n        maps.put("å¨å¨",30);\n        maps.put("iphoneX",100);\n        maps.put("huawei",1000);\n        maps.put("çæ´»ç¨å",10);\n        maps.put("æè¡¨",10);\n        System.out.println(maps);\n        /**\n            maps = {huawei=1000, æè¡¨=10, çæ´»ç¨å=10, iphoneX=100, å¨å¨=30}\n                ð\n            ä½¿ç¨foreachéåmapéå.åç°Mapéåçé®å¼å¯¹åç´ ç´æ¥æ¯æ²¡æç±»åçãæä»¥ä¸å¯ä»¥ç´æ¥foreachéåéåã\n                ð\n            å¯ä»¥éè¿è°ç¨Mapçæ¹æ³ entrySetæMapéåè½¬æ¢æSetéåå½¢å¼  maps.entrySet();\n                ð\n            æ­¤æ¶å¯ä»¥ä½¿ç¨foreachéå\n       */\n       // 1ãæMapéåè½¬æ¢æSetéå\n        Set<Map.Entry<String, Integer>> entries = maps.entrySet();\n        // 2ãå¼å§éå\n        for(Map.Entry<String, Integer> entry : entries){\n            String key = entry.getKey();\n            int value = entry.getValue();\n            System.out.println(key + "====>" + value);\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n# 1.3.3 éåæ¹å¼ä¸ï¼Lambda\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \nÂ \n\n\n\n\n\n\n/**\n    c.JDK 1.8å¼å§ä¹åçæ°ææ¯ï¼Lambdaè¡¨è¾¾å¼ãï¼ææ¶äºè§£ï¼\n */\npublic class MapDemo03 {\n    public static void main(String[] args) {\n        Map<String , Integer> maps = new HashMap<>();\n        // 1.æ·»å åç´ : æ åºï¼ä¸éå¤ï¼æ ç´¢å¼ã\n        maps.put("å¨å¨",30);\n        maps.put("iphoneX",100);//  Mapéååé¢éå¤çé®å¯¹åºçåç´ ä¼è¦çåé¢éå¤çæ´ä¸ªåç´ ï¼\n        maps.put("huawei",1000);\n        maps.put("çæ´»ç¨å",10);\n        maps.put("æè¡¨",10);\n        System.out.println(maps);\n\n        //  maps = {huawei=1000, æè¡¨=10, çæ´»ç¨å=10, iphoneX=100, å¨å¨=30}\n\n//        maps.forEach(new BiConsumer<String, Integer>() {\n//            @Override\n//            public void accept(String key, Integer value) {\n//                System.out.println(key + "---\x3e" + value);\n//            }\n//        });\n\n        maps.forEach((k, v) -> {\n                System.out.println(k + "---\x3e" + v);\n        });\n\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# 1.4 Map éåä¹å®ç°ç±»\n\n# 1.4.1 HashMap\n\nHashMap æ¯ Map éé¢çä¸ä¸ªå®ç°ç±»ã\n\nHashMap çç¹ç¹ï¼\n\n * HashMap ç¹ç¹é½æ¯ç±é®å³å®çï¼æ åºãä¸éå¤ãæ ç´¢å¼ã\n * æ²¡æé¢å¤éè¦å­¦ä¹ çç¹ææ¹æ³ï¼ç´æ¥ä½¿ç¨ Map éé¢çæ¹æ³å°±å¯ä»¥äºã\n * HashMap è· HashSet åºå±åçæ¯ä¸æ¨¡ä¸æ ·çï¼é½æ¯åå¸è¡¨ç»æï¼åªæ¯ HashMap çæ¯ä¸ªåç´ åå«ä¸¤ä¸ªå¼èå·²ã\n\nå®éä¸ï¼Set ç³»åéåçåºå±å°±æ¯ Map å®ç°çï¼åªæ¯ Set éåä¸­çåç´ åªè¦é®æ°æ®ï¼ä¸è¦å¼æ°æ®ã\n\næºç ï¼\n\npublic HashSet() {\n    map = new HashMap<>();\n}\n\n\n1\n2\n3\n',normalizedContent:'# 1. map éå\n\n\n# 1.1 å³äº map éåèªèº«\n\nmap éåæ¯ä¸ç§ååéåï¼ä¹è¢«ç§°ä¸ºâé®å¼å¯¹éåâãæ¯ä¸ªåç´ åå«ä¸¤ä¸ªæ°æ®ãæ¯ä¸ªåç´ çæ ¼å¼ï¼key=value(é®å¼å¯¹åç´ )\n\nmap éåçå®æ´æ ¼å¼ï¼\n\n{key1=value1 , key2=value2 , key3=value3 , ...}\n\n> collectionéåçæ ¼å¼: [åç´ 1,åç´ 2,åç´ 3..]\n\nmap éåéå¸¸éååè´­ç©è½¦è¿æ ·çä¸å¡åºæ¯ã\n\n\n# 1.2 map éåä½ç³»\n\nä½¿ç¨æå¤ç map éåæ¯ hashmapã\n\néç¹ææ¡ hashmap , linkedhashmap , treemapãå¶ä»çåç»­çè§£ã\n\nmap éåä½ç³»çç¹ç¹ï¼\n\n * map éåçç¹ç¹é½æ¯ç±é®å³å®çã\n * map éåçé®æ¯æ åºãä¸éå¤ãæ ç´¢å¼çï¼å¼ä¸åè¦æ±ï¼å¯ä»¥éå¤ï¼ã\n * map éååé¢éå¤çé®å¯¹åºçå¼ä¼è¦çåé¢éå¤é®çå¼ã\n * map éåçé®å¼å¯¹é½å¯ä»¥ä¸º nullã\n\nmap éåå®ç°ç±»ç¹ç¹:\n\n * hashmap: åç´ æç§é®æ¯æ åºï¼ä¸éå¤ï¼æ ç´¢å¼ï¼å¼ä¸åè¦æ±ãï¼ä¸mapä½ç³»ä¸è´ï¼\n * linkedhashmap: åç´ æç§é®æ¯æåºï¼ä¸éå¤ï¼æ ç´¢å¼ï¼å¼ä¸åè¦æ±ã\n * treemapï¼åç´ æç§å»ºæ¯æåºï¼ä¸éå¤ï¼æ ç´¢å¼çï¼å¼ä¸åè¦æ±ã\n\nmap éåå¸¸ç¨ api:\n\nè¯´æï¼map æ¯ååéåçç¥å®æ¥å£ï¼å®çåè½æ¯å¨é¨ååéåé½å¯ä»¥ç»§æ¿ä½¿ç¨çã\n\næ¹æ³åç§°                                  è¯´æ\nv put(k key,v value)                  æ·»å åç´ \nv remove(object key)                  æ ¹æ®é®å é¤é®å¼å¯¹åç´ \nvoid clear()                          ç§»é¤ææçé®å¼å¯¹åç´ \nboolean containskey(object key)       å¤æ­éåæ¯å¦åå«æå®çé®\nboolean containsvalue(object value)   å¤æ­éåæ¯å¦åå«æå®çå¼\nboolean isempty()                     å¤æ­éåæ¯å¦ä¸ºç©º\nint size()                            éåçé¿åº¦ï¼ä¹å°±æ¯éåä¸­é®å¼å¯¹çä¸ªæ°\n\n\n# 1.3 map éåçéå\n\nmap éåéåæä¸ç§æ¹å¼ï¼\n\n * é®æ¾å¼çæ¹å¼éåï¼åè·åmapéåå¨é¨çé®ï¼åæ ¹æ®éåé®æ¾å¼ã\n * é®å¼å¯¹çæ¹å¼éåï¼æâé®å¼å¯¹âçæä¸ä¸ªæ´ä½ï¼é¾åº¦è¾å¤§ã\n * jdk 1.8å¼å§ä¹åçæ°ææ¯ï¼lambdaè¡¨è¾¾å¼ã\n\n# 1.3.1 éåæ¹å¼ä¸ï¼é®æ¾å¼\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \n\n\nÂ \n\n\n\n\n\n\n\n/**\n    a.âé®æ¾å¼âçæ¹å¼éåmapéåã\n        1.åè·åmapéåçå¨é¨é®çsetéåã\n        2.éåé®çsetéåï¼ç¶åéè¿é®æ¾å¼ã\n */\npublic class mapdemo01 {\n    public static void main(string[] args) {\n        map<string , integer> maps = new hashmap<>();\n        // 1.æ·»å åç´ : æ åºï¼ä¸éå¤ï¼æ ç´¢å¼ã\n        maps.put("å¨å¨",30);\n        maps.put("iphonex",100);\n        maps.put("huawei",1000);\n        maps.put("çæ´»ç¨å",10);\n        maps.put("æè¡¨",10);\n        system.out.println(maps);\n        // maps = {huawei=1000, æè¡¨=10, çæ´»ç¨å=10, iphonex=100, å¨å¨=30}\n\n        // 1ãé®æ¾å¼ï¼ç¬¬ä¸æ­¥ï¼åæ¿å°éåçå¨é¨é®ã\n        set<string> keys = maps.keyset();\n        // 2ãç¬¬äºæ­¥ï¼éåæ¯ä¸ªé®ï¼æ ¹æ®é®æåå¼\n        for (string key : keys) {\n            int value = maps.get(key);\n            system.out.println(key + "===>" + value);\n        }\n\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\n# 1.3.2 éåæ¹å¼äºï¼é®å¼å¯¹æµç¨\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \n\n\nÂ \nÂ \n\n\n\n\n\n\n/**\n    b.âé®å¼å¯¹âçæ¹å¼éåï¼\n        1.æmapéåè½¬æ¢æä¸ä¸ªsetéå:set<map.entry<k, v>> entryset();\n        2.æ­¤æ¶é®å¼å¯¹åç´ çç±»åå°±ç¡®å®äºï¼ç±»åæ¯é®å¼å¯¹å®ä½ç±»åï¼map.entry<k, v>\n        3.æ¥ä¸æ¥å°±å¯ä»¥ç¨foreachéåè¿ä¸ªsetéåï¼ç±»åç¨map.entry<k, v>\n */\npublic class mapdemo02 {\n    public static void main(string[] args) {\n        map<string , integer> maps = new hashmap<>();\n        // 1.æ·»å åç´ : æ åºï¼ä¸éå¤ï¼æ ç´¢å¼ã\n        maps.put("å¨å¨",30);\n        maps.put("iphonex",100);\n        maps.put("huawei",1000);\n        maps.put("çæ´»ç¨å",10);\n        maps.put("æè¡¨",10);\n        system.out.println(maps);\n        /**\n            maps = {huawei=1000, æè¡¨=10, çæ´»ç¨å=10, iphonex=100, å¨å¨=30}\n                ð\n            ä½¿ç¨foreachéåmapéå.åç°mapéåçé®å¼å¯¹åç´ ç´æ¥æ¯æ²¡æç±»åçãæä»¥ä¸å¯ä»¥ç´æ¥foreachéåéåã\n                ð\n            å¯ä»¥éè¿è°ç¨mapçæ¹æ³ entrysetæmapéåè½¬æ¢æsetéåå½¢å¼  maps.entryset();\n                ð\n            æ­¤æ¶å¯ä»¥ä½¿ç¨foreachéå\n       */\n       // 1ãæmapéåè½¬æ¢æsetéå\n        set<map.entry<string, integer>> entries = maps.entryset();\n        // 2ãå¼å§éå\n        for(map.entry<string, integer> entry : entries){\n            string key = entry.getkey();\n            int value = entry.getvalue();\n            system.out.println(key + "====>" + value);\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n# 1.3.3 éåæ¹å¼ä¸ï¼lambda\n\nç¤ºä¾ä»£ç ï¼\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nÂ \nÂ \n\n\n\n\n\n\n/**\n    c.jdk 1.8å¼å§ä¹åçæ°ææ¯ï¼lambdaè¡¨è¾¾å¼ãï¼ææ¶äºè§£ï¼\n */\npublic class mapdemo03 {\n    public static void main(string[] args) {\n        map<string , integer> maps = new hashmap<>();\n        // 1.æ·»å åç´ : æ åºï¼ä¸éå¤ï¼æ ç´¢å¼ã\n        maps.put("å¨å¨",30);\n        maps.put("iphonex",100);//  mapéååé¢éå¤çé®å¯¹åºçåç´ ä¼è¦çåé¢éå¤çæ´ä¸ªåç´ ï¼\n        maps.put("huawei",1000);\n        maps.put("çæ´»ç¨å",10);\n        maps.put("æè¡¨",10);\n        system.out.println(maps);\n\n        //  maps = {huawei=1000, æè¡¨=10, çæ´»ç¨å=10, iphonex=100, å¨å¨=30}\n\n//        maps.foreach(new biconsumer<string, integer>() {\n//            @override\n//            public void accept(string key, integer value) {\n//                system.out.println(key + "---\x3e" + value);\n//            }\n//        });\n\n        maps.foreach((k, v) -> {\n                system.out.println(k + "---\x3e" + v);\n        });\n\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# 1.4 map éåä¹å®ç°ç±»\n\n# 1.4.1 hashmap\n\nhashmap æ¯ map éé¢çä¸ä¸ªå®ç°ç±»ã\n\nhashmap çç¹ç¹ï¼\n\n * hashmap ç¹ç¹é½æ¯ç±é®å³å®çï¼æ åºãä¸éå¤ãæ ç´¢å¼ã\n * æ²¡æé¢å¤éè¦å­¦ä¹ çç¹ææ¹æ³ï¼ç´æ¥ä½¿ç¨ map éé¢çæ¹æ³å°±å¯ä»¥äºã\n * hashmap è· hashset åºå±åçæ¯ä¸æ¨¡ä¸æ ·çï¼é½æ¯åå¸è¡¨ç»æï¼åªæ¯ hashmap çæ¯ä¸ªåç´ åå«ä¸¤ä¸ªå¼èå·²ã\n\nå®éä¸ï¼set ç³»åéåçåºå±å°±æ¯ map å®ç°çï¼åªæ¯ set éåä¸­çåç´ åªè¦é®æ°æ®ï¼ä¸è¦å¼æ°æ®ã\n\næºç ï¼\n\npublic hashset() {\n    map = new hashmap<>();\n}\n\n\n1\n2\n3\n',charsets:{cjk:!0},lastUpdated:"2023/03/30, 09:25:20",lastUpdatedTimestamp:168016832e4},{title:"é¢åå¯¹è±¡è¿é¶-è¡¥åï¼å¯ååæ°ï¼",frontmatter:{title:"é¢åå¯¹è±¡è¿é¶-è¡¥åï¼å¯ååæ°ï¼",date:"2023-03-29T15:22:10.000Z",permalink:"/pages/e64834/",categories:["å¼å","Java","é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/05.%E9%BB%91%E9%A9%ACJava%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/40.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B6-%E8%A1%A5%E5%85%85%EF%BC%88%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%EF%BC%89.html",relativePath:"å¼å/10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/40.é¢åå¯¹è±¡è¿é¶-è¡¥åï¼å¯ååæ°ï¼.md",key:"v-78a8ae4e",path:"/pages/e64834/",headers:[{level:2,title:"1. å¯ååæ°",slug:"_1-å¯ååæ°",normalizedTitle:"1. å¯ååæ°",charIndex:2},{level:3,title:"1.1 å¯ååæ°æ¯å¥",slug:"_1-1-å¯ååæ°æ¯å¥",normalizedTitle:"1.1 å¯ååæ°æ¯å¥",charIndex:14},{level:3,title:"1.2 å¯ååæ°çä½ç¨",slug:"_1-2-å¯ååæ°çä½ç¨",normalizedTitle:"1.2 å¯ååæ°çä½ç¨",charIndex:89},{level:3,title:"1.3 å¯ååæ°çæ³¨æäºé¡¹",slug:"_1-3-å¯ååæ°çæ³¨æäºé¡¹",normalizedTitle:"1.3 å¯ååæ°çæ³¨æäºé¡¹",charIndex:141}],headersStr:"1. å¯ååæ° 1.1 å¯ååæ°æ¯å¥ 1.2 å¯ååæ°çä½ç¨ 1.3 å¯ååæ°çæ³¨æäºé¡¹",content:'# 1. å¯ååæ°\n\n\n# 1.1 å¯ååæ°æ¯å¥\n\nå¯ååæ°ç¨å¨å½¢åä¸­å¯ä»¥æ¥æ¶å¤ä¸ªæ°æ®\n\nå¯ååæ°çæ ¼å¼ï¼æ°æ®ç±»å...åæ°åç§°\n\nå¯ååæ°å¨æ¹æ³åé¨æ¬è´¨ä¸å°±æ¯ä¸ªæ°ç»ã\n\n\n# 1.2 å¯ååæ°çä½ç¨\n\nä¼ è¾åæ°éå¸¸çµæ´»æ¹ä¾¿ï¼å¯ä»¥ä¸ä¼ è¾åæ°ãä¼ ä¸ä¸ªæå¤ä¸ªåæ°ãä¼ ä¸ä¸ªæ°ç»ã\n\n\n# 1.3 å¯ååæ°çæ³¨æäºé¡¹\n\n 1. ä¸ä¸ªå½¢ååè¡¨ä¸­å¯ååæ°åªè½æä¸ä¸ª\n 2. å¯ååæ°å¿é¡»æ¾å¨å½¢ååè¡¨çæåé¢\n\nç¤ºä¾ä»£ç ï¼\n\npublic class MethodDemo {\n    public static void main(String[] args) {\n\n        sum(); // 1ãä¸ä¼ åæ°\n        sum(10); // 2ãå¯ä»¥ä¼ è¾ä¸ä¸ªåæ°\n        sum(10, 20, 30); // 3ãå¯ä»¥ä¼ è¾å¤ä¸ªåæ°\n        sum(new int[]{10, 20, 30, 40, 50}); // 4ãå¯ä»¥ä¼ è¾ä¸ä¸ªæ°ç»\n    }\n\n    /**\n       æ³¨æï¼ä¸ä¸ªå½¢ååè¡¨ä¸­åªè½æä¸ä¸ªå¯ååæ°,å¯ååæ°å¿é¡»æ¾å¨å½¢ååè¡¨çæåé¢\n     * @param nums\n     */\n    public static void sum(int...nums){\n        // æ³¨æï¼å¯ååæ°å¨æ¹æ³åé¨å¶å®å°±æ¯ä¸ä¸ªæ°ç»ã nums\n        System.out.println("åç´ ä¸ªæ°ï¼" + nums.length);\n        System.out.println("åç´ åå®¹ï¼" + Arrays.toString(nums));\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',normalizedContent:'# 1. å¯ååæ°\n\n\n# 1.1 å¯ååæ°æ¯å¥\n\nå¯ååæ°ç¨å¨å½¢åä¸­å¯ä»¥æ¥æ¶å¤ä¸ªæ°æ®\n\nå¯ååæ°çæ ¼å¼ï¼æ°æ®ç±»å...åæ°åç§°\n\nå¯ååæ°å¨æ¹æ³åé¨æ¬è´¨ä¸å°±æ¯ä¸ªæ°ç»ã\n\n\n# 1.2 å¯ååæ°çä½ç¨\n\nä¼ è¾åæ°éå¸¸çµæ´»æ¹ä¾¿ï¼å¯ä»¥ä¸ä¼ è¾åæ°ãä¼ ä¸ä¸ªæå¤ä¸ªåæ°ãä¼ ä¸ä¸ªæ°ç»ã\n\n\n# 1.3 å¯ååæ°çæ³¨æäºé¡¹\n\n 1. ä¸ä¸ªå½¢ååè¡¨ä¸­å¯ååæ°åªè½æä¸ä¸ª\n 2. å¯ååæ°å¿é¡»æ¾å¨å½¢ååè¡¨çæåé¢\n\nç¤ºä¾ä»£ç ï¼\n\npublic class methoddemo {\n    public static void main(string[] args) {\n\n        sum(); // 1ãä¸ä¼ åæ°\n        sum(10); // 2ãå¯ä»¥ä¼ è¾ä¸ä¸ªåæ°\n        sum(10, 20, 30); // 3ãå¯ä»¥ä¼ è¾å¤ä¸ªåæ°\n        sum(new int[]{10, 20, 30, 40, 50}); // 4ãå¯ä»¥ä¼ è¾ä¸ä¸ªæ°ç»\n    }\n\n    /**\n       æ³¨æï¼ä¸ä¸ªå½¢ååè¡¨ä¸­åªè½æä¸ä¸ªå¯ååæ°,å¯ååæ°å¿é¡»æ¾å¨å½¢ååè¡¨çæåé¢\n     * @param nums\n     */\n    public static void sum(int...nums){\n        // æ³¨æï¼å¯ååæ°å¨æ¹æ³åé¨å¶å®å°±æ¯ä¸ä¸ªæ°ç»ã nums\n        system.out.println("åç´ ä¸ªæ°ï¼" + nums.length);\n        system.out.println("åç´ åå®¹ï¼" + arrays.tostring(nums));\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n',charsets:{cjk:!0},lastUpdated:"2023/03/29, 07:33:42",lastUpdatedTimestamp:1680075222e3},{title:"é¢åå¯¹è±¡",frontmatter:{title:"é¢åå¯¹è±¡",date:"2022-03-28T16:39:56.000Z",permalink:"/pages/017edb/",categories:["å¼å","Java"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/10.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1.html",relativePath:"å¼å/10.Java/10.é¢åå¯¹è±¡.md",key:"v-147908a9",path:"/pages/017edb/",headers:[{level:2,title:"1. æ¨¡æ¿æ¹æ³æ¨¡å¼",slug:"_1-æ¨¡æ¿æ¹æ³æ¨¡å¼",normalizedTitle:"1. æ¨¡æ¿æ¹æ³æ¨¡å¼",charIndex:2},{level:3,title:"1.1 æ½è±¡ç±»",slug:"_1-1-æ½è±¡ç±»",normalizedTitle:"1.1 æ½è±¡ç±»",charIndex:16},{level:3,title:"1.2 æ¨¡æ¿æ¹æ³",slug:"_1-2-æ¨¡æ¿æ¹æ³",normalizedTitle:"1.2 æ¨¡æ¿æ¹æ³",charIndex:254},{level:2,title:"2. æ¥å£",slug:"_2-æ¥å£",normalizedTitle:"2. æ¥å£",charIndex:549},{level:3,title:"2.1 åºæ¬ç¥è¯",slug:"_2-1-åºæ¬ç¥è¯",normalizedTitle:"2.1 åºæ¬ç¥è¯",charIndex:559},{level:3,title:"2.2 æ¥å£æ°å¢çæ¹æ³",slug:"_2-2-æ¥å£æ°å¢çæ¹æ³",normalizedTitle:"2.2 æ¥å£æ°å¢çæ¹æ³",charIndex:825},{level:3,title:"2.3 ä½¿ç¨æ¥å£çæ³¨æäºé¡¹ï¼é¢è¯ä¸­æ¶åï¼",slug:"_2-3-ä½¿ç¨æ¥å£çæ³¨æäºé¡¹-é¢è¯ä¸­æ¶å",normalizedTitle:"2.3 ä½¿ç¨æ¥å£çæ³¨æäºé¡¹ï¼é¢è¯ä¸­æ¶åï¼",charIndex:1132},{level:2,title:"3. å¤æ",slug:"_3-å¤æ",normalizedTitle:"3. å¤æ",charIndex:1432},{level:4,title:"(1) ä»ä¹æ¯å¤æ",slug:"_1-ä»ä¹æ¯å¤æ",normalizedTitle:"(1) ä»ä¹æ¯å¤æ",charIndex:1441},{level:4,title:"(2) å¤æçå¸¸è§å½¢å¼",slug:"_2-å¤æçå¸¸è§å½¢å¼",normalizedTitle:"(2) å¤æçå¸¸è§å½¢å¼",charIndex:1510},{level:4,title:"(3) å¤æä¸­æåè®¿é®ç¹ç¹",slug:"_3-å¤æä¸­æåè®¿é®ç¹ç¹",normalizedTitle:"(3) å¤æä¸­æåè®¿é®ç¹ç¹",charIndex:1767},{level:4,title:"(4) å¤æçåæ",slug:"_4-å¤æçåæ",normalizedTitle:"(4) å¤æçåæ",charIndex:1874},{level:4,title:"(5) ä¼å¿",slug:"_5-ä¼å¿",normalizedTitle:"(5) ä¼å¿",charIndex:1916},{level:4,title:"(6) å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢",slug:"_6-å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢",normalizedTitle:"(6) å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢",charIndex:2278},{level:2,title:"4. åé¨ç±»",slug:"_4-åé¨ç±»",normalizedTitle:"4. åé¨ç±»",charIndex:3301},{level:3,title:"4.1 éæåé¨ç±»",slug:"_4-1-éæåé¨ç±»",normalizedTitle:"4.1 éæåé¨ç±»",charIndex:3329},{level:3,title:"4.2 æååé¨ç±»ï¼ééæåé¨ç±»ï¼",slug:"_4-2-æååé¨ç±»-ééæåé¨ç±»",normalizedTitle:"4.2 æååé¨ç±»ï¼ééæåé¨ç±»ï¼",charIndex:3602},{level:3,title:"4.3 å±é¨åé¨ç±»",slug:"_4-3-å±é¨åé¨ç±»",normalizedTitle:"4.3 å±é¨åé¨ç±»",charIndex:4111},{level:3,title:"4.4 *å¿ååé¨ç±»",slug:"_4-4-å¿ååé¨ç±»",normalizedTitle:"4.4 *å¿ååé¨ç±»",charIndex:4136},{level:4,title:"(1) æ¦è¿°",slug:"_1-æ¦è¿°",normalizedTitle:"(1) æ¦è¿°",charIndex:4150},{level:4,title:"(2) å¸¸è§ä½¿ç¨å½¢å¼",slug:"_2-å¸¸è§ä½¿ç¨å½¢å¼",normalizedTitle:"(2) å¸¸è§ä½¿ç¨å½¢å¼",charIndex:4926}],headersStr:"1. æ¨¡æ¿æ¹æ³æ¨¡å¼ 1.1 æ½è±¡ç±» 1.2 æ¨¡æ¿æ¹æ³ 2. æ¥å£ 2.1 åºæ¬ç¥è¯ 2.2 æ¥å£æ°å¢çæ¹æ³ 2.3 ä½¿ç¨æ¥å£çæ³¨æäºé¡¹ï¼é¢è¯ä¸­æ¶åï¼ 3. å¤æ (1) ä»ä¹æ¯å¤æ (2) å¤æçå¸¸è§å½¢å¼ (3) å¤æä¸­æåè®¿é®ç¹ç¹ (4) å¤æçåæ (5) ä¼å¿ (6) å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢ 4. åé¨ç±» 4.1 éæåé¨ç±» 4.2 æååé¨ç±»ï¼ééæåé¨ç±»ï¼ 4.3 å±é¨åé¨ç±» 4.4 *å¿ååé¨ç±» (1) æ¦è¿° (2) å¸¸è§ä½¿ç¨å½¢å¼",content:'# 1. æ¨¡æ¿æ¹æ³æ¨¡å¼\n\n\n# 1.1 æ½è±¡ç±»\n\nå¦æä¸ä¸ªç±»ä¸­çæä¸ªæ¹æ³çå·ä½å®ç°ä¸è½ç¡®å®ï¼å°±å¯ä»¥ç³ææabstractä¿®é¥°çæ½è±¡æ¹æ³ï¼ä¸è½åæ¹æ³ä½äºï¼ï¼è¿ä¸ªç±»å¿é¡»ç¨abstractä¿®é¥°ï¼è¢«ç§°ä¸ºæ½è±¡ç±»ã\n\n\n\næ½è±¡çä½¿ç¨æ»ç»ä¸æ³¨æäºé¡¹ï¼\n\n * æ½è±¡ç±»å¯ä»¥çè§£æç±»çä¸å®æ´è®¾è®¡å¾ï¼æ¯ç¨æ¥è¢«å­ç±»ç»§æ¿çã\n * ä¸ä¸ªç±»å¦æç»§æ¿äºæ½è±¡ç±»ï¼é£ä¹è¿ä¸ªç±»å¿é¡»éåå®æ½è±¡ç±»çå¨é¨æ½è±¡æ¹æ³ï¼å¦åè¿ä¸ªç±»ä¹å¿é¡»å®ä¹ææ½è±¡ç±»ã\n * æ½è±¡ç±»æ²¡æåå»ºå¯¹è±¡çè½åã\n * æ½è±¡ç±»ä¸­ä¸ä¸å®ææ½è±¡æ¹æ³ï¼ææ½è±¡æ¹æ³çç±»ä¸å®æ¯æ½è±¡ç±»\n\n\n# 1.2 æ¨¡æ¿æ¹æ³\n\næ¨¡æ¿æ¹æ³æ¨¡å¼å®ç°æ­¥éª¤ï¼\n\n * æåè½å®ä¹æä¸ä¸ªæè°çæ¨¡æ¿æ¹æ³ï¼æ¾å¨æ½è±¡ç±»ä¸­ï¼æ¨¡æ¿æ¹æ³ä¸­åªå®ä¹éç¨ä¸è½ç¡®å®çä»£ç ã\n * æ¨¡æ¿æ¹æ³ä¸­ä¸è½å³å®çåè½å®ä¹ææ½è±¡æ¹æ³è®©å·ä½å­ç±»å»å®ç°ã\n\næç¤º\n\næ¨¡æ¿æ¹æ³æä»¬æ¯å»ºè®®ä½¿ç¨finalä¿®é¥°ç,æ¨¡æ¿æ¹æ³æ¯ç»å­ç±»ç´æ¥ä½¿ç¨çï¼ä¸æ¯è®©å­ç±»éåçï¼ ä¸æ¦å­ç±»éåäºæ¨¡æ¿æ¹æ³å°±å¤±æäºã\n\nä¾å¦ï¼ä¸­å­¦çåå°å­¦çåãæçç¸ç¸ãè¿ç¯ä½æï¼ä»ä¿©é¤äºæç« ä¸»ä½é¨åä¸åï¼å«çå°æ¹é½ä¸æ ·ï¼æ­¤æ¶ï¼å¯ä»¥å®ä¹ä¸ä¸ªæ½è±¡ç±»ï¼ç¨ä¸ä¸ªå¬å±çæ¨¡æ¿æ¹æ³æ¥å®ç°ç¸åçé¨åï¼ä¸åçé¨åå¨è¿ä¸ªæ½è±¡ç±»ä¸­å£°æä¸ä¸ªæ½è±¡æ¹æ³ï¼è®©å­ç±»å¨æ­¤å¤æ¥å®ç°ä»ä»¬åå«çåè½ãå¦ä¸å¾ä»£ç æç¤ºï¼\n\n\n\n\n# 2. æ¥å£\n\n\n# 2.1 åºæ¬ç¥è¯\n\næ¥å£ä½ç°äºä¸ç§è§èï¼çº¦æç±»ä¸å®è¦å¹²å¥äºãè§èä¸å®æ¯å¬å¼çã\n\nJDK 8 ä¹åæ¥å£ä¸­åªè½ææ½è±¡æ¹æ³åå¸¸éã\n\n * å³é®å­ï¼interface\n\n * æ¥å£çå®ç°ï¼implements æ¥å£1,æ¥å£2,...\n\nå ç§å³ç³»ï¼\n\n * ç±»åç±»çå³ç³»ï¼åç»§æ¿ã\n * ç±»åæ¥å£çå³ç³»ï¼å¤å®ç°ã\n * æ¥å£åæ¥å£çå³ç³»ï¼å¤ç»§æ¿ï¼ä¸ä¸ªæ¥å£å¯ä»¥åæ¶ç»§æ¿å¤ä¸ªæ¥å£ã\n\næ¥å£å¤ç»§æ¿çä½ç¨: è§èåå¹¶ï¼æ´åå¤ä¸ªæ¥å£ä¸ºåä¸ä¸ªæ¥å£ï¼ä¾¿äºå­ç±»å®ç°ãï¼å­ç±»åªéè¦implementsä¸ä¸ªæ¥å£å°±å¯ä»¥äºï¼ä¸ç¨å¾ç´¯èµå°å®ç°å¾å¤ä¸ªæ¥å£ï¼\n\n\n# 2.2 æ¥å£æ°å¢çæ¹æ³\n\nJDK8å¼å§åæ°å¢äºé£äºæ¹æ³ ?\n\n * é»è®¤æ¹æ³ï¼defaultä¿®é¥°ï¼å®ç°ç±»å¯¹è±¡è°ç¨ã\n * éææ¹æ³ï¼staticä¿®é¥°ï¼å¿é¡»ç¨å½åæ¥å£åè°ç¨ãä¸è½ç¨å­ç±»è°ç¨éææ¹æ³ã\n * ç§ææ¹æ³ï¼privateä¿®é¥°ï¼jdk9å¼å§ææçï¼åªè½å¨æ¥å£åé¨è¢«è°ç¨ã\n * ä»ä»¬é½ä¼é»è®¤è¢«publicä¿®é¥°ã\n\næ³¨æ\n\nJDK8æ°å¢ç3ç§æ¹æ³æä»¬èªå·±å¨å¼åä¸­å¾å°ä½¿ç¨ï¼éå¸¸æ¯Javaæºç æ¶åå°çï¼æä»¬éè¦çè§£ãè¯å«è¯­æ³ãæç½è°ç¨å³ç³»å³å¯ã\n\næç¤º\n\nåæ¢æ¨¡åçç¼è¯çæ¬ï¼éæ©JDKçæ¬ï¼File -> Project Structure -> Modules ->language level\n\n\n\n\n# 2.3 ä½¿ç¨æ¥å£çæ³¨æäºé¡¹ï¼é¢è¯ä¸­æ¶åï¼\n\næ¯è¾åçä¸äºè¯­æ³ï¼å®éå¼åä¸­éå¸¸ä¸ç¨ï¼åªæå¨ä¸äºé¢è¯ä¸­å¯è½ä¼æ¶åã\n\n 1. æ¥å£ä¸è½åå»ºå¯¹è±¡\n\n 2. ä¸ä¸ªç±»å®ç°å¤ä¸ªæ¥å£ï¼å¤ä¸ªæ¥å£ä¸­æåæ ·çéææ¹æ³ä¸å²çªã\n\n 3. ä¸ä¸ªç±»ç»§æ¿äºç¶ç±»ï¼åæ¶åå®ç°äºæ¥å£ï¼ç¶ç±»ä¸­åæ¥å£ä¸­æååæ¹æ³ï¼é»è®¤ç¨ç¶ç±»çã\n    \n    ç»§æ¿åªè½å¨å®ç°ä¹ååï¼å³åæäº²ç¸åæå¹²ç¹ãæ¥å£ä¸ºå¹²ç¹ï¼ç»§æ¿ä¸ºäº²ç¸ã\n\n 4. ä¸ä¸ªç±»å®ç°äºå¤ä¸ªæ¥å£ï¼å¤ä¸ªæ¥å£ä¸­å­å¨ååçé»è®¤æ¹æ³ï¼ä¸å²çªï¼è¿ä¸ªç±»éåè¯¥æ¹æ³å³å¯ã\n\n 5. ä¸ä¸ªæ¥å£ç»§æ¿å¤ä¸ªæ¥å£ï¼æ¯æ²¡æé®é¢çï¼å³ä½¿å¤ä¸ªæ¥å£ä¸­æéåçæ¹æ³ï¼ä½å¦æå¤ä¸ªæ¥å£ä¸­å­å¨è§èå²çªåä¸è½å¤ç»§æ¿ã\n\n\n# 3. å¤æ\n\n# (1) ä»ä¹æ¯å¤æ\n\nåç±»åçå¯¹è±¡ï¼æ§è¡åä¸ä¸ªè¡ä¸ºï¼ä¼è¡¨ç°åºä¸åçè¡ä¸ºç¹å¾ã\n\nç¶ç±»çå¼ç¨ç±»åæåå­ç±»çæé ï¼åä¸é åï¼å³ä¸ºå¤æã\n\n# (2) å¤æçå¸¸è§å½¢å¼\n\n * ç¶ç±»ç±»å å¯¹è±¡åç§° = new å­ç±»æé å¨;\n * æ¥å£ å¯¹è±¡åç§° = new å®ç°ç±»æé å¨;\n\nAnimal a = new Dog();\na.run(); // æ¹æ³è°ç¨ï¼ç¼è¯çå·¦ï¼è¿è¡çå³\nSystem.out.println(a.name); // æ¹æ³è°ç¨ï¼ç¼è¯çå·¦ï¼è¿è¡ä¹çå·¦ï¼å¨ç©åç§°\n\nAnimal a1 = new Dog();\na1.run();\nSystem.out.println(a1.name); // å¨ç©åç§°\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# (3) å¤æä¸­æåè®¿é®ç¹ç¹\n\n * æ¹æ³è°ç¨ï¼ç¼è¯çå·¦ï¼è¿è¡çå³ã=> å æ­¤å¤æä¸ä¸è½ä½¿ç¨å­ç±»çç¬æåè½ã\n * åéè°ç¨ï¼ç¼è¯çå·¦ï¼è¿è¡ä¹çå·¦ãï¼å¤æä¾§éè¡ä¸ºå¤æï¼\n\nå æ­¤ä¸è¿°ä»£ç çè¾åºç»æé½æ¯å¨ç©åç§°ã\n\n# (4) å¤æçåæ\n\næç»§æ¿/å®ç°å³ç³»ï¼æç¶ç±»å¼ç¨æåå­ç±»å¯¹è±¡ï¼ææ¹æ³éåã\n\n# (5) ä¼å¿\n\n * å¨å¤æå½¢å¼ä¸ï¼å³è¾¹å¯¹è±¡å¯ä»¥å®ç°è§£è¦åï¼ä¾¿äºæ©å±åç»´æ¤ã\n\nAnimal a = new Dog(); // åç»­ä¸å¡æ´æ¹æ¶åªéè¦ä¿®æ¹æ­¤å¤newçDogå³å¯\na.run(); // åç»­ä¸å¡è¡ä¸ºéå¯¹è±¡èåï¼åç»­ä»£ç æ éä¿®æ¹\n\n\n1\n2\n\n * å®ä¹æ¹æ³çæ¶åï¼ä½¿ç¨ç¶ç±»åä½ä¸ºåæ°ï¼è¯¥æ¹æ³å°±å¯ä»¥æ¥æ¶è¿ç¶ç±»çä¸åå­ç±»å¯¹è±¡ï¼ä½ç°åºå¤æçæ©å±æ§ä¸ä¾¿å©ã\n\n    public static void go(Animal a){\n        System.out.println("å¼å§ããã");\n        a.run();\n        System.out.println("ç»æããã");\n    }\n// è¿ä¸ªå½æ°å¯ä»¥ä¼ ä¸é¢ä»£ç ä¸­ça, ä¹å¯ä»¥ä¼ a1\n\n\n1\n2\n3\n4\n5\n6\n\n\n# (6) å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢\n\n * èªå¨ç±»åè½¬æ¢ï¼ä»å­å°ç¶)ï¼å­ç±»å¯¹è±¡èµå¼ç»ç¶ç±»ç±»åçåéæåã\n   \n   // èªå¨ç±»åè½¬æ¢\n   Animal a = new Dog();\n   a.run();\n   //a.lookDoor(); // å¤æä¸æ æ³è°ç¨å­ç±»ç¬æåè½\n   \n   \n   1\n   2\n   3\n   4\n   \n\n * å¼ºå¶ç±»åè½¬æ¢åï¼ä»ç¶å°å­)\n   \n   * æ­¤æ¶å¿é¡»è¿è¡å¼ºå¶ç±»åè½¬æ¢ï¼å­ç±» å¯¹è±¡åé = (å­ç±»)ç¶ç±»ç±»åçåé\n     \n     // å¼ºå¶ç±»åè½¬æ¢:å¯ä»¥å®ç°è°ç¨å­ç±»ç¬æåè½ç\n     Dog d = (Dog) a;\n     d.lookDoor();\n     \n     \n     1\n     2\n     3\n     \n   \n   * ä½ç¨ï¼å¯ä»¥è§£å³å¤æä¸çå£å¿ï¼å¯ä»¥å®ç°è°ç¨å­ç±»ç¬æçåè½ã\n   \n   * æ³¨æï¼ å¦æè½¬ååçç±»ååå¯¹è±¡çå®ç±»åä¸æ¯åä¸ç§ç±»åï¼é£ä¹å¨è½¬æ¢çæ¶åå°±ä¼åºç°ClassCastException\n\nå»ºè®®\n\nå»ºè®®å¼ºå¶è½¬æ¢åï¼åå¤æ­åéæåå¯¹è±¡ççå®ç±»åï¼åå¼ºå¶ç±»åè½¬æ¢ã\n\nåéå instanceof çå®ç±»å å¤æ­å³é®å­å·¦è¾¹çåéæåçå¯¹è±¡ççå®ç±»åï¼æ¯å¦æ¯å³è¾¹çç±»åæèæ¯å¶å­ç±»ç±»åï¼æ¯åè¿åtrue\n\nä»¥ä¸å¤æ­æ¯å¾æå¿è¦çï¼å ä¸ºå¾æå¯è½å¨æ¹æ³åé¨çä¸å°è¿ä¸ªå¯¹è±¡å°åºæ¯å¥ç±»åãå¦ä¸ä»£ç æç¤ºï¼ä¸ç¥éä¼ è¿æ¥ç Animal å°åºæ¯çè¿æ¯ä¹é¾ï¼\n\n    public static void go(Animal a){\n        System.out.println("é¢å¤~~~");\n        a.run();\n        // ç¬æåè½\n        if(a instanceof Tortoise){\n            Tortoise t = (Tortoise) a;\n            t.layEggs();\n        }else if(a instanceof Dog){\n            Dog d1 = (Dog) a;\n            d1.lookDoor();\n        }\n        System.out.println("ç»æ~~~~");\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 4. åé¨ç±»\n\nåé¨ç±»å°±æ¯å®ä¹å¨ä¸ä¸ªç±»éé¢çç±»\n\n\n# 4.1 éæåé¨ç±»\n\næstaticä¿®é¥°ï¼å±äºå¤é¨ç±»æ¬èº«ãå®çç¹ç¹åä½¿ç¨ä¸æ®éç±»æ¯å®å¨ä¸æ ·çï¼ç±»æçæåå®é½æï¼åªæ¯ä½ç½®å¨å«äººéé¢èå·²ã\n\npublic class Outer{\n    // éææååé¨ç±»\n    public static class Inner{\n    }\n}\n\n\n1\n2\n3\n4\n5\n\n\néæåé¨ç±»åå»ºå¯¹è±¡çæ ¼å¼ï¼å¤é¨ç±»å.åé¨ç±»å å¯¹è±¡å = new å¤é¨ç±»å.åé¨ç±»æé å¨; èä¾ï¼Outer.Inner in = new Outer.Inner();\n\n> è¿ç§è¯­æ³æ¯è¾å°ç¨ï¼ä¸è¬è¿æ¯åå¼å®ä¹ä¸¤ç§ç±»çã\n\n\n# 4.2 æååé¨ç±»ï¼ééæåé¨ç±»ï¼\n\næ staticä¿®é¥°ï¼å±äºå¤é¨ç±»çå¯¹è±¡ãJDK16ä¹åï¼æååé¨ç±»ä¸­ä¸è½å®ä¹éææåï¼JDK 16å¼å§ä¹å¯ä»¥å®ä¹éææåäºã\n\npublic class Outer {\n    // æååé¨ç±»\n    public class Inner {\n        \n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\næååé¨ç±»åå»ºå¯¹è±¡çæ ¼å¼ï¼æ ¼å¼ï¼å¤é¨ç±»å.åé¨ç±»å å¯¹è±¡å = new å¤é¨ç±»æé å¨.new åé¨ç±»æé å¨(); èä¾ï¼Outer.Inner in = new Outer().new Inner();\n\nï¼åæå¤é¨å¯¹è±¡ï¼ç¶åæè½åå»ºæååé¨ç±»çå¯¹è±¡ï¼\n\nå³äºstatic\n\nstatic ä¿®é¥°çæ¯è¡¨ç¤ºå±äºç±»çï¼èä¸æ¯å±äºå¯¹è±¡çãè¥æ1000ä¸ªå¯¹è±¡ï¼é£ä¹å±äºå¯¹è±¡çé¨åä¹æ¯æ1000ä¸ªï¼è static ä¿®é¥°çé¨ååªæä¸ä¸ªï¼å ä¸ºåªæä¸ä¸ªè¿æ ·çç±»ãæä»¥å¯¹è±¡éé¢æ¯ä¸å­å¨éæçã\n\n> æååé¨ç±»æ¯éæåé¨ç±»æ´å¸¸ç¨ï¼å ä¸ºä»æå¯¹è±¡åå»ºçååæ¬¡åºãä¼ä¸åé¨ï¼å¿é¡»åæè½¦è¿ä¸ªå¯¹è±¡ï¼åæåå¨æºå¯¹è±¡ã\n\næ³¨æ\n\nå¨æååé¨ç±»ä¸­è®¿é®æå¨å¤é¨ç±»çå¯¹è±¡ï¼æ ¼å¼ä¸ºï¼å¤é¨ç±»å.this\n\n\n# 4.3 å±é¨åé¨ç±»\n\né¸¡èè¯­æ³ï¼äºè§£å³å¯\n\n\n# 4.4 *å¿ååé¨ç±»\n\n# (1) æ¦è¿°\n\næ¬è´¨ä¸æ¯ä¸ä¸ªæ²¡æåå­çå±é¨åé¨ç±»ï¼å®ä¹å¨æ¹æ³ä¸­ãä»£ç åä¸­ãç­ã\n\nä½ç¨ï¼æ¹ä¾¿åå»ºå­ç±»å¯¹è±¡ï¼æç»ç®çä¸ºäºç®åä»£ç ç¼åã\n\nç¹å»å±å¼ä»£ç \n\n/**\n      ç®æ ï¼å­¦ä¹ å¿ååé¨ç±»çå½¢å¼åç¹ç¹ã\n */\npublic class Test {\n    public static void main(String[] args) {\n        Animal a = new Animal(){\n            @Override\n            public void run() {\n                System.out.println("èèè·çå~~~");\n            }\n        };\n        a.run();\n    }\n}\n\n//class Tiger extends Animal{\n//    @Override\n//    public void run() {\n//        System.out.println("èèè·çå~~~");\n//    }\n//}\n\nabstract class Animal{\n    public abstract void run();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\nä¸é¢è¿æ®µä»£ç ä¸­è½ç¶ Animal æ¯ä¸ªæ½è±¡ç±»ï¼ä½æ¯å¨ Test ä¸­ä¹å¯ä»¥ç¨ Animal æ¥åå»ºä¸ä¸ªå¿ååé¨ç±»ãå¿ååé¨ç±»ååºæ¥å°±ä¼äº§çä¸ä¸ªå¿ååé¨ç±»çå¯¹è±¡ãå¿ååé¨ç±»çå¯¹è±¡ç±»åç¸å½äºæ¯å½ånewçé£ä¸ªçç±»åçå­ç±»ç±»åãå³äº§ççå¿ååé¨ç±»ç¸å½äºæ³¨éæç Tiger å­ç±»å¯¹è±¡ã\n\nå¿ååé¨ç±»ä¹ä¼äº§ç Class æä»¶ã\n\n# (2) å¸¸è§ä½¿ç¨å½¢å¼\n\næäºå¿ååé¨ç±»ä¹åï¼å¯ä»¥ä¸æ¯å¿é¡»è¦å®ä¹å¦å¤çClasså»å®ç°ç¸åºçæ¥å£äºï¼å¯ä»¥ç´æ¥å¨ new çæ¶åå®ä¹å¿ååé¨ç±»åºæ¥è¿è¡æ¥å£çå®ç°ã\n\nå·ä½çä¸ä¸ªä¾å­\n\n/**\n    ç®æ ï¼ææ¡å¿ååé¨ç±»çä½¿ç¨å½¢å¼ï¼è¯­æ³ï¼\n */\npublic class Test2 {\n    public static void main(String[] args) {\n        Swimming s = new Swimming() {\n            @Override\n            public void swim() {\n                System.out.println("å­¦çå¿«ä¹çèªç±æ³³ðâ");\n            }\n        };\n        go(s);\n\n        System.out.println("--------------");\n\n        Swimming s1 = new Swimming() {\n            @Override\n            public void swim() {\n                System.out.println("èå¸æ³³ðçè´¼å¿«~~~~~");\n            }\n        };\n        go(s1);\n\n        go(new Swimming() {\n            @Override\n            public void swim() {\n                System.out.println("è¿å¨åæ³³ðçè´¼å¿«~~~~~");\n            }\n        });\n\n        System.out.println("--------------");\n\n    /**\n       å­¦ç èå¸ è¿å¨åå¯ä»¥ä¸èµ·åå æ¸¸æ³³æ¯èµ\n     */\n    public static void go(Swimming s){\n        System.out.println("å¼å§ããã");\n        s.swim();\n        System.out.println("ç»æããã");\n    }\n}\n\n\ninterface Swimming{\n    void swim();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\nç»å¸¸ç¨å¿ååé¨ç±»æ¹æ³çå¥åå½¢å¼ï¼å¦ä¸å¾ï¼\n\n\n\nå¥æ¶åç¨å¿ååé¨ç±»\n\nå¼åä¸­ä¸æ¯æä»¬ä¸»å¨å»å®ä¹å¿ååé¨ç±»çï¼èæ¯å«äººéè¦æä»¬åæèæä»¬å¯ä»¥åçæ¶åæä¼ä½¿ç¨ãè½åçæ¶åæè¦åï¼å¯éä¸å¯æ±ã',normalizedContent:'# 1. æ¨¡æ¿æ¹æ³æ¨¡å¼\n\n\n# 1.1 æ½è±¡ç±»\n\nå¦æä¸ä¸ªç±»ä¸­çæä¸ªæ¹æ³çå·ä½å®ç°ä¸è½ç¡®å®ï¼å°±å¯ä»¥ç³ææabstractä¿®é¥°çæ½è±¡æ¹æ³ï¼ä¸è½åæ¹æ³ä½äºï¼ï¼è¿ä¸ªç±»å¿é¡»ç¨abstractä¿®é¥°ï¼è¢«ç§°ä¸ºæ½è±¡ç±»ã\n\n\n\næ½è±¡çä½¿ç¨æ»ç»ä¸æ³¨æäºé¡¹ï¼\n\n * æ½è±¡ç±»å¯ä»¥çè§£æç±»çä¸å®æ´è®¾è®¡å¾ï¼æ¯ç¨æ¥è¢«å­ç±»ç»§æ¿çã\n * ä¸ä¸ªç±»å¦æç»§æ¿äºæ½è±¡ç±»ï¼é£ä¹è¿ä¸ªç±»å¿é¡»éåå®æ½è±¡ç±»çå¨é¨æ½è±¡æ¹æ³ï¼å¦åè¿ä¸ªç±»ä¹å¿é¡»å®ä¹ææ½è±¡ç±»ã\n * æ½è±¡ç±»æ²¡æåå»ºå¯¹è±¡çè½åã\n * æ½è±¡ç±»ä¸­ä¸ä¸å®ææ½è±¡æ¹æ³ï¼ææ½è±¡æ¹æ³çç±»ä¸å®æ¯æ½è±¡ç±»\n\n\n# 1.2 æ¨¡æ¿æ¹æ³\n\næ¨¡æ¿æ¹æ³æ¨¡å¼å®ç°æ­¥éª¤ï¼\n\n * æåè½å®ä¹æä¸ä¸ªæè°çæ¨¡æ¿æ¹æ³ï¼æ¾å¨æ½è±¡ç±»ä¸­ï¼æ¨¡æ¿æ¹æ³ä¸­åªå®ä¹éç¨ä¸è½ç¡®å®çä»£ç ã\n * æ¨¡æ¿æ¹æ³ä¸­ä¸è½å³å®çåè½å®ä¹ææ½è±¡æ¹æ³è®©å·ä½å­ç±»å»å®ç°ã\n\næç¤º\n\næ¨¡æ¿æ¹æ³æä»¬æ¯å»ºè®®ä½¿ç¨finalä¿®é¥°ç,æ¨¡æ¿æ¹æ³æ¯ç»å­ç±»ç´æ¥ä½¿ç¨çï¼ä¸æ¯è®©å­ç±»éåçï¼ ä¸æ¦å­ç±»éåäºæ¨¡æ¿æ¹æ³å°±å¤±æäºã\n\nä¾å¦ï¼ä¸­å­¦çåå°å­¦çåãæçç¸ç¸ãè¿ç¯ä½æï¼ä»ä¿©é¤äºæç« ä¸»ä½é¨åä¸åï¼å«çå°æ¹é½ä¸æ ·ï¼æ­¤æ¶ï¼å¯ä»¥å®ä¹ä¸ä¸ªæ½è±¡ç±»ï¼ç¨ä¸ä¸ªå¬å±çæ¨¡æ¿æ¹æ³æ¥å®ç°ç¸åçé¨åï¼ä¸åçé¨åå¨è¿ä¸ªæ½è±¡ç±»ä¸­å£°æä¸ä¸ªæ½è±¡æ¹æ³ï¼è®©å­ç±»å¨æ­¤å¤æ¥å®ç°ä»ä»¬åå«çåè½ãå¦ä¸å¾ä»£ç æç¤ºï¼\n\n\n\n\n# 2. æ¥å£\n\n\n# 2.1 åºæ¬ç¥è¯\n\næ¥å£ä½ç°äºä¸ç§è§èï¼çº¦æç±»ä¸å®è¦å¹²å¥äºãè§èä¸å®æ¯å¬å¼çã\n\njdk 8 ä¹åæ¥å£ä¸­åªè½ææ½è±¡æ¹æ³åå¸¸éã\n\n * å³é®å­ï¼interface\n\n * æ¥å£çå®ç°ï¼implements æ¥å£1,æ¥å£2,...\n\nå ç§å³ç³»ï¼\n\n * ç±»åç±»çå³ç³»ï¼åç»§æ¿ã\n * ç±»åæ¥å£çå³ç³»ï¼å¤å®ç°ã\n * æ¥å£åæ¥å£çå³ç³»ï¼å¤ç»§æ¿ï¼ä¸ä¸ªæ¥å£å¯ä»¥åæ¶ç»§æ¿å¤ä¸ªæ¥å£ã\n\næ¥å£å¤ç»§æ¿çä½ç¨: è§èåå¹¶ï¼æ´åå¤ä¸ªæ¥å£ä¸ºåä¸ä¸ªæ¥å£ï¼ä¾¿äºå­ç±»å®ç°ãï¼å­ç±»åªéè¦implementsä¸ä¸ªæ¥å£å°±å¯ä»¥äºï¼ä¸ç¨å¾ç´¯èµå°å®ç°å¾å¤ä¸ªæ¥å£ï¼\n\n\n# 2.2 æ¥å£æ°å¢çæ¹æ³\n\njdk8å¼å§åæ°å¢äºé£äºæ¹æ³ ?\n\n * é»è®¤æ¹æ³ï¼defaultä¿®é¥°ï¼å®ç°ç±»å¯¹è±¡è°ç¨ã\n * éææ¹æ³ï¼staticä¿®é¥°ï¼å¿é¡»ç¨å½åæ¥å£åè°ç¨ãä¸è½ç¨å­ç±»è°ç¨éææ¹æ³ã\n * ç§ææ¹æ³ï¼privateä¿®é¥°ï¼jdk9å¼å§ææçï¼åªè½å¨æ¥å£åé¨è¢«è°ç¨ã\n * ä»ä»¬é½ä¼é»è®¤è¢«publicä¿®é¥°ã\n\næ³¨æ\n\njdk8æ°å¢ç3ç§æ¹æ³æä»¬èªå·±å¨å¼åä¸­å¾å°ä½¿ç¨ï¼éå¸¸æ¯javaæºç æ¶åå°çï¼æä»¬éè¦çè§£ãè¯å«è¯­æ³ãæç½è°ç¨å³ç³»å³å¯ã\n\næç¤º\n\nåæ¢æ¨¡åçç¼è¯çæ¬ï¼éæ©jdkçæ¬ï¼file -> project structure -> modules ->language level\n\n\n\n\n# 2.3 ä½¿ç¨æ¥å£çæ³¨æäºé¡¹ï¼é¢è¯ä¸­æ¶åï¼\n\næ¯è¾åçä¸äºè¯­æ³ï¼å®éå¼åä¸­éå¸¸ä¸ç¨ï¼åªæå¨ä¸äºé¢è¯ä¸­å¯è½ä¼æ¶åã\n\n 1. æ¥å£ä¸è½åå»ºå¯¹è±¡\n\n 2. ä¸ä¸ªç±»å®ç°å¤ä¸ªæ¥å£ï¼å¤ä¸ªæ¥å£ä¸­æåæ ·çéææ¹æ³ä¸å²çªã\n\n 3. ä¸ä¸ªç±»ç»§æ¿äºç¶ç±»ï¼åæ¶åå®ç°äºæ¥å£ï¼ç¶ç±»ä¸­åæ¥å£ä¸­æååæ¹æ³ï¼é»è®¤ç¨ç¶ç±»çã\n    \n    ç»§æ¿åªè½å¨å®ç°ä¹ååï¼å³åæäº²ç¸åæå¹²ç¹ãæ¥å£ä¸ºå¹²ç¹ï¼ç»§æ¿ä¸ºäº²ç¸ã\n\n 4. ä¸ä¸ªç±»å®ç°äºå¤ä¸ªæ¥å£ï¼å¤ä¸ªæ¥å£ä¸­å­å¨ååçé»è®¤æ¹æ³ï¼ä¸å²çªï¼è¿ä¸ªç±»éåè¯¥æ¹æ³å³å¯ã\n\n 5. ä¸ä¸ªæ¥å£ç»§æ¿å¤ä¸ªæ¥å£ï¼æ¯æ²¡æé®é¢çï¼å³ä½¿å¤ä¸ªæ¥å£ä¸­æéåçæ¹æ³ï¼ä½å¦æå¤ä¸ªæ¥å£ä¸­å­å¨è§èå²çªåä¸è½å¤ç»§æ¿ã\n\n\n# 3. å¤æ\n\n# (1) ä»ä¹æ¯å¤æ\n\nåç±»åçå¯¹è±¡ï¼æ§è¡åä¸ä¸ªè¡ä¸ºï¼ä¼è¡¨ç°åºä¸åçè¡ä¸ºç¹å¾ã\n\nç¶ç±»çå¼ç¨ç±»åæåå­ç±»çæé ï¼åä¸é åï¼å³ä¸ºå¤æã\n\n# (2) å¤æçå¸¸è§å½¢å¼\n\n * ç¶ç±»ç±»å å¯¹è±¡åç§° = new å­ç±»æé å¨;\n * æ¥å£ å¯¹è±¡åç§° = new å®ç°ç±»æé å¨;\n\nanimal a = new dog();\na.run(); // æ¹æ³è°ç¨ï¼ç¼è¯çå·¦ï¼è¿è¡çå³\nsystem.out.println(a.name); // æ¹æ³è°ç¨ï¼ç¼è¯çå·¦ï¼è¿è¡ä¹çå·¦ï¼å¨ç©åç§°\n\nanimal a1 = new dog();\na1.run();\nsystem.out.println(a1.name); // å¨ç©åç§°\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# (3) å¤æä¸­æåè®¿é®ç¹ç¹\n\n * æ¹æ³è°ç¨ï¼ç¼è¯çå·¦ï¼è¿è¡çå³ã=> å æ­¤å¤æä¸ä¸è½ä½¿ç¨å­ç±»çç¬æåè½ã\n * åéè°ç¨ï¼ç¼è¯çå·¦ï¼è¿è¡ä¹çå·¦ãï¼å¤æä¾§éè¡ä¸ºå¤æï¼\n\nå æ­¤ä¸è¿°ä»£ç çè¾åºç»æé½æ¯å¨ç©åç§°ã\n\n# (4) å¤æçåæ\n\næç»§æ¿/å®ç°å³ç³»ï¼æç¶ç±»å¼ç¨æåå­ç±»å¯¹è±¡ï¼ææ¹æ³éåã\n\n# (5) ä¼å¿\n\n * å¨å¤æå½¢å¼ä¸ï¼å³è¾¹å¯¹è±¡å¯ä»¥å®ç°è§£è¦åï¼ä¾¿äºæ©å±åç»´æ¤ã\n\nanimal a = new dog(); // åç»­ä¸å¡æ´æ¹æ¶åªéè¦ä¿®æ¹æ­¤å¤newçdogå³å¯\na.run(); // åç»­ä¸å¡è¡ä¸ºéå¯¹è±¡èåï¼åç»­ä»£ç æ éä¿®æ¹\n\n\n1\n2\n\n * å®ä¹æ¹æ³çæ¶åï¼ä½¿ç¨ç¶ç±»åä½ä¸ºåæ°ï¼è¯¥æ¹æ³å°±å¯ä»¥æ¥æ¶è¿ç¶ç±»çä¸åå­ç±»å¯¹è±¡ï¼ä½ç°åºå¤æçæ©å±æ§ä¸ä¾¿å©ã\n\n    public static void go(animal a){\n        system.out.println("å¼å§ããã");\n        a.run();\n        system.out.println("ç»æããã");\n    }\n// è¿ä¸ªå½æ°å¯ä»¥ä¼ ä¸é¢ä»£ç ä¸­ça, ä¹å¯ä»¥ä¼ a1\n\n\n1\n2\n3\n4\n5\n6\n\n\n# (6) å¤æä¸å¼ç¨æ°æ®ç±»åçç±»åè½¬æ¢\n\n * èªå¨ç±»åè½¬æ¢ï¼ä»å­å°ç¶)ï¼å­ç±»å¯¹è±¡èµå¼ç»ç¶ç±»ç±»åçåéæåã\n   \n   // èªå¨ç±»åè½¬æ¢\n   animal a = new dog();\n   a.run();\n   //a.lookdoor(); // å¤æä¸æ æ³è°ç¨å­ç±»ç¬æåè½\n   \n   \n   1\n   2\n   3\n   4\n   \n\n * å¼ºå¶ç±»åè½¬æ¢åï¼ä»ç¶å°å­)\n   \n   * æ­¤æ¶å¿é¡»è¿è¡å¼ºå¶ç±»åè½¬æ¢ï¼å­ç±» å¯¹è±¡åé = (å­ç±»)ç¶ç±»ç±»åçåé\n     \n     // å¼ºå¶ç±»åè½¬æ¢:å¯ä»¥å®ç°è°ç¨å­ç±»ç¬æåè½ç\n     dog d = (dog) a;\n     d.lookdoor();\n     \n     \n     1\n     2\n     3\n     \n   \n   * ä½ç¨ï¼å¯ä»¥è§£å³å¤æä¸çå£å¿ï¼å¯ä»¥å®ç°è°ç¨å­ç±»ç¬æçåè½ã\n   \n   * æ³¨æï¼ å¦æè½¬ååçç±»ååå¯¹è±¡çå®ç±»åä¸æ¯åä¸ç§ç±»åï¼é£ä¹å¨è½¬æ¢çæ¶åå°±ä¼åºç°classcastexception\n\nå»ºè®®\n\nå»ºè®®å¼ºå¶è½¬æ¢åï¼åå¤æ­åéæåå¯¹è±¡ççå®ç±»åï¼åå¼ºå¶ç±»åè½¬æ¢ã\n\nåéå instanceof çå®ç±»å å¤æ­å³é®å­å·¦è¾¹çåéæåçå¯¹è±¡ççå®ç±»åï¼æ¯å¦æ¯å³è¾¹çç±»åæèæ¯å¶å­ç±»ç±»åï¼æ¯åè¿åtrue\n\nä»¥ä¸å¤æ­æ¯å¾æå¿è¦çï¼å ä¸ºå¾æå¯è½å¨æ¹æ³åé¨çä¸å°è¿ä¸ªå¯¹è±¡å°åºæ¯å¥ç±»åãå¦ä¸ä»£ç æç¤ºï¼ä¸ç¥éä¼ è¿æ¥ç animal å°åºæ¯çè¿æ¯ä¹é¾ï¼\n\n    public static void go(animal a){\n        system.out.println("é¢å¤~~~");\n        a.run();\n        // ç¬æåè½\n        if(a instanceof tortoise){\n            tortoise t = (tortoise) a;\n            t.layeggs();\n        }else if(a instanceof dog){\n            dog d1 = (dog) a;\n            d1.lookdoor();\n        }\n        system.out.println("ç»æ~~~~");\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 4. åé¨ç±»\n\nåé¨ç±»å°±æ¯å®ä¹å¨ä¸ä¸ªç±»éé¢çç±»\n\n\n# 4.1 éæåé¨ç±»\n\næstaticä¿®é¥°ï¼å±äºå¤é¨ç±»æ¬èº«ãå®çç¹ç¹åä½¿ç¨ä¸æ®éç±»æ¯å®å¨ä¸æ ·çï¼ç±»æçæåå®é½æï¼åªæ¯ä½ç½®å¨å«äººéé¢èå·²ã\n\npublic class outer{\n    // éææååé¨ç±»\n    public static class inner{\n    }\n}\n\n\n1\n2\n3\n4\n5\n\n\néæåé¨ç±»åå»ºå¯¹è±¡çæ ¼å¼ï¼å¤é¨ç±»å.åé¨ç±»å å¯¹è±¡å = new å¤é¨ç±»å.åé¨ç±»æé å¨; èä¾ï¼outer.inner in = new outer.inner();\n\n> è¿ç§è¯­æ³æ¯è¾å°ç¨ï¼ä¸è¬è¿æ¯åå¼å®ä¹ä¸¤ç§ç±»çã\n\n\n# 4.2 æååé¨ç±»ï¼ééæåé¨ç±»ï¼\n\næ staticä¿®é¥°ï¼å±äºå¤é¨ç±»çå¯¹è±¡ãjdk16ä¹åï¼æååé¨ç±»ä¸­ä¸è½å®ä¹éææåï¼jdk 16å¼å§ä¹å¯ä»¥å®ä¹éææåäºã\n\npublic class outer {\n    // æååé¨ç±»\n    public class inner {\n        \n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\næååé¨ç±»åå»ºå¯¹è±¡çæ ¼å¼ï¼æ ¼å¼ï¼å¤é¨ç±»å.åé¨ç±»å å¯¹è±¡å = new å¤é¨ç±»æé å¨.new åé¨ç±»æé å¨(); èä¾ï¼outer.inner in = new outer().new inner();\n\nï¼åæå¤é¨å¯¹è±¡ï¼ç¶åæè½åå»ºæååé¨ç±»çå¯¹è±¡ï¼\n\nå³äºstatic\n\nstatic ä¿®é¥°çæ¯è¡¨ç¤ºå±äºç±»çï¼èä¸æ¯å±äºå¯¹è±¡çãè¥æ1000ä¸ªå¯¹è±¡ï¼é£ä¹å±äºå¯¹è±¡çé¨åä¹æ¯æ1000ä¸ªï¼è static ä¿®é¥°çé¨ååªæä¸ä¸ªï¼å ä¸ºåªæä¸ä¸ªè¿æ ·çç±»ãæä»¥å¯¹è±¡éé¢æ¯ä¸å­å¨éæçã\n\n> æååé¨ç±»æ¯éæåé¨ç±»æ´å¸¸ç¨ï¼å ä¸ºä»æå¯¹è±¡åå»ºçååæ¬¡åºãä¼ä¸åé¨ï¼å¿é¡»åæè½¦è¿ä¸ªå¯¹è±¡ï¼åæåå¨æºå¯¹è±¡ã\n\næ³¨æ\n\nå¨æååé¨ç±»ä¸­è®¿é®æå¨å¤é¨ç±»çå¯¹è±¡ï¼æ ¼å¼ä¸ºï¼å¤é¨ç±»å.this\n\n\n# 4.3 å±é¨åé¨ç±»\n\né¸¡èè¯­æ³ï¼äºè§£å³å¯\n\n\n# 4.4 *å¿ååé¨ç±»\n\n# (1) æ¦è¿°\n\næ¬è´¨ä¸æ¯ä¸ä¸ªæ²¡æåå­çå±é¨åé¨ç±»ï¼å®ä¹å¨æ¹æ³ä¸­ãä»£ç åä¸­ãç­ã\n\nä½ç¨ï¼æ¹ä¾¿åå»ºå­ç±»å¯¹è±¡ï¼æç»ç®çä¸ºäºç®åä»£ç ç¼åã\n\nç¹å»å±å¼ä»£ç \n\n/**\n      ç®æ ï¼å­¦ä¹ å¿ååé¨ç±»çå½¢å¼åç¹ç¹ã\n */\npublic class test {\n    public static void main(string[] args) {\n        animal a = new animal(){\n            @override\n            public void run() {\n                system.out.println("èèè·çå~~~");\n            }\n        };\n        a.run();\n    }\n}\n\n//class tiger extends animal{\n//    @override\n//    public void run() {\n//        system.out.println("èèè·çå~~~");\n//    }\n//}\n\nabstract class animal{\n    public abstract void run();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\nä¸é¢è¿æ®µä»£ç ä¸­è½ç¶ animal æ¯ä¸ªæ½è±¡ç±»ï¼ä½æ¯å¨ test ä¸­ä¹å¯ä»¥ç¨ animal æ¥åå»ºä¸ä¸ªå¿ååé¨ç±»ãå¿ååé¨ç±»ååºæ¥å°±ä¼äº§çä¸ä¸ªå¿ååé¨ç±»çå¯¹è±¡ãå¿ååé¨ç±»çå¯¹è±¡ç±»åç¸å½äºæ¯å½ånewçé£ä¸ªçç±»åçå­ç±»ç±»åãå³äº§ççå¿ååé¨ç±»ç¸å½äºæ³¨éæç tiger å­ç±»å¯¹è±¡ã\n\nå¿ååé¨ç±»ä¹ä¼äº§ç class æä»¶ã\n\n# (2) å¸¸è§ä½¿ç¨å½¢å¼\n\næäºå¿ååé¨ç±»ä¹åï¼å¯ä»¥ä¸æ¯å¿é¡»è¦å®ä¹å¦å¤çclasså»å®ç°ç¸åºçæ¥å£äºï¼å¯ä»¥ç´æ¥å¨ new çæ¶åå®ä¹å¿ååé¨ç±»åºæ¥è¿è¡æ¥å£çå®ç°ã\n\nå·ä½çä¸ä¸ªä¾å­\n\n/**\n    ç®æ ï¼ææ¡å¿ååé¨ç±»çä½¿ç¨å½¢å¼ï¼è¯­æ³ï¼\n */\npublic class test2 {\n    public static void main(string[] args) {\n        swimming s = new swimming() {\n            @override\n            public void swim() {\n                system.out.println("å­¦çå¿«ä¹çèªç±æ³³ðâ");\n            }\n        };\n        go(s);\n\n        system.out.println("--------------");\n\n        swimming s1 = new swimming() {\n            @override\n            public void swim() {\n                system.out.println("èå¸æ³³ðçè´¼å¿«~~~~~");\n            }\n        };\n        go(s1);\n\n        go(new swimming() {\n            @override\n            public void swim() {\n                system.out.println("è¿å¨åæ³³ðçè´¼å¿«~~~~~");\n            }\n        });\n\n        system.out.println("--------------");\n\n    /**\n       å­¦ç èå¸ è¿å¨åå¯ä»¥ä¸èµ·åå æ¸¸æ³³æ¯èµ\n     */\n    public static void go(swimming s){\n        system.out.println("å¼å§ããã");\n        s.swim();\n        system.out.println("ç»æããã");\n    }\n}\n\n\ninterface swimming{\n    void swim();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n\n\nç»å¸¸ç¨å¿ååé¨ç±»æ¹æ³çå¥åå½¢å¼ï¼å¦ä¸å¾ï¼\n\n\n\nå¥æ¶åç¨å¿ååé¨ç±»\n\nå¼åä¸­ä¸æ¯æä»¬ä¸»å¨å»å®ä¹å¿ååé¨ç±»çï¼èæ¯å«äººéè¦æä»¬åæèæä»¬å¯ä»¥åçæ¶åæä¼ä½¿ç¨ãè½åçæ¶åæè¦åï¼å¯éä¸å¯æ±ã',charsets:{cjk:!0},lastUpdated:"2022/03/30, 06:54:33",lastUpdatedTimestamp:1648623273e3},{title:"å¸¸ç¨API",frontmatter:{title:"å¸¸ç¨API",date:"2022-04-02T10:39:16.000Z",permalink:"/pages/e76788/",categories:["å¼å","Java"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/15.%E5%B8%B8%E7%94%A8API.html",relativePath:"å¼å/10.Java/15.å¸¸ç¨API.md",key:"v-f49e53d6",path:"/pages/e76788/",headers:[{level:2,title:"1. Object",slug:"_1-object",normalizedTitle:"1. object",charIndex:12},{level:2,title:"2. Objects",slug:"_2-objects",normalizedTitle:"2. objects",charIndex:543},{level:2,title:"3. StringBuilder",slug:"_3-stringbuilder",normalizedTitle:"3. stringbuilder",charIndex:993},{level:2,title:"4. Math",slug:"_4-math",normalizedTitle:"4. math",charIndex:2516},{level:2,title:"5. System",slug:"_5-system",normalizedTitle:"5. system",charIndex:2582},{level:2,title:"6. BigDecimal",slug:"_6-bigdecimal",normalizedTitle:"6. bigdecimal",charIndex:2620}],headersStr:"1. Object 2. Objects 3. StringBuilder 4. Math 5. System 6. BigDecimal",content:'# å¸¸ç¨API\n\n\n# 1. Object\n\n * toStringæ¹æ³\n   \n   // ç´æ¥è¾åºå¯¹è±¡åéï¼é»è®¤å¯ä»¥çç¥toStringè°ç¨ä¸åç\n   System.out.println(s);\n   // åä¸é¢è¿å¥è¯åä¹\n   System.out.println(s.toString());\n   \n   \n   1\n   2\n   3\n   4\n   \n   \n   toString å­å¨çæä¹\n   \n   ç¶ç±»toString()æ¹æ³å­å¨çæä¹å°±æ¯ä¸ºäºè¢«å­ç±»éåï¼ä»¥ä¾¿è¿åå¯¹è±¡çåå®¹ä¿¡æ¯ï¼èä¸æ¯å°åä¿¡æ¯ï¼ï¼\n   \n   å¿«æ·æ¹å¼ï¼\n   \n   è¾å¥tosï¼ IDEA ä¼èªå¨æç¤º Generate èªå¨çæè¿ååå®¹çä¿¡æ¯ã\n\n * equalsæ¹æ³\n   \n   ç´æ¥æ¯è¾ä¸¤ä¸ªå¯¹è±¡çå°åæ¯å¦ç¸åå®å¨å¯ä»¥ç¨â==âæ¿ä»£equalsã\n   \n   System.out.println(s1.equals(s2));\n   // æ­¤æ¶s1è¥==nullï¼ä¼æ¥éç©ºæéå¼å¸¸ã\n   \n   \n   1\n   2\n   \n   \n   equals å­å¨çæä¹\n   \n   ç¶ç±»equalsæ¹æ³å­å¨çæä¹å°±æ¯ä¸ºäºè¢«å­ç±»éåï¼ä»¥ä¾¿å­ç±»èªå·±æ¥å®å¶æ¯è¾è§åã\n\n\n# 2. Objects\n\n * equals æ¹æ³\n   \n   æ¯ Object API ä¸­ç equals æ¹æ³æ´å®å¨ï¼ä¸ä¼æç©ºæéå¼å¸¸ã\n   \n   System.out.println(Objects.equals(s1, s2));\n   \n   \n   1\n   \n   \n   ä½æ­¤æ¶è¿æ¯å¾éå Object ä¸­ç equals æ¹æ³ï¼å ä¸ºæ­¤æ¶ Objects æºç ä¸­è°ç¨ç equals æ¹æ³è¿æ¯éåçé£ä¸ªæ¹æ³ã\n   \n   å¯¹è±¡è¿è¡åå®¹æ¯è¾çæ¶åå»ºè®®ä½¿ç¨ä»ä¹ï¼ä¸ºä»ä¹ï¼\n   \n   å»ºè®®ä½¿ç¨ Objects æä¾ç equals æ¹æ³ãæ¯è¾çç»ææ¯ä¸æ ·çï¼ä½æ¯æ´å®å¨ã\n\n * isNull æ¹æ³\n   \n   System.out.println(Objects.isNull(s1)); \n   System.out.println(s1 == null); \n   \n   \n   1\n   2\n   \n   \n   è¿ä¿©åæ³å®å¨ä¸æ ·ï¼ä½æ¯è°ç¨ API æ´ä¸ä¸ã\n\n\n# 3. StringBuilder\n\nStringBuilder æ¯ä¸ªå¯åçå­ç¬¦ä¸²ç±»ï¼å¯ä»¥æå®çæä¸ä¸ªå¯¹è±¡å®¹å¨ã\n\nä½ç¨ï¼æé«å­ç¬¦ä¸²çæä½æçï¼å¦æ¼æ¥ãä¿®æ¹ç­ã\n\nå¸¸ç¨æ¹æ³ï¼\n\n * append(ä»»æç±»å)\n   \n   // æ¯æé¾å¼ç¼ç¨\n   sb1.append("a").append("b").append("c").append("æç±ä½ ä¸­å½");\n   // åè½¬+appendä¹å¯ä»¥\n   sb1.reverse().append("110");\n   \n   \n   1\n   2\n   3\n   4\n   \n   \n   ä»¥ä¸æä½é½å¯è¡æ¯å ä¸ºappendåreverseé½æ¯è¿å this è¿ä¸ªå½åçå¯¹è±¡ã\n\n * reverse()\n\n * length()\n\n * toString()\n   \n   å¯ç¨æ¥æ StringBuild æ¢å¤æ String ç±»åãStringBuild å·²éåäº toString æ¹æ³ã\n   \n   // ä¾1\n   String rs = sb2.toString();\n   check(rs);\n   public static void check(String data) {\n       System.out.println(data);\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   \n   \n   // ä¾2\n   /**\n      1ãå®ä¹æ¹æ³æ¥æ¶ä»»ææ´åæ°ç»ï¼è¿åæ°ç»åå®¹æ ¼å¼\n    */\n   public static String toString(int[] arr){\n      if(arr != null){\n           // 2ãå¼å§æ¼æ¥åå®¹ã\n          StringBuilder sb = new StringBuilder("[");\n          for (int i = 0; i < arr.length; i++) {\n              sb.append(arr[i] ).append(i == arr.length - 1 ? "" : ", ");\n          }\n          sb.append("]");\n          return sb.toString(); // è½¬æStringç±»åè¿åå»\n      }else {\n          return null;\n      }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   \n\nStringBuilder å String\n\nStringBuilderåªæ¯æ¼æ¥å­ç¬¦ä¸²çææ®µï¼æçå¥½ï¼æç»çç®çè¿æ¯è¦æ¢å¤æStringç±»åã\n\nå¹¶ä¸ String ç±»åå StringBuild ä¸åï¼String ç±»åçåæ°ä¸è½ç´æ¥ä¼  StringBuild å¯¹è±¡ãString æ¯ä¸å¯åå­ç¬¦ä¸²ï¼è StringBuilder æ¯ä¸ªå¯åçå­ç¬¦ä¸²ç±»ã\n\nä¸ºä»ä¹æ¼æ¥ãåè½¬å­ç¬¦ä¸²å»ºè®®ä½¿ç¨StringBuilder?\n\nString ï¼åå®¹æ¯ä¸å¯åçãæ¼æ¥å­ç¬¦ä¸²æ§è½å·®ã StringBuilderï¼åå®¹æ¯å¯åçãæ¼æ¥å­ç¬¦ä¸²æ§è½å¥½ãä»£ç ä¼éã\n\nå®ä¹å­ç¬¦ä¸²ä½¿ç¨String æ¼æ¥ãä¿®æ¹ç­æä½å­ç¬¦ä¸²ä½¿ç¨StringBuilder\n\nStringBuilder é«æçåå ï¼å¦ä¸åçå¾ï¼\n\n\n\n\n\n\n# 4. Math\n\næ¯ä¸ªå·¥å·ç±»ï¼æ²¡æå¬å¼æé å¨ãå¶ä¸­çæ¹æ³é½æ¯éæçï¼ç´æ¥ç¨ç±»åè°ç¨å³å¯ï¼ä¸éè¦åå»ºå¯¹è±¡ï¼å³ä¸è½å®ä¾åã\n\n\n\n\n# 5. System\n\næ¯ä¸ªå·¥å·ç±»ï¼ä¸è½å®ä¾åãç´æ¥ç¨ç±»åè°ç¨ã\n\n\n\n\n# 6. BigDecimal\n\nç¨äºè§£å³æµ®ç¹åè¿ç®ç²¾åº¦å¤±ççé®é¢ã\n\nå®éå¼åä¸­å¹¶ä¸åå»º BigDecimal å¯¹è±¡ï¼èæ¯è°ç¨æ¹æ³æ¥ä½¿å¶æä¸º BigDecimal å¯¹è±¡ãå¦ï¼public static BigDecimal valueOf(double val): åè£æµ®ç¹æ°æä¸ºBigDecimalå¯¹è±¡ãæèä¼ è¿æ¥å­ç¬¦ä¸²ç±»åçå¼ãç´æ¥ç¨æé å¨å¯è½è¿æ¯ä¼æå¤±ç²¾åº¦ã\n\ndouble å BigDecimal\n\ndouble æ¯ç®çï¼BigDecimal æ¯ææ®µã\n\ndouble rs = c1.doubleValue();\n\n\n1\n\n\nBigDecimal æ¯ä¸å®è¦ç²¾åº¦è¿ç®çï¼é¤ä¸å°½çä¼å´©ï¼å æ­¤éè¦æå®çå°æ°ä½æ°ã',normalizedContent:'# å¸¸ç¨api\n\n\n# 1. object\n\n * tostringæ¹æ³\n   \n   // ç´æ¥è¾åºå¯¹è±¡åéï¼é»è®¤å¯ä»¥çç¥tostringè°ç¨ä¸åç\n   system.out.println(s);\n   // åä¸é¢è¿å¥è¯åä¹\n   system.out.println(s.tostring());\n   \n   \n   1\n   2\n   3\n   4\n   \n   \n   tostring å­å¨çæä¹\n   \n   ç¶ç±»tostring()æ¹æ³å­å¨çæä¹å°±æ¯ä¸ºäºè¢«å­ç±»éåï¼ä»¥ä¾¿è¿åå¯¹è±¡çåå®¹ä¿¡æ¯ï¼èä¸æ¯å°åä¿¡æ¯ï¼ï¼\n   \n   å¿«æ·æ¹å¼ï¼\n   \n   è¾å¥tosï¼ idea ä¼èªå¨æç¤º generate èªå¨çæè¿ååå®¹çä¿¡æ¯ã\n\n * equalsæ¹æ³\n   \n   ç´æ¥æ¯è¾ä¸¤ä¸ªå¯¹è±¡çå°åæ¯å¦ç¸åå®å¨å¯ä»¥ç¨â==âæ¿ä»£equalsã\n   \n   system.out.println(s1.equals(s2));\n   // æ­¤æ¶s1è¥==nullï¼ä¼æ¥éç©ºæéå¼å¸¸ã\n   \n   \n   1\n   2\n   \n   \n   equals å­å¨çæä¹\n   \n   ç¶ç±»equalsæ¹æ³å­å¨çæä¹å°±æ¯ä¸ºäºè¢«å­ç±»éåï¼ä»¥ä¾¿å­ç±»èªå·±æ¥å®å¶æ¯è¾è§åã\n\n\n# 2. objects\n\n * equals æ¹æ³\n   \n   æ¯ object api ä¸­ç equals æ¹æ³æ´å®å¨ï¼ä¸ä¼æç©ºæéå¼å¸¸ã\n   \n   system.out.println(objects.equals(s1, s2));\n   \n   \n   1\n   \n   \n   ä½æ­¤æ¶è¿æ¯å¾éå object ä¸­ç equals æ¹æ³ï¼å ä¸ºæ­¤æ¶ objects æºç ä¸­è°ç¨ç equals æ¹æ³è¿æ¯éåçé£ä¸ªæ¹æ³ã\n   \n   å¯¹è±¡è¿è¡åå®¹æ¯è¾çæ¶åå»ºè®®ä½¿ç¨ä»ä¹ï¼ä¸ºä»ä¹ï¼\n   \n   å»ºè®®ä½¿ç¨ objects æä¾ç equals æ¹æ³ãæ¯è¾çç»ææ¯ä¸æ ·çï¼ä½æ¯æ´å®å¨ã\n\n * isnull æ¹æ³\n   \n   system.out.println(objects.isnull(s1)); \n   system.out.println(s1 == null); \n   \n   \n   1\n   2\n   \n   \n   è¿ä¿©åæ³å®å¨ä¸æ ·ï¼ä½æ¯è°ç¨ api æ´ä¸ä¸ã\n\n\n# 3. stringbuilder\n\nstringbuilder æ¯ä¸ªå¯åçå­ç¬¦ä¸²ç±»ï¼å¯ä»¥æå®çæä¸ä¸ªå¯¹è±¡å®¹å¨ã\n\nä½ç¨ï¼æé«å­ç¬¦ä¸²çæä½æçï¼å¦æ¼æ¥ãä¿®æ¹ç­ã\n\nå¸¸ç¨æ¹æ³ï¼\n\n * append(ä»»æç±»å)\n   \n   // æ¯æé¾å¼ç¼ç¨\n   sb1.append("a").append("b").append("c").append("æç±ä½ ä¸­å½");\n   // åè½¬+appendä¹å¯ä»¥\n   sb1.reverse().append("110");\n   \n   \n   1\n   2\n   3\n   4\n   \n   \n   ä»¥ä¸æä½é½å¯è¡æ¯å ä¸ºappendåreverseé½æ¯è¿å this è¿ä¸ªå½åçå¯¹è±¡ã\n\n * reverse()\n\n * length()\n\n * tostring()\n   \n   å¯ç¨æ¥æ stringbuild æ¢å¤æ string ç±»åãstringbuild å·²éåäº tostring æ¹æ³ã\n   \n   // ä¾1\n   string rs = sb2.tostring();\n   check(rs);\n   public static void check(string data) {\n       system.out.println(data);\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   \n   \n   // ä¾2\n   /**\n      1ãå®ä¹æ¹æ³æ¥æ¶ä»»ææ´åæ°ç»ï¼è¿åæ°ç»åå®¹æ ¼å¼\n    */\n   public static string tostring(int[] arr){\n      if(arr != null){\n           // 2ãå¼å§æ¼æ¥åå®¹ã\n          stringbuilder sb = new stringbuilder("[");\n          for (int i = 0; i < arr.length; i++) {\n              sb.append(arr[i] ).append(i == arr.length - 1 ? "" : ", ");\n          }\n          sb.append("]");\n          return sb.tostring(); // è½¬æstringç±»åè¿åå»\n      }else {\n          return null;\n      }\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   \n\nstringbuilder å string\n\nstringbuilderåªæ¯æ¼æ¥å­ç¬¦ä¸²çææ®µï¼æçå¥½ï¼æç»çç®çè¿æ¯è¦æ¢å¤æstringç±»åã\n\nå¹¶ä¸ string ç±»åå stringbuild ä¸åï¼string ç±»åçåæ°ä¸è½ç´æ¥ä¼  stringbuild å¯¹è±¡ãstring æ¯ä¸å¯åå­ç¬¦ä¸²ï¼è stringbuilder æ¯ä¸ªå¯åçå­ç¬¦ä¸²ç±»ã\n\nä¸ºä»ä¹æ¼æ¥ãåè½¬å­ç¬¦ä¸²å»ºè®®ä½¿ç¨stringbuilder?\n\nstring ï¼åå®¹æ¯ä¸å¯åçãæ¼æ¥å­ç¬¦ä¸²æ§è½å·®ã stringbuilderï¼åå®¹æ¯å¯åçãæ¼æ¥å­ç¬¦ä¸²æ§è½å¥½ãä»£ç ä¼éã\n\nå®ä¹å­ç¬¦ä¸²ä½¿ç¨string æ¼æ¥ãä¿®æ¹ç­æä½å­ç¬¦ä¸²ä½¿ç¨stringbuilder\n\nstringbuilder é«æçåå ï¼å¦ä¸åçå¾ï¼\n\n\n\n\n\n\n# 4. math\n\næ¯ä¸ªå·¥å·ç±»ï¼æ²¡æå¬å¼æé å¨ãå¶ä¸­çæ¹æ³é½æ¯éæçï¼ç´æ¥ç¨ç±»åè°ç¨å³å¯ï¼ä¸éè¦åå»ºå¯¹è±¡ï¼å³ä¸è½å®ä¾åã\n\n\n\n\n# 5. system\n\næ¯ä¸ªå·¥å·ç±»ï¼ä¸è½å®ä¾åãç´æ¥ç¨ç±»åè°ç¨ã\n\n\n\n\n# 6. bigdecimal\n\nç¨äºè§£å³æµ®ç¹åè¿ç®ç²¾åº¦å¤±ççé®é¢ã\n\nå®éå¼åä¸­å¹¶ä¸åå»º bigdecimal å¯¹è±¡ï¼èæ¯è°ç¨æ¹æ³æ¥ä½¿å¶æä¸º bigdecimal å¯¹è±¡ãå¦ï¼public static bigdecimal valueof(double val): åè£æµ®ç¹æ°æä¸ºbigdecimalå¯¹è±¡ãæèä¼ è¿æ¥å­ç¬¦ä¸²ç±»åçå¼ãç´æ¥ç¨æé å¨å¯è½è¿æ¯ä¼æå¤±ç²¾åº¦ã\n\ndouble å bigdecimal\n\ndouble æ¯ç®çï¼bigdecimal æ¯ææ®µã\n\ndouble rs = c1.doublevalue();\n\n\n1\n\n\nbigdecimal æ¯ä¸å®è¦ç²¾åº¦è¿ç®çï¼é¤ä¸å°½çä¼å´©ï¼å æ­¤éè¦æå®çå°æ°ä½æ°ã',charsets:{cjk:!0},lastUpdated:"2022/04/07, 08:01:03",lastUpdatedTimestamp:1649318463e3},{title:"å¹¶åãå¹¶è¡ãå¼æ­¥ãåæ­¥ï¼æå­ï¼",frontmatter:{title:"å¹¶åãå¹¶è¡ãå¼æ­¥ãåæ­¥ï¼æå­ï¼",date:"2022-04-07T15:21:00.000Z",permalink:"/pages/5de326/",categories:["å¼å","Java"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/20.%E5%B9%B6%E5%8F%91%E3%80%81%E5%B9%B6%E8%A1%8C%E3%80%81%E5%BC%82%E6%AD%A5%E3%80%81%E5%90%8C%E6%AD%A5%EF%BC%88%E6%9A%82%E5%AD%98%EF%BC%89.html",relativePath:"å¼å/10.Java/20.å¹¶åãå¹¶è¡ãå¼æ­¥ãåæ­¥ï¼æå­ï¼.md",key:"v-00a73f02",path:"/pages/5de326/",headers:[{level:2,title:"1. å¹¶å VS. å¹¶è¡ï¼parallelismï¼",slug:"_1-å¹¶å-vs-å¹¶è¡-parallelism",normalizedTitle:"1. å¹¶å vs. å¹¶è¡ï¼parallelismï¼",charIndex:2},{level:2,title:"2. åæ­¥ VS. å¼æ­¥",slug:"_2-åæ­¥-vs-å¼æ­¥",normalizedTitle:"2. åæ­¥ vs. å¼æ­¥",charIndex:132},{level:3,title:"2.1 å¤çº¿ç¨ç¼ç¨ï¼Multi-threadingï¼ VS. ï¼åçº¿ç¨ï¼å¼æ­¥ç¼ç¨ï¼Asynchronous Programmingï¼",slug:"_2-1-å¤çº¿ç¨ç¼ç¨-multi-threading-vs-åçº¿ç¨-å¼æ­¥ç¼ç¨-asynchronous-programming",normalizedTitle:"2.1 å¤çº¿ç¨ç¼ç¨ï¼multi-threadingï¼ vs. ï¼åçº¿ç¨ï¼å¼æ­¥ç¼ç¨ï¼asynchronous programmingï¼",charIndex:388},{level:3,title:"2.2 å¼æ­¥ç¼ç¨",slug:"_2-2-å¼æ­¥ç¼ç¨",normalizedTitle:"2.2 å¼æ­¥ç¼ç¨",charIndex:631}],headersStr:"1. å¹¶å VS. å¹¶è¡ï¼parallelismï¼ 2. åæ­¥ VS. å¼æ­¥ 2.1 å¤çº¿ç¨ç¼ç¨ï¼Multi-threadingï¼ VS. ï¼åçº¿ç¨ï¼å¼æ­¥ç¼ç¨ï¼Asynchronous Programmingï¼ 2.2 å¼æ­¥ç¼ç¨",content:'# 1. å¹¶å VS. å¹¶è¡ï¼parallelismï¼\n\nå¹¶ååçº¯ä»£è¡¨è®¡ç®æºè½åæ¶æ§è¡å¤é¡¹ä»»å¡ï¼å·ä½æä¹å®ç°çä¼æå¤ç§å½¢å¼ã\n\n * åæ ¸ï¼åéæ¶é´çï¼è¿ç¨æçº¿ç¨è¿è¡ä¸ä¸æåæ¢ï¼å®ç°å¹¶åã\n * å¤æ ¸ï¼å¤æ ¸å¤çå¨ä¸ï¼å¯ä»¥å¨ä¸åçæ ¸å¿ä¸çæ­£å¹¶è¡å°æ§è¡ä»»å¡ã\n\n\n# 2. åæ­¥ VS. å¼æ­¥\n\n * åæ­¥ï¼å¿é¡»ç­åä¸ä¸ªä»»å¡å®æ¯ä¹åæè½å¼å§ä¸ä¸ä¸ªä»»å¡ï¼æ²¡æå¹¶åãå¹¶è¡çæ¦å¿µã\n\n * å¼æ­¥ï¼ä¸åä»»å¡ä¹é´ä¸äºç¸ç­å¾ï¼ç´å°ä»»å¡å®æä¹åæåæ¥éç¥ä½ ã\n   \n   å¸åå®ç°æ¹å¼ï¼å¤çº¿ç¨ã\n   \n   * è¥å¨å¤æ ¸å¿ä¸è¿è¡ï¼åä¸åçº¿ç¨åéå°ä¸åçæ ¸å¿ä¸è¿è¡ã\n   * è¥å¨åæ ¸å¿ä¸è¿è¡ï¼æéè¿è®¾ç½®äº²ååï¼Affinityï¼å¼ºå¶å°çº¿ç¨ç»å®å°æä¸ªæ ¸å¿ä¸ï¼åä¼éè¿åéæ¶é´ççæ¹å¼è¿è¡å¹¶åå°æ§è¡åä¸ªçº¿ç¨ã\n   \n   python ç asyncio å°±æ¯åççå¼æ­¥ç¼ç¨æ¹å¼ï¼\n\n\n# 2.1 å¤çº¿ç¨ç¼ç¨ï¼Multi-threadingï¼ VS. ï¼åçº¿ç¨ï¼å¼æ­¥ç¼ç¨ï¼Asynchronous Programmingï¼\n\n * å¤çº¿ç¨ç¼ç¨ï¼éåè®¡ç®éå¯éçåºç¨ãè§é¢ãå¾åå¤çãç§å­¦è®¡ç®ç­ï¼ä¸è®© CPU æ ¸å¿æ¶èå¨æ ççç­å¾ä¸ã\n\n\n\n * å¼æ­¥ç¼ç¨ï¼I/Oå¯éåç¨åºåºç¨å¼æ­¥ç¼ç¨ã\n   \n   ç¨å¤çº¿ç¨ç¼ç¨å®¹æé æèµæºæµªè´¹ï¼åä¸ªçº¿ç¨é½ä¼å¤äºç­å¾ I/O æä½çè¿ç¨ä¸­ï¼çº¿ç¨èªèº«ä¼å ç¨é¢å¤åå­ï¼å¹¶ä¸çº¿ç¨ä¹é´çåæ¢ä¼æé¢å¤çå¼éï¼ä»¥åçº¿ç¨ä¹é´çèµæºç«äºé®é¢ã\n\n\n\n\n# 2.2 å¼æ­¥ç¼ç¨\n\nä¸åä»»å¡ä¹é´ä¸äºç¸ç­å¾ï¼ç´å°ä»»å¡å®æä¹åæåæ¥éç¥ä½ ï¼éå¸¸ä»¥åè°å½æ°ï¼callbackï¼çæ¹å¼æ¥éç¥ä½ ãè¿ç§ç¼ç¨æ¨¡å¼é¿åäºç¨åºçé»å¡ï¼æé«äº CPU æ§è¡æçãå°¤å¶éç¨ I/O å¯éãæä½æ°æ®åºãè®¿é®æä»¶ç­æä½ã\n\n * Promise (æ¿è¯º) ï¼ å¯æè¿ä¸ªå»è¿ä¸ªè¯·æ±ä¼å¨æªæ¥æä¸ä¸ªæ¶å»è¿å\n   \n   è§£å³äºåè°å°ç±çé®é¢\n   \n   ä¾å¦ï¼ fetch åæå¡å¨è¯·æ±ï¼è¿åPromiseå¯¹è±¡,æ¸²æåç«¯ï¼å¦æå¯ä»¥ä½¿ç¨ then è¿è¡æ¥åè¿åçç»æ\n\nfetch("https://www.woshishuaige.om").then((res)=>{\n\n})\n\n\n1\n2\n3\n\n\n * async / await\n   \n   ç¨ async æ è®°ä¸ä¸ªå½æ°ä¸ºå¼æ­¥å½æ°ï¼å¨è¿æ ·çå½æ°ä¸­ï¼å¯ä»¥ç¨ await æ¥è°ç¨å¶ä»çå¼æ­¥å½æ°ï¼è¿æ ·é¿åäºç¨ Promise ï¼ ä»¥åä¸ç³»åç then ç­ç­ã\n   \n   ä¸è½å¨å¨å±åæ®éå½æ°ä¸­ä½¿ç¨ await å³é®å­ï¼åªè½è¢«åºç¨å¼æ­¥ï¼æä»¥æ³è¦ä½¿ç¨ await å°±å¿é¡»ç¨ async ä¿®é¥°å½æ°ã',normalizedContent:'# 1. å¹¶å vs. å¹¶è¡ï¼parallelismï¼\n\nå¹¶ååçº¯ä»£è¡¨è®¡ç®æºè½åæ¶æ§è¡å¤é¡¹ä»»å¡ï¼å·ä½æä¹å®ç°çä¼æå¤ç§å½¢å¼ã\n\n * åæ ¸ï¼åéæ¶é´çï¼è¿ç¨æçº¿ç¨è¿è¡ä¸ä¸æåæ¢ï¼å®ç°å¹¶åã\n * å¤æ ¸ï¼å¤æ ¸å¤çå¨ä¸ï¼å¯ä»¥å¨ä¸åçæ ¸å¿ä¸çæ­£å¹¶è¡å°æ§è¡ä»»å¡ã\n\n\n# 2. åæ­¥ vs. å¼æ­¥\n\n * åæ­¥ï¼å¿é¡»ç­åä¸ä¸ªä»»å¡å®æ¯ä¹åæè½å¼å§ä¸ä¸ä¸ªä»»å¡ï¼æ²¡æå¹¶åãå¹¶è¡çæ¦å¿µã\n\n * å¼æ­¥ï¼ä¸åä»»å¡ä¹é´ä¸äºç¸ç­å¾ï¼ç´å°ä»»å¡å®æä¹åæåæ¥éç¥ä½ ã\n   \n   å¸åå®ç°æ¹å¼ï¼å¤çº¿ç¨ã\n   \n   * è¥å¨å¤æ ¸å¿ä¸è¿è¡ï¼åä¸åçº¿ç¨åéå°ä¸åçæ ¸å¿ä¸è¿è¡ã\n   * è¥å¨åæ ¸å¿ä¸è¿è¡ï¼æéè¿è®¾ç½®äº²ååï¼affinityï¼å¼ºå¶å°çº¿ç¨ç»å®å°æä¸ªæ ¸å¿ä¸ï¼åä¼éè¿åéæ¶é´ççæ¹å¼è¿è¡å¹¶åå°æ§è¡åä¸ªçº¿ç¨ã\n   \n   python ç asyncio å°±æ¯åççå¼æ­¥ç¼ç¨æ¹å¼ï¼\n\n\n# 2.1 å¤çº¿ç¨ç¼ç¨ï¼multi-threadingï¼ vs. ï¼åçº¿ç¨ï¼å¼æ­¥ç¼ç¨ï¼asynchronous programmingï¼\n\n * å¤çº¿ç¨ç¼ç¨ï¼éåè®¡ç®éå¯éçåºç¨ãè§é¢ãå¾åå¤çãç§å­¦è®¡ç®ç­ï¼ä¸è®© cpu æ ¸å¿æ¶èå¨æ ççç­å¾ä¸ã\n\n\n\n * å¼æ­¥ç¼ç¨ï¼i/oå¯éåç¨åºåºç¨å¼æ­¥ç¼ç¨ã\n   \n   ç¨å¤çº¿ç¨ç¼ç¨å®¹æé æèµæºæµªè´¹ï¼åä¸ªçº¿ç¨é½ä¼å¤äºç­å¾ i/o æä½çè¿ç¨ä¸­ï¼çº¿ç¨èªèº«ä¼å ç¨é¢å¤åå­ï¼å¹¶ä¸çº¿ç¨ä¹é´çåæ¢ä¼æé¢å¤çå¼éï¼ä»¥åçº¿ç¨ä¹é´çèµæºç«äºé®é¢ã\n\n\n\n\n# 2.2 å¼æ­¥ç¼ç¨\n\nä¸åä»»å¡ä¹é´ä¸äºç¸ç­å¾ï¼ç´å°ä»»å¡å®æä¹åæåæ¥éç¥ä½ ï¼éå¸¸ä»¥åè°å½æ°ï¼callbackï¼çæ¹å¼æ¥éç¥ä½ ãè¿ç§ç¼ç¨æ¨¡å¼é¿åäºç¨åºçé»å¡ï¼æé«äº cpu æ§è¡æçãå°¤å¶éç¨ i/o å¯éãæä½æ°æ®åºãè®¿é®æä»¶ç­æä½ã\n\n * promise (æ¿è¯º) ï¼ å¯æè¿ä¸ªå»è¿ä¸ªè¯·æ±ä¼å¨æªæ¥æä¸ä¸ªæ¶å»è¿å\n   \n   è§£å³äºåè°å°ç±çé®é¢\n   \n   ä¾å¦ï¼ fetch åæå¡å¨è¯·æ±ï¼è¿åpromiseå¯¹è±¡,æ¸²æåç«¯ï¼å¦æå¯ä»¥ä½¿ç¨ then è¿è¡æ¥åè¿åçç»æ\n\nfetch("https://www.woshishuaige.om").then((res)=>{\n\n})\n\n\n1\n2\n3\n\n\n * async / await\n   \n   ç¨ async æ è®°ä¸ä¸ªå½æ°ä¸ºå¼æ­¥å½æ°ï¼å¨è¿æ ·çå½æ°ä¸­ï¼å¯ä»¥ç¨ await æ¥è°ç¨å¶ä»çå¼æ­¥å½æ°ï¼è¿æ ·é¿åäºç¨ promise ï¼ ä»¥åä¸ç³»åç then ç­ç­ã\n   \n   ä¸è½å¨å¨å±åæ®éå½æ°ä¸­ä½¿ç¨ await å³é®å­ï¼åªè½è¢«åºç¨å¼æ­¥ï¼æä»¥æ³è¦ä½¿ç¨ await å°±å¿é¡»ç¨ async ä¿®é¥°å½æ°ã',charsets:{cjk:!0},lastUpdated:"2023/05/17, 13:14:17",lastUpdatedTimestamp:1684329257e3},{title:"Springä¾èµæ³¨å¥åç",frontmatter:{title:"Springä¾èµæ³¨å¥åç",date:"2023-04-22T16:11:16.000Z",permalink:"/pages/0fc51e/",categories:["å¼å","Java","ãSpring Boot è¿é¶ï¼éå¤©æ°ï¼ã-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/10.Java/30.%E3%80%8ASpring%20Boot%20%E8%BF%9B%E9%98%B6-%E9%83%91%E5%A4%A9%E6%B0%91%E3%80%8B/05.Spring%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%9A%84%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.html",relativePath:"å¼å/10.Java/30.ãSpring Boot è¿é¶-éå¤©æ°ã/05.Springä¾èµæ³¨å¥çåçåæ.md",key:"v-cafc5bfe",path:"/pages/0fc51e/",headers:[{level:2,title:"1. åºæ¬æ¦å¿µ",slug:"_1-åºæ¬æ¦å¿µ",normalizedTitle:"1. åºæ¬æ¦å¿µ",charIndex:2},{level:2,title:"2. Springä¾èµæ³¨å¥åçåæ",slug:"_2-springä¾èµæ³¨å¥åçåæ",normalizedTitle:"2. springä¾èµæ³¨å¥åçåæ",charIndex:88},{level:3,title:"2.1 Bean çæ³¨å",slug:"_2-1-bean-çæ³¨å",normalizedTitle:"2.1 bean çæ³¨å",charIndex:338},{level:3,title:"2.2 Bean çå®ä¾å",slug:"_2-2-bean-çå®ä¾å",normalizedTitle:"2.2 bean çå®ä¾å",charIndex:1861},{level:2,title:"3. Spring å¾ªç¯ä¾èµåæ",slug:"_3-spring-å¾ªç¯ä¾èµåæ",normalizedTitle:"3. spring å¾ªç¯ä¾èµåæ",charIndex:3600},{level:3,title:"3.1 ä¸çº§ç¼å­ç»æ",slug:"_3-1-ä¸çº§ç¼å­ç»æ",normalizedTitle:"3.1 ä¸çº§ç¼å­ç»æ",charIndex:3829},{level:3,title:"3.2 ä¸çº§ç¼å­å¦ä½åæ¥ä½ç¨çï¼",slug:"_3-2-ä¸çº§ç¼å­å¦ä½åæ¥ä½ç¨ç",normalizedTitle:"3.2 ä¸çº§ç¼å­å¦ä½åæ¥ä½ç¨çï¼",charIndex:4144},{level:3,title:"3.3 å¾ªç¯ä¾èµè§£å³æ¹æ¡",slug:"_3-3-å¾ªç¯ä¾èµè§£å³æ¹æ¡",normalizedTitle:"3.3 å¾ªç¯ä¾èµè§£å³æ¹æ¡",charIndex:5609}],headersStr:"1. åºæ¬æ¦å¿µ 2. Springä¾èµæ³¨å¥åçåæ 2.1 Bean çæ³¨å 2.2 Bean çå®ä¾å 3. Spring å¾ªç¯ä¾èµåæ 3.1 ä¸çº§ç¼å­ç»æ 3.2 ä¸çº§ç¼å­å¦ä½åæ¥ä½ç¨çï¼ 3.3 å¾ªç¯ä¾èµè§£å³æ¹æ¡",content:"# 1. åºæ¬æ¦å¿µ\n\nä¾èµæ³¨å¥ï¼Dependency Injection, DIï¼ï¼å¨ç³»ç»è¿è¡æ¶åºäºæä¸ªå¯¹è±¡çä½¿ç¨éæ±ï¼å¨ææä¾ä»æä¾èµçå¶ä»å¯¹è±¡ï¼éè¿ä¾èµæ³¨å¥å®ç°ã\n\n\n# 2. Springä¾èµæ³¨å¥åçåæ\n\nSpring ä¸­æ¶åå¤§éç±»åç»ä»¶ä¹é´çåä½ä¸äº¤äºãåçä¸è®²ï¼ä»»ä½ä¸ä¸ªæ¡æ¶é½å­å¨ä¸æ¡æ ¸å¿æ§è¡æµç¨ï¼åªè¦æä½è¿æ¡ä¸»æµç¨ï¼æä»¬å°±è½ææ¡æ¡æ¶çæ´ä½ä»£ç ç»æï¼Spring ä¹ä¸ä¾å¤ãæ è®ºéç¨ä½ç§ä¾èµæ³¨å¥æºå¶ï¼åæé½æ¯ SpringIoC å®¹å¨æ­£å¸¸å¯å¨ãå æ­¤ï¼IoC å®¹å¨åå§åå°±æ¯æä»¬çè§£åææ¡ä¾èµæ³¨äººå®ç°æºå¶çåæã\n\nä¸é¢æä»¬è®²è§£ IoC å®¹å¨çåå§åè¿ç¨ãç»å Bean ççå½å¨æï¼å°å¶æ¢³çä¸ºä¸¤å¤§æ­¥éª¤ï¼\n\n * Bean çæ³¨å\n * Bean çå®ä¾å\n\n\n# 2.1 Bean çæ³¨å\n\nå¨ä½¿ç¨Springæ¶ï¼æä»¬å¯ä»¥éè¿è·åä¸ä¸ªåºç¨ä¸ä¸æ(ApplicationContext)å¯¹è±¡æ¥æä½åç§ Beanï¼ç¤ºä¾ä»£ç å¦ä¸ï¼\n\nAnnotationConfigApplicationContext applicationContext = new AnnotationConfigApplicationContext(AppConfig.class);\n\n\n1\n\n * è¿éç ApplicationContext æ¥å£ä»£è¡¨çå°±æ¯ä¸ä¸ªSpring IoC å®¹å¨ï¼èå¨ Spring ä¸­å­å¨å¤§æ¹ ApplicationContext æ¥å£çå®ç°ç±»ãå¦æä½¿ç¨åºäºæ³¨è§£çéç½®æ¹å¼ï¼å°±å¯ä»¥ä½¿ç¨ä¸è¿°ä»£ç ä¸­ç AnnotationConfigApplicationContext æ¥åå§åå®¹å¨ä¸ä¸æå¯¹è±¡ã\n\nçä¸ä¸ AnnotationConfigApplicationContext çå¯å¨æµç¨ï¼è¿ä¸æµç¨ä½äºå®çæé å½æ°ä¸­ï¼å¦ä¸ï¼\n\npublic AnnotationConfigApplicationContext(Class<?>...annotatedClasses) {\n  this();\n  //æ ¹æ®æ³¨è§£éç½®ç±»æ³¨å Bean\n  register(annotatedClasses);\n  //å·æ°å®¹å¨\n  refresh();\n}\n\npublic AnnotationConfigApplicationContext(String...basePackages) {\n  this();\n  //æ ¹æ®åè·¯å¾éç½®æ«æ Bean\n  scan(basePackages);\n  // å·æ°å®¹å¨\n  refresh();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n * è¿ä¸¤ä¸ªæé å½æ°çä½ç¨å¾æç¡®ï¼ä¸ä¸ªæ¯æ ¹æ®æ³¨è§£éç½®ç±»æ³¨å Beanï¼å¦ä¸ä¸ªåæ¯æ ¹æ®åè·¯å¾éç½®æ«æ Beanã\n\nè¿éæä»¬ä»¥ register() æ¹æ³ä¸ºä¾ï¼æ¥è®¨è®º Bean çæ³¨åè¿ç¨ãè¯¥ register() ä¼ä¾èµ AnnolatedBeanDeinitionReader å·¥å·ç±»æ¥å®æ Bean çæ³¨åãè¿ä¸ªå·¥å·ç±»ä¼éåææä¼ å¥ç annotatedClasses æ³¨è§£ç±»ï¼ç¶åéè¿ doRegisterBean() æ¹æ³å®ææ³¨åã\n\nå¨ doRegisterBean() æ¹æ³ä¸­ï¼åå«äº Bean æ³¨åè¿ç¨ä¸­çä¸ä¸ªæ ¸å¿æ­¥éª¤ï¼å¦ä¸å¾ï¼\n\n * é¦åï¼æä»¬æå»ºç¨æ¥æè¿° Bean å®ä¾ä¿¡æ¯ç BeanDefinition å¯¹è±¡ï¼è¿éè¦å°æ³¨è§£éç½®ç±»ä¿¡æ¯è½¬æ AnnotatedGenericBeanDefinition æ°æ®ç»æï¼èå®å°±æ¯ä¸ç§ BeanDefinitionï¼åå«äº Bean çæé å½æ°åæ°ãåç§å±æ§å¼ä»¥åææ·»å çæ³¨è§£ä¿¡æ¯ã\n   * Bean çå±æ§å¼ï¼å¦ Student ç±»ç ageãname ç­ï¼å°±æ¯å±æ§\n * ç¶åï¼æä»¬è®¾ç½® BeanDefinition å±æ§ï¼è¿ä¸æ­¥éª¤å®æäºå¯¹ @Scopeã@Primaryã@Lazy ç­æ³¨è§£çå¤çã\n * æåï¼éè¿ registerBeanDefinition() æ¹æ³å®æ Bean çæ³¨åï¼è¯¥æ¹æ³åé¨éè¿ ListableBeanFactory çå®ç°ç±» DefaultListableBeanFactoryå° Bean å®ä¹ä¿¡æ¯æ³¨åå° Spring IoC å®¹å¨ä¸­ã\n   * ListableBeanFactory æ¯ Spring ä¸­å¸¸ç¨çä¸ä¸ª BeanFactoryï¼éè¿è¿ä¸ªæ¥å£ï¼æä»¬å¯ä»¥ä¸æ¬¡è·åå¤ä¸ª Beanã\n\n\n# 2.2 Bean çå®ä¾å\n\nä¸ä¸å°å°èä¸­ç Bean çæ³¨åå¹¶æªå®æå®ä¾åï¼åªæ¯å° Bean çå®ä¹å è½½å°äºå®¹å¨ä¸­ã\n\nè¦æ ¹æ®æ³¨åç Bean çå®ä¹è°ç¨ ApplicationContext æ¥å£çæ½è±¡å®ç°ç±» AbstractApplicationContext ä¸­ç refresh() æ¹æ³å·æ°å®¹å¨ï¼æ­£å¦æä»¬å¨åé¢çå°ç AnnotationConfigApplicationContext æé å½æ°ææ§è¡çé£æ ·ãå¯ä»¥è¯´ï¼refresh() æ¹æ³æ¯æ´ä¸ª Spring å®¹å¨ä¸­æä¸ºæ ¸å¿çä¸ä¸ªæ¹æ³ï¼æä»¬è¿éåªå¯¹ refresh() ä¸­åä¾èµæ³¨å¥ç¸å³çé¨åè®¨è®ºã\n\nrefresh() æ¹æ³ä¸­ï¼\n\n * obtainFreshBeanFactory() æ¹æ³å®æ BeanDefinition çæ³¨åå¹¶è¿åä¸ä¸ªBeanFactoryãå¯¹äº AnnotationConfigApplicationContext èè¨ï¼è¿ä¸æ­¥å®éä¸å°±æ¯å° BeanDefinition æ³¨åå° DefaultListableBeanFactory èå·²ï¼æä»¬å¨åé¢å·²ç»ä»ç»äºè¿ä¸æ­¥éª¤ã\n * è finishBeanFactorylnitialization() æ¹æ³ææ¯çæ­£çå®æ Bean å®ä¾åçå¥å£ã\n\nå¨ finishBeanFactorylnitialization() å¯¹ Bean çå®ä¾ååç»åäºä¸çªæè¾ï¼\n\n * å®æ Bean çå®ä¾åçä»£ç å®éä¸ä½äºæ³å®çå­ç±» DefaultListableBeanFactory ä¸­ï¼çprelnstantiateSingletons() æ¹æ³ï¼\n * è¯¥æ¹æ³è°ç¨ getBean() æ¹æ³ï¼å¯ä»¥ä» BeanFactory ä¸­è·å Beanï¼è Bean çåå§åè¿ç¨ä¹è¢«å°è£å¨è¿ä¸ªæ¹æ³ä¸­ã\n * å¨ getBean() ä¸­ï¼åç°å®éä¸æ¯ç±å®ç°æ½è±¡æ¹æ³ createBean() çå¯ä¸ BeanFactory ââ AbstractAutowireCapableBeanFactory ä¸­ï¼ç doCreateBean() æ¹æ³ä¸­çæ­£å®æ Bean çåå»ºã\n\ndoCreateBean() æ¹æ³ä¸­åå«ä¸ä¸ªæ ¸å¿å­æ¹æ³ï¼ä»ä»¬çåç§°åä½ç¨å¦ä¸å¾ï¼ç»è¿å¤§éè£åªä¹åå¾å°çä»£ç å¦ä¸æç¤ºã\n\nprotected object docreateBean(final String beanName, final RootBeanDefinitioimbd, final @Nullable object[] args) throws BeanCreationException {\n  //1. åå§åBean\n  instanceWrapper =createBeanInstance(beanNameï¼mbdï¼args);\n\n  //2. åå§åBeanå®ä¾\n  populateBean(beanNameï¼ mbdï¼instanceWrapper);\n  \n  //3. æ§è¡åå§å Bean å®ä¾çåè°\n  exposedObject=initializeBean(beanNameï¼exposedObjectï¼mbd);\n\n  return exposedObject;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n * createBeanInstance0 æ¹æ³ç¨äºæ ¹æ®éç½®çæå·ä½ç Beanï¼æç»éè¿åºäºæé å¨çåå°æ¹æ³å®ç°è¿ä¸ç®æ ãè¯·æ³¨æï¼æ§è¡å®è¿ä¸æ­¥ä¹åï¼Bean å·²ç»è¢«åå»ºäºä½è¿ä¸å®æ´ï¼å ä¸ºå±æ§è¿æ²¡æè¢«æ³¨å¥ã\n * æ¥ä¸æ¥ç populateBean() æ¹æ³å°±æ¯ç¨äºå®ç°å±æ§çèªå¨æ³¨äººï¼åå« byNameãbyType ç±»åçèªå¨è£éï¼ä»¥ååºäº @Autowiredã@Value æ³¨è§£çå±æ§è®¾å¼ãæ§è¡å®è¿ä¸æ­¥ä¹åï¼å¯ä»¥è¯´ Bean å·²ç»æ¯å®æ´çäºã\n * æåç initializeBean()æ¹æ³åæ´å¤æ¯ä¸ç§æ©å±æ§çå®ç°æºå¶ï¼ç¨äºå¨ Beanåå§åå®æä¹åæ§è¡ä¸äºå®å¶åæä½ã\n\nè³æ­¤ï¼éå¯¹æ´ä¸ª Bean çæ³¨äººè¿ç¨(å³ Bean çæ³¨ååå®ä¾å)ï¼æä»¬å´ç»æ ¸å¿æµç¨åäºåæåæ»ç»ã\n\n\n# 3. Spring å¾ªç¯ä¾èµåæ\n\nä½¿ç¨ Ioc å®¹å¨æ¶çä¸ä¸ªå¸¸è§é®é¢ï¼å¾ªç¯ä¾èµã\n\nå¨åä¾ä½ç¨åä¸ï¼Setter æ¹æ³æ³¨å¥è½å¤è§£å³å¾ªç¯ä¾èµé®é¢èæé å¨æ³¨å¥åä¸è½ã\n\nå¯¹äºåä¾ä½ç¨åæ¥è¯´ï¼Spring å®¹å¨å¨æ´ä¸ªçå½å¨æåï¼æä¸åªæä¸ä¸ª Bean å¯¹è±¡ï¼æä»¥å¾å®¹ææ³å°è¿ä¸ªå¯¹è±¡åºè¯¥å­å¨äºç¼å­ä¸­ãSpringä¸ºäºè§£å³åä¾ Bean çå¾ªç¯ä¾èµé®é¢ï¼ä½¿ç¨äºä¸çº§ç¼å­ãè¿æ¯ Spring å¨è®¾è®¡åå®ç°ä¸çä¸å¤§ç¹è²ï¼ä¹æ¯å¼åäººåå¨é¢è¯è¿ç¨ä¸­ç»å¸¸éå°çè¯é¢ã\n\n\n# 3.1 ä¸çº§ç¼å­ç»æ\n\næè°çä¸çº§ç¼å­ï¼å¨Springä¸­è¡¨ç°ä¸ºä¸ä¸ª Map å¯¹è±¡ï¼å¦ä¸çä»£ç æç¤ºï¼\n\nè¿ä¸ä¸ªMap å¯¹è±¡å®ä¹å¨ DefaultSingletonBeanRegistry ç±»ä¸­ï¼è¯¥ç±»æ¯ DefaultListableBeanFactory çç¶ç±»ã\n\n * singletonObjects åéå°±æ¯ç­ä¸çº§ç¼å­ï¼ç¨æ¥ææå®æ´ç Beanå®ä¾\n * earlySingletonObjects ä¸­å­æ¾çæ¯é£äºæåæ´é²çå¯¹è±¡ï¼ä¹å°±æ¯å·²ç»åå»ºä½è¿æ²¡æå®æå±æ§æ±ªäººçå¯¹è±¡ï¼å±äºç¬¬äºçº§ç¼å­\n * singletonFactories å­æ¾ç¨æ¥åå»ºearlySingletonObjects çå·¥åå¯¹è±¡ï¼å±äºç¬¬ä¸çº§ç¼å­\n\n\n# 3.2 ä¸çº§ç¼å­å¦ä½åæ¥ä½ç¨çï¼\n\næä»¬éè¿åæè·å Bean çä»£ç æµç¨æ¥çè§£å¯¹ä¸çº§ç¼å­çè®¿é®è¿ç¨ã\n\nprotected object getSingleton(String beanName, boolean allowEarlyReference) {\n    //é¦åä»ä¸çº§ç¼å­singletonObjects ä¸­è·åObject \n    singletonObject = this.singletonObjects.get(beanName);\n\n    //å¦æè·åä¸å°ï¼å°±ä»äºçº§ç¼å­ earlysingletonobjects ä¸­è·å\n    if (singletonobject == null && isSingletonCurrentlyInCreation(beanName)) {\n      synchronized (this.singletonObjects) {\n        singletonObject = this.earlySingletonObjects.get(beanName);\n        \n        //å¦æè¿æ¯è·åä¸å°ï¼å°±ä»ä¸çº§ç¼å­ singletonPactory ä¸­è·å\n        if (singletonObject == null && allowEarlyReference){\n          ObjectFactory<?> singletonFactory = this.singletonFactories.get(beanName);\n          if (singletonFactory != null){\n            singletonObject = singletonFactory.getobject();\n            \n            //ä¸æ¦è·åæåï¼å°±æå¯¹è±¡ä»ç¬¬ä¸çº§ç¼å­ç§»å¨å°ç¬¬äºçº§ç¼å­ä¸­\n            this.earlySingletonobjects.put(beanNameï¼singletonObject);\n            this.singletonFactories.remove(beanName);\n          }\n        }\n      }\n    }\n    return singletonObject;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nçäºè¿æ®µä»£ç ï¼å¯è½è¿æ¯ä¸çè§£ Spring ä¸ºä»ä¹è¦è¿æ ·è®¾è®¡ãäºå®ä¸ï¼è§£å³å¾ªç¯ä¾èµçå³é®è¿æ¯è¦å´ç» Bean ççå½å¨æãSpring è§£å³å¾ªç¯ä¾èµçè¯çªå°±å¨äº singletonFactories è¿ä¸ªç¬¬ä¸çº§ç¼å­ã\n\nä¸ä¸å°å°èæä»¬ä»ç» Bean çå®ä¾åæ¶ï¼æä»¬ç¥éå®åå«ä¸ä¸ªæ ¸å¿æ­¥éª¤ï¼èå¨ç¬¬ä¸æ­¥åç¬¬äºæ­¥ä¹é´ï¼å­å¨ä¸ä¸ªaddSingletonFactory() æ¹æ³ï¼ç¨äºåå§åç¬¬ä¸çº§ç¼å­ä¸­çæ°æ®ï¼ä»éå¯¹å¾ªç¯ä¾èµé®é¢æ´é²åä¾å·¥åç±»ï¼ä»£ç å¦ä¸å¾æç¤ºï¼\n\naddSingletonFactory() æ¹æ³çå·ä½ä»£ç å°±ä¸å¨è¿éå±å¼äºã\n\naddSingletonFactory() æ¹æ³çä»£ç çæ§è¡æ¶æºæ¯å¨å·²ç»éè¿æé å½æ°åå»º Beanï¼ä½è¿æ²¡æå®æå¯¹ Bean ä¸­å®æå±æ§çæ³¨äººçæ¶åãæ¢å¥è¯è¯´ï¼Ben å·²ç»å¯ä»¥è¢«æ´é²åºæ¥è¿è¡è¯å«äºï¼ä½è¿ä¸è½æ­£å¸¸ä½¿ç¨ã\n\n\n# 3.3 å¾ªç¯ä¾èµè§£å³æ¹æ¡\n\næ¥ä¸æ¥æä»¬å°±æ¥åæä¸ä¸ä¸ºä»ä¹éè¿è¿ç§æºå¶å°±è½è§£å³å¾ªç¯ä¾èµé®é¢ã\n\nè®©æä»¬åé¡¾åºäº Setter æ¹æ³æ³¨å¥çå¾ªç¯ä¾èµåºæ¯:\n\nç°å¨æä»¬å°±è½å¤åºäº Setter æ¹æ³æ³¨å¥æ¥è§£å³æå¾ªç¯ä¾èµäºï¼æ´ä¸ªæµç¨å¦ä¸å¾ï¼\n\nåºäº Setter æ¹æ³æ³¨å¥è§£å³å¾ªç¯ä¾èµçå·ä½æè¿°ï¼å¯¹ä¸å¾çè§£éï¼\n\nç°å¨åè®¾æä»¬ååå§å ClassAãClassA é¦åéè¿ createBeanInstance() æ¹æ³åå»ºäºå®ä¾ï¼å¹¶ä¸å°è¿ä¸ªå®ä¾æåæ´é²å°ç¬¬ä¸çº§ç¼å­ singletonFactories ä¸­ãç¶åï¼ClassA å°è¯éè¿ populateBean() æ¹æ³æ³¨äººå±æ§ï¼åç°èªå·±ä¾èµClassB è¿ä¸ªå±æ§ï¼å°±ä¼å°è¯å»è·å ClassBçå®ä¾ã\n\næ¾ç¶ï¼è¿æ¶å ClassB è¿æ²¡æè¢«åå»ºï¼æä»¥è¦èµ°åå»ºæµç¨ãClassB å¨åå§åç¬¬ä¸æ­¥çæ¶ååç°èªå·±ä¾èµäº ClassAï¼å°±ä¼å°è¯ä»ç¬¬ä¸çº§ç¼å­ singletonObjects å»è·å ClassAå®ä¾ãå ä¸º ClassA è¿æ¶åè¿æ²¡æè¢«åå»ºå®æ¯ï¼æä»¥å®å¨ç¬¬ä¸çº§ç¼å­åç¬¬äºçº§ç¼å­ä¸­é½ä¸å­å¨ãå½å°è¯è®¿é®ç¬¬ä¸çº§ç¼å­æ¶ï¼å ä¸º ClassA å·²ç»æåæ´é²äºï¼æä»¥ ClassB è½å¤éè¿singletonFactoriesæ¿å° ClassA å¯¹è±¡å¹¶é¡ºå©å®æææåå§åæµç¨ã\n\nClassB å¯¹è±¡åå»ºå®æä¹åä¼è¢«æ¾å°ç¬¬ä¸çº§ç¼å­ä¸­ï¼è¿æ¶å ClassA å°±è½ä»ç¬¬ä¸çº§ç¼å­ä¸­è·å ClassB çå®ä¾ï¼è¿èå®æ ClassA çææåå§åæµãè¿æ · ClassA å ClassB é½è½å¤åå®æåå»ºè¿ç¨ï¼\n\nè®²å°è¿éï¼ç¸ä¿¡ä½ ä¹çè§£äºä¸ºä»ä¹æé å¨æ³¨å¥æ æ³è§£å³å¾ªç¯ä¾èµé®é¢ãè¿æ¯å ä¸ºæé å¨æ³¨äººè¿ç¨æ¯åçå¨ Bean åå§åçç¬¬ä¸ä¸ªæ­¥éª¤ createBeanInstance() ä¸­ï¼èè¿ä¸ªæ­¥éª¤è¿æ²¡æè°ç¨ addSingletonFactory0æ¹æ³å®æç¬¬ä¸çº§ç¼å­çæå»ºï¼èªç¶ä¹å°±æ æ³ä»è¯¥ç¼å­ä¸­è·åç®æ å¯¹è±¡ã",normalizedContent:"# 1. åºæ¬æ¦å¿µ\n\nä¾èµæ³¨å¥ï¼dependency injection, diï¼ï¼å¨ç³»ç»è¿è¡æ¶åºäºæä¸ªå¯¹è±¡çä½¿ç¨éæ±ï¼å¨ææä¾ä»æä¾èµçå¶ä»å¯¹è±¡ï¼éè¿ä¾èµæ³¨å¥å®ç°ã\n\n\n# 2. springä¾èµæ³¨å¥åçåæ\n\nspring ä¸­æ¶åå¤§éç±»åç»ä»¶ä¹é´çåä½ä¸äº¤äºãåçä¸è®²ï¼ä»»ä½ä¸ä¸ªæ¡æ¶é½å­å¨ä¸æ¡æ ¸å¿æ§è¡æµç¨ï¼åªè¦æä½è¿æ¡ä¸»æµç¨ï¼æä»¬å°±è½ææ¡æ¡æ¶çæ´ä½ä»£ç ç»æï¼spring ä¹ä¸ä¾å¤ãæ è®ºéç¨ä½ç§ä¾èµæ³¨å¥æºå¶ï¼åæé½æ¯ springioc å®¹å¨æ­£å¸¸å¯å¨ãå æ­¤ï¼ioc å®¹å¨åå§åå°±æ¯æä»¬çè§£åææ¡ä¾èµæ³¨äººå®ç°æºå¶çåæã\n\nä¸é¢æä»¬è®²è§£ ioc å®¹å¨çåå§åè¿ç¨ãç»å bean ççå½å¨æï¼å°å¶æ¢³çä¸ºä¸¤å¤§æ­¥éª¤ï¼\n\n * bean çæ³¨å\n * bean çå®ä¾å\n\n\n# 2.1 bean çæ³¨å\n\nå¨ä½¿ç¨springæ¶ï¼æä»¬å¯ä»¥éè¿è·åä¸ä¸ªåºç¨ä¸ä¸æ(applicationcontext)å¯¹è±¡æ¥æä½åç§ beanï¼ç¤ºä¾ä»£ç å¦ä¸ï¼\n\nannotationconfigapplicationcontext applicationcontext = new annotationconfigapplicationcontext(appconfig.class);\n\n\n1\n\n * è¿éç applicationcontext æ¥å£ä»£è¡¨çå°±æ¯ä¸ä¸ªspring ioc å®¹å¨ï¼èå¨ spring ä¸­å­å¨å¤§æ¹ applicationcontext æ¥å£çå®ç°ç±»ãå¦æä½¿ç¨åºäºæ³¨è§£çéç½®æ¹å¼ï¼å°±å¯ä»¥ä½¿ç¨ä¸è¿°ä»£ç ä¸­ç annotationconfigapplicationcontext æ¥åå§åå®¹å¨ä¸ä¸æå¯¹è±¡ã\n\nçä¸ä¸ annotationconfigapplicationcontext çå¯å¨æµç¨ï¼è¿ä¸æµç¨ä½äºå®çæé å½æ°ä¸­ï¼å¦ä¸ï¼\n\npublic annotationconfigapplicationcontext(class<?>...annotatedclasses) {\n  this();\n  //æ ¹æ®æ³¨è§£éç½®ç±»æ³¨å bean\n  register(annotatedclasses);\n  //å·æ°å®¹å¨\n  refresh();\n}\n\npublic annotationconfigapplicationcontext(string...basepackages) {\n  this();\n  //æ ¹æ®åè·¯å¾éç½®æ«æ bean\n  scan(basepackages);\n  // å·æ°å®¹å¨\n  refresh();\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n * è¿ä¸¤ä¸ªæé å½æ°çä½ç¨å¾æç¡®ï¼ä¸ä¸ªæ¯æ ¹æ®æ³¨è§£éç½®ç±»æ³¨å beanï¼å¦ä¸ä¸ªåæ¯æ ¹æ®åè·¯å¾éç½®æ«æ beanã\n\nè¿éæä»¬ä»¥ register() æ¹æ³ä¸ºä¾ï¼æ¥è®¨è®º bean çæ³¨åè¿ç¨ãè¯¥ register() ä¼ä¾èµ annolatedbeandeinitionreader å·¥å·ç±»æ¥å®æ bean çæ³¨åãè¿ä¸ªå·¥å·ç±»ä¼éåææä¼ å¥ç annotatedclasses æ³¨è§£ç±»ï¼ç¶åéè¿ doregisterbean() æ¹æ³å®ææ³¨åã\n\nå¨ doregisterbean() æ¹æ³ä¸­ï¼åå«äº bean æ³¨åè¿ç¨ä¸­çä¸ä¸ªæ ¸å¿æ­¥éª¤ï¼å¦ä¸å¾ï¼\n\n * é¦åï¼æä»¬æå»ºç¨æ¥æè¿° bean å®ä¾ä¿¡æ¯ç beandefinition å¯¹è±¡ï¼è¿éè¦å°æ³¨è§£éç½®ç±»ä¿¡æ¯è½¬æ annotatedgenericbeandefinition æ°æ®ç»æï¼èå®å°±æ¯ä¸ç§ beandefinitionï¼åå«äº bean çæé å½æ°åæ°ãåç§å±æ§å¼ä»¥åææ·»å çæ³¨è§£ä¿¡æ¯ã\n   * bean çå±æ§å¼ï¼å¦ student ç±»ç ageãname ç­ï¼å°±æ¯å±æ§\n * ç¶åï¼æä»¬è®¾ç½® beandefinition å±æ§ï¼è¿ä¸æ­¥éª¤å®æäºå¯¹ @scopeã@primaryã@lazy ç­æ³¨è§£çå¤çã\n * æåï¼éè¿ registerbeandefinition() æ¹æ³å®æ bean çæ³¨åï¼è¯¥æ¹æ³åé¨éè¿ listablebeanfactory çå®ç°ç±» defaultlistablebeanfactoryå° bean å®ä¹ä¿¡æ¯æ³¨åå° spring ioc å®¹å¨ä¸­ã\n   * listablebeanfactory æ¯ spring ä¸­å¸¸ç¨çä¸ä¸ª beanfactoryï¼éè¿è¿ä¸ªæ¥å£ï¼æä»¬å¯ä»¥ä¸æ¬¡è·åå¤ä¸ª beanã\n\n\n# 2.2 bean çå®ä¾å\n\nä¸ä¸å°å°èä¸­ç bean çæ³¨åå¹¶æªå®æå®ä¾åï¼åªæ¯å° bean çå®ä¹å è½½å°äºå®¹å¨ä¸­ã\n\nè¦æ ¹æ®æ³¨åç bean çå®ä¹è°ç¨ applicationcontext æ¥å£çæ½è±¡å®ç°ç±» abstractapplicationcontext ä¸­ç refresh() æ¹æ³å·æ°å®¹å¨ï¼æ­£å¦æä»¬å¨åé¢çå°ç annotationconfigapplicationcontext æé å½æ°ææ§è¡çé£æ ·ãå¯ä»¥è¯´ï¼refresh() æ¹æ³æ¯æ´ä¸ª spring å®¹å¨ä¸­æä¸ºæ ¸å¿çä¸ä¸ªæ¹æ³ï¼æä»¬è¿éåªå¯¹ refresh() ä¸­åä¾èµæ³¨å¥ç¸å³çé¨åè®¨è®ºã\n\nrefresh() æ¹æ³ä¸­ï¼\n\n * obtainfreshbeanfactory() æ¹æ³å®æ beandefinition çæ³¨åå¹¶è¿åä¸ä¸ªbeanfactoryãå¯¹äº annotationconfigapplicationcontext èè¨ï¼è¿ä¸æ­¥å®éä¸å°±æ¯å° beandefinition æ³¨åå° defaultlistablebeanfactory èå·²ï¼æä»¬å¨åé¢å·²ç»ä»ç»äºè¿ä¸æ­¥éª¤ã\n * è finishbeanfactorylnitialization() æ¹æ³ææ¯çæ­£çå®æ bean å®ä¾åçå¥å£ã\n\nå¨ finishbeanfactorylnitialization() å¯¹ bean çå®ä¾ååç»åäºä¸çªæè¾ï¼\n\n * å®æ bean çå®ä¾åçä»£ç å®éä¸ä½äºæ³å®çå­ç±» defaultlistablebeanfactory ä¸­ï¼çprelnstantiatesingletons() æ¹æ³ï¼\n * è¯¥æ¹æ³è°ç¨ getbean() æ¹æ³ï¼å¯ä»¥ä» beanfactory ä¸­è·å beanï¼è bean çåå§åè¿ç¨ä¹è¢«å°è£å¨è¿ä¸ªæ¹æ³ä¸­ã\n * å¨ getbean() ä¸­ï¼åç°å®éä¸æ¯ç±å®ç°æ½è±¡æ¹æ³ createbean() çå¯ä¸ beanfactory ââ abstractautowirecapablebeanfactory ä¸­ï¼ç docreatebean() æ¹æ³ä¸­çæ­£å®æ bean çåå»ºã\n\ndocreatebean() æ¹æ³ä¸­åå«ä¸ä¸ªæ ¸å¿å­æ¹æ³ï¼ä»ä»¬çåç§°åä½ç¨å¦ä¸å¾ï¼ç»è¿å¤§éè£åªä¹åå¾å°çä»£ç å¦ä¸æç¤ºã\n\nprotected object docreatebean(final string beanname, final rootbeandefinitioimbd, final @nullable object[] args) throws beancreationexception {\n  //1. åå§åbean\n  instancewrapper =createbeaninstance(beannameï¼mbdï¼args);\n\n  //2. åå§åbeanå®ä¾\n  populatebean(beannameï¼ mbdï¼instancewrapper);\n  \n  //3. æ§è¡åå§å bean å®ä¾çåè°\n  exposedobject=initializebean(beannameï¼exposedobjectï¼mbd);\n\n  return exposedobject;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n * createbeaninstance0 æ¹æ³ç¨äºæ ¹æ®éç½®çæå·ä½ç beanï¼æç»éè¿åºäºæé å¨çåå°æ¹æ³å®ç°è¿ä¸ç®æ ãè¯·æ³¨æï¼æ§è¡å®è¿ä¸æ­¥ä¹åï¼bean å·²ç»è¢«åå»ºäºä½è¿ä¸å®æ´ï¼å ä¸ºå±æ§è¿æ²¡æè¢«æ³¨å¥ã\n * æ¥ä¸æ¥ç populatebean() æ¹æ³å°±æ¯ç¨äºå®ç°å±æ§çèªå¨æ³¨äººï¼åå« bynameãbytype ç±»åçèªå¨è£éï¼ä»¥ååºäº @autowiredã@value æ³¨è§£çå±æ§è®¾å¼ãæ§è¡å®è¿ä¸æ­¥ä¹åï¼å¯ä»¥è¯´ bean å·²ç»æ¯å®æ´çäºã\n * æåç initializebean()æ¹æ³åæ´å¤æ¯ä¸ç§æ©å±æ§çå®ç°æºå¶ï¼ç¨äºå¨ beanåå§åå®æä¹åæ§è¡ä¸äºå®å¶åæä½ã\n\nè³æ­¤ï¼éå¯¹æ´ä¸ª bean çæ³¨äººè¿ç¨(å³ bean çæ³¨ååå®ä¾å)ï¼æä»¬å´ç»æ ¸å¿æµç¨åäºåæåæ»ç»ã\n\n\n# 3. spring å¾ªç¯ä¾èµåæ\n\nä½¿ç¨ ioc å®¹å¨æ¶çä¸ä¸ªå¸¸è§é®é¢ï¼å¾ªç¯ä¾èµã\n\nå¨åä¾ä½ç¨åä¸ï¼setter æ¹æ³æ³¨å¥è½å¤è§£å³å¾ªç¯ä¾èµé®é¢èæé å¨æ³¨å¥åä¸è½ã\n\nå¯¹äºåä¾ä½ç¨åæ¥è¯´ï¼spring å®¹å¨å¨æ´ä¸ªçå½å¨æåï¼æä¸åªæä¸ä¸ª bean å¯¹è±¡ï¼æä»¥å¾å®¹ææ³å°è¿ä¸ªå¯¹è±¡åºè¯¥å­å¨äºç¼å­ä¸­ãspringä¸ºäºè§£å³åä¾ bean çå¾ªç¯ä¾èµé®é¢ï¼ä½¿ç¨äºä¸çº§ç¼å­ãè¿æ¯ spring å¨è®¾è®¡åå®ç°ä¸çä¸å¤§ç¹è²ï¼ä¹æ¯å¼åäººåå¨é¢è¯è¿ç¨ä¸­ç»å¸¸éå°çè¯é¢ã\n\n\n# 3.1 ä¸çº§ç¼å­ç»æ\n\næè°çä¸çº§ç¼å­ï¼å¨springä¸­è¡¨ç°ä¸ºä¸ä¸ª map å¯¹è±¡ï¼å¦ä¸çä»£ç æç¤ºï¼\n\nè¿ä¸ä¸ªmap å¯¹è±¡å®ä¹å¨ defaultsingletonbeanregistry ç±»ä¸­ï¼è¯¥ç±»æ¯ defaultlistablebeanfactory çç¶ç±»ã\n\n * singletonobjects åéå°±æ¯ç­ä¸çº§ç¼å­ï¼ç¨æ¥ææå®æ´ç beanå®ä¾\n * earlysingletonobjects ä¸­å­æ¾çæ¯é£äºæåæ´é²çå¯¹è±¡ï¼ä¹å°±æ¯å·²ç»åå»ºä½è¿æ²¡æå®æå±æ§æ±ªäººçå¯¹è±¡ï¼å±äºç¬¬äºçº§ç¼å­\n * singletonfactories å­æ¾ç¨æ¥åå»ºearlysingletonobjects çå·¥åå¯¹è±¡ï¼å±äºç¬¬ä¸çº§ç¼å­\n\n\n# 3.2 ä¸çº§ç¼å­å¦ä½åæ¥ä½ç¨çï¼\n\næä»¬éè¿åæè·å bean çä»£ç æµç¨æ¥çè§£å¯¹ä¸çº§ç¼å­çè®¿é®è¿ç¨ã\n\nprotected object getsingleton(string beanname, boolean allowearlyreference) {\n    //é¦åä»ä¸çº§ç¼å­singletonobjects ä¸­è·åobject \n    singletonobject = this.singletonobjects.get(beanname);\n\n    //å¦æè·åä¸å°ï¼å°±ä»äºçº§ç¼å­ earlysingletonobjects ä¸­è·å\n    if (singletonobject == null && issingletoncurrentlyincreation(beanname)) {\n      synchronized (this.singletonobjects) {\n        singletonobject = this.earlysingletonobjects.get(beanname);\n        \n        //å¦æè¿æ¯è·åä¸å°ï¼å°±ä»ä¸çº§ç¼å­ singletonpactory ä¸­è·å\n        if (singletonobject == null && allowearlyreference){\n          objectfactory<?> singletonfactory = this.singletonfactories.get(beanname);\n          if (singletonfactory != null){\n            singletonobject = singletonfactory.getobject();\n            \n            //ä¸æ¦è·åæåï¼å°±æå¯¹è±¡ä»ç¬¬ä¸çº§ç¼å­ç§»å¨å°ç¬¬äºçº§ç¼å­ä¸­\n            this.earlysingletonobjects.put(beannameï¼singletonobject);\n            this.singletonfactories.remove(beanname);\n          }\n        }\n      }\n    }\n    return singletonobject;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nçäºè¿æ®µä»£ç ï¼å¯è½è¿æ¯ä¸çè§£ spring ä¸ºä»ä¹è¦è¿æ ·è®¾è®¡ãäºå®ä¸ï¼è§£å³å¾ªç¯ä¾èµçå³é®è¿æ¯è¦å´ç» bean ççå½å¨æãspring è§£å³å¾ªç¯ä¾èµçè¯çªå°±å¨äº singletonfactories è¿ä¸ªç¬¬ä¸çº§ç¼å­ã\n\nä¸ä¸å°å°èæä»¬ä»ç» bean çå®ä¾åæ¶ï¼æä»¬ç¥éå®åå«ä¸ä¸ªæ ¸å¿æ­¥éª¤ï¼èå¨ç¬¬ä¸æ­¥åç¬¬äºæ­¥ä¹é´ï¼å­å¨ä¸ä¸ªaddsingletonfactory() æ¹æ³ï¼ç¨äºåå§åç¬¬ä¸çº§ç¼å­ä¸­çæ°æ®ï¼ä»éå¯¹å¾ªç¯ä¾èµé®é¢æ´é²åä¾å·¥åç±»ï¼ä»£ç å¦ä¸å¾æç¤ºï¼\n\naddsingletonfactory() æ¹æ³çå·ä½ä»£ç å°±ä¸å¨è¿éå±å¼äºã\n\naddsingletonfactory() æ¹æ³çä»£ç çæ§è¡æ¶æºæ¯å¨å·²ç»éè¿æé å½æ°åå»º beanï¼ä½è¿æ²¡æå®æå¯¹ bean ä¸­å®æå±æ§çæ³¨äººçæ¶åãæ¢å¥è¯è¯´ï¼ben å·²ç»å¯ä»¥è¢«æ´é²åºæ¥è¿è¡è¯å«äºï¼ä½è¿ä¸è½æ­£å¸¸ä½¿ç¨ã\n\n\n# 3.3 å¾ªç¯ä¾èµè§£å³æ¹æ¡\n\næ¥ä¸æ¥æä»¬å°±æ¥åæä¸ä¸ä¸ºä»ä¹éè¿è¿ç§æºå¶å°±è½è§£å³å¾ªç¯ä¾èµé®é¢ã\n\nè®©æä»¬åé¡¾åºäº setter æ¹æ³æ³¨å¥çå¾ªç¯ä¾èµåºæ¯:\n\nç°å¨æä»¬å°±è½å¤åºäº setter æ¹æ³æ³¨å¥æ¥è§£å³æå¾ªç¯ä¾èµäºï¼æ´ä¸ªæµç¨å¦ä¸å¾ï¼\n\nåºäº setter æ¹æ³æ³¨å¥è§£å³å¾ªç¯ä¾èµçå·ä½æè¿°ï¼å¯¹ä¸å¾çè§£éï¼\n\nç°å¨åè®¾æä»¬ååå§å classaãclassa é¦åéè¿ createbeaninstance() æ¹æ³åå»ºäºå®ä¾ï¼å¹¶ä¸å°è¿ä¸ªå®ä¾æåæ´é²å°ç¬¬ä¸çº§ç¼å­ singletonfactories ä¸­ãç¶åï¼classa å°è¯éè¿ populatebean() æ¹æ³æ³¨äººå±æ§ï¼åç°èªå·±ä¾èµclassb è¿ä¸ªå±æ§ï¼å°±ä¼å°è¯å»è·å classbçå®ä¾ã\n\næ¾ç¶ï¼è¿æ¶å classb è¿æ²¡æè¢«åå»ºï¼æä»¥è¦èµ°åå»ºæµç¨ãclassb å¨åå§åç¬¬ä¸æ­¥çæ¶ååç°èªå·±ä¾èµäº classaï¼å°±ä¼å°è¯ä»ç¬¬ä¸çº§ç¼å­ singletonobjects å»è·å classaå®ä¾ãå ä¸º classa è¿æ¶åè¿æ²¡æè¢«åå»ºå®æ¯ï¼æä»¥å®å¨ç¬¬ä¸çº§ç¼å­åç¬¬äºçº§ç¼å­ä¸­é½ä¸å­å¨ãå½å°è¯è®¿é®ç¬¬ä¸çº§ç¼å­æ¶ï¼å ä¸º classa å·²ç»æåæ´é²äºï¼æä»¥ classb è½å¤éè¿singletonfactoriesæ¿å° classa å¯¹è±¡å¹¶é¡ºå©å®æææåå§åæµç¨ã\n\nclassb å¯¹è±¡åå»ºå®æä¹åä¼è¢«æ¾å°ç¬¬ä¸çº§ç¼å­ä¸­ï¼è¿æ¶å classa å°±è½ä»ç¬¬ä¸çº§ç¼å­ä¸­è·å classb çå®ä¾ï¼è¿èå®æ classa çææåå§åæµãè¿æ · classa å classb é½è½å¤åå®æåå»ºè¿ç¨ï¼\n\nè®²å°è¿éï¼ç¸ä¿¡ä½ ä¹çè§£äºä¸ºä»ä¹æé å¨æ³¨å¥æ æ³è§£å³å¾ªç¯ä¾èµé®é¢ãè¿æ¯å ä¸ºæé å¨æ³¨äººè¿ç¨æ¯åçå¨ bean åå§åçç¬¬ä¸ä¸ªæ­¥éª¤ createbeaninstance() ä¸­ï¼èè¿ä¸ªæ­¥éª¤è¿æ²¡æè°ç¨ addsingletonfactory0æ¹æ³å®æç¬¬ä¸çº§ç¼å­çæå»ºï¼èªç¶ä¹å°±æ æ³ä»è¯¥ç¼å­ä¸­è·åç®æ å¯¹è±¡ã",charsets:{cjk:!0},lastUpdated:"2023/04/22, 13:40:03",lastUpdatedTimestamp:1682170803e3},{title:"åºç¡",frontmatter:{title:"åºç¡",date:"2022-05-15T21:16:06.000Z",permalink:"/pages/a53eb3/",categories:["å¼å","GoLang","ç ç¥ä¹è·¯-å­¦ä¹ ç¬è®°"],tags:[null]},regularPath:"/%E5%BC%80%E5%8F%91/15.GoLang/05.%E7%A0%81%E7%A5%9E%E4%B9%8B%E8%B7%AF-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/05.%E5%9F%BA%E7%A1%80.html",relativePath:"å¼å/15.GoLang/05.ç ç¥ä¹è·¯-å­¦ä¹ ç¬è®°/05.åºç¡.md",key:"v-53b20642",path:"/pages/a53eb3/",headers:[{level:2,title:"1. åé",slug:"_1-åé",normalizedTitle:"1. åé",charIndex:65},{level:3,title:"1.1 æ åæ ¼å¼",slug:"_1-1-æ åæ ¼å¼",normalizedTitle:"1.1 æ åæ ¼å¼",charIndex:129},{level:3,title:"1.2 åºæ¬ç±»å",slug:"_1-2-åºæ¬ç±»å",normalizedTitle:"1.2 åºæ¬ç±»å",charIndex:257},{level:3,title:"1.3 ä¸ææåéç±»å",slug:"_1-3-ä¸ææåéç±»å",normalizedTitle:"1.3 ä¸ææåéç±»å",charIndex:616}],headersStr:"1. åé 1.1 æ åæ ¼å¼ 1.2 åºæ¬ç±»å 1.3 ä¸ææåéç±»å",content:'# åºç¡\n\n> ç°å¨å·²ç»ä¸ç¨ GOROOT å GOPATH é£å¥äºï¼ç´æ¥ç¨ go mod å³å¯ã\n> \n> ââ å¤§æ\n\n\n# 1. åé\n\n> Goè¯­è¨æ¯éæç±»åè¯­è¨ï¼å æ­¤åéï¼variableï¼æ¯ææç¡®ç±»åçï¼ç¼è¯å¨ä¹ä¼æ£æ¥åéç±»åçæ­£ç¡®æ§ã\n\n\n# 1.1 æ åæ ¼å¼\n\nvar åéå åéç±»å\n\n\n1\n\n\nåéå£°æä»¥å³é®å­varå¼å¤´ï¼åéç±»ååç½®ï¼è¡å°¾æ é¡»åå·\n\nä¸¾ä¸ªä¾å­\n\n//å£°æäºä¸ä¸ªåä¸ºageçåéï¼ç±»åä¸ºint\nvar age int\n\n\n1\n2\n\n\n> åéçå½åè§åéµå¾ªé©¼å³°å½åæ³\n\n\n# 1.2 åºæ¬ç±»å\n\n * bool\n * string\n * intï¼éç³»ç»ï¼ä¸è¬æ¯å ç¨4ä¸ªå­èï¼ãint8(å ä¸ä¸ªå­è)ãint16(å ä¸¤ä¸ªå­è)ãint32(å 4ä¸ªå­è)ãint64ï¼å 8ä¸ªå­èï¼\n * uintï¼æ ç¬¦å·æ´æ°ï¼ãuint8ãuint16ãuint32ãuint64ãuintptr\n * byte // uint8 çå«å\n * rune // int32 çå«å ä»£è¡¨ä¸ä¸ª Unicode ç \n * float32ãfloat64\n * complex64ãcomplex128\n\nå½ä¸ä¸ªåéè¢«å£°æä¹åï¼ç³»ç»èªå¨èµäºå®è¯¥ç±»åçé¶å¼ï¼\n\nint ä¸º 0ï¼float ä¸º 0.0ï¼bool ä¸º falseï¼string ä¸ºç©ºå­ç¬¦ä¸²ï¼æéä¸º nil\n\nææçåå­å¨ Go ä¸­é½æ¯ç»è¿åå§åçã\n\n\n# 1.3 ä¸ææåéç±»å\n\n//è®¾ç½®æ¸¸æä¸­è§è²çåå§ç­çº§ä¸º1\nvar level = 1;\n\n\n1\n2\n\n\nåä¸é¢è¿ç§å£°æåéçæ¹å¼ï¼å¹¶æ²¡æææç±»åï¼Goè¯­è¨ä¸­ï¼å¨ç¼è¯æ¶ä¼èªå¨æ¨å¯¼ç±»å\n\næä»¬å¯ä»¥ä½¿ç¨\n\nfmt.Printf("%T", level)\n\n\n1\n\n\nè¿è¡ç±»åè¾åºã',normalizedContent:'# åºç¡\n\n> ç°å¨å·²ç»ä¸ç¨ goroot å gopath é£å¥äºï¼ç´æ¥ç¨ go mod å³å¯ã\n> \n> ââ å¤§æ\n\n\n# 1. åé\n\n> goè¯­è¨æ¯éæç±»åè¯­è¨ï¼å æ­¤åéï¼variableï¼æ¯ææç¡®ç±»åçï¼ç¼è¯å¨ä¹ä¼æ£æ¥åéç±»åçæ­£ç¡®æ§ã\n\n\n# 1.1 æ åæ ¼å¼\n\nvar åéå åéç±»å\n\n\n1\n\n\nåéå£°æä»¥å³é®å­varå¼å¤´ï¼åéç±»ååç½®ï¼è¡å°¾æ é¡»åå·\n\nä¸¾ä¸ªä¾å­\n\n//å£°æäºä¸ä¸ªåä¸ºageçåéï¼ç±»åä¸ºint\nvar age int\n\n\n1\n2\n\n\n> åéçå½åè§åéµå¾ªé©¼å³°å½åæ³\n\n\n# 1.2 åºæ¬ç±»å\n\n * bool\n * string\n * intï¼éç³»ç»ï¼ä¸è¬æ¯å ç¨4ä¸ªå­èï¼ãint8(å ä¸ä¸ªå­è)ãint16(å ä¸¤ä¸ªå­è)ãint32(å 4ä¸ªå­è)ãint64ï¼å 8ä¸ªå­èï¼\n * uintï¼æ ç¬¦å·æ´æ°ï¼ãuint8ãuint16ãuint32ãuint64ãuintptr\n * byte // uint8 çå«å\n * rune // int32 çå«å ä»£è¡¨ä¸ä¸ª unicode ç \n * float32ãfloat64\n * complex64ãcomplex128\n\nå½ä¸ä¸ªåéè¢«å£°æä¹åï¼ç³»ç»èªå¨èµäºå®è¯¥ç±»åçé¶å¼ï¼\n\nint ä¸º 0ï¼float ä¸º 0.0ï¼bool ä¸º falseï¼string ä¸ºç©ºå­ç¬¦ä¸²ï¼æéä¸º nil\n\nææçåå­å¨ go ä¸­é½æ¯ç»è¿åå§åçã\n\n\n# 1.3 ä¸ææåéç±»å\n\n//è®¾ç½®æ¸¸æä¸­è§è²çåå§ç­çº§ä¸º1\nvar level = 1;\n\n\n1\n2\n\n\nåä¸é¢è¿ç§å£°æåéçæ¹å¼ï¼å¹¶æ²¡æææç±»åï¼goè¯­è¨ä¸­ï¼å¨ç¼è¯æ¶ä¼èªå¨æ¨å¯¼ç±»å\n\næä»¬å¯ä»¥ä½¿ç¨\n\nfmt.printf("%t", level)\n\n\n1\n\n\nè¿è¡ç±»åè¾åºã',charsets:{cjk:!0},lastUpdated:"2022/07/27, 11:28:29",lastUpdatedTimestamp:1658921309e3},{title:"åè¨",frontmatter:{title:"åè¨",date:"2022-04-12T20:06:38.000Z",permalink:"/pages/83009c/",categories:["ç½ç»","è·¯ç±å«æ","ãæ·±å¥æµåºè¯¦è§£RPKIã"],tags:[null]},regularPath:"/%E7%BD%91%E7%BB%9C/5.%E8%B7%AF%E7%94%B1%E5%8A%AB%E6%8C%81/5.%E3%80%8A%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E8%AF%A6%E8%A7%A3RPKI%E3%80%8B/05.%E5%89%8D%E8%A8%80.html",relativePath:"ç½ç»/5.è·¯ç±å«æ/5.ãæ·±å¥æµåºè¯¦è§£RPKIã/05.åè¨.md",key:"v-623e7b3d",path:"/pages/83009c/",headers:[{level:2,title:"ç¼©ç¥è¯­",slug:"ç¼©ç¥è¯­",normalizedTitle:"ç¼©ç¥è¯­",charIndex:219}],headersStr:"ç¼©ç¥è¯­",content:"# åè¨\n\nIETF æ¨åºäºè¿40ç¯ RFCï¼ä»¥ææå»ºä¸ä¸ªæ¯æåé´è·¯ç±å®å¨çäºèç½å·ç èµæºå¬é¥åºç¡è®¾æ½ã\n\næ¬ä¹¦ä»¥ IETF å¶å®ç RFC ä¸ºåºç¡ï¼çç¼äºå®éï¼ä»å®ä¹ãåçãæ¶æåå®éåºç¨åºåï¼ç³»ç»å°ä»ç»äº RPKI ã\n\nRPKI æ¯ä¸ä¸ªä¸äºèç½å·ç èµæºç»æç¸ç»åçåå±è®¤è¯æ¨¡åï¼å¨ X.509 è¯ä¹¦æ¡æ¶ä¸éç¨å¬é¥âç§é¥çå å¯å½¢å¼ï¼ç¨ç­¾åçæ¹å¼ä¸ºç½ç»å°ååè·¯ç±å®£åä¿¡æ¯æä¾å¯ä¿¡ä»»çåºç¡ãRPKI æ¯äºèç½è·¯ç±æ¶æä¿¡ä»»çåºç¡ã\n\n\n# ç¼©ç¥è¯­\n\nASï¼Autonomous System èªæ²»ç³»ç»\n\nAFRINICï¼Africa Network Information Centre éæ´²äºèç½ç»ä¿¡æ¯ä¸­å¿\n\nAIAï¼Authority Information Access æå¨ä¿¡æ¯è®¿é®\n\nAPNICï¼Asia Pacific Network Information Centre äºå¤ªäºèç½ç»ä¿¡æ¯ä¸­å¿\n\nARINï¼American Registry for Internet Numbers ç¾å½äºèç½å·ç æ³¨åä¸­å¿\n\nBGPï¼Border Gateway Protocol è¾¹çç½å³åè®®\n\nBGPsecï¼Border Gateway Protocol Security è¾¹çè·¯ç±åè®®å®å¨\n\nCAï¼Certification Authority è®¤è¯æå¨\n\nCMSï¼Cryptographic Message Syntax å¯ç æ¶æ¯è¯­æ³\n\nCNNICï¼China Internet Network Information Center ä¸­å½äºèç½ç»ä¿¡æ¯ä¸­å¿\n\nCPï¼Certificate Policies è¯ä¹¦ç­ç¥\n\nCPSï¼Certificate Practice Statement è¯ä¹¦æä½å£°æ\n\nCRLï¼Certificate Revocation List è¯ä¹¦æ¤éåè¡¨\n\nEEï¼End Entity ç»ç«¯å®ä½\n\nIPï¼ Internet Protocol äºèç½åè®®\n\nINRï¼Internet Number Resource äºèç½å·ç èµæº\n\nIANAï¼Internet Assigned Number Authority äºèç½å·ç åéæºæ\n\nLACNICï¼Lation American and Caribbean Internet Address Registry æä¸ç¾æ´²åå åæ¯æµ· äºèç½å°åæ³¨åæºæ\n\nRDIï¼Routing Domain Identifier è·¯ç±åæ è¯ç¬¦\n\nRIPE NCCï¼Reseaux IP Europeans Network Coordination Center æ¬§æ´²ç½ç»åè°ä¸­å¿\n\nRIRï¼Regional Internet Registry å°åºäºèç½æ³¨åæºæ\n\nROAï¼Router Origin Authorization è·¯ç±èµ·æºææ\n\nRPKIï¼Resource Public Key Infrastructure äºèç½å·ç èµæºå¬é¥åºç¡è®¾æ½\n\nRPï¼Relying Party ä¾èµæ¹\n\nS-BGPï¼Secure Border Gateway Protocol å®å¨è¾¹çè·¯ç±åè®®\n\nsoBGPï¼Secure Origin Border Gateway Protocol å®å¨æºè¾¹çè·¯ç±åè®®\n\nSIAï¼Subject Information Authority ä¸»é¢ä¿¡æ¯æå¨\n\nTAOï¼Transfer Authorization Object è½¬ç§»è®¤è¯å¯¹è±¡\n\nTAï¼Trust Anchor ä¿¡ä»»é\n\nTALï¼Trust Anchor Locator ä¿¡ä»»éå®ä½å¨",normalizedContent:"# åè¨\n\nietf æ¨åºäºè¿40ç¯ rfcï¼ä»¥ææå»ºä¸ä¸ªæ¯æåé´è·¯ç±å®å¨çäºèç½å·ç èµæºå¬é¥åºç¡è®¾æ½ã\n\næ¬ä¹¦ä»¥ ietf å¶å®ç rfc ä¸ºåºç¡ï¼çç¼äºå®éï¼ä»å®ä¹ãåçãæ¶æåå®éåºç¨åºåï¼ç³»ç»å°ä»ç»äº rpki ã\n\nrpki æ¯ä¸ä¸ªä¸äºèç½å·ç èµæºç»æç¸ç»åçåå±è®¤è¯æ¨¡åï¼å¨ x.509 è¯ä¹¦æ¡æ¶ä¸éç¨å¬é¥âç§é¥çå å¯å½¢å¼ï¼ç¨ç­¾åçæ¹å¼ä¸ºç½ç»å°ååè·¯ç±å®£åä¿¡æ¯æä¾å¯ä¿¡ä»»çåºç¡ãrpki æ¯äºèç½è·¯ç±æ¶æä¿¡ä»»çåºç¡ã\n\n\n# ç¼©ç¥è¯­\n\nasï¼autonomous system èªæ²»ç³»ç»\n\nafrinicï¼africa network information centre éæ´²äºèç½ç»ä¿¡æ¯ä¸­å¿\n\naiaï¼authority information access æå¨ä¿¡æ¯è®¿é®\n\napnicï¼asia pacific network information centre äºå¤ªäºèç½ç»ä¿¡æ¯ä¸­å¿\n\narinï¼american registry for internet numbers ç¾å½äºèç½å·ç æ³¨åä¸­å¿\n\nbgpï¼border gateway protocol è¾¹çç½å³åè®®\n\nbgpsecï¼border gateway protocol security è¾¹çè·¯ç±åè®®å®å¨\n\ncaï¼certification authority è®¤è¯æå¨\n\ncmsï¼cryptographic message syntax å¯ç æ¶æ¯è¯­æ³\n\ncnnicï¼china internet network information center ä¸­å½äºèç½ç»ä¿¡æ¯ä¸­å¿\n\ncpï¼certificate policies è¯ä¹¦ç­ç¥\n\ncpsï¼certificate practice statement è¯ä¹¦æä½å£°æ\n\ncrlï¼certificate revocation list è¯ä¹¦æ¤éåè¡¨\n\neeï¼end entity ç»ç«¯å®ä½\n\nipï¼ internet protocol äºèç½åè®®\n\ninrï¼internet number resource äºèç½å·ç èµæº\n\nianaï¼internet assigned number authority äºèç½å·ç åéæºæ\n\nlacnicï¼lation american and caribbean internet address registry æä¸ç¾æ´²åå åæ¯æµ· äºèç½å°åæ³¨åæºæ\n\nrdiï¼routing domain identifier è·¯ç±åæ è¯ç¬¦\n\nripe nccï¼reseaux ip europeans network coordination center æ¬§æ´²ç½ç»åè°ä¸­å¿\n\nrirï¼regional internet registry å°åºäºèç½æ³¨åæºæ\n\nroaï¼router origin authorization è·¯ç±èµ·æºææ\n\nrpkiï¼resource public key infrastructure äºèç½å·ç èµæºå¬é¥åºç¡è®¾æ½\n\nrpï¼relying party ä¾èµæ¹\n\ns-bgpï¼secure border gateway protocol å®å¨è¾¹çè·¯ç±åè®®\n\nsobgpï¼secure origin border gateway protocol å®å¨æºè¾¹çè·¯ç±åè®®\n\nsiaï¼subject information authority ä¸»é¢ä¿¡æ¯æå¨\n\ntaoï¼transfer authorization object è½¬ç§»è®¤è¯å¯¹è±¡\n\ntaï¼trust anchor ä¿¡ä»»é\n\ntalï¼trust anchor locator ä¿¡ä»»éå®ä½å¨",charsets:{cjk:!0},lastUpdated:"2022/04/12, 13:24:26",lastUpdatedTimestamp:1649769866e3},{title:"ç®ä»",frontmatter:{title:"ç®ä»",date:"2022-04-12T20:22:28.000Z",permalink:"/pages/b6c83c/",categories:["ç½ç»","è·¯ç±å«æ","ãæ·±å¥æµåºè¯¦è§£RPKIã"],tags:[null]},regularPath:"/%E7%BD%91%E7%BB%9C/5.%E8%B7%AF%E7%94%B1%E5%8A%AB%E6%8C%81/5.%E3%80%8A%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E8%AF%A6%E8%A7%A3RPKI%E3%80%8B/10.%E7%AE%80%E4%BB%8B.html",relativePath:"ç½ç»/5.è·¯ç±å«æ/5.ãæ·±å¥æµåºè¯¦è§£RPKIã/10.ç®ä».md",key:"v-551cf7ff",path:"/pages/b6c83c/",headers:[{level:2,title:"1.1 èæ¯",slug:"_1-1-èæ¯",normalizedTitle:"1.1 èæ¯",charIndex:9},{level:3,title:"1.1.1 ææ¯èµ·æº",slug:"_1-1-1-ææ¯èµ·æº",normalizedTitle:"1.1.1 ææ¯èµ·æº",charIndex:20},{level:3,title:"1.1.2 èªæ²»ç³»ç»åè·¯ç±å«æ",slug:"_1-1-2-èªæ²»ç³»ç»åè·¯ç±å«æ",normalizedTitle:"1.1.2 èªæ²»ç³»ç»åè·¯ç±å«æ",charIndex:432},{level:3,title:"1.1.3 äºèç½å·ç èµæºåéæ¶æ",slug:"_1-1-3-äºèç½å·ç èµæºåéæ¶æ",normalizedTitle:"1.1.3 äºèç½å·ç èµæºåéæ¶æ",charIndex:616},{level:2,title:"1.2 RPKI æ¦è¿°",slug:"_1-2-rpki-æ¦è¿°",normalizedTitle:"1.2 rpki æ¦è¿°",charIndex:845},{level:3,title:"1.2.1 RPKI çä¸ä¸ªæ ¸å¿ç»æ",slug:"_1-2-1-rpki-çä¸ä¸ªæ ¸å¿ç»æ",normalizedTitle:"1.2.1 rpki çä¸ä¸ªæ ¸å¿ç»æ",charIndex:1206},{level:3,title:"1.2.2 å·¥ä½åç",slug:"_1-2-2-å·¥ä½åç",normalizedTitle:"1.2.2 å·¥ä½åç",charIndex:1340}],headersStr:"1.1 èæ¯ 1.1.1 ææ¯èµ·æº 1.1.2 èªæ²»ç³»ç»åè·¯ç±å«æ 1.1.3 äºèç½å·ç èµæºåéæ¶æ 1.2 RPKI æ¦è¿° 1.2.1 RPKI çä¸ä¸ªæ ¸å¿ç»æ 1.2.2 å·¥ä½åç",content:"# ç®ä»\n\n\n# 1.1 èæ¯\n\n\n# 1.1.1 ææ¯èµ·æº\n\nRPKI çæ¦å¿µææ©è¯çäºæè¿°S-BGPæ¹ æ¡çè®ºæä¸­ãS-BGP æåºäºä¸ç§éå ç­¾åç BGP æ©å±æ¶æ¯æ ¼å¼ï¼ç¨ä»¥éªè¯è·¯ç±éåä¸­ IP å°ååç¼åä¼ æ­è·¯å¾ä¸ AS å·ä¹é´çç»å®å³ç³»ï¼ä»èé¿åè·¯ç±å«æãåºäºè¿æ ·çè®¾è®¡ï¼æ°å­è¯ä¹¦åç­¾åæºå¶è¢«å¼å¥ BGP èç´ï¼ ä»èé¡ºçæç« å°éè¦ä¸å¥å¬é¥åºç¡è®¾æ½ï¼Public Key Infostructureï¼PKIï¼çæ¯æãä¸ºéªè¯è·¯ç±éåç­¾åèæææçå¬é¥ï¼è¯¥ç­¾åèç IP å°ååéä¸æ¸¸ä¸ºå¶ç­¾åè¯ä¹¦ãä¸æ¹é¢éªè¯å¶ææçå¬é¥ï¼å¦ä¸æ¹é¢éªè¯è¯¥ç­¾åèå¯¹æä¸ª IP å°ååç¼çæææãåºäº IP å°åèµæºåéå³ç³»èå½¢æçå¬é¥è¯ä¹¦ä½ç³»ï¼RPKI çåºæ¬æ¡æ¶å°±æ­¤å½¢æã\n\nååç³»ç»ååé´è·¯ç±ç³»ç»ä½ä¸ºäºèç½ä¸¤å¤§åºç¡ æ§èµæºï¼å¯¹äºèç½çå®å¨æçè³å³éè¦çå½±åãå¨åé´è·¯ç±ç³»ç»å±é¢ï¼äºèç½ç¤¾åºåè®¡åé¨ç½² RPKI ä»¥ææå»ºä¸ä¸ªæ¯æåé´è·¯ç±å®å¨çäºèç½åºç¡èµæºç®¡çä½ç³»ã\n\n\n# 1.1.2 èªæ²»ç³»ç»åè·¯ç±å«æ\n\n\n\nå¦ä¸å¾æç¤ºï¼AS1 å«æäºç»è¿ AS2 éåIPå°ååç¼ä¸º218.113.28.10/15 ç AS5 çææç½ç»æµéã\n\nææå¯ä»¥è®©æä¸ª IP å°åççæ­£ææèè½ä»¥æç¡®ãå¯éªè¯çæ¹å¼ææä¸ä¸ªæèå¤ä¸ª AS ä½ä¸ºå¶å°åçåå§è·¯ç±å¹¿æ­èï¼å¹¶ä¸æ¯ä¸ª AS é½å¯ä»¥è·å¾è¯¥ææä¿¡æ¯å¹¶è¿è¡éªè¯ï¼è¿èé¿åç±»ä¼¼è·¯ç±å«æçç½ç»äºæåçã\n\n\n# 1.1.3 äºèç½å·ç èµæºåéæ¶æ\n\nå½åäºèç½ç®¡çç­ç¥åè®¸ IP å°åçææèèªç±å³å®å°å¶æææç IP å°åææï¼åéï¼ç»è°ä½¿ç¨ãRPKI çä¸»è¦åè½ä¹æ¯ä¸ºä¸è¿°ææï¼åéï¼å³ç³»æä¾å¯ä»¥éªè¯çå¯ç æå¡ãä¸ä¸ª RPKI è¯ä¹¦ä¸ä¸æ¬¡ IP å°ååéç¸å¯¹åºï¼ä¸ä¸ª RPKI å­è¯ä¹¦ä¸ä¸æ¬¡ IP å°åå­åéç¸å¯¹åºï¼æä»¥ RPKI åæ ·éç¨äºå¦å¾1-3æç¤ºçæ å½¢å¾ã\n\n\n\nä¸è¿ï¼å¨ RPKI çæ å½¢åå±ä½ç³»ä¸­ï¼ASå·ç çåéå°äº NIR è¿ä¸çº§å°±ç»æ­¢äºã\n\n\n# 1.2 RPKI æ¦è¿°\n\nRPKIæ¯ç±IETFå®å¨åé´è·¯ç±å·¥ä½ç»ï¼Secure Inter-Domain Routingï¼SIDRï¼å¶å®çä¸ä¸ªä¸ç¨çPKIæ¡æ¶ã\n\nRPKIå¹¿æ³éç¨äºç±PKIXï¼Public Key Infrastructure using X.509ï¼å®ä¹çX.509è¯ä¹¦è§èãä¸ºäºæ´å¥½å°çè§£RPKIææ¯ï¼å»ºè®®æ¬ä¹¦çè¯»èæå¥½äºåçæ âInternet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profileâï¼RFC5280ï¼å âX.509 Extensions for IP Addresses and AS Identifiersâ ï¼RFC3779ï¼éçæ¡æ¬¾ã\n\n\n# 1.2.1 RPKI çä¸ä¸ªæ ¸å¿ç»æ\n\n * æ´ä½æ¶æè§èï¼è¿æ¯ä¿è¯ RPKI ç³»ç»æ­£å¸¸è¿è¡çåºç¡ã\n\n * æ°å­ç­¾åè·¯ç±å¯¹è±¡ï¼ç´æ¥ä¸º IP/AS åéæä¾å¯ç éªè¯æå¡ã\n\n * åå¸å¼çèµæåºç³»ç»ï¼ç¨äºå­å¨ PKI å¯¹è±¡ä»¥åç­¾åè·¯ç±å¯¹è±¡ï¼ä¾ç¨æ·è®¿é®åä½¿ç¨ã\n\n\n# 1.2.2 å·¥ä½åç\n\n....\n\nåä¸ä¸å»å¦~ç±»ä¼¼äºå·¥å·ä¹¦ï¼ç¨å°æ¥å°±å¯ä»¥å¦~",normalizedContent:"# ç®ä»\n\n\n# 1.1 èæ¯\n\n\n# 1.1.1 ææ¯èµ·æº\n\nrpki çæ¦å¿µææ©è¯çäºæè¿°s-bgpæ¹ æ¡çè®ºæä¸­ãs-bgp æåºäºä¸ç§éå ç­¾åç bgp æ©å±æ¶æ¯æ ¼å¼ï¼ç¨ä»¥éªè¯è·¯ç±éåä¸­ ip å°ååç¼åä¼ æ­è·¯å¾ä¸ as å·ä¹é´çç»å®å³ç³»ï¼ä»èé¿åè·¯ç±å«æãåºäºè¿æ ·çè®¾è®¡ï¼æ°å­è¯ä¹¦åç­¾åæºå¶è¢«å¼å¥ bgp èç´ï¼ ä»èé¡ºçæç« å°éè¦ä¸å¥å¬é¥åºç¡è®¾æ½ï¼public key infostructureï¼pkiï¼çæ¯æãä¸ºéªè¯è·¯ç±éåç­¾åèæææçå¬é¥ï¼è¯¥ç­¾åèç ip å°ååéä¸æ¸¸ä¸ºå¶ç­¾åè¯ä¹¦ãä¸æ¹é¢éªè¯å¶ææçå¬é¥ï¼å¦ä¸æ¹é¢éªè¯è¯¥ç­¾åèå¯¹æä¸ª ip å°ååç¼çæææãåºäº ip å°åèµæºåéå³ç³»èå½¢æçå¬é¥è¯ä¹¦ä½ç³»ï¼rpki çåºæ¬æ¡æ¶å°±æ­¤å½¢æã\n\nååç³»ç»ååé´è·¯ç±ç³»ç»ä½ä¸ºäºèç½ä¸¤å¤§åºç¡ æ§èµæºï¼å¯¹äºèç½çå®å¨æçè³å³éè¦çå½±åãå¨åé´è·¯ç±ç³»ç»å±é¢ï¼äºèç½ç¤¾åºåè®¡åé¨ç½² rpki ä»¥ææå»ºä¸ä¸ªæ¯æåé´è·¯ç±å®å¨çäºèç½åºç¡èµæºç®¡çä½ç³»ã\n\n\n# 1.1.2 èªæ²»ç³»ç»åè·¯ç±å«æ\n\n\n\nå¦ä¸å¾æç¤ºï¼as1 å«æäºç»è¿ as2 éåipå°ååç¼ä¸º218.113.28.10/15 ç as5 çææç½ç»æµéã\n\nææå¯ä»¥è®©æä¸ª ip å°åççæ­£ææèè½ä»¥æç¡®ãå¯éªè¯çæ¹å¼ææä¸ä¸ªæèå¤ä¸ª as ä½ä¸ºå¶å°åçåå§è·¯ç±å¹¿æ­èï¼å¹¶ä¸æ¯ä¸ª as é½å¯ä»¥è·å¾è¯¥ææä¿¡æ¯å¹¶è¿è¡éªè¯ï¼è¿èé¿åç±»ä¼¼è·¯ç±å«æçç½ç»äºæåçã\n\n\n# 1.1.3 äºèç½å·ç èµæºåéæ¶æ\n\nå½åäºèç½ç®¡çç­ç¥åè®¸ ip å°åçææèèªç±å³å®å°å¶æææç ip å°åææï¼åéï¼ç»è°ä½¿ç¨ãrpki çä¸»è¦åè½ä¹æ¯ä¸ºä¸è¿°ææï¼åéï¼å³ç³»æä¾å¯ä»¥éªè¯çå¯ç æå¡ãä¸ä¸ª rpki è¯ä¹¦ä¸ä¸æ¬¡ ip å°ååéç¸å¯¹åºï¼ä¸ä¸ª rpki å­è¯ä¹¦ä¸ä¸æ¬¡ ip å°åå­åéç¸å¯¹åºï¼æä»¥ rpki åæ ·éç¨äºå¦å¾1-3æç¤ºçæ å½¢å¾ã\n\n\n\nä¸è¿ï¼å¨ rpki çæ å½¢åå±ä½ç³»ä¸­ï¼aså·ç çåéå°äº nir è¿ä¸çº§å°±ç»æ­¢äºã\n\n\n# 1.2 rpki æ¦è¿°\n\nrpkiæ¯ç±ietfå®å¨åé´è·¯ç±å·¥ä½ç»ï¼secure inter-domain routingï¼sidrï¼å¶å®çä¸ä¸ªä¸ç¨çpkiæ¡æ¶ã\n\nrpkiå¹¿æ³éç¨äºç±pkixï¼public key infrastructure using x.509ï¼å®ä¹çx.509è¯ä¹¦è§èãä¸ºäºæ´å¥½å°çè§£rpkiææ¯ï¼å»ºè®®æ¬ä¹¦çè¯»èæå¥½äºåçæ âinternet x.509 public key infrastructure certificate and certificate revocation list (crl) profileâï¼rfc5280ï¼å âx.509 extensions for ip addresses and as identifiersâ ï¼rfc3779ï¼éçæ¡æ¬¾ã\n\n\n# 1.2.1 rpki çä¸ä¸ªæ ¸å¿ç»æ\n\n * æ´ä½æ¶æè§èï¼è¿æ¯ä¿è¯ rpki ç³»ç»æ­£å¸¸è¿è¡çåºç¡ã\n\n * æ°å­ç­¾åè·¯ç±å¯¹è±¡ï¼ç´æ¥ä¸º ip/as åéæä¾å¯ç éªè¯æå¡ã\n\n * åå¸å¼çèµæåºç³»ç»ï¼ç¨äºå­å¨ pki å¯¹è±¡ä»¥åç­¾åè·¯ç±å¯¹è±¡ï¼ä¾ç¨æ·è®¿é®åä½¿ç¨ã\n\n\n# 1.2.2 å·¥ä½åç\n\n....\n\nåä¸ä¸å»å¦~ç±»ä¼¼äºå·¥å·ä¹¦ï¼ç¨å°æ¥å°±å¯ä»¥å¦~",charsets:{cjk:!0},lastUpdated:"2022/04/12, 13:24:26",lastUpdatedTimestamp:1649769866e3}],themeConfig:{nav:[{text:"é¦é¡µ",link:"/"},{text:"å¼å",items:[{text:"Java",link:"/java/"},{text:"Golang",link:"/go/"}]},{text:"AI",items:[{text:"æ·±åº¦å­¦ä¹ ",link:"/deep-learning/"}]},{text:"åºç¡",items:[{text:"Git",link:"/git/"},{text:"Linux",link:"/linux/"},{text:"DataStructure",link:"/datastructure/"},{text:"CloudNative",link:"/cloudnative/"}]},{text:"ä¸­é´ä»¶",items:[{text:"Redis",link:"/redis/"},{text:"MySQL",link:"/mysql/"}]},{text:"ç½ç»",items:[{text:"è·¯ç±å«æ",link:"/route-hijack/"}]}],sidebarDepth:2,logo:"/img/mylogo.jpeg",repo:"n7301/blog",searchMaxSuggestions:10,lastUpdated:"ä¸æ¬¡æ´æ°",docsDir:"docs",editLinks:!0,editLinkText:"ç¼è¾",sidebar:{"/00.ç®å½é¡µ/":[{title:"å¼å",collapsable:!0,children:[["05.å¼å/10.Java.md","Java","/java"],["05.å¼å/15.GoLang.md","GoLang","/go"]]},{title:"AI",collapsable:!0,children:[["10.AI/05.æ·±åº¦å­¦ä¹ .md","æ·±åº¦å­¦ä¹ ","/deep-learning"]]},{title:"åºç¡",collapsable:!0,children:[["15.åºç¡/5.Git.md","Git","/git"],["15.åºç¡/10.Linux.md","Linux","/linux"],["15.åºç¡/15.æ°æ®ç»æ.md","DataStructure","/datastructure"],["15.åºç¡/20.äºåç.md","CloudNative","/cloudnative"]]},{title:"ä¸­é´ä»¶",collapsable:!0,children:[["20.ä¸­é´ä»¶/05.Redis.md","Redis","/redis"],["20.ä¸­é´ä»¶/06.MySQL.md","MySQL","/mysql"]]},{title:"ç½ç»",collapsable:!0,children:[["25.ç½ç»/5.è·¯ç±å«æ.md","è·¯ç±å«æ","/route-hijack"]]}],catalogue:{Java:"/java",GoLang:"/go","æ·±åº¦å­¦ä¹ ":"/deep-learning",Linux:"/linux","æ°æ®ç»æ":"/datastructure","äºåç":"/cloudnative",Git:"/git",Redis:"/redis",MySQL:"/mysql","è·¯ç±å«æ":"/route-hijack"},"/AI/":[{title:"æ·±åº¦å­¦ä¹ ",collapsable:!0,children:[{title:"æå®æ¯",collapsable:!0,children:[["05.æ·±åº¦å­¦ä¹ /05.æå®æ¯/01.åºæ¬æ¦å¿µ.md","åºæ¬æ¦å¿µ","/pages/3a4ae9/"],["05.æ·±åº¦å­¦ä¹ /05.æå®æ¯/05.ç¥ç»ç½ç»è®­ç»ä¸èµ·æ¥æä¹å.md","ç¥ç»ç½ç»è®­ç»ä¸èµ·æ¥æä¹å","/pages/e6f457/"]]}]}],"/ä¸­é´ä»¶/":[{title:"Redis",collapsable:!0,children:[{title:"ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ",collapsable:!0,children:[["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/01.åºç¡æ¶æãæ°æ®ç»æä¸ IO æ¨¡å.md","åºç¡æ¶æãæ°æ®ç»æä¸ IO æ¨¡å","/pages/271391/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/04.æä¹åæºå¶ï¼AOFæ¥å¿åRDBå¿«ç§.md","æä¹åæºå¶ï¼AOFæ¥å¿åRDBå¿«ç§","/pages/d1a6d3/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/06.ä¸»ä»å¤å¶ä¸å¨åµæºå¶.md","ä¸»ä»å¤å¶ä¸å¨åµæºå¶","/pages/348567/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/09.åçéç¾¤.md","åçéç¾¤","/pages/71b166/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/11.Redis ä¸­çæ°æ®ç»æ.md","Redis ä¸­çæ°æ®ç»æ","/pages/2029a8/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/14.æ¶é´åºåæ°æ®çä¿å­.md","æ¶é´åºåæ°æ®çä¿å­","/pages/a3ed18/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/15.Redis çæ¶æ¯éåæ¹æ¡.md","Redis çæ¶æ¯éåæ¹æ¡","/pages/5d636a/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/16.å¼æ­¥æºå¶ãCPU æ¶æå¯¹æ§è½çå½±å.md","å¼æ­¥æºå¶ãCPU æ¶æå¯¹æ§è½çå½±å","/pages/ca62e3/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/18.å¦ä½åºå¯¹åæ¢ç Redis.md","å¦ä½åºå¯¹åæ¢ç Redis","/pages/f111bf/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/20.Redis çåå­ç¢çãç¼å²åº.md","Redis çåå­ç¢çãç¼å²åº","/pages/6135bf/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/23.Redis ç¨ä½ç¼å­.md","Redis ç¨ä½ç¼å­","/pages/d403e5/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/25.Redis ç¨ä½ç¼å­ä¹ç¼å­å¼å¸¸.md","Redis ç¨ä½ç¼å­ä¹ç¼å­å¼å¸¸","/pages/cbe81b/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/27.Redis ç¨ä½ç¼å­ä¹ç¼å­æ±¡æ.md","Redis ç¨ä½ç¼å­ä¹ç¼å­æ±¡æ","/pages/ea52c5/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/28.Pikaï¼åºäºSSDå®ç°å¤§å®¹éRedis.md","Pikaï¼åºäºSSDå®ç°å¤§å®¹éRedis","/pages/8f7740/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/29.æ éçåå­æä½ååå¸å¼é.md","æ éçåå­æä½ååå¸å¼é","/pages/5a1b01/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/31.Redis çäºå¡æºå¶.md","Redis çäºå¡æºå¶","/pages/932816/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/32.Redis ä¸»ä»åæ­¥çå.md","Redis ä¸»ä»åæ­¥çå","/pages/4140fe/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/36.ç§æåºæ¯ä¸çåºç¨.md","ç§æåºæ¯ä¸çåºç¨","/pages/b6efd0/"],["05.Redis/05.ä¸æ ï¼Redis æ ¸å¿ææ¯ä¸å®æ/37.éç¾¤çæ°æ®å¾æåéä¿¡å¼éé®é¢.md","éç¾¤çæ°æ®å¾æåéä¿¡å¼éé®é¢","/pages/d3d97d/"]]}]},{title:"MySQL",collapsable:!0,children:[{title:"ä¸æ ï¼MySQL å®æ 45 è®²",collapsable:!0,children:[["06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/01.åºç¡æ¶æï¼ä¸æ¡SQLæ¥è¯¢è¯­å¥æ¯å¦ä½æ§è¡çï¼.md","åºç¡æ¶æï¼ä¸æ¡SQLæ¥è¯¢è¯­å¥æ¯å¦ä½æ§è¡çï¼","/pages/473452/"],["06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/02.æ¥å¿ç³»ç»ï¼ä¸æ¡SQLæ´æ°è¯­å¥æ¯å¦ä½æ§è¡çï¼.md","æ¥å¿ç³»ç»ï¼ä¸æ¡SQLæ´æ°è¯­å¥æ¯å¦ä½æ§è¡çï¼","/pages/38bad9/"],["06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/03.äºå¡éç¦».md","äºå¡éç¦»","/pages/b99352/"],["06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/04.æ·±å¥æµåºç´¢å¼.md","æ·±å¥æµåºç´¢å¼","/pages/1ea58b/"],["06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/05.å¨å±éãè¡¨çº§éåè¡é.md","å¨å±éãè¡¨çº§éåè¡é","/pages/376254/"],["06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/06.change buffer.md","change buffer","/pages/02bb58/"],["06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/07.MySQLä¸ºä»ä¹ææ¶åä¼å éç´¢å¼.md","MySQLä¸ºä»ä¹ææ¶åä¼å éç´¢å¼","/pages/c4cff3/"],["06.MySQL/05.ä¸æ ï¼MySQL å®æ 45 è®²/08.æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼.md","æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼","/pages/fa9ec1/"]]}]}],"/åºç¡/":[{title:"Git",collapsable:!0,children:[["5.Git/05.Gitåºç¡.md","Gitåºç¡","/pages/0d79ac/"],["5.Git/10.Gitçä½¿ç¨.md","Gitçä½¿ç¨","/pages/dc4ebe/"]]},{title:"Linux",collapsable:!0,children:[{title:"é©é¡ºå¹³2021è¯¾ç¨ç¬è®°",collapsable:!0,children:[["10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/05.Linuxåºç¡ç¯.md","Linux åºç¡ç¯","/pages/c774f5/"],["10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/10.Linuxå®æç¯ï¼ä¸ï¼.md","Linuxå®æç¯ï¼ä¸ï¼","/pages/4a5b75/"],["10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/15.Linuxå®æç¯ï¼ä¸ï¼.md","Linuxå®æç¯ï¼ä¸ï¼","/pages/16468e/"],["10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/20.JavaEEä¸Pythonå®å¶ç¯.md","JavaEEä¸Pythonå®å¶ç¯","/pages/1e98d9/"],["10.Linux/05.é©é¡ºå¹³2021è¯¾ç¨ç¬è®°/25.å¤§æ°æ®å®å¶ç¯-Shellç¼ç¨.md","å¤§æ°æ®å®å¶ç¯-Shellç¼ç¨","/pages/338288/"]]},{title:"Fromå¬ä¼å·",collapsable:!0,children:[["10.Linux/10.Fromå¬ä¼å·/5.å¸¦ä½ å®ç°Linuxå½ä»¤èªç±.md","å¸¦ä½ å®ç°Linuxå½ä»¤èªç±","/pages/dd2e0e/"]]}]},{title:"æ°æ®ç»æ",collapsable:!0,children:[{title:"å¸¸è§æ°æ®ç»æ",collapsable:!0,children:[["15.æ°æ®ç»æ/05.å¸¸è§æ°æ®ç»æ/05.LSM æ .md","LSM æ ","/pages/c2aef8/"]]}]},{title:"äºåç",collapsable:!0,children:[{title:"Kuberneteså¥é¨å®æè¯¾-ç½åé",collapsable:!0,children:[["20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/01.å¼ç¯è¯.md","å¼ç¯è¯","/pages/850e00/"],["20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/02.åè¯å®¹å¨.md","åè¯å®¹å¨","/pages/1cc8db/"],["20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/09.Kubernetes çå®è£ä¸åºæ¬æ¶æ.md","Kubernetes çå®è£ä¸åºæ¬æ¶æ","/pages/757154/"],["20.äºåç/15.Kuberneteså¥é¨å®æè¯¾-ç½åé/11.YAMLãPodãJobãCronJobãConfigMapãSecret.md","YAMLãPodãJobãCronJobãConfigMapãSecret","/pages/c0d84b/"]]}]}],"/å¼å/":[{title:"Java",collapsable:!0,children:[{title:"é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°",collapsable:!0,children:[["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/05.Javaåºç¡è¯­æ³.md","Java åºç¡è¯­æ³","/pages/483565/"],["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/10.æ°ç».md","æ°ç»","/pages/a6522a/"],["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/15.æ¹æ³.md","æ¹æ³","/pages/615479/"],["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/20.é¢åå¯¹è±¡åºç¡.md","é¢åå¯¹è±¡åºç¡","/pages/d4e408/"],["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/25.å¸¸ç¨API(StringãArrayList).md","å¸¸ç¨API(StringãArrayList)","/pages/8f676c/"],["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/30.é¢åå¯¹è±¡è¿é¶1ï¼staticãåä¾ãä»£ç åãç»§æ¿ï¼.md","é¢åå¯¹è±¡è¿é¶1ï¼staticãåä¾ãä»£ç åãç»§æ¿ï¼","/pages/46cfbb/"],["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/31.é¢åå¯¹è±¡è¿é¶2ï¼åãæéä¿®é¥°ç¬¦ãæ½è±¡ç±»ãæ¥å£ï¼.md","é¢åå¯¹è±¡è¿é¶2ï¼åãæéä¿®é¥°ç¬¦ãæ½è±¡ç±»ãæ¥å£ï¼","/pages/b127ae/"],["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/32.é¢åå¯¹è±¡è¿é¶3ï¼å¤æãåé¨ç±»ãå¸¸ç¨APIï¼.md","é¢åå¯¹è±¡è¿é¶3ï¼å¤æãåé¨ç±»ãå¸¸ç¨APIï¼","/pages/a4fc75/"],["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/33.é¢åå¯¹è±¡è¿é¶4ï¼å¸¸ç¨æ¥æAPIãæ­£åãArraysç±»ãLambdaï¼.md","é¢åå¯¹è±¡è¿é¶4ï¼å¸¸ç¨æ¥æAPIãæ­£åãArraysç±»ãLambdaï¼","/pages/4cb625/"],["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/34.é¢åå¯¹è±¡è¿é¶5ï¼éåä½ç³»ï¼.md","é¢åå¯¹è±¡è¿é¶5ï¼éåä½ç³»ï¼","/pages/6013df/"],["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/35.é¢åå¯¹è±¡è¿é¶6ï¼éåä½ç³»ä¹Mapï¼.md","é¢åå¯¹è±¡è¿é¶6ï¼éåä½ç³»ä¹Mapï¼","/pages/134c54/"],["10.Java/05.é»é©¬Javaå¥é¨åºç¡-å­¦ä¹ ç¬è®°/40.é¢åå¯¹è±¡è¿é¶-è¡¥åï¼å¯ååæ°ï¼.md","é¢åå¯¹è±¡è¿é¶-è¡¥åï¼å¯ååæ°ï¼","/pages/e64834/"]]},["10.Java/10.é¢åå¯¹è±¡.md","é¢åå¯¹è±¡","/pages/017edb/"],["10.Java/15.å¸¸ç¨API.md","å¸¸ç¨API","/pages/e76788/"],["10.Java/20.å¹¶åãå¹¶è¡ãå¼æ­¥ãåæ­¥ï¼æå­ï¼.md","å¹¶åãå¹¶è¡ãå¼æ­¥ãåæ­¥ï¼æå­ï¼","/pages/5de326/"],{title:"ãSpring Boot è¿é¶-éå¤©æ°ã",collapsable:!0,children:[["10.Java/30.ãSpring Boot è¿é¶-éå¤©æ°ã/05.Springä¾èµæ³¨å¥çåçåæ.md","Springä¾èµæ³¨å¥åç","/pages/0fc51e/"]]}]},{title:"GoLang",collapsable:!0,children:[{title:"ç ç¥ä¹è·¯-å­¦ä¹ ç¬è®°",collapsable:!0,children:[["15.GoLang/05.ç ç¥ä¹è·¯-å­¦ä¹ ç¬è®°/05.åºç¡.md","åºç¡","/pages/a53eb3/"]]}]}],"/ç½ç»/":[{title:"è·¯ç±å«æ",collapsable:!0,children:[{title:"ãæ·±å¥æµåºè¯¦è§£RPKIã",collapsable:!0,children:[["5.è·¯ç±å«æ/5.ãæ·±å¥æµåºè¯¦è§£RPKIã/05.åè¨.md","åè¨","/pages/83009c/"],["5.è·¯ç±å«æ/5.ãæ·±å¥æµåºè¯¦è§£RPKIã/10.ç®ä».md","ç®ä»","/pages/b6c83c/"]]}]}]},author:{name:"Nrich",link:"https://github.com/Nrich-sunny"},blogger:{avatar:"https://blog-1310567564.cos.ap-beijing.myqcloud.com/head.jpg",name:"Nrich",slogan:"å°èªæ"},social:{icons:[{iconClass:"icon-github",title:"GitHub",link:"https://github.com/Nrich-sunny"}]},footer:{createYear:2022,copyrightInfo:'Nrich | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a>'},htmlModules:{}},locales:{"/":{lang:"zh-CN",title:"Nrich's blog",description:"webåç«¯ææ¯åå®¢,ä¸æ³¨webåç«¯å­¦ä¹ ä¸æ»ç»ãJavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,githubç­ææ¯æç« ã",path:"/"}}};var ko=t(96),_o=t(97),Eo=t(11);var So={computed:{$filterPosts(){return this.$site.pages.filter(n=>{const{frontmatter:{pageComponent:e,article:t,home:i}}=n;return!(e||!1===t||!0===i)})},$sortPosts(){return(n=this.$filterPosts).sort((n,e)=>{const t=n.frontmatter.sticky,i=e.frontmatter.sticky;return t&&i?t==i?Object(Eo.a)(n,e):t-i:t&&!i?-1:!t&&i?1:Object(Eo.a)(n,e)}),n;var n},$sortPostsByDate(){return(n=this.$filterPosts).sort((n,e)=>Object(Eo.a)(n,e)),n;var n},$groupPosts(){return function(n){const e={},t={};for(let i=0,r=n.length;i<r;i++){const{frontmatter:{categories:r,tags:a}}=n[i];"array"===Object(Eo.n)(r)&&r.forEach(t=>{t&&(e[t]||(e[t]=[]),e[t].push(n[i]))}),"array"===Object(Eo.n)(a)&&a.forEach(e=>{e&&(t[e]||(t[e]=[]),t[e].push(n[i]))})}return{categories:e,tags:t}}(this.$sortPosts)},$categoriesAndTags(){return function(n){const e=[],t=[];for(let t in n.categories)e.push({key:t,length:n.categories[t].length});for(let e in n.tags)t.push({key:e,length:n.tags[e].length});return{categories:e,tags:t}}(this.$groupPosts)}}};Ht.component(ko.default),Ht.component(_o.default);function Ro(n){return n.toString().padStart(2,"0")}t(245);Ht.component("Badge",()=>Promise.all([t.e(0),t.e(3)]).then(t.bind(null,415))),Ht.component("CodeBlock",()=>Promise.resolve().then(t.bind(null,96))),Ht.component("CodeGroup",()=>Promise.resolve().then(t.bind(null,97)));t(246),t(247);var To=t(95),wo=t.n(To),Io=t(27);let Ao,Lo;var Bo;"valine"===(Bo="gitalk")?t.e(82).then(t.t.bind(null,335,7)).then(n=>Lo=n.default):"gitalk"===Bo&&Promise.all([t.e(0),t.e(81)]).then(t.t.bind(null,336,7)).then(()=>t.e(80).then(t.t.bind(null,337,7))).then(n=>Ao=n.default);function Co(n,e){const t={};return Reflect.ownKeys(n).forEach(i=>{if("string"==typeof n[i])try{t[i]=wo.a.render(n[i],e)}catch(e){console.warn(`Comment config option error at key named "${i}"`),console.warn("More info: "+e.message),t[i]=n[i]}else t[i]=n[i]}),t}console.log(`How to use "gitalk" in ${Io.name}@v${Io.version}:`,Io.homepage);const zo={gitalk:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t);new Ao(Co({clientID:"a6e1355287947096b88b",clientSecret:"f0e77d070fabfcd5af95bebb82b2d574d7248d71",repo:"blog-gitalk-comment",owner:"xugaoyi",admin:["xugaoyi"],pagerDirection:"last",id:"<%- (frontmatter.permalink || frontmatter.to.path).slice(-16) %>",title:"ãè¯è®ºã<%- frontmatter.title %>",labels:["Gitalk","Comment"],body:"é¡µé¢ï¼<%- window.location.origin + (frontmatter.to.path || window.location.pathname) %>"},{frontmatter:n})).render(e)},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}},valine:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t),new Lo({...Co({clientID:"a6e1355287947096b88b",clientSecret:"f0e77d070fabfcd5af95bebb82b2d574d7248d71",repo:"blog-gitalk-comment",owner:"xugaoyi",admin:["xugaoyi"],pagerDirection:"last",id:"<%- (frontmatter.permalink || frontmatter.to.path).slice(-16) %>",title:"ãè¯è®ºã<%- frontmatter.title %>",labels:["Gitalk","Comment"],body:"é¡µé¢ï¼<%- window.location.origin + (frontmatter.to.path || window.location.pathname) %>"},{frontmatter:n}),el:"#"+e})},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}}},Do="vuepress-plugin-comment";let Po=null;function Oo(n){return zo.gitalk.clear(Do)}function Mo(n){return!1!==n.comment&&!1!==n.comments}function jo(n){clearTimeout(Po);if(document.querySelector("main.page"))return zo.gitalk.render(n,Do);Po=setTimeout(()=>jo(n),200)}var Uo={mounted(){Po=setTimeout(()=>{const n={to:{},from:{},...this.$frontmatter};Oo()&&Mo(n)&&jo(n)},1e3),this.$router.afterEach((n,e)=>{if(n&&e&&n.path===e.path)return;const t={to:n,from:e,...this.$frontmatter};Oo()&&Mo(t)&&jo(t)})}},$o=Object(bo.a)(Uo,(function(){return(0,this._self._c)("div")}),[],!1,null,null,null).exports,Fo=[({Vue:n,options:e,router:t,siteData:i})=>{},({Vue:n,options:e,router:t,siteData:i})=>{i.pages.map(n=>{const{frontmatter:{date:e,author:t}}=n;"string"==typeof e&&"Z"===e.charAt(e.length-1)&&(n.frontmatter.date=function(n){n instanceof Date||(n=new Date(n));return`${n.getUTCFullYear()}-${Ro(n.getUTCMonth()+1)}-${Ro(n.getUTCDate())} ${Ro(n.getUTCHours())}:${Ro(n.getUTCMinutes())}:${Ro(n.getUTCSeconds())}`}(e)),t?n.author=t:i.themeConfig.author&&(n.author=i.themeConfig.author)}),n.mixin(So)},{},({Vue:n})=>{n.mixin({computed:{$dataBlock(){return this.$options.__data__block__}}})},{},{},({router:n})=>{"undefined"!=typeof window&&function(){var n=document.createElement("script"),e=window.location.protocol.split(":")[0];n.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(n,t)}()},({router:n})=>{"undefined"!=typeof window&&(window._hmt=window._hmt||[],function(){var n=document.createElement("script");n.src="https://hm.baidu.com/hm.js?503f098e7e5b3a5b5d8c5fc2938af002";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)}(),n.afterEach((function(n){_hmt.push(["_trackPageview",n.fullPath])})))},({Vue:n})=>{n.component("Comment",$o)}],No=["Comment"];class qo extends class{constructor(){this.store=new Ht({data:{state:{}}})}$get(n){return this.store.state[n]}$set(n,e){Ht.set(this.store.state,n,e)}$emit(...n){this.store.$emit(...n)}$on(...n){this.store.$on(...n)}}{}Object.assign(qo.prototype,{getPageAsyncComponent:al,getLayoutAsyncComponent:sl,getAsyncComponent:ll,getVueComponent:ol});var Go={install(n){const e=new qo;n.$vuepress=e,n.prototype.$vuepress=e}};function Ko(n,e){const t=e.toLowerCase();return n.options.routes.some(n=>n.path.toLowerCase()===t)}var Ho={props:{pageKey:String,slotKey:{type:String,default:"default"}},render(n){const e=this.pageKey||this.$parent.$page.key;return cl("pageKey",e),Ht.component(e)||Ht.component(e,al(e)),Ht.component(e)?n(e):n("")}},Jo={functional:!0,props:{slotKey:String,required:!0},render:(n,{props:e,slots:t})=>n("div",{class:["content__"+e.slotKey]},t()[e.slotKey])},Vo={computed:{openInNewWindowTitle(){return this.$themeLocaleConfig.openNewWindowText||"(opens new window)"}}},Qo=(t(253),t(254),Object(bo.a)(Vo,(function(){var n=this._self._c;return n("span",[n("svg",{staticClass:"icon outbound",attrs:{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15"}},[n("path",{attrs:{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}}),this._v(" "),n("polygon",{attrs:{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"}})]),this._v(" "),n("span",{staticClass:"sr-only"},[this._v(this._s(this.openInNewWindowTitle))])])}),[],!1,null,null,null).exports),Xo={functional:!0,render(n,{parent:e,children:t}){if(e._isMounted)return t;e.$once("hook:mounted",()=>{e.$forceUpdate()})}};Ht.config.productionTip=!1,Ht.use(qs),Ht.use(Go),Ht.mixin(function(n,e,t=Ht){!function(n){n.locales&&Object.keys(n.locales).forEach(e=>{n.locales[e].path=e});Object.freeze(n)}(e),t.$vuepress.$set("siteData",e);const i=new(n(t.$vuepress.$get("siteData"))),r=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(i)),a={};return Object.keys(r).reduce((n,e)=>(e.startsWith("$")&&(n[e]=r[e].get),n),a),{computed:a}}(n=>class{setPage(n){this.__page=n}get $site(){return n}get $themeConfig(){return this.$site.themeConfig}get $frontmatter(){return this.$page.frontmatter}get $localeConfig(){const{locales:n={}}=this.$site;let e,t;for(const i in n)"/"===i?t=n[i]:0===this.$page.path.indexOf(i)&&(e=n[i]);return e||t||{}}get $siteTitle(){return this.$localeConfig.title||this.$site.title||""}get $canonicalUrl(){const{canonicalUrl:n}=this.$page.frontmatter;return"string"==typeof n&&n}get $title(){const n=this.$page,{metaTitle:e}=this.$page.frontmatter;if("string"==typeof e)return e;const t=this.$siteTitle,i=n.frontmatter.home?null:n.frontmatter.title||n.title;return t?i?i+" | "+t:t:i||"VuePress"}get $description(){const n=function(n){if(n){const e=n.filter(n=>"description"===n.name)[0];if(e)return e.content}}(this.$page.frontmatter.meta);return n||(this.$page.frontmatter.description||this.$localeConfig.description||this.$site.description||"")}get $lang(){return this.$page.frontmatter.lang||this.$localeConfig.lang||"en-US"}get $localePath(){return this.$localeConfig.path||"/"}get $themeLocaleConfig(){return(this.$site.themeConfig.locales||{})[this.$localePath]||{}}get $page(){return this.__page?this.__page:function(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(i.path.toLowerCase()===e.toLowerCase())return i}return{path:"",frontmatter:{}}}(this.$site.pages,this.$route.path)}},xo)),Ht.component("Content",Ho),Ht.component("ContentSlotsDistributor",Jo),Ht.component("OutboundLink",Qo),Ht.component("ClientOnly",Xo),Ht.component("Layout",sl("Layout")),Ht.component("NotFound",sl("NotFound")),Ht.prototype.$withBase=function(n){const e=this.$site.base;return"/"===n.charAt(0)?e+n.slice(1):n},window.__VUEPRESS__={version:"1.9.5",hash:"88f8a87"},async function(n){const e="undefined"!=typeof window&&window.__VUEPRESS_ROUTER_BASE__?window.__VUEPRESS_ROUTER_BASE__:xo.routerBase||xo.base,t=new qs({base:e,mode:"history",fallback:!1,routes:yo,scrollBehavior:(n,e,t)=>t||(n.hash?!Ht.$vuepress.$get("disableScrollBehavior")&&{selector:decodeURIComponent(n.hash)}:{x:0,y:0})});!function(n){n.beforeEach((e,t,i)=>{if(Ko(n,e.path))i();else if(/(\/|\.html)$/.test(e.path))if(/\/$/.test(e.path)){const t=e.path.replace(/\/$/,"")+".html";Ko(n,t)?i(t):i()}else i();else{const t=e.path+"/",r=e.path+".html";Ko(n,r)?i(r):Ko(n,t)?i(t):i()}})}(t);const i={};try{await Promise.all(Fo.filter(n=>"function"==typeof n).map(e=>e({Vue:Ht,options:i,router:t,siteData:xo,isServer:n})))}catch(n){console.error(n)}return{app:new Ht(Object.assign(i,{router:t,render:n=>n("div",{attrs:{id:"app"}},[n("RouterView",{ref:"layout"}),n("div",{class:"global-ui"},No.map(e=>n(e)))])})),router:t}}(!1).then(({app:n,router:e})=>{e.onReady(()=>{n.$mount("#app")})})}]);